<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5352 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_videoFilter2	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5352%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_editor%0A%09avidemux/common/ADM_videoFilter2%0A%09avidemux_core/ADM_coreVideoFilter/include%0A%09avidemux_core/ADM_coreVideoFilter/src&In-Reply-To=%3C200909251738.n8PHc7EQ030998%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002563.html">
   <LINK REL="Next"  HREF="002565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5352 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_videoFilter2	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5352%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_editor%0A%09avidemux/common/ADM_videoFilter2%0A%09avidemux_core/ADM_coreVideoFilter/include%0A%09avidemux_core/ADM_coreVideoFilter/src&In-Reply-To=%3C200909251738.n8PHc7EQ030998%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5352 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_videoFilter2	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src">mean at mail.berlios.de
       </A><BR>
    <I>Fri Sep 25 19:38:07 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002563.html">[Avidemux-svn-commit] r5351 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
</A></li>
        <LI>Next message: <A HREF="002565.html">[Avidemux-svn-commit] r5353 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2564">[ date ]</a>
              <a href="thread.html#2564">[ thread ]</a>
              <a href="subject.html#2564">[ subject ]</a>
              <a href="author.html#2564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-09-25 19:38:06 +0200 (Fri, 25 Sep 2009)
New Revision: 5352

Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.hxx
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/ADM_videoFilterBridge.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
Log:
[videoFilter] Skeleton for video filter

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.cpp	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.cpp	2009-09-25 17:38:06 UTC (rev 5352)
@@ -1 +0,0 @@
-// Rmed
\ No newline at end of file

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.hxx
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.hxx	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudio.hxx	2009-09-25 17:38:06 UTC (rev 5352)
@@ -1 +0,0 @@
-//

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2009-09-25 17:38:06 UTC (rev 5352)
@@ -31,6 +31,7 @@
 #include &quot;ADM_pp.h&quot;
 
 // FIXME BADLY !!!
+// This should be in a context somewhere
 static uint8_t compBuffer[MAXIMUM_SIZE * MAXIMUM_SIZE * 3];
 /**
         \fn GoToIntra

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/CMakeLists.txt	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/CMakeLists.txt	2009-09-25 17:38:06 UTC (rev 5352)
@@ -1,5 +1,4 @@
 SET(ADM_editor_SRCS
-ADM_edAudio.cpp 
 ADM_edCache.cpp 
 ADM_edIdentify.cpp 
 ADM_edLoadSave.cpp 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/ADM_videoFilterBridge.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/ADM_videoFilterBridge.cpp	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/ADM_videoFilterBridge.cpp	2009-09-25 17:38:06 UTC (rev 5352)
@@ -48,6 +48,7 @@
     printf(&quot;[VideoBridge] Goint to %&quot;LU&quot; ms\n&quot;,(uint32_t)(startTime/1000));
     video_body-&gt;GoToTime(startTime);
     firstImage=true;
+    lastSentImage=0;
     return true;
 }
 
@@ -63,7 +64,7 @@
     \fn getNextFrame
     \brief
 */
-bool         ADM_videoFilterBridge::getNextFrame(ADMImage *image)
+bool         ADM_videoFilterBridge::nextFrame(ADMImage *image)
 {
 again:
     bool r=false;
@@ -71,9 +72,11 @@
     {
         firstImage=false;
         r=video_body-&gt;samePicture(image);
+        lastSentImage=0;
     }else
     {
         r=   video_body-&gt;NextPicture(image);
+        lastSentImage++;
     }
     if(r==false) return false;
     // Translate pts if any
@@ -93,6 +96,28 @@
     return true;
 }
 /**
+    \fn getFrame
+    \brief This one is special. the lower level can only do sequential access
+            so we in case of non-sequential access we rely on the cache of decoded image.
+            (TODO)
+*/
+bool         ADM_videoFilterBridge::getFrame(uint32_t frame,ADMImage *image)
+{
+    if(frame==0)
+    {
+        rewind();
+        return nextFrame(image);
+    }
+    // Sequential access ?
+    if(frame==lastSentImage+1)
+    {
+        return nextFrame(image);
+    }
+    // Non sequential access : todo
+    ADM_assert(0);
+    return false;
+}
+/**
     \fn ADM_videoFilterBridge
 
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/CMakeLists.txt	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/CMakeLists.txt	2009-09-25 17:38:06 UTC (rev 5352)
@@ -1,5 +1,6 @@
 SET(ADM_internalVideoFilter_SRCS 
 	ADM_videoFilterBridge.cpp
         ADM_filterChain.cpp
+        ADM_pluginLoad.cpp
 )
 ADD_LIBRARY(ADM_internalVideoFilter6 STATIC ${ADM_internalVideoFilter_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2009-09-25 17:38:06 UTC (rev 5352)
@@ -239,17 +239,14 @@
     char *dmPlugins = ADM_getInstallRelativePath(startDir,&quot;ADM_plugins6&quot;,&quot;demuxers&quot;);    
     char *mxPlugins = ADM_getInstallRelativePath(startDir,&quot;ADM_plugins6&quot;,&quot;muxers&quot;);    
     char *vePlugins = ADM_getInstallRelativePath(startDir,&quot;ADM_plugins6&quot;,&quot;videoEncoders&quot;);    
-    char *vfPlugins = ADM_getInstallRelativePath(startDir,&quot;ADM_plugins6&quot;,&quot;videoFilter&quot;);
+    char *vfPlugins = ADM_getInstallRelativePath(startDir,&quot;ADM_plugins6&quot;,&quot;videoFilters&quot;);
 
     ADM_mx_loadPlugins(mxPlugins);
     delete [] mxPlugins;
 
 	ADM_ad_loadPlugins(adPlugins);
 	delete [] adPlugins;
-#if 0 // Dont load video filter now
-	ADM_vf_loadPlugins(vfPlugins);
-	delete [] vfPlugins;
-#endif
+
     ADM_av_loadPlugins(avPlugins);
     delete [] avPlugins;
 
@@ -262,6 +259,8 @@
     ADM_ve6_loadPlugins(vePlugins);
     delete [] vePlugins;
 
+    ADM_vf_loadPlugins(vfPlugins);
+    delete [] vfPlugins;
 
     // load local audio decoder plugins
 	adPlugins=ADM_getHomeRelativePath(&quot;plugins6&quot;,&quot;audioDecoder&quot;);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h	2009-09-25 17:38:06 UTC (rev 5352)
@@ -36,12 +36,15 @@
  */
 class ADM_coreVideoFilter
 {
+protected:
+            uint32_t             nextFrame;
 public:
             ADM_coreVideoFilter(ADM_coreVideoFilter *previous,CONFcouple *conf=NULL);
             ~ADM_coreVideoFilter();
 
        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
-       virtual bool         getNextFrame(ADMImage *image)=0;           /// Return the next image
+       virtual bool         getFrame(uint32_t frame,ADMImage *image)=0;    /// Return the next image
+       virtual bool         getNextFrame(ADMImage *image);              /// Dont mix getFrame &amp; getNextFrame !
 	   virtual FilterInfo  *getInfo(void);                             /// Return picture parameters after this filter
 	   virtual bool         getCoupledConf(CONFcouple **couples)=0 ;   /// Return the current filter configuration
        virtual bool         configure(void) {return true;}             /// Start graphical user interface

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h	2009-09-25 17:38:06 UTC (rev 5352)
@@ -30,11 +30,13 @@
         uint64_t            startTime,endTime;
         FilterInfo          bridgeInfo;
         bool                firstImage;
+        uint32_t            lastSentImage;
+        virtual bool        nextFrame(ADMImage *image);    /// Return the next image
 public:
                             ADM_videoFilterBridge(uint64_t startTime, uint64_t endTime);
                             ~ADM_videoFilterBridge();
-
-       virtual bool         getNextFrame(ADMImage *image);    /// Return the next image
+       virtual bool         getFrame(uint32_t frame,ADMImage *image);
+       
 	   virtual FilterInfo  *getInfo(void);                                      /// Return picture parameters after this filter
 	   virtual bool         getCoupledConf(CONFcouple **couples) {*couples=NULL;return true;} ; /// Return the current filter configuration
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp	2009-09-25 17:38:02 UTC (rev 5351)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp	2009-09-25 17:38:06 UTC (rev 5352)
@@ -37,6 +37,7 @@
  ADM_coreVideoFilter::ADM_coreVideoFilter(ADM_coreVideoFilter *previous,CONFcouple *conf)
 {
     previousFilter=previous;
+    nextFrame=0;
 }
 /**
     \fn  ~ADM_coreVideoFilter
@@ -61,4 +62,14 @@
     ADM_assert(previousFilter);
     return previousFilter-&gt;getInfo();
 }
+/**
+        \fn getNextFrame
+        \brief 
+*/  
+bool         ADM_coreVideoFilter::getNextFrame(ADMImage *image)     
+{
+      bool r=getFrame(nextFrame,image);
+      nextFrame++;
+      return true;
+}
 // EOF


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002563.html">[Avidemux-svn-commit] r5351 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
</A></li>
	<LI>Next message: <A HREF="002565.html">[Avidemux-svn-commit] r5353 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2564">[ date ]</a>
              <a href="thread.html#2564">[ thread ]</a>
              <a href="subject.html#2564">[ subject ]</a>
              <a href="author.html#2564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
