<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4538 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audio avidemux/ADM_core/src avidemux/ADM_coreAudio/src	avidemux/ADM_coreAudio/src/ADM_libsamplerate	avidemux/ADM_coreImage/include avidemux/ADM_coreImage/src	avidemux/ADM_infoExtractor avidemux/ADM_inputs/ADM_flv	avidemux/ADM_libraries avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_videoFilter cmake cmake/patches plugins	plugins/ADM_audioEncoders/lavcodec	plugins/ADM_videoFilters/Equalizer	plugins/ADM_videoFilters/Equalizer/gtk	plugins/ADM_videoFilters/ForcedPP plugins/ADM_videoFilters/McDeint	plugins/ADM_videoFilters/Mosaic	plugins/ADM_videoFilters/MplayerResize	plugins/ADM_videoFilters/lavDeinterlace
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4538%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audio%20avidemux/ADM_core/src%20avidemux/ADM_coreAudio/src%0A%09avidemux/ADM_coreAudio/src/ADM_libsamplerate%0A%09avidemux/ADM_coreImage/include%20avidemux/ADM_coreImage/src%0A%09avidemux/ADM_infoExtractor%20avidemux/ADM_inputs/ADM_flv%0A%09avidemux/ADM_libraries%20avidemux/ADM_outputs%0A%09avidemux/ADM_outputs/oplug_avi%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_videoFilter%20cmake%20cmake/patches%20plugins%0A%09plugins/ADM_audioEncoders/lavcodec%0A%09plugins/ADM_videoFilters/Equalizer%0A%09plugins/ADM_videoFilters/Equalizer/gtk%0A%09plugins/ADM_videoFilters/ForcedPP%20plugins/ADM_videoFilters/McDeint%0A%09plugins/ADM_videoFilters/Mosaic%0A%09plugins/ADM_videoFilters/MplayerResize%0A%09plugins/ADM_videoFilters/lavDeinterlace&In-Reply-To=%3C200901192253.n0JMrvVU020754%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001770.html">
   <LINK REL="Next"  HREF="001772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4538 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audio avidemux/ADM_core/src avidemux/ADM_coreAudio/src	avidemux/ADM_coreAudio/src/ADM_libsamplerate	avidemux/ADM_coreImage/include avidemux/ADM_coreImage/src	avidemux/ADM_infoExtractor avidemux/ADM_inputs/ADM_flv	avidemux/ADM_libraries avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_videoFilter cmake cmake/patches plugins	plugins/ADM_audioEncoders/lavcodec	plugins/ADM_videoFilters/Equalizer	plugins/ADM_videoFilters/Equalizer/gtk	plugins/ADM_videoFilters/ForcedPP plugins/ADM_videoFilters/McDeint	plugins/ADM_videoFilters/Mosaic	plugins/ADM_videoFilters/MplayerResize	plugins/ADM_videoFilters/lavDeinterlace</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4538%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audio%20avidemux/ADM_core/src%20avidemux/ADM_coreAudio/src%0A%09avidemux/ADM_coreAudio/src/ADM_libsamplerate%0A%09avidemux/ADM_coreImage/include%20avidemux/ADM_coreImage/src%0A%09avidemux/ADM_infoExtractor%20avidemux/ADM_inputs/ADM_flv%0A%09avidemux/ADM_libraries%20avidemux/ADM_outputs%0A%09avidemux/ADM_outputs/oplug_avi%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_videoFilter%20cmake%20cmake/patches%20plugins%0A%09plugins/ADM_audioEncoders/lavcodec%0A%09plugins/ADM_videoFilters/Equalizer%0A%09plugins/ADM_videoFilters/Equalizer/gtk%0A%09plugins/ADM_videoFilters/ForcedPP%20plugins/ADM_videoFilters/McDeint%0A%09plugins/ADM_videoFilters/Mosaic%0A%09plugins/ADM_videoFilters/MplayerResize%0A%09plugins/ADM_videoFilters/lavDeinterlace&In-Reply-To=%3C200901192253.n0JMrvVU020754%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4538 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audio avidemux/ADM_core/src avidemux/ADM_coreAudio/src	avidemux/ADM_coreAudio/src/ADM_libsamplerate	avidemux/ADM_coreImage/include avidemux/ADM_coreImage/src	avidemux/ADM_infoExtractor avidemux/ADM_inputs/ADM_flv	avidemux/ADM_libraries avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_videoFilter cmake cmake/patches plugins	plugins/ADM_audioEncoders/lavcodec	plugins/ADM_videoFilters/Equalizer	plugins/ADM_videoFilters/Equalizer/gtk	plugins/ADM_videoFilters/ForcedPP plugins/ADM_videoFilters/McDeint	plugins/ADM_videoFilters/Mosaic	plugins/ADM_videoFilters/MplayerResize	plugins/ADM_videoFilters/lavDeinterlace">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Jan 19 23:53:57 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001770.html">[Avidemux-svn-commit] r4537 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_codecs	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog
</A></li>
        <LI>Next message: <A HREF="001772.html">[Avidemux-svn-commit] r4539 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1771">[ date ]</a>
              <a href="thread.html#1771">[ thread ]</a>
              <a href="subject.html#1771">[ subject ]</a>
              <a href="author.html#1771">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-01-19 23:53:34 +0100 (Mon, 19 Jan 2009)
New Revision: 4538

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/
Modified:
   branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
Log:
[[ffmpeg] bootstrap ffmpeg (only tested win32)

Modified: branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -3,11 +3,10 @@
 MESSAGE(&quot;#####################################&quot;)
 MESSAGE(&quot;&quot;)
 
-CMAKE_MINIMUM_REQUIRED(VERSION 2.4.7 FATAL_ERROR)
+CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2 FATAL_ERROR)
 
 if (COMMAND cmake_policy)
-	cmake_policy(VERSION 2.4)
-	cmake_policy(SET CMP0003 NEW)
+	cmake_policy(SET CMP0004 OLD)
 endif (COMMAND cmake_policy)
 
 SET(CMAKE_MODULE_PATH &quot;${CMAKE_SOURCE_DIR}/cmake&quot; &quot;${CMAKE_MODULE_PATH}&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -16,9 +16,9 @@
 #include &quot;ADM_audio/ADM_dcainfo.h&quot;
 extern &quot;C&quot;
 {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/common.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot;
+#include &quot;libavutil/common.h&quot;
+#include &quot;libavutil/bswap.h&quot;
+#include &quot;libavcodec/bitstream.h&quot;
 
 }
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -37,7 +37,11 @@
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; 
 {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
+#define AV_WN16
+#define AV_WN32
+#define AV_RN16
+#define AV_RN32
+#include &quot;libavcodec/dsputil.h&quot;
 }
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -38,7 +38,13 @@
 
 extern &quot;C&quot;
 {
-	#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
+	#define HAVE_MMX
+	#define AV_WN16
+	#define AV_WN32
+	#define AV_RN16
+	#define AV_RN32
+	#include &quot;libavcodec/dsputil.h&quot;
+	#include &quot;libavcodec/avcodec.h&quot;
 
 adm_fast_memcpy myAdmMemcpy=NULL;
 /* Original comments from mplayer (file: aclib.c)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,17 +0,0 @@
-SET(ADM_LIB ADM_libsamplerate)
-
-SET(${ADM_LIB}_SRCS 
-src_linear.c
-src_sinc.c
-src_zoh.c
-)
-
-ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-ADD_DEFINITIONS( &quot;-I${CMAKE_CURRENT_SOURCE_DIR} &quot;)
-ADD_DEFINITIONS( &quot;-DADM_LEGACY_PROGGY&quot;)
-if(unix)
-ADD_DEFINITIONS( &quot;-fpic &quot;)
-endif(unix)
-# FIXME!
-ADD_DEFINITIONS( &quot;-DHAVE_LRINT -DHAVE_LRINTF &quot;)
-

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -10,12 +10,12 @@
 ADM_libsamplerate/src_zoh.c
 )	
 #*************************************************
-ADD_DEFINITIONS( &quot;-DADM_LEGACY_PROGGY&quot;)
-ADD_DEFINITIONS( &quot;-DHAVE_LRINT -DHAVE_LRINTF &quot;)
-ADD_DEFINITIONS( &quot;-DCPU_CLIPS_POSITIVE=0 -DCPU_CLIPS_NEGATIVE=0&quot;)
-ADD_DEFINITIONS( &quot;-I${CMAKE_CURRENT_SOURCE_DIR} &quot;)
-ADD_DEFINITIONS( '-DPACKAGE=&quot;SRC&quot;')
-ADD_DEFINITIONS( '-DVERSION=&quot;0.1.4&quot;')
+ADD_DEFINITIONS(-DADM_LEGACY_PROGGY)
+ADD_DEFINITIONS(-DHAVE_LRINT -DHAVE_LRINTF)
+ADD_DEFINITIONS(-DCPU_CLIPS_POSITIVE=0 -DCPU_CLIPS_NEGATIVE=0)
+ADD_DEFINITIONS(-I${CMAKE_CURRENT_SOURCE_DIR})
+ADD_DEFINITIONS(-DPACKAGE=&quot;SRC&quot;)
+ADD_DEFINITIONS(-DVERSION=&quot;0.1.4&quot;)
 #*************************************************
 ADD_LIBRARY(ADM_coreAudio SHARED ${ADMaudioCore_SRCS})
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_coreAudio/include)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h	2009-01-19 22:53:34 UTC (rev 4538)
@@ -12,7 +12,7 @@
 #ifndef ADMPP
 #define ADMPP
 extern &quot;C&quot; {
-#include &quot;../ADM_libpostproc/postprocess.h&quot;
+#include &quot;libpostproc/postprocess.h&quot;
 }
 typedef struct ADM_PP
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -20,9 +20,9 @@
 
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libavutil/avutil.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 #include &quot;ADM_rgb.h&quot; 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -16,8 +16,8 @@
 #include &quot;ADM_image.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -24,9 +24,9 @@
 #include &quot;ADM_colorspace.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libavutil/avutil.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 	

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -19,7 +19,7 @@
 #include &quot;ADM_assert.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
 }
 
 ADM_flyDialog::ADM_flyDialog(uint32_t width,uint32_t height,AVDMGenericVideoStream *in,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,8 +26,8 @@
 
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 #include &quot;ADM_colorspace.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,7 +26,7 @@
 #include &lt;string.h&gt;
 
 #include &quot;ADM_default.h&quot;
-#include &quot;colorspace.h&quot;
+#include &quot;libavcodec/colorspace.h&quot;
 
 uint8_t COL_422_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,11 +26,11 @@
 
 extern &quot;C&quot;
 {
-#include &quot;common.h&quot;
-#include &quot;bswap.h&quot;
+#include &quot;libavutil/common.h&quot;
+#include &quot;libavutil/bswap.h&quot;
 #define INT_MAX (0x7FFFFFFF)
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/golomb.h&quot;
+#include &quot;libavcodec/bitstream.h&quot;
+#include &quot;libavcodec/golomb.h&quot;
 }
 
 #include &quot;ADM_infoExtractor/ADM_h264_tag.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -25,7 +25,7 @@
 #include &quot;ADM_flv.h&quot;
 
 // Borrowed from lavformt/flv.h
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavformat/flv.h&quot;
+#include &quot;libavformat/flv.h&quot;
 // Borrowed from lavformt/flv.h    
 
 uint32_t ADM_UsecFromFps1000(uint32_t fps1000);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2009-01-19 22:53:34 UTC (rev 4538)
@@ -18,6 +18,6 @@
   #define  __ADM_LAVC
   extern &quot;C&quot;
   {  
-  #include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
+  #include &quot;libavcodec/avcodec.h&quot;
   };
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,15 +1,14 @@
-subdirs (PREORDER ADM_ffmpeg)
-subdirs (PREORDER ADM_libmpeg2enc)
-subdirs (PREORDER ADM_lvemux)
-subdirs (PREORDER ADM_mplex)
-subdirs (PREORDER ADM_smjs)
-subdirs (PREORDER ADM_utilities)
-subdirs (PREORDER ADM_xvidratectl)
+add_subdirectory(ADM_libmpeg2enc)
+add_subdirectory(ADM_lvemux)
+add_subdirectory(ADM_mplex)
+add_subdirectory(ADM_smjs)
+add_subdirectory(ADM_utilities)
+add_subdirectory(ADM_xvidratectl)
 
 if (ADM_DEBUG AND FIND_LEAKS)
-	subdirs (PREORDER ADM_nvwa)
+	add_subdirectory(ADM_nvwa)
 endif (ADM_DEBUG AND FIND_LEAKS)
 
 if (APPLE AND USE_SDL)
-	subdirs (PREORDER ADM_libsdl)
+	add_subdirectory(ADM_libsdl)
 endif (APPLE AND USE_SDL)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -28,7 +28,7 @@
 
 extern &quot;C&quot;
 {
-	#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavformat/avformat.h&quot;
+	#include &quot;libavformat/avformat.h&quot;
 };
 
 #undef malloc

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -334,8 +334,8 @@
 {
 #undef av_always_inline
 #define av_always_inline inline
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot;
+#include &quot;libavutil/bswap.h&quot;
+#include &quot;libavcodec/bitstream.h&quot;
 }
 void putNvop(ADMBitstream *data,uint32_t timebits, uint32_t timeincval)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -44,7 +44,6 @@
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_PREVIEW
 #include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h&quot;
 #include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
 #include &quot;ADM_preview.h&quot;
 #define MAX(a,b) ( (a)&gt;(b) ? (a) : (b) )

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -36,7 +36,6 @@
 #include &quot;../ADM_render/GUI_accelRender.h&quot;
 
 #include &quot;ADM_colorspace.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h&quot;
 
 void GUI_gtk_grow_off(int onff);
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -61,9 +61,9 @@
 
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libavutil/avutil.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -58,8 +58,6 @@
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_coreImage/include&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_coreAudio/include&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_utilities&quot;)
-INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavutil&quot;)
-INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavcodec&quot;)
 
 IF (GETTEXT_FOUND)
 	INCLUDE_DIRECTORIES(${GETTEXT_INCLUDE_DIR})
@@ -130,24 +128,29 @@
 
 ADD_EXECUTABLE(avidemux2_cli MACOSX_BUNDLE ${ADM_EXE_SRCS} ${MO_FILES})
 ADD_TARGET_CFLAGS(avidemux2_cli &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
-ADD_DEPENDENCIES(avidemux2_cli mofiles)
+ADD_DEPENDENCIES(avidemux2_cli mofiles  ffmpeg)
 
 IF (ADM_UI_GTK)
 	ADD_EXECUTABLE(avidemux2_gtk MACOSX_BUNDLE ${ADM_EXE_SRCS} ${MO_FILES})
 	ADD_TARGET_CFLAGS(avidemux2_gtk &quot;-I${CMAKE_BINARY_DIR}/config/gtk&quot;)
-	ADD_DEPENDENCIES(avidemux2_gtk mofiles)
+	ADD_DEPENDENCIES(avidemux2_gtk mofiles  ffmpeg)
 ENDIF (ADM_UI_GTK)
 
 IF (ADM_UI_QT4)
 	ADD_EXECUTABLE(avidemux2_qt4 MACOSX_BUNDLE ${ADM_EXE_SRCS} ${QM_FILES})
 	ADD_TARGET_CFLAGS(avidemux2_qt4 &quot;-I${CMAKE_BINARY_DIR}/config/qt4&quot;)
-	ADD_DEPENDENCIES(avidemux2_qt4 qmfiles)
+	ADD_DEPENDENCIES(avidemux2_qt4 qmfiles  ffmpeg)
 ENDIF (ADM_UI_QT4)
 
 SDLify(main.cpp)
 ADD_SOURCE_CFLAGS(main.cpp &quot;-DADM_SUBVERSION=${ADM_SUBVERSION}&quot;)
 
 ########################################
+# FFmpeg
+########################################
+include(admFFmpegBuild)
+
+########################################
 # Compile and link general subdirs
 ########################################
 SET(ADM_SUBDIR 

Added: branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+if (NOT PATCH_EXECUTABLE)
+	message(STATUS &quot;Checking for patch&quot;)
+	message(STATUS &quot;******************&quot;)
+
+	find_program(PATCH_EXECUTABLE patch)
+	set(PATCH_EXECUTABLE ${PATCH_EXECUTABLE} CACHE STRING &quot;&quot;)
+
+	if (PATCH_EXECUTABLE)
+		message(STATUS &quot;Found patch&quot;)
+		
+		if (VERBOSE)
+			message(STATUS &quot;Path: ${PATCH_EXECUTABLE}&quot;)
+		endif (VERBOSE)
+	else (PATCH_EXECUTABLE)
+		message(FATAL_ERROR &quot;patch not found&quot;)
+	endif (PATCH_EXECUTABLE)
+
+	message(&quot;&quot;)
+endif (NOT PATCH_EXECUTABLE)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,181 @@
+include(admFFmpegUtil)
+
+set(FFMPEG_VERSION 12476)
+set(SWSCALE_VERSION 26258)
+set(FFMPEG_SOURCE_DIR &quot;${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+set(FFMPEG_BINARY_DIR &quot;${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+
+set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  dnxhd  dvbsub  dvvideo  ffv1  ffvhuff  flv  fourxm  fraps  h263  h264  huffyuv  indeo2  indeo3
+					 interplay_video  mjpeg  mjpegb  mpeg1video  mpeg2video  mpeg4  mpegaudio_hp  mpegvideo  msmpeg4v1  msmpeg4v2  msmpeg4v3  msvideo1
+					 nellymoser  png  qdm2  rv10  rv20  snow  svq1  svq3  tscc  vc1  vcr1  vp3  vp5  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
+set(FFMPEG_ENCODERS  ac3  dvbsub  dvvideo  ffv1  ffvhuff  flv  flv1  h263  h263p  huffyuv  mjpeg  mpeg1video  mpeg2video  mp2  mpeg4  msmpeg4v3  snow)
+set(FFMPEG_MUXERS  flv  ipod  matroska  mov  mp4  psp  tg2  tgp)
+set(FFMPEG_PARSERS  h263  h264  mpeg4video)
+set(FFMPEG_PROTOCOLS  file)
+set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-filters --disable-protocols --disable-network --disable-indevs --disable-outdevs --disable-bsfs
+				  --disable-parsers --disable-decoders --disable-encoders --disable-demuxers --disable-muxers --enable-postproc --enable-swscale --enable-gpl 
+				  --prefix=${CMAKE_INSTALL_PREFIX})
+
+if (NOT VERBOSE)
+	set(ffmpegSvnOutput OUTPUT_VARIABLE FFMPEG_SVN_OUTPUT)
+	set(swscaleSvnOutput OUTPUT_VARIABLE SWSCALE_SVN_OUTPUT)
+	set(ffmpegBuildOutput OUTPUT_VARIABLE FFMPEG_CONFIGURE_OUTPUT)
+endif (NOT VERBOSE)
+
+# Checkout FFmpeg source and patch it
+if (NOT IS_DIRECTORY &quot;${FFMPEG_SOURCE_DIR}/.svn&quot;)
+	find_package(Patch)
+
+	message(STATUS &quot;Checking out FFmpeg&quot;)
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co <A HREF="svn://svn.ffmpeg.org/ffmpeg/trunk">svn://svn.ffmpeg.org/ffmpeg/trunk</A> -r ${FFMPEG_VERSION} --ignore-externals &quot;${FFMPEG_SOURCE_DIR}&quot;
+					${ffmpegSvnOutput})
+
+	message(STATUS &quot;Checking out libswscale&quot;)
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co <A HREF="svn://svn.ffmpeg.org/mplayer/trunk/libswscale">svn://svn.ffmpeg.org/mplayer/trunk/libswscale</A> -r ${SWSCALE_VERSION} &quot;${FFMPEG_SOURCE_DIR}/libswscale&quot;
+					${swscaleSvnOutput})
+
+	set(FFMPEG_PERFORM_PATCH 1)
+endif (NOT IS_DIRECTORY &quot;${FFMPEG_SOURCE_DIR}/.svn&quot;)
+
+# Check version
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
+message(STATUS &quot;FFmpeg revision: ${ffmpeg_WC_REVISION}&quot;)
+
+if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+	MESSAGE(STATUS &quot;Updating to revision ${FFMPEG_VERSION}&quot;)
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+	
+	find_package(Patch)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals &quot;${FFMPEG_SOURCE_DIR}&quot;
+					${ffmpegSvnOutput})	
+endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+
+message(&quot;&quot;)
+
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
+message(STATUS &quot;libswscale revision: ${swscale_WC_REVISION}&quot;)
+
+if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
+	message(STATUS &quot;Updating to revision ${SWSCALE_VERSION}&quot;)
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+	
+	find_package(Patch)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} &quot;${FFMPEG_SOURCE_DIR}/libswscale&quot;
+					${swscaleSvnOutput})
+endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
+
+message(&quot;&quot;)
+
+if (FFMPEG_PERFORM_PATCH)
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R &quot;${FFMPEG_SOURCE_DIR}&quot;
+					${ffmpegSvnOutput})
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R &quot;${FFMPEG_SOURCE_DIR}/libswscale&quot;
+					${swscaleSvnOutput})
+
+	file(GLOB patchFiles &quot;${CMAKE_SOURCE_DIR}/cmake/patches/*.patch&quot;)
+
+	foreach(patchFile ${patchFiles})
+		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i ${patchFile}
+						WORKING_DIRECTORY &quot;${FFMPEG_SOURCE_DIR}&quot;)
+	endforeach(patchFile)
+
+	message(&quot;&quot;)
+endif (FFMPEG_PERFORM_PATCH)
+
+# Configure FFmpeg, if required
+foreach (decoder ${FFMPEG_DECODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-decoder=${decoder})
+endforeach (decoder)
+
+foreach (encoder ${FFMPEG_DECODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-encoder=${encoder})
+endforeach (encoder)
+
+foreach (muxer ${FFMPEG_MUXERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-muxer=${muxer})
+endforeach (muxer)
+
+foreach (parser ${FFMPEG_PARSERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-parser=${parser})
+endforeach (parser)
+
+foreach (protocol ${FFMPEG_PROTOCOLS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-protocol=${protocol})
+endforeach (protocol)
+
+if (WIN32)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-memalign-hack --enable-w32threads)
+else (WIN32)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-pthreads)
+endif (WIN32)
+
+if (NOT ADM_DEBUG)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --disable-debug)
+endif (NOT ADM_DEBUG)
+
+if (NOT &quot;${LAST_FFMPEG_FLAGS}&quot; STREQUAL &quot;${FFMPEG_FLAGS}&quot;)
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT &quot;${LAST_FFMPEG_FLAGS}&quot; STREQUAL &quot;${FFMPEG_FLAGS}&quot;)
+
+if (NOT EXISTS &quot;${FFMPEG_BINARY_DIR}/Makefile&quot;)
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT EXISTS &quot;${FFMPEG_BINARY_DIR}/Makefile&quot;)
+
+if (FFMPEG_PERFORM_BUILD)
+	message(STATUS &quot;Configuring FFmpeg&quot;)
+	set(LAST_FFMPEG_FLAGS &quot;${FFMPEG_FLAGS}&quot; CACHE STRING &quot;&quot; FORCE)
+
+	file(MAKE_DIRECTORY &quot;${FFMPEG_BINARY_DIR}&quot;)
+	file(REMOVE &quot;${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}&quot;)
+	file(REMOVE &quot;${FFMPEG_BINARY_DIR}/ffmpeg_g${CMAKE_EXECUTABLE_SUFFIX}&quot;)
+
+	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
+					WORKING_DIRECTORY &quot;${FFMPEG_BINARY_DIR}&quot;
+					${ffmpegBuildOutput})
+	message(&quot;&quot;)
+endif (FFMPEG_PERFORM_BUILD)
+
+# Build FFmpeg
+add_custom_command(OUTPUT &quot;${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}&quot;
+				   COMMAND ${CMAKE_COMMAND}  -DCMAKE_SHARED_LIBRARY_SUFFIX=${CMAKE_SHARED_LIBRARY_SUFFIX} -P &quot;${CMAKE_SOURCE_DIR}/cmake/admFFmpegMake.cmake&quot;
+				   WORKING_DIRECTORY &quot;${FFMPEG_BINARY_DIR}&quot;)
+
+add_custom_target(ffmpeg ALL
+				  DEPENDS &quot;${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}&quot;)
+
+# Add and install libraries
+getFfmpegLibNames(&quot;${FFMPEG_SOURCE_DIR}&quot;)
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION &quot;${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}&quot;)
+install(FILES &quot;${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}&quot; DESTINATION &quot;${BIN_DIR}&quot;)
+
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION &quot;${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}&quot;)
+install(FILES &quot;${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}&quot; DESTINATION &quot;${BIN_DIR}&quot;)
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION &quot;${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}&quot;)
+install(FILES &quot;${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}&quot; DESTINATION &quot;${BIN_DIR}&quot;)
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION &quot;${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}&quot;)
+install(FILES &quot;${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}&quot; DESTINATION &quot;${BIN_DIR}&quot;)
+
+add_library(ADM_libavformat UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavformat PROPERTY IMPORTED_LOCATION &quot;${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}&quot;)
+install(FILES &quot;${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}&quot; DESTINATION &quot;${BIN_DIR}&quot;)
+
+include_directories(&quot;${FFMPEG_SOURCE_DIR}&quot;)
+include_directories(&quot;${FFMPEG_SOURCE_DIR}/libavutil&quot;)
+include_directories(&quot;${FFMPEG_SOURCE_DIR}/libpostproc&quot;)
+
+# Clean FFmpeg
+add_custom_target(cleanffmpeg
+				  COMMAND ${CMAKE_COMMAND} -P &quot;${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake&quot;
+				  WORKING_DIRECTORY &quot;${FFMPEG_BINARY_DIR}&quot;
+				  COMMENT &quot;Cleaning FFmpeg&quot;)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,2 @@
+execute_process(COMMAND make clean
+				WORKING_DIRECTORY &quot;${FFMPEG_BINARY_DIR}&quot;)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1 @@
+execute_process(COMMAND make)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+MACRO (getFfmpegVersionFromHeader description headerFile definition ffmpegVersion)
+	FILE(READ &quot;${headerFile}&quot; FFMPEG_H)
+	STRING(REGEX MATCH &quot;#define[ ]+${definition}[ ]+([0-9]+)&quot; FFMPEG_H &quot;${FFMPEG_H}&quot;)
+	STRING(REGEX REPLACE &quot;.*[ ]([0-9]+).*&quot; &quot;\\1&quot; ${ffmpegVersion} &quot;${FFMPEG_H}&quot;)
+ENDMACRO (getFfmpegVersionFromHeader)
+
+MACRO (getFfmpegLibNames sourceDir)
+	getFfmpegVersionFromHeader(&quot;libavcodec&quot; &quot;${sourceDir}/libavcodec/avcodec.h&quot; LIBAVCODEC_VERSION_MAJOR LIBAVCODEC_VERSION)
+	getFfmpegVersionFromHeader(&quot;libavformat&quot; &quot;${sourceDir}/libavformat/avformat.h&quot; LIBAVFORMAT_VERSION_MAJOR LIBAVFORMAT_VERSION)
+	getFfmpegVersionFromHeader(&quot;libavutil&quot; &quot;${sourceDir}/libavutil/avutil.h&quot; LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
+	getFfmpegVersionFromHeader(&quot;libpostproc&quot; &quot;${sourceDir}/libpostproc/postprocess.h&quot; LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
+	getFfmpegVersionFromHeader(&quot;libswscale&quot; &quot;${sourceDir}/libswscale/swscale.h&quot; LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
+	
+	set(LIBAVCODEC_LIB avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBAVFORMAT_LIB avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBAVUTIL_LIB avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBPOSTPROC_LIB postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBSWSCALE_LIB swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+ENDMACRO (getFfmpegLibNames)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,78 @@
+*** libavcodec/avcodec.h	Sat Jan 17 18:42:27 2009
+--- libavcodec/avcodec.h	Sat Jan 17 17:54:54 2009
+***************
+*** 177,182 ****
+--- 177,183 ----
+      CODEC_ID_SUNRAST,
+      CODEC_ID_INDEO4,
+      CODEC_ID_INDEO5,
++     CODEC_ID_DIRAC,
+  
+      /* various PCM &quot;codecs&quot; */
+      CODEC_ID_PCM_S16LE= 0x10000,
+***************
+*** 449,454 ****
+--- 450,457 ----
+  #define CODEC_FLAG2_CHUNKS        0x00008000 ///&lt; Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
+  #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///&lt; Use MPEG-2 nonlinear quantizer.
+  #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///&lt; Use a bit reservoir when encoding if possible
++ //MEANX: NEVER EVER USE CLOSED GOP ?
++ #define CODEC_FLAG2_32_PULLDOWN   0x80000000 
+  
+  /* Unsupported options :
+   *              Syntax Arithmetic coding (SAC)
+***************
+*** 1215,1220 ****
+--- 1218,1224 ----
+       * - decoding: unused
+       */
+      int rc_max_rate;
++     int rc_max_rate_header; /*&lt; That one is set in the header MEANX */
+  
+      /**
+       * minimum bitrate
+***************
+*** 1229,1234 ****
+--- 1233,1240 ----
+       * - decoding: unused
+       */
+      int rc_buffer_size;
++     int rc_buffer_size_header;  /*&lt; That one is set in the header MEANX*/
++ 
+      float rc_buffer_aggressivity;
+  
+      /**
+***************
+*** 2293,2299 ****
+  
+  #if LIBAVCODEC_VERSION_INT &lt; ((52&lt;&lt;16)+(0&lt;&lt;8)+0)
+  /* YUV420 format is assumed ! */
+! 
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+--- 2299,2305 ----
+  
+  #if LIBAVCODEC_VERSION_INT &lt; ((52&lt;&lt;16)+(0&lt;&lt;8)+0)
+  /* YUV420 format is assumed ! */
+! #if 0 // MEANX
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+***************
+*** 2325,2331 ****
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! 
+  #endif
+  
+  /**
+--- 2331,2337 ----
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! #endif //MEANX
+  #endif
+  
+  /**

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,13 @@
+*** libavcodec/ffv1.c	Sat Jan 17 19:11:59 2009
+--- libavcodec/ffv1.c	Tue Jan 13 19:57:28 2009
+***************
+*** 959,964 ****
+--- 959,966 ----
+          clear_state(f);
+      }else{
+          p-&gt;key_frame= 0;
++          p-&gt;pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
++ 
+      }
+      if(!f-&gt;plane[0].state &amp;&amp; !f-&gt;plane[0].vlc_state)
+          return -1;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,60 @@
+*** libavcodec/h263dec.c	Sat Jan 17 19:12:00 2009
+--- libavcodec/h263dec.c	Tue Jan 13 19:57:29 2009
+***************
+*** 118,123 ****
+--- 118,140 ----
+  
+      return 0;
+  }
++ /* MeanX : Ugly patch to detect vo ppacked stuff ... */
++ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
++ {
++     MpegEncContext *s = avctx-&gt;priv_data;
++     // set sane default
++     *vop_packed=0;
++     *gmc=0;
++     *qpel=0;
++     if(avctx-&gt;codec-&gt;id!=CODEC_ID_MPEG4) return 0;
++     	
++   	*vop_packed=(s-&gt;divx_packed);
++ 	*qpel=s-&gt;quarter_sample;
++ 	*gmc=0;	// FIXME
++ 	return 1;
++ 
++   }
++   /* MeanX */
+  
+  int ff_h263_decode_end(AVCodecContext *avctx)
+  {
+***************
+*** 412,417 ****
+--- 429,440 ----
+      } else {
+          ret = h263_decode_picture_header(s);
+      }
++ 	//MEANX we need to do it here also for quicktime file / ctts atom 
++         // we need the correct frame type, and qt file may contain 
++         // vop not coded frame.
++         pict-&gt;pict_type=s-&gt;current_picture.pict_type= s-&gt;pict_type;
++         pict-&gt;key_frame=s-&gt;current_picture.key_frame= s-&gt;pict_type == FF_I_TYPE;
++         //MEANX
+  
+      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
+  
+***************
+*** 690,695 ****
+--- 713,726 ----
+  
+  assert(s-&gt;current_picture.pict_type == s-&gt;current_picture_ptr-&gt;pict_type);
+  assert(s-&gt;current_picture.pict_type == s-&gt;pict_type);
++ /* MEANX */
++   if(s-&gt;current_picture_ptr)
++       s-&gt;current_picture_ptr-&gt;opaque=pict-&gt;opaque;
++ /* MEANX */
++ 
++ 
++ 
++ 
+      if (s-&gt;pict_type == FF_B_TYPE || s-&gt;low_delay) {
+          *pict= *(AVFrame*)s-&gt;current_picture_ptr;
+      } else if (s-&gt;last_picture_ptr != NULL) {

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,22 @@
+*** libavcodec/h264.c	Sat Jan 17 19:11:59 2009
+--- libavcodec/h264.c	Tue Jan 13 19:57:28 2009
+***************
+*** 75,80 ****
+--- 75,91 ----
+  0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
+  };
+  
++ /* MEANX */
++ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
++ {
++       H264Context *h = avctx-&gt;priv_data;
++       assert(h);
++       *nalSize=h-&gt;nal_length_size;
++       *isAvc=h-&gt;is_avc;
++ 	return 1;
++ 
++   }
++ /* MeanX */
+  
+  static void fill_caches(H264Context *h, int mb_type, int for_deblock){
+      MpegEncContext * const s = &amp;h-&gt;s;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,16 @@
+*** libavcodec/mpeg12.c	Sat Jan 17 19:17:41 2009
+--- libavcodec/mpeg12.c	Tue Jan 13 19:57:29 2009
+***************
+*** 1934,1939 ****
+--- 1934,1944 ----
+          ff_er_frame_end(s);
+  
+          MPV_frame_end(s);
++ /* MEANX */
++   if(s-&gt;current_picture_ptr)
++       s-&gt;current_picture_ptr-&gt;opaque=pict-&gt;opaque;
++ /* MEANX */
++ 
+  
+          if (s-&gt;pict_type == FF_B_TYPE || s-&gt;low_delay) {
+              *pict= *(AVFrame*)s-&gt;current_picture_ptr;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,231 @@
+*** libavcodec/mpeg12enc.c	Sat Jan 17 21:33:37 2009
+--- libavcodec/mpeg12enc.c	Sat Jan 17 21:35:16 2009
+***************
+*** 127,136 ****
+--- 127,145 ----
+              s-&gt;frame_rate_index= i;
+          }
+      }
++  /* MEANX 
++ 
+      if(dmin)
+          return -1;
+      else
+          return 0;
++   */
++         if(dmin&gt;4)
++    {
++         av_log(0,AV_LOG_ERROR,&quot;We did a roundup ! Expect async!\n&quot;);
++    }
++         return 0; //MEANX
++ 
+  }
+  
+  static int encode_init(AVCodecContext *avctx)
+***************
+*** 208,213 ****
+--- 217,223 ----
+  
+              put_bits(&amp;s-&gt;pb, 12, s-&gt;width);
+              put_bits(&amp;s-&gt;pb, 12, s-&gt;height);
++ #if 0 //MEANX
+  
+              for(i=1; i&lt;15; i++){
+                  float error= aspect_ratio;
+***************
+*** 223,242 ****
+                      s-&gt;aspect_ratio_info= i;
+                  }
+              }
+  
+!             put_bits(&amp;s-&gt;pb, 4, s-&gt;aspect_ratio_info);
+!             put_bits(&amp;s-&gt;pb, 4, s-&gt;frame_rate_index);
+! 
+!             if(s-&gt;avctx-&gt;rc_max_rate){
+!                 v = (s-&gt;avctx-&gt;rc_max_rate + 399) / 400;
+                  if (v &gt; 0x3ffff &amp;&amp; s-&gt;codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s-&gt;avctx-&gt;rc_buffer_size)
+!                 vbv_buffer_size = s-&gt;avctx-&gt;rc_buffer_size;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s-&gt;bit_rate) / (1151929 / 2)) * 8 * 1024;
+--- 233,276 ----
+                      s-&gt;aspect_ratio_info= i;
+                  }
+              }
++ #endif // MEANX
++             //MEANX put_bits(&amp;s-&gt;pb, 4, s-&gt;aspect_ratio_info);
++             //MEANX put_bits(&amp;s-&gt;pb, 4, s-&gt;frame_rate_index);
++  // MEANX 4:3
++   if(s-&gt;avctx-&gt;sample_aspect_ratio.num==16 &amp;&amp; s-&gt;avctx-&gt;sample_aspect_ratio.den==9)
++             {
++                 //printf(&quot;FFmpeg : Wide\n&quot;);
++                 put_bits(&amp;s-&gt;pb,4,3); //16:9
++             }
++             else        //4:3
++             {
++               if(s-&gt;codec_id == CODEC_ID_MPEG2VIDEO)
++                 put_bits(&amp;s-&gt;pb, 4, 2);
++               else
++                 put_bits(&amp;s-&gt;pb, 4, 12); // MPEG1
++             }
++ // /MEANX
++ 
++ // //MEANX PULLDOWN            put_bits(&amp;s-&gt;pb, 4, s-&gt;frame_rate_index);
++ if((s-&gt;flags2 &amp; CODEC_FLAG2_32_PULLDOWN) &amp;&amp; (s-&gt;codec_id == CODEC_ID_MPEG2VIDEO))
++             {           
++                 put_bits(&amp;s-&gt;pb, 4,4);
++             }
++             else
++             {                                  
++                 put_bits(&amp;s-&gt;pb, 4, s-&gt;frame_rate_index);
++             } //MEANX pulldown
+  
+!             if(s-&gt;avctx-&gt;rc_max_rate_header){ //MEANX we use header
+!                 v = (s-&gt;avctx-&gt;rc_max_rate_header + 399) / 400;
+                  if (v &gt; 0x3ffff &amp;&amp; s-&gt;codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s-&gt;avctx-&gt;rc_buffer_size_header) // MEANX we use header
+!                 vbv_buffer_size = s-&gt;avctx-&gt;rc_buffer_size_header;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s-&gt;bit_rate) / (1151929 / 2)) * 8 * 1024;
+***************
+*** 269,276 ****
+  
+                  put_bits(&amp;s-&gt;pb, 3, s-&gt;avctx-&gt;profile); //profile
+                  put_bits(&amp;s-&gt;pb, 4, s-&gt;avctx-&gt;level); //level
+  
+-                 put_bits(&amp;s-&gt;pb, 1, s-&gt;progressive_sequence);
+                  put_bits(&amp;s-&gt;pb, 2, s-&gt;chroma_format);
+                  put_bits(&amp;s-&gt;pb, 2, 0); //horizontal size ext
+                  put_bits(&amp;s-&gt;pb, 2, 0); //vertical size ext
+--- 303,319 ----
+  
+                  put_bits(&amp;s-&gt;pb, 3, s-&gt;avctx-&gt;profile); //profile
+                  put_bits(&amp;s-&gt;pb, 4, s-&gt;avctx-&gt;level); //level
++    // MEANX pulldown put_bits(&amp;s-&gt;pb, 1, s-&gt;progressive_sequence);
++   // MEANX Pulldown
++  if(s-&gt;flags2 &amp; CODEC_FLAG2_32_PULLDOWN) //MEANX
++                         put_bits(&amp;s-&gt;pb, 1, 0);
++                 else
++                         put_bits(&amp;s-&gt;pb, 1, s-&gt;progressive_sequence);
++ 
++ 
++ // /MEANX
++ 
+  
+                  put_bits(&amp;s-&gt;pb, 2, s-&gt;chroma_format);
+                  put_bits(&amp;s-&gt;pb, 2, 0); //horizontal size ext
+                  put_bits(&amp;s-&gt;pb, 2, 0); //vertical size ext
+***************
+*** 334,339 ****
+--- 377,384 ----
+  
+  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
+  {
++ 	int tff,rff; //MEANX
++ 
+      mpeg1_encode_sequence_header(s);
+  
+      /* mpeg1 picture header */
+***************
+*** 370,375 ****
+--- 415,463 ----
+  
+      s-&gt;frame_pred_frame_dct = 1;
+      if(s-&gt;codec_id == CODEC_ID_MPEG2VIDEO){
++  /* MEANX -- Pulldown */
++         if(s-&gt;flags2 &amp; CODEC_FLAG2_32_PULLDOWN)
++         {
++         
++                 switch((s-&gt;picture_number - 
++                           s-&gt;gop_picture_number)&amp;3)
++                 {
++                         case 0:
++                         default:
++                                 rff=1;
++                                 tff=1;
++                                 break;
++                         case 1:
++                                 rff=0;
++                                 tff=0;
++                                 break;
++                         case 2:
++                                 rff=1;
++                                 tff=0;
++                                 break;
++                         case 3:
++                                 rff=0;
++                                 tff=1;
++                                 break;
++                 }               
++            }
++         else
++         {
++                 if (s-&gt;progressive_sequence) 
++                 {
++                         tff=0; /* no repeat */
++                 } else 
++                 {
++                         tff= s-&gt;current_picture_ptr-&gt;top_field_first;
++                 }
++                 rff=s-&gt;repeat_first_field;
++         
++         }
++ 
++ //               /MEANX pulldown
++ 
++ 
++ 
+          put_header(s, EXT_START_CODE);
+          put_bits(&amp;s-&gt;pb, 4, 8); //pic ext
+          if (s-&gt;pict_type == FF_P_TYPE || s-&gt;pict_type == FF_B_TYPE) {
+***************
+*** 388,398 ****
+--- 476,491 ----
+  
+          assert(s-&gt;picture_structure == PICT_FRAME);
+          put_bits(&amp;s-&gt;pb, 2, s-&gt;picture_structure);
++ #if 0 //MEANX
++ 
+          if (s-&gt;progressive_sequence) {
+              put_bits(&amp;s-&gt;pb, 1, 0); /* no repeat */
+          } else {
+              put_bits(&amp;s-&gt;pb, 1, s-&gt;current_picture_ptr-&gt;top_field_first);
+          }
++ #endif
++          put_bits(&amp;s-&gt;pb, 1, tff);  //MEANX PULLDOWN
++ 
+          /* XXX: optimize the generation of this flag with entropy
+             measures */
+          s-&gt;frame_pred_frame_dct = s-&gt;progressive_sequence;
+***************
+*** 402,408 ****
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;q_scale_type);
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;intra_vlc_format);
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;alternate_scan);
+!         put_bits(&amp;s-&gt;pb, 1, s-&gt;repeat_first_field);
+          s-&gt;progressive_frame = s-&gt;progressive_sequence;
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;chroma_format == CHROMA_420 ? s-&gt;progressive_frame : 0); /* chroma_420_type */
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;progressive_frame);
+--- 495,504 ----
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;q_scale_type);
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;intra_vlc_format);
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;alternate_scan);
+!  // MEANX put_bits(&amp;s-&gt;pb, 1, s-&gt;repeat_first_field);
+! 	put_bits(&amp;s-&gt;pb, 1, rff);
+!       // /MEANX
+! 
+          s-&gt;progressive_frame = s-&gt;progressive_sequence;
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;chroma_format == CHROMA_420 ? s-&gt;progressive_frame : 0); /* chroma_420_type */
+          put_bits(&amp;s-&gt;pb, 1, s-&gt;progressive_frame);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,23 @@
+*** libavcodec/mpegvideo.c	Sat Jan 17 19:17:41 2009
+--- libavcodec/mpegvideo.c	Tue Jan 13 19:57:29 2009
+***************
+*** 558,564 ****
+      CHECKED_ALLOCZ(s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s-&gt;parse_context.state= -1;
+!     if((s-&gt;avctx-&gt;debug&amp;(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s-&gt;avctx-&gt;debug_mv)){
+         s-&gt;visualization_buffer[0] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
+         s-&gt;visualization_buffer[1] = av_malloc((s-&gt;mb_width*8 + EDGE_WIDTH) * s-&gt;mb_height*8 + EDGE_WIDTH);
+         s-&gt;visualization_buffer[2] = av_malloc((s-&gt;mb_width*8 + EDGE_WIDTH) * s-&gt;mb_height*8 + EDGE_WIDTH);
+--- 558,568 ----
+      CHECKED_ALLOCZ(s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s-&gt;parse_context.state= -1;
+!  //MEANX: Allocate them always, as they may be free when we decode 1st image
+! 
+!     // MEANXif((s-&gt;avctx-&gt;debug&amp;(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s-&gt;avctx-&gt;debug_mv)){
+! if(1){ // MEANX
+! 
+         s-&gt;visualization_buffer[0] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
+         s-&gt;visualization_buffer[1] = av_malloc((s-&gt;mb_width*8 + EDGE_WIDTH) * s-&gt;mb_height*8 + EDGE_WIDTH);
+         s-&gt;visualization_buffer[2] = av_malloc((s-&gt;mb_width*8 + EDGE_WIDTH) * s-&gt;mb_height*8 + EDGE_WIDTH);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,47 @@
+*** libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:28 2009
+--- libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:50 2009
+***************
+*** 371,382 ****
+--- 371,384 ----
+  
+          av_log(avctx, AV_LOG_INFO, &quot;Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n&quot;);
+      }
++ #if 0 //MEANX
+  
+      if((s-&gt;flags &amp; CODEC_FLAG_4MV) &amp;&amp; s-&gt;codec_id != CODEC_ID_MPEG4
+         &amp;&amp; s-&gt;codec_id != CODEC_ID_H263 &amp;&amp; s-&gt;codec_id != CODEC_ID_H263P &amp;&amp; s-&gt;codec_id != CODEC_ID_FLV1){
+          av_log(avctx, AV_LOG_ERROR, &quot;4MV not supported by codec\n&quot;);
+          return -1;
+      }
++ #endif
+  
+      if(s-&gt;obmc &amp;&amp; s-&gt;avctx-&gt;mb_decision != FF_MB_DECISION_SIMPLE){
+          av_log(avctx, AV_LOG_ERROR, &quot;OBMC is only supported with simple mb decision\n&quot;);
+***************
+*** 408,419 ****
+          av_log(avctx, AV_LOG_ERROR, &quot;interlacing not supported by codec\n&quot;);
+          return -1;
+      }
+  
+      if(s-&gt;mpeg_quant &amp;&amp; s-&gt;codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, &quot;mpeg2 style quantization not supported by codec\n&quot;);
+          return -1;
+      }
+! 
+      if((s-&gt;flags &amp; CODEC_FLAG_CBP_RD) &amp;&amp; !(s-&gt;flags &amp; CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, &quot;CBP RD needs trellis quant\n&quot;);
+          return -1;
+--- 410,422 ----
+          av_log(avctx, AV_LOG_ERROR, &quot;interlacing not supported by codec\n&quot;);
+          return -1;
+      }
++ #if 0 //MEANX
+  
+      if(s-&gt;mpeg_quant &amp;&amp; s-&gt;codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, &quot;mpeg2 style quantization not supported by codec\n&quot;);
+          return -1;
+      }
+! #endif
+      if((s-&gt;flags &amp; CODEC_FLAG_CBP_RD) &amp;&amp; !(s-&gt;flags &amp; CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, &quot;CBP RD needs trellis quant\n&quot;);
+          return -1;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,34 @@
+*** libavcodec/utils.c	Sat Jan 17 19:17:40 2009
+--- libavcodec/utils.c	Tue Jan 13 19:57:28 2009
+***************
+*** 959,968 ****
+--- 959,970 ----
+  
+      if((avctx-&gt;codec-&gt;capabilities &amp; CODEC_CAP_DELAY) || buf_size){
+          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
++ #if 0 // MEANX : Silence
+          if(*frame_size_ptr &lt; AVCODEC_MAX_AUDIO_FRAME_SIZE){
+              av_log(avctx, AV_LOG_ERROR, &quot;buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n&quot;);
+              return -1;
+          }
++ #endif
+          if(*frame_size_ptr &lt; FF_MIN_BUFFER_SIZE ||
+          *frame_size_ptr &lt; avctx-&gt;channels * avctx-&gt;frame_size * sizeof(int16_t)){
+              av_log(avctx, AV_LOG_ERROR, &quot;buffer %d too small\n&quot;, *frame_size_ptr);
+***************
+*** 1387,1393 ****
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, &quot;/tmp/%sXXXXXX&quot;, prefix);
+      fd = mkstemp(*filename);
+--- 1389,1395 ----
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, &quot;/tmp/%sXXXXXX&quot;, prefix);
+      fd = mkstemp(*filename);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,75 @@
+*** libavformat/file.c	Sat Jan 17 23:12:09 2009
+--- libavformat/file.c	Sat Jan 17 23:12:53 2009
+***************
+*** 26,31 ****
+--- 26,95 ----
+  #include &lt;stdlib.h&gt;
+  #include &quot;os_support.h&quot;
+  
++ // GRUNTSTER start
++ #ifdef __WIN32
++ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
++ {
++ 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
++ 
++ 	if (wideCharString)
++ 		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
++ 
++ 	return wideCharStringLength;
++ }
++ 
++ int ADM_open(const char *path, int oflag, ...)
++ {
++ 	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
++ 	wchar_t wcFile[fileNameLength];
++ 	int creation = 0, access = 0;
++ 	HANDLE hFile;
++ 
++ 	utf8StringToWideChar(path, -1, wcFile);
++ 
++ 	if (oflag &amp; O_WRONLY || oflag &amp; O_RDWR)
++ 	{
++ 		access = GENERIC_WRITE;
++ 
++ 		if (oflag &amp; O_RDWR)
++ 			access |= GENERIC_READ;
++ 
++ 		if (oflag &amp; O_CREAT)
++ 		{
++ 			if (oflag &amp; O_EXCL)
++ 				creation = CREATE_NEW;
++ 			else if (oflag &amp; O_TRUNC)
++ 				creation = CREATE_ALWAYS;
++ 			else
++ 				creation = OPEN_ALWAYS;
++ 		}
++ 		else if (oflag &amp; O_TRUNC)
++ 			creation = TRUNCATE_EXISTING;
++ 	}
++ 	else if (oflag &amp; O_RDONLY)
++ 		creation = OPEN_EXISTING;
++ 
++ 	if (creation &amp; GENERIC_WRITE)
++ 	{
++ 		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
++ 
++ 		if (hFile == INVALID_HANDLE_VALUE)
++ 			return -1;
++ 		else
++ 			CloseHandle(hFile);
++ 	}
++ 
++ 	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
++ 
++ 	if (hFile == INVALID_HANDLE_VALUE)
++ 		return -1;
++ 	else
++ 		return _open_osfhandle((intptr_t)hFile, oflag);
++ }
++ 
++ #define open ADM_open
++ #endif
++ // GRUNTSTER end
+  
+  /* standard file protocol */
+  

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,33 @@
+*** libavformat/flvenc.c	Sat Jan 17 21:39:33 2009
+--- libavformat/flvenc.c	Sat Jan 17 21:39:38 2009
+***************
+*** 328,334 ****
+      &quot;video/x-flv&quot;,
+      &quot;flv&quot;,
+      sizeof(FLVContext),
+! #ifdef CONFIG_LIBMP3LAME
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
+--- 328,335 ----
+      &quot;video/x-flv&quot;,
+      &quot;flv&quot;,
+      sizeof(FLVContext),
+! //MEANX #ifdef CONFIG_LIBMP3LAME
+! #ifdef HAVE_LIBMP3LAME  
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
+***************
+*** 339,341 ****
+--- 340,348 ----
+      flv_write_trailer,
+      .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+  };
++ // MEANX
++ int flvenc_init(void)
++ {
++     av_register_output_format(&amp;flv_muxer);
++     return 0;
++ }
+\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,39 @@
+*** libavformat/isom.c	Sat Jan 17 19:28:21 2009
+--- libavformat/isom.c	Tue Jan 13 19:57:35 2009
+***************
+*** 40,46 ****
+      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
+      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
+      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
+!     { CODEC_ID_MP3       , 107 }, /* 11172-3 */
+      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
+      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
+      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
+--- 40,46 ----
+      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
+      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
+      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
+!     { CODEC_ID_MP2       , 107 }, /* 11172-3 */ /* MEANX WAS MP3 */
+      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
+      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
+      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
+***************
+*** 149,155 ****
+      { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
+      { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
+  
+!     { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at <A HREF="http://www.3ivx.com/showcase.html">http://www.3ivx.com/showcase.html</A> use this tag */
+      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
+  
+--- 149,158 ----
+      { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
+      { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
+  
+!     //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at <A HREF="http://www.3ivx.com/showcase.html">http://www.3ivx.com/showcase.html</A> use this tag */
+!      { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
+!      { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
+!     // /MEANX
+      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
+  

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,85 @@
+*** libavformat/matroskaenc.c	Sat Jan 17 19:28:21 2009
+--- libavformat/matroskaenc.c	Tue Jan 13 19:57:35 2009
+***************
+*** 391,396 ****
+--- 391,397 ----
+  
+  static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+  {
++ #if 0 // MEANX avidemux does thing differently
+      uint8_t *header_start[3];
+      int header_len[3];
+      int first_header_size;
+***************
+*** 415,420 ****
+--- 416,443 ----
+          put_buffer(pb, header_start[j], header_len[j]);
+  
+      return 0;
++ #else
++    // Not endian safe....
++       uint32_t packetLen[3],*ptr=(uint32_t *)codec-&gt;extradata;
++       uint8_t *data[3],i,j;
++       if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec-&gt;extradata_size)
++       {
++         av_log(s, AV_LOG_ERROR, &quot;Broken avidemux xiph header.\n&quot;);
++         return -1;
++       }
++       data[0]=codec-&gt;extradata+3*4;
++       data[1]=data[0]+ptr[0];
++       data[2]=data[1]+ptr[1];
++       put_byte(pb, 2);                    // number packets - 1
++       for (j = 0; j &lt; 2; j++) 
++       {
++           put_xiph_size(pb, ptr[j]);
++       }
++       for (j = 0; j &lt; 3; j++)
++         put_buffer(pb, data[j], ptr[j]);
++       
++       return 0; // /MEANX
++ #endif
+  }
+  
+  #define FLAC_STREAMINFO_SIZE 34
+***************
+*** 544,549 ****
+--- 567,589 ----
+          put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
+          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
+          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
++ /**  MEANX : Add a default duration for video **/
++         if(codec-&gt;codec_type==CODEC_TYPE_VIDEO)
++         {
++           if(codec-&gt;time_base.den &amp;&amp; codec-&gt;time_base.num)
++           {
++             int num=codec-&gt;time_base.num;
++             int den=codec-&gt;time_base.den;
++             unsigned int default_duration;
++             float period=num;
++                   period/=den;
++                   period*=1000*1000*1000; // in ns
++                   default_duration=(unsigned int)floor(period);
++                   put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
++           }
++         }
++         
++ /**  MEANX : Add a default duration for video **/
+  
+          if (st-&gt;language[0])
+              put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st-&gt;language);
+***************
+*** 845,847 ****
+--- 885,897 ----
+      mkv_write_trailer,
+      .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
+  };
++ // MEANX
++ //
++ int matroskaenc_init(void)
++ {
++     av_register_output_format(&amp;matroska_muxer);
++     return 0;
++ }
++ // /MEANX
++ 
++ 

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,20 @@
+*** libavformat/movenc.c	Sat Jan 17 21:45:18 2009
+--- libavformat/movenc.c	Sat Jan 17 22:01:23 2009
+***************
+*** 1747,1749 ****
+--- 1747,1761 ----
+      .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
+  };
+  #endif
++ /* MEANX */
++ int movenc_init(void)
++ {
++     av_register_output_format(&amp;mov_muxer);
++     av_register_output_format(&amp;tgp_muxer);
++     av_register_output_format(&amp;mp4_muxer);
++     av_register_output_format(&amp;psp_muxer);
++     av_register_output_format(&amp;tg2_muxer);
++     av_register_output_format(&amp;ipod_muxer);
++     return 0;
++ }
++ /* MEANX */

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,18 @@
+*** libavutil/avutil.h	Sat Jan 17 21:11:42 2009
+--- libavutil/avutil.h	Sat Jan 17 21:42:06 2009
+***************
+*** 48,53 ****
+--- 48,60 ----
+  
+  #define LIBAVUTIL_IDENT         &quot;Lavu&quot; AV_STRINGIFY(LIBAVUTIL_VERSION)
+  
++ /* MEANX
++  * - */
++ #define ASMALIGN(ZEROBITS) &quot;.p2align &quot; #ZEROBITS &quot;\n\t&quot;
++ /* /MEANX
++  */
++ 
++ 
+  
+  #include &quot;common.h&quot;
+  #include &quot;mathematics.h&quot;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+*** libavutil/internal.h	Sat Jan 17 21:11:42 2009
+--- libavutil/internal.h	Sat Jan 17 21:42:38 2009
+***************
+*** 234,245 ****
+--- 234,247 ----
+  #endif
+  
+  /* avoid usage of various functions */
++ #if 0 //MEANX
+  #undef  malloc
+  #define malloc please_use_av_malloc
+  #undef  free
+  #define free please_use_av_free
+  #undef  realloc
+  #define realloc please_use_av_realloc
++ #endif
+  #undef  time
+  #define time time_is_forbidden_due_to_security_issues
+  #undef  rand

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,9 +1,14 @@
 	INCLUDE(ae_plugin)
-        INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/../avidemux/&quot;)
-        INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/&quot;)
-        INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/&quot;)
+	include(admFFmpegUtil)
 
+	getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+	INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux&quot;)
+	INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+
 	SET(ADM_ae_lav_mp2_SRCS audioencoder_lavcodec.cpp)
+	
+	add_library(ADM_libavcodec UNKNOWN IMPORTED)
+	set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}&quot;)	
 
 	ADD_LIBRARY(ADM_ae_lav_mp2 SHARED ${ADM_ae_lav_mp2_SRCS})
 	ADD_TARGET_CFLAGS(ADM_ae_lav_mp2 &quot;-DADM_LAV_MP2&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -7,6 +7,7 @@
 
 INCLUDE(vf_plugin_gtk)
 INCLUDE(vf_plugin_qt4)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 
 SET(equalizerGtk_SRCS gtk/DIA_equalizer.cpp)
 SET(equalizerQT_SRCS  DIA_flyEqualiser.cpp  qt4/Q_equaliser.cpp  qt4/T_gridFrame.cpp  qt4/T_EqualiserPath.cpp)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -28,7 +28,7 @@
 #include &quot;ADM_vidEqualizer.h&quot;
 #include &quot;ADM_colorspace.h&quot;
 extern &quot;C&quot; {
-#include &quot;../../../ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
 }
 
 static ColYuvRgb    *rgbConv=NULL;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,14 @@
 INCLUDE(vf_plugin)
-INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc&quot;)
+include(admFFmpegUtil)
 
+getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+
 SET(ADM_vf_forcedPP_SRCS ADM_vidForcedPP.cpp)
 
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBPOSTPROC_LIB}&quot;)
+
 ADD_LIBRARY(ADM_vf_forcedPP SHARED ${ADM_vf_forcedPP_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_forcedPP ADM_libpostproc)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,14 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
-INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/&quot;)
+getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 SET(ADM_vf_mcdeint_SRCS ADM_vidMcDeint.cpp)
 
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}&quot;)
+
 ADD_LIBRARY(ADM_vf_mcdeint SHARED ${ADM_vf_mcdeint_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_mcdeint ADM_libavcodec)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -21,10 +21,9 @@
 
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
-
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libavutil/avutil.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,12 +1,23 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
+SET(ADM_vf_Mosaic_SRCS ADM_vidMosaic.cpp)
 
-SET(ADM_vf_Mosaic_SRCS ADM_vidMosaic.cpp)
+getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}&quot;)
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}&quot;)
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVUTIL_LIB}&quot;)
+
 ADD_LIBRARY(ADM_vf_Mosaic SHARED ${ADM_vf_Mosaic_SRCS})
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libswscale)
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libavcodec)
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libavutil)
+TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libswscale ADM_libavcodec ADM_libavutil)
 
 INIT_VIDEOFILTER_PLUGIN(ADM_vf_Mosaic)
 INSTALL_VIDEOFILTER(ADM_vf_Mosaic)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -27,9 +27,9 @@
 
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
+#include &quot;libavcodec/avcodec.h&quot;
+#include &quot;libavutil/avutil.h&quot;
+#include &quot;libswscale/swscale.h&quot;
 }
 
 typedef struct alg

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,4 +1,5 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
 SET(resizeCommon_SRCS ADM_vidMPLResize.cpp)
 SET(resizeCommonGtk_SRCS gtk/gtk_resize.cpp)
@@ -6,9 +7,19 @@
 SET(resizeCommonQT_Headers qt4/Q_resize.h)
 SET(resizeCommonQT_UI qt4/resizing)
 
+getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/&quot;)
-#INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}&quot;)
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}&quot;)
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBAVUTIL_LIB}&quot;)
+
 INCLUDE(vf_plugin_gtk)
 INIT_VIDEOFILTER_PLUGIN_GTK(ADM_vf_mplayerResize_gtk ${resizeCommonGtk_SRCS} ${resizeCommon_SRCS})
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -31,7 +31,7 @@
 #include &quot;ADM_lavpp_deintparam.h&quot;
 extern &quot;C&quot;
 {
-#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libpostproc/postprocess.h&quot;
+#include &quot;libpostproc/postprocess.h&quot;
 };
 #include &quot;DIA_factory.h&quot;
 /*

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,18 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
+SET(ADM_vf_lavDeinterlace_SRCS ADM_lavpp_deint.cpp)
 
-SET(ADM_vf_lavDeinterlace_SRCS ADM_lavpp_deint.cpp)
+getFfmpegLibNames(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
 INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg&quot;)
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}&quot;)
+
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION &quot;${AVIDEMUX_BIN_DIR}/${LIBPOSTPROC_LIB}&quot;)
+
 ADD_LIBRARY(ADM_vf_lavDeinterlace SHARED ${ADM_vf_lavDeinterlace_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_lavDeinterlace ADM_libswscale ADM_libpostproc)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -3,11 +3,11 @@
 MESSAGE(&quot;#####################################&quot;)
 MESSAGE(&quot;&quot;)
 
-CMAKE_MINIMUM_REQUIRED(VERSION 2.4.7 FATAL_ERROR)
+CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2 FATAL_ERROR)
 
 if (COMMAND cmake_policy)
-	cmake_policy(VERSION 2.4)
 	cmake_policy(SET CMP0003 NEW)
+	cmake_policy(SET CMP0004 OLD)
 endif (COMMAND cmake_policy)
 
 IF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES &quot;^${CMAKE_CXX_COMPILER_WORKS}$&quot;)
@@ -36,13 +36,13 @@
 ########################################
 # Where are the libraries
 ########################################
-IF(NOT AVIDEMUX_LIB_DIR)
-	MESSAGE(FATAL_ERROR &quot;Please add -DAVIDEMUX_LIB_DIR=path_to_avidemux_libs&quot;)
-ELSE (NOT AVIDEMUX_LIB_DIR)
-	SET(AVIDEMUX_LIB_DIR &quot;${AVIDEMUX_LIB_DIR}&quot; CACHE STRING &quot;&quot;)
-ENDIF(NOT AVIDEMUX_LIB_DIR)
+IF (NOT AVIDEMUX_INSTALL_PREFIX)
+	MESSAGE(FATAL_ERROR &quot;Please add -DAVIDEMUX_INSTALL_PREFIX=path_to_avidemux_install&quot;)
+ELSE (NOT AVIDEMUX_INSTALL_PREFIX)
+	SET(AVIDEMUX_BIN_DIR &quot;${AVIDEMUX_INSTALL_PREFIX}&quot; CACHE STRING &quot;&quot;)
+ENDIF (NOT AVIDEMUX_INSTALL_PREFIX)
 
-LINK_DIRECTORIES(${AVIDEMUX_LIB_DIR})
+LINK_DIRECTORIES(${AVIDEMUX_INSTALL_PREFIX}/lib)
 
 ########################################
 # Where is coreConfig ?
@@ -89,6 +89,7 @@
 
 IF (WIN32)
 	SET(BIN_DIR .)
+	set(AVIDEMUX_BIN_DIR ${AVIDEMUX_INSTALL_PREFIX})
 	SET(CMAKE_SHARED_LINKER_FLAGS &quot;${CMAKE_SHARED_LINKER_FLAGS} -Wl,-enable-auto-image-base -Wl,-enable-auto-import&quot;)
 
 	IF (CMAKE_BUILD_TYPE STREQUAL &quot;Release&quot;)
@@ -96,6 +97,7 @@
 	ENDIF (CMAKE_BUILD_TYPE STREQUAL &quot;Release&quot;)
 ELSE (WIN32)
 	SET(BIN_DIR bin)
+	set(AVIDEMUX_BIN_DIR ${AVIDEMUX_INSTALL_PREFIX}/bin)
 ENDIF (WIN32)
 
 ########################################


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001770.html">[Avidemux-svn-commit] r4537 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_codecs	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog
</A></li>
	<LI>Next message: <A HREF="001772.html">[Avidemux-svn-commit] r4539 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1771">[ date ]</a>
              <a href="thread.html#1771">[ thread ]</a>
              <a href="subject.html#1771">[ subject ]</a>
              <a href="author.html#1771">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
