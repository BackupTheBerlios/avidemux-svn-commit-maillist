<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4528 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4528%20-%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk&In-Reply-To=%3C200901101121.n0ABL4i4017926%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001760.html">
   <LINK REL="Next"  HREF="001762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4528 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4528%20-%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk&In-Reply-To=%3C200901101121.n0ABL4i4017926%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4528 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk">gruntster at mail.berlios.de
       </A><BR>
    <I>Sat Jan 10 12:21:04 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001760.html">[Avidemux-svn-commit] r4527 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:	. qt4
</A></li>
        <LI>Next message: <A HREF="001762.html">[Avidemux-svn-commit] r4529 - in	branches/avidemux_2.5_branch_gruntster/plugins:	ADM_videoEncoder/ADM_vidEnc_xvid/qt4	ADM_videoFilters/TemporalCleaner
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1761">[ date ]</a>
              <a href="thread.html#1761">[ thread ]</a>
              <a href="subject.html#1761">[ subject ]</a>
              <a href="author.html#1761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-01-10 12:20:53 +0100 (Sat, 10 Jan 2009)
New Revision: 4528

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
Log:
[xvid] hook up GTK options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-09 16:23:44 UTC (rev 4527)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-10 11:20:53 UTC (rev 4528)
@@ -16,7 +16,7 @@
 
 	ADD_DEFINITIONS(${GTK_CFLAGS})
 	ADD_LIBRARY(${GTK_PLUGIN_NAME} SHARED ${ADM_vidEnc_xvid_Gtk_SRCS})
-	TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ADM_vidEnc_xvid ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
+	TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ADM_vidEnc_xvid ADM_coreUI ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
 	
 	IF (GETTEXT_FOUND)
 		TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ${GETTEXT_LIBRARY_DIR})

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-09 16:23:44 UTC (rev 4527)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-10 11:20:53 UTC (rev 4528)
@@ -24,32 +24,30 @@
 #endif
 
 #include &quot;ADM_inttype.h&quot;
+#include &quot;gtkSupport.h&quot;
+
+#include &quot;ADM_files.h&quot;
+#include &quot;DIA_fileSel.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
-#include &quot;DIA_fileSel.h&quot;
 
-#include &quot;../options.h&quot;
-
-#include &quot;gtkSupport.h&quot;
+#include &quot;../presetOptions.h&quot;
 #include &quot;xvidConfigDialog.h&quot;
 
 #define WID(x) lookup_widget(dialog, #x)
 
-//static xvid4EncParam localParam;
-static uint32_t mQ,mB,mS,mA;
-static GtkWidget *dialog=NULL;
-//static COMPRESSION_MODE mMode;
-
 static GtkWidget *create_dialog1 (void);
 static GtkWidget *create_dialog3 (void);
 
-static void xvid4otherUpload(GtkWidget *dialog);
-static void xvid4otherDownload(GtkWidget *dialog);
-static uint8_t editMatrix(uint8_t *inter, uint8_t *intra, GtkWindow *parent);
-static void updateMode( void );
+static void loadOptions(GtkWidget *dialog, XvidOptions *options);
+void saveOptions(GtkWidget *dialog, XvidOptions *options);
 
-static int cb_mod(GtkObject * object, gpointer user_data);
-static int ch_par_asinput(GtkObject * object, gpointer user_data);
+static unsigned char editMatrix(unsigned char *inter, unsigned char *intra, GtkWidget *parent);
+static void updateMode(GtkWidget *dialog, int encodeMode, int encodeModeParameter);
+static int getCurrentEncodeMode(GtkWidget *dialog);
 
+static int cb_mod(GtkObject *object, gpointer user_data);
+static int ch_par_asinput(GtkObject *object, gpointer user_data);
+
 #define CALL_Z(x,y)  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),XVID4_RESPONSE_##y);
 
 typedef enum 
@@ -59,141 +57,113 @@
     XVID4_RESPONSE_LOAD_MATRIX,
     XVID4_RESPONSE_SAVE_MATRIX,
     XVID4_RESPONSE_LAST,
-}XVID4_CODE;
+} XVID4_CODE;
 
+static int _parWidth, _parHeight;
+static int _lastBitrate, _lastVideoSize;
+
 extern &quot;C&quot; int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options)
 {
-	int b;
-	int ret=0;
-	int code;
-	//ADM_assert(incoming-&gt;extraSettingsLen==sizeof(localParam));
-	//memcpy(&amp;localParam,incoming-&gt;extraSettings,sizeof(localParam));
-	dialog=create_dialog1();
+	_lastBitrate = 1500;
+	_lastVideoSize = 700;
 
+	GtkWidget *dialog = create_dialog1();
+
+	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
+										GTK_RESPONSE_OK,
+										GTK_RESPONSE_CANCEL,
+										-1);
+
 	gtk_window_set_modal(GTK_WINDOW(dialog), 1);
 	gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(configParameters-&gt;parent));
 
-#define HIST_SET(x) gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), x)
-#define VAL_SET(x) gtk_write_entry(WID(entryEntry), x)
+	_parWidth = properties-&gt;parWidth;
+	_parHeight = properties-&gt;parHeight;
 
-/*	mQ=incoming-&gt;qz;
-	mB=incoming-&gt;bitrate; // in kbits
-	mS=incoming-&gt;finalsize;	
-	mA=incoming-&gt;avg_bitrate;
-	mMode=incoming-&gt;mode;
-	updateMode();
+	updateMode(dialog, encodeOptions-&gt;encodeMode, encodeOptions-&gt;encodeModeParameter);
+	loadOptions(dialog, options);
 
-	xvid4otherUpload(dialog); */
-	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), &quot;changed&quot;,
-		GTK_SIGNAL_FUNC(cb_mod),                   (void *) 0);
+	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), &quot;changed&quot;, GTK_SIGNAL_FUNC(cb_mod), dialog);
+	gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), &quot;clicked&quot;, GTK_SIGNAL_FUNC(ch_par_asinput), options);
 
-	gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), &quot;clicked&quot;,
-		GTK_SIGNAL_FUNC(ch_par_asinput),                   (void *) 0);
+	CALL_Z(buttonCreateCustomMatrix, EDIT_MATRIX);
+	CALL_Z(buttonLoadMatrix, LOAD_MATRIX);
 
-	CALL_Z(buttonCreateCustomMatrix,EDIT_MATRIX);
-	CALL_Z(buttonLoadMatrix,LOAD_MATRIX);
+_again:
+	int code = gtk_dialog_run(GTK_DIALOG(dialog));
+	int b, ret = 0;
 
-_again:
-	code=gtk_dialog_run(GTK_DIALOG(dialog));
-/*	if(code==XVID4_RESPONSE_EDIT_MATRIX)
+	if (code == XVID4_RESPONSE_EDIT_MATRIX)
 	{
-		uint8_t intra[64],inter[64];
-		memcpy(intra,localParam.intraMatrix,64);
-		memcpy(inter,localParam.interMatrix,64);
-		if(editMatrix(intra,inter))
+		unsigned char intra[64], inter[64];
+
+		options-&gt;getIntraMatrix(intra);
+		options-&gt;getInterMatrix(inter);
+
+		if (editMatrix(intra, inter, dialog))
 		{
-			memcpy(localParam.intraMatrix,intra,64);
-			memcpy(localParam.interMatrix,inter,64);
+			options-&gt;setIntraMatrix(intra);
+			options-&gt;setInterMatrix(inter);
 		}
+
 		goto _again;
 	}
-	if(code==XVID4_RESPONSE_LOAD_MATRIX)
+
+	if (code == XVID4_RESPONSE_LOAD_MATRIX)
 	{
-		uint8_t intra[64],inter[64];
+		unsigned char intra[64], inter[64];
 		char name[1024];
-		FILE *file=NULL;
+		FILE *file = NULL;
 
 		if (!FileSel_SelectRead(_(&quot;Select Xvid matrix file to load&quot;), name, 1023, NULL))
 			goto _again;
 
 		printf(&quot;Loading Matrix\n&quot;);
-		file=fopen(name,&quot;rb&quot;);
-		if(!file)
+		file = fopen(name,&quot;rb&quot;);
+
+		if (!file)
 		{
 _erLoad:
-			if(file) fclose(file);
+			if (file)
+				fclose(file);
+
 			GUI_Error_HIG(_(&quot;Error Loading&quot;),_(&quot;Error loadind the custom matrix file.&quot;));
 			goto _again;
 		}
+
 		// Read it
-		if(64!=fread(intra,1,64,file))
+		if(64 != fread(intra, 1, 64, file))
 		{
 			printf(&quot;Error reading intra\n&quot;);
 			goto _erLoad;
 		}
-		if(64!=fread(inter,1,64,file))
+
+		if(64 != fread(inter, 1, 64, file))
 		{
 			printf(&quot;Error reading inter\n&quot;);
 			goto _erLoad;
 		}
-		// Ok
+
 		fclose(file);
-		memcpy(localParam.intraMatrix,intra,64);
-		memcpy(localParam.interMatrix,inter,64);
-		GUI_Info_HIG(ADM_LOG_INFO,_(&quot;Matrix Loaded&quot;),_(&quot;The custom matrix file has been successfully loaded.&quot;));
+
+		options-&gt;setIntraMatrix(intra);
+		options-&gt;setInterMatrix(inter);
+
+		GUI_Info_HIG(ADM_LOG_INFO, _(&quot;Matrix Loaded&quot;), _(&quot;The custom matrix file has been successfully loaded.&quot;));
 		goto _again;
 	}
-*/
-	if(code==GTK_RESPONSE_OK)
+
+	if (code == GTK_RESPONSE_OK)
 	{
-/*		int r,value=0;
-		ret=1;
-		r=getRangeInMenu(WID(optionmenuType));
-		xvid4otherDownload(dialog);
-		memcpy(incoming-&gt;extraSettings,&amp;localParam,sizeof(localParam));
+		saveOptions(dialog, options);
 
-		switch(r)
+		if (getCurrentEncodeMode(dialog) == ADM_VIDENC_MODE_CQP)
+			encodeOptions-&gt;encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
+		else
 		{
-			case 0:
-				incoming-&gt;mode = COMPRESS_CBR;				      
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				incoming-&gt;bitrate = value;
-				ret = 1;
-				gtk_label_set_text(GTK_LABEL(WID(label11)),&quot;Bitrate (kbps):&quot;);
-				break;
-			case 1:
-				incoming-&gt;mode = COMPRESS_CQ;		      			
-				value = (uint32_t) gtk_spin_button_get_value_as_int(
-					GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
-				if (value &gt;= 2 &amp;&amp; value &lt;= 32)
-				{
-					incoming-&gt;qz = value;
-				}
-				break;
-
-			case 2:
-				incoming-&gt;mode = COMPRESS_2PASS;		       				
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				if((value&gt;0)&amp;&amp;(value&lt;4000))
-				{
-					incoming-&gt;finalsize=value;
-
-				}
-				gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Size (MBytes):&quot;));
-				break;
-			case 3:
-				incoming-&gt;mode = COMPRESS_2PASS_BITRATE;	
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				incoming-&gt;avg_bitrate=value;
-				gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Average bitrate (kb/s):&quot;));
-				break;
-
-			case 4:
-				incoming-&gt;mode=COMPRESS_SAME;
-				break;
-			default:
-				ADM_assert(0);
-		} */
+			char *str = gtk_editable_get_chars(GTK_EDITABLE(WID(entryEntry)), 0, -1);
+			encodeOptions-&gt;encodeModeParameter = atoi(str);
+		}
 	}
 
 	gtk_widget_destroy(dialog);
@@ -201,235 +171,340 @@
 	return ret;
 }
 
-// Read the localParam struct and set the ui fields
-// accordingly
-#define SPIN_GET(x,y) {localParam.y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-	printf(#x&quot;:%d\n&quot;,localParam.y);}
+int getRangeInMenu(GtkWidget *menu)
+{
+    GtkWidget *br = gtk_option_menu_get_menu(GTK_OPTION_MENU(menu));
+    GtkWidget *active = gtk_menu_get_active(GTK_MENU(br));
+    int mode = g_list_index(GTK_MENU_SHELL(br)-&gt;children, active);
 
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)localParam.y) ; \
-	printf(#x&quot;:%d\n&quot;,localParam.y);}
+    return mode;
+}
 
-#define MENU_SET(x,y) { gtk_option_menu_set_history (GTK_OPTION_MENU(WID(x)),localParam.y);}
-#define MENU_GET(x,y) { localParam.y	= getRangeInMenu(WID(x));}
-#define TOGGLE_SET(x,y) {gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}
-#define TOGGLE_GET(x,y) {localParam.y=gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(x)));\
-	printf(#y&quot;:%d\n&quot;,localParam.y);}
+void loadOptions(GtkWidget *dialog, XvidOptions *options)
+{
+	// Main tab
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonInterlaced)), options-&gt;getInterlaced() == INTERLACED_BFF);
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonCartoon)), options-&gt;getCartoon());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTurbo)), options-&gt;getTurboMode());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGreyScale)), options-&gt;getGreyscale());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChroma)), options-&gt;getChromaOptimisation());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonPacked)), options-&gt;getPacked());
 
-#define ENTRY_SET(x,y) {gtk_write_entry(WID(x),(int)localParam.y);}
-#define ENTRY_GET(x,y) {localParam.y=gtk_read_entry(WID(x));\
-	printf(#y&quot;:%d\n&quot;,localParam.y);}
+	// Motion &amp; Misc tab
+	switch (options-&gt;getMotionEstimation())
+	{
+		case ME_NONE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 0);
+			break;
+		case ME_LOW:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 1);
+			break;
+		case ME_MEDIUM:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 2);
+			break;
+		case ME_HIGH:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 3);
+			break;
+	}
 
-#define CHECK_GET(x,y) {localParam.y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}
+	switch (options-&gt;getRateDistortion())
+	{
+		case RD_NONE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 0);
+			break;
+		case RD_DCT_ME:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 1);
+			break;
+		case RD_HPEL_QPEL_16:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 2);
+			break;
+		case RD_HPEL_QPEL_8:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 3);
+			break;
+		case RD_SQUARE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 4);
+			break;
+	}
 
-void xvid4otherUpload(GtkWidget *dialog)
-{
-/*	MENU_SET(optionmenuMS,guiLevel);
-	MENU_SET(optionmenuVHQ,vhqmode);
-	if(localParam.useCustomIntra || localParam.useCustomInter)
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChromaMotion)), options-&gt;getChromaMotionEstimation());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbutton4MV)), options-&gt;getInterMotionVector());
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMaxPeriod)),(gfloat)options-&gt;getMaxKeyInterval());
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBFrame)),(gfloat)options-&gt;getMaxBframes());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonQPel)), options-&gt;getQpel());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGMC)), options-&gt;getGmc());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonBVHQ)), options-&gt;getBframeRdo());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)), options-&gt;getParAsInput());
+
+	ch_par_asinput(GTK_OBJECT(WID(checkbutton_par_asinput)), options);
+
+	// Quantisation tab
+	switch (options-&gt;getCqmPreset())
 	{
-		RADIO_SET(radiobuttonCustomMatrix,		1);
-	}else
-		if(localParam.mpegQuantizer)
-			RADIO_SET(radiobuttonMpeg,		1);
-		else
-			RADIO_SET(radiobuttonH263,		1);		
-	CHECK_SET(checkbuttonInterlaced,	interlaced);
-	CHECK_SET(checkbutton4MV,		inter4mv);
-	CHECK_SET(checkbuttonTrellis,		trellis);
-	CHECK_SET(checkbuttonCartoon,		cartoon);
-	CHECK_SET(checkbuttonGreyScale,		greyscale);
-	CHECK_SET(checkbuttonChroma,		chroma_opt);
-	CHECK_SET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_SET(checkbuttonGMC,		gmc);
-	CHECK_SET(checkbuttonBVHQ,		bvhq);
-	CHECK_SET(checkbutton_par_asinput,	par_as_input);
-	CHECK_SET(checkbuttonQPel,		qpel);
-	CHECK_SET(checkbuttonHQAC,		hqac);
+		case CQM_H263:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonH263)), 1);
+			break;
+		case CQM_MPEG:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonMpeg)), 1);
+			break;
+		case CQM_CUSTOM:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonCustomMatrix)), 1);
+			break;
+	}
 
-	CHECK_SET(checkbuttonTurbo,		turbo);
-	CHECK_SET(checkbuttonPacked,		packed);
+	unsigned int minI, minP, minB;
+	unsigned int maxI, maxP, maxB;
 
-	SPIN_SET(spinbuttonIMaxPeriod,  max_key_interval);
-	ENTRY_SET(entryIInterv,		min_key_interval);
-	SPIN_SET(spinbuttonBFrame,	bframes);
-	ch_par_asinput(NULL, NULL);
+	options-&gt;getMinQuantiser(&amp;minI, &amp;minP, &amp;minB);
+	options-&gt;getMaxQuantiser(&amp;maxI, &amp;maxP, &amp;maxB);
 
-	SPIN_SET(spinbuttonIMax,	qmax[0]);
-	SPIN_SET(spinbuttonPMax,	qmax[1]);
-	SPIN_SET(spinbuttonBMax,	qmax[2]);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMax)),(gfloat)maxI);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMin)),(gfloat)minI);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonPMax)),(gfloat)maxP);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonPMin)),(gfloat)minP);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBMax)),(gfloat)maxB);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBMin)),(gfloat)minB);
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTrellis)), options-&gt;getTrellis());
 
-	SPIN_SET(spinbuttonIMin,	qmin[0]);
-	SPIN_SET(spinbuttonPMin,	qmin[1]);
-	SPIN_SET(spinbuttonBMin,	qmin[2]);
+	// Second Pass
+	char string[21];
 
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getKeyFrameBoost());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIBoost)), string);
 
-	ENTRY_SET(entryIBoost		,	keyframe_boost		);
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getAboveAverageCurveCompression());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryHiPass)), string);
 
-	ENTRY_SET(entryHiPass		,	curve_compression_high	);
-	ENTRY_SET(entryLowPass		,	curve_compression_low	);
-	ENTRY_SET(entryOvrControl,		overflow_control_strength	);
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getBelowAverageCurveCompression());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryLowPass)), string);
 
-	ENTRY_SET(entryMaxOvrImp	,	max_overflow_improvement	);
-	ENTRY_SET(entryMaxOvrDeg	,	max_overflow_degradation	);
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getOverflowControlStrength());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryOvrControl)), string);
 
-	ENTRY_SET(entryIreduction	,	kfreduction			);
-	ENTRY_SET(entryIInterv	,		kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-*/
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getMaxOverflowImprovement());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryMaxOvrImp)), string);
+
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getMaxOverflowDegradation());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryMaxOvrDeg)), string);
+
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getMaxKeyFrameReduceBitrate());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIreduction)), string);
+
+	snprintf(string, 20, &quot;%d&quot;, options-&gt;getKeyFrameBitrateThreshold());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIInterv)), string);
 }
 
 // Read the ui fields and set localParam
 // accordingly
-void xvid4otherDownload(GtkWidget *dialog)
+void saveOptions(GtkWidget *dialog, XvidOptions *options)
 {
-/*	MENU_GET(optionmenuMS,guiLevel);
-	MENU_GET(optionmenuVHQ,vhqmode);
+	// Main tab
+	options-&gt;setInterlaced(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonInterlaced))) ? INTERLACED_BFF : INTERLACED_NONE);
+	options-&gt;setCartoon(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonCartoon))));
+	options-&gt;setTurboMode(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTurbo))));
+	options-&gt;setGreyscale(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGreyScale))));
+	options-&gt;setChromaOptimisation(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChroma))));
+	options-&gt;setPacked(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonPacked))));
 
-	localParam.mpegQuantizer=RADIO_GET(radiobuttonMpeg);
-	if(RADIO_GET(radiobuttonCustomMatrix))
+	// Motion &amp; Misc tab
+	switch (getRangeInMenu(WID(optionmenuMS)))
 	{
-		localParam.useCustomIntra=1;
-		localParam.useCustomInter=1;
-	}else
+		case 0:
+			options-&gt;setMotionEstimation(ME_NONE);
+			break;
+		case 1:
+			options-&gt;setMotionEstimation(ME_LOW);
+			break;
+		case 2:
+			options-&gt;setMotionEstimation(ME_MEDIUM);
+			break;
+		case 3:
+			options-&gt;setMotionEstimation(ME_HIGH);
+			break;
+	}
+
+	switch (getRangeInMenu(WID(optionmenuVHQ)))
 	{
-		localParam.useCustomIntra=0;
-		localParam.useCustomInter=0;
+		case 0:
+			options-&gt;setRateDistortion(RD_NONE);
+			break;
+		case 1:
+			options-&gt;setRateDistortion(RD_DCT_ME);
+			break;
+		case 2:
+			options-&gt;setRateDistortion(RD_HPEL_QPEL_16);
+			break;
+		case 3:
+			options-&gt;setRateDistortion(RD_HPEL_QPEL_8);
+			break;
+		case 4:
+			options-&gt;setRateDistortion(RD_SQUARE);
+			break;
 	}
-	CHECK_GET(checkbuttonInterlaced,	interlaced);
-	CHECK_GET(checkbutton4MV,		inter4mv);
-	CHECK_GET(checkbuttonTrellis,		trellis);
-	CHECK_GET(checkbuttonCartoon,		cartoon);
-	CHECK_GET(checkbuttonGreyScale,		greyscale);
-	CHECK_GET(checkbuttonChroma,		chroma_opt);
-	CHECK_GET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_GET(checkbuttonGMC,		gmc);
-	CHECK_GET(checkbuttonBVHQ,		bvhq);
-	CHECK_GET(checkbutton_par_asinput,	par_as_input);
-	CHECK_GET(checkbuttonQPel,		qpel);
-	CHECK_GET(checkbuttonHQAC,		hqac);
-	CHECK_GET(checkbuttonTurbo,		turbo);
-	CHECK_GET(checkbuttonPacked,		packed);
 
+	options-&gt;setChromaMotionEstimation(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChromaMotion))));
+	options-&gt;setInterMotionVector(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton4MV))));
+	options-&gt;setMaxKeyInterval(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMaxPeriod))));
+	options-&gt;setMaxBframes(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBFrame))));
+	options-&gt;setQpel(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonQPel))));
+	options-&gt;setGmc(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGMC))));
+	options-&gt;setBframeRdo(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonBVHQ))));
+	options-&gt;setParAsInput(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput))));
+	options-&gt;setPar(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_width))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_height))));
 
-	SPIN_GET(spinbuttonIMaxPeriod,  max_key_interval);	
-	ENTRY_GET(entryIInterv,			kfthreshold);
-	SPIN_GET(spinbuttonBFrame,		bframes);
+	// Quantisation tab
+	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(radiobuttonMpeg))))
+		options-&gt;setCqmPreset(CQM_MPEG);
+	else if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(radiobuttonCustomMatrix))))
+		options-&gt;setCqmPreset(CQM_CUSTOM);
+	else
+		options-&gt;setCqmPreset(CQM_H263);
 
-	SPIN_GET(spinbutton_par_width,	par_width);
-	SPIN_GET(spinbutton_par_height,	par_height);
+	options-&gt;setMinQuantiser(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMin))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonPMin))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBMin))));
+	options-&gt;setMaxQuantiser(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMax))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonPMax))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBMax))));
+	options-&gt;setTrellis(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTrellis))));
 
+	// Second Pass
+	options-&gt;setKeyFrameBoost(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIBoost)), 0, -1)));
+	options-&gt;setAboveAverageCurveCompression(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryHiPass)), 0, -1)));
+	options-&gt;setBelowAverageCurveCompression(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryLowPass)), 0, -1)));
+	options-&gt;setOverflowControlStrength(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryOvrControl)), 0, -1)));
+	options-&gt;setMaxOverflowImprovement(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryMaxOvrImp)), 0, -1)));
+	options-&gt;setMaxOverflowDegradation(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryMaxOvrDeg)), 0, -1)));
+	options-&gt;setMaxKeyFrameReduceBitrate(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIreduction)), 0, -1)));
+	options-&gt;setKeyFrameBitrateThreshold(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIInterv)), 0, -1)));
+}
 
-	ENTRY_GET(entryIBoost		,	keyframe_boost		);
+int getCurrentEncodeMode(GtkWidget *dialog)
+{
+	int modeIndex = getRangeInMenu(WID(optionmenuType));
+	int encodeMode;
 
-	ENTRY_GET(entryHiPass		,	curve_compression_high	);
-	ENTRY_GET(entryLowPass		,	curve_compression_low	);
-	ENTRY_GET(entryOvrControl,		overflow_control_strength	);
+	switch (modeIndex)
+	{
+		case 0:
+			encodeMode = ADM_VIDENC_MODE_AQP;
+			break;
+		case 1:
+			encodeMode = ADM_VIDENC_MODE_CQP;
+			break;
+		case 2:
+			encodeMode = ADM_VIDENC_MODE_CBR;
+			break;
+		case 3:
+			encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+			break;
+		case 4:
+			encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			break;
+	}
 
-	ENTRY_GET(entryMaxOvrImp	,	max_overflow_improvement	);
-	ENTRY_GET(entryMaxOvrDeg	,	max_overflow_degradation	);
-
-	ENTRY_GET(entryIreduction	,	kfreduction			);
-	ENTRY_GET(entryIInterv	,	kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-	SPIN_GET(spinbuttonIMax,	qmax[0]);
-	SPIN_GET(spinbuttonPMax,	qmax[1]);
-	SPIN_GET(spinbuttonBMax,	qmax[2]);
-
-	SPIN_GET(spinbuttonIMin,	qmin[0]);
-	SPIN_GET(spinbuttonPMin,	qmin[1]);
-	SPIN_GET(spinbuttonBMin,	qmin[2]);
-*/
-
+	return encodeMode;
 }
 
-void updateMode( void )
+void updateMode(GtkWidget *dialog, int encodeMode, int encodeModeParameter)
 {
-/*	uint32_t b;
-	// set the right select button
-	switch (mMode)
+	int modeIndex = 0;
+	bool quantiser = false;
+
+	switch (encodeMode)
 	{
-	case COMPRESS_CBR:
-		HIST_SET(0);			
-		b=mB;
-		VAL_SET(b);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Target bitrate (kb/s):&quot;));
-		break;
+		case ADM_VIDENC_MODE_CBR:
+			modeIndex = 0;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Target bitrate (kb/s)&quot;));
+			break;
+		case ADM_VIDENC_MODE_CQP:
+			modeIndex = 1;
+			quantiser = true;
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			modeIndex = 2;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Target video size (MB)&quot;));
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			modeIndex = 3;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Average bitrate (kb/s)&quot;));
+			break;
+	}
 
-	case COMPRESS_2PASS:
-		HIST_SET(2);
-		VAL_SET(mS);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Target video size (MB):&quot;));
-		break;
-	case COMPRESS_2PASS_BITRATE:
-		HIST_SET(3);
-		VAL_SET(mA);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_(&quot;Average bitrate (kb/s):&quot;));
-		break;
+	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), modeIndex);
 
-	case COMPRESS_CQ:
-		HIST_SET(1);
-		gtk_widget_set_sensitive(WID(entryEntry),0);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),1);
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)),(gfloat)mQ);
-		break;
-	case COMPRESS_SAME:
-		HIST_SET(4);
-		gtk_widget_set_sensitive(WID(entryEntry),0);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
+	if (quantiser)
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)), encodeModeParameter);
+	else
+	{
+		char string[21];
 
-		break;
+		snprintf(string, 20, &quot;%d&quot;, encodeModeParameter);
+		gtk_entry_set_text(GTK_ENTRY(WID(entryEntry)), string);
+	}
 
-	} */
+	gtk_widget_set_sensitive(WID(spinbuttonQuant), quantiser);
+	gtk_widget_set_sensitive(WID(entryEntry), !quantiser);
 }
 
-int cb_mod(GtkObject * object, gpointer user_data)
+int cb_mod(GtkObject *object, gpointer user_data)
 {
-/*	int r;
-	r=getRangeInMenu(WID(optionmenuType));
-	switch(r)
+	GtkWidget *dialog = ((GtkWidget*)object)-&gt;parent;
+	int r = getRangeInMenu(WID(optionmenuType));
+	int mode = getCurrentEncodeMode(dialog);
+	int encodeModeParameter;
+
+	switch (mode)
 	{
-	case 0: mMode=COMPRESS_CBR ;break;
-	case 1: mMode=COMPRESS_CQ ;break;
-	case 2: mMode=COMPRESS_2PASS ;break;
-	case 3: mMode=COMPRESS_2PASS_BITRATE ;break;
-	case 4: mMode=COMPRESS_SAME;break;
+		case ADM_VIDENC_MODE_CBR:
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			encodeModeParameter = _lastBitrate;
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			encodeModeParameter = _lastVideoSize;
+			break;
+		default:
+			encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuantizer)));
+	}
 
-	}
-	updateMode();
-	printf(&quot;Changed!!!\n&quot;);
+	updateMode(((GtkWidget*)object)-&gt;parent, mode, encodeModeParameter);
+
 	return 0;
-*/
 }
 
-int ch_par_asinput(GtkObject * object, gpointer user_data)
+int ch_par_asinput(GtkObject *object, gpointer user_data)
 {
-/*	int on = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)));
+	XvidOptions *options = (XvidOptions*)user_data;
+	GtkWidget *dialog = ((GtkWidget*)object)-&gt;parent;
+	int on = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)));
+
 	gtk_widget_set_sensitive(WID(spinbutton_par_width), on^1);
 	gtk_widget_set_sensitive(WID(spinbutton_par_height), on^1);
 
-	if (on) {
-		SPIN_GET(spinbutton_par_width,	par_width);
-		SPIN_GET(spinbutton_par_height,	par_height);
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)), video_body-&gt;getPARWidth());
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)), video_body-&gt;getPARHeight());
-	}else{
-		SPIN_SET(spinbutton_par_width,	par_width);
-		SPIN_SET(spinbutton_par_height,	par_height);
+	if (on)
+	{
+		options-&gt;setPar(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_width))),
+			gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_height))));
+
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)), _parWidth);
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)), _parHeight);
 	}
+	else
+	{
+		unsigned int width, height;
 
-	return 0; */
+		options-&gt;getPar(&amp;width, &amp;height);
+
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)),(gfloat)width);
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)),(gfloat)height);
+	}
+
+	return 0;
 }
 
-uint8_t editMatrix(uint8_t *intra, uint8_t *inter, GtkWindow *parent)
+uint8_t editMatrix(uint8_t *intra, uint8_t *inter, GtkWidget *parent)
 {
-	GtkWidget *dialog=NULL;
+	GtkWidget *dialog = create_dialog3();
 	GtkWidget *spinbutton1;
 	GtkObject *spinbutton1_adj;
 	GtkWidget *intraCell[64],*interCell[64];
@@ -437,48 +512,47 @@
 	int code;
 	int col, row;
 
-	dialog=create_dialog3();
 	gtk_window_set_modal(GTK_WINDOW(dialog), 1);
-	gtk_window_set_transient_for(GTK_WINDOW(dialog), parent);
+	gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(parent));
 
-	for(int i=0;i&lt;64;i++)
-	{  //Intra
-		col=i%8;
-		row=i&gt;&gt;3;
-		spinbutton1_adj = gtk_adjustment_new (intra[i], 8, 255, 1, 10, 0);
-		intraCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-		//     gtk_widget_show (spinbutton1);
-		gtk_table_attach (GTK_TABLE (WID(tableIntra)), spinbutton1, col, col+1, row, row+1,
-			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-			(GtkAttachOptions) (0), 0, 0);
+	for (int i = 0; i &lt; 64; i++)
+	{
+		//Intra
+		col = i % 8;
+		row = i &gt;&gt; 3;
 
+		spinbutton1_adj = gtk_adjustment_new(intra[i], 8, 255, 1, 10, 0);
+		intraCell[i] = spinbutton1 = gtk_spin_button_new(GTK_ADJUSTMENT(spinbutton1_adj), 1, 0);
 
+		gtk_table_attach (GTK_TABLE (WID(tableIntra)), spinbutton1, col, col+1, row, row+1,
+			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL), (GtkAttachOptions) (0), 0, 0);
 	}
 
-	for(int i=0;i&lt;64;i++)
-	{  //Inter
-		col=i%8;
-		row=i&gt;&gt;3;
+	for (int i = 0; i &lt; 64; i++)
+	{
+		//Inter
+		col = i % 8;
+		row = i &gt;&gt; 3;
+
 		spinbutton1_adj = gtk_adjustment_new (inter[i], 1, 255, 1, 10, 0);
-		interCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-		//    gtk_widget_show (spinbutton1);
+		interCell[i] = spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
+
 		gtk_table_attach (GTK_TABLE (WID(tableInter)), spinbutton1, col, col+1, row, row+1,
-			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-			(GtkAttachOptions) (0), 0, 0);
+			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),	(GtkAttachOptions) (0), 0, 0);
 	}
 
-	for(int i=0;i&lt;64;i++)
+	for (int i = 0; i &lt; 64; i++)
 	{
-		gtk_widget_show (intraCell[i]);
-		gtk_widget_show (interCell[i]);
+		gtk_widget_show(intraCell[i]);
+		gtk_widget_show(interCell[i]);
 	}
-	//
 
-	CALL_Z(button12,SAVE_MATRIX)
+	CALL_Z(button12, SAVE_MATRIX)
+
 _loop:
-	code=gtk_dialog_run(GTK_DIALOG(dialog));
+	code = gtk_dialog_run(GTK_DIALOG(dialog));
 
-	if(code==XVID4_RESPONSE_SAVE_MATRIX)
+	if (code == XVID4_RESPONSE_SAVE_MATRIX)
 	{
 		printf(&quot;Save\n&quot;);
 		char name[1024];
@@ -506,7 +580,7 @@
 		goto _loop;
 	}
 
-	if(code==GTK_RESPONSE_OK)
+	if (code==GTK_RESPONSE_OK)
 	{
 		printf(&quot;Accept\n&quot;);
 		ret=1;
@@ -545,7 +619,6 @@
   GtkWidget *one_pass_quantizer1;
   GtkWidget *two_pass1;
   GtkWidget *two_pass__average_bitrate1;
-  GtkWidget *same_qz_as_input1;
   GtkWidget *entryEntry;
   GtkObject *spinbuttonQuant_adj;
   GtkWidget *spinbuttonQuant;
@@ -569,13 +642,10 @@
   GtkWidget *vbox7;
   GtkWidget *optionmenuMS;
   GtkWidget *menu2;
-  GtkWidget *_0___none1;
-  GtkWidget *_1___very_low1;
-  GtkWidget *_2___low2;
-  GtkWidget *_3___medium1;
-  GtkWidget *_4___high1;
-  GtkWidget *_5___very_high1;
-  GtkWidget *_6___ultra_high1;
+  GtkWidget *_0___none;
+  GtkWidget *_1___low;
+  GtkWidget *_2___medium;
+  GtkWidget *_3___high;
   GtkWidget *optionmenuVHQ;
   GtkWidget *menu3;
   GtkWidget *_0___off1;
@@ -586,11 +656,7 @@
   GtkWidget *hbox10;
   GtkWidget *checkbuttonChromaMotion;
   GtkWidget *checkbutton4MV;
-  GtkWidget *checkbuttonHQAC;
   GtkWidget *hbox9;
-  GtkWidget *labelIFrameIntervalMin;
-  GtkObject *spinbuttonIMinPeriod_adj;
-  GtkWidget *spinbuttonIMinPeriod;
   GtkWidget *labelIFrameIntervalMax;
   GtkObject *spinbuttonIMaxPeriod_adj;
   GtkWidget *spinbuttonIMaxPeriod;
@@ -698,7 +764,7 @@
 
   dialog1 = gtk_dialog_new ();
   gtk_container_set_border_width (GTK_CONTAINER (dialog1), 2);
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;XviD encoding options&quot;));
+  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;Xvid Configuration&quot;));
   gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
 
   dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
@@ -774,10 +840,6 @@
   gtk_widget_show (two_pass__average_bitrate1);
   gtk_container_add (GTK_CONTAINER (menu1), two_pass__average_bitrate1);
 
-  same_qz_as_input1 = gtk_menu_item_new_with_mnemonic (_(&quot;Same Quantizer as Input&quot;));
-  gtk_widget_show (same_qz_as_input1);
-  gtk_container_add (GTK_CONTAINER (menu1), same_qz_as_input1);
-
   gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuType), menu1);
 
   entryEntry = gtk_entry_new ();
@@ -786,8 +848,8 @@
   gtk_tooltips_set_tip (tooltips, entryEntry, _(&quot;Target video bitrate&quot;), NULL);
   gtk_entry_set_width_chars (GTK_ENTRY (entryEntry), 10);
 
-  spinbuttonQuant_adj = gtk_adjustment_new (4, 1, 31, 0.1, 10, 0);
-  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 1);
+  spinbuttonQuant_adj = gtk_adjustment_new (4, 1, 31, 1, 10, 0);
+  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 0);
   gtk_widget_show (spinbuttonQuant);
   gtk_box_pack_start (GTK_BOX (vbox22), spinbuttonQuant, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, spinbuttonQuant, _(&quot;Constant quantizer - each frame will get the same compression&quot;), NULL);
@@ -882,34 +944,22 @@
 
   menu2 = gtk_menu_new ();
 
-  _0___none1 = gtk_menu_item_new_with_mnemonic (_(&quot;0 - None&quot;));
-  gtk_widget_show (_0___none1);
-  gtk_container_add (GTK_CONTAINER (menu2), _0___none1);
+  _0___none = gtk_menu_item_new_with_mnemonic (_(&quot;0 - None&quot;));
+  gtk_widget_show (_0___none);
+  gtk_container_add (GTK_CONTAINER (menu2), _0___none);
 
-  _1___very_low1 = gtk_menu_item_new_with_mnemonic (_(&quot;1 - Very low&quot;));
-  gtk_widget_show (_1___very_low1);
-  gtk_container_add (GTK_CONTAINER (menu2), _1___very_low1);
+  _1___low = gtk_menu_item_new_with_mnemonic (_(&quot;1 - Low&quot;));
+  gtk_widget_show (_1___low);
+  gtk_container_add (GTK_CONTAINER (menu2), _1___low);
 
-  _2___low2 = gtk_menu_item_new_with_mnemonic (_(&quot;2 - Low&quot;));
-  gtk_widget_show (_2___low2);
-  gtk_container_add (GTK_CONTAINER (menu2), _2___low2);
+  _2___medium = gtk_menu_item_new_with_mnemonic (_(&quot;2 - Medium&quot;));
+  gtk_widget_show (_2___medium);
+  gtk_container_add (GTK_CONTAINER (menu2), _2___medium);
 
-  _3___medium1 = gtk_menu_item_new_with_mnemonic (_(&quot;3 - Medium&quot;));
-  gtk_widget_show (_3___medium1);
-  gtk_container_add (GTK_CONTAINER (menu2), _3___medium1);
+  _3___high = gtk_menu_item_new_with_mnemonic (_(&quot;3 - High&quot;));
+  gtk_widget_show (_3___high);
+  gtk_container_add (GTK_CONTAINER (menu2), _3___high);
 
-  _4___high1 = gtk_menu_item_new_with_mnemonic (_(&quot;4 - High&quot;));
-  gtk_widget_show (_4___high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _4___high1);
-
-  _5___very_high1 = gtk_menu_item_new_with_mnemonic (_(&quot;5 - Very high&quot;));
-  gtk_widget_show (_5___very_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _5___very_high1);
-
-  _6___ultra_high1 = gtk_menu_item_new_with_mnemonic (_(&quot;6 - Ultra high&quot;));
-  gtk_widget_show (_6___ultra_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _6___ultra_high1);
-
   gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMS), menu2);
 
   optionmenuVHQ = gtk_option_menu_new ();
@@ -955,26 +1005,11 @@
   gtk_box_pack_start (GTK_BOX (hbox10), checkbutton4MV, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, checkbutton4MV, _(&quot;Use 4 motion vectors per macroblock, might give better compression&quot;), NULL);
 
-  checkbuttonHQAC = gtk_check_button_new_with_mnemonic (_(&quot;HQ _AC&quot;));
-  gtk_widget_show (checkbuttonHQAC);
-  gtk_box_pack_start (GTK_BOX (hbox10), checkbuttonHQAC, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonHQAC, _(&quot;Enable a better prediction of AC component. Turns on Lumi masking - applies more compression to dark/light areas that the eye cannot notice easily&quot;), NULL);
-
   hbox9 = gtk_hbox_new (FALSE, 10);
   gtk_widget_show (hbox9);
   gtk_box_pack_start (GTK_BOX (vbox6), hbox9, FALSE, FALSE, 0);
 
-  labelIFrameIntervalMin = gtk_label_new (_(&quot;I-frame interval - Min:&quot;));
-  gtk_widget_show (labelIFrameIntervalMin);
-  gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMin, FALSE, FALSE, 0);
-
-  spinbuttonIMinPeriod_adj = gtk_adjustment_new (1, 1, 9, 1, 10, 0);
-  spinbuttonIMinPeriod = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMinPeriod_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMinPeriod);
-  gtk_box_pack_start (GTK_BOX (hbox9), spinbuttonIMinPeriod, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMinPeriod, _(&quot;Minimum space between I-frames, 1 will disable forced I-frame spacing&quot;), NULL);
-
-  labelIFrameIntervalMax = gtk_label_new (_(&quot;Max:&quot;));
+  labelIFrameIntervalMax = gtk_label_new (_(&quot;Max I-frame interval:&quot;));
   gtk_widget_show (labelIFrameIntervalMax);
   gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMax, FALSE, FALSE, 0);
 
@@ -1413,7 +1448,6 @@
   GLADE_HOOKUP_OBJECT (dialog1, one_pass_quantizer1, &quot;one_pass_quantizer1&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, two_pass1, &quot;two_pass1&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, two_pass__average_bitrate1, &quot;two_pass__average_bitrate1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, same_qz_as_input1, &quot;same_qz_as_input1&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, entryEntry, &quot;entryEntry&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQuant, &quot;spinbuttonQuant&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, label9, &quot;label9&quot;);
@@ -1436,13 +1470,10 @@
   GLADE_HOOKUP_OBJECT (dialog1, vbox7, &quot;vbox7&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, optionmenuMS, &quot;optionmenuMS&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, menu2, &quot;menu2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _0___none1, &quot;_0___none1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _1___very_low1, &quot;_1___very_low1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _2___low2, &quot;_2___low2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _3___medium1, &quot;_3___medium1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _4___high1, &quot;_4___high1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _5___very_high1, &quot;_5___very_high1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, _6___ultra_high1, &quot;_6___ultra_high1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, _0___none, &quot;_0___none&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, _1___low, &quot;_1___low&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, _2___medium, &quot;_2___medium&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, _3___high, &quot;_3___high&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, optionmenuVHQ, &quot;optionmenuVHQ&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, menu3, &quot;menu3&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, _0___off1, &quot;_0___off1&quot;);
@@ -1453,10 +1484,7 @@
   GLADE_HOOKUP_OBJECT (dialog1, hbox10, &quot;hbox10&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChromaMotion, &quot;checkbuttonChromaMotion&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, checkbutton4MV, &quot;checkbutton4MV&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonHQAC, &quot;checkbuttonHQAC&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, hbox9, &quot;hbox9&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMin, &quot;labelIFrameIntervalMin&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMinPeriod, &quot;spinbuttonIMinPeriod&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMax, &quot;labelIFrameIntervalMax&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMaxPeriod, &quot;spinbuttonIMaxPeriod&quot;);
   GLADE_HOOKUP_OBJECT (dialog1, frameAdvancedSimpleProfile, &quot;frameAdvancedSimpleProfile&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001760.html">[Avidemux-svn-commit] r4527 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:	. qt4
</A></li>
	<LI>Next message: <A HREF="001762.html">[Avidemux-svn-commit] r4529 - in	branches/avidemux_2.5_branch_gruntster/plugins:	ADM_videoEncoder/ADM_vidEnc_xvid/qt4	ADM_videoFilters/TemporalCleaner
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1761">[ date ]</a>
              <a href="thread.html#1761">[ thread ]</a>
              <a href="subject.html#1761">[ subject ]</a>
              <a href="author.html#1761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
