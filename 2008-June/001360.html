<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4104 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec	ADM_audiofilter ADM_editor ADM_encoder ADM_filter	ADM_inputs/ADM_amv ADM_inputs/ADM_asf ADM_inputs/ADM_avsproxy	ADM_inputs/ADM_flv ADM_inputs/ADM_h263 ADM_inputs/ADM_inpics	ADM_inputs/ADM_matroska ADM_inputs/ADM_mp4	ADM_inputs/ADM_mpegdemuxer ADM_inputs/ADM_nuv	ADM_inputs/ADM_ogm ADM_inputs/ADM_openDML	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_libwrapper	ADM_libraries/ADM_utilities ADM_osSupport	ADM_outputs/oplug_avi ADM_script ADM_toolkit	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_videoFilter xpm
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4104%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audiocodec%0A%09ADM_audiofilter%20ADM_editor%20ADM_encoder%20ADM_filter%0A%09ADM_inputs/ADM_amv%20ADM_inputs/ADM_asf%20ADM_inputs/ADM_avsproxy%0A%09ADM_inputs/ADM_flv%20ADM_inputs/ADM_h263%20ADM_inputs/ADM_inpics%0A%09ADM_inputs/ADM_matroska%20ADM_inputs/ADM_mp4%0A%09ADM_inputs/ADM_mpegdemuxer%20ADM_inputs/ADM_nuv%0A%09ADM_inputs/ADM_ogm%20ADM_inputs/ADM_openDML%0A%09ADM_libraries/ADM_libmpeg2enc%20ADM_libraries/ADM_libwrapper%0A%09ADM_libraries/ADM_utilities%20ADM_osSupport%0A%09ADM_outputs/oplug_avi%20ADM_script%20ADM_toolkit%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%20ADM_videoFilter%20xpm&In-Reply-To=%3C200806161155.m5GBtPk8031215%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001359.html">
   <LINK REL="Next"  HREF="001361.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4104 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec	ADM_audiofilter ADM_editor ADM_encoder ADM_filter	ADM_inputs/ADM_amv ADM_inputs/ADM_asf ADM_inputs/ADM_avsproxy	ADM_inputs/ADM_flv ADM_inputs/ADM_h263 ADM_inputs/ADM_inpics	ADM_inputs/ADM_matroska ADM_inputs/ADM_mp4	ADM_inputs/ADM_mpegdemuxer ADM_inputs/ADM_nuv	ADM_inputs/ADM_ogm ADM_inputs/ADM_openDML	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_libwrapper	ADM_libraries/ADM_utilities ADM_osSupport	ADM_outputs/oplug_avi ADM_script ADM_toolkit	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_videoFilter xpm</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4104%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audiocodec%0A%09ADM_audiofilter%20ADM_editor%20ADM_encoder%20ADM_filter%0A%09ADM_inputs/ADM_amv%20ADM_inputs/ADM_asf%20ADM_inputs/ADM_avsproxy%0A%09ADM_inputs/ADM_flv%20ADM_inputs/ADM_h263%20ADM_inputs/ADM_inpics%0A%09ADM_inputs/ADM_matroska%20ADM_inputs/ADM_mp4%0A%09ADM_inputs/ADM_mpegdemuxer%20ADM_inputs/ADM_nuv%0A%09ADM_inputs/ADM_ogm%20ADM_inputs/ADM_openDML%0A%09ADM_libraries/ADM_libmpeg2enc%20ADM_libraries/ADM_libwrapper%0A%09ADM_libraries/ADM_utilities%20ADM_osSupport%0A%09ADM_outputs/oplug_avi%20ADM_script%20ADM_toolkit%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%20ADM_videoFilter%20xpm&In-Reply-To=%3C200806161155.m5GBtPk8031215%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4104 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec	ADM_audiofilter ADM_editor ADM_encoder ADM_filter	ADM_inputs/ADM_amv ADM_inputs/ADM_asf ADM_inputs/ADM_avsproxy	ADM_inputs/ADM_flv ADM_inputs/ADM_h263 ADM_inputs/ADM_inpics	ADM_inputs/ADM_matroska ADM_inputs/ADM_mp4	ADM_inputs/ADM_mpegdemuxer ADM_inputs/ADM_nuv	ADM_inputs/ADM_ogm ADM_inputs/ADM_openDML	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_libwrapper	ADM_libraries/ADM_utilities ADM_osSupport	ADM_outputs/oplug_avi ADM_script ADM_toolkit	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_videoFilter xpm">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Jun 16 13:55:25 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001359.html">[Avidemux-svn-commit] r4103 - branches/avidemux_2.4_branch/po
</A></li>
        <LI>Next message: <A HREF="001361.html">[Avidemux-svn-commit] r4105 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_GTK/ADM_toolkit_gtk ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1360">[ date ]</a>
              <a href="thread.html#1360">[ thread ]</a>
              <a href="subject.html#1360">[ subject ]</a>
              <a href="author.html#1360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-06-16 13:54:28 +0200 (Mon, 16 Jun 2008)
New Revision: 4104

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_assert.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.h
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/ADM_vidDummyFilter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmAudio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/ad_layer.cc
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/synchrolib.cc
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/aviio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_fileio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memcpy.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.h
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
   branches/avidemux_2.4_branch/avidemux/xpm/avidemux_icon.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/begin.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/end.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator_small.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/stop.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/systray.xpm
   branches/avidemux_2.4_branch/avidemux/xpm/systray2.xpm
Log:
[misc] fix various warnings

Modified: branches/avidemux_2.4_branch/avidemux/ADM_assert.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_assert.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_assert.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -24,7 +24,7 @@
 extern void *ADM_realloc(void *in,size_t size);
 extern void ADM_dezalloc(void *ptr);
 extern char *ADM_strdup( const char *in);
-extern char *slashToBackSlash(char *in);
+extern char *slashToBackSlash(const char *in);
 typedef void *(* adm_fast_memcpy)(void *to, const void *from, size_t len);
 extern adm_fast_memcpy myAdmMemcpy;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -227,4 +227,4 @@
   
 }
 
-// EOF
\ No newline at end of file
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -18,7 +18,7 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 #include &lt;math.h&gt;
 
 #include &quot;ADM_utilities/default.h&quot;
@@ -57,7 +57,7 @@
 typedef struct externalSource
 {
  AudioSource type;
- char *name;       
+ const char *name;
 }externalSource;
 
 static const externalSource Sources[]=
@@ -70,7 +70,7 @@
 };
 typedef struct Mixer_String
 {
-  char         *name;
+  const char         *name;
   CHANNEL_CONF conf;
 };
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -102,7 +102,7 @@
   return 1;
 }
 
-uint8_t vidHeader::setMyName (char *name)
+uint8_t vidHeader::setMyName (const char *name)
 {
   _name = new char[strlen (name) + 1];
   ADM_assert (_name);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_Video.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -73,7 +73,7 @@
 virtual   void 			Dump(void)=0;
 virtual	  uint8_t		getExtraHeaderData(uint32_t *len, uint8_t **data);
 // AVI io
-virtual 	uint8_t		open(char *name)=0;
+virtual 	uint8_t		open(const char *name)=0;
 virtual 	uint8_t		close(void)=0;
 virtual	uint8_t			reorder( void ) { return 0;} // by default we don&quot;t do frame re-ordering
 virtual	uint8_t			isReordered( void ) { return 0;} // by default we don&quot;t do frame re-ordering
@@ -83,7 +83,7 @@
   uint8_t			getVideoInfo(aviInfo *info);
   uint32_t			getWidth( void ) { return _mainaviheader.dwWidth;};
   uint32_t			getHeight( void ) { return _mainaviheader.dwHeight;};
-  uint8_t			setMyName( char *name);
+  uint8_t			setMyName( const char *name);
   char				*getMyName( void);
   //__________________________
   //				 Audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -44,7 +44,7 @@
 /**
 	Read the magic of a file i.e. its 16 first bytes
 */
-uint8_t ADM_Composer::getMagic (char *name, uint32_t * magic)
+uint8_t ADM_Composer::getMagic (const char *name, uint32_t * magic)
 {
   FILE *    tmp;
   uint8_t    ret =    1;
@@ -67,7 +67,7 @@
 
 */
 
-uint8_t ADM_Composer::identify (char *name, fileType * type)
+uint8_t ADM_Composer::identify (const char *name, fileType * type)
 {
   uint32_t magic[4];
   uint32_t id;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -48,8 +48,7 @@
 // Ugly but sooo usefull
 extern uint32_t frameStart,frameEnd;
 static uint32_t edFrameStart,edFrameEnd;
-uint8_t loadVideoCodecConf( char *name);
-uint8_t saveVideoCodecConf( char *name);
+uint8_t loadVideoCodecConf( const char *name);
 const char *getCurrentContainerAsString(void);
 
 uint8_t ADM_Composer::getMarkers(uint32_t *start, uint32_t *end)
@@ -70,7 +69,7 @@
 // Save the config, including name, segment etc...
 //______________________________________________
 
-uint8_t ADM_Composer::saveWorbench (char *name)
+uint8_t ADM_Composer::saveWorbench (const char *name)
 {
         GUI_Error_HIG(QT_TR_NOOP(&quot;Unsupported&quot;), NULL);
         return 0;
@@ -78,7 +77,7 @@
 /*______________________________________________
         Save the project as a script
 ______________________________________________*/
-uint8_t ADM_Composer::saveAsScript (char *name, char *outputname)
+uint8_t ADM_Composer::saveAsScript (const char *name, const char *outputname)
 {
 const char *truefalse[]={&quot;false&quot;,&quot;true&quot;};
 printf(&quot;\n **Saving script project **\n&quot;);
@@ -296,7 +295,7 @@
 // Save the config, including name, segment etc...
 //______________________________________________
 
-uint8_t ADM_Composer::loadWorbench (char *name)
+uint8_t ADM_Composer::loadWorbench (const char *name)
 {
   GUI_Error_HIG(QT_TR_NOOP(&quot;Old format project file&quot;),QT_TR_NOOP( &quot;No more supported.&quot;));
  return 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -76,7 +76,7 @@
 void DIA_indexerPrefill(char *name);
 extern uint8_t indexMpeg (char *mpeg, char *file, uint8_t aid);
 
-extern uint8_t loadVideoCodecConf( char *name);
+extern uint8_t loadVideoCodecConf( const char *name);
 extern uint8_t parseScript(char *name);
 uint8_t UI_SetCurrentFormat( ADM_OUT_FORMAT fmt );
 const char *VBR_MSG = QT_TR_NOOP(&quot;Avidemux detected VBR MP3 audio in this file. For keeping audio/video in sync, time map is needed. Build it now?\n\nYou can do it later with \&quot;Audio -&gt; Build VBR Time Map\&quot;.&quot;);
@@ -262,7 +262,7 @@
         
 
 */
-uint8_t ADM_Composer::addFile (char *name, uint8_t mode,fileType forcedType)
+uint8_t ADM_Composer::addFile (const char *name, uint8_t mode,fileType forcedType)
 {
   uint8_t    ret =    0;
   aviInfo    info;
@@ -1511,7 +1511,7 @@
 //              0 else
 //_________________________________________
 //
-uint8_t         ADM_Composer::tryIndexing(char *name,char *idxname)
+uint8_t         ADM_Composer::tryIndexing(const char *name, const char *idxname)
 {
  unsigned int autoidx = 0;
       prefs-&gt;get(FEATURE_TRYAUTOIDX,&amp;autoidx);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx	2008-06-16 11:54:28 UTC (rev 4104)
@@ -152,10 +152,10 @@
 				       		uint8_t  	updateAudioTrack(uint32_t seg);			   	
 						void 		deleteAllVideos(void );
 
-						uint8_t 	getMagic(char *name,uint32_t *magic);
-						uint8_t 	identify(char *name, fileType *type);
+						uint8_t 	getMagic(const char *name,uint32_t *magic);
+						uint8_t 	identify(const char *name, fileType *type);
 						uint32_t 	searchForwardSeg(uint32_t startframe);
-                                                uint8_t         tryIndexing(char *name,char *idxname=NULL);
+                                                uint8_t         tryIndexing(const char *name, const char *idxname=NULL);
 
   public:
                                                 uint8_t hasVBRVideos(void);
@@ -169,9 +169,9 @@
   				virtual 			~ADM_Composer();
   						void		clean( void );
   						void		dumpSeg(void);
-                                                uint8_t         saveAsScript (char *name,char *out);
-						uint8_t 	saveWorbench(char *name)      ;
-						uint8_t 	loadWorbench(char *name)      ;
+                                                uint8_t         saveAsScript (const char *name, const char *out);
+						uint8_t 	saveWorbench(const char *name);
+						uint8_t 	loadWorbench(const char *name);
 						uint8_t     resetSeg( void );
 						uint8_t	reorder( void );
 						uint8_t	isReordered( uint32_t framenum );
@@ -179,7 +179,7 @@
   				//_______________________
   				// specific to composer
   				//_______________________
-  						uint8_t 	addFile (char *name, uint8_t mode=0,fileType forcedType=Unknown_FileType);
+  						uint8_t 	addFile (const char *name, uint8_t mode=0,fileType forcedType=Unknown_FileType);
   						uint8_t 	cleanup( void);
 			   			uint8_t 	isMultiSeg( void) { if(_nb_segment&gt;1) return 1; else return 0;}
   						uint8_t 	removeFrames(uint32_t start,uint32_t end);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -90,8 +90,7 @@
 
 
 
-uint8_t loadVideoCodecConf (char *name);
-uint8_t saveVideoCodecConf (char *name);
+uint8_t loadVideoCodecConf (const char *name);
 uint8_t mk_hex (uint8_t a, uint8_t b);
 //*********************************************
 CodecFamilty
@@ -754,7 +753,7 @@
 
 */
 uint8_t
-loadVideoCodecConf (char *name)
+loadVideoCodecConf (const char *name)
 {
   FILE *fd = NULL;
   char str[4000];
@@ -799,7 +798,7 @@
 }
 /***********************/
 uint8_t
-loadVideoCodecConfString (char *cmd)
+loadVideoCodecConfString (const char *cmd)
 {
 #define MAX_STRING 4000
   char str[MAX_STRING * 3];

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/ADM_vidDummyFilter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/ADM_vidDummyFilter.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/ADM_vidDummyFilter.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -18,12 +18,11 @@
  #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 #include &quot;config.h&quot;
 #include &quot;fourcc.h&quot;
 #include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
 #include &quot;avi_vars.h&quot;
 
 
@@ -44,12 +43,12 @@
 {
 SCRIPT_CREATE(FILTER_create_fromscript,ADMVideoFlipV,flipParam);
 BUILD_CREATE(FILTER_create,ADMVideoFlipV);
-char *FILTER_getName(void)
+const char *FILTER_getName(void)
 {
 	return &quot;DynFLIPPER&quot;;
 }
 
-char *FILTER_getDesc(void)
+const char *FILTER_getDesc(void)
 {
 	return &quot;Vertical flip, demo for dynamically loaded filters&quot;;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -80,11 +80,10 @@
 }
 void filterListAll( void )
 {
-char *name;
 	printf(&quot;\nVideo filters\n&quot;);
 	for(uint32_t i=0;i&lt;allfilters.size();i++)
 	{
-		name=allfilters[ i].filtername;
+		const char *name = allfilters[ i].filtername;
 		if(allfilters[ i].viewable)
 		{
 			if(name)
@@ -93,13 +92,12 @@
 	}
 
 }
-VF_FILTERS filterGetTagFromName(char *inname)
+VF_FILTERS filterGetTagFromName(const char *inname)
 {
-char *name;
 	VF_FILTERS filter=VF_DUMMY;
 	for(uint32_t i=0;i&lt;allfilters.size();i++)
 	{
-		name=allfilters[ i].filtername;
+		const char *name=allfilters[ i].filtername;
 		if(allfilters[ i].viewable || allfilters[i].tag==VF_PARTIAL)
 		{
 			if(name)
@@ -128,7 +126,7 @@
 }
 void registerFilterEx(const char *name,VF_FILTERS tag,uint8_t viewable
 		,AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *)
-		,char *filtername,AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),char *desc)
+		,const char *filtername,AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args), const char *desc)
 {
 //    printf (&quot;nb_video_filter = %d, max %d, name = %s\n&quot;, nb_video_filter, (MAX_FILTER-1), name);
         allfilters.push_back (FILTER_ENTRY (name, create, tag, viewable,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -21,8 +21,7 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 #include &quot;config.h&quot;
 #include &quot;fourcc.h&quot;
@@ -41,7 +40,7 @@
 #define REGISTER(e,a,g,b,c,d) {FILTERDEC(d);registerFilterEx(a,b,c,d,e,NULL,NULL);}
 #define REGISTERX(e,a,g,b,c,d,f) {\
 FILTERDECX(f);\
-FILTERDEC(d);registerFilterEx((char*)a,b,c,d,e,f,(char*)g);\
+FILTERDEC(d);registerFilterEx(a,b,c,d,e,f,g);\
 }
 
 void registerVideoFilters( void )

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -79,7 +79,7 @@
 #endif
 
 
-typedef char *(ADM_getStringT)(void);
+typedef const char *(ADM_getStringT)(void);
 
 static void tryLoading(TYPEOFHANDLE handle);
 static uint32_t dynTag=0xF0000000;
@@ -133,11 +133,9 @@
     
     
     
-    char *name,*desc;
+    const char *name = nameP();
+    const char *desc = descP();
     
-    name=nameP();
-    desc=descP();
-    
     ADM_assert(name);
     ADM_assert(desc);
     

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -122,13 +122,13 @@
         void              (*destroy)( AVDMGenericVideoStream *old); /* Maybe needed ...*/
         VF_FILTERS        tag;
         uint8_t           viewable;
-        char              *filtername;
-        char              *description;
+        const char              *filtername;
+        const char              *description;
         ADM_create_from_scriptT *create_from_script;
 
        FILTER_ENTRY (const char * name, ADM_createT * create, VF_FILTERS tag,
-                     uint8_t viewable, char * filtername,
-                     char * description = 0,
+                     uint8_t viewable, const char * filtername,
+                     const char * description = 0,
                      ADM_create_from_scriptT * create_from_script = 0)
            : name (name),
              create (create),
@@ -197,12 +197,12 @@
                     
 void registerFilterEx(const char *name,VF_FILTERS tag,uint8_t viewable,
                 ADM_createT  *create,
-		char *filtername,
+		const char *filtername,
                 ADM_create_from_scriptT *create_from_script,
-                char *description);
+                const char *description);
                 
 void 		filterListAll( void );
-VF_FILTERS 	filterGetTagFromName(char *inname);
+VF_FILTERS 	filterGetTagFromName(const char *inname);
 uint8_t 	filterAddScript(VF_FILTERS tags,uint32_t n,Arg *args);
 //AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,uint8_t *conf, AVDMGenericVideoStream *in) ;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -90,7 +90,7 @@
       \brief open the flv file, gather infos and build index(es).
 */
 
-uint8_t amvHeader::open(char *name)
+uint8_t amvHeader::open(const char *name)
 {
   uint32_t prevLen, type, size, pts,pos=0;
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_amv/ADM_amv.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -105,7 +105,7 @@
             amvHeader( void );
    virtual  ~amvHeader(  ) ;
 // AVI io
-    virtual uint8_t  open(char *name);
+    virtual uint8_t  open(const char *name);
     virtual uint8_t  close(void) ;
   //__________________________
   //  Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,782 +1,782 @@
-/***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-#include &lt;string.h&gt;
-
-#include &quot;math.h&quot;
-
-#include &quot;ADM_utilities/default.h&quot;
-#include &quot;ADM_editor/ADM_Video.h&quot;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;fourcc.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-//#include &quot;DIA_working.h&quot;
-#include &quot;ADM_asf.h&quot;
-#include &quot;ADM_asfPacket.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_ASF
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-static const uint8_t asf_audio[16]={0x40,0x9e,0x69,0xf8,0x4d,0x5b,0xcf,0x11,0xa8,0xfd,0x00,0x80,0x5f,0x5c,0x44,0x2b};
-static const uint8_t asf_video[16]={0xc0,0xef,0x19,0xbc,0x4d,0x5b,0xcf,0x11,0xa8,0xfd,0x00,0x80,0x5f,0x5c,0x44,0x2b};
-
-
-WAVHeader *asfHeader::getAudioInfo(void )
-{
-  if(!_curAudio) return NULL;
-  return _curAudio-&gt;getInfo();
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t asfHeader::getAudioStream(AVDMGenericAudioStream **audio)
-{
- 
-  *audio=_curAudio;
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-void asfHeader::Dump(void)
-{
- 
-  printf(&quot;*********** ASF INFO***********\n&quot;);
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t asfHeader::close(void)
-{
-	if (_fd) 
-		fclose(_fd);
-
-	_fd=NULL;
-
-  if(_videoExtraData)
-  {
-    delete [] _videoExtraData;
-    _videoExtraData=NULL; 
-  }
-  if(myName)
-  {
-    delete myName;
-    myName=NULL; 
-  }
-  if(_extraData)
-  {
-    delete [] _extraData;
-    _extraData=NULL; 
-  }
-  if(_index)
-  {
-    delete [] _index; 
-  }
-  _index=NULL;
-  if(_packet)
-    delete _packet;
-  _packet=NULL;
-  
-  for(int i=0;i&lt;_nbAudioTrack;i++)
-  {
-    asfAudioTrak *trk=&amp;(_allAudioTracks[i]);
-    if(trk-&gt;extraData) delete [] trk-&gt;extraData;
-    trk-&gt;extraData=NULL;
-  }
-}
-uint8_t       asfHeader::getExtraHeaderData(uint32_t *len, uint8_t **data)
-{
-  *len=_extraDataLen;
-  *data=_extraData;
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
- asfHeader::asfHeader( void ) : vidHeader()
-{
-  _fd=NULL;
-  _videoIndex=-1;
-  myName=NULL;
-  _extraDataLen=0;
-  _extraData=NULL;
-  _packetSize=0;
-  _videoStreamId=0;
-  nbImage=0;
-  _index=NULL;
-  _packet=NULL;
-  _curAudio=NULL;
-  _nbPackets=0;
-  printf(&quot;%u\n&quot;,sizeof(_allAudioTracks));
-  memset(&amp;(_allAudioTracks[0]),0,sizeof(_allAudioTracks));
-
-  _nbAudioTrack=0;
-  _currentAudioStream=0;
-}
-/*
-    __________________________________________________________
-*/
-
- asfHeader::~asfHeader(  )
-{
-  close();
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t asfHeader::open(char *name)
-{
-  _fd=fopen(name,&quot;rb&quot;);
-  if(!_fd)
-  {
-    GUI_Error_HIG(&quot;File Error.&quot;,&quot;Cannot open file\n&quot;);
-    return 0; 
-  }
-  myName=ADM_strdup(name);
-  if(!getHeaders())
-  {
-    return 0; 
-  }
-  buildIndex();
-  fseeko(_fd,_dataStartOffset,SEEK_SET);
-  _packet=new asfPacket(_fd,_nbPackets,_packetSize,&amp;readQueue,_dataStartOffset);
-  curSeq=1;
-  if(_nbAudioTrack)
-  {
-    _curAudio=new asfAudio(this,_currentAudioStream);
-  }
-  return 1;
-}
-/*
-    __________________________________________________________
-*/
-
- 
-/*
-    __________________________________________________________
-*/
-
-  uint8_t  asfHeader::setFlag(uint32_t frame,uint32_t flags)
-{
-  ADM_assert(frame&lt;nbImage);
-  _index[frame].flags=flags;
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-uint32_t asfHeader::getFlags(uint32_t frame,uint32_t *flags)
-{
-  if(frame&gt;=nbImage) return 0;
-  if(!frame) *flags=AVI_KEY_FRAME;
-  else 
-      *flags=_index[frame].flags;
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t  asfHeader::getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img)
-{
-  img-&gt;dataLength=0;
-  img-&gt;flags=AVI_KEY_FRAME;
-  if(framenum&gt;=nbImage)
-  {
-    printf(&quot;[ASF] Going out of bound %u %u\n&quot;,framenum, nbImage);
-    return 0;
-  }
-  if(!_index[framenum].frameLen)
-  {
-    return 1; // Empty frame 
-  }
-  // In case curSeq is stored as one byte..
-  curSeq&amp;=0xff;
-  //
-  uint32_t len=0;
-  aprintf(&quot;Framenum %u len: %u curSeq %u frameSeq=%u packetnb=%u \n&quot;,
-         framenum,_index[framenum].frameLen,curSeq,
-         _index[framenum].segNb,_index[framenum].packetNb);
-  // Seeking ?
-  if(_index[framenum].segNb!=curSeq)
-  {
-    printf(&quot;Seeking.. curseq:%u wanted seq:%u\n&quot;,curSeq,_index[framenum].segNb);
-    if(!_packet-&gt;goToPacket(_index[framenum].packetNb))
-    {
-      printf(&quot;[ASF] Cannot seek to frame %u\n&quot;,framenum);
-      return 0; 
-    }
-    _packet-&gt;purge();
-    curSeq=_index[framenum].segNb;
-    printf(&quot;Seeking starting at seq=%u\n&quot;,curSeq);
-  }
-  
-  
-  len=0;
-  uint32_t delta;
-  while(1)
-  {
-   
-    
-    
-    while(!readQueue.isEmpty())
-    {
-      asfBit *bit;
-      ADM_assert(readQueue.pop((void**)&amp;bit));
-      aprintf(&quot;&gt;found packet of size %d seq %d, while curseq =%d wanted seg=%u current offset=%u\n&quot;,bit-&gt;len,bit-&gt;sequence,curSeq,_index[framenum].segNb,len);
-      // Here it is tricky
-      // if len==0 we are reading the first part of our frame
-      // The packet may starts with segments from the previous frame
-      // discard them
-      // Delta is just a security as it should be slightly &gt;10
-      delta=256+bit-&gt;sequence-_index[framenum].segNb;
-      delta &amp;=0xff;
-      if(!len) // Starting a new frame
-      {
-          if(_index[framenum].segNb != bit-&gt;sequence )
-          {
-            aprintf(&quot;Dropping seq=%u too old for %u delta %d\n&quot;,
-                  bit-&gt;sequence,_index[framenum].segNb,delta);
-            delete[] bit-&gt;data;
-            delete bit;
-            if(delta&lt;230)
-            {
-              printf(&quot;Very suspicious\n&quot;);
-              printf(&quot;Very suspicious\n&quot;);
-              printf(&quot;Very suspicious\n&quot;);
-              printf(&quot;Very suspicious\n&quot;);
-              printf(&quot;Very suspicious\n&quot;);
-            }
-            continue; 
-          }
-          // We have found our first chunk
-          curSeq=bit-&gt;sequence;
-          memcpy(img-&gt;data,bit-&gt;data,bit-&gt;len);
-          len=bit-&gt;len;
-          delete[] bit-&gt;data;
-          delete bit;
-          continue;
-      }
-      // Continuing a frame
-      // If the seq number is different it is the beginning of a new frame
-      if(bit-&gt;sequence!=curSeq )
-      {
-        aprintf(&quot;New sequence %u-&gt;%u while loading %u frame\n&quot;,curSeq,bit-&gt;sequence,framenum);
-        img-&gt;dataLength=len;
-        readQueue.pushBack(bit); // don't delete it, we will use it later...
-        curSeq=bit-&gt;sequence;
-        goto gotcha;
-      }
-      // still same sequence ...add
-      memcpy(img-&gt;data+len,bit-&gt;data,bit-&gt;len);
-      len+=bit-&gt;len;
-	  delete[] bit-&gt;data;
-      delete bit;
-    }
-    if(!_packet-&gt;nextPacket(_videoStreamId))
-    {
-      printf(&quot;[ASF] Packet Error\n&quot;);
-      return 0; 
-    }
-    _packet-&gt;skipPacket();
-  }
-gotcha:
-  
-  img-&gt;dataLength=len;
-  if(len!=_index[framenum].frameLen)
-  {
-    printf(&quot;[ASF] Frame=%u :-&gt; Mismatch found len : %u expected %u\n&quot;,framenum,len, _index[framenum].frameLen);
-  }
-  aprintf(&quot;&gt;&gt;Len %d seq %d\n&quot;,len,curSeq);
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-/*******************************************
-  Read Headers to collect information 
-********************************************/
-uint8_t asfHeader::getHeaders(void)
-{
-  uint32_t i=0,nbSubChunk,hi,lo;
-  const chunky *id;
-  uint8_t gid[16];
-  uint32_t mn=0,mx=0;
-  asfChunk chunk(_fd);
-  // The first header is header chunk
-  chunk.nextChunk();
-  id=chunk.chunkId();
-  if(id-&gt;id!=ADM_CHUNK_HEADER_CHUNK)
-  {
-    printf(&quot;[ASF] expected header chunk\n&quot;); 
-    return 0;
-  }
-  printf(&quot;[ASF] getting headers\n&quot;);
-  chunk.dump();
-  nbSubChunk=chunk.read32();
-  printf(&quot;NB subchunk :%u\n&quot;,nbSubChunk);
-  chunk.read8();
-  chunk.read8();
-  for(i=0;i&lt;nbSubChunk;i++)
-  {
-    asfChunk *s=new asfChunk(_fd);
-    uint32_t skip;
-    s-&gt;nextChunk();
-    printf(&quot;***************\n&quot;);  
-    id=s-&gt;chunkId();
-    s-&gt;dump();
-    switch(id-&gt;id)
-    {
-#if 0      
-      case ADM_CHUNK_HEADER_EXTENSION_CHUNK:
-      {
-        s-&gt;skip(16); // Clock type extension ????
-        printf(&quot;?? %d\n&quot;,s-&gt;read16());
-        printf(&quot;?? %d\n&quot;,s-&gt;read32());
-          
-        uint32_t streamNameCount;
-        uint32_t payloadCount;
-          
-          asfChunk *u=new asfChunk(_fd);
-          for(int zzz=0;zzz&lt;8;zzz++)
-          {
-              u-&gt;nextChunk();
-              u-&gt;dump();
-              id=u-&gt;chunkId();
-              if(id-&gt;id==ADM_CHUNK_EXTENDED_STREAM_PROP)
-              {
-                  s-&gt;skip(8); // start time 
-                  s-&gt;skip(8); // end time
-                  printf(&quot;Bitrate         %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Buffer Size     %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;BFill           %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Alt Bitrate     %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Alt Bsize       %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Alt Bfullness   %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Max object Size %u :\n&quot;,u-&gt;read32());
-                  printf(&quot;Flags           0x%x :\n&quot;,u-&gt;read32());
-                  printf(&quot;Stream no       %u :\n&quot;,u-&gt;read16());
-                  printf(&quot;Stream lang     %u :\n&quot;,u-&gt;read16());
-                  printf(&quot;Stream time/fra %lu :\n&quot;,u-&gt;read64());
-                  streamNameCount=u-&gt;read16();
-                  payloadCount=u-&gt;read16();
-                  printf(&quot;Stream Nm Count %u :\n&quot;,streamNameCount);
-                  printf(&quot;Payload count   %u :\n&quot;,payloadCount);
-                  for(int stream=0;stream&lt;streamNameCount;stream++)
-                  {
-                    u-&gt;read16();
-                    skip=u-&gt;read16();
-                    u-&gt;skip(skip);
-                  }
-                  uint32_t size;
-                  for(int payload=0;payload&lt;payloadCount;payload++)
-                  {
-                    for(int pp=0;pp&lt;16;pp++) printf(&quot;0x%02x,&quot;,u-&gt;read8());
-                    printf(&quot;\n&quot;);
-                    skip=u-&gt;read16();
-                    size=u-&gt;read32();
-                    u-&gt;skip(size);
-                    printf(&quot;Extra Data : %d, skipd %d\n&quot;,size,skip);
-                  }
-                  printf(&quot;We are at %x\n&quot;,ftello(_fd));
-                }
-                u-&gt;skipChunk();
-          }
-          delete u;
-      }
-      break;
-#endif      
-      case ADM_CHUNK_FILE_HEADER_CHUNK:
-        {
-            // Client GID
-            printf(&quot;Client        :&quot;);
-            for(int z=0;z&lt;16;z++) printf(&quot;:%02x&quot;,s-&gt;read8());
-            printf(&quot;\n&quot;);
-            printf(&quot;File size     : %08lx\n&quot;,s-&gt;read64());
-            printf(&quot;Creation time : %08lx\n&quot;,s-&gt;read64());
-            printf(&quot;Number of pack: %08lx\n&quot;,s-&gt;read64());
-            printf(&quot;Timestamp 1   : %08lx\n&quot;,s-&gt;read64());
-            _duration=s-&gt;read64();
-            printf(&quot;Timestamp 2   : %08lx\n&quot;,_duration);
-            printf(&quot;Timestamp 3   : %04x\n&quot;,s-&gt;read32());
-            printf(&quot;Preload       : %04x\n&quot;,s-&gt;read32());
-            printf(&quot;Flags         : %04x\n&quot;,s-&gt;read32());
-            mx=s-&gt;read32();
-            mn=s-&gt;read32();
-            if(mx!=mn)
-            {
-              printf(&quot;Variable packet size!!\n&quot;);
-              delete s;
-              return 0; 
-            }
-            _packetSize=mx;
-            printf(&quot;Min size      : %04x\n&quot;,mx);
-            printf(&quot;Max size      : %04x\n&quot;,mn);
-            printf(&quot;Uncompres.size: %04x\n&quot;,s-&gt;read32());
-          }
-          break;
-      case ADM_CHUNK_STREAM_HEADER_CHUNK:
-      {
-         // Client GID
-        uint32_t audiovideo=0; // video=1, audio=2, 0=unknown
-        uint32_t sid;
-        s-&gt;read(gid,16);
-        printf(&quot;Type            :&quot;);
-        for(int z=0;z&lt;16;z++) printf(&quot;0x%02x,&quot;,gid[z]);
-        if(!memcmp(gid,asf_video,16))
-        {
-          printf(&quot;(video)&quot;);
-          audiovideo=1;
-        } else
-        {
-          if(!memcmp(gid,asf_audio,16))
-          {
-            printf(&quot;(audio)&quot;); 
-            audiovideo=2;
-          } else printf(&quot;(? ? ? ?)&quot;); 
-        }
-        printf(&quot;\nConceal       :&quot;);
-        for(int z=0;z&lt;16;z++) printf(&quot;:%02x&quot;,s-&gt;read8());
-        printf(&quot;\n&quot;);
-        printf(&quot;Reserved    : %08x\n&quot;,s-&gt;read64());
-        printf(&quot;Total Size  : %04x\n&quot;,s-&gt;read32());
-        printf(&quot;Size        : %04x\n&quot;,s-&gt;read32());
-        sid=s-&gt;read16();
-        printf(&quot;Stream nb   : %04x\n&quot;,sid);
-        printf(&quot;Reserved    : %04x\n&quot;,s-&gt;read32());
-        switch(audiovideo)
-        {
-          case 1: // Video
-          {
-                    _videoStreamId=sid;
-                    if(!loadVideo(s))
-                    {
-                      delete s;
-                      return 0; 
-                    }
-                    break;
-          }
-              break;
-          case 2: // audio
-          {
-            asfAudioTrak *trk=&amp;(_allAudioTracks[_nbAudioTrack]);
-            ADM_assert(_nbAudioTrack&lt;ASF_MAX_AUDIO_TRACK);
-            trk-&gt;streamIndex=sid;
-            s-&gt;read((uint8_t *)&amp;(trk-&gt;wavHeader),sizeof(WAVHeader));
-
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+
+#include &lt;string.h&gt;
+
+#include &quot;math.h&quot;
+
+#include &quot;ADM_utilities/default.h&quot;
+#include &quot;ADM_editor/ADM_Video.h&quot;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;fourcc.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+//#include &quot;DIA_working.h&quot;
+#include &quot;ADM_asf.h&quot;
+#include &quot;ADM_asfPacket.h&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_ASF
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+static const uint8_t asf_audio[16]={0x40,0x9e,0x69,0xf8,0x4d,0x5b,0xcf,0x11,0xa8,0xfd,0x00,0x80,0x5f,0x5c,0x44,0x2b};
+static const uint8_t asf_video[16]={0xc0,0xef,0x19,0xbc,0x4d,0x5b,0xcf,0x11,0xa8,0xfd,0x00,0x80,0x5f,0x5c,0x44,0x2b};
+
+
+WAVHeader *asfHeader::getAudioInfo(void )
+{
+  if(!_curAudio) return NULL;
+  return _curAudio-&gt;getInfo();
+}
+/*
+    __________________________________________________________
+*/
+
+uint8_t asfHeader::getAudioStream(AVDMGenericAudioStream **audio)
+{
+ 
+  *audio=_curAudio;
+  return 1; 
+}
+/*
+    __________________________________________________________
+*/
+
+void asfHeader::Dump(void)
+{
+ 
+  printf(&quot;*********** ASF INFO***********\n&quot;);
+}
+/*
+    __________________________________________________________
+*/
+
+uint8_t asfHeader::close(void)
+{
+	if (_fd) 
+		fclose(_fd);
+
+	_fd=NULL;
+
+  if(_videoExtraData)
+  {
+    delete [] _videoExtraData;
+    _videoExtraData=NULL; 
+  }
+  if(myName)
+  {
+    delete myName;
+    myName=NULL; 
+  }
+  if(_extraData)
+  {
+    delete [] _extraData;
+    _extraData=NULL; 
+  }
+  if(_index)
+  {
+    delete [] _index; 
+  }
+  _index=NULL;
+  if(_packet)
+    delete _packet;
+  _packet=NULL;
+  
+  for(int i=0;i&lt;_nbAudioTrack;i++)
+  {
+    asfAudioTrak *trk=&amp;(_allAudioTracks[i]);
+    if(trk-&gt;extraData) delete [] trk-&gt;extraData;
+    trk-&gt;extraData=NULL;
+  }
+}
+uint8_t       asfHeader::getExtraHeaderData(uint32_t *len, uint8_t **data)
+{
+  *len=_extraDataLen;
+  *data=_extraData;
+  return 1; 
+}
+/*
+    __________________________________________________________
+*/
+
+ asfHeader::asfHeader( void ) : vidHeader()
+{
+  _fd=NULL;
+  _videoIndex=-1;
+  myName=NULL;
+  _extraDataLen=0;
+  _extraData=NULL;
+  _packetSize=0;
+  _videoStreamId=0;
+  nbImage=0;
+  _index=NULL;
+  _packet=NULL;
+  _curAudio=NULL;
+  _nbPackets=0;
+  printf(&quot;%u\n&quot;,sizeof(_allAudioTracks));
+  memset(&amp;(_allAudioTracks[0]),0,sizeof(_allAudioTracks));
+
+  _nbAudioTrack=0;
+  _currentAudioStream=0;
+}
+/*
+    __________________________________________________________
+*/
+
+ asfHeader::~asfHeader(  )
+{
+  close();
+}
+/*
+    __________________________________________________________
+*/
+
+uint8_t asfHeader::open(const char *name)
+{
+  _fd=fopen(name,&quot;rb&quot;);
+  if(!_fd)
+  {
+    GUI_Error_HIG(&quot;File Error.&quot;,&quot;Cannot open file\n&quot;);
+    return 0; 
+  }
+  myName=ADM_strdup(name);
+  if(!getHeaders())
+  {
+    return 0; 
+  }
+  buildIndex();
+  fseeko(_fd,_dataStartOffset,SEEK_SET);
+  _packet=new asfPacket(_fd,_nbPackets,_packetSize,&amp;readQueue,_dataStartOffset);
+  curSeq=1;
+  if(_nbAudioTrack)
+  {
+    _curAudio=new asfAudio(this,_currentAudioStream);
+  }
+  return 1;
+}
+/*
+    __________________________________________________________
+*/
+
+ 
+/*
+    __________________________________________________________
+*/
+
+  uint8_t  asfHeader::setFlag(uint32_t frame,uint32_t flags)
+{
+  ADM_assert(frame&lt;nbImage);
+  _index[frame].flags=flags;
+  return 1; 
+}
+/*
+    __________________________________________________________
+*/
+
+uint32_t asfHeader::getFlags(uint32_t frame,uint32_t *flags)
+{
+  if(frame&gt;=nbImage) return 0;
+  if(!frame) *flags=AVI_KEY_FRAME;
+  else 
+      *flags=_index[frame].flags;
+  return 1; 
+}
+/*
+    __________________________________________________________
+*/
+
+uint8_t  asfHeader::getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img)
+{
+  img-&gt;dataLength=0;
+  img-&gt;flags=AVI_KEY_FRAME;
+  if(framenum&gt;=nbImage)
+  {
+    printf(&quot;[ASF] Going out of bound %u %u\n&quot;,framenum, nbImage);
+    return 0;
+  }
+  if(!_index[framenum].frameLen)
+  {
+    return 1; // Empty frame 
+  }
+  // In case curSeq is stored as one byte..
+  curSeq&amp;=0xff;
+  //
+  uint32_t len=0;
+  aprintf(&quot;Framenum %u len: %u curSeq %u frameSeq=%u packetnb=%u \n&quot;,
+         framenum,_index[framenum].frameLen,curSeq,
+         _index[framenum].segNb,_index[framenum].packetNb);
+  // Seeking ?
+  if(_index[framenum].segNb!=curSeq)
+  {
+    printf(&quot;Seeking.. curseq:%u wanted seq:%u\n&quot;,curSeq,_index[framenum].segNb);
+    if(!_packet-&gt;goToPacket(_index[framenum].packetNb))
+    {
+      printf(&quot;[ASF] Cannot seek to frame %u\n&quot;,framenum);
+      return 0; 
+    }
+    _packet-&gt;purge();
+    curSeq=_index[framenum].segNb;
+    printf(&quot;Seeking starting at seq=%u\n&quot;,curSeq);
+  }
+  
+  
+  len=0;
+  uint32_t delta;
+  while(1)
+  {
+   
+    
+    
+    while(!readQueue.isEmpty())
+    {
+      asfBit *bit;
+      ADM_assert(readQueue.pop((void**)&amp;bit));
+      aprintf(&quot;&gt;found packet of size %d seq %d, while curseq =%d wanted seg=%u current offset=%u\n&quot;,bit-&gt;len,bit-&gt;sequence,curSeq,_index[framenum].segNb,len);
+      // Here it is tricky
+      // if len==0 we are reading the first part of our frame
+      // The packet may starts with segments from the previous frame
+      // discard them
+      // Delta is just a security as it should be slightly &gt;10
+      delta=256+bit-&gt;sequence-_index[framenum].segNb;
+      delta &amp;=0xff;
+      if(!len) // Starting a new frame
+      {
+          if(_index[framenum].segNb != bit-&gt;sequence )
+          {
+            aprintf(&quot;Dropping seq=%u too old for %u delta %d\n&quot;,
+                  bit-&gt;sequence,_index[framenum].segNb,delta);
+            delete[] bit-&gt;data;
+            delete bit;
+            if(delta&lt;230)
+            {
+              printf(&quot;Very suspicious\n&quot;);
+              printf(&quot;Very suspicious\n&quot;);
+              printf(&quot;Very suspicious\n&quot;);
+              printf(&quot;Very suspicious\n&quot;);
+              printf(&quot;Very suspicious\n&quot;);
+            }
+            continue; 
+          }
+          // We have found our first chunk
+          curSeq=bit-&gt;sequence;
+          memcpy(img-&gt;data,bit-&gt;data,bit-&gt;len);
+          len=bit-&gt;len;
+          delete[] bit-&gt;data;
+          delete bit;
+          continue;
+      }
+      // Continuing a frame
+      // If the seq number is different it is the beginning of a new frame
+      if(bit-&gt;sequence!=curSeq )
+      {
+        aprintf(&quot;New sequence %u-&gt;%u while loading %u frame\n&quot;,curSeq,bit-&gt;sequence,framenum);
+        img-&gt;dataLength=len;
+        readQueue.pushBack(bit); // don't delete it, we will use it later...
+        curSeq=bit-&gt;sequence;
+        goto gotcha;
+      }
+      // still same sequence ...add
+      memcpy(img-&gt;data+len,bit-&gt;data,bit-&gt;len);
+      len+=bit-&gt;len;
+	  delete[] bit-&gt;data;
+      delete bit;
+    }
+    if(!_packet-&gt;nextPacket(_videoStreamId))
+    {
+      printf(&quot;[ASF] Packet Error\n&quot;);
+      return 0; 
+    }
+    _packet-&gt;skipPacket();
+  }
+gotcha:
+  
+  img-&gt;dataLength=len;
+  if(len!=_index[framenum].frameLen)
+  {
+    printf(&quot;[ASF] Frame=%u :-&gt; Mismatch found len : %u expected %u\n&quot;,framenum,len, _index[framenum].frameLen);
+  }
+  aprintf(&quot;&gt;&gt;Len %d seq %d\n&quot;,len,curSeq);
+  return 1; 
+}
+/*
+    __________________________________________________________
+*/
+
+/*******************************************
+  Read Headers to collect information 
+********************************************/
+uint8_t asfHeader::getHeaders(void)
+{
+  uint32_t i=0,nbSubChunk,hi,lo;
+  const chunky *id;
+  uint8_t gid[16];
+  uint32_t mn=0,mx=0;
+  asfChunk chunk(_fd);
+  // The first header is header chunk
+  chunk.nextChunk();
+  id=chunk.chunkId();
+  if(id-&gt;id!=ADM_CHUNK_HEADER_CHUNK)
+  {
+    printf(&quot;[ASF] expected header chunk\n&quot;); 
+    return 0;
+  }
+  printf(&quot;[ASF] getting headers\n&quot;);
+  chunk.dump();
+  nbSubChunk=chunk.read32();
+  printf(&quot;NB subchunk :%u\n&quot;,nbSubChunk);
+  chunk.read8();
+  chunk.read8();
+  for(i=0;i&lt;nbSubChunk;i++)
+  {
+    asfChunk *s=new asfChunk(_fd);
+    uint32_t skip;
+    s-&gt;nextChunk();
+    printf(&quot;***************\n&quot;);  
+    id=s-&gt;chunkId();
+    s-&gt;dump();
+    switch(id-&gt;id)
+    {
+#if 0      
+      case ADM_CHUNK_HEADER_EXTENSION_CHUNK:
+      {
+        s-&gt;skip(16); // Clock type extension ????
+        printf(&quot;?? %d\n&quot;,s-&gt;read16());
+        printf(&quot;?? %d\n&quot;,s-&gt;read32());
+          
+        uint32_t streamNameCount;
+        uint32_t payloadCount;
+          
+          asfChunk *u=new asfChunk(_fd);
+          for(int zzz=0;zzz&lt;8;zzz++)
+          {
+              u-&gt;nextChunk();
+              u-&gt;dump();
+              id=u-&gt;chunkId();
+              if(id-&gt;id==ADM_CHUNK_EXTENDED_STREAM_PROP)
+              {
+                  s-&gt;skip(8); // start time 
+                  s-&gt;skip(8); // end time
+                  printf(&quot;Bitrate         %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Buffer Size     %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;BFill           %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Alt Bitrate     %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Alt Bsize       %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Alt Bfullness   %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Max object Size %u :\n&quot;,u-&gt;read32());
+                  printf(&quot;Flags           0x%x :\n&quot;,u-&gt;read32());
+                  printf(&quot;Stream no       %u :\n&quot;,u-&gt;read16());
+                  printf(&quot;Stream lang     %u :\n&quot;,u-&gt;read16());
+                  printf(&quot;Stream time/fra %lu :\n&quot;,u-&gt;read64());
+                  streamNameCount=u-&gt;read16();
+                  payloadCount=u-&gt;read16();
+                  printf(&quot;Stream Nm Count %u :\n&quot;,streamNameCount);
+                  printf(&quot;Payload count   %u :\n&quot;,payloadCount);
+                  for(int stream=0;stream&lt;streamNameCount;stream++)
+                  {
+                    u-&gt;read16();
+                    skip=u-&gt;read16();
+                    u-&gt;skip(skip);
+                  }
+                  uint32_t size;
+                  for(int payload=0;payload&lt;payloadCount;payload++)
+                  {
+                    for(int pp=0;pp&lt;16;pp++) printf(&quot;0x%02x,&quot;,u-&gt;read8());
+                    printf(&quot;\n&quot;);
+                    skip=u-&gt;read16();
+                    size=u-&gt;read32();
+                    u-&gt;skip(size);
+                    printf(&quot;Extra Data : %d, skipd %d\n&quot;,size,skip);
+                  }
+                  printf(&quot;We are at %x\n&quot;,ftello(_fd));
+                }
+                u-&gt;skipChunk();
+          }
+          delete u;
+      }
+      break;
+#endif      
+      case ADM_CHUNK_FILE_HEADER_CHUNK:
+        {
+            // Client GID
+            printf(&quot;Client        :&quot;);
+            for(int z=0;z&lt;16;z++) printf(&quot;:%02x&quot;,s-&gt;read8());
+            printf(&quot;\n&quot;);
+            printf(&quot;File size     : %08lx\n&quot;,s-&gt;read64());
+            printf(&quot;Creation time : %08lx\n&quot;,s-&gt;read64());
+            printf(&quot;Number of pack: %08lx\n&quot;,s-&gt;read64());
+            printf(&quot;Timestamp 1   : %08lx\n&quot;,s-&gt;read64());
+            _duration=s-&gt;read64();
+            printf(&quot;Timestamp 2   : %08lx\n&quot;,_duration);
+            printf(&quot;Timestamp 3   : %04x\n&quot;,s-&gt;read32());
+            printf(&quot;Preload       : %04x\n&quot;,s-&gt;read32());
+            printf(&quot;Flags         : %04x\n&quot;,s-&gt;read32());
+            mx=s-&gt;read32();
+            mn=s-&gt;read32();
+            if(mx!=mn)
+            {
+              printf(&quot;Variable packet size!!\n&quot;);
+              delete s;
+              return 0; 
+            }
+            _packetSize=mx;
+            printf(&quot;Min size      : %04x\n&quot;,mx);
+            printf(&quot;Max size      : %04x\n&quot;,mn);
+            printf(&quot;Uncompres.size: %04x\n&quot;,s-&gt;read32());
+          }
+          break;
+      case ADM_CHUNK_STREAM_HEADER_CHUNK:
+      {
+         // Client GID
+        uint32_t audiovideo=0; // video=1, audio=2, 0=unknown
+        uint32_t sid;
+        s-&gt;read(gid,16);
+        printf(&quot;Type            :&quot;);
+        for(int z=0;z&lt;16;z++) printf(&quot;0x%02x,&quot;,gid[z]);
+        if(!memcmp(gid,asf_video,16))
+        {
+          printf(&quot;(video)&quot;);
+          audiovideo=1;
+        } else
+        {
+          if(!memcmp(gid,asf_audio,16))
+          {
+            printf(&quot;(audio)&quot;); 
+            audiovideo=2;
+          } else printf(&quot;(? ? ? ?)&quot;); 
+        }
+        printf(&quot;\nConceal       :&quot;);
+        for(int z=0;z&lt;16;z++) printf(&quot;:%02x&quot;,s-&gt;read8());
+        printf(&quot;\n&quot;);
+        printf(&quot;Reserved    : %08x\n&quot;,s-&gt;read64());
+        printf(&quot;Total Size  : %04x\n&quot;,s-&gt;read32());
+        printf(&quot;Size        : %04x\n&quot;,s-&gt;read32());
+        sid=s-&gt;read16();
+        printf(&quot;Stream nb   : %04x\n&quot;,sid);
+        printf(&quot;Reserved    : %04x\n&quot;,s-&gt;read32());
+        switch(audiovideo)
+        {
+          case 1: // Video
+          {
+                    _videoStreamId=sid;
+                    if(!loadVideo(s))
+                    {
+                      delete s;
+                      return 0; 
+                    }
+                    break;
+          }
+              break;
+          case 2: // audio
+          {
+            asfAudioTrak *trk=&amp;(_allAudioTracks[_nbAudioTrack]);
+            ADM_assert(_nbAudioTrack&lt;ASF_MAX_AUDIO_TRACK);
+            trk-&gt;streamIndex=sid;
+            s-&gt;read((uint8_t *)&amp;(trk-&gt;wavHeader),sizeof(WAVHeader));
+
 		#ifdef ADM_BIG_ENDIAN
 			Endian_WavHeader(&amp;(trk-&gt;wavHeader));
-		#endif
-
-            trk-&gt;extraDataLen=s-&gt;read16();
-            printf(&quot;Extension :%u bytes\n&quot;,trk-&gt;extraDataLen);
-            if(trk-&gt;extraDataLen)
-            {
-              trk-&gt;extraData=new uint8_t[trk-&gt;extraDataLen];
-              s-&gt;read(trk-&gt;extraData,trk-&gt;extraDataLen);
-            }
-              printf(&quot;#block in group   :%d\n&quot;,s-&gt;read8());
-              printf(&quot;#byte in group    :%d\n&quot;,s-&gt;read16());
-              printf(&quot;Align1            :%d\n&quot;,s-&gt;read16());
-              printf(&quot;Align2            :%d\n&quot;,s-&gt;read16());
-              _nbAudioTrack++;
-            
-          }
-          break;
-          default:break; 
-          
-        }
-      }
-      break;
-       default:
-         break;
-    }
-    s-&gt;skipChunk();
-    delete s;
-  }
-  printf(&quot;End of headers\n&quot;);
-  return 1;
-}
-uint8_t    asfHeader::changeAudioStream(uint32_t newstream)
-{
-  ADM_assert(_currentAudioStream&lt;_nbAudioTrack);
-  _currentAudioStream=newstream;
-  return 1;
-}
-uint32_t    asfHeader::getCurrentAudioStreamNumber(void)
-{
-  return _currentAudioStream;
-}
-uint8_t     asfHeader::getAudioStreamsInfo(uint32_t *nbStreams, audioInfo **infos)
-{
-    *nbStreams=_nbAudioTrack;
-    if(_nbAudioTrack)
-    {
-      *infos=new audioInfo[_nbAudioTrack];
-      for(int i=0;i&lt;_nbAudioTrack;i++)
-      {
-        WAV2AudioInfo(&amp;(_allAudioTracks[i].wavHeader),&amp;((*infos)[i]));
-      }
-    }
-    return 1;
-}
-uint8_t asfHeader::loadVideo(asfChunk *s)
-{
-  uint32_t w,h,x;
-            w=s-&gt;read32();
-            h=s-&gt;read32();
-            s-&gt;read8();
-            x=s-&gt;read16();
-            _isvideopresent=1;
-
-            memset(&amp;_mainaviheader,0,sizeof(_mainaviheader));
-            _mainaviheader.dwWidth=w;
-            _mainaviheader.dwHeight=h;
-            _video_bih.biWidth=w;
-            _video_bih.biHeight=h;
-            printf(&quot;Pic Width  %04d\n&quot;,w);
-            printf(&quot;Pic Height %04d\n&quot;,h);
-            printf(&quot; BMP size  %04d (%04d)\n&quot;,x,sizeof(BITMAPINFOHEADER));
-            s-&gt;read((uint8_t *)&amp;_video_bih,sizeof(BITMAPINFOHEADER));
-
+		#endif
+
+            trk-&gt;extraDataLen=s-&gt;read16();
+            printf(&quot;Extension :%u bytes\n&quot;,trk-&gt;extraDataLen);
+            if(trk-&gt;extraDataLen)
+            {
+              trk-&gt;extraData=new uint8_t[trk-&gt;extraDataLen];
+              s-&gt;read(trk-&gt;extraData,trk-&gt;extraDataLen);
+            }
+              printf(&quot;#block in group   :%d\n&quot;,s-&gt;read8());
+              printf(&quot;#byte in group    :%d\n&quot;,s-&gt;read16());
+              printf(&quot;Align1            :%d\n&quot;,s-&gt;read16());
+              printf(&quot;Align2            :%d\n&quot;,s-&gt;read16());
+              _nbAudioTrack++;
+            
+          }
+          break;
+          default:break; 
+          
+        }
+      }
+      break;
+       default:
+         break;
+    }
+    s-&gt;skipChunk();
+    delete s;
+  }
+  printf(&quot;End of headers\n&quot;);
+  return 1;
+}
+uint8_t    asfHeader::changeAudioStream(uint32_t newstream)
+{
+  ADM_assert(_currentAudioStream&lt;_nbAudioTrack);
+  _currentAudioStream=newstream;
+  return 1;
+}
+uint32_t    asfHeader::getCurrentAudioStreamNumber(void)
+{
+  return _currentAudioStream;
+}
+uint8_t     asfHeader::getAudioStreamsInfo(uint32_t *nbStreams, audioInfo **infos)
+{
+    *nbStreams=_nbAudioTrack;
+    if(_nbAudioTrack)
+    {
+      *infos=new audioInfo[_nbAudioTrack];
+      for(int i=0;i&lt;_nbAudioTrack;i++)
+      {
+        WAV2AudioInfo(&amp;(_allAudioTracks[i].wavHeader),&amp;((*infos)[i]));
+      }
+    }
+    return 1;
+}
+uint8_t asfHeader::loadVideo(asfChunk *s)
+{
+  uint32_t w,h,x;
+            w=s-&gt;read32();
+            h=s-&gt;read32();
+            s-&gt;read8();
+            x=s-&gt;read16();
+            _isvideopresent=1;
+
+            memset(&amp;_mainaviheader,0,sizeof(_mainaviheader));
+            _mainaviheader.dwWidth=w;
+            _mainaviheader.dwHeight=h;
+            _video_bih.biWidth=w;
+            _video_bih.biHeight=h;
+            printf(&quot;Pic Width  %04d\n&quot;,w);
+            printf(&quot;Pic Height %04d\n&quot;,h);
+            printf(&quot; BMP size  %04d (%04d)\n&quot;,x,sizeof(BITMAPINFOHEADER));
+            s-&gt;read((uint8_t *)&amp;_video_bih,sizeof(BITMAPINFOHEADER));
+
 		#ifdef ADM_BIG_ENDIAN
 			Endian_BitMapInfo(&amp;_video_bih);
-		#endif
-
-            _videostream.dwScale=1000;
-            _videostream.dwRate=30000;
-
-            _videostream.fccHandler=_video_bih.biCompression;
-            printf(&quot;Codec : &lt;%s&gt; (%04x)\n&quot;,
-                    fourCC::tostring(_video_bih.biCompression),_video_bih.biCompression);
-            if(fourCC::check(_video_bih.biCompression,(uint8_t *)&quot;DVR &quot;))
-            {
-              // It is MS DVR, fail so that the mpeg2 indexer can take it from here
-              _videostream.fccHandler=_video_bih.biCompression=fourCC::get((uint8_t *)&quot;MPEG&quot;);
-              printf(&quot;This is MSDVR, not ASF\n&quot;);
-              return 0; 
-            }
-            printBih(&amp;_video_bih);
-            if(x&gt;sizeof(BITMAPINFOHEADER))
-            {
-              _extraDataLen=x-sizeof(BITMAPINFOHEADER);
-              _extraData=new uint8_t[_extraDataLen];
-              s-&gt;read(_extraData,_extraDataLen);
-            }
-            return 1;
-}
-/*
-    Scan the file to build an index
-    
-    Header Chunk
-            Chunk
-            Chunk
-            Chunk
-            
-    Data chunk
-            Chunk
-            Chunk
-            
-    We skip the 1st one, and just read the header of the 2nd one
-    
-*/
-uint8_t asfHeader::buildIndex(void)
-{
-  uint32_t fSize;
-  const chunky *id;
-  uint32_t chunkFound;
-  uint32_t r=5;
-  uint32_t len;
-  
-  fseeko(_fd,0,SEEK_END);
-  fSize=ftello(_fd);
-  fseeko(_fd,0,SEEK_SET);
-  
-  asfChunk h(_fd);
-  printf(&quot;[ASF] ********** Building index **********\n&quot;);
-  printf(&quot;[ASF] Searching data\n&quot;);
-  while(r--)
-  {
-    h.nextChunk();    // Skip headers
-    id=h.chunkId();
-    h.dump();
-    if(id-&gt;id==ADM_CHUNK_DATA_CHUNK) break;
-    h.skipChunk();
-  }
-  if(id-&gt;id!=ADM_CHUNK_DATA_CHUNK) return 0;
-  // Remove leftover from DATA_chunk
- // Unknown	GUID	16
-//       Number of packets	UINT64	8
-//       Unknown	UINT8	1
-//       Unknown	UINT8	1
-//   
-  h.read32();
-  h.read32();
-  h.read32();
-  h.read32();
-  _nbPackets=(uint32_t) h.read64();
-  h.read16();
-  
-  len=h.chunkLen-16-8-2-24;
-  
-  printf(&quot;[ASF] nbPacket  : %u\n&quot;,_nbPackets);
-  printf(&quot;[ASF] len to go : %u\n&quot;,len);
-  printf(&quot;[ASF] scanning data\n&quot;);
-  _dataStartOffset=ftello(_fd);
-  
-  // Here we go
-  //DIA_working *working=new DIA_working(&quot;indexing asf&quot;);
-  asfPacket *aPacket=new asfPacket(_fd,_nbPackets,_packetSize,
-                                   &amp;readQueue,_dataStartOffset);
-  uint32_t packet=1;
-#define MAXIMAGE (_nbPackets)
-  uint32_t sequence=1;
-  uint32_t ceilImage=MAXIMAGE;
-
-  nbImage=0;
-  asfIndex *tmpIndex=new asfIndex[ceilImage];
-  memset(tmpIndex,0,sizeof(asfIndex)*ceilImage);
-  len=0;
-  tmpIndex[0].segNb=1;
-  while(packet&lt;_nbPackets)
-  {
-    while(!readQueue.isEmpty())
-    {
-      asfBit *bit=NULL;
-      ADM_assert(readQueue.pop((void**)&amp;bit));
-      if(nbImage&gt;=ceilImage-1)
-      {  // Expand if our first guess was too small
-           uint32_t newceil=ceilImage*2;
-           asfIndex *tmptmpIndex=new asfIndex[newceil];
-           memset(tmptmpIndex,0,sizeof(asfIndex)*newceil);
-           memcpy(tmptmpIndex,tmpIndex,sizeof(asfIndex)*ceilImage);
-           delete [] tmpIndex;
-           tmpIndex=tmptmpIndex;
-           ceilImage=newceil;
-      }
-      if(bit-&gt;stream==_videoStreamId)
-      {
-          aprintf(&quot;&gt;found packet of size %d seq %d, while curseq =%d\n&quot;,bit-&gt;len,bit-&gt;sequence,curSeq);
-          if(bit-&gt;sequence!=sequence)
-          {
-            tmpIndex[nbImage].frameLen=len;
-            aprintf(&quot;New sequence\n&quot;);
-            if( ((sequence+1)&amp;0xff)!=(bit-&gt;sequence&amp;0xff))
-            {
-                printf(&quot;!!!!!!!!!!!! non continuous sequence %u %u\n&quot;,sequence,bit-&gt;sequence); 
-    #if 1         
-                // Let's insert a couple of null frame
-                int32_t delta,start,end;
-                
-                start=256+bit-&gt;sequence-sequence-1;
-                start&amp;=0xff;
-                printf(&quot;!!!!!!!!!!!! Delta %d\n&quot;,start);
-                
-                for(int filler=0;filler&lt;start;filler++)
-                {
-                  tmpIndex[++nbImage].frameLen=0;
-                }
-    #endif            
-            }
-            nbImage++;
-            ADM_assert(nbImage&lt;ceilImage);
-            tmpIndex[nbImage].frameLen=0;
-            tmpIndex[nbImage].segNb=bit-&gt;sequence;
-            tmpIndex[nbImage].packetNb=bit-&gt;packet;
-            tmpIndex[nbImage].flags=bit-&gt;flags;
-
-            for(int z=0;z&lt;_nbAudioTrack;z++)
-            {
-              tmpIndex[nbImage].audioSeen[z]=_allAudioTracks[z].length;
-            }
-            readQueue.pushBack(bit);
-    
-            sequence=bit-&gt;sequence;
-            len=0;
-            continue;
-          }
-          len+=bit-&gt;len;
-      } // End of video stream Id
-      else  // Audio ?
-      {
-        int found=0;
-        for(int i=0;i&lt;_nbAudioTrack &amp;&amp; !found;i++)
-        {
-          if(bit-&gt;stream == _allAudioTracks[i].streamIndex)
-          {
-            
-            _allAudioTracks[i].length+=bit-&gt;len;
-            found=1;
-          }
-        }
-        if(!found) 
-        {
-          printf(&quot;Unmapped stream %u\n&quot;,bit-&gt;stream); 
-        }
-      }
-     delete[] bit-&gt;data;
-     delete bit;
-    }
-    //working-&gt;update(packet,_nbPackets);
-
-    packet++;
-    aPacket-&gt;nextPacket(0xff); // All packets
-    aPacket-&gt;skipPacket();
-  }
-  delete aPacket;
-  //delete working;
-  /* Compact index */
-  _index=new asfIndex[nbImage];
-  memcpy(_index,tmpIndex,sizeof(asfIndex)*nbImage);
-  delete [] tmpIndex;
-  
-  fseeko(_fd,_dataStartOffset,SEEK_SET);
-  printf(&quot;[ASF] %u images found\n&quot;,nbImage);
-  printf(&quot;[ASF] ******** End of buildindex *******\n&quot;);
-  _videostream.dwLength=_mainaviheader.dwTotalFrames=nbImage;
-  if(!nbImage) return 0;
-  
-  // Update fps
-  // In fact it is an average fps
-  // FIXME
-  float f=nbImage;
-  uint32_t ps;
-  
-  f*=1000.*1000.*10000.;
-  f=f/_duration;
-  ps=(uint32_t)f;
-  // Round up to the closed 0.5 = 500
-  ps=(ps+490)/500;
-  ps*=500;
-  
-  _videostream.dwScale=1000;
-  _videostream.dwRate=ps;
-
-  return 1;
-  
-}
-//EOF
+		#endif
+
+            _videostream.dwScale=1000;
+            _videostream.dwRate=30000;
+
+            _videostream.fccHandler=_video_bih.biCompression;
+            printf(&quot;Codec : &lt;%s&gt; (%04x)\n&quot;,
+                    fourCC::tostring(_video_bih.biCompression),_video_bih.biCompression);
+            if(fourCC::check(_video_bih.biCompression,(uint8_t *)&quot;DVR &quot;))
+            {
+              // It is MS DVR, fail so that the mpeg2 indexer can take it from here
+              _videostream.fccHandler=_video_bih.biCompression=fourCC::get((uint8_t *)&quot;MPEG&quot;);
+              printf(&quot;This is MSDVR, not ASF\n&quot;);
+              return 0; 
+            }
+            printBih(&amp;_video_bih);
+            if(x&gt;sizeof(BITMAPINFOHEADER))
+            {
+              _extraDataLen=x-sizeof(BITMAPINFOHEADER);
+              _extraData=new uint8_t[_extraDataLen];
+              s-&gt;read(_extraData,_extraDataLen);
+            }
+            return 1;
+}
+/*
+    Scan the file to build an index
+    
+    Header Chunk
+            Chunk
+            Chunk
+            Chunk
+            
+    Data chunk
+            Chunk
+            Chunk
+            
+    We skip the 1st one, and just read the header of the 2nd one
+    
+*/
+uint8_t asfHeader::buildIndex(void)
+{
+  uint32_t fSize;
+  const chunky *id;
+  uint32_t chunkFound;
+  uint32_t r=5;
+  uint32_t len;
+  
+  fseeko(_fd,0,SEEK_END);
+  fSize=ftello(_fd);
+  fseeko(_fd,0,SEEK_SET);
+  
+  asfChunk h(_fd);
+  printf(&quot;[ASF] ********** Building index **********\n&quot;);
+  printf(&quot;[ASF] Searching data\n&quot;);
+  while(r--)
+  {
+    h.nextChunk();    // Skip headers
+    id=h.chunkId();
+    h.dump();
+    if(id-&gt;id==ADM_CHUNK_DATA_CHUNK) break;
+    h.skipChunk();
+  }
+  if(id-&gt;id!=ADM_CHUNK_DATA_CHUNK) return 0;
+  // Remove leftover from DATA_chunk
+ // Unknown	GUID	16
+//       Number of packets	UINT64	8
+//       Unknown	UINT8	1
+//       Unknown	UINT8	1
+//   
+  h.read32();
+  h.read32();
+  h.read32();
+  h.read32();
+  _nbPackets=(uint32_t) h.read64();
+  h.read16();
+  
+  len=h.chunkLen-16-8-2-24;
+  
+  printf(&quot;[ASF] nbPacket  : %u\n&quot;,_nbPackets);
+  printf(&quot;[ASF] len to go : %u\n&quot;,len);
+  printf(&quot;[ASF] scanning data\n&quot;);
+  _dataStartOffset=ftello(_fd);
+  
+  // Here we go
+  //DIA_working *working=new DIA_working(&quot;indexing asf&quot;);
+  asfPacket *aPacket=new asfPacket(_fd,_nbPackets,_packetSize,
+                                   &amp;readQueue,_dataStartOffset);
+  uint32_t packet=1;
+#define MAXIMAGE (_nbPackets)
+  uint32_t sequence=1;
+  uint32_t ceilImage=MAXIMAGE;
+
+  nbImage=0;
+  asfIndex *tmpIndex=new asfIndex[ceilImage];
+  memset(tmpIndex,0,sizeof(asfIndex)*ceilImage);
+  len=0;
+  tmpIndex[0].segNb=1;
+  while(packet&lt;_nbPackets)
+  {
+    while(!readQueue.isEmpty())
+    {
+      asfBit *bit=NULL;
+      ADM_assert(readQueue.pop((void**)&amp;bit));
+      if(nbImage&gt;=ceilImage-1)
+      {  // Expand if our first guess was too small
+           uint32_t newceil=ceilImage*2;
+           asfIndex *tmptmpIndex=new asfIndex[newceil];
+           memset(tmptmpIndex,0,sizeof(asfIndex)*newceil);
+           memcpy(tmptmpIndex,tmpIndex,sizeof(asfIndex)*ceilImage);
+           delete [] tmpIndex;
+           tmpIndex=tmptmpIndex;
+           ceilImage=newceil;
+      }
+      if(bit-&gt;stream==_videoStreamId)
+      {
+          aprintf(&quot;&gt;found packet of size %d seq %d, while curseq =%d\n&quot;,bit-&gt;len,bit-&gt;sequence,curSeq);
+          if(bit-&gt;sequence!=sequence)
+          {
+            tmpIndex[nbImage].frameLen=len;
+            aprintf(&quot;New sequence\n&quot;);
+            if( ((sequence+1)&amp;0xff)!=(bit-&gt;sequence&amp;0xff))
+            {
+                printf(&quot;!!!!!!!!!!!! non continuous sequence %u %u\n&quot;,sequence,bit-&gt;sequence); 
+    #if 1         
+                // Let's insert a couple of null frame
+                int32_t delta,start,end;
+                
+                start=256+bit-&gt;sequence-sequence-1;
+                start&amp;=0xff;
+                printf(&quot;!!!!!!!!!!!! Delta %d\n&quot;,start);
+                
+                for(int filler=0;filler&lt;start;filler++)
+                {
+                  tmpIndex[++nbImage].frameLen=0;
+                }
+    #endif            
+            }
+            nbImage++;
+            ADM_assert(nbImage&lt;ceilImage);
+            tmpIndex[nbImage].frameLen=0;
+            tmpIndex[nbImage].segNb=bit-&gt;sequence;
+            tmpIndex[nbImage].packetNb=bit-&gt;packet;
+            tmpIndex[nbImage].flags=bit-&gt;flags;
+
+            for(int z=0;z&lt;_nbAudioTrack;z++)
+            {
+              tmpIndex[nbImage].audioSeen[z]=_allAudioTracks[z].length;
+            }
+            readQueue.pushBack(bit);
+    
+            sequence=bit-&gt;sequence;
+            len=0;
+            continue;
+          }
+          len+=bit-&gt;len;
+      } // End of video stream Id
+      else  // Audio ?
+      {
+        int found=0;
+        for(int i=0;i&lt;_nbAudioTrack &amp;&amp; !found;i++)
+        {
+          if(bit-&gt;stream == _allAudioTracks[i].streamIndex)
+          {
+            
+            _allAudioTracks[i].length+=bit-&gt;len;
+            found=1;
+          }
+        }
+        if(!found) 
+        {
+          printf(&quot;Unmapped stream %u\n&quot;,bit-&gt;stream); 
+        }
+      }
+     delete[] bit-&gt;data;
+     delete bit;
+    }
+    //working-&gt;update(packet,_nbPackets);
+
+    packet++;
+    aPacket-&gt;nextPacket(0xff); // All packets
+    aPacket-&gt;skipPacket();
+  }
+  delete aPacket;
+  //delete working;
+  /* Compact index */
+  _index=new asfIndex[nbImage];
+  memcpy(_index,tmpIndex,sizeof(asfIndex)*nbImage);
+  delete [] tmpIndex;
+  
+  fseeko(_fd,_dataStartOffset,SEEK_SET);
+  printf(&quot;[ASF] %u images found\n&quot;,nbImage);
+  printf(&quot;[ASF] ******** End of buildindex *******\n&quot;);
+  _videostream.dwLength=_mainaviheader.dwTotalFrames=nbImage;
+  if(!nbImage) return 0;
+  
+  // Update fps
+  // In fact it is an average fps
+  // FIXME
+  float f=nbImage;
+  uint32_t ps;
+  
+  f*=1000.*1000.*10000.;
+  f=f/_duration;
+  ps=(uint32_t)f;
+  // Round up to the closed 0.5 = 500
+  ps=(ps+490)/500;
+  ps*=500;
+  
+  _videostream.dwScale=1000;
+  _videostream.dwRate=ps;
+
+  return 1;
+  
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -166,7 +166,7 @@
              asfHeader( void );
     virtual  ~asfHeader(  ) ;
 // AVI io
-    virtual uint8_t  open(char *name);
+    virtual uint8_t  open(const char *name);
     virtual uint8_t  close(void) ;
   //__________________________
   //  Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -41,7 +41,7 @@
 }
 
 
-uint8_t avsHeader::open(char *name)
+uint8_t avsHeader::open(const char *name)
 {
     mySocket=0;
     if(!bindMe(9999))

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -30,7 +30,7 @@
         avsHeader( void );
         ~avsHeader(  );
 // AVI io
-        virtual 	uint8_t			open(char *name);
+        virtual 	uint8_t			open(const char *name);
         virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -93,7 +93,7 @@
       \brief open the flv file, gather infos and build index(es).
 */
 
-uint8_t flvHeader::open(char *name)
+uint8_t flvHeader::open(const char *name)
 {
   uint32_t prevLen, type, size, pts,pos=0;
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_flv/ADM_flv.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -110,7 +110,7 @@
             flvHeader( void );
    virtual  ~flvHeader(  ) ;
 // AVI io
-    virtual uint8_t  open(char *name);
+    virtual uint8_t  open(const char *name);
     virtual uint8_t  close(void) ;
   //__________________________
   //  Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -106,7 +106,7 @@
 // Open and index the (small) h263
 //
 //______________________________________
-uint8_t    h263Header::open(char *name)
+uint8_t    h263Header::open(const char *name)
 {
 	uint32_t w,h,res=255,nbImg=0;
 	uint32_t word;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/ADM_h263.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -49,7 +49,7 @@
 			h263Header( void ) {_fd=NULL;};
        		    	~h263Header(  ) { };
 // AVI io
-virtual 	uint8_t			open(char *name);
+virtual 	uint8_t			open(const char *name);
 virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -19,11 +19,11 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-#include &quot;math.h&quot;
+#include &lt;math.h&gt;
 
 #include &quot;default.h&quot;
 #include &quot;ADM_editor/ADM_Video.h&quot;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 
 #include &quot;fourcc.h&quot;
@@ -127,7 +127,7 @@
 
 			}
 }
-uint8_t bitsReader::open(char *name)
+uint8_t bitsReader::open(const char *name)
 {
 	_fd=fopen(name,&quot;rb&quot;);
 	if(!_fd) return 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_h263/bitsRead.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -15,7 +15,7 @@
 
 public:
 			bitsReader(void);
-	uint8_t		open(char *name);
+	uint8_t		open(const char *name);
 			~bitsReader();
 	uint8_t 	forward(uint32_t nbBits);
 	uint8_t 	read(uint32_t nbBits,uint32_t *val);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -128,7 +128,7 @@
     return i;
 }
 //****************************************************************
-uint8_t picHeader::open(char *inname)
+uint8_t picHeader::open(const char *inname)
 {
     uint32_t nnum;
     uint32_t *fcc;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_inpics/ADM_pics.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -57,7 +57,7 @@
 			picHeader( void );
        		    ~picHeader(  ) { };
 // AVI io
-virtual 	uint8_t			open(char *name);
+virtual 	uint8_t			open(const char *name);
 virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -34,7 +34,7 @@
     __________________________________________________________
 */
 
-uint8_t mkvHeader::open(char *name)
+uint8_t mkvHeader::open(const char *name)
 {
 
   ADM_ebml_file ebml;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -134,7 +134,7 @@
             mkvHeader( void );
    virtual  ~mkvHeader(  ) ;
 // AVI io
-    virtual uint8_t  open(char *name);
+    virtual uint8_t  open(const char *name);
     virtual uint8_t  close(void) ;
   //__________________________
   //  Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -201,7 +201,7 @@
 // other stuff which are pretty useless on
 // 3gp file anyway.
 //______________________________________
-uint8_t    MP4Header::open(char *name)
+uint8_t    MP4Header::open(const char *name)
 {
         printf(&quot;** opening 3gpp files **&quot;);	
         _fd=fopen(name,&quot;rb&quot;);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -157,7 +157,7 @@
                                 MP4Header( void ) ;
 virtual	                        ~MP4Header(  ) ;
 // AVI io
-virtual 	uint8_t	       open(char *name);
+virtual 	uint8_t	       open(const char *name);
 virtual 	uint8_t	       close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -75,7 +75,7 @@
   _index=NULL;
 }
 uint8_t
-dmxAudioStream::open (char *name)
+dmxAudioStream::open (const char *name)
 {
   FILE *file;
   uint32_t dummy;		//,audio=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -56,7 +56,7 @@
                 public:
                 uint32_t        currentTrack;
                                 dmxAudioStream( void);
-                uint8_t         open(char *name);
+                uint8_t         open(const char *name);
         virtual                 ~dmxAudioStream() ;                    
         virtual uint8_t         goTo(uint32_t offset);
         virtual uint32_t        read(uint32_t size,uint8_t *ptr);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -30,7 +30,7 @@
 #include &quot;ADM_audio/aviaudio.hxx&quot;
 
 #include &quot;fourcc.h&quot;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
@@ -178,7 +178,7 @@
 
 */
 #define MAX_LINE 4096
-uint8_t                 dmxHeader::open(char *name)
+uint8_t                 dmxHeader::open(const char *name)
 {
                 FILE *file;
         

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -42,7 +42,7 @@
 
 
 // AVI io
-        virtual         uint8_t                 open(char *name);
+        virtual         uint8_t                 open(const char *name);
         virtual         uint8_t                 close(void);
   //__________________________
   //                             Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -425,7 +425,7 @@
 
 
 */
-uint8_t    nuvHeader::open(char *name)
+uint8_t    nuvHeader::open(const char *name)
 {
 uint32_t a=0,v=0,t=0;
 uint32_t max=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_nuv/ADM_nuv.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -107,7 +107,7 @@
 					nuvHeader( void ) ;
 		   virtual  		~nuvHeader(  ) ;
 // AVI io
-virtual 	uint8_t			open(char *name);
+virtual 	uint8_t			open(const char *name);
 virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -155,7 +155,7 @@
 
 
 
-uint8_t oggHeader::open(char *name)
+uint8_t oggHeader::open(const char *name)
 {
 #ifdef ADM_BIG_ENDIAN
 	#define SWAP64(x) { uint64_t y=x;x=R32((y&gt;&gt;16)&gt;&gt;16)+((R32(y&amp;0x0ffffffff)&lt;&lt;16)&lt;&lt;16);}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogm.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -61,7 +61,7 @@
  			
 				
 		public:
-					oggAudio( char *name,OgAudioTrack *tracks,uint8_t trkidx );
+					oggAudio(const char *name,OgAudioTrack *tracks,uint8_t trkidx );
 			virtual 	~oggAudio() ;
 			virtual uint8_t goTo(uint32_t offset);
 			virtual uint32_t read(uint32_t size,uint8_t *ptr);
@@ -101,7 +101,7 @@
 					oggHeader( void ) ;
 		   virtual  		~oggHeader(  ) ;
 // AVI io
-virtual 	uint8_t			open(char *name);
+virtual 	uint8_t			open(const char *name);
 virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmAudio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmAudio.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmAudio.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -50,7 +50,7 @@
 
 }
 
-oggAudio::oggAudio( char *name,OgAudioTrack *tracks,uint8_t trkidx )
+oggAudio::oggAudio(const char *name,OgAudioTrack *tracks,uint8_t trkidx )
 {
 uint64_t f;
 	_tracks=tracks;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -40,7 +40,7 @@
 
 }
 
-uint8_t OGMDemuxer::open(char *name)
+uint8_t OGMDemuxer::open(const char *name)
 {
 		_fd=fopen(name,&quot;rb&quot;);
 		if(!_fd) return 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -36,7 +36,7 @@
 						OGMDemuxer(void);
 						~OGMDemuxer();
 			uint8_t		dumpHeaders(uint8_t *ptr,uint32_t *size);
-			uint8_t 		open(char *file);			
+			uint8_t 		open(const char *file);			
 			uint8_t		setPos( uint64_t pos );
 			uint8_t		readHeader(uint32_t *paySize, uint32_t *flag,uint64_t *frame,
 							uint8_t *id);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -190,7 +190,7 @@
 // Open and get the headears/index built
 // along way
 //______________________________________
-uint8_t    OpenDMLHeader::open(char *name)
+uint8_t    OpenDMLHeader::open(const char *name)
 {
 uint8_t badAvi=0;
 uint32_t rd;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -123,7 +123,7 @@
 					OpenDMLHeader( void ) ;
        		    			~OpenDMLHeader(  ) ;
 // AVI io
-virtual 	uint8_t			open(char *name);
+virtual 	uint8_t			open(const char *name);
 virtual 	uint8_t			close(void) ;
   //__________________________
   //				 Info

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -78,7 +78,7 @@
 		
 	}
 }
-riffParser::riffParser(char *name)
+riffParser::riffParser(const char *name)
 {
 	ADM_assert(fd=fopen(name,&quot;rb&quot;));
 	startPos=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_riff.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -9,7 +9,7 @@
 	uint64_t curPos;
 	uint8_t  _root;
 
-	riffParser(char *name);
+	riffParser(const char *name);
 	riffParser(riffParser *o, uint32_t size);
 	~riffParser();
 	uint64_t getPos( void );

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/ad_layer.cc
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/ad_layer.cc	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/ad_layer.cc	2008-06-16 11:54:28 UTC (rev 4104)
@@ -36,4 +36,4 @@
 	}
 	nb_alloc=0;
 
-}
\ No newline at end of file
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/synchrolib.cc
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/synchrolib.cc	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/synchrolib.cc	2008-06-16 11:54:28 UTC (rev 4104)
@@ -25,4 +25,4 @@
    work properly if the same thread does the locking and unlocking. Gaah!
  */
 
-// MEANX : removed, not used &amp; cause problem on cygwin
\ No newline at end of file
+// MEANX : removed, not used &amp; cause problem on cygwin

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -9,9 +9,9 @@
 {
 #ifdef USE_LATE_BINDING
 #ifdef ADM_WIN32
-	char* libname = &quot;libamrnb-2.dll&quot;;
+	const char* libname = &quot;libamrnb-2.dll&quot;;
 #else
-	char* libname = &quot;libamrnb-2.so&quot;;	// ???
+	const char* libname = &quot;libamrnb-2.so&quot;;	// ???
 #endif
 
 	initialised = (loadLibrary(libname) &amp;&amp; getSymbols(6, 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -9,9 +9,9 @@
 {
 #ifdef USE_LATE_BINDING
 #ifdef ADM_WIN32
-	char* libname = &quot;libdts.dll&quot;;
+	const char* libname = &quot;libdts.dll&quot;;
 #else
-	char* libname = &quot;libdts.so&quot;;	// ???
+	const char* libname = &quot;libdts.so&quot;;	// ???
 #endif
 
 	initialised = (loadLibrary(libname) &amp;&amp; getSymbols(7, 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/aviio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/aviio.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/aviio.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1 +1 @@
-// RMED
\ No newline at end of file
+// RMED

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -406,7 +406,7 @@
 void saveCrashProject(void)
 {
   char *baseDir=ADM_getBaseDir();
-  char *name=CRASH_FILE;
+  const char *name=CRASH_FILE;
   static int crashCount=0;
   if(crashCount) return ; // avoid endless looping
   crashCount++;
@@ -426,7 +426,7 @@
 void checkCrashFile(void)
 {
   char *baseDir=ADM_getBaseDir();
-  char *name=CRASH_FILE;
+  const char *name=CRASH_FILE;
   static int crashCount=0;
   char *where=new char[strlen(baseDir)+strlen(name)+2];
   strcpy(where,baseDir);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_fileio.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_fileio.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -375,7 +375,7 @@
 	Split patch into absolute path+name and extention
 
 */
-void PathSplit(char *str, char **root, char **ext)
+void PathSplit(const char *str, char **root, char **ext)
 {
 	char *full;
 	uint32_t l;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memcpy.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memcpy.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -388,7 +388,7 @@
 #endif /* ARCH_X86 */
 
 static struct {
-  char *name;
+  const char *name;
   void *(* function)(void *to, const void *from, size_t len);
 
   uint64_t time; /* This type could be used for non-MSC build too! */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -263,7 +263,7 @@
     This function convert the later to the former
 
 */
-extern char *slashToBackSlash(char *in)
+extern char *slashToBackSlash(const char *in)
 {
     char *out,*cout;
     int n;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.h	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.h	2008-06-16 11:54:28 UTC (rev 4104)
@@ -30,7 +30,7 @@
   uint32_t hours,minutes,seconds; 
 } ADM_date;
 void            TLK_getDate(ADM_date *date);
-void            PathSplit(char *str, char **root, char **ext);
+void            PathSplit(const char *str, char **root, char **ext);
 void	        PathStripName(char *str);
 const char      *GetFileName(const char *str);
 char            *PathCanonize(const char *tmpname);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1033,7 +1033,7 @@
 	}
 	return true;
 }
-void aviWrite::odml_write_sindex(int stream_nbr, char* stream_fcc)
+void aviWrite::odml_write_sindex(int stream_nbr, const char* stream_fcc)
 {
         
 	// Warning: This changes the file position
@@ -1086,7 +1086,7 @@
                 
 	}	
 }
-bool aviWrite::odml_write_index(int stream_nbr, char* stream_fcc, char* index_fcc){	// write index
+bool aviWrite::odml_write_index(int stream_nbr, const char* stream_fcc, const char* index_fcc){	// write index
 	// Warning: This changes the file position
 	if(doODML==NORMAL){
 		aprintf (&quot;\n writing %lu interleaved ODML indexes for %lu frames in stream %s&quot;, odml_indexes[stream_nbr].index_count+1, vframe, stream_fcc);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.hxx	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.hxx	2008-06-16 11:54:28 UTC (rev 4104)
@@ -94,8 +94,8 @@
 	void odml_destroy_index(void);	// deallocate index data structures
 	void odml_write_dummy_chunk(AviList* alist, uint64_t* fpos, uint32_t size);	// write a dummy chunk and get its file position
 	bool odml_index_frame(int stream_nbr, uint32_t data_size, bool keyFrame);	//index one data chunk
-	void odml_write_sindex(int stream_nbr, char* stream_fcc);	// write super index
-	bool odml_write_index(int stream_nbr, char* stream_fcc, char* index_fcc);	// write index
+	void odml_write_sindex(int stream_nbr, const char* stream_fcc);	// write super index
+	bool odml_write_index(int stream_nbr, const char* stream_fcc, const char* index_fcc);	// write index
 	void odml_riff_break(uint32_t len);	// advance to the next riff if required; len = chunk size to be written (incl. 4cc and size info) without padding
 	// END MOD Feb 2005 by GMV
         void reallocIndeces( odml_super_index_t *idx);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -30,13 +30,12 @@
 
 #include &quot;ADM_script/ADM_container.h&quot;
 
-extern VF_FILTERS filterGetTagFromName(char *inname);
 //extern uint8_t indexMpeg(char *mpeg,char *file,uint8_t aid);
 extern uint8_t A_ListAllBlackFrames( char *file );
-extern uint8_t loadVideoCodecConfString( char *name);
+extern uint8_t loadVideoCodecConfString( const char *name);
 extern uint8_t ADM_saveRaw (const char *name);
 extern int A_saveJpg (char *name);
-extern uint8_t loadVideoCodecConf( char *name);
+extern uint8_t loadVideoCodecConf( const char *name);
 extern int videoCodecConfigure(char *p,uint32_t i, uint8_t  *c);
 
 extern void filterCleanUp( void );

Modified: branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -48,7 +48,7 @@
 
 extern void filterListAll(void );
 
-extern uint8_t loadVideoCodecConf( char *name);
+extern uint8_t loadVideoCodecConf( const char *name);
 extern int A_saveJpg (char *name);
 extern void filterLoadXml(char *n);
 extern int A_openAvi(char *name);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -57,7 +57,7 @@
 //	Video is in YV12 Colorspace
 //
 //
-int DIA_getCropParams(char *name, CROP_PARAMS *param, AVDMGenericVideoStream *in)
+int DIA_getCropParams(const char *name, CROP_PARAMS *param, AVDMGenericVideoStream *in)
 {
 	uint32_t width, height;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -55,7 +55,7 @@
 int SliderIsShifted = 0;
 
 int DIA_coloryuv(COLOR_YUV_PARAM *param) {return 0;}
-int DIA_getCropParams(  char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in) {return 0;}
+int DIA_getCropParams(const char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in) {return 0;}
 
 #ifdef USE_XX_XVID 
 #include &quot;xvid.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -32,4 +32,4 @@
 uint8_t UI_getPhysicalScreenSize(void *window, uint32_t *w,uint32_t *h)
 {
   *w=*h=10000; 
-}
\ No newline at end of file
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -193,7 +193,7 @@
       \fn     DIA_getCropParams
       \brief  Handle crop dialog
 */
-int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in)
+int DIA_getCropParams(const char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in)
 {
         uint8_t ret=0;
         

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -186,13 +186,13 @@
 			return 1;
 
 }
-extern int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in);
+extern int DIA_getCropParams(const char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in);
 uint8_t AVDMVideoStreamCrop::configure( AVDMGenericVideoStream *instream)
 
 {
 		uint8_t r;
 		uint32_t w,h;
-    	if(r = (DIA_getCropParams(&quot;Crop Settings&quot;,_param,instream )))
+    	if(r = (DIA_getCropParams(QT_TR_NOOP(&quot;Crop Settings&quot;),_param,instream )))
     	{
 			w=_param-&gt;left+_param-&gt;right;
 			h=_param-&gt;top+_param-&gt;bottom;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2008-06-16 11:54:28 UTC (rev 4104)
@@ -99,11 +99,11 @@
 {
 SCRIPT_CREATE(FILTER_create_fromscript,ADMVideoYadif,yadifParam);
 BUILD_CREATE(FILTER_create,ADMVideoYadif);
-char *FILTER_getName(void)
+const char *FILTER_getName(void)
 {
 	return &quot;DynYadif&quot;;
 }
-char *FILTER_getDesc(void)
+const char *FILTER_getDesc(void)
 {
 	return &quot;YADIF&quot;;
 }

Modified: branches/avidemux_2.4_branch/avidemux/xpm/avidemux_icon.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/avidemux_icon.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/avidemux_icon.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * avidemux_icon_xpm[] = {
+static const char * avidemux_icon_xpm[] = {
 &quot;64 64 824 2&quot;,
 &quot;  	c None&quot;,
 &quot;. 	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/begin.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/begin.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/begin.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-const char * xpm_begin[] = {
+static const char * xpm_begin[] = {
 &quot;32 20 56 1&quot;,
 &quot; 	c None&quot;,
 &quot;.	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/end.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/end.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/end.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-const char * xpm_end[] = {
+static const char * xpm_end[] = {
 &quot;32 20 55 1&quot;,
 &quot; 	c None&quot;,
 &quot;.	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * gnome_calculator_xpm[] = {
+static const char * gnome_calculator_xpm[] = {
 &quot;24 24 175 2&quot;,
 &quot;  	c None&quot;,
 &quot;. 	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator_small.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator_small.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/gnome-calculator_small.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * gnome_calculator_small_xpm[] = {
+static const char * gnome_calculator_small_xpm[] = {
 &quot;16 16 94 2&quot;,
 &quot;  	c None&quot;,
 &quot;. 	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/stop.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/stop.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/stop.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * xpm_stop[] = {
+static const char * xpm_stop[] = {
 &quot;32 20 30 1&quot;,
 &quot; 	c None&quot;,
 &quot;.	c #000000&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/systray.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/systray.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/systray.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * systray_xpm[] = {
+static const char * systray_xpm[] = {
 &quot;22 23 288 2&quot;,
 &quot;  	c None&quot;,
 &quot;. 	c #DDD4DC&quot;,

Modified: branches/avidemux_2.4_branch/avidemux/xpm/systray2.xpm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/xpm/systray2.xpm	2008-06-16 11:04:41 UTC (rev 4103)
+++ branches/avidemux_2.4_branch/avidemux/xpm/systray2.xpm	2008-06-16 11:54:28 UTC (rev 4104)
@@ -1,5 +1,5 @@
 /* XPM */
-static char * systray2_xpm[] = {
+static const char * systray2_xpm[] = {
 &quot;22 23 288 2&quot;,
 &quot;  	c None&quot;,
 &quot;. 	c #F2D8DF&quot;,


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001359.html">[Avidemux-svn-commit] r4103 - branches/avidemux_2.4_branch/po
</A></li>
	<LI>Next message: <A HREF="001361.html">[Avidemux-svn-commit] r4105 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_GTK/ADM_toolkit_gtk ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1360">[ date ]</a>
              <a href="thread.html#1360">[ thread ]</a>
              <a href="subject.html#1360">[ subject ]</a>
              <a href="author.html#1360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
