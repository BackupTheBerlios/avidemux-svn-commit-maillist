<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4105 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_GTK/ADM_toolkit_gtk ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4105%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_dialog%20ADM_GTK/ADM_toolkit_gtk%20ADM_commonUI&In-Reply-To=%3C200806161213.m5GCDugv003332%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001360.html">
   <LINK REL="Next"  HREF="001362.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4105 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_GTK/ADM_toolkit_gtk ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4105%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_dialog%20ADM_GTK/ADM_toolkit_gtk%20ADM_commonUI&In-Reply-To=%3C200806161213.m5GCDugv003332%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4105 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_GTK/ADM_toolkit_gtk ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Jun 16 14:13:56 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001360.html">[Avidemux-svn-commit] r4104 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec	ADM_audiofilter ADM_editor ADM_encoder ADM_filter	ADM_inputs/ADM_amv ADM_inputs/ADM_asf ADM_inputs/ADM_avsproxy	ADM_inputs/ADM_flv ADM_inputs/ADM_h263 ADM_inputs/ADM_inpics	ADM_inputs/ADM_matroska ADM_inputs/ADM_mp4	ADM_inputs/ADM_mpegdemuxer ADM_inputs/ADM_nuv	ADM_inputs/ADM_ogm ADM_inputs/ADM_openDML	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_libwrapper	ADM_libraries/ADM_utilities ADM_osSupport	ADM_outputs/oplug_avi ADM_script ADM_toolkit	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_videoFilter xpm
</A></li>
        <LI>Next message: <A HREF="001362.html">[Avidemux-svn-commit] r4106 - in branches/avidemux_2.4_branch: .	avidemux/ADM_audiocodec avidemux/ADM_libraries/ADM_lavcodec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1361">[ date ]</a>
              <a href="thread.html#1361">[ thread ]</a>
              <a href="subject.html#1361">[ subject ]</a>
              <a href="author.html#1361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-06-16 14:13:43 +0200 (Mon, 16 Jun 2008)
New Revision: 4105

Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtray_win32.c
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.c
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_tray_gtk.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/ADM_tray.h
Log:
[systray] use GTK+ for systray instead of libegg (FS#434)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2008-06-16 12:13:43 UTC (rev 4105)
@@ -107,20 +107,21 @@
 
         gtk_widget_show(dialog);
 
-        if(useTray)
-        {
-              gtk_window_iconify(GTK_WINDOW(dialog));
-              UI_iconify();
-        }
+		if (useTray)
+		{
+			gtk_window_iconify(GTK_WINDOW(dialog));
+			UI_iconify();
+			tray = new ADM_tray(dialog);
+		}
+		else
+			tray = NULL;
+
         _lastTime=0;
         _lastFrame=0;
         _fps_average=0;
-        tray=NULL;
         _total=1000;
-        if(useTray)
-                tray=new ADM_tray(&quot;Encoding&quot;);
+}
 
-}
 void DIA_encoding::setFps(uint32_t fps)
 {
         _roundup=(uint32_t )floor( (fps+999)/1000);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_tray_gtk.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_tray_gtk.cpp	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_tray_gtk.cpp	2008-06-16 12:13:43 UTC (rev 4105)
@@ -1,13 +1,11 @@
 /***************************************************************************
-                          adm_encdivx.cpp  -  description
-                             -------------------
+                              ADM_tray_gtk.cpp
+                              ----------------
+
     begin                : Sun Jul 14 2002
-    copyright            : (C) 2002 by mean
+    copyright            : (C) 2002 by mean/gruntster
     email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
 
-
-Derived from MLdonkey systray code
-<A HREF="http://savannah.nongnu.org/cvs/?group=mldonkey">http://savannah.nongnu.org/cvs/?group=mldonkey</A>
  ***************************************************************************/
 
 /***************************************************************************
@@ -24,81 +22,105 @@
 #include &lt;string.h&gt;
 #include &lt;stdio.h&gt;
 
-
-
 #include &quot;default.h&quot;
 #include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-#include &lt;ADM_assert.h&gt;
 #include &quot;ADM_tray.h&quot;
 #include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-extern &quot;C&quot;
+
+extern void UI_deiconify(void);
+
+static GdkPixbuf **pixbuf = NULL;
+static int lastIcon;
+
+static const char *animated[] = {
+	&quot;film1.png&quot;,&quot;film3.png&quot;,&quot;film5.png&quot;,&quot;film7.png&quot;,&quot;film9.png&quot;,
+	&quot;film11.png&quot;,&quot;film13.png&quot;,&quot;film15.png&quot;,&quot;film17.png&quot;,&quot;film19.png&quot;,
+	&quot;film21.png&quot;,&quot;film23.png&quot;};
+
+void tray_icon_on_click(GtkStatusIcon *status_icon, gpointer user_data)
 {
-#include &quot;systray.h&quot;
+	gtk_window_deiconify(GTK_WINDOW(user_data));
+	UI_deiconify();
 }
-static int nbTray=0;
-static  GdkPixbuf   **pixbuf=NULL;
 
-extern GdkPixbuf        *create_pixbuf                  (const gchar     *filename);
-/*
-class ADM_tray
+static void tray_menu_open_avidemux(GtkStatusIcon *status_icon, gpointer user_data)
 {
-protected:
+	gtk_window_deiconify(GTK_WINDOW(user_data));
+	UI_deiconify();
+}
 
-public:
-        ADM_tray(char *name);
-        ~ADM_tray();
-        setPercent(int percent);
-        setStatus(int working);
+static void tray_icon_popup_menu(GtkStatusIcon *status_icon, guint button, guint activate_time, gpointer user_data)
+{
+	GtkWidget *popupMenu = gtk_menu_new();
+	GtkWidget *item = gtk_menu_item_new_with_label(QT_TR_NOOP(&quot;Open Avidemux&quot;));
 
-};*/
-static char *animated[]={
-    &quot;film1.png&quot;,&quot;film3.png&quot;,&quot;film5.png&quot;,&quot;film7.png&quot;,&quot;film9.png&quot;,
-    &quot;film11.png&quot;,&quot;film13.png&quot;,&quot;film15.png&quot;,&quot;film17.png&quot;,&quot;film19.png&quot;,
-    &quot;film21.png&quot;,&quot;film23.png&quot;};
-ADM_tray::ADM_tray(char *name)
+	gtk_menu_append(popupMenu, item);
+	g_signal_connect(G_OBJECT(item), &quot;activate&quot;, G_CALLBACK(tray_menu_open_avidemux), user_data);
+
+	gtk_widget_show_all(popupMenu);
+	gtk_menu_popup(GTK_MENU(popupMenu), NULL, NULL, gtk_status_icon_position_menu, status_icon, button, activate_time);
+}
+
+ADM_tray::ADM_tray(void* parent)
 {
-        ADM_assert(!nbTray);
-        nbTray++;
+	_parent = parent;
+	lastIcon = 0;
+	int nb = sizeof(animated) / sizeof(char *);
 
+	if (!pixbuf)
+	{
+		pixbuf = new GdkPixbuf*[nb];
 
-  int nb=sizeof(animated)/sizeof(char *);
-  if(!pixbuf)
-  {
-      pixbuf=new GdkPixbuf*[nb];
-      for(int i=0;i&lt;nb;i++)
-      {
-        pixbuf[i]=create_pixbuf(animated[i]);
-        if(!pixbuf[i])
-        {
-          printf(&quot;Failed to create &lt;%s&gt;\n&quot;,animated[i]);
-          ADM_assert(0);
-        }
-      }
+		for (int i = 0; i &lt; nb; i++)
+		{
+			pixbuf[i] = create_pixbuf(animated[i]);
 
-  }
-  sys=adm_new_systray(pixbuf,nb,name);
+			if (!pixbuf[i])
+			{
+				printf(&quot;Failed to create &lt;%s&gt;\n&quot;, animated[i]);
+				ADM_assert(0);
+			}
+		}
+	}
 
+	sys = gtk_status_icon_new_from_pixbuf(pixbuf[0]);
+
+	g_signal_connect(G_OBJECT(sys), &quot;activate&quot;, G_CALLBACK(tray_icon_on_click), _parent);
+	g_signal_connect(G_OBJECT(sys), &quot;popup-menu&quot;, G_CALLBACK(tray_icon_popup_menu), _parent);
+	gtk_status_icon_set_tooltip((GtkStatusIcon*)sys, &quot;Avidemux&quot;);
+	gtk_status_icon_set_visible((GtkStatusIcon*)sys, TRUE);
 }
+
 ADM_tray::~ADM_tray()
 {
-        nbTray--;
-        ADM_assert(!nbTray);
-        if(sys)
-                adm_delete_systray(sys);
-        sys=NULL;
+	if (sys)
+		gtk_status_icon_set_visible((GtkStatusIcon*)sys, FALSE);
+
+	sys = NULL;
 }
+
 uint8_t ADM_tray::setPercent(int percent)
 {
-char percentS[40];
-        sprintf(percentS,&quot;%d %%&quot;,percent);
-        if(sys)
-        {
-                adm_changeIcon_systray();
-                adm_change_tooltip(sys,percentS);
-        }
-        return 1;
+	char percentS[40];
+
+	sprintf(percentS, &quot;Avidemux [%d%%]&quot;, percent);
+
+	if (sys)
+	{
+		int maxIcons = sizeof(animated) / sizeof(char *);
+		lastIcon++;
+
+		if (lastIcon &gt;= maxIcons)
+			lastIcon = 0;
+
+		gtk_status_icon_set_from_pixbuf((GtkStatusIcon*)sys, pixbuf[lastIcon]);
+		gtk_status_icon_set_tooltip((GtkStatusIcon*)sys, percentS);
+	}
+
+	return 1;
 }
+
 uint8_t ADM_tray::setStatus(int working)
 {
-        return 1;
+	return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt	2008-06-16 12:13:43 UTC (rev 4105)
@@ -6,7 +6,7 @@
 #
 SET(${ADM_LIB}_SRCS
 ADM_gladeSupport.cpp  ADM_tray_gtk.cpp  choice.cpp  TLK_filesel.cpp  toolkit.cpp  toolkit_dialog.cpp 
-    eggtrayicon.c eggtray_win32.c gtkmarkscale.c jogshuttle.c ADM_jogshuttle.cpp  mediactrl.c
+    gtkmarkscale.c jogshuttle.c ADM_jogshuttle.cpp  mediactrl.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtray_win32.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtray_win32.c	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtray_win32.c	2008-06-16 12:13:43 UTC (rev 4105)
@@ -1,287 +0,0 @@
-/*
-    Borrowed from mldonkey
-*/
-/* Copyright 2004 b8_bavard, INRIA */
-/*
-    This file is part of mldonkey.
-
-    mldonkey is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    mldonkey is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with mldonkey; if not, write to the Free Software
-    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-/* Stub code to interface with Shell_NotifyIcon */
-#include &lt;config.h&gt;
-#ifdef ADM_WIN32
-#include &lt;windows.h&gt;
-#include &lt;wingdi.h&gt;
-
-#include &lt;gdk/gdk.h&gt; 
-#include &lt;gdk/gdkwin32.h&gt;
-#include &lt;gdk-pixbuf/gdk-pixbuf.h&gt;
-
-#include &lt;stdio.h&gt;
-#include &lt;systray.h&gt;
-#define WM_TRAYMESSAGE           WM_USER /* User defined WM Message */
-#define SYSTRAY_LBUTTONDBLCLK    0
-#define SYSTRAY_LBUTTONCLK       1
-#define SYSTRAY_RBUTTONCLK       2
-
-static UINT timerID = 3;
-static NOTIFYICONDATA nid;
-static HWND systray_hwnd=0;
-static HICON systray_hicon=0;
-static int  win32egg_nb=0;
-static GdkPixbuf **win32egg_pixbuf;
-static int flipflop=0;
-LRESULT msg_handler(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam)
-{
-  static UINT taskbarRestartMsg; /* static here means value is kept across multiple calls to this func */
-
-  switch(msg) {
-    case WM_CREATE:
-      taskbarRestartMsg = RegisterWindowMessage(&quot;TaskbarCreated&quot;);
-      break;
-
-    case WM_TIMER:
-        #if 0
-      KillTimer(hWnd, timerID);
-      call_caml_systray_clicked(SYSTRAY_LBUTTONCLK);
-      #endif
-      break;
-
-    case WM_DESTROY:
-      break;
-
-    case WM_TRAYMESSAGE:
-#if 0
-      switch (lParam) {
-        case WM_RBUTTONUP:
-          call_caml_systray_clicked(SYSTRAY_RBUTTONCLK);
-          break;
-
-        case WM_LBUTTONDBLCLK:
-          KillTimer(hWnd, timerID);
-          call_caml_systray_clicked(SYSTRAY_LBUTTONDBLCLK);
-          break;
-
-        case WM_LBUTTONDOWN:
-          SetTimer(hWnd, timerID, GetDoubleClickTime(), NULL);
-          break;
-
-      }
-#endif
-    default: 
-      if (msg == taskbarRestartMsg) {
-        /* explorer crashed and left us hanging... 
-           This will put the systray icon back in it's place, when it restarts */
-        Shell_NotifyIcon(NIM_ADD,&amp;nid);
-      }
-      break;
-
-  }/* end switch */
-
-  return DefWindowProc(hWnd, msg, wParam, lParam);
-
-} 
-/* Create hidden window to process systray messages */
-
-static HWND systray_create_hiddenwin(void)
-{
-
-  WNDCLASSEX wcex;
-  TCHAR wname[32];
-
-  strcpy(wname, &quot;Win&quot;);
-
-  wcex.cbSize = sizeof(WNDCLASSEX);
-
-  wcex.style = 0;
-  wcex.lpfnWndProc = (WNDPROC)msg_handler;
-  wcex.cbClsExtra = 0;
-  wcex.cbWndExtra = 0;
-  wcex.hInstance = GetModuleHandle(NULL);
-  wcex.hIcon = NULL;
-  wcex.hCursor = NULL,
-  wcex.hbrBackground = NULL;
-  wcex.lpszMenuName = NULL;
-  wcex.lpszClassName = wname;
-  wcex.hIconSm = NULL;
-
-  RegisterClassEx(&amp;wcex);
-
-  /* Create the window */
-  return (CreateWindow(wname, &quot;&quot;, 0, 0, 0, 0, 0, GetDesktopWindow(), NULL, GetModuleHandle(NULL), 0));
-}
-
-/* taken and modified from gdk/win32/gdkwindow-win32.c */
-
-HICON pixmap_to_hicon (GdkPixmap *pixmap, GdkBitmap *mask)
-{
-  ICONINFO ii;
-  HICON hIcon;
-  gint w = 0, h = 0;
-  HANDLE hpixmap = NULL;
-  HBITMAP hbitmap = NULL;
-
-  /* Create Drawing Context */
-  HDC hdc1 = NULL;
-  HBITMAP hbitmaptmp1 = NULL;
-
-    if (!pixmap) {
-      return NULL;
-    }
-
-    gdk_drawable_get_size (GDK_DRAWABLE (pixmap), &amp;w, &amp;h);
-
-    hpixmap = gdk_win32_drawable_get_handle (pixmap); 
-
-    /* we need the inverted mask for the XOR op */
-    hdc1 = CreateCompatibleDC (NULL);
-    hbitmap = CreateCompatibleBitmap (hdc1, w, h);
-    hbitmaptmp1 = SelectObject (hdc1, hbitmap);
-
-    if (mask) {
-      HANDLE hmask = NULL;
-      HDC hdc2 = NULL;
-      HBITMAP hbitmaptmp2 = NULL;
-
-      hmask = gdk_win32_drawable_get_handle (mask); 
-
-      hdc2 = CreateCompatibleDC (NULL);
-      hbitmaptmp2 = SelectObject (hdc2, hmask);
-
-      BitBlt (hdc1, 0,0,w,h, hdc2, 0,0, NOTSRCCOPY);    
-
-      SelectObject (hdc2, hbitmaptmp2);
-      DeleteDC (hdc2);
-    } else {
-      RECT rect;
-      GetClipBox (hdc1, &amp;rect);
-      FillRect (hdc1, &amp;rect, GetStockObject (WHITE_BRUSH));
-    }
-
-    SelectObject (hdc1, hbitmaptmp1); 
-    DeleteDC (hdc1); 
- 
-    ii.fIcon = TRUE;
-    ii.xHotspot = ii.yHotspot = 0; /* ignored for icons */
-    ii.hbmMask = hbitmap;
-    ii.hbmColor = hpixmap; 
-
-    hIcon = CreateIconIndirect (&amp;ii);
-    if (!hIcon) {
-      return NULL;
-    }
-
-    DeleteObject (hbitmap);
-
-    return hIcon;
-}
-
-NOTIFYICONDATA systray_init(GdkPixbuf *pixbuf,  char* text) 
-{
-  GdkPixmap *pm;
-  GdkBitmap *mask;
-
-  gdk_pixbuf_render_pixmap_and_mask(pixbuf, &amp;pm, &amp;mask, 128);
-
-  char* locenc=NULL;
-
-  ZeroMemory(&amp;nid,sizeof(nid));
-  systray_hicon = pixmap_to_hicon (pm, mask);
-  systray_hwnd = systray_create_hiddenwin();
-
-  nid.cbSize=sizeof(NOTIFYICONDATA);
-  nid.hWnd=systray_hwnd;
-  nid.uID=0;
-  nid.uFlags=NIF_ICON | NIF_MESSAGE | NIF_TIP ;
-  nid.uCallbackMessage=WM_TRAYMESSAGE;
-  nid.hIcon=systray_hicon;
-
-  if(text) {
-    locenc = g_locale_from_utf8(text, -1, NULL, NULL, NULL);
-    lstrcpy(nid.szTip, locenc);
-    g_free(locenc);
-  }
-
-  Shell_NotifyIcon(NIM_ADD,&amp;nid);
-  return nid;
-}
-
-void systray_modify_icon (GdkPixmap *pm, GdkBitmap *mask) 
-{
-
-  systray_hicon = pixmap_to_hicon (pm, mask);
-  nid.hIcon = systray_hicon;
-  Shell_NotifyIcon(NIM_MODIFY,&amp;nid);
-}
-
-void systray_modify_tooltip (const char* text) 
-{
-  char *locenc=NULL;
-
-  if(text) {
-    locenc = g_locale_from_utf8(text, -1, NULL, NULL, NULL);
-    lstrcpy(nid.szTip, locenc);
-    g_free(locenc);
-  }
-  Shell_NotifyIcon(NIM_MODIFY,&amp;nid);
-}
-
-void systray_remove_nid(void) 
-{
-  DestroyWindow(nid.hWnd);
-  Shell_NotifyIcon(NIM_DELETE,&amp;nid);
-}
-//*********************************************************
-//*********************************************************
-//*********************************************************
-void *adm_new_systray(GdkPixbuf *zpixbuf[],int nb, char *name)
-{
-void *r;
-	flipflop=0;
-	win32egg_pixbuf=zpixbuf;
-	win32egg_nb=nb;
-  systray_init(win32egg_pixbuf[0],  name);
-  r=(void *)0xdead;
-  return r;
-
-}
-void adm_delete_systray(void *systray)
-{
- systray_remove_nid() ;
-}
-void adm_change_tooltip(void *systray, const char *tips)
-{
-    systray_modify_tooltip (tips ) ;
-}
-void adm_changeIcon_systray(void)
-{
-  GdkPixmap *pm;
-  GdkBitmap *mask;
-  GdkPixbuf *icon;
-	flipflop=flipflop%win32egg_nb;
-	icon=win32egg_pixbuf[flipflop];
-	//ADM_assert(icon);
-
-  	gdk_pixbuf_render_pixmap_and_mask(icon, &amp;pm, &amp;mask, 128);
-
-
-	systray_modify_icon (pm, mask) ;
-
-		
-	flipflop++;
-	flipflop=flipflop%win32egg_nb;
-}
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.c	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.c	2008-06-16 12:13:43 UTC (rev 4105)
@@ -1,514 +0,0 @@
-/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */
-/* eggtrayicon.c
- * Copyright (C) 2002 Anders Carlsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">andersca at gnu.org</A>&gt;
- *
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the
- * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
- * Boston, MA 02111-1307, USA.
- */
-#include &quot;config.h&quot;
-#ifndef ADM_WIN32
-
-#include &lt;gtk/gtk.h&gt;
-#include &lt;gtk/gtkversion.h&gt;
-
-
-#include &quot;eggtrayicon.h&quot;
-#include &lt;string.h&gt;
-#include &quot;systray.h&quot;
-#include &quot;../ADM_assert.h&quot;
-#define SYSTEM_TRAY_REQUEST_DOCK    0
-#define SYSTEM_TRAY_BEGIN_MESSAGE   1
-#define SYSTEM_TRAY_CANCEL_MESSAGE  2
-
-#define SYSTEM_TRAY_ORIENTATION_HORZ 0
-#define SYSTEM_TRAY_ORIENTATION_VERT 1
-
-enum {
-  PROP_0,
-  PROP_ORIENTATION
-};
-         
-static GtkPlugClass *parent_class = NULL;
-
-static void egg_tray_icon_init (EggTrayIcon *icon);
-static void egg_tray_icon_class_init (EggTrayIconClass *klass);
-
-static void egg_tray_icon_get_property (GObject    *object,
-                                        guint       prop_id,
-                                        GValue     *value,
-                                        GParamSpec *pspec);
-
-static void egg_tray_icon_realize   (GtkWidget *widget);
-static void egg_tray_icon_unrealize (GtkWidget *widget);
-
-static void egg_tray_icon_update_manager_window (EggTrayIcon *icon);
-
-static GtkWidget   *img=NULL;
-
-static GdkPixbuf **listOfIcons=NULL;
-static int nbListOfIcons=0;
-static int flipflop=0;
-
-GType egg_tray_icon_get_type (void)
-{
-  static GType our_type = 0;
-
-  if (our_type == 0)
-    {
-      static const GTypeInfo our_info =
-      {
-	sizeof (EggTrayIconClass),
-	(GBaseInitFunc) NULL,
-	(GBaseFinalizeFunc) NULL,
-	(GClassInitFunc) egg_tray_icon_class_init,
-	NULL, /* class_finalize */
-	NULL, /* class_data */
-	sizeof (EggTrayIcon),
-	0,    /* n_preallocs */
-	(GInstanceInitFunc) egg_tray_icon_init
-      };
-
-      our_type = g_type_register_static (GTK_TYPE_PLUG, &quot;EggTrayIcon&quot;, &amp;our_info, 0);
-    }
-
-  return our_type;
-}
-
-static void egg_tray_icon_init (EggTrayIcon *icon)
-{
-  icon-&gt;stamp = 1;
-  icon-&gt;orientation = GTK_ORIENTATION_HORIZONTAL;
-  
-  gtk_widget_add_events (GTK_WIDGET (icon), GDK_PROPERTY_CHANGE_MASK);
-}
-
-static void egg_tray_icon_class_init (EggTrayIconClass *klass)
-{
-  GObjectClass *gobject_class = (GObjectClass *)klass;
-  GtkWidgetClass *widget_class = (GtkWidgetClass *)klass;
-
-  parent_class = g_type_class_peek_parent (klass);
-
-  gobject_class-&gt;get_property = egg_tray_icon_get_property;
-
-  widget_class-&gt;realize   = egg_tray_icon_realize;
-  widget_class-&gt;unrealize = egg_tray_icon_unrealize;
-
-  g_object_class_install_property (gobject_class,
-				   PROP_ORIENTATION,
-				   g_param_spec_enum (&quot;orientation&quot;,
-						      &quot;Orientation&quot;,
-						      &quot;The orientation of the tray.&quot;,
-						      GTK_TYPE_ORIENTATION,
-						      GTK_ORIENTATION_HORIZONTAL,
-						      G_PARAM_READABLE));
-}
-
-static void egg_tray_icon_get_property (GObject    *object,
-                            guint       prop_id,
-                            GValue     *value,
-                            GParamSpec *pspec)
-{
-  EggTrayIcon *icon = EGG_TRAY_ICON (object);
-
-  switch (prop_id)
-    {
-    case PROP_ORIENTATION:
-      g_value_set_enum (value, icon-&gt;orientation);
-      break;
-    default:
-      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
-      break;
-    }
-}
-
-static void egg_tray_icon_get_orientation_property (EggTrayIcon *icon)
-{
-  Display *xdisplay;
-  Atom type;
-  int format;
-	union {
-	  gulong *prop;
-		guchar *prop_ch;
-	} prop = { NULL };
-  gulong nitems;
-  gulong bytes_after;
-  int error, result;
-
-  g_assert (icon-&gt;manager_window != None);
-
-  xdisplay = GDK_DISPLAY_XDISPLAY (gtk_widget_get_display (GTK_WIDGET (icon)));
-
-  gdk_error_trap_push ();
-  type = None;
-  result = XGetWindowProperty (xdisplay,
-			       icon-&gt;manager_window,
-			       icon-&gt;orientation_atom,
-			       0, G_MAXLONG, FALSE,
-			       XA_CARDINAL,
-			       &amp;type, &amp;format, &amp;nitems,
-			       &amp;bytes_after, &amp;(prop.prop_ch));
-  error = gdk_error_trap_pop ();
-
-  if (error || result != Success)
-    return;
-
-  if (type == XA_CARDINAL)
-    {
-      GtkOrientation orientation;
-
-      orientation = (prop.prop [0] == SYSTEM_TRAY_ORIENTATION_HORZ) ?
-					GTK_ORIENTATION_HORIZONTAL :
-					GTK_ORIENTATION_VERTICAL;
-
-      if (icon-&gt;orientation != orientation)
-	{
-	  icon-&gt;orientation = orientation;
-
-	  g_object_notify (G_OBJECT (icon), &quot;orientation&quot;);
-	}
-    }
-
-  if (prop.prop)
-    XFree (prop.prop);
-}
-
-static GdkFilterReturn egg_tray_icon_manager_filter (GdkXEvent *xevent, GdkEvent *event, gpointer user_data)
-{
-  EggTrayIcon *icon = user_data;
-  XEvent *xev = (XEvent *)xevent;
-
-  if (xev-&gt;xany.type == ClientMessage &amp;&amp;
-      xev-&gt;xclient.message_type == icon-&gt;manager_atom &amp;&amp;
-      xev-&gt;xclient.data.l[1] == icon-&gt;selection_atom)
-    {
-      egg_tray_icon_update_manager_window (icon);
-    }
-  else if (xev-&gt;xany.window == icon-&gt;manager_window)
-    {
-      if (xev-&gt;xany.type == PropertyNotify &amp;&amp;
-	  xev-&gt;xproperty.atom == icon-&gt;orientation_atom)
-	{
-	  egg_tray_icon_get_orientation_property (icon);
-	}
-      if (xev-&gt;xany.type == DestroyNotify)
-	{
-	  egg_tray_icon_update_manager_window (icon);
-	}
-    }
-  
-  return GDK_FILTER_CONTINUE;
-}
-
-static void egg_tray_icon_unrealize (GtkWidget *widget)
-{
-  EggTrayIcon *icon = EGG_TRAY_ICON (widget);
-  GdkWindow *root_window;
-
-  if (icon-&gt;manager_window != None)
-    {
-      GdkWindow *gdkwin;
-
-      gdkwin = gdk_window_lookup_for_display (gtk_widget_get_display (widget),
-                                              icon-&gt;manager_window);
-
-      gdk_window_remove_filter (gdkwin, egg_tray_icon_manager_filter, icon);
-    }
-
-  root_window = gdk_screen_get_root_window (gtk_widget_get_screen (widget));
-
-  gdk_window_remove_filter (root_window, egg_tray_icon_manager_filter, icon);
-
-  if (GTK_WIDGET_CLASS (parent_class)-&gt;unrealize)
-    (* GTK_WIDGET_CLASS (parent_class)-&gt;unrealize) (widget);
-}
-
-static void egg_tray_icon_send_manager_message (EggTrayIcon *icon,
-				    long         message,
-				    Window       window,
-				    long         data1,
-				    long         data2,
-				    long         data3)
-{
-  XClientMessageEvent ev;
-  Display *display;
-  
-  ev.type = ClientMessage;
-  ev.window = window;
-  ev.message_type = icon-&gt;system_tray_opcode_atom;
-  ev.format = 32;
-  ev.data.l[0] = gdk_x11_get_server_time (GTK_WIDGET (icon)-&gt;window);
-  ev.data.l[1] = message;
-  ev.data.l[2] = data1;
-  ev.data.l[3] = data2;
-  ev.data.l[4] = data3;
-
-  display = GDK_DISPLAY_XDISPLAY (gtk_widget_get_display (GTK_WIDGET (icon)));
-  
-  gdk_error_trap_push ();
-  XSendEvent (display,
-	      icon-&gt;manager_window, False, NoEventMask, (XEvent *)&amp;ev);
-  XSync (display, False);
-  gdk_error_trap_pop ();
-}
-
-static void egg_tray_icon_send_dock_request (EggTrayIcon *icon)
-{
-  egg_tray_icon_send_manager_message (icon,
-				      SYSTEM_TRAY_REQUEST_DOCK,
-				      icon-&gt;manager_window,
-				      gtk_plug_get_id (GTK_PLUG (icon)),
-				      0, 0);
-}
-
-static void egg_tray_icon_update_manager_window (EggTrayIcon *icon)
-{
-  Display *xdisplay;
-
-  xdisplay = GDK_DISPLAY_XDISPLAY (gtk_widget_get_display (GTK_WIDGET (icon)));
-  
-  if (icon-&gt;manager_window != None)
-    {
-      GdkWindow *gdkwin;
-
-      gdkwin = gdk_window_lookup_for_display (gtk_widget_get_display (GTK_WIDGET (icon)),
-					      icon-&gt;manager_window);
-      
-      gdk_window_remove_filter (gdkwin, egg_tray_icon_manager_filter, icon);
-    }
-  
-  XGrabServer (xdisplay);
-  
-  icon-&gt;manager_window = XGetSelectionOwner (xdisplay,
-					     icon-&gt;selection_atom);
-
-  if (icon-&gt;manager_window != None)
-    XSelectInput (xdisplay,
-		  icon-&gt;manager_window, StructureNotifyMask|PropertyChangeMask);
-
-  XUngrabServer (xdisplay);
-  XFlush (xdisplay);
-  
-  if (icon-&gt;manager_window != None)
-    {
-      GdkWindow *gdkwin;
-
-      gdkwin = gdk_window_lookup_for_display (gtk_widget_get_display (GTK_WIDGET (icon)),
-					      icon-&gt;manager_window);
-      
-      gdk_window_add_filter (gdkwin, egg_tray_icon_manager_filter, icon);
-
-      /* Send a request that we'd like to dock */
-      egg_tray_icon_send_dock_request (icon);
-
-      egg_tray_icon_get_orientation_property (icon);
-    }
-}
-
-static void egg_tray_icon_realize (GtkWidget *widget)
-{
-  EggTrayIcon *icon = EGG_TRAY_ICON (widget);
-  GdkScreen *screen;
-  GdkDisplay *display;
-  Display *xdisplay;
-  char buffer[256];
-  GdkWindow *root_window;
-
-  if (GTK_WIDGET_CLASS (parent_class)-&gt;realize)
-    GTK_WIDGET_CLASS (parent_class)-&gt;realize (widget);
-
-  screen = gtk_widget_get_screen (widget);
-  display = gdk_screen_get_display (screen);
-  xdisplay = gdk_x11_display_get_xdisplay (display);
-
-  /* Now see if there's a manager window around */
-  g_snprintf (buffer, sizeof (buffer),
-	      &quot;_NET_SYSTEM_TRAY_S%d&quot;,
-	      gdk_screen_get_number (screen));
-
-  icon-&gt;selection_atom = XInternAtom (xdisplay, buffer, False);
-  
-  icon-&gt;manager_atom = XInternAtom (xdisplay, &quot;MANAGER&quot;, False);
-  
-  icon-&gt;system_tray_opcode_atom = XInternAtom (xdisplay,
-						   &quot;_NET_SYSTEM_TRAY_OPCODE&quot;,
-						   False);
-
-  icon-&gt;orientation_atom = XInternAtom (xdisplay,
-					&quot;_NET_SYSTEM_TRAY_ORIENTATION&quot;,
-					False);
-
-  egg_tray_icon_update_manager_window (icon);
-
-  root_window = gdk_screen_get_root_window (screen);
-
-  /* Add a root window filter so that we get changes on MANAGER */
-  gdk_window_add_filter (root_window,
-			 egg_tray_icon_manager_filter, icon);
-}
-
-EggTrayIcon *egg_tray_icon_new_for_xscreen (Screen *xscreen, const char *name)
-{
-  GdkDisplay *display;
-  GdkScreen *screen;
-
-  display = gdk_x11_lookup_xdisplay (DisplayOfScreen (xscreen));
-  screen = gdk_display_get_screen (display, XScreenNumberOfScreen (xscreen));
-
-  return egg_tray_icon_new_for_screen (screen, name);
-}
-
-EggTrayIcon *egg_tray_icon_new_for_screen (GdkScreen *screen, const char *name)
-{
-  g_return_val_if_fail (GDK_IS_SCREEN (screen), NULL);
-
-  return g_object_new (EGG_TYPE_TRAY_ICON, &quot;screen&quot;, screen, &quot;title&quot;, name, NULL);
-}
-
-EggTrayIcon *egg_tray_icon_new (const gchar *name)
-{
-  return g_object_new (EGG_TYPE_TRAY_ICON, &quot;title&quot;, name, NULL);
-}
-
-guint egg_tray_icon_send_message (EggTrayIcon *icon,
-			    gint         timeout,
-			    const gchar *message,
-			    gint         len)
-{
-  guint stamp;
-  
-  g_return_val_if_fail (EGG_IS_TRAY_ICON (icon), 0);
-  g_return_val_if_fail (timeout &gt;= 0, 0);
-  g_return_val_if_fail (message != NULL, 0);
-		     
-  if (icon-&gt;manager_window == None)
-    return 0;
-
-  if (len &lt; 0)
-    len = strlen (message);
-
-  stamp = icon-&gt;stamp++;
-  
-  /* Get ready to send the message */
-  egg_tray_icon_send_manager_message (icon, SYSTEM_TRAY_BEGIN_MESSAGE,
-				      (Window)gtk_plug_get_id (GTK_PLUG (icon)),
-				      timeout, len, stamp);
-
-  /* Now to send the actual message */
-  gdk_error_trap_push ();
-  while (len &gt; 0)
-    {
-      XClientMessageEvent ev;
-      Display *xdisplay;
-
-      xdisplay = GDK_DISPLAY_XDISPLAY (gtk_widget_get_display (GTK_WIDGET (icon)));
-      
-      ev.type = ClientMessage;
-      ev.window = (Window)gtk_plug_get_id (GTK_PLUG (icon));
-      ev.format = 8;
-      ev.message_type = XInternAtom (xdisplay,
-				     &quot;_NET_SYSTEM_TRAY_MESSAGE_DATA&quot;, False);
-      if (len &gt; 20)
-	{
-	  memcpy (&amp;ev.data, message, 20);
-	  len -= 20;
-	  message += 20;
-	}
-      else
-	{
-	  memcpy (&amp;ev.data, message, len);
-	  len = 0;
-	}
-
-      XSendEvent (xdisplay,
-		  icon-&gt;manager_window, False, StructureNotifyMask, (XEvent *)&amp;ev);
-      XSync (xdisplay, False);
-    }
-  gdk_error_trap_pop ();
-
-  return stamp;
-}
-
-void egg_tray_icon_cancel_message (EggTrayIcon *icon,
-			      guint        id)
-{
-  g_return_if_fail (EGG_IS_TRAY_ICON (icon));
-  g_return_if_fail (id &gt; 0);
-  
-  egg_tray_icon_send_manager_message (icon, SYSTEM_TRAY_CANCEL_MESSAGE,
-				      (Window)gtk_plug_get_id (GTK_PLUG (icon)),
-				      id, 0, 0);
-}
-
-GtkOrientation egg_tray_icon_get_orientation (EggTrayIcon *icon)
-{
-  g_return_val_if_fail (EGG_IS_TRAY_ICON (icon), GTK_ORIENTATION_HORIZONTAL);
-
-  return icon-&gt;orientation;
-}
-/**************************************************************/
-static GtkWidget   *systray_icon = NULL;
-static GtkWidget   *evbox = NULL;
-static GtkTooltips *systray_icon_tooltips = NULL;
-
-void *adm_new_systray(GdkPixbuf *pixbufA[],int nb , char *name)
-{
-	flipflop=0;
-  systray_icon = GTK_WIDGET (egg_tray_icon_new (&quot;Avidemux&quot;));
-  nbListOfIcons=nb;
-  if(listOfIcons) ADM_dealloc(listOfIcons);
-  listOfIcons=NULL;
-  listOfIcons=ADM_alloc(sizeof( GdkPixbuf *)*nb);
-  memcpy(listOfIcons,pixbufA,sizeof(GdkPixbuf *)*nb);
-  img = gtk_image_new_from_pixbuf (listOfIcons[0]);
-  
-
-  evbox = gtk_event_box_new ();
-  gtk_container_add (GTK_CONTAINER (systray_icon), evbox);
-  gtk_container_add (GTK_CONTAINER (evbox), img);
-  gtk_widget_show_all (systray_icon);
-  gtk_widget_realize (systray_icon);
-  gtk_widget_show (systray_icon);
-
-  systray_icon_tooltips = gtk_tooltips_new ();
-  gtk_tooltips_enable (systray_icon_tooltips);
-
-  gtk_tooltips_set_tip (systray_icon_tooltips, systray_icon, &quot;avidemux&quot;, &quot;&quot;);
-  return (void *)systray_icon;
-}
-void adm_delete_systray(void *systray)
-{
- ADM_assert( (void*)systray_icon==systray);
- gtk_widget_destroy(systray_icon);
-}
-void adm_change_tooltip(void *systray, const char *tips)
-{
- ADM_assert( (void*)systray_icon==systray);
- gtk_tooltips_set_tip (systray_icon_tooltips, systray_icon, tips, &quot;&quot;);
-}
-void adm_changeIcon_systray(void)
-{
-GdkPixbuf *cur;
-	flipflop%=nbListOfIcons; // Double check
-	cur=listOfIcons[flipflop];
-		ADM_assert(cur);
-	flipflop++;
-	flipflop%=nbListOfIcons; // Double check
-  	gtk_image_set_from_pixbuf( GTK_IMAGE(img), GDK_PIXBUF(cur));
-
-}
-#endif   /* not defined GUI_DISABLE_SYSTRAY */
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.h	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/eggtrayicon.h	2008-06-16 12:13:43 UTC (rev 4105)
@@ -1,82 +0,0 @@
-/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */
-/* eggtrayicon.h
- * Copyright (C) 2002 Anders Carlsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">andersca at gnu.org</A>&gt;
- *
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the
- * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
- * Boston, MA 02111-1307, USA.
- */
-
-#ifndef __EGG_TRAY_ICON_H__
-#define __EGG_TRAY_ICON_H__
-
-#include &lt;gtk/gtkplug.h&gt;
-#include &lt;gdk/gdkx.h&gt;
-#include &lt;X11/Xatom.h&gt;
-
-G_BEGIN_DECLS
-
-#define EGG_TYPE_TRAY_ICON		(egg_tray_icon_get_type ())
-#define EGG_TRAY_ICON(obj)		(G_TYPE_CHECK_INSTANCE_CAST ((obj), EGG_TYPE_TRAY_ICON, EggTrayIcon))
-#define EGG_TRAY_ICON_CLASS(klass)	(G_TYPE_CHECK_CLASS_CAST ((klass), EGG_TYPE_TRAY_ICON, EggTrayIconClass))
-#define EGG_IS_TRAY_ICON(obj)		(G_TYPE_CHECK_INSTANCE_TYPE ((obj), EGG_TYPE_TRAY_ICON))
-#define EGG_IS_TRAY_ICON_CLASS(klass)	(G_TYPE_CHECK_CLASS_TYPE ((klass), EGG_TYPE_TRAY_ICON))
-#define EGG_TRAY_ICON_GET_CLASS(obj)	(G_TYPE_INSTANCE_GET_CLASS ((obj), EGG_TYPE_TRAY_ICON, EggTrayIconClass))
-
-typedef struct _EggTrayIcon	  EggTrayIcon;
-typedef struct _EggTrayIconClass  EggTrayIconClass;
-
-struct _EggTrayIcon
-{
-  GtkPlug parent_instance;
-
-  guint stamp;
-
-  Atom selection_atom;
-  Atom manager_atom;
-  Atom system_tray_opcode_atom;
-  Atom orientation_atom;
-  Window manager_window;
-
-  GtkOrientation orientation;
-};
-
-struct _EggTrayIconClass
-{
-  GtkPlugClass parent_class;
-};
-
-
-GType        egg_tray_icon_get_type       (void);
-
-EggTrayIcon *egg_tray_icon_new_for_screen (GdkScreen   *screen,
-					   const gchar *name);
-
-
-
-guint        egg_tray_icon_send_message   (EggTrayIcon *icon,
-					   gint         timeout,
-					   const char  *message,
-					   gint         len);
-void         egg_tray_icon_cancel_message (EggTrayIcon *icon,
-					   guint        id);
-
-GtkOrientation egg_tray_icon_get_orientation (EggTrayIcon *icon);
-
-EggTrayIcon *egg_tray_icon_new            (const gchar *name);
-
-G_END_DECLS
-#endif /* __EGG_TRAY_ICON_H__ */
-
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/ADM_tray.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/ADM_tray.h	2008-06-16 11:54:28 UTC (rev 4104)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/ADM_tray.h	2008-06-16 12:13:43 UTC (rev 4105)
@@ -22,8 +22,9 @@
 {
 protected:
         void    *sys;
+		void *_parent;
 public:
-                ADM_tray(char *name);
+                ADM_tray(void *parent);
                 ~ADM_tray();
         uint8_t setPercent(int percent);
         uint8_t setStatus(int working);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001360.html">[Avidemux-svn-commit] r4104 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec	ADM_audiofilter ADM_editor ADM_encoder ADM_filter	ADM_inputs/ADM_amv ADM_inputs/ADM_asf ADM_inputs/ADM_avsproxy	ADM_inputs/ADM_flv ADM_inputs/ADM_h263 ADM_inputs/ADM_inpics	ADM_inputs/ADM_matroska ADM_inputs/ADM_mp4	ADM_inputs/ADM_mpegdemuxer ADM_inputs/ADM_nuv	ADM_inputs/ADM_ogm ADM_inputs/ADM_openDML	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_libwrapper	ADM_libraries/ADM_utilities ADM_osSupport	ADM_outputs/oplug_avi ADM_script ADM_toolkit	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_videoFilter xpm
</A></li>
	<LI>Next message: <A HREF="001362.html">[Avidemux-svn-commit] r4106 - in branches/avidemux_2.4_branch: .	avidemux/ADM_audiocodec avidemux/ADM_libraries/ADM_lavcodec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1361">[ date ]</a>
              <a href="thread.html#1361">[ thread ]</a>
              <a href="subject.html#1361">[ subject ]</a>
              <a href="author.html#1361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
