<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5488 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_script avidemux/common/ADM_toolkit	avidemux/common/ADM_videoEncoder	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreVideoEncoder/include	avidemux_plugins/ADM_videoEncoder/huff
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5488%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common%20avidemux/common/ADM_editor%0A%09avidemux/common/ADM_script%20avidemux/common/ADM_toolkit%0A%09avidemux/common/ADM_videoEncoder%0A%09avidemux/common/ADM_videoEncoder/include%0A%09avidemux/common/ADM_videoEncoder/src%0A%09avidemux_core/ADM_coreVideoEncoder/include%0A%09avidemux_plugins/ADM_videoEncoder/huff&In-Reply-To=%3C200911131729.nADHTiMi027051%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002698.html">
   <LINK REL="Next"  HREF="002700.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5488 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_script avidemux/common/ADM_toolkit	avidemux/common/ADM_videoEncoder	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreVideoEncoder/include	avidemux_plugins/ADM_videoEncoder/huff</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5488%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common%20avidemux/common/ADM_editor%0A%09avidemux/common/ADM_script%20avidemux/common/ADM_toolkit%0A%09avidemux/common/ADM_videoEncoder%0A%09avidemux/common/ADM_videoEncoder/include%0A%09avidemux/common/ADM_videoEncoder/src%0A%09avidemux_core/ADM_coreVideoEncoder/include%0A%09avidemux_plugins/ADM_videoEncoder/huff&In-Reply-To=%3C200911131729.nADHTiMi027051%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5488 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_editor	avidemux/common/ADM_script avidemux/common/ADM_toolkit	avidemux/common/ADM_videoEncoder	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreVideoEncoder/include	avidemux_plugins/ADM_videoEncoder/huff">mean at mail.berlios.de
       </A><BR>
    <I>Fri Nov 13 18:29:44 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002698.html">[Avidemux-svn-commit] r5487 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/dummy
</A></li>
        <LI>Next message: <A HREF="002700.html">[Avidemux-svn-commit] r5489 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2699">[ date ]</a>
              <a href="thread.html#2699">[ thread ]</a>
              <a href="subject.html#2699">[ subject ]</a>
              <a href="author.html#2699">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-11-13 18:29:44 +0100 (Fri, 13 Nov 2009)
New Revision: 5488

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_VideoEncoders.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder_desc.cpp
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSAvidemuxVideo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoder.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp
Log:
[VideoEncoder] Use param list to store video encoder configuration to file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -27,6 +27,7 @@
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
 #include &quot;ADM_paramList.h&quot;
 #include &quot;prefs.h&quot;
 #include &quot;avi_vars.h&quot;
@@ -125,29 +126,27 @@
 
 // Video codec
 //___________________________
-#if 0
-		uint8_t *extraData;
-		uint32_t extraDataSize;
-
+        
 		qfprintf(fd, &quot;\n//** Video Codec conf **\n&quot;);
-		videoCodecGetConf(&amp;extraDataSize, &amp;extraData);
+        CONFcouple *couples=NULL;
+    
+        qfprintf(fd, &quot;app.video.codec(\&quot;%s\&quot;&quot;, videoEncoder6_GetCurrentEncoderName());
+        videoEncoder6_GetConfiguration(&amp;couples);
+        if(couples)
+        {
+            uint32_t n=couples-&gt;getSize();
+        
+            for(int i=0;i&lt;n;i++)
+            {
+                char *name,*value;
+                couples-&gt;getInternalName(i,&amp;name,&amp;value);
+                qfprintf(fd,&quot;,\&quot;%s=%s\&quot;&quot;,name,value);
+            }
+            delete couples;
+            couples=NULL;
+        }
+        qfprintf(fd,&quot;);\n&quot;);
 
-		if (videoCodecGetType() == CodecExternal)
-			qfprintf(fd, &quot;app.video.codecPlugin(\&quot;%s\&quot;, \&quot;%s\&quot;, \&quot;%s\&quot;, \&quot;%s\&quot;);\n&quot;, videoCodecPluginGetGuid(), videoCodecGetName(), videoCodecGetMode(), extraData);
-		else
-		{
-			qfprintf(fd, &quot;app.video.codec(\&quot;%s\&quot;, \&quot;%s\&quot;, \&quot;&quot;, videoCodecGetName(), videoCodecGetMode());
-
-			// Now deal with extra data
-			qfprintf(fd, &quot;%d &quot;, extraDataSize);
-
-			if (extraDataSize)
-				for(int i = 0; i &lt; extraDataSize; i++)
-					qfprintf(fd, &quot;%02x &quot;, extraData[i]);
-
-			qfprintf(fd, &quot;\&quot;);\n&quot;);
-		}
-#endif        
 // Audio Source
 //______________________________________________
 
@@ -181,7 +180,7 @@
                         
         }
 #endif
-   CONFcouple *couples=NULL;
+   couples=NULL;
    getAudioExtraConf(&amp;bitrate,&amp;couples);
     qfprintf(fd,&quot;app.audio.codec(\&quot;%s\&quot;,%d&quot;,audioCodecGetName(),bitrate); 
    if(couples)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSAvidemuxVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSAvidemuxVideo.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSAvidemuxVideo.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -24,6 +24,7 @@
 #include &quot;ADM_editor/ADM_outputfmt.h&quot;
 #include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;ADM_script/ADM_container.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
 
 extern VF_FILTERS filterGetTagFromName(const char *inname);
 extern uint8_t A_ListAllBlackFrames( char *file );
@@ -32,7 +33,10 @@
 extern int A_saveJpg (char *name);
 extern uint8_t loadVideoCodecConf( const char *name);
 extern void filterCleanUp( void );
+extern bool jsArgToConfCouple(int nb,CONFcouple **conf,  jsval *argv);
+bool A_setVideoCodec(const char *nm);
 
+
 JSPropertySpec ADM_JSAvidemuxVideo::avidemuxvideo_properties[] = 
 { 
        
@@ -45,9 +49,7 @@
 	{ &quot;add&quot;, Add, 3, 0, 0 },	// add
     { &quot;clearFilters&quot;, ClearFilters, 0, 0, 0 }, // Delete all filters
 	{ &quot;addFilter&quot;, AddFilter, 10, 0, 0 },	// Add filter to filter chain
-	{ &quot;codec&quot;, Codec, 3, 0, 0 },	// Set the video codec
-	{ &quot;codecPlugin&quot;, codecPlugin, 4, 0, 0 },	// Set the video codec plugin
-	{ &quot;codecConf&quot;, CodecConf, 1, 0, 0 },	// load video codec config
+	{ &quot;codec&quot;, Codec, 1, 0, 0 },	// Set the video codec
 	{ &quot;save&quot;, Save, 1, 0, 0 },	// save video portion of the stream
 	{ &quot;saveJpeg&quot;, SaveJPEG, 1, 0, 0 },	// save the current frame as a JPEG
 	{ &quot;listBlackFrames&quot;, ListBlackFrames, 1, 0, 0 },	// output a list of the black frame to a file
@@ -246,110 +248,39 @@
 #endif        
         return JS_TRUE;
 }// end AddFilter
-
+/**
+    \fn Codec
+*/
 JSBool ADM_JSAvidemuxVideo::Codec(JSContext *cx, JSObject *obj, uintN argc, 
                                        jsval *argv, jsval *rval)
 {// begin Codec
         *rval = BOOLEAN_TO_JSVAL(false);
-        if(argc &gt; 3)
+        if(argc &lt;1)
                 return JS_FALSE;
-        printf(&quot;Codec ... \n&quot;);
-        if(JSVAL_IS_STRING(argv[0]) == false || JSVAL_IS_STRING(argv[1]) == false  || JSVAL_IS_STRING(argv[2]) == false)
+        if(JSVAL_IS_STRING(argv[0]) == false )
+        {
+                ADM_error(&quot;Cannot set codec\n&quot;);
                 return JS_FALSE;
-        
-                printf(&quot;[codec]%s\n&quot;,JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-                printf(&quot;[conf ]%s\n&quot;,JS_GetStringBytes(JSVAL_TO_STRING(argv[1])));
-                printf(&quot;[xtra ]%s\n&quot;,JS_GetStringBytes(JSVAL_TO_STRING(argv[2])));
-                
-                char *codec,*conf,*codecConfString;
-                codec = JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
-                conf = JS_GetStringBytes(JSVAL_TO_STRING(argv[1]));
-                codecConfString = JS_GetStringBytes(JSVAL_TO_STRING(argv[2]));
-                enterLock();
-#if 0
-                if(!videoCodecSelectByName(codec))
-                        *rval = BOOLEAN_TO_JSVAL(false);
-                else
-                {// begin conf
-                        // now do the conf
-                        // format CBR=bitrate in kbits
-                        //	  CQ=Q
-                        //	  2 Pass=size
-                        // We have to replace
-                        if(!videoCodecConfigure(conf,0,NULL))
-                                *rval = BOOLEAN_TO_JSVAL(false);
-                        else
-                        {
-                                *rval = BOOLEAN_TO_JSVAL(true);
-                                if(!loadVideoCodecConfString(codecConfString))
-                                        *rval = BOOLEAN_TO_JSVAL(false);
-                                else
-                                        *rval = BOOLEAN_TO_JSVAL(true);
-                        }
+        }
+        char *codec=JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
+        // Set codec.
+        enterLock();
+        if(A_setVideoCodec(codec)==false)
+        {
+            ADM_error(&quot;Could not select codec %s\n&quot;,codec);
+            leaveLock();
+            return JS_FALSE;
+        }
+        CONFcouple *c;
+        jsArgToConfCouple(argc-1,&amp;c,argv+1);
+        *rval = BOOLEAN_TO_JSVAL( videoEncoder6_SetConfiguration(c));
+        printf(&quot;Selected codec %s\n&quot;,codec);
+        leaveLock();
 
-                }// end conf
-#endif
-                leaveLock();
-
         return JS_TRUE;
 }// end Codec
 
-JSBool ADM_JSAvidemuxVideo::codecPlugin(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	*rval = BOOLEAN_TO_JSVAL(false);
-#if 0
-	if (argc != 4)
-		return JS_FALSE;
 
-	printf(&quot;Codec Plugin ... \n&quot;);
-
-	if (!JSVAL_IS_STRING(argv[0]) || !JSVAL_IS_STRING(argv[1]) || !JSVAL_IS_STRING(argv[2]) || !JSVAL_IS_STRING(argv[3]))
-		return JS_FALSE;
-
-	char *guid = JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
-	char *desc = JS_GetStringBytes(JSVAL_TO_STRING(argv[1]));
-	char *conf = JS_GetStringBytes(JSVAL_TO_STRING(argv[2]));
-	char *data = JS_GetStringBytes(JSVAL_TO_STRING(argv[3]));
-
-	printf(&quot;[guid] %s\n&quot;, guid);
-	printf(&quot;[desc] %s\n&quot;, desc);
-	printf(&quot;[conf] %s\n&quot;, conf);
-	printf(&quot;[data] %s\n&quot;, data);
-
-	enterLock();
-
-	if (!videoCodecPluginSelectByGuid(guid))
-		*rval = BOOLEAN_TO_JSVAL(false);
-	else
-		*rval = BOOLEAN_TO_JSVAL(videoCodecConfigure(conf, 0, (uint8_t*)data));
-
-	leaveLock();
-#endif
-	return JS_TRUE;
-}
-
-JSBool ADM_JSAvidemuxVideo::CodecConf(JSContext *cx, JSObject *obj, uintN argc, 
-                                       jsval *argv, jsval *rval)
-{
-	*rval = BOOLEAN_TO_JSVAL(false);
-#if 0
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (!JSVAL_IS_STRING(argv[0]))
-		return JS_FALSE;
-
-	char *pTempStr = JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
-
-	printf(&quot;Codec Conf Video \&quot;%s\&quot;\n&quot;, pTempStr);
-
-	enterLock();
-	*rval = INT_TO_JSVAL(loadVideoCodecConf(pTempStr));
-	leaveLock();
-#endif
-	return JS_TRUE;
-}
-
 JSBool ADM_JSAvidemuxVideo::Save(JSContext *cx, JSObject *obj, uintN argc, 
                                        jsval *argv, jsval *rval)
 {// begin Save
@@ -638,4 +569,20 @@
         
         return JS_TRUE;
 }// end PostProcess
+/**
+    \fn A_setVideoCodec
+*/
+bool A_setVideoCodec(const char *nm)
+{
+    int idx=videoEncoder6_GetIndexFromName(nm);
+    if(idx==-1)
+    {
+        ADM_error(&quot;No such encoder :%s\n&quot;,nm);
+    }
+    // Select by index
+    videoEncoder6_SetCurrentEncoder(idx);
+    UI_setVideoCodec(idx);
+    return true;
+}
+
 /* EOF */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -43,6 +43,7 @@
 
 #include &quot;ADM_vidMisc.h&quot;
 #include &quot;ADM_coreVideoEncoder.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
 #include &quot;ADM_audioFilter/include/ADM_audioFilterInterface.h&quot;
 //extern void filterListAll(void );
 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -1,21 +0,0 @@
-/***************************************************************************
-                          \fn ADM_VideoEncoders
-                          \brief Internal handling of video encoders
-                             -------------------
-    
-    copyright            : (C) 2002/2009 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_coreVideoEncoder.h&quot;
-#include &quot;ADM_filterChain.h&quot;
-// EOF

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -1,242 +0,0 @@
-/***************************************************************************
-                             ADM_dynVideoEncoder.cpp
-
-    begin                : Mon Apr 14 2008
-    copyright            : (C) 2008 2009 by gruntster/mean
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include &quot;ADM_default.h&quot;
-#include &lt;vector&gt;
-
-#include &quot;DIA_fileSel.h&quot;
-
-#include &quot;ADM_coreVideoEncoder.h&quot;
-#include &quot;ADM_coreVideoEncoderInternal.h&quot;
-#include &quot;DIA_uiTypes.h&quot;
-#include &quot;ADM_dynamicLoading.h&quot;
-
-static int currentVideoCodec=0;
-/**
-    \class ADM_videoEncoder6
-    \brief Plugin Wrapper Class
-
-*/
-class ADM_videoEncoder6 :public ADM_LibWrapper
-{
-public:
-        int                  initialised;
-        ADM_videoEncoderDesc *desc;
-        ADM_videoEncoderDesc  *(*getInfo)();
-        ADM_videoEncoder6(const char *file) : ADM_LibWrapper()
-        {
-			initialised = (loadLibrary(file) &amp;&amp; getSymbols(1,
-				&amp;getInfo, &quot;getInfo&quot;));
-                if(initialised)
-                {
-                    desc=getInfo();
-                    printf(&quot;[videoEncoder6]Name :%s ApiVersion :%d Description :%s\n&quot;,
-                                                        desc-&gt;encoderName,
-                                                        desc-&gt;apiVersion,
-                                                        desc-&gt;description);
-                }else
-                {
-                    printf(&quot;[videoEncoder6]Symbol loading failed for %s\n&quot;,file);
-                }
-        }
-};
-
-std::vector &lt;ADM_videoEncoder6 *&gt; ListOfEncoders;
-// 
-ADM_videoEncoderDesc copyDesc={
-        &quot;Copy&quot;,
-        &quot;Copy&quot;,
-        &quot;Copy encoder&quot;,
-        ADM_VIDEO_ENCODER_API_VERSION, //uint32_t     apiVersion;            // const
-
-        NULL, //ADM_coreVideoEncoder *(*create)(ADM_coreVideoFilter *head);  
-        NULL, //void         (*destroy)(ADM_coreVideoEncoder *codec);
-        NULL, //bool         (*configure)(void);                                // Call UI to set it up
-        NULL, //bool         (*getConfigurationData)(uint32_t *l, uint8_t **d); // Get the encoder private conf
-        NULL, //bool         (*setConfigurationData)(uint32_t l, uint8_t *d);   // Set the encoder private conf
-
-        ADM_UI_ALL, //ADM_UI_TYPE  UIType;                // Type of UI
-        1,0,0, //uint32_t     major,minor,patch;     // Version of the plugin
-        NULL  //void         *opaque;               // Hide stuff in here
-};
-
-/**
-        \fn ADM_ve6_getNbEncoders
-        \brief Returns the number of demuxers plugins except one
-*/
-uint32_t ADM_ve6_getNbEncoders(void)
-{
-    return ListOfEncoders.size();
-}
-/**
-    \fn     ADM_ve6_getEncoderInfo
-    \brief  Get Infos about the demuxer #th plugin
-*/
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
-{
-    ADM_assert(filter&lt;ListOfEncoders.size());
-    ADM_videoEncoderDesc *desc=ListOfEncoders[filter]-&gt;desc;
-    ADM_assert(desc);
-    *name=desc-&gt;menuName;
-    *major=desc-&gt;major;
-    *minor=desc-&gt;minor;
-    *patch=desc-&gt;patch;
-    return true;
-}
-/**
-    \fn tryLoadingFilterPlugin
-    \brief Try loading the file given as argument as an audio device plugin
-
-*/
-#define Fail(x) {printf(&quot;%s:&quot;#x&quot;\n&quot;,file);goto er;}
-static bool tryLoadingEncoderPlugin(const char *file)
-{
-	ADM_videoEncoder6 *dll=new ADM_videoEncoder6(file);
-    if(!dll-&gt;initialised) Fail(CannotLoad);
-    if(dll-&gt;desc-&gt;apiVersion!=ADM_VIDEO_ENCODER_API_VERSION) Fail(WrongApiVersion);
-//fixme todo also check uiType    
-    ListOfEncoders.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
-    printf(&quot;[VideoEncoder6] Registered filter %s as  %s\n&quot;,file,dll-&gt;desc-&gt;description);
-    return true;
-	// Fail!
-er:
-	delete dll;
-	return false;
-
-}
-/**
- * 	\fn ADM_ve6_loadPlugins
- *  \brief load all audio device plugins
- */
-uint8_t ADM_ve6_loadPlugins(const char *path)
-{
-#define MAX_EXTERNAL_FILTER 100
-// FIXME Factorize
-
-	char *files[MAX_EXTERNAL_FILTER];
-	uint32_t nbFile;
-
-	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
-	printf(&quot;[ADM_ve6_plugin] Scanning directory %s\n&quot;,path);
-
-	if(!buildDirectoryContent(&amp;nbFile, path, files, MAX_EXTERNAL_FILTER, SHARED_LIB_EXT))
-	{
-		printf(&quot;[ADM_ve6_plugin] Cannot parse plugin\n&quot;);
-		return 0;
-	}
-    // Add our copy encoder....
-    ADM_videoEncoder6 *dll=new ADM_videoEncoder6(&quot;copyADM&quot;);
-    dll-&gt;desc=&copyDesc;
-    ListOfEncoders.push_back(dll);
-
-	for(int i=0;i&lt;nbFile;i++)
-		tryLoadingEncoderPlugin(files[i]);
-    
-	printf(&quot;[ADM_ve6_plugin] Scanning done\n&quot;);
-
-	return 1;
-}
-/**
-        \fn ADM_ve6_cleanup
-        \brief Current device is no longer used, delete
-*/
-void ADM_ve6_cleanup(void)
-{
-        int nb=ListOfEncoders.size();
-        for(int i=0;i&lt;nb;i++)
-                {
-                        if(ListOfEncoders[i]) delete ListOfEncoders[i];
-                        ListOfEncoders[i]=NULL;
-                }
-}
-
-/**
-    \fn ADM_ve6_getMenuName
-    \brief IT starts from 0, ignoring the copy one
-*/
-const char *ADM_ve6_getMenuName(uint32_t i)
-{
-	 int nb=ListOfEncoders.size();
-
-	ADM_assert(i &lt; nb);
-
-	return ListOfEncoders[i]-&gt;desc-&gt;menuName;
-}
-/**
-    \fn ADM_ve6_Changed
-*/
-void ADM_ve6_Changed(int newCodecIndex)
-{
-	int nb=ListOfEncoders.size();
-	ADM_assert(newCodecIndex &lt; nb);
-
-	currentVideoCodec=newCodecIndex;
-}
-
-
-/**
-    \fn createVideoEncoder
-*/
-ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index)
-{
-    int nb=ListOfEncoders.size();
-	ADM_assert(index &lt; nb);
-    ADM_assert(index); // 0 is for copy, should not get it through here
-    ADM_videoEncoder6 *plugin=ListOfEncoders[index];
-
-    ADM_coreVideoEncoder *enc=plugin-&gt;desc-&gt;create(chain);
-    return enc;
-}
-/**
-    \fn videoEncoder6SelectByName
-*/
-bool videoEncoder6SelectByName(const char *name)
-{
-    int nb=ListOfEncoders.size();
-    for(int i=0;i&lt;nb;i++)
-    {
-        ADM_videoEncoderDesc *desc=ListOfEncoders[i]-&gt;desc;
-        if(!strcasecmp(name,desc-&gt;encoderName))
-        {
-            currentVideoCodec=i;
-            return true;
-        }
-    }
-    return false;
-}
-/**
-    \fn videoEncoder6Configure
-
-*/
-bool                  videoEncoder6Configure(void)
-{
-    ADM_videoEncoderDesc *desc=ListOfEncoders[currentVideoCodec]-&gt;desc;
-    if(desc-&gt;configure) return desc-&gt;configure();
-    return true;
-}
-/**
-    \fn videoEncoder6_SetCurrentEncoder
-
-*/
-bool                  videoEncoder6_SetCurrentEncoder(uint32_t index)
-{
-      int nb=ListOfEncoders.size();
-      if(index&gt;=nb) return false;
-      currentVideoCodec=index;
-      return true;
-}
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt	2009-11-13 17:29:44 UTC (rev 5488)
@@ -1,5 +1 @@
-SET(ADM_internalVideoEncoder_SRCS 
-	ADM_VideoEncoders.cpp
-        ADM_dynVideoEncoder.cpp
-)
-ADD_LIBRARY(ADM_videoEncoder6 STATIC ${ADM_internalVideoEncoder_SRCS})
+ADD_SUBDIRECTORY(src)

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,39 @@
+/***************************************************************************
+                          \fn ADM_videoEncoderApi.h
+                          \brief Api to deal with video encoder
+                             -------------------
+    
+    copyright            : (C) 2002/2009 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_VIDEO_ENCODER_API_H
+#define ADM_VIDEO_ENCODER_API_H
+class ADM_coreVideoEncoder;
+class ADM_coreVideoFilter;
+// Spawn a new encoder using the index from the menu = the index in the vector
+ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index);
+
+bool                  videoEncoder6SelectByName(const char *name);
+bool                  videoEncoder6Configure(void);
+
+int                   videoEncoder6_GetIndexFromName(const char *name);
+
+bool                  videoEncoder6_SetCurrentEncoder(uint32_t index);
+
+const char            *videoEncoder6_GetCurrentEncoderName(void);
+
+bool                  videoEncoder6_SetConfiguration(CONFcouple *c);
+bool                  videoEncoder6_GetConfiguration(CONFcouple **c);
+
+ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index);
+
+#endif

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_VideoEncoders.cpp (from rev 5487, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_VideoEncoders.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_VideoEncoders.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,21 @@
+/***************************************************************************
+                          \fn ADM_VideoEncoders
+                          \brief Internal handling of video encoders
+                             -------------------
+    
+    copyright            : (C) 2002/2009 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_coreVideoEncoder.h&quot;
+#include &quot;ADM_filterChain.h&quot;
+// EOF

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp (from rev 5487, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/ADM_dynVideoEncoder.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,283 @@
+/***************************************************************************
+                             ADM_dynVideoEncoder.cpp
+
+    begin                : Mon Apr 14 2008
+    copyright            : (C) 2008 2009 by gruntster/mean
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#include &quot;ADM_default.h&quot;
+#include &lt;vector&gt;
+
+#include &quot;DIA_fileSel.h&quot;
+
+#include &quot;ADM_coreVideoEncoder.h&quot;
+#include &quot;ADM_coreVideoEncoderInternal.h&quot;
+#include &quot;DIA_uiTypes.h&quot;
+#include &quot;ADM_dynamicLoading.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
+static int currentVideoCodec=0;
+/**
+    \class ADM_videoEncoder6
+    \brief Plugin Wrapper Class
+
+*/
+class ADM_videoEncoder6 :public ADM_LibWrapper
+{
+public:
+        int                  initialised;
+        ADM_videoEncoderDesc *desc;
+        ADM_videoEncoderDesc  *(*getInfo)();
+        ADM_videoEncoder6(const char *file) : ADM_LibWrapper()
+        {
+			initialised = (loadLibrary(file) &amp;&amp; getSymbols(1,
+				&amp;getInfo, &quot;getInfo&quot;));
+                if(initialised)
+                {
+                    desc=getInfo();
+                    printf(&quot;[videoEncoder6]Name :%s ApiVersion :%d Description :%s\n&quot;,
+                                                        desc-&gt;encoderName,
+                                                        desc-&gt;apiVersion,
+                                                        desc-&gt;description);
+                }else
+                {
+                    printf(&quot;[videoEncoder6]Symbol loading failed for %s\n&quot;,file);
+                }
+        }
+};
+
+std::vector &lt;ADM_videoEncoder6 *&gt; ListOfEncoders;
+// 
+ADM_videoEncoderDesc copyDesc={
+        &quot;Copy&quot;,
+        &quot;Copy&quot;,
+        &quot;Copy encoder&quot;,
+        ADM_VIDEO_ENCODER_API_VERSION, //uint32_t     apiVersion;            // const
+
+        NULL, //ADM_coreVideoEncoder *(*create)(ADM_coreVideoFilter *head);  
+        NULL, //void         (*destroy)(ADM_coreVideoEncoder *codec);
+        NULL, //bool         (*configure)(void);                                // Call UI to set it up
+        NULL, //bool         (*getConfigurationData)(uint32_t *l, uint8_t **d); // Get the encoder private conf
+        NULL, //bool         (*setConfigurationData)(uint32_t l, uint8_t *d);   // Set the encoder private conf
+
+        ADM_UI_ALL, //ADM_UI_TYPE  UIType;                // Type of UI
+        1,0,0, //uint32_t     major,minor,patch;     // Version of the plugin
+        NULL  //void         *opaque;               // Hide stuff in here
+};
+
+/**
+        \fn ADM_ve6_getNbEncoders
+        \brief Returns the number of demuxers plugins except one
+*/
+uint32_t ADM_ve6_getNbEncoders(void)
+{
+    return ListOfEncoders.size();
+}
+/**
+    \fn     ADM_ve6_getEncoderInfo
+    \brief  Get Infos about the demuxer #th plugin
+*/
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
+{
+    ADM_assert(filter&lt;ListOfEncoders.size());
+    ADM_videoEncoderDesc *desc=ListOfEncoders[filter]-&gt;desc;
+    ADM_assert(desc);
+    *name=desc-&gt;menuName;
+    *major=desc-&gt;major;
+    *minor=desc-&gt;minor;
+    *patch=desc-&gt;patch;
+    return true;
+}
+/**
+    \fn tryLoadingFilterPlugin
+    \brief Try loading the file given as argument as an audio device plugin
+
+*/
+#define Fail(x) {printf(&quot;%s:&quot;#x&quot;\n&quot;,file);goto er;}
+static bool tryLoadingEncoderPlugin(const char *file)
+{
+	ADM_videoEncoder6 *dll=new ADM_videoEncoder6(file);
+    if(!dll-&gt;initialised) Fail(CannotLoad);
+    if(dll-&gt;desc-&gt;apiVersion!=ADM_VIDEO_ENCODER_API_VERSION) Fail(WrongApiVersion);
+//fixme todo also check uiType    
+    ListOfEncoders.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    printf(&quot;[VideoEncoder6] Registered filter %s as  %s\n&quot;,file,dll-&gt;desc-&gt;description);
+    return true;
+	// Fail!
+er:
+	delete dll;
+	return false;
+
+}
+/**
+ * 	\fn ADM_ve6_loadPlugins
+ *  \brief load all audio device plugins
+ */
+uint8_t ADM_ve6_loadPlugins(const char *path)
+{
+#define MAX_EXTERNAL_FILTER 100
+// FIXME Factorize
+
+	char *files[MAX_EXTERNAL_FILTER];
+	uint32_t nbFile;
+
+	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
+	printf(&quot;[ADM_ve6_plugin] Scanning directory %s\n&quot;,path);
+
+	if(!buildDirectoryContent(&amp;nbFile, path, files, MAX_EXTERNAL_FILTER, SHARED_LIB_EXT))
+	{
+		printf(&quot;[ADM_ve6_plugin] Cannot parse plugin\n&quot;);
+		return 0;
+	}
+    // Add our copy encoder....
+    ADM_videoEncoder6 *dll=new ADM_videoEncoder6(&quot;copyADM&quot;);
+    dll-&gt;desc=&copyDesc;
+    ListOfEncoders.push_back(dll);
+
+	for(int i=0;i&lt;nbFile;i++)
+		tryLoadingEncoderPlugin(files[i]);
+    
+	printf(&quot;[ADM_ve6_plugin] Scanning done\n&quot;);
+
+	return 1;
+}
+/**
+        \fn ADM_ve6_cleanup
+        \brief Current device is no longer used, delete
+*/
+void ADM_ve6_cleanup(void)
+{
+        int nb=ListOfEncoders.size();
+        for(int i=0;i&lt;nb;i++)
+                {
+                        if(ListOfEncoders[i]) delete ListOfEncoders[i];
+                        ListOfEncoders[i]=NULL;
+                }
+}
+
+/**
+    \fn ADM_ve6_getMenuName
+    \brief IT starts from 0, ignoring the copy one
+*/
+const char *ADM_ve6_getMenuName(uint32_t i)
+{
+	 int nb=ListOfEncoders.size();
+
+	ADM_assert(i &lt; nb);
+
+	return ListOfEncoders[i]-&gt;desc-&gt;menuName;
+}
+/**
+    \fn ADM_ve6_Changed
+*/
+void ADM_ve6_Changed(int newCodecIndex)
+{
+	int nb=ListOfEncoders.size();
+	ADM_assert(newCodecIndex &lt; nb);
+
+	currentVideoCodec=newCodecIndex;
+}
+
+
+/**
+    \fn createVideoEncoder
+*/
+ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index)
+{
+    int nb=ListOfEncoders.size();
+	ADM_assert(index &lt; nb);
+    ADM_assert(index); // 0 is for copy, should not get it through here
+    ADM_videoEncoder6 *plugin=ListOfEncoders[index];
+
+    ADM_coreVideoEncoder *enc=plugin-&gt;desc-&gt;create(chain);
+    return enc;
+}
+/**
+    \fn videoEncoder6SelectByName
+*/
+bool videoEncoder6SelectByName(const char *name)
+{
+    int i=videoEncoder6_GetIndexFromName(name);
+    if(i==-1) return false;
+    
+    currentVideoCodec=i;
+    return true;
+}
+/**
+    \fn videoEncoder6Configure
+
+*/
+bool                  videoEncoder6Configure(void)
+{
+    ADM_videoEncoderDesc *desc=ListOfEncoders[currentVideoCodec]-&gt;desc;
+    if(desc-&gt;configure) return desc-&gt;configure();
+    return true;
+}
+/**
+    \fn videoEncoder6_SetCurrentEncoder
+
+*/
+bool                  videoEncoder6_SetCurrentEncoder(uint32_t index)
+{
+      int nb=ListOfEncoders.size();
+      if(index&gt;=nb) return false;
+      currentVideoCodec=index;
+      return true;
+}
+/**
+    \fn videoEncoder6_GetCurrentEncoderName
+*/
+const char            *videoEncoder6_GetCurrentEncoderName(void)
+{
+    ADM_assert(currentVideoCodec&lt;ListOfEncoders.size());
+    ADM_videoEncoder6 *e=ListOfEncoders[currentVideoCodec];
+    return e-&gt;desc-&gt;encoderName;
+}
+/**
+    \fn videoEncoder6_GetCurrentEncoderName
+*/
+
+bool                  videoEncoder6_SetConfiguration(CONFcouple *c)
+{
+    if(!c) return true;
+    ADM_assert(currentVideoCodec&lt;ListOfEncoders.size());
+    ADM_videoEncoder6 *e=ListOfEncoders[currentVideoCodec];
+    return e-&gt;desc-&gt;setConfigurationData(c);
+}
+/**
+    \fn videoEncoder6_GetConfiguration
+*/
+
+bool                  videoEncoder6_GetConfiguration(CONFcouple **c)
+{
+    ADM_assert(currentVideoCodec&lt;ListOfEncoders.size());
+    ADM_videoEncoder6 *e=ListOfEncoders[currentVideoCodec];
+    return e-&gt;desc-&gt;getConfigurationData(c);
+}
+/**
+    \fn videoEncoder6_GetIndexFromName
+*/
+int                   videoEncoder6_GetIndexFromName(const char *name)
+{
+    int nb=ListOfEncoders.size();
+    for(int i=0;i&lt;nb;i++)
+    {
+        ADM_videoEncoderDesc *desc=ListOfEncoders[i]-&gt;desc;
+        if(!strcasecmp(name,desc-&gt;encoderName))
+        {
+           
+            return i;
+        }
+    }
+    return -1;
+}
+//EOF

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/CMakeLists.txt (from rev 5487, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/CMakeLists.txt	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/CMakeLists.txt	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,5 @@
+SET(ADM_internalVideoEncoder_SRCS 
+	ADM_VideoEncoders.cpp
+        ADM_dynVideoEncoder.cpp
+)
+ADD_LIBRARY(ADM_videoEncoder6 STATIC ${ADM_internalVideoEncoder_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -35,6 +35,7 @@
 #include &quot;ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;
 #include &quot;ADM_coreVideoEncoder.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
 #include &quot;ADM_audioFilter/include/ADM_audioFilterInterface.h&quot;
 
 #include &quot;avi_vars.h&quot;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -39,6 +39,7 @@
 #include &quot;ADM_muxerGate/include/ADM_videoProcess.h&quot;
 #include &quot;ADM_bitstream.h&quot;
 #include &quot;ADM_filterChain.h&quot;
+#include &quot;ADM_videoEncoderApi.h&quot;
 /*
     
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2009-11-13 17:29:44 UTC (rev 5488)
@@ -33,6 +33,7 @@
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_audioFilter/include&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_commonUI&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_videoFilter2/include&quot;)
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_videoEncoder/include&quot;)
 #
 # Add main source
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoder.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoder.h	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoder.h	2009-11-13 17:29:44 UTC (rev 5488)
@@ -21,6 +21,7 @@
 #include &quot;ADM_coreVideoFilter.h&quot;
 #include &quot;ADM_bitstream.h&quot;
 #include &quot;ADM_frameType.h&quot;
+#include &quot;stddef.h&quot;
 typedef enum
 {
     ADM_ENCODER_OPTION_MOV_MODE=1
@@ -52,11 +53,6 @@
                uint64_t    getTotalDuration(void) {return source-&gt;getInfo()-&gt;totalDuration;}
 virtual        bool        setPassAndLogFile(int pass,const char *name) {return false;}
 };
-// Spawn a new encoder using the index from the menu = the index in the vector
-ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index);
-bool                  videoEncoder6SelectByName(const char *name);
-bool                  videoEncoder6Configure(void);
-bool                  videoEncoder6_SetCurrentEncoder(uint32_t index);
 
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -25,7 +25,7 @@
     ADM_HUFF_YUV,
     ADM_FF_HUFF_YUV
 };
-int huffType=ADM_HUFF_YUV;
+huff_encoder huffType={ADM_HUFF_YUV};
 //
 /**
         \fn ADM_huffEncoder
@@ -33,7 +33,7 @@
 ADM_huffEncoder::ADM_huffEncoder(ADM_coreVideoFilter *src) : ADM_coreVideoEncoderFFmpeg(src)
 {
     printf(&quot;[huffEncoder] Creating.\n&quot;);
-    if(huffType==ADM_HUFF_YUV)
+    if(huffType.encoderType==ADM_HUFF_YUV)
         targetColorSpace=ADM_COLOR_YUV422P;
     else
         targetColorSpace=ADM_COLOR_YV12;
@@ -44,7 +44,7 @@
 bool ADM_huffEncoder::setup(void)
 {
     CodecID id=CODEC_ID_HUFFYUV;
-    if(huffType==ADM_FF_HUFF_YUV) id=CODEC_ID_FFVHUFF;
+    if(huffType.encoderType==ADM_FF_HUFF_YUV) id=CODEC_ID_FFVHUFF;
     return ADM_coreVideoEncoderFFmpeg::setup(id);
 }
 
@@ -62,7 +62,7 @@
 */
 const  char        *ADM_huffEncoder::getFourcc(void)
 {
-    if(huffType==ADM_HUFF_YUV) return &quot;HFYU&quot;;
+    if(huffType.encoderType==ADM_HUFF_YUV) return &quot;HFYU&quot;;
     else return &quot;FFVH&quot;;
 
 }
@@ -109,14 +109,14 @@
 {
 uint32_t colorM;
     printf(&quot;[huff] Configure\n&quot;);
-    colorM=(uint32_t)huffType;
+    colorM=(uint32_t)huffType.encoderType;
 
     diaElemMenu      c(&amp;colorM,QT_TR_NOOP(&quot;Type:&quot;),2,colorMenus);
     diaElem *elems[1]={&amp;c};
     
       if( diaFactoryRun(QT_TR_NOOP(&quot;HuffYUV Configuration&quot;),1 ,elems))
       {
-        huffType=colorM;
+        huffType.encoderType=colorM;
         return false;
       }
       return true;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.h	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.h	2009-11-13 17:29:44 UTC (rev 5488)
@@ -18,11 +18,13 @@
 #ifndef ADM_huff_ENCODER_H
 #define ADM_huff_ENCODER_H
 #include &quot;ADM_coreVideoEncoderFFmpeg.h&quot;
+#include &quot;huff_encoder.h&quot;
 /**
         \class ADM_huffEncoder
         \brief Dummy encoder that does nothing
 
 */
+extern huff_encoder huffType;
 class ADM_huffEncoder : public ADM_coreVideoEncoderFFmpeg
 {
 protected:

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -18,6 +18,7 @@
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_huffEncoder.h&quot;
 #include &quot;ADM_coreVideoEncoderInternal.h&quot;
+#include &quot;huff_encoder_desc.cpp&quot;
 
 extern bool         huffConfigure(void);
 
@@ -28,6 +29,6 @@
                                 huffConfigure, // No configuration
                                 ADM_UI_ALL,
                                 1,0,0,
-                                NULL, // conf template
-                                NULL // conf var
+                                huff_encoder_param, // conf template
+                                &amp;huffType // conf var
 );

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.conf	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.conf	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1 @@
+uint32_t:encoderType

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.h	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder.h	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,8 @@
+// Automatically generated, do not edit!
+#ifndef ADM_huff_encoder_CONF_H
+#define ADM_huff_encoder_CONF_H
+typedef struct {
+   uint32_t encoderType;
+}huff_encoder;
+#endif //huff_encoder
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder_desc.cpp	2009-11-13 17:29:42 UTC (rev 5487)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huff_encoder_desc.cpp	2009-11-13 17:29:44 UTC (rev 5488)
@@ -0,0 +1,5 @@
+// Automatically generated, do not edit!
+const ADM_paramList huff_encoder_param[]={
+ {&quot;encoderType&quot;,offsetof( huff_encoder,encoderType),&quot;uint32_t&quot;,ADM_param_uint32_t},
+{NULL,0,NULL}
+};


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002698.html">[Avidemux-svn-commit] r5487 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/dummy
</A></li>
	<LI>Next message: <A HREF="002700.html">[Avidemux-svn-commit] r5489 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2699">[ date ]</a>
              <a href="thread.html#2699">[ thread ]</a>
              <a href="subject.html#2699">[ subject ]</a>
              <a href="author.html#2699">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
