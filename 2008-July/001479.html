<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4234 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audioEncoder/include	avidemux/ADM_audioEncoder/src plugins/ADM_audioEncoders	plugins/ADM_audioEncoders/aften plugins/ADM_audioEncoders/faac	plugins/ADM_audioEncoders/lavcodec plugins/ADM_audioEncoders/pcm	plugins/ADM_audioEncoders/twolame plugins/ADM_audioEncoders/vorbis
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4234%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_audioEncoder/include%0A%09avidemux/ADM_audioEncoder/src%20plugins/ADM_audioEncoders%0A%09plugins/ADM_audioEncoders/aften%20plugins/ADM_audioEncoders/faac%0A%09plugins/ADM_audioEncoders/lavcodec%20plugins/ADM_audioEncoders/pcm%0A%09plugins/ADM_audioEncoders/twolame%20plugins/ADM_audioEncoders/vorbis&In-Reply-To=%3C200807161740.m6GHeviW021384%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001481.html">
   <LINK REL="Next"  HREF="001480.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4234 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audioEncoder/include	avidemux/ADM_audioEncoder/src plugins/ADM_audioEncoders	plugins/ADM_audioEncoders/aften plugins/ADM_audioEncoders/faac	plugins/ADM_audioEncoders/lavcodec plugins/ADM_audioEncoders/pcm	plugins/ADM_audioEncoders/twolame plugins/ADM_audioEncoders/vorbis</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4234%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_audioEncoder/include%0A%09avidemux/ADM_audioEncoder/src%20plugins/ADM_audioEncoders%0A%09plugins/ADM_audioEncoders/aften%20plugins/ADM_audioEncoders/faac%0A%09plugins/ADM_audioEncoders/lavcodec%20plugins/ADM_audioEncoders/pcm%0A%09plugins/ADM_audioEncoders/twolame%20plugins/ADM_audioEncoders/vorbis&In-Reply-To=%3C200807161740.m6GHeviW021384%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4234 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audioEncoder/include	avidemux/ADM_audioEncoder/src plugins/ADM_audioEncoders	plugins/ADM_audioEncoders/aften plugins/ADM_audioEncoders/faac	plugins/ADM_audioEncoders/lavcodec plugins/ADM_audioEncoders/pcm	plugins/ADM_audioEncoders/twolame plugins/ADM_audioEncoders/vorbis">mean at mail.berlios.de
       </A><BR>
    <I>Wed Jul 16 19:40:57 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001481.html">[Avidemux-svn-commit] r4233 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_coreAudio/include plugins/ADM_audioEncoders/twolame	plugins/ADM_audioEncoders/twolame/ADM_libtwolame
</A></li>
        <LI>Next message: <A HREF="001480.html">[Avidemux-svn-commit] r4235 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1479">[ date ]</a>
              <a href="thread.html#1479">[ thread ]</a>
              <a href="subject.html#1479">[ subject ]</a>
              <a href="author.html#1479">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-07-16 19:40:55 +0200 (Wed, 16 Jul 2008)
New Revision: 4234

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften_param.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac_param.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/twolame/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis_param.h
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt
Log:
[AudioEncoder] PCM


Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,31 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef AUDMaudioAften
-#define AUDMaudioAften
-#ifdef USE_AFTEN
- //_____________________________________________
-class AUDMEncoder_Aften : public AUDMEncoder
-{
-protected:
-         void           *_handle;
-         
-public:
-                        uint8_t init(ADM_audioEncoderDescriptor *config);
-                virtual ~AUDMEncoder_Aften();
-                        AUDMEncoder_Aften(AUDMAudioFilter *instream);	
-                virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-};
-#endif
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,10 +0,0 @@
-#ifndef AUDM_AFTEN_PARAM_H
-#define AUDM_AFTEN_PARAM_H
-#ifdef USE_AFTEN
-
-typedef struct AFTEN_encoderParam
-{
-  ADM_mode        mode;
-};
-#endif
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,31 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef AUDMaudioAAC
-#define AUDMaudioAAC
-
- //_____________________________________________
-class AUDMEncoder_Faac : public AUDMEncoder
-{
-protected:
-         void           *_handle;
-         uint8_t        refillBuffer(int minimum);
-public:
-//                        uint8_t init(ADM_audioEncoderDescriptor *config);
-                virtual ~AUDMEncoder_Faac();
-                        AUDMEncoder_Faac(AUDMAudioFilter *instream);	
-                virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,8 +0,0 @@
-
-#ifndef FAAC_PARAM_H
-#define FAAC_PARAM_H
-typedef struct 
-{
-  uint32_t dummy;
-}FAAC_encoderParam;
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,32 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef AUDMaudioLavcodec
-#define AUDMaudioLavcodec
- //_____________________________________________
-class AUDMEncoder_Lavcodec : public AUDMEncoder
-{
-  protected:
-   
-    void              *_context;
-    uint32_t          _fourcc;
-         
-  public:
-//            uint8_t     init(ADM_audioEncoderDescriptor *config);
-   virtual             ~AUDMEncoder_Lavcodec();
-                        AUDMEncoder_Lavcodec(uint32_t fourcc,AUDMAudioFilter *instream);	
-   virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,36 +0,0 @@
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef AUDMaudioPCM
-#define AUDMaudioPCM
-
-/*!
-    This class is the float-&gt;PCM encoder.
-    It is somehow special as it can alsa be a LPCM encoder and a bigendian/littleendian swapper
-*/
-class AUDMEncoder_PCM : public AUDMEncoder
-{
-  protected:
-    uint32_t            revert;
-         
-  public:
-//            uint8_t     init(ADM_audioEncoderDescriptor *config);
-            virtual     ~AUDMEncoder_PCM();
-                        /*! \param reverted : Should the endianness be reverted compared to system  
-                            \param fourCC   : FourCC to use (WAV_PCM/WAV_LPCM)
-                        */
-                         AUDMEncoder_PCM(uint32_t reverted,uint32_t fourCC,AUDMAudioFilter * instream);
-    virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,35 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef AUDMaudioVorbis
-#define AUDMaudioVorbis
-
- //_____________________________________________
-class AUDMEncoder_Vorbis : public AUDMEncoder
-{
-  protected:
-   
-    void              *_handle;
-    uint64_t          _oldpos;
-
-         
-  public:
-//            uint8_t     init(ADM_audioEncoderDescriptor *config);
-            virtual     ~AUDMEncoder_Vorbis();
-                        AUDMEncoder_Vorbis(AUDMAudioFilter *instream);	
-            
-   virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,17 +0,0 @@
-#ifndef AUDM_VORBIS_PARAM_H
-#define AUDM_VORBIS_PARAM_H
-
-typedef enum 
-{
-  ADM_VORBIS_CBR,
-  ADM_VORBIS_VBR,
-  ADM_VORBIS_QUALITY
-  
-}ADM_VORBIS_MODE;
-
-typedef struct 
-{
-  ADM_VORBIS_MODE    mode;   // 0 cbr 1 vbr 2 quality
-  float              quality;
-}VORBIS_encoderParam;
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,166 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-
-    Interface to Aften
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#ifdef USE_AFTEN
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
-#include &quot;audioencoder.h&quot;
-//
-extern &quot;C&quot;
-{
-#if defined(USE_AFTEN_06)
-	#include &quot;aften.h&quot;
-#else	// Aften 0.05 &amp; 0.07 onwards
-	#include &quot;aften/aften.h&quot;
-#endif
-};
-#include &quot;audioencoder_aften_param.h&quot;
-#include &quot;audioencoder_aften.h&quot;
-
-#define _HANDLE ((AftenContext *)_handle)
-AUDMEncoder_Aften::AUDMEncoder_Aften(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
-{
-  uint32_t channels;
-  channels=instream-&gt;getInfo()-&gt;channels;
-  _handle=(void *)new AftenContext;
-  memset(_handle,0,sizeof(AftenContext));
-  aften_set_defaults(_HANDLE);
-  _wavheader-&gt;encoding=WAV_AC3;
-#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
-#elif defined(USE_AFTEN_07)
-  _HANDLE-&gt;params.n_threads=1; // MThread collides with avidemux multithreading
-#else
-  _HANDLE-&gt;system.n_threads=1;
-#endif
-};
-
-
-AUDMEncoder_Aften::~AUDMEncoder_Aften()
-{
-    if(_handle)
-      aften_encode_close(_HANDLE);
-    delete(_HANDLE);
-    _handle=NULL;
-
-    printf(&quot;[Aften] Deleting aften\n&quot;);
-    cleanup();
-};
-
-
-//________________________________________________
-//   Init lame encoder
-// frequence    : Impose frequency , 0 means reuse the incoming fq
-// mode                         : ADM_STEREO etc...
-// bitrate              : Bitrate in kbps (96,192...)
-// return 0 : init failed
-//                              1 : init succeeded
-//_______________________________________________
-uint8_t AUDMEncoder_Aften::init(ADM_audioEncoderDescriptor *config)
-{
-
-
-int ret=0;
-
-#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
-int mask;
-#else
-unsigned int mask;
-#endif
-
-    _wavheader-&gt;byterate=(config-&gt;bitrate*1000)/8;
-    _HANDLE-&gt;sample_format=A52_SAMPLE_FMT_FLT;
-    _HANDLE-&gt;channels=_wavheader-&gt;channels;
-    _HANDLE-&gt;samplerate=_wavheader-&gt;frequency;
-    
-    _HANDLE-&gt;params.bitrate=config-&gt;bitrate;
-    switch(_wavheader-&gt;channels)
-    {
-        case 1: mask = 0x04;  break;
-        case 2: mask = 0x03;  break;
-        case 3: mask = 0x07;  break;
-        case 4: mask = 0x107; break;
-        case 5: mask = 0x37;  break;
-        case 6: mask = 0x3F;  break;
-      }
-
-#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
-	aften_wav_chmask_to_acmod(_wavheader-&gt;channels, mask, &amp;(_HANDLE-&gt;acmod), &amp;(_HANDLE-&gt;lfe));
-#else
-	aften_wav_channels_to_acmod(_wavheader-&gt;channels, mask, &amp;(_HANDLE-&gt;acmod), &amp;(_HANDLE-&gt;lfe));
-#endif
-
-   //   _HANDLE-&gt;params.verbose=2;
-    int er= aften_encode_init(_HANDLE);
-    if(er&lt;0)
-    {
-      printf(&quot;[Aften] init error %d\n&quot;,er); 
-      return 0;
-    }
-    _chunk=256*6*_wavheader-&gt;channels;
-    printf(&quot;[Aften] Initialized with fd %u Channels %u bitrate %u\n&quot;,_HANDLE-&gt;samplerate,
-                                                                    _HANDLE-&gt;channels,_HANDLE-&gt;params.bitrate);
-    return 1;
-}
-
-
-//______________________________________________
-uint8_t	AUDMEncoder_Aften::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  uint32_t count=0;
-  int r;
-  void *ptr;
-_again:
-        *len = 0;
-        _chunk=256*6*_wavheader-&gt;channels;
-        if(!refillBuffer(_chunk ))
-        {
-          return 0; 
-        }
-        ptr=(void *)&amp;(tmpbuffer[tmphead]);
-        ADM_assert(tmptail&gt;=tmphead);
-
-#ifdef USE_AFTEN_05
-		aften_remap_wav_to_a52(ptr, 256*6, _wavheader-&gt;channels, A52_SAMPLE_FMT_FLT, _HANDLE-&gt;acmod, _HANDLE-&gt;lfe);
-#else
-		aften_remap_wav_to_a52(ptr, 256*6, _wavheader-&gt;channels, A52_SAMPLE_FMT_FLT, _HANDLE-&gt;acmod);
-#endif
-
-        r=aften_encode_frame(_HANDLE, dest,(void *)ptr);
-        if(r&lt;0)
-        {
-          printf(&quot;[Aften] Encoding error %d\n&quot;,r);
-          return 0; 
-        }
-        
-        *samples=256*6;
-        *len=r;
-        tmphead+=_chunk;
-        return 1;
-}
-
-#endif		
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,222 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2002-6 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-
-    Interface to FAAC
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#ifdef USE_FAAC
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioencoder.h&quot;
-//
-
-#include &quot;faac.h&quot;
-#include &quot;audioencoder_faac.h&quot;
-
-AUDMEncoder_Faac::AUDMEncoder_Faac(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
-{
-  uint32_t channels;
-  channels=instream-&gt;getInfo()-&gt;channels;
-  switch(channels)
-  {
-    case 1:outputChannelMapping[1] = CH_FRONT_LEFT;break;
-    case 2:
-    	outputChannelMapping[0] = CH_FRONT_LEFT;
-    	outputChannelMapping[1] = CH_FRONT_RIGHT;
-      break;
-    default :
-    	outputChannelMapping[0] = CH_FRONT_CENTER;
-    	outputChannelMapping[1] = CH_FRONT_LEFT;
-    	outputChannelMapping[2] = CH_FRONT_RIGHT;
-    	outputChannelMapping[3] = CH_REAR_LEFT;
-    	outputChannelMapping[4] = CH_REAR_RIGHT;
-    	outputChannelMapping[5] = CH_LFE;
-  }
-};
-
-
-AUDMEncoder_Faac::~AUDMEncoder_Faac()
-{
-    if(_handle)
-        faacEncClose(_handle);
-    _handle=NULL;
-
-    printf(&quot;[FAAC] Deleting faac\n&quot;);
-    cleanup();
-};
-
-
-//________________________________________________
-//   Init lame encoder
-// frequence    : Impose frequency , 0 means reuse the incoming fq
-// mode                         : ADM_STEREO etc...
-// bitrate              : Bitrate in kbps (96,192...)
-// return 0 : init failed
-//                              1 : init succeeded
-//_______________________________________________
-#if 0
-uint8_t AUDMEncoder_Faac::init(ADM_audioEncoderDescriptor *config)
-{
-unsigned long int samples_input, max_bytes_output;
-faacEncConfigurationPtr cfg;
-int ret=0;
-
-    printf(&quot;[FAAC] Incoming Fq :%u\n&quot;,_wavheader-&gt;frequency);
-     _handle = faacEncOpen(_wavheader-&gt;frequency,
-                                 _wavheader-&gt;channels,
-                                 &amp;samples_input,
-                                &amp;max_bytes_output);
-    if(!_handle)
-    {
-          printf(&quot;Cannot open faac with fq=%lu chan=%lu br=%lu\n&quot;,
-          _wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate);
-          return 0;
-    }
-    printf(&quot; [FAAC] : Sample input:%d, max byte output%d \n&quot;,samples_input,max_bytes_output);
-    cfg= faacEncGetCurrentConfiguration(_handle);
-    
-    // Set default conf, same as ffmpeg
-    cfg-&gt;aacObjectType = LOW;
-    cfg-&gt;mpegVersion = MPEG4;
-    cfg-&gt;bandWidth= (_wavheader-&gt;frequency*3)/4; // Should be relevant
-    cfg-&gt;useTns = 0;
-    cfg-&gt;allowMidside = 0;
-    cfg-&gt;bitRate = (config-&gt;bitrate*1000)/_wavheader-&gt;channels; // It is per channel
-    cfg-&gt;outputFormat = 0; // 0 Raw 1 ADTS
-    cfg-&gt;inputFormat = FAAC_INPUT_FLOAT;
-    cfg-&gt;useLfe=0;	
-    if (!(ret=faacEncSetConfiguration(_handle, cfg))) 
-    {
-        printf(&quot;[FAAC] Cannot set conf for faac with fq=%lu chan=%lu br=%lu (err:%d)\n&quot;,
-				_wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate,ret);
-	return 0;
-    }
-     unsigned char *data=NULL;
-     unsigned long size=0;
-     if((ret=faacEncGetDecoderSpecificInfo(_handle, &amp;data,&amp;size)))
-     {
-        printf(&quot;FAAC: GetDecoderSpecific info failed (err:%d)\n&quot;,ret);
-        return 0;
-     }
-     _extraSize=size;
-     _extraData=new uint8_t[size];
-     memcpy(_extraData,data,size);
-
-    // update
-     _wavheader-&gt;byterate=(config-&gt;bitrate*1000)/8;
-//    _wavheader-&gt;dwScale=1024;
-//    _wavheader-&gt;dwSampleSize=0;
-    _wavheader-&gt;blockalign=4096;
-    _wavheader-&gt;bitspersample=0;
-
-    _chunk=samples_input;
-
-
-    printf(&quot;[Faac] Initialized :\n&quot;);
-    
-    printf(&quot;[Faac]Version        : %s\n&quot;,cfg-&gt;name);
-    printf(&quot;[Faac]Bitrate        : %lu\n&quot;,cfg-&gt;bitRate);
-    printf(&quot;[Faac]Mpeg2 (1)/4(0) : %u\n&quot;,cfg-&gt;mpegVersion);
-    printf(&quot;[Faac]Use lfe      ) : %u\n&quot;,cfg-&gt;useLfe);
-    printf(&quot;[Faac]Sample output  : %lu\n&quot;,_chunk / _wavheader-&gt;channels);
-    printf(&quot;[Faac]Bitrate        : %lu\n&quot;,cfg-&gt;bitRate*_wavheader-&gt;channels);
-
-    
-    return 1;
-}
-#endif
-//_____________________________________________
-//  Need to multiply the float by 32767, can't use
-//  generic fill buffer
-//----------------------------------------------
-uint8_t AUDMEncoder_Faac::refillBuffer(int minimum)
-{
-  uint32_t filler=_wavheader-&gt;frequency*_wavheader-&gt;channels;
-  uint32_t nb;
-  AUD_Status status;
-  if(eof_met) return 0;
-  while(1)
-  {
-    ADM_assert(tmptail&gt;=tmphead);
-    if((tmptail-tmphead)&gt;=minimum) return 1;
-  
-    if(tmphead &amp;&amp; tmptail&gt;filler/2)
-    {
-      memmove(&amp;tmpbuffer[0],&amp;tmpbuffer[tmphead],(tmptail-tmphead)*sizeof(float)); 
-      tmptail-=tmphead;
-      tmphead=0;
-    }
-    ADM_assert(filler&gt;tmptail);
-    nb=_incoming-&gt;fill( (filler-tmptail)/2,&amp;tmpbuffer[tmptail],&amp;status);
-    if(!nb)
-    {
-      if(status!=AUD_END_OF_STREAM) ADM_assert(0);
-      
-      if((tmptail-tmphead)&lt;minimum)
-      {
-        memset(&amp;tmpbuffer[tmptail],0,sizeof(float)*(minimum-(tmptail-tmphead)));
-        tmptail=tmphead+minimum;
-        eof_met=1;  
-        return minimum;
-      }
-      else continue;
-    } else
-    {
-      float *s=&amp;(tmpbuffer[tmptail]);
-      for(int i=0;i&lt;nb;i++)
-      {
-        *s=*s*32767.;
-        s++;
-      }
-      tmptail+=nb;
-    }
-  }
-}
-
-#define FA_BUFFER_SIZE (SIZE_INTERNAL/4)
-//______________________________________________
-uint8_t	AUDMEncoder_Faac::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  uint32_t count=0;
-_again:
-        *samples = _chunk/_wavheader-&gt;channels;
-        *len = 0;
-
-        if(!refillBuffer(_chunk ))
-        {
-          return 0; 
-        }
-        ADM_assert(tmptail&gt;=tmphead);
-        reorderChannels(&amp;(tmpbuffer[tmphead]),*samples,_incoming-&gt;getChannelMapping(),outputChannelMapping);
-        *len = faacEncEncode(_handle, (int32_t *)&amp;(tmpbuffer[tmphead]), _chunk, dest, FA_BUFFER_SIZE);
-        if(!*len) 
-        {
-          count++;
-          if(count&lt;20)
-            goto _again;
-          *samples=0;
-        }
-        tmphead+=_chunk;
-        return 1;
-}
-#endif		
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,147 +0,0 @@
-/***************************************************************************
-                        
-    copyright            : (C) 2002-2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-    
-    Interface to FFmpeg mpeg1/2 audio encoder
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioencoder.h&quot;
-//
-#include &quot;audioencoder_lavcodec.h&quot;
-
-#include &quot;ADM_lavcodec.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_AUDIO_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-#define CONTEXT ((AVCodecContext  	*)_context)
-
-
-// Ctor: Duplicate
-//__________
-
-AUDMEncoder_Lavcodec::AUDMEncoder_Lavcodec(uint32_t fourcc,AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
-{
-  _fourcc=fourcc;
-  if(_fourcc!=WAV_MP2 &amp;&amp; _fourcc!=WAV_AC3) ADM_assert(0);
-  _context=NULL;
-  _wavheader-&gt;encoding=_fourcc;
-  printf(&quot;[Lavcodec] Creating Lavcodec\n&quot;);
-};
-
-
-AUDMEncoder_Lavcodec::~AUDMEncoder_Lavcodec()
-{
-  printf(&quot;[Lavcodec] Deleting Lavcodec\n&quot;);
-  if(_context)
-  {
-    avcodec_close(CONTEXT);
-    ADM_dealloc(_context);
-  }
-  _context=NULL;
-  cleanup();
-};
-
-//________________________________________________
-//   Init lame encoder
-//_______________________________________________
-uint8_t AUDMEncoder_Lavcodec::init(ADM_audioEncoderDescriptor *config)
-{
-  int ret;
-  _context=( void *)avcodec_alloc_context();
-  _wavheader-&gt;byterate=(config-&gt;bitrate*1000)&gt;&gt;3;
-
-      
-  if(_fourcc==WAV_MP2 &amp;&amp; _incoming-&gt;getInfo()-&gt;channels&gt;2)
-  {
-    printf(&quot;[Lavcodec]Too many channels\n&quot;);
-    return 0; 
-  }
-  _wavheader-&gt;byterate=(config-&gt;bitrate*1000)&gt;&gt;3;         
-      
-  if(_fourcc==WAV_MP2)
-    _chunk = 1152*_wavheader-&gt;channels;
-  else
-    _chunk = 1536*_wavheader-&gt;channels; // AC3
-
-  printf(&quot;[Lavcodec]Incoming : fq : %lu, channel : %lu bitrate: %lu \n&quot;,
-         _wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate);
-  
-  
-  CONTEXT-&gt;channels     =  _wavheader-&gt;channels;
-  CONTEXT-&gt;sample_rate  =  _wavheader-&gt;frequency;
-  CONTEXT-&gt;bit_rate     = (config-&gt;bitrate*1000); // bits -&gt; kbits
-
-  AVCodec *codec;
-  CodecID codecID;
-  
-  if(_fourcc==WAV_MP2) codecID=CODEC_ID_MP2;
-        else codecID=CODEC_ID_AC3;
-  codec = avcodec_find_encoder(codecID);
-  ADM_assert(codec);
-  
-  ret = avcodec_open(CONTEXT, codec);
-  if (0&gt; ret) 
-  {
-    printf(&quot;[Lavcodec] init failed err : %d!\n&quot;,ret);
-    return 0;
-  }
-
-
-  printf(&quot;[Lavcodec]Lavcodec successfully initialized\n&quot;);
-  return 1;       
-}
-//*********************************
-uint8_t	AUDMEncoder_Lavcodec::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  uint32_t nbout;
-  
-  *samples = _chunk/_wavheader-&gt;channels; //FIXME
-  *len = 0;
-
-  if(!refillBuffer(_chunk ))
-  {
-    return 0; 
-  }
-        
-  if(tmptail-tmphead&lt;_chunk)
-  {
-    return 0; 
-  }
-
-  dither16(&amp;(tmpbuffer[tmphead]),_chunk,_wavheader-&gt;channels);
-
-  ADM_assert(tmptail&gt;=tmphead);
-  nbout = avcodec_encode_audio(CONTEXT, dest, 5000, (short *) &amp;(tmpbuffer[tmphead]));
-
-  tmphead+=_chunk;
-  if (nbout &lt; 0) 
-  {
-    printf(&quot;[Lavcodec] Error !!! : %ld\n&quot;, nbout);
-    return 0;
-  }
-  *len=nbout;
-  return 1;
-}
-
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,112 +0,0 @@
-/***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioencoder.h&quot;
-//
-#include &quot;audioencoder_pcm.h&quot;
-
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_AUDIO_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-
-
-// Ctor: Duplicate
-//__________
-
-AUDMEncoder_PCM::AUDMEncoder_PCM(uint32_t reverted,uint32_t fourCC,AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
-{
-  printf(&quot;[PCM] Creating PCM\n&quot;);
-  ADM_assert(fourCC==WAV_PCM || fourCC==WAV_LPCM);
-  _wavheader-&gt;encoding=fourCC;
-  revert=reverted;
-};
-
-
-AUDMEncoder_PCM::~AUDMEncoder_PCM()
-{
-  printf(&quot;[PCM] Deleting PCM\n&quot;);
-  cleanup();
-};
-
-//________________________________________________
-//   Init lame encoder
-// frequence    : Impose frequency , 0 means reuse the incoming fq
-// mode                         : ADM_STEREO etc...
-// bitrate              : Bitrate in kbps (96,192...)
-// return 0 : init failed
-//                              1 : init succeeded
-//_______________________________________________
-uint8_t AUDMEncoder_PCM::init(ADM_audioEncoderDescriptor *config)
-{
-  
-  _wavheader-&gt;byterate=_wavheader-&gt;channels*_wavheader-&gt;frequency*2;
-  _chunk = (_wavheader-&gt;frequency/100)*_wavheader-&gt;channels*2;
-  
-
- 
-  printf(&quot;[PCM]Incoming :fq : %lu, channel : %lu \n&quot;,_wavheader-&gt;frequency,_wavheader-&gt;channels);
-  printf(&quot;[PCM]PCM successfully initialized\n&quot;);
-  return 1;       
-}
-
-uint8_t	AUDMEncoder_PCM::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  uint32_t nbout;
-  
-  *samples = _chunk; //FIXME
-  *len = 0;
-
-  if(!refillBuffer(_chunk ))
-  {
-    return 0; 
-  }
-        
-  if(tmptail-tmphead&lt;_chunk)
-  {
-    return 0; 
-  }
-        // Do in place replace
-  dither16(&amp;(tmpbuffer[tmphead]),_chunk,_wavheader-&gt;channels);
-  if(!revert)
-    memcpy(dest,&amp;(tmpbuffer[tmphead]),_chunk*2);
-  else
-  {
-    uint16_t *in,*out,tmp;
-    in=(uint16_t*)&amp;(tmpbuffer[tmphead]);
-    out=(uint16_t *)dest;
-    for(int i=0;i&lt;_chunk;i++)
-    {
-      tmp=*in++;
-      tmp=((tmp&amp;0xff)&lt;&lt;8)+(tmp&gt;&gt;8);
-      *out++=tmp;
-    }
-  }
-  tmphead+=_chunk;
-  *len=_chunk*2;
-  *samples=_chunk/_wavheader-&gt;channels;
-  return 1;
-}
-
-
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,305 +0,0 @@
-/***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#ifdef USE_VORBIS
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioencoder.h&quot;
-//
-#include &quot;audioencoder_vorbis_param.h&quot;
-#include &quot;audioencoder_vorbis.h&quot;
-
-
-#include &quot;vorbis/vorbisenc.h&quot;
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_AUDIO_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-#define OPTIONS (twolame_options_struct *)_twolameOptions
-
-#define VD (((vorbisStruct *)_handle)-&gt;vd)
-#define VI (((vorbisStruct *)_handle)-&gt;vi)
-#define VB (((vorbisStruct *)_handle)-&gt;vb)
-#define VC (((vorbisStruct *)_handle)-&gt;vc)
-typedef struct vorbisStruct
-{ 
-	vorbis_info 	 vi ;
-	vorbis_dsp_state vd ;
-	vorbis_block     vb ;
-	vorbis_comment   vc ;
-}vorbisStruct;
-//__________
-
-AUDMEncoder_Vorbis::AUDMEncoder_Vorbis(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
-{
-  printf(&quot;[Vorbis] Creating Vorbis\n&quot;);
-  _handle=NULL;
-  _wavheader-&gt;encoding=WAV_OGG;
-  _oldpos=0;
-  _handle=(void *)new  vorbisStruct; 
-  outputChannelMapping[0] = CH_FRONT_LEFT;
-  outputChannelMapping[1] = CH_FRONT_RIGHT;
-  outputChannelMapping[2] = CH_REAR_LEFT;
-  outputChannelMapping[3] = CH_REAR_RIGHT;
-  outputChannelMapping[4] = CH_FRONT_CENTER;
-  outputChannelMapping[5] = CH_LFE;
-};
-
-
-AUDMEncoder_Vorbis::~AUDMEncoder_Vorbis()
-{
-  printf(&quot;[Vorbis] Deleting Vorbis\n&quot;);
-  if(_handle)
-  {
-    vorbis_block_clear(&amp;VB);
-    vorbis_dsp_clear(&amp;VD);
-    vorbis_info_clear(&amp;VI);
-    delete (vorbisStruct *)_handle;
-  }    	
-  _handle=NULL;
-  
-  cleanup();
-};
-
-//________________________________________________
-//   Init lame encoder
-// frequence    : Impose frequency , 0 means reuse the incoming fq
-// mode                         : ADM_STEREO etc...
-// bitrate              : Bitrate in kbps (96,192...)
-// return 0 : init failed
-//                              1 : init succeeded
-//_______________________________________________
-uint8_t AUDMEncoder_Vorbis::init(ADM_audioEncoderDescriptor *config)
-{
-  int ret;
-  VORBIS_encoderParam *vorbisConf=(VORBIS_encoderParam *)config-&gt;param;
-  ADM_assert(config-&gt;paramSize==sizeof(VORBIS_encoderParam));
-
-  ogg_packet header1,header2,header3;
-  int err;
-
-  
-  
-  vorbis_info_init(&amp;VI) ;
-
-  switch(vorbisConf-&gt;mode)
-  {
-    
-    case ADM_VORBIS_VBR:
-                      err=vorbis_encode_init(&amp;VI,
-                              _wavheader-&gt;channels,
-                              _wavheader-&gt;frequency,
-                              -1, // Max bitrate      
-                              config-&gt;bitrate*1000, //long nominal_bitrate,
-                              -1 //long min_bitrate))
-                            );
-                      break;
-    case  ADM_VORBIS_QUALITY :
-                    err=vorbis_encode_init_vbr(&amp;VI,
-                                _wavheader-&gt;channels,
-                                _wavheader-&gt;frequency,
-                                vorbisConf-&gt;quality/10
-                              );
-                    break;
-      
-    default:
-      ADM_assert(0);
-  }
-  if (err!=0) 
-  {
-	  delete (vorbisStruct*)_handle;
-	  _handle = NULL;
-
-    printf(&quot;[vorbis] init error %d\n&quot;,err);
-    return 0;
-  }
-  vorbis_analysis_init(&amp;VD, &amp;VI) ;
-  vorbis_block_init(&amp;VD, &amp;VB);
-  vorbis_comment_init(&amp;VC);
-  vorbis_comment_add_tag(&amp;VC, &quot;encoder&quot;, &quot;AVIDEMUX2&quot;) ;
-
-  vorbis_analysis_headerout(&amp;VD, &amp;VC, &amp;header1,
-                             &amp;header2, &amp;header3);
-
-
-// Store all headers as extra data
-// see ogg vorbis decode for details
-// we need 3 packets
-
-  _extraSize=header1.bytes+header2.bytes+header3.bytes+3*sizeof(uint32_t);
-  _extraData=new uint8_t[_extraSize];
-
-  uint32_t *ex=(uint32_t *)_extraData;
-  uint8_t *d;
-  d=_extraData+sizeof(uint32_t)*3;
-  ex[0]=header1.bytes;
-  ex[1]=header2.bytes;
-  ex[2]=header3.bytes;
-  memcpy(d,header1.packet,ex[0]);
-  d+=ex[0];
-  memcpy(d,header2.packet,ex[1]);
-  d+=ex[1];
-  memcpy(d,header3.packet,ex[2]);
-  vorbis_comment_clear(&amp;VC);
-			
-  printf(&quot;\n[Vorbis]Vorbis encoder initialized\n&quot;);
-  switch(vorbisConf-&gt;mode)
-  {
-    case ADM_VORBIS_VBR:
-      printf(&quot;[Vorbis]CBR Bitrate:%lu\n&quot;,config-&gt;bitrate);
-      break;
-    case ADM_VORBIS_QUALITY: //FIXME FIXME FIXME
-      printf(&quot;[Vorbis]VBR Quality:%.1f\n&quot;,vorbisConf-&gt;quality);
-    break;
-    default:
-      ADM_assert(0);
-  }
-   
-  printf(&quot;[Vorbis]Channels  :%lu\n&quot;,_wavheader-&gt;channels);
-  printf(&quot;[Vorbis]Frequency :%lu\n&quot;,_wavheader-&gt;frequency);
-  return 1;
-}
-
-#define ROUNDMAX 3000
-
-uint8_t	AUDMEncoder_Vorbis::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  uint32_t nbout;
-  uint32_t consumed=0;
-  float **float_samples;
-  ogg_packet op ;
-
-  *len = 0;
-  _chunk=1024*_wavheader-&gt;channels;
-  int count=ROUNDMAX;
-// Check that we have packet from previous pass
-  while(count--)
-  {
-    if(!refillBuffer(_chunk ))
-    {
-      return 0; 
-    }
-        
-    if(tmptail-tmphead&lt;_chunk)
-    {
-      return 0; 
-    }
-    
-	//printf(&quot;Round %d\n&quot;,ROUNDMAX-count);
-    if(vorbis_analysis_blockout(&amp;VD, &amp;VB) == 1) 
-    {
-      vorbis_analysis(&amp;VB, NULL);
-      vorbis_bitrate_addblock(&amp;VB) ;
-	//printf(&quot;Blockout\n&quot;);
-	
-      if(vorbis_bitrate_flushpacket(&amp;VD, &amp;op)) 
-      {
-        memcpy(dest, op.packet,op.bytes);
-        *len=op.bytes;
-        *samples=op.granulepos-_oldpos;
-        _oldpos=op.granulepos;
-        //  aprintf(&quot;1st packet :sampl:%lu len :%lu sample:%lu abs:%llu\n&quot;,*samples,op.bytes,total,op.granulepos);
-        return 1;
-      }
-    }
-
-    
-    uint32_t nbSample=(tmptail-tmphead)/_wavheader-&gt;channels;
-    if(nbSample&gt;1024) nbSample=1024;
-    float_samples=vorbis_analysis_buffer(&amp;VD, nbSample) ;
-    int index=tmphead;
-    // Put our samples in incoming buffer
-    reorderChannels(&amp;(tmpbuffer[tmphead]), nbSample,_incoming-&gt;getChannelMapping(),outputChannelMapping);
-    for (int i = 0; i &lt; nbSample; i++)
-      for (int j = 0; j &lt; _wavheader-&gt;channels; j++) {
-      float_samples[j][i] = tmpbuffer[index++];
-      if (float_samples[j][i] &gt; 1) float_samples[j][i] = 1;
-      if (float_samples[j][i] &lt; -1) float_samples[j][i] = -1;
-      }
-      // Buffer full, go go go
-      vorbis_analysis_wrote(&amp;VD, nbSample) ;  
-      tmphead+=nbSample*_wavheader-&gt;channels;	
-  }
-  return 0;
-	
-}
-/**
-      \fn DIA_getLameSettings
-      \brief Dialog to set lame settings
-      @return 1 on success, 0 on failure
-
-*/
-#include &quot;DIA_factory.h&quot;
-int DIA_getVorbisSettings(ADM_audioEncoderDescriptor *descriptor)
-  {
-    int ret=0;
-    char string[400];
-    uint32_t mmode,ppreset;
-    ELEM_TYPE_FLOAT qqual;
-#define SZT(x) sizeof(x)/sizeof(diaMenuEntry )
-#define PX(x) &amp;(lameParam-&gt;x)
-    
-    
-   VORBIS_encoderParam *vorbisParam;
-  ADM_assert(sizeof(VORBIS_encoderParam)==descriptor-&gt;paramSize);
-  vorbisParam=(VORBIS_encoderParam*)descriptor-&gt;param;
-  
-    mmode=vorbisParam-&gt;mode;
-    qqual=(ELEM_TYPE_FLOAT)vorbisParam-&gt;quality;
-    
-    diaMenuEntry channelMode[]={
-                             {ADM_VORBIS_VBR,      QT_TR_NOOP(&quot;VBR&quot;),NULL},
-                             {ADM_VORBIS_QUALITY,   QT_TR_NOOP(&quot;Quality based&quot;),NULL}};
-          
-    diaElemMenu menuMode(&amp;mmode,   QT_TR_NOOP(&quot;_Mode:&quot;), SZT(channelMode),channelMode);
-    
-#define BITRATE(x) {x,QT_TR_NOOP(#x)}
-    diaMenuEntry bitrateM[]={
-                              BITRATE(56),
-                              BITRATE(64),
-                              BITRATE(80),
-                              BITRATE(96),
-                              BITRATE(112),
-                              BITRATE(128),
-                              BITRATE(160),
-                              BITRATE(192),
-                              BITRATE(224)
-                          };
-    diaElemMenu bitrate(&amp;(descriptor-&gt;bitrate),   QT_TR_NOOP(&quot;_Bitrate:&quot;), SZT(bitrateM),bitrateM);
-    
-    diaElemFloat quality(&amp;qqual,QT_TR_NOOP(&quot;_Quality:&quot;),-1.,10.);
-    
-    
-    
-  
-      diaElem *elems[]={&amp;menuMode,&amp;bitrate,&amp;quality};
-    
-  if( diaFactoryRun(QT_TR_NOOP(&quot;Vorbis Configuration&quot;),3,elems))
-  {
-    vorbisParam-&gt;mode=(ADM_VORBIS_MODE)mmode;
-    vorbisParam-&gt;quality=(float)qqual;
-    
-    return 1;
-  }
-  return 0;
-}  
-
-#endif		
-// EOF

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt	2008-07-16 17:40:55 UTC (rev 4234)
@@ -1,17 +1,29 @@
-#######################################
-include (admCheckAudioEncoderLibs)
-include (admConfigSummary)
-MESSAGE(&quot;***  Audio Codec  ***&quot;)
-ADM_DISPLAY(&quot;Aften     &quot; &quot;${USE_AFTEN}&quot;)
-ADM_DISPLAY(&quot;LAME      &quot; &quot;${USE_LAME}&quot;)
-ADM_DISPLAY(&quot;FAAC      &quot; &quot;${USE_FAAC}&quot;)
-ADM_DISPLAY(&quot;Vorbis    &quot; &quot;${USE_VORBIS}&quot;)
-MESSAGE(&quot;***  /Audio Codec  ***&quot;)
-
-
+#######################################
+include (admCheckAudioEncoderLibs)
+include (admConfigSummary)
+MESSAGE(&quot;***  Audio Codec  ***&quot;)
+ADM_DISPLAY(&quot;Aften     &quot; &quot;${USE_AFTEN}&quot;)
+ADM_DISPLAY(&quot;LAME      &quot; &quot;${USE_LAME}&quot;)
+ADM_DISPLAY(&quot;FAAC      &quot; &quot;${USE_FAAC}&quot;)
+ADM_DISPLAY(&quot;Vorbis    &quot; &quot;${USE_VORBIS}&quot;)
+MESSAGE(&quot;***  /Audio Codec  ***&quot;)
+
+
 ADD_SUBDIRECTORY(twolame)
-
-if(USE_LAME)
-ADD_SUBDIRECTORY(lame)
-endif(USE_LAME)
-
+ADD_SUBDIRECTORY(pcm)
+
+if(USE_LAME)
+ADD_SUBDIRECTORY(lame)
+endif(USE_LAME)
+
+if(USE_AFTEN)
+# not tested ADD_SUBDIRECTORY(aften)
+endif(USE_AFTEN)
+
+if(USE_VORBIS)
+ADD_SUBDIRECTORY(vorbis)
+endif(USE_VORBIS)
+
+if(USE_FAAC)
+#ADD_SUBDIRECTORY(faac)
+endif(USE_FAAC)

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/CMakeLists.txt	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/CMakeLists.txt	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,12 @@
+	INCLUDE(ae_plugin)
+
+	SET(ADM_ae_aften_SRCS audioencoder_aften.cpp)
+
+	ADD_LIBRARY(ADM_ae_aften SHARED ${ADM_ae_aften_SRCS})
+
+	TARGET_LINK_LIBRARIES(ADM_ae_aften ${AFTEN_LIBRARY_DIR})
+
+	ADD_TARGET_CFLAGS(ADM_ae_aften &quot;-I${AFTEN_INCLUDE_DIR}&quot;)
+
+	INIT_AUDIO_ENCODER(ADM_ae_aften)
+	INSTALL_AUDIOENCODER(ADM_ae_aften)

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_aften.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,166 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+
+    Interface to Aften
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+#ifdef USE_AFTEN
+#include &quot;config.h&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;audioprocess.hxx&quot;
+#include &quot;audioeng_process.h&quot;
+#include &quot;audioencoder.h&quot;
+//
+extern &quot;C&quot;
+{
+#if defined(USE_AFTEN_06)
+	#include &quot;aften.h&quot;
+#else	// Aften 0.05 &amp; 0.07 onwards
+	#include &quot;aften/aften.h&quot;
+#endif
+};
+#include &quot;audioencoder_aften_param.h&quot;
+#include &quot;audioencoder_aften.h&quot;
+
+#define _HANDLE ((AftenContext *)_handle)
+AUDMEncoder_Aften::AUDMEncoder_Aften(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
+{
+  uint32_t channels;
+  channels=instream-&gt;getInfo()-&gt;channels;
+  _handle=(void *)new AftenContext;
+  memset(_handle,0,sizeof(AftenContext));
+  aften_set_defaults(_HANDLE);
+  _wavheader-&gt;encoding=WAV_AC3;
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
+#elif defined(USE_AFTEN_07)
+  _HANDLE-&gt;params.n_threads=1; // MThread collides with avidemux multithreading
+#else
+  _HANDLE-&gt;system.n_threads=1;
+#endif
+};
+
+
+AUDMEncoder_Aften::~AUDMEncoder_Aften()
+{
+    if(_handle)
+      aften_encode_close(_HANDLE);
+    delete(_HANDLE);
+    _handle=NULL;
+
+    printf(&quot;[Aften] Deleting aften\n&quot;);
+    cleanup();
+};
+
+
+//________________________________________________
+//   Init lame encoder
+// frequence    : Impose frequency , 0 means reuse the incoming fq
+// mode                         : ADM_STEREO etc...
+// bitrate              : Bitrate in kbps (96,192...)
+// return 0 : init failed
+//                              1 : init succeeded
+//_______________________________________________
+uint8_t AUDMEncoder_Aften::init(ADM_audioEncoderDescriptor *config)
+{
+
+
+int ret=0;
+
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
+int mask;
+#else
+unsigned int mask;
+#endif
+
+    _wavheader-&gt;byterate=(config-&gt;bitrate*1000)/8;
+    _HANDLE-&gt;sample_format=A52_SAMPLE_FMT_FLT;
+    _HANDLE-&gt;channels=_wavheader-&gt;channels;
+    _HANDLE-&gt;samplerate=_wavheader-&gt;frequency;
+    
+    _HANDLE-&gt;params.bitrate=config-&gt;bitrate;
+    switch(_wavheader-&gt;channels)
+    {
+        case 1: mask = 0x04;  break;
+        case 2: mask = 0x03;  break;
+        case 3: mask = 0x07;  break;
+        case 4: mask = 0x107; break;
+        case 5: mask = 0x37;  break;
+        case 6: mask = 0x3F;  break;
+      }
+
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
+	aften_wav_chmask_to_acmod(_wavheader-&gt;channels, mask, &amp;(_HANDLE-&gt;acmod), &amp;(_HANDLE-&gt;lfe));
+#else
+	aften_wav_channels_to_acmod(_wavheader-&gt;channels, mask, &amp;(_HANDLE-&gt;acmod), &amp;(_HANDLE-&gt;lfe));
+#endif
+
+   //   _HANDLE-&gt;params.verbose=2;
+    int er= aften_encode_init(_HANDLE);
+    if(er&lt;0)
+    {
+      printf(&quot;[Aften] init error %d\n&quot;,er); 
+      return 0;
+    }
+    _chunk=256*6*_wavheader-&gt;channels;
+    printf(&quot;[Aften] Initialized with fd %u Channels %u bitrate %u\n&quot;,_HANDLE-&gt;samplerate,
+                                                                    _HANDLE-&gt;channels,_HANDLE-&gt;params.bitrate);
+    return 1;
+}
+
+
+//______________________________________________
+uint8_t	AUDMEncoder_Aften::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+  uint32_t count=0;
+  int r;
+  void *ptr;
+_again:
+        *len = 0;
+        _chunk=256*6*_wavheader-&gt;channels;
+        if(!refillBuffer(_chunk ))
+        {
+          return 0; 
+        }
+        ptr=(void *)&amp;(tmpbuffer[tmphead]);
+        ADM_assert(tmptail&gt;=tmphead);
+
+#ifdef USE_AFTEN_05
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader-&gt;channels, A52_SAMPLE_FMT_FLT, _HANDLE-&gt;acmod, _HANDLE-&gt;lfe);
+#else
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader-&gt;channels, A52_SAMPLE_FMT_FLT, _HANDLE-&gt;acmod);
+#endif
+
+        r=aften_encode_frame(_HANDLE, dest,(void *)ptr);
+        if(r&lt;0)
+        {
+          printf(&quot;[Aften] Encoding error %d\n&quot;,r);
+          return 0; 
+        }
+        
+        *samples=256*6;
+        *len=r;
+        tmphead+=_chunk;
+        return 1;
+}
+
+#endif		
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,31 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioAften
+#define AUDMaudioAften
+#ifdef USE_AFTEN
+ //_____________________________________________
+class AUDMEncoder_Aften : public AUDMEncoder
+{
+protected:
+         void           *_handle;
+         
+public:
+                        uint8_t init(ADM_audioEncoderDescriptor *config);
+                virtual ~AUDMEncoder_Aften();
+                        AUDMEncoder_Aften(AUDMAudioFilter *instream);	
+                virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+};
+#endif
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften_param.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_aften_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/aften/audioencoder_aften_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,10 @@
+#ifndef AUDM_AFTEN_PARAM_H
+#define AUDM_AFTEN_PARAM_H
+#ifdef USE_AFTEN
+
+typedef struct AFTEN_encoderParam
+{
+  ADM_mode        mode;
+};
+#endif
+#endif

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/CMakeLists.txt	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/CMakeLists.txt	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,12 @@
+	INCLUDE(ae_plugin)
+
+	SET(ADM_ae_faac_SRCS audioencoder_faac.cpp)
+
+	ADD_LIBRARY(ADM_ae_faac SHARED ${ADM_ae_faac_SRCS})
+
+	TARGET_LINK_LIBRARIES(ADM_ae_faac ${FAAC_LIBRARY_DIR})
+
+	ADD_TARGET_CFLAGS(ADM_ae_faac &quot;-I${FAAC_INCLUDE_DIR}&quot;)
+
+	INIT_AUDIO_ENCODER(ADM_ae_faac)
+	INSTALL_AUDIOENCODER(ADM_ae_faac)

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,215 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+
+    Interface to FAAC
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;audioencoder.h&quot;
+//
+
+#include &quot;faac.h&quot;
+#include &quot;audioencoder_faac.h&quot;
+
+AUDMEncoder_Faac::AUDMEncoder_Faac(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
+{
+  uint32_t channels;
+  channels=instream-&gt;getInfo()-&gt;channels;
+  switch(channels)
+  {
+    case 1:outputChannelMapping[1] = CH_FRONT_LEFT;break;
+    case 2:
+    	outputChannelMapping[0] = CH_FRONT_LEFT;
+    	outputChannelMapping[1] = CH_FRONT_RIGHT;
+      break;
+    default :
+    	outputChannelMapping[0] = CH_FRONT_CENTER;
+    	outputChannelMapping[1] = CH_FRONT_LEFT;
+    	outputChannelMapping[2] = CH_FRONT_RIGHT;
+    	outputChannelMapping[3] = CH_REAR_LEFT;
+    	outputChannelMapping[4] = CH_REAR_RIGHT;
+    	outputChannelMapping[5] = CH_LFE;
+  }
+};
+
+
+AUDMEncoder_Faac::~AUDMEncoder_Faac()
+{
+    if(_handle)
+        faacEncClose(_handle);
+    _handle=NULL;
+
+    printf(&quot;[FAAC] Deleting faac\n&quot;);
+    cleanup();
+};
+
+
+//________________________________________________
+//   Init lame encoder
+// frequence    : Impose frequency , 0 means reuse the incoming fq
+// mode                         : ADM_STEREO etc...
+// bitrate              : Bitrate in kbps (96,192...)
+// return 0 : init failed
+//                              1 : init succeeded
+//_______________________________________________
+#if 0
+uint8_t AUDMEncoder_Faac::init(ADM_audioEncoderDescriptor *config)
+{
+unsigned long int samples_input, max_bytes_output;
+faacEncConfigurationPtr cfg;
+int ret=0;
+
+    printf(&quot;[FAAC] Incoming Fq :%u\n&quot;,_wavheader-&gt;frequency);
+     _handle = faacEncOpen(_wavheader-&gt;frequency,
+                                 _wavheader-&gt;channels,
+                                 &amp;samples_input,
+                                &amp;max_bytes_output);
+    if(!_handle)
+    {
+          printf(&quot;Cannot open faac with fq=%lu chan=%lu br=%lu\n&quot;,
+          _wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate);
+          return 0;
+    }
+    printf(&quot; [FAAC] : Sample input:%d, max byte output%d \n&quot;,samples_input,max_bytes_output);
+    cfg= faacEncGetCurrentConfiguration(_handle);
+    
+    // Set default conf, same as ffmpeg
+    cfg-&gt;aacObjectType = LOW;
+    cfg-&gt;mpegVersion = MPEG4;
+    cfg-&gt;bandWidth= (_wavheader-&gt;frequency*3)/4; // Should be relevant
+    cfg-&gt;useTns = 0;
+    cfg-&gt;allowMidside = 0;
+    cfg-&gt;bitRate = (config-&gt;bitrate*1000)/_wavheader-&gt;channels; // It is per channel
+    cfg-&gt;outputFormat = 0; // 0 Raw 1 ADTS
+    cfg-&gt;inputFormat = FAAC_INPUT_FLOAT;
+    cfg-&gt;useLfe=0;	
+    if (!(ret=faacEncSetConfiguration(_handle, cfg))) 
+    {
+        printf(&quot;[FAAC] Cannot set conf for faac with fq=%lu chan=%lu br=%lu (err:%d)\n&quot;,
+				_wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate,ret);
+	return 0;
+    }
+     unsigned char *data=NULL;
+     unsigned long size=0;
+     if((ret=faacEncGetDecoderSpecificInfo(_handle, &amp;data,&amp;size)))
+     {
+        printf(&quot;FAAC: GetDecoderSpecific info failed (err:%d)\n&quot;,ret);
+        return 0;
+     }
+     _extraSize=size;
+     _extraData=new uint8_t[size];
+     memcpy(_extraData,data,size);
+
+    // update
+     _wavheader-&gt;byterate=(config-&gt;bitrate*1000)/8;
+//    _wavheader-&gt;dwScale=1024;
+//    _wavheader-&gt;dwSampleSize=0;
+    _wavheader-&gt;blockalign=4096;
+    _wavheader-&gt;bitspersample=0;
+
+    _chunk=samples_input;
+
+
+    printf(&quot;[Faac] Initialized :\n&quot;);
+    
+    printf(&quot;[Faac]Version        : %s\n&quot;,cfg-&gt;name);
+    printf(&quot;[Faac]Bitrate        : %lu\n&quot;,cfg-&gt;bitRate);
+    printf(&quot;[Faac]Mpeg2 (1)/4(0) : %u\n&quot;,cfg-&gt;mpegVersion);
+    printf(&quot;[Faac]Use lfe      ) : %u\n&quot;,cfg-&gt;useLfe);
+    printf(&quot;[Faac]Sample output  : %lu\n&quot;,_chunk / _wavheader-&gt;channels);
+    printf(&quot;[Faac]Bitrate        : %lu\n&quot;,cfg-&gt;bitRate*_wavheader-&gt;channels);
+
+    
+    return 1;
+}
+#endif
+//_____________________________________________
+//  Need to multiply the float by 32767, can't use
+//  generic fill buffer
+//----------------------------------------------
+uint8_t AUDMEncoder_Faac::refillBuffer(int minimum)
+{
+  uint32_t filler=_wavheader-&gt;frequency*_wavheader-&gt;channels;
+  uint32_t nb;
+  AUD_Status status;
+  if(eof_met) return 0;
+  while(1)
+  {
+    ADM_assert(tmptail&gt;=tmphead);
+    if((tmptail-tmphead)&gt;=minimum) return 1;
+  
+    if(tmphead &amp;&amp; tmptail&gt;filler/2)
+    {
+      memmove(&amp;tmpbuffer[0],&amp;tmpbuffer[tmphead],(tmptail-tmphead)*sizeof(float)); 
+      tmptail-=tmphead;
+      tmphead=0;
+    }
+    ADM_assert(filler&gt;tmptail);
+    nb=_incoming-&gt;fill( (filler-tmptail)/2,&amp;tmpbuffer[tmptail],&amp;status);
+    if(!nb)
+    {
+      if(status!=AUD_END_OF_STREAM) ADM_assert(0);
+      
+      if((tmptail-tmphead)&lt;minimum)
+      {
+        memset(&amp;tmpbuffer[tmptail],0,sizeof(float)*(minimum-(tmptail-tmphead)));
+        tmptail=tmphead+minimum;
+        eof_met=1;  
+        return minimum;
+      }
+      else continue;
+    } else
+    {
+      float *s=&amp;(tmpbuffer[tmptail]);
+      for(int i=0;i&lt;nb;i++)
+      {
+        *s=*s*32767.;
+        s++;
+      }
+      tmptail+=nb;
+    }
+  }
+}
+
+#define FA_BUFFER_SIZE (SIZE_INTERNAL/4)
+//______________________________________________
+uint8_t	AUDMEncoder_Faac::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+  uint32_t count=0;
+_again:
+        *samples = _chunk/_wavheader-&gt;channels;
+        *len = 0;
+
+        if(!refillBuffer(_chunk ))
+        {
+          return 0; 
+        }
+        ADM_assert(tmptail&gt;=tmphead);
+        reorderChannels(&amp;(tmpbuffer[tmphead]),*samples,_incoming-&gt;getChannelMapping(),outputChannelMapping);
+        *len = faacEncEncode(_handle, (int32_t *)&amp;(tmpbuffer[tmphead]), _chunk, dest, FA_BUFFER_SIZE);
+        if(!*len) 
+        {
+          count++;
+          if(count&lt;20)
+            goto _again;
+          *samples=0;
+        }
+        tmphead+=_chunk;
+        return 1;
+}
+#endif		
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,31 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioAAC
+#define AUDMaudioAAC
+
+ //_____________________________________________
+class AUDMEncoder_Faac : public AUDMEncoder
+{
+protected:
+         void           *_handle;
+         uint8_t        refillBuffer(int minimum);
+public:
+//                        uint8_t init(ADM_audioEncoderDescriptor *config);
+                virtual ~AUDMEncoder_Faac();
+                        AUDMEncoder_Faac(AUDMAudioFilter *instream);	
+                virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac_param.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_faac_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,8 @@
+
+#ifndef FAAC_PARAM_H
+#define FAAC_PARAM_H
+typedef struct 
+{
+  uint32_t dummy;
+}FAAC_encoderParam;
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,147 @@
+/***************************************************************************
+                        
+    copyright            : (C) 2002-2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+    
+    Interface to FFmpeg mpeg1/2 audio encoder
+    
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;audioencoder.h&quot;
+//
+#include &quot;audioencoder_lavcodec.h&quot;
+
+#include &quot;ADM_lavcodec.h&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_AUDIO_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+
+#define CONTEXT ((AVCodecContext  	*)_context)
+
+
+// Ctor: Duplicate
+//__________
+
+AUDMEncoder_Lavcodec::AUDMEncoder_Lavcodec(uint32_t fourcc,AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
+{
+  _fourcc=fourcc;
+  if(_fourcc!=WAV_MP2 &amp;&amp; _fourcc!=WAV_AC3) ADM_assert(0);
+  _context=NULL;
+  _wavheader-&gt;encoding=_fourcc;
+  printf(&quot;[Lavcodec] Creating Lavcodec\n&quot;);
+};
+
+
+AUDMEncoder_Lavcodec::~AUDMEncoder_Lavcodec()
+{
+  printf(&quot;[Lavcodec] Deleting Lavcodec\n&quot;);
+  if(_context)
+  {
+    avcodec_close(CONTEXT);
+    ADM_dealloc(_context);
+  }
+  _context=NULL;
+  cleanup();
+};
+
+//________________________________________________
+//   Init lame encoder
+//_______________________________________________
+uint8_t AUDMEncoder_Lavcodec::init(ADM_audioEncoderDescriptor *config)
+{
+  int ret;
+  _context=( void *)avcodec_alloc_context();
+  _wavheader-&gt;byterate=(config-&gt;bitrate*1000)&gt;&gt;3;
+
+      
+  if(_fourcc==WAV_MP2 &amp;&amp; _incoming-&gt;getInfo()-&gt;channels&gt;2)
+  {
+    printf(&quot;[Lavcodec]Too many channels\n&quot;);
+    return 0; 
+  }
+  _wavheader-&gt;byterate=(config-&gt;bitrate*1000)&gt;&gt;3;         
+      
+  if(_fourcc==WAV_MP2)
+    _chunk = 1152*_wavheader-&gt;channels;
+  else
+    _chunk = 1536*_wavheader-&gt;channels; // AC3
+
+  printf(&quot;[Lavcodec]Incoming : fq : %lu, channel : %lu bitrate: %lu \n&quot;,
+         _wavheader-&gt;frequency,_wavheader-&gt;channels,config-&gt;bitrate);
+  
+  
+  CONTEXT-&gt;channels     =  _wavheader-&gt;channels;
+  CONTEXT-&gt;sample_rate  =  _wavheader-&gt;frequency;
+  CONTEXT-&gt;bit_rate     = (config-&gt;bitrate*1000); // bits -&gt; kbits
+
+  AVCodec *codec;
+  CodecID codecID;
+  
+  if(_fourcc==WAV_MP2) codecID=CODEC_ID_MP2;
+        else codecID=CODEC_ID_AC3;
+  codec = avcodec_find_encoder(codecID);
+  ADM_assert(codec);
+  
+  ret = avcodec_open(CONTEXT, codec);
+  if (0&gt; ret) 
+  {
+    printf(&quot;[Lavcodec] init failed err : %d!\n&quot;,ret);
+    return 0;
+  }
+
+
+  printf(&quot;[Lavcodec]Lavcodec successfully initialized\n&quot;);
+  return 1;       
+}
+//*********************************
+uint8_t	AUDMEncoder_Lavcodec::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+  uint32_t nbout;
+  
+  *samples = _chunk/_wavheader-&gt;channels; //FIXME
+  *len = 0;
+
+  if(!refillBuffer(_chunk ))
+  {
+    return 0; 
+  }
+        
+  if(tmptail-tmphead&lt;_chunk)
+  {
+    return 0; 
+  }
+
+  dither16(&amp;(tmpbuffer[tmphead]),_chunk,_wavheader-&gt;channels);
+
+  ADM_assert(tmptail&gt;=tmphead);
+  nbout = avcodec_encode_audio(CONTEXT, dest, 5000, (short *) &amp;(tmpbuffer[tmphead]));
+
+  tmphead+=_chunk;
+  if (nbout &lt; 0) 
+  {
+    printf(&quot;[Lavcodec] Error !!! : %ld\n&quot;, nbout);
+    return 0;
+  }
+  *len=nbout;
+  return 1;
+}
+
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_lavcodec.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,32 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioLavcodec
+#define AUDMaudioLavcodec
+ //_____________________________________________
+class AUDMEncoder_Lavcodec : public AUDMEncoder
+{
+  protected:
+   
+    void              *_context;
+    uint32_t          _fourcc;
+         
+  public:
+//            uint8_t     init(ADM_audioEncoderDescriptor *config);
+   virtual             ~AUDMEncoder_Lavcodec();
+                        AUDMEncoder_Lavcodec(uint32_t fourcc,AUDMAudioFilter *instream);	
+   virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/CMakeLists.txt	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/CMakeLists.txt	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,9 @@
+	INCLUDE(ae_plugin)
+
+	SET(ADM_ae_pcm_SRCS audioencoder_pcm.cpp)
+
+	ADD_LIBRARY(ADM_ae_pcm SHARED ${ADM_ae_pcm_SRCS})
+
+
+	INIT_AUDIO_ENCODER(ADM_ae_pcm)
+	INSTALL_AUDIOENCODER(ADM_ae_pcm)

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.cpp (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,138 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;audioencoder.h&quot;
+#include &quot;audioencoderInternal.h&quot;
+#include &quot;audioencoder_pcm.h&quot;
+
+
+
+
+/********************* Declare Plugin *****************************************************/
+ADM_DECLARE_AUDIO_ENCODER_PREAMBLE(AUDMEncoder_PCM);
+
+static ADM_audioEncoder encoderDesc = { 
+  ADM_AUDIO_ENCODER_API_VERSION,
+  create,			// Defined by macro automatically
+  destroy,			// Defined by macro automatically
+  NULL,		//** put your own function here**
+  &quot;PCM&quot;,            
+  &quot;PCM&quot;,      
+  &quot;PCM encoder plugin Mean 2008&quot;,             
+  6,                    // Max channels
+  1,0,0,                // Version
+  WAV_PCM,
+  200,                  // Priority
+  NULL,  // Defined by macro automatically
+  NULL,  // Defined by macro automatically
+
+  NULL,           // Defined by macro automatically
+  NULL,            // Defined by macro automatically 
+
+  NULL,         //** put your own function here**
+
+  NULL
+};
+//ADM_DECLARE_AUDIO_ENCODER_CONFIG(NULL);
+extern &quot;C&quot; ADM_audioEncoder *getInfo (void) 
+{ 
+  return &encoderDesc; 
+}  
+
+/******************* / Declare plugin*******************************************************/
+
+
+
+// Ctor: Duplicate
+//__________
+
+AUDMEncoder_PCM::AUDMEncoder_PCM(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
+{
+  printf(&quot;[PCM] Creating PCM\n&quot;);
+  _wavheader-&gt;encoding=WAV_PCM;
+  
+};
+
+
+AUDMEncoder_PCM::~AUDMEncoder_PCM()
+{
+  printf(&quot;[PCM] Deleting PCM\n&quot;);
+  cleanup();
+};
+
+/**
+    \fn initialize
+*/
+uint8_t AUDMEncoder_PCM::initialize(void)
+{
+  
+  _wavheader-&gt;byterate=_wavheader-&gt;channels*_wavheader-&gt;frequency*2;
+  _chunk = (_wavheader-&gt;frequency/100)*_wavheader-&gt;channels*2;
+  
+
+ 
+  printf(&quot;[PCM]Incoming :fq : %lu, channel : %lu \n&quot;,_wavheader-&gt;frequency,_wavheader-&gt;channels);
+  printf(&quot;[PCM]PCM successfully initialized\n&quot;);
+  return 1;       
+}
+/**
+    \fn getPacket
+*/
+
+uint8_t	AUDMEncoder_PCM::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+  uint32_t nbout;
+  
+  *samples = _chunk; //FIXME
+  *len = 0;
+
+  if(!refillBuffer(_chunk ))
+  {
+    return 0; 
+  }
+        
+  if(tmptail-tmphead&lt;_chunk)
+  {
+    return 0; 
+  }
+        // Do in place replace
+  dither16(&amp;(tmpbuffer[tmphead]),_chunk,_wavheader-&gt;channels);
+  if(1) //!revert)
+    memcpy(dest,&amp;(tmpbuffer[tmphead]),_chunk*2);
+  else
+  {
+    uint16_t *in,*out,tmp;
+    in=(uint16_t*)&amp;(tmpbuffer[tmphead]);
+    out=(uint16_t *)dest;
+    for(int i=0;i&lt;_chunk;i++)
+    {
+      tmp=*in++;
+      tmp=((tmp&amp;0xff)&lt;&lt;8)+(tmp&gt;&gt;8);
+      *out++=tmp;
+    }
+  }
+  tmphead+=_chunk;
+  *len=_chunk*2;
+  *samples=_chunk/_wavheader-&gt;channels;
+  return 1;
+}
+
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_pcm.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/pcm/audioencoder_pcm.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,36 @@
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioPCM
+#define AUDMaudioPCM
+
+/*!
+    This class is the float-&gt;PCM encoder.
+    It is somehow special as it can alsa be a LPCM encoder and a bigendian/littleendian swapper
+*/
+class AUDMEncoder_PCM : public AUDMEncoder
+{
+  protected:
+    uint32_t            revert;
+         
+  public:
+            uint8_t     initialize(void);
+            virtual     ~AUDMEncoder_PCM();
+                        /*! \param reverted : Should the endianness be reverted compared to system  
+                            \param fourCC   : FourCC to use (WAV_PCM/WAV_LPCM)
+                        */
+                         AUDMEncoder_PCM(AUDMAudioFilter * instream);
+    virtual uint8_t	     getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/twolame/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/twolame/CMakeLists.txt	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/twolame/CMakeLists.txt	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,13 @@
+	INCLUDE(ae_plugin)
+        subdirs(PREORDER ADM_libtwolame)
+
+	SET(ADM_ae_twolame_SRCS audioencoder_twolame.cpp)
+
+	ADD_LIBRARY(ADM_ae_twolame SHARED ${ADM_ae_twolame_SRCS})
+
+	TARGET_LINK_LIBRARIES(ADM_ae_twolame ADM_libtwolame)
+        include_directories(ADM_libtwolame)
+
+
+	INIT_AUDIO_ENCODER(ADM_ae_twolame)
+	INSTALL_AUDIOENCODER(ADM_ae_twolame)

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,305 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+#ifdef USE_VORBIS
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;audioencoder.h&quot;
+//
+#include &quot;audioencoder_vorbis_param.h&quot;
+#include &quot;audioencoder_vorbis.h&quot;
+
+
+#include &quot;vorbis/vorbisenc.h&quot;
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_AUDIO_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+
+#define OPTIONS (twolame_options_struct *)_twolameOptions
+
+#define VD (((vorbisStruct *)_handle)-&gt;vd)
+#define VI (((vorbisStruct *)_handle)-&gt;vi)
+#define VB (((vorbisStruct *)_handle)-&gt;vb)
+#define VC (((vorbisStruct *)_handle)-&gt;vc)
+typedef struct vorbisStruct
+{ 
+	vorbis_info 	 vi ;
+	vorbis_dsp_state vd ;
+	vorbis_block     vb ;
+	vorbis_comment   vc ;
+}vorbisStruct;
+//__________
+
+AUDMEncoder_Vorbis::AUDMEncoder_Vorbis(AUDMAudioFilter * instream)  :AUDMEncoder    (instream)
+{
+  printf(&quot;[Vorbis] Creating Vorbis\n&quot;);
+  _handle=NULL;
+  _wavheader-&gt;encoding=WAV_OGG;
+  _oldpos=0;
+  _handle=(void *)new  vorbisStruct; 
+  outputChannelMapping[0] = CH_FRONT_LEFT;
+  outputChannelMapping[1] = CH_FRONT_RIGHT;
+  outputChannelMapping[2] = CH_REAR_LEFT;
+  outputChannelMapping[3] = CH_REAR_RIGHT;
+  outputChannelMapping[4] = CH_FRONT_CENTER;
+  outputChannelMapping[5] = CH_LFE;
+};
+
+
+AUDMEncoder_Vorbis::~AUDMEncoder_Vorbis()
+{
+  printf(&quot;[Vorbis] Deleting Vorbis\n&quot;);
+  if(_handle)
+  {
+    vorbis_block_clear(&amp;VB);
+    vorbis_dsp_clear(&amp;VD);
+    vorbis_info_clear(&amp;VI);
+    delete (vorbisStruct *)_handle;
+  }    	
+  _handle=NULL;
+  
+  cleanup();
+};
+
+//________________________________________________
+//   Init lame encoder
+// frequence    : Impose frequency , 0 means reuse the incoming fq
+// mode                         : ADM_STEREO etc...
+// bitrate              : Bitrate in kbps (96,192...)
+// return 0 : init failed
+//                              1 : init succeeded
+//_______________________________________________
+uint8_t AUDMEncoder_Vorbis::init(ADM_audioEncoderDescriptor *config)
+{
+  int ret;
+  VORBIS_encoderParam *vorbisConf=(VORBIS_encoderParam *)config-&gt;param;
+  ADM_assert(config-&gt;paramSize==sizeof(VORBIS_encoderParam));
+
+  ogg_packet header1,header2,header3;
+  int err;
+
+  
+  
+  vorbis_info_init(&amp;VI) ;
+
+  switch(vorbisConf-&gt;mode)
+  {
+    
+    case ADM_VORBIS_VBR:
+                      err=vorbis_encode_init(&amp;VI,
+                              _wavheader-&gt;channels,
+                              _wavheader-&gt;frequency,
+                              -1, // Max bitrate      
+                              config-&gt;bitrate*1000, //long nominal_bitrate,
+                              -1 //long min_bitrate))
+                            );
+                      break;
+    case  ADM_VORBIS_QUALITY :
+                    err=vorbis_encode_init_vbr(&amp;VI,
+                                _wavheader-&gt;channels,
+                                _wavheader-&gt;frequency,
+                                vorbisConf-&gt;quality/10
+                              );
+                    break;
+      
+    default:
+      ADM_assert(0);
+  }
+  if (err!=0) 
+  {
+	  delete (vorbisStruct*)_handle;
+	  _handle = NULL;
+
+    printf(&quot;[vorbis] init error %d\n&quot;,err);
+    return 0;
+  }
+  vorbis_analysis_init(&amp;VD, &amp;VI) ;
+  vorbis_block_init(&amp;VD, &amp;VB);
+  vorbis_comment_init(&amp;VC);
+  vorbis_comment_add_tag(&amp;VC, &quot;encoder&quot;, &quot;AVIDEMUX2&quot;) ;
+
+  vorbis_analysis_headerout(&amp;VD, &amp;VC, &amp;header1,
+                             &amp;header2, &amp;header3);
+
+
+// Store all headers as extra data
+// see ogg vorbis decode for details
+// we need 3 packets
+
+  _extraSize=header1.bytes+header2.bytes+header3.bytes+3*sizeof(uint32_t);
+  _extraData=new uint8_t[_extraSize];
+
+  uint32_t *ex=(uint32_t *)_extraData;
+  uint8_t *d;
+  d=_extraData+sizeof(uint32_t)*3;
+  ex[0]=header1.bytes;
+  ex[1]=header2.bytes;
+  ex[2]=header3.bytes;
+  memcpy(d,header1.packet,ex[0]);
+  d+=ex[0];
+  memcpy(d,header2.packet,ex[1]);
+  d+=ex[1];
+  memcpy(d,header3.packet,ex[2]);
+  vorbis_comment_clear(&amp;VC);
+			
+  printf(&quot;\n[Vorbis]Vorbis encoder initialized\n&quot;);
+  switch(vorbisConf-&gt;mode)
+  {
+    case ADM_VORBIS_VBR:
+      printf(&quot;[Vorbis]CBR Bitrate:%lu\n&quot;,config-&gt;bitrate);
+      break;
+    case ADM_VORBIS_QUALITY: //FIXME FIXME FIXME
+      printf(&quot;[Vorbis]VBR Quality:%.1f\n&quot;,vorbisConf-&gt;quality);
+    break;
+    default:
+      ADM_assert(0);
+  }
+   
+  printf(&quot;[Vorbis]Channels  :%lu\n&quot;,_wavheader-&gt;channels);
+  printf(&quot;[Vorbis]Frequency :%lu\n&quot;,_wavheader-&gt;frequency);
+  return 1;
+}
+
+#define ROUNDMAX 3000
+
+uint8_t	AUDMEncoder_Vorbis::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+  uint32_t nbout;
+  uint32_t consumed=0;
+  float **float_samples;
+  ogg_packet op ;
+
+  *len = 0;
+  _chunk=1024*_wavheader-&gt;channels;
+  int count=ROUNDMAX;
+// Check that we have packet from previous pass
+  while(count--)
+  {
+    if(!refillBuffer(_chunk ))
+    {
+      return 0; 
+    }
+        
+    if(tmptail-tmphead&lt;_chunk)
+    {
+      return 0; 
+    }
+    
+	//printf(&quot;Round %d\n&quot;,ROUNDMAX-count);
+    if(vorbis_analysis_blockout(&amp;VD, &amp;VB) == 1) 
+    {
+      vorbis_analysis(&amp;VB, NULL);
+      vorbis_bitrate_addblock(&amp;VB) ;
+	//printf(&quot;Blockout\n&quot;);
+	
+      if(vorbis_bitrate_flushpacket(&amp;VD, &amp;op)) 
+      {
+        memcpy(dest, op.packet,op.bytes);
+        *len=op.bytes;
+        *samples=op.granulepos-_oldpos;
+        _oldpos=op.granulepos;
+        //  aprintf(&quot;1st packet :sampl:%lu len :%lu sample:%lu abs:%llu\n&quot;,*samples,op.bytes,total,op.granulepos);
+        return 1;
+      }
+    }
+
+    
+    uint32_t nbSample=(tmptail-tmphead)/_wavheader-&gt;channels;
+    if(nbSample&gt;1024) nbSample=1024;
+    float_samples=vorbis_analysis_buffer(&amp;VD, nbSample) ;
+    int index=tmphead;
+    // Put our samples in incoming buffer
+    reorderChannels(&amp;(tmpbuffer[tmphead]), nbSample,_incoming-&gt;getChannelMapping(),outputChannelMapping);
+    for (int i = 0; i &lt; nbSample; i++)
+      for (int j = 0; j &lt; _wavheader-&gt;channels; j++) {
+      float_samples[j][i] = tmpbuffer[index++];
+      if (float_samples[j][i] &gt; 1) float_samples[j][i] = 1;
+      if (float_samples[j][i] &lt; -1) float_samples[j][i] = -1;
+      }
+      // Buffer full, go go go
+      vorbis_analysis_wrote(&amp;VD, nbSample) ;  
+      tmphead+=nbSample*_wavheader-&gt;channels;	
+  }
+  return 0;
+	
+}
+/**
+      \fn DIA_getLameSettings
+      \brief Dialog to set lame settings
+      @return 1 on success, 0 on failure
+
+*/
+#include &quot;DIA_factory.h&quot;
+int DIA_getVorbisSettings(ADM_audioEncoderDescriptor *descriptor)
+  {
+    int ret=0;
+    char string[400];
+    uint32_t mmode,ppreset;
+    ELEM_TYPE_FLOAT qqual;
+#define SZT(x) sizeof(x)/sizeof(diaMenuEntry )
+#define PX(x) &amp;(lameParam-&gt;x)
+    
+    
+   VORBIS_encoderParam *vorbisParam;
+  ADM_assert(sizeof(VORBIS_encoderParam)==descriptor-&gt;paramSize);
+  vorbisParam=(VORBIS_encoderParam*)descriptor-&gt;param;
+  
+    mmode=vorbisParam-&gt;mode;
+    qqual=(ELEM_TYPE_FLOAT)vorbisParam-&gt;quality;
+    
+    diaMenuEntry channelMode[]={
+                             {ADM_VORBIS_VBR,      QT_TR_NOOP(&quot;VBR&quot;),NULL},
+                             {ADM_VORBIS_QUALITY,   QT_TR_NOOP(&quot;Quality based&quot;),NULL}};
+          
+    diaElemMenu menuMode(&amp;mmode,   QT_TR_NOOP(&quot;_Mode:&quot;), SZT(channelMode),channelMode);
+    
+#define BITRATE(x) {x,QT_TR_NOOP(#x)}
+    diaMenuEntry bitrateM[]={
+                              BITRATE(56),
+                              BITRATE(64),
+                              BITRATE(80),
+                              BITRATE(96),
+                              BITRATE(112),
+                              BITRATE(128),
+                              BITRATE(160),
+                              BITRATE(192),
+                              BITRATE(224)
+                          };
+    diaElemMenu bitrate(&amp;(descriptor-&gt;bitrate),   QT_TR_NOOP(&quot;_Bitrate:&quot;), SZT(bitrateM),bitrateM);
+    
+    diaElemFloat quality(&amp;qqual,QT_TR_NOOP(&quot;_Quality:&quot;),-1.,10.);
+    
+    
+    
+  
+      diaElem *elems[]={&amp;menuMode,&amp;bitrate,&amp;quality};
+    
+  if( diaFactoryRun(QT_TR_NOOP(&quot;Vorbis Configuration&quot;),3,elems))
+  {
+    vorbisParam-&gt;mode=(ADM_VORBIS_MODE)mmode;
+    vorbisParam-&gt;quality=(float)qqual;
+    
+    return 1;
+  }
+  return 0;
+}  
+
+#endif		
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,35 @@
+
+/***************************************************************************
+    copyright            : (C) 2002-6 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioVorbis
+#define AUDMaudioVorbis
+
+ //_____________________________________________
+class AUDMEncoder_Vorbis : public AUDMEncoder
+{
+  protected:
+   
+    void              *_handle;
+    uint64_t          _oldpos;
+
+         
+  public:
+//            uint8_t     init(ADM_audioEncoderDescriptor *config);
+            virtual     ~AUDMEncoder_Vorbis();
+                        AUDMEncoder_Vorbis(AUDMAudioFilter *instream);	
+            
+   virtual uint8_t	getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis_param.h (from rev 4233, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/include/audioencoder_vorbis_param.h	2008-07-16 17:40:50 UTC (rev 4233)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis_param.h	2008-07-16 17:40:55 UTC (rev 4234)
@@ -0,0 +1,17 @@
+#ifndef AUDM_VORBIS_PARAM_H
+#define AUDM_VORBIS_PARAM_H
+
+typedef enum 
+{
+  ADM_VORBIS_CBR,
+  ADM_VORBIS_VBR,
+  ADM_VORBIS_QUALITY
+  
+}ADM_VORBIS_MODE;
+
+typedef struct 
+{
+  ADM_VORBIS_MODE    mode;   // 0 cbr 1 vbr 2 quality
+  float              quality;
+}VORBIS_encoderParam;
+#endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001481.html">[Avidemux-svn-commit] r4233 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_coreAudio/include plugins/ADM_audioEncoders/twolame	plugins/ADM_audioEncoders/twolame/ADM_libtwolame
</A></li>
	<LI>Next message: <A HREF="001480.html">[Avidemux-svn-commit] r4235 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1479">[ date ]</a>
              <a href="thread.html#1479">[ thread ]</a>
              <a href="subject.html#1479">[ subject ]</a>
              <a href="author.html#1479">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
