<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4187 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audiodevice avidemux/ADM_audiofilter	avidemux/ADM_core/src cmake plugins/ADM_audioDevices	plugins/ADM_audioDevices/Arts plugins/ADM_audioDevices/Jack	plugins/ADM_audioDevices/Oss plugins/ADM_audioDevices/Sdl
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4187%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_audiodevice%20avidemux/ADM_audiofilter%0A%09avidemux/ADM_core/src%20cmake%20plugins/ADM_audioDevices%0A%09plugins/ADM_audioDevices/Arts%20plugins/ADM_audioDevices/Jack%0A%09plugins/ADM_audioDevices/Oss%20plugins/ADM_audioDevices/Sdl&In-Reply-To=%3C200807031929.m63JTZ0v029198%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001438.html">
   <LINK REL="Next"  HREF="001441.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4187 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audiodevice avidemux/ADM_audiofilter	avidemux/ADM_core/src cmake plugins/ADM_audioDevices	plugins/ADM_audioDevices/Arts plugins/ADM_audioDevices/Jack	plugins/ADM_audioDevices/Oss plugins/ADM_audioDevices/Sdl</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4187%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_audiodevice%20avidemux/ADM_audiofilter%0A%09avidemux/ADM_core/src%20cmake%20plugins/ADM_audioDevices%0A%09plugins/ADM_audioDevices/Arts%20plugins/ADM_audioDevices/Jack%0A%09plugins/ADM_audioDevices/Oss%20plugins/ADM_audioDevices/Sdl&In-Reply-To=%3C200807031929.m63JTZ0v029198%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4187 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audiodevice avidemux/ADM_audiofilter	avidemux/ADM_core/src cmake plugins/ADM_audioDevices	plugins/ADM_audioDevices/Arts plugins/ADM_audioDevices/Jack	plugins/ADM_audioDevices/Oss plugins/ADM_audioDevices/Sdl">mean at mail.berlios.de
       </A><BR>
    <I>Thu Jul  3 21:29:35 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001438.html">[Avidemux-svn-commit] r4186 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core:	include src
</A></li>
        <LI>Next message: <A HREF="001441.html">[Avidemux-svn-commit] r4188 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices:	. Win32
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1440">[ date ]</a>
              <a href="thread.html#1440">[ thread ]</a>
              <a href="subject.html#1440">[ subject ]</a>
              <a href="author.html#1440">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-07-03 21:29:34 +0200 (Thu, 03 Jul 2008)
New Revision: 4187

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/CMakeLists.txt
Log:
[AudioDevice] more, put dither16 in core to avoid missing symbols on win32


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.h	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.h	2008-07-03 19:29:34 UTC (rev 4187)
@@ -13,7 +13,7 @@
 #define ADM_AUDIODEVICE_H
 
 // Converts float to int16_t with dithering
-extern void dither16(float *start, uint32_t nb, uint8_t channels);
+#include &quot;ADM_coreAudio.h&quot;
 
  class audioDevice
  {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.cpp	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.cpp	2008-07-03 19:29:34 UTC (rev 4187)
@@ -95,44 +95,7 @@
   }
 }
 
-static float rand_table[DITHER_CHANNELS][DITHER_SIZE];
 
-void AUDMEncoder_initDither(void)
-{
-  printf(&quot;Initializing Dithering tables\n&quot;);
-	float d, dp;
-	for (int c = 0; c &lt; DITHER_CHANNELS; c++) {
-		dp = 0;
-		for (int i = 0; i &lt; DITHER_SIZE-1; i++) {
-			d = rand() / (float)RAND_MAX - 0.5;
-			rand_table[c][i] = d - dp;
-			dp = d;
-		}
-  		rand_table[c][DITHER_SIZE-1] = 0 - dp;
-	}
-}
-
-void dither16(float *start, uint32_t len, uint8_t channels)
-{
-	static uint16_t nr = 0;
-	int16_t *data_int = (int16_t *)start;
-	float *data = start;
-
-	len /= channels;
-	for (int i = 0; i &lt; len; i++) {
-		for (int c = 0; c &lt; channels; c++) {
-			*data = roundf(*data * 32766 + rand_table[c][nr]);
-			if (*data &gt; 32767.0f) *data = 32767;
-			if (*data &lt; -32768.0f) *data = -32768;
-			*data_int = (int16_t) *data;
-			data++;
-			data_int++;
-		}
-		nr++;
-		if (nr &gt;= DITHER_SIZE)
-			nr = 0;
-	}
-}
 /**
  * 	\fn reorderChannels
  *  \brief Reorder the channels

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.h	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioencoder.h	2008-07-03 19:29:34 UTC (rev 4187)
@@ -15,6 +15,7 @@
   \param maxChannels The maximum # of channels this codec supports
   \param param : An opaque structure that contains the codec specific configuration datas
 */
+#include &quot;ADM_coreAudio.h&quot;
 #include &quot;audioeng_buildfilters.h&quot;
 
 typedef struct ADM_audioEncoderDescriptor
@@ -32,10 +33,6 @@
   Base class for all audio encoder.It does the reverse of the bridge class and offers a proper GenericAudioStreamAPI
 
 */
-#define DITHER_SIZE 4800
-#define DITHER_CHANNELS 6
-void            AUDMEncoder_initDither();
-void dither16(float *start, uint32_t nb, uint8_t channels);
 
  //_____________________________________________
 class AUDMEncoder : public AVDMGenericAudioStream

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -1,6 +1,8 @@
 SET(ADM_core_SRCS 
 	ADM_cpuCap.cpp  ADM_memcpy.cpp  ADM_memsupport.cpp  ADM_threads.cpp  ADM_win32.cpp
-	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_crashdump.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp)
+	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_crashdump.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp
+        ADM_audioUtils.cpp
+)
 
 ADD_LIBRARY(ADM_core SHARED ${ADM_core_SRCS})
 ADD_TARGET_DEFINITIONS(ADM_core ADM_DEBUG FIND_LEAKS)
@@ -14,4 +16,4 @@
 
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)
 
-INSTALL(TARGETS ADM_core RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)
\ No newline at end of file
+INSTALL(TARGETS ADM_core RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-07-03 19:29:34 UTC (rev 4187)
@@ -16,7 +16,7 @@
 			MESSAGE(STATUS &quot;  version: ${alsaVersion}&quot;)
 			PRINT_LIBRARY_INFO(&quot;ALSA&quot; ALSA_FOUND &quot;${_ALSA_INCLUDE_DIR}&quot; &quot;${ASOUND_LIBRARY}&quot;)
 
-			SET(ALSA_SUPPORT 1)
+			SET(USE_ALSA 1)
 		ENDIF (ALSA_FOUND)
 	ELSE (ALSA)
 		MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
@@ -133,7 +133,7 @@
 		PRINT_LIBRARY_INFO(&quot;OSS&quot; OSS_FOUND &quot;${OSS_INCLUDE_DIR}&quot; &quot;&quot;)
 
 		IF (OSS_FOUND)
-			SET(OSS_SUPPORT 1)
+			SET(USE_OSS 1)
 		ENDIF (OSS_FOUND)
 	ELSE (OSS)
 		MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.cpp	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.cpp	2008-07-03 19:29:34 UTC (rev 4187)
@@ -15,17 +15,18 @@
  *                                                                         *
  ***************************************************************************/
 
-#include &quot;config.h&quot;
+
 #include &quot;ADM_default.h&quot;
 
-#ifdef USE_ARTS
+
 #include &lt;artsc.h&gt;
 
-#include &quot;ADM_audiodevice.h&quot;
-#include  &quot;ADM_audiodevice/ADM_deviceoss.h&quot;
-#include  &quot;ADM_audiodevice/ADM_deviceArts.h&quot;
+#include  &quot;ADM_audiodevice.h&quot;
+#include  &quot;ADM_audioDeviceInternal.h&quot;
+#include  &quot;ADM_deviceArts.h&quot;
 
 uint8_t artsInitialized=0;
+ADM_DECLARE_AUDIODEVICE(Arts,artsAudioDevice,1,0,0,&quot;Arts audio device (c) mean&quot;);
 //_______________________________________________
 //
 //
@@ -49,7 +50,7 @@
 //
 //
 //_______________________________________________
-uint8_t artsAudioDevice::init(uint8_t channels, uint32_t fq)
+uint8_t artsAudioDevice::init(uint32_t channels, uint32_t fq)
 {
 	_channels = channels;
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.h	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/ADM_deviceArts.h	2008-07-03 19:29:34 UTC (rev 4187)
@@ -15,19 +15,19 @@
  *                                                                         *
  ***************************************************************************/
 
- #ifdef USE_ARTS
-                 class artsAudioDevice : public audioDevice
+ 
+     class artsAudioDevice : public audioDevice
 	 {
 		 protected :
 		 		arts_stream_t _stream;
 		  public:
 		  			artsAudioDevice() {_stream=NULL;}
 				virtual ~artsAudioDevice() {stop();}
-		     		virtual uint8_t init(uint8_t channels, uint32_t fq);
+		     		virtual uint8_t init(uint32_t channels, uint32_t fq);
 	    			virtual uint8_t play(uint32_t len, float *data);
 		      		virtual uint8_t stop(void);
 				uint8_t setVolume(int volume);
 		 };
-#endif
 
 
+

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Arts/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -0,0 +1,10 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_arts_SRCS ADM_deviceArts.cpp)
+
+ADD_LIBRARY(ADM_av_arts SHARED ${ADM_av_arts_SRCS})
+TARGET_LINK_LIBRARIES(ADM_av_arts ${ARTS_LDFLAGS})
+ADD_DEFINITIONS(${ARTS_CFLAGS})
+INIT_AUDIO_DEVICE(ADM_av_arts)
+INSTALL_AUDIODEVICE(ADM_av_arts)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -1,7 +1,7 @@
 include(admCheckAudioDeviceLibs)
-if(ALSA_SUPPORT)
+if(USE_ALSA)
 ADD_SUBDIRECTORY(Alsa)
-endif(ALSA_SUPPORT)
+endif(USE_ALSA)
 
 if(USE_PULSE_SIMPLE)
 ADD_SUBDIRECTORY(PulseAudioSimple)
@@ -10,3 +10,20 @@
 if(USE_ESD)
 ADD_SUBDIRECTORY(Esd)
 endif(USE_ESD)
+
+if(USE_SDL)
+ADD_SUBDIRECTORY(Sdl)
+endif(USE_SDL)
+
+if(USE_OSS)
+ADD_SUBDIRECTORY(Oss)
+endif(USE_OSS)
+
+if(USE_ARTS)
+ADD_SUBDIRECTORY(Arts)
+endif(USE_ARTS)
+
+if(USE_JACK)
+ADD_SUBDIRECTORY(Jack)
+endif(USE_JACK)
+#

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -0,0 +1,11 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_jack_SRCS ADM_deviceJack.cpp)
+
+ADD_LIBRARY(ADM_av_jack SHARED ${ADM_av_jack_SRCS})
+TARGET_LINK_LIBRARIES(ADM_av_jack ${JACK_LIBRARY_DIR})
+include_directories(${JACK_INCLUDE_DIR})
+
+INIT_AUDIO_DEVICE(ADM_av_jack)
+INSTALL_AUDIODEVICE(ADM_av_jack)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp	2008-07-03 19:29:34 UTC (rev 4187)
@@ -14,12 +14,12 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include &quot;config.h&quot;
 
-#ifdef OSS_SUPPORT
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;unistd.h&gt;
+#include &quot;ADM_default.h&quot;
+
+#include  &quot;ADM_audiodevice.h&quot;
+#include  &quot;ADM_audioDeviceInternal.h&quot;
+
 #include &lt;errno.h&gt;
 
 #include &lt;fcntl.h&gt;
@@ -38,18 +38,12 @@
 	#include &lt;sys/soundcard.h&gt;
 	const char *dsp = &quot;/dev/dsp&quot;;
         const char *device_mixer = &quot;/dev/mixer&quot;;
-
 #endif
- 
- 
 
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_audiodevice.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include  &quot;ADM_audiodevice/ADM_deviceoss.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-#include &quot;prefs.h&quot;
+#include  &quot;ADM_deviceoss.h&quot;
 
+ADM_DECLARE_AUDIODEVICE(Oss,ossAudioDevice,1,0,0,&quot;Oss audio device (c) mean&quot;);
+
 //_______________________________________________
 //
 //
@@ -60,14 +54,14 @@
 	int ret;
 	uint32_t which_vol = 0;
 
-	prefs-&gt;get(FEATURE_AUDIOBAR_USES_MASTER,&amp;which_vol);
+	//prefs-&gt;get(FEATURE_AUDIOBAR_USES_MASTER,&amp;which_vol);
         fd=open(device_mixer,O_RDONLY);
         if(!fd)
         {
-                printf(&quot;OSS: cannot open mixer\n&quot;);
+                printf(&quot;[OSSS]: cannot open mixer\n&quot;);
                 return 0;
         }
-        printf(&quot;Oss: New %s volume %d\n&quot;,(which_vol?&quot;master&quot;:&quot;pcm&quot;),volume);
+        printf(&quot;[OSSS]: New %s volume %d\n&quot;,(which_vol?&quot;master&quot;:&quot;pcm&quot;),volume);
         // Assuming stereo
         volume=volume+(volume&lt;&lt;8);
 	if( which_vol ){
@@ -79,9 +73,9 @@
 
 	if( ret ){
 		if( errno == EBADF ){
-			printf(&quot;set mixer failed: %u (possible access issue)\n&quot;,errno);
+			printf(&quot;[OSSS]set mixer failed: %u (possible access issue)\n&quot;,errno);
 		}else{
-			printf(&quot;set mixer failed: %u\n&quot;,errno);
+			printf(&quot;[OSSS]set mixer failed: %u\n&quot;,errno);
 		}
 	}
         return 1;
@@ -104,36 +98,38 @@
 //
 //
 //_______________________________________________
-uint8_t ossAudioDevice::init(uint8_t channels, uint32_t fq) 
+uint8_t ossAudioDevice::init(uint32_t channels, uint32_t fq) 
 {
 	_channels = channels;
  
-    printf(&quot;\n OSS  : %lu Hz, %lu channels&quot;, fq, channels);
+    printf(&quot;[OSSS]: %lu Hz, %lu channels\n&quot;, fq, channels);
     // open OSS device
     oss_fd = open(dsp, O_WRONLY | O_NONBLOCK);
     if (oss_fd == -1) {
+/*
 	if( errno == EACCES )
 	{
           GUI_Error_HIG(QT_TR_NOOP(&quot;Could not open OSS audio device&quot;), QT_TR_NOOP(&quot;Check the permissions for /dev/dsp.&quot;));
 	  }
 	else
-           printf(&quot;\n Error initializing OSS: Error : %d&quot;, errno);
+*/
+           printf(&quot;[OSSS] Error initializing OSS: Error : %d\n&quot;, errno);
         return 0;
     }
     // seems ok, set up audio 
     if (ioctl (oss_fd, SNDCTL_DSP_SPEED, &amp;fq) &lt; 0) {
-        printf(&quot;\n Error setting up OSS(SPEED): Error : %d&quot;, errno);
+        printf(&quot;[OSSS] Error setting up OSS(SPEED): Error : %d\n&quot;, errno);
         return 0;
     }
     if (channels &gt; 2) {
         if (ioctl (oss_fd, SNDCTL_DSP_CHANNELS, &amp;channels) &lt; 0) {
-	    printf(&quot;\n Error setting up OSS(CHANNELS): Error : %d&quot;, errno);
+	    printf(&quot;[OSSS] Error setting up OSS(CHANNELS): Error : %d\n&quot;, errno);
 	    return 0;
         }
     } else {
         int chan = channels - 1;
         if (ioctl (oss_fd, SNDCTL_DSP_STEREO, &amp;chan) &lt; 0) {
-	    printf(&quot;\n Error setting up OSS(STEREO): Error : %d&quot;, errno);
+	    printf(&quot;[OSSS] Error setting up OSS(STEREO): Error : %d\n&quot;, errno);
 	    return 0;
         }
     }
@@ -143,7 +139,7 @@
     int fmt = AFMT_S16_LE;
 #endif    
     if (ioctl (oss_fd, SNDCTL_DSP_SETFMT, &amp;fmt) &lt; 0) {
-        printf(&quot;\n Error setting up OSS(FORMAT): Error : %d&quot;, errno);
+        printf(&quot;[OSSS] Error setting up OSS(FORMAT): Error : %d\n&quot;, errno);
         return 0;
     }
 
@@ -170,10 +166,4 @@
         }
 	return 1;
 }
-#else
-void dummy_oss_func( void);
-void dummy_oss_func( void)
- {
-}
-
-#endif
+//EOF

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.h	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/ADM_deviceoss.h	2008-07-03 19:29:34 UTC (rev 4187)
@@ -14,16 +14,16 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#ifdef OSS_SUPPORT
+
 class ossAudioDevice : public audioDevice
 {
 protected :
                                 int oss_fd;
 public:
                                         ossAudioDevice(void) {oss_fd=0;}
-                        virtual uint8_t init(uint8_t channels, uint32_t fq);
+                        virtual uint8_t init(uint32_t channels, uint32_t fq);
                         virtual uint8_t play(uint32_t len, float *data);
                         virtual uint8_t stop(void);
 			uint8_t setVolume(int volume);
 }     ;
-#endif
+

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Oss/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -0,0 +1,9 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_oss_SRCS ADM_deviceoss.cpp)
+
+ADD_LIBRARY(ADM_av_oss SHARED ${ADM_av_oss_SRCS})
+include_directories(${OSS_INCLUDE_DIR})
+INIT_AUDIO_DEVICE(ADM_av_oss)
+INSTALL_AUDIODEVICE(ADM_av_oss)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp	2008-07-03 19:29:34 UTC (rev 4187)
@@ -4,32 +4,21 @@
 // Description: 
 //
 //
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004-2008
 //
 // Copyright: See COPYING file that comes with this distribution
 //
 //
 
-#include &quot;config.h&quot;
-#include &lt;errno.h&gt;
 
-
 #include &quot;ADM_default.h&quot;
-  
- 
-#ifdef USE_SDL
 #include &quot;SDL.h&quot;
 
+#include  &quot;ADM_audiodevice.h&quot;
+#include  &quot;ADM_audioDeviceInternal.h&quot;
 
+#include &quot;ADM_deviceSDL.h&quot;
 
-#include &quot;ADM_audiodevice.h&quot;
-#include &quot;ADM_audiodevice/ADM_deviceoss.h&quot;
-#include &quot;ADM_audiodevice/ADM_deviceALSA.h&quot;
-#include &quot;ADM_audiodevice/ADM_deviceSDL.h&quot;
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME  MODULE_ADEVICE
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
 static int16_t  		*audioBuffer=NULL;
 static uint32_t 		frameCount=0;
 static uint32_t			rd_ptr=0;
@@ -46,6 +35,9 @@
 #define BUFFER_SIZE (2*48000)
 #endif
 
+ADM_DECLARE_AUDIODEVICE(Sdl,sdlAudioDevice,1,0,0,&quot;Sdl audio device (c) mean&quot;);
+
+#define aprintf(...) {}
 //_______________________________________________
 //
 //_______________________________________________
@@ -142,7 +134,7 @@
 //
 //
 //_______________________________________________
-uint8_t sdlAudioDevice::init(uint8_t channels, uint32_t fq) 
+uint8_t sdlAudioDevice::init(uint32_t channels, uint32_t fq) 
 {
 SDL_AudioSpec spec,result;
 _channels = channels;
@@ -266,11 +258,5 @@
 	return 1;
 }
 
-#else
-void dummy_as_func( void);
-void dummy_as_func( void)
- {
-}
 
-#endif
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h	2008-07-03 19:29:34 UTC (rev 4187)
@@ -9,18 +9,17 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#ifdef USE_SDL
 
-	        class sdlAudioDevice : public audioDevice
+
+    class sdlAudioDevice : public audioDevice
 	 {
 		 protected :
 					uint8_t				_inUse;
 		  public:
 		  				sdlAudioDevice(void);
-		     		virtual uint8_t init(uint8_t channels, uint32_t fq);
+		     		virtual uint8_t init(uint32_t channels, uint32_t fq);
 	    			virtual uint8_t play(uint32_t len, float *data);
 		      		virtual uint8_t stop(void);
 				uint8_t setVolume(int volume);
 		 }     ;
 
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/CMakeLists.txt	2008-07-03 19:29:32 UTC (rev 4186)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Sdl/CMakeLists.txt	2008-07-03 19:29:34 UTC (rev 4187)
@@ -0,0 +1,11 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_sdl_SRCS ADM_deviceSDL.cpp)
+
+ADD_LIBRARY(ADM_av_sdl SHARED ${ADM_av_sdl_SRCS})
+TARGET_LINK_LIBRARIES(ADM_av_sdl ${SDL_LIBRARY})
+SDLify(ADM_deviceSDL.cpp)
+
+INIT_AUDIO_DEVICE(ADM_av_sdl)
+INSTALL_AUDIODEVICE(ADM_av_sdl)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001438.html">[Avidemux-svn-commit] r4186 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core:	include src
</A></li>
	<LI>Next message: <A HREF="001441.html">[Avidemux-svn-commit] r4188 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices:	. Win32
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1440">[ date ]</a>
              <a href="thread.html#1440">[ thread ]</a>
              <a href="subject.html#1440">[ subject ]</a>
              <a href="author.html#1440">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
