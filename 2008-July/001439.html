<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4185 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiodevice	avidemux/ADM_userInterfaces/ADM_commonUI cmake	plugins/ADM_audioDevices plugins/ADM_audioDevices/Alsa	plugins/ADM_audioDevices/Esd	plugins/ADM_audioDevices/PulseAudioSimple
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4185%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audiodevice%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20cmake%0A%09plugins/ADM_audioDevices%20plugins/ADM_audioDevices/Alsa%0A%09plugins/ADM_audioDevices/Esd%0A%09plugins/ADM_audioDevices/PulseAudioSimple&In-Reply-To=%3C200807031929.m63JTViG029134%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001437.html">
   <LINK REL="Next"  HREF="001438.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4185 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiodevice	avidemux/ADM_userInterfaces/ADM_commonUI cmake	plugins/ADM_audioDevices plugins/ADM_audioDevices/Alsa	plugins/ADM_audioDevices/Esd	plugins/ADM_audioDevices/PulseAudioSimple</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4185%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audiodevice%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20cmake%0A%09plugins/ADM_audioDevices%20plugins/ADM_audioDevices/Alsa%0A%09plugins/ADM_audioDevices/Esd%0A%09plugins/ADM_audioDevices/PulseAudioSimple&In-Reply-To=%3C200807031929.m63JTViG029134%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4185 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiodevice	avidemux/ADM_userInterfaces/ADM_commonUI cmake	plugins/ADM_audioDevices plugins/ADM_audioDevices/Alsa	plugins/ADM_audioDevices/Esd	plugins/ADM_audioDevices/PulseAudioSimple">mean at mail.berlios.de
       </A><BR>
    <I>Thu Jul  3 21:29:31 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001437.html">[Avidemux-svn-commit] r4184 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiodevice	avidemux/ADM_userInterfaces/ADM_commonUI cmake plugins	plugins/ADM_audioDevices plugins/ADM_audioDevices/Alsa	plugins/ADM_audioDevices/Arts plugins/ADM_audioDevices/AudioCore	plugins/ADM_audioDevices/Esd plugins/ADM_audioDevices/Jack	plugins/ADM_audioDevices/Oss plugins/ADM_audioDevices/Sdl	plugins/ADM_audioDevices/Win32
</A></li>
        <LI>Next message: <A HREF="001438.html">[Avidemux-svn-commit] r4186 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core:	include src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1439">[ date ]</a>
              <a href="thread.html#1439">[ thread ]</a>
              <a href="subject.html#1439">[ subject ]</a>
              <a href="author.html#1439">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-07-03 21:29:30 +0200 (Thu, 03 Jul 2008)
New Revision: 4185

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/CMakeLists.txt
Modified:
   branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/audio_out.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/CMakeLists.txt
Log:
[AudioDevices] Alsa fixup+Esd


Modified: branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -142,7 +142,7 @@
 ENDIF (NOT QT4_FOUND)
 
 INCLUDE(admCheckAudioCodecLibs)
-INCLUDE(admCheckAudioDeviceLibs)
+#INCLUDE(admCheckAudioDeviceLibs)
 INCLUDE(admCheckMiscLibs)
 
 ########################################

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.cpp	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/ADM_audiodevice.cpp	2008-07-03 19:29:30 UTC (rev 4185)
@@ -48,8 +48,6 @@
     dummyAudioDevice *a=(dummyAudioDevice *)z;
 }
 // --------- couple of stubs for dummy device  -------------
-uint32_t ADM_av_getNbDevices(void);
-bool     ADM_av_getDeviceInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
 
 /**
         \fn ADM_av_getNbDevices

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/audio_out.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/audio_out.h	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiodevice/audio_out.h	2008-07-03 19:29:30 UTC (rev 4185)
@@ -30,6 +30,9 @@
 void 		AVDM_AudioClose(void);
 AUDIO_DEVICE 	AVDM_getCurrentDevice( void);
 uint8_t         AVDM_setVolume(int volume);
+// Get infos
+uint32_t ADM_av_getNbDevices(void);
+bool     ADM_av_getDeviceInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
 
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-07-03 19:29:30 UTC (rev 4185)
@@ -285,51 +285,21 @@
                               ,{3,      QT_TR_NOOP(&quot;Pro Logic II&quot;),NULL}
          };
         diaElemMenu menuMixer(&amp;downmix,QT_TR_NOOP(&quot;_Local playback downmixing:&quot;), sizeof(mixerEntries)/sizeof(diaMenuEntry),mixerEntries,&quot;&quot;);
-
-		diaMenuEntry audioEntries[] =
-		{
-#if 0
-		#ifdef ALSA_SUPPORT
-			{DEVICE_ALSA, QT_TR_NOOP(&quot;ALSA&quot;)},
-		#endif
-		#ifdef USE_ARTS
-			{DEVICE_ARTS, QT_TR_NOOP(&quot;aRts&quot;)},
-		#endif
-		#ifdef __APPLE__
-			{DEVICE_COREAUDIO, QT_TR_NOOP(&quot;Core Audio&quot;)},
-		#endif
-		#ifdef USE_ESD
-			{DEVICE_ESD, QT_TR_NOOP(&quot;ESD&quot;)},
-		#endif
-		#ifdef USE_JACK
-			{DEVICE_JACK, QT_TR_NOOP(&quot;JACK&quot;)},
-		#endif
-		#ifdef OSS_SUPPORT
-			{DEVICE_OSS, QT_TR_NOOP(&quot;OSS&quot;)},
-		#endif
-		#if	defined(USE_SDL) &amp;&amp; !defined(__WIN32)
-			{DEVICE_SDL, QT_TR_NOOP(&quot;SDL&quot;)},
-		#endif
-		#ifdef __WIN32
-			{DEVICE_WIN32, QT_TR_NOOP(&quot;Win32&quot;)},
-		#endif
-#endif
-			{0, QT_TR_NOOP(&quot;None&quot;)}
-		};
-
-        diaElemMenu menuAudio(&amp;newdevice,QT_TR_NOOP(&quot;_Audio output:&quot;), sizeof(audioEntries)/sizeof(diaMenuEntry),audioEntries,&quot;&quot;);
-                
-#if 0 //def ALSA_SUPPORT
-		diaElemText entryAlsaDevice(&amp;alsaDevice,QT_TR_NOOP(&quot;ALSA _device:&quot;),NULL);
-
-          int z,m;
-          m=sizeof(audioEntries)/sizeof(diaMenuEntry);
-          for(z=0;z&lt;m;z++)
-          {
-            if(audioEntries[z].val==DEVICE_ALSA)
-                menuAudio.link(&amp;(audioEntries[z]),1,&amp;entryAlsaDevice);
-          }
-#endif
+//*********** AV_
+		
+//***AV
+        uint32_t nbAudioDevice=ADM_av_getNbDevices();
+        diaMenuEntryDynamic *audioDeviceItems[nbAudioDevice+1];
+        audioDeviceItems[0]=new diaMenuEntryDynamic(0,&quot;Dummy&quot;,&quot;Dummy&quot;);
+        for(int i=0;i&lt;nbAudioDevice;i++)
+        {
+            const char *name;
+            uint32_t major,minor,patch;
+            ADM_av_getDeviceInfo(i, &amp;name, &amp;major,&amp;minor,&amp;patch);
+            audioDeviceItems[i+1]=new diaMenuEntryDynamic(i+1,name,name);
+        }
+        diaElemMenuDynamic menuAudio(&amp;newdevice,QT_TR_NOOP(&quot;_AudioDevice&quot;), nbAudioDevice+1, 
+                    audioDeviceItems,NULL);
         // default Post proc
      diaElemToggle     fhzd(&amp;hzd,QT_TR_NOOP(&quot;_Horizontal deblocking&quot;));
      diaElemToggle     fvzd(&amp;vzd,QT_TR_NOOP(&quot;_Vertical deblocking&quot;));
@@ -516,6 +486,11 @@
 				initSdl(render);
 			#endif
 	}
+        for(int i=0;i&lt;nbAudioDevice+1;i++)
+        {
+            
+            delete audioDeviceItems[i];
+        }
 
 	ADM_dealloc(filterPath);
 	ADM_dealloc(globalGlyphName);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -375,7 +375,7 @@
 		TARGET_LINK_LIBRARIES(avidemux2_qt4 ${SDL_LIBRARY})
 	ENDIF (ADM_UI_QT4)
 ENDIF (USE_SDL)
-
+if(0)
 # aRts
 IF (USE_ARTS)
 	IF (ADM_UI_GTK)
@@ -387,33 +387,11 @@
 	ENDIF (ADM_UI_QT4)
 ENDIF (USE_ARTS)
 
-# ALSA
-IF (ALSA_FOUND)
-	IF (ADM_UI_GTK)
-		TARGET_LINK_LIBRARIES(avidemux2_gtk ${ASOUND_LIBRARY})
-	ENDIF (ADM_UI_GTK)
-
-	IF (ADM_UI_QT4)
-		TARGET_LINK_LIBRARIES(avidemux2_qt4 ${ASOUND_LIBRARY})
-	ENDIF (ADM_UI_QT4)
-ENDIF (ALSA_FOUND)
-
-# ESD
-IF (USE_ESD)
-	IF (ADM_UI_GTK)
-		TARGET_LINK_LIBRARIES(avidemux2_gtk ${ESD_LIBRARY_DIR})
-	ENDIF (ADM_UI_GTK)
-
-	IF (ADM_UI_QT4)
-		TARGET_LINK_LIBRARIES(avidemux2_qt4 ${ESD_LIBRARY_DIR})
-	ENDIF (ADM_UI_QT4)
-ENDIF (USE_ESD)
-
 # JACK
 IF (USE_JACK)
 	ADD_LIB_ALL_TARGETS(&quot;${JACK_LIBRARY_DIR}&quot;)
 ENDIF (USE_JACK)
-
+endif(0)
 # LAME
 IF (HAVE_LIBMP3LAME)
 	ADD_LIB_ALL_TARGETS(&quot;${LAME_LIBRARY_DIR}&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-07-03 19:29:30 UTC (rev 4185)
@@ -142,4 +142,54 @@
 	MESSAGE(&quot;&quot;)
 ELSE (UNIX AND NOT APPLE)
 	SET(OSS_CAPABLE FALSE)
-ENDIF (UNIX AND NOT APPLE)
\ No newline at end of file
+ENDIF (UNIX AND NOT APPLE)
+########################################
+# PulseAudioSimple
+########################################
+IF (UNIX AND NOT APPLE)
+	OPTION(PULSEAUDIOSIMPLE &quot;&quot; ON)
+
+	MESSAGE(STATUS &quot;Checking for PULSEAUDIOSIMPLE&quot;)
+	MESSAGE(STATUS &quot;*****************************&quot;)
+        IF (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
+        # in cache already
+         SET(PULSEAUDIOSIMPLE_FIND_QUIETLY TRUE)
+        ENDIF (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
+
+           # use pkg-config to get the directories and then use these values
+        # in the FIND_PATH() and FIND_LIBRARY() calls
+        INCLUDE(UsePkgConfig)
+        PKGCONFIG(libpulse-simple _PASIncDir _PASLinkDir _PASLinkFlags _PASCflags)
+        SET(PULSEAUDIOSIMPLE_DEFINITIONS ${_PASCflags})
+
+        FIND_PATH(PULSEAUDIOSIMPLE_INCLUDE_DIR pulse/simple.h
+        PATHS
+        ${_PASIncDir}
+        PATH_SUFFIXES pulse
+        )
+
+        FIND_LIBRARY(PULSEAUDIOSIMPLE_LIBRARIES NAMES pulse-simple libpulse-simple
+        PATHS
+        ${_PASLinkDir}
+        )
+
+        IF (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
+         SET(PULSEAUDIOSIMPLE_FOUND TRUE)
+        ELSE (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
+         SET(PULSEAUDIOSIMPLE_FOUND FALSE)
+        ENDIF (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
+
+        IF (PULSEAUDIOSIMPLE_FOUND)
+         IF (NOT PULSEAUDIOSIMPLE_FIND_QUIETLY)
+          MESSAGE(STATUS &quot;Found PulseAudio Simple: ${PULSEAUDIOSIMPLE_LIBRARIES}&quot;)
+        ENDIF (NOT PULSEAUDIOSIMPLE_FIND_QUIETLY)
+        SET(USE_PULSE_SIMPLE 1)
+        ELSE (PULSEAUDIOSIMPLE_FOUND)
+         MESSAGE(STATUS &quot;Could NOT find PulseAudioSimple&quot;)
+        ENDIF (PULSEAUDIOSIMPLE_FOUND)
+
+        MARK_AS_ADVANCED(PULSEAUDIOSIMPLE_INCLUDE_DIR PULSEAUDIOSIMPLE_LIBRARIES)
+
+ELSE (UNIX AND NOT APPLE)
+	SET(PULSEAUDIOSIMPLE_CAPABLE FALSE)
+ENDIF (UNIX AND NOT APPLE)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp	2008-07-03 19:29:30 UTC (rev 4185)
@@ -62,7 +62,7 @@
   static char *pcm_name;
 //  if( prefs-&gt;get(DEVICE_AUDIO_ALSA_DEVICE, &amp;pcm_name) != RC_OK )
                pcm_name = ADM_strdup(&quot;dmix&quot;);
-
+    printf(&quot;[Alsa] Using device :%s\n&quot;,pcm_name);
  /* Allocate the snd_pcm_hw_params_t structure on the stack. */
     snd_pcm_hw_params_alloca(&amp;hwparams);
     snd_pcm_sw_params_alloca(&amp;swparams);
@@ -74,14 +74,14 @@
     /* specified, SIGIO will be emitted whenever a period has     */
     /* been completely processed by the soundcard.                */
     if (snd_pcm_open(&amp;pcm_handle, pcm_name, stream, SND_PCM_NONBLOCK) &lt; 0) {
-      fprintf(stderr, &quot;Error opening PCM device %s\n&quot;, pcm_name);
+      fprintf(stderr, &quot;[Alsa]Error opening PCM device %s\n&quot;, pcm_name);
       return(0);
     }
     // past this point we got _init=1 -&gt; partially initialized
     _init=1;
       /* Init hwparams with full configuration space */
     if (snd_pcm_hw_params_any(pcm_handle, hwparams) &lt; 0) {
-      fprintf(stderr, &quot;Can not configure this PCM device.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Can not configure this PCM device.\n&quot;);
       ADM_dealloc(pcm_name);
       return(0);
     }
@@ -93,7 +93,7 @@
     /* access, but this is beyond the scope   */
     /* of this introduction.                  */
     if (snd_pcm_hw_params_set_access(pcm_handle, hwparams, SND_PCM_ACCESS_RW_INTERLEAVED) &lt; 0) {
-      fprintf(stderr, &quot;Error setting access.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Error setting access.\n&quot;);
       return(0);
     }
 
@@ -107,7 +107,7 @@
     if (snd_pcm_hw_params_set_format(pcm_handle, hwparams, SND_PCM_FORMAT_S16_LE) &lt; 0)
 #endif
     {
-      fprintf(stderr, &quot;Error setting format.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Error setting format.\n&quot;);
       return(0);
     }
 	//}
@@ -117,12 +117,12 @@
     dir=0;
     exact_rate = snd_pcm_hw_params_set_rate_near(pcm_handle, hwparams, &amp;fq, &amp;dir);
     if (dir != 0) {
-      fprintf(stderr, &quot;The rate %lu Hz is not supported by your hardware.\n  ==&gt; Using %d Hz instead.\n&quot;, fq, exact_rate);
+      fprintf(stderr, &quot;[Alsa]The rate %lu Hz is not supported by your hardware.\n  ==&gt; Using %d Hz instead.\n&quot;, fq, exact_rate);
     }
 
     /* Set number of channels */
     if (snd_pcm_hw_params_set_channels(pcm_handle, hwparams, channel) &lt; 0) {
-      fprintf(stderr, &quot;Error setting channels.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Error setting channels.\n&quot;);
       return(0);
     }
 #if 0
@@ -130,7 +130,7 @@
 	uint32_t periodsize=1;
     /* Set number of periods. Periods used to be called fragments. */
     if (snd_pcm_hw_params_set_periods(pcm_handle, hwparams, periods, 0) &lt; 0) {
-      fprintf(stderr, &quot;Error setting periods.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Error setting periods.\n&quot;);
       return(0);
     }
 #else
@@ -142,7 +142,7 @@
 
 	if ((er=snd_pcm_hw_params_set_buffer_time_near(pcm_handle, hwparams, &amp;buffer_time, &amp;dir)) &lt; 0)
 	  {
-	    printf(&quot;Error : hw_params_set_buffer_time\n&quot;);
+	    printf(&quot;[Alsa]Error : hw_params_set_buffer_time\n&quot;);
 	    return(0);
 	  }
 	  // unsigned ?
@@ -153,7 +153,7 @@
 	if (snd_pcm_hw_params_set_period_time_near(pcm_handle, hwparams, buffer_time&gt;&gt;2, 0) &lt; 0)
 	  /* original: alsa_buffer_time/ao_data.bps */
 	  {
-	    printf(&quot;Error : hw_params_set_period_time\n&quot;);
+	    printf(&quot;[Alsa]Error : hw_params_set_period_time\n&quot;);
 	    return(0);
 	  }
 #endif
@@ -168,33 +168,33 @@
     /* Apply HW parameter settings to */
     /* PCM device and prepare device  */
     if (snd_pcm_hw_params(pcm_handle, hwparams) &lt; 0) {
-      fprintf(stderr, &quot;Error setting HW params.\n&quot;);
+      fprintf(stderr, &quot;[Alsa]Error setting HW params.\n&quot;);
       return(0);
     }
 
  	if (snd_pcm_sw_params_current(pcm_handle, swparams) &lt; 0)
 	    {
-	      printf(&quot;Error setting SW params.\n&quot;);
+	      printf(&quot;[Alsa]Error setting SW params.\n&quot;);
 	      return(0);
 	    }
 
  	// be sure that playback starts immediatly (or near)
 	  if (snd_pcm_sw_params_set_avail_min(pcm_handle, swparams, 4) &lt; 0)
 	    {
-	      printf(&quot;Error setting set_avail_min \n&quot;);
+	      printf(&quot;[Alsa]Error setting set_avail_min \n&quot;);
 	      return(0);
 	    }
 
 	  if (snd_pcm_sw_params(pcm_handle, swparams) &lt; 0)
 	    {
-	      printf(&quot;Error:snd_pcm_sw_params\n &quot;);
+	      printf(&quot;[Alsa]Error:snd_pcm_sw_params\n &quot;);
 	      return(0);
 	    }
 
 
       if ( snd_pcm_prepare(pcm_handle) &lt; 0)
 	{
-	  printf(&quot;Error : snd_pcm_prepare\n&quot;);
+	  printf(&quot;[Alsa]Error : snd_pcm_prepare\n&quot;);
 	  return(0);
 	}
 
@@ -233,16 +233,16 @@
 			{
 				case    -EAGAIN :
 					//wait a bit to flush datas
-					printf(&quot;ALSA EAGAIN\n&quot;);
+					printf(&quot;[Alsa]ALSA EAGAIN\n&quot;);
 					snd_pcm_wait(pcm_handle, 1000);
 					continue;
 
 				case    -EPIPE:
-					printf(&quot;ALSA EPIPE\n&quot;);
+					printf(&quot;[Alsa]ALSA EPIPE\n&quot;);
 					snd_pcm_prepare(pcm_handle);
 					continue;
 				default:
-					printf(&quot;ALSA Error %d : Play %s (len=%lu)\n&quot;,ret, snd_strerror(ret),len);
+					printf(&quot;[Alsa]ALSA Error %d : Play %s (len=%lu)\n&quot;,ret, snd_strerror(ret),len);
 					return 1;
 			}
 		}
@@ -268,7 +268,7 @@
     snd_pcm_drain(pcm_handle);
       if (snd_pcm_close(pcm_handle) &lt; 0)
       {
-		printf(&quot;\n Troubles closing alsa\n&quot;);
+		printf(&quot;[Alsa] Troubles closing alsa\n&quot;);
 
       }
      }
@@ -290,25 +290,25 @@
     pcm_name = ADM_strdup(&quot;hw:0&quot;);
     which_vol = 0;
 	if( (rc=snd_mixer_open(&amp;mixer_handle,0)) &lt; 0 ){
-		printf(&quot;ALSA: snd_mixer_open failed: %d\n&quot;,rc);
+		printf(&quot;[Alsa]: snd_mixer_open failed: %d\n&quot;,rc);
 		ADM_dealloc(pcm_name);
 		return 0;
 	}
 // MEANX: Cannot use the real name, does not work with dmix
 	if( (rc=snd_mixer_attach(mixer_handle,&quot;hw:0&quot;)) &lt; 0 ){
-		printf(&quot;ALSA: snd_mixer_attach failed: %d, %s\n&quot;,rc, snd_strerror (rc));
+		printf(&quot;[Alsa]: snd_mixer_attach failed: %d, %s\n&quot;,rc, snd_strerror (rc));
 		snd_mixer_close(mixer_handle);
 		ADM_dealloc(pcm_name);
 		return 0;
 	}
 	ADM_dealloc(pcm_name);
 	if( (rc=snd_mixer_selem_register(mixer_handle,NULL,NULL)) &lt; 0 ){
-		printf(&quot;ALSA: snd_mixer_selem_register failed: %d\n&quot;,rc);
+		printf(&quot;[Alsa]: snd_mixer_selem_register failed: %d\n&quot;,rc);
 		snd_mixer_close(mixer_handle);
 		return 0;
 	}
 	if( (rc=snd_mixer_load(mixer_handle)) &lt; 0 ){
-		printf(&quot;ALSA: snd_mixer_load failed: %d\n&quot;,rc);
+		printf(&quot;[Alsa]: snd_mixer_load failed: %d\n&quot;,rc);
 		snd_mixer_close(mixer_handle);
 		return 0;
 	}
@@ -332,9 +332,9 @@
 				printf(&quot;ALSA: old val: %lu\n&quot;,val*100/max);
 				*/
 				if( (rc=snd_mixer_selem_set_playback_volume_all(elem,volume*max/100)) &lt; 0 ){
-					printf(&quot;ALSA: snd_mixer_selem_set_playback_volume_all failed: %d\n&quot;,rc);
+					printf(&quot;[Alsa]: snd_mixer_selem_set_playback_volume_all failed: %d\n&quot;,rc);
 				}
-				printf(&quot;ALSA: new %s val: %lu\n&quot;,(which_vol?&quot;master&quot;:&quot;pcm&quot;),volume);
+				printf(&quot;[Alsa]: new %s val: %lu\n&quot;,(which_vol?&quot;master&quot;:&quot;pcm&quot;),volume);
 				break;
 			}
 		}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Alsa/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -4,7 +4,7 @@
 SET(ADM_av_alsa_SRCS ADM_deviceALSA.cpp)
 
 ADD_LIBRARY(ADM_av_alsa SHARED ${ADM_av_alsa_SRCS})
-#TARGET_LINK_LIBRARIES(ADM_av_alsa ADM_libalsa)
+TARGET_LINK_LIBRARIES(ADM_av_alsa ${ASOUND_LIBRARY})
 
 INIT_AUDIO_DEVICE(ADM_av_alsa)
 INSTALL_AUDIODEVICE(ADM_av_alsa)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -1 +1,12 @@
+include(admCheckAudioDeviceLibs)
+if(ALSA_SUPPORT)
 ADD_SUBDIRECTORY(Alsa)
+endif(ALSA_SUPPORT)
+
+if(USE_PULSE_SIMPLE)
+ADD_SUBDIRECTORY(PulseAudioSimple)
+endif(USE_PULSE_SIMPLE)
+
+if(USE_ESD)
+ADD_SUBDIRECTORY(Esd)
+endif(USE_ESD)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp	2008-07-03 19:29:30 UTC (rev 4185)
@@ -15,26 +15,16 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include &quot;config.h&quot;
-
-#if defined(USE_ESD)
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;errno.h&gt;
-
-#include &lt;fcntl.h&gt;
-#include &lt;sys/ioctl.h&gt;
-#include &lt;esd.h&gt;
-
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_audiodevice.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_audiodevice/ADM_deviceoss.h&quot;
-#include &quot;ADM_audiodevice/ADM_deviceALSA.h&quot;
-#include  &quot;ADM_audiodevice/ADM_deviceEsd.h&quot;
 
 
+#include  &quot;ADM_audiodevice.h&quot;
+#include  &quot;ADM_audioDeviceInternal.h&quot;
+
+#include  &quot;ADM_deviceEsd.h&quot;
+#include &lt;esd.h&gt;
+ADM_DECLARE_AUDIODEVICE(Esd,esdAudioDevice,1,0,0,&quot;Esd audio device (c) mean&quot;);
 //_______________________________________________
 //
 //
@@ -51,7 +41,7 @@
 //
 //
 //_______________________________________________
-uint8_t esdAudioDevice::init(uint8_t channels, uint32_t fq) 
+uint8_t esdAudioDevice::init(uint32_t channels, uint32_t fq) 
 {
 esd_format_t format;
 _channels = channels;
@@ -102,10 +92,4 @@
 	return 1;
 }
 
-#else
-void dummy_ess_func( void);
-void dummy_ess_func( void)
- {
-}
-
-#endif
+//EOF

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h	2008-07-03 19:29:30 UTC (rev 4185)
@@ -14,16 +14,16 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#ifdef USE_ESD
+
 class esdAudioDevice : public audioDevice
 	 {
 		 protected :
                     int esdDevice;
 		  public:
 		  			esdAudioDevice(void) {esdDevice=-1;}
-		     		virtual uint8_t init(uint8_t channels, uint32_t fq);
+		     		virtual uint8_t init(uint32_t channels, uint32_t fq);
 	    			virtual uint8_t play(uint32_t len, float *data);
 		      		virtual uint8_t stop(void);
-				uint8_t setVolume(int volume);
+                            uint8_t setVolume(int volume);
 		 }     ;
-#endif
+

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -0,0 +1,12 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_esd_SRCS ADM_deviceEsd.cpp)
+
+ADD_LIBRARY(ADM_av_esd SHARED ${ADM_av_esd_SRCS})
+INCLUDE_DIRECTORIES(${ESD_INCLUDE_DIR})
+TARGET_LINK_LIBRARIES(ADM_av_esd ${ESD_LIBRARY_DIR})
+
+
+INIT_AUDIO_DEVICE(ADM_av_esd)
+INSTALL_AUDIODEVICE(ADM_av_esd)

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2008-07-03 19:29:30 UTC (rev 4185)
@@ -0,0 +1,123 @@
+/***************************************************************************
+                          ADM_devicePulseSimple.cpp  -  description
+
+  Simple Pulse audio out
+                          
+    copyright            : (C) 2008 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_audiodevice.h&quot;
+
+
+#include  &quot;ADM_audiodevice.h&quot;
+#include  &quot;ADM_audioDeviceInternal.h&quot;
+#include  &quot;ADM_devicePulseSimple.h&quot;
+#include  &quot;pulse/simple.h&quot;
+
+ADM_DECLARE_AUDIODEVICE(PulseAudioS,pulseSimpleAudioDevice,1,0,0,&quot;PulseAudioSimple audio device (c) mean&quot;);
+
+//#define ADM_PULSE_INT16
+/**
+    \fn pulseSimpleAudioDevice
+    \brief Constructor
+
+*/
+pulseSimpleAudioDevice::pulseSimpleAudioDevice()
+{
+    instance=NULL;
+}
+
+#define INSTANCE  ((pa_simple *)instance)
+/**
+    \fn stop
+    \brief stop &amp; release device
+
+*/
+
+uint8_t  pulseSimpleAudioDevice::stop(void) 
+{
+int er;
+    if(!instance) return 1;
+    ADM_assert(instance);
+    pa_simple_flush(INSTANCE,&amp;er);
+    pa_simple_free(INSTANCE);
+    instance=NULL;
+    printf(&quot;[PulseAudio] Stopped\n&quot;);
+    return 1;
+}
+
+/**
+    \fn init
+    \brief Take &amp; initialize the device
+
+*/
+uint8_t pulseSimpleAudioDevice::init(uint32_t channels, uint32_t fq) 
+{
+
+pa_simple *s;
+pa_sample_spec ss;
+int er;
+ 
+#ifdef ADM_PULSE_INT16
+  ss.format = PA_SAMPLE_S16NE;
+#else
+    ss.format = PA_SAMPLE_FLOAT32NE;//PA_SAMPLE_S16NE; //FIXME big endian
+#endif
+  ss.channels = channels;
+  ss.rate =fq;
+ 
+  instance= pa_simple_new(NULL,               // Use the default server.
+                    &quot;Avidemux2&quot;,           // Our application's name.
+                    PA_STREAM_PLAYBACK,
+                    NULL,               // Use the default device.
+                    &quot;Sound&quot;,            // Description of our stream.
+                    &amp;ss,                // Our sample format.
+                    NULL,               // Use default channel map
+                    NULL ,             // Use default buffering attributes.
+                    &amp;er               // Ignore error code.
+                    );
+  if(!instance)
+    {
+        printf(&quot;[PulseSimple] open failed\n&quot;);
+        return 0;
+    }
+    printf(&quot;[PulseSimple] open ok\n&quot;);
+    return 1;
+
+}
+
+/**
+    \fn play
+    \brief Playback samples
+
+*/
+uint8_t pulseSimpleAudioDevice::play(uint32_t len, float *data)
+{
+int er;
+#ifdef ADM_PULSE_INT16
+	dither16(data, len, _channels);
+    pa_simple_write(INSTANCE,data,len*2,&amp;er);
+#else
+    pa_simple_write(INSTANCE,data,len*4,&amp;er);
+#endif
+	return 1;
+}
+/**
+    \fn setVolume
+    \brief Cannot be done with pulse simple
+*/
+uint8_t pulseSimpleAudioDevice::setVolume(int volume)
+{
+	return 1;
+}
+//EOF
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h (from rev 4184, branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h	2008-07-03 19:29:30 UTC (rev 4185)
@@ -0,0 +1,29 @@
+/***************************************************************************
+                          ADM_deviceEsd.h  -  description
+                             -------------------
+                             Audio device for ESD sound daemon
+    copyright            : (C) 2005 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+class pulseSimpleAudioDevice : public audioDevice
+	 {
+		 protected :
+                    void  *instance;
+		  public:
+		  			pulseSimpleAudioDevice(void);
+		     		virtual uint8_t init(uint32_t channels, uint32_t fq);
+	    			virtual uint8_t play(uint32_t len, float *data);
+		      		virtual uint8_t stop(void);
+				    uint8_t setVolume(int volume);
+		 }     ;
+

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/CMakeLists.txt	2008-07-03 19:29:25 UTC (rev 4184)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/PulseAudioSimple/CMakeLists.txt	2008-07-03 19:29:30 UTC (rev 4185)
@@ -0,0 +1,10 @@
+INCLUDE(av_plugin)
+
+
+SET(ADM_av_pulseAudioSimple_SRCS ADM_devicePulseSimple.cpp)
+
+ADD_LIBRARY(ADM_av_pulseAudioSimple SHARED ${ADM_av_pulseAudioSimple_SRCS})
+ADD_DEFINITIONS(${PULSEAUDIOSIMPLE_DEFINITIONS})
+TARGET_LINK_LIBRARIES(ADM_av_pulseAudioSimple ${PULSEAUDIOSIMPLE_LIBRARIES})
+INIT_AUDIO_DEVICE(ADM_av_pulseAudioSimple)
+INSTALL_AUDIODEVICE(ADM_av_pulseAudioSimple)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001437.html">[Avidemux-svn-commit] r4184 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiodevice	avidemux/ADM_userInterfaces/ADM_commonUI cmake plugins	plugins/ADM_audioDevices plugins/ADM_audioDevices/Alsa	plugins/ADM_audioDevices/Arts plugins/ADM_audioDevices/AudioCore	plugins/ADM_audioDevices/Esd plugins/ADM_audioDevices/Jack	plugins/ADM_audioDevices/Oss plugins/ADM_audioDevices/Sdl	plugins/ADM_audioDevices/Win32
</A></li>
	<LI>Next message: <A HREF="001438.html">[Avidemux-svn-commit] r4186 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core:	include src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1439">[ date ]</a>
              <a href="thread.html#1439">[ thread ]</a>
              <a href="subject.html#1439">[ subject ]</a>
              <a href="author.html#1439">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
