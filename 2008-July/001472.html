<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4224 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_audioEncoder/src ADM_audiofilter ADM_coreAudio/include	ADM_coreAudio/src ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4224%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_audioEncoder/src%20ADM_audiofilter%20ADM_coreAudio/include%0A%09ADM_coreAudio/src%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200807161739.m6GHdvBA021106%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001471.html">
   <LINK REL="Next"  HREF="001473.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4224 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_audioEncoder/src ADM_audiofilter ADM_coreAudio/include	ADM_coreAudio/src ADM_userInterfaces/ADM_commonUI</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4224%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_audioEncoder/src%20ADM_audiofilter%20ADM_coreAudio/include%0A%09ADM_coreAudio/src%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200807161739.m6GHdvBA021106%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4224 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_audioEncoder/src ADM_audiofilter ADM_coreAudio/include	ADM_coreAudio/src ADM_userInterfaces/ADM_commonUI">mean at mail.berlios.de
       </A><BR>
    <I>Wed Jul 16 19:39:57 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001471.html">[Avidemux-svn-commit] r4223 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_audio	ADM_audioEncoder/include ADM_audioEncoder/src ADM_audiofilter	ADM_coreAudio/include ADM_coreAudio/src
</A></li>
        <LI>Next message: <A HREF="001473.html">[Avidemux-svn-commit] r4225 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_audioEncoder/include ADM_audioEncoder/src ADM_audiocodec	ADM_audiodevice ADM_audiofilter ADM_coreAudio/include	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1472">[ date ]</a>
              <a href="thread.html#1472">[ thread ]</a>
              <a href="subject.html#1472">[ subject ]</a>
              <a href="author.html#1472">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-07-16 19:39:56 +0200 (Wed, 16 Jul 2008)
New Revision: 4224

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audioFilter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_audioFilter.cpp
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lame.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_twolame.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_buildfilters.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioprocess.hxx
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_coreAudio.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/audioencoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/audioencoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp
Log:
[Audio] Dispatch files


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_faac.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -26,8 +26,6 @@
 
 #include &quot;ADM_default.h&quot;
 
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 //
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lame.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lame.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lame.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -17,8 +17,6 @@
 #include &lt;lame/lame.h&gt;
 
 #include &quot;ADM_default.h&quot;
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 #include &quot;audioencoder_lame_param.h&quot;
 #include &quot;audioencoder_lame.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_lavcodec.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -23,8 +23,6 @@
 
 #include &quot;ADM_default.h&quot;
 
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 //
 #include &quot;audioencoder_lavcodec.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_pcm.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -19,8 +19,6 @@
 
 #include &quot;ADM_default.h&quot;
 
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 //
 #include &quot;audioencoder_pcm.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_twolame.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_twolame.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_twolame.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -19,8 +19,6 @@
 
 #include &quot;ADM_default.h&quot;
 
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 //
 #include &quot;audioencoder_twolame.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audioEncoder/src/audioencoder_vorbis.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -20,8 +20,6 @@
 
 #include &quot;ADM_default.h&quot;
 
-#include &quot;audioprocess.hxx&quot;
-#include &quot;audioeng_process.h&quot;
 #include &quot;audioencoder.h&quot;
 //
 #include &quot;audioencoder_vorbis_param.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/CMakeLists.txt	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/CMakeLists.txt	2008-07-16 17:39:56 UTC (rev 4224)
@@ -1,6 +1,5 @@
 SET(ADMaudiofilter_SRCS 
 	audiodeng_buildfilters.cpp    
-        audioeng_process.cpp           
         audiofilter_film2pal.cpp   
 	audiofilter_bridge.cpp         
         audiofilter_limiter.cpp    

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -15,16 +15,12 @@
  *                                                                         *
  ***************************************************************************/
 #include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
 #include &lt;math.h&gt;
 
 #include &quot;ADM_default.h&quot;
 
 #include &quot;ADM_audiofilter/audiofilter_limiter_param.h&quot;
 #include &quot;ADM_audiofilter/audiofilter_normalize_param.h&quot;
-#include &quot;audioprocess.hxx&quot;
 
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
 
@@ -33,7 +29,6 @@
 
 #include &quot;ADM_audiocodec/ADM_audiocodeclist.h&quot;
 
-#include &quot;audioeng_process.h&quot;
 
 #include &quot;audiofilter_bridge.h&quot;
 #include &quot;audiofilter_mixer.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_buildfilters.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -17,9 +17,7 @@
 #ifndef ADM_AUDIO_BUILDFILTER_H
 #define  ADM_AUDIO_BUILDFILTER_H
 
-#include &quot;ADM_audiofilter/audioeng_process.h&quot;
-#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
-#include &quot;ADM_audiofilter/audioeng_process.h&quot;
+#include &quot;audioencoder.h&quot;
 
 
 

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -1,102 +0,0 @@
-/***************************************************************************
-                          audioeng_process
-                             -------------------
-    copyright            : (C) 2002/2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;audioprocess.hxx&quot;
-
-#include &quot;audioeng_process.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_AUDIO_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-
-AUDMAudioFilter::AUDMAudioFilter(AUDMAudioFilter *previous)
-{
-  _previous=previous;
-  if(_previous)
-  {
-      memcpy(&amp;_wavHeader,_previous-&gt;getInfo(),sizeof(_wavHeader));
-      _length=previous-&gt;getLength();
-  }
-  _head=_tail=0; 
-}
-AUDMAudioFilter::~AUDMAudioFilter()
-{
-}
-
-uint8_t  AUDMAudioFilter::rewind(void)
-{
-  _head=_tail=0;
-  return _previous-&gt;rewind();
-}
-
-uint8_t AUDMAudioFilter::shrink(void)
-{
-  if(_tail&gt;AUD_PROCESS_BUFFER_SIZE/2)
-  {
-    memmove(&amp;_incomingBuffer[0],&amp;_incomingBuffer[_head],sizeof(float)*(_tail-_head));
-    _tail-=_head;
-    _head=0;
-  }
-  if(_head==_tail)
-  {
-    _head=_tail=0;
-  }
-  return 1;
-}
-/*
-    If the incoming data is getting low (less than 1/4) fill it up 
-*/
-uint8_t AUDMAudioFilter::fillIncomingBuffer(AUD_Status *status)
-{
-  uint32_t asked;
-  *status=AUD_OK;
-  // Hysteresis
-  if((_tail-_head)&lt;(AUD_PROCESS_BUFFER_SIZE&gt;&gt;2)) // Less than 1/4 full
- {
-
-  while ((  _tail &lt; (3*AUD_PROCESS_BUFFER_SIZE)/5)) // Fill up to 3/5--3/4
-  {
-      // don't ask too much front.
-    asked = (3*AUD_PROCESS_BUFFER_SIZE)/4-_tail;
-    //asked = _incoming-&gt;readDecompress(asked, &amp;(_incomingBuffer[_tail]));
-    asked=_previous-&gt;fill(asked,&amp;(_incomingBuffer[_tail]),status);
-
-    if (!asked )
-    {
-      *status=AUD_END_OF_STREAM;
-      break;
-    }
-    _tail+=asked;
-  }
- }
- return 1;
-}
-
-
-WAVHeader  *AUDMAudioFilter::getInfo(void)
-{
-  return &amp;(_wavHeader);
-}
-//EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -1,94 +0,0 @@
-/***************************************************************************
-                          audioeng_process.h
-                             -------------------
-    begin                : 2006
-    copyright            : (C) 2002-2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef __Audio_ENG_Process__
-#define __Audio_ENG_Process__
-
-#define AUD_PROCESS_BUFFER_SIZE 48000*2*4 // should be enougth 4 seconds of stereo
-#include &quot;ADM_coreAudio/include/ADM_coreAudio.h&quot;
-/**
-  This enumerate is used to give a more accurate error when no audio is output from
-  an audio filter.
-*/
-typedef enum 
-{
-  AUD_OK=1,           ///&lt; No error
-  AUD_ERROR,          ///&lt; No data was caused by an error
-  AUD_NEED_DATA,      ///&lt; Filter was stalled, should not happend
-  AUD_END_OF_STREAM   ///&lt; End of incoming stream, this is the nominal error case
-} AUD_Status;
-/*
-    incoming --&gt; incomingBuffer  || Processing  --&gt; fill (into next in chain buffer)
-          
-                   
-*/
-
-
-/**
-  This class is the base class for all audio filter.
-  Note that all datas are handled as float!
-*/
-class AUDMAudioFilter
-{
-  protected:
-    //! This will be used to store data coming from the previous filter
-    float           _incomingBuffer[AUD_PROCESS_BUFFER_SIZE]; 
-    //! Pointer to read/write indeces in the _incomingBuffer
-    uint32_t        _head;
-    uint32_t        _tail;
-
-    //! Describe the output wav format, _wavHeader-&gt;byterate holds the size in # of float (NOT SAMPLE)
-    WAVHeader       _wavHeader;
-
-    //! Pointer to the previous filter in the chain
-    AUDMAudioFilter *_previous;
-
-    //! Fill up the incoming buffer, it is called to pull data from the previous filter
-    //! \param status Status of the fill operation
-    virtual uint8_t fillIncomingBuffer(AUD_Status *status);
-    //! length in float
-    uint32_t        _length;
-    
-  public:
-/** Constructor
-    \param previous : Pointer to previous in chain filter 
-*/
-    AUDMAudioFilter(AUDMAudioFilter *previous);
-    
-//! Destructor                                
-    virtual                ~AUDMAudioFilter();
-                                
-//! Compact the _incomingBuffer to avoid overflow
-    uint8_t    shrink( void); 
-
-//! To be called by the next in chain filter. Fills output with processed datas up to max float
-//! \param max : Max number of float to put
-//! \param output : Where to store output float
-//! \param status : Status of the fill operation
-    virtual    uint32_t   fill(uint32_t max,float *output,AUD_Status *status)=0;
-                                                                                     
-//! Returns the output wavheader infos field
-        virtual    WAVHeader  *getInfo(void);
-        
-//! Rewind the stream to the beginning. Used mainly by the normalize filter 
-        virtual   uint8_t    rewind(void)  ;
-                  uint32_t   getLength(void) {return _length;};
-// Returns the channel mapping, by default it is the on from the previous
-// The value returned is an array up to MAX_CHANNELS                  
-        virtual   CHANNEL_TYPE    *getChannelMapping(void ) {return _previous-&gt;getChannelMapping();}
-};
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -16,13 +16,7 @@
 #include &quot;ADM_default.h&quot;
 #include &lt;math.h&gt;
 
-#include &quot;avifmt.h&quot;
-#include &quot;avifmt2.h&quot;
-// Needed for incoming ..
-#include &quot;audioprocess.hxx&quot;
-
-#include &quot;audioeng_process.h&quot;
-
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_bridge.h&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_bridge.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -15,7 +15,7 @@
  *                                                                         *
  ***************************************************************************/
 #ifndef AUDM_BRIDGE_H
-
+#include &quot;audioencoder.h&quot;
 class AUDMAudioFilter_Bridge : public AUDMAudioFilter
 {
   protected:

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -15,19 +15,11 @@
  *                                                                         *
  ***************************************************************************/
 #include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
 #include &lt;math.h&gt;
 
-#include &quot;ADM_assert.h&quot;
+#include &quot;ADM_default.h&quot;
 
-#include &quot;avifmt.h&quot;
-#include &quot;avifmt2.h&quot;
-
-
-//#include &quot;ADM_dialog/DIA_working.h&quot;
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_film2pal.h&quot;
 
 //__________

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_film2pal.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -16,7 +16,7 @@
 #ifndef AUDIO_F_FILM2PAL_H
 #define AUDIO_F_FILM2PAL_H
 
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_limiter_param.h&quot;
 class AUDMAudioFilterFilm2Pal : public AUDMAudioFilter
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -28,21 +28,12 @@
  ***************************************************************************/
 
 #include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
 #include &lt;math.h&gt;
 
-#include &quot;ADM_assert.h&quot;
+#include &quot;ADM_default.h&quot;
 
 
-
-#include &quot;avifmt.h&quot;
-#include &quot;avifmt2.h&quot;
-
-
-
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_limiter.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_limiter.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -16,7 +16,7 @@
 #ifndef AUDIO_F_LIMITER_H
 #define AUDIO_F_LIMITER_H
 
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_limiter_param.h&quot;
 class AUDMAudioFilterLimiter : public AUDMAudioFilter
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -20,17 +20,11 @@
 #include &quot;config.h&quot;
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
+
 #include &lt;math.h&gt;
 
-#include &quot;ADM_assert.h&quot;
-
-#include &quot;avifmt.h&quot;
-#include &quot;avifmt2.h&quot;
-
-
-//#include &quot;ADM_dialog/DIA_working.h&quot;
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter_normalize_param.h&quot;
 #include &quot;audiofilter_normalize.h&quot;
 #include &quot;audiofilter_dolby.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_normalize.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -1,7 +1,7 @@
 #ifndef AUDIO_F_NORMALIZE_H
 #define AUDIO_F_NORMALIZE_H
 
-#include &quot;audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 class AUDMAudioFilterNormalize : public AUDMAudioFilter
 {
   protected:

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioprocess.hxx
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioprocess.hxx	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioprocess.hxx	2008-07-16 17:39:56 UTC (rev 4224)
@@ -19,7 +19,7 @@
 #define __AudioProcess__
 
 #include &quot;ADM_audio/aviaudio.hxx&quot;
-#define MINUS_ONE 0xffffffff
+
 #define PROCESS_BUFFER_SIZE 48000*4*4 // should be enougth
 #define MINIMUM_BUFFER   8192*4
 /*! Base class for chained action. This class is derivated from AVDMGenericAudioStream and has two

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audioFilter.h (from rev 4223, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audioFilter.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -0,0 +1,94 @@
+/***************************************************************************
+                          audioeng_process.h
+                             -------------------
+    begin                : 2006
+    copyright            : (C) 2002-2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef __Audio_ENG_Process__
+#define __Audio_ENG_Process__
+
+#define AUD_PROCESS_BUFFER_SIZE 48000*2*4 // should be enougth 4 seconds of stereo
+#include &quot;ADM_coreAudio/include/ADM_coreAudio.h&quot;
+/**
+  This enumerate is used to give a more accurate error when no audio is output from
+  an audio filter.
+*/
+typedef enum 
+{
+  AUD_OK=1,           ///&lt; No error
+  AUD_ERROR,          ///&lt; No data was caused by an error
+  AUD_NEED_DATA,      ///&lt; Filter was stalled, should not happend
+  AUD_END_OF_STREAM   ///&lt; End of incoming stream, this is the nominal error case
+} AUD_Status;
+/*
+    incoming --&gt; incomingBuffer  || Processing  --&gt; fill (into next in chain buffer)
+          
+                   
+*/
+
+
+/**
+  This class is the base class for all audio filter.
+  Note that all datas are handled as float!
+*/
+class AUDMAudioFilter
+{
+  protected:
+    //! This will be used to store data coming from the previous filter
+    float           _incomingBuffer[AUD_PROCESS_BUFFER_SIZE]; 
+    //! Pointer to read/write indeces in the _incomingBuffer
+    uint32_t        _head;
+    uint32_t        _tail;
+
+    //! Describe the output wav format, _wavHeader-&gt;byterate holds the size in # of float (NOT SAMPLE)
+    WAVHeader       _wavHeader;
+
+    //! Pointer to the previous filter in the chain
+    AUDMAudioFilter *_previous;
+
+    //! Fill up the incoming buffer, it is called to pull data from the previous filter
+    //! \param status Status of the fill operation
+    virtual uint8_t fillIncomingBuffer(AUD_Status *status);
+    //! length in float
+    uint32_t        _length;
+    
+  public:
+/** Constructor
+    \param previous : Pointer to previous in chain filter 
+*/
+    AUDMAudioFilter(AUDMAudioFilter *previous);
+    
+//! Destructor                                
+    virtual                ~AUDMAudioFilter();
+                                
+//! Compact the _incomingBuffer to avoid overflow
+    uint8_t    shrink( void); 
+
+//! To be called by the next in chain filter. Fills output with processed datas up to max float
+//! \param max : Max number of float to put
+//! \param output : Where to store output float
+//! \param status : Status of the fill operation
+    virtual    uint32_t   fill(uint32_t max,float *output,AUD_Status *status)=0;
+                                                                                     
+//! Returns the output wavheader infos field
+        virtual    WAVHeader  *getInfo(void);
+        
+//! Rewind the stream to the beginning. Used mainly by the normalize filter 
+        virtual   uint8_t    rewind(void)  ;
+                  uint32_t   getLength(void) {return _length;};
+// Returns the channel mapping, by default it is the on from the previous
+// The value returned is an array up to MAX_CHANNELS                  
+        virtual   CHANNEL_TYPE    *getChannelMapping(void ) {return _previous-&gt;getChannelMapping();}
+};
+#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_coreAudio.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_coreAudio.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_coreAudio.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -6,6 +6,7 @@
 #define ADM_audioCore_H
 
 
+#define MINUS_ONE 0xffffffff
 
 #define DITHER_SIZE 4800
 #define DITHER_CHANNELS 6

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/audioencoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/audioencoder.h	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/audioencoder.h	2008-07-16 17:39:56 UTC (rev 4224)
@@ -33,7 +33,7 @@
 
 */
 #include &quot;ADM_audio/aviaudio.hxx&quot; // FIXME!!!!
-#include &quot;ADM_audiofilter/audioeng_process.h&quot; // FIXME!!!
+#include &quot;ADM_audioFilter.h&quot; // FIXME!!!
  //_____________________________________________
 class AUDMEncoder //: public AVDMGenericAudioStream
 {

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_audioFilter.cpp (from rev 4223, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audioeng_process.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_audioFilter.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -0,0 +1,97 @@
+/***************************************************************************
+                          audioeng_process
+                             -------------------
+    copyright            : (C) 2002/2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;ADM_audioFilter.h&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_AUDIO_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+
+
+AUDMAudioFilter::AUDMAudioFilter(AUDMAudioFilter *previous)
+{
+  _previous=previous;
+  if(_previous)
+  {
+      memcpy(&amp;_wavHeader,_previous-&gt;getInfo(),sizeof(_wavHeader));
+      _length=previous-&gt;getLength();
+  }
+  _head=_tail=0; 
+}
+AUDMAudioFilter::~AUDMAudioFilter()
+{
+}
+
+uint8_t  AUDMAudioFilter::rewind(void)
+{
+  _head=_tail=0;
+  return _previous-&gt;rewind();
+}
+
+uint8_t AUDMAudioFilter::shrink(void)
+{
+  if(_tail&gt;AUD_PROCESS_BUFFER_SIZE/2)
+  {
+    memmove(&amp;_incomingBuffer[0],&amp;_incomingBuffer[_head],sizeof(float)*(_tail-_head));
+    _tail-=_head;
+    _head=0;
+  }
+  if(_head==_tail)
+  {
+    _head=_tail=0;
+  }
+  return 1;
+}
+/*
+    If the incoming data is getting low (less than 1/4) fill it up 
+*/
+uint8_t AUDMAudioFilter::fillIncomingBuffer(AUD_Status *status)
+{
+  uint32_t asked;
+  *status=AUD_OK;
+  // Hysteresis
+  if((_tail-_head)&lt;(AUD_PROCESS_BUFFER_SIZE&gt;&gt;2)) // Less than 1/4 full
+ {
+
+  while ((  _tail &lt; (3*AUD_PROCESS_BUFFER_SIZE)/5)) // Fill up to 3/5--3/4
+  {
+      // don't ask too much front.
+    asked = (3*AUD_PROCESS_BUFFER_SIZE)/4-_tail;
+    //asked = _incoming-&gt;readDecompress(asked, &amp;(_incomingBuffer[_tail]));
+    asked=_previous-&gt;fill(asked,&amp;(_incomingBuffer[_tail]),status);
+
+    if (!asked )
+    {
+      *status=AUD_END_OF_STREAM;
+      break;
+    }
+    _tail+=asked;
+  }
+ }
+ return 1;
+}
+
+
+WAVHeader  *AUDMAudioFilter::getInfo(void)
+{
+  return &amp;(_wavHeader);
+}
+//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2008-07-16 17:39:56 UTC (rev 4224)
@@ -1,6 +1,7 @@
 SET(ADMaudioCore_SRCS
 ADM_audioUtils.cpp
 audioencoder.cpp
+ADM_audioFilter.cpp
 )	
 ADD_LIBRARY(ADM_coreAudio SHARED ${ADMaudioCore_SRCS})
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_coreAudio/include)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/audioencoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/audioencoder.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/audioencoder.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -15,8 +15,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_coreAudio.h&quot;
-#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
-#include &quot;ADM_audiofilter/audioeng_process.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
 #include &quot;audioencoder.h&quot;
 
 AUDMEncoder::AUDMEncoder(AUDMAudioFilter *in) // :AVDMGenericAudioStream  ()

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp	2008-07-16 17:39:47 UTC (rev 4223)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp	2008-07-16 17:39:56 UTC (rev 4224)
@@ -18,8 +18,6 @@
 #include &quot;ADM_default.h&quot;
 
 #include &quot;DIA_factory.h&quot;
-#include &quot;../../ADM_audiofilter/audioprocess.hxx&quot;
-#include &quot;../../ADM_audiofilter/audioeng_process.h&quot;
 #include &quot;ADM_coreAudio/include/audioencoder.h&quot;
 
 /**


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001471.html">[Avidemux-svn-commit] r4223 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_audio	ADM_audioEncoder/include ADM_audioEncoder/src ADM_audiofilter	ADM_coreAudio/include ADM_coreAudio/src
</A></li>
	<LI>Next message: <A HREF="001473.html">[Avidemux-svn-commit] r4225 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_audioEncoder/include ADM_audioEncoder/src ADM_audiocodec	ADM_audiodevice ADM_audiofilter ADM_coreAudio/include	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1472">[ date ]</a>
              <a href="thread.html#1472">[ thread ]</a>
              <a href="subject.html#1472">[ subject ]</a>
              <a href="author.html#1472">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
