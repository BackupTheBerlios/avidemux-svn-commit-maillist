<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4694 - in	branches/avidemux_2.6_branch_mean/avidemux:	ADM_audioFilter/include ADM_audioFilter/src ADM_audiofilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4694%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux%3A%0A%09ADM_audioFilter/include%20ADM_audioFilter/src%20ADM_audiofilter&In-Reply-To=%3C200903151450.n2FEo1d2027071%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001923.html">
   <LINK REL="Next"  HREF="001925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4694 - in	branches/avidemux_2.6_branch_mean/avidemux:	ADM_audioFilter/include ADM_audioFilter/src ADM_audiofilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4694%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux%3A%0A%09ADM_audioFilter/include%20ADM_audioFilter/src%20ADM_audiofilter&In-Reply-To=%3C200903151450.n2FEo1d2027071%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4694 - in	branches/avidemux_2.6_branch_mean/avidemux:	ADM_audioFilter/include ADM_audioFilter/src ADM_audiofilter">mean at mail.berlios.de
       </A><BR>
    <I>Sun Mar 15 15:50:01 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001923.html">[Avidemux-svn-commit] r4693 - in branches/avidemux_2.6_branch_mean:	avidemux/ADM_audio avidemux/ADM_audioFilter/include	avidemux/ADM_audioFilter/src avidemux/ADM_audiofilter	avidemux/ADM_editor avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_demuxers/MpegPS
</A></li>
        <LI>Next message: <A HREF="001925.html">[Avidemux-svn-commit] r4695 - in	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers: Flv	Matroska Mp4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1924">[ date ]</a>
              <a href="thread.html#1924">[ thread ]</a>
              <a href="subject.html#1924">[ subject ]</a>
              <a href="author.html#1924">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-03-15 15:50:00 +0100 (Sun, 15 Mar 2009)
New Revision: 4694

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_SRC.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_dolby.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_film2pal.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_limiter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_normalize.cpp
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/include/audiofilter_conf.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_mixer.cpp
Log:
[Audio] Move more audio filter

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/include/audiofilter_conf.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/include/audiofilter_conf.h	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/include/audiofilter_conf.h	2009-03-15 14:50:00 UTC (rev 4694)
@@ -19,6 +19,7 @@
 #include &quot;ADM_audioFilter.h&quot;
 #include &quot;audiofilter.h&quot;
 #include &quot;audiofilter_mixer.h&quot;
+#include &quot;audiofilter_SRC.h&quot;
 
 /**
     \class ADM_AUDIOFILTER_CONFIG
@@ -33,17 +34,20 @@
                 shiftInMs=0;
                 mixerEnabled=false;
                 mixerConf=CHANNEL_STEREO;
-
+                resamplerEnabled=false;
+                resamplerFrequency=44100;
         }
 
     uint64_t     startTimeInUs;
     int32_t      shiftInMs;
-    
+    // Mixer
     bool         mixerEnabled;
     CHANNEL_CONF mixerConf;
+    // Resampler
+    bool         resamplerEnabled;
+    uint32_t     resamplerFrequency;
 
 
-
 };
 
 #endif
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/CMakeLists.txt	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/CMakeLists.txt	2009-03-15 14:50:00 UTC (rev 4694)
@@ -2,6 +2,11 @@
 audiofilter_bridge.cpp
 audiofilter_access.cpp
 audiofilter_mixer.cpp
+audiofilter_dolby.cpp
+audiofilter_film2pal.cpp
+audiofilter_limiter.cpp
+audiofilter_normalize.cpp
+audiofilter_SRC.cpp
 audiofilter.cpp
 )
 ADD_LIBRARY(ADM_audioFilter STATIC ${ADM_audioFilter_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -62,9 +62,12 @@
 
 }
 /***********************************************************************/
+#define ADD_FILTER(x) { vec-&gt;push_back(x);last=x;}
 /**
     \fn ADM_buildFilterChain
     \brief Create a filterchain
+    @param vec : VectorFilter to build filters into
+    @param config: Filters configuration
 */
 bool ADM_buildFilterChain(VectorOfAudioFilter *vec,ADM_AUDIOFILTER_CONFIG *config)
 {
@@ -75,16 +78,22 @@
     // Bridge
     AUDMAudioFilter_Bridge *nw=new AUDMAudioFilter_Bridge(video_body,(uint32_t)( config-&gt;startTimeInUs/1000),
                                                                                 config-&gt;shiftInMs);
-    vec-&gt;push_back(nw);
-    last=nw;
+    ADD_FILTER(nw);
 
     // Mixer
     if(config-&gt;mixerEnabled)
     {
         AUDMAudioFilterMixer *mixer=new AUDMAudioFilterMixer(last,config-&gt;mixerConf);
-        vec-&gt;push_back(mixer);
-        last=mixer;
+        ADD_FILTER(mixer);
     }
+    // Resample
+    if(config-&gt;resamplerEnabled &amp;&amp; config-&gt;resamplerFrequency!=last-&gt;getInfo()-&gt;frequency)
+    {
+        AUDMAudioFilterSrc *src=new AUDMAudioFilterSrc(last,config-&gt;resamplerFrequency);
+        ADD_FILTER(src);
+    }
+    // Normalize
+
     return true;
 }
 /**

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_SRC.cpp (from rev 4693, branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_SRC.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -0,0 +1,113 @@
+/***************************************************************************
+        Sox
+ ***************************************************************************/
+ 
+ 
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;ADM_audioFilter.h&quot;
+#include &quot;audiofilter_SRC.h&quot;
+/**
+    \fn AUDMAudioFilterSrc
+
+*/
+ AUDMAudioFilterSrc::AUDMAudioFilterSrc(AUDMAudioFilter *instream,uint32_t  tgt):AUDMAudioFilter (instream)
+{
+
+  targetFrequency=tgt;
+  _previous-&gt;rewind();     // rewind
+  printf(&quot;[FilterSrc] Creating from %d Hz to %d Hz\n&quot;,_wavHeader.frequency,targetFrequency);
+  if(_wavHeader.frequency==targetFrequency)
+  {
+    engaged=0;
+    return;
+  }
+    int org=_previous-&gt;getInfo()-&gt;frequency;
+    if(true!=resampler.init(org,tgt,_wavHeader.channels))
+    {
+        printf(&quot;[AudioFilter Resample] Init failed! \n&quot;);
+        engaged=0;
+        return;
+    }
+    engaged=1;
+    _wavHeader.frequency= targetFrequency;    
+     printf(&quot;[AudioFilter Resample] Init done. \n&quot;);
+};
+
+AUDMAudioFilterSrc::~AUDMAudioFilterSrc()
+{
+  printf(&quot;[AudioFilter Resample] Destroying\n&quot;);
+};
+
+#define BLK_SIZE 512
+//_____________________________________________
+uint32_t AUDMAudioFilterSrc::fill(uint32_t max,float *output,AUD_Status *status)
+{
+  if(!engaged)
+  {
+    return _previous-&gt;fill(max, output,status); 
+    
+  }
+    uint32_t snboutput=0;
+    // BLK_SIZE sample will generate blockOut sample*channel
+    float blockOutf=BLK_SIZE*_wavHeader.channels*_wavHeader.frequency;
+    blockOutf/=_previous-&gt;getInfo()-&gt;frequency;
+    uint32_t blockOut=(uint32_t)(blockOutf);
+
+    // Roundup to the next # channels
+    blockOut=(blockOut+_wavHeader.channels-1)/_wavHeader.channels;
+    blockOut*=_wavHeader.channels;
+
+    while(max&gt;blockOut)
+    {
+      // Fill incoming buffer
+        shrink();
+        fillIncomingBuffer(status);
+        if(_head==_tail)
+        {
+          *status=AUD_END_OF_STREAM;
+          return snboutput;
+        }
+        ADM_assert(_tail&gt;=_head);
+        uint32_t nb_in=(_tail-_head)/(_wavHeader.channels); // Nb Sample
+        if(nb_in&gt;BLK_SIZE) nb_in=BLK_SIZE;
+        if(!nb_in)
+        {
+          printf(&quot;[Resampler]Not enough audio\n&quot;);
+          return snboutput;
+        }
+        // We have one BLK_SIZE incoming
+        uint32_t maxSample=BLK_SIZE*4; // FIXME!
+        uint32_t nbOut=0;
+        uint32_t nbIn=nb_in;
+        uint32_t nbInTaken=0;
+        float *from,*to;
+        from=_incomingBuffer+_head;
+        to=output;
+        if(true!=resampler.process(from,to, 
+                    nbIn,
+                    maxSample,
+                    &amp;nbInTaken, 
+                    &amp;nbOut))
+        {
+                *status=AUD_END_OF_STREAM;
+                return snboutput;
+        }
+        
+      _head=_head+(nbInTaken*_wavHeader.channels);
+      snboutput+=nbOut*_wavHeader.channels;
+      output+=nbOut*_wavHeader.channels;
+      max-=nbOut*_wavHeader.channels;
+    }
+    return snboutput;
+}
+//EOF

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_dolby.cpp (from rev 4693, branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_dolby.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -0,0 +1,226 @@
+/**
+// \file audiofilter_dolby.cpp
+//
+// Description: 
+//
+//
+// Author: Mihail Zenkov &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">kreator at tut.by</A>&gt;, (C) 2006
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;string.h&gt;
+
+#define NZEROS 500
+#define GAIN 1.571116176e+00
+
+static float xv_left[NZEROS+1];
+static float xv_right[NZEROS+1];
+
+static float xcoeffs[] =
+{ +0.0000000000, +0.0003214310, +0.0000000000, +0.0003252099,
++0.0000000000, +0.0003302355, +0.0000000000, +0.0003365372,
++0.0000000000, +0.0003441444, +0.0000000000, +0.0003530868,
++0.0000000000, +0.0003633944, +0.0000000000, +0.0003750973,
++0.0000000000, +0.0003882260, +0.0000000000, +0.0004028113,
++0.0000000000, +0.0004188840, +0.0000000000, +0.0004364757,
++0.0000000000, +0.0004556178, +0.0000000000, +0.0004763424,
++0.0000000000, +0.0004986818, +0.0000000000, +0.0005226689,
++0.0000000000, +0.0005483367, +0.0000000000, +0.0005757189,
++0.0000000000, +0.0006048495, +0.0000000000, +0.0006357632,
++0.0000000000, +0.0006684951, +0.0000000000, +0.0007030809,
++0.0000000000, +0.0007395569, +0.0000000000, +0.0007779600,
++0.0000000000, +0.0008183281, +0.0000000000, +0.0008606994,
++0.0000000000, +0.0009051133, +0.0000000000, +0.0009516098,
++0.0000000000, +0.0010002299, +0.0000000000, +0.0010510155,
++0.0000000000, +0.0011040098, +0.0000000000, +0.0011592568,
++0.0000000000, +0.0012168018, +0.0000000000, +0.0012766915,
++0.0000000000, +0.0013389738, +0.0000000000, +0.0014036982,
++0.0000000000, +0.0014709156, +0.0000000000, +0.0015406788,
++0.0000000000, +0.0016130421, +0.0000000000, +0.0016880620,
++0.0000000000, +0.0017657969, +0.0000000000, +0.0018463073,
++0.0000000000, +0.0019296564, +0.0000000000, +0.0020159096,
++0.0000000000, +0.0021051351, +0.0000000000, +0.0021974040,
++0.0000000000, +0.0022927905, +0.0000000000, +0.0023913723,
++0.0000000000, +0.0024932304, +0.0000000000, +0.0025984499,
++0.0000000000, +0.0027071199, +0.0000000000, +0.0028193341,
++0.0000000000, +0.0029351907, +0.0000000000, +0.0030547934,
++0.0000000000, +0.0031782511, +0.0000000000, +0.0033056791,
++0.0000000000, +0.0034371988, +0.0000000000, +0.0035729386,
++0.0000000000, +0.0037130347, +0.0000000000, +0.0038576311,
++0.0000000000, +0.0040068807, +0.0000000000, +0.0041609461,
++0.0000000000, +0.0043200000, +0.0000000000, +0.0044842264,
++0.0000000000, +0.0046538214, +0.0000000000, +0.0048289944,
++0.0000000000, +0.0050099691, +0.0000000000, +0.0051969851,
++0.0000000000, +0.0053902989, +0.0000000000, +0.0055901856,
++0.0000000000, +0.0057969412, +0.0000000000, +0.0060108836,
++0.0000000000, +0.0062323557, +0.0000000000, +0.0064617271,
++0.0000000000, +0.0066993973, +0.0000000000, +0.0069457986,
++0.0000000000, +0.0072013994, +0.0000000000, +0.0074667084,
++0.0000000000, +0.0077422784, +0.0000000000, +0.0080287117,
++0.0000000000, +0.0083266658, +0.0000000000, +0.0086368590,
++0.0000000000, +0.0089600787, +0.0000000000, +0.0092971888,
++0.0000000000, +0.0096491399, +0.0000000000, +0.0100169797,
++0.0000000000, +0.0104018664, +0.0000000000, +0.0108050829,
++0.0000000000, +0.0112280539, +0.0000000000, +0.0116723666,
++0.0000000000, +0.0121397934, +0.0000000000, +0.0126323203,
++0.0000000000, +0.0131521795, +0.0000000000, +0.0137018887,
++0.0000000000, +0.0142842976, +0.0000000000, +0.0149026446,
++0.0000000000, +0.0155606252, +0.0000000000, +0.0162624744,
++0.0000000000, +0.0170130694, +0.0000000000, +0.0178180552,
++0.0000000000, +0.0186840011, +0.0000000000, +0.0196185982,
++0.0000000000, +0.0206309077, +0.0000000000, +0.0217316805,
++0.0000000000, +0.0229337690, +0.0000000000, +0.0242526657,
++0.0000000000, +0.0257072177, +0.0000000000, +0.0273205841,
++0.0000000000, +0.0291215436, +0.0000000000, +0.0311463069,
++0.0000000000, +0.0334410798, +0.0000000000, +0.0360657647,
++0.0000000000, +0.0390994399, +0.0000000000, +0.0426486966,
++0.0000000000, +0.0468607407, +0.0000000000, +0.0519447683,
++0.0000000000, +0.0582084316, +0.0000000000, +0.0661234757,
++0.0000000000, +0.0764519642, +0.0000000000, +0.0905102051,
++0.0000000000, +0.1107845781, +0.0000000000, +0.1426030657,
++0.0000000000, +0.1998184590, +0.0000000000, +0.3332243858,
++0.0000000000, +0.9999636803, +0.0000000000, -0.9999636803,
+-0.0000000000, -0.3332243858, -0.0000000000, -0.1998184590,
+-0.0000000000, -0.1426030657, -0.0000000000, -0.1107845781,
+-0.0000000000, -0.0905102051, -0.0000000000, -0.0764519642,
+-0.0000000000, -0.0661234757, -0.0000000000, -0.0582084316,
+-0.0000000000, -0.0519447683, -0.0000000000, -0.0468607407,
+-0.0000000000, -0.0426486966, -0.0000000000, -0.0390994399,
+-0.0000000000, -0.0360657647, -0.0000000000, -0.0334410798,
+-0.0000000000, -0.0311463069, -0.0000000000, -0.0291215436,
+-0.0000000000, -0.0273205841, -0.0000000000, -0.0257072177,
+-0.0000000000, -0.0242526657, -0.0000000000, -0.0229337690,
+-0.0000000000, -0.0217316805, -0.0000000000, -0.0206309077,
+-0.0000000000, -0.0196185982, -0.0000000000, -0.0186840011,
+-0.0000000000, -0.0178180552, -0.0000000000, -0.0170130694,
+-0.0000000000, -0.0162624744, -0.0000000000, -0.0155606252,
+-0.0000000000, -0.0149026446, -0.0000000000, -0.0142842976,
+-0.0000000000, -0.0137018887, -0.0000000000, -0.0131521795,
+-0.0000000000, -0.0126323203, -0.0000000000, -0.0121397934,
+-0.0000000000, -0.0116723666, -0.0000000000, -0.0112280539,
+-0.0000000000, -0.0108050829, -0.0000000000, -0.0104018664,
+-0.0000000000, -0.0100169797, -0.0000000000, -0.0096491399,
+-0.0000000000, -0.0092971888, -0.0000000000, -0.0089600787,
+-0.0000000000, -0.0086368590, -0.0000000000, -0.0083266658,
+-0.0000000000, -0.0080287117, -0.0000000000, -0.0077422784,
+-0.0000000000, -0.0074667084, -0.0000000000, -0.0072013994,
+-0.0000000000, -0.0069457986, -0.0000000000, -0.0066993973,
+-0.0000000000, -0.0064617271, -0.0000000000, -0.0062323557,
+-0.0000000000, -0.0060108836, -0.0000000000, -0.0057969412,
+-0.0000000000, -0.0055901856, -0.0000000000, -0.0053902989,
+-0.0000000000, -0.0051969851, -0.0000000000, -0.0050099691,
+-0.0000000000, -0.0048289944, -0.0000000000, -0.0046538214,
+-0.0000000000, -0.0044842264, -0.0000000000, -0.0043200000,
+-0.0000000000, -0.0041609461, -0.0000000000, -0.0040068807,
+-0.0000000000, -0.0038576311, -0.0000000000, -0.0037130347,
+-0.0000000000, -0.0035729386, -0.0000000000, -0.0034371988,
+-0.0000000000, -0.0033056791, -0.0000000000, -0.0031782511,
+-0.0000000000, -0.0030547934, -0.0000000000, -0.0029351907,
+-0.0000000000, -0.0028193341, -0.0000000000, -0.0027071199,
+-0.0000000000, -0.0025984499, -0.0000000000, -0.0024932304,
+-0.0000000000, -0.0023913723, -0.0000000000, -0.0022927905,
+-0.0000000000, -0.0021974040, -0.0000000000, -0.0021051351,
+-0.0000000000, -0.0020159096, -0.0000000000, -0.0019296564,
+-0.0000000000, -0.0018463073, -0.0000000000, -0.0017657969,
+-0.0000000000, -0.0016880620, -0.0000000000, -0.0016130421,
+-0.0000000000, -0.0015406788, -0.0000000000, -0.0014709156,
+-0.0000000000, -0.0014036982, -0.0000000000, -0.0013389738,
+-0.0000000000, -0.0012766915, -0.0000000000, -0.0012168018,
+-0.0000000000, -0.0011592568, -0.0000000000, -0.0011040098,
+-0.0000000000, -0.0010510155, -0.0000000000, -0.0010002299,
+-0.0000000000, -0.0009516098, -0.0000000000, -0.0009051133,
+-0.0000000000, -0.0008606994, -0.0000000000, -0.0008183281,
+-0.0000000000, -0.0007779600, -0.0000000000, -0.0007395569,
+-0.0000000000, -0.0007030809, -0.0000000000, -0.0006684951,
+-0.0000000000, -0.0006357632, -0.0000000000, -0.0006048495,
+-0.0000000000, -0.0005757189, -0.0000000000, -0.0005483367,
+-0.0000000000, -0.0005226689, -0.0000000000, -0.0004986818,
+-0.0000000000, -0.0004763424, -0.0000000000, -0.0004556178,
+-0.0000000000, -0.0004364757, -0.0000000000, -0.0004188840,
+-0.0000000000, -0.0004028113, -0.0000000000, -0.0003882260,
+-0.0000000000, -0.0003750973, -0.0000000000, -0.0003633944,
+-0.0000000000, -0.0003530868, -0.0000000000, -0.0003441444,
+-0.0000000000, -0.0003365372, -0.0000000000, -0.0003302355,
+-0.0000000000, -0.0003252099, -0.0000000000, -0.0003214310,
+-0.0000000000,
+};
+
+static bool skip;
+
+void DolbySkip(bool on)
+{
+	skip = on;
+}
+
+void DolbyInit()
+{
+	memset(xv_left, 0, sizeof(float) * NZEROS);
+	memset(xv_right, 0, sizeof(float) * NZEROS);
+}
+
+float DolbyShiftLeft(float isamp)
+{
+if(!skip) {
+	float *p_xcoeffs = xcoeffs;
+	static int pos = 0;
+
+	if ((pos - 1) &lt; 0)
+		xv_left[NZEROS] = isamp / GAIN;
+	else
+		xv_left[pos - 1] = isamp / GAIN;
+
+	float sum = 0;
+	for (int i = pos; i &lt;= NZEROS; i++)
+		sum += (*(p_xcoeffs++) * xv_left[i]);
+
+	for (int i = 0; i &lt; pos; i++)
+		sum += (*(p_xcoeffs++) * xv_left[i]);
+
+	pos++;
+	if (pos &gt; NZEROS)
+		pos = 0;
+
+	return sum;
+}else{
+	return isamp;
+}
+}
+
+float DolbyShiftRight(float isamp)
+{
+if(!skip) {
+	float *p_xcoeffs = xcoeffs;
+	static int pos = 0;
+
+	if ((pos - 1) &lt; 0)
+		xv_right[NZEROS] = isamp / GAIN;
+	else
+		xv_right[pos - 1] = isamp / GAIN;
+
+	float sum = 0;
+	for (int i = pos; i &lt;= NZEROS; i++)
+		sum += (*(p_xcoeffs++) * xv_right[i]);
+
+	for (int i = 0; i &lt; pos; i++)
+		sum += (*(p_xcoeffs++) * xv_right[i]);
+
+	pos++;
+	if (pos &gt; NZEROS)
+		pos = 0;
+
+	return -sum;
+}else{
+	return isamp;
+}
+}

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_film2pal.cpp (from rev 4693, branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_film2pal.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -0,0 +1,95 @@
+/***************************************************************************
+                   \file       audiofilterFilm2pal.cpp
+                             
+    
+    copyright            : (C) 2002/2009 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+#include &quot;ADM_audioFilter.h&quot;
+#include &quot;audiofilter_film2pal.h&quot;
+
+AUDMAudioFilterFilm2Pal::AUDMAudioFilterFilm2Pal(AUDMAudioFilter *previous) : 
+            AUDMAudioFilterFilmChange(previous,1001,960)
+{
+    printf(&quot;[Film2Pal] Created\n&quot;);
+}
+AUDMAudioFilterPal2Film::AUDMAudioFilterPal2Film(AUDMAudioFilter *previous) : 
+            AUDMAudioFilterFilmChange(previous,960,1001)
+{
+    printf(&quot;[Pal2Film] Created\n&quot;);
+}
+#define CONTECT ((SRC_STATE *)context))
+//__________
+
+AUDMAudioFilterFilmChange::AUDMAudioFilterFilmChange(AUDMAudioFilter * instream,uint32_t from, uint32_t to):AUDMAudioFilter (instream)
+{
+    // The parameter are in sample, we deal with fq
+    if(true!=resampler.init(from,to,_wavHeader.channels))
+    {
+        printf(&quot;[AudioFilter Resample] Init failed! \n&quot;);
+        ADM_assert(0);
+    }
+    printf(&quot;[FilmChange] Creating\n&quot;);
+};
+
+AUDMAudioFilterFilmChange::~AUDMAudioFilterFilmChange()
+{
+  
+  printf(&quot;[FilmChange] Destroying\n&quot;);
+}
+//
+//___________________________________________
+uint32_t AUDMAudioFilterFilmChange::fill( uint32_t max, float * buffer,AUD_Status *status)
+{
+  uint32_t len,i,rendered;
+  uint32_t chan=_wavHeader.channels;
+  float *start;
+  
+  shrink();
+  fillIncomingBuffer(status);
+  
+  len=_tail-_head;
+  int nbBlock=max/1001;
+  max=nbBlock*960; // Prevent overflow when slowing down
+
+  if(len&gt;max) len=max;
+  
+  len=len/chan; // in sample
+
+        uint32_t maxSample=max/chan; // in sample
+        uint32_t nbOut=0;
+        uint32_t nbIn=len;
+        uint32_t nbInTaken=0;
+        float *from,*to;
+        from=_incomingBuffer+_head;
+        to=buffer;
+        if(true!=resampler.process(from,to, 
+                    nbIn,
+                    maxSample,
+                    &amp;nbInTaken, 
+                    &amp;nbOut))
+        {
+            printf(&quot;[FilmChange] EOF ??\n&quot;);
+            *status=AUD_END_OF_STREAM;
+            return 0;
+        }
+      _head=_head+(nbInTaken*chan);
+      return nbOut*chan;
+};
+
+//EOF
+

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_limiter.cpp (from rev 4693, branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_limiter.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -0,0 +1,250 @@
+/***************************************************************************
+                          audioeng_6dbpress.cpp  -  description
+                             -------------------
+	Derived from audactity compressor
+	see <A HREF="http://audacity.sf.net">http://audacity.sf.net</A>
+ ***************************************************************************/
+/**********************************************************************
+
+  Audacity: A Digital Audio Editor
+
+  Compressor.cpp
+
+  Dominic Mazzoni
+
+  Steve Jolly made it inherit from EffectSimpleMono.
+  GUI added and implementation improved by Dominic Mazzoni, 5/11/2003.
+
+**********************************************************************/
+ 
+ 
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+
+#include &quot;ADM_audioFilter.h&quot;
+#include &quot;audiofilter_limiter.h&quot;
+
+
+
+AUDMAudioFilterLimiter::AUDMAudioFilterLimiter(AUDMAudioFilter *previous, DRCparam *param):AUDMAudioFilter (previous)
+{
+uint32_t nbChan=previous-&gt;getInfo()-&gt;channels;
+#define AMP 4
+    _previous-&gt;rewind();
+    memcpy(&amp;_param,param,sizeof(_param));
+//
+// The base is 100 ms
+//
+
+    mCircleSize=DRC_WINDOW;
+    mCircleSize=mCircleSize-(mCircleSize%nbChan);
+    drc_cleanup();
+    printf(&quot;[DRC] Created DRC:%u Window:%u nbChan %u\n&quot;,mCircleSize,DRC_WINDOW,nbChan);
+
+};
+void AUDMAudioFilterLimiter::drc_cleanup(void)
+{
+  float mCurRate=(float)_wavHeader.frequency;
+   
+  for(int j=0; j&lt;mCircleSize; j++) {
+      mCircle[j] = 0.0;
+      mLevelCircle[j] = _param.mFloor;
+   }
+   mCirclePos = 0;
+   mRMSSum = 0.0;
+
+   mGainDB = ((_param.mThresholdDB*-0.7) * (1 - 1/_param.mRatio));
+   if (mGainDB &lt; 0)
+      mGainDB = 0;
+
+   mThreshold = pow(10.0, _param.mThresholdDB/10); // factor of 10 because it's power
+
+   if (_param.mUseGain)
+      mGain = pow(10.0, mGainDB/20); // factor of 20 because it's amplitude
+   else
+      mGain = 1.0;
+
+   mAttackFactor = exp(-log(_param.mFloor) / (mCurRate * _param.mAttackTime + 0.5));
+   mDecayFactor = exp(log(_param.mFloor) / (mCurRate * _param.mDecayTime + 0.5));
+
+   mLastLevel = 0.0;
+   
+   memset(mCircle,0,sizeof(mCircle));
+   memset(follow,0,sizeof(follow));
+   memset(mLevelCircle,0,sizeof(mLevelCircle));
+    
+}
+//
+AUDMAudioFilterLimiter::~AUDMAudioFilterLimiter()
+{
+  printf(&quot;[DRC] Destroyed\n&quot;);
+}
+
+uint32_t   AUDMAudioFilterLimiter::fill(uint32_t max,float *output,AUD_Status *status)
+{
+  uint32_t len,i;
+  
+  shrink();
+  fillIncomingBuffer(status);
+  
+  
+  len=_tail-_head;
+  if(len&gt;max) len=max;
+  if(len&gt;=DELIM_WINDOW_SIZE) len=DELIM_WINDOW_SIZE-1;
+  
+  // Count in full sample  i.e. all channels
+  len=len-(len%_wavHeader.channels);
+  
+  // Process..
+  if (mLastLevel == 0.0) {
+    int preSeed = mCircleSize;
+    if (preSeed &gt; len)
+      preSeed = len;
+    for(i=0; i&lt;preSeed; i++)
+      AvgCircle(_incomingBuffer[_head+i]);
+  }
+  
+    for (i = 0; i &lt; len; i++) {
+      Follow(_incomingBuffer[_head+i], &amp;follow[i], i);
+    }
+
+    for (i = 0; i &lt; len; i++) {
+      output[i] =DoCompression(_incomingBuffer[_head+i], follow[i]);
+    }  
+    _head+=len;
+    return len;
+}
+
+float AUDMAudioFilterLimiter::AvgCircle(float value)
+{
+  float level;
+
+   // Calculate current level from root-mean-squared of
+   // circular buffer (&quot;RMS&quot;)
+   mRMSSum -= mCircle[mCirclePos];
+   mCircle[mCirclePos] = value*value;
+   mRMSSum += mCircle[mCirclePos];
+   level = sqrt(mRMSSum/mCircleSize);
+   mLevelCircle[mCirclePos] = level;
+   mCirclePos = (mCirclePos+1)%mCircleSize;  
+   return level;
+}
+
+void AUDMAudioFilterLimiter::Follow(float x, float *outEnv, int maxBack)
+{
+   /*
+
+   &quot;Follow&quot;ing algorithm by Roger B. Dannenberg, taken from
+   Nyquist.  His description follows.  -DMM
+
+   Description: this is a sophisticated envelope follower.
+    The input is an envelope, e.g. something produced with
+    the AVG function. The purpose of this function is to
+    generate a smooth envelope that is generally not less
+    than the input signal. In other words, we want to &quot;ride&quot;
+    the peaks of the signal with a smooth function. The 
+    algorithm is as follows: keep a current output value
+    (called the &quot;value&quot;). The value is allowed to increase
+    by at most rise_factor and decrease by at most fall_factor.
+    Therefore, the next value should be between
+    value * rise_factor and value * fall_factor. If the input
+    is in this range, then the next value is simply the input.
+    If the input is less than value * fall_factor, then the
+    next value is just value * fall_factor, which will be greater
+    than the input signal. If the input is greater than value *
+    rise_factor, then we compute a rising envelope that meets
+    the input value by working bacwards in time, changing the
+    previous values to input / rise_factor, input / rise_factor^2,
+    input / rise_factor^3, etc. until this new envelope intersects
+    the previously computed values. There is only a limited buffer
+    in which we can work backwards, so if the new envelope does not
+    intersect the old one, then make yet another pass, this time
+    from the oldest buffered value forward, increasing on each 
+    sample by rise_factor to produce a maximal envelope. This will 
+    still be less than the input.
+    
+    The value has a lower limit of floor to make sure value has a 
+    reasonable positive value from which to begin an attack.
+   */
+
+   float level = AvgCircle(x);
+   float high = mLastLevel * mAttackFactor;
+   float low = mLastLevel * mDecayFactor;
+
+   if (low &lt; _param.mFloor)
+      low = _param.mFloor;
+
+   if (level &lt; low)
+      *outEnv = low;
+   else if (level &lt; high)
+      *outEnv = level;
+   else {
+      // Backtrack
+     float attackInverse = 1.0 / mAttackFactor;
+     float temp = level * attackInverse;
+
+      int backtrack = 50;
+      if (backtrack &gt; maxBack)
+         backtrack = maxBack;
+
+      float *ptr = &amp;outEnv[-1];
+      int i;
+      bool ok = false;
+      for(i=0; i&lt;backtrack-2; i++) {
+         if (*ptr &lt; temp) {
+            *ptr-- = temp;
+            temp *= attackInverse;
+         }
+         else {
+            ok = true;
+            break;
+         }   
+      }
+
+      if (!ok &amp;&amp; backtrack&gt;1 &amp;&amp; (*ptr &lt; temp)) {
+         temp = *ptr;
+         for (i = 0; i &lt; backtrack-1; i++) {
+            ptr++;
+            temp *= mAttackFactor;
+            *ptr = temp;
+         }
+      }
+      else
+         *outEnv = level;
+   }
+
+   mLastLevel = *outEnv;
+}
+
+float AUDMAudioFilterLimiter::DoCompression(float value, float env)
+{
+   float mult;
+   float out;
+
+   if (env &gt; mThreshold)
+      mult = mGain * pow(mThreshold/env, 1.0/_param.mRatio);
+   else
+      mult = mGain;
+
+   out = value * mult;
+
+   if (out &gt; 1.0)
+      out = 1.0;
+
+   if (out &lt; -1.0)
+      out = -1.0;
+
+   return out;
+}
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_mixer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_mixer.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_mixer.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,5 +1,8 @@
 /***************************************************************************
-         Downmixer
+       \file audiofilter_mixer.cpp
+       \brief Change channels configuration (down/up channels)
+
+    (C) Mihail Zenkov &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">kreator at tut.by</A>&gt; &amp; mean
  ***************************************************************************/
  
  

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_normalize.cpp (from rev 4693, branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter_normalize.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -0,0 +1,183 @@
+/***************************************************************************
+                          \file  audiofilter_normalize
+                          \brief absolute or automatic gain filter
+                             -------------------
+    
+    copyright            : (C) 2002/2009 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+    
+    Compute the ratio so that the maximum is at -3db
+    
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#include &lt;math.h&gt;
+
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_audioFilter.h&quot;
+#include &quot;audiofilter_normalize_param.h&quot;
+#include &quot;audiofilter_normalize.h&quot;
+#include &quot;audiofilter_dolby.h&quot;
+
+#include &quot;ADM_audio/aviaudio.hxx&quot;
+//#include &quot;ADM_dialog/DIA_busy.h&quot; //CANNOT USE IT! We are in another thread!
+
+extern AVDMGenericAudioStream *currentaudiostream;
+
+#ifdef __WIN32
+#define POW10(x)   pow(10,x)
+#elif defined(ADM_BSD_FAMILY)
+#define POW10(x) powf(10.0,x)
+#else
+#define POW10(x)  pow10f(x)
+#endif
+
+#define LINEAR_TO_DB(x) (20.*log10(x))
+#define DB_TO_LINEAR(x) (POW10((x/20.)))
+
+// Ctor
+//__________
+
+AUDMAudioFilterNormalize::AUDMAudioFilterNormalize(AUDMAudioFilter * instream,GAINparam *param):AUDMAudioFilter (instream)
+{
+  float db_out;
+    // nothing special here...
+  switch(param-&gt;mode)
+  {
+    case ADM_NO_GAIN: _ratio=1;_scanned=1;printf(&quot;[Gain] Gain of 1.0\n&quot;);break; 
+    case ADM_GAIN_AUTOMATIC: _ratio=1;_scanned=0;printf(&quot;[Gain] Automatic gain\n&quot;);break;
+    case ADM_GAIN_MANUAL: 
+                _scanned=1;
+                db_out =  param-&gt;gain10/10.0; // Dbout is in 10*DB (!)
+                _ratio = DB_TO_LINEAR(db_out);
+                printf(&quot;[Gain] %f db (p=%d)\n&quot;, (float)(param-&gt;gain10)/10.,param-&gt;gain10);
+                printf(&quot;[Gain] Linear ratio of : %03.3f\n&quot;, _ratio);
+  }
+    _previous-&gt;rewind();
+};
+
+AUDMAudioFilterNormalize::~AUDMAudioFilterNormalize()
+{
+
+}
+//
+// For normalize, we scan the input stream
+// to check for maximum value
+//___________________________________________
+uint8_t AUDMAudioFilterNormalize::preprocess(void)
+{
+
+    int16_t *ptr;
+    uint32_t scanned = 0, ch = 0;
+    AUD_Status status;
+    _ratio = 0;
+
+    uint32_t percent=0;
+    uint32_t current=0,llength=0;
+    float max[_wavHeader.channels];
+    _previous-&gt;rewind();
+    DolbySkip(1);
+    printf(&quot;\n Seeking for maximum value, that can take a while\n&quot;);
+
+    llength=_length ;
+    
+
+      for(int i=0;i&lt;_wavHeader.channels;i++) max[i]=0;
+      while (1)
+      {
+          int ready=_previous-&gt;fill(AUD_PROCESS_BUFFER_SIZE&gt;&gt;2,_incomingBuffer,&amp;status);
+          if(!ready)
+          {
+            if(status==AUD_END_OF_STREAM) 
+            {
+              break; 
+            }
+           else 
+            {
+              printf(&quot;Unknown cause : %d\n&quot;,status);
+              ADM_assert(0); 
+            }
+          }
+          ADM_assert(!(ready %_wavHeader.channels));
+          
+          int index=0;
+          float current;
+          
+        //  printf(&quot;*\n&quot;);
+          int sample= ready /_wavHeader.channels;
+          for(int j=0;j&lt;sample;j++)
+            for(int chan=0;chan&lt;_wavHeader.channels;chan++)
+          {
+            current=fabs(_incomingBuffer[index++]);
+            if(current&gt;max[chan]) max[chan]=current;
+          }
+          scanned+=ready;
+      }
+      
+      
+      
+
+    _previous-&gt;rewind();
+    float mx=0;
+    for(int chan=0;chan&lt;_wavHeader.channels;chan++)
+    {
+        if(max[chan]&gt;mx) mx=max[chan];
+        printf(&quot;[Normalize] maximum found for channel %d : %f\n&quot;, chan,max[chan]);
+    }
+    printf(&quot;[Normalize] Using : %0.4f as max value \n&quot;, mx);
+    double db_in, db_out=-3;
+
+    if (mx&gt;0.001)
+      db_in = LINEAR_TO_DB(mx);
+    else
+      db_in = -20; // We consider -20 DB to be noise
+
+    printf(&quot;--&gt; %2.2f db / %2.2f \n&quot;, db_in, db_out);
+
+    // search ratio
+    _ratio=1;
+
+    float db_delta=db_out-db_in;
+    printf(&quot;[Normalize]Gain %f dB\n&quot;,db_delta);
+    _ratio = DB_TO_LINEAR(db_delta);
+    printf(&quot;\n Using ratio of : %f\n&quot;, _ratio);
+
+    _scanned = 1;
+    DolbySkip(0);
+    _previous-&gt;rewind();
+    return 1;
+}
+//
+//___________________________________________
+uint32_t AUDMAudioFilterNormalize::fill( uint32_t max, float * buffer,AUD_Status *status)
+{
+    uint32_t rd, i, j,rd2;
+
+    *status=AUD_OK;
+    if(!_scanned) preprocess();
+    rd = _previous-&gt;fill(max, _incomingBuffer,status);
+    if(!rd)
+    {
+      if(*status==AUD_END_OF_STREAM) return 0;
+      ADM_assert(0);
+    }
+    float *in,*out,tmp;
+    for (i = 0; i &lt; rd; i++)
+    {
+      tmp=_incomingBuffer[i];
+      tmp*=_ratio;
+      buffer[i]=tmp;
+    }
+    return rd;
+};
+//EOF
+

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_SRC.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,113 +0,0 @@
-/***************************************************************************
-        Sox
- ***************************************************************************/
- 
- 
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_audioFilter.h&quot;
-#include &quot;audiofilter_SRC.h&quot;
-/**
-    \fn AUDMAudioFilterSrc
-
-*/
- AUDMAudioFilterSrc::AUDMAudioFilterSrc(AUDMAudioFilter *instream,uint32_t  tgt):AUDMAudioFilter (instream)
-{
-
-  targetFrequency=tgt;
-  _previous-&gt;rewind();     // rewind
-  printf(&quot;[FilterSrc] Creating from %d Hz to %d Hz\n&quot;,_wavHeader.frequency,targetFrequency);
-  if(_wavHeader.frequency==targetFrequency)
-  {
-    engaged=0;
-    return;
-  }
-    int org=_previous-&gt;getInfo()-&gt;frequency;
-    if(true!=resampler.init(org,tgt,_wavHeader.channels))
-    {
-        printf(&quot;[AudioFilter Resample] Init failed! \n&quot;);
-        engaged=0;
-        return;
-    }
-    engaged=1;
-    _wavHeader.frequency= targetFrequency;    
-     printf(&quot;[AudioFilter Resample] Init done. \n&quot;);
-};
-
-AUDMAudioFilterSrc::~AUDMAudioFilterSrc()
-{
-  printf(&quot;[AudioFilter Resample] Destroying\n&quot;);
-};
-
-#define BLK_SIZE 512
-//_____________________________________________
-uint32_t AUDMAudioFilterSrc::fill(uint32_t max,float *output,AUD_Status *status)
-{
-  if(!engaged)
-  {
-    return _previous-&gt;fill(max, output,status); 
-    
-  }
-    uint32_t snboutput=0;
-    // BLK_SIZE sample will generate blockOut sample*channel
-    float blockOutf=BLK_SIZE*_wavHeader.channels*_wavHeader.frequency;
-    blockOutf/=_previous-&gt;getInfo()-&gt;frequency;
-    uint32_t blockOut=(uint32_t)(blockOutf);
-
-    // Roundup to the next # channels
-    blockOut=(blockOut+_wavHeader.channels-1)/_wavHeader.channels;
-    blockOut*=_wavHeader.channels;
-
-    while(max&gt;blockOut)
-    {
-      // Fill incoming buffer
-        shrink();
-        fillIncomingBuffer(status);
-        if(_head==_tail)
-        {
-          *status=AUD_END_OF_STREAM;
-          return snboutput;
-        }
-        ADM_assert(_tail&gt;=_head);
-        uint32_t nb_in=(_tail-_head)/(_wavHeader.channels); // Nb Sample
-        if(nb_in&gt;BLK_SIZE) nb_in=BLK_SIZE;
-        if(!nb_in)
-        {
-          printf(&quot;[Resampler]Not enough audio\n&quot;);
-          return snboutput;
-        }
-        // We have one BLK_SIZE incoming
-        uint32_t maxSample=BLK_SIZE*4; // FIXME!
-        uint32_t nbOut=0;
-        uint32_t nbIn=nb_in;
-        uint32_t nbInTaken=0;
-        float *from,*to;
-        from=_incomingBuffer+_head;
-        to=output;
-        if(true!=resampler.process(from,to, 
-                    nbIn,
-                    maxSample,
-                    &amp;nbInTaken, 
-                    &amp;nbOut))
-        {
-                *status=AUD_END_OF_STREAM;
-                return snboutput;
-        }
-        
-      _head=_head+(nbInTaken*_wavHeader.channels);
-      snboutput+=nbOut*_wavHeader.channels;
-      output+=nbOut*_wavHeader.channels;
-      max-=nbOut*_wavHeader.channels;
-    }
-    return snboutput;
-}
-//EOF

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_dolby.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,216 +0,0 @@
-//
-// C++ Interface: audiofilter_dolby
-//
-// Description: 
-//
-//
-// Author: Mihail Zenkov &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">kreator at tut.by</A>&gt;, (C) 2006
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-#include &lt;string.h&gt;
-
-#define NZEROS 500
-#define GAIN 1.571116176e+00
-
-static float xv_left[NZEROS+1];
-static float xv_right[NZEROS+1];
-
-static float xcoeffs[] =
-{ +0.0000000000, +0.0003214310, +0.0000000000, +0.0003252099,
-+0.0000000000, +0.0003302355, +0.0000000000, +0.0003365372,
-+0.0000000000, +0.0003441444, +0.0000000000, +0.0003530868,
-+0.0000000000, +0.0003633944, +0.0000000000, +0.0003750973,
-+0.0000000000, +0.0003882260, +0.0000000000, +0.0004028113,
-+0.0000000000, +0.0004188840, +0.0000000000, +0.0004364757,
-+0.0000000000, +0.0004556178, +0.0000000000, +0.0004763424,
-+0.0000000000, +0.0004986818, +0.0000000000, +0.0005226689,
-+0.0000000000, +0.0005483367, +0.0000000000, +0.0005757189,
-+0.0000000000, +0.0006048495, +0.0000000000, +0.0006357632,
-+0.0000000000, +0.0006684951, +0.0000000000, +0.0007030809,
-+0.0000000000, +0.0007395569, +0.0000000000, +0.0007779600,
-+0.0000000000, +0.0008183281, +0.0000000000, +0.0008606994,
-+0.0000000000, +0.0009051133, +0.0000000000, +0.0009516098,
-+0.0000000000, +0.0010002299, +0.0000000000, +0.0010510155,
-+0.0000000000, +0.0011040098, +0.0000000000, +0.0011592568,
-+0.0000000000, +0.0012168018, +0.0000000000, +0.0012766915,
-+0.0000000000, +0.0013389738, +0.0000000000, +0.0014036982,
-+0.0000000000, +0.0014709156, +0.0000000000, +0.0015406788,
-+0.0000000000, +0.0016130421, +0.0000000000, +0.0016880620,
-+0.0000000000, +0.0017657969, +0.0000000000, +0.0018463073,
-+0.0000000000, +0.0019296564, +0.0000000000, +0.0020159096,
-+0.0000000000, +0.0021051351, +0.0000000000, +0.0021974040,
-+0.0000000000, +0.0022927905, +0.0000000000, +0.0023913723,
-+0.0000000000, +0.0024932304, +0.0000000000, +0.0025984499,
-+0.0000000000, +0.0027071199, +0.0000000000, +0.0028193341,
-+0.0000000000, +0.0029351907, +0.0000000000, +0.0030547934,
-+0.0000000000, +0.0031782511, +0.0000000000, +0.0033056791,
-+0.0000000000, +0.0034371988, +0.0000000000, +0.0035729386,
-+0.0000000000, +0.0037130347, +0.0000000000, +0.0038576311,
-+0.0000000000, +0.0040068807, +0.0000000000, +0.0041609461,
-+0.0000000000, +0.0043200000, +0.0000000000, +0.0044842264,
-+0.0000000000, +0.0046538214, +0.0000000000, +0.0048289944,
-+0.0000000000, +0.0050099691, +0.0000000000, +0.0051969851,
-+0.0000000000, +0.0053902989, +0.0000000000, +0.0055901856,
-+0.0000000000, +0.0057969412, +0.0000000000, +0.0060108836,
-+0.0000000000, +0.0062323557, +0.0000000000, +0.0064617271,
-+0.0000000000, +0.0066993973, +0.0000000000, +0.0069457986,
-+0.0000000000, +0.0072013994, +0.0000000000, +0.0074667084,
-+0.0000000000, +0.0077422784, +0.0000000000, +0.0080287117,
-+0.0000000000, +0.0083266658, +0.0000000000, +0.0086368590,
-+0.0000000000, +0.0089600787, +0.0000000000, +0.0092971888,
-+0.0000000000, +0.0096491399, +0.0000000000, +0.0100169797,
-+0.0000000000, +0.0104018664, +0.0000000000, +0.0108050829,
-+0.0000000000, +0.0112280539, +0.0000000000, +0.0116723666,
-+0.0000000000, +0.0121397934, +0.0000000000, +0.0126323203,
-+0.0000000000, +0.0131521795, +0.0000000000, +0.0137018887,
-+0.0000000000, +0.0142842976, +0.0000000000, +0.0149026446,
-+0.0000000000, +0.0155606252, +0.0000000000, +0.0162624744,
-+0.0000000000, +0.0170130694, +0.0000000000, +0.0178180552,
-+0.0000000000, +0.0186840011, +0.0000000000, +0.0196185982,
-+0.0000000000, +0.0206309077, +0.0000000000, +0.0217316805,
-+0.0000000000, +0.0229337690, +0.0000000000, +0.0242526657,
-+0.0000000000, +0.0257072177, +0.0000000000, +0.0273205841,
-+0.0000000000, +0.0291215436, +0.0000000000, +0.0311463069,
-+0.0000000000, +0.0334410798, +0.0000000000, +0.0360657647,
-+0.0000000000, +0.0390994399, +0.0000000000, +0.0426486966,
-+0.0000000000, +0.0468607407, +0.0000000000, +0.0519447683,
-+0.0000000000, +0.0582084316, +0.0000000000, +0.0661234757,
-+0.0000000000, +0.0764519642, +0.0000000000, +0.0905102051,
-+0.0000000000, +0.1107845781, +0.0000000000, +0.1426030657,
-+0.0000000000, +0.1998184590, +0.0000000000, +0.3332243858,
-+0.0000000000, +0.9999636803, +0.0000000000, -0.9999636803,
--0.0000000000, -0.3332243858, -0.0000000000, -0.1998184590,
--0.0000000000, -0.1426030657, -0.0000000000, -0.1107845781,
--0.0000000000, -0.0905102051, -0.0000000000, -0.0764519642,
--0.0000000000, -0.0661234757, -0.0000000000, -0.0582084316,
--0.0000000000, -0.0519447683, -0.0000000000, -0.0468607407,
--0.0000000000, -0.0426486966, -0.0000000000, -0.0390994399,
--0.0000000000, -0.0360657647, -0.0000000000, -0.0334410798,
--0.0000000000, -0.0311463069, -0.0000000000, -0.0291215436,
--0.0000000000, -0.0273205841, -0.0000000000, -0.0257072177,
--0.0000000000, -0.0242526657, -0.0000000000, -0.0229337690,
--0.0000000000, -0.0217316805, -0.0000000000, -0.0206309077,
--0.0000000000, -0.0196185982, -0.0000000000, -0.0186840011,
--0.0000000000, -0.0178180552, -0.0000000000, -0.0170130694,
--0.0000000000, -0.0162624744, -0.0000000000, -0.0155606252,
--0.0000000000, -0.0149026446, -0.0000000000, -0.0142842976,
--0.0000000000, -0.0137018887, -0.0000000000, -0.0131521795,
--0.0000000000, -0.0126323203, -0.0000000000, -0.0121397934,
--0.0000000000, -0.0116723666, -0.0000000000, -0.0112280539,
--0.0000000000, -0.0108050829, -0.0000000000, -0.0104018664,
--0.0000000000, -0.0100169797, -0.0000000000, -0.0096491399,
--0.0000000000, -0.0092971888, -0.0000000000, -0.0089600787,
--0.0000000000, -0.0086368590, -0.0000000000, -0.0083266658,
--0.0000000000, -0.0080287117, -0.0000000000, -0.0077422784,
--0.0000000000, -0.0074667084, -0.0000000000, -0.0072013994,
--0.0000000000, -0.0069457986, -0.0000000000, -0.0066993973,
--0.0000000000, -0.0064617271, -0.0000000000, -0.0062323557,
--0.0000000000, -0.0060108836, -0.0000000000, -0.0057969412,
--0.0000000000, -0.0055901856, -0.0000000000, -0.0053902989,
--0.0000000000, -0.0051969851, -0.0000000000, -0.0050099691,
--0.0000000000, -0.0048289944, -0.0000000000, -0.0046538214,
--0.0000000000, -0.0044842264, -0.0000000000, -0.0043200000,
--0.0000000000, -0.0041609461, -0.0000000000, -0.0040068807,
--0.0000000000, -0.0038576311, -0.0000000000, -0.0037130347,
--0.0000000000, -0.0035729386, -0.0000000000, -0.0034371988,
--0.0000000000, -0.0033056791, -0.0000000000, -0.0031782511,
--0.0000000000, -0.0030547934, -0.0000000000, -0.0029351907,
--0.0000000000, -0.0028193341, -0.0000000000, -0.0027071199,
--0.0000000000, -0.0025984499, -0.0000000000, -0.0024932304,
--0.0000000000, -0.0023913723, -0.0000000000, -0.0022927905,
--0.0000000000, -0.0021974040, -0.0000000000, -0.0021051351,
--0.0000000000, -0.0020159096, -0.0000000000, -0.0019296564,
--0.0000000000, -0.0018463073, -0.0000000000, -0.0017657969,
--0.0000000000, -0.0016880620, -0.0000000000, -0.0016130421,
--0.0000000000, -0.0015406788, -0.0000000000, -0.0014709156,
--0.0000000000, -0.0014036982, -0.0000000000, -0.0013389738,
--0.0000000000, -0.0012766915, -0.0000000000, -0.0012168018,
--0.0000000000, -0.0011592568, -0.0000000000, -0.0011040098,
--0.0000000000, -0.0010510155, -0.0000000000, -0.0010002299,
--0.0000000000, -0.0009516098, -0.0000000000, -0.0009051133,
--0.0000000000, -0.0008606994, -0.0000000000, -0.0008183281,
--0.0000000000, -0.0007779600, -0.0000000000, -0.0007395569,
--0.0000000000, -0.0007030809, -0.0000000000, -0.0006684951,
--0.0000000000, -0.0006357632, -0.0000000000, -0.0006048495,
--0.0000000000, -0.0005757189, -0.0000000000, -0.0005483367,
--0.0000000000, -0.0005226689, -0.0000000000, -0.0004986818,
--0.0000000000, -0.0004763424, -0.0000000000, -0.0004556178,
--0.0000000000, -0.0004364757, -0.0000000000, -0.0004188840,
--0.0000000000, -0.0004028113, -0.0000000000, -0.0003882260,
--0.0000000000, -0.0003750973, -0.0000000000, -0.0003633944,
--0.0000000000, -0.0003530868, -0.0000000000, -0.0003441444,
--0.0000000000, -0.0003365372, -0.0000000000, -0.0003302355,
--0.0000000000, -0.0003252099, -0.0000000000, -0.0003214310,
--0.0000000000,
-};
-
-static bool skip;
-
-void DolbySkip(bool on)
-{
-	skip = on;
-}
-
-void DolbyInit()
-{
-	memset(xv_left, 0, sizeof(float) * NZEROS);
-	memset(xv_right, 0, sizeof(float) * NZEROS);
-}
-
-float DolbyShiftLeft(float isamp)
-{
-if(!skip) {
-	float *p_xcoeffs = xcoeffs;
-	static int pos = 0;
-
-	if ((pos - 1) &lt; 0)
-		xv_left[NZEROS] = isamp / GAIN;
-	else
-		xv_left[pos - 1] = isamp / GAIN;
-
-	float sum = 0;
-	for (int i = pos; i &lt;= NZEROS; i++)
-		sum += (*(p_xcoeffs++) * xv_left[i]);
-
-	for (int i = 0; i &lt; pos; i++)
-		sum += (*(p_xcoeffs++) * xv_left[i]);
-
-	pos++;
-	if (pos &gt; NZEROS)
-		pos = 0;
-
-	return sum;
-}else{
-	return isamp;
-}
-}
-
-float DolbyShiftRight(float isamp)
-{
-if(!skip) {
-	float *p_xcoeffs = xcoeffs;
-	static int pos = 0;
-
-	if ((pos - 1) &lt; 0)
-		xv_right[NZEROS] = isamp / GAIN;
-	else
-		xv_right[pos - 1] = isamp / GAIN;
-
-	float sum = 0;
-	for (int i = pos; i &lt;= NZEROS; i++)
-		sum += (*(p_xcoeffs++) * xv_right[i]);
-
-	for (int i = 0; i &lt; pos; i++)
-		sum += (*(p_xcoeffs++) * xv_right[i]);
-
-	pos++;
-	if (pos &gt; NZEROS)
-		pos = 0;
-
-	return -sum;
-}else{
-	return isamp;
-}
-}

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_film2pal.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,95 +0,0 @@
-/***************************************************************************
-                          audiofilterFilm2pal
-                             -------------------
-    
-    copyright            : (C) 2002/2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_audioFilter.h&quot;
-#include &quot;audiofilter_film2pal.h&quot;
-
-AUDMAudioFilterFilm2Pal::AUDMAudioFilterFilm2Pal(AUDMAudioFilter *previous) : 
-            AUDMAudioFilterFilmChange(previous,1001,960)
-{
-    printf(&quot;[Film2Pal] Created\n&quot;);
-}
-AUDMAudioFilterPal2Film::AUDMAudioFilterPal2Film(AUDMAudioFilter *previous) : 
-            AUDMAudioFilterFilmChange(previous,960,1001)
-{
-    printf(&quot;[Pal2Film] Created\n&quot;);
-}
-#define CONTECT ((SRC_STATE *)context))
-//__________
-
-AUDMAudioFilterFilmChange::AUDMAudioFilterFilmChange(AUDMAudioFilter * instream,uint32_t from, uint32_t to):AUDMAudioFilter (instream)
-{
-    // The parameter are in sample, we deal with fq
-    if(true!=resampler.init(from,to,_wavHeader.channels))
-    {
-        printf(&quot;[AudioFilter Resample] Init failed! \n&quot;);
-        ADM_assert(0);
-    }
-    printf(&quot;[FilmChange] Creating\n&quot;);
-};
-
-AUDMAudioFilterFilmChange::~AUDMAudioFilterFilmChange()
-{
-  
-  printf(&quot;[FilmChange] Destroying\n&quot;);
-}
-//
-//___________________________________________
-uint32_t AUDMAudioFilterFilmChange::fill( uint32_t max, float * buffer,AUD_Status *status)
-{
-  uint32_t len,i,rendered;
-  uint32_t chan=_wavHeader.channels;
-  float *start;
-  
-  shrink();
-  fillIncomingBuffer(status);
-  
-  len=_tail-_head;
-  int nbBlock=max/1001;
-  max=nbBlock*960; // Prevent overflow when slowing down
-
-  if(len&gt;max) len=max;
-  
-  len=len/chan; // in sample
-
-        uint32_t maxSample=max/chan; // in sample
-        uint32_t nbOut=0;
-        uint32_t nbIn=len;
-        uint32_t nbInTaken=0;
-        float *from,*to;
-        from=_incomingBuffer+_head;
-        to=buffer;
-        if(true!=resampler.process(from,to, 
-                    nbIn,
-                    maxSample,
-                    &amp;nbInTaken, 
-                    &amp;nbOut))
-        {
-            printf(&quot;[FilmChange] EOF ??\n&quot;);
-            *status=AUD_END_OF_STREAM;
-            return 0;
-        }
-      _head=_head+(nbInTaken*chan);
-      return nbOut*chan;
-};
-
-//EOF
-

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,251 +0,0 @@
-/***************************************************************************
-                          audioeng_6dbpress.cpp  -  description
-                             -------------------
-	Derived from audactity compressor
-	see <A HREF="http://audacity.sf.net">http://audacity.sf.net</A>
- ***************************************************************************/
-/**********************************************************************
-
-  Audacity: A Digital Audio Editor
-
-  Compressor.cpp
-
-  Dominic Mazzoni
-
-  Steve Jolly made it inherit from EffectSimpleMono.
-  GUI added and implementation improved by Dominic Mazzoni, 5/11/2003.
-
-**********************************************************************/
- 
- 
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-
-#include &quot;ADM_audioFilter.h&quot;
-#include &quot;audiofilter_limiter.h&quot;
-
-
-
-AUDMAudioFilterLimiter::AUDMAudioFilterLimiter(AUDMAudioFilter *previous, DRCparam *param):AUDMAudioFilter (previous)
-{
-uint32_t nbChan=previous-&gt;getInfo()-&gt;channels;
-#define AMP 4
-    _previous-&gt;rewind();
-    memcpy(&amp;_param,param,sizeof(_param));
-//
-// The base is 100 ms
-//
-
-    mCircleSize=DRC_WINDOW;
-    mCircleSize=mCircleSize-(mCircleSize%nbChan);
-    drc_cleanup();
-    printf(&quot;[DRC] Created DRC:%u Window:%u nbChan %u\n&quot;,mCircleSize,DRC_WINDOW,nbChan);
-
-};
-void AUDMAudioFilterLimiter::drc_cleanup(void)
-{
-  float mCurRate=(float)_wavHeader.frequency;
-   
-  for(int j=0; j&lt;mCircleSize; j++) {
-      mCircle[j] = 0.0;
-      mLevelCircle[j] = _param.mFloor;
-   }
-   mCirclePos = 0;
-   mRMSSum = 0.0;
-
-   mGainDB = ((_param.mThresholdDB*-0.7) * (1 - 1/_param.mRatio));
-   if (mGainDB &lt; 0)
-      mGainDB = 0;
-
-   mThreshold = pow(10.0, _param.mThresholdDB/10); // factor of 10 because it's power
-
-   if (_param.mUseGain)
-      mGain = pow(10.0, mGainDB/20); // factor of 20 because it's amplitude
-   else
-      mGain = 1.0;
-
-   mAttackFactor = exp(-log(_param.mFloor) / (mCurRate * _param.mAttackTime + 0.5));
-   mDecayFactor = exp(log(_param.mFloor) / (mCurRate * _param.mDecayTime + 0.5));
-
-   mLastLevel = 0.0;
-   
-   memset(mCircle,0,sizeof(mCircle));
-   memset(follow,0,sizeof(follow));
-   memset(mLevelCircle,0,sizeof(mLevelCircle));
-    
-}
-//
-AUDMAudioFilterLimiter::~AUDMAudioFilterLimiter()
-{
-  printf(&quot;[DRC] Destroyed\n&quot;);
-}
-
-uint32_t   AUDMAudioFilterLimiter::fill(uint32_t max,float *output,AUD_Status *status)
-{
-  uint32_t len,i;
-  
-  shrink();
-  fillIncomingBuffer(status);
-  
-  
-  len=_tail-_head;
-  if(len&gt;max) len=max;
-  if(len&gt;=DELIM_WINDOW_SIZE) len=DELIM_WINDOW_SIZE-1;
-  
-  // Count in full sample  i.e. all channels
-  len=len-(len%_wavHeader.channels);
-  
-  // Process..
-  if (mLastLevel == 0.0) {
-    int preSeed = mCircleSize;
-    if (preSeed &gt; len)
-      preSeed = len;
-    for(i=0; i&lt;preSeed; i++)
-      AvgCircle(_incomingBuffer[_head+i]);
-  }
-  
-    for (i = 0; i &lt; len; i++) {
-      Follow(_incomingBuffer[_head+i], &amp;follow[i], i);
-    }
-
-    for (i = 0; i &lt; len; i++) {
-      output[i] =DoCompression(_incomingBuffer[_head+i], follow[i]);
-    }  
-    _head+=len;
-    return len;
-}
-
-float AUDMAudioFilterLimiter::AvgCircle(float value)
-{
-  float level;
-
-   // Calculate current level from root-mean-squared of
-   // circular buffer (&quot;RMS&quot;)
-   mRMSSum -= mCircle[mCirclePos];
-   mCircle[mCirclePos] = value*value;
-   mRMSSum += mCircle[mCirclePos];
-   level = sqrt(mRMSSum/mCircleSize);
-   mLevelCircle[mCirclePos] = level;
-   mCirclePos = (mCirclePos+1)%mCircleSize;  
-   return level;
-}
-
-void AUDMAudioFilterLimiter::Follow(float x, float *outEnv, int maxBack)
-{
-   /*
-
-   &quot;Follow&quot;ing algorithm by Roger B. Dannenberg, taken from
-   Nyquist.  His description follows.  -DMM
-
-   Description: this is a sophisticated envelope follower.
-    The input is an envelope, e.g. something produced with
-    the AVG function. The purpose of this function is to
-    generate a smooth envelope that is generally not less
-    than the input signal. In other words, we want to &quot;ride&quot;
-    the peaks of the signal with a smooth function. The 
-    algorithm is as follows: keep a current output value
-    (called the &quot;value&quot;). The value is allowed to increase
-    by at most rise_factor and decrease by at most fall_factor.
-    Therefore, the next value should be between
-    value * rise_factor and value * fall_factor. If the input
-    is in this range, then the next value is simply the input.
-    If the input is less than value * fall_factor, then the
-    next value is just value * fall_factor, which will be greater
-    than the input signal. If the input is greater than value *
-    rise_factor, then we compute a rising envelope that meets
-    the input value by working bacwards in time, changing the
-    previous values to input / rise_factor, input / rise_factor^2,
-    input / rise_factor^3, etc. until this new envelope intersects
-    the previously computed values. There is only a limited buffer
-    in which we can work backwards, so if the new envelope does not
-    intersect the old one, then make yet another pass, this time
-    from the oldest buffered value forward, increasing on each 
-    sample by rise_factor to produce a maximal envelope. This will 
-    still be less than the input.
-    
-    The value has a lower limit of floor to make sure value has a 
-    reasonable positive value from which to begin an attack.
-   */
-
-   float level = AvgCircle(x);
-   float high = mLastLevel * mAttackFactor;
-   float low = mLastLevel * mDecayFactor;
-
-   if (low &lt; _param.mFloor)
-      low = _param.mFloor;
-
-   if (level &lt; low)
-      *outEnv = low;
-   else if (level &lt; high)
-      *outEnv = level;
-   else {
-      // Backtrack
-     float attackInverse = 1.0 / mAttackFactor;
-     float temp = level * attackInverse;
-
-      int backtrack = 50;
-      if (backtrack &gt; maxBack)
-         backtrack = maxBack;
-
-      float *ptr = &amp;outEnv[-1];
-      int i;
-      bool ok = false;
-      for(i=0; i&lt;backtrack-2; i++) {
-         if (*ptr &lt; temp) {
-            *ptr-- = temp;
-            temp *= attackInverse;
-         }
-         else {
-            ok = true;
-            break;
-         }   
-      }
-
-      if (!ok &amp;&amp; backtrack&gt;1 &amp;&amp; (*ptr &lt; temp)) {
-         temp = *ptr;
-         for (i = 0; i &lt; backtrack-1; i++) {
-            ptr++;
-            temp *= mAttackFactor;
-            *ptr = temp;
-         }
-      }
-      else
-         *outEnv = level;
-   }
-
-   mLastLevel = *outEnv;
-}
-
-float AUDMAudioFilterLimiter::DoCompression(float value, float env)
-{
-   float mult;
-   float out;
-
-   if (env &gt; mThreshold)
-      mult = mGain * pow(mThreshold/env, 1.0/_param.mRatio);
-   else
-      mult = mGain;
-
-   out = value * mult;
-
-   if (out &gt; 1.0)
-      out = 1.0;
-
-   if (out &lt; -1.0)
-      out = -1.0;
-
-   return out;
-}
-//EOF

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp	2009-03-15 09:57:35 UTC (rev 4693)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiofilter_normalize.cpp	2009-03-15 14:50:00 UTC (rev 4694)
@@ -1,184 +0,0 @@
-/***************************************************************************
-                          audiofilter_normalize
-                             -------------------
-    
-    copyright            : (C) 2002/2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-    
-    Compute the ratio so that the maximum is at -3db
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_audioFilter.h&quot;
-#include &quot;audiofilter_normalize_param.h&quot;
-#include &quot;audiofilter_normalize.h&quot;
-#include &quot;audiofilter_dolby.h&quot;
-
-#include &quot;ADM_audio/aviaudio.hxx&quot;
-//#include &quot;ADM_dialog/DIA_busy.h&quot; //CANNOT USE IT! We are in another thread!
-
-extern AVDMGenericAudioStream *currentaudiostream;
-
-#ifdef __WIN32
-#define POW10(x)   pow(10,x)
-#elif defined(ADM_BSD_FAMILY)
-#define POW10(x) powf(10.0,x)
-#else
-#define POW10(x)  pow10f(x)
-#endif
-
-#define LINEAR_TO_DB(x) (20.*log10(x))
-#define DB_TO_LINEAR(x) (POW10((x/20.)))
-
-// Ctor
-//__________
-
-AUDMAudioFilterNormalize::AUDMAudioFilterNormalize(AUDMAudioFilter * instream,GAINparam *param):AUDMAudioFilter (instream)
-{
-  float db_out;
-    // nothing special here...
-  switch(param-&gt;mode)
-  {
-    case ADM_NO_GAIN: _ratio=1;_scanned=1;printf(&quot;[Gain] Gain of 1.0\n&quot;);break; 
-    case ADM_GAIN_AUTOMATIC: _ratio=1;_scanned=0;printf(&quot;[Gain] Automatic gain\n&quot;);break;
-    case ADM_GAIN_MANUAL: 
-                _scanned=1;
-                db_out =  param-&gt;gain10/10.0; // Dbout is in 10*DB (!)
-                _ratio = DB_TO_LINEAR(db_out);
-                printf(&quot;[Gain] %f db (p=%d)\n&quot;, (float)(param-&gt;gain10)/10.,param-&gt;gain10);
-                printf(&quot;[Gain] Linear ratio of : %03.3f\n&quot;, _ratio);
-  }
-    _previous-&gt;rewind();
-};
-
-AUDMAudioFilterNormalize::~AUDMAudioFilterNormalize()
-{
-
-}
-//
-// For normalize, we scan the input stream
-// to check for maximum value
-//___________________________________________
-uint8_t AUDMAudioFilterNormalize::preprocess(void)
-{
-
-    int16_t *ptr;
-    uint32_t scanned = 0, ch = 0;
-    AUD_Status status;
-    _ratio = 0;
-
-    uint32_t percent=0;
-    uint32_t current=0,llength=0;
-    float max[_wavHeader.channels];
-    _previous-&gt;rewind();
-    DolbySkip(1);
-    printf(&quot;\n Seeking for maximum value, that can take a while\n&quot;);
-
-    llength=_length ;
-    
-
-      for(int i=0;i&lt;_wavHeader.channels;i++) max[i]=0;
-      while (1)
-      {
-          int ready=_previous-&gt;fill(AUD_PROCESS_BUFFER_SIZE&gt;&gt;2,_incomingBuffer,&amp;status);
-          if(!ready)
-          {
-            if(status==AUD_END_OF_STREAM) 
-            {
-              break; 
-            }
-           else 
-            {
-              printf(&quot;Unknown cause : %d\n&quot;,status);
-              ADM_assert(0); 
-            }
-          }
-          ADM_assert(!(ready %_wavHeader.channels));
-          
-          int index=0;
-          float current;
-          
-        //  printf(&quot;*\n&quot;);
-          int sample= ready /_wavHeader.channels;
-          for(int j=0;j&lt;sample;j++)
-            for(int chan=0;chan&lt;_wavHeader.channels;chan++)
-          {
-            current=fabs(_incomingBuffer[index++]);
-            if(current&gt;max[chan]) max[chan]=current;
-          }
-          scanned+=ready;
-      }
-      
-      
-      
-
-    _previous-&gt;rewind();
-    float mx=0;
-    for(int chan=0;chan&lt;_wavHeader.channels;chan++)
-    {
-        if(max[chan]&gt;mx) mx=max[chan];
-        printf(&quot;[Normalize] maximum found for channel %d : %f\n&quot;, chan,max[chan]);
-    }
-    printf(&quot;[Normalize] Using : %0.4f as max value \n&quot;, mx);
-    double db_in, db_out=-3;
-
-    if (mx&gt;0.001)
-      db_in = LINEAR_TO_DB(mx);
-    else
-      db_in = -20; // We consider -20 DB to be noise
-
-    printf(&quot;--&gt; %2.2f db / %2.2f \n&quot;, db_in, db_out);
-
-    // search ratio
-    _ratio=1;
-
-    float db_delta=db_out-db_in;
-    printf(&quot;[Normalize]Gain %f dB\n&quot;,db_delta);
-    _ratio = DB_TO_LINEAR(db_delta);
-    printf(&quot;\n Using ratio of : %f\n&quot;, _ratio);
-
-    _scanned = 1;
-    DolbySkip(0);
-    _previous-&gt;rewind();
-    return 1;
-}
-//
-//___________________________________________
-uint32_t AUDMAudioFilterNormalize::fill( uint32_t max, float * buffer,AUD_Status *status)
-{
-    uint32_t rd, i, j,rd2;
-
-    *status=AUD_OK;
-    if(!_scanned) preprocess();
-    rd = _previous-&gt;fill(max, _incomingBuffer,status);
-    if(!rd)
-    {
-      if(*status==AUD_END_OF_STREAM) return 0;
-      ADM_assert(0);
-    }
-    float *in,*out,tmp;
-    for (i = 0; i &lt; rd; i++)
-    {
-      tmp=_incomingBuffer[i];
-      tmp*=_ratio;
-      buffer[i]=tmp;
-    }
-    return rd;
-};
-//EOF
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001923.html">[Avidemux-svn-commit] r4693 - in branches/avidemux_2.6_branch_mean:	avidemux/ADM_audio avidemux/ADM_audioFilter/include	avidemux/ADM_audioFilter/src avidemux/ADM_audiofilter	avidemux/ADM_editor avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_demuxers/MpegPS
</A></li>
	<LI>Next message: <A HREF="001925.html">[Avidemux-svn-commit] r4695 - in	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers: Flv	Matroska Mp4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1924">[ date ]</a>
              <a href="thread.html#1924">[ thread ]</a>
              <a href="subject.html#1924">[ subject ]</a>
              <a href="author.html#1924">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
