<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3952 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_coreUI/include ADM_coreUI/src	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3952%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_coreUI/include%20ADM_coreUI/src%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory&In-Reply-To=%3C200803300800.m2U80ti0023562%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001213.html">
   <LINK REL="Next"  HREF="001215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3952 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_coreUI/include ADM_coreUI/src	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3952%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_coreUI/include%20ADM_coreUI/src%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory&In-Reply-To=%3C200803300800.m2U80ti0023562%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3952 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_coreUI/include ADM_coreUI/src	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory">mean at mail.berlios.de
       </A><BR>
    <I>Sun Mar 30 10:00:55 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001213.html">[Avidemux-svn-commit] r3951 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_coreUI/include ADM_coreUI/src	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
        <LI>Next message: <A HREF="001215.html">[Avidemux-svn-commit] r3953 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mp4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1214">[ date ]</a>
              <a href="thread.html#1214">[ thread ]</a>
              <a href="subject.html#1214">[ subject ]</a>
              <a href="author.html#1214">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-03-30 10:00:55 +0200 (Sun, 30 Mar 2008)
New Revision: 3952

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
Log:
[Factory] file &amp; dir


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h	2008-03-30 08:00:52 UTC (rev 3951)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h	2008-03-30 08:00:55 UTC (rev 3952)
@@ -59,16 +59,16 @@
 	CREATE_UINTEGER_T    *CreateUInteger;
 	DELETE_DIA_ELEM_T    *DestroyUInteger;
 // Notch	
-	CREATE_NOTCH_T   *CreateNotch;
+	CREATE_NOTCH_T       *CreateNotch;
 	DELETE_DIA_ELEM_T    *DestroyNotch;
 // ReadonlyText
 	CREATE_READONLYTEXT_T *CreateReadonlyText;
-	DELETE_DIA_ELEM_T    *DestroyReadonlyText;
+	DELETE_DIA_ELEM_T     *DestroyReadonlyText;
 // Text
-	CREATE_TEXT_T    *CreateText;
+	CREATE_TEXT_T        *CreateText;
 	DELETE_DIA_ELEM_T    *DestroyText;
 // Hex
-	CREATE_HEX_T     *CreateHex;
+	CREATE_HEX_T         *CreateHex;
 	DELETE_DIA_ELEM_T    *DestroyHex;
 // Matrix
 	CREATE_MATRIX_T      *CreateMatrix;
@@ -85,6 +85,12 @@
 // Bitrate
 	CREATE_BITRATE_T     *CreateBitrate;
 	DELETE_DIA_ELEM_T    *DestroyBitrate;
+// File
+	CREATE_FILE_T        *CreateFile;
+	DELETE_DIA_ELEM_T    *DestroyFile;
+// Dir
+	CREATE_DIR_T         *CreateDir;
+	DELETE_DIA_ELEM_T    *DestroyDir;
 }FactoryDescriptor;
 //
 uint8_t DIA_factoryInit(FactoryDescriptor *d);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2008-03-30 08:00:52 UTC (rev 3951)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2008-03-30 08:00:55 UTC (rev 3952)
@@ -344,6 +344,7 @@
 };
 
 /*************************************************/
+typedef diaElem *CREATE_FILE_T(uint32_t writeMode,char **filename,const char *toggleTitle,  const char *defaultSuffix ,const char *tip);
 class diaElemFile : public diaElem
 {
 
@@ -361,6 +362,7 @@
   void   enable(uint32_t onoff);
 };
 /*************************************************/
+typedef diaElem *CREATE_DIR_T(char **filename,const char *toggleTitle,const char *tip);
 class diaElemDirSelect : public diaElem
 {
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2008-03-30 08:00:52 UTC (rev 3951)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2008-03-30 08:00:55 UTC (rev 3952)
@@ -4,6 +4,10 @@
   Check the GTK/QT/.. functions to see the intersting parts
   (C) Mean 2008 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
 
+/!\ Big Warning, each time there is a cast, it is a gross hack and needs to be fixed
+ later by using proper inheritance. It is very dangerous as it is.
+
+
  ***************************************************************************/
 
 /***************************************************************************
@@ -325,7 +329,55 @@
 	
 }
 DIA_MKSTUBS(diaElemBitrate)
+// ****************** diaElemFile ********************
+diaElemFile ::diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,
+        const char *defaultSuffix ,const char *tip):
+	diaElem(ELEM_FILE_READ)
+{
+	ADM_assert(Factory); 
+	internalPointer=Factory-&gt;CreateFile(writeMode,filename,toggleTitle,defaultSuffix,tip);
+}
+diaElemFile ::~diaElemFile()
+{
+	ADM_assert(Factory); 
+	Factory-&gt;DestroyBitrate(internalPointer);
+	internalPointer=NULL;
+}
+void      diaElemFile::enable(uint32_t onoff)
+	{ 
+		ADM_assert(internalPointer); 
+		internalPointer-&gt;enable(onoff); 
+	}
+void      diaElemFile::changeFile(void)
+	{ 
+	diaElemFile *cast=(diaElemFile *)internalPointer;
+	cast-&gt;changeFile();
+	}
+DIA_MKSTUBS(diaElemFile)
 
-//
+// ****************** diaElemDirSelect ********************
+diaElemDirSelect ::diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip):
+	diaElem(ELEM_DIR_SELECT)
+{
+	ADM_assert(Factory); 
+	internalPointer=Factory-&gt;CreateDir( filename, toggleTitle, tip);
+}
+diaElemDirSelect ::~diaElemDirSelect()
+{
+	ADM_assert(Factory); 
+	Factory-&gt;DestroyBitrate(internalPointer);
+	internalPointer=NULL;
+}
+void      diaElemDirSelect::enable(uint32_t onoff)
+	{ 
+		ADM_assert(internalPointer); 
+		internalPointer-&gt;enable(onoff); 
+	}
+void      diaElemDirSelect::changeFile(void)
+	{ 
+	diaElemDirSelect *cast=(diaElemDirSelect *)internalPointer;
+	cast-&gt;changeFile();
+	}
+DIA_MKSTUBS(diaElemDirSelect)
 
 // EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2008-03-30 08:00:52 UTC (rev 3951)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2008-03-30 08:00:55 UTC (rev 3952)
@@ -321,6 +321,12 @@
 extern DELETE_DIA_ELEM_T    gtkDestroyThreadCount;
 extern CREATE_BITRATE_T     gtkCreateBitrate;
 extern DELETE_DIA_ELEM_T    gtkDestroyBitrate;
+extern CREATE_FILE_T        gtkCreateFile;
+extern DELETE_DIA_ELEM_T    gtkDestroyFile;
+extern CREATE_DIR_T         gtkCreateDir;
+extern DELETE_DIA_ELEM_T    gtkDestroyDir;
+
+
 //************
 static FactoryDescriptor GtkFactoryDescriptor=
 {
@@ -366,7 +372,13 @@
 	&amp;gtkDestroyThreadCount,
 	// Bitrate
 	&amp;gtkCreateBitrate,
-	&amp;gtkDestroyBitrate
+	&amp;gtkDestroyBitrate,
+	// File
+	&amp;gtkCreateFile,
+	&amp;gtkDestroyFile,
+	// Dir
+	&amp;gtkCreateDir,
+	&amp;gtkDestroyDir
 		
 };
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2008-03-30 08:00:52 UTC (rev 3951)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2008-03-30 08:00:55 UTC (rev 3952)
@@ -15,7 +15,38 @@
 #include &quot;../ADM_toolkit_gtk/toolkit_gtk.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;DIA_fileSel.h&quot;
+#include &quot;prefs.h&quot;
+namespace ADM_GtkFactory
+{
+class diaElemFile : public diaElem
+{
 
+protected:
+    const char * defaultSuffix;
+public:
+  
+  diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,
+              const char *defaultSuffix = 0,const char *tip=NULL);
+  virtual ~diaElemFile() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+  uint32_t _write;
+  void   changeFile(void);
+  void   enable(uint32_t onoff);
+};
+class diaElemDirSelect : public diaElem
+{
+
+public:
+  
+  diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip=NULL);
+  virtual ~diaElemDirSelect() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+  
+  void changeFile(void);
+  void   enable(uint32_t onoff);
+};
 static void fileRead(void *w,void *p);
 static void dirSel(void *w,void *p);
 
@@ -305,5 +336,27 @@
   diaElemDirSelect *me=(diaElemDirSelect *)p;
   me-&gt;changeFile();
 }
+} // End of namespace
+//****************************Hoook*****************
 
+diaElem  *gtkCreateFile(uint32_t writeMode,char **filename,const char *toggleTitle,
+        const char *defaultSuffix ,const char *tip)
+{
+	return new  ADM_GtkFactory::diaElemFile(writeMode,filename,toggleTitle,defaultSuffix ,tip);
+}
+void gtkDestroyFile(diaElem *e)
+{
+	ADM_GtkFactory::diaElemFile *a=(ADM_GtkFactory::diaElemFile *)e;
+	delete a;
+}
+
+diaElem  *gtkCreateDir(char **filename,const char *toggleTitle,const char *tip)
+{
+	return new  ADM_GtkFactory::diaElemDirSelect(filename,toggleTitle,tip);
+}
+void gtkDestroyDir(diaElem *e)
+{
+	ADM_GtkFactory::diaElemDirSelect *a=(ADM_GtkFactory::diaElemDirSelect *)e;
+	delete a;
+}
 //EOF


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001213.html">[Avidemux-svn-commit] r3951 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_coreUI/include ADM_coreUI/src	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
	<LI>Next message: <A HREF="001215.html">[Avidemux-svn-commit] r3953 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mp4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1214">[ date ]</a>
              <a href="thread.html#1214">[ thread ]</a>
              <a href="subject.html#1214">[ subject ]</a>
              <a href="author.html#1214">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
