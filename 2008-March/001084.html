<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3818 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_libraries avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_videoFilter cmake cmake_compile_check
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3818%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_libraries%20avidemux/ADM_libraries/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_libmpeg2enc%0A%09avidemux/ADM_libraries/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_script%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/ADM_videoFilter%20cmake%20cmake_compile_check&In-Reply-To=%3C200803030927.m239RAwO009128%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001083.html">
   <LINK REL="Next"  HREF="001085.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3818 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_libraries avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_videoFilter cmake cmake_compile_check</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3818%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_libraries%20avidemux/ADM_libraries/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_libmpeg2enc%0A%09avidemux/ADM_libraries/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_script%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/ADM_videoFilter%20cmake%20cmake_compile_check&In-Reply-To=%3C200803030927.m239RAwO009128%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3818 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_libraries avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_videoFilter cmake cmake_compile_check">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Mar  3 10:27:10 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001083.html">[Avidemux-svn-commit] r3817 - branches
</A></li>
        <LI>Next message: <A HREF="001085.html">[Avidemux-svn-commit] r3819 - in	branches/avidemux_2.5_branch_gruntster: . cmake cmake_compile_check
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1084">[ date ]</a>
              <a href="thread.html#1084">[ thread ]</a>
              <a href="subject.html#1084">[ subject ]</a>
              <a href="author.html#1084">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-03-03 10:26:56 +0100 (Mon, 03 Mar 2008)
New Revision: 3818

Added:
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_altivec_check.cpp
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ppc_check.cpp
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ssse3_check.cpp
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86-64_check.cpp
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86_check.cpp
Removed:
   branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckMiscLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admDetermineSystem.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
Log:
[CMake] guess GCC CPU support and remove CYG_MANGLING and ADM_OS_*

Modified: branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -39,22 +39,15 @@
 ########################################
 INCLUDE(admDetermineSystem)
 
-IF (ADM_OS_WINDOWS)
-	SET(CYG_MANGLING 1)
-ENDIF (ADM_OS_WINDOWS)
-
-IF (ADM_OS_DARWIN)
-	SET(CYG_MANGLING 1)
-ENDIF (ADM_OS_DARWIN)
-
 IF (CYGWIN)
 	SET(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -mwin32&quot;)
 	SET(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -mwin32&quot;)
 ENDIF (CYGWIN)
 
-IF (ADM_OS_LINUX)
-	SET(USE_JOG 1)		# jog shuttle is only available on Linux due to its interface
-ENDIF (ADM_OS_LINUX)
+IF (UNIX)
+	# jog shuttle is only available on Linux due to its interface
+	SET(USE_JOG 1)
+ENDIF (UNIX)
 
 ########################################
 # Standard Avidemux defines
@@ -78,15 +71,17 @@
 	SET(ARCH_X86_64 1)
 	SET(ARCH_64_BITS 1)
 ELSEIF (ADM_CPU_PPC)
-	OPTION(ALTIVEC &quot;&quot;  ON)
+	SET(ARCH_POWERPC 1)
 
-	IF (ALTIVEC)
-		SET(ADM_CPUCAP_ALTIVEC 1)
+	IF (ADM_CPU_ALTIVEC)
 		SET(ARCH_PPC 1)
-		SET(ARCH_POWERPC 1)
 		SET(USE_ALTIVEC 1)
 		SET(HAVE_ALTIVEC 1)
-	ENDIF (ALTIVEC)
+
+		IF (NOT APPLE)
+			SET(HAVE_ALTIVEC_H 1)
+		ENDIF (NOT APPLE)
+	ENDIF (ADM_CPU_ALTIVEC)
 ENDIF (ADM_CPU_X86)
 
 IF (CMAKE_WORDS_BIGENDIAN)
@@ -118,16 +113,11 @@
 ###########################################
 # CPU Specific
 ###########################################
-IF (ADM_CPUCAP_ALTIVEC)
-	SET(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -mabi=altivec -maltivec&quot;)
-	SET(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -mabi=altivec -maltivec&quot;)
+IF (ADM_CPU_ALTIVEC)
+	SET(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${ADM_ALTIVEC_FLAGS}&quot;)
+	SET(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${ADM_ALTIVEC_FLAGS}&quot;)
+ENDIF (ADM_CPU_ALTIVEC)
 
-	IF (ADM_OS_DARWIN)
-		SET(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -faltivec&quot;)
-		SET(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -faltivec&quot;)
-	ENDIF (ADM_OS_DARWIN)
-ENDIF (ADM_CPUCAP_ALTIVEC)
-
 ########################################
 # Subversion
 ########################################
@@ -191,10 +181,6 @@
 CHECK_INCLUDE_FILES(unistd.h     HAVE_UNISTD_H)		# internal use, ass, mad
 CHECK_INCLUDE_FILES(malloc.h     HAVE_MALLOC_H)		# libavcodec, libavutil, libpostproc, libswscale, mplex
 
-IF (ADM_CPUCAP_ALTIVEC AND NOT ADM_OS_DARWIN)
-	CHECK_INCLUDE_FILES(altivec.h    HAVE_ALTIVEC_H)	# libavcodec, libpostproc, libswscale, mpeg2dec, mpeg2enc
-ENDIF (ADM_CPUCAP_ALTIVEC AND NOT ADM_OS_DARWIN)
-
 MESSAGE(&quot;&quot;)
 
 ########################################

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -40,12 +40,12 @@
 		i386/snowdsp_mmx.c i386/fft_3dn.c)
 ENDIF(ARCH_X86)
 
-IF (ADM_CPUCAP_ALTIVEC)
+IF (ADM_CPU_ALTIVEC)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
 		ppc/dsputil_altivec.c  ppc/dsputil_ppc.c  ppc/fdct_altivec.c  ppc/fft_altivec.c  ppc/float_altivec.c  ppc/gmc_altivec.c
 		ppc/h264_altivec.c  ppc/idct_altivec.c  ppc/int_altivec.c  ppc/mpegvideo_altivec.c  ppc/mpegvideo_ppc.c
 		ppc/snow_altivec.c  ppc/vc1dsp_altivec.c)
-ENDIF (ADM_CPUCAP_ALTIVEC)
+ENDIF (ADM_CPU_ALTIVEC)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I../ADM_lavutil -DHAVE_AV_CONFIG_H -Drestrict=__restrict__ -fomit-frame-pointer -include ffconf.h&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -11,7 +11,7 @@
 fdctref.cc            macroblock.cc         motion.cc                   predcomp_mmx.cc  putmpg.cc         ratectl.cc       ADM_mpe2enc.cpp
 )
 
-IF (ADM_CPUCAP_ALTIVEC)
+IF (ADM_CPU_ALTIVEC)
 	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS}
 		altivec/add_pred.c   altivec/amber.c  altivec/benchmark.c  altivec/bsad.c  altivec/bsumsq.c  altivec/bsumsq_sub22.c  altivec/build_sub22_mests.c
 		altivec/build_sub44_mests.c  altivec/detect.c  altivec/fdct.c  altivec/fdct_idct.c  altivec/field_dct_best.c  altivec/find_best_one_pel.c
@@ -19,7 +19,7 @@
 		altivec/quant_weight_coeff_sum.c  altivec/quantize.c  altivec/sad_00.c  altivec/sad_01.c  altivec/sad_10.c  altivec/sad_11.c
 		altivec/sub_mean_reduction.c  altivec/sub_mean_reduction_ppc.S  altivec/sub_pred.c  altivec/subsample_image.c  altivec/sumsq.c
 		altivec/sumsq_sub22.c  altivec/variance.c)
-ENDIF (ADM_CPUCAP_ALTIVEC)
+ENDIF (ADM_CPU_ALTIVEC)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I${CMAKE_CURRENT_SOURCE_DIR}&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -6,10 +6,10 @@
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DCONFIG_GPL -fomit-frame-pointer&quot;)
 
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DPIC&quot;)
 	
 	IF (ADM_DEBUG)
 		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-O2&quot;)
 	ENDIF (ADM_DEBUG)
-ENDIF (ADM_OS_DARWIN)
\ No newline at end of file
+ENDIF (APPLE)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -9,6 +9,6 @@
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I${CMAKE_CURRENT_SOURCE_DIR} -DHAVE_FMAX&quot;)
 
-IF (NOT ADM_OS_APPLE)
+IF (NOT APPLE)
     ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_MEMALIGN&quot;)
-ENDIF (NOT ADM_OS_APPLE)
+ENDIF (NOT APPLE)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h	2008-03-03 09:26:56 UTC (rev 3818)
@@ -1,15 +1,29 @@
 // Symbol mangling for asm
-// is different on win32
 // Shamelessly borrowed from lavcodec
+#if ( defined(__PIC__) || defined(__pic__) ) &amp;&amp; ! defined(PIC)
+#    define PIC
+#endif
 
-#ifdef CYG_MANGLING // CYGWIN
-	#define Mangle(x) &quot;_&quot; #x
-	#define MANGLE(x) &quot;_&quot; #x
+// Use rip-relative addressing if compiling PIC code on x86-64.
+#if defined(__MINGW32__) || defined(__CYGWIN__) || defined(__DJGPP__) || \
+    defined(__OS2__) || (defined (__OpenBSD__) &amp;&amp; !defined(__ELF__))
+#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#        define MANGLE(a) &quot;_&quot; #a&quot;(%%rip)&quot;
+#    else
+#        define MANGLE(a) &quot;_&quot; #a
+#    endif
 #else
-	#define Mangle(x) #x
-	#define MANGLE(x) #x
+#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#        define MANGLE(a) #a&quot;(%%rip)&quot;
+#    elif defined(__APPLE__)
+#        define MANGLE(a) &quot;_&quot; #a
+#    else
+#        define MANGLE(a) #a
+#    endif
 #endif
 
+#define Mangle MANGLE
+
 #define ADM_ALIGN16 &quot;.p2align 4\n&quot;
 /* Regiter renaming */
 #ifdef ARCH_X86_64

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -23,6 +23,6 @@
 	subdirs (PREORDER ADM_nvwa)
 endif (ADM_DEBUG AND FIND_LEAKS)
 
-if (ADM_OS_DARWIN AND USE_SDL)
+if (APPLE AND USE_SDL)
 	subdirs (PREORDER ADM_libsdl)
-endif (ADM_OS_DARWIN AND USE_SDL)
\ No newline at end of file
+endif (APPLE AND USE_SDL)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -14,7 +14,7 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-#ifdef __unix__
+#if defined(__unix__) || defined(__APPLE__)
 int CDirectorySearch::_findnext(unsigned long int hDir,_finddata_t *pfdData)
 {// begin _findnext
 	if(!hDir || hDir == 0xFFFFFFFF)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.h	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/DirectorySearch.h	2008-03-03 09:26:56 UTC (rev 3818)
@@ -27,7 +27,7 @@
 // create a non file bit for unix
 #define _A_NONFILE	0x03
 
-#if (defined( __unix__)||defined(__APPLE__)) &amp;&amp; !defined(__MINGW32__)
+#if defined( __unix__) || defined(__APPLE__)
 
 // wrap the file mode bits
 #define _A_NORMAL	0x00
@@ -104,7 +104,7 @@
 	_finddata_t m_fdData;
 	std::string m_sDirectory;
 private:
-#ifdef __unix__
+#if defined(__unix__) || defined(__APPLE__)
 	// prototypes
 	int _findfirst(const char *path,_finddata_t *pfdData);
 	int _findnext(unsigned long int hDir,_finddata_t *pfdData);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -3,9 +3,9 @@
 SET(${ADM_LIB}_SRCS
 	GUI_bindings.cpp  GUI_gtkRender.cpp  GUI_keymap.cpp  GUI_main2.cpp)
 
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} GUI_gtkRenderHelper.m)
-ENDIF (ADM_OS_DARWIN)
+ENDIF (APPLE)
 
 ADD_ADM_LIB_GTK_TARGET(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_GTK_TARGET(${ADM_LIB} ${GTK_CFLAGS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -9,9 +9,9 @@
 DIA_flyEq2.cpp        DIA_flv1.cpp            DIA_flyThreshold.cpp DIA_flyParticle.cpp DIA_flyEraser.cpp DIA_flySwissArmyKnife.cpp
 )
 
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} GUI_sdlRenderHelper.m)
-ENDIF (ADM_OS_DARWIN)
+ENDIF (APPLE)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -42,9 +42,9 @@
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_videoFilter ${ADM_videoFilter_SRCS})
 
-IF (ADM_OS_DARWIN AND ADM_DEBUG)
+IF (APPLE AND ADM_DEBUG)
 	SET_SOURCE_FILES_PROPERTIES(ADM_vidYadif_asm.c PROPERTIES COMPILE_FLAGS &quot;-O2&quot;)
-ENDIF (ADM_OS_DARWIN AND ADM_DEBUG)
+ENDIF (APPLE AND ADM_DEBUG)
 
 IF (USE_FREETYPE)
 	ADD_SOURCE_CFLAGS(ADM_vidSRT.cpp &quot;${FREETYPE2_CFLAGS}&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-03 09:26:56 UTC (rev 3818)
@@ -63,7 +63,7 @@
 ########################################
 # Embed resources for executables
 ########################################
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	# add icon
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${CMAKE_CURRENT_SOURCE_DIR}/xpm/avidemux.icns)
 	SET_SOURCE_FILES_PROPERTIES(${CMAKE_CURRENT_SOURCE_DIR}/xpm/avidemux.icns PROPERTIES MACOSX_PACKAGE_LOCATION Resources)
@@ -80,9 +80,9 @@
 	SET(MACOSX_BUNDLE_LONG_VERSION_STRING &quot;${ADM_OSX_VERSION}&quot;) 
 	SET(MACOSX_BUNDLE_SHORT_VERSION_STRING &quot;${ADM_OSX_VERSION}&quot;)
 	SET(MACOSX_BUNDLE_VERSION &quot;${ADM_OSX_VERSION}&quot;)
-ENDIF (ADM_OS_DARWIN)
+ENDIF (APPLE)
 
-IF (ADM_OS_WINDOWS)
+IF (WIN32)
 	# add icon and version info
 	SET(FILEVERSION_STRING &quot;${VERSION}.0.${ADM_SUBVERSION}&quot;)
 	SET(PRODUCTVERSION_STRING &quot;${VERSION}&quot;)
@@ -94,7 +94,7 @@
 	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/admWin32.obj COMMAND windres.exe -i ${CMAKE_CURRENT_BINARY_DIR}/admWin32.rc -o ${CMAKE_CURRENT_BINARY_DIR}/admWin32.obj -O coff --define VS_VERSION_INFO=1)
 
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} &quot;${CMAKE_CURRENT_BINARY_DIR}/admWin32.obj&quot;)
-ENDIF (ADM_OS_WINDOWS)
+ENDIF (WIN32)
 
 ########################################
 # Our exectuables
@@ -235,10 +235,10 @@
 	ADD_ADMLIB_ALL_TARGETS(ADM_nvwa)
 ENDIF (ADM_DEBUG AND FIND_LEAKS)
 
-IF (ADM_OS_DARWIN AND USE_SDL)
+IF (APPLE AND USE_SDL)
 	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_libsdl_gtk)
 	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_libsdl_qt4)
-ENDIF (ADM_OS_DARWIN AND USE_SDL)
+ENDIF (APPLE AND USE_SDL)
 
 ###########################################
 # Construct ADM_userInterface
@@ -317,11 +317,11 @@
 	ENDIF (ADM_UI_GTK)
 	
 	IF (ADM_UI_QT4)
-		IF (ADM_OS_DARWIN AND NOT QT_USE_FRAMEWORKS)
+		IF (APPLE AND NOT QT_USE_FRAMEWORKS)
 			TARGET_LINK_LIBRARIES(avidemux2_qt4 ${PNG_LIBRARIES})
-		ELSEIF (NOT ADM_OS_DARWIN)
+		ELSEIF (NOT APPLE)
 			TARGET_LINK_LIBRARIES(avidemux2_qt4 ${PNG_LIBRARIES})
-		ENDIF (ADM_OS_DARWIN AND NOT QT_USE_FRAMEWORKS)
+		ENDIF (APPLE AND NOT QT_USE_FRAMEWORKS)
 	ENDIF (ADM_UI_QT4)
 ENDIF (USE_PNG)
 
@@ -458,7 +458,7 @@
 ###########################################
 # OS Specific
 ###########################################
-IF (ADM_OS_WINDOWS)
+IF (WIN32)
 	ADD_ADMLIB_ALL_TARGETS(ADM_osSupport)
 	
 	IF (MINGW)
@@ -483,14 +483,14 @@
 	IF (CMAKE_BUILD_TYPE STREQUAL &quot;Release&quot;)
 		ADD_LDFLAGS_ALL_TARGETS(&quot;-Wl,-s&quot;)
 	ENDIF (CMAKE_BUILD_TYPE STREQUAL &quot;Release&quot;)
-ENDIF (ADM_OS_WINDOWS)
+ENDIF (WIN32)
 
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	ADD_LIB_ALL_TARGETS(&quot;-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon -framework Cocoa&quot;)
 
 	# for Leopard but it doesn't hurt Tiger
 	ADD_LIB_ALL_TARGETS(&quot;-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib&quot;)
-ENDIF (ADM_OS_DARWIN)
+ENDIF (APPLE)
 
 ###########################################
 # Install

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -74,9 +74,9 @@
 MESSAGE(STATUS &quot;*****************&quot;)
 
 IF (LAME)
-	IF (ADM_OS_LINUX)
+	IF (UNIX)
 		SET(LAME_REQUIRED_FLAGS &quot;-lm&quot;)
-	ENDIF (ADM_OS_LINUX)
+	ENDIF (UNIX)
 
 	FIND_HEADER_AND_LIB(LAME lame/lame.h mp3lame lame_init ${LAME_REQUIRED_FLAGS})
 	PRINT_LIBRARY_INFO(&quot;LAME&quot; LAME_FOUND &quot;${LAME_INCLUDE_DIR}&quot; &quot;${LAME_LIBRARY_DIR}&quot;)
@@ -99,9 +99,9 @@
 MESSAGE(STATUS &quot;*******************&quot;)
 
 IF (LIBDCA)
-	IF (ADM_OS_LINUX)
+	IF (UNIX)
 		SET(LIBDCA_REQUIRED_FLAGS &quot;-lm&quot;)
-	ENDIF (ADM_OS_LINUX)
+	ENDIF (UNIX)
 
 	SET(LIBDCA_VERSION 005)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -1,7 +1,7 @@
 ########################################
 # ALSA
 ########################################
-IF (ADM_OS_LINUX)
+IF (UNIX AND NOT APPLE)
 	OPTION(ALSA &quot;&quot; ON)
 
 	MESSAGE(STATUS &quot;Checking for ALSA&quot;)
@@ -23,39 +23,39 @@
 	ENDIF (ALSA)
 
 	MESSAGE(&quot;&quot;)
-ELSE (ADM_OS_LINUX)
+ELSE (UNIX AND NOT APPLE)
 	SET(ALSA_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX)
+ENDIF (UNIX AND NOT APPLE)
 
 ########################################
 # aRts
 ########################################
-IF (ADM_OS_LINUX)
+IF (UNIX)
 	OPTION(ARTS &quot;&quot; ON)
-	
+
 	MESSAGE(STATUS &quot;Checking for aRts&quot;)
 	MESSAGE(STATUS &quot;*****************&quot;)
 
 	IF (ARTS)
 		FIND_PACKAGE(Arts)
 		PRINT_LIBRARY_INFO(&quot;aRts&quot; ARTS_FOUND &quot;${ARTS_CFLAGS}&quot; &quot;${ARTS_LDFLAGS}&quot;)
-		
+
 		IF (ARTS_FOUND)
 			SET(USE_ARTS 1)
 		ENDIF (ARTS_FOUND)
 	ELSE (ARTS)
 		MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
 	ENDIF (ARTS)
-		
+
 	MESSAGE(&quot;&quot;)
-ELSE (ADM_OS_LINUX)
+ELSE (UNIX)
 	SET(ARTS_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX)
+ENDIF (UNIX)
 
 ########################################
 # ESD
 ########################################
-IF (ADM_OS_LINUX)
+IF (UNIX)
 	OPTION(ESD &quot;&quot; ON)
 
 	MESSAGE(STATUS &quot;Checking for ESD&quot;)
@@ -73,14 +73,14 @@
 	ENDIF (ESD)
 
 	MESSAGE(&quot;&quot;)
-ELSE (ADM_OS_LINUX)
+ELSE (UNIX)
 	SET(ESD_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX)
+ENDIF (UNIX)
 
 ########################################
 # JACK
 ########################################
-IF (ADM_OS_LINUX OR ADM_OS_DARWIN)
+IF (UNIX)
 	OPTION(JACK &quot;&quot; ON)
 
 	MESSAGE(STATUS &quot;Checking for JACK&quot;)
@@ -96,11 +96,11 @@
 	ELSE (JACK)
 		MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
 	ENDIF (JACK)
-	
+
 	MESSAGE(&quot;&quot;)
-ELSE (ADM_OS_LINUX OR ADM_OS_DARWIN)
+ELSE (UNIX)
 	SET(JACK_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX OR ADM_OS_DARWIN)
+ENDIF (UNIX)
 
 ########################################
 # Secret Rabbit Code
@@ -115,19 +115,19 @@
 	IF (SRC_FOUND)
 		SET(USE_SRC 1)
 	ENDIF (SRC_FOUND)
-	
+
 	MESSAGE(&quot;&quot;)
 ENDIF (JACK_FOUND)
 
 ########################################
 # OSS
 ########################################
-IF (ADM_OS_LINUX)
+IF (UNIX AND NOT APPLE)
 	OPTION(OSS &quot;&quot; ON)
-	
+
 	MESSAGE(STATUS &quot;Checking for OSS&quot;)
 	MESSAGE(STATUS &quot;****************&quot;)
-	
+
 	IF (OSS)
 		FIND_HEADER_AND_LIB(OSS sys/soundcard.h)
 		PRINT_LIBRARY_INFO(&quot;OSS&quot; OSS_FOUND &quot;${OSS_INCLUDE_DIR}&quot; &quot;&quot;)
@@ -138,8 +138,8 @@
 	ELSE (OSS)
 		MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
 	ENDIF (OSS)
-	
+
 	MESSAGE(&quot;&quot;)
-ELSE (ADM_OS_LINUX)
+ELSE (UNIX AND NOT APPLE)
 	SET(OSS_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX)
\ No newline at end of file
+ENDIF (UNIX AND NOT APPLE)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckMiscLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckMiscLibs.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckMiscLibs.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -120,7 +120,7 @@
 ########################################
 # XVideo
 ########################################
-IF (ADM_OS_LINUX)
+IF (UNIX AND NOT APPLE)
 	OPTION(XVIDEO &quot;&quot; ON)
 
 	IF (XVIDEO)
@@ -136,6 +136,6 @@
 
 		MESSAGE(&quot;&quot;)
 	ENDIF (XVIDEO)
-ELSE (ADM_OS_LINUX)
+ELSE (UNIX AND NOT APPLE)
 	SET(XVIDEO_CAPABLE FALSE)
-ENDIF (ADM_OS_LINUX)
+ENDIF (UNIX AND NOT APPLE)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admDetermineSystem.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admDetermineSystem.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admDetermineSystem.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -1,47 +1,93 @@
-# - determine CPU and Operating System
-#  ADM_CPU_X86      - x86 CPU architecture was detected
-#  ADM_CPU_X86_64   - x86-64 CPU architecture was detected
-#  ADM_OS_DARWIN    - Mac OS X was detected
-#  ADM_OS_LINUX     - Linux was detected
-#  ADM_OS_WINDOWS   - Microsoft Windows was detected
+# Determine CPU and Operating System for GCC
+#  ADM_BSD_FAMILY        - BSD family operating system was detected
+#  ADM_CPU_ALTIVEC       - PowerPC CPU with AltiVec architecture was detected
+#  ADM_CPU_PPC           - PowerPC CPU architecture was detected
+#  ADM_CPU_X86           - x86 CPU architecture was detected
+#  ADM_CPU_X86_64        - x86-64 CPU architecture was detected
+#  CMAKE_WORDS_BIGENDIAN - big endian CPU detected
 
 INCLUDE(CMakeDetermineSystem)
 INCLUDE(TestBigEndian)
 
-# override detected processor for cross-compilation purposes
-IF (CROSS_SYSTEM_PROCESSOR)
-	SET(CROSS_SYSTEM_PROCESSOR ${CROSS_SYSTEM_PROCESSOR} CACHE INTERNAL &quot;&quot;)
-	SET(CMAKE_SYSTEM_PROCESSOR ${CROSS_SYSTEM_PROCESSOR})
-ENDIF (CROSS_SYSTEM_PROCESSOR)
-
-IF (WIN32)
-	SET(ADM_OS_WINDOWS 1)
-ELSEIF (APPLE AND UNIX)
-	SET(ADM_OS_DARWIN 1)
+IF (APPLE)
 	SET(ADM_BSD_FAMILY 1)
 ELSEIF (UNIX)
-	SET(ADM_OS_LINUX 1)
-	
 	IF (CMAKE_SYSTEM_NAME STREQUAL &quot;FreeBSD&quot;)
 		SET(ADM_BSD_FAMILY 1)
 	ENDIF (CMAKE_SYSTEM_NAME STREQUAL &quot;FreeBSD&quot;)
-ENDIF (WIN32)
+ENDIF (APPLE)
 
-IF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;x86&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i386&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i586&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i686&quot;)
-	SET(ADM_CPU_X86 1)
-ELSEIF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;x86_64&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;amd64&quot;)
+########################################
+# Check CPU support
+########################################
+MESSAGE(STATUS &quot;Checking GCC support&quot;)
+MESSAGE(STATUS &quot;********************&quot;)
+
+# x86_64
+ADM_COMPILE(cpu_x86-64_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; X86_64_SUPPORTED outputx86_64Test)
+
+IF (X86_64_SUPPORTED)
 	SET(ADM_CPU_X86_64 1)
-ELSEIF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;ppc&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;powerpc&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;Power Macintosh&quot;)
-	SET(ADM_CPU_PPC 1)
-ENDIF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;x86&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i386&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i586&quot; OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL &quot;i686&quot;)
 
+	MESSAGE(STATUS &quot;Check if GCC is x86 64-bit - Yes&quot;)
+ELSE (X86_64_SUPPORTED)
+	MESSAGE(STATUS &quot;Check if GCC is x86 64-bit - No&quot;)
+
+	IF (VERBOSE)
+		MESSAGE(&quot;Error Message: ${outputx86_64Test}&quot;)
+	ENDIF (VERBOSE)
+
+	# x86
+	ADM_COMPILE(cpu_x86_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; X86_SUPPORTED outputX86Test)
+
+	IF (X86_SUPPORTED)
+		SET(ADM_CPU_X86 1)
+
+		MESSAGE(STATUS &quot;Check if GCC is x86 32-bit - Yes&quot;)
+	ELSE (X86_SUPPORTED)
+		MESSAGE(STATUS &quot;Check if GCC is x86 32-bit - No&quot;)
+
+		IF (VERBOSE)
+			MESSAGE(&quot;Error Message: ${outputX86Test}&quot;)
+		ENDIF (VERBOSE)
+
+		# PowerPC
+		ADM_COMPILE(cpu_ppc_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; POWERPC_SUPPORTED outputPowerPcTest)
+
+		IF (POWERPC_SUPPORTED)
+			SET(ADM_CPU_PPC 1)
+
+			SET(ADM_ALTIVEC_FLAGS &quot;-mabi=altivec -maltivec&quot;)
+
+			IF (APPLE)
+				SET(ADM_ALTIVEC_FLAGS &quot;${ADM_ALTIVEC_FLAGS} -faltivec&quot;)
+			ENDIF (APPLE)
+
+			MESSAGE(STATUS &quot;Check if GCC is PowerPC - Yes&quot;)	
+			ADM_COMPILE(cpu_altivec_check.cpp &quot;${ADM_ALTIVEC_FLAGS}&quot; &quot;&quot; &quot;&quot; ALTIVEC_SUPPORTED outputAltivecTest)
+
+			IF (ALTIVEC_SUPPORTED)
+				SET(ADM_CPU_ALTIVEC 1)
+				MESSAGE(STATUS &quot;Check if GCC is AltiVec - Yes&quot;)
+			ELSE (ALTIVEC_SUPPORTED)
+				MESSAGE(STATUS &quot;Check if GCC is AltiVec - No&quot;)
+
+				IF (VERBOSE)
+					MESSAGE(&quot;Error Message: ${outputAltivecTest}&quot;)
+				ENDIF (VERBOSE)
+			ENDIF (ALTIVEC_SUPPORTED)
+		ELSE (POWERPC_SUPPORTED)
+			MESSAGE(STATUS &quot;Check if GCC is PowerPC - No&quot;)
+
+			IF (VERBOSE)
+				MESSAGE(&quot;Error Message: ${outputPowerPcTest}&quot;)
+			ENDIF (VERBOSE)
+		ENDIF (POWERPC_SUPPORTED)
+	ENDIF (X86_SUPPORTED)
+ENDIF (X86_64_SUPPORTED)
+
 TEST_BIG_ENDIAN(CMAKE_WORDS_BIGENDIAN)
-MESSAGE(&quot;&quot;)
 
-IF (NOT ADM_OS_DARWIN AND NOT ADM_OS_WINDOWS AND NOT ADM_OS_LINUX)
-	MESSAGE(FATAL_ERROR &quot;Operating System not supported (${CMAKE_SYSTEM_NAME})&quot;)
-ENDIF (NOT ADM_OS_DARWIN AND NOT ADM_OS_WINDOWS AND NOT ADM_OS_LINUX)
-
 IF (NOT ADM_CPU_X86 AND NOT ADM_CPU_X86_64 AND NOT ADM_CPU_PPC)
-	MESSAGE(FATAL_ERROR &quot;CPU not supported (${CMAKE_SYSTEM_PROCESSOR})&quot;)
+	MESSAGE(FATAL_ERROR &quot;CPU not supported&quot;)
 ENDIF (NOT ADM_CPU_X86 AND NOT ADM_CPU_X86_64 AND NOT ADM_CPU_PPC)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -24,42 +24,39 @@
 SET(HAVE_THREADS 1)
 SET(RUNTIME_CPUDETECT 1)
 
-IF (ADM_CPU_X86 OR ADM_CPU_X86_64)
-	SET(ENABLE_MMX 1)
-	SET(HAVE_MMX 1)
-	SET(HAVE_FAST_UNALIGNED 1)
-
-	IF (ADM_CPU_X86_64)
-		SET(HAVE_FAST_64BIT 1)
-	ENDIF (ADM_CPU_X86_64)
-ELSE (ADM_CPU_X86 OR ADM_CPU_X86_64)
-	SET(ENABLE_MMX 0)
+IF (ADM_CPU_X86 OR ADM_CPU_X86_64)
+	SET(ENABLE_MMX 1)
+	SET(HAVE_MMX 1)
+	SET(HAVE_FAST_UNALIGNED 1)
+
+	IF (ADM_CPU_X86_64)
+		SET(HAVE_FAST_64BIT 1)
+	ENDIF (ADM_CPU_X86_64)
+ELSE (ADM_CPU_X86 OR ADM_CPU_X86_64)
+	SET(ENABLE_MMX 0)
 ENDIF (ADM_CPU_X86 OR ADM_CPU_X86_64)
 
-IF (ADM_OS_DARWIN)
+IF (APPLE)
 	SET(CONFIG_DARWIN 1)
-ENDIF (ADM_OS_DARWIN)
+ENDIF (APPLE)
 
 ########################################
 # Check GCC support for SSSE3
 ########################################
 IF (ADM_CPU_X86 OR ADM_CPU_X86_64)
-	MESSAGE(STATUS &quot;Checking GCC support for SSSE3&quot;)
-	MESSAGE(STATUS &quot;******************************&quot;)
+	ADM_COMPILE(cpu_ssse3_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; SSSE3_SUPPORTED outputSsse3Test)
 
-	ADM_COMPILE(ssse3_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; SSSE3_SUPPORTED outputSsse3Test)
-
 	IF (SSSE3_SUPPORTED)
 		SET(HAVE_SSSE3 1)
 
-		MESSAGE(STATUS &quot;GCC supports SSSE3&quot;)
+		MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - Yes&quot;)
 	ELSE (SSSE3_SUPPORTED)
-		MESSAGE(STATUS &quot;GCC doesn't support SSSE3&quot;)
+		MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - No&quot;)
 
 		IF (VERBOSE)
 			MESSAGE(&quot;Error Message: ${outputSsse3Test}&quot;)
 		ENDIF (VERBOSE)	
 	ENDIF (SSSE3_SUPPORTED)
+ENDIF (ADM_CPU_X86 OR ADM_CPU_X86_64)
 
-	MESSAGE(&quot;&quot;)
-ENDIF (ADM_CPU_X86 OR ADM_CPU_X86_64)
\ No newline at end of file
+MESSAGE(&quot;&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-03-03 09:26:56 UTC (rev 3818)
@@ -84,9 +84,6 @@
 #cmakedefine HAVE_SSSE3
 #cmakedefine CONFIG_DARWIN
 
-/* Name mangling */
-#cmakedefine CYG_MANGLING
-
 /* Mad */
 #cmakedefine FPM_DEFAULT
 #cmakedefine FPM_INTEL
@@ -243,10 +240,6 @@
 /* use Nvwa memory leak detector */
 #cmakedefine FIND_LEAKS
 
-#cmakedefine ADM_OS_DARWIN
-#cmakedefine ADM_OS_LINUX
-#cmakedefine ADM_OS_WINDOWS
-
 #cmakedefine ADM_CPU_X86
 #cmakedefine ADM_CPU_X86_64
 

Added: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_altivec_check.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_altivec_check.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_altivec_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -0,0 +1,15 @@
+#ifndef __APPLE__
+#include &lt;altivec.h&gt;
+#endif
+
+int foo(void)
+{
+	unsigned char *x;
+
+	vec_ld(0, x);
+}
+
+int main(int a, char **b)
+{
+	return 0;
+}

Added: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ppc_check.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ppc_check.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ppc_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -0,0 +1,11 @@
+int foo(void)
+{
+	register const void *p;
+
+	asm volatile (&quot;dcbt 0, %0&quot; : : &quot;r&quot; (p));
+}
+
+int main(int a, char **b)
+{
+	return 0;
+}

Copied: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ssse3_check.cpp (from rev 3811, branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp	2008-02-29 18:35:39 UTC (rev 3811)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_ssse3_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -0,0 +1,9 @@
+int foo(void)
+{
+	asm volatile (&quot;pabsw %xmm0, %xmm0&quot;);
+}
+
+int main(int a, char **b)
+{
+	return 0;
+}

Added: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86-64_check.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86-64_check.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86-64_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -0,0 +1,9 @@
+int foo(void)
+{
+	asm volatile (&quot;movdqa %xmm8, 0&quot;);
+}
+
+int main(int a, char **b)
+{
+	return 0;
+}

Added: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86_check.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86_check.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/cpu_x86_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -0,0 +1,9 @@
+int foo(void)
+{
+	asm volatile (&quot;movdqa %xmm7, 0&quot;);
+}
+
+int main(int a, char **b)
+{
+	return 0;
+}

Deleted: branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp	2008-03-02 18:38:11 UTC (rev 3817)
+++ branches/avidemux_2.5_branch_gruntster/cmake_compile_check/ssse3_check.cpp	2008-03-03 09:26:56 UTC (rev 3818)
@@ -1,11 +0,0 @@
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-int foo(void){
-      asm volatile(&quot;pabsw %xmm0, %xmm0&quot;);
-}
-int main(int a, char **b)
-{
-        return 0;
-}
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001083.html">[Avidemux-svn-commit] r3817 - branches
</A></li>
	<LI>Next message: <A HREF="001085.html">[Avidemux-svn-commit] r3819 - in	branches/avidemux_2.5_branch_gruntster: . cmake cmake_compile_check
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1084">[ date ]</a>
              <a href="thread.html#1084">[ thread ]</a>
              <a href="subject.html#1084">[ subject ]</a>
              <a href="author.html#1084">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
