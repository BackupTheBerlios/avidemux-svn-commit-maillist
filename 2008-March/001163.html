<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3900 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries/ADM_libwrapper	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3900%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_libraries/ADM_libwrapper%0A%09avidemux/plugins/ADM_audiodecoder%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_dca%20cmake&In-Reply-To=%3C200803161753.m2GHr68e016748%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001162.html">
   <LINK REL="Next"  HREF="001164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3900 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries/ADM_libwrapper	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3900%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_libraries/ADM_libwrapper%0A%09avidemux/plugins/ADM_audiodecoder%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_dca%20cmake&In-Reply-To=%3C200803161753.m2GHr68e016748%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3900 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries/ADM_libwrapper	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca cmake">mean at mail.berlios.de
       </A><BR>
    <I>Sun Mar 16 18:53:06 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001162.html">[Avidemux-svn-commit] r3899 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg:	ADM_lavcodec ADM_lavformat ADM_lavutil ADM_libpostproc	ADM_libswscale
</A></li>
        <LI>Next message: <A HREF="001164.html">[Avidemux-svn-commit] r3901 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiocodec avidemux/ADM_core/src avidemux/ADM_libraries	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca	avidemux/plugins/ADM_audiodecoder/ADM_ad_faad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1163">[ date ]</a>
              <a href="thread.html#1163">[ thread ]</a>
              <a href="subject.html#1163">[ subject ]</a>
              <a href="author.html#1163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-03-16 18:53:05 +0100 (Sun, 16 Mar 2008)
New Revision: 3900

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
Log:
[AudioDecoder] Make faad/dca works, dts untested


Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/CMakeLists.txt	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,16 +0,0 @@
-SET(ADM_LIB ADM_libwrapper)
-
-SET(${ADM_LIB}_SRCS
-	libwrapper_amrnb.cpp  libwrapper_dca.cpp  libwrapper_global.cpp)
-
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-
-IF (USE_AMR_NB)
-	ADD_SOURCE_CFLAGS(libwrapper_amrnb.cpp -I${AMRNB_INCLUDE_DIR})
-	ADD_SOURCE_CFLAGS(libwrapper_global.cpp -I${AMRNB_INCLUDE_DIR})
-ENDIF (USE_AMR_NB)
-
-IF (USE_LIBDCA)
-	ADD_SOURCE_CFLAGS(libwrapper_dca.cpp -I${LIBDCA_INCLUDE_DIR})
-	ADD_SOURCE_CFLAGS(libwrapper_global.cpp -I${LIBDCA_INCLUDE_DIR})
-ENDIF (USE_LIBDCA)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper.h	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper.h	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1 +0,0 @@
-#include &quot;ADM_dynamicLoading.h&quot;

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,85 +0,0 @@
-#include &quot;config.h&quot;
-
-#ifdef USE_AMR_NB
-#include &lt;stdio.h&gt;
-#include &quot;ADM_default.h&quot;
-#include &quot;libwrapper_amrnb.h&quot;
-
-ADM_LibWrapperAmrnb::ADM_LibWrapperAmrnb() : ADM_LibWrapper()
-{
-#ifdef USE_LATE_BINDING
-#ifdef __WIN32
-	char* libname = &quot;libamrnb-2.dll&quot;;
-#else
-	char* libname = &quot;libamrnb-2.so&quot;;	// ???
-#endif
-
-	initialised = (loadLibrary(libname) &amp;&amp; getSymbols(6, 
-		&amp;func_Decoder_Interface_init, &quot;Decoder_Interface_init&quot;, 
-		&amp;func_Decoder_Interface_exit, &quot;Decoder_Interface_exit&quot;,
-		&amp;func_Encoder_Interface_exit, &quot;Encoder_Interface_exit&quot;,
-		&amp;func_GP3Decoder_Interface_Decode, &quot;GP3Decoder_Interface_Decode&quot;,
-		&amp;func_GP3VADxEncoder_Interface_Encode, &quot;GP3VADxEncoder_Interface_Encode&quot;,
-		&amp;func_VADxEncoder_Interface_init, &quot;VADxEncoder_Interface_init&quot;));
-#else
-	initialised = true;
-#endif	
-}
-
-ADM_LibWrapperAmrnb::~ADM_LibWrapperAmrnb() {}
-
-extern &quot;C&quot; void* Decoder_Interface_init_(ADM_LibWrapperAmrnb* amrnb)
-{
-#ifdef USE_LATE_BINDING
-	return amrnb-&gt;func_Decoder_Interface_init();
-#else
-	return Decoder_Interface_init();
-#endif
-}
-
-extern &quot;C&quot; void Decoder_Interface_Decode_(ADM_LibWrapperAmrnb* amrnb, void *st, unsigned char *bits, short *synth, int bfi)
-{
-#ifdef USE_LATE_BINDING
-	amrnb-&gt;func_GP3Decoder_Interface_Decode(st, bits, synth, bfi);
-#else
-	Decoder_Interface_Decode(st, bits, synth, bfi);
-#endif
-}
-
-extern &quot;C&quot; void Decoder_Interface_exit_(ADM_LibWrapperAmrnb* amrnb, void* state)
-{
-#ifdef USE_LATE_BINDING
-	amrnb-&gt;func_Decoder_Interface_exit(state);
-#else
-	Decoder_Interface_exit(state);
-#endif
-}
-
-extern &quot;C&quot; int Encoder_Interface_Encode_(ADM_LibWrapperAmrnb* amrnb, void *st, enum Mode mode, short *speech, unsigned char *serial, int forceSpeech)
-{
-#ifdef USE_LATE_BINDING
-	return amrnb-&gt;func_GP3VADxEncoder_Interface_Encode(st, mode, speech, serial, forceSpeech, 0);
-#else
-	return Encoder_Interface_Encode(st, mode, speech, serial, forceSpeech);
-#endif
-}
-
-extern &quot;C&quot; void Encoder_Interface_exit_(ADM_LibWrapperAmrnb* amrnb, void* state)
-{
-#ifdef USE_LATE_BINDING
-	amrnb-&gt;func_Encoder_Interface_exit(state);
-#else
-	Encoder_Interface_exit(state);
-#endif
-}
-
-extern &quot;C&quot; void* Encoder_Interface_init_(ADM_LibWrapperAmrnb* amrnb, int dtx)
-{
-#ifdef USE_LATE_BINDING
-	return amrnb-&gt;func_VADxEncoder_Interface_init(dtx, 0);
-#else
-	return Encoder_Interface_init(dtx);
-#endif
-}
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.h	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.h	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,47 +0,0 @@
-#ifndef LIBWRAPPER_AMRNB
-#define LIBWRAPPER_AMRNB
-
-#ifdef USE_AMR_NB
-#ifdef __cplusplus
-#include &quot;libwrapper.h&quot;
-
-extern &quot;C&quot;
-{
-#endif	// __cpluscplus
-
-#include &quot;amrnb/interf_dec.h&quot;
-#include &quot;amrnb/interf_enc.h&quot;
-
-#ifdef __cplusplus
-}
-#endif	// __cpluscplus
-
-#ifdef __cplusplus
-class ADM_LibWrapperAmrnb : public ADM_LibWrapper
-{
-	public:
-	#ifdef USE_LATE_BINDING
-		void (*func_Decoder_Interface_exit)(void *state);
-		void* (*func_Decoder_Interface_init)(void);		
-		void (*func_Encoder_Interface_exit)(void *state);
-		void (*func_GP3Decoder_Interface_Decode)(void *st, unsigned char *bits, short *synth, int bfi);
-		int (*func_GP3VADxEncoder_Interface_Encode)(void *st, enum Mode mode, short *speech, unsigned char *serial, int forceSpeech, char vad2_code);
-		void* (*func_VADxEncoder_Interface_init)(int dtx, char vad2_code);
-	#endif
-	
-		ADM_LibWrapperAmrnb();
-		virtual	~ADM_LibWrapperAmrnb();
-};
-#else
-struct ADM_LibWrapperAmrnb;
-
-void Decoder_Interface_Decode_(struct ADM_LibWrapperAmrnb* amrnb, void *st, unsigned char *bits, short *synth, int bfi);
-void Decoder_Interface_exit_(struct ADM_LibWrapperAmrnb* amrnb, void *state);
-void* Decoder_Interface_init_(struct ADM_LibWrapperAmrnb* amrnb);
-int Encoder_Interface_Encode_(struct ADM_LibWrapperAmrnb* amrnb, void *st, enum Mode mode, short *speech, unsigned char *serial, int forceSpeech);
-void Encoder_Interface_exit_(struct ADM_LibWrapperAmrnb* amrnb, void *state);
-void* Encoder_Interface_init_(struct ADM_LibWrapperAmrnb* amrnb, int dtx);
-#endif	// __cpluscplus
-
-#endif	// USE_AMR_NB
-#endif	// LIBWRAPPER_AMRNB

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,114 +0,0 @@
-#include &quot;config.h&quot;
-
-#ifdef USE_LIBDCA
-#include &lt;stdio.h&gt;
-#include &quot;ADM_default.h&quot;
-#include &quot;libwrapper_dca.h&quot;
-
-ADM_LibWrapperDca::ADM_LibWrapperDca() : ADM_LibWrapper()
-{
-#ifdef USE_LATE_BINDING
-#ifdef __WIN32
-#ifdef USE_LIBDCA_002
-	const char* libname = &quot;libdts.dll&quot;;
-#else
-	const char* libname = &quot;libdca-0.dll&quot;;
-#endif	// USE_LIBDCA_002
-#else
-#ifdef USE_LIBDCA_002
-	const char* libname = &quot;libdts.so&quot;;	// ???
-#else
-	const char* libname = &quot;libdca-0.so&quot;;	// ???
-#endif	// USE_LIBDCA_002
-#endif	// __WIN32
-
-#ifdef USE_LIBDCA_002
-	initialised = (loadLibrary(libname) &amp;&amp; getSymbols(7, 
-		&amp;func_dts_block, &quot;dts_block&quot;, 
-		&amp;func_dts_blocks_num, &quot;dts_blocks_num&quot;, 
-		&amp;func_dts_frame, &quot;dts_frame&quot;, 
-		&amp;func_dts_free, &quot;dts_free&quot;, 
-		&amp;func_dts_init, &quot;dts_init&quot;,
-		&amp;func_dts_samples, &quot;dts_samples&quot;, 
-		&amp;func_dts_syncinfo, &quot;dts_syncinfo&quot;));
-#else
-	initialised = (loadLibrary(libname) &amp;&amp; getSymbols(7, 
-		&amp;func_dts_block, &quot;dca_block&quot;, 
-		&amp;func_dts_blocks_num, &quot;dca_blocks_num&quot;, 
-		&amp;func_dts_frame, &quot;dca_frame&quot;, 
-		&amp;func_dts_free, &quot;dca_free&quot;, 
-		&amp;func_dts_init, &quot;dca_init&quot;,
-		&amp;func_dts_samples, &quot;dca_samples&quot;, 
-		&amp;func_dts_syncinfo, &quot;dca_syncinfo&quot;));
-#endif	// USE_LIBDCA_002
-#else
-	initialised = true;
-#endif	// USE_LATE_BINDING
-}
-
-ADM_LibWrapperDca::~ADM_LibWrapperDca() {}
-
-int ADM_LibWrapperDca::dts_block_ (dts_state_t* state)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_block(state);
-#else
-	return dts_block(state);
-#endif
-}
-
-int ADM_LibWrapperDca::dts_blocks_num_ (dts_state_t* state)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_blocks_num(state);
-#else
-	return dts_blocks_num(state);
-#endif
-}
-
-int ADM_LibWrapperDca::dts_frame_ (dts_state_t* state, uint8_t* buf, int* flags, level_t* level, sample_t bias)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_frame(state, buf, flags, level, bias);
-#else
-	return dts_frame(state, buf, flags, level, bias);
-#endif
-}
-
-void ADM_LibWrapperDca::dts_free_ (dts_state_t* state)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_free(state);
-#else
-	return dts_free(state);
-#endif
-}
-
-dts_state_t* ADM_LibWrapperDca::dts_init_ (uint32_t mm_accel)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_init(mm_accel);
-#else
-	return dts_init(mm_accel);
-#endif
-}
-
-sample_t* ADM_LibWrapperDca::dts_samples_ (dts_state_t* state)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_samples(state);
-#else
-	return dts_samples(state);
-#endif
-}
-
-int ADM_LibWrapperDca::dts_syncinfo_ (dts_state_t* state, uint8_t* buf, int* flags, int* sample_rate, int* bit_rate, int* frame_length)
-{
-#ifdef USE_LATE_BINDING
-	return func_dts_syncinfo(state, buf, flags, sample_rate, bit_rate, frame_length);
-#else
-	return dts_syncinfo(state, buf, flags, sample_rate, bit_rate, frame_length);
-#endif
-}
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.h	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.h	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,38 +0,0 @@
-#ifndef LIBWRAPPER_DCA
-#define LIBWRAPPER_DCA
-
-#ifdef USE_LIBDCA
-#include &quot;libwrapper.h&quot;
-
-extern &quot;C&quot;
-{
-#include &quot;dts.h&quot;
-//#include &quot;dts_internal.h&quot;
-}
-
-class ADM_LibWrapperDca : public ADM_LibWrapper
-{
-	protected:
-	#ifdef USE_LATE_BINDING
-		int (*func_dts_block)(dts_state_t* state);
-		int (*func_dts_blocks_num) (dts_state_t* state);
-		int (*func_dts_frame) (dts_state_t* state, uint8_t* buf, int* flags, level_t* level, sample_t bias);
-		void (*func_dts_free) (dts_state_t* state);
-		dts_state_t* (*func_dts_init) (uint32_t mm_accel);
-		sample_t* (*func_dts_samples) (dts_state_t* state);
-		int (*func_dts_syncinfo) (dts_state_t* state, uint8_t* buf, int* flags, int* sample_rate, int* bit_rate, int* frame_length);
-	#endif
-
-	public:
-		ADM_LibWrapperDca();
-		virtual	~ADM_LibWrapperDca();
-		int dts_block_ (dts_state_t* state);
-		int dts_blocks_num_ (dts_state_t* state);
-		int dts_frame_ (dts_state_t* state, uint8_t* buf, int* flags, level_t* level, sample_t bias);
-		void dts_free_ (dts_state_t* state);
-		dts_state_t* dts_init_ (uint32_t mm_accel);
-		sample_t* dts_samples_ (dts_state_t* state);
-		int dts_syncinfo_ (dts_state_t* state, uint8_t* buf, int* flags, int* sample_rate, int* bit_rate, int* frame_length);
-};
-#endif
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,31 +0,0 @@
-#include &lt;stdio.h&gt;
-#include &quot;ADM_default.h&quot;
-#include &quot;libwrapper_global.h&quot;
-
-void initLibWrappers()
-{
-#ifdef USE_AMR_NB
-	amrnb = new ADM_LibWrapperAmrnb();
-#endif
-#ifdef USE_LIBDCA
-	dca = new ADM_LibWrapperDca();
-#endif
-}
-
-void destroyLibWrappers()
-{
-#ifdef USE_AMR_NB
-	delete amrnb;
-#endif
-#ifdef USE_LIBDCA
-	delete dca;
-#endif
-}
-
-#ifdef USE_AMR_NB
-extern &quot;C&quot; ADM_LibWrapperAmrnb* getAmrnbWrapper(void)
-{ 
-	return amrnb;
-}
-#endif
-//EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2008-03-16 17:53:05 UTC (rev 3900)
@@ -1,37 +0,0 @@
-#ifndef LIBWRAPPER_GLOBAL
-#define LIBWRAPPER_GLOBAL
-
-#include &quot;config.h&quot;
-//
-#if defined(__DECLARE__)
-#define ZZ_PREFIX
-#define ZZ_POSTFIX =NULL
-#else
-#define ZZ_PREFIX extern
-#define ZZ_POSTFIX 
-#endif //__DECLARE__
-
-// AMRNB
-#ifdef USE_AMR_NB
-#define _TYPEDEF_H
-
-#include &quot;libwrapper_amrnb.h&quot;
-
-#if defined(__cplusplus)
-ZZ_PREFIX ADM_LibWrapperAmrnb  *amrnb ZZ_POSTFIX;
-#else
-struct ADM_LibWrapperAmrnb* getAmrnbWrapper(void);
-#endif	// __cplusplus
-#endif	// USE_AMR_NB
-
-// LIBDCA
-#if defined(USE_LIBDCA) &amp;&amp; defined(__cplusplus)
-#include &quot;libwrapper_dca.h&quot;
-
-ZZ_PREFIX ADM_LibWrapperDca* dca ZZ_POSTFIX;
-#endif // USE LIBDCA
-
-// funcs
-void initLibWrappers();
-void destroyLibWrappers();
-#endif // LIBWRAPPER

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp	2008-03-16 17:53:05 UTC (rev 3900)
@@ -0,0 +1,197 @@
+/***************************************************************************
+                          ADM_codecac3.cpp  -  description
+                             -------------------
+    begin                : Fri May 31 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;math.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;ADM_default.h&quot;
+
+#include &quot;ADM_audio/aviaudio.hxx&quot;
+#include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
+
+#include &quot;prefs.h&quot;
+
+#ifdef USE_LIBDCA
+#include &quot;ADM_audio/ADM_dcainfo.h&quot;
+#include &quot;ADM_libraries/ADM_libwrapper/libwrapper_global.h&quot;
+
+#define DTS_HANDLE ((dts_state_t *)dts_handle)
+
+ADM_AudiocodecDCA::ADM_AudiocodecDCA( uint32_t fourcc, WAVHeader *info) :   ADM_Audiocodec(fourcc)
+{
+    int flags=0;
+    ADM_assert(fourcc==WAV_DTS);
+    dts_handle=NULL;
+    
+#ifdef ADM_CPU_X86
+#define CHK(x,y) if(CpuCaps::has##x()) flags|=MM_ACCEL_X86_##y;
+    CHK(MMX,MMX);
+    CHK(3DNOW,3DNOW);
+    CHK(MMXEXT,MMXEXT);
+#endif
+    
+    dts_handle=(void *)dca-&gt;dts_init_(flags);
+    if(!dts_handle)
+    {
+        printf(&quot;Cannot init libdca\n&quot;);
+        ADM_assert(0);   
+    }
+	_wavHeader = info;
+}
+
+ADM_AudiocodecDCA::~ADM_AudiocodecDCA( )
+{
+    if(dts_handle)
+    {
+        dca-&gt;dts_free_(DTS_HANDLE);
+        dts_handle=NULL;
+    }
+}
+
+uint8_t ADM_AudiocodecDCA::beginDecompress( void )
+{
+    return 1;
+}
+
+uint8_t ADM_AudiocodecDCA::endDecompress( void )
+{
+    return 1;
+}
+
+uint8_t ADM_AudiocodecDCA::run(uint8_t *inptr, uint32_t nbIn, float *outptr, uint32_t *nbOut)
+{
+    uint32_t avail;
+    uint32_t length,syncoff;
+    int flags = 0, samprate = 0, bitrate = 0, frame_length;
+    uint8_t chan = _wavHeader-&gt;channels;
+    *nbOut=0;
+
+
+    //  Ready to decode
+    while(nbIn)
+    {
+        if(nbIn&lt;DTS_HEADER_SIZE)
+        {
+            if(nbIn)
+                printf(&quot;[DTS]: no data to decode avail %u\n&quot;,nbIn);
+            break;
+        }
+        //length = ADM_DCAGetInfo(ptr,nbIn, &amp;samprate, &amp;bitrate, &amp;chan,&amp;syncoff,&amp;flags);
+        length = dca-&gt;dts_syncinfo_ (DTS_HANDLE,  inptr, &amp;flags, &amp;samprate,&amp;bitrate, &amp;frame_length);
+
+        if(!length)
+        {
+            printf(&quot;[DTS] dts_syncinfo failed\n&quot;);
+            ADM_assert(0); 
+        }
+        if(length&gt;nbIn)
+        {
+            // not enough data
+            break;
+        }
+
+	if (ch_route.mode &lt; 1) {
+		CHANNEL_TYPE *p_ch_type = ch_route.input_type;
+		switch (flags &amp; DTS_CHANNEL_MASK) {
+			case DTS_MONO:
+				*(p_ch_type++) = CH_MONO;
+			break;
+			case DTS_STEREO:
+			case DTS_DOLBY:
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+			break;
+			case DTS_3F:
+				*(p_ch_type++) = CH_FRONT_CENTER;
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+			break;
+			case DTS_2F1R:
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CH_REAR_CENTER;
+			break;
+			case DTS_3F1R:
+				*(p_ch_type++) = CH_FRONT_CENTER;
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CH_REAR_CENTER;
+			break;
+			case DTS_2F2R:
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CH_REAR_LEFT;
+				*(p_ch_type++) = CH_REAR_RIGHT;
+			break;
+			case DTS_3F2R:
+				*(p_ch_type++) = CH_FRONT_CENTER;
+				*(p_ch_type++) = CH_FRONT_LEFT;
+				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CH_REAR_LEFT;
+				*(p_ch_type++) = CH_REAR_RIGHT;
+			break;
+			default:
+				ADM_assert(0);
+		}
+		if (flags &amp; DTS_LFE) {
+			*(p_ch_type++) = CH_LFE;
+		}
+	}
+
+        sample_t level = 1, bias = 0;
+        flags &amp;=DTS_CHANNEL_MASK;
+        flags |= DTS_ADJUST_LEVEL;
+
+        if (dca-&gt;dts_frame_(DTS_HANDLE, inptr, &amp;flags, &amp;level, bias))
+        {
+            printf(&quot;\n DTS_frame failed!&quot;);
+            inptr+=length;
+            nbIn-=length;
+            outptr+=256*chan;
+            *nbOut+=256*chan;
+            break;
+        };
+
+        inptr+=length;
+        nbIn-=length;
+        // Each block is 256 samples
+        *nbOut += 256 * chan * dca-&gt;dts_blocks_num_(DTS_HANDLE);
+	float *cur;
+	for (int i = 0; i &lt; dca-&gt;dts_blocks_num_(DTS_HANDLE); i++) {
+		if (dca-&gt;dts_block_ (DTS_HANDLE)) {
+			printf(&quot;\n[DTS] dts_block failed on block %d/%d\n&quot;,i,dca-&gt;dts_blocks_num_ (DTS_HANDLE));
+			// in that case we silent out the chunk
+			memset(outptr, 0, 256 * chan * sizeof(float));
+		} else {
+			float *cur;
+			for (int k = 0; k &lt; chan; k++) {
+				sample_t *sample=(sample_t *)dca-&gt;dts_samples_(DTS_HANDLE);
+				sample += 256 * k;
+				cur = outptr + k;
+				for (int j = 0; j &lt; 256; j++) {
+					*cur = *sample++;
+					cur+=chan;
+				}
+			}
+		}
+		outptr += chan * 256;
+	}
+    }
+
+    return 1; 
+}
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
@@ -0,0 +1,16 @@
+INCLUDE(admCheckDca)
+checkFaad()
+
+IF (LIBDCA_FOUND)
+	INCLUDE(ad_plugin)
+	
+	SET(ADM_ad_dca_SRCS ADM_dca.cpp)
+
+	ADD_LIBRARY(ADM_ad_dca SHARED ${ADM_ad_dca_SRCS})
+	TARGET_LINK_LIBRARIES(ADM_ad_dca ${LIBDCA_LIBRARY_DIR})
+
+	ADD_TARGET_CFLAGS(ADM_ad_dca &quot;-I${LIBDCA_INCLUDE_DIR}&quot;)
+
+	INIT_AUDIO_PLUGIN(ADM_ad_dca)
+	INSTALL_AUDIODECODER(ADM_ad_dca)
+ENDIF (HAVE_FAAD)

Added: branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake	2008-03-16 17:51:51 UTC (rev 3899)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake	2008-03-16 17:53:05 UTC (rev 3900)
@@ -0,0 +1,48 @@
+########################################
+# libdca
+########################################
+MACRO(checkDca)
+OPTION(LIBDCA &quot;&quot; ON)
+
+MESSAGE(STATUS &quot;Checking for libdca&quot;)
+MESSAGE(STATUS &quot;*******************&quot;)
+
+IF (LIBDCA)
+	IF (UNIX)
+		SET(LIBDCA_REQUIRED_FLAGS &quot;-lm&quot;)
+	ENDIF (UNIX)
+
+	SET(LIBDCA_VERSION 005)
+
+	IF (USE_LATE_BINDING)
+		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h)
+
+		IF (NOT LIBDCA_005_FOUND)
+			SET(LIBDCA_VERSION 002)
+			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h)
+		ENDIF (NOT LIBDCA_005_FOUND)
+	ELSE (USE_LATE_BINDING)
+		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h dca dca_init ${LIBDCA_REQUIRED_FLAGS})
+
+		IF (NOT LIBDCA_005_FOUND)
+			SET(LIBDCA_VERSION 002)
+			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h dts dts_init ${LIBDCA_REQUIRED_FLAGS})
+		ENDIF (NOT LIBDCA_005_FOUND)
+	ENDIF (USE_LATE_BINDING)
+
+	IF (LIBDCA_${LIBDCA_VERSION}_FOUND)
+		SET(LIBDCA_FOUND 1)
+		SET(USE_LIBDCA 1)
+		SET(USE_LIBDCA_${LIBDCA_VERSION} 1)
+		SET(LIBDCA_INCLUDE_DIR &quot;${LIBDCA_${LIBDCA_VERSION}_INCLUDE_DIR}&quot;)
+		SET(LIBDCA_LIBRARY_DIR &quot;${LIBDCA_${LIBDCA_VERSION}_LIBRARY_DIR}&quot;)
+	ENDIF (LIBDCA_${LIBDCA_VERSION}_FOUND)
+
+	PRINT_LIBRARY_INFO(&quot;libdca&quot; LIBDCA_FOUND &quot;${LIBDCA_INCLUDE_DIR}&quot; &quot;${LIBDCA_LIBRARY_DIR}&quot;)
+ELSE (LIBDCA)
+	MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
+ENDIF (LIBDCA)
+
+MESSAGE(&quot;&quot;)
+ENDMACRO(checkDca)
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001162.html">[Avidemux-svn-commit] r3899 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg:	ADM_lavcodec ADM_lavformat ADM_lavutil ADM_libpostproc	ADM_libswscale
</A></li>
	<LI>Next message: <A HREF="001164.html">[Avidemux-svn-commit] r3901 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiocodec avidemux/ADM_core/src avidemux/ADM_libraries	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca	avidemux/plugins/ADM_audiodecoder/ADM_ad_faad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1163">[ date ]</a>
              <a href="thread.html#1163">[ thread ]</a>
              <a href="subject.html#1163">[ subject ]</a>
              <a href="author.html#1163">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
