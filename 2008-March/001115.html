<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3852 - in	branches/avidemux_2.5_branch_mean_merged/avidemux: .	ADM_core/include ADM_core/src ADM_libraries/ADM_mplex	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui plugins	plugins/ADM_audiodecoder plugins/ADM_audiodecoder/ADM_ad_ac3	plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	plugins/ADM_audiodecoder/ADM_ad_faad	plugins/ADM_audiodecoder/ADM_ad_mad	plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	plugins/ADM_audiodecoder/ADM_ad_vorbis
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3852%20-%20in%0A%09branches/avidemux_2.5_branch_mean_merged/avidemux%3A%20.%0A%09ADM_core/include%20ADM_core/src%20ADM_libraries/ADM_mplex%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20plugins%0A%09plugins/ADM_audiodecoder%20plugins/ADM_audiodecoder/ADM_ad_ac3%0A%09plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52%0A%09plugins/ADM_audiodecoder/ADM_ad_faad%0A%09plugins/ADM_audiodecoder/ADM_ad_mad%0A%09plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad%0A%09plugins/ADM_audiodecoder/ADM_ad_vorbis&In-Reply-To=%3C200803080956.m289uFp7016070%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001114.html">
   <LINK REL="Next"  HREF="001116.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3852 - in	branches/avidemux_2.5_branch_mean_merged/avidemux: .	ADM_core/include ADM_core/src ADM_libraries/ADM_mplex	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui plugins	plugins/ADM_audiodecoder plugins/ADM_audiodecoder/ADM_ad_ac3	plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	plugins/ADM_audiodecoder/ADM_ad_faad	plugins/ADM_audiodecoder/ADM_ad_mad	plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	plugins/ADM_audiodecoder/ADM_ad_vorbis</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3852%20-%20in%0A%09branches/avidemux_2.5_branch_mean_merged/avidemux%3A%20.%0A%09ADM_core/include%20ADM_core/src%20ADM_libraries/ADM_mplex%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20plugins%0A%09plugins/ADM_audiodecoder%20plugins/ADM_audiodecoder/ADM_ad_ac3%0A%09plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52%0A%09plugins/ADM_audiodecoder/ADM_ad_faad%0A%09plugins/ADM_audiodecoder/ADM_ad_mad%0A%09plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad%0A%09plugins/ADM_audiodecoder/ADM_ad_vorbis&In-Reply-To=%3C200803080956.m289uFp7016070%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3852 - in	branches/avidemux_2.5_branch_mean_merged/avidemux: .	ADM_core/include ADM_core/src ADM_libraries/ADM_mplex	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui plugins	plugins/ADM_audiodecoder plugins/ADM_audiodecoder/ADM_ad_ac3	plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	plugins/ADM_audiodecoder/ADM_ad_faad	plugins/ADM_audiodecoder/ADM_ad_mad	plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	plugins/ADM_audiodecoder/ADM_ad_vorbis">mean at mail.berlios.de
       </A><BR>
    <I>Sat Mar  8 10:56:15 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001114.html">[Avidemux-svn-commit] r3851 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_core/include ADM_core/src ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
        <LI>Next message: <A HREF="001116.html">[Avidemux-svn-commit] r3853 -	branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1115">[ date ]</a>
              <a href="thread.html#1115">[ thread ]</a>
              <a href="subject.html#1115">[ subject ]</a>
              <a href="author.html#1115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-03-08 10:56:14 +0100 (Sat, 08 Mar 2008)
New Revision: 3852

Modified:
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/include/ADM_misc.h
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/src/ADM_win32.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt
   branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/CMakeLists.txt
Log:
[Patch] update r3849 3850 3851


Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/include/ADM_misc.h
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/include/ADM_misc.h	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/include/ADM_misc.h	2008-03-08 09:56:14 UTC (rev 3852)
@@ -72,7 +72,6 @@
 	#define SHTDN_REASON_FLAG_PLANNED 0x80000000
 
 	int shutdown_win32(void);
-	void getWorkingArea(uint32_t *width, uint32_t *height);
 #else
 	#include &lt;sys/resource.h&gt;
 #endif

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/src/ADM_win32.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_core/src/ADM_win32.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -396,39 +396,6 @@
 
 #define MONITOR_DEFAULTTONEAREST    0x00000002
 
-void getWorkingArea(uint32_t *width, uint32_t *height)
-{
-	typedef void* (WINAPI *MonitorFromWindow)(HWND hwnd, uint32_t dwFlags);
-	typedef bool (WINAPI *GetMonitorInfo)(void *hMonitor, LPMONITORINFO lpmi);
-
-	static HMODULE user32 = GetModuleHandle(&quot;user32.dll&quot;);
-	static MonitorFromWindow pMonitorFromWindow = (MonitorFromWindow)GetProcAddress(user32, &quot;MonitorFromWindow&quot;);
-	static GetMonitorInfo pGetMonitorInfo = (GetMonitorInfo)GetProcAddress(user32, &quot;GetMonitorInfoA&quot;);
-
-	if (pMonitorFromWindow == NULL)
-	{
-		RECT rect;
-
-		// Required for NT4 - no multi-monitor support
-		SystemParametersInfo(SPI_GETWORKAREA, 0, &amp;rect, 0);
-
-		*width = rect.right - rect.left;
-		*height = rect.bottom - rect.top;
-	}
-	else
-	{
-		void *hMonitor = pMonitorFromWindow(GetForegroundWindow(), MONITOR_DEFAULTTONEAREST);
-
-		MONITORINFO monitorInfo;
-
-		monitorInfo.cbSize = sizeof(MONITORINFO);
-		pGetMonitorInfo(hMonitor, &amp;monitorInfo);
-
-		*width = monitorInfo.rcWork.right - monitorInfo.rcWork.left;
-		*height = monitorInfo.rcWork.bottom - monitorInfo.rcWork.top;
-	}
-}
-
 void redirectStdoutToFile(void)
 {
 	// Don't redirect stdout and stderr if SDL hasn't already hijacked it.

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2008-03-08 09:56:14 UTC (rev 3852)
@@ -21,6 +21,8 @@
 
 #define ADM_LEGACY_PROGGY
 #include &quot;ADM_default.h&quot;
+#include &lt;signal.h&gt;
+#include &lt;setjmp.h&gt;
 #include &lt;unistd.h&gt;
 #include &lt;string.h&gt;
 #include &lt;errno.h&gt;

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -35,7 +35,7 @@
 #include &quot;gtkgui.h&quot;
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
 
 
 #define WOD(x) lookup_widget (guiRootWindow,#x)
@@ -43,7 +43,7 @@
 void frame2time(uint32_t frame, uint32_t fps, uint16_t * hh, uint16_t * mm,
 	   uint16_t * ss, uint16_t * ms);
 
-static GtkWidget *guiRootWindow=NULL;
+GtkWidget *guiRootWindow=NULL;
 static GtkWidget *guiDrawingArea=NULL;
 static GtkWidget *guiSlider=NULL;
 
@@ -318,7 +318,7 @@
 		GUI_initCursor(  );
     
                 
-                UI_getPhysicalScreenSize(&amp;w,&amp;h); //gtk_widget_get_parent_window (guiRootWindow));
+                UI_getPhysicalScreenSize(guiRootWindow, &amp;w, &amp;h);
                 printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
  
                 GUI_gtk_grow_off(1);
@@ -1276,7 +1276,6 @@
 extern char **global_argv;
 typedef gboolean GCALL       (void *);
 extern int automation(void );
-extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
 extern void initTranslator(void);
 
 int UI_Init(int argc, char **argv)

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -41,7 +41,7 @@
 void GUI_gtk_grow_off(int onff);
 
 extern GtkWidget *getDrawWidget(void);
-extern uint8_t UI_getPhysicalScreenSize(uint32_t *w, uint32_t *h);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w, uint32_t *h);
 
 #ifdef ENABLE_WINDOW_SIZING_HACK
 extern int maxWindowWidth, maxWindowHeight; // from GUI_bindings.cpp
@@ -191,7 +191,7 @@
 	gtk_window_get_size(window, &amp;windowWidth, &amp;windowHeight);
 	gtk_widget_get_size_request(drawingArea, &amp;drawingWidth, &amp;drawingHeight);
 
-	UI_getPhysicalScreenSize(&amp;screenWidth, &amp;screenHeight);
+	UI_getPhysicalScreenSize(window, &amp;screenWidth, &amp;screenHeight);
 
 	// Take drawing area out of the equation, how much extra do we need for additional controls?
 	windowWidth -= drawingWidth;
@@ -223,9 +223,11 @@
 void UI_centreCanvasWindow(GtkWindow *window, GtkWidget *canvas, int newCanvasWidth, int newCanvasHeight)
 {
 	int winWidth, winHeight, widgetWidth, widgetHeight;
-	uint32_t resWidth, resHeight;
+	GdkScreen *screen = gdk_screen_get_default();
+	int monitorNo = gdk_screen_get_monitor_at_window(screen, GTK_WIDGET(window-&gt;transient_parent)-&gt;window);
+	GdkRectangle rect;
 
-	UI_getPhysicalScreenSize(&amp;resWidth, &amp;resHeight);
+	gdk_screen_get_monitor_geometry(screen, monitorNo, &amp;rect);
 	gtk_widget_get_size_request((GtkWidget*)canvas, &amp;widgetWidth, &amp;widgetHeight);
 	gtk_window_get_size(window, &amp;winWidth, &amp;winHeight);
 
@@ -236,6 +238,6 @@
 	winWidth += 10;
 	winHeight += 40;
 
-	gtk_window_move(window, ((int)resWidth - winWidth) / 2, ((int)resHeight - winHeight) / 2);
+	gtk_window_move(window, rect.x + (rect.width - winWidth) / 2, rect.y + (rect.height - winHeight) / 2);
 }
 // EOF

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -24,8 +24,8 @@
 #endif
 
 
+extern GtkWidget *guiRootWindow;
 
-
 GtkWidget *GUI_PixmapButtonDefault(GdkWindow * window, const gchar ** xpm,
                                   const gchar * tooltip);
 GtkWidget *GUI_PixmapButton(GdkWindow * window, const gchar ** xpm,
@@ -186,26 +186,22 @@
     \fn UI_getPhysicalScreenSize
     \brief return the physical size of display in pixels
 */
-uint8_t UI_getPhysicalScreenSize(uint32_t *w, uint32_t *h)
+uint8_t UI_getPhysicalScreenSize(void *window, uint32_t *w, uint32_t *h)
 {
-#ifdef __WIN32
-	getWorkingArea(w, h);
-#else
-	static int inited = 0;
-	static int ww,hh;
+	GtkWindow* gtkWindow = (GtkWindow*)window;
+	GdkScreen *screen = gdk_screen_get_default();
 
-    if (!inited)
-    {      
-      GdkScreen* sc = gdk_screen_get_default();
-      ww = gdk_screen_get_width(sc);
-      hh = gdk_screen_get_height(sc);
-      inited = 1;
-    }
+	if (!gtkWindow)
+		gtkWindow = (GtkWindow*)guiRootWindow;
 
-    *w=ww;
-    *h=hh;
-#endif
+	int monitorNo = gdk_screen_get_monitor_at_window(screen, GTK_WIDGET(gtkWindow)-&gt;window);
+	GdkRectangle rect;
 
+	gdk_screen_get_monitor_geometry(screen, monitorNo, &amp;rect);
+
+	*w = rect.width;
+	*h = rect.height;
+
 	return 1;
 }
 //EOF

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -29,7 +29,7 @@
 void GUI_FileSelWrite(const char *label, char * * name)
 {}
 
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
+uint8_t UI_getPhysicalScreenSize(void *window, uint32_t *w,uint32_t *h)
 {
   *w=*h=10000; 
 }
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -23,7 +23,7 @@
 uint8_t UI_arrow_enabled(void) {return 1;}
 uint8_t UI_arrow_disabled(void) {return 1;}
 
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
+uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h)
 {
 	QRect qrect = QApplication::desktop()-&gt;availableGeometry();
 

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/gtk_gui.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/gtk_gui.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -146,7 +146,7 @@
 PARAM_MUX muxMode = MUX_REGULAR;
 int muxParam = 0;
 
-extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
 extern uint8_t GUI_jobs(void);
 extern bool parseECMAScript(const char *name);
 void A_parseECMAScript(const char *name);
@@ -1060,7 +1060,7 @@
   
   /* Zoom out if needed */
   uint32_t phyW,phyH;
-  UI_getPhysicalScreenSize(&amp;phyW,&amp;phyH);
+  UI_getPhysicalScreenSize(NULL, &amp;phyW,&amp;phyH);
   if(phyW&lt;avifileinfo-&gt;width || phyH&lt;avifileinfo-&gt;height)
   {
       if(phyW&lt;avifileinfo-&gt;width/2 || phyH&lt;avifileinfo-&gt;height/2)

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -4,4 +4,12 @@
 	bit_allocate.c  bitstream.c  downmix.c  imdct.c  parse.c)
 
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-add_definitions(-fPIC)
\ No newline at end of file
+
+IF (UNIX)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -fPIC)
+ENDIF (UNIX)
+
+# FIXME
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_core/include&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1,17 +1,10 @@
-##
-##
-##
+ADD_SUBDIRECTORY(ADM_liba52)
 
-subdirs(PREORDER ADM_liba52)
+SET(ADM_ad_a52_SRCS ADM_ad_a52.cpp)
 
-
-
-include_directories(../../)
-include_directories(../../../ADM_audiocodec)
-include_directories(ADM_liba52)
-
-SET(ADM_ad_a52_SRCS         ADM_ad_a52.cpp )
-
 ADD_LIBRARY(ADM_ad_a52 SHARED ${ADM_ad_a52_SRCS})
 TARGET_LINK_LIBRARIES(ADM_ad_a52 ADM_liba52)
 
+# FIXME
+ADD_TARGET_CFLAGS(ADM_ad_a52 &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ADD_TARGET_CFLAGS(ADM_ad_a52 &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1,11 +1,7 @@
-##
-##
-##
+SET(ADM_ad_faad_SRCS ADM_ad_faad.cpp )
 
-include_directories(../../)
-include_directories(../../../ADM_audiocodec)
-
-SET(ADM_ad_faad_SRCS         ADM_ad_faad.cpp )
-
 ADD_LIBRARY(ADM_ad_faad SHARED ${ADM_ad_faad_SRCS})
 
+# FIXME
+ADD_TARGET_CFLAGS(ADM_ad_faad &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ADD_TARGET_CFLAGS(ADM_ad_faad &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp	2008-03-08 09:56:14 UTC (rev 3852)
@@ -18,7 +18,7 @@
 #include &quot;ADM_ad_plugin.h&quot;
 
 #ifdef USE_MP3
-#include &quot;../ADM_libMad/mad.h&quot;
+#include &quot;ADM_libMad/mad.h&quot;
 #define Stream ((mad_stream *)_stream)
 #define Frame ((mad_frame *)_frame)
 #define Synth ((mad_synth *)_synth)

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -5,4 +5,19 @@
 	stream.c  synth.c  timer.c  version.c)
 
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-add_definitions(-fPIC)
+
+IF (UNIX)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -fPIC)
+ENDIF (UNIX)
+
+INCLUDE(admLibMad)
+GET_MAD_CFLAGS(MAD_CFLAGS)
+
+ADD_TARGET_CFLAGS(${ADM_LIB} ${MAD_CFLAGS})
+
+IF (ADM_BIG_ENDIAN)
+	ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-DWORDS_BIGENDIAN&quot;)
+ENDIF (ADM_BIG_ENDIAN)
+
+# FIXME
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1,17 +1,15 @@
-##
-##
-##
+ADD_SUBDIRECTORY(ADM_libMad)
 
-subdirs(PREORDER ADM_libMad)
+SET(ADM_ad_Mad_SRCS ADM_ad_mad.cpp)
 
-
-
-include_directories(../../)
-include_directories(../../../ADM_audiocodec)
-include_directories(ADM_libMad)
-
-SET(ADM_ad_Mad_SRCS         ADM_ad_mad.cpp )
-
 ADD_LIBRARY(ADM_ad_Mad SHARED ${ADM_ad_Mad_SRCS})
 TARGET_LINK_LIBRARIES(ADM_ad_Mad ADM_libMad)
 
+INCLUDE(admLibMad)
+GET_MAD_CFLAGS(MAD_CFLAGS)
+
+ADD_TARGET_CFLAGS(ADM_ad_Mad ${MAD_CFLAGS})
+
+# FIXME
+ADD_TARGET_CFLAGS(ADM_ad_Mad &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ADD_TARGET_CFLAGS(ADM_ad_Mad &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1,11 +1,7 @@
-##
-##
-##
+SET(ADM_ad_vorbis_SRCS ADM_ad_vorbis.cpp )
 
-include_directories(../../)
-include_directories(../../../ADM_audiocodec)
-
-SET(ADM_ad_vorbis_SRCS         ADM_ad_vorbis.cpp )
-
 ADD_LIBRARY(ADM_ad_vorbis SHARED ${ADM_ad_vorbis_SRCS})
 
+# FIXME
+ADD_TARGET_CFLAGS(ADM_ad_vorbis &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ADD_TARGET_CFLAGS(ADM_ad_vorbis &quot;-I${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1,4 +1,4 @@
-subdirs(PREORDER ADM_ad_ac3)
-subdirs(PREORDER ADM_ad_mad)
-subdirs(PREORDER ADM_ad_faad)
-subdirs(PREORDER ADM_ad_vorbis)
+ADD_SUBDIRECTORY(ADM_ad_ac3)
+ADD_SUBDIRECTORY(ADM_ad_faad)
+ADD_SUBDIRECTORY(ADM_ad_mad)
+ADD_SUBDIRECTORY(ADM_ad_vorbis)

Modified: branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/CMakeLists.txt	2008-03-08 09:33:15 UTC (rev 3851)
+++ branches/avidemux_2.5_branch_mean_merged/avidemux/plugins/CMakeLists.txt	2008-03-08 09:56:14 UTC (rev 3852)
@@ -1 +1 @@
-subdirs(PREORDER ADM_audiodecoder)
+ADD_SUBDIRECTORY(ADM_audiodecoder)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001114.html">[Avidemux-svn-commit] r3851 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_core/include ADM_core/src ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
	<LI>Next message: <A HREF="001116.html">[Avidemux-svn-commit] r3853 -	branches/avidemux_2.5_branch_mean_merged/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1115">[ date ]</a>
              <a href="thread.html#1115">[ thread ]</a>
              <a href="subject.html#1115">[ subject ]</a>
              <a href="author.html#1115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
