<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3895 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audio avidemux/ADM_colorspace	avidemux/ADM_core/src avidemux/ADM_infoExtractor	avidemux/ADM_inputs/ADM_flv avidemux/ADM_libraries	avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3895%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_audio%20avidemux/ADM_colorspace%0A%09avidemux/ADM_core/src%20avidemux/ADM_infoExtractor%0A%09avidemux/ADM_inputs/ADM_flv%20avidemux/ADM_libraries%0A%09avidemux/ADM_libraries/ADM_ffmpeg%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_libMpeg2Dec%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_outputs%0A%09avidemux/ADM_outputs/oplug_avi%20avidemux/ADM_outputs/oplug_dummy%0A%09avidemux/ADM_outputs/oplug_flv%20avidemux/ADM_outputs/oplug_mp4%0A%09avidemux/ADM_outputs/oplug_mpeg%20avidemux/ADM_outputs/oplug_mpegFF%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20avidemux/ADM_video%0A%09avidemux/ADM_videoFilter%20cmake&In-Reply-To=%3C200803151552.m2FFqx3P031691%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001157.html">
   <LINK REL="Next"  HREF="001159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3895 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audio avidemux/ADM_colorspace	avidemux/ADM_core/src avidemux/ADM_infoExtractor	avidemux/ADM_inputs/ADM_flv avidemux/ADM_libraries	avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3895%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_audio%20avidemux/ADM_colorspace%0A%09avidemux/ADM_core/src%20avidemux/ADM_infoExtractor%0A%09avidemux/ADM_inputs/ADM_flv%20avidemux/ADM_libraries%0A%09avidemux/ADM_libraries/ADM_ffmpeg%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_libMpeg2Dec%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_outputs%0A%09avidemux/ADM_outputs/oplug_avi%20avidemux/ADM_outputs/oplug_dummy%0A%09avidemux/ADM_outputs/oplug_flv%20avidemux/ADM_outputs/oplug_mp4%0A%09avidemux/ADM_outputs/oplug_mpeg%20avidemux/ADM_outputs/oplug_mpegFF%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20avidemux/ADM_video%0A%09avidemux/ADM_videoFilter%20cmake&In-Reply-To=%3C200803151552.m2FFqx3P031691%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3895 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audio avidemux/ADM_colorspace	avidemux/ADM_core/src avidemux/ADM_infoExtractor	avidemux/ADM_inputs/ADM_flv avidemux/ADM_libraries	avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc	avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_outputs	avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake">gruntster at mail.berlios.de
       </A><BR>
    <I>Sat Mar 15 16:52:59 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001157.html">[Avidemux-svn-commit] r3894 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters cmake
</A></li>
        <LI>Next message: <A HREF="001159.html">[Avidemux-svn-commit] r3896 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_smjs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1158">[ date ]</a>
              <a href="thread.html#1158">[ thread ]</a>
              <a href="subject.html#1158">[ subject ]</a>
              <a href="author.html#1158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-03-15 16:52:19 +0100 (Sat, 15 Mar 2008)
New Revision: 3895

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_muxts.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_tscrc.h
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_muxts.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_tscrc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/
   branches/avidemux_2.5_branch_gruntster/cmake/admLibFfmpeg.cmake
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memsupport.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ADM_lavcodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/movenc.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/ADM_mpeg2dec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mthread.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
Log:
[ffmpeg] make ffmpeg libs shared

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -16,9 +16,9 @@
 #include &quot;ADM_audio/ADM_dcainfo.h&quot;
 extern &quot;C&quot;
 {
-#include &quot;ADM_libraries/ADM_lavutil/common.h&quot;
-#include &quot;ADM_libraries/ADM_lavutil/bswap.h&quot;
-#include &quot;ADM_libraries/ADM_lavcodec/bitstream.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/common.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot;
 
 }
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -20,12 +20,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 #include &quot;ADM_rgb.h&quot; 
 #include &quot;ADM_colorspace.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -25,12 +25,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 #include &quot;ADM_rgb.h&quot; 
 
 #define CLEANUP() \

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -26,11 +26,11 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 #include &quot;colorspace.h&quot;
 
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -37,7 +37,7 @@
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; 
 {
-#include &quot;ADM_libraries/ADM_lavcodec/dsputil_cpu.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
 }
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -38,7 +38,7 @@
 
 extern &quot;C&quot;
 {
-	#include &quot;ADM_libraries/ADM_lavcodec/dsputil_cpu.h&quot;
+	#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
 
 adm_fast_memcpy myAdmMemcpy=NULL;
 /* Original comments from mplayer (file: aclib.c)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memsupport.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memsupport.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memsupport.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -208,20 +208,20 @@
 
 		return ptr;
 	}
-}
 
-char *av_strdup(const char *s)
-{
-    char *ptr;
-    int len;
+	char *av_strdup(const char *s)
+	{
+		char *ptr;
+		int len;
 
-    len = strlen(s) + 1;
-    ptr = (char *)av_malloc(len);
+		len = strlen(s) + 1;
+		ptr = (char *)av_malloc(len);
 
-    if (ptr)
-        memcpy(ptr, s, len);
+		if (ptr)
+			memcpy(ptr, s, len);
 
-    return ptr;
+		return ptr;
+	}
 }
 
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -35,8 +35,8 @@
 #include &quot;common.h&quot;
 #include &quot;bswap.h&quot;
 #define INT_MAX (0x7FFFFFFF)
-#include &quot;ADM_libraries/ADM_lavcodec/bitstream.h&quot;
-#include &quot;ADM_libraries/ADM_lavcodec/golomb.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/golomb.h&quot;
 }
 
 #include &quot;ADM_infoExtractor/ADM_h264_tag.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -30,7 +30,7 @@
 #include &quot;ADM_flv.h&quot;
 
 // Borrowed from lavformt/flv.h
-#include &quot;ADM_libraries/ADM_lavformat/flv.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavformat/flv.h&quot;
 // Borrowed from lavformt/flv.h    
 
 uint32_t ADM_UsecFromFps1000(uint32_t fps1000);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2008-03-15 15:52:19 UTC (rev 3895)
@@ -18,6 +18,6 @@
   #define  __ADM_LAVC
   extern &quot;C&quot;
   {  
-  #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+  #include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
   };
 #endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ADM_lavcodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/ADM_lavcodec.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ADM_lavcodec.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,7 +1,7 @@
 #include &quot;ADM_default.h&quot;
 #ifdef ADM_CPU_X86
 #include &quot;ADM_lavcodec.h&quot;
-#include &quot;ADM_libraries/ADM_lavcodec/dsputil_cpu.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
 #endif
 /**
  * 		\fn lavcodec_mm_support

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,65 +1,51 @@
-SET(ADM_LIB ADM_lavcodec)
+SET(ADM_LIB ADM_libavcodec)
 
 SET(${ADM_LIB}_SRCS 
-	adpcm.c 	allcodecs.c 	cyuv.c 	dsputil.c 	dv.c 
-	error_resilience.c 		fft.c 	h263.c 	h263dec.c 	huffyuv.c 	imgconvert.c 
-	jfdctfst.c 	jfdctint.c 	jrevdct.c 	mace.c 	mdct.c 	 	mjpeg.c 
-	motion_est.c 	mpeg12.c 	mpegaudio.c 	mpegaudiodec.c 	mpegvideo.c 	msmpeg4.c 	 
-	pcm.c 	ratecontrol.c 	raw.c 	resample.c 	rv10.c 	simple_idct.c 	svq1.c 
-	utils.c 	wmadec.c 	indeo3.c 	vp3.c 	vp3dsp.c 	h264.c 	ffv1.c 	ra144.c 	ra288.c 
-	golomb.c 	4xm.c 	cabac.c 	asv1.c vcr1.c cljr.c 	faandct.c 	 	parser.c 
-	roqvideo.c 	xan.c 	rpza.c 	msrle.c 	msvideo1.c 	cinepak.c 	vqavideo.c 
-	idcinvideo.c 	smc.c 	flicvideo.c 	interplayvideo.c 	dpcm.c 	8bps.c vmdav.c 
-	truemotion1.c flac.c g726.c 	qtrle.c lcl.c 	snow.c  
-	rangecoder.c bitstream.c h264idct.c h261.c amr.c tscc.c 
-	resample2.c pthread.c qdm2.c bitstream_filter.c eval.c 
-	vc1.c vc1dsp.c vp56.c  vp6.c vp5.c indeo2.c smacker.c  opt.c
-	fraps.c dnxhddata.h  dnxhddec.c
-	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c   vc1data.c   vp56data.c mjpegbdec.c
-	h263_parser.c
-	h264_parser.c
-	mpeg4video_parser.c
-	mpegvideo_enc.c
-	mpeg12enc.c mpegaudioenc.c
-	ac3enc.c ac3.c ac3tab.c
-	mjpegenc.c mjpegdec.c
-	wma.c
-	dvbsub_parser.c
-	dvbsubdec.c
-	dvbsub.c xiph.c
-	sp5xdec.c nellymoserdec.c
+	adpcm.c  allcodecs.c  cyuv.c  dsputil.c  dv.c  error_resilience.c  fft.c  h263.c
+	h263dec.c  huffyuv.c  imgconvert.c  jfdctfst.c  jfdctint.c  jrevdct.c  mace.c
+	mdct.c  mjpeg.c  motion_est.c  mpeg12.c  mpegaudio.c  mpegaudiodec.c  mpegvideo.c
+	msmpeg4.c  pcm.c  ratecontrol.c  raw.c  resample.c  rv10.c  simple_idct.c  svq1.c
+	utils.c  wmadec.c  indeo3.c  vp3.c  vp3dsp.c  h264.c  ffv1.c  ra144.c  ra288.c
+	golomb.c  4xm.c  cabac.c  asv1.c  vcr1.c  cljr.c  faandct.c  parser.c  roqvideo.c
+	xan.c  rpza.c  msrle.c  msvideo1.c  cinepak.c  vqavideo.c  idcinvideo.c  smc.c
+	flicvideo.c  interplayvideo.c  dpcm.c  8bps.c  vmdav.c  truemotion1.c  flac.c
+	g726.c  qtrle.c  lcl.c  snow.c  rangecoder.c  bitstream.c  h264idct.c  h261.c
+	amr.c  tscc.c  resample2.c  pthread.c  qdm2.c  bitstream_filter.c  eval.c  vc1.c
+	vc1dsp.c  vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
+	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c  vc1data.c  vp56data.c  mjpegbdec.c
+	h263_parser.c  h264_parser.c  mpeg4video_parser.c  mpegvideo_enc.c  mpeg12enc.c
+	mpegaudioenc.c  ac3enc.c  ac3.c  ac3tab.c  mjpegenc.c  mjpegdec.c  wma.c  
+	dvbsub_parser.c  dvbsubdec.c  dvbsub.c  xiph.c  sp5xdec.c  nellymoserdec.c
 	ADM_lavcodec.cpp
 )
 
 IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
-		i386/cputest.c
-		i386/mpegvideo_mmx.c     i386/vp3dsp_mmx.c 
-		i386/dsputil_mmx.c   
-		i386/fdct_mmx.c   i386/motion_est_mmx.c  i386/simple_idct_mmx.c 
-		i386/fft_sse.c i386/vp3dsp_sse2.c  
-		i386/idct_mmx_xvid.c i386/fft_3dn2.c 
-		i386/snowdsp_mmx.c i386/fft_3dn.c)
+		i386/cputest.c  i386/mpegvideo_mmx.c  i386/vp3dsp_mmx.c  i386/dsputil_mmx.c
+		i386/fdct_mmx.c  i386/motion_est_mmx.c  i386/simple_idct_mmx.c  i386/fft_sse.c
+		i386/vp3dsp_sse2.c  i386/idct_mmx_xvid.c  i386/fft_3dn2.c  i386/snowdsp_mmx.c
+		i386/fft_3dn.c)
 ENDIF(ADM_CPU_X86)
 
 IF (ADM_CPU_ALTIVEC)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
-		ppc/dsputil_altivec.c  ppc/dsputil_ppc.c  ppc/fdct_altivec.c  ppc/fft_altivec.c  ppc/float_altivec.c  ppc/gmc_altivec.c
-		ppc/h264_altivec.c  ppc/idct_altivec.c  ppc/int_altivec.c  ppc/mpegvideo_altivec.c  ppc/mpegvideo_ppc.c
+		ppc/dsputil_altivec.c  ppc/dsputil_ppc.c  ppc/fdct_altivec.c  ppc/fft_altivec.c
+		ppc/float_altivec.c  ppc/gmc_altivec.c  ppc/h264_altivec.c  ppc/idct_altivec.c
+		ppc/int_altivec.c  ppc/mpegvideo_altivec.c  ppc/mpegvideo_ppc.c
 		ppc/snow_altivec.c  ppc/vc1dsp_altivec.c)
 ENDIF (ADM_CPU_ALTIVEC)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I../ADM_lavutil -DHAVE_AV_CONFIG_H -Drestrict=__restrict__ -fomit-frame-pointer -include ffconf.h&quot;)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I../ADM_lavutil -DHAVE_AV_CONFIG_H -Drestrict=__restrict__ -fomit-frame-pointer&quot;)
 
 IF (ADM_DEBUG)
-	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-O2&quot;)
+	ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-O2&quot;)
 ENDIF (ADM_DEBUG)
 
 IF (USE_AMR_NB)
 	ADD_SOURCE_CFLAGS(amr.c -I${AMRNB_INCLUDE_DIR})
 ENDIF (USE_AMR_NB)
 
-INCLUDE(admLibFfmpeg)
-GET_FFMPEG_CFLAGS(FFMPEG_CFLAGS)
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${FFMPEG_CFLAGS}&quot;)
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core ADM_libavutil ${ZLIB_LIBRARY})
+
+INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)
\ No newline at end of file

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.c	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,396 +0,0 @@
-/*
- * Glue to lavcodec configure
- * MEANX
- * */
-#include &lt;stdlib.h&gt;
-#include &lt;stdio.h&gt;
-int main(void)
-{
-#define DECLARE_DECODER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_DECODER 1\n&quot;); 
-  
-    DECLARE_DECODER(NELLYMOSER,nellymoser);
-    DECLARE_DECODER(ADPCM_IMA_AMV, amv);
-    DECLARE_DECODER(CINEPAK, cinepak);
-    DECLARE_DECODER(DNXHD, dnxhd);
-    DECLARE_DECODER(FOURXM, fourxm);
-    DECLARE_DECODER(FRAPS, fraps);
-	DECLARE_DECODER(H263, h263);
-    DECLARE_DECODER(H264, h264);
-    DECLARE_DECODER(INDEO2, indeo2);
-    DECLARE_DECODER(INDEO3, indeo3);
-    DECLARE_DECODER(INTERPLAY_VIDEO, interplay_video);
-    DECLARE_DECODER(MPEGVIDEO, mpegvideo);
-    DECLARE_DECODER(MSVIDEO1, msvideo1);
-    DECLARE_DECODER(VC1, vc1);
-    DECLARE_DECODER(VCR1, vcr1);
-    DECLARE_DECODER(VP5, vp5);
-    DECLARE_DECODER(VP6, vp6);
-    DECLARE_DECODER(VP6F, vp6f);
-    DECLARE_DECODER(WMV3, wmv3);
-    DECLARE_DECODER (WMV1, wmv1);
-    DECLARE_DECODER (WMV2, wmv2);
-    DECLARE_DECODER(VP3, vp3);
-    DECLARE_DECODER (MPEG4, mpeg4);
-    DECLARE_DECODER (MSMPEG4V1, msmpeg4v1);
-    DECLARE_DECODER (MSMPEG4V2, msmpeg4v2);
-    DECLARE_DECODER (MSMPEG4V3, msmpeg4v3);
-    DECLARE_DECODER(MJPEGB, mjpegb);
-    DECLARE_DECODER (MJPEG, mjpeg);
-    DECLARE_DECODER(WMAV2, wmav2);
-    DECLARE_DECODER (DVVIDEO, dvvideo);
-    DECLARE_DECODER (HUFFYUV, huffyuv);
-    DECLARE_DECODER (FFVHUFF, ffvhuff);
-    DECLARE_DECODER(SVQ3, svq3);
-    DECLARE_DECODER(TSCC, tscc);
-    DECLARE_DECODER(QDM2, qdm2);
-    DECLARE_DECODER (FFV1, ffv1);
-    DECLARE_DECODER (MPEG1VIDEO, mpeg1video);
-    DECLARE_DECODER (MPEG2VIDEO, mpeg2video);
-    DECLARE_DECODER (RV10, rv10);
-    DECLARE_DECODER (RV20, rv20);
-    DECLARE_DECODER (DVBSUB, dvbsub);
-    DECLARE_DECODER (FLV, flv);
-    DECLARE_DECODER (SNOW, snow);
-    DECLARE_DECODER (AMV, amv);
-#undef DECLARE_DECODER
-#define DECLARE_DECODER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_DECODER 0\n&quot;); 
-
-    DECLARE_DECODER(AASC, aasc);
-    DECLARE_DECODER(AVS, avs);
-    DECLARE_DECODER(BETHSOFTVID, bethsoftvid);
-    DECLARE_DECODER(C93, c93);
-    DECLARE_DECODER(CAVS, cavs);
-    DECLARE_DECODER(CLJR, cljr);
-    DECLARE_DECODER(CSCD, cscd);
-    DECLARE_DECODER(CYUV, cyuv);
-    DECLARE_DECODER(DSICINVIDEO, dsicinvideo);
-    DECLARE_DECODER(DXA, dxa);
-    DECLARE_DECODER(EIGHTBPS, eightbps);
-    DECLARE_DECODER(FLIC, flic);
-    DECLARE_DECODER(IDCIN, idcin);
-    DECLARE_DECODER(KMVC, kmvc);
-    DECLARE_DECODER(LOCO, loco);
-    DECLARE_DECODER(MDEC, mdec);
-    DECLARE_DECODER(MMVIDEO, mmvideo);
-    DECLARE_DECODER(MPEG_XVMC, mpeg_xvmc);
-    DECLARE_DECODER(MSRLE, msrle);
-    DECLARE_DECODER(MSZH, mszh);
-    DECLARE_DECODER(NUV, nuv);
-    DECLARE_DECODER(PTX, ptx);
-    DECLARE_DECODER(QDRAW, qdraw);
-    DECLARE_DECODER(QPEG, qpeg);
-    DECLARE_DECODER(RPZA, rpza);
-    DECLARE_DECODER(SMACKER, smacker);
-    DECLARE_DECODER(SMC, smc);
-    DECLARE_DECODER(SP5X, sp5x);
-    DECLARE_DECODER(THEORA, theora);
-    DECLARE_DECODER(THP, thp);
-    DECLARE_DECODER(TIERTEXSEQVIDEO, tiertexseqvideo);
-    DECLARE_DECODER(TRUEMOTION1, truemotion1);
-    DECLARE_DECODER(TRUEMOTION2, truemotion2);
-    DECLARE_DECODER(TXD, txd);
-    DECLARE_DECODER(ULTI, ulti);
-    DECLARE_DECODER(VMDVIDEO, vmdvideo);
-    DECLARE_DECODER(VMNC, vmnc);
-    DECLARE_DECODER(VQA, vqa);
-    DECLARE_DECODER(WNV1, wnv1);
-    DECLARE_DECODER(XAN_WC3, xan_wc3);
-    DECLARE_DECODER(XL, xl);
-    DECLARE_DECODER(MPEG4AAC, mpeg4aac);
-    DECLARE_DECODER(ALAC, alac);
-    DECLARE_DECODER(ATRAC3, atrac3);
-    DECLARE_DECODER(COOK, cook);
-    DECLARE_DECODER(DCA, dca);
-    DECLARE_DECODER(DSICINAUDIO, dsicinaudio);
-    DECLARE_DECODER(IMC, imc);
-    DECLARE_DECODER(LIBA52, liba52);
-    DECLARE_DECODER(LIBFAAD, libfaad);
-    DECLARE_DECODER(MACE3, mace3);
-    DECLARE_DECODER(MACE6, mace6);
-    DECLARE_DECODER(MP3, mp3);
-    DECLARE_DECODER(MP3ADU, mp3adu);
-    DECLARE_DECODER(MP3ON4, mp3on4);
-    DECLARE_DECODER(MPC7, mpc7);
-    DECLARE_DECODER(RA_144, ra_144);
-    DECLARE_DECODER(RA_288, ra_288);
-    DECLARE_DECODER(SHORTEN, shorten);
-    DECLARE_DECODER(SMACKAUD, smackaud);
-    DECLARE_DECODER(TRUESPEECH, truespeech);
-    DECLARE_DECODER(TTA, tta);
-    DECLARE_DECODER(VMDAUDIO, vmdaudio);
-    DECLARE_DECODER(WAVPACK, wavpack);
-    DECLARE_DECODER(WS_SND1, ws_snd1);
-    DECLARE_DECODER(INTERPLAY_DPCM, interplay_dpcm);
-    DECLARE_DECODER(SOL_DPCM, sol_dpcm);
-    DECLARE_DECODER(XAN_DPCM, xan_dpcm);
-    DECLARE_DECODER(ADPCM_THP, adpcm_thp);
-    /* DUPE */
-    DECLARE_DECODER (ASV1, asv1);
-    DECLARE_DECODER (ASV2, asv2);
-    DECLARE_DECODER (BMP, bmp);
-    DECLARE_DECODER (FLASHSV, flashsv);
-    DECLARE_DECODER (GIF, gif);
-    DECLARE_DECODER (H261, h261);
-	DECLARE_DECODER (H263I, h263i);
-    DECLARE_DECODER (JPEGLS, jpegls);
-    DECLARE_DECODER (PNG, png);
-    DECLARE_DECODER (QTRLE, qtrle);
-    DECLARE_DECODER (RAWVIDEO, rawvideo);
-    DECLARE_DECODER (ROQ, roq);
-    DECLARE_DECODER (SGI, sgi);
-    DECLARE_DECODER (SVQ1, svq1);
-    DECLARE_DECODER (TARGA, targa);
-    DECLARE_DECODER (TIFF, tiff);
-    DECLARE_DECODER (ZLIB, zlib);
-    DECLARE_DECODER (ZMBV, zmbv);
-    DECLARE_DECODER (FLAC, flac);
-    DECLARE_DECODER (LIBAMR_NB, libamr_nb);
-    DECLARE_DECODER (LIBAMR_WB, libamr_wb);
-    DECLARE_DECODER (LIBGSM, libgsm);
-    DECLARE_DECODER (LIBGSM_MS, libgsm_ms);
-    DECLARE_DECODER (MP2, mp2);
-    DECLARE_DECODER (SONIC, sonic);
-    DECLARE_DECODER (VORBIS, vorbis);
-    DECLARE_DECODER(WMAV1, wmav1);
-    DECLARE_DECODER (PCM_ALAW, pcm_alaw);
-    DECLARE_DECODER (PCM_MULAW, pcm_mulaw);
-    DECLARE_DECODER (PCM_S8, pcm_s8);
-    DECLARE_DECODER (PCM_S16BE, pcm_s16be);
-    DECLARE_DECODER (PCM_S16LE, pcm_s16le);
-    DECLARE_DECODER (PCM_S24BE, pcm_s24be);
-    DECLARE_DECODER (PCM_S24DAUD, pcm_s24daud);
-    DECLARE_DECODER (PCM_S24LE, pcm_s24le);
-    DECLARE_DECODER (PCM_S32BE, pcm_s32be);
-    DECLARE_DECODER (PCM_S32LE, pcm_s32le);
-    DECLARE_DECODER (PCM_U8, pcm_u8);
-    DECLARE_DECODER (PCM_U16BE, pcm_u16be);
-    DECLARE_DECODER (PCM_U16LE, pcm_u16le);
-    DECLARE_DECODER (PCM_U24BE, pcm_u24be);
-    DECLARE_DECODER (PCM_U24LE, pcm_u24le);
-    DECLARE_DECODER (PCM_U32BE, pcm_u32be);
-    DECLARE_DECODER (PCM_U32LE, pcm_u32le);
-    DECLARE_DECODER (ROQ_DPCM, roq_dpcm);
-    DECLARE_DECODER (ADPCM_4XM, adpcm_4xm);
-    DECLARE_DECODER (ADPCM_ADX, adpcm_adx);
-    DECLARE_DECODER (ADPCM_CT, adpcm_ct);
-    DECLARE_DECODER (ADPCM_EA, adpcm_ea);
-    DECLARE_DECODER (ADPCM_G726, adpcm_g726);
-    DECLARE_DECODER (ADPCM_IMA_DK3, adpcm_ima_dk3);
-    DECLARE_DECODER (ADPCM_IMA_DK4, adpcm_ima_dk4);
-    DECLARE_DECODER (ADPCM_IMA_QT, adpcm_ima_qt);
-    DECLARE_DECODER (ADPCM_IMA_SMJPEG, adpcm_ima_smjpeg);
-    DECLARE_DECODER (ADPCM_IMA_WAV, adpcm_ima_wav);
-    DECLARE_DECODER (ADPCM_IMA_WS, adpcm_ima_ws);
-    DECLARE_DECODER (ADPCM_MS, adpcm_ms);
-    DECLARE_DECODER (ADPCM_SBPRO_2, adpcm_sbpro_2);
-    DECLARE_DECODER (ADPCM_SBPRO_3, adpcm_sbpro_3);
-    DECLARE_DECODER (ADPCM_SBPRO_4, adpcm_sbpro_4);
-    DECLARE_DECODER (ADPCM_SWF, adpcm_swf);
-    DECLARE_DECODER (ADPCM_XA, adpcm_xa);
-    DECLARE_DECODER (ADPCM_YAMAHA, adpcm_yamaha);
-    DECLARE_DECODER (DVDSUB, dvdsub);
-	DECLARE_DECODER (LIBVORBIS, libvorbis);
-
-#define DECLARE_PARSER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_PARSER 1\n&quot;); 
-    DECLARE_PARSER (H263, h263);
-    DECLARE_PARSER (H264, h264);
-    DECLARE_PARSER (MPEG4VIDEO, mpeg4video);
-
-#undef DECLARE_PARSER
-#define DECLARE_PARSER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_PARSER 0\n&quot;); 
-    DECLARE_PARSER (AAC, aac);
-    DECLARE_PARSER (AC3, ac3);
-    DECLARE_PARSER (CAVSVIDEO, cavsvideo);
-    DECLARE_PARSER (DCA, dca);
-    DECLARE_PARSER (DVBSUB, dvbsub);
-    DECLARE_PARSER (DVDSUB, dvdsub);
-    DECLARE_PARSER (H261, h261);
-    DECLARE_PARSER (MJPEG, mjpeg);
-    DECLARE_PARSER (MPEGAUDIO, mpegaudio);
-    DECLARE_PARSER (MPEGVIDEO, mpegvideo);
-    DECLARE_PARSER (PNM, pnm);
-    DECLARE_PARSER (VC1, vc1);
-
-#define DECLARE_ENCODER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_ENCODER 1\n&quot;); 
-    DECLARE_ENCODER (MJPEG, mjpeg);
-    DECLARE_ENCODER (MSMPEG4V3, msmpeg4v3);
-    DECLARE_ENCODER(H263P, h263p);
-    DECLARE_ENCODER(AC3, ac3);
-    DECLARE_ENCODER (FFV1, ffv1);
-    DECLARE_ENCODER (FLV1, flv1);
-    DECLARE_ENCODER (FFVHUFF, ffvhuff);
-    DECLARE_ENCODER (H263, h263);
-    DECLARE_ENCODER (MPEG1VIDEO, mpeg1video);
-    DECLARE_ENCODER (MPEG2VIDEO, mpeg2video);
-    DECLARE_ENCODER (MPEG4, mpeg4);
-    DECLARE_ENCODER (FLV, flv);
-    DECLARE_ENCODER (MP2, mp2);
-    DECLARE_ENCODER (DVVIDEO, dvvideo);
-    DECLARE_ENCODER (HUFFYUV, huffyuv);
-    DECLARE_ENCODER (DVBSUB, dvbsub);
-    DECLARE_ENCODER (SNOW, snow);
-
-#undef DECLARE_ENCODER
-#define DECLARE_ENCODER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_ENCODER 0\n&quot;); 
-    DECLARE_ENCODER(ADPCM_IMA_AMV, amv);
-    DECLARE_ENCODER(LIBX264, libx264);
-    DECLARE_ENCODER(LIBXVID, libxvid);
-    DECLARE_ENCODER(LJPEG, ljpeg);
-    DECLARE_ENCODER(PAM, pam);
-    DECLARE_ENCODER(PBM, pbm);
-    DECLARE_ENCODER(PGM, pgm);
-    DECLARE_ENCODER(PGMYUV, pgmyuv);
-    DECLARE_ENCODER(PPM, ppm);
-    DECLARE_ENCODER(LIBFAAC, libfaac);
-    DECLARE_ENCODER(LIBMP3LAME, libmp3lame);
-    DECLARE_ENCODER(LIBTHEORA, libtheora);
-    DECLARE_ENCODER(SONIC_LS, sonic_ls);
-/* Dupe */
-	DECLARE_ENCODER (ASV1, asv1);
-    DECLARE_ENCODER (ASV2, asv2);
-    DECLARE_ENCODER (BMP, bmp);
-    DECLARE_ENCODER (FLASHSV, flashsv);
-    DECLARE_ENCODER (GIF, gif);
-    DECLARE_ENCODER (H261, h261);
-    DECLARE_ENCODER (JPEGLS, jpegls);
-    DECLARE_ENCODER (MSMPEG4V1, msmpeg4v1);
-    DECLARE_ENCODER (MSMPEG4V2, msmpeg4v2);
-    DECLARE_ENCODER (PNG, png);
-    DECLARE_ENCODER (QTRLE, qtrle);
-    DECLARE_ENCODER (RAWVIDEO, rawvideo);
-    DECLARE_ENCODER (ROQ, roq);
-    DECLARE_ENCODER (RV10, rv10);
-    DECLARE_ENCODER (RV20, rv20);
-    DECLARE_ENCODER (SGI, sgi);
-    DECLARE_ENCODER (SVQ1, svq1);
-    DECLARE_ENCODER (TARGA, targa);
-    DECLARE_ENCODER (TIFF, tiff);
-    DECLARE_ENCODER (WMV1, wmv1);
-    DECLARE_ENCODER (WMV2, wmv2);
-    DECLARE_ENCODER (ZLIB, zlib);
-    DECLARE_ENCODER (ZMBV, zmbv);
-    DECLARE_ENCODER (FLAC, flac);
-    DECLARE_ENCODER (LIBAMR_NB, libamr_nb);
-    DECLARE_ENCODER (LIBAMR_WB, libamr_wb);
-    DECLARE_ENCODER (LIBGSM, libgsm);
-    DECLARE_ENCODER (LIBGSM_MS, libgsm_ms);
-    DECLARE_ENCODER (SONIC, sonic);
-    DECLARE_ENCODER (VORBIS, vorbis);
-    DECLARE_ENCODER(WMAV1, wmav1);
-    DECLARE_ENCODER(WMAV2, wmav2);
-    DECLARE_ENCODER (PCM_ALAW, pcm_alaw);
-    DECLARE_ENCODER (PCM_MULAW, pcm_mulaw);
-    DECLARE_ENCODER (PCM_S8, pcm_s8);
-    DECLARE_ENCODER (PCM_S16BE, pcm_s16be);
-    DECLARE_ENCODER (PCM_S16LE, pcm_s16le);
-    DECLARE_ENCODER (PCM_S24BE, pcm_s24be);
-    DECLARE_ENCODER (PCM_S24DAUD, pcm_s24daud);
-    DECLARE_ENCODER (PCM_S24LE, pcm_s24le);
-    DECLARE_ENCODER (PCM_S32BE, pcm_s32be);
-    DECLARE_ENCODER (PCM_S32LE, pcm_s32le);
-    DECLARE_ENCODER (PCM_U8, pcm_u8);
-    DECLARE_ENCODER (PCM_U16BE, pcm_u16be);
-    DECLARE_ENCODER (PCM_U16LE, pcm_u16le);
-    DECLARE_ENCODER (PCM_U24BE, pcm_u24be);
-    DECLARE_ENCODER (PCM_U24LE, pcm_u24le);
-    DECLARE_ENCODER (PCM_U32BE, pcm_u32be);
-    DECLARE_ENCODER (PCM_U32LE, pcm_u32le);
-    DECLARE_ENCODER (ROQ_DPCM, roq_dpcm);
-    DECLARE_ENCODER (ADPCM_4XM, adpcm_4xm);
-    DECLARE_ENCODER (ADPCM_ADX, adpcm_adx);
-    DECLARE_ENCODER (ADPCM_CT, adpcm_ct);
-    DECLARE_ENCODER (ADPCM_EA, adpcm_ea);
-    DECLARE_ENCODER (ADPCM_G726, adpcm_g726);
-    DECLARE_ENCODER (ADPCM_IMA_DK3, adpcm_ima_dk3);
-    DECLARE_ENCODER (ADPCM_IMA_DK4, adpcm_ima_dk4);
-    DECLARE_ENCODER (ADPCM_IMA_QT, adpcm_ima_qt);
-    DECLARE_ENCODER (ADPCM_IMA_SMJPEG, adpcm_ima_smjpeg);
-    DECLARE_ENCODER (ADPCM_IMA_WAV, adpcm_ima_wav);
-    DECLARE_ENCODER (ADPCM_IMA_WS, adpcm_ima_ws);
-    DECLARE_ENCODER (ADPCM_MS, adpcm_ms);
-    DECLARE_ENCODER (ADPCM_SBPRO_2, adpcm_sbpro_2);
-    DECLARE_ENCODER (ADPCM_SBPRO_3, adpcm_sbpro_3);
-    DECLARE_ENCODER (ADPCM_SBPRO_4, adpcm_sbpro_4);
-    DECLARE_ENCODER (ADPCM_SWF, adpcm_swf);
-    DECLARE_ENCODER (ADPCM_XA, adpcm_xa);
-    DECLARE_ENCODER (ADPCM_YAMAHA, adpcm_yamaha);
-    DECLARE_ENCODER (DVDSUB, dvdsub);
-	DECLARE_ENCODER (LIBVORBIS, libvorbis);
-
-#define DECLARE_BSF(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_BSF 0\n&quot;);
-
-	DECLARE_BSF(MP3_HEADER_COMPRESS, mp3_header_compress);
-	DECLARE_BSF(IMX_DUMP_HEADER, imx_dump_header);
-	DECLARE_BSF(DUMP_EXTRADATA, dump_extradata);
-	DECLARE_BSF(REMOVE_EXTRADATA, remove_extradata);
-	DECLARE_BSF(NOISE, noise);
-	DECLARE_BSF(MP3_HEADER_DECOMPRESS, mp3_header_decompress);
-	DECLARE_BSF(MJPEGA_DUMP_HEADER, mjpega_dump_header);
-	DECLARE_BSF(IMX_DUMP_HEADER, imx_dump_header);
-
-#define DECLARE_MUXER(a,b); printf(&quot;#define CONFIG_&quot;#a&quot;_MUXER 1\n&quot;);
-
-	printf(&quot;#define CONFIG_MUXERS 1\n&quot;);
-	DECLARE_MUXER(MOV, mov)
-	DECLARE_MUXER(MP4, mp4)
-	DECLARE_MUXER(PSP, psp)
-	DECLARE_MUXER(TG2, tg2)
-	DECLARE_MUXER(TGP, tgp)
-
-	printf(&quot;#define CONFIG_ENCODERS 1\n&quot;);
-	printf(&quot;#define CONFIG_DVVIDEO_ENCODER 1\n&quot;);
-	printf(&quot;#define CONFIG_SNOW_ENCODER 1\n&quot;);
-
-#define DECLARE_CONFIG_DECODER(a,b); printf(&quot;#define CONFIG_&quot;#a&quot;_DECODER 1\n&quot;);
-
-	printf(&quot;#define CONFIG_DECODERS 1\n&quot;);
-	DECLARE_CONFIG_DECODER(DVVIDEO, dvvideo);
-	DECLARE_CONFIG_DECODER(H263, h263);
-	DECLARE_CONFIG_DECODER(MPEG4, mpeg4);
-	DECLARE_CONFIG_DECODER(SNOW, snow);
-	DECLARE_CONFIG_DECODER(VC1, vc1);
-	DECLARE_CONFIG_DECODER(WMV2, wmv2);
-	DECLARE_CONFIG_DECODER(WMV3, wmv3);
-
-	printf(&quot;#define CONFIG_MPEGAUDIO_HP 1\n&quot;);
-	printf(&quot;#define CONFIG_ZLIB 1\n&quot;);
-
-#define ENABLE(a,b); printf(&quot;#define ENABLE_&quot;#a&quot; 0\n&quot;);
-
-	ENABLE(ARMV4L, armv4l);
-	ENABLE(MLIB, mlib);
-	ENABLE(SPARC, sparc);
-	ENABLE(ALPHA, alpha);
-	ENABLE(MMI, mmi);
-	ENABLE(SH4, sh4);
-	ENABLE(BFIN, bfin);
-	ENABLE(SMALL, small);
-
-	// Hack so CMake and autoconf don't need to be changed
-	printf(&quot;#ifdef ARCH_POWERPC\n&quot;);
-	printf(&quot;#define ENABLE_POWERPC 1\n&quot;);
-	printf(&quot;#else\n&quot;);
-	printf(&quot;#define ENABLE_POWERPC 0\n&quot;);
-	printf(&quot;#endif\n&quot;);
-
-	printf(&quot;#ifdef ARCH_X86\n&quot;);
-	printf(&quot;#define ENABLE_MMX 1\n&quot;);
-	printf(&quot;#define HAVE_MMX 1\n&quot;);
-	printf(&quot;#define HAVE_FAST_UNALIGNED 1\n&quot;);
-	printf(&quot;#else\n&quot;);
-	printf(&quot;#define ENABLE_MMX 0\n&quot;);
-	printf(&quot;#endif\n&quot;);
-
-	printf(&quot;#ifdef ARCH_X86_64\n&quot;);
-	printf(&quot;#define HAVE_FAST_64BIT 1\n&quot;);
-	printf(&quot;#endif\n&quot;);
-
-	printf(&quot;#ifdef __APPLE__\n&quot;);
-	printf(&quot;#define CONFIG_DARWIN 1\n&quot;);
-	printf(&quot;#endif\n&quot;);
-
-	printf(&quot;#define ENABLE_THREADS 1\n&quot;);
-	printf(&quot;#define HAVE_LRINTF 1\n&quot;);
-	printf(&quot;#define HAVE_THREADS 1\n&quot;);
-	printf(&quot;#define RUNTIME_CPUDETECT 1\n&quot;);
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ffconf.h	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,350 +0,0 @@
-#define ENABLE_NELLYMOSER_DECODER 1
-#define ENABLE_ADPCM_IMA_AMV_DECODER 1
-#define ENABLE_CINEPAK_DECODER 1
-#define ENABLE_DNXHD_DECODER 1
-#define ENABLE_FOURXM_DECODER 1
-#define ENABLE_FRAPS_DECODER 1
-#define ENABLE_H263_DECODER 1
-#define ENABLE_H264_DECODER 1
-#define ENABLE_INDEO2_DECODER 1
-#define ENABLE_INDEO3_DECODER 1
-#define ENABLE_INTERPLAY_VIDEO_DECODER 1
-#define ENABLE_MPEGVIDEO_DECODER 1
-#define ENABLE_MSVIDEO1_DECODER 1
-#define ENABLE_VC1_DECODER 1
-#define ENABLE_VCR1_DECODER 1
-#define ENABLE_VP5_DECODER 1
-#define ENABLE_VP6_DECODER 1
-#define ENABLE_VP6F_DECODER 1
-#define ENABLE_WMV3_DECODER 1
-#define ENABLE_WMV1_DECODER 1
-#define ENABLE_WMV2_DECODER 1
-#define ENABLE_VP3_DECODER 1
-#define ENABLE_MPEG4_DECODER 1
-#define ENABLE_MSMPEG4V1_DECODER 1
-#define ENABLE_MSMPEG4V2_DECODER 1
-#define ENABLE_MSMPEG4V3_DECODER 1
-#define ENABLE_MJPEGB_DECODER 1
-#define ENABLE_MJPEG_DECODER 1
-#define ENABLE_WMAV2_DECODER 1
-#define ENABLE_DVVIDEO_DECODER 1
-#define ENABLE_HUFFYUV_DECODER 1
-#define ENABLE_FFVHUFF_DECODER 1
-#define ENABLE_SVQ3_DECODER 1
-#define ENABLE_TSCC_DECODER 1
-#define ENABLE_QDM2_DECODER 1
-#define ENABLE_FFV1_DECODER 1
-#define ENABLE_MPEG1VIDEO_DECODER 1
-#define ENABLE_MPEG2VIDEO_DECODER 1
-#define ENABLE_RV10_DECODER 1
-#define ENABLE_RV20_DECODER 1
-#define ENABLE_DVBSUB_DECODER 1
-#define ENABLE_FLV_DECODER 1
-#define ENABLE_SNOW_DECODER 1
-#define ENABLE_AMV_DECODER 1
-#define ENABLE_AASC_DECODER 0
-#define ENABLE_AVS_DECODER 0
-#define ENABLE_BETHSOFTVID_DECODER 0
-#define ENABLE_C93_DECODER 0
-#define ENABLE_CAVS_DECODER 0
-#define ENABLE_CLJR_DECODER 0
-#define ENABLE_CSCD_DECODER 0
-#define ENABLE_CYUV_DECODER 0
-#define ENABLE_DSICINVIDEO_DECODER 0
-#define ENABLE_DXA_DECODER 0
-#define ENABLE_EIGHTBPS_DECODER 0
-#define ENABLE_FLIC_DECODER 0
-#define ENABLE_IDCIN_DECODER 0
-#define ENABLE_KMVC_DECODER 0
-#define ENABLE_LOCO_DECODER 0
-#define ENABLE_MDEC_DECODER 0
-#define ENABLE_MMVIDEO_DECODER 0
-#define ENABLE_MPEG_XVMC_DECODER 0
-#define ENABLE_MSRLE_DECODER 0
-#define ENABLE_MSZH_DECODER 0
-#define ENABLE_NUV_DECODER 0
-#define ENABLE_PTX_DECODER 0
-#define ENABLE_QDRAW_DECODER 0
-#define ENABLE_QPEG_DECODER 0
-#define ENABLE_RPZA_DECODER 0
-#define ENABLE_SMACKER_DECODER 0
-#define ENABLE_SMC_DECODER 0
-#define ENABLE_SP5X_DECODER 0
-#define ENABLE_THEORA_DECODER 0
-#define ENABLE_THP_DECODER 0
-#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
-#define ENABLE_TRUEMOTION1_DECODER 0
-#define ENABLE_TRUEMOTION2_DECODER 0
-#define ENABLE_TXD_DECODER 0
-#define ENABLE_ULTI_DECODER 0
-#define ENABLE_VMDVIDEO_DECODER 0
-#define ENABLE_VMNC_DECODER 0
-#define ENABLE_VQA_DECODER 0
-#define ENABLE_WNV1_DECODER 0
-#define ENABLE_XAN_WC3_DECODER 0
-#define ENABLE_XL_DECODER 0
-#define ENABLE_MPEG4AAC_DECODER 0
-#define ENABLE_ALAC_DECODER 0
-#define ENABLE_ATRAC3_DECODER 0
-#define ENABLE_COOK_DECODER 0
-#define ENABLE_DCA_DECODER 0
-#define ENABLE_DSICINAUDIO_DECODER 0
-#define ENABLE_IMC_DECODER 0
-#define ENABLE_LIBA52_DECODER 0
-#define ENABLE_LIBFAAD_DECODER 0
-#define ENABLE_MACE3_DECODER 0
-#define ENABLE_MACE6_DECODER 0
-#define ENABLE_MP3_DECODER 0
-#define ENABLE_MP3ADU_DECODER 0
-#define ENABLE_MP3ON4_DECODER 0
-#define ENABLE_MPC7_DECODER 0
-#define ENABLE_RA_144_DECODER 0
-#define ENABLE_RA_288_DECODER 0
-#define ENABLE_SHORTEN_DECODER 0
-#define ENABLE_SMACKAUD_DECODER 0
-#define ENABLE_TRUESPEECH_DECODER 0
-#define ENABLE_TTA_DECODER 0
-#define ENABLE_VMDAUDIO_DECODER 0
-#define ENABLE_WAVPACK_DECODER 0
-#define ENABLE_WS_SND1_DECODER 0
-#define ENABLE_INTERPLAY_DPCM_DECODER 0
-#define ENABLE_SOL_DPCM_DECODER 0
-#define ENABLE_XAN_DPCM_DECODER 0
-#define ENABLE_ADPCM_THP_DECODER 0
-#define ENABLE_ASV1_DECODER 0
-#define ENABLE_ASV2_DECODER 0
-#define ENABLE_BMP_DECODER 0
-#define ENABLE_FLASHSV_DECODER 0
-#define ENABLE_GIF_DECODER 0
-#define ENABLE_H261_DECODER 0
-#define ENABLE_H263I_DECODER 0
-#define ENABLE_JPEGLS_DECODER 0
-#define ENABLE_PNG_DECODER 0
-#define ENABLE_QTRLE_DECODER 0
-#define ENABLE_RAWVIDEO_DECODER 0
-#define ENABLE_ROQ_DECODER 0
-#define ENABLE_SGI_DECODER 0
-#define ENABLE_SVQ1_DECODER 0
-#define ENABLE_TARGA_DECODER 0
-#define ENABLE_TIFF_DECODER 0
-#define ENABLE_ZLIB_DECODER 0
-#define ENABLE_ZMBV_DECODER 0
-#define ENABLE_FLAC_DECODER 0
-#define ENABLE_LIBAMR_NB_DECODER 0
-#define ENABLE_LIBAMR_WB_DECODER 0
-#define ENABLE_LIBGSM_DECODER 0
-#define ENABLE_LIBGSM_MS_DECODER 0
-#define ENABLE_MP2_DECODER 0
-#define ENABLE_SONIC_DECODER 0
-#define ENABLE_VORBIS_DECODER 0
-#define ENABLE_WMAV1_DECODER 0
-#define ENABLE_PCM_ALAW_DECODER 0
-#define ENABLE_PCM_MULAW_DECODER 0
-#define ENABLE_PCM_S8_DECODER 0
-#define ENABLE_PCM_S16BE_DECODER 0
-#define ENABLE_PCM_S16LE_DECODER 0
-#define ENABLE_PCM_S24BE_DECODER 0
-#define ENABLE_PCM_S24DAUD_DECODER 0
-#define ENABLE_PCM_S24LE_DECODER 0
-#define ENABLE_PCM_S32BE_DECODER 0
-#define ENABLE_PCM_S32LE_DECODER 0
-#define ENABLE_PCM_U8_DECODER 0
-#define ENABLE_PCM_U16BE_DECODER 0
-#define ENABLE_PCM_U16LE_DECODER 0
-#define ENABLE_PCM_U24BE_DECODER 0
-#define ENABLE_PCM_U24LE_DECODER 0
-#define ENABLE_PCM_U32BE_DECODER 0
-#define ENABLE_PCM_U32LE_DECODER 0
-#define ENABLE_ROQ_DPCM_DECODER 0
-#define ENABLE_ADPCM_4XM_DECODER 0
-#define ENABLE_ADPCM_ADX_DECODER 0
-#define ENABLE_ADPCM_CT_DECODER 0
-#define ENABLE_ADPCM_EA_DECODER 0
-#define ENABLE_ADPCM_G726_DECODER 0
-#define ENABLE_ADPCM_IMA_DK3_DECODER 0
-#define ENABLE_ADPCM_IMA_DK4_DECODER 0
-#define ENABLE_ADPCM_IMA_QT_DECODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
-#define ENABLE_ADPCM_IMA_WAV_DECODER 0
-#define ENABLE_ADPCM_IMA_WS_DECODER 0
-#define ENABLE_ADPCM_MS_DECODER 0
-#define ENABLE_ADPCM_SBPRO_2_DECODER 0
-#define ENABLE_ADPCM_SBPRO_3_DECODER 0
-#define ENABLE_ADPCM_SBPRO_4_DECODER 0
-#define ENABLE_ADPCM_SWF_DECODER 0
-#define ENABLE_ADPCM_XA_DECODER 0
-#define ENABLE_ADPCM_YAMAHA_DECODER 0
-#define ENABLE_DVDSUB_DECODER 0
-#define ENABLE_LIBVORBIS_DECODER 0
-#define ENABLE_H263_PARSER 1
-#define ENABLE_H264_PARSER 1
-#define ENABLE_MPEG4VIDEO_PARSER 1
-#define ENABLE_AAC_PARSER 0
-#define ENABLE_AC3_PARSER 0
-#define ENABLE_CAVSVIDEO_PARSER 0
-#define ENABLE_DCA_PARSER 0
-#define ENABLE_DVBSUB_PARSER 0
-#define ENABLE_DVDSUB_PARSER 0
-#define ENABLE_H261_PARSER 0
-#define ENABLE_MJPEG_PARSER 0
-#define ENABLE_MPEGAUDIO_PARSER 0
-#define ENABLE_MPEGVIDEO_PARSER 0
-#define ENABLE_PNM_PARSER 0
-#define ENABLE_VC1_PARSER 0
-#define ENABLE_MJPEG_ENCODER 1
-#define ENABLE_MSMPEG4V3_ENCODER 1
-#define ENABLE_H263P_ENCODER 1
-#define ENABLE_AC3_ENCODER 1
-#define ENABLE_FFV1_ENCODER 1
-#define ENABLE_FLV1_ENCODER 1
-#define ENABLE_FFVHUFF_ENCODER 1
-#define ENABLE_H263_ENCODER 1
-#define ENABLE_MPEG1VIDEO_ENCODER 1
-#define ENABLE_MPEG2VIDEO_ENCODER 1
-#define ENABLE_MPEG4_ENCODER 1
-#define ENABLE_FLV_ENCODER 1
-#define ENABLE_MP2_ENCODER 1
-#define ENABLE_DVVIDEO_ENCODER 1
-#define ENABLE_HUFFYUV_ENCODER 1
-#define ENABLE_DVBSUB_ENCODER 1
-#define ENABLE_SNOW_ENCODER 1
-#define ENABLE_ADPCM_IMA_AMV_ENCODER 0
-#define ENABLE_LIBX264_ENCODER 0
-#define ENABLE_LIBXVID_ENCODER 0
-#define ENABLE_LJPEG_ENCODER 0
-#define ENABLE_PAM_ENCODER 0
-#define ENABLE_PBM_ENCODER 0
-#define ENABLE_PGM_ENCODER 0
-#define ENABLE_PGMYUV_ENCODER 0
-#define ENABLE_PPM_ENCODER 0
-#define ENABLE_LIBFAAC_ENCODER 0
-#define ENABLE_LIBMP3LAME_ENCODER 0
-#define ENABLE_LIBTHEORA_ENCODER 0
-#define ENABLE_SONIC_LS_ENCODER 0
-#define ENABLE_ASV1_ENCODER 0
-#define ENABLE_ASV2_ENCODER 0
-#define ENABLE_BMP_ENCODER 0
-#define ENABLE_FLASHSV_ENCODER 0
-#define ENABLE_GIF_ENCODER 0
-#define ENABLE_H261_ENCODER 0
-#define ENABLE_JPEGLS_ENCODER 0
-#define ENABLE_MSMPEG4V1_ENCODER 0
-#define ENABLE_MSMPEG4V2_ENCODER 0
-#define ENABLE_PNG_ENCODER 0
-#define ENABLE_QTRLE_ENCODER 0
-#define ENABLE_RAWVIDEO_ENCODER 0
-#define ENABLE_ROQ_ENCODER 0
-#define ENABLE_RV10_ENCODER 0
-#define ENABLE_RV20_ENCODER 0
-#define ENABLE_SGI_ENCODER 0
-#define ENABLE_SVQ1_ENCODER 0
-#define ENABLE_TARGA_ENCODER 0
-#define ENABLE_TIFF_ENCODER 0
-#define ENABLE_WMV1_ENCODER 0
-#define ENABLE_WMV2_ENCODER 0
-#define ENABLE_ZLIB_ENCODER 0
-#define ENABLE_ZMBV_ENCODER 0
-#define ENABLE_FLAC_ENCODER 0
-#define ENABLE_LIBAMR_NB_ENCODER 0
-#define ENABLE_LIBAMR_WB_ENCODER 0
-#define ENABLE_LIBGSM_ENCODER 0
-#define ENABLE_LIBGSM_MS_ENCODER 0
-#define ENABLE_SONIC_ENCODER 0
-#define ENABLE_VORBIS_ENCODER 0
-#define ENABLE_WMAV1_ENCODER 0
-#define ENABLE_WMAV2_ENCODER 0
-#define ENABLE_PCM_ALAW_ENCODER 0
-#define ENABLE_PCM_MULAW_ENCODER 0
-#define ENABLE_PCM_S8_ENCODER 0
-#define ENABLE_PCM_S16BE_ENCODER 0
-#define ENABLE_PCM_S16LE_ENCODER 0
-#define ENABLE_PCM_S24BE_ENCODER 0
-#define ENABLE_PCM_S24DAUD_ENCODER 0
-#define ENABLE_PCM_S24LE_ENCODER 0
-#define ENABLE_PCM_S32BE_ENCODER 0
-#define ENABLE_PCM_S32LE_ENCODER 0
-#define ENABLE_PCM_U8_ENCODER 0
-#define ENABLE_PCM_U16BE_ENCODER 0
-#define ENABLE_PCM_U16LE_ENCODER 0
-#define ENABLE_PCM_U24BE_ENCODER 0
-#define ENABLE_PCM_U24LE_ENCODER 0
-#define ENABLE_PCM_U32BE_ENCODER 0
-#define ENABLE_PCM_U32LE_ENCODER 0
-#define ENABLE_ROQ_DPCM_ENCODER 0
-#define ENABLE_ADPCM_4XM_ENCODER 0
-#define ENABLE_ADPCM_ADX_ENCODER 0
-#define ENABLE_ADPCM_CT_ENCODER 0
-#define ENABLE_ADPCM_EA_ENCODER 0
-#define ENABLE_ADPCM_G726_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
-#define ENABLE_ADPCM_IMA_QT_ENCODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
-#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
-#define ENABLE_ADPCM_IMA_WS_ENCODER 0
-#define ENABLE_ADPCM_MS_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
-#define ENABLE_ADPCM_SWF_ENCODER 0
-#define ENABLE_ADPCM_XA_ENCODER 0
-#define ENABLE_ADPCM_YAMAHA_ENCODER 0
-#define ENABLE_DVDSUB_ENCODER 0
-#define ENABLE_LIBVORBIS_ENCODER 0
-#define ENABLE_MP3_HEADER_COMPRESS_BSF 0
-#define ENABLE_IMX_DUMP_HEADER_BSF 0
-#define ENABLE_DUMP_EXTRADATA_BSF 0
-#define ENABLE_REMOVE_EXTRADATA_BSF 0
-#define ENABLE_NOISE_BSF 0
-#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
-#define ENABLE_MJPEGA_DUMP_HEADER_BSF 0
-#define ENABLE_IMX_DUMP_HEADER_BSF 0
-#define CONFIG_MUXERS 1
-#define CONFIG_MOV_MUXER 1
-#define CONFIG_MP4_MUXER 1
-#define CONFIG_PSP_MUXER 1
-#define CONFIG_TG2_MUXER 1
-#define CONFIG_TGP_MUXER 1
-#define CONFIG_ENCODERS 1
-#define CONFIG_DVVIDEO_ENCODER 1
-#define CONFIG_SNOW_ENCODER 1
-#define CONFIG_DECODERS 1
-#define CONFIG_DVVIDEO_DECODER 1
-#define CONFIG_H263_DECODER 1
-#define CONFIG_MPEG4_DECODER 1
-#define CONFIG_SNOW_DECODER 1
-#define CONFIG_VC1_DECODER 1
-#define CONFIG_WMV2_DECODER 1
-#define CONFIG_WMV3_DECODER 1
-#define CONFIG_MPEGAUDIO_HP 1
-#define CONFIG_ZLIB 1
-#define ENABLE_ARMV4L 0
-#define ENABLE_MLIB 0
-#define ENABLE_SPARC 0
-#define ENABLE_ALPHA 0
-#define ENABLE_MMI 0
-#define ENABLE_SH4 0
-#define ENABLE_BFIN 0
-#define ENABLE_SMALL 0
-#ifdef ARCH_POWERPC
-#define ENABLE_POWERPC 1
-#else
-#define ENABLE_POWERPC 0
-#endif
-#ifdef ARCH_X86
-#define ENABLE_MMX 1
-#define HAVE_MMX 1
-#define HAVE_FAST_UNALIGNED 1
-#else
-#define ENABLE_MMX 0
-#endif
-#ifdef ARCH_X86_64
-#define HAVE_FAST_64BIT 1
-#endif
-#ifdef __APPLE__
-#define CONFIG_DARWIN 1
-#endif
-#define ENABLE_THREADS 1
-#define HAVE_LRINTF 1
-#define HAVE_THREADS 1
-#define RUNTIME_CPUDETECT 1

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,809 +0,0 @@
-
-// C++ Implementation: ADM_lavformat
-//
-// Description: 
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;math.h&gt;
-#include &lt;string.h&gt;
-
-extern &quot;C&quot; 
-{
-	
-	#include &quot;avformat.h&quot;
-};
-
-#undef malloc
-#undef realloc
-#undef free
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
-#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
-#include &quot;ADM_audio/ADM_a52info.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_editor/ADM_Video.h&quot;
-
-#include &quot;ADM_lavformat.h&quot;
-#include &quot;fourcc.h&quot;
-
-#include &quot;prefs.h&quot;
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_LAVFORMAT
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-#include &quot;ADM_cpuCap.h&quot;
-static    AVOutputFormat *fmt;
-static    AVFormatContext *oc;
-static    AVStream *audio_st, *video_st;
-static    double audio_pts, video_pts;
-
-static uint32_t one;
-uint64_t  _curDTS;
-
-static uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid);
-static uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid);
-// convert in in us to out in 90Khz tick
-int64_t adm_90k( double in)
-{
-int64_t out;
-	// in=in/1000*1000 us-&gt;s
-	// in/=(1/90000) nb 90 khz tick
-	// in*=90*000/000*000
-	// in =  in*=90/000
-	//in=in*90./1000.;
-	out= (int64_t)in;
-	return out;
-}
-//___________________________________________________________________________
-lavMuxer::lavMuxer( void )
-{
-	fmt=NULL;
-	oc=NULL;
-	audio_st=NULL;
-	video_st=NULL;
-	_fps1000=0;
-	_audioByterate=0;
-	_lastAudioDts=0;
-	_frameNo=0;
-	_running=0;
-	_curDTS=0;
-        _audioFq=0;
-}
-//___________________________________________________________________________
-lavMuxer::~lavMuxer()
-{
-	close();
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::open(const char *filename, uint32_t inbitrate,ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader) 
-{
-        return open(filename,inbitrate,type,info,0,NULL,audioheader,0,NULL);
-}
-
-
-uint8_t lavMuxer::open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info,
-              uint32_t videoExtraDataSize, uint8_t *videoExtraData, WAVHeader *audioheader,
-              uint32_t audioextraSize,uint8_t *audioextraData)
-{
- AVCodecContext *c;
- 	_type=type;
-	_fps1000=info-&gt;fps1000;
-	switch(_type)
-	{
-	case MUXER_TS:
-		fmt=guess_format(&quot;mpegts&quot;, NULL, NULL);
-		break;
-	case MUXER_DVD:
-		fmt = guess_format(&quot;dvd&quot;, NULL, NULL);
-		break;
-	case MUXER_VCD:
-		fmt = guess_format(&quot;vcd&quot;, NULL, NULL);
-		break;
-	case MUXER_SVCD:
-		fmt = guess_format(&quot;svcd&quot;, NULL, NULL);
-		break;
-	case MUXER_MP4:
-		fmt = guess_format(&quot;mp4&quot;, NULL, NULL);
-		break;
-	case MUXER_PSP:
-		fmt = guess_format(&quot;psp&quot;, NULL, NULL);
-		break;
-	case MUXER_FLV:
-		fmt = guess_format(&quot;flv&quot;, NULL, NULL);
-		break;          
-	case MUXER_MATROSKA:
-		fmt = guess_format(&quot;matroska&quot;, NULL, NULL);
-		break;          
-
-	default:
-		fmt=NULL;
-	}
-	if (!fmt) 
-	{
-        	printf(&quot;Lav:Cannot guess format\n&quot;);
-                ADM_assert(0);
-		return 0;
-	}
-	oc = av_alloc_format_context();
-	if (!oc) 
-	{
-       		printf(&quot;Lav:Cannot allocate context\n&quot;);
-		return 0;
-	}
-	oc-&gt;oformat = fmt;
-	snprintf(oc-&gt;filename,1000,&quot;<A HREF="file://%s">file://%s</A>&quot;,filename);
-	// Video
-	//________
-	
-	video_st = av_new_stream(oc, 0);
-	if (!video_st) 
-	{
-		printf(&quot;Lav: new stream failed\n&quot;);
-		return 0;
-	}	
-	
-	c = video_st-&gt;codec;
-	switch(_type)
-	{
-				case MUXER_FLV:
-					 c-&gt;codec=new AVCodec;
-					 memset(c-&gt;codec,0,sizeof(AVCodec));
-					 if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;FLV1&quot;))
-					 {
-						 c-&gt;codec_id=CODEC_ID_FLV1;
-					 	 c-&gt;codec-&gt;name=ADM_strdup(&quot;FLV1&quot;);
-					 }else
-					 {
-						 if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;VP6F&quot;))
-						 			{
-							 		 c-&gt;codec_id=CODEC_ID_VP6F;
-					 				 c-&gt;codec-&gt;name=ADM_strdup(&quot;VP6F&quot;);
-						 			}
-						 else
-							 ADM_assert(0);
-					 
-					 }
-					 
-					 break;
-                case MUXER_MATROSKA:
-                        strcpy(oc-&gt;title,&quot;Avidemux&quot;);
-                        strcpy(oc-&gt;author,&quot;Avidemux&quot;);
-                        c-&gt;sample_aspect_ratio.num=1;
-                        c-&gt;sample_aspect_ratio.den=1;
-                        if(isMpeg4Compatible(info-&gt;fcc))
-                        {
-                                c-&gt;codec_id = CODEC_ID_MPEG4;
-                                c-&gt;has_b_frames=1; // in doubt...
-                        }else
-                        {
-                                if(isH264Compatible(info-&gt;fcc))
-                                {
-                                        c-&gt;has_b_frames=1; // in doubt...
-                                        c-&gt;codec_id = CODEC_ID_H264;
-                                        c-&gt;codec=new AVCodec;
-                                        memset(c-&gt;codec,0,sizeof(AVCodec));
-                                        c-&gt;codec-&gt;name=ADM_strdup(&quot;H264&quot;);
-                                }
-                                else
-                                {
-                                   if(!ADM_4cc_to_lavcodec((const char *)&amp;(info-&gt;fcc),&amp;(c-&gt;codec_id)))
-                                   {
-                                      printf(&quot;[lavFormat] Cannot map  this\n&quot;);
-                                      return 0;
-                                   }
-                                  
-                                }
-                        }
-                        if(videoExtraDataSize)
-                        {
-                                c-&gt;extradata=videoExtraData;
-                                c-&gt;extradata_size= videoExtraDataSize;
-                        }
-                        break;
-                case MUXER_MP4:
-                case MUXER_PSP:
-                {
-                        // probably a memeleak here
-                        char *foo=ADM_strdup(filename);
-                        
-                        strcpy(oc-&gt;title,ADM_GetFileName(foo));
-                        strcpy(oc-&gt;author,&quot;Avidemux&quot;);
-                        c-&gt;sample_aspect_ratio.num=1;
-                        c-&gt;sample_aspect_ratio.den=1;
-                        if(isMpeg4Compatible(info-&gt;fcc))
-                        {
-                                c-&gt;codec_id = CODEC_ID_MPEG4;
-                                c-&gt;has_b_frames=1; // in doubt...
-                        }else
-                        {
-                                if(isH264Compatible(info-&gt;fcc))
-                                {
-                                        c-&gt;has_b_frames=1; // in doubt...
-                                        c-&gt;codec_id = CODEC_ID_H264;
-                                        c-&gt;codec=new AVCodec;
-                                        memset(c-&gt;codec,0,sizeof(AVCodec));
-                                        c-&gt;codec-&gt;name=ADM_strdup(&quot;H264&quot;);
-                                }
-                                else
-                                {
-                                        if(isDVCompatible(info-&gt;fcc))
-                                        {
-                                          c-&gt;codec_id = CODEC_ID_DVVIDEO;
-                                        }else
-                                        {
-                                          if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;H263&quot;))
-                                          {
-                                                    c-&gt;codec_id=CODEC_ID_H263;
-                                            }else{
-                                                    c-&gt;codec_id = CODEC_ID_MPEG4; // Default value
-                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
-                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
-                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
-                                                }
-                                        }
-                                }
-                        }
-                        if(videoExtraDataSize)
-                        {
-                                c-&gt;extradata=videoExtraData;
-                                c-&gt;extradata_size= videoExtraDataSize;
-                        }
-                        if(MUXER_PSP==_type)
-                        {
-                            c-&gt;rc_buffer_size=0; //8*1024*224;
-                            c-&gt;rc_max_rate=0; //768*1000;
-                            c-&gt;rc_min_rate=0;
-                            c-&gt;bit_rate=768*1000;
-                        }
-                        else
-                        {
-                            c-&gt;rc_buffer_size=8*1024*224;
-                            c-&gt;rc_max_rate=9500*1000;
-                            c-&gt;rc_min_rate=0;
-                            if(!inbitrate)
-                                    c-&gt;bit_rate=9000*1000;
-                            else
-                                    c-&gt;bit_rate=inbitrate;
-                        }
-                }
-                        break;
-                case MUXER_TS:
-                        c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
-                        c-&gt;rc_buffer_size=8*1024*224;
-                        c-&gt;rc_max_rate=9500*1000;
-                        c-&gt;rc_min_rate=0;
-                        if(!inbitrate)
-                                c-&gt;bit_rate=9000*1000;
-                        else
-                                c-&gt;bit_rate=inbitrate;
-        
-                        break;
-		case MUXER_DVD:
-			c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
-			c-&gt;rc_buffer_size=8*1024*224;
-			c-&gt;rc_max_rate=9500*1000;
-			c-&gt;rc_min_rate=0;
-			if(!inbitrate)
-				c-&gt;bit_rate=9000*1000;
-			else
-				c-&gt;bit_rate=inbitrate;
-	
-			break;
-		case MUXER_VCD:
-			c-&gt;codec_id = CODEC_ID_MPEG1VIDEO;
-
-			c-&gt;rc_buffer_size=8*1024*40;
-			c-&gt;rc_max_rate=1152*1000;
-			c-&gt;rc_min_rate=1152*1000;
-			
-			c-&gt;bit_rate=1152*1000;
-			
-
-			break;
-		case MUXER_SVCD:
-			c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
-
-			c-&gt;rc_buffer_size=8*1024*112;
-			c-&gt;rc_max_rate=2500*1000;
-			c-&gt;rc_min_rate=0*1000;
-			if(!inbitrate)
-				c-&gt;bit_rate=2040*1000;
-			else
-				c-&gt;bit_rate=inbitrate;
-
-			break;
-		default:
-			ADM_assert(0);
-	}
-	
-	c-&gt;codec_type = CODEC_TYPE_VIDEO;
-	c-&gt;flags=CODEC_FLAG_QSCALE;   
-	c-&gt;width = info-&gt;width;  
-	c-&gt;height = info-&gt;height; 
-
-       AVRational fps25=(AVRational){1001,25025};
-       AVRational fps24=(AVRational){1001,24000};
-       AVRational fps30= (AVRational){1001,30000};
-       AVRational fpsfree= (AVRational){1000,_fps1000};
-
-        
-    	switch(_fps1000)
-	{
-		case 25000:
-                {
-			 c-&gt;time_base= fps25; 
-			 break;
-                }
-		case 23976:
-                        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
-                        {
-                                 c-&gt;time_base= fps24; //(AVRational){1001,24000};
-                                break;
-                        }
-		case  29970:
-			 c-&gt;time_base=fps30;
-			break;
-		default:
-                      {
-                            if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
-                            {
-                                    c-&gt;time_base=fpsfree;// (AVRational){1000,_fps1000};
-                                    break;
-                            }
-                            else
-                            {
-                                GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible frame rate&quot;), NULL);
-                                return 0;
-                            }
-                            }
-                        break;
-	}
-
-			
-	c-&gt;gop_size=15;
-	c-&gt;max_b_frames=2;
-	c-&gt;has_b_frames=1;
-
-	
-	// Audio
-	//________
-        if(audioheader)
-        {
-          audio_st = av_new_stream(oc, 1);
-          if (!audio_st) 
-          {
-                  printf(&quot;Lav: new stream failed\n&quot;);
-                  return 0;
-          }
-  
-                  
-          c = audio_st-&gt;codec;
-          c-&gt;frame_size=1024; //For AAC mainly, sample per frame
-          printf(&quot;[LavFormat] Bitrate %u\n&quot;,(audioheader-&gt;byterate*8)/1000);
-          _audioFq=c-&gt;sample_rate = audioheader-&gt;frequency;
-#if 0
-           if(_type== MUXER_PSP &amp;&amp; audioheader-&gt;encoding==WAV_AAC)
-            {
-                    _audioFq=c-&gt;sample_rate = audioheader-&gt;frequency/2;                 //_audioFq*=2; // SBR
-             }
-#endif
-          
-          switch(audioheader-&gt;encoding)
-          {
-                  case WAV_AC3: c-&gt;codec_id = CODEC_ID_AC3;break;
-                  case WAV_MP2: c-&gt;codec_id = CODEC_ID_MP2;break;
-                  case WAV_MP3:
-  #warning FIXME : Probe deeper
-                              c-&gt;frame_size=1152;
-                              c-&gt;codec_id = CODEC_ID_MP3;
-                              break;
-                  case WAV_PCM: 
-                                  // One chunk is 10 ms (1/100 of fq)
-                                  c-&gt;frame_size=4;
-                                  c-&gt;codec_id = CODEC_ID_PCM_S16LE;break;
-                  case WAV_AAC: 
-                                  c-&gt;extradata=audioextraData;
-                                  c-&gt;extradata_size= audioextraSize;
-                                  c-&gt;codec_id = CODEC_ID_AAC;
-                                  break;
-                  default:
-                          if(_type==MUXER_MATROSKA)
-                          {
-                           if(ADM_WaveTag_to_lavcodec(audioheader-&gt;encoding, &amp;(c-&gt;codec_id)))
-                           {
-                             if(audioextraData)
-                             {
-                                  c-&gt;extradata=audioextraData;
-                                  c-&gt;extradata_size= audioextraSize;
-                             }
-                             // Put a dummy time increment
-                              c-&gt;time_base= fps25;
-                             break;
-                           }
-                          }
-                            
-                          printf(&quot;Cant mux that ! audio\n&quot;); 
-                          printf(&quot;Cant mux that ! audio\n&quot;);
-                          c-&gt;codec_id = CODEC_ID_MP2;
-                          return 0;
-                          break;
-          }
-          c-&gt;codec_type = CODEC_TYPE_AUDIO;
-          
-          c-&gt;bit_rate = audioheader-&gt;byterate*8;
-          c-&gt;rc_buffer_size=(c-&gt;bit_rate/(2*8)); // 500 ms worth
-          
-          c-&gt;channels = audioheader-&gt;channels;
-          _audioByterate=audioheader-&gt;byterate;
-          
-        }
-        // /audio
-	
-	
-//----------------------
-	switch(_type)
-	{
-				case MUXER_FLV:
-                case MUXER_PSP:
-                case MUXER_MP4:
-                case MUXER_MATROSKA:
-                        oc-&gt;mux_rate=10080*1000; // Needed ?
-                        break;
-
-                case MUXER_TS:
-                        oc-&gt;mux_rate=10080*1000;
-                        break;
-		case MUXER_DVD:
-			oc-&gt;packet_size=2048;
-			oc-&gt;mux_rate=10080*1000;
-			break;
-		case MUXER_VCD:
-			oc-&gt;packet_size=2324;
-			oc-&gt;mux_rate=2352 * 75 * 8;
-			
-			break;
-		case MUXER_SVCD:
-			
-			oc-&gt;packet_size=2324;
-			oc-&gt;mux_rate=2*2352 * 75 * 8; // ?
-			
-			break;
-		default:
-			ADM_assert(0);
-	}
-	oc-&gt;preload=AV_TIME_BASE/10; // 100 ms preloading
-	oc-&gt;max_delay=200*1000; // 500 ms
-	
-	if (av_set_parameters(oc, NULL) &lt; 0) 
-	{
-		printf(&quot;Lav: set param failed \n&quot;);
-		return 0;
-	}
-	 if (url_fopen(&amp;(oc-&gt;pb), filename, URL_WRONLY) &lt; 0) 
-	 {
-	 	printf(&quot;Lav: Failed to open file :%s\n&quot;,filename);
-		return 0;
-        }
-
-	ADM_assert(av_write_header(oc)&gt;=0);
-	dump_format(oc, 0, filename, 1);
-
-
-	printf(&quot;lavformat mpeg muxer initialized\n&quot;);
-	
-	_running=1;
-
-	one=(1000*1000*1000)/_fps1000; 
-	_curDTS=one;
-
-	return 1;
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::writeAudioPacket(uint32_t len, uint8_t *buf,uint32_t sample)
-{
-        
-        int ret;
-        AVPacket pkt;
-        double f;
-        int64_t timeInUs;
-
-            //printf(&quot;Audio paclet : size %u, sample %u\n&quot;,len,sample);
-        
-           if(!audio_st) return 0;
-           if(!len) return 1;
-            av_init_packet(&amp;pkt);
-
-            timeInUs=(int64_t)sample2time_us(sample);
-            /* Rescale to ?? */
-            if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
-            {
-            			f=timeInUs/1000;
-            			f=floor(f+0.4);
-            }
-            else
-            {
-            	f=timeInUs;
-            	f/=1000000.; // In ms seconds 
-            	f*=_audioFq;
-            	f=floor(f+0.4);
-            }
-            pkt.dts=pkt.pts=(int)(f);
-
-            //printf(&quot;F:%f Q:%u D=%u\n&quot;,f,pkt.pts,timeInUs-_lastAudioDts);
-            
-            pkt.flags |= PKT_FLAG_KEY; 
-            pkt.data= buf;
-            pkt.size= len;
-            pkt.stream_index=1;
-            //pkt.duration=pkt.dts-_lastAudioDts; // Duration
-            aprintf(&quot;A: sample: %d frame_pts: %d fq: %d\n&quot;,(int32_t )sample,(int32_t )pkt.dts,audio_st-&gt;codec-&gt;sample_rate); 
-
-            ret = av_write_frame(oc, &amp;pkt);
-            _lastAudioDts=timeInUs;
-            if(ret) 
-            {
-                        printf(&quot;Error writing audio packet\n&quot;);
-                        printf(&quot;pts %llu dts %llu\n&quot;,pkt.pts,pkt.dts);
-                        return 0;
-            }
-            return 1;
-}
-//________________________________________________________________________
-uint64_t  lavMuxer::sample2time_us( uint32_t sample )
-{
-double f;
-
-                f=sample;
-                f*=1000.*1000.;
-                f/=_audioFq;              // Sample / Frequency = time in seconds *10E6 to get in in us
-                
-                return (uint64_t)floor(f);
-
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::needAudio( void )
-{
-	
-        if(!audio_st) return 0;
-
-	double f;
-	uint64_t dts=_lastAudioDts;  // Last audio dts
-
-		
-		aprintf(&quot;Need audio  ?: %llu / %llu : %llu\n &quot;,dts,_curDTS,_curDTS+one);
-		if((dts+5000&gt;=_curDTS) &amp;&amp; (dts&lt;=_curDTS+one)) return 1;
-		if(dts&lt;=_curDTS)
-		{
-			printf(&quot;LavMuxer:Audio DTS is too low %llu / %llu!\n&quot;,dts,_curDTS);
-			return 1;
-		}
-		return 0;
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::writeVideoPacket(ADMBitstream *bitstream)
-{
-int ret;
-
-double p,d;
-  	AVPacket pkt;
-            av_init_packet(&amp;pkt);
-	    
-        p=bitstream-&gt;ptsFrame+1;      // Pts           // Time p/fps1000=out/den  out=p*den*1000/fps1000
-        p=(p*1000*1000*1000);
-        p=p/_fps1000;                  // in us
-	
-        d=bitstream-&gt;dtsFrame;		// dts
-	d=(d*1000*1000*1000);
-	d=d/_fps1000;
-	
-	
-	_curDTS=(int64_t)floor(d);	
-        
-        // Rescale
-#define RESCALE(x) x=x*video_st-&gt;codec-&gt;time_base.den*1000.;\
-                   x=x/_fps1000;
-        
-        p=bitstream-&gt;ptsFrame+1;
-        RESCALE(p);
-        
-        d=bitstream-&gt;dtsFrame;
-        RESCALE(d);
-        
-        if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
-        {
-        			p=p*1000/_fps1000;
-        			d=d*1000/_fps1000;
-        }
-    	pkt.dts=(int64_t)floor(d);
-    	pkt.pts=(int64_t)floor(p);
-
-       // printf(&quot;Lavformat : Pts :%u dts:%u&quot;,displayframe,frameno);
-	aprintf(&quot;Lavformat : Pts :%llu dts:%llu&quot;,pkt.pts,pkt.dts);
-	pkt.stream_index=0;
-           
-        pkt.data= bitstream-&gt;data;
-        pkt.size= bitstream-&gt;len;
-	// Look if it is a gop start or seq start
-        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
-        {
-            if(bitstream-&gt;flags &amp; AVI_KEY_FRAME) 
-                        pkt.flags |= PKT_FLAG_KEY;
-        }else
-            if(!bitstream-&gt;data[0] &amp;&amp;  !bitstream-&gt;data[1] &amp;&amp; bitstream-&gt;data[2]==1)
-	{
-            if(bitstream-&gt;data[3]==0xb3 || bitstream-&gt;data[3]==0xb8 ) // Seq start or gop start
-		pkt.flags |= PKT_FLAG_KEY;
-		//printf(&quot;Intra\n&quot;); 
-	}
-           
-	ret =av_write_frame(oc, &amp;pkt);
-	if(ret) 
-	{
-		printf(&quot;Error writing video packet\n&quot;);
-		return 0;
-	}
-        aprintf(&quot;V: frame %lu pts%d\n&quot;,bitstream-&gt;dtsFrame,pkt.pts);
-	
-	return 1;
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::forceRestamp(void)
-{
-	return 1;
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::close( void )
-{
-	if(_running)
-	{
-		_running=0;
-		// Flush
-		// Cause deadlock :
-		av_write_trailer(oc);
-		url_fclose(&amp;oc-&gt;pb);
-
-	}
-	if(audio_st)
-	{
-		 av_free(audio_st);
-	}
-	if(video_st)
-	{
-		 av_free(video_st);
-	}
-	video_st=NULL;
-	audio_st=NULL;
-	if(oc)
-		av_free(oc);
-	oc=NULL;
-	return 1;
-}
-//___________________________________________________________________________
-uint8_t lavMuxer::audioEmpty( void)
-{
-	return 0;
-}
-extern &quot;C&quot;
-{
-     extern  int        mpegps_init(void );
-     extern  int        movenc_init(void );
-     extern  int        flvenc_init(void );
-     extern  int        matroskaenc_init(void );
-};
-extern URLProtocol file_protocol ;
-uint8_t lavformat_init(void)
-{
-                movenc_init();
-                flvenc_init();
-                matroskaenc_init();
-                register_protocol(&amp;file_protocol);
-}
-extern &quot;C&quot;
-{
-/** 
-    \fn ADM_useAlternateTagging
-    \brief returns 1 if using haali compatible tagging, 0 if normal. For mp3 in mp4ff.
-*/
-int ADM_useAlternateTagging(void)
-{
-  uint32_t v=1;
-  prefs-&gt;get(FEATURE_ALTERNATE_MP3_TAG,&amp;v);
-  return v;
-} 
-}
-
-typedef struct
-{
-  const char *name;
-  int    id;
-}lavFCC_t;
-
-lavFCC_t lavFCC[]=
-{
-  {&quot;DIV3&quot;,CODEC_ID_MSMPEG4V3},
-  {&quot;FLV1&quot;,CODEC_ID_FLV1},
-  {&quot;MPEG&quot;,CODEC_ID_MPEG2VIDEO},
-  {&quot;DUMMY&quot;,0Xffff}
-};
-/**
-    \fn ADM_4cc_to_lavcodec
-    \brief Convert avi fourcc to lavcodec id (video)
-
-*/
-uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid)
-{
-    uint32_t nb=sizeof( lavFCC)/sizeof(lavFCC_t);
-    nb--;
-    for(int i=0;i&lt;nb;i++)
-    {
-      if(!strncmp(lavFCC[i].name,fcc,4))
-      {
-        *outlavid=(CodecID)lavFCC[i].id;
-        return 1; 
-      }
-      
-    }
-    return 0;
-  
-}
-//*****************
-typedef struct
-{
-  uint32_t tag;
-  int    id;
-}lavWaveTag_t;
-
-lavWaveTag_t lavWaveTag[]=
-{
-  {WAV_AC3,CODEC_ID_AC3},
-  {WAV_OGG,CODEC_ID_VORBIS},
-  {WAV_AAC,CODEC_ID_AAC},
-  {0xdead,0Xffff} // DUMMY
-};
-/**
-    \fn ADM_WaveTag_to_lavcodec
-    \brief Convert ADM audio codec id to lavcodec id (video)
-
-*/
-uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid)
-{
-    uint32_t nb=sizeof( lavWaveTag)/sizeof(lavWaveTag_t);
-    nb--;
-    for(int i=0;i&lt;nb;i++)
-    {
-      if(lavWaveTag[i].tag==tag)
-      {
-        *outlavid=(CodecID)lavWaveTag[i].id;
-        return 1; 
-      }
-      
-    }
-    return 0;
-  
-}
-
-//___________________________________________________________________________
-//EOF
-
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_lavformat.h	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,167 +0,0 @@
-//
-// C++ Interface: ADM_lavformat
-//
-// Description: 
-//
-//	iface to libavformat	
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-#ifndef ADM_LAVFORMAT_H
-#define ADM_LAVFORMAT_H
-#include &quot;ADM_bitstream.h&quot;
-typedef enum
-{
-        MUXER_NONE=0,
-        MUXER_DVD,
-		MUXER_VCD,
-		MUXER_SVCD,
-        MUXER_TS,
-        MUXER_MP4,
-        MUXER_PSP,
-        MUXER_FLV,
-        MUXER_MATROSKA,
-        MUXER_DUMMY
-}ADM_MUXER_TYPE;
-
-
-class ADMMpegMuxer
-{
-protected:
-                uint32_t _frameNo;
-                uint32_t _fps1000;
-                uint32_t _audioByterate;
-                uint32_t _audioFq;
-                uint32_t _total; // deprecated, only for muxts
-                uint64_t _lastAudioDts;
-                uint32_t _running;
-                ADM_MUXER_TYPE _type;
-                uint8_t  _restamp;
-                ADM_MUXER_TYPE _muxerType;
-
-public:
-        virtual uint8_t open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, 
-                                aviInfo *info, WAVHeader *audioheader)=0;
-        virtual uint8_t writeAudioPacket(uint32_t len, uint8_t *buf)=0;
-        virtual uint8_t writeVideoPacket(ADMBitstream *bitstream )=0;
-        virtual uint8_t forceRestamp(void)=0;
-        virtual uint8_t close( void )=0;
-        virtual uint8_t audioEmpty( void)=0;
-        virtual uint8_t needAudio(void)=0;
-        virtual uint8_t audioEof(void) {return 1;}
-
-                ADMMpegMuxer(void) {};
-                virtual ~ADMMpegMuxer(void) {};
-
-};
-class lavMuxer : public ADMMpegMuxer
-{
-private:
-                uint64_t  sample2time_us( uint32_t sample );
-		
-
-public:
-		lavMuxer(void );
-		~lavMuxer(  );
-	virtual uint8_t open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader);
-        virtual uint8_t open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info,uint32_t videoExtraDataSize,
-                        uint8_t *videoExtraData, WAVHeader *audioheader,uint32_t audioextraSize,uint8_t *audioextraData);
-        
-        virtual uint8_t writeAudioPacket(uint32_t len, uint8_t *buf,uint32_t sample);
-        virtual uint8_t writeAudioPacket(uint32_t len, uint8_t *buf) { ADM_assert(0);return 1;}
-        virtual uint8_t writeVideoPacket(ADMBitstream *bitstream );
-        virtual uint8_t forceRestamp(void);
-        virtual uint8_t close( void );
-        virtual uint8_t audioEmpty( void);
-        virtual uint8_t needAudio(void);
-
-	
-
-};
-
-class mplexMuxer : public ADMMpegMuxer
-{
-protected:
-               
-public:
-                mplexMuxer(void );
-                ~mplexMuxer(  );
-        virtual uint8_t open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader);
-        virtual uint8_t writeVideoPacket(ADMBitstream *bitstream );
-        virtual uint8_t writeAudioPacket(uint32_t len, uint8_t *buf);
-        virtual uint8_t forceRestamp(void);
-        virtual uint8_t close( void );
-        virtual uint8_t audioEmpty( void);
-        virtual uint8_t needAudio(void);
-        virtual uint8_t audioEof(void);
-        virtual uint8_t videoEof(void);
-
-};
-#define TS_PACKET_SIZE 188
-
-typedef struct
-{
-    uint64_t pts;
-    uint8_t  packet[TS_PACKET_SIZE];
-}entryPacket;
-
-typedef struct
-{
-    uint32_t pid;
-    uint32_t counter;
-    uint32_t tableId;
-    uint32_t sectionId;
-}channel;
-
-class tsMuxer : public ADMMpegMuxer
-{
-protected:
-        uint32_t    audioPacket;
-        entryPacket *packetPipe;
-        uint32_t    packetHead,packetTail;
-        FILE        *outFile;     
-        uint32_t    audioPid,videoPid;
-        uint32_t    _curPTS;
-        uint32_t    nbPacket;
-        uint32_t    packetSincePAT;
-        uint64_t    lastPCR;
-        uint8_t     *audioBuffer;
-        uint32_t    audioFill;
-        uint8_t     *pesBuffer;
-        
-        entryPacket *getPacket( void);   
-        uint8_t     writeSection( uint32_t pid,channel *chan, 
-                                uint8_t *data, uint32_t len) ;
-        uint8_t     writePmt( void); 
-        uint8_t     writePat( void);                       
-        uint8_t     writePacket(uint8_t *data, uint32_t len, uint64_t pcr,channel *chan,uint8_t start);
-        uint8_t     writePacketPad(uint8_t *data, uint32_t len, uint64_t pcr,channel *chan,uint8_t start);
-        uint64_t    audioTime( uint32_t time)   ;            // Time is us
-        uint64_t    videoTime( uint32_t frameno);   // Time in us                    
-        uint8_t     flushPackets(uint8_t r);
-        uint8_t     writeAudioPacket2(void);
-        uint8_t     pes2ts(channel *chan,uint64_t pcr,uint8_t tim );
-        uint8_t     writeVideoPacket2(uint32_t len, uint8_t *buf,uint32_t frameno,uint32_t displayframe );
-        channel     audioChannel,videoChannel,pmt,pat;
-        aviInfo     _info;
-        WAVHeader   _wavHeader;
-             
-public:
-                tsMuxer(void );
-                ~tsMuxer(  );
-        virtual uint8_t open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader);
-        virtual uint8_t writeVideoPacket(ADMBitstream *bitstream );
-        virtual uint8_t writeAudioPacket(uint32_t len, uint8_t *buf);
-        virtual uint8_t forceRestamp(void);
-        virtual uint8_t close( void );
-        virtual uint8_t audioEmpty( void);
-        virtual uint8_t needAudio(void);
-
-};
-#endif
-//EOF
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_muxts.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_muxts.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_muxts.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,708 +0,0 @@
-//
-// C++ Implementation: ADM_lavformat
-//
-// Description: 
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;math.h&gt;
-#include &lt;string.h&gt;
-
-
-#include &quot;ADM_assert.h&quot;
-
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
-#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
-#include &quot;ADM_audio/ADM_a52info.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_editor/ADM_Video.h&quot;
-
-#include &quot;ADM_lavformat.h&quot;
-
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_LAVFORMAT
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_tscrc.h&quot;
-
-
-#define TS_NB_PACKET   1000
-
-#define PAT_PID         0
-#define PMT_PID         0x42
-#define AUDIO_PID       0x45
-#define VIDEO_PID       0x44
-
-#define TS_HEADER_LEN 4
-
-#define TS_UNIT_START        0x40
-#define TS_UNIT_PAYLOAD_ONLY 0x10
-#define TS_UNIT_PAYLOAD_AF   0x30
-// 33 bits 
-#define TS_PCR_MASK             0x0000003FFFFFFFFFLL
-#define TS_NO_PCR               0xFF00000000000000LL
-#define TS_PAT_EVERY_PACKET     256
-#define TS_MUX_RATE             10000000        // 10 Mbs
-
-#define AUDIO_BUFFER            1024*10
-#define PES_BUFFER              1024            // Just to build packet into
-#define STUFFING_PATTERN        0
-#define MUX_EVERY_N_AUDIO_FRAMES 5
-static uint8_t writePts(uint8_t *data,uint64_t ipts,uint32_t flags);
-// /* ------------------------------------------------------------------------*/write
-tsMuxer::tsMuxer( void)
-{
-    packetPipe=new entryPacket[TS_NB_PACKET];
-    memset(packetPipe,0,sizeof(entryPacket)*TS_NB_PACKET);
-    packetHead=packetTail=0;
-    
-    audioChannel.pid=AUDIO_PID;
-    audioChannel.counter=0;
-    
-    videoChannel.pid=VIDEO_PID;
-    videoChannel.counter=0;
-    
-    pat.pid=PAT_PID;
-    pat.counter=0;
-    pat.tableId=0;
-    pat.sectionId=0;
-    
-    pmt.pid=PMT_PID;
-    pmt.counter=0;
-    pmt.tableId=2;
-    pmt.sectionId=1;
-    
-    _total=0;
-    _curPTS=0;
-    
-    packetSincePAT=0;
-    nbPacket=0;
-    lastPCR=0;
-    audioFill=0;
-    audioBuffer=new uint8_t[AUDIO_BUFFER];
-    pesBuffer=new uint8_t [PES_BUFFER];
-    audioPacket=0;
-}
-tsMuxer::~tsMuxer( )
-{
-   if(packetPipe)
-    delete [] packetPipe;
-   packetPipe=NULL;
-   if(audioBuffer)
-        delete [] audioBuffer;
-   audioBuffer=NULL;
-   if(pesBuffer)
-        delete [] pesBuffer;
-   pesBuffer=NULL;
-
-}
-//
-// Flush out of data packets
-// update pcr on the fly with non stupid value
-//
-uint8_t tsMuxer::flushPackets(uint8_t really)
-{
-double dpcr;    // delta PCR
-uint64_t pcr,packetpcr;
-entryPacket *entry;
-        
-        dpcr=TS_PACKET_SIZE*8;
-        dpcr/=TS_MUX_RATE;      
-        dpcr=dpcr*1000*1000;        // duration of a packet in us
-        pcr=(uint64_t )dpcr;
-        while(1)
-        {
-            if(packetHead==packetTail) break; // no more packet to handle
-            entry=&amp;(packetPipe[packetHead]);
-#if 0            
-            if(entry-&gt;pts!=TS_NO_PCR)
-            {
-                if(entry-&gt;pts&gt;=_curPTS) _curPTS=entry-&gt;pts;
-                    else
-                {
-                    // need to update
-                    uint32_t i=4;
-                    uint64_t fixed;
-                    uint8_t *pkt=entry-&gt;packet;
-                    
-                    fixed=_curPTS;
-                     //mask to avoid overflow
-                    fixed=(fixed*90)/1000;
-                    fixed=fixed&amp;0x1FFFFFFFFLL; // 33 Bits
-                    pkt[i++]=7;
-                    pkt[i++]=0x10; // AF flags       
-                    pkt[i++]=(fixed&gt;&gt;25)&amp;0xff; // FF
-                    pkt[i++]=(fixed&gt;&gt;17)&amp;0xff; // FF
-                    pkt[i++]=(fixed&gt;&gt;9)&amp;0xff; // FF
-                    pkt[i++]=(fixed&gt;&gt;1)&amp;0xff; // FF
-                    pkt[i++]=(fixed&lt;&lt;7)&amp;0x80; // &amp;0x80
-                    pkt[i++]=0x00;
-                }
-            }
-#endif            
-           // _curPTS+=pcr;
-            fwrite(entry-&gt;packet,TS_PACKET_SIZE,1,outFile);
-            packetHead++;
-            packetHead%=TS_NB_PACKET;
-        }
-        return 1;
-}
-/*
-sync_byte 8 bslbf 
-transport_error_indicator 1 bslbf       1: Error present
-payload_unit_start_indicator 1 bslbf    If 1 a unit start in this packet, there is an offset later
-transport_priority 1 bslbf              x
-PID 13 uimsbf 
-transport_scrambling_control 2 bslbf  00 not scrambled
-adaptation_field_control 2 bslbf      00 01:Payload only 10:adap only 11: payload + adap
-continuity_counter 4 uimsbf 
-if(adaptation_field_control=='10' || adaptation_field_control=='11
-'){ adaptation_field() }
-if(adaptation_field_control=='01' || adaptation_field_control=='11') 
-{ for (i=0;i&lt;N;i++){ data_byte 8 bslbf } } } bslbf Bit string, 
-
-pcr is pts in us
-*/
-uint8_t     tsMuxer::writePacket(uint8_t *data, uint32_t len, uint64_t pcr,channel *chan,uint8_t start)
-{
-
-uint32_t i=0,val=0,fill=0,fre;
-entryPacket *paket;
-uint8_t *pkt;
-
-    if(start)
-      if(((packetTail+TS_NB_PACKET-packetHead)%TS_NB_PACKET)&gt;TS_NB_PACKET/4)
-      {  
-            flushPackets(0);    
-      }
-     
-    //ADM_assert(len&lt;TS_PACKET_SIZE-3);
-    if(!packetSincePAT)
-    {
-        packetSincePAT++;
-        writePat();
-        writePmt();
-    }
-    else
-        packetSincePAT++;
-    packetSincePAT%=TS_PAT_EVERY_PACKET;
-    
-    //
-    paket=getPacket();
-    paket-&gt;pts=pcr;
-    pkt=paket-&gt;packet;
-
-    // Here we go
-
-        // Will we fill the packet
-        fre=TS_PACKET_SIZE-TS_HEADER_LEN;
-        if(start)       fre--;  // offset
-        if(pcr!=TS_NO_PCR) fre-=8;
-        if(len&lt;fre) // We won't fill the packet
-        {
-                fill=fre-len;
-        }
-
-    pkt[i++]=0x47;
-    if(start) val=TS_UNIT_START; // Start ?
-            else val=0;
-    pkt[i++]=val+((chan-&gt;pid)&gt;&gt;8);
-    pkt[i++]=(chan-&gt;pid)&amp;0xff;
-   
-    if(pcr!=TS_NO_PCR || fill)
-        val=TS_UNIT_PAYLOAD_AF;     // if me put a pcr, we need to say there is
-                                    // an adaption field
-    else
-        val=TS_UNIT_PAYLOAD_ONLY;
-    pkt[i++]=val+(chan-&gt;counter&amp;0xf);  // Payload only
-    chan-&gt;counter++;
-    if(pcr!=TS_NO_PCR || fill)
-    {
-        if(pcr!=TS_NO_PCR)
-        {
-        
-                pcr=(pcr*90)/1000;
-                pcr=pcr&amp;0x1FFFFFFFFLL; //mask to avoid overflow
-                pkt[i++]=7+fill;
-                pkt[i++]=0x10; // AF flags
-        
-                pkt[i++]=(pcr&gt;&gt;25)&amp;0xff; // FF
-                pkt[i++]=(pcr&gt;&gt;17)&amp;0xff; // FF
-                pkt[i++]=(pcr&gt;&gt;9)&amp;0xff; // FF
-                pkt[i++]=(pcr&gt;&gt;1)&amp;0xff; // FF
-                pkt[i++]=(pcr&lt;&lt;7)&amp;0x80; // &amp;0x80
-                pkt[i++]=0x00;
-                if(fill)
-                {
-                        memset(pkt+i,0xff,fill);        
-                        i+=fill;
-                }
-        }
-        else
-        {
-                pkt[i++]=fill-1;
-                switch(fill)
-                {
-                        case 1: break;
-                        case 2: pkt[i++]=0;
-                                break;
-                        default:
-                                pkt[i++]=0;
-                                memset(pkt+i,0xff,fill-2);   
-                                i+=fill-2;
-                                break;
-                }
-        }
-     }
-
-    
-    if(start) pkt[i++]=0; // pointer field
-    uint32_t left=TS_PACKET_SIZE-i;
-    ADM_assert(len&gt;=left);
-    memcpy(pkt+i,data,left);
-    return left;
-}
-
-uint32_t mpegTsCRC(uint8_t *data, uint32_t len)
-{
-    int i;
-    uint32_t crc = 0xffffffff;
-    
-    for (i=0; i&lt;len; i++)
-        crc = (crc &lt;&lt; 8) ^ crc_table[((crc &gt;&gt; 24) ^ *data++) &amp; 0xff];
-    
-    return crc;
-}
-/*****************************/
-entryPacket *tsMuxer::getPacket( void)
-{
- 
- entryPacket *r=&amp;packetPipe[packetTail++];
- packetTail%=TS_NB_PACKET;
- ADM_assert(packetTail!=packetHead);
- return r;   
-}
-
-uint8_t tsMuxer::open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader)
-{
-    ADM_assert(type==MUXER_TS);
-    outFile=fopen(filename,&quot;wb&quot;);
-    if(!outFile)
-    {
-        printf(&quot;TS:Cannot open for write\n&quot;);
-        return 0; 
-    }
-    memcpy(&amp;_info,info,sizeof(_info));
-    memcpy(&amp;_wavHeader,audioheader,sizeof(_wavHeader));
-    
-    return 1;
-}
-uint8_t tsMuxer::close( void)
-{
-    flushPackets(1);    
-    if(outFile) fclose(outFile);
-    outFile=NULL;
-    return 1;
-}
-uint8_t tsMuxer::forceRestamp(void)
-{
-    return 1;
-}
-uint8_t tsMuxer::audioEmpty( void)
-{
-    return 0;
-}
-uint8_t tsMuxer::needAudio(void)
-{
-	
-    double f;
-    uint64_t pts;
-    // all computation is in us
-    uint32_t one=(1000*1000*1000)/_info.fps1000;
-    
-            pts=audioTime(audioFill);
-            aprintf(&quot;Need audio  ?: %llu / %llu : %llu\n &quot;,pts,_curPTS,_curPTS+one);
-            if((pts&gt;=_curPTS) &amp;&amp; (pts&lt;=_curPTS+one)) return 1;
-            if(pts&lt;=_curPTS)
-            {
-                    printf(&quot;tsMuxer:Audio DTS is too low %llu / %llu!\n&quot;,pts,_curPTS);
-                    return 1;
-            }
-            return 0;
-}
-/*
-    Write the program Access Table
-    In our case it is pretty simple as we have one video and one audio
-    in one PMT
-    We assume it fits in one TS packet
-
-    8 :Table id
-    1 :Section syntax indicator (1 for PAT)
-    1: 0
-    2: 11
-    12: length
-    16: Transport ID
-    2 : 11
-    5: Version number
-    1: current next indicator
-    8 : : section number
-    8:last section number
-        8: Program number
-        3: 111
-        13: Nit pid
-    32 : CRC    
-*/
-uint8_t tsMuxer::writeSection( uint32_t pid,channel *chan, 
-                                uint8_t *data, uint32_t len)
-{
-    uint8_t packet[1024];
-    uint32_t i=0,sectionLen=0,crc;
-    
-    sectionLen=len+4+5; // Includes header &amp; crc
-    
-    packet[i++]=chan-&gt;tableId;
-    packet[i++]=0xb0+(sectionLen&gt;&gt;8);
-    packet[i++]=0x00+(sectionLen&amp;0xff);
-    packet[i++]=chan-&gt;sectionId&gt;&gt;8;     // For PMT: Program number
-    packet[i++]=chan-&gt;sectionId&amp;0xff;
-    packet[i++]=0xc1;   // Table is applicable
-    packet[i++]=0;      // section  number
-    packet[i++]=0;      // last section number
-    
-    memcpy(packet+i,data,len);
-    i+=len;
-    //ADM_assert(len&lt;TS_PACKET_SIZE-3);
-    // and CRC
-    crc= mpegTsCRC(packet,i);
-    packet[i++]=(crc&gt;&gt;24)&amp;0xff;
-    packet[i++]=(crc&gt;&gt;16)&amp;0xff;
-    packet[i++]=(crc&gt;&gt;8)&amp;0xff;
-    packet[i++]=(crc    )&amp;0xff;
-   
-  //  writePacket(packet,i,NO_PCR);
-    writePacket(packet, i, TS_NO_PCR,chan,1);
-    return 1;
-}
-uint8_t tsMuxer::writePat( void)
-{
-uint8_t data[1024];
-uint32_t i=0,sid=1;
-
-        sid=pmt.sectionId;
-        data[i++]=sid&gt;&gt;8;                
-        data[i++]=sid&amp;0xff;                        
-        data[i++]=0xe0+((pmt.pid)&gt;&gt;8);                
-        data[i++]=(pmt.pid)&amp;0xff;    
-        return writeSection(pat.pid,&amp;pat,data,4);                    
-                                
-}   
-uint8_t tsMuxer::writePmt( void)
-{
-uint8_t data[1024];
-uint32_t i=0,sid=1;
-
-        data[i++]=0xE0+(videoChannel.pid&gt;&gt;8);  // PCR pid locked on audio             
-        data[i++]=videoChannel.pid&amp;0xff;       //                 
-        data[i++]=0xf0;  // info length              
-        data[i++]=0;  // info length   
-        //-- Video --
-        data[i++]=0x02; // Mpeg2 video
-        data[i++]=0xE0+(videoChannel.pid&gt;&gt;8); // pid
-        data[i++]=(videoChannel.pid&amp;0xff); 
-        data[i++]=0xF0; // no descriptor
-        data[i++]=3;    // Stream descriptor
-        data[i++]=0x52;    
-        data[i++]=1;    
-        data[i++]=1;    
-        //-- Audio --
-        if(_wavHeader.encoding==WAV_AC3)
-            data[i++]=0x81; // ac3
-        else
-            data[i++]=0x03; // Mpeg2 audio
-        data[i++]=0xE0+(audioChannel.pid&gt;&gt;8); // pid
-        data[i++]=(audioChannel.pid&amp;0xff); 
-        data[i++]=0xF0; // no descriptor
-        data[i++]=3+6;    // Stream descriptor
-        data[i++]=0x52;    
-        data[i++]=1;    
-        data[i++]=2;    
-        data[i++]=0x0a; // Language    
-        data[i++]=4;    
-        data[i++]='e';    
-        data[i++]='n';    
-        data[i++]='g';    
-        data[i++]=0x02;     // Hearing impaired ?
-        
-        
-/*        data[2]=0xF0+((i-4)&gt;&gt;8);
-        data[3]=((i-4)&amp;0xff);
-*/        
-        return writeSection(pmt.pid,&amp;pmt,data,i);                          
-                                
-} 
-uint8_t tsMuxer::pes2ts(channel *chan,uint64_t pcr,uint8_t tim )
-{
-        uint32_t part=0,l;
-        uint32_t out=PES_BUFFER;
-        uint8_t *data=pesBuffer;
-        while(out)
-        {
-                if(!part &amp;&amp; tim)
-                {
-                        l=writePacket(data,out,pcr,chan,1);
-                }
-                else
-                        l=writePacket(data,out,TS_NO_PCR,chan,0);
-                out-=l;
-                data+=l;
-                part++;
-        }
-        return 1;
-}
-uint8_t tsMuxer::writeVideoPacket(ADMBitstream *bitstream )
-{
-#define MAX_PES 64000
-uint32_t l,len;
-uint8_t *buf;
-
-       //writeAudioPacket2();
-       _curPTS=videoTime(bitstream-&gt;dtsFrame); 
-       len=bitstream-&gt;len;
-       buf=bitstream-&gt;data;
-       while(len)
-       {
-                if(len&gt;MAX_PES)
-                        l=MAX_PES;
-                else
-                    l=len;
-                if(!writeVideoPacket2(l,buf, bitstream-&gt;dtsFrame, bitstream-&gt;ptsFrame ))
-                {
-                    return 0;    
-                }
-                len-=l;
-                buf+=l;
-        }
-        return 1;
-
-}                                  
-uint8_t tsMuxer::writeVideoPacket2(uint32_t len, uint8_t *buf,uint32_t frameno,uint32_t displayframe )
-{
-    
-    uint8_t  *data;
-    uint32_t pes_len;
-    uint64_t its;
-    double d;
-    uint32_t left,part=1;
-    
-//#define IGNORE_PTS
-        
-#ifdef IGNORE_PTS
-        displayframe=frameno+1;
-#endif    
-
-    // First packet    
-    while(len)
-    {
-            
-            // we build header &amp; pts separately
-            //
-            uint32_t i=0,left;
-            data=pesBuffer;
-            if(part)
-            {
-            
-                //data[i++]=0x00;
-                data[i++]=0x00;
-                data[i++]=0x01;
-                data[i++]=0xe0;   // video id
-                pes_len=len+3+10;  // PES header
-                data[i++]=pes_len&gt;&gt;8;
-                data[i++]=pes_len &amp; 0xff;
-                data[i++]=0x80; // mpeg2
-           
-                data[i++]=0x80+0x40; // PTS + dts
-                data[i++]=10;    // PTS LEN
-            
-                // pts
-                
-                its=videoTime(displayframe);
-                writePts(data+i,its,3);
-                data[i]|=0x10;
-                i+=5;
-                // dts
-                its=videoTime(frameno);
-                writePts(data+i,its,1);
-                i+=5;                
-
-                left=TS_PACKET_SIZE-i;
-                if(left&gt;len)
-                {
-                      left=len;
-
-                }
-                memcpy(data+i,buf,left);                      
-                left=writePacket(data, i+len, its,&amp;videoChannel,1);
-                left=left-i;
-            }
-            else
-            {
-                left=writePacket(buf, len, TS_NO_PCR,&amp;videoChannel,0);
-            }
-
-            buf+=left;
-            len-=left;                   
-            part=0;
-     }    
-    return 1;
-}
-/* Return time elapsed for video in us */
-uint64_t tsMuxer::videoTime( uint32_t frameno)
-{
-double d;
-uint64_t p;
-    d=frameno;		// dts
-    d=(d*1000*1000*1000);
-    d=d/_info.fps1000; // in usec
-    
-    p= (uint64_t)floor(d);
-   
-    return p;
-}    
-/* Return time elapsed for audio in us */
-uint64_t tsMuxer::audioTime( uint32_t fill)
-{
-double f;
-uint64_t d;
-    f=_total+fill;
-     f*=1000.*1000.;  // in us
-     f/=(_wavHeader.byterate);   
-     d= (uint64_t)floor(f);
-     
-     return d;
-}
-uint8_t tsMuxer::writeAudioPacket(uint32_t len, uint8_t *buf)
-{
-        memcpy(audioBuffer+audioFill,buf,len);
-        audioFill+=len;
-        audioPacket++;
-        ADM_assert(audioFill&lt;AUDIO_BUFFER);
-        if(audioPacket&gt;=MUX_EVERY_N_AUDIO_FRAMES)
-        {
-                writeAudioPacket2();
-                audioPacket%=MUX_EVERY_N_AUDIO_FRAMES;
-        }
-        return 1;        
-}
-uint8_t tsMuxer::writeAudioPacket2(void)
-{
-    uint32_t part=1;
-    uint8_t  *data; // should be enough for one frame...    
-    uint64_t ipts;   
-    uint32_t left,pes_len;
-    uint8_t  *buf=audioBuffer;
-    uint32_t len=audioFill,org=audioFill;    
-    uint64_t its;
-
-    if(!audioFill) return 1; // nothing to do
-
-
-     while(len)
-    {
-            
-            // we build header &amp; pts separately
-            //
-            uint32_t i=0,left;
-            data=pesBuffer;
-            if(part)
-            {
-            
-                //data[i++]=0x00;
-                data[i++]=0x00;
-                data[i++]=0x01;
-               // data[i++]=0xc0;   // video id
-                if(_wavHeader.encoding==WAV_AC3)
-                {
-                        data[i++]=0xbd;   // audio id
-                }
-                else
-                        data[i++]=0xc0;   // audio id
-
-                pes_len=len+3+5;  // PES header
-                data[i++]=pes_len&gt;&gt;8;
-                data[i++]=pes_len &amp; 0xff;
-                data[i++]=0x80; // mpeg2            
-                data[i++]=0x80; // PTS 
-                data[i++]=5;    // PTS LEN
-            
-                // pts
-                its=audioTime(0);
-                writePts(data+i,its,2);
-                i+=5;                             
-            
-                left=TS_PACKET_SIZE-i;
-                if(left&gt;len)
-                {
-                      left=len;
-
-                }
-                memcpy(data+i,buf,left);                      
-                left=writePacket(data, i+len, its,&amp;audioChannel,1);
-                left=left-i;
-            }
-            else
-            {
-                left=writePacket(buf, len, TS_NO_PCR,&amp;audioChannel,0);
-            }
-
-            buf+=left;
-            len-=left;                   
-            part=0;
-     }    
-   
-     audioFill=0;
-     _total+=org;
-     return 1;
-}
-/*
-    ipts is is us
-*/
-/*
-        flags : PTS only = 2 PTS+DTS=3 DTS=1
-
-*/
-uint8_t writePts(uint8_t *data,uint64_t ipts,uint32_t flags)
-{
-uint32_t i=0;
-uint64_t p;
-            ipts=ipts&amp;0xfffffffffLL; // clip to 36 bits 33 bits *8 before clipping
-            ipts=(ipts*90)/1000;
-            
-            data[i++]=(flags &lt;&lt; 4) | (((ipts &gt;&gt; 30) &amp; 0x07) &lt;&lt; 1) | 1;
-            p=(((ipts &gt;&gt; 15) &amp; 0x7fff) &lt;&lt; 1) | 1;
-            data[i++]=p&gt;&gt;8;
-            data[i++]=p&amp;0xff;
-            p=(((ipts) &amp; 0x7fff) &lt;&lt; 1) | 1;
-            data[i++]=p&gt;&gt;8;
-            data[i++]=p&amp;0xff;
-}
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_tscrc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_tscrc.h	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/ADM_tscrc.h	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,45 +0,0 @@
-static const uint32_t crc_table[256] = {
-	0x00000000, 0x04c11db7, 0x09823b6e, 0x0d4326d9, 0x130476dc, 0x17c56b6b,
-	0x1a864db2, 0x1e475005, 0x2608edb8, 0x22c9f00f, 0x2f8ad6d6, 0x2b4bcb61,
-	0x350c9b64, 0x31cd86d3, 0x3c8ea00a, 0x384fbdbd, 0x4c11db70, 0x48d0c6c7,
-	0x4593e01e, 0x4152fda9, 0x5f15adac, 0x5bd4b01b, 0x569796c2, 0x52568b75,
-	0x6a1936c8, 0x6ed82b7f, 0x639b0da6, 0x675a1011, 0x791d4014, 0x7ddc5da3,
-	0x709f7b7a, 0x745e66cd, 0x9823b6e0, 0x9ce2ab57, 0x91a18d8e, 0x95609039,
-	0x8b27c03c, 0x8fe6dd8b, 0x82a5fb52, 0x8664e6e5, 0xbe2b5b58, 0xbaea46ef,
-	0xb7a96036, 0xb3687d81, 0xad2f2d84, 0xa9ee3033, 0xa4ad16ea, 0xa06c0b5d,
-	0xd4326d90, 0xd0f37027, 0xddb056fe, 0xd9714b49, 0xc7361b4c, 0xc3f706fb,
-	0xceb42022, 0xca753d95, 0xf23a8028, 0xf6fb9d9f, 0xfbb8bb46, 0xff79a6f1,
-	0xe13ef6f4, 0xe5ffeb43, 0xe8bccd9a, 0xec7dd02d, 0x34867077, 0x30476dc0,
-	0x3d044b19, 0x39c556ae, 0x278206ab, 0x23431b1c, 0x2e003dc5, 0x2ac12072,
-	0x128e9dcf, 0x164f8078, 0x1b0ca6a1, 0x1fcdbb16, 0x018aeb13, 0x054bf6a4,
-	0x0808d07d, 0x0cc9cdca, 0x7897ab07, 0x7c56b6b0, 0x71159069, 0x75d48dde,
-	0x6b93dddb, 0x6f52c06c, 0x6211e6b5, 0x66d0fb02, 0x5e9f46bf, 0x5a5e5b08,
-	0x571d7dd1, 0x53dc6066, 0x4d9b3063, 0x495a2dd4, 0x44190b0d, 0x40d816ba,
-	0xaca5c697, 0xa864db20, 0xa527fdf9, 0xa1e6e04e, 0xbfa1b04b, 0xbb60adfc,
-	0xb6238b25, 0xb2e29692, 0x8aad2b2f, 0x8e6c3698, 0x832f1041, 0x87ee0df6,
-	0x99a95df3, 0x9d684044, 0x902b669d, 0x94ea7b2a, 0xe0b41de7, 0xe4750050,
-	0xe9362689, 0xedf73b3e, 0xf3b06b3b, 0xf771768c, 0xfa325055, 0xfef34de2,
-	0xc6bcf05f, 0xc27dede8, 0xcf3ecb31, 0xcbffd686, 0xd5b88683, 0xd1799b34,
-	0xdc3abded, 0xd8fba05a, 0x690ce0ee, 0x6dcdfd59, 0x608edb80, 0x644fc637,
-	0x7a089632, 0x7ec98b85, 0x738aad5c, 0x774bb0eb, 0x4f040d56, 0x4bc510e1,
-	0x46863638, 0x42472b8f, 0x5c007b8a, 0x58c1663d, 0x558240e4, 0x51435d53,
-	0x251d3b9e, 0x21dc2629, 0x2c9f00f0, 0x285e1d47, 0x36194d42, 0x32d850f5,
-	0x3f9b762c, 0x3b5a6b9b, 0x0315d626, 0x07d4cb91, 0x0a97ed48, 0x0e56f0ff,
-	0x1011a0fa, 0x14d0bd4d, 0x19939b94, 0x1d528623, 0xf12f560e, 0xf5ee4bb9,
-	0xf8ad6d60, 0xfc6c70d7, 0xe22b20d2, 0xe6ea3d65, 0xeba91bbc, 0xef68060b,
-	0xd727bbb6, 0xd3e6a601, 0xdea580d8, 0xda649d6f, 0xc423cd6a, 0xc0e2d0dd,
-	0xcda1f604, 0xc960ebb3, 0xbd3e8d7e, 0xb9ff90c9, 0xb4bcb610, 0xb07daba7,
-	0xae3afba2, 0xaafbe615, 0xa7b8c0cc, 0xa379dd7b, 0x9b3660c6, 0x9ff77d71,
-	0x92b45ba8, 0x9675461f, 0x8832161a, 0x8cf30bad, 0x81b02d74, 0x857130c3,
-	0x5d8a9099, 0x594b8d2e, 0x5408abf7, 0x50c9b640, 0x4e8ee645, 0x4a4ffbf2,
-	0x470cdd2b, 0x43cdc09c, 0x7b827d21, 0x7f436096, 0x7200464f, 0x76c15bf8,
-	0x68860bfd, 0x6c47164a, 0x61043093, 0x65c52d24, 0x119b4be9, 0x155a565e,
-	0x18197087, 0x1cd86d30, 0x029f3d35, 0x065e2082, 0x0b1d065b, 0x0fdc1bec,
-	0x3793a651, 0x3352bbe6, 0x3e119d3f, 0x3ad08088, 0x2497d08d, 0x2056cd3a,
-	0x2d15ebe3, 0x29d4f654, 0xc5a92679, 0xc1683bce, 0xcc2b1d17, 0xc8ea00a0,
-	0xd6ad50a5, 0xd26c4d12, 0xdf2f6bcb, 0xdbee767c, 0xe3a1cbc1, 0xe760d676,
-	0xea23f0af, 0xeee2ed18, 0xf0a5bd1d, 0xf464a0aa, 0xf9278673, 0xfde69bc4,
-	0x89b8fd09, 0x8d79e0be, 0x803ac667, 0x84fbdbd0, 0x9abc8bd5, 0x9e7d9662,
-	0x933eb0bb, 0x97ffad0c, 0xafb010b1, 0xab710d06, 0xa6322bdf, 0xa2f33668,
-	0xbcb4666d, 0xb8757bda, 0xb5365d03, 0xb1f740b4
-};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,14 +1,13 @@
-SET(ADM_LIB ADM_lavformat)
+SET(ADM_LIB ADM_libavformat)
 
 SET(${ADM_LIB}_SRCS 
-	mpeg.c utils.c avio.c ADM_lavformat.cpp 
-	aviobuf.c cutils.c img2.c file.c mpegtsenc.c ADM_muxts.cpp movenc.c 
-	avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c
-	flvenc.c matroskaenc.c)
+	mpeg.c  utils.c  avio.c  aviobuf.c  cutils.c  img2.c  file.c  mpegtsenc.c
+	movenc.c  avienc.c  wav.c  mov.c  matroska.c  isom.c  isom.h  riff.c
+	flvenc.c  matroskaenc.c)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I../ADM_lavcodec -I../ADM_lavutil -DHAVE_AV_CONFIG_H -include ffconf.h&quot;)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I../ADM_lavcodec -I../ADM_lavutil -DHAVE_AV_CONFIG_H&quot;)
 
-INCLUDE(admLibFfmpeg)
-GET_FFMPEG_CFLAGS(FFMPEG_CFLAGS)
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${FFMPEG_CFLAGS}&quot;)
\ No newline at end of file
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core ADM_libavutil ADM_libavcodec)
+
+INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/movenc.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/movenc.c	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat/movenc.c	2008-03-15 15:52:19 UTC (rev 3895)
@@ -270,7 +270,8 @@
   //MEANX  put_byte(pb, codec_get_tag(ff_mp4_obj_type, track-&gt;enc-&gt;codec_id));
  // MEANX
     codec_id=track-&gt;enc-&gt;codec_id;
-    if(ADM_useAlternateTagging() &amp;&amp; codec_id==CODEC_ID_MP3) codec_id=CODEC_ID_MP2;
+#warning useAlternateTagging disabled
+    //if(ADM_useAlternateTagging() &amp;&amp; codec_id==CODEC_ID_MP3) codec_id=CODEC_ID_MP2;
     put_byte(pb, codec_get_tag(ff_mp4_obj_type, codec_id));
     // /MEANX
 

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,12 +1,10 @@
-SET(ADM_LIB ADM_lavutil)
+SET(ADM_LIB ADM_libavutil)
 
 SET(${ADM_LIB}_SRCS 
-	integer.c  intfloat_readwrite.c  mathematics.c  rational.c md5.c crc.c log.c  adler32.c lls.c random.c
-	string.c)
+	integer.c  intfloat_readwrite.c  mathematics.c  rational.c  md5.c  crc.c
+	log.c  adler32.c  lls.c  random.c  string.c)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_AV_CONFIG_H -include ffconf.h&quot;)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-DHAVE_AV_CONFIG_H&quot;)
 
-INCLUDE(admLibFfmpeg)
-GET_FFMPEG_CFLAGS(FFMPEG_CFLAGS)
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${FFMPEG_CFLAGS}&quot;)
\ No newline at end of file
+INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,15 +1,14 @@
 SET(ADM_LIB ADM_libpostproc)
 
-SET(${ADM_LIB}_SRCS 
-	postprocess.c)
+SET(${ADM_LIB}_SRCS postprocess.c)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I.. -DHAVE_AV_CONFIG_H  -O3 -I../.. -I../ADM_lavutil -Drestrict=__restrict__ -fomit-frame-pointer -include ffconf.h&quot;)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-I.. -DHAVE_AV_CONFIG_H  -O3 -I../.. -I../ADM_lavutil -Drestrict=__restrict__ -fomit-frame-pointer&quot;)
 
 IF(ADM_CPU_X86_64)
-	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-msse&quot;)
+	ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-msse&quot;)
 ENDIF(ADM_CPU_X86_64)
 
-INCLUDE(admLibFfmpeg)
-GET_FFMPEG_CFLAGS(FFMPEG_CFLAGS)
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${FFMPEG_CFLAGS}&quot;)
\ No newline at end of file
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core ADM_libavutil)
+
+INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -23,12 +23,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 
 
 #include &quot;ADM_mp.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -5,17 +5,17 @@
 	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} yuv2rgb_altivec.c)
 ENDIF (ADM_CPU_ALTIVEC)
 	
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DCONFIG_GPL -fomit-frame-pointer -include ffconf.h&quot;)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-DCONFIG_GPL -fomit-frame-pointer&quot;)
 
 IF (APPLE)
-	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DPIC&quot;)
+	ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-DPIC&quot;)
 	
 	IF (ADM_DEBUG)
-		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-O2&quot;)
+		ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-O2&quot;)
 	ENDIF (ADM_DEBUG)
 ENDIF (APPLE)
 
-INCLUDE(admLibFfmpeg)
-GET_FFMPEG_CFLAGS(FFMPEG_CFLAGS)
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${FFMPEG_CFLAGS}&quot;)
\ No newline at end of file
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core ADM_libavutil)
+
+INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -0,0 +1,35 @@
+IF (ADM_CPU_X86_32)
+	ADD_DEFINITIONS(&quot;-DARCH_X86 -DARCH_X86_32&quot;)
+ELSEIF (ADM_CPU_X86_64)
+	ADD_DEFINITIONS(&quot;-DARCH_X86 -DARCH_X86_64&quot;)
+ELSEIF (ADM_CPU_PPC)
+	ADD_DEFINITIONS(&quot;-DARCH_POWERPC&quot;)
+
+	IF (ADM_CPU_ALTIVEC)
+		ADD_DEFINITIONS(&quot;-DHAVE_ALTIVEC&quot;)
+
+		IF (NOT APPLE)
+			ADD_DEFINITIONS(&quot;-DHAVE_ALTIVEC_H&quot;)
+		ENDIF (NOT APPLE)
+	ENDIF (ADM_CPU_ALTIVEC)
+
+	IF (ADM_CPU_DCBZL)
+		ADD_DEFINITIONS(&quot;-DHAVE_DCBZL&quot;)
+	ENDIF (ADM_CPU_DCBZL)
+ENDIF (ADM_CPU_X86_32)
+
+IF (ADM_CPU_SSSE3)
+	ADD_DEFINITIONS(&quot;-DHAVE_SSSE3&quot;)
+ENDIF (ADM_CPU_SSSE3)
+
+IF (ADM_BIG_ENDIAN)
+	ADD_DEFINITIONS(&quot;-DWORDS_BIGENDIAN&quot;)
+ENDIF (ADM_BIG_ENDIAN)
+
+INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
+
+ADD_SUBDIRECTORY(ADM_lavcodec)
+ADD_SUBDIRECTORY(ADM_lavformat)
+ADD_SUBDIRECTORY(ADM_lavutil)
+ADD_SUBDIRECTORY(ADM_libswscale)
+ADD_SUBDIRECTORY(ADM_libpostproc)
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/ADM_mpeg2dec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/ADM_mpeg2dec.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/ADM_mpeg2dec.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -12,7 +12,7 @@
 #include &quot;ADM_default.h&quot;
 #ifdef ADM_CPU_X86
 #include &quot;ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h&quot;
-#include &quot;ADM_libraries/ADM_lavcodec/dsputil_cpu.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h&quot;
 #include &quot;ADM_cpuCap.h&quot;
 #endif
 extern &quot;C&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -38,7 +38,7 @@
 #include &quot;avifmt.h&quot;
 #include &quot;avifmt2.h&quot;
 #include &quot;ADM_editor/ADM_Video.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;ADM_outputs/ADM_lavformat.h&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_LAVFORMAT

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mthread.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mthread.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/ADM_mthread.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -22,8 +22,6 @@
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_threads.h&quot;
 
-
-
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
@@ -32,7 +30,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;ADM_outputs/ADM_lavformat.h&quot;
 #include &quot;ADM_mthread.h&quot;
 
 admMutex accessMutex(&quot;accessMutex_MT_muxer&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -23,10 +23,10 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 
 ADMImageResizer::ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,9 +1,6 @@
-subdirs (PREORDER ADM_lavcodec)
-subdirs (PREORDER ADM_lavformat)
-subdirs (PREORDER ADM_lavutil)
+subdirs (PREORDER ADM_ffmpeg)
 subdirs (PREORDER ADM_libMpeg2Dec)
 subdirs (PREORDER ADM_libmpeg2enc)
-subdirs (PREORDER ADM_libswscale)
 subdirs (PREORDER ADM_libtwolame)
 subdirs (PREORDER ADM_libwrapper)
 subdirs (PREORDER ADM_lvemux)
@@ -11,7 +8,6 @@
 subdirs (PREORDER ADM_smjs)
 subdirs (PREORDER ADM_utilities)
 subdirs (PREORDER ADM_xvidratectl)
-subdirs (PREORDER ADM_libpostproc)
 
 if(USE_FREETYPE)
 	subdirs (PREORDER ADM_libass)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -0,0 +1,808 @@
+
+// C++ Implementation: ADM_lavformat
+//
+// Description: 
+//
+//
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;config.h&quot;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;math.h&gt;
+#include &lt;string.h&gt;
+
+extern &quot;C&quot; 
+{
+	#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavformat/avformat.h&quot;
+};
+
+#undef malloc
+#undef realloc
+#undef free
+
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+
+#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
+#include &quot;ADM_audio/ADM_a52info.h&quot;
+
+#include &quot;ADM_codecs/ADM_codec.h&quot;
+#include &quot;ADM_editor/ADM_Video.h&quot;
+
+#include &quot;ADM_lavformat.h&quot;
+#include &quot;fourcc.h&quot;
+
+#include &quot;prefs.h&quot;
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_LAVFORMAT
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+#include &quot;ADM_cpuCap.h&quot;
+static    AVOutputFormat *fmt;
+static    AVFormatContext *oc;
+static    AVStream *audio_st, *video_st;
+static    double audio_pts, video_pts;
+
+static uint32_t one;
+uint64_t  _curDTS;
+
+static uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid);
+static uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid);
+// convert in in us to out in 90Khz tick
+int64_t adm_90k( double in)
+{
+int64_t out;
+	// in=in/1000*1000 us-&gt;s
+	// in/=(1/90000) nb 90 khz tick
+	// in*=90*000/000*000
+	// in =  in*=90/000
+	//in=in*90./1000.;
+	out= (int64_t)in;
+	return out;
+}
+//___________________________________________________________________________
+lavMuxer::lavMuxer( void )
+{
+	fmt=NULL;
+	oc=NULL;
+	audio_st=NULL;
+	video_st=NULL;
+	_fps1000=0;
+	_audioByterate=0;
+	_lastAudioDts=0;
+	_frameNo=0;
+	_running=0;
+	_curDTS=0;
+        _audioFq=0;
+}
+//___________________________________________________________________________
+lavMuxer::~lavMuxer()
+{
+	close();
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::open(const char *filename, uint32_t inbitrate,ADM_MUXER_TYPE type, aviInfo *info, WAVHeader *audioheader) 
+{
+        return open(filename,inbitrate,type,info,0,NULL,audioheader,0,NULL);
+}
+
+
+uint8_t lavMuxer::open(const char *filename,uint32_t inbitrate, ADM_MUXER_TYPE type, aviInfo *info,
+              uint32_t videoExtraDataSize, uint8_t *videoExtraData, WAVHeader *audioheader,
+              uint32_t audioextraSize,uint8_t *audioextraData)
+{
+ AVCodecContext *c;
+ 	_type=type;
+	_fps1000=info-&gt;fps1000;
+	switch(_type)
+	{
+	case MUXER_TS:
+		fmt=guess_format(&quot;mpegts&quot;, NULL, NULL);
+		break;
+	case MUXER_DVD:
+		fmt = guess_format(&quot;dvd&quot;, NULL, NULL);
+		break;
+	case MUXER_VCD:
+		fmt = guess_format(&quot;vcd&quot;, NULL, NULL);
+		break;
+	case MUXER_SVCD:
+		fmt = guess_format(&quot;svcd&quot;, NULL, NULL);
+		break;
+	case MUXER_MP4:
+		fmt = guess_format(&quot;mp4&quot;, NULL, NULL);
+		break;
+	case MUXER_PSP:
+		fmt = guess_format(&quot;psp&quot;, NULL, NULL);
+		break;
+	case MUXER_FLV:
+		fmt = guess_format(&quot;flv&quot;, NULL, NULL);
+		break;          
+	case MUXER_MATROSKA:
+		fmt = guess_format(&quot;matroska&quot;, NULL, NULL);
+		break;          
+
+	default:
+		fmt=NULL;
+	}
+	if (!fmt) 
+	{
+        	printf(&quot;Lav:Cannot guess format\n&quot;);
+                ADM_assert(0);
+		return 0;
+	}
+	oc = av_alloc_format_context();
+	if (!oc) 
+	{
+       		printf(&quot;Lav:Cannot allocate context\n&quot;);
+		return 0;
+	}
+	oc-&gt;oformat = fmt;
+	snprintf(oc-&gt;filename,1000,&quot;<A HREF="file://%s">file://%s</A>&quot;,filename);
+	// Video
+	//________
+	
+	video_st = av_new_stream(oc, 0);
+	if (!video_st) 
+	{
+		printf(&quot;Lav: new stream failed\n&quot;);
+		return 0;
+	}	
+	
+	c = video_st-&gt;codec;
+	switch(_type)
+	{
+				case MUXER_FLV:
+					 c-&gt;codec=new AVCodec;
+					 memset(c-&gt;codec,0,sizeof(AVCodec));
+					 if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;FLV1&quot;))
+					 {
+						 c-&gt;codec_id=CODEC_ID_FLV1;
+					 	 c-&gt;codec-&gt;name=ADM_strdup(&quot;FLV1&quot;);
+					 }else
+					 {
+						 if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;VP6F&quot;))
+						 			{
+							 		 c-&gt;codec_id=CODEC_ID_VP6F;
+					 				 c-&gt;codec-&gt;name=ADM_strdup(&quot;VP6F&quot;);
+						 			}
+						 else
+							 ADM_assert(0);
+					 
+					 }
+					 
+					 break;
+                case MUXER_MATROSKA:
+                        strcpy(oc-&gt;title,&quot;Avidemux&quot;);
+                        strcpy(oc-&gt;author,&quot;Avidemux&quot;);
+                        c-&gt;sample_aspect_ratio.num=1;
+                        c-&gt;sample_aspect_ratio.den=1;
+                        if(isMpeg4Compatible(info-&gt;fcc))
+                        {
+                                c-&gt;codec_id = CODEC_ID_MPEG4;
+                                c-&gt;has_b_frames=1; // in doubt...
+                        }else
+                        {
+                                if(isH264Compatible(info-&gt;fcc))
+                                {
+                                        c-&gt;has_b_frames=1; // in doubt...
+                                        c-&gt;codec_id = CODEC_ID_H264;
+                                        c-&gt;codec=new AVCodec;
+                                        memset(c-&gt;codec,0,sizeof(AVCodec));
+                                        c-&gt;codec-&gt;name=ADM_strdup(&quot;H264&quot;);
+                                }
+                                else
+                                {
+                                   if(!ADM_4cc_to_lavcodec((const char *)&amp;(info-&gt;fcc),&amp;(c-&gt;codec_id)))
+                                   {
+                                      printf(&quot;[lavFormat] Cannot map  this\n&quot;);
+                                      return 0;
+                                   }
+                                  
+                                }
+                        }
+                        if(videoExtraDataSize)
+                        {
+                                c-&gt;extradata=videoExtraData;
+                                c-&gt;extradata_size= videoExtraDataSize;
+                        }
+                        break;
+                case MUXER_MP4:
+                case MUXER_PSP:
+                {
+                        // probably a memeleak here
+                        char *foo=ADM_strdup(filename);
+                        
+                        strcpy(oc-&gt;title,ADM_GetFileName(foo));
+                        strcpy(oc-&gt;author,&quot;Avidemux&quot;);
+                        c-&gt;sample_aspect_ratio.num=1;
+                        c-&gt;sample_aspect_ratio.den=1;
+                        if(isMpeg4Compatible(info-&gt;fcc))
+                        {
+                                c-&gt;codec_id = CODEC_ID_MPEG4;
+                                c-&gt;has_b_frames=1; // in doubt...
+                        }else
+                        {
+                                if(isH264Compatible(info-&gt;fcc))
+                                {
+                                        c-&gt;has_b_frames=1; // in doubt...
+                                        c-&gt;codec_id = CODEC_ID_H264;
+                                        c-&gt;codec=new AVCodec;
+                                        memset(c-&gt;codec,0,sizeof(AVCodec));
+                                        c-&gt;codec-&gt;name=ADM_strdup(&quot;H264&quot;);
+                                }
+                                else
+                                {
+                                        if(isDVCompatible(info-&gt;fcc))
+                                        {
+                                          c-&gt;codec_id = CODEC_ID_DVVIDEO;
+                                        }else
+                                        {
+                                          if(fourCC::check(info-&gt;fcc,(uint8_t *)&quot;H263&quot;))
+                                          {
+                                                    c-&gt;codec_id=CODEC_ID_H263;
+                                            }else{
+                                                    c-&gt;codec_id = CODEC_ID_MPEG4; // Default value
+                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
+                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
+                                                    printf(&quot;Ooops, cant mux that...\n&quot;);
+                                                }
+                                        }
+                                }
+                        }
+                        if(videoExtraDataSize)
+                        {
+                                c-&gt;extradata=videoExtraData;
+                                c-&gt;extradata_size= videoExtraDataSize;
+                        }
+                        if(MUXER_PSP==_type)
+                        {
+                            c-&gt;rc_buffer_size=0; //8*1024*224;
+                            c-&gt;rc_max_rate=0; //768*1000;
+                            c-&gt;rc_min_rate=0;
+                            c-&gt;bit_rate=768*1000;
+                        }
+                        else
+                        {
+                            c-&gt;rc_buffer_size=8*1024*224;
+                            c-&gt;rc_max_rate=9500*1000;
+                            c-&gt;rc_min_rate=0;
+                            if(!inbitrate)
+                                    c-&gt;bit_rate=9000*1000;
+                            else
+                                    c-&gt;bit_rate=inbitrate;
+                        }
+                }
+                        break;
+                case MUXER_TS:
+                        c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
+                        c-&gt;rc_buffer_size=8*1024*224;
+                        c-&gt;rc_max_rate=9500*1000;
+                        c-&gt;rc_min_rate=0;
+                        if(!inbitrate)
+                                c-&gt;bit_rate=9000*1000;
+                        else
+                                c-&gt;bit_rate=inbitrate;
+        
+                        break;
+		case MUXER_DVD:
+			c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
+			c-&gt;rc_buffer_size=8*1024*224;
+			c-&gt;rc_max_rate=9500*1000;
+			c-&gt;rc_min_rate=0;
+			if(!inbitrate)
+				c-&gt;bit_rate=9000*1000;
+			else
+				c-&gt;bit_rate=inbitrate;
+	
+			break;
+		case MUXER_VCD:
+			c-&gt;codec_id = CODEC_ID_MPEG1VIDEO;
+
+			c-&gt;rc_buffer_size=8*1024*40;
+			c-&gt;rc_max_rate=1152*1000;
+			c-&gt;rc_min_rate=1152*1000;
+			
+			c-&gt;bit_rate=1152*1000;
+			
+
+			break;
+		case MUXER_SVCD:
+			c-&gt;codec_id = CODEC_ID_MPEG2VIDEO;
+
+			c-&gt;rc_buffer_size=8*1024*112;
+			c-&gt;rc_max_rate=2500*1000;
+			c-&gt;rc_min_rate=0*1000;
+			if(!inbitrate)
+				c-&gt;bit_rate=2040*1000;
+			else
+				c-&gt;bit_rate=inbitrate;
+
+			break;
+		default:
+			ADM_assert(0);
+	}
+	
+	c-&gt;codec_type = CODEC_TYPE_VIDEO;
+	c-&gt;flags=CODEC_FLAG_QSCALE;   
+	c-&gt;width = info-&gt;width;  
+	c-&gt;height = info-&gt;height; 
+
+       AVRational fps25=(AVRational){1001,25025};
+       AVRational fps24=(AVRational){1001,24000};
+       AVRational fps30= (AVRational){1001,30000};
+       AVRational fpsfree= (AVRational){1000,_fps1000};
+
+        
+    	switch(_fps1000)
+	{
+		case 25000:
+                {
+			 c-&gt;time_base= fps25; 
+			 break;
+                }
+		case 23976:
+                        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
+                        {
+                                 c-&gt;time_base= fps24; //(AVRational){1001,24000};
+                                break;
+                        }
+		case  29970:
+			 c-&gt;time_base=fps30;
+			break;
+		default:
+                      {
+                            if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
+                            {
+                                    c-&gt;time_base=fpsfree;// (AVRational){1000,_fps1000};
+                                    break;
+                            }
+                            else
+                            {
+                                GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible frame rate&quot;), NULL);
+                                return 0;
+                            }
+                            }
+                        break;
+	}
+
+			
+	c-&gt;gop_size=15;
+	c-&gt;max_b_frames=2;
+	c-&gt;has_b_frames=1;
+
+	
+	// Audio
+	//________
+        if(audioheader)
+        {
+          audio_st = av_new_stream(oc, 1);
+          if (!audio_st) 
+          {
+                  printf(&quot;Lav: new stream failed\n&quot;);
+                  return 0;
+          }
+  
+                  
+          c = audio_st-&gt;codec;
+          c-&gt;frame_size=1024; //For AAC mainly, sample per frame
+          printf(&quot;[LavFormat] Bitrate %u\n&quot;,(audioheader-&gt;byterate*8)/1000);
+          _audioFq=c-&gt;sample_rate = audioheader-&gt;frequency;
+#if 0
+           if(_type== MUXER_PSP &amp;&amp; audioheader-&gt;encoding==WAV_AAC)
+            {
+                    _audioFq=c-&gt;sample_rate = audioheader-&gt;frequency/2;                 //_audioFq*=2; // SBR
+             }
+#endif
+          
+          switch(audioheader-&gt;encoding)
+          {
+                  case WAV_AC3: c-&gt;codec_id = CODEC_ID_AC3;break;
+                  case WAV_MP2: c-&gt;codec_id = CODEC_ID_MP2;break;
+                  case WAV_MP3:
+  #warning FIXME : Probe deeper
+                              c-&gt;frame_size=1152;
+                              c-&gt;codec_id = CODEC_ID_MP3;
+                              break;
+                  case WAV_PCM: 
+                                  // One chunk is 10 ms (1/100 of fq)
+                                  c-&gt;frame_size=4;
+                                  c-&gt;codec_id = CODEC_ID_PCM_S16LE;break;
+                  case WAV_AAC: 
+                                  c-&gt;extradata=audioextraData;
+                                  c-&gt;extradata_size= audioextraSize;
+                                  c-&gt;codec_id = CODEC_ID_AAC;
+                                  break;
+                  default:
+                          if(_type==MUXER_MATROSKA)
+                          {
+                           if(ADM_WaveTag_to_lavcodec(audioheader-&gt;encoding, &amp;(c-&gt;codec_id)))
+                           {
+                             if(audioextraData)
+                             {
+                                  c-&gt;extradata=audioextraData;
+                                  c-&gt;extradata_size= audioextraSize;
+                             }
+                             // Put a dummy time increment
+                              c-&gt;time_base= fps25;
+                             break;
+                           }
+                          }
+                            
+                          printf(&quot;Cant mux that ! audio\n&quot;); 
+                          printf(&quot;Cant mux that ! audio\n&quot;);
+                          c-&gt;codec_id = CODEC_ID_MP2;
+                          return 0;
+                          break;
+          }
+          c-&gt;codec_type = CODEC_TYPE_AUDIO;
+          
+          c-&gt;bit_rate = audioheader-&gt;byterate*8;
+          c-&gt;rc_buffer_size=(c-&gt;bit_rate/(2*8)); // 500 ms worth
+          
+          c-&gt;channels = audioheader-&gt;channels;
+          _audioByterate=audioheader-&gt;byterate;
+          
+        }
+        // /audio
+	
+	
+//----------------------
+	switch(_type)
+	{
+				case MUXER_FLV:
+                case MUXER_PSP:
+                case MUXER_MP4:
+                case MUXER_MATROSKA:
+                        oc-&gt;mux_rate=10080*1000; // Needed ?
+                        break;
+
+                case MUXER_TS:
+                        oc-&gt;mux_rate=10080*1000;
+                        break;
+		case MUXER_DVD:
+			oc-&gt;packet_size=2048;
+			oc-&gt;mux_rate=10080*1000;
+			break;
+		case MUXER_VCD:
+			oc-&gt;packet_size=2324;
+			oc-&gt;mux_rate=2352 * 75 * 8;
+			
+			break;
+		case MUXER_SVCD:
+			
+			oc-&gt;packet_size=2324;
+			oc-&gt;mux_rate=2*2352 * 75 * 8; // ?
+			
+			break;
+		default:
+			ADM_assert(0);
+	}
+	oc-&gt;preload=AV_TIME_BASE/10; // 100 ms preloading
+	oc-&gt;max_delay=200*1000; // 500 ms
+	
+	if (av_set_parameters(oc, NULL) &lt; 0) 
+	{
+		printf(&quot;Lav: set param failed \n&quot;);
+		return 0;
+	}
+	 if (url_fopen(&amp;(oc-&gt;pb), filename, URL_WRONLY) &lt; 0) 
+	 {
+	 	printf(&quot;Lav: Failed to open file :%s\n&quot;,filename);
+		return 0;
+        }
+
+	ADM_assert(av_write_header(oc)&gt;=0);
+	dump_format(oc, 0, filename, 1);
+
+
+	printf(&quot;lavformat mpeg muxer initialized\n&quot;);
+	
+	_running=1;
+
+	one=(1000*1000*1000)/_fps1000; 
+	_curDTS=one;
+
+	return 1;
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::writeAudioPacket(uint32_t len, uint8_t *buf,uint32_t sample)
+{
+        
+        int ret;
+        AVPacket pkt;
+        double f;
+        int64_t timeInUs;
+
+            //printf(&quot;Audio paclet : size %u, sample %u\n&quot;,len,sample);
+        
+           if(!audio_st) return 0;
+           if(!len) return 1;
+            av_init_packet(&amp;pkt);
+
+            timeInUs=(int64_t)sample2time_us(sample);
+            /* Rescale to ?? */
+            if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+            {
+            			f=timeInUs/1000;
+            			f=floor(f+0.4);
+            }
+            else
+            {
+            	f=timeInUs;
+            	f/=1000000.; // In ms seconds 
+            	f*=_audioFq;
+            	f=floor(f+0.4);
+            }
+            pkt.dts=pkt.pts=(int)(f);
+
+            //printf(&quot;F:%f Q:%u D=%u\n&quot;,f,pkt.pts,timeInUs-_lastAudioDts);
+            
+            pkt.flags |= PKT_FLAG_KEY; 
+            pkt.data= buf;
+            pkt.size= len;
+            pkt.stream_index=1;
+            //pkt.duration=pkt.dts-_lastAudioDts; // Duration
+            aprintf(&quot;A: sample: %d frame_pts: %d fq: %d\n&quot;,(int32_t )sample,(int32_t )pkt.dts,audio_st-&gt;codec-&gt;sample_rate); 
+
+            ret = av_write_frame(oc, &amp;pkt);
+            _lastAudioDts=timeInUs;
+            if(ret) 
+            {
+                        printf(&quot;Error writing audio packet\n&quot;);
+                        printf(&quot;pts %llu dts %llu\n&quot;,pkt.pts,pkt.dts);
+                        return 0;
+            }
+            return 1;
+}
+//________________________________________________________________________
+uint64_t  lavMuxer::sample2time_us( uint32_t sample )
+{
+double f;
+
+                f=sample;
+                f*=1000.*1000.;
+                f/=_audioFq;              // Sample / Frequency = time in seconds *10E6 to get in in us
+                
+                return (uint64_t)floor(f);
+
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::needAudio( void )
+{
+	
+        if(!audio_st) return 0;
+
+	double f;
+	uint64_t dts=_lastAudioDts;  // Last audio dts
+
+		
+		aprintf(&quot;Need audio  ?: %llu / %llu : %llu\n &quot;,dts,_curDTS,_curDTS+one);
+		if((dts+5000&gt;=_curDTS) &amp;&amp; (dts&lt;=_curDTS+one)) return 1;
+		if(dts&lt;=_curDTS)
+		{
+			printf(&quot;LavMuxer:Audio DTS is too low %llu / %llu!\n&quot;,dts,_curDTS);
+			return 1;
+		}
+		return 0;
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::writeVideoPacket(ADMBitstream *bitstream)
+{
+int ret;
+
+double p,d;
+  	AVPacket pkt;
+            av_init_packet(&amp;pkt);
+	    
+        p=bitstream-&gt;ptsFrame+1;      // Pts           // Time p/fps1000=out/den  out=p*den*1000/fps1000
+        p=(p*1000*1000*1000);
+        p=p/_fps1000;                  // in us
+	
+        d=bitstream-&gt;dtsFrame;		// dts
+	d=(d*1000*1000*1000);
+	d=d/_fps1000;
+	
+	
+	_curDTS=(int64_t)floor(d);	
+        
+        // Rescale
+#define RESCALE(x) x=x*video_st-&gt;codec-&gt;time_base.den*1000.;\
+                   x=x/_fps1000;
+        
+        p=bitstream-&gt;ptsFrame+1;
+        RESCALE(p);
+        
+        d=bitstream-&gt;dtsFrame;
+        RESCALE(d);
+        
+        if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+        {
+        			p=p*1000/_fps1000;
+        			d=d*1000/_fps1000;
+        }
+    	pkt.dts=(int64_t)floor(d);
+    	pkt.pts=(int64_t)floor(p);
+
+       // printf(&quot;Lavformat : Pts :%u dts:%u&quot;,displayframe,frameno);
+	aprintf(&quot;Lavformat : Pts :%llu dts:%llu&quot;,pkt.pts,pkt.dts);
+	pkt.stream_index=0;
+           
+        pkt.data= bitstream-&gt;data;
+        pkt.size= bitstream-&gt;len;
+	// Look if it is a gop start or seq start
+        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
+        {
+            if(bitstream-&gt;flags &amp; AVI_KEY_FRAME) 
+                        pkt.flags |= PKT_FLAG_KEY;
+        }else
+            if(!bitstream-&gt;data[0] &amp;&amp;  !bitstream-&gt;data[1] &amp;&amp; bitstream-&gt;data[2]==1)
+	{
+            if(bitstream-&gt;data[3]==0xb3 || bitstream-&gt;data[3]==0xb8 ) // Seq start or gop start
+		pkt.flags |= PKT_FLAG_KEY;
+		//printf(&quot;Intra\n&quot;); 
+	}
+           
+	ret =av_write_frame(oc, &amp;pkt);
+	if(ret) 
+	{
+		printf(&quot;Error writing video packet\n&quot;);
+		return 0;
+	}
+        aprintf(&quot;V: frame %lu pts%d\n&quot;,bitstream-&gt;dtsFrame,pkt.pts);
+	
+	return 1;
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::forceRestamp(void)
+{
+	return 1;
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::close( void )
+{
+	if(_running)
+	{
+		_running=0;
+		// Flush
+		// Cause deadlock :
+		av_write_trailer(oc);
+		url_fclose(&amp;oc-&gt;pb);
+
+	}
+	if(audio_st)
+	{
+		 av_free(audio_st);
+	}
+	if(video_st)
+	{
+		 av_free(video_st);
+	}
+	video_st=NULL;
+	audio_st=NULL;
+	if(oc)
+		av_free(oc);
+	oc=NULL;
+	return 1;
+}
+//___________________________________________________________________________
+uint8_t lavMuxer::audioEmpty( void)
+{
+	return 0;
+}
+extern &quot;C&quot;
+{
+     extern  int        mpegps_init(void );
+     extern  int        movenc_init(void );
+     extern  int        flvenc_init(void );
+     extern  int        matroskaenc_init(void );
+};
+extern URLProtocol file_protocol ;
+uint8_t lavformat_init(void)
+{
+                movenc_init();
+                flvenc_init();
+                matroskaenc_init();
+                register_protocol(&amp;file_protocol);
+}
+extern &quot;C&quot;
+{
+/** 
+    \fn ADM_useAlternateTagging
+    \brief returns 1 if using haali compatible tagging, 0 if normal. For mp3 in mp4ff.
+*/
+int ADM_useAlternateTagging(void)
+{
+  uint32_t v=1;
+  prefs-&gt;get(FEATURE_ALTERNATE_MP3_TAG,&amp;v);
+  return v;
+} 
+}
+
+typedef struct
+{
+  const char *name;
+  int    id;
+}lavFCC_t;
+
+lavFCC_t lavFCC[]=
+{
+  {&quot;DIV3&quot;,CODEC_ID_MSMPEG4V3},
+  {&quot;FLV1&quot;,CODEC_ID_FLV1},
+  {&quot;MPEG&quot;,CODEC_ID_MPEG2VIDEO},
+  {&quot;DUMMY&quot;,0Xffff}
+};
+/**
+    \fn ADM_4cc_to_lavcodec
+    \brief Convert avi fourcc to lavcodec id (video)
+
+*/
+uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid)
+{
+    uint32_t nb=sizeof( lavFCC)/sizeof(lavFCC_t);
+    nb--;
+    for(int i=0;i&lt;nb;i++)
+    {
+      if(!strncmp(lavFCC[i].name,fcc,4))
+      {
+        *outlavid=(CodecID)lavFCC[i].id;
+        return 1; 
+      }
+      
+    }
+    return 0;
+  
+}
+//*****************
+typedef struct
+{
+  uint32_t tag;
+  int    id;
+}lavWaveTag_t;
+
+lavWaveTag_t lavWaveTag[]=
+{
+  {WAV_AC3,CODEC_ID_AC3},
+  {WAV_OGG,CODEC_ID_VORBIS},
+  {WAV_AAC,CODEC_ID_AAC},
+  {0xdead,0Xffff} // DUMMY
+};
+/**
+    \fn ADM_WaveTag_to_lavcodec
+    \brief Convert ADM audio codec id to lavcodec id (video)
+
+*/
+uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid)
+{
+    uint32_t nb=sizeof( lavWaveTag)/sizeof(lavWaveTag_t);
+    nb--;
+    for(int i=0;i&lt;nb;i++)
+    {
+      if(lavWaveTag[i].tag==tag)
+      {
+        *outlavid=(CodecID)lavWaveTag[i].id;
+        return 1; 
+      }
+      
+    }
+    return 0;
+  
+}
+
+//___________________________________________________________________________
+//EOF
+
+

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.h (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_muxts.cpp (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_muxts.cpp)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_tscrc.h (from rev 3894, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/ADM_tscrc.h)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -6,3 +6,8 @@
 ADD_SUBDIRECTORY(oplug_flv)
 ADD_SUBDIRECTORY(oplug_dummy)
 
+SET(ADM_LIB ADM_outputs)
+SET(${ADM_LIB}_SRCS 
+	ADM_lavformat.cpp  ADM_muxts.cpp)
+
+ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -335,8 +335,8 @@
 extern &quot;C&quot;
 {
 #define av_always_inline inline
-#include &quot;ADM_libraries/ADM_lavutil/bswap.h&quot; 
-#include &quot;ADM_libraries/ADM_lavcodec/bitstream.h&quot; 
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h&quot; 
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h&quot; 
 }
 void putNvop(ADMBitstream *data,uint32_t timebits, uint32_t timeincval)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -47,7 +47,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;../ADM_lavformat.h&quot;
 #include &quot;fourcc.h&quot;
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -47,7 +47,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;../ADM_lavformat.h&quot;
 #include &quot;fourcc.h&quot;
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -52,7 +52,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;../ADM_lavformat.h&quot;
 
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -31,7 +31,7 @@
 #include &quot;prefs.h&quot;
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_editor/ADM_outputfmt.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;../ADM_lavformat.h&quot;
 
 #include &quot;ADM_libraries/ADM_lvemux/ADM_muxer.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -51,7 +51,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;ADM_libraries/ADM_lavformat/ADM_lavformat.h&quot;
+#include &quot;../ADM_lavformat.h&quot;
 
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -50,7 +50,7 @@
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_PREVIEW
 #include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/ADM_mp.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h&quot;
 #include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
 
 #define MAX(a,b) ( (a)&gt;(b) ? (a) : (b) )

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -32,7 +32,7 @@
 #include &quot;ADM_video/ADM_vidEqualizer.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 
 static ColYuvRgb    *rgbConv=NULL;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -31,7 +31,7 @@
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 
 static GtkWidget	*create_dialog1 (void);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -36,7 +36,7 @@
 #include &quot;../ADM_commonUI/GUI_accelRender.h&quot;
 
 #include &quot;ADM_colorspace/ADM_rgb.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/ADM_mp.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h&quot;
 
 void GUI_gtk_grow_off(int onff);
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -21,7 +21,7 @@
 #include &quot;ADM_assert.h&quot;
 
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 
 ADM_flyDialog::ADM_flyDialog(uint32_t width,uint32_t height,AVDMGenericVideoStream *in,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -15,12 +15,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 
 #include &quot;ADM_filter/video_filters.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -28,12 +28,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 #include &quot;ADM_filter/video_filters.h&quot;
 
 typedef struct alg

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -25,12 +25,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 
 #include &quot;ADM_filter/video_filters.h&quot;
 #include &quot;ADM_video/ADM_cache.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2008-03-15 15:52:19 UTC (rev 3895)
@@ -67,12 +67,12 @@
 
 #ifdef ADM_CPU_X86
 extern &quot;C&quot; {
-#include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h&quot;
 }
 #endif
 
-#include &quot;ADM_libraries/ADM_lavutil/avutil.h&quot;
-#include &quot;ADM_libraries/ADM_libswscale/swscale.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h&quot;
+#include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h&quot;
 
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-15 15:52:19 UTC (rev 3895)
@@ -55,8 +55,8 @@
 INCLUDE_DIRECTORIES(&quot;${CMAKE_BINARY_DIR}/config&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_core/include&quot;)
 INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_utilities&quot;)
-INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_lavutil&quot;)
-INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_lavcodec&quot;)
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavutil&quot;)
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavcodec&quot;)
 
 IF (GETTEXT_FOUND)
 	INCLUDE_DIRECTORIES(${GETTEXT_INCLUDE_DIR})
@@ -179,14 +179,15 @@
 ###########################################
 ADD_SUBDIRECTORY(ADM_outputs)
 
-SET(ADM_OUTPUTS
+SET(ADM_OUTPUTS	
 	oplug_avi
 	oplug_mp4
 	oplug_mpeg
 	oplug_mpegFF
 	oplug_ogm
 	oplug_flv
-	oplug_dummy)
+	oplug_dummy
+	ADM_outputs)
 
 ADD_ADMLIB_ALL_TARGETS(${ADM_OUTPUTS})
 
@@ -232,24 +233,24 @@
 ###########################################
 ADD_SUBDIRECTORY(ADM_libraries)
 
-SET(ADM_LIBRARIES
-	ADM_lavformat
-	ADM_lavcodec
-	ADM_lavutil
+ADD_ADMLIB_ALL_TARGETS(
 	ADM_mplex
 	ADM_libMpeg2Dec
 	ADM_libmpeg2enc
-	ADM_libswscale
 	ADM_libtwolame
 	ADM_libwrapper
 	ADM_lvemux
 	ADM_smjs
 	ADM_utilities
 	ADM_xvidratectl
-	ADM_libpostproc
 	ADM_colorspace)
 
-ADD_ADMLIB_ALL_TARGETS(${ADM_LIBRARIES})
+ADD_LIB_ALL_TARGETS(
+	ADM_libavutil
+	ADM_libpostproc
+	ADM_libswscale
+	ADM_libavcodec
+	ADM_libavformat)
 
 IF (USE_FREETYPE)
 	ADD_ADMLIB_ALL_TARGETS(ADM_libass)

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/admLibFfmpeg.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admLibFfmpeg.cmake	2008-03-15 11:42:55 UTC (rev 3894)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admLibFfmpeg.cmake	2008-03-15 15:52:19 UTC (rev 3895)
@@ -1,32 +0,0 @@
-# This is a hack. FFmpeg libraries should have one config file.
-# This will be easier if automake is ever dropped.
-
-MACRO (GET_FFMPEG_CFLAGS varToSet)
-	IF (ADM_CPU_X86_32)
-		SET(${varToSet} &quot;-DARCH_X86 -DARCH_X86_32&quot;)
-	ELSEIF (ADM_CPU_X86_64)
-		SET(${varToSet} &quot;-DARCH_X86 -DARCH_X86_64&quot;)
-	ELSEIF (ADM_CPU_PPC)
-		SET(${varToSet} &quot;-DARCH_POWERPC&quot;)
-
-		IF (ADM_CPU_ALTIVEC)
-			SET(${varToSet} &quot;${${varToSet}} -DHAVE_ALTIVEC&quot;)
-
-			IF (NOT APPLE)
-				SET(${varToSet} &quot;${${varToSet}} -DHAVE_ALTIVEC_H&quot;)
-			ENDIF (NOT APPLE)
-		ENDIF (ADM_CPU_ALTIVEC)
-
-		IF (ADM_CPU_DCBZL)
-			SET(${varToSet} &quot;${${varToSet}} -DHAVE_DCBZL&quot;)
-		ENDIF (ADM_CPU_DCBZL)
-	ENDIF (ADM_CPU_X86_32)
-
-	IF (ADM_CPU_SSSE3)
-		SET(${varToSet} &quot;${${varToSet}} -DHAVE_SSSE3&quot;)
-	ENDIF (ADM_CPU_SSSE3)
-
-	IF (ADM_BIG_ENDIAN)
-		SET(${varToSet} &quot;${${varToSet}} -DWORDS_BIGENDIAN&quot;)
-	ENDIF (ADM_BIG_ENDIAN)
-ENDMACRO (GET_FFMPEG_CFLAGS)
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001157.html">[Avidemux-svn-commit] r3894 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters cmake
</A></li>
	<LI>Next message: <A HREF="001159.html">[Avidemux-svn-commit] r3896 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_smjs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1158">[ date ]</a>
              <a href="thread.html#1158">[ thread ]</a>
              <a href="subject.html#1158">[ subject ]</a>
              <a href="author.html#1158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
