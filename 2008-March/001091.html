<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3825 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiocodec avidemux/ADM_codecs	avidemux/ADM_colorspace avidemux/ADM_filter	avidemux/ADM_inputs/ADM_openDML avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_lavformat	avidemux/ADM_libraries/ADM_lavutil	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libpostproc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3825%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audiocodec%20avidemux/ADM_codecs%0A%09avidemux/ADM_colorspace%20avidemux/ADM_filter%0A%09avidemux/ADM_inputs/ADM_openDML%20avidemux/ADM_libraries/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_lavformat%0A%09avidemux/ADM_libraries/ADM_lavutil%0A%09avidemux/ADM_libraries/ADM_libMpeg2Dec%0A%09avidemux/ADM_libraries/ADM_libmpeg2enc%0A%09avidemux/ADM_libraries/ADM_libpostproc%0A%09avidemux/ADM_libraries/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_osSupport%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20avidemux/ADM_video%0A%09avidemux/ADM_videoFilter%20cmake&In-Reply-To=%3C200803051150.m25BoC33030692%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001090.html">
   <LINK REL="Next"  HREF="001092.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3825 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiocodec avidemux/ADM_codecs	avidemux/ADM_colorspace avidemux/ADM_filter	avidemux/ADM_inputs/ADM_openDML avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_lavformat	avidemux/ADM_libraries/ADM_lavutil	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libpostproc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3825%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20.%20avidemux%0A%09avidemux/ADM_audiocodec%20avidemux/ADM_codecs%0A%09avidemux/ADM_colorspace%20avidemux/ADM_filter%0A%09avidemux/ADM_inputs/ADM_openDML%20avidemux/ADM_libraries/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_lavformat%0A%09avidemux/ADM_libraries/ADM_lavutil%0A%09avidemux/ADM_libraries/ADM_libMpeg2Dec%0A%09avidemux/ADM_libraries/ADM_libmpeg2enc%0A%09avidemux/ADM_libraries/ADM_libpostproc%0A%09avidemux/ADM_libraries/ADM_libswscale%0A%09avidemux/ADM_libraries/ADM_mplex%0A%09avidemux/ADM_libraries/ADM_utilities%20avidemux/ADM_osSupport%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%20avidemux/ADM_video%0A%09avidemux/ADM_videoFilter%20cmake&In-Reply-To=%3C200803051150.m25BoC33030692%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3825 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_audiocodec avidemux/ADM_codecs	avidemux/ADM_colorspace avidemux/ADM_filter	avidemux/ADM_inputs/ADM_openDML avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_lavformat	avidemux/ADM_libraries/ADM_lavutil	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_libmpeg2enc	avidemux/ADM_libraries/ADM_libpostproc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video	avidemux/ADM_videoFilter cmake">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Mar  5 12:50:12 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001090.html">[Avidemux-svn-commit] r3824 - in	branches/avidemux_2.5_branch_gruntster: .	avidemux/ADM_audiocodec avidemux/ADM_codecs	avidemux/ADM_libraries/ADM_libMad	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_smjs	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_videoFilter cmake
</A></li>
        <LI>Next message: <A HREF="001092.html">[Avidemux-svn-commit] r3826 - in	branches/avidemux_2.5_branch_gruntster: .	avidemux/ADM_inputs/ADM_nuv avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_lavformat	avidemux/ADM_libraries/ADM_lavutil avidemux/ADM_libraries/ADM_libMad	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_liba52	avidemux/ADM_libraries/ADM_libpostproc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_commonUI cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1091">[ date ]</a>
              <a href="thread.html#1091">[ thread ]</a>
              <a href="subject.html#1091">[ subject ]</a>
              <a href="author.html#1091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-03-05 12:49:06 +0100 (Wed, 05 Mar 2008)
New Revision: 3825

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/admLibavcodec.cmake
Removed:
   branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake
Modified:
   branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_codecac3.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_dca.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_openDML/ADM_odml_odml.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/yuv2rgb_altivec.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_pp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_memcpy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_interlaced.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidBlend.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidDeintASM.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFields.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFlux.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMsmooth.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVlad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADMmpdetc.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
Log:
[CMake] more localisation and clean up of defines

Modified: branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -60,34 +60,15 @@
 SET(USE_FFMPEG 1)
 SET(USE_MJPEG 1)
 
-# ARCH_XXX need to be removed from Avidemux code one day and made library specific...
-IF (ADM_CPU_X86)
-	SET(ARCH_X86 1)
-	SET(ARCH_X86_32 1)
-ELSEIF (ADM_CPU_X86_64)
-	SET(ARCH_X86 1)
-	SET(ARCH_X86_64 1)
-ELSEIF (ADM_CPU_PPC)
-	SET(ARCH_POWERPC 1)
-
-	IF (ADM_CPU_ALTIVEC)
-		SET(ARCH_PPC 1)
-		SET(USE_ALTIVEC 1)
-		SET(HAVE_ALTIVEC 1)
-
-		IF (NOT APPLE)
-			SET(HAVE_ALTIVEC_H 1)
-		ENDIF (NOT APPLE)
-	ENDIF (ADM_CPU_ALTIVEC)
-ENDIF (ADM_CPU_X86)
-
 IF (CMAKE_WORDS_BIGENDIAN)
 	SET(ADM_BIG_ENDIAN 1)
+# needs to be made library specific
 	SET(WORDS_BIGENDIAN 1)
 ENDIF (CMAKE_WORDS_BIGENDIAN)
 
 # Libavcodec
-INCLUDE(admSetLavcodecFlags)
+INCLUDE(admLibavcodec)
+SET_LAVC_CONFIG_FLAGS()
 
 IF (NOT CMAKE_BUILD_TYPE)
 	SET(CMAKE_BUILD_TYPE &quot;Release&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_codecac3.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_codecac3.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_codecac3.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -43,7 +43,7 @@
     ADM_assert(fourcc==WAV_AC3);
     ac3_handle=NULL;
     ac3_sample=NULL;
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 #define CHK(x,y) if(CpuCaps::has##x()) flags|=MM_ACCEL_X86_##y;
     CHK(MMX,MMX);
     CHK(3DNOW,3DNOW);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_dca.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_dca.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_dca.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -40,7 +40,7 @@
     ADM_assert(fourcc==WAV_DTS);
     dts_handle=NULL;
     
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 #define CHK(x,y) if(CpuCaps::has##x()) flags|=MM_ACCEL_X86_##y;
     CHK(MMX,MMX);
     CHK(3DNOW,3DNOW);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -127,7 +127,7 @@
 
   printf (&quot;[xvid] SIMD supported: (%x)\n&quot;, xvid_gbl_info.cpu_flags);
 #define CPUF(x) if(xvid_gbl_info.cpu_flags  &amp; XVID_CPU_##x) printf(&quot;\t\t&quot;#x&quot;\n&quot;);
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
   CPUF (MMX);
   CPUF (MMXEXT);
   CPUF (SSE);
@@ -135,7 +135,7 @@
   CPUF (3DNOW);
   CPUF (3DNOWEXT);
 #endif
-#ifdef USE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
   CPUF (ALTIVEC);
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_colorspace.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -24,7 +24,7 @@
 #include &quot;colorspace.h&quot;
 
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#if (defined( ARCH_X86) || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -35,11 +35,11 @@
 #include &quot;ADM_rgb.h&quot; 
 #include &quot;ADM_colorspace.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))		
+#ifdef ADM_CPU_X86
 		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
 #define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2);
 #else
-#ifdef USE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 #define FLAGS() flags|=SWS_CPU_CAPS_ALTIVEC;
 #else
 #define FLAGS()

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/ADM_rgb.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -29,7 +29,7 @@
 
 #include &quot;colorspace.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -47,11 +47,11 @@
         clean();  \
     }
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))		
+#ifdef ADM_CPU_X86
 		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
 #define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2);
 #else
-#ifdef USE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 #define FLAGS() flags|=SWS_CPU_CAPS_ALTIVEC;
 #else
 #define FLAGS()
@@ -125,7 +125,7 @@
 */
 static void ADM_RGBA2BGRA(uint8_t *ptr, uint32_t howmuch)
 {
-#if ((defined( ARCH_X86)  || defined(ARCH_X86_64)))
+#ifdef ADM_CPU_X86
     __asm__(
                         &quot;1: mov            (%0),%%eax \n&quot;
                         &quot;bswap          %%eax \n&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_colorspace/rgb2yuv.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -26,7 +26,7 @@
 
 #include &quot;default.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -215,7 +215,7 @@
 	int flags = SWS_SPLINE;
 	struct SwsContext *context=NULL;
 	
-	#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+	#ifdef ADM_CPU_X86
 		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
 
 		ADD(MMX,MMX);
@@ -223,7 +223,7 @@
 		ADD(MMXEXT,MMX2);
 	#endif
 
-	#ifdef USE_ALTIVEC
+	#ifdef ADM_CPU_ALTIVEC
 	    flags |= SWS_CPU_CAPS_ALTIVEC;
 	#endif
 	    context = sws_getContext(w, h,
@@ -252,7 +252,7 @@
 	int flags = SWS_SPLINE;
 	struct SwsContext *context=NULL;
 	
-	#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+	#ifdef ADM_CPU_X86
 		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
 
 		ADD(MMX,MMX);
@@ -260,7 +260,7 @@
 		ADD(MMXEXT,MMX2);
 	#endif
 
-	#ifdef USE_ALTIVEC
+	#ifdef ADM_CPU_ALTIVEC
 	    flags |= SWS_CPU_CAPS_ALTIVEC;
 	#endif
 	    context = sws_getContext(w, h,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -21,8 +21,8 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
+
 #include &quot;ADM_assert.h&quot;
-#include &quot;ADM_assert.h&quot;
 
 #include &quot;config.h&quot;
 #include &quot;fourcc.h&quot;
@@ -130,7 +130,7 @@
 	REGISTERX(&quot;mpdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer denoise3d&quot;),QT_TR_NOOP(&quot;Reduce noise, smooth image, increase compressibility.&quot;),VF_MPLLQD3D,1,MPD3Dlow_create,MPD3Dlow_script);
 	REGISTERX(&quot;mphqdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer hqdn3d&quot;),QT_TR_NOOP(&quot;High quality version of denoise3d. Slower but more precise.&quot;),VF_MPLHQD3D,1,MPD3D_create,MPD3D_script);
 	REGISTERX(&quot;fluxsmooth&quot;,QT_TR_NOOP(&quot;FluxSmooth&quot;),QT_TR_NOOP(&quot;Spatio-temporal cleaner by Ross Thomas.&quot;),VF_FLUXSMOOTH,1,fluxsmooth_create,fluxsmooth_script);
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
     	REGISTERX(&quot;temporalcleaner&quot;,QT_TR_NOOP(&quot;Temporal Cleaner&quot;),QT_TR_NOOP(&quot;Vlad59's Avisynth port of Jim Casaburi's denoiser.&quot;),VF_VLADSMOOTH,1,vladsmooth_create,vladsmooth_script);
 #endif
 	REGISTERX(&quot;denoise&quot;,QT_TR_NOOP(&quot;Denoise&quot;),QT_TR_NOOP(&quot;Port of Transcode DNR.&quot;),VF_DENOISE,1,denoise_create,denoise_script);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_openDML/ADM_odml_odml.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_openDML/ADM_odml_odml.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_openDML/ADM_odml_odml.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -38,7 +38,7 @@
 
 //#define OPENDML_VERBOSE
 
-#if defined( __WIN32) || defined(ARCH_X86_64)
+#if defined( __WIN32) || defined(ADM_CPU_X86_64)
 	#define PPACKED __attribute__ ((packed, gcc_struct))
 #else
 	#define PPACKED 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -29,7 +29,7 @@
 	dvbsub.c xiph.c
 	sp5xdec.c nellymoserdec.c)
 
-IF(ARCH_X86)
+IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
 		i386/cputest.c
 		i386/mpegvideo_mmx.c     i386/vp3dsp_mmx.c 
@@ -38,7 +38,7 @@
 		i386/fft_sse.c i386/vp3dsp_sse2.c  
 		i386/idct_mmx_xvid.c i386/fft_3dn2.c 
 		i386/snowdsp_mmx.c i386/fft_3dn.c)
-ENDIF(ARCH_X86)
+ENDIF(ADM_CPU_X86)
 
 IF (ADM_CPU_ALTIVEC)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
@@ -57,3 +57,7 @@
 IF (USE_AMR_NB)
 	ADD_SOURCE_CFLAGS(amr.c -I${AMRNB_INCLUDE_DIR})
 ENDIF (USE_AMR_NB)
+
+INCLUDE(admLibavcodec)
+GET_LAVC_CFLAGS(LAVC_CFLAGS)
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${LAVC_CFLAGS}&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -7,4 +7,8 @@
 	flvenc.c matroskaenc.c)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I../ADM_lavcodec -I../ADM_lavutil -DHAVE_AV_CONFIG_H&quot;)
\ No newline at end of file
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I../ADM_lavcodec -I../ADM_lavutil -DHAVE_AV_CONFIG_H&quot;)
+
+INCLUDE(admLibavcodec)
+GET_LAVC_CFLAGS(LAVC_CFLAGS)
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${LAVC_CFLAGS}&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_lavutil/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -5,4 +5,8 @@
 	string.c)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_AV_CONFIG_H&quot;)
\ No newline at end of file
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_AV_CONFIG_H&quot;)
+
+INCLUDE(admLibavcodec)
+GET_LAVC_CFLAGS(LAVC_CFLAGS)
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${LAVC_CFLAGS}&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -1,8 +1,18 @@
-SET(ADM_LIB ADM_libMpeg2Dec)
-
-SET(${ADM_LIB}_SRCS 
-	alloc.c      cpu_state.c  header.c      idct_altivec.c  idct_mlib.c  motion_comp_alpha.c    motion_comp.c       motion_comp_mmx.c
-	cpu_accel.c  decode.c     idct_alpha.c  idct.c          idct_mmx.c   motion_comp_altivec.c  motion_comp_mlib.c  slice.c)
-
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DACCEL_DETECT&quot;)
\ No newline at end of file
+SET(ADM_LIB ADM_libMpeg2Dec)
+
+SET(${ADM_LIB}_SRCS 
+	alloc.c      cpu_state.c  header.c      idct_altivec.c  idct_mlib.c  motion_comp_alpha.c    motion_comp.c       motion_comp_mmx.c
+	cpu_accel.c  decode.c     idct_alpha.c  idct.c          idct_mmx.c   motion_comp_altivec.c  motion_comp_mlib.c  slice.c)
+
+ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DACCEL_DETECT&quot;)
+
+IF (ADM_CPU_X86)
+	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DARCH_X86&quot;)
+ELSEIF (ADM_CPU_ALTIVEC)
+	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DARCH_PPC&quot;)
+
+	IF (NOT __APPLE__)
+		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_ALTIVEC_H&quot;)
+	ENDIF (NOT __APPLE__)
+ENDIF (ADM_CPU_X86)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -23,3 +23,17 @@
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I${CMAKE_CURRENT_SOURCE_DIR}&quot;)
+
+IF (ADM_CPU_X86)
+	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_X86CPU&quot;)
+
+	IF (ADM_CPU_X86_64)
+		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_X86_64_CPU&quot;)
+	ENDIF (ADM_CPU_X86_64)
+ELSEIF (ADM_CPU_ALTIVEC)
+	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_ALTIVEC&quot;)
+
+	IF (NOT __APPLE__)
+		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_ALTIVEC_H&quot;)
+	ENDIF (NOT __APPLE__)
+ENDIF (ADM_CPU_X86)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -28,7 +28,7 @@
 #include &quot;default.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
 
-#if defined( HAVE_ALTIVEC ) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 int detect_altivec(){};
 #endif
 
@@ -40,7 +40,7 @@
 
 
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 
 static int x86_accel (void)
 {
@@ -57,7 +57,7 @@
 #endif   
 int cpu_accel (void)
 {
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
     static int got_accel = 0;
     static int accel;
 
@@ -68,7 +68,7 @@
 
     return accel;
 #endif
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
     return detect_altivec();
 #else
     return 0;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -31,7 +31,7 @@
  */
 
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;attributes.h&quot;
 #include &quot;mmx.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -1,5 +1,5 @@
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &lt;math.h&gt;
 #include &lt;unistd.h&gt;
 #include &quot;mjpeg_types.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -2,7 +2,7 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;mmx.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -21,7 +21,7 @@
 #include &lt;config.h&gt;
 #include &lt;stdio.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
 
 // These rely on mm7 being zero

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -20,7 +20,7 @@
 
 #include &lt;config.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -26,7 +26,7 @@
 
 #include &lt;config.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -31,7 +31,7 @@
 */
 
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;mmx.h&quot;
 #include &quot;mmxsse_motion.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -35,7 +35,7 @@
  */
 
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;attributes.h&quot;
 #include &quot;mmx.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -20,7 +20,7 @@
 
 #include &lt;config.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
 
 /*

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -6,7 +6,7 @@
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
 void enable_mmxsse_motion(int cpucap)
 {
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 	if(CpuCaps::hasMMXEXT())  /* AMD MMX or SSE... */
 	{
                 printf( &quot;[Mpeg2enc] MMXE motion \n&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -39,7 +39,7 @@
  * and verification.
  */
 #define STATIC static
-#if defined( HAVE_ALTIVEC ) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 //#include &quot;altivec/altivec_motion.h&quot;
 #  if ALTIVEC_TEST_MOTION
 #    undef STATIC
@@ -49,7 +49,7 @@
 
 
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmxsse_motion.h&quot;
 #endif
 
@@ -996,7 +996,7 @@
 	pbuild_sub44_mests = build_sub44_mests;
 	psubsample_image = subsample_image;
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 	printf(&quot;[Mpeg2enc]Enabling mmx motion search\n&quot;);
 	enable_mmxsse_motion(0);
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -67,7 +67,7 @@
 #include &quot;format_codes.h&quot;
 #include &quot;mpegconsts.h&quot;
 #include &quot;fastintfns.h&quot;
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 /* needed for ALTIVEC_BENCHMARK and print_benchmark_statistics() */
 #include &quot;../utils/altivec/altivec_conf.h&quot;
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -39,7 +39,7 @@
 #include &quot;format_codes.h&quot;
 #include &quot;mpegconsts.h&quot;
 #include &quot;fastintfns.h&quot;
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 /* needed for ALTIVEC_BENCHMARK and print_benchmark_statistics() */
 //#include &quot;../utils/altivec/altivec_conf.h&quot;
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -1187,7 +1187,7 @@
 	opt-&gt;enc_width = 16*mb_width;
 	opt-&gt;enc_height = 16*mb_height;
 
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 	/* Pad opt-&gt;phy_width to 64 so that the rowstride of 4*4
 	 * sub-sampled data will be a multiple of 16 (ideal for AltiVec)
 	 * and the rowstride of 2*2 sub-sampled data will be a multiple

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -25,7 +25,7 @@
 
 #include &lt;config.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -24,7 +24,7 @@
  */
  
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;mmx.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -20,7 +20,7 @@
 
 #include &lt;config.h&gt;
 #include &quot;mjpeg_types.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mmx.h&quot;
   
 void sub_pred_mmx(unsigned char *pred, unsigned char *cur, int lx, int16_t *blk)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -59,7 +59,7 @@
 #include &lt;stdio.h&gt;
 
 
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 #include &quot;altivec/altivec_predict.h&quot;
 #endif
 
@@ -301,7 +301,7 @@
                 printf(&quot;[Mpeg2enc] C predict (NO ACCEL)\n&quot;);
 	}
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 	else if(cpucap &amp; ACCEL_X86_MMXEXT ) /* AMD MMX or SSE... */
 	{
                 printf(&quot;[Mpeg2enc] MMXE predict\n&quot;);
@@ -313,7 +313,7 @@
 		ppred_comp = pred_comp_mmx;
 	}
 #endif
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
     else
 	{
 #  if ALTIVEC_TEST_PREDICT

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -25,7 +25,7 @@
 #include &quot;mjpeg_types.h&quot;
 #include &quot;simd.h&quot;
 #include &quot;predict_ref.h&quot;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 void pred_comp_mmxe(
 	uint8_t *src,
 	uint8_t *dst,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -22,7 +22,7 @@
  */
 
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &quot;mjpeg_types.h&quot;
 #include &quot;mmx.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -63,7 +63,7 @@
 #include &quot;simd.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
 
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 void enable_altivec_quantization(int op);//t-&gt;mpeg1);
 #endif
 
@@ -473,7 +473,7 @@
 {
   pquant_weight_coeff_sum = quant_weight_coeff_sum;
   piquant_non_intra = iquant_non_intra;
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef HAVE_X86CPU
         if(CpuCaps::hasMMX())
         {
                 printf(&quot;[Mpeg2enc]Using MMX quant non intra\n&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -29,7 +29,7 @@
 #include &lt;math.h&gt;
 #include &lt;string.h&gt;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef HAVE_X86CPU
 
 #include &quot;syntaxparams.h&quot;
 #include &quot;mjpeg_logging.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -98,7 +98,7 @@
 
 int luminance_mean(uint8_t *frame, int w, int h )
 {
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
         if(CpuCaps::hasMMX()) return luminance_mean_MMX(frame,w,h);
 #endif
         luminance_mean_C(frame,w,h);
@@ -121,14 +121,14 @@
 	sum=sum/(w*h);
 	return sum;
 }
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 // MEANX
 // code borrowed from ffmpeg by means
 
 static int pix_sum16_mmx(uint8_t * pix, int line_size)
 {
     const int h=16;
-#ifdef ARCH_X86_64
+#ifdef HAVE_X86_64_CPU
     long int rline_size=line_size;
     long int sum;
     long int index= -line_size*h;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -58,11 +58,11 @@
 #include &quot;cpu_accel.h&quot;
 #include &quot;simd.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#if defined( HAVE_ALTIVEC ) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 //#include &quot;../utils/altivec/altivec_transform.h&quot;
 #endif
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 
 	void add_pred_mmx (uint8_t *pred, uint8_t *cur,
 						  int lx, int16_t *blk) ;
@@ -192,7 +192,7 @@
 {
 
 	// By default use C implementation
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
                 if(CpuCaps::hasSSE())
                 {
 		  pfdct = mp2_fdct_sse;
@@ -224,7 +224,7 @@
 		psub_pred = sub_pred;
 		pfield_dct_best = field_dct_best;
                 printf(&quot;[Mpeg2enc] C idct/fdct\n&quot;);
-#if !defined( ARCH_X86)  &amp;&amp; !defined(ARCH_X86_64)
+#ifndef HAVE_X86CPU
 		printf(&quot;Because not X86 Arch\n&quot;);
 #endif
                 }
@@ -254,7 +254,7 @@
 		pfield_dct_best = field_dct_best;
 	}
 
-#if defined( HAVE_ALTIVEC) &amp;&amp; defined(USE_ALTIVEC)
+#ifdef HAVE_ALTIVEC
 	if (flags &gt; 0)
 	{
 #if ALTIVEC_TEST_TRANSFORM

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h	2008-03-05 11:49:06 UTC (rev 3825)
@@ -84,7 +84,7 @@
 void init_fdct (void);
 void init_idct (void);
 */
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 void init_mp2_fdct_sse();
 void mp2_fdct_sse( int16_t *blk );
 void mp2_idct_sse( int16_t *blk );

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc	2008-03-05 11:49:06 UTC (rev 3825)
@@ -22,7 +22,7 @@
 
 
 #include &lt;config.h&gt;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef HAVE_X86CPU
 #include &lt;math.h&gt;
 #include &quot;mjpeg_types.h&quot;
 #include &quot;syntaxparams.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libpostproc/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -6,6 +6,10 @@
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-I.. -DHAVE_AV_CONFIG_H  -O3 -I../.. -I../ADM_lavutil -Drestrict=__restrict__ -fomit-frame-pointer&quot;)
 
-IF(ARCH_X86_64)
+IF(ADM_CPU_X86_64)
 	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-msse&quot;)
-ENDIF(ARCH_X86_64)
\ No newline at end of file
+ENDIF(ADM_CPU_X86_64)
+
+INCLUDE(admLibavcodec)
+GET_LAVC_CFLAGS(LAVC_CFLAGS)
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${LAVC_CFLAGS}&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -26,7 +26,7 @@
 #include &quot;avio.hxx&quot;
 #include &quot;default.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -49,14 +49,14 @@
 
                            flags=SWS_BILINEAR;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
                 
                 #define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
                 ADD(MMX,MMX);           
                 ADD(3DNOW,3DNOW);
                 ADD(MMXEXT,MMX2);
-#endif  
-#ifdef USE_ALTIVEC
+#endif
+#ifdef ADM_CPU_ALTIVEC
                 flags|=SWS_CPU_CAPS_ALTIVEC;
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -1,7 +1,9 @@
 SET(ADM_LIB ADM_libswscale)
+SET(${ADM_LIB}_SRCS swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp)
 
-SET(${ADM_LIB}_SRCS 
-	swscale.c yuv2rgb.c rgb2rgb.c yuv2rgb_altivec.c ADM_mp.cpp)
+IF (ADM_CPU_ALTIVEC)
+	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} yuv2rgb_altivec.c)
+ENDIF (ADM_CPU_ALTIVEC)
 	
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DCONFIG_GPL -fomit-frame-pointer&quot;)
@@ -12,4 +14,8 @@
 	IF (ADM_DEBUG)
 		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-O2&quot;)
 	ENDIF (ADM_DEBUG)
-ENDIF (APPLE)
\ No newline at end of file
+ENDIF (APPLE)
+
+INCLUDE(admLibavcodec)
+GET_LAVC_CFLAGS(LAVC_CFLAGS)
+ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;${LAVC_CFLAGS}&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/yuv2rgb_altivec.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/yuv2rgb_altivec.c	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libswscale/yuv2rgb_altivec.c	2008-03-05 11:49:06 UTC (rev 3825)
@@ -80,7 +80,7 @@
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 #include &quot;config.h&quot;
-#ifdef USE_ALTIVEC
+
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
@@ -966,4 +966,3 @@
     }
 
 }
-#endif //MEANX

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2008-03-05 11:49:06 UTC (rev 3825)
@@ -12,3 +12,11 @@
 IF (NOT APPLE)
     ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} &quot;-DHAVE_MEMALIGN&quot;)
 ENDIF (NOT APPLE)
+
+IF (ADM_CPU_X86)
+    ADD_SOURCE_CFLAGS(cpu_accel.c &quot;-DHAVE_X86CPU&quot;)
+ENDIF (ADM_CPU_X86)
+
+IF (ADM_CPU_ALTIVEC)
+    ADD_SOURCE_CFLAGS(cpu_accel.c &quot;-DHAVE_ALTIVEC&quot;)
+ENDIF (ADM_CPU_ALTIVEC)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2008-03-05 11:49:06 UTC (rev 3825)
@@ -75,7 +75,7 @@
 /* Some miscelaneous stuff to allow checking whether SSE instructions cause
    illegal instruction errors.
 */
-
+#if !defined(__MINGW32__)
 static sigjmp_buf sigill_recover;
 
 static RETSIGTYPE sigillhandler(int sig )
@@ -84,11 +84,12 @@
 }
 
 typedef RETSIGTYPE (*__sig_t)(int);
+#endif
 
 static int testsseill()
 {
 	int illegal;
-#if defined(__CYGWIN__)
+#if defined(__CYGWIN__) || defined(__MINGW32__)
 	/* SSE causes a crash on CYGWIN, apparently.
 	   Perhaps the wrong signal is being caught or something along
 	   those line ;-) or maybe SSE itself won't work...

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -22,7 +22,7 @@
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -60,7 +60,7 @@
 
 	int flags = SWS_SPLINE;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 	#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
 
 	ADD(MMX,MMX);
@@ -68,7 +68,7 @@
 	ADD(MMXEXT,MMX2);
 #endif
 
-#ifdef USE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
     flags |= SWS_CPU_CAPS_ALTIVEC;
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -60,7 +60,7 @@
         
         return 1;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
 static uint8_t tinyAverageMMX(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {
 int delta;
@@ -118,7 +118,7 @@
 
 uint8_t ADMImage::merge(ADMImage *src1,ADMImage *src2)
 {
-#if 1 &amp;&amp; defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
         if(CpuCaps::hasMMX())
         {
                 tinyAverageMMX(YPLANE(this),YPLANE(src1),YPLANE(src2),(_width*_height*3)&gt;&gt;1);
@@ -149,7 +149,7 @@
         }
         return df;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
 static uint64_t noise64;
 static uint32_t computeDiffMMX(uint8_t  *s1,uint8_t *s2,uint32_t noise,uint32_t l)
 {
@@ -239,7 +239,7 @@
 uint32_t ADMImage::lumaDiff(ADMImage *src1,ADMImage *src2,uint32_t noise)
 {
 
-#if 1 &amp;&amp; defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
 uint32_t r1,r2;
         if(CpuCaps::hasMMX())
         {
@@ -279,7 +279,7 @@
                 }
         return 1;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
 static uint8_t tinySubstractMMX(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {
 int delta;
@@ -338,7 +338,7 @@
 uint8_t ADMImage::substract(ADMImage *src1,ADMImage *src2)
 {
 
-#if 1 &amp;&amp; defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#ifdef ADM_CPU_X86
 uint32_t r1,r2;
         if(CpuCaps::hasMMX())
         {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_pp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_pp.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_pp.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -63,7 +63,7 @@
 		{
 		uint32_t ppCaps=0;
 		
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 		
 	#define ADD(x,y) if( CpuCaps::has##x()) ppCaps|=PP_CPU_CAPS_##y;
 		
@@ -71,7 +71,7 @@
 		ADD(3DNOW,3DNOW);
 		ADD(MMXEXT,MMX2);
 #endif		
-#ifdef HAVE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 		ppCaps|=PP_CPU_CAPS_ALTIVEC;
 #endif	
 			pp-&gt;ppContext=pp_get_context(pp-&gt;w, pp-&gt;h, ppCaps

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/admmangle.h	2008-03-05 11:49:06 UTC (rev 3825)
@@ -7,13 +7,13 @@
 // Use rip-relative addressing if compiling PIC code on x86-64.
 #if defined(__MINGW32__) || defined(__CYGWIN__) || defined(__DJGPP__) || \
     defined(__OS2__) || (defined (__OpenBSD__) &amp;&amp; !defined(__ELF__))
-#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#    if defined(ADM_CPU_X86_64) &amp;&amp; defined(PIC)
 #        define MANGLE(a) &quot;_&quot; #a&quot;(%%rip)&quot;
 #    else
 #        define MANGLE(a) &quot;_&quot; #a
 #    endif
 #else
-#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#    if defined(ADM_CPU_X86_64) &amp;&amp; defined(PIC)
 #        define MANGLE(a) #a&quot;(%%rip)&quot;
 #    elif defined(__APPLE__)
 #        define MANGLE(a) &quot;_&quot; #a
@@ -26,7 +26,7 @@
 
 #define ADM_ALIGN16 &quot;.p2align 4\n&quot;
 /* Regiter renaming */
-#ifdef ARCH_X86_64
+#ifdef ADM_CPU_X86_64
 #define REG_a  &quot;rax&quot; 
 #define REGa    rax 
 #define REGb    rbx 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -35,7 +35,7 @@
 }
 
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; 
 {
 #include &quot;ADM_libraries/ADM_lavcodec/dsputil_cpu.h&quot;
@@ -63,7 +63,7 @@
 	myCpuMask=0xffffffff;
 	prefs-&gt;get(FEATURE_CPU_CAPS,&amp;myCpuMask);
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 int rval = 0;
  int eax, ebx, ecx, edx;
  int max_std_level, max_ext_level, std_caps=0, ext_caps=0;
@@ -144,7 +144,7 @@
 }
 
 /************************************************************************/
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 #include &quot;ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h&quot;
 #endif
 
@@ -152,7 +152,7 @@
 {
 int rval=0;
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 #undef MATCH
 #define MATCH(x,y) if(CpuCaps::myCpuCaps &amp; CpuCaps::myCpuMask &amp; ADM_CPU_##x) rval|=MPEG2_ACCEL_X86_##x;
 	
@@ -164,7 +164,7 @@
 	return rval;
 }
 //******************************************************
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 #include &quot;ADM_lavcodec.h&quot;
 #endif
 /**
@@ -175,7 +175,7 @@
 {
 int rval=0;
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 #undef MATCH
 #define MATCH(x,y) if(CpuCaps::myCpuCaps &amp;  CpuCaps::myCpuMask &amp; ADM_CPU_##x) rval|=MM_##x;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.h	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_cpuCap.h	2008-03-05 11:49:06 UTC (rev 3825)
@@ -9,7 +9,7 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#if defined(ARCH_X86_64) ||defined(ARCH_X86)
+#ifdef ADM_CPU_X86
 
 #define CHECK_Z(x) {if(CpuCaps::myCpuCaps &amp; ADM_CPU_##x &amp; CpuCaps::myCpuMask) return 1; else return 0;} 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_memcpy.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_memcpy.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -110,7 +110,7 @@
 */
 
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 
 
 /* for small memory blocks (&lt;256 bytes) this version is faster */
@@ -379,7 +379,7 @@
 static void *linux_kernel_memcpy(void *to, const void *from, size_t len) {
   return linux_kernel_memcpy_impl(to,from,len);
 }
-#endif /* ARCH_X86 */
+#endif /* ADM_CPU_X86 */
 
 static struct {
   char *name;
@@ -392,22 +392,20 @@
 {
   { NULL, NULL, 0, 0 },
   { &quot;libc memcpy()&quot;, memcpy, 0, 0 },
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
   { &quot;linux kernel memcpy()&quot;, linux_kernel_memcpy, 0, 0 },
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
   { &quot;MMX optimized memcpy()&quot;, mmx_memcpy, 0, MM_MMX },
   { &quot;MMXEXT optimized memcpy()&quot;, mmx2_memcpy, 0, MM_MMXEXT },
   { &quot;SSE optimized memcpy()&quot;, sse_memcpy, 0, MM_MMXEXT|MM_SSE },
-#endif
-#endif /* ARCH_X86 */
-#if 0 &amp;&amp; defined (ARCH_PPC) &amp;&amp; !defined (HOST_OS_DARWIN)
+#endif /* ADM_CPU_X86 */
+#if 0 &amp;&amp; defined (ADM_CPU_PPC) &amp;&amp; !defined (__APPLE__)
   { &quot;ppcasm_memcpy()&quot;, ppcasm_memcpy, 0, 0 },
   { &quot;ppcasm_cacheable_memcpy()&quot;, ppcasm_cacheable_memcpy, 0, MM_ACCEL_PPC_CACHE32 },
-#endif /* ARCH_PPC &amp;&amp; !HOST_OS_DARWIN */
+#endif /* ADM_CPU_PPC &amp;&amp; !__APPLE__ */
   { NULL, NULL, 0, 0 }
 };
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 static unsigned long long int rdtsc(void)
 {
   unsigned long long int x;
@@ -459,14 +457,14 @@
   int               config_flags = 0;
 #undef memcpy
         myAdmMemcpy=memcpy;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
         if(CpuCaps::hasMMX())
                 myAdmMemcpy=mmx_memcpy;
 #endif
 #if 0
 	probe(memcpy,&quot;libc&quot;);
 	probe(linux_kernel_memcpy,&quot;kernel&quot;);
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 	if(CpuCaps::hasMMX()) probe(mmx_memcpy,&quot;mmx&quot;);
 	if(CpuCaps::hasMMXEXT()) probe(mmx_memcpy,&quot;mmxext&quot;);
 	if(CpuCaps::hasSSE()) probe(sse_memcpy,&quot;sse&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -65,7 +65,7 @@
 			lutMeType *lutMe=apply_lut;
 			
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 	        if(CpuCaps::hasMMX())
 	        {
 	        		lutMe=affine_1d_MMX;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_interlaced.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_interlaced.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_interlaced.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -70,7 +70,7 @@
 		mm2 contains 4 bytes of n
 */
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_ILACING)
+#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_ILACING)
 
 static uint32_t      ADMVideo_interlaceCount_MMX( uint8_t *src ,uint32_t w, uint32_t h);
 static uint8_t *_l_p=NULL;
@@ -111,7 +111,7 @@
 
 uint32_t      ADMVideo_interlaceCount( uint8_t *src ,uint32_t w, uint32_t h)
 {
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_ILACING)  
+#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_ILACING)  
         if(CpuCaps::hasMMX())
                 return ADMVideo_interlaceCount_MMX(src,w,h);
         else
@@ -120,7 +120,7 @@
 
 }
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_ILACING)  
+#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_ILACING)  
 uint32_t      ADMVideo_interlaceCount_MMX( uint8_t *src ,uint32_t w, uint32_t h)
 {
 uint32_t m=0,y,x;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_video/ADM_vidMPdelogo.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -23,7 +23,7 @@
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 #include &quot;ADM_video/ADM_vidCommonFilter.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -185,7 +185,7 @@
   string[0]=0;
   
         cleanup();
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 #define ADD(x,y) if( CpuCaps::has##x()) ppCaps|=PP_CPU_CAPS_##y;                
                 ADD(MMX,MMX);           
                 ADD(3DNOW,3DNOW);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidBlend.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidBlend.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidBlend.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -39,7 +39,7 @@
 
 #include &quot;admmangle.h&quot;
 
-#ifdef ARCH_X86_64
+#ifdef ADM_CPU_X86_64
 static int64_t _l_w,_l_h;
 #else
  static int32_t _l_w,_l_h;
@@ -79,7 +79,7 @@
                  }
               }
 }
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 void ADMVideoFields::blend_MMX(uint8_t *p,uint8_t *c,
 																							uint8_t *n,
 																							uint8_t *e,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidDeintASM.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidDeintASM.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidDeintASM.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -37,7 +37,7 @@
 
 #include&quot;ADM_vidField.h&quot;
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 //	#define DEBUG_DEINT 1
 //	#define MMX_TRACE 1
 	#include &quot;ADM_video/mmx_macros.h&quot;
@@ -94,7 +94,7 @@
                       }
            }
 }
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 void ADMVideoFields::hasMotion_MMX(uint8_t *p,uint8_t *c,
 									uint8_t *n,
 									uint8_t *e,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -167,7 +167,7 @@
   w=_info.width;
   h=_info.height;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
   if(CpuCaps::hasMMX())
   {
         affine_1d_MMX(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
@@ -278,7 +278,7 @@
   par-&gt;lut_clean = 1;
 }
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 
 void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
   unsigned int w, unsigned int h)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h	2008-03-05 11:49:06 UTC (rev 3825)
@@ -52,7 +52,7 @@
   unsigned int w, unsigned int h);
 void create_lut (oneSetting *par);
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
                 unsigned int w, unsigned int h);
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFields.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFields.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFields.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -118,7 +118,7 @@
            e2=_motionmask2+w; 	
   //___________________ C version of motion detection ________________________
        // other line
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_DEINT)
+#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_DEINT)
        if(CpuCaps::hasMMX())  
       	hasMotion_MMX(p,c,n,e,e2);
        else
@@ -200,7 +200,7 @@
 		n++;
 		c++;
 	}
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_BLEND)
+#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_BLEND)
        if(CpuCaps::hasMMX())               
               blend_MMX(p,c,n,e2,f);
         else

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFlux.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFlux.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidFlux.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -274,7 +274,7 @@
 	nextp += src_pitch;
 	destp += dst_pitch;
 
-	#if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(ASM_FLUX)
+	#if defined(ADM_CPU_X86) &amp;&amp; defined(ASM_FLUX)
         if(CpuCaps::hasMMX())
         {
 		DoFilter_MMX(currp, prevp, nextp, src_pitch,
@@ -402,7 +402,7 @@
 	ADM_assert(ycnt == 0);
 
 }
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 /*
 	__asm movq mm2, mm0 \
 	__asm movq mm3, mm1 \

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -221,7 +221,7 @@
                 }
         return 1;
 }
-#if defined (ARCH_X86 ) || defined (ARCH_X86_64 )
+#ifdef ADM_CPU_X86
 static uint8_t tinyRestoreMMX(uint8_t *dst, uint8_t *srcP, uint8_t *src,uint8_t *srcN,uint8_t *srcNN,uint32_t w, uint32_t h)
 {
 
@@ -291,7 +291,7 @@
 uint8_t *s1,*s2,*d1;
 int a1,a2,t1;
 
-#if defined (ARCH_X86 ) || defined (ARCH_X86_64 )
+#ifdef ADM_CPU_X86
         if(CpuCaps::hasMMX())
         {
               tinyRestoreMMX(YPLANE(tgt),YPLANE(srcP),YPLANE(src),YPLANE(srcN),YPLANE(srcNN),tgt-&gt;_width,tgt-&gt;_height);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -36,7 +36,7 @@
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 #include &quot;ADM_video/ADM_vidCommonFilter.h&quot;
 
-#if (defined(ARCH_X86) || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -183,14 +183,13 @@
 						default:ADM_assert(0);
 
 					}
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-		
+#ifdef ADM_CPU_X86		
 		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
 		ADD(MMX,MMX);		
 		ADD(3DNOW,3DNOW);
 		ADD(MMXEXT,MMX2);
 #endif	
-#ifdef USE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 		flags|=SWS_CPU_CAPS_ALTIVEC;
 #endif
 				    _context=sws_getContext(

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -303,7 +303,7 @@
   int val;
 
   // Vertical only for now      
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
   if(CpuCaps::hasMMX())
   {
   int off;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMosaic.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -34,7 +34,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
 
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }
@@ -131,7 +131,7 @@
                 flags=SWS_BICUBIC;
 
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
                 
                 #define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
                 ADD(MMX,MMX);           

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMsmooth.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMsmooth.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidMsmooth.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -32,9 +32,12 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
+
+#if defined(ADM_CPU_ALTIVEC) &amp;&amp; !defined(__APPLE__)
+#include &lt;altivec.h&gt;
+#endif
+
 #include &quot;ADM_assert.h&quot;
-
-#include &quot;config.h&quot;
 #include &quot;fourcc.h&quot;
 #include &quot;avio.hxx&quot;
 #include &quot;avi_vars.h&quot;
@@ -42,7 +45,7 @@
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include&quot;ADM_video/ADM_cache.h&quot;
+#include &quot;ADM_video/ADM_cache.h&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_FILTER
@@ -53,9 +56,6 @@
 
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
 
-#ifdef HAVE_ALTIVEC_H
-#include &quot;altivec.h&quot;
-#endif
 #if 0
 #undef aprintf
 #define aprintf printf
@@ -84,10 +84,10 @@
 extern  void 	DrawStringYUY2(uint8_t *dst, int x, int y, const char *s); 
 
 static void Blur_C(uint8_t *in, uint8_t *out, uint32_t w, uint32_t h) ;
-#ifdef HAVE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 void Blur_Altivec(uint8_t *in, uint8_t *out, uint32_t w, uint32_t h);
 #endif
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 void Blur_MMX(uint8_t *in, uint8_t *out, uint32_t w, uint32_t h);
 #endif
 class Msmooth : public AVDMGenericVideoStream
@@ -392,7 +392,7 @@
 }
 
 
-#ifdef HAVE_ALTIVEC
+#ifdef ADM_CPU_ALTIVEC
 #define vecbyte vector unsigned char
 #define vect16 vector unsigned short
 
@@ -485,7 +485,7 @@
 }
 #endif
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 //______________________
 void Blur_MMX(uint8_t *in, uint8_t *out, uint32_t w, uint32_t h)
 {
@@ -603,7 +603,7 @@
 	int y1, y2, y3, y4;
 
 	/* Blur the source image prior to detail detection. */
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 		//printf(&quot;MMX\n&quot;);
 	if(CpuCaps::hasMMX())
 	{
@@ -612,7 +612,7 @@
 	}
 	else
 	#endif
-	#ifdef HAVE_ALTIVEC
+	#ifdef ADM_CPU_ALTIVEC
 	#define ISALIGNED(x) (!( ((long long)x)&amp;15 ))
 		if( ISALIGNED(srcp) &amp;&amp; ISALIGNED(blurp) &amp;&amp; ISALIGNED(workp) &amp;&amp; ISALIGNED(maskp) &amp;&amp; !(src_pitch&amp;15))
 		{

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -173,7 +173,7 @@
                 CSET(use_linear);
                 return 1;
 }
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 static uint64_t low,high;
 static void blendMMX(uint8_t *src, uint8_t *src2, uint8_t *dst, uint8_t alpha, uint8_t beta,uint32_t count)
 {
@@ -321,7 +321,7 @@
         
       count = page;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
         if(CpuCaps::hasMMX())
                 blendMMX(in1,in2,out,lowweight,highweight,(count*3)&gt;&gt;1);
         else

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVlad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVlad.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVlad.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -41,13 +41,13 @@
 
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
 
-#if  defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86_64
 #define COUNTER long int
 #else
 #define COUNTER int
 #endif
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 static void ProcessCPlane_mmxe(unsigned char *source,
 				   unsigned char *prev,
 				   unsigned char* dest,
@@ -147,7 +147,7 @@
 
 	ProcessYPlane = ProcessYPlane_C;
 	ProcessCPlane = ProcessCPlane_C;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 #if 0
 // Check
 	if(CpuCaps::hasMMXEXT() &amp;&amp; (_info.width&amp;7) == 0)
@@ -271,7 +271,7 @@
 	} while(++i &lt; 0);
 }
 
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 void ProcessYPlane_mmxe( unsigned char *source,
 				    unsigned char *prev,
 				    unsigned char* dest,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -65,7 +65,7 @@
 #include &quot;ADM_vobsubinfo.h&quot;
 #include &quot;ADM_vidVobSub.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot; {
 #include &quot;ADM_libraries/ADM_lavcodec/avcodec.h&quot;
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -54,7 +54,7 @@
 #define MAX3(a,b,c) MAX(MAX(a,b),c)
 
 //===========================================================================//
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 extern &quot;C&quot;
 {
 void filter_line_mmx2(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity);
@@ -401,7 +401,7 @@
 void (*filter_line)(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity);
 	int y;
 	filter_line = filter_line_c;
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 	if (CpuCaps::hasMMXEXT()) 
 		filter_line = filter_line_mmx2;
 #endif
@@ -421,7 +421,7 @@
         }
         memcpy(dst + (h-1)*dst_stride, cur0 + (h-1)*refs, w);
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 	if (CpuCaps::hasMMXEXT()) 
 		asm volatile(&quot;emms&quot;);
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c	2008-03-05 11:49:06 UTC (rev 3825)
@@ -9,7 +9,7 @@
 #include &quot;default.h&quot;
 #include &quot;admmangle.h&quot;
 
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+#ifdef ADM_CPU_X86
 
 
 #define LOAD4(mem,dst) \

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADMmpdetc.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADMmpdetc.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADMmpdetc.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -57,7 +57,7 @@
 						int dstStride, int srcStride);
 unsigned int 	hash_pic(unsigned char *img, int w, int h, int stride);
 static void 	block_diffs_C(struct metrics *m, unsigned char *old, unsigned char *nw, int os, int ns);
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
+#ifdef ADM_CPU_X86
 void block_diffs_MMX(struct metrics *m, unsigned char *old, unsigned char *ew, int os, int ns);
 #endif
 static void 	diff_planes(struct metrics *m, unsigned char *old, unsigned char *nw, int w, int h, int os, int ns);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2008-03-05 11:49:06 UTC (rev 3825)
@@ -157,11 +157,11 @@
 	printf(&quot;Linux&quot;);
 #endif
 
-#if defined(ARCH_X86_32)
+#if defined(ADM_CPU_X86_32)
 	printf(&quot; (x86)&quot;);
-#elif defined(ARCH_X86_64)
+#elif defined(ADM_CPU_X86_64)
 	printf(&quot; (x86-64)&quot;);
-#elif defined(ARCH_POWERPC)
+#elif defined(ADM_CPU_PPC)
 	printf(&quot; (PowerPC)&quot;);
 #endif
 

Copied: branches/avidemux_2.5_branch_gruntster/cmake/admLibavcodec.cmake (from rev 3824, branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admLibavcodec.cmake	2008-03-05 11:49:06 UTC (rev 3825)
@@ -0,0 +1,84 @@
+# this is a temporary hack. Libavcodec should have it's own config file.
+
+MACRO (SET_LAVC_CONFIG_FLAGS)
+	SET(CONFIG_ENCODERS 1)
+	SET(CONFIG_DVVIDEO_ENCODER 1)
+
+	SET(CONFIG_DECODERS 1)
+	SET(CONFIG_DVVIDEO_DECODER 1)
+	SET(CONFIG_H263_DECODER 1)
+	SET(CONFIG_MPEG4_DECODER 1)
+	SET(CONFIG_MPEGAUDIO_HP 1)
+	SET(CONFIG_SNOW_DECODER 1)
+	SET(CONFIG_VC1_DECODER 1)
+	SET(CONFIG_WMV2_DECODER 1)
+	SET(CONFIG_WMV3_DECODER 1)
+	SET(CONFIG_ZLIB 1)
+
+	SET(CONFIG_MUXERS 1)
+	SET(CONFIG_MOV_MUXER 1)
+	SET(CONFIG_MP4_MUXER 1)
+	SET(CONFIG_PSP_MUXER 1)
+	SET(CONFIG_TG2_MUXER 1)
+	SET(CONFIG_TGP_MUXER 1)
+
+	SET(ENABLE_THREADS 1)
+	SET(HAVE_LRINTF 1)
+	SET(HAVE_THREADS 1)
+	SET(RUNTIME_CPUDETECT 1)
+
+	IF (ADM_CPU_X86)
+		SET(ENABLE_MMX 1)
+		SET(HAVE_MMX 1)
+		SET(HAVE_FAST_UNALIGNED 1)
+
+		IF (ADM_CPU_X86_64)
+			SET(HAVE_FAST_64BIT 1)
+		ENDIF (ADM_CPU_X86_64)
+	ELSE (ADM_CPU_X86)
+		SET(ENABLE_MMX 0)
+	ENDIF (ADM_CPU_X86)
+
+	IF (APPLE)
+		SET(CONFIG_DARWIN 1)
+	ENDIF (APPLE)
+
+	########################################
+	# Check GCC support for SSSE3
+	########################################
+	IF (ADM_CPU_X86)
+		ADM_COMPILE(cpu_ssse3_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; SSSE3_SUPPORTED outputSsse3Test)
+
+		IF (SSSE3_SUPPORTED)
+			SET(HAVE_SSSE3 1)
+
+			MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - Yes&quot;)
+		ELSE (SSSE3_SUPPORTED)
+			MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - No&quot;)
+
+			IF (VERBOSE)
+				MESSAGE(&quot;Error Message: ${outputSsse3Test}&quot;)
+			ENDIF (VERBOSE)	
+		ENDIF (SSSE3_SUPPORTED)
+	ENDIF (ADM_CPU_X86)
+
+	MESSAGE(&quot;&quot;)
+ENDMACRO (SET_LAVC_CONFIG_FLAGS)
+
+MACRO (GET_LAVC_CFLAGS varToSet)
+	IF (ADM_CPU_X86)
+		SET(${varToSet} &quot;-DARCH_X86 -DARCH_X86_32&quot;)
+	ELSEIF (ADM_CPU_X86_64)
+		SET(${varToSet} &quot;-DARCH_X86 -DARCH_X86_64&quot;)
+	ELSEIF (ADM_CPU_PPC)
+		SET(${varToSet} &quot;-DARCH_POWERPC&quot;)
+
+		IF (ADM_CPU_ALTIVEC)
+			SET(${varToSet} &quot;${${varToSet}} -DHAVE_ALTIVEC&quot;)
+
+			IF (NOT APPLE)
+				SET(${varToSet} &quot;${${varToSet}} -DHAVE_ALTIVEC_H&quot;)
+			ENDIF (NOT APPLE)
+		ENDIF (ADM_CPU_ALTIVEC)
+	ENDIF (ADM_CPU_X86)
+ENDMACRO (GET_LAVC_CFLAGS)
\ No newline at end of file

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admSetLavcodecFlags.cmake	2008-03-05 11:49:06 UTC (rev 3825)
@@ -1,62 +0,0 @@
-SET(CONFIG_ENCODERS 1)
-SET(CONFIG_DVVIDEO_ENCODER 1)
-
-SET(CONFIG_DECODERS 1)
-SET(CONFIG_DVVIDEO_DECODER 1)
-SET(CONFIG_H263_DECODER 1)
-SET(CONFIG_MPEG4_DECODER 1)
-SET(CONFIG_MPEGAUDIO_HP 1)
-SET(CONFIG_SNOW_DECODER 1)
-SET(CONFIG_VC1_DECODER 1)
-SET(CONFIG_WMV2_DECODER 1)
-SET(CONFIG_WMV3_DECODER 1)
-SET(CONFIG_ZLIB 1)
-
-SET(CONFIG_MUXERS 1)
-SET(CONFIG_MOV_MUXER 1)
-SET(CONFIG_MP4_MUXER 1)
-SET(CONFIG_PSP_MUXER 1)
-SET(CONFIG_TG2_MUXER 1)
-SET(CONFIG_TGP_MUXER 1)
-
-SET(ENABLE_THREADS 1)
-SET(HAVE_LRINTF 1)
-SET(HAVE_THREADS 1)
-SET(RUNTIME_CPUDETECT 1)
-
-IF (ADM_CPU_X86)
-	SET(ENABLE_MMX 1)
-	SET(HAVE_MMX 1)
-	SET(HAVE_FAST_UNALIGNED 1)
-
-	IF (ADM_CPU_X86_64)
-		SET(HAVE_FAST_64BIT 1)
-	ENDIF (ADM_CPU_X86_64)
-ELSE (ADM_CPU_X86)
-	SET(ENABLE_MMX 0)
-ENDIF (ADM_CPU_X86)
-
-IF (APPLE)
-	SET(CONFIG_DARWIN 1)
-ENDIF (APPLE)
-
-########################################
-# Check GCC support for SSSE3
-########################################
-IF (ADM_CPU_X86)
-	ADM_COMPILE(cpu_ssse3_check.cpp &quot;&quot; &quot;&quot; &quot;&quot; SSSE3_SUPPORTED outputSsse3Test)
-
-	IF (SSSE3_SUPPORTED)
-		SET(HAVE_SSSE3 1)
-
-		MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - Yes&quot;)
-	ELSE (SSSE3_SUPPORTED)
-		MESSAGE(STATUS &quot;Check if GCC supports SSSE3 - No&quot;)
-
-		IF (VERBOSE)
-			MESSAGE(&quot;Error Message: ${outputSsse3Test}&quot;)
-		ENDIF (VERBOSE)	
-	ENDIF (SSSE3_SUPPORTED)
-ENDIF (ADM_CPU_X86)
-
-MESSAGE(&quot;&quot;)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-03-04 20:54:48 UTC (rev 3824)
+++ branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-03-05 11:49:06 UTC (rev 3825)
@@ -14,7 +14,7 @@
 /* Jog Shuttle */
 #cmakedefine USE_JOG
 
-/* Big endian CPU - SPARC or PowerPC */
+/* Big endian CPU */
 #cmakedefine ADM_BIG_ENDIAN
 
 #define PACKAGE   &quot;avidemux&quot;
@@ -33,21 +33,6 @@
 /* AMR_NB */
 #cmakedefine AMR_NB
 
-/* Enable PowerPC optim */
-#cmakedefine ARCH_POWERPC
-
-/* AltiVec for libmpeg2 */
-#cmakedefine ARCH_PPC
-
-/* post proc */
-#cmakedefine ARCH_X86
-
-/* X86_32 assembly */
-#cmakedefine ARCH_X86_32
-
-/* X86_64 AMD64 assembly */
-#cmakedefine ARCH_X86_64
-
 /* FFMPEG */
 #cmakedefine CONFIG_ENCODERS
 #cmakedefine CONFIG_DVVIDEO_ENCODER
@@ -82,12 +67,6 @@
 #cmakedefine HAVE_SSSE3
 #cmakedefine CONFIG_DARWIN
 
-/* AltiVec for mpeg2enc */
-#cmakedefine HAVE_ALTIVEC
-
-/* Enable AltiVec by default */
-#cmakedefine HAVE_ALTIVEC_H
-
 /* FontConfig detected */
 #cmakedefine HAVE_FONTCONFIG
 
@@ -134,9 +113,6 @@
 #cmakedefine USE_AFTEN_07	// 0.07
 #cmakedefine USE_AFTEN_08	// 0.0.8
 
-/* AltiVec for mpeg2enc */
-#cmakedefine USE_ALTIVEC
-
 /* Tell avidemux to use libamrnb */
 #cmakedefine USE_AMR_NB
 
@@ -216,7 +192,7 @@
 /* Version number of package */
 #define VERSION &quot;${VERSION}&quot;
 
-/* Big endian CPU - SPARC or PowerPC */
+/* Big endian CPU */
 #cmakedefine WORDS_BIGENDIAN
 
 /* use Nvwa memory leak detector */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001090.html">[Avidemux-svn-commit] r3824 - in	branches/avidemux_2.5_branch_gruntster: .	avidemux/ADM_audiocodec avidemux/ADM_codecs	avidemux/ADM_libraries/ADM_libMad	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_smjs	avidemux/ADM_libraries/ADM_utilities avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_videoFilter cmake
</A></li>
	<LI>Next message: <A HREF="001092.html">[Avidemux-svn-commit] r3826 - in	branches/avidemux_2.5_branch_gruntster: .	avidemux/ADM_inputs/ADM_nuv avidemux/ADM_libraries/ADM_lavcodec	avidemux/ADM_libraries/ADM_lavformat	avidemux/ADM_libraries/ADM_lavutil avidemux/ADM_libraries/ADM_libMad	avidemux/ADM_libraries/ADM_libMpeg2Dec	avidemux/ADM_libraries/ADM_liba52	avidemux/ADM_libraries/ADM_libpostproc	avidemux/ADM_libraries/ADM_libswscale	avidemux/ADM_libraries/ADM_mplex avidemux/ADM_osSupport	avidemux/ADM_userInterfaces/ADM_commonUI cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1091">[ date ]</a>
              <a href="thread.html#1091">[ thread ]</a>
              <a href="subject.html#1091">[ subject ]</a>
              <a href="author.html#1091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
