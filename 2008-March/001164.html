<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3901 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiocodec avidemux/ADM_core/src avidemux/ADM_libraries	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca	avidemux/plugins/ADM_audiodecoder/ADM_ad_faad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3901%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_audiocodec%20avidemux/ADM_core/src%20avidemux/ADM_libraries%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/plugins/ADM_audiodecoder%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_dca%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_faad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_mad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis%20cmake&In-Reply-To=%3C200803161753.m2GHrA8g016811%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001163.html">
   <LINK REL="Next"  HREF="001165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3901 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiocodec avidemux/ADM_core/src avidemux/ADM_libraries	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca	avidemux/plugins/ADM_audiodecoder/ADM_ad_faad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3901%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_audiocodec%20avidemux/ADM_core/src%20avidemux/ADM_libraries%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/plugins/ADM_audiodecoder%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_dca%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_faad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_mad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad%0A%09avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis%20cmake&In-Reply-To=%3C200803161753.m2GHrA8g016811%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3901 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_audiocodec avidemux/ADM_core/src avidemux/ADM_libraries	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3	avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca	avidemux/plugins/ADM_audiodecoder/ADM_ad_faad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad	avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad	avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis cmake">mean at mail.berlios.de
       </A><BR>
    <I>Sun Mar 16 18:53:10 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001163.html">[Avidemux-svn-commit] r3900 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries/ADM_libwrapper	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca cmake
</A></li>
        <LI>Next message: <A HREF="001165.html">[Avidemux-svn-commit] r3902 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_audiocodec ADM_libraries/ADM_ffmpeg/ADM_lavcodec	ADM_userInterfaces/ADM_commonUI plugins/ADM_audiodecoder	plugins/ADM_audiodecoder/ADM_ad_amrnb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1164">[ date ]</a>
              <a href="thread.html#1164">[ thread ]</a>
              <a href="subject.html#1164">[ subject ]</a>
              <a href="author.html#1164">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-03-16 18:53:08 +0100 (Sun, 16 Mar 2008)
New Revision: 3901

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_pluginLoad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_dynamicLoading.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_ad_a52.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/ADM_ad_faad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/ADM_ad_vorbis.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/ad_plugin.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
Log:
[AudioDecoder] Make faad/dca works, dts untested


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -25,8 +25,8 @@
 #include &quot;fourcc.h&quot;
 #include &quot;ADM_audio/aviaudio.hxx&quot;
 #include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
-#include &quot;ADM_libraries/ADM_libwrapper/libwrapper_global.h&quot;
 
+
 extern ADM_Audiocodec *ADM_ad_searchCodec(uint32_t fourcc,	WAVHeader *info,uint32_t extraLength,uint8_t *extraData);
 
 ADM_Audiocodec	*getAudioCodec(uint32_t fourcc,WAVHeader *info,uint32_t extra,uint8_t *extraData)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.h	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.h	2008-03-16 17:53:08 UTC (rev 3901)
@@ -83,24 +83,7 @@
 };
 
 
-#ifdef USE_LIBDCA
-class ADM_AudiocodecDCA : public     ADM_Audiocodec
-{
-	protected:
-		void *dts_handle;
 
-	public:
-		ADM_AudiocodecDCA(uint32_t fourcc, WAVHeader *info);
-		virtual	~ADM_AudiocodecDCA();
-		virtual	uint8_t beginDecompress(void);
-		virtual	uint8_t endDecompress(void);
-		virtual	uint8_t run(uint8_t *inptr, uint32_t nbIn, float *outptr, uint32_t *nbOut);
-		virtual	uint8_t isCompressed(void) {return 1;}
-		virtual	uint8_t isDecompressable(void) {return 1;}
-
-   };
-#endif
-
 class ADM_Audiocodec8Bits : public     ADM_Audiocodec
 {
 	protected:

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_pluginLoad.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_pluginLoad.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -21,6 +21,12 @@
 #include &quot;ADM_toolkit/filesel.h&quot;
 #include &quot;ADM_dynamicLoading.h&quot;
 #include &lt;vector&gt;
+#if 1
+#define aprintf printf
+#else
+#define aprintf(...) {}
+#endif
+
 /**
  * 
  */
@@ -34,6 +40,7 @@
 	ADM_ad_GetDecoderVersion	*getDecoderVersion;
 	ADM_ADM_ad_GetInfo			*getInfo;
 	ADM_LibWrapper				*wrapper;
+	const char 					*name;
 };
 
 std::vector&lt;ADM_ad_plugin *&gt; ADM_audioPlugins;
@@ -48,7 +55,7 @@
 	ADM_LibWrapper *wrapper=new ADM_LibWrapper;
 	 if(true!=wrapper-&gt;loadLibrary(file))
 	 {
-		 printf(&quot;Load failed\n&quot;);
+		 printf(&quot;[ADM_ad_plugin] LoadLibrary failed for %s\n&quot;,ADM_GetFileName(file));
 		 goto Err_ad;
 	 }
 #define FUNCKY(a,b,c)	 blank.a=(b *)wrapper-&gt;getSymbol(#c); if(!blank.a) { printf(&quot;[ADM_ad_plugin]&quot;#c&quot; failed\n&quot;); goto Err_ad;;}
@@ -71,6 +78,7 @@
 	 const char *desc;
 	 blank.getDecoderVersion(&amp;major,&amp;minor,&amp;patch);
 	 blank.wrapper=wrapper;
+	 blank.name=ADM_strdup(ADM_GetFileName(file));
 	 desc=blank.getInfo();
 	 // Print out stuff
 	 printf(&quot;[ADM_ad_plugin] Plugin loaded version %d.%d.%d, desc : %s\n&quot;,major,minor,patch,desc);
@@ -133,7 +141,7 @@
 		ADM_ad_plugin *a=ADM_audioPlugins[i];
 		ADM_assert(a);
 		ADM_assert(a-&gt;supportedFormat);
-		
+		aprintf(&quot;Format 0x%x : probing %s\n&quot;,fourcc,a-&gt;name);
 		if(a-&gt;supportedFormat(fourcc)==true)
 		{
 			ADM_assert(a-&gt;create);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,6 +1,6 @@
 SET(ADM_audiocodec_SRCS
 	ADM_8bits.cpp  ADM_codecimaadpcm.cpp  ADM_codecmsadpcm.cpp  ADM_codeculaw.cpp  ADM_codecwma.cpp  ADM_lpcm.cpp
-	ADM_audiocodec.cpp  ADM_codecwav.cpp  ADM_dca.cpp  ADM_pluginLoad.cpp)
+	ADM_audiocodec.cpp  ADM_codecwav.cpp  ADM_pluginLoad.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_audiocodec ${ADM_audiocodec_SRCS})
 
@@ -8,7 +8,3 @@
 	ADD_SOURCE_CFLAGS(ADM_audiocodec.cpp -I${AMRNB_INCLUDE_DIR})
 ENDIF (USE_AMR_NB)
 
-IF (USE_LIBDCA)
-	ADD_SOURCE_CFLAGS(ADM_audiocodec.cpp -I${LIBDCA_INCLUDE_DIR})
-	ADD_SOURCE_CFLAGS(ADM_dca.cpp -I${LIBDCA_INCLUDE_DIR})
-ENDIF (USE_LIBDCA)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_dynamicLoading.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_dynamicLoading.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_dynamicLoading.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -90,11 +90,11 @@
 		return true;
 	}
 #else
-	hinstLib = dlopen(path, RTLD_NOW);
+	hinstLib = dlopen(path, RTLD_NOW | RTLD_GLOBAL);
 	
 	if (hinstLib == NULL)
 	{
-		aprintf(&quot;Unable to load [%s]: %s\n&quot;, path, dlerror());
+		printf(&quot;Unable to load [%s]: %s\n&quot;, path, dlerror());
 
 		return false;
 	}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,7 +1,6 @@
 subdirs (PREORDER ADM_ffmpeg)
 subdirs (PREORDER ADM_libmpeg2enc)
 subdirs (PREORDER ADM_libtwolame)
-subdirs (PREORDER ADM_libwrapper)
 subdirs (PREORDER ADM_lvemux)
 subdirs (PREORDER ADM_mplex)
 subdirs (PREORDER ADM_smjs)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -32,7 +32,6 @@
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;ADM_assert.h&quot;
-#include &quot;ADM_libraries/ADM_libwrapper/libwrapper_global.h&quot;
 
 /**
     \fn DIA_builtin(void)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -237,7 +237,6 @@
 	ADM_mplex
 	ADM_libmpeg2enc
 	ADM_libtwolame
-	ADM_libwrapper
 	ADM_lvemux
 	ADM_utilities
 	ADM_xvidratectl

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -33,7 +33,6 @@
 #include &quot;prefs.h&quot;
 #include &quot;ADM_audiodevice/audio_out.h&quot;
 #include &quot;ADM_toolkit/ADM_intfloat.h&quot;
-#include &quot;ADM_libraries/ADM_libwrapper/libwrapper_global.h&quot;
 
 #ifdef USE_XVID_4
 extern void xvid4_init(void);
@@ -263,9 +262,7 @@
     buildDistMatrix();
     initScaleTab();
 
-    COL_init();
-	initLibWrappers();
-	
+    COL_init();	
     if(SpidermonkeyInit() == true)
         printf(&quot;Spidermonkey initialized.\n&quot;);
     else
@@ -293,7 +290,6 @@
     pthread_mutex_unlock(&amp;g_pSpiderMonkeyMutex);
     destroyPrefs();
     filterCleanUp();
-	destroyLibWrappers();
 	ADM_lavDestroy();
 
 #ifdef USE_SDL

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_ad_a52.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_ad_a52.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_ad_a52.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -43,7 +43,7 @@
    };
 // Supported formats + declare our plugin
 //*******************************************************
-   uint32_t Formats[]={WAV_AC3};
+   static  uint32_t Formats[]={WAV_AC3};
    DECLARE_AUDIO_DECODER(ADM_AudiocodecAC3,						// Class
 		   	0,0,1, 												// Major, minor,patch 
 		   	Formats, 											// Supported formats

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/ADM_liba52/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -15,4 +15,6 @@
 
 IF (ADM_BIG_ENDIAN)
 	ADD_TARGET_CFLAGS(${ADM_LIB} -DWORDS_BIGENDIAN)
-ENDIF (ADM_BIG_ENDIAN)
\ No newline at end of file
+ENDIF (ADM_BIG_ENDIAN)
+
+INIT_AUDIO_PLUGIN(${ADM_LIB})
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_ac3/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,5 +1,4 @@
 INCLUDE(ad_plugin)
-INIT_AUDIO_PLUGIN()
 
 ADD_SUBDIRECTORY(ADM_liba52)
 
@@ -8,8 +7,5 @@
 ADD_LIBRARY(ADM_ad_a52 SHARED ${ADM_ad_a52_SRCS})
 TARGET_LINK_LIBRARIES(ADM_ad_a52 ADM_liba52)
 
-IF (WIN32 OR APPLE)
-	TARGET_LINK_LIBRARIES(ADM_ad_a52 ADM_core)
-ENDIF (WIN32 OR APPLE)
-
-INSTALL_AUDIODECODER(ADM_ad_a52)
\ No newline at end of file
+INIT_AUDIO_PLUGIN(ADM_ad_a52)
+INSTALL_AUDIODECODER(ADM_ad_a52)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/ADM_dca.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -15,22 +15,89 @@
  *                                                                         *
  ***************************************************************************/
 #include &lt;math.h&gt;
-
-#include &quot;config.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_ad_plugin.h&quot;
+#ifdef USE_LIBDCA_002
+extern &quot;C&quot; {
+#include &quot;dts.h&quot;
+}
+#define LIBDCA_STATE dts_state_t
+#define DTS(x) DTS_##x
+#else
+extern &quot;C&quot; {
+#include &quot;dca.h&quot;
+}
+#define LIBDCA_STATE dca_state_t
+#define DTS(x) DCA_##x 
+#endif
 
-#include &quot;ADM_audio/aviaudio.hxx&quot;
-#include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
+#define DTS_HEADER_SIZE (10)
 
-#include &quot;prefs.h&quot;
+class ADM_AudiocodecDCA : public     ADM_Audiocodec
+{
+	protected:
+		void *dts_handle;
 
-#ifdef USE_LIBDCA
-#include &quot;ADM_audio/ADM_dcainfo.h&quot;
-#include &quot;ADM_libraries/ADM_libwrapper/libwrapper_global.h&quot;
+	public:
+		ADM_AudiocodecDCA(uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d);
+		virtual	~ADM_AudiocodecDCA();
+		virtual	uint8_t beginDecompress(void);
+		virtual	uint8_t endDecompress(void);
+		virtual	uint8_t run(uint8_t *inptr, uint32_t nbIn, float *outptr, uint32_t *nbOut);
+		virtual	uint8_t isCompressed(void) {return 1;}
+		virtual	uint8_t isDecompressable(void) {return 1;}
 
-#define DTS_HANDLE ((dts_state_t *)dts_handle)
+   };
+typedef struct
+{
+		int (*dts_block)(LIBDCA_STATE* state);
+		int (*dts_blocks_num) (LIBDCA_STATE* state);
+		int (*dts_frame) (LIBDCA_STATE* state, uint8_t* buf, int* flags, level_t* level, sample_t bias);
+		void (*dts_free) (LIBDCA_STATE* state);
+		LIBDCA_STATE* (*dts_init) (uint32_t mm_accel);
+		sample_t* (*dts_samples) (LIBDCA_STATE* state);
+		int (*dts_syncinfo) (LIBDCA_STATE* state, uint8_t* buf, int* flags, int* sample_rate, int* bit_rate, int* frame_length);
+}DCA_func_struct;
+#ifdef USE_LIBDCA_002
+DCA_func_struct dcaFunctions=
+{
+	dts_block, 
+	dts_blocks_num, 
+	dts_frame, 
+	dts_free, 
+	dts_init,
+	dts_samples, 
+	dts_syncinfo
+};	
+#else // 05
+DCA_func_struct dcaFunctions=
+{
+	dca_block, 
+	dca_blocks_num, 
+	dca_frame, 
+	dca_free, 
+	dca_init,
+	dca_samples, 
+	dca_syncinfo
+};	
+#endif
 
-ADM_AudiocodecDCA::ADM_AudiocodecDCA( uint32_t fourcc, WAVHeader *info) :   ADM_Audiocodec(fourcc)
+DCA_func_struct *dca=&dcaFunctions;
+
+#define DTS_HANDLE ((LIBDCA_STATE *)dts_handle)
+// Supported formats + declare our plugin
+//*******************************************************
+static uint32_t Formats[]={WAV_DTS};
+DECLARE_AUDIO_DECODER(ADM_AudiocodecDCA,						// Class
+			0,0,1, 												// Major, minor,patch 
+			Formats, 											// Supported formats
+#ifdef USE_LIBDCA_002			
+			&quot;libDts decoder plugin for avidemux (c) Mean/Gruntster\n&quot;); 	// Desc
+#else
+			&quot;libDca decoder plugin for avidemux (c) Mean/Gruntster\n&quot;); 	// Desc
+#endif
+   //********************************************************
+ADM_AudiocodecDCA::ADM_AudiocodecDCA(uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d) :   ADM_Audiocodec(fourcc)
 {
     int flags=0;
     ADM_assert(fourcc==WAV_DTS);
@@ -43,7 +110,7 @@
     CHK(MMXEXT,MMXEXT);
 #endif
     
-    dts_handle=(void *)dca-&gt;dts_init_(flags);
+    dts_handle=(void *)dca-&gt;dts_init(flags);
     if(!dts_handle)
     {
         printf(&quot;Cannot init libdca\n&quot;);
@@ -56,7 +123,7 @@
 {
     if(dts_handle)
     {
-        dca-&gt;dts_free_(DTS_HANDLE);
+        dca-&gt;dts_free(DTS_HANDLE);
         dts_handle=NULL;
     }
 }
@@ -90,7 +157,7 @@
             break;
         }
         //length = ADM_DCAGetInfo(ptr,nbIn, &amp;samprate, &amp;bitrate, &amp;chan,&amp;syncoff,&amp;flags);
-        length = dca-&gt;dts_syncinfo_ (DTS_HANDLE,  inptr, &amp;flags, &amp;samprate,&amp;bitrate, &amp;frame_length);
+        length = dca-&gt;dts_syncinfo (DTS_HANDLE,  inptr, &amp;flags, &amp;samprate,&amp;bitrate, &amp;frame_length);
 
         if(!length)
         {
@@ -102,41 +169,41 @@
             // not enough data
             break;
         }
+        CHANNEL_TYPE *p_ch_type = channelMapping;
 
-	if (ch_route.mode &lt; 1) {
-		CHANNEL_TYPE *p_ch_type = ch_route.input_type;
-		switch (flags &amp; DTS_CHANNEL_MASK) {
-			case DTS_MONO:
+		switch (flags &amp; DTS(CHANNEL_MASK)) 
+		{
+			case DTS(MONO):
 				*(p_ch_type++) = CH_MONO;
 			break;
-			case DTS_STEREO:
-			case DTS_DOLBY:
+			case DTS(STEREO):
+			case DTS(DOLBY):
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
 			break;
-			case DTS_3F:
+			case DTS(3F):
 				*(p_ch_type++) = CH_FRONT_CENTER;
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
 			break;
-			case DTS_2F1R:
+			case DTS(2F1R):
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
 				*(p_ch_type++) = CH_REAR_CENTER;
 			break;
-			case DTS_3F1R:
+			case DTS(3F1R):
 				*(p_ch_type++) = CH_FRONT_CENTER;
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
 				*(p_ch_type++) = CH_REAR_CENTER;
 			break;
-			case DTS_2F2R:
+			case DTS(2F2R):
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
 				*(p_ch_type++) = CH_REAR_LEFT;
 				*(p_ch_type++) = CH_REAR_RIGHT;
 			break;
-			case DTS_3F2R:
+			case DTS(3F2R):
 				*(p_ch_type++) = CH_FRONT_CENTER;
 				*(p_ch_type++) = CH_FRONT_LEFT;
 				*(p_ch_type++) = CH_FRONT_RIGHT;
@@ -145,17 +212,18 @@
 			break;
 			default:
 				ADM_assert(0);
-		}
-		if (flags &amp; DTS_LFE) {
+		} // End switch
+		if (flags &amp; DTS(LFE)) 
+		{
 			*(p_ch_type++) = CH_LFE;
 		}
-	}
+	
 
         sample_t level = 1, bias = 0;
-        flags &amp;=DTS_CHANNEL_MASK;
-        flags |= DTS_ADJUST_LEVEL;
+        flags &amp;=DTS(CHANNEL_MASK);
+        flags |= DTS(ADJUST_LEVEL);
 
-        if (dca-&gt;dts_frame_(DTS_HANDLE, inptr, &amp;flags, &amp;level, bias))
+        if (dca-&gt;dts_frame(DTS_HANDLE, inptr, &amp;flags, &amp;level, bias))
         {
             printf(&quot;\n DTS_frame failed!&quot;);
             inptr+=length;
@@ -168,17 +236,17 @@
         inptr+=length;
         nbIn-=length;
         // Each block is 256 samples
-        *nbOut += 256 * chan * dca-&gt;dts_blocks_num_(DTS_HANDLE);
+        *nbOut += 256 * chan * dca-&gt;dts_blocks_num(DTS_HANDLE);
 	float *cur;
-	for (int i = 0; i &lt; dca-&gt;dts_blocks_num_(DTS_HANDLE); i++) {
-		if (dca-&gt;dts_block_ (DTS_HANDLE)) {
-			printf(&quot;\n[DTS] dts_block failed on block %d/%d\n&quot;,i,dca-&gt;dts_blocks_num_ (DTS_HANDLE));
+	for (int i = 0; i &lt; dca-&gt;dts_blocks_num(DTS_HANDLE); i++) {
+		if (dca-&gt;dts_block(DTS_HANDLE)) {
+			printf(&quot;\n[DTS] dts_block failed on block %d/%d\n&quot;,i,dca-&gt;dts_blocks_num (DTS_HANDLE));
 			// in that case we silent out the chunk
 			memset(outptr, 0, 256 * chan * sizeof(float));
 		} else {
 			float *cur;
 			for (int k = 0; k &lt; chan; k++) {
-				sample_t *sample=(sample_t *)dca-&gt;dts_samples_(DTS_HANDLE);
+				sample_t *sample=(sample_t *)dca-&gt;dts_samples(DTS_HANDLE);
 				sample += 256 * k;
 				cur = outptr + k;
 				for (int j = 0; j &lt; 256; j++) {
@@ -194,4 +262,3 @@
     return 1; 
 }
 
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_dca/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,5 +1,6 @@
+# DCA decoder
 INCLUDE(admCheckDca)
-checkFaad()
+checkDca()
 
 IF (LIBDCA_FOUND)
 	INCLUDE(ad_plugin)
@@ -10,7 +11,8 @@
 	TARGET_LINK_LIBRARIES(ADM_ad_dca ${LIBDCA_LIBRARY_DIR})
 
 	ADD_TARGET_CFLAGS(ADM_ad_dca &quot;-I${LIBDCA_INCLUDE_DIR}&quot;)
+	ADD_TARGET_CFLAGS(ADM_ad_dca &quot;-DUSE_LIBDCA_${LIBDCA_VERSION}&quot;)
 
 	INIT_AUDIO_PLUGIN(ADM_ad_dca)
 	INSTALL_AUDIODECODER(ADM_ad_dca)
-ENDIF (HAVE_FAAD)
+ENDIF (LIBDCA_FOUND)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/ADM_ad_faad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/ADM_ad_faad.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/ADM_ad_faad.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -42,7 +42,7 @@
 };
 // Supported formats + declare our plugin
 //*******************************************************
-uint32_t Formats[]={WAV_AAC,WAV_MP4};
+static uint32_t Formats[]={WAV_AAC,WAV_MP4};
 DECLARE_AUDIO_DECODER(ADM_faad,						// Class
 			0,0,1, 												// Major, minor,patch 
 			Formats, 											// Supported formats

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_faad/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -3,19 +3,15 @@
 
 IF (HAVE_FAAD)
 	INCLUDE(ad_plugin)
-	INIT_AUDIO_PLUGIN()
 	
 	SET(ADM_ad_faad_SRCS ADM_ad_faad.cpp)
 
 	ADD_LIBRARY(ADM_ad_faad SHARED ${ADM_ad_faad_SRCS})
 	TARGET_LINK_LIBRARIES(ADM_ad_faad ${FAAD_LIBRARY_DIR})
 
-	IF (WIN32 OR APPLE)
-		TARGET_LINK_LIBRARIES(ADM_ad_faad ADM_core)
-	ENDIF (WIN32 OR APPLE)
-
 	ADD_TARGET_CFLAGS(ADM_ad_faad &quot;-I${FAAD_INCLUDE_DIR}&quot;)
 	ADD_TARGET_DEFINITIONS(ADM_ad_faad FAAD_OLD_PROTOTYPE)
 	
+	INIT_AUDIO_PLUGIN(ADM_ad_faad)
 	INSTALL_AUDIODECODER(ADM_ad_faad)
-ENDIF (HAVE_FAAD)
\ No newline at end of file
+ENDIF (HAVE_FAAD)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_ad_mad.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -44,7 +44,7 @@
 };
 // Supported formats + declare our plugin
 //*******************************************************
-uint32_t Formats[]={WAV_MP3,WAV_MP2};
+static uint32_t Formats[]={WAV_MP3,WAV_MP2};
 DECLARE_AUDIO_DECODER(ADM_AudiocodecMP3,						// Class
 			0,0,1, 												// Major, minor,patch 
 			Formats, 											// Supported formats

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/ADM_libMad/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -13,3 +13,5 @@
 IF (ADM_BIG_ENDIAN)
 	ADD_TARGET_CFLAGS(${ADM_LIB} &quot;-DWORDS_BIGENDIAN&quot;)
 ENDIF (ADM_BIG_ENDIAN)
+
+INIT_AUDIO_PLUGIN(${ADM_LIB})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_mad/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,5 +1,4 @@
 INCLUDE(ad_plugin)
-INIT_AUDIO_PLUGIN()
 
 IF (ADM_CPU_X86_32)
 	ADD_DEFINITIONS(&quot;-DFPM_INTEL&quot;)
@@ -16,8 +15,5 @@
 ADD_LIBRARY(ADM_ad_Mad SHARED ${ADM_ad_Mad_SRCS})
 TARGET_LINK_LIBRARIES(ADM_ad_Mad ADM_libMad)
 
-IF (WIN32 OR APPLE)
-	TARGET_LINK_LIBRARIES(ADM_ad_Mad ADM_core)
-ENDIF (WIN32 OR APPLE)
-
-INSTALL_AUDIODECODER(ADM_ad_Mad)
\ No newline at end of file
+INIT_AUDIO_PLUGIN(ADM_ad_Mad)
+INSTALL_AUDIODECODER(ADM_ad_Mad)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/ADM_ad_vorbis.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2008-03-16 17:53:08 UTC (rev 3901)
@@ -50,7 +50,7 @@
 
 // Supported formats + declare our plugin
 //*******************************************************
-uint32_t Formats[]={WAV_OGG};
+static uint32_t Formats[]={WAV_OGG};
 DECLARE_AUDIO_DECODER(ADM_vorbis,						// Class
 			0,0,1, 												// Major, minor,patch 
 			Formats, 											// Supported formats

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/ADM_ad_vorbis/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,15 +1,15 @@
-IF (USE_VORBIS)
+IF (USE_VORBIS)
 	INCLUDE(ad_plugin)
-	INIT_AUDIO_PLUGIN()
-
-	SET(ADM_ad_vorbis_SRCS ADM_ad_vorbis.cpp)
-
-	ADD_LIBRARY(ADM_ad_vorbis SHARED ${ADM_ad_vorbis_SRCS})
-
-	TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBIS_LIBRARY_DIR})
-	TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBISENC_LIBRARY_DIR})
-
-	ADD_TARGET_CFLAGS(ADM_ad_vorbis &quot;-I${VORBIS_INCLUDE_DIR}&quot;)
-
-	INSTALL_AUDIODECODER(ADM_ad_vorbis)
-ENDIF (USE_VORBIS)
\ No newline at end of file
+
+	SET(ADM_ad_vorbis_SRCS ADM_ad_vorbis.cpp)
+
+	ADD_LIBRARY(ADM_ad_vorbis SHARED ${ADM_ad_vorbis_SRCS})
+
+	TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBIS_LIBRARY_DIR})
+	TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBISENC_LIBRARY_DIR})
+
+	ADD_TARGET_CFLAGS(ADM_ad_vorbis &quot;-I${VORBIS_INCLUDE_DIR}&quot;)
+
+	INIT_AUDIO_PLUGIN(ADM_ad_vorbis)
+	INSTALL_AUDIODECODER(ADM_ad_vorbis)
+ENDIF (USE_VORBIS)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_audiodecoder/CMakeLists.txt	2008-03-16 17:53:08 UTC (rev 3901)
@@ -2,3 +2,4 @@
 ADD_SUBDIRECTORY(ADM_ad_faad)
 ADD_SUBDIRECTORY(ADM_ad_mad)
 ADD_SUBDIRECTORY(ADM_ad_vorbis)
+ADD_SUBDIRECTORY(ADM_ad_dca)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/ad_plugin.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/ad_plugin.cmake	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/cmake/ad_plugin.cmake	2008-03-16 17:53:08 UTC (rev 3901)
@@ -1,9 +1,12 @@
-MACRO(INIT_AUDIO_PLUGIN)
+MACRO(INIT_AUDIO_PLUGIN _lib)
 	INCLUDE_DIRECTORIES(&quot;${CMAKE_BINARY_DIR}/config&quot;)
 	INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/avidemux/ADM_core/include&quot;)
 	INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/avidemux/ADM_audiocodec&quot;)
+        if(WIN32)
+                TARGET_LINK_LIBRARIES(${_lib} ADM_core)
+        endif(WIN32)
 ENDMACRO(INIT_AUDIO_PLUGIN)
 
 MACRO(INSTALL_AUDIODECODER _lib)
 	INSTALL(TARGETS ${_lib} DESTINATION &quot;${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/audioDecoder/&quot;)
-ENDMACRO(INSTALL_AUDIODECODER)
\ No newline at end of file
+ENDMACRO(INSTALL_AUDIODECODER)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioCodecLibs.cmake	2008-03-16 17:53:08 UTC (rev 3901)
@@ -90,52 +90,7 @@
 
 MESSAGE(&quot;&quot;)
 
-########################################
-# libdca
-########################################
-OPTION(LIBDCA &quot;&quot; ON)
 
-MESSAGE(STATUS &quot;Checking for libdca&quot;)
-MESSAGE(STATUS &quot;*******************&quot;)
-
-IF (LIBDCA)
-	IF (UNIX)
-		SET(LIBDCA_REQUIRED_FLAGS &quot;-lm&quot;)
-	ENDIF (UNIX)
-
-	SET(LIBDCA_VERSION 005)
-
-	IF (USE_LATE_BINDING)
-		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h)
-
-		IF (NOT LIBDCA_005_FOUND)
-			SET(LIBDCA_VERSION 002)
-			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h)
-		ENDIF (NOT LIBDCA_005_FOUND)
-	ELSE (USE_LATE_BINDING)
-		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h dca dca_init ${LIBDCA_REQUIRED_FLAGS})
-
-		IF (NOT LIBDCA_005_FOUND)
-			SET(LIBDCA_VERSION 002)
-			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h dts dts_init ${LIBDCA_REQUIRED_FLAGS})
-		ENDIF (NOT LIBDCA_005_FOUND)
-	ENDIF (USE_LATE_BINDING)
-
-	IF (LIBDCA_${LIBDCA_VERSION}_FOUND)
-		SET(LIBDCA_FOUND 1)
-		SET(USE_LIBDCA 1)
-		SET(USE_LIBDCA_${LIBDCA_VERSION} 1)
-		SET(LIBDCA_INCLUDE_DIR &quot;${LIBDCA_${LIBDCA_VERSION}_INCLUDE_DIR}&quot;)
-		SET(LIBDCA_LIBRARY_DIR &quot;${LIBDCA_${LIBDCA_VERSION}_LIBRARY_DIR}&quot;)
-	ENDIF (LIBDCA_${LIBDCA_VERSION}_FOUND)
-
-	PRINT_LIBRARY_INFO(&quot;libdca&quot; LIBDCA_FOUND &quot;${LIBDCA_INCLUDE_DIR}&quot; &quot;${LIBDCA_LIBRARY_DIR}&quot;)
-ELSE (LIBDCA)
-	MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
-ENDIF (LIBDCA)
-
-MESSAGE(&quot;&quot;)
-
 ########################################
 # FAAC
 ########################################
@@ -180,4 +135,4 @@
 	MESSAGE(&quot;${MSG_DISABLE_OPTION}&quot;)
 ENDIF (VORBIS)
 
-MESSAGE (&quot;&quot;)
\ No newline at end of file
+MESSAGE (&quot;&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckDca.cmake	2008-03-16 17:53:08 UTC (rev 3901)
@@ -14,22 +14,13 @@
 
 	SET(LIBDCA_VERSION 005)
 
-	IF (USE_LATE_BINDING)
-		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h)
+	FIND_HEADER_AND_LIB(LIBDCA_005 dca.h dca dca_init ${LIBDCA_REQUIRED_FLAGS})
 
-		IF (NOT LIBDCA_005_FOUND)
-			SET(LIBDCA_VERSION 002)
-			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h)
-		ENDIF (NOT LIBDCA_005_FOUND)
-	ELSE (USE_LATE_BINDING)
-		FIND_HEADER_AND_LIB(LIBDCA_005 dca.h dca dca_init ${LIBDCA_REQUIRED_FLAGS})
+	IF (NOT LIBDCA_005_FOUND)
+		SET(LIBDCA_VERSION 002)
+		FIND_HEADER_AND_LIB(LIBDCA_002 dts.h dts dts_init ${LIBDCA_REQUIRED_FLAGS})
+	ENDIF (NOT LIBDCA_005_FOUND)
 
-		IF (NOT LIBDCA_005_FOUND)
-			SET(LIBDCA_VERSION 002)
-			FIND_HEADER_AND_LIB(LIBDCA_002 dts.h dts dts_init ${LIBDCA_REQUIRED_FLAGS})
-		ENDIF (NOT LIBDCA_005_FOUND)
-	ENDIF (USE_LATE_BINDING)
-
 	IF (LIBDCA_${LIBDCA_VERSION}_FOUND)
 		SET(LIBDCA_FOUND 1)
 		SET(USE_LIBDCA 1)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-03-16 17:53:05 UTC (rev 3900)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-03-16 17:53:08 UTC (rev 3901)
@@ -228,4 +228,4 @@
 	APPEND_FLAGS(_flags ${ARGN})
 
 	TARGET_LINK_LIBRARIES(${_target} ${_flags})
-ENDMACRO (ADD_TARGET_LDFLAGS)
\ No newline at end of file
+ENDMACRO (ADD_TARGET_LDFLAGS)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001163.html">[Avidemux-svn-commit] r3900 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries/ADM_libwrapper	avidemux/plugins/ADM_audiodecoder	avidemux/plugins/ADM_audiodecoder/ADM_ad_dca cmake
</A></li>
	<LI>Next message: <A HREF="001165.html">[Avidemux-svn-commit] r3902 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_audiocodec ADM_libraries/ADM_ffmpeg/ADM_lavcodec	ADM_userInterfaces/ADM_commonUI plugins/ADM_audiodecoder	plugins/ADM_audiodecoder/ADM_ad_amrnb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1164">[ date ]</a>
              <a href="thread.html#1164">[ thread ]</a>
              <a href="subject.html#1164">[ subject ]</a>
              <a href="author.html#1164">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
