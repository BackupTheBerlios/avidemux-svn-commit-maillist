<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3898 - in	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_codecs	ADM_core/src ADM_libraries ADM_libraries/ADM_utilities	ADM_outputs/oplug_mpeg ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3898%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%20ADM_codecs%0A%09ADM_core/src%20ADM_libraries%20ADM_libraries/ADM_utilities%0A%09ADM_outputs/oplug_mpeg%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200803161516.m2GFGB8j030436%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001160.html">
   <LINK REL="Next"  HREF="001162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3898 - in	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_codecs	ADM_core/src ADM_libraries ADM_libraries/ADM_utilities	ADM_outputs/oplug_mpeg ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3898%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%20ADM_codecs%0A%09ADM_core/src%20ADM_libraries%20ADM_libraries/ADM_utilities%0A%09ADM_outputs/oplug_mpeg%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200803161516.m2GFGB8j030436%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3898 - in	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_codecs	ADM_core/src ADM_libraries ADM_libraries/ADM_utilities	ADM_outputs/oplug_mpeg ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Sun Mar 16 16:16:11 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001160.html">[Avidemux-svn-commit] r3897 - in branches/avidemux_2.5_branch_gruntster: . avidemux avidemux/ADM_audio avidemux/ADM_audiocodec avidemux/ADM_audiodevice avidemux/ADM_audiofilter avidemux/ADM_codecs avidemux/ADM_colorspace avidemux/ADM_editor avidemux/ADM_encoder avidemux/ADM_filter avidemux/ADM_infoExtractor avidemux/ADM_inputs avidemux/ADM_inputs/ADM_amv avidemux/ADM_inputs/ADM_asf avidemux/ADM_inputs/ADM_avsproxy avidemux/ADM_inputs/ADM_flv avidemux/ADM_inputs/ADM_h263 avidemux/ADM_inputs/ADM_inpics avidemux/ADM_inputs/ADM_matroska avidemux/ADM_inputs/ADM_mp4 avidemux/ADM_inputs/ADM_mpegdemuxer avidemux/ADM_inputs/ADM_nuv avidemux/ADM_inputs/ADM_ogm avidemux/ADM_inputs/ADM_openDML avidemux/ADM_libraries avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/i386 avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ppc avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpos! tproc avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale avidemux/ADM_libraries/ADM_libMpeg2Dec avidemux/ADM_libraries/ADM_libass avidemux/ADM_libraries/ADM_libmpeg2enc avidemux/ADM_libraries/ADM_libmpeg2enc/altivec avidemux/ADM_libraries/ADM_libtwolame avidemux/ADM_libraries/ADM_libwrapper avidemux/ADM_libraries/ADM_lvemux avidemux/ADM_libraries/ADM_mplex avidemux/ADM_libraries/ADM_smjs avidemux/ADM_libraries/ADM_utilities avidemux/ADM_libraries/ADM_xvidratectl avidemux/ADM_ocr avidemux/ADM_osSupport avidemux/ADM_outputs avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4 avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF avidemux/ADM_outputs/oplug_ogm avidemux/ADM_requant avidemux/ADM_script avidemux/ADM_toolkit avidemux/ADM_userInterfaces avidemux/ADM_userInterfaces/ADM_GTK avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory avidemux/ADM! _userInterfaces/ADM_GTK/ADM_filters avidemux/ADM_userInterface! s/ADM_GT
</A></li>
        <LI>Next message: <A HREF="001162.html">[Avidemux-svn-commit] r3899 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg:	ADM_lavcodec ADM_lavformat ADM_lavutil ADM_libpostproc	ADM_libswscale
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1161">[ date ]</a>
              <a href="thread.html#1161">[ thread ]</a>
              <a href="subject.html#1161">[ subject ]</a>
              <a href="author.html#1161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-03-16 16:16:03 +0100 (Sun, 16 Mar 2008)
New Revision: 3898

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libMpeg2Dec/
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_crashdump.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
Log:
[mpeg2dec] remove mpeg2dec

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -62,7 +62,6 @@
 #include &quot;ADM_codecs/ADM_theora_dec.h&quot;
 #endif
 
-#include &quot;ADM_codecs/ADM_mpeg.h&quot;
 #include &quot;ADM_codecs/ADM_png.h&quot;
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_assert.h&quot;
@@ -391,33 +390,13 @@
 
     }
   if (isMpeg12Compatible (fcc))
-    {
-      uint32_t lavcodec_mpeg = 0;
-      printf (&quot;\n using Mpeg1/2 codec (libmpeg2)\n&quot;);
-      if (!prefs-&gt;get (FEATURE_USE_LAVCODEC_MPEG, &amp;lavcodec_mpeg))
-	{
-	  lavcodec_mpeg = 0;
-	}
-      if (lavcodec_mpeg)
-	{
-	  return (decoders *) (new
-			       decoderFFMpeg12 (w, h, extraLen, extraData));
-	}
-      else
-	{
-	  return (decoders *) (new decoderMpeg (w, h, extraLen, extraData));
-	}
-      //  
-    }
+	  return (decoders *) (new decoderFFMpeg12 (w, h, extraLen, extraData));
 
   // default : null decoder
   printf (&quot;\n using invalid codec for \n&quot;);
   fourCC::print (fcc);
 
   return (decoders *) (new decoderEmpty (w, h));
-
-
-
 }
 
 uint8_t coders::compress (ADMImage * in, ADMBitstream * out)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -1,449 +0,0 @@
-/***************************************************************************
-                          ADM_mpeg.h  -  description
-                             -------------------
-
-	Mpeg1/2 decoder interface tp libmpeg2
-
-	We store the system header etc ... as extra data
-
-    begin                : Sat Sep 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-
-#ifdef HAVE_SYS_PARAM_H
-#include &lt;sys/param.h&gt;
-#endif
-
-#if  defined( __FreeBSD__ ) || defined(__APPLE__)
-#include &lt;sys/types.h&gt;
-#endif
-
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-#include &quot;ADM_default.h&quot;
-#include &quot;avifmt.h&quot;
-#include &quot;avifmt2.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_codecs/ADM_mpeg.h&quot;
-
-#define MPEG2DEC  ((mpeg2dec_t *)_decoder)
-
-extern &quot;C&quot;
-{
-#include &quot;ADM_libraries/ADM_libMpeg2Dec/video_out.h&quot;
-#undef free
-#undef alloc
-#undef realloc
-
-#include &quot;ADM_libraries/ADM_libMpeg2Dec/mpeg2.h&quot;
-#include &quot;ADM_libraries/ADM_libMpeg2Dec/mpeg2_internal.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_CODEC
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-  extern void mpeg2_pop (mpeg2dec_t * m);
-  extern void mpeg2_popI (mpeg2dec_t * m);
-  static vo_instance_t *yv12_open (void);
-  static void yv12_close (vo_instance_t * _instance);
-  static int yv12_setup (vo_instance_t * _instance, unsigned int width,
-			 unsigned int height, unsigned int chroma_w,
-			 unsigned int chroma_h, vo_setup_result_t * result);
-  static void yv12_setup_fbuf (vo_instance_t * _instance, uint8_t ** buf,
-			       void **id);
-  extern int mpeg2_cleanup (mpeg2dec_t * mpeg2dec);
-};
-
-//static uint8_t *zero=NULL;
-
-decoderMpeg *_father = NULL;
-static vo_instance_t *output;
-// avoid exporting our stuff...
-typedef struct yv12_instance_s
-{
-  vo_instance_t vo;
-  decoderMpeg *father;
-  uint32_t w, h;
-  uint8_t *buffer;
-} yv12_instance_t;
-
-decoderMpeg::~decoderMpeg()
-{
-	kill_codec();
-	delete[] unpackBuffer;
-
-	if (_seqHeader)
-	{
-		delete[] _seqHeader;
-		_seqHeader = NULL;
-	}
-}
-//____________________________________
-uint8_t decoderMpeg::isMpeg1 (void)
-{
-  mpeg2_decoder_t *
-    dec;
-  dec = &amp;((MPEG2DEC)-&gt;decoder);
-  return (dec-&gt;mpeg1);
-}
-//____________________-un init ____________________
-uint8_t decoderMpeg::kill_codec (void)
-{
-  mpeg2_decoder_t *
-    dec;
-  dec = &amp;((MPEG2DEC)-&gt;decoder);
-
-  if (dec-&gt;quant)
-    {
-      ADM_dealloc (dec-&gt;quant);
-      dec-&gt;quant = NULL;
-    }
-  mpeg2_close (MPEG2DEC);
-  _decoder = NULL;
-  yv12_close (output);
-  output = NULL;
-
-  return 1;
-}
-//________________________________________________
-void
-decoderMpeg::setParam (void)
-{
-
-
-  return;
-}
-/*
-______________________________________________________________________________________
-		Constructor for mpeg decoder
-______________________________________________________________________________________
-*/
-decoderMpeg::decoderMpeg (uint32_t w, uint32_t h, uint32_t extraLen, uint8_t * extraData) : decoders (w,h)
-{
-	mpeg2_decoder_t *dec;
-	uint32_t wmb, hmb;
-	yv12_instance_t *inst;
-
-	_seqLen = extraLen;
-
-	if (extraLen)
-	{
-		_seqHeader = new uint8_t[extraLen];
-		memcpy (_seqHeader, extraData, extraLen);
-	}
-	else
-		_seqHeader = NULL;
-
-	// store for future use
-	_seqFound = 0;
-	par_width=par_height=1;
-
-	printf (&quot;\nInitializing MPEG2 decoder %lu x %lu\n&quot;, _w, _h);
-	output = yv12_open ();
-	inst = (yv12_instance_t *) output;
-	unpackBuffer = new uint8_t[(w * h * 9) &gt;&gt; 1];
-	inst-&gt;buffer = unpackBuffer;
-	_decoder = mpeg2_init();
-	dec = &amp;((MPEG2DEC)-&gt;decoder);
-
-	wmb = (_w + 15) &gt;&gt; 4;;
-	hmb = (_h + 15) &gt;&gt; 4;;
-
-	dec-&gt;quant_stride = wmb;
-	dec-&gt;quant = (int8_t *)ADM_alloc ((wmb * hmb) * sizeof (int8_t));
-
-	feedData (extraLen, _seqHeader);
-	feedData (extraLen, _seqHeader);
-
-	// Post processing settings
-	_swapUV = 0;
-	// Post Proc is disabled by default
-
-	printf (&quot;\nDone\n&quot;);
-}
-/*------------------------------------------------------------------*/
-uint8_t
-  decoderMpeg::uncompress  (ADMCompressedImage * in, ADMImage * out)
-{
-  
-    out-&gt;flags = 0;
-#if defined( REMOVE_PADDING)
-  while (*(in + len - 1) == 0)
-    len--;
-#endif
-  if (!in-&gt;dataLength)
-    {
-      if (!dontcopy ())
-	return 1;
-    }
-  if (in-&gt;dataLength)
-    feedData (in-&gt;dataLength, in-&gt;data);
-
-  const mpeg2_info_t *info;
-  uint8_t *t;
-
-  t = (uint8_t *) MPEG2DEC-&gt;fbuf[0]-&gt;buf[0];
-  mpeg2_cleanup (MPEG2DEC);
-  info = mpeg2_info (MPEG2DEC);
-
-  if (info-&gt;sequence) {
-    par_width = info-&gt;sequence-&gt;pixel_width;
-    par_height = info-&gt;sequence-&gt;pixel_height;
-  }
-
-  aprintf(&quot;Mpeg  %u * %u\n&quot;,par_width,par_height);
-  out-&gt;_noPicture = 0;		// For mpeg1/2 we ALWAYS have a picture
-  if (out-&gt;quant &amp;&amp; MPEG2DEC-&gt;decoder.quant_stride &gt;= out-&gt;_qStride)
-    {
-
-
-      if (dontcopy ())
-	{
-	  out-&gt;_qSize = ((_w + 15) &gt;&gt; 4) * ((_h + 15) &gt;&gt; 4);
-	  out-&gt;_qStride = (_w + 15) &gt;&gt; 4;
-	  out-&gt;quant = (uint8_t *) MPEG2DEC-&gt;decoder.quant;
-	}
-      else
-	memcpy (out-&gt;quant, MPEG2DEC-&gt;decoder.quant, out-&gt;_qSize);
-
-    }
-  if (dontcopy ())
-    {
-      uint32_t plane = _w * _h;
-
-      out-&gt;_planes[0] = t;
-      out-&gt;_planes[1] = t + plane;
-      out-&gt;_planes[2] = t + ((plane * 5) &gt;&gt; 2);
-      out-&gt;_planeStride[0] = _w;
-      out-&gt;_planeStride[1] = _w &gt;&gt; 1;
-      out-&gt;_planeStride[2] = _w &gt;&gt; 1;
-    }
-  else
-    {
-      memcpy (out-&gt;data, t, (_w * _h * 3) &gt;&gt; 1);
-    }
-
-  switch (MPEG2DEC-&gt;decoder.coding_type)
-    {
-    case I_TYPE:
-      out-&gt;flags = AVI_KEY_FRAME;
-      break;
-    case B_TYPE:
-      out-&gt;flags = AVI_B_FRAME;
-      break;
-    case P_TYPE:
-      out-&gt;flags = 0;
-      break;
-    default:
-      printf (&quot;\n unknown frame type ! %d\n&quot;, MPEG2DEC-&gt;decoder.coding_type);
-      //ADM_assert(0);
-      //return 0;
-      out-&gt;flags = 0;
-    }
-  if (MPEG2DEC-&gt;ext_state &amp; PIC_FLAG_PROGRESSIVE_FRAME)
-    {
-      aprintf (&quot;Progressive\n&quot;);
-    }
-  return 1;
-}
-void
-decoderMpeg::feedData (uint32_t len, uint8_t * data)
-{
-  decode_mpeg2 (data, data + len);
-
-}
-void
-decoderMpeg::setFather (decoderMpeg * f)
-{
-  _father = f;
-}
-
-
-/**
-	decode_mpeg2: Just a copy/paste from mpeg2dec
-
-*/
-void
-decoderMpeg::decode_mpeg2 (uint8_t * current, uint8_t * end)
-{
-  const mpeg2_info_t *info;
-  int state;
-  int loop = 0;
-
-  mpeg2_buffer (MPEG2DEC, current, end);
-
-  info = mpeg2_info (MPEG2DEC);
-  while (1)
-    {
-
-      state = mpeg2_parse (MPEG2DEC);
-      aprintf (&quot;Mpeg2dec : %d \n&quot;, state);
-      switch (state)
-	{
-	case STATE_BUFFER:
-	  loop++;
-	  if (loop &gt; 2)
-	    {
-	      aprintf (&quot;Mpeg2dec: Running empty...\n&quot;);
-	      return;
-	    }
-	  break;
-	case -1:
-	  printf (&quot;Not ready \n&quot;);
-	  return;
-	case STATE_SEQUENCE:
-	  /* might set nb fbuf, convert format, stride */
-	  /* might set fbufs */
-	  printf (&quot;\n Seq found\n&quot;);
-
-	  vo_setup_result_t res;
-	  if (!_seqFound)
-	    {
-	      if (output-&gt;setup (output,
-				 info-&gt;sequence-&gt;width,
-				 info-&gt;sequence-&gt;height,
-				 info-&gt;sequence-&gt;width &gt;&gt; 1,
-				 info-&gt;sequence-&gt;height &gt;&gt; 1, &amp;res))
-		{
-		  fprintf (stderr, &quot;display setup failed\n&quot;);
-		  exit (1);
-		}
-	      uint8_t *buf[3];
-	      void *id;
-	      //mpeg2_custom_fbuf(MPEG2DEC,1);
-	      output-&gt;setup_fbuf (output, buf, (void **) 0);	// 3 buffer ...
-	      mpeg2_set_buf (MPEG2DEC, buf, (void *) 0);
-	      output-&gt;setup_fbuf (output, buf, (void **) 1);
-	      mpeg2_set_buf (MPEG2DEC, buf, (void *) 1);
-	      output-&gt;setup_fbuf (output, buf, (void **) 2);
-	      mpeg2_set_buf (MPEG2DEC, buf, (void *) 2);
-	      _seqFound = 0;
-	    }
-	  else
-	    printf (&quot;..already initialized...\n&quot;);
-
-	  break;
-	case STATE_PICTURE:
-	  /* might skip */
-	  /* might set fbuf */
-
-	  _seen = MPEG2DEC-&gt;decoder.coding_type;
-	  //printf(&quot;1st %d\n&quot;,_seen);
-	  break;
-	case STATE_PICTURE_2ND:
-	  /* should not do anything */
-	  //printf(&quot;2nd\n&quot;);
-	  break;
-	case STATE_SLICE:
-	case STATE_END:
-	  /* draw current picture */
-	  /* might free frame buffer */
-
-	  break;
-	}
-    }
-}
-
-
-/**
-		yv12_open : set up the callbacks
-*/
-vo_instance_t *
-yv12_open (void)
-{
-  yv12_instance_t *instance;
-
-  instance = new yv12_instance_t;
-  if (instance == NULL)
-    return NULL;
-  memset (instance, 0, sizeof (*instance));
-
-  instance-&gt;vo.setup = yv12_setup;
-  instance-&gt;vo.setup_fbuf = yv12_setup_fbuf;
-  instance-&gt;vo.set_fbuf = NULL;
-  instance-&gt;vo.draw = NULL;
-  instance-&gt;vo.discard = NULL;
-  instance-&gt;vo.close = yv12_close;
-  instance-&gt;father = _father;
-
-  printf (&quot; YV12 open called\n&quot;);
-
-  return (vo_instance_t *) instance;
-}
-/**
-		yv12_setup : Nothing to do
-*/
-int
-yv12_setup (vo_instance_t * _instance, unsigned int width,
-	    unsigned int height, unsigned int chroma_w, unsigned int chroma_h,
-	    vo_setup_result_t * result)
-{
-  yv12_instance_t *ins;
-
-  ins = (yv12_instance_t *) _instance;
-  ins-&gt;w = width;
-  ins-&gt;h = height;
-  result-&gt;convert = NULL;
-  printf (&quot; YV12 setup called\n&quot;);
-  return 0;
-}
-/**
-	yv12_close : nothing to do
-*/
-void
-yv12_close (vo_instance_t * _instance)
-{
-	delete _instance;
-	printf (&quot;yv12close called\n&quot;);
-}
-
-/**
-	yv12_setup_fbuf : Allocate some buffers
-*/
-static void
-yv12_setup_fbuf (vo_instance_t * _instance, uint8_t ** buf, void **id)
-{
-  uint8_t *all;
-  uint32_t page, img;
-#ifdef ADM_CPU_64BIT
-  uint64_t i;
-  i = (uint64_t) id;
-
-#else
-  uint32_t i;
-  i = (uint32_t) id;
-#endif
-
-  yv12_instance_t *instance = (yv12_instance_t *) _instance;
-  printf (&quot; **********YV12 setup fbuf called : %lu x %lu (%lu)\n&quot;,
-	  instance-&gt;w, instance-&gt;h, i);
-
-  page = instance-&gt;w * instance-&gt;h;
-  img = (page * 3) &gt;&gt; 1;
-
-  all = instance-&gt;buffer;
-  all += img * i;
-  memset (all, 0, img);
-  buf[0] = all;
-  buf[2] = all + page;;
-  buf[1] = all + page + (page &gt;&gt; 2);;
-  //@*id=NULL;
-
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.h	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mpeg.h	2008-03-16 15:16:03 UTC (rev 3898)
@@ -1,68 +0,0 @@
-/***************************************************************************
-                          ADM_mpeg.h  -  description
-                             -------------------
-
-	Mpeg1/2 decoder based on libmpeg2
-
-    begin                : Sat Sep 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;ADM_pp.h&quot;
-class decoderMpeg:public decoders
-{
-protected:
-  uint8_t _seen;
-  uint8_t *_seqHeader;
-  uint32_t _seqLen;
-  uint8_t _seqFound;
-  uint8_t par_height;
-  uint8_t par_width;
-
-  uint8_t init_codec (void);
-  uint8_t kill_codec (void);
-  void *_decoder;
-  void setFather (decoderMpeg * f);
-  void decode_mpeg2 (uint8_t * current, uint8_t * end);
-  void feedData (uint32_t len, uint8_t * data);
-  uint32_t _swapUV;
-  uint8_t *unpackBuffer;
-
-
-
-
-public:
-    decoderMpeg (uint32_t w, uint32_t h,
-		 uint32_t extraLen, uint8_t * extraData);
-    virtual ~ decoderMpeg ();
-  virtual uint8_t uncompress  (ADMCompressedImage * in, ADMImage * out);
-  virtual uint8_t getPARWidth (void)
-  {
-     return par_width;
-  }
-  virtual uint8_t getPARHeight (void)
-  {
-     return par_height;
-  }
-  virtual uint8_t bFramePossible (void)
-  {
-    return 1;
-  }
-  virtual void setParam (void);
-  uint8_t isMpeg1 (void);
-  uint8_t dontcopy (void)
-  {
-    return 1;
-  }
-
-};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2008-03-16 15:16:03 UTC (rev 3898)
@@ -1,6 +1,6 @@
 SET(ADM_codecs_SRCS 
 	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_png.cpp    ADM_theora_dec.cpp  ADM_x264.cpp   ADM_xvid.cpp     ADM_xvideco.cpp
-	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_mpeg.cpp         ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp  ADM_xvidcvs.cpp)
+	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp  ADM_xvidcvs.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_crashdump.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_crashdump.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -412,7 +412,7 @@
 
 	if(myFatalFunction)
 		myFatalFunction(&quot;Crash&quot;, wholeStuff); // FIXME
-#endif __CYGWIN__
+#endif	//__CYGWIN__
 
 	exit(-1); // _exit(1) ???
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -115,7 +115,6 @@
 	{&quot;feature.svcdres.preferedsourceratio&quot;,		STRING,&quot;1:1&quot;,	NULL, NULL, NULL },
 	{&quot;feature.saveprefsonexit&quot;,		UINT,	&quot;1&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.ignoresavedmarkers&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
-	{&quot;feature.use_lavcodec_mpeg&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.disable_nuv_resync&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.tryautoidx&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.use_odml&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
@@ -141,7 +140,7 @@
 	{&quot;priority.playback&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;4&quot;	}
 };
 
-int num_opts = 81;
+int num_opts = 80;
 // &lt;/prefs_gen&gt;
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2008-03-16 15:16:03 UTC (rev 3898)
@@ -1,5 +1,4 @@
 subdirs (PREORDER ADM_ffmpeg)
-subdirs (PREORDER ADM_libMpeg2Dec)
 subdirs (PREORDER ADM_libmpeg2enc)
 subdirs (PREORDER ADM_libtwolame)
 subdirs (PREORDER ADM_libwrapper)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -36,7 +36,6 @@
 #include &quot;ADM_libraries/ADM_lvemux/ADM_muxer.h&quot;
 
 // To have access to low level infos 
-#include &quot;ADM_codecs/ADM_mpeg.h&quot;
 #include &quot;ADM_lavcodec.h&quot;
 #include &quot;ADM_codecs/ADM_ffmp43.h&quot;
 #include &quot;ADM_inputs/ADM_mpegdemuxer/dmx_mpegstartcode.h&quot;
@@ -110,48 +109,11 @@
 	}
 	// Check
 	WAVHeader *hdr=audio-&gt;getInfo();
-	uint32_t isMpeg1;
-	uint32_t isLav;
-	if(!prefs-&gt;get(FEATURE_USE_LAVCODEC_MPEG, &amp;isLav))
-		{
-		 isLav=0;
-		}
 
-	if(!isLav)
-	{
-		decoderMpeg *mpeghdr;
-	
-		mpeghdr=(decoderMpeg *)video_body-&gt;rawGetDecoder(0);
-		isMpeg1=mpeghdr-&gt;isMpeg1();
-	}
-	else
-	{
-		// How to know if it is mpeg 1?
-		// Assume it is not
-		/*
-		decoderFFMpeg12 *mpeghdr;
-	
-		mpeghdr=(decoderFFMpeg12 *)video_body-&gt;rawGetDecoder(0);
-		isMpeg1=mpeghdr-&gt;isMpeg1();
-		*/
-		isMpeg1=0;
-	
-	}
-	
 	switch(format)
         {
         case ADM_PS:	
-                if(isMpeg1)
-                {
-                        if(hdr-&gt;frequency!=44100 ||  hdr-&gt;encoding != WAV_MP2)
-                        {
-                          GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible audio&quot;), QT_TR_NOOP(&quot;For VCD, audio must be 44.1 kHz MP2.&quot;));
-                                return 0 ;
-                        }
-                        mux=MUXER_VCD;
-                        printf(&quot;PassThrough: Using VCD PS\n&quot;);        
-                }else
-                {    // Mpeg2 
+                    // Mpeg2 
                         aviInfo info;
                         video_body-&gt;getVideoInfo(&amp;info);
                         if(hdr-&gt;frequency==44100 &amp;&amp; info.width==480&amp;&amp; hdr-&gt;encoding == WAV_MP2 ) // SVCD ?
@@ -181,7 +143,6 @@
                                mux=MUXER_DVD;
                                printf(&quot;PassThrough: Using DVD PS\n&quot;);
                         }
-                }
 
   	        muxer=new mplexMuxer();
                 break;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-03-16 15:16:03 UTC (rev 3898)
@@ -48,7 +48,6 @@
 {
 uint32_t olddevice,newdevice;
 
-uint32_t	lavcodec_mpeg=0;
 uint32_t        use_odml=0;
 uint32_t	autosplit=0;
 uint32_t render;
@@ -151,8 +150,6 @@
         if(!prefs-&gt;get(SETTINGS_MPEGSPLIT, &amp;autosplit))
                 autosplit=690;		
                         
-        if(!prefs-&gt;get(FEATURE_USE_LAVCODEC_MPEG, &amp;lavcodec_mpeg))
-                lavcodec_mpeg=0;
         // Open DML (Gmv)
         if(!prefs-&gt;get(FEATURE_USE_ODML, &amp;use_odml))
           use_odml=0;
@@ -185,7 +182,6 @@
         /************************ Build diaelems ****************************************/
         diaElemToggle useSysTray(&amp;useTray,QT_TR_NOOP(&quot;_Use systray while encoding&quot;));
         diaElemToggle allowAnyMpeg(&amp;mpeg_no_limit,QT_TR_NOOP(&quot;_Accept non-standard audio frequency for DVD&quot;));
-        diaElemToggle useLavcodec(&amp;lavcodec_mpeg,QT_TR_NOOP(&quot;_Use libavcodec MPEG-2 decoder&quot;));
         diaElemToggle openDml(&amp;use_odml,QT_TR_NOOP(&quot;Create _OpenDML files&quot;));
         diaElemToggle autoIndex(&amp;useAutoIndex,QT_TR_NOOP(&quot;Automatically _index MPEG files&quot;));
         diaElemToggle autoSwap(&amp;useSwap,QT_TR_NOOP(&quot;Automatically _swap A and B if A&gt;B&quot;));
@@ -375,8 +371,8 @@
         diaElemTabs tabAuto(QT_TR_NOOP(&quot;Automation&quot;),5,diaAuto);
         
         /* Input */
-        diaElem *diaInput[]={&amp;nuvAudio,&amp;useLavcodec};
-        diaElemTabs tabInput(QT_TR_NOOP(&quot;Input&quot;),2,(diaElem **)diaInput);
+        diaElem *diaInput[]={&amp;nuvAudio};
+        diaElemTabs tabInput(QT_TR_NOOP(&quot;Input&quot;),1,(diaElem **)diaInput);
         
         /* Output */
         diaElem *diaOutput[]={&amp;autoSplit,&amp;openDml,&amp;allowAnyMpeg,&amp;togTagMp3};
@@ -482,8 +478,6 @@
                 prefs-&gt;set(FEATURE_MPEG_NO_LIMIT, mpeg_no_limit);
                 // Video render
                 prefs-&gt;set(DEVICE_VIDEODEVICE,render);
-                // Mpeg /lavcodec
-                prefs-&gt;set(FEATURE_USE_LAVCODEC_MPEG, lavcodec_mpeg);
                 // Odml
                 prefs-&gt;set(FEATURE_USE_ODML, use_odml);
 				// Split

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-03-16 15:16:03 UTC (rev 3898)
@@ -235,7 +235,6 @@
 
 ADD_ADMLIB_ALL_TARGETS(
 	ADM_mplex
-	ADM_libMpeg2Dec
 	ADM_libmpeg2enc
 	ADM_libtwolame
 	ADM_libwrapper

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2008-03-16 15:16:03 UTC (rev 3898)
@@ -65,7 +65,6 @@
 	FEATURE_SVCDRES_PREFEREDSOURCERATIO,
 	FEATURE_SAVEPREFSONEXIT,
 	FEATURE_IGNORESAVEDMARKERS,
-	FEATURE_USE_LAVCODEC_MPEG,
 	FEATURE_DISABLE_NUV_RESYNC,
 	FEATURE_TRYAUTOIDX,
 	FEATURE_USE_ODML,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2008-03-15 17:16:16 UTC (rev 3897)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2008-03-16 15:16:03 UTC (rev 3898)
@@ -74,7 +74,6 @@
 feature.svcdres.preferedsourceratio,	STRING, &quot;1:1&quot;
 feature.saveprefsonexit,		UINT,	1,	0,	1
 feature.ignoresavedmarkers,		UINT,	0,	0,	1
-feature.use_lavcodec_mpeg,		UINT,	0,	0,	1
 feature.disable_nuv_resync,		UINT,	0,	0,	1
 feature.tryautoidx,			UINT,	0,	0,	1
 feature.use_odml,                       UINT,   0,      0,      1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001160.html">[Avidemux-svn-commit] r3897 - in branches/avidemux_2.5_branch_gruntster: . avidemux avidemux/ADM_audio avidemux/ADM_audiocodec avidemux/ADM_audiodevice avidemux/ADM_audiofilter avidemux/ADM_codecs avidemux/ADM_colorspace avidemux/ADM_editor avidemux/ADM_encoder avidemux/ADM_filter avidemux/ADM_infoExtractor avidemux/ADM_inputs avidemux/ADM_inputs/ADM_amv avidemux/ADM_inputs/ADM_asf avidemux/ADM_inputs/ADM_avsproxy avidemux/ADM_inputs/ADM_flv avidemux/ADM_inputs/ADM_h263 avidemux/ADM_inputs/ADM_inpics avidemux/ADM_inputs/ADM_matroska avidemux/ADM_inputs/ADM_mp4 avidemux/ADM_inputs/ADM_mpegdemuxer avidemux/ADM_inputs/ADM_nuv avidemux/ADM_inputs/ADM_ogm avidemux/ADM_inputs/ADM_openDML avidemux/ADM_libraries avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/i386 avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/ppc avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavformat avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpos! tproc avidemux/ADM_libraries/ADM_ffmpeg/ADM_libswscale avidemux/ADM_libraries/ADM_libMpeg2Dec avidemux/ADM_libraries/ADM_libass avidemux/ADM_libraries/ADM_libmpeg2enc avidemux/ADM_libraries/ADM_libmpeg2enc/altivec avidemux/ADM_libraries/ADM_libtwolame avidemux/ADM_libraries/ADM_libwrapper avidemux/ADM_libraries/ADM_lvemux avidemux/ADM_libraries/ADM_mplex avidemux/ADM_libraries/ADM_smjs avidemux/ADM_libraries/ADM_utilities avidemux/ADM_libraries/ADM_xvidratectl avidemux/ADM_ocr avidemux/ADM_osSupport avidemux/ADM_outputs avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4 avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF avidemux/ADM_outputs/oplug_ogm avidemux/ADM_requant avidemux/ADM_script avidemux/ADM_toolkit avidemux/ADM_userInterfaces avidemux/ADM_userInterfaces/ADM_GTK avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory avidemux/ADM! _userInterfaces/ADM_GTK/ADM_filters avidemux/ADM_userInterface! s/ADM_GT
</A></li>
	<LI>Next message: <A HREF="001162.html">[Avidemux-svn-commit] r3899 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg:	ADM_lavcodec ADM_lavformat ADM_lavutil ADM_libpostproc	ADM_libswscale
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1161">[ date ]</a>
              <a href="thread.html#1161">[ thread ]</a>
              <a href="subject.html#1161">[ subject ]</a>
              <a href="author.html#1161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
