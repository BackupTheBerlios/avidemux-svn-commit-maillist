<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6209 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6209%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/js%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%20cmake&In-Reply-To=%3C201005201523.o4KFN2VR014370%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003408.html">
   <LINK REL="Next"  HREF="003410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6209 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6209%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/js%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%20cmake&In-Reply-To=%3C201005201523.o4KFN2VR014370%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6209 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src cmake">mean at mail.berlios.de
       </A><BR>
    <I>Thu May 20 17:23:02 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003408.html">[Avidemux-svn-commit] r6208 - in	branches/avidemux_2.6_branch_mean/avidemux: . common	common/ADM_editor common/ADM_script2	common/ADM_script2/include common/ADM_script2/js	common/ADM_script2/js/src_dialogFactory common/ADM_script2/py	common/ADM_script2/py/include common/ADM_script2/src	common/ADM_script2/src_dialogFactory	qt4/ADM_userInterfaces/ADM_shell
</A></li>
        <LI>Next message: <A HREF="003410.html">[Avidemux-svn-commit] r6210 -	branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3409">[ date ]</a>
              <a href="thread.html#3409">[ thread ]</a>
              <a href="subject.html#3409">[ subject ]</a>
              <a href="author.html#3409">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-05-20 17:23:01 +0200 (Thu, 20 May 2010)
New Revision: 6209

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemuxInfo.cpp
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm.admPy
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/cmake/admPy.pl
Log:
[script] Unify js and py

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h (from rev 6208, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h	2010-05-20 15:23:01 UTC (rev 6209)
@@ -0,0 +1,42 @@
+/**
+    \file ADM_jsAvidemux
+    \brief Standard includes and defines
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+int jsLoadVideo(const char *c);
+int jsAppendVideo(const char *c);
+int jsClearSegments(void);
+int jsAddSegment(int ref, double start, double duration);
+int jsAudioReset(void);
+int jsAudioMixer(const char *s);
+// Fq
+int32_t jsGetResample(void);
+void    jsSetResample(int32_t fq);
+// Markers
+double jsGetMarkerA(void);
+double jsGetMarkerB(void);
+void   jsSetMarkerA(double a);
+void   jsSetMarkerB(double b);
+//
+int    jsClearVideoFilters();
+// Info
+int jsGetWidth ( void) ;
+int jsGetHeight ( void) ;
+int jsGetFps1000 ( void) ;
+char *jsGetVideoCodec ( void) ;
+
+#ifdef __cplusplus
+};
+#endif 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -25,15 +25,8 @@
 #include &quot;ADM_audioFilterInterface.h&quot;
 #include &quot;audioEncoderApi.h&quot;
 extern ADM_Composer *video_body;
+
 /**
-    \fn int jsAudioReset(void);
-*/
-int jsAudioReset (void)
-{
-    audioFilterReset();
-    return 1;
-}
-/**
     \fn 
 */  
 extern &quot;C&quot; int   jsAudioCodec(const char *a,const char **b) {return 0;}
@@ -75,26 +68,4 @@
         
         return JS_TRUE;
 }
-/**
-    \fn jsAudioMixer
-*/
-int jsAudioMixer(const char *s)
-{
-    CHANNEL_CONF c=AudioMuxerStringToId(s);
-    return audioFilterSetMixer(c);
-}
-/**
-    \fn jsGetResample
-*/
-int32_t jsGetResample(void)
-{
-    return 0;
-}
-/**
-    \fn jsSetResample
-*/
-void    jsSetResample(int32_t fq)
-{
-
-}
-//EOF
\ No newline at end of file
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -20,81 +20,8 @@
 #include &quot;ADM_muxerProto.h&quot;
 #include &quot;GUI_ui.h&quot;
 extern ADM_Composer *video_body;
+bool A_setContainer(const char *cont);
 /**
-    \fn ADM_JSAvidemux
-    \brief Select the current container from a string
-*/
-bool A_setContainer(const char *cont)
-{
-    int idx=ADM_MuxerIndexFromName(cont);
-    if(idx==-1)
-    {
-        ADM_error(&quot;Cannot find muxer for format=%s\n&quot;,cont);
-        return false;
-    }
-    ADM_info(&quot;setting container as index %d\n&quot;,idx);
-    UI_SetCurrentFormat(idx);
-    return true;
-}
-
-/**
-    \fn jsLoadFile
-*/
-int jsLoadVideo(const char *s)
-{
-int ret=0;
-        jsLog(JS_LOG_NORMAL,&quot;[Js] Loading video %s&quot;,s);
-        if(A_openAvi(s)) 
-        {
-          ret=1;
-        }
-        
-    return ret;
-}
-
-/**
-    \fn jsAppendFile
-*/
-int jsAppendVideo(const char *s)
-{
-int ret=0;
-        
-        if(A_appendAvi(s)) 
-        {
-          ret=1;
-        }
-        
-    return ret;
-}
-
-/**
-    \fn jsClearSegments
-*/
-int jsClearSegments(void)
-{
-    video_body-&gt;clearSegment();
-    return 1;
-}
-/**
-    \fn jsAddSegment
-
-*/
-int  jsAddSegment(int ref, double start, double duration)
-{
-    if(true==video_body-&gt;addSegment(ref,(uint64_t)start,(uint64_t)duration)) 
-    {
-        if(1==video_body-&gt;getNbSegment()) // We just added our first seg...
-        {
-                ADM_info(&quot;First segment, refreshing screen\n&quot;);
-                A_Rewind();
-        }
-        return 1;
-    }
-    return 0;
-}
-
-
-/**
     \fn Codec
     
 */
@@ -132,4 +59,4 @@
 }// end Codec
 
 
-// EOF
\ No newline at end of file
+// EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.h	2010-05-20 15:23:01 UTC (rev 6209)
@@ -18,29 +18,9 @@
 #ifdef __cplusplus
 extern &quot;C&quot; {
 #endif
+#include &quot;ADM_scriptCommon.h&quot;
+//char *jsGetVideoCodec ( void) ;
 
-int jsLoadVideo(const char *c);
-int jsAppendVideo(const char *c);
-int jsClearSegments(void);
-int jsAddSegment(int ref, double start, double duration);
-int jsAudioReset(void);
-int jsAudioMixer(const char *s);
-// Fq
-int32_t jsGetResample(void);
-void    jsSetResample(int32_t fq);
-// Markers
-double jsGetMarkerA(void);
-double jsGetMarkerB(void);
-void   jsSetMarkerA(double a);
-void   jsSetMarkerB(double b);
-//
-int    jsClearVideoFilters();
-// Info
-int jsGetWidth ( void) ;
-int jsGetHeight ( void) ;
-int jsGetFps1000 ( void) ;
-char *jsGetVideoCodec ( void) ;
-
 // non jsapigen function, variables number of args
 JSBool jsAdmaddVideoFilter(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool jsAdmaudioCodec(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -1,59 +0,0 @@
-/**
-    \file ADM_jsLoad.cpp
-    \brief Load oriented functions
-    \author mean (c) 2009 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-
-
-*/
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;ADM_js.h&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_jsAvidemux.h&quot;
-#include &quot;fourcc.h&quot;
-extern ADM_Composer *video_body;
-/**
-    \fn jsGetWidth
-*/
-int jsGetWidth ( void)
-{
-aviInfo info;
-        video_body-&gt;getVideoInfo(&amp;info);
-        return info.width;
-}
-/**
-    \fn jsGetHeight
-*/
-int jsGetHeight ( void)
-{
-aviInfo info;
-        video_body-&gt;getVideoInfo(&amp;info);
-        return info.height;
-}
-/**
-    \fn jsGetFps1000
-*/
-int jsGetFps1000 ( void)
-{
-aviInfo info;
-        video_body-&gt;getVideoInfo(&amp;info);
-        return info.fps1000;
-}
-/**
-    \fn jsGetVideoCodec
-*/
-char *jsGetVideoCodec ( void)
-{
-uint32_t fcc;
-aviInfo info;
-        video_body-&gt;getVideoInfo(&amp;info);
-        fcc=info.fcc;
-        return fourCC::tostring(fcc);
-}
-// EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/CMakeLists.txt	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/CMakeLists.txt	2010-05-20 15:23:01 UTC (rev 6209)
@@ -9,7 +9,6 @@
         ADM_jsTestFactory_js.c
 # Load segment
         ADM_jsAvidemux.cpp
-        ADM_jsAvidemuxInfo.cpp
         ADM_jsAvidemux_js.c
 # Debug / editor class
         ADM_jsEditor.cpp

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -20,7 +20,8 @@
 #include &quot;ADM_coreTinyPy/include/ADM_tinypy.h&quot;
 #include &quot;ADM_script2/include/ADM_scriptShell.h&quot;
 #include &quot;A_functions.h&quot;
-
+#include &quot;ADM_scriptCommon.h&quot;
+#include &quot;ADM_scriptVideo.h&quot;
 #include &quot;adm_gen.h&quot;
 
 #include &quot;adm_gen.cpp&quot;
@@ -63,68 +64,5 @@
 	return true;
 }
 
-int  py_loadVideo (char *vid )
-{
-    printf(&quot;pyLoadVideo %s\n&quot;,vid);
-    return 0;
-}
-int  py_clearSegments (void)
-{
-    printf(&quot;py_clearSegments\n&quot;);
-    return 0;
-}
+// EOF
 
-int  py_appendVideo (char *vid )
-{
-    printf(&quot;py_appendVideo %s\n&quot;,vid);
-    return 0;
-}
-
-int  py_addSegment (int ,float , float )
-{
-    printf(&quot;py_addSegment\n&quot;);
-    return 0;
-}
-
-int  py_setPostProc (int a,int b, int c)
-{
-    printf(&quot;py_setPostProc\n&quot;);
-    return 0;
-}
-
-int  py_getWidth (void)
-{
-    printf(&quot;py_getWidth\n&quot;);
-    return 0;
-}
-
-int  py_getHeight (void)
-{
-    printf(&quot;py_getHeight\n&quot;);
-    return 0;
-}
-
-int  py_getFps1000 (void)
-{
-    printf(&quot;py_getFps1000\n&quot;);
-    return 0;
-}
-
-int  py_audioReset (void)
-{
-    printf(&quot;py_audioReset\n&quot;);
-    return 0;
-}
-
-int  py_audioMixer (char *mixer )
-{
-    printf(&quot;py_audioMixer\n&quot;);
-    return 0;
-}
-
-int  py_clearVideoFilters (void)
-{
-    printf(&quot;py_clearVideoFilters\n&quot;);
-    return 0;
-}
-

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm.admPy
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm.admPy	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm.admPy	2010-05-20 15:23:01 UTC (rev 6209)
@@ -1,13 +1,15 @@
-/* FUNC */ int loadVideo      (char * ) 
-/* FUNC */ int clearSegments  (void) 
-/* FUNC */ int appendVideo    (char * ) 
-/* FUNC */ int addSegment     (int ,float , float ) 
-/* FUNC */ int setPostProc    (int ,int , int ) 
-/* FUNC */ int getWidth       (void) 
-/* FUNC */ int getHeight      (void) 
-/* FUNC */ int getFps1000     (void) 
+#              cname:pyname
+
+/* FUNC */ int jsLoadVideo:loadVideo          (char * ) 
+/* FUNC */ int jsClearSegments:clearSegments  (void) 
+/* FUNC */ int jsAppendVideo:appendVideo      (char * ) 
+/* FUNC */ int jsAddSegment:addSegment        (int ,float , float ) 
+/* FUNC */ int jsSetPostProc:setPostProc      (int ,int , int ) 
+/* FUNC */ int jsGetWidth:getWidth            (void) 
+/* FUNC */ int jsGetHeight:getHeight          (void) 
+/* FUNC */ int jsGetFps1000:getFps1000        (void) 
 #/* FUNC */ char* getVideoCodec(void) 
-/* FUNC */ int audioReset     (void) 
-/* FUNC */ int audioMixer     (char * ) 
-/* FUNC */ int clearVideoFilters   (void) 
+/* FUNC */ int jsAudioReset:audioReset        (void) 
+/* FUNC */ int jsAudioMixer:audioMixer        (char * ) 
+/* FUNC */ int jsClearVideoFilters:clearVideoFilters   (void) 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -1,76 +1,76 @@
-//int  loadVideo &lt;char * &gt;
+//int  jsLoadVideo &lt;char * &gt;
 tp_obj zzpy_loadVideo(TP)
 {
 char * p0=(char *)TP_STR().string.val;
-int r=py_loadVideo(p0); 
+int r=jsLoadVideo(p0); 
 return tp_number(r);
 }
-//int  clearSegments &lt;void&gt;
+//int  jsClearSegments &lt;void&gt;
 tp_obj zzpy_clearSegments(TP)
 {
-int r=py_clearSegments(); 
+int r=jsClearSegments(); 
 return tp_number(r);
 }
-//int  appendVideo &lt;char * &gt;
+//int  jsAppendVideo &lt;char * &gt;
 tp_obj zzpy_appendVideo(TP)
 {
 char * p0=(char *)TP_STR().string.val;
-int r=py_appendVideo(p0); 
+int r=jsAppendVideo(p0); 
 return tp_number(r);
 }
-//int  addSegment &lt;int  float   float &gt;
+//int  jsAddSegment &lt;int  float   float &gt;
 tp_obj zzpy_addSegment(TP)
 {
 int p0=TP_NUM();
 float p1=TP_NUM();
 float p2=TP_NUM();
-int r=py_addSegment(p0,p1,p2); 
+int r=jsAddSegment(p0,p1,p2); 
 return tp_number(r);
 }
-//int  setPostProc &lt;int  int   int &gt;
+//int  jsSetPostProc &lt;int  int   int &gt;
 tp_obj zzpy_setPostProc(TP)
 {
 int p0=TP_NUM();
 int p1=TP_NUM();
 int p2=TP_NUM();
-int r=py_setPostProc(p0,p1,p2); 
+int r=jsSetPostProc(p0,p1,p2); 
 return tp_number(r);
 }
-//int  getWidth &lt;void&gt;
+//int  jsGetWidth &lt;void&gt;
 tp_obj zzpy_getWidth(TP)
 {
-int r=py_getWidth(); 
+int r=jsGetWidth(); 
 return tp_number(r);
 }
-//int  getHeight &lt;void&gt;
+//int  jsGetHeight &lt;void&gt;
 tp_obj zzpy_getHeight(TP)
 {
-int r=py_getHeight(); 
+int r=jsGetHeight(); 
 return tp_number(r);
 }
-//int  getFps1000 &lt;void&gt;
+//int  jsGetFps1000 &lt;void&gt;
 tp_obj zzpy_getFps1000(TP)
 {
-int r=py_getFps1000(); 
+int r=jsGetFps1000(); 
 return tp_number(r);
 }
-//int  audioReset &lt;void&gt;
+//int  jsAudioReset &lt;void&gt;
 tp_obj zzpy_audioReset(TP)
 {
-int r=py_audioReset(); 
+int r=jsAudioReset(); 
 return tp_number(r);
 }
-//int  audioMixer &lt;char * &gt;
+//int  jsAudioMixer &lt;char * &gt;
 tp_obj zzpy_audioMixer(TP)
 {
 char * p0=(char *)TP_STR().string.val;
-int r=py_audioMixer(p0); 
+int r=jsAudioMixer(p0); 
 return tp_number(r);
 }
-//int  clearVideoFilters &lt;void&gt;
+//int  jsClearVideoFilters &lt;void&gt;
 tp_obj zzpy_clearVideoFilters(TP)
 {
-int r=py_clearVideoFilters(); 
+int r=jsClearVideoFilters(); 
 return tp_number(r);
 }
 pyFuncs adm_functions[]={

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.h	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.h	2010-05-20 15:23:01 UTC (rev 6209)
@@ -1,11 +1,11 @@
-int  py_loadVideo (char * );
-int  py_clearSegments (void);
-int  py_appendVideo (char * );
-int  py_addSegment (int ,float , float );
-int  py_setPostProc (int ,int , int );
-int  py_getWidth (void);
-int  py_getHeight (void);
-int  py_getFps1000 (void);
-int  py_audioReset (void);
-int  py_audioMixer (char * );
-int  py_clearVideoFilters (void);
+int  loadVideo (char * );
+int  clearSegments (void);
+int  appendVideo (char * );
+int  addSegment (int ,float , float );
+int  setPostProc (int ,int , int );
+int  getWidth (void);
+int  getHeight (void);
+int  getFps1000 (void);
+int  audioReset (void);
+int  audioMixer (char * );
+int  clearVideoFilters (void);

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp (from rev 6208, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -0,0 +1,58 @@
+/**
+    \file ADM_jsAudio.cpp
+    \brief Audio oriented functions
+    \author mean (c) 2009 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+
+
+    jsapigen does not like much variable number of arguments
+    In that case, we patch the generated file to go back to native spidermonkey api
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_scriptIf.h&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;A_functions.h&quot;
+#include &quot;GUI_ui.h&quot;
+#include &quot;ADM_audioFilterInterface.h&quot;
+#include &quot;audioEncoderApi.h&quot;
+#include &quot;ADM_scriptCommon.h&quot;
+extern ADM_Composer *video_body;
+/**
+    \fn int jsAudioReset(void);
+*/
+int jsAudioReset (void)
+{
+    audioFilterReset();
+    return 1;
+}
+/**
+    \fn jsAudioMixer
+*/
+int jsAudioMixer(const char *s)
+{
+    CHANNEL_CONF c=AudioMuxerStringToId(s);
+    return audioFilterSetMixer(c);
+}
+/**
+    \fn jsGetResample
+*/
+int32_t jsGetResample(void)
+{
+    return 0;
+}
+/**
+    \fn jsSetResample
+*/
+void    jsSetResample(int32_t fq)
+{
+
+}
+//EOF
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -0,0 +1,98 @@
+/**
+    \file ADM_jsLoad.cpp
+    \brief Load oriented functions
+    \author mean (c) 2009 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;A_functions.h&quot;
+#include &quot;ADM_muxerProto.h&quot;
+#include &quot;GUI_ui.h&quot;
+#include &quot;ADM_scriptIf.h&quot;
+#include &quot;ADM_scriptCommon.h&quot;
+extern ADM_Composer *video_body;
+/**
+    \fn ADM_JSAvidemux
+    \brief Select the current container from a string
+*/
+bool A_setContainer(const char *cont)
+{
+    int idx=ADM_MuxerIndexFromName(cont);
+    if(idx==-1)
+    {
+        ADM_error(&quot;Cannot find muxer for format=%s\n&quot;,cont);
+        return false;
+    }
+    ADM_info(&quot;setting container as index %d\n&quot;,idx);
+    UI_SetCurrentFormat(idx);
+    return true;
+}
+
+/**
+    \fn jsLoadFile
+*/
+int jsLoadVideo(const char *s)
+{
+int ret=0;
+        jsLog(JS_LOG_NORMAL,&quot;[Js] Loading video %s&quot;,s);
+        if(A_openAvi(s)) 
+        {
+          ret=1;
+        }
+        
+    return ret;
+}
+
+/**
+    \fn jsAppendFile
+*/
+int jsAppendVideo(const char *s)
+{
+int ret=0;
+        
+        if(A_appendAvi(s)) 
+        {
+          ret=1;
+        }
+        
+    return ret;
+}
+
+/**
+    \fn jsClearSegments
+*/
+int jsClearSegments(void)
+{
+    video_body-&gt;clearSegment();
+    return 1;
+}
+/**
+    \fn jsAddSegment
+
+*/
+int  jsAddSegment(int ref, double start, double duration)
+{
+    if(true==video_body-&gt;addSegment(ref,(uint64_t)start,(uint64_t)duration)) 
+    {
+        if(1==video_body-&gt;getNbSegment()) // We just added our first seg...
+        {
+                ADM_info(&quot;First segment, refreshing screen\n&quot;);
+                A_Rewind();
+        }
+        return 1;
+    }
+    return 0;
+}
+
+
+// EOF

Copied: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemuxInfo.cpp (from rev 6208, branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemuxInfo.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemuxInfo.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -0,0 +1,59 @@
+/**
+    \file ADM_jsLoad.cpp
+    \brief Load oriented functions
+    \author mean (c) 2009 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_scriptIf.h&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_scriptCommon.h&quot;
+#include &quot;fourcc.h&quot;
+extern ADM_Composer *video_body;
+/**
+    \fn jsGetWidth
+*/
+int jsGetWidth ( void)
+{
+aviInfo info;
+        video_body-&gt;getVideoInfo(&amp;info);
+        return info.width;
+}
+/**
+    \fn jsGetHeight
+*/
+int jsGetHeight ( void)
+{
+aviInfo info;
+        video_body-&gt;getVideoInfo(&amp;info);
+        return info.height;
+}
+/**
+    \fn jsGetFps1000
+*/
+int jsGetFps1000 ( void)
+{
+aviInfo info;
+        video_body-&gt;getVideoInfo(&amp;info);
+        return info.fps1000;
+}
+/**
+    \fn jsGetVideoCodec
+*/
+char *jsGetVideoCodec ( void)
+{
+uint32_t fcc;
+aviInfo info;
+        video_body-&gt;getVideoInfo(&amp;info);
+        fcc=info.fcc;
+        return fourCC::tostring(fcc);
+}
+// EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp	2010-05-20 15:23:01 UTC (rev 6209)
@@ -26,18 +26,10 @@
 #include &quot;ADM_videoFilterApi.h&quot;
 #include &quot;ADM_videoFilters.h&quot;
 #include &quot;GUI_ui.h&quot;
+#include &quot;ADM_scriptCommon.h&quot;
 extern ADM_Composer *video_body;
 bool A_setVideoCodec(const char *nm);
 /**
-    \fn jsSetPostProc
-*/
-int jsSetPostProc (int a,int b, int c)
-{
-    return video_body-&gt;setPostProc(a,b,c);
-}
-
-
-/**
     \fn A_setVideoCodec
 */
 bool A_setVideoCodec(const char *nm)
@@ -52,7 +44,17 @@
     UI_setVideoCodec(idx);
     return true;
 }
+
 /**
+    \fn jsSetPostProc
+*/
+int jsSetPostProc (int a,int b, int c)
+{
+    return video_body-&gt;setPostProc(a,b,c);
+}
+
+
+/**
      \fn jsClearFilters
 */
 int jsClearVideoFilters()

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/CMakeLists.txt	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/CMakeLists.txt	2010-05-20 15:23:01 UTC (rev 6209)
@@ -1,8 +1,12 @@
 SET(ADM_script_SRCS
         ADM_scriptIf.cpp
         ADM_scriptVideo.cpp
+        ADM_scriptAvidemux.cpp
+        ADM_scriptAvidemuxInfo.cpp
+        ADM_scriptAudio.cpp
 )
 
+
 ADD_LIBRARY(ADM_script6 STATIC ${ADM_script_SRCS})
 include_directories(../include)
 include_directories(.)

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-05-20 15:23:01 UTC (rev 6209)
@@ -97,10 +97,10 @@
 #ADM_filter6 
 ADM_osSupport6 
 ADM_requant6 
-ADM_script6 
 ADM_pyScript6 
 ADM_jsScript6 
-#ADM_scriptDF
+ADM_scriptDF
+ADM_script6 
 ADM_videoEncoder6 
 ADM_internalVideoFilter6
 ADM_toolkit6

Modified: branches/avidemux_2.6_branch_mean/cmake/admPy.pl
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admPy.pl	2010-05-20 15:22:57 UTC (rev 6208)
+++ branches/avidemux_2.6_branch_mean/cmake/admPy.pl	2010-05-20 15:23:01 UTC (rev 6209)
@@ -4,7 +4,7 @@
 my $headerFile;
 my $line;
 my $glueprefix=&quot;zzpy_&quot;;
-my $functionPrefix=&quot;py_&quot;;
+my $functionPrefix=&quot;&quot;;
 my @allFuncs;
 #
 #
@@ -68,6 +68,7 @@
         my @params;
         my $retType=$proto;;
         my $func=$proto;;
+        my $cfunc;
         $args=~s/^.*\(//g;
         $args=~s/\).*$//g;
         #print &quot;args =&gt; $args\n&quot;;
@@ -79,7 +80,8 @@
         # get functioName
         $func=~s/ *\(.*$//g;
         $func=~s/^.* //g;
-        print OUTPUT &quot;//$retType  $func &lt;@params&gt;\n&quot;;
+        ($cfunc,$func)=split &quot;:&quot;,$func;
+        print OUTPUT &quot;//$retType  $cfunc &lt;@params&gt;\n&quot;;
         # Write glue code
         print OUTPUT &quot;tp_obj &quot;.$glueprefix.$func.&quot;(TP)\n&quot;;
         push(@allFuncs,$func);
@@ -109,7 +111,7 @@
         {
                 print OUTPUT $retType.&quot; r=&quot;;
         }
-        print OUTPUT $functionPrefix.$func.&quot;(&quot;;
+        print OUTPUT $functionPrefix.$cfunc.&quot;(&quot;;
         for($i=0;$i&lt;$nb;$i++)
         {
                 if($i)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003408.html">[Avidemux-svn-commit] r6208 - in	branches/avidemux_2.6_branch_mean/avidemux: . common	common/ADM_editor common/ADM_script2	common/ADM_script2/include common/ADM_script2/js	common/ADM_script2/js/src_dialogFactory common/ADM_script2/py	common/ADM_script2/py/include common/ADM_script2/src	common/ADM_script2/src_dialogFactory	qt4/ADM_userInterfaces/ADM_shell
</A></li>
	<LI>Next message: <A HREF="003410.html">[Avidemux-svn-commit] r6210 -	branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3409">[ date ]</a>
              <a href="thread.html#3409">[ thread ]</a>
              <a href="subject.html#3409">[ subject ]</a>
              <a href="author.html#3409">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
