<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6214 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_editor avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_core/ADM_coreTinyPy/include	avidemux_core/ADM_coreTinyPy/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6214%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_editor%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/js%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_core/ADM_coreTinyPy/include%0A%09avidemux_core/ADM_coreTinyPy/src&In-Reply-To=%3C201005231525.o4NFPrBI008876%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003413.html">
   <LINK REL="Next"  HREF="003415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6214 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_editor avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_core/ADM_coreTinyPy/include	avidemux_core/ADM_coreTinyPy/src</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6214%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_editor%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/js%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_core/ADM_coreTinyPy/include%0A%09avidemux_core/ADM_coreTinyPy/src&In-Reply-To=%3C201005231525.o4NFPrBI008876%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6214 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_editor avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/js avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_core/ADM_coreTinyPy/include	avidemux_core/ADM_coreTinyPy/src">mean at mail.berlios.de
       </A><BR>
    <I>Sun May 23 17:25:53 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003413.html">[Avidemux-svn-commit] r6213 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. qt4
</A></li>
        <LI>Next message: <A HREF="003415.html">[Avidemux-svn-commit] r6215 -	branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3414">[ date ]</a>
              <a href="thread.html#3414">[ thread ]</a>
              <a href="subject.html#3414">[ subject ]</a>
              <a href="author.html#3414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-05-23 17:25:52 +0200 (Sun, 23 May 2010)
New Revision: 6214

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptIf.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_js.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsDebug.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsEditor.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsTestFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/include/ADM_tinypy.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
Log:
[js/py] factorize logger + add help() python call

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -482,12 +482,12 @@
     {
         _SEGMENT *s=getSegment(i);
         
-        jsLog(JS_LOG_NORMAL,&quot;Segment :%d/%d&quot;,i,n);
-        jsLog(JS_LOG_NORMAL,&quot;\tReference    :%&quot;LU,s-&gt;_reference,ADM_us2plain(s-&gt;_reference));
-        jsLog(JS_LOG_NORMAL,&quot;\tstartLinear  :%08&quot;LLU&quot; %s&quot;,s-&gt;_startTimeUs,ADM_us2plain(s-&gt;_startTimeUs));
-        jsLog(JS_LOG_NORMAL,&quot;\tduration     :%08&quot;LLU&quot; %s&quot;,s-&gt;_durationUs,ADM_us2plain(s-&gt;_durationUs));
-        jsLog(JS_LOG_NORMAL,&quot;\trefStartPts  :%08&quot;LLU&quot; %s&quot;,s-&gt;_refStartTimeUs,ADM_us2plain(s-&gt;_refStartTimeUs));
-        jsLog(JS_LOG_NORMAL,&quot;\trefStartDts  :%08&quot;LLU&quot; %s&quot;,s-&gt;_refStartDts,ADM_us2plain(s-&gt;_refStartDts));
+        jsLog(&quot;Segment :%d/%d&quot;,i,n);
+        jsLog( &quot;\tReference    :%&quot;LU,s-&gt;_reference,ADM_us2plain(s-&gt;_reference));
+        jsLog( &quot;\tstartLinear  :%08&quot;LLU&quot; %s&quot;,s-&gt;_startTimeUs,ADM_us2plain(s-&gt;_startTimeUs));
+        jsLog( &quot;\tduration     :%08&quot;LLU&quot; %s&quot;,s-&gt;_durationUs,ADM_us2plain(s-&gt;_durationUs));
+        jsLog( &quot;\trefStartPts  :%08&quot;LLU&quot; %s&quot;,s-&gt;_refStartTimeUs,ADM_us2plain(s-&gt;_refStartTimeUs));
+        jsLog( &quot;\trefStartDts  :%08&quot;LLU&quot; %s&quot;,s-&gt;_refStartDts,ADM_us2plain(s-&gt;_refStartDts));
     }
 }
 /**
@@ -503,10 +503,10 @@
     {
         _VIDEOS *s=getRefVideo(i);
 
-        jsLog(JS_LOG_NORMAL,&quot;Videos :%d/%d&quot;,i,n);
-        jsLog(JS_LOG_NORMAL,&quot;\tfirstFramePts      :%08&quot;LLU&quot; %s&quot;,s-&gt;firstFramePts,ADM_us2plain(s-&gt;firstFramePts));
-        jsLog(JS_LOG_NORMAL,&quot;\ttimeIncrementInUs  :%08&quot;LLU&quot; %s&quot;,s-&gt;timeIncrementInUs,ADM_us2plain(s-&gt;timeIncrementInUs));
-        jsLog(JS_LOG_NORMAL,&quot;\tnb frames    :%08&quot;LLU,s-&gt;_nb_video_frames);
+        jsLog(&quot;Videos :%d/%d&quot;,i,n);
+        jsLog(&quot;\tfirstFramePts      :%08&quot;LLU&quot; %s&quot;,s-&gt;firstFramePts,ADM_us2plain(s-&gt;firstFramePts));
+        jsLog(&quot;\ttimeIncrementInUs  :%08&quot;LLU&quot; %s&quot;,s-&gt;timeIncrementInUs,ADM_us2plain(s-&gt;timeIncrementInUs));
+        jsLog(&quot;\tnb frames    :%08&quot;LLU,s-&gt;_nb_video_frames);
     }
 
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptIf.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptIf.h	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptIf.h	2010-05-23 15:25:52 UTC (rev 6214)
@@ -19,19 +19,23 @@
 */
 typedef enum
 {
-    JS_LOG_NORMAL,
-    JS_LOG_ERROR
-}JS_LOG_TYPE;
+    SCRIPT_LOG_NORMAL,
+    SCRIPT_LOG_ERROR
+}SCRIPT_LOG_TYPE;
 /**
     \typedef jsLoggerFunc
 */
-typedef bool (jsLoggerFunc)(void *cookie,JS_LOG_TYPE type,const char *);
+typedef bool (scriptLoggerFunc)(void *cookie,SCRIPT_LOG_TYPE type,const char *);
 /*
+    Interface used by shell
+*/
+bool ADM_scriptRegisterLogger(void *cookie,scriptLoggerFunc *fun);
+bool ADM_scriptUnregisterLogger(void);
+/**
 
 */
-bool ADM_jsRegisterLogger(void *cookie,jsLoggerFunc *fun);
-bool ADM_jsUnregisterLogger(void);
-
+bool jsLog(const char *fmt,...);
+bool jsLogError(const char *fmt,...);
 /**
     \fn parseECMAScript
     \brief Compile &amp; execute ecma script
@@ -47,7 +51,7 @@
     \fn jsLog
 
 */
-bool jsLog(JS_LOG_TYPE type, const char *fmt,...);
+bool scriptLog(SCRIPT_LOG_TYPE type, const char *fmt,...);
 
 /**
     \fn SpidermonkeyInit

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_js.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_js.h	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_js.h	2010-05-23 15:25:52 UTC (rev 6214)
@@ -29,7 +29,8 @@
 
 typedef JSBool JS_PROTOTYPE(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 
-
+bool jsLog( const char *fmt,...);
+bool jsLogError( const char *fmt,...);
 /**
     \struct ADM_JS_HOOK
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAudio.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -47,7 +47,7 @@
         if(!audioCodecSetByName(name))
         {
                 *rval = BOOLEAN_TO_JSVAL(false);
-                jsLog(JS_LOG_ERROR,&quot;Cannot set audio codec %s\n&quot;,name);
+                jsLogError(&quot;Cannot set audio codec %s\n&quot;,name);
         }
         else
         {

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsAvidemux.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -33,17 +33,17 @@
         *rval = BOOLEAN_TO_JSVAL(false);
         if(argc &lt; 1)
         {
-            jsLog(JS_LOG_NORMAL,&quot;setContainer needs at least one arg\n&quot;);
+            jsLog(&quot;setContainer needs at least one arg\n&quot;);
             return JS_FALSE;
         }
         
         if(JSVAL_IS_STRING(argv[0]) == false)
         {
-                jsLog(JS_LOG_NORMAL,&quot;setContainer needs at string arg\n&quot;);
+                jsLog(&quot;setContainer needs at string arg\n&quot;);
                 return JS_FALSE;
         }
         char *str = JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
-         jsLog(JS_LOG_NORMAL,&quot;[JS] Selecting container :%s\n&quot;,str);
+         jsLog(&quot;[JS] Selecting container :%s\n&quot;,str);
         if(A_setContainer(str))
         {
             CONFcouple *c;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsDebug.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsDebug.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsDebug.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -52,11 +52,11 @@
 */
 void jsPrint(const char *s)
 {// begin print
-        jsLog(JS_LOG_NORMAL,&quot;%s&quot;,s);
+        jsLog(&quot;%s&quot;,s);
 }// end print
 void jsPrint2(const char *s)
 {// begin print
-        jsLog(JS_LOG_NORMAL,&quot;%s&quot;,s);
+        jsLog(&quot;%s&quot;,s);
 }// end print
 
 
@@ -64,7 +64,7 @@
 {
     while(f-&gt;name)
     {
-        jsLog(JS_LOG_NORMAL,&quot;     %s(..)&quot;,f-&gt;name);
+        jsLog(&quot;     %s(..)&quot;,f-&gt;name);
         f++;
     }
 }
@@ -87,16 +87,16 @@
 	if( strncmp(buf,&quot;//AD&quot;,4) )
     {
             if (report-&gt;filename || report-&gt;lineno)
-                jsLog(JS_LOG_ERROR,&quot;%s: line %d:\nMsg: %s\n&quot;,
+                jsLogError(&quot;%s: line %d:\nMsg: %s\n&quot;,
                               report-&gt;filename,
                               report-&gt;lineno,
                               message);
             else
-                jsLog(JS_LOG_ERROR,&quot;Error&quot;);
+                jsLogError(&quot;Error&quot;);
     
 	}else
     {
-            jsLog(JS_LOG_ERROR,&quot;%s: line %d:\nMsg: %s\n&quot;,report-&gt;filename,report-&gt;lineno,message);
+            jsLogError(&quot;%s: line %d:\nMsg: %s\n&quot;,report-&gt;filename,report-&gt;lineno,message);
 	}
        
     if(quiet)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsEditor.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsEditor.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsEditor.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -30,10 +30,10 @@
     {
         int64_t delta=0;
         if(pts!=ADM_NO_PTS &amp;&amp; dts!=ADM_NO_PTS) delta=(int64_t)pts-(int64_t)dts;
-        jsLog(JS_LOG_NORMAL,&quot;Frame %&quot;LU&quot; : Flags 0x%&quot;LX&quot; pts=%&quot;LLD&quot; dts=%&quot;LLD&quot; delta=%&quot;LLD&quot; ms&quot;,framenumber,flags,pts,dts,delta/1000LL);
+        jsLog(&quot;Frame %&quot;LU&quot; : Flags 0x%&quot;LX&quot; pts=%&quot;LLD&quot; dts=%&quot;LLD&quot; delta=%&quot;LLD&quot; ms&quot;,framenumber,flags,pts,dts,delta/1000LL);
     }else
     {
-        jsLog(JS_LOG_NORMAL,&quot;Cannot get info for frame %&quot;LU,framenumber);
+        jsLog(&quot;Cannot get info for frame %&quot;LU,framenumber);
     }
     return 0;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -120,7 +120,7 @@
 {
     while(f-&gt;name)
     {
-        jsLog(JS_LOG_NORMAL,&quot;    %s&quot;,f-&gt;name);
+        jsLog(&quot;    %s&quot;,f-&gt;name);
         f++;
     }
 }
@@ -141,16 +141,16 @@
         {
             const char *t=jsHooks[i].text;
             if(t)
-                jsLog(JS_LOG_NORMAL,&quot;%s&quot;,t);
+                jsLog(&quot;%s&quot;,t);
             return dump(jsHooks[i].jsFunctions);
         }
     }
 //    if(!strcasecmp(s,&quot;load&quot;)) return dump(jsGetAvidemuxFunctions());
 none:
-        jsLog(JS_LOG_NORMAL,&quot;please use help(\&quot;xxx\&quot;) with xx among&quot;);
+        jsLog(&quot;please use help(\&quot;xxx\&quot;) with xx among&quot;);
 
         for(int i=0;i&lt;n;i++)
-            jsLog(JS_LOG_NORMAL,&quot;    %s&quot;,jsHooks[i].name);
+            jsLog(&quot;    %s&quot;,jsHooks[i].name);
 
 }
 } // extern &quot;C&quot;
@@ -283,7 +283,7 @@
 extern &quot;C&quot; void jsSetSuccess(int bSuccess)
 {// begin JS_setSuccess
 	g_bJSSuccess = bSuccess;
-	jsLog(JS_LOG_NORMAL,&quot;[ECMA] success : %d\n&quot;, g_bJSSuccess);
+	jsLog(&quot;[ECMA] success : %d\n&quot;, g_bJSSuccess);
 }// end JS_setSuccess
 /**
     \fn SpidermonkeyExit

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsTestFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsTestFactory.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsTestFactory.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -54,7 +54,7 @@
     
   if(diaFactoryRun(QT_TR_NOOP(&quot;Test uinteger&quot;),1,elems))
   {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %u\n&quot;,tog);
+    jsLog(&quot;Value : %u\n&quot;,tog);
     return true;
   }
   return false;
@@ -71,7 +71,7 @@
     
   if(diaFactoryRun(&quot;Test float&quot;,1,elems))
   {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %f\n&quot;,(float)tog);
+    jsLog(&quot;Value : %f\n&quot;,(float)tog);
     return true;
   }
   return false;
@@ -93,7 +93,7 @@
     
   if(diaFactoryRun(&quot;Test Toggle&quot;,3,elems))
    {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %u\n&quot;,tog);
+    jsLog(&quot;Value : %u\n&quot;,tog);
     return true;
   }
   return false;
@@ -122,7 +122,7 @@
 diaElem *elems[]={&amp;blend,&amp;toggle   };
   if(diaFactoryRun(&quot;Test Menu&quot;,2,elems))
    {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %&quot;LU&quot;\n&quot;,tog);
+    jsLog(&quot;Value : %&quot;LU&quot;\n&quot;,tog);
     return true;
   }
   return false;
@@ -140,7 +140,7 @@
       diaElem *elems[]={&amp;fread   };
   if(diaFactoryRun(&quot;Test FileRead&quot;,1,elems))
    {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %s\n&quot;,test);
+    jsLog(&quot;Value : %s\n&quot;,test);
     if(test) ADM_dealloc(test);
     return true;
   }
@@ -160,7 +160,7 @@
   diaElem *elems[]={&amp;fread   };
   if(diaFactoryRun(&quot;Test DirSel&quot;,1,elems))
   {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %s\n&quot;,test);
+    jsLog(&quot;Value : %s\n&quot;,test);
     if(test) ADM_dealloc(test);
     return true;
   }
@@ -240,7 +240,7 @@
       diaElem *elems[]={&amp;slide   };
   if(diaFactoryRun(&quot;Test Slider&quot;,1,elems))
   {
-    jsLog(JS_LOG_NORMAL,&quot;Value : %d\n&quot;,(int)val);
+    jsLog(&quot;Value : %d\n&quot;,(int)val);
     return true;
   }
   return false;
@@ -275,7 +275,7 @@
       diaElem *elems[]={&amp;txt   };
   if(diaFactoryRun(&quot;Test FileRead&quot;,1,elems))
  {
-    jsLog(JS_LOG_NORMAL,&quot;Out:%s&quot;,foo);
+    jsLog(&quot;Out:%s&quot;,foo);
     if(foo) ADM_dealloc(foo);
     return true;
   }
@@ -378,7 +378,7 @@
       for(int x=0;x&lt;4*4;x++)
       {
           if(x &amp;&amp; !(x&amp;3)) printf(&quot;\n&quot;);
-          jsLog(JS_LOG_NORMAL,&quot;%02x &quot;,data[x]);
+          jsLog(&quot;%02x &quot;,data[x]);
           
       }
       return true;
@@ -398,7 +398,7 @@
     
   if(diaFactoryRun(&quot;Test ThreadCount&quot;,1,elems))
   {
-         jsLog(JS_LOG_NORMAL,&quot;Thread: %u &quot;,(unsigned int)val);
+         jsLog(&quot;Thread: %u &quot;,(unsigned int)val);
         return true;
   }
   return false;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -41,7 +41,7 @@
                 return JS_FALSE;
         if(JSVAL_IS_STRING(argv[0]) == false )
         {
-                jsLog(JS_LOG_ERROR,&quot;Cannot set codec, first parameter is not a string\n&quot;);
+                jsLog(&quot;Cannot set codec, first parameter is not a string\n&quot;);
                 return JS_FALSE;
         }
         char *codec=JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
@@ -49,13 +49,13 @@
         
         if(A_setVideoCodec(codec)==false)
         {
-            jsLog(JS_LOG_ERROR,&quot;Could not select codec %s\n&quot;,codec);
+            jsLog(&quot;Could not select codec %s\n&quot;,codec);
             return JS_FALSE;
         }
         CONFcouple *c;
         jsArgToConfCouple(argc-1,&amp;c,argv+1);
         *rval = BOOLEAN_TO_JSVAL( videoEncoder6_SetConfiguration(c));
-        jsLog(JS_LOG_NORMAL,&quot;Selected codec %s\n&quot;,codec);
+        jsLog(&quot;Selected codec %s\n&quot;,codec);
         if(c) delete c;
         return JS_TRUE;
 }// end Codec
@@ -75,7 +75,7 @@
                 return JS_FALSE;
         char *filterName=JS_GetStringBytes(JSVAL_TO_STRING(argv[0]));
         filterTag = ADM_vf_getTagFromInternalName(filterName);
-        jsLog(JS_LOG_NORMAL,&quot;Adding Filter %s -&gt; %&quot;LU&quot;... \n&quot;,filterName,filterTag);
+        jsLog(&quot;Adding Filter %s -&gt; %&quot;LU&quot;... \n&quot;,filterName,filterTag);
 
         
         CONFcouple *c=NULL;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/ADM_pyAdm.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -26,15 +26,39 @@
 
 #include &quot;adm_gen.cpp&quot;
 /**
+
+*/
+static  bool pyLogger(const char *s)
+{
+    jsLog(s);
+    return true;
+}
+/**
+    \fn initPy
+*/  
+static bool initPy(tinyPy *py)
+{
+    py-&gt;init();
+    py-&gt;registerFuncs(&quot;adm&quot;,adm_functions);
+    tinyPy::registerLogger(pyLogger);
+    return true;
+}
+static bool deinitPy(tinyPy *py)
+{
+    tinyPy::unregisterLogger();
+    return true;
+}
+/**
     \fn    parseTinyPyScript
     \brief Execute a tinyPy script
 */
 bool parseTinyPyScript(const char *name)
 {
         tinyPy py;
-        py.init();
-        py.registerFuncs(&quot;adm&quot;,adm_functions);
-        return py.execFile(name);
+        initPy(&amp;py);
+        bool r=py.execFile(name);
+        deinitPy(&amp;py);
+        return r;
 }
 
 /**
@@ -53,10 +77,9 @@
 bool interactiveTinyPy(void)
 {
     myPy=new tinyPy;
-    myPy-&gt;init();
-    myPy-&gt;registerFuncs(&quot;adm&quot;,adm_functions);
-
+    initPy(myPy);
     ADM_startShell(pyEvaluate);
+    deinitPy(myPy);
     delete myPy;
     myPy=NULL;
 	A_Resync();

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAvidemux.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -44,7 +44,7 @@
 int jsLoadVideo(const char *s)
 {
 int ret=0;
-        jsLog(JS_LOG_NORMAL,&quot;[Js] Loading video %s&quot;,s);
+        jsLog(&quot;[Js] Loading video %s&quot;,s);
         if(A_openAvi(s)) 
         {
           ret=1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -20,20 +20,20 @@
 void    A_Resync(void);
 
 /* our variables */
-static jsLoggerFunc *jsLogger=NULL;
-static void *jsLoggerCookie=NULL;
+static scriptLoggerFunc *scriptLogger=NULL;
+static void             *scriptLoggerCookie=NULL;
 /**
     \fn jsLogger
 */
 bool isJsLogRedirected(void)
 {
-    if(jsLogger) return true;
+    if(scriptLogger) return true;
     return false;
 }
 /**
     \fn jsLog
 */
-bool jsLog(JS_LOG_TYPE type, const char *prf,...)
+bool jsLog( const char *prf,...)
 {
  static char print_buffer[1024];
   	
@@ -43,12 +43,9 @@
 		va_end(list);
 		print_buffer[1023]=0; // ensure the string is terminated
         if(true==isJsLogRedirected())
-            jsLogger(jsLoggerCookie,type,print_buffer);
+            scriptLogger(scriptLoggerCookie,SCRIPT_LOG_NORMAL,print_buffer);
         else
         {
-            if(type==JS_LOG_ERROR)
-                GUI_Error_HIG(&quot;Script Error&quot;,&quot;%s&quot;,print_buffer);
-            else
                 ADM_warning(&quot;[JS]%s\n&quot;,print_buffer);
         }
 
@@ -56,20 +53,41 @@
 }
 
 /**
-    \fn ADM_jsRegisterLogger
+    \fn jsLogError
 */
-bool ADM_jsRegisterLogger(void *cookie,jsLoggerFunc *fun)
+bool jsLogError(const char *prf,...)
 {
-    jsLoggerCookie=cookie;
-    jsLogger=fun;
+ static char print_buffer[1024];
+  	
+		va_list 	list;
+		va_start(list,	prf);
+		vsnprintf(print_buffer,1023,prf,list);
+		va_end(list);
+		print_buffer[1023]=0; // ensure the string is terminated
+        if(true==isJsLogRedirected())
+            scriptLogger(scriptLoggerCookie,SCRIPT_LOG_ERROR,print_buffer);
+        else
+        {
+                GUI_Error_HIG(&quot;Script Error&quot;,&quot;%s&quot;,print_buffer);
+        }
+
+        return true;
+}
+/**
+    \fn ADM_scriptRegisterLogger
+*/
+bool ADM_scriptRegisterLogger(void *cookie,scriptLoggerFunc *fun)
+{
+    scriptLoggerCookie=cookie;
+    scriptLogger=fun;
     return true;
 }
 /**
-    \fn ADM_jsUnregisterLogger
+    \fn ADM_scriptUnregisterLogger
 */
-bool ADM_jsUnregisterLogger(void)
+bool ADM_scriptUnregisterLogger(void)
 {
-    jsLogger=NULL;
+    scriptLogger=NULL;
     return true;
 }
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -38,8 +38,8 @@
     ui.textBrowser_2-&gt;installEventFilter(this);
     connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
     connect((ui.clear),SIGNAL(clicked(bool)),this,SLOT(clear(bool)));
-    print(JS_LOG_NORMAL,&quot;Enter your commands then press the evaluate button or CTRL+ENTER.\n&quot;);
-    print(JS_LOG_NORMAL,&quot;You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n&quot;);
+    print(SCRIPT_LOG_NORMAL,&quot;Enter your commands then press the evaluate button or CTRL+ENTER.\n&quot;);
+    print(SCRIPT_LOG_NORMAL,&quot;You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n&quot;);
     indexRead=indexWrite=0;
 }
 /**
@@ -85,14 +85,14 @@
 /**
     \fn print
 */
-bool qShell::print(JS_LOG_TYPE type,const char *s)
+bool qShell::print(SCRIPT_LOG_TYPE type,const char *s)
 {
     QString string(s);
     //printf(&quot;**%s&quot;,s);
     switch(type)
     {
-        case JS_LOG_NORMAL: ui.textBrowser-&gt;setTextColor(QColor(0,0,0));break;
-        case JS_LOG_ERROR : ui.textBrowser-&gt;setTextColor(QColor(255,0,0));break;
+        case SCRIPT_LOG_NORMAL: ui.textBrowser-&gt;setTextColor(QColor(0,0,0));break;
+        case SCRIPT_LOG_ERROR : ui.textBrowser-&gt;setTextColor(QColor(255,0,0));break;
     }
     ui.textBrowser-&gt;append(string.toAscii());
     ui.textBrowser-&gt;setTextColor(QColor(0,0,0));

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2010-05-23 15:25:52 UTC (rev 6214)
@@ -27,7 +27,7 @@
                     qShell(jsShellEvaluate *s) ;
     virtual         ~qShell() ;
     bool            run(void);
-    bool            print(JS_LOG_TYPE type, const char *s);
+    bool            print(SCRIPT_LOG_TYPE type, const char *s);
 public slots:
     bool            evaluate(bool x);
     bool            clear(bool x);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -9,7 +9,7 @@
     \fn qt4ShellLogger
     \brief Redirect output to the shell
 */
-static bool qt4ShellLogger(void *cookie,JS_LOG_TYPE type,const char *v)
+static bool qt4ShellLogger(void *cookie,SCRIPT_LOG_TYPE type,const char *v)
 {
     qShell *s=(qShell *)cookie;
     s-&gt;print(type,v);
@@ -23,9 +23,9 @@
 bool ADM_startShell(jsShellEvaluate eval)
 {
         qShell *s= new qShell(eval);
-        ADM_jsRegisterLogger((void *)s,qt4ShellLogger);
+        ADM_scriptRegisterLogger((void *)s,qt4ShellLogger);
         s-&gt;run();
-        ADM_jsUnregisterLogger();
+        ADM_scriptUnregisterLogger();
         delete s;
         return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/include/ADM_tinypy.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/include/ADM_tinypy.h	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/include/ADM_tinypy.h	2010-05-23 15:25:52 UTC (rev 6214)
@@ -24,6 +24,7 @@
     const char *funcName;
     tp_obj (*funcCall)(TP);
 }pyFuncs;
+typedef bool (pyLoggerFunc)(const char *);
 /**
     \class tinyPy
 */
@@ -39,5 +40,8 @@
         bool    execString(const char *s);
         bool    execFile(const char *f);
         bool    dumpInternals(void);
+static  bool    registerLogger(pyLoggerFunc func);
+static  bool    unregisterLogger(void);
+        bool    dumpBuiltin(void);
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2010-05-20 19:10:12 UTC (rev 6213)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2010-05-23 15:25:52 UTC (rev 6214)
@@ -24,6 +24,25 @@
 #define INSTANCE ((tp_vm *)instance)
 #define SCRIPT   ((tp_obj *)script)
 
+pyLoggerFunc *pyLog=NULL;
+static tp_obj    tinyPy_dumpBuiltin(tp_vm *vm);
+static pyFuncs addons[]={{&quot;help&quot;,tinyPy_dumpBuiltin},{NULL,NULL}};
+/**
+
+*/
+bool    tinyPy::registerLogger(pyLoggerFunc func)
+{
+    pyLog=func;
+    return true;
+}
+bool    tinyPy::unregisterLogger(void)
+{
+    pyLog=NULL;
+    return true;
+}
+/**
+    \fn pyPrintfd
+*/
 bool pyPrintf(const char *fmt,...)
 {
         static char print_buffer[1024];
@@ -33,7 +52,10 @@
 		vsnprintf(print_buffer,1023,fmt,list);
 		va_end(list);
 		print_buffer[1023]=0; // ensure the string is terminated
-        printf(&quot;TP&gt;%s&quot;,print_buffer);
+        //printf(&quot;%s&quot;,print_buffer);
+        //jsLog(JS_LOG_NORMAL,print_buffer);
+        if(!pyLog) printf(&quot;%s&quot;,print_buffer);
+            else pyLog(print_buffer);
         return true;
 }
 
@@ -67,10 +89,14 @@
     ADM_warning(&quot;Init tinypy\n&quot;);
     ADM_assert(!instance);
     instance=(void *)tp_init(0,NULL);
-    if(instance) return true;   
+    if(!instance)
+    {
+        ADM_error(&quot;Cannot initialize tinypy\n&quot;);
+        return false;   
+    }
     math_init(INSTANCE);
-    ADM_error(&quot;Cannot initialize tinypy\n&quot;);
-    return false;
+    registerFuncs(&quot;addons&quot;,addons);
+    return true;
 }
 /**
     \fn execString
@@ -130,10 +156,10 @@
 */
 bool    tinyPy::registerFuncs(const char *group,pyFuncs *funcs)
 {
-    printf(&quot;Registering group %s\n&quot;,group);
+    ADM_info(&quot;Registering group %s\n&quot;,group);
     while(funcs-&gt;funcName)
     {
-        printf(&quot;Registering :%s\n&quot;,funcs-&gt;funcName);
+        ADM_info(&quot;Registering :%s\n&quot;,funcs-&gt;funcName);
         tp_set(INSTANCE, INSTANCE-&gt;builtins, 
                 tp_string(funcs-&gt;funcName), 
                 tp_fnc(INSTANCE, funcs-&gt;funcCall));
@@ -141,4 +167,24 @@
     }
     return true;
 }
+
+/**
+    \fn dumpBuiltin
+*/
+tp_obj    tinyPy_dumpBuiltin(tp_vm *vm)
+{
+    ADM_info(&quot;Dumping builtins\n&quot;);
+    tp_obj builtins=vm-&gt;builtins;
+    // It is a dict..
+    _tp_dict *dict=builtins.dict.val;
+    ADM_info(&quot;%d elems\n&quot;,dict-&gt;len);
+    for( int i=0;i&lt;dict-&gt;len;i++)
+    {
+        tp_item *item=&amp;(dict-&gt;items[i]);
+        const char *str=item-&gt;key.string.val;
+        if(str)
+            pyPrintf(&quot;%s\n&quot;,str);
+    }
+    return tp_None;
+}
 // EOF
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003413.html">[Avidemux-svn-commit] r6213 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. qt4
</A></li>
	<LI>Next message: <A HREF="003415.html">[Avidemux-svn-commit] r6215 -	branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3414">[ date ]</a>
              <a href="thread.html#3414">[ thread ]</a>
              <a href="subject.html#3414">[ subject ]</a>
              <a href="author.html#3414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
