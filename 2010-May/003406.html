<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6206 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_pyScript	avidemux/common/ADM_pyScript/include	avidemux/common/ADM_pyScript/src avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_gui cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6206%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common%20avidemux/common/ADM_pyScript%0A%09avidemux/common/ADM_pyScript/include%0A%09avidemux/common/ADM_pyScript/src%20avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%20cmake&In-Reply-To=%3C201005201522.o4KFMoq0014306%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003405.html">
   <LINK REL="Next"  HREF="003407.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6206 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_pyScript	avidemux/common/ADM_pyScript/include	avidemux/common/ADM_pyScript/src avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_gui cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6206%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/common%20avidemux/common/ADM_pyScript%0A%09avidemux/common/ADM_pyScript/include%0A%09avidemux/common/ADM_pyScript/src%20avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%20cmake&In-Reply-To=%3C201005201522.o4KFMoq0014306%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6206 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/common avidemux/common/ADM_pyScript	avidemux/common/ADM_pyScript/include	avidemux/common/ADM_pyScript/src avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_gui cmake">mean at mail.berlios.de
       </A><BR>
    <I>Thu May 20 17:22:50 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003405.html">[Avidemux-svn-commit] r6205 - in	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy:	include src tst
</A></li>
        <LI>Next message: <A HREF="003407.html">[Avidemux-svn-commit] r6207 - in	branches/avidemux_2.6_branch_mean/avidemux: . common	common/ADM_pyScript common/ADM_pyScript/include	common/ADM_pyScript/src common/ADM_script2	common/ADM_script2/js common/ADM_script2/py	common/ADM_script2/py/include common/ADM_script2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3406">[ date ]</a>
              <a href="thread.html#3406">[ thread ]</a>
              <a href="subject.html#3406">[ subject ]</a>
              <a href="author.html#3406">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-05-20 17:22:49 +0200 (Thu, 20 May 2010)
New Revision: 6206

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/include/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/include/ADM_pyIf.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/ADM_pyAdm.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm.admPy
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.h
   branches/avidemux_2.6_branch_mean/cmake/admPy.pl
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/A_functions.h
   branches/avidemux_2.6_branch_mean/avidemux/common/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
Log:
[tinypy]

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/CMakeLists.txt	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/CMakeLists.txt	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,2 @@
+subdirs (src)
+#subdirs (src_dialogFactory)

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/include/ADM_pyIf.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/include/ADM_pyIf.h	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/include/ADM_pyIf.h	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,21 @@
+/**
+    \file ADM_pyIf.h
+    \brief Interface for python script 
+    \author mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A> 2010
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_PY_IF_H
+#define ADM_PY_IF_H
+
+bool parseTinyPyScript(const char *name);
+bool interactiveTinyPy(void);
+
+#endif
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/ADM_pyAdm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/ADM_pyAdm.cpp	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/ADM_pyAdm.cpp	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,130 @@
+/**
+    \file ADM_pyADM.cpp
+    \author mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A> 2010
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_default.h&quot;
+#include &lt;stdarg.h&gt;
+#include &lt;vector&gt;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_coreTinyPy/include/tinypy.h&quot;
+#include &quot;ADM_coreTinyPy/include/ADM_tinypy.h&quot;
+#include &quot;ADM_script2/include/ADM_jsShell.h&quot;
+#include &quot;A_functions.h&quot;
+
+#include &quot;adm_gen.h&quot;
+
+#include &quot;adm_gen.cpp&quot;
+/**
+    \fn    parseTinyPyScript
+    \brief Execute a tinyPy script
+*/
+bool parseTinyPyScript(const char *name)
+{
+        tinyPy py;
+        py.init();
+        py.registerFuncs(&quot;adm&quot;,adm_functions);
+        return py.execFile(name);
+}
+
+/**
+    \fn jsEvaluate
+*/
+static tinyPy *myPy=NULL;
+static bool pyEvaluate(const char *str)
+{
+    ADM_assert(myPy);
+    return myPy-&gt;execString(str);
+}
+/**
+    \fn    interactiveTinyPy
+    \brief interprete &amp; execute python script (interactive)
+*/
+bool interactiveTinyPy(void)
+{
+    myPy=new tinyPy;
+    myPy-&gt;init();
+    myPy-&gt;registerFuncs(&quot;adm&quot;,adm_functions);
+
+    ADM_startShell(pyEvaluate);
+    delete myPy;
+    myPy=NULL;
+	A_Resync();
+    ADM_info(&quot;Ending py shell...\n&quot;);
+	return true;
+}
+
+int  py_loadVideo (char *vid )
+{
+    printf(&quot;pyLoadVideo %s\n&quot;,vid);
+    return 0;
+}
+int  py_clearSegments (void)
+{
+    printf(&quot;py_clearSegments\n&quot;);
+    return 0;
+}
+
+int  py_appendVideo (char *vid )
+{
+    printf(&quot;py_appendVideo %s\n&quot;,vid);
+    return 0;
+}
+
+int  py_addSegment (int ,float , float )
+{
+    printf(&quot;py_addSegment\n&quot;);
+    return 0;
+}
+
+int  py_setPostProc (int a,int b, int c)
+{
+    printf(&quot;py_setPostProc\n&quot;);
+    return 0;
+}
+
+int  py_getWidth (void)
+{
+    printf(&quot;py_getWidth\n&quot;);
+    return 0;
+}
+
+int  py_getHeight (void)
+{
+    printf(&quot;py_getHeight\n&quot;);
+    return 0;
+}
+
+int  py_getFps1000 (void)
+{
+    printf(&quot;py_getFps1000\n&quot;);
+    return 0;
+}
+
+int  py_audioReset (void)
+{
+    printf(&quot;py_audioReset\n&quot;);
+    return 0;
+}
+
+int  py_audioMixer (char *mixer )
+{
+    printf(&quot;py_audioMixer\n&quot;);
+    return 0;
+}
+
+int  py_clearVideoFilters (void)
+{
+    printf(&quot;py_clearVideoFilters\n&quot;);
+    return 0;
+}
+

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/CMakeLists.txt	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/CMakeLists.txt	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,7 @@
+SET(ADM_script_SRCS
+        ADM_pyAdm.cpp
+)
+
+ADD_LIBRARY(ADM_pyScript6 STATIC ${ADM_script_SRCS})
+include_directories(../include)
+include_directories(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreTinyPy/include)

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm.admPy
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm.admPy	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm.admPy	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,13 @@
+/* FUNC */ int loadVideo      (char * ) 
+/* FUNC */ int clearSegments  (void) 
+/* FUNC */ int appendVideo    (char * ) 
+/* FUNC */ int addSegment     (int ,float , float ) 
+/* FUNC */ int setPostProc    (int ,int , int ) 
+/* FUNC */ int getWidth       (void) 
+/* FUNC */ int getHeight      (void) 
+/* FUNC */ int getFps1000     (void) 
+#/* FUNC */ char* getVideoCodec(void) 
+/* FUNC */ int audioReset     (void) 
+/* FUNC */ int audioMixer     (char * ) 
+/* FUNC */ int clearVideoFilters   (void) 
+

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.cpp	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.cpp	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,89 @@
+//int  loadVideo &lt;char * &gt;
+tp_obj zzpy_loadVideo(TP)
+{
+char * p0=(char *)TP_STR().string.val;
+int r=py_loadVideo(p0); 
+return tp_number(r);
+}
+//int  clearSegments &lt;void&gt;
+tp_obj zzpy_clearSegments(TP)
+{
+int r=py_clearSegments(); 
+return tp_number(r);
+}
+//int  appendVideo &lt;char * &gt;
+tp_obj zzpy_appendVideo(TP)
+{
+char * p0=(char *)TP_STR().string.val;
+int r=py_appendVideo(p0); 
+return tp_number(r);
+}
+//int  addSegment &lt;int  float   float &gt;
+tp_obj zzpy_addSegment(TP)
+{
+int p0=TP_NUM();
+float p1=TP_NUM();
+float p2=TP_NUM();
+int r=py_addSegment(p0,p1,p2); 
+return tp_number(r);
+}
+//int  setPostProc &lt;int  int   int &gt;
+tp_obj zzpy_setPostProc(TP)
+{
+int p0=TP_NUM();
+int p1=TP_NUM();
+int p2=TP_NUM();
+int r=py_setPostProc(p0,p1,p2); 
+return tp_number(r);
+}
+//int  getWidth &lt;void&gt;
+tp_obj zzpy_getWidth(TP)
+{
+int r=py_getWidth(); 
+return tp_number(r);
+}
+//int  getHeight &lt;void&gt;
+tp_obj zzpy_getHeight(TP)
+{
+int r=py_getHeight(); 
+return tp_number(r);
+}
+//int  getFps1000 &lt;void&gt;
+tp_obj zzpy_getFps1000(TP)
+{
+int r=py_getFps1000(); 
+return tp_number(r);
+}
+//int  audioReset &lt;void&gt;
+tp_obj zzpy_audioReset(TP)
+{
+int r=py_audioReset(); 
+return tp_number(r);
+}
+//int  audioMixer &lt;char * &gt;
+tp_obj zzpy_audioMixer(TP)
+{
+char * p0=(char *)TP_STR().string.val;
+int r=py_audioMixer(p0); 
+return tp_number(r);
+}
+//int  clearVideoFilters &lt;void&gt;
+tp_obj zzpy_clearVideoFilters(TP)
+{
+int r=py_clearVideoFilters(); 
+return tp_number(r);
+}
+pyFuncs adm_functions[]={
+{&quot;loadVideo&quot;,zzpy_loadVideo},
+{&quot;clearSegments&quot;,zzpy_clearSegments},
+{&quot;appendVideo&quot;,zzpy_appendVideo},
+{&quot;addSegment&quot;,zzpy_addSegment},
+{&quot;setPostProc&quot;,zzpy_setPostProc},
+{&quot;getWidth&quot;,zzpy_getWidth},
+{&quot;getHeight&quot;,zzpy_getHeight},
+{&quot;getFps1000&quot;,zzpy_getFps1000},
+{&quot;audioReset&quot;,zzpy_audioReset},
+{&quot;audioMixer&quot;,zzpy_audioMixer},
+{&quot;clearVideoFilters&quot;,zzpy_clearVideoFilters},
+{NULL,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.h	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_pyScript/src/adm_gen.h	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,11 @@
+int  py_loadVideo (char * );
+int  py_clearSegments (void);
+int  py_appendVideo (char * );
+int  py_addSegment (int ,float , float );
+int  py_setPostProc (int ,int , int );
+int  py_getWidth (void);
+int  py_getHeight (void);
+int  py_getFps1000 (void);
+int  py_audioReset (void);
+int  py_audioMixer (char * );
+int  py_clearVideoFilters (void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-05-20 15:22:49 UTC (rev 6206)
@@ -16,7 +16,6 @@
 #include &lt;stdarg.h&gt;
 #include &lt;vector&gt;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_coreTinyPy/include/ADM_tinypy.h&quot;
 void    A_Resync(void);
 
 /* our variables */
@@ -85,14 +84,7 @@
 static bool jsEvaluate(const char *str)
 {
 jsval rval;
-#if 1
-        tinyPy py;
-        py.init();
-        py.execString(str);
-
-#else
    JS_EvaluateScript(g_pCx,g_pObject,str,strlen(str),&quot;dummy&quot;,1,&amp;rval);
-#endif
    return true; 
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/A_functions.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/A_functions.h	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/A_functions.h	2010-05-20 15:22:49 UTC (rev 6206)
@@ -20,6 +20,8 @@
 int     A_Save(const char *name);
 int     A_SaveWrapper( char *name);
 bool    A_parseECMAScript(const char *name);
+bool    A_parseTinyPyScript(const char *name);
+
 //uint8_t A_autoDrive(Action action);
 uint8_t A_TimeShift(void);
 void    A_ResetMarkers(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/CMakeLists.txt	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/CMakeLists.txt	2010-05-20 15:22:49 UTC (rev 6206)
@@ -16,6 +16,7 @@
 ADD_SUBDIRECTORY(ADM_requant)
 #ADD_SUBDIRECTORY(ADM_script)
 ADD_SUBDIRECTORY(ADM_script2)
+ADD_SUBDIRECTORY(ADM_pyScript)
 ADD_SUBDIRECTORY(ADM_toolkit)
 #ADD_SUBDIRECTORY(ADM_video)
 #ADD_SUBDIRECTORY(ADM_videoFilter)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-05-20 15:22:49 UTC (rev 6206)
@@ -41,6 +41,7 @@
 #include &quot;avi_vars.h&quot;
 #include &quot;prototype.h&quot; // FIXME
 #include &quot;ADM_script2/include/ADM_jsIf.h&quot;
+#include &quot;ADM_pyScript/include/ADM_pyIf.h&quot;
 renderZoom currentZoom=ZOOM_1_1;
 //***********************************
 //******** A Function ***************
@@ -119,6 +120,9 @@
   }
   switch (action)
     {
+        case ACT_PY_SHELL:
+                                interactiveTinyPy();
+                                return;
         case ACT_JS_SHELL:
                                 interactiveECMAScript(&quot;dummy&quot;);
                                 return;
@@ -163,6 +167,9 @@
     case ACT_PLUGIN_INFO:
             DIA_pluginsInfo();
             return;
+    case ACT_RunPyScript:
+            GUI_FileSelRead (QT_TR_NOOP(&quot;Select python script to Run&quot;),(SELFILE_CB *) A_parseTinyPyScript);
+    		return;
     case ACT_RunScript:
             GUI_FileSelRead (QT_TR_NOOP(&quot;Select ECMAScript to Run&quot;),(SELFILE_CB *) A_parseECMAScript);
     		return;
@@ -854,6 +861,26 @@
 
 
 
+/**
+    \fn A_parseTinyPyScript
+*/
+bool A_parseTinyPyScript(const char *name){
+  bool ret;
+  char *longname = ADM_PathCanonize(name);
+   if (playing){
+      GUI_PlayAvi();
+   }
+   ret = parseTinyPyScript(longname);
+   if( ret == true )
+   {
+      video_body-&gt;setProjectName(longname);
+   }
+   ADM_dealloc(longname);
+   return ret;
+}
+/**
+    \fn A_parseECMAScript
+*/
 bool A_parseECMAScript(const char *name){
   bool ret;
   char *longname = ADM_PathCanonize(name);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2010-05-20 15:22:49 UTC (rev 6206)
@@ -112,6 +112,7 @@
 ACT(JumpToFrame)
 ACT(JumpToTime)
 ACT(RunScript)
+ACT(RunPyScript)
 ACT(AudioCodecChanged)
 ACT(VideoCodecChanged)
 ACT(PreviewChanged)
@@ -152,3 +153,4 @@
 ACT(GLYPHEDIT)
 ACT(PLUGIN_INFO)
 ACT(JS_SHELL)
+ACT(PY_SHELL)

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-05-20 15:22:49 UTC (rev 6206)
@@ -99,6 +99,7 @@
 ADM_requant6 
 #ADM_script6 
 ADM_script26 
+ADM_pyScript6 
 ADM_scriptDF
 ADM_videoEncoder6 
 ADM_internalVideoFilter6

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-05-20 15:22:49 UTC (rev 6206)
@@ -1307,63 +1307,6 @@
     &lt;addaction name=&quot;actionSave_2&quot;/&gt;
     &lt;addaction name=&quot;actionFilters_2&quot;/&gt;
    &lt;/widget&gt;
-   &lt;widget class=&quot;QMenu&quot; name=&quot;menuFile&quot;&gt;
-    &lt;property name=&quot;title&quot;&gt;
-     &lt;string&gt;&amp;File&lt;/string&gt;
-    &lt;/property&gt;
-    &lt;widget class=&quot;QMenu&quot; name=&quot;menuRecent_Files&quot;&gt;
-     &lt;property name=&quot;title&quot;&gt;
-      &lt;string&gt;&amp;Recent Files&lt;/string&gt;
-     &lt;/property&gt;
-     &lt;addaction name=&quot;actionRecent0&quot;/&gt;
-     &lt;addaction name=&quot;actionRecent1&quot;/&gt;
-     &lt;addaction name=&quot;actionRecent2&quot;/&gt;
-     &lt;addaction name=&quot;actionRecent3&quot;/&gt;
-    &lt;/widget&gt;
-    &lt;widget class=&quot;QMenu&quot; name=&quot;menuSave&quot;&gt;
-     &lt;property name=&quot;title&quot;&gt;
-      &lt;string&gt;&amp;Save&lt;/string&gt;
-     &lt;/property&gt;
-     &lt;addaction name=&quot;actionSave_video&quot;/&gt;
-     &lt;addaction name=&quot;separator&quot;/&gt;
-     &lt;addaction name=&quot;actionSave_BMP&quot;/&gt;
-     &lt;addaction name=&quot;actionSave_jpeg&quot;/&gt;
-    &lt;/widget&gt;
-    &lt;addaction name=&quot;actionOpen&quot;/&gt;
-    &lt;addaction name=&quot;menuRecent_Files&quot;/&gt;
-    &lt;addaction name=&quot;actionAppend&quot;/&gt;
-    &lt;addaction name=&quot;menuSave&quot;/&gt;
-    &lt;addaction name=&quot;actionClose&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionProperties&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionLoad_run_project&quot;/&gt;
-    &lt;addaction name=&quot;actionSave_project&quot;/&gt;
-    &lt;addaction name=&quot;actionSave_project_as&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionAdd_to_joblist&quot;/&gt;
-    &lt;addaction name=&quot;actionShow_Joblist&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionConnect_to_AvsProxy&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionQuit&quot;/&gt;
-   &lt;/widget&gt;
-   &lt;widget class=&quot;QMenu&quot; name=&quot;menuTools&quot;&gt;
-    &lt;property name=&quot;title&quot;&gt;
-     &lt;string&gt;&amp;Tools&lt;/string&gt;
-    &lt;/property&gt;
-    &lt;addaction name=&quot;actionCalculator&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionRebuild_I_B_Frames&quot;/&gt;
-    &lt;addaction name=&quot;actionBitrate_histogram&quot;/&gt;
-    &lt;addaction name=&quot;actionScan_for_black_frames&quot;/&gt;
-    &lt;addaction name=&quot;separator&quot;/&gt;
-    &lt;addaction name=&quot;actionVob_to_vobsub&quot;/&gt;
-    &lt;addaction name=&quot;actionOCR&quot;/&gt;
-    &lt;addaction name=&quot;actionOCR_DVB_T_TS_files&quot;/&gt;
-    &lt;addaction name=&quot;actionGlyphs_Edit&quot;/&gt;
-    &lt;addaction name=&quot;actionJavaScript_shell&quot;/&gt;
-   &lt;/widget&gt;
    &lt;widget class=&quot;QMenu&quot; name=&quot;menuEdit&quot;&gt;
     &lt;property name=&quot;title&quot;&gt;
      &lt;string&gt;&amp;Edit&lt;/string&gt;
@@ -1437,6 +1380,65 @@
     &lt;addaction name=&quot;actionJump_to_Frame&quot;/&gt;
     &lt;addaction name=&quot;actionJump_to_Time&quot;/&gt;
    &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuFile&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;&amp;File&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;widget class=&quot;QMenu&quot; name=&quot;menuRecent_Files&quot;&gt;
+     &lt;property name=&quot;title&quot;&gt;
+      &lt;string&gt;&amp;Recent Files&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;addaction name=&quot;actionRecent0&quot;/&gt;
+     &lt;addaction name=&quot;actionRecent1&quot;/&gt;
+     &lt;addaction name=&quot;actionRecent2&quot;/&gt;
+     &lt;addaction name=&quot;actionRecent3&quot;/&gt;
+    &lt;/widget&gt;
+    &lt;widget class=&quot;QMenu&quot; name=&quot;menuSave&quot;&gt;
+     &lt;property name=&quot;title&quot;&gt;
+      &lt;string&gt;&amp;Save&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;addaction name=&quot;actionSave_video&quot;/&gt;
+     &lt;addaction name=&quot;separator&quot;/&gt;
+     &lt;addaction name=&quot;actionSave_BMP&quot;/&gt;
+     &lt;addaction name=&quot;actionSave_jpeg&quot;/&gt;
+    &lt;/widget&gt;
+    &lt;addaction name=&quot;actionOpen&quot;/&gt;
+    &lt;addaction name=&quot;menuRecent_Files&quot;/&gt;
+    &lt;addaction name=&quot;actionAppend&quot;/&gt;
+    &lt;addaction name=&quot;menuSave&quot;/&gt;
+    &lt;addaction name=&quot;actionClose&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionProperties&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionLoad_run_project&quot;/&gt;
+    &lt;addaction name=&quot;actionSave_project&quot;/&gt;
+    &lt;addaction name=&quot;actionSave_project_as&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionAdd_to_joblist&quot;/&gt;
+    &lt;addaction name=&quot;actionShow_Joblist&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionConnect_to_AvsProxy&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionQuit&quot;/&gt;
+    &lt;addaction name=&quot;actionRun_pyScript&quot;/&gt;
+   &lt;/widget&gt;
+   &lt;widget class=&quot;QMenu&quot; name=&quot;menuTools&quot;&gt;
+    &lt;property name=&quot;title&quot;&gt;
+     &lt;string&gt;&amp;Tools&lt;/string&gt;
+    &lt;/property&gt;
+    &lt;addaction name=&quot;actionCalculator&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionRebuild_I_B_Frames&quot;/&gt;
+    &lt;addaction name=&quot;actionBitrate_histogram&quot;/&gt;
+    &lt;addaction name=&quot;actionScan_for_black_frames&quot;/&gt;
+    &lt;addaction name=&quot;separator&quot;/&gt;
+    &lt;addaction name=&quot;actionVob_to_vobsub&quot;/&gt;
+    &lt;addaction name=&quot;actionOCR&quot;/&gt;
+    &lt;addaction name=&quot;actionOCR_DVB_T_TS_files&quot;/&gt;
+    &lt;addaction name=&quot;actionGlyphs_Edit&quot;/&gt;
+    &lt;addaction name=&quot;actionJavaScript_shell&quot;/&gt;
+    &lt;addaction name=&quot;actionPython_Shell&quot;/&gt;
+   &lt;/widget&gt;
    &lt;addaction name=&quot;menuFile&quot;/&gt;
    &lt;addaction name=&quot;menuEdit&quot;/&gt;
    &lt;addaction name=&quot;menuView&quot;/&gt;
@@ -2398,6 +2400,16 @@
     &lt;string&gt;16:9&lt;/string&gt;
    &lt;/property&gt;
   &lt;/action&gt;
+  &lt;action name=&quot;actionRun_pyScript&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Run pyScript&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionPython_Shell&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Python Shell&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
  &lt;/widget&gt;
  &lt;customwidgets&gt;
   &lt;customwidget&gt;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2010-05-20 15:22:49 UTC (rev 6206)
@@ -70,7 +70,9 @@
 PROCESS(actionAdd_to_joblist,ACT_ADD_JOB) \
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  \
 PROCESS(actionPlugins,ACT_PLUGIN_INFO) \
-PROCESS(actionJavaScript_shell,ACT_JS_SHELL) 
+PROCESS(actionJavaScript_shell,ACT_JS_SHELL) \
+PROCESS(actionRun_pyScript,ACT_RunPyScript) \
+PROCESS(actionPython_Shell,ACT_PY_SHELL) \
 
 #if 0
 PROCESS(actionPrevious_intra_frame,ACT_PreviousKFrame) \

Added: branches/avidemux_2.6_branch_mean/cmake/admPy.pl
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admPy.pl	2010-05-20 15:22:47 UTC (rev 6205)
+++ branches/avidemux_2.6_branch_mean/cmake/admPy.pl	2010-05-20 15:22:49 UTC (rev 6206)
@@ -0,0 +1,190 @@
+use strict;
+my $input;
+my $output;
+my $headerFile;
+my $line;
+my $glueprefix=&quot;zzpy_&quot;;
+my $functionPrefix=&quot;py_&quot;;
+my @allFuncs;
+#
+#
+#
+sub genReturn
+{
+        my $retType=shift;
+        if($retType=~m/int/)
+        {
+                return &quot;return tp_number(r);&quot;;
+        }
+        if($retType=~m/float/)
+        {
+                return &quot;return tp_number(r);&quot;;
+        }
+        if($retType=~m/void/)
+        {
+                return &quot;&quot;;
+        }
+        return &quot;???? $retType&quot;;
+}
+#
+#
+#
+sub castFrom
+{
+        my $type=shift;
+        if($type=~m/^char/)
+        {
+                return &quot;(char *)TP_STR().string.val&quot;;
+        }
+        if($type=~m/^int/)
+        {
+                return &quot;TP_NUM()&quot;;
+        }
+        if($type=~m/^float/)
+        {
+                return &quot;TP_NUM()&quot;;
+        }
+        return &quot;????&quot;;
+
+}
+#
+# Generate the locals / wrapping for the parameters
+#
+sub genParam
+{
+        my $num=shift;
+        my $type=shift;
+        print OUTPUT &quot;$type p&quot;.$num.&quot;=&quot;;
+        print OUTPUT castFrom($type);
+        print OUTPUT &quot;;\n&quot;; 
+}
+#
+# Process a function declaration and write the glue code to do tinypy&lt;-&gt;function call
+#
+sub processFunc
+{
+        my $proto=shift;
+        my $args=$proto;
+        my @params;
+        my $retType=$proto;;
+        my $func=$proto;;
+        $args=~s/^.*\(//g;
+        $args=~s/\).*$//g;
+        #print &quot;args =&gt; $args\n&quot;;
+        @params=split &quot;,&quot;,$args;
+        #print &quot;params -&gt; @params\n&quot;;
+        # Get return type...
+        $retType=~s/^ *//g;
+        $retType=~s/ .*$//g;
+        # get functioName
+        $func=~s/ *\(.*$//g;
+        $func=~s/^.* //g;
+        print OUTPUT &quot;//$retType  $func &lt;@params&gt;\n&quot;;
+        # Write glue code
+        print OUTPUT &quot;tp_obj &quot;.$glueprefix.$func.&quot;(TP)\n&quot;;
+        push(@allFuncs,$func);
+        print OUTPUT &quot;{\n&quot;;
+        my $nb=scalar(@params);
+        my $i;
+        for($i=0;$i&lt;$nb;$i++)
+        {
+                $params[$i]=~s/^ *//g; # Remove &quot; &quot; at the beginning if any
+                $params[$i]=~s/ *$//g; # Remove &quot; &quot; at the end if any
+        }
+        if($params[0]=~m/^void$/)
+        {
+                $nb=0;
+        }
+        print &quot; New function : $retType,$func,&lt;@params&gt;\n&quot;;
+        
+        print HEADER &quot;$retType  $functionPrefix&quot;.$func.&quot; ($args);\n&quot;;
+
+
+        for($i=0;$i&lt;$nb;$i++)
+        {
+                genParam($i,$params[$i]);
+        }
+        # Call real function
+        if(!($retType=~m/^void$/))
+        {
+                print OUTPUT $retType.&quot; r=&quot;;
+        }
+        print OUTPUT $functionPrefix.$func.&quot;(&quot;;
+        for($i=0;$i&lt;$nb;$i++)
+        {
+                if($i)
+                {
+                        print OUTPUT &quot;,&quot;;
+                }
+                print OUTPUT &quot;p&quot;.$i;
+        } 
+        print OUTPUT &quot;); \n&quot;;
+        # Cast r to pyobj
+        print OUTPUT genReturn($retType);
+        print OUTPUT &quot;\n}\n&quot;;
+
+
+}
+
+
+if(scalar(@ARGV)!=1)
+{
+        die(&quot;admPy inputfile\n&quot;);
+}
+$input=$ARGV[0];
+$output=$input;
+$output=~s/\..*$//g;
+my $thisfile=$output;
+$thisfile=~s/^.*\///g;
+$headerFile=$output.&quot;_gen.h&quot;;
+$output=$output.&quot;_gen.cpp&quot;;
+print &quot;Processing $input=&gt;$output\n&quot;;
+open(OUTPUT,&quot;&gt;$output&quot;) or die(&quot;Cannot open $output&quot;);
+##
+## Main Loop
+##
+# 1 grab all functions
+open(INPUT,$input) or die(&quot;Cannot open $input&quot;);
+close(INPUT);
+# Process them
+open(INPUT,$input) or die(&quot;Cannot open $input&quot;);
+open(HEADER,&quot;&gt;$headerFile&quot;) or die(&quot;Cannot open $headerFile&quot;);
+while($line=&lt;INPUT&gt;)
+{
+        chomp($line);
+        if($line=~m/^#/)
+        {
+        }
+        else
+        {
+            if($line=~m/\* FUNC \*/)
+            {
+                my $proto=$line;
+                # Remove header...
+                # Remove tail
+                $line=~s/^.*\*\///g;
+                $line=~s/\/\/.*$//g;
+                processFunc($line);
+
+            }
+        }
+}
+# gen init array
+my $nbFunc=scalar(@allFuncs);
+my $i;
+print OUTPUT &quot;pyFuncs &quot;.$thisfile.&quot;_functions[]={\n&quot;;
+for($i=0;$i&lt;$nbFunc;$i++)
+{
+                my $line=$allFuncs[$i];
+                #print &quot;Function : $line\n&quot;;
+                my $funcName;
+                my $funcProto;
+                $funcName=&quot;\&quot;&quot;.$line.&quot;\&quot;&quot;;
+                $funcProto=$glueprefix.$line;
+                print OUTPUT &quot;{$funcName,$funcProto},\n&quot;;
+}
+print OUTPUT &quot;{NULL,NULL}\n};\n&quot;;
+close(INPUT);
+close(OUTPUT);
+close(HEADER);
+print &quot;done\n.&quot;;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003405.html">[Avidemux-svn-commit] r6205 - in	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy:	include src tst
</A></li>
	<LI>Next message: <A HREF="003407.html">[Avidemux-svn-commit] r6207 - in	branches/avidemux_2.6_branch_mean/avidemux: . common	common/ADM_pyScript common/ADM_pyScript/include	common/ADM_pyScript/src common/ADM_script2	common/ADM_script2/js common/ADM_script2/py	common/ADM_script2/py/include common/ADM_script2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3406">[ date ]</a>
              <a href="thread.html#3406">[ thread ]</a>
              <a href="subject.html#3406">[ subject ]</a>
              <a href="author.html#3406">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
