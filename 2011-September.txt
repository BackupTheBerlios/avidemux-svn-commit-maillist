From mean at mail.berlios.de  Sat Sep  3 14:19:10 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:19:10 +0200
Subject: [Avidemux-svn-commit] r7454 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska
Message-ID: <20110903121910.675F948111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:19:09 +0200 (Sat, 03 Sep 2011)
New Revision: 7454

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
Log:
[mkv/demux] use vector rather than manually managing it

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -11,6 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "ADM_cpp.h"
 #include <math.h>
 
 #include "ADM_default.h"
@@ -83,7 +84,7 @@
     printf("[MKV] Cluster indexing failed\n");
     return 0;
   }
-  printf("[MKV]Found %u clusters\n",_nbClusters);
+  printf("[MKV]Found %u clusters\n",_clusters.size());
   printf("[MKV] Indexing video\n");
     if(!videoIndexer(&ebml))
     {
@@ -481,14 +482,10 @@
 
 uint8_t mkvHeader::close(void)
 {
-  if(_clusters)
-  {
-    delete [] _clusters;
-    _clusters=NULL;
-  }
+    _clusters.clear();
   // CLEANUP!!
-  if(_parser) delete _parser;
-  _parser=NULL;
+    if(_parser) delete _parser;
+    _parser=NULL;
 
 
 #define FREEIF(i) { if(_tracks[i].extraData) delete [] _tracks[i].extraData; _tracks[i].extraData=0;}
@@ -528,9 +525,6 @@
   memset(_tracks,0,sizeof(_tracks));
   _reordered=0;
 
-  _clusters=NULL;
-  _clustersCeil=0;
-  _nbClusters=0;
   _currentAudioTrack=0;
   _access=NULL;
   _audioStreams=NULL;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h	2011-09-03 12:19:09 UTC (rev 7454)
@@ -134,9 +134,7 @@
     char                    *_filename;
     mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
 
-    mkvIndex                *_clusters;
-    uint32_t                _nbClusters;
-    uint32_t                _clustersCeil;
+    vector <mkvIndex    >   _clusters;
 
     uint32_t                _nbAudioTrack;
     uint32_t                _currentAudioTrack;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -11,7 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "ADM_cpp.h"
 #include <math.h>
 
 #include "ADM_default.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -11,7 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "ADM_cpp.h"
 #include <math.h>
 
 #include "ADM_default.h"
@@ -43,19 +43,21 @@
     //************
    work->update(0);
 #if 0
-   for(int clusters=0;clusters<_nbClusters;clusters++)
+    int nbCluster=_clusters.size();
+   for(int clusters=0;clusters<nbCluster;clusters++)
     {
-        printf("[Cluster] %d/%d StartTimecode=%"LLU" ms\n",clusters,_nbClusters,_clusters[clusters].Dts);
+        printf("[Cluster] %d/%d StartTimecode=%"LLU" ms\n",clusters,nbCluster,_clusters[clusters].Dts);
     }
 #endif
-   for(int clusters=0;clusters<_nbClusters;clusters++)
+    int nbClusters=_clusters.size();
+   for(int clusters=0;clusters<nbClusters;clusters++)
    {
    parser->seek(_clusters[clusters].pos);
    ADM_ebml_file cluster(parser,_clusters[clusters].size);
    int thiscluster=0;
    while(!cluster.finished())
    {
-      work->update(clusters,_nbClusters);
+      work->update(clusters,nbClusters);
       cluster.readElemId(&id,&len);
       if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
       {
@@ -324,11 +326,7 @@
   uint64_t time;
   uint64_t pos;
 
-#define NB_DEFAULT_CLUSTERS 10
-  // Allocate some clusters
-  _clusters=new mkvIndex[NB_DEFAULT_CLUSTERS];
-  _clustersCeil=NB_DEFAULT_CLUSTERS;
-  _nbClusters=0;
+    mkvIndex tmpCluster;
 
   // Search segment
    fileSize=parser->getFileSize();
@@ -353,17 +351,9 @@
 
      // UI update
      work->update(segment.tell()>>10,fileSize>>10);
-     // Grow clusters index if needed
-     if(_nbClusters==_clustersCeil-1)
-     {
-         mkvIndex *dx=new mkvIndex[_clustersCeil*2];
-         memcpy(dx,_clusters,sizeof(mkvIndex)*_nbClusters);
-         delete [] _clusters;
-         _clusters=dx;
-         _clustersCeil*=2;
-     }
-     _clusters[_nbClusters].pos=segment.tell();
-     _clusters[_nbClusters].size=alen;
+     tmpCluster.pos=segment.tell();
+     tmpCluster.size=alen;
+     _clusters.push_back(tmpCluster);
 
      // Normally the timecode is the 1st one following
 
@@ -378,7 +368,7 @@
                 goto tryAgain;
             default:break;
         }
-       int seekme=_nbClusters;
+       int seekme=_clusters.size()-1; // last element...
        if(id!=MKV_TIMECODE)
        {
           ss=NULL;
@@ -386,17 +376,16 @@
           ADM_warning("[MKV] Cluster : no time code Found %s(0x%"LLX"), expected MKV_TIMECODE  (0x%x)\n",
                   ss,id,MKV_TIMECODE);
        }
-       else
+       else // timecode
        {
            uint64_t timecode=segment.readUnsignedInt(len);
-           _clusters[_nbClusters].Dts=timecode;
-           _nbClusters++;
+           _clusters[seekme].Dts=timecode;
        }
        segment.seek( _clusters[seekme].pos+ _clusters[seekme].size);
        //printf("Position :%u %u MB\n", _clusters[seekme].pos+ _clusters[seekme].size,( _clusters[seekme].pos+ _clusters[seekme].size)>>20);
    }
    delete work;
-   ADM_info("[MKV] Found %u clusters\n",_nbClusters);
+   ADM_info("[MKV] Found %u clusters\n",(int)_clusters.size());
    return 1;
 }
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvPlugin.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvPlugin.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -13,6 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "ADM_cpp.h"
 #include "ADM_default.h"
 #include "ADM_mkv.h"
 #include "ADM_demuxerInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvTrackType.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvTrackType.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -12,7 +12,7 @@
  *                                                                         *
  ***************************************************************************/
 
-
+#include "ADM_cpp.h"
 #include <math.h>
 
 #include "ADM_default.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2011-08-29 06:02:38 UTC (rev 7453)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2011-09-03 12:19:09 UTC (rev 7454)
@@ -11,6 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "ADM_cpp.h"
 #include "ADM_default.h"
 #include "math.h"
 #include "ADM_Video.h"



From mean at mail.berlios.de  Sat Sep  3 14:19:11 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:19:11 +0200
Subject: [Avidemux-svn-commit] r7455 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	. sample_distort
Message-ID: <20110903121911.D939F48111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:19:11 +0200 (Sat, 03 Sep 2011)
New Revision: 7455

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.ui
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGlDistort.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
Log:
[openGl wav] new filter wave like effect

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-03 12:19:09 UTC (rev 7454)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-03 12:19:11 UTC (rev 7455)
@@ -2,5 +2,6 @@
 ADD_SUBDIRECTORY(glYadif)
 #ADD_SUBDIRECTORY(sample_fragment)
 ADD_SUBDIRECTORY(sample_fragment2)
+ADD_SUBDIRECTORY(sample_distort)
 #ADD_SUBDIRECTORY(sample_vertex)
 #ADD_SUBDIRECTORY(glVdpau)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/CMakeLists.txt	2011-09-03 12:19:11 UTC (rev 7455)
@@ -0,0 +1,7 @@
+INCLUDE(vf_plugin)
+INCLUDE(vf_plugin_qt4gl)
+
+
+SET(ADM_vf_sampleGlVertex_SRCS sampleGl.cpp)
+INIT_VIDEO_FILTER_GLQT4(ADM_vf_sampleGlVertex "${ADM_vf_sampleGlVertex_SRCS}" "sampleGl.h" "sampleGl" "${ADM_vf_sampleGl_SRCS}")
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.cpp	2011-09-03 12:19:11 UTC (rev 7455)
@@ -0,0 +1,242 @@
+/** *************************************************************************
+                    \fn       openGlFragmentSample.cpp  
+                    \brief    simple fragment shader
+
+    Simple vertex shader
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_openGL.h"
+#define ADM_LEGACY_PROGGY
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "T_openGL.h"
+#include "T_openGLFilter.h"
+#include "sampleGl.h"
+#include "sampleGlDistort.h"
+#include "ADM_clock.h"
+/**
+
+*/
+#define DEPTH 300
+//#define BENCH 1
+//#define BENCH_READTEXTURE
+
+
+/**
+    \class openGlDistort
+*/
+class openGlDistort : public  ADM_coreVideoFilterQtGl
+{
+protected:
+                        GLuint  glList;
+                        bool    buildVertex(int phase);
+protected:
+                        bool render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo);
+public:
+                             openGlDistort(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                            ~openGlDistort();
+
+        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) {return true;}             /// Start graphical user interface
+};
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   openGlDistort,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_QT4+ADM_UI_GL,         // UI
+                        VF_OPENGL,            // Category
+                        "glSampleDistort",            // internal name (must be uniq!)
+                        "OpenGl wave ",            // Display name
+                        "Simple wave filter." // Description
+                    );
+
+// Now implements the interesting parts
+/**
+    \fn openGlDistort
+    \brief constructor
+*/
+openGlDistort::openGlDistort(  ADM_coreVideoFilter *in,CONFcouple *setup) : ADM_coreVideoFilterQtGl(in,setup)
+{
+UNUSED_ARG(setup);
+        widget->makeCurrent();
+        fboY->bind();
+        printf("Compiling shader \n");
+        // vertex shader 
+       
+        // frag shader
+        glProgramY = new QGLShaderProgram(context);
+        ADM_assert(glProgramY);
+        if ( !glProgramY->addShaderFromSourceCode(QGLShader::Fragment, myShaderY))
+        {
+                ADM_error("[GL Render] Fragment log: %s\n", glProgramY->log().toUtf8().constData());
+                ADM_assert(0);
+        }
+        if ( !glProgramY->link())
+        {
+            ADM_error("[GL Render] Link log: %s\n", glProgramY->log().toUtf8().constData());
+            ADM_assert(0);
+        }
+
+        if ( !glProgramY->bind())
+        {
+                ADM_error("[GL Render] Binding FAILED\n");
+                ADM_assert(0);
+        }
+        glList=glGenLists(1);
+        
+        fboY->release();
+        widget->doneCurrent();
+
+}
+/**
+    \fn openGlDistort
+    \brief destructor
+*/
+openGlDistort::~openGlDistort()
+{
+    glDeleteLists(glList,1);
+}
+
+/**
+    \fn getFrame
+    \brief Get a processed frame
+*/
+bool openGlDistort::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+    // since we do nothing, just get the output of previous filter
+    if(false==previousFilter->getNextFrame(fn,image))
+    {
+        ADM_warning("Distort : Cannot get frame\n");
+        return false;
+    }
+    widget->makeCurrent();
+    glPushMatrix();
+    
+    // size is the last one...
+    fboY->bind();
+
+    int pulse=(*fn)*8;
+    pulse=pulse%info.width;
+    float angle=pulse;
+
+    buildVertex(angle);
+
+    glProgramY->setUniformValue("myTextureU", 1); 
+    glProgramY->setUniformValue("myTextureV", 2); 
+    glProgramY->setUniformValue("myTextureY", 0); 
+    glProgramY->setUniformValue("myWidth", (GLfloat)info.width); 
+    glProgramY->setUniformValue("myHeight",(GLfloat)info.height); 
+
+    uploadAllPlanes(image);
+
+    render(image,PLANAR_Y,fboY);
+
+    downloadTextures(image,fboY);
+
+    fboY->release();
+    firstRun=false;
+    glPopMatrix();
+    widget->doneCurrent();
+    
+    return true;
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         openGlDistort::getCoupledConf(CONFcouple **couples)
+{
+    *couples=new CONFcouple(0); // Even if we dont have configuration we must allocate one 
+    return true;
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *openGlDistort::getConfiguration(void)
+{
+    
+    return "openGl Distort.";
+}
+/**
+    \fn buildVertex
+    \brief Build a grid mapping of the image using 16x16 quads
+*/
+static int getY(int phase, int x,int y,int width,int height,int rippleHeight)
+{
+    double angle=(x+phase);
+    angle=angle/width;
+    double angle2=y;
+    angle2/=height;
+    angle=angle*4*3.1415;
+    angle2=angle2*6*3.1415;
+    double shift=sin(angle+angle2);
+    //printf("%d:angle=%f:%f\n",x,angle/3.14,shift);
+    return rippleHeight*shift;
+}
+static void myGlVertex(int x,int y,int phase, int width, int height,int rippleHeight)
+{
+  glTexCoord2i(x, y);
+  glVertex2i(x, y+getY(phase,x,y,width,height,rippleHeight));
+}
+bool openGlDistort::buildVertex(int phase)
+{
+  int width=info.width;
+  int height=info.height;
+  glDeleteLists(glList,1);
+  glNewList(glList,GL_COMPILE);
+  glBegin(GL_QUADS);
+
+  int rippleHeight=height/20;
+
+
+#define STEP 3
+  int roundW=width>>STEP;
+  int roundH=height>>STEP;
+
+  
+    for(int y=0;y<roundH;y++)
+        for(int x=0;x<roundW;x++)
+        {
+            int startx=x*(1<<STEP);
+            int starty=y*(1<<STEP);
+
+            myGlVertex(startx+ 00, starty+00,phase,width,height,rippleHeight);
+            myGlVertex(startx+ (1<<STEP), starty+00,phase,width,height,rippleHeight);
+            myGlVertex(startx+ (1<<STEP) ,starty+(1<<STEP),phase,width,height,rippleHeight);
+            myGlVertex(startx+ 00, starty+(1<<STEP),phase,width,height,rippleHeight);
+            	
+        }
+
+    glEnd();
+    glEndList();
+}
+
+/**
+    \fn render
+*/
+bool openGlDistort::render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo)
+{
+    int width=image->GetWidth(plane);
+    int height=image->GetHeight(plane);
+
+    glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);
+	glViewport(0, 0, width, height);
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0, width, 0, height, -1, 1);
+
+    glCallList(glList);
+    return true;
+}
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-03 12:19:11 UTC (rev 7455)
@@ -0,0 +1,19 @@
+// Invert x & y
+static const char *myShaderY =
+	"#extension GL_ARB_texture_rectangle: enable\n"
+	"uniform sampler2DRect myTextureY;\n" // tex unit 0
+    "uniform sampler2DRect myTextureU;\n" // tex unit 1
+    "uniform sampler2DRect myTextureV;\n" // tex unit 2
+    "uniform float myWidth;\n"
+    "uniform float myHeight;\n"
+    "uniform float teta;\n"
+
+	"void main(void) {\n"
+    "  float nx = gl_TexCoord[0].x;\n"
+	"  float ny = gl_TexCoord[0].y;\n"
+    "  vec4 texvalV = texture2DRect(myTextureV, vec2(nx/2,ny/2));\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, vec2(nx/2,ny/2));\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, vec2(nx,ny));\n"
+	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
+	"}\n";
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.ui	2011-09-03 12:19:11 UTC (rev 7455)
@@ -0,0 +1,724 @@
+<ui version="4.0" >
+ <class>resizeDialog</class>
+ <widget class="QDialog" name="resizeDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>350</width>
+    <height>342</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Resize</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <widget class="QGroupBox" name="groupBox_2" >
+     <property name="title" >
+      <string>Aspect Ratio</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <widget class="QCheckBox" name="lockArCheckBox" >
+        <property name="text" >
+         <string>Lock Aspect Ratio</string>
+        </property>
+        <property name="checked" >
+         <bool>true</bool>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label_4" >
+          <property name="text" >
+           <string>Source:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxSource" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_3" >
+          <property name="text" >
+           <string>Destination:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxDestination" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox" >
+     <property name="title" >
+      <string>Resize Dimensions</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label" >
+          <property name="text" >
+           <string>Width:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxWidth" >
+          <property name="maximum" >
+           <number>2900</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_2" >
+          <property name="text" >
+           <string>Height:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxHeight" >
+          <property name="maximum" >
+           <number>2000</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <widget class="QCheckBox" name="checkBoxRoundup" >
+        <property name="text" >
+         <string>Round to the Nearest Multiple of 16</string>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Vertical</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>312</width>
+          <height>4</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>12</number>
+          </property>
+          <item>
+           <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QLabel" name="label_8" >
+                <property name="text" >
+                 <string>1%</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_5" >
+                <property name="text" >
+                 <string>Percent</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_9" >
+                <property name="text" >
+                 <string>200%</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <widget class="QSlider" name="horizontalSlider" >
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="maximum" >
+               <number>200</number>
+              </property>
+              <property name="value" >
+               <number>100</number>
+              </property>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QSpinBox" name="percentageSpinBox" >
+            <property name="maximum" >
+             <number>200</number>
+            </property>
+            <property name="minimum" >
+             <number>1</number>
+            </property>
+            <property name="value" >
+             <number>100</number>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <widget class="QLabel" name="label_10" >
+            <property name="text" >
+             <string>Error X / Y:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="labelErrorXY" >
+            <property name="text" >
+             <string>0.00 / 0.00</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>40</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Fixed</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>332</width>
+       <height>6</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label_6" >
+       <property name="text" >
+        <string>Resize Method:</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QComboBox" name="comboBoxAlgo" >
+       <item>
+        <property name="text" >
+         <string>Bilinear</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Bicubic</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Lanzcos3</string>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::MinimumExpanding</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>16</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>lockArCheckBox</tabstop>
+  <tabstop>comboBoxSource</tabstop>
+  <tabstop>comboBoxDestination</tabstop>
+  <tabstop>spinBoxWidth</tabstop>
+  <tabstop>spinBoxHeight</tabstop>
+  <tabstop>checkBoxRoundup</tabstop>
+  <tabstop>horizontalSlider</tabstop>
+  <tabstop>percentageSpinBox</tabstop>
+  <tabstop>comboBoxAlgo</tabstop>
+  <tabstop>buttonBox</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>resizeDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_8</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>39</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_5</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>150</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_9</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>267</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>horizontalSlider</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>156</x>
+     <y>164</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>percentageSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>317</x>
+     <y>155</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>checkBoxRoundup</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>95</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_10</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>55</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>labelErrorXY</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>114</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_4</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>46</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxSource</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>94</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_3</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>188</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxDestination</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>247</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGlDistort.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGlDistort.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGlDistort.h	2011-09-03 12:19:11 UTC (rev 7455)
@@ -0,0 +1,2 @@
+
+// EOF



From mean at mail.berlios.de  Sat Sep  3 14:19:13 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:19:13 +0200
Subject: [Avidemux-svn-commit] r7456 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src
Message-ID: <20110903121913.7A48A48111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:19:13 +0200 (Sat, 03 Sep 2011)
New Revision: 7456

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_dcainfo.cpp
Log:
[dcaInfo] dump buffer start (debug)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_dcainfo.cpp	2011-09-03 12:19:11 UTC (rev 7455)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_dcainfo.cpp	2011-09-03 12:19:13 UTC (rev 7456)
@@ -110,7 +110,7 @@
 
 
             }
-            ADM_warning("[DTS] Cannot find sync\n");
+            ADM_warning("[DTS] Cannot find sync %x %x %x %x\n",buf[0],buf[1],buf[2],buf[3]);
 	      return false;
 }
 



From mean at mail.berlios.de  Sat Sep  3 14:19:14 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:19:14 +0200
Subject: [Avidemux-svn-commit] r7457 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src
Message-ID: <20110903121914.B108348111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:19:14 +0200 (Sat, 03 Sep 2011)
New Revision: 7457

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamDCA.cpp
Log:
[DCA] Speed up (a bit) wrong sync

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamDCA.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamDCA.cpp	2011-09-03 12:19:13 UTC (rev 7456)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamDCA.cpp	2011-09-03 12:19:14 UTC (rev 7457)
@@ -66,7 +66,12 @@
     while(1)
     {
         // Do we have sync ?
-        if(needBytes(ADM_LOOK_AHEAD)==false) return 0;
+        if(needBytes(ADM_LOOK_AHEAD)==false) 
+        {
+            ADM_warning("DCA: Not sync found in buffer\n");
+            return false;
+        }
+            
         // Peek
         peek(ADM_LOOK_AHEAD,data);
         // Search start seq
@@ -75,14 +80,25 @@
             read8();
             continue;
         }
+        if(buffer[start+2]!=0x80 || buffer[start+3]!=0x1)
+        {
+            read8();
+            read8();
+            continue;
+        }
+
         if(false== ADM_DCAGetInfo(buffer+start, limit-start,&info,&offset))
         {
             read8();
+            read8();
+            read8();
+            read8();
             continue;
         }
         ADM_assert(info.frameSizeInBytes<=sizeMax);
         if(needBytes(info.frameSizeInBytes)==false)
         {
+            ADM_warning("DCA: Not enough data\n");
             return false;
         }
         *osize=info.frameSizeInBytes;



From mean at mail.berlios.de  Sat Sep  3 14:20:45 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:20:45 +0200
Subject: [Avidemux-svn-commit] r7459 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreAudioParser/src ADM_coreUtils/src
Message-ID: <20110903122045.D0BC448111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:20:45 +0200 (Sat, 03 Sep 2011)
New Revision: 7459

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp
Log:
[core] update packing using ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp	2011-09-03 12:20:20 UTC (rev 7458)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp	2011-09-03 12:20:45 UTC (rev 7459)
@@ -9,7 +9,7 @@
 
 #include "ADM_default.h"
 #include "ADM_eac3info.h"
-
+#define ADM_LAV_NO_CONFIG
 extern "C"
 {
 #define sign_extend

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp	2011-09-03 12:20:20 UTC (rev 7458)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp	2011-09-03 12:20:45 UTC (rev 7459)
@@ -17,6 +17,8 @@
 
 #ifndef ADM_getbits_H
 #define ADM_getbits_H
+
+#define ADM_LAV_NO_CONFIG
 extern "C"
 {
 #include "libavutil/common.h"
@@ -93,4 +95,4 @@
 {
     return get_bits_count((GetBitContext *)ctx);
 }
-// EOF
\ No newline at end of file
+// EOF



From mean at mail.berlios.de  Sat Sep  3 14:31:26 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 14:31:26 +0200
Subject: [Avidemux-svn-commit] r7460 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264
Message-ID: <20110903123126.B0AD548111B@sheep.berlios.de>

Author: mean
Date: 2011-09-03 14:31:26 +0200 (Sat, 03 Sep 2011)
New Revision: 7460

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt
Log:
[x264] Fix headless compilation of x264

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt	2011-09-03 12:20:45 UTC (rev 7459)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt	2011-09-03 12:31:26 UTC (rev 7460)
@@ -28,6 +28,7 @@
   #-----------------------GTK or CLI VERSION---------------------
   if((DO_GTK) OR (DO_CLI))
     ADD_VIDEO_ENCODER(ADM_ve_x264_other   ADM_x264_noui.cpp ${x264_SRCS})
+    ADD_TARGET_CFLAGS(ADM_ve_x264_other "-DADM_UI_TYPE_BUILD=1") # CLI!
     TARGET_LINK_LIBRARIES(ADM_ve_x264_other x264 )
     INIT_VIDEO_ENCODER(ADM_ve_x264_other)
     INSTALL_VIDEO_ENCODER(ADM_ve_x264_other)



From mean at mail.berlios.de  Sat Sep  3 16:44:05 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 16:44:05 +0200
Subject: [Avidemux-svn-commit] r7461 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2
Message-ID: <20110903144405.934A948111C@sheep.berlios.de>

Author: mean
Date: 2011-09-03 16:44:05 +0200 (Sat, 03 Sep 2011)
New Revision: 7461

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Config.cpp
Log:
[mp4v2] Disable optimize

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp	2011-09-03 12:31:26 UTC (rev 7460)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp	2011-09-03 14:44:05 UTC (rev 7461)
@@ -43,7 +43,7 @@
 
 mp4v2_muxer muxerConfig=
 {
-   1, // uint32_t optimize;
+   0, // uint32_t optimize;
    0  //uint32_t add_itunes_metadata;
 };
 extern "C"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Config.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Config.cpp	2011-09-03 12:31:26 UTC (rev 7460)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Config.cpp	2011-09-03 14:44:05 UTC (rev 7461)
@@ -28,13 +28,15 @@
         bool optimize=muxerConfig.optimize;
         bool addItuneMetaData=muxerConfig.add_itunes_metadata;
 
-        diaElemToggle   wOptimize(&optimize,"Optimize for streaming");
+        //diaElemToggle   wOptimize(&optimize,"Optimize for streaming");
         diaElemToggle   wItunes(&addItuneMetaData,"Add ipod metadata");
 
-        diaElem *tabs[]={&wOptimize,&wItunes};
-        if( diaFactoryRun(("MP4V2 Settings"),2,tabs))
+        //diaElem *tabs[]={&wOptimize,&wItunes};
+        diaElem *tabs[]={&wItunes};
+        if( diaFactoryRun(("MP4V2 Settings"),1,tabs))
         {
-            muxerConfig.optimize=optimize;
+            //muxerConfig.optimize=optimize;
+            muxerConfig.optimize=false;
             muxerConfig.add_itunes_metadata=addItuneMetaData;
             return true;
         }



From mean at mail.berlios.de  Sat Sep  3 16:44:06 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Sep 2011 16:44:06 +0200
Subject: [Avidemux-svn-commit] r7462 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches
Message-ID: <20110903144406.F025A48111C@sheep.berlios.de>

Author: mean
Date: 2011-09-03 16:44:06 +0200 (Sat, 03 Sep 2011)
New Revision: 7462

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch
Log:
[ffmpeg] Add patch to allow muxing eac3 in mpeg ts. Really quick and dirty

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch	2011-09-03 14:44:06 UTC (rev 7462)
@@ -0,0 +1,20 @@
+--- libavformat/mpegtsenc.c	2011-08-10 14:16:41.000000000 +0200
++++ /home/fx/workspace/avidemux_core/ffmpeg/source/libavformat/mpegtsenc.c	2011-09-03 16:26:10.605350454 +0200
+@@ -285,6 +285,17 @@
+         /* write optional descriptors here */
+         switch(st->codec->codec_type) {
+         case AVMEDIA_TYPE_AUDIO:
++// MEANX : For eac3 we put one tag with all flags set to zero
++// MEANX : This tag is enough to signal this stream is eac3
++// MEANX : Else it is a private stream without identification =>ignored
++            if(st->codec->codec_id==CODEC_ID_EAC3)
++            {
++                *q++=0x7a; // EAC3 descriptor see A038 DVB SI
++                *q++=1; // 1 byte, all flags sets to 0
++                *q++=0; // omit all fields...
++            }
++
++// /MEANX
+             if (lang) {
+                 char *p;
+                 char *next = lang->value;



From mean at mail.berlios.de  Mon Sep  5 18:39:04 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon,  5 Sep 2011 18:39:04 +0200
Subject: [Avidemux-svn-commit] r7463 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs: include src
Message-ID: <20110905163904.76A09481219@sheep.berlios.de>

Author: mean
Date: 2011-09-05 18:39:03 +0200 (Mon, 05 Sep 2011)
New Revision: 7463

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[openGl] Try to use pbo to speed up readback

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-03 14:44:06 UTC (rev 7462)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-05 16:39:03 UTC (rev 7463)
@@ -26,6 +26,7 @@
 class ADM_coreVideoFilterQtGl:  public ADM_coreVideoFilter
 {
 protected:
+                            GLuint                bufferARB   ;
                             QGLWidget            *widget;
                     const   QGLContext           *context;
                             QGLFramebufferObject *fboY;
@@ -41,12 +42,16 @@
                             void uploadOnePlane(ADMImage *image, ADM_PLANE plane, GLuint tex,int texNum );
                             bool downloadTexture(ADMImage *target, ADM_PLANE plane,QGLFramebufferObject *fbo);
                             bool downloadTextures(ADMImage *target, QGLFramebufferObject *fbo);
+                            bool downloadTexturesDma(ADMImage *target, QGLFramebufferObject *fbo);
+                            bool downloadTexturesQt(ADMImage *target, QGLFramebufferObject *fbo);
+                            bool finishInit(void);
 
 public:
                             ADM_coreVideoFilterQtGl(ADM_coreVideoFilter *previous,CONFcouple *conf=NULL);
        virtual             ~ADM_coreVideoFilterQtGl();
 
-                                                                                        
+        
+                            static bool checkGlError(const char *op);
 protected:
 };
 // Hooks

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-03 14:44:06 UTC (rev 7462)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-05 16:39:03 UTC (rev 7463)
@@ -9,9 +9,18 @@
 #include "DIA_coreToolkit.h"
 static QGLWidget *thisWidget=NULL;
 static GlActiveTexture_Type *myActiveTexture=NULL;
-
-
 /**
+     \fn checkGlError
+     \brief pop an error if an operation failed
+*/
+bool ADM_coreVideoFilterQtGl::checkGlError(const char *op)
+{
+    GLenum er=glGetError();
+    if(!er) return true;
+    ADM_error("[GLERROR]%s: %d => %s\n",op,er,gluErrorString(er));
+    return false;
+}           
+/**
     \fn ADM_setActiveTexture
 */
 bool ADM_setActiveTexture(GlActiveTexture_Type *set)
@@ -58,6 +67,7 @@
 ADM_coreVideoFilterQtGl::ADM_coreVideoFilterQtGl(ADM_coreVideoFilter *previous,CONFcouple *conf)
 :ADM_coreVideoFilter(previous,conf)
 {
+    bufferARB=0;
     context=NULL;
     glProgramY=NULL;
     glProgramUV=NULL;
@@ -81,9 +91,19 @@
         ADM_assert(0);
     }
     glGenTextures(3,texName);
+    checkGlError("GenTex");
+    glGenBuffersARB(1,&bufferARB);
+    checkGlError("GenBuffer");
     widget->doneCurrent();
     // glTexture TODO
+}
+/**
+    \fn finishInit
 
+*/
+bool ADM_coreVideoFilterQtGl::finishInit(void)
+{
+        return true;
 }
 /**
     \fn dtor
@@ -102,6 +122,8 @@
     fboUV=NULL;
     if(widget) delete widget;       
     widget=NULL;
+    glDeleteBuffersARB(1,&bufferARB);
+    bufferARB=0;
 }
 #if  1
 #define TEX_Y_OFFSET 2
@@ -114,6 +136,7 @@
 #define TEX_V_OFFSET 2   
 #define TEX_A_OFFSET 3   
 #endif
+
 /**
     \fn downloadTexture
 */
@@ -222,12 +245,15 @@
             dst[x]  = src[x*4+TEX_Y_OFFSET];
         }
 }
-
+bool ADM_coreVideoFilterQtGl::downloadTextures(ADMImage *image,  QGLFramebufferObject *fbo)
+{
+    return downloadTexturesQt(image,fbo);
+}
 /**
     \fn downloadTexture
     \brief Download YUVA texture into a YV12 image
 */
-bool ADM_coreVideoFilterQtGl::downloadTextures(ADMImage *image,  QGLFramebufferObject *fbo)
+bool ADM_coreVideoFilterQtGl::downloadTexturesQt(ADMImage *image,  QGLFramebufferObject *fbo)
 {
 
     QImage qimg(fbo->toImage()); // this is slow ! ~ 15 ms for a 720 picture (Y only).
@@ -288,6 +314,102 @@
     return true;
 }
 /**
+    \fn downloadTexture
+    \brief Download YUVA texture into a YV12 image
+*/
+bool ADM_coreVideoFilterQtGl::downloadTexturesDma(ADMImage *image,  QGLFramebufferObject *fbo)
+{
+    int width=image->GetWidth(PLANAR_Y);
+    int height=image->GetHeight(PLANAR_Y);
+    bool r=true;
+
+    glBindBufferARB(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
+    checkGlError("BindARB");
+    glBufferDataARB(GL_PIXEL_PACK_BUFFER_ARB,info.width*info.height*sizeof(uint32_t),
+                                NULL,GL_STREAM_READ_ARB);
+    checkGlError("BufferDataRB");
+
+    glReadBuffer(GL_COLOR_ATTACHMENT0_EXT); 
+    checkGlError("ReadBuffer (fbo)");
+    glBindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
+    checkGlError("Bind Buffer (arb)");
+
+    glReadPixels(0, 0, width, height, GL_BGRA, GL_UNSIGNED_BYTE, 0);
+    checkGlError("glReadPixel");
+
+    // DMA call done, we can do something else here
+    ADM_usleep(5*1000);
+
+    glBindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
+    checkGlError("Bind Buffer (arb)");
+
+    GLubyte* ptr = (GLubyte*)glMapBufferARB(GL_PIXEL_PACK_BUFFER_ARB,
+                                        GL_READ_ONLY_ARB);
+    checkGlError("MapBuffer");
+    if(!ptr)
+    {
+        ADM_error("Cannot map output buffer!\n");
+        r=false;
+    }
+    else
+    {
+        // Assume RGB32, read R or A
+        int strideY=image->GetPitch(PLANAR_Y);
+        uint8_t *toY=image->GetWritePtr(PLANAR_Y);
+        uint8_t *toU=image->GetWritePtr(PLANAR_U);
+        uint8_t *toV=image->GetWritePtr(PLANAR_V);
+        int      strideU=image->GetPitch(PLANAR_U);
+        int      strideV=image->GetPitch(PLANAR_V);
+
+        int width=image->GetWidth(PLANAR_Y);
+        int height=image->GetHeight(PLANAR_Y);
+        typeGlYv444 *luma=glYUV444_C;
+    #ifdef ADM_CPU_X86
+          if(CpuCaps::hasMMX())
+          {
+                glYUV444_MMXInit();
+                luma=glYUV444_MMX;
+          }
+    #endif
+        // Do Y
+        for(int y=0;y<height;y++)
+        {
+            const uchar *src=4*width*(y)+ptr;
+            
+            if(!src)
+            {
+                ADM_error("Can t get pointer to openGl texture\n");
+                return false;
+            }
+           luma(src,toY,width);
+           toY+=strideY;
+           if(y&1)
+           {
+                for(int x=0;x<width;x+=2) // Stupid subsample: 1 out of 4
+                {
+                    const uchar *p=src+x*4;
+                    uint32_t v=*(uint32_t *)p;
+                    if(!v)
+                    {
+                            toU[x/2]=128;
+                            toV[x/2]=128;
+                    }else
+                    {
+                        toU[x/2]  =  p[TEX_U_OFFSET];
+                        toV[x/2]  =  p[TEX_V_OFFSET];
+                    }
+                }
+                toU+=strideU;
+                toV+=strideV;
+           }
+        }
+    #ifdef ADM_CPU_X86
+        __asm__( "emms\n"::  );
+    #endif
+    }
+    return r;
+}
+/**
     \fn uploadTexture
 */
 void ADM_coreVideoFilterQtGl::uploadOnePlane(ADMImage *image, ADM_PLANE plane, GLuint tex,int texNum )



From mean at mail.berlios.de  Mon Sep  5 18:39:05 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon,  5 Sep 2011 18:39:05 +0200
Subject: [Avidemux-svn-commit] r7464 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	. glBenchmark
Message-ID: <20110905163905.C321B481219@sheep.berlios.de>

Author: mean
Date: 2011-09-05 18:39:05 +0200 (Mon, 05 Sep 2011)
New Revision: 7464

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.ui
Log:
[glBenchmark] Benchmark readback from GPU to CPU, DMA is faster

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/CMakeLists.txt	2011-09-05 16:39:05 UTC (rev 7464)
@@ -0,0 +1,7 @@
+INCLUDE(vf_plugin)
+INCLUDE(vf_plugin_qt4gl)
+
+
+SET(ADM_vf_sampleGlFrag_SRCS sampleGl.cpp)
+INIT_VIDEO_FILTER_GLQT4(ADM_vf_glBenchmark "${ADM_vf_sampleGlFrag_SRCS}" "sampleGl.h" "sampleGl" "${ADM_vf_sampleGl_SRCS}")
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.cpp	2011-09-05 16:39:05 UTC (rev 7464)
@@ -0,0 +1,215 @@
+/** *************************************************************************
+                    \fn       openGlFragmentSample.cpp  
+                    \brief    simple fragment shader
+
+    This one is combining the 3 textures and apply the shader once
+
+
+    copyright            : (C) 2011 by mean
+
+bench : 1280*720, null shader, 20 ms, 95% of it in download texture.
+            Download Texture
+                RGB2Y=5ms               (MMX it)
+                toQimage=14 ms  <<==    TOO SLOW
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_openGL.h"
+#define ADM_LEGACY_PROGGY
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "T_openGL.h"
+#include "T_openGLFilter.h"
+#include "sampleGl.h"
+#include "ADM_clock.h"
+
+
+/**
+    \class openGlBenchmark
+*/
+class openGlBenchmark : public  ADM_coreVideoFilterQtGl
+{
+protected:
+
+protected:
+                        bool render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo);
+
+public:
+                             openGlBenchmark(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                            ~openGlBenchmark();
+
+        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) {return true;}             /// Start graphical user interface
+};
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   openGlBenchmark,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_QT4+ADM_UI_GL,         // UI
+                        VF_OPENGL,            // Category
+                        "glBenchmark",            // internal name (must be uniq!)
+                        "OpenGl ReadBack benchmark",            // Display name
+                        "Check how fast readback is." // Description
+                    );
+
+// Now implements the interesting parts
+/**
+    \fn openGlBenchmark
+    \brief constructor
+*/
+openGlBenchmark::openGlBenchmark(  ADM_coreVideoFilter *in,CONFcouple *setup) : ADM_coreVideoFilterQtGl(in,setup)
+{
+UNUSED_ARG(setup);
+        widget->makeCurrent();
+        fboY->bind();
+        printf("Compiling shader \n");
+        glProgramY = new QGLShaderProgram(context);
+        ADM_assert(glProgramY);
+        if ( !glProgramY->addShaderFromSourceCode(QGLShader::Fragment, myShaderY))
+        {
+                ADM_error("[GL Render] Fragment log: %s\n", glProgramY->log().toUtf8().constData());
+                ADM_assert(0);
+        }
+        if ( !glProgramY->link())
+        {
+            ADM_error("[GL Render] Link log: %s\n", glProgramY->log().toUtf8().constData());
+            ADM_assert(0);
+        }
+
+        if ( !glProgramY->bind())
+        {
+                ADM_error("[GL Render] Binding FAILED\n");
+                ADM_assert(0);
+        }
+
+        fboY->release();
+        widget->doneCurrent();
+
+}
+/**
+    \fn openGlBenchmark
+    \brief destructor
+*/
+openGlBenchmark::~openGlBenchmark()
+{
+    
+}
+
+/**
+    \fn getFrame
+    \brief Get a processed frame
+*/
+bool openGlBenchmark::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+    // since we do nothing, just get the output of previous filter
+    if(false==previousFilter->getNextFrame(fn,image))
+    {
+        ADM_warning("FlipFilter : Cannot get frame\n");
+        return false;
+    }
+    widget->makeCurrent();
+    glPushMatrix();
+    // size is the last one...
+    fboY->bind();
+    
+    float angle=*fn;
+    angle=angle/40;
+    glProgramY->setUniformValue("teta", angle);     
+    glProgramY->setUniformValue("myTextureU", 1); 
+    glProgramY->setUniformValue("myTextureV", 2); 
+    glProgramY->setUniformValue("myTextureY", 0); 
+    glProgramY->setUniformValue("myWidth", (GLfloat)image->GetWidth(PLANAR_Y)); 
+    glProgramY->setUniformValue("myHeight", (GLfloat)image->GetHeight(PLANAR_Y)); 
+
+    uploadAllPlanes(image);
+
+    render(image,PLANAR_Y,fboY);
+
+    ADMBenchmark bench;
+
+    for(int i=0;i<10;i++)
+    {
+        bench.start();
+        downloadTexturesQt(image,fboY);
+        bench.end();
+    }
+    ADMBenchmark bench2;
+    for(int i=0;i<10;i++)
+    {
+        bench2.start();
+        downloadTexturesDma(image,fboY);
+        bench2.end();
+    }
+    printf("Qt4 Benchmark\n");
+    bench.printResult();
+    printf("PBO/FBO Benchmark\n");
+    bench2.printResult();
+
+    
+    fboY->release();
+    firstRun=false;
+    glPopMatrix();
+    widget->doneCurrent();
+    
+    return true;
+}
+
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         openGlBenchmark::getCoupledConf(CONFcouple **couples)
+{
+    *couples=new CONFcouple(0); // Even if we dont have configuration we must allocate one 
+    return true;
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *openGlBenchmark::getConfiguration(void)
+{
+    
+    return "openGl Sample.";
+}
+
+
+/**
+    \fn render
+*/
+bool openGlBenchmark::render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo)
+{
+    int width=image->GetWidth(plane);
+    int height=image->GetHeight(plane);
+
+    glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);
+	glViewport(0, 0, width, height);
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0, width, 0, height, -1, 1);
+
+    //
+    glBegin(GL_QUADS);
+	glTexCoord2i(0, 0);
+	glVertex2i(0, 0);
+	glTexCoord2i(width, 0);
+	glVertex2i(width, 0);
+	glTexCoord2i(width, height);
+	glVertex2i(width ,height);
+	glTexCoord2i(0, height);
+	glVertex2i(0, height);
+	glEnd();	// draw cube background
+    return true;
+}
+
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.h	2011-09-05 16:39:05 UTC (rev 7464)
@@ -0,0 +1,19 @@
+// Invert x & y
+static const char *myShaderY =
+	"#extension GL_ARB_texture_rectangle: enable\n"
+	"uniform sampler2DRect myTextureY;\n" // tex unit 0
+    "uniform sampler2DRect myTextureU;\n" // tex unit 1
+    "uniform sampler2DRect myTextureV;\n" // tex unit 2
+    "uniform float myWidth;\n"
+    "uniform float myHeight;\n"
+    "uniform float teta;\n"
+
+	"void main(void) {\n"
+    "  float mx = gl_TexCoord[0].x;\n"
+	"  float my = gl_TexCoord[0].y;\n"
+    "  vec4 texvalV = texture2DRect(myTextureV, vec2(mx/2,my/2));\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, vec2(mx/2,my/2));\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, vec2(mx,my));\n"
+	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
+	"}\n";
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glBenchmark/sampleGl.ui	2011-09-05 16:39:05 UTC (rev 7464)
@@ -0,0 +1,724 @@
+<ui version="4.0" >
+ <class>resizeDialog</class>
+ <widget class="QDialog" name="resizeDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>350</width>
+    <height>342</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Resize</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <widget class="QGroupBox" name="groupBox_2" >
+     <property name="title" >
+      <string>Aspect Ratio</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <widget class="QCheckBox" name="lockArCheckBox" >
+        <property name="text" >
+         <string>Lock Aspect Ratio</string>
+        </property>
+        <property name="checked" >
+         <bool>true</bool>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label_4" >
+          <property name="text" >
+           <string>Source:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxSource" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_3" >
+          <property name="text" >
+           <string>Destination:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxDestination" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox" >
+     <property name="title" >
+      <string>Resize Dimensions</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label" >
+          <property name="text" >
+           <string>Width:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxWidth" >
+          <property name="maximum" >
+           <number>2900</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_2" >
+          <property name="text" >
+           <string>Height:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxHeight" >
+          <property name="maximum" >
+           <number>2000</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <widget class="QCheckBox" name="checkBoxRoundup" >
+        <property name="text" >
+         <string>Round to the Nearest Multiple of 16</string>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Vertical</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>312</width>
+          <height>4</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>12</number>
+          </property>
+          <item>
+           <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QLabel" name="label_8" >
+                <property name="text" >
+                 <string>1%</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_5" >
+                <property name="text" >
+                 <string>Percent</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_9" >
+                <property name="text" >
+                 <string>200%</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <widget class="QSlider" name="horizontalSlider" >
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="maximum" >
+               <number>200</number>
+              </property>
+              <property name="value" >
+               <number>100</number>
+              </property>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QSpinBox" name="percentageSpinBox" >
+            <property name="maximum" >
+             <number>200</number>
+            </property>
+            <property name="minimum" >
+             <number>1</number>
+            </property>
+            <property name="value" >
+             <number>100</number>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <widget class="QLabel" name="label_10" >
+            <property name="text" >
+             <string>Error X / Y:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="labelErrorXY" >
+            <property name="text" >
+             <string>0.00 / 0.00</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>40</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Fixed</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>332</width>
+       <height>6</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label_6" >
+       <property name="text" >
+        <string>Resize Method:</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QComboBox" name="comboBoxAlgo" >
+       <item>
+        <property name="text" >
+         <string>Bilinear</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Bicubic</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Lanzcos3</string>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::MinimumExpanding</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>16</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>lockArCheckBox</tabstop>
+  <tabstop>comboBoxSource</tabstop>
+  <tabstop>comboBoxDestination</tabstop>
+  <tabstop>spinBoxWidth</tabstop>
+  <tabstop>spinBoxHeight</tabstop>
+  <tabstop>checkBoxRoundup</tabstop>
+  <tabstop>horizontalSlider</tabstop>
+  <tabstop>percentageSpinBox</tabstop>
+  <tabstop>comboBoxAlgo</tabstop>
+  <tabstop>buttonBox</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>resizeDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_8</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>39</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_5</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>150</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_9</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>267</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>horizontalSlider</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>156</x>
+     <y>164</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>percentageSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>317</x>
+     <y>155</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>checkBoxRoundup</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>95</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_10</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>55</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>labelErrorXY</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>114</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_4</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>46</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxSource</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>94</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_3</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>188</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxDestination</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>247</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From mean at mail.berlios.de  Mon Sep  5 18:39:07 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon,  5 Sep 2011 18:39:07 +0200
Subject: [Avidemux-svn-commit] r7465 - in branches/avidemux_2.6_branch_mean:
	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src
	avidemux_plugins/ADM_videoFilters6_openGl
Message-ID: <20110905163907.91135481219@sheep.berlios.de>

Author: mean
Date: 2011-09-05 18:39:07 +0200 (Mon, 05 Sep 2011)
New Revision: 7465

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
Log:
[openGl] slight cleanup of DMA readback

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-05 16:39:05 UTC (rev 7464)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-05 16:39:07 UTC (rev 7465)
@@ -44,7 +44,6 @@
                             bool downloadTextures(ADMImage *target, QGLFramebufferObject *fbo);
                             bool downloadTexturesDma(ADMImage *target, QGLFramebufferObject *fbo);
                             bool downloadTexturesQt(ADMImage *target, QGLFramebufferObject *fbo);
-                            bool finishInit(void);
 
 public:
                             ADM_coreVideoFilterQtGl(ADM_coreVideoFilter *previous,CONFcouple *conf=NULL);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-05 16:39:05 UTC (rev 7464)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-05 16:39:07 UTC (rev 7465)
@@ -98,14 +98,6 @@
     // glTexture TODO
 }
 /**
-    \fn finishInit
-
-*/
-bool ADM_coreVideoFilterQtGl::finishInit(void)
-{
-        return true;
-}
-/**
     \fn dtor
 */
 ADM_coreVideoFilterQtGl::~ADM_coreVideoFilterQtGl()
@@ -247,7 +239,7 @@
 }
 bool ADM_coreVideoFilterQtGl::downloadTextures(ADMImage *image,  QGLFramebufferObject *fbo)
 {
-    return downloadTexturesQt(image,fbo);
+    return downloadTexturesDma(image,fbo);
 }
 /**
     \fn downloadTexture
@@ -323,6 +315,9 @@
     int height=image->GetHeight(PLANAR_Y);
     bool r=true;
 
+    glBindBufferARB(GL_PIXEL_PACK_BUFFER_ARB,0);
+    // that one might fail : checkGlError("BindARB-00");
+
     glBindBufferARB(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
     checkGlError("BindARB");
     glBufferDataARB(GL_PIXEL_PACK_BUFFER_ARB,info.width*info.height*sizeof(uint32_t),
@@ -338,10 +333,8 @@
     checkGlError("glReadPixel");
 
     // DMA call done, we can do something else here
-    ADM_usleep(5*1000);
+    ADM_usleep(1*1000);
 
-    glBindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
-    checkGlError("Bind Buffer (arb)");
 
     GLubyte* ptr = (GLubyte*)glMapBufferARB(GL_PIXEL_PACK_BUFFER_ARB,
                                         GL_READ_ONLY_ARB);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-05 16:39:05 UTC (rev 7464)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-05 16:39:07 UTC (rev 7465)
@@ -3,5 +3,6 @@
 #ADD_SUBDIRECTORY(sample_fragment)
 ADD_SUBDIRECTORY(sample_fragment2)
 ADD_SUBDIRECTORY(sample_distort)
+ADD_SUBDIRECTORY(glBenchmark)
 #ADD_SUBDIRECTORY(sample_vertex)
 #ADD_SUBDIRECTORY(glVdpau)



From mean at mail.berlios.de  Tue Sep  6 08:45:59 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 08:45:59 +0200
Subject: [Avidemux-svn-commit] r7466 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches
Message-ID: <20110906064559.9FDD6481216@sheep.berlios.de>

Author: mean
Date: 2011-09-06 08:45:59 +0200 (Tue, 06 Sep 2011)
New Revision: 7466

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/common.mak.diff
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h264_parser.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_utils.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_x86_fmtconvert_mmx.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_file.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_isom.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_avutil.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/vdpau.h.patch
Log:
[ffmpeg/patches] use relative paths

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/common.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/common.mak.diff	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/common.mak.diff	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/common.mak	2011-08-10 14:16:41.000000000 +0200
+--- ./common.mak	2011-08-10 14:16:41.000000000 +0200
 +++ ./common.mak	2011-09-03 09:03:14.265349252 +0200
 @@ -61,7 +61,7 @@
  FFLIBS    := $(FFLIBS-yes) $(FFLIBS)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_avcodec.h.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_avcodec.h.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/avcodec.h	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/avcodec.h	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/avcodec.h	2011-09-03 08:35:49.485349178 +0200
 @@ -619,6 +619,8 @@
  #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h263dec.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h263dec.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/h263dec.c	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/h263dec.c	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/h263dec.c	2011-09-03 09:00:01.025349244 +0200
 @@ -115,6 +115,25 @@
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h264_parser.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_h264_parser.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/h264_parser.c	2011-08-10 14:16:41.000000000 +0200
+--- libavcodec/h264_parser.c	2011-08-10 14:16:41.000000000 +0200
 +++ libavcodec/h264_parser.c	2011-09-03 08:35:49.545349178 +0200
 @@ -29,7 +29,52 @@
  #include "h264data.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/mpeg12.c	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/mpeg12.c	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/mpeg12.c	2011-09-03 08:35:49.555349178 +0200
 @@ -1998,6 +1998,11 @@
          ff_er_frame_end(s);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12enc.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpeg12enc.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/mpeg12enc.c	2011-08-10 14:16:41.000000000 +0200
+--- libavcodec/mpeg12enc.c	2011-08-10 14:16:41.000000000 +0200
 +++ libavcodec/mpeg12enc.c	2011-09-03 08:35:49.555349178 +0200
 @@ -127,10 +127,19 @@
              s->frame_rate_index= i;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/mpegvideo.c	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/mpegvideo.c	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/mpegvideo.c	2011-09-03 08:35:49.565349178 +0200
 @@ -736,7 +736,11 @@
      FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo_enc.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mpegvideo_enc.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/mpegvideo_enc.c	2011-08-10 14:16:41.000000000 +0200
+--- libavcodec/mpegvideo_enc.c	2011-08-10 14:16:41.000000000 +0200
 +++ libavcodec/mpegvideo_enc.c	2011-09-03 08:35:49.565349178 +0200
 @@ -376,12 +376,14 @@
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_utils.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_utils.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/utils.c	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/utils.c	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/utils.c	2011-09-03 08:35:49.575349178 +0200
 @@ -787,10 +787,12 @@
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_x86_fmtconvert_mmx.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_x86_fmtconvert_mmx.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_x86_fmtconvert_mmx.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,5 +1,5 @@
 --- libavcodec/x86/fmtconvert_mmx.c	2011-08-10 14:15:51.000000000 +0200
-+++ /home/fx/workspace/avidemux_core/ffmpeg/source/libavcodec/x86/fmtconvert_mmx.c	2011-09-03 12:38:36.365349837 +0200
++++ libavcodec/x86/fmtconvert_mmx.c	2011-09-03 12:38:36.365349837 +0200
 @@ -285,6 +285,7 @@
                  c->float_to_int16_interleave = float_to_int16_interleave_3dn2;
              }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_file.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_file.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavformat/file.c	2011-08-10 14:18:20.000000000 +0200
+--- libavformat/file.c	2011-08-10 14:18:20.000000000 +0200
 +++ libavformat/file.c	2011-09-03 08:35:49.575349178 +0200
 @@ -31,6 +31,75 @@
  #include "os_support.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_isom.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_isom.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavformat/isom.c	2011-08-10 14:15:51.000000000 +0200
+--- libavformat/isom.c	2011-08-10 14:15:51.000000000 +0200
 +++ libavformat/isom.c	2011-09-03 08:35:49.695349178 +0200
 @@ -237,7 +237,10 @@
      { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_matroskaenc.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_matroskaenc.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavformat/matroskaenc.c	2011-08-10 14:16:41.000000000 +0200
+--- libavformat/matroskaenc.c	2011-08-10 14:16:41.000000000 +0200
 +++ libavformat/matroskaenc.c	2011-09-03 09:02:21.375349250 +0200
 @@ -409,6 +409,7 @@
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavformat_mpegtsenc_eac3.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,5 +1,5 @@
 --- libavformat/mpegtsenc.c	2011-08-10 14:16:41.000000000 +0200
-+++ /home/fx/workspace/avidemux_core/ffmpeg/source/libavformat/mpegtsenc.c	2011-09-03 16:26:10.605350454 +0200
++++ libavformat/mpegtsenc.c	2011-09-03 16:26:10.605350454 +0200
 @@ -285,6 +285,17 @@
          /* write optional descriptors here */
          switch(st->codec->codec_type) {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_avutil.h.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_avutil.h.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavutil/avutil.h	2011-08-10 14:18:20.000000000 +0200
+--- libavutil/avutil.h	2011-08-10 14:18:20.000000000 +0200
 +++ libavutil/avutil.h	2011-09-03 08:35:49.695349178 +0200
 @@ -26,6 +26,13 @@
   * external API header

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.c.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.c.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavutil/lfg.c	2011-08-10 14:15:51.000000000 +0200
+--- libavutil/lfg.c	2011-08-10 14:15:51.000000000 +0200
 +++ libavutil/lfg.c	2011-09-03 08:35:49.695349178 +0200
 @@ -39,7 +39,7 @@
          c->state[i+2]= AV_RL32(tmp+8);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.h.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavutil_lfg.h.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavutil/lfg.h	2011-08-10 14:15:51.000000000 +0200
+--- libavutil/lfg.h	2011-08-10 14:15:51.000000000 +0200
 +++ libavutil/lfg.h	2011-09-03 08:35:49.715349178 +0200
 @@ -24,7 +24,7 @@
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/vdpau.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/vdpau.h.patch	2011-09-05 16:39:07 UTC (rev 7465)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/vdpau.h.patch	2011-09-06 06:45:59 UTC (rev 7466)
@@ -1,4 +1,4 @@
---- /home/fx/workspace/gitted/avidemux_core/ffmpeg_package/source/libavcodec/vdpau.h	2011-08-10 14:18:20.000000000 +0200
+--- libavcodec/vdpau.h	2011-08-10 14:18:20.000000000 +0200
 +++ libavcodec/vdpau.h	2011-09-03 08:35:49.735349178 +0200
 @@ -66,7 +66,7 @@
      VdpVideoSurface surface; ///< Used as rendered surface, never changed.



From mean at mail.berlios.de  Tue Sep  6 08:55:03 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 08:55:03 +0200
Subject: [Avidemux-svn-commit] r7467 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches
Message-ID: <20110906065503.A2715481216@sheep.berlios.de>

Author: mean
Date: 2011-09-06 08:55:03 +0200 (Tue, 06 Sep 2011)
New Revision: 7467

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch
Log:
[ffmpeg/patch] Remove absolute path

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch	2011-09-06 06:45:59 UTC (rev 7466)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch	2011-09-06 06:55:03 UTC (rev 7467)
@@ -1,5 +1,5 @@
 --- libavcodec/mathops.h	2011-08-10 14:15:51.000000000 +0200
-+++ /home/fx/workspace/avidemux_core/ffmpeg/source/libavcodec/mathops.h	2011-09-03 09:31:09.635349327 +0200
++++ libavcodec/mathops.h	2011-09-03 09:31:09.635349327 +0200
 @@ -23,7 +23,9 @@
  #define AVCODEC_MATHOPS_H
  



From mean at mail.berlios.de  Tue Sep  6 09:12:17 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 09:12:17 +0200
Subject: [Avidemux-svn-commit] r7468 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches
Message-ID: <20110906071217.73E7F481216@sheep.berlios.de>

Author: mean
Date: 2011-09-06 09:12:16 +0200 (Tue, 06 Sep 2011)
New Revision: 7468

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch
Log:
[ffmpeg/patch] Remove absolute path

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch	2011-09-06 06:55:03 UTC (rev 7467)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/libavcodec_mathopt_put_bits.h.patch	2011-09-06 07:12:16 UTC (rev 7468)
@@ -11,7 +11,7 @@
  #if   ARCH_ARM
  #   include "arm/mathops.h"
 --- libavcodec/put_bits.h	2011-08-10 14:16:41.000000000 +0200
-+++ /home/fx/workspace/avidemux_core/ffmpeg/source/libavcodec//put_bits.h	2011-09-03 09:32:37.685349331 +0200
++++ libavcodec//put_bits.h	2011-09-03 09:32:37.685349331 +0200
 @@ -34,7 +34,9 @@
  #include "libavutil/intreadwrite.h"
  #include "libavutil/log.h"



From mean at mail.berlios.de  Tue Sep  6 14:11:59 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 14:11:59 +0200
Subject: [Avidemux-svn-commit] r7469 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4:
	ADM_UIs/include ADM_UIs/src ADM_userInterfaces/ADM_gui
Message-ID: <20110906121200.23F03481223@sheep.berlios.de>

Author: mean
Date: 2011-09-06 14:11:59 +0200 (Tue, 06 Sep 2011)
New Revision: 7469

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
Log:
[openGl] Manage ARB extensions

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-09-06 07:12:16 UTC (rev 7468)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-09-06 12:11:59 UTC (rev 7469)
@@ -25,12 +25,32 @@
 #endif
 
 #include <QtOpenGL/QtOpenGL>
+/**
+    \class ADM_glExt
+*/
+class ADM_glExt
+{
+public:
+ static       void setActivateTexture(void *func);
+ static       void setBindBuffer(void *func);
+ static       void setGenBuffers(void *func);
+ static       void setDeleteBuffers(void *func);
+ static       void setMapBuffer(void *func);
+ static       void setUnmapBuffer(void *func);
+ static       void setBufferData(void *func);
+public:
+ static       void activeTexture  (GLenum texture);
+ static       void bindBuffer     (GLenum target, GLuint buffer);
+ static       void genBuffers     (GLsizei n, GLuint *buffers);
+ static       void deleteBuffers  (GLsizei n, const GLuint *buffers);
+ static       void *mapBuffer     (GLenum target, GLenum access);
+ static       void unmapBuffer    (GLenum target);
+ static       void bufferData     (GLenum target,GLsizeiptr size, const GLvoid *data,GLenum usage);
+};
 
 
-// Get glActiveTexture
-typedef void APIENTRY (GlActiveTexture_Type)(GLenum texture);
-bool ADM_setActiveTexture(GlActiveTexture_Type *set);
-GlActiveTexture_Type *ADM_getActiveTexture(void);
-bool ADM_hasActiveTexture(void);
+bool ADM_GlHasActiveTexture(void);
+bool ADM_GlHasARB(void);
 #endif
 
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-06 07:12:16 UTC (rev 7468)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-06 12:11:59 UTC (rev 7469)
@@ -34,7 +34,6 @@
                             QGLShaderProgram     *glProgramY;
                             QGLShaderProgram     *glProgramUV;
                             int                   firstRun;
-                            GlActiveTexture_Type *myGlActiveTexture;
                             GLuint                texName[3];
 protected:
                             // image <--> texture

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-06 07:12:16 UTC (rev 7468)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-06 12:11:59 UTC (rev 7469)
@@ -8,8 +8,49 @@
 #include "ADM_default.h"
 #include "DIA_coreToolkit.h"
 static QGLWidget *thisWidget=NULL;
-static GlActiveTexture_Type *myActiveTexture=NULL;
 /**
+
+*/
+static PFNGLACTIVETEXTUREPROC myActiveTexture=NULL;
+static PFNGLBINDBUFFERPROC    myBindBuffer=NULL;
+static PFNGLDELETEBUFFERSPROC myDeleteBuffers=NULL;
+static PFNGLGENBUFFERSPROC    myGenBuffers=NULL;
+static PFNGLMAPBUFFERPROC     myMapBuffer=NULL;
+static PFNGLUNMAPBUFFERPROC   myUnmapBuffer=NULL;
+static PFNGLBUFFERDATAARBPROC myBufferData=NULL;
+
+ void ADM_glExt::setBufferData(void *func)
+{
+    myBufferData=(PFNGLBUFFERDATAARBPROC )func;
+}
+
+ void ADM_glExt::setActivateTexture(void *func)
+{
+    myActiveTexture=(PFNGLACTIVETEXTUREPROC )func;
+}
+ void ADM_glExt::setBindBuffer(void *func)
+{
+    myBindBuffer=(PFNGLBINDBUFFERPROC)func;
+}
+ void ADM_glExt::setGenBuffers(void *func)
+{
+    myGenBuffers=(PFNGLGENBUFFERSPROC)func;
+}
+ void ADM_glExt::setDeleteBuffers(void *func)
+{
+    myDeleteBuffers=(PFNGLDELETEBUFFERSPROC)func;
+}
+ void ADM_glExt::setMapBuffer(void *func)
+{
+    myMapBuffer=(PFNGLMAPBUFFERPROC)func;
+}
+ void ADM_glExt::setUnmapBuffer(void *func)
+{
+    myUnmapBuffer=(PFNGLUNMAPBUFFERPROC)func;
+}
+
+
+/**
      \fn checkGlError
      \brief pop an error if an operation failed
 */
@@ -19,33 +60,77 @@
     if(!er) return true;
     ADM_error("[GLERROR]%s: %d => %s\n",op,er,gluErrorString(er));
     return false;
-}           
+}          
+
+#define CHECK(x) if(!x) {GUI_Error_HIG("Missing extension "#x,#x" not defined");ADM_assert(0);}
 /**
-    \fn ADM_setActiveTexture
+    \class ADM_glExt
 */
-bool ADM_setActiveTexture(GlActiveTexture_Type *set)
+void ADM_glExt::activeTexture  (GLenum texture)
 {
-    myActiveTexture=set;
-    return true;
+    CHECK(myActiveTexture);
+      myActiveTexture(texture);
 }
-/**
-    \fn ADM_getActiveTexture
-*/
-GlActiveTexture_Type *ADM_getActiveTexture(void)
+void ADM_glExt::bindBuffer     (GLenum target, GLuint buffer)
 {
-    return myActiveTexture;
+    CHECK(myBindBuffer);
+      myBindBuffer(target,buffer);
+
 }
+void ADM_glExt::genBuffers     (GLsizei n, GLuint *buffers)
+{
+    CHECK(myGenBuffers);
+      myGenBuffers(n,buffers);
 
+}
+void ADM_glExt::deleteBuffers  (GLsizei n, const GLuint *buffers)
+{
+    CHECK(myDeleteBuffers);
+      myDeleteBuffers(n,buffers);
+
+}
+
+void *ADM_glExt::mapBuffer    (GLenum target, GLenum access)
+{
+    CHECK(myMapBuffer);
+    return myMapBuffer(target,access);
+
+}
+void ADM_glExt::unmapBuffer    (GLenum target)
+{
+    CHECK(myUnmapBuffer);
+      myUnmapBuffer(target);
+
+}
+void ADM_glExt::bufferData(GLenum target,GLsizeiptr size, const GLvoid *data,GLenum usage)
+{
+    CHECK(myBufferData);
+      myBufferData(target,size,data,usage);
+
+}
+
 /**
     \fn ADM_hasActiveTexture
 */
-bool ADM_hasActiveTexture(void)
+bool ADM_glHasActiveTexture(void)
 {
     if(!myActiveTexture) return false;
     return true;
 }
 
 /**
+    \fn ADM_glHasARB
+*/
+bool ADM_glHasARB(void)
+{
+    if(!myBindBuffer) return false;
+    if(!myDeleteBuffers) return false;
+    if(!myGenBuffers) return false;
+    if(!myMapBuffer) return false;
+    if(!myUnmapBuffer) return false;
+    return true;
+}
+/**
 
 */
 bool ADM_setGlWidget(QGLWidget *w)
@@ -83,13 +168,6 @@
     ADM_assert(fboY);
     fboUV = new QGLFramebufferObject(info.width/2,info.height/2);
     ADM_assert(fboUV);
-    myGlActiveTexture=ADM_getActiveTexture();
-    if(!myGlActiveTexture)
-    {
-        ADM_error("Cannot get glActiveTexture\n");
-        GUI_Error_HIG("","Cannot get glActiveTexture");
-        ADM_assert(0);
-    }
     glGenTextures(3,texName);
     checkGlError("GenTex");
     glGenBuffersARB(1,&bufferARB);
@@ -239,7 +317,9 @@
 }
 bool ADM_coreVideoFilterQtGl::downloadTextures(ADMImage *image,  QGLFramebufferObject *fbo)
 {
-    return downloadTexturesDma(image,fbo);
+    if(ADM_glHasARB())
+        return downloadTexturesDma(image,fbo);
+    return downloadTexturesQt(image,fbo);
 }
 /**
     \fn downloadTexture
@@ -315,18 +395,18 @@
     int height=image->GetHeight(PLANAR_Y);
     bool r=true;
 
-    glBindBufferARB(GL_PIXEL_PACK_BUFFER_ARB,0);
+    ADM_glExt::bindBuffer(GL_PIXEL_PACK_BUFFER_ARB,0);
     // that one might fail : checkGlError("BindARB-00");
 
-    glBindBufferARB(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
+    ADM_glExt::bindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
     checkGlError("BindARB");
-    glBufferDataARB(GL_PIXEL_PACK_BUFFER_ARB,info.width*info.height*sizeof(uint32_t),
+    ADM_glExt::bufferData(GL_PIXEL_PACK_BUFFER_ARB,info.width*info.height*sizeof(uint32_t),
                                 NULL,GL_STREAM_READ_ARB);
     checkGlError("BufferDataRB");
 
     glReadBuffer(GL_COLOR_ATTACHMENT0_EXT); 
     checkGlError("ReadBuffer (fbo)");
-    glBindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
+    ADM_glExt::bindBuffer(GL_PIXEL_PACK_BUFFER_ARB,bufferARB);
     checkGlError("Bind Buffer (arb)");
 
     glReadPixels(0, 0, width, height, GL_BGRA, GL_UNSIGNED_BYTE, 0);
@@ -336,8 +416,7 @@
     ADM_usleep(1*1000);
 
 
-    GLubyte* ptr = (GLubyte*)glMapBufferARB(GL_PIXEL_PACK_BUFFER_ARB,
-                                        GL_READ_ONLY_ARB);
+    GLubyte* ptr = (GLubyte*)ADM_glExt::mapBuffer(GL_PIXEL_PACK_BUFFER_ARB, GL_READ_ONLY_ARB);
     checkGlError("MapBuffer");
     if(!ptr)
     {
@@ -399,7 +478,9 @@
     #ifdef ADM_CPU_X86
         __asm__( "emms\n"::  );
     #endif
+        ADM_glExt::unmapBuffer(GL_PIXEL_PACK_BUFFER_ARB);
     }
+    ADM_glExt::bindBuffer(GL_PIXEL_PACK_BUFFER_ARB,0);
     return r;
 }
 /**
@@ -407,7 +488,7 @@
 */
 void ADM_coreVideoFilterQtGl::uploadOnePlane(ADMImage *image, ADM_PLANE plane, GLuint tex,int texNum )
 {
-        myGlActiveTexture(tex);  // Activate texture unit "tex"
+        ADM_glExt::activeTexture(tex);  // Activate texture unit "tex"
         glBindTexture(GL_TEXTURE_RECTANGLE_NV, texNum); // Use texture "texNum"
 
         glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
@@ -438,7 +519,7 @@
           // Activate texture unit "tex"
         for(int xplane=2;xplane>=0;xplane--)
         {
-            myGlActiveTexture(GL_TEXTURE0+xplane);
+            ADM_glExt::activeTexture(GL_TEXTURE0+xplane);
             ADM_PLANE plane=(ADM_PLANE)xplane;
             glBindTexture(GL_TEXTURE_RECTANGLE_NV, texName[xplane]); // Use tex engine "texNum"
             glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-06 07:12:16 UTC (rev 7468)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-06 12:11:59 UTC (rev 7469)
@@ -36,7 +36,7 @@
 #include "DIA_coreToolkit.h"
 
 #ifdef USE_OPENGL
-extern bool ADM_hasActiveTexture(void);
+extern bool ADM_glHasActiveTexture(void);
 void UI_Qt4InitGl(void);
 void UI_Qt4CleanGl(void);
 #endif
@@ -1241,7 +1241,7 @@
 #ifndef USE_OPENGL
     return false;
 #else
-    if(!ADM_hasActiveTexture()) return false; // ADM_setActiveTexure
+    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
     bool enabled;
     prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
     return enabled;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 07:12:16 UTC (rev 7468)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 12:11:59 UTC (rev 7469)
@@ -43,21 +43,21 @@
     topGlWidgetRoot->resize(4,4);
     topGlWidgetRoot->show();
     
-#ifndef QT_OPENGL_ES
-    GlActiveTexture_Type *tex= (GlActiveTexture_Type *)topGlWidgetRoot->context()->getProcAddress(QLatin1String("glActiveTexture"));
+    void  *func;
+
+    #define PROBE_GL_EXT(funcName, meth)     func=topGlWidgetRoot->context()->getProcAddress(QLatin1String(#funcName));   \
+                                         ADM_glExt::meth(func); \
+                                         if(!func) ADM_warning("Extension "#funcName" missing\n");
+
+    PROBE_GL_EXT(glActiveTexture,setActivateTexture)
+    PROBE_GL_EXT(glBindBufferARB,setBindBuffer)
+    PROBE_GL_EXT(glGenBuffers,setGenBuffers)
+    PROBE_GL_EXT(glDeleteBuffers,setDeleteBuffers)
+    PROBE_GL_EXT(glMapBufferARB,setMapBuffer)
+    PROBE_GL_EXT(glUnmapBufferARB,setUnmapBuffer)
+    PROBE_GL_EXT(glBufferDataARB,setBufferData)
+
 
-	if (!tex)
-	{
-		ADM_error("[GL Render] Active Texture function not found!\n");
-	}else
-    {
-        ADM_warning("[GL Render] Active Texture function found (Not openGL_ES)\n");
-        ADM_setActiveTexture(tex);
-    }
-#else
-    ADM_setActiveTexture(glActiveTexture);
-#endif
-
 	printf("[GL Render] OpenGL Vendor: %s\n", glGetString(GL_VENDOR));
 	printf("[GL Render] OpenGL Renderer: %s\n", glGetString(GL_RENDERER));
 	printf("[GL Render] OpenGL Version: %s\n", glGetString(GL_VERSION));



From mean at mail.berlios.de  Tue Sep  6 14:26:54 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 14:26:54 +0200
Subject: [Avidemux-svn-commit] r7470 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src
Message-ID: <20110906122654.D47D3481223@sheep.berlios.de>

Author: mean
Date: 2011-09-06 14:26:54 +0200 (Tue, 06 Sep 2011)
New Revision: 7470

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[gl] Bind more extension to ADM_glExt::

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-06 12:11:59 UTC (rev 7469)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-06 12:26:54 UTC (rev 7470)
@@ -170,7 +170,8 @@
     ADM_assert(fboUV);
     glGenTextures(3,texName);
     checkGlError("GenTex");
-    glGenBuffersARB(1,&bufferARB);
+    if(ADM_glHasARB)
+        ADM_glExt::genBuffers(1,&bufferARB);
     checkGlError("GenBuffer");
     widget->doneCurrent();
     // glTexture TODO
@@ -192,7 +193,8 @@
     fboUV=NULL;
     if(widget) delete widget;       
     widget=NULL;
-    glDeleteBuffersARB(1,&bufferARB);
+    if(ADM_glHasARB)
+        ADM_glExt::deleteBuffers(1,&bufferARB);
     bufferARB=0;
 }
 #if  1
@@ -545,4 +547,4 @@
         }
 }
 
-// EOF
\ No newline at end of file
+// EOF



From mean at mail.berlios.de  Tue Sep  6 14:26:55 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 14:26:55 +0200
Subject: [Avidemux-svn-commit] r7471 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110906122655.E57EE481223@sheep.berlios.de>

Author: mean
Date: 2011-09-06 14:26:55 +0200 (Tue, 06 Sep 2011)
New Revision: 7471

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake
Log:
[gl] win32 fix

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake	2011-09-06 12:26:54 UTC (rev 7470)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake	2011-09-06 12:26:55 UTC (rev 7471)
@@ -12,7 +12,7 @@
                        MESSAGE(STATUS "Found QtOpenGL")
                        IF(CROSS)
                                 SET(OPENGL_INCLUDE_DIR  "${MINGW}/include" )
-                                SET(OPENGL_LIBRARIES "-lopengl32")
+                                SET(OPENGL_LIBRARIES "-lopengl32 -lglu32")
                                 SET(OPENGL_FOUND 1)
                                 MESSAGE(STATUS "Cross compilation override, Skipping openGl search")
                        ELSE(CROSS)



From mean at mail.berlios.de  Tue Sep  6 16:56:58 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 16:56:58 +0200
Subject: [Avidemux-svn-commit] r7472 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32
Message-ID: <20110906145659.14FDF481227@sheep.berlios.de>

Author: mean
Date: 2011-09-06 16:56:58 +0200 (Tue, 06 Sep 2011)
New Revision: 7472

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
Log:
[win32/audio] Increase buckets

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-06 12:26:55 UTC (rev 7471)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-06 14:56:58 UTC (rev 7472)
@@ -20,7 +20,7 @@
 
 #define aprintf(...) {}
 
-#define NB_BUCKET 8
+#define NB_BUCKET 64
 
 static uint32_t bucketSize;
 static HWAVEOUT myDevice;



From mean at mail.berlios.de  Tue Sep  6 16:57:00 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 16:57:00 +0200
Subject: [Avidemux-svn-commit] r7473 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110906145700.2A7B3481227@sheep.berlios.de>

Author: mean
Date: 2011-09-06 16:56:59 +0200 (Tue, 06 Sep 2011)
New Revision: 7473

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
Log:
[GL] Be more verbose about ARB

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 14:56:58 UTC (rev 7472)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 14:56:59 UTC (rev 7473)
@@ -32,6 +32,7 @@
 dummyGLWidget *topGlWidget=NULL;
 dummyGLWidget *topGlWidgetRoot=NULL;
 extern QWidget *VuMeter;
+extern bool ADM_glHasARB(void);
 /**
     \fn UI_Qt4InitGl
 */
@@ -46,8 +47,9 @@
     void  *func;
 
     #define PROBE_GL_EXT(funcName, meth)     func=topGlWidgetRoot->context()->getProcAddress(QLatin1String(#funcName));   \
-                                         ADM_glExt::meth(func); \
-                                         if(!func) ADM_warning("Extension "#funcName" missing\n");
+             ADM_glExt::meth(func); \
+             if(!func) ADM_warning("Extension "#funcName" missing\n"); \
+             else ADM_info("Extension "#funcName" found\n");
 
     PROBE_GL_EXT(glActiveTexture,setActivateTexture)
     PROBE_GL_EXT(glBindBufferARB,setBindBuffer)
@@ -57,6 +59,12 @@
     PROBE_GL_EXT(glUnmapBufferARB,setUnmapBuffer)
     PROBE_GL_EXT(glBufferDataARB,setBufferData)
 
+
+    if(ADM_glHasARB())
+    {
+        ADM_info("openGL ARB activated\n");
+    }else
+        ADM_warning("OpenGL: Not enough ARB extension found\n");
 
 	printf("[GL Render] OpenGL Vendor: %s\n", glGetString(GL_VENDOR));
 	printf("[GL Render] OpenGL Renderer: %s\n", glGetString(GL_RENDERER));



From mean at mail.berlios.de  Tue Sep  6 18:41:36 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue,  6 Sep 2011 18:41:36 +0200
Subject: [Avidemux-svn-commit] r7474 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110906164136.29C89481227@sheep.berlios.de>

Author: mean
Date: 2011-09-06 18:41:35 +0200 (Tue, 06 Sep 2011)
New Revision: 7474

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
Log:
[openGLInit] Be more verbose

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 14:56:59 UTC (rev 7473)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2GL.cpp	2011-09-06 16:41:35 UTC (rev 7474)
@@ -41,10 +41,19 @@
     ADM_info("Creating openGl dummy widget\n");
     topGlWidgetRoot=new dummyGLWidget(VuMeter);
     ADM_setGlWidget(topGlWidgetRoot);
+    ADM_info("Dummy Widget created\n");
+#ifndef __MINGW__
     topGlWidgetRoot->resize(4,4);
+#endif
     topGlWidgetRoot->show();
-    
+    ADM_info("Probing openGl extension\n");
+    if(!topGlWidgetRoot->context())
+    {
+        ADM_error("Cannot get context\n");
+        return;
+    }
     void  *func;
+    
 
     #define PROBE_GL_EXT(funcName, meth)     func=topGlWidgetRoot->context()->getProcAddress(QLatin1String(#funcName));   \
              ADM_glExt::meth(func); \
@@ -59,7 +68,7 @@
     PROBE_GL_EXT(glUnmapBufferARB,setUnmapBuffer)
     PROBE_GL_EXT(glBufferDataARB,setBufferData)
 
-
+    ADM_info("Probing dine\n");
     if(ADM_glHasARB())
     {
         ADM_info("openGL ARB activated\n");



From mean at mail.berlios.de  Wed Sep  7 07:17:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 07:17:19 +0200
Subject: [Avidemux-svn-commit] r7475 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32
Message-ID: <20110907051719.AC559480B11@sheep.berlios.de>

Author: mean
Date: 2011-09-07 07:17:19 +0200 (Wed, 07 Sep 2011)
New Revision: 7475

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
Log:
[win32/device] remove warning which is not a warning

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-06 16:41:35 UTC (rev 7474)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-07 05:17:19 UTC (rev 7475)
@@ -30,11 +30,18 @@
 
 WAVEHDR waveHdr[NB_BUCKET];	
 ADM_DECLARE_AUDIODEVICE(Win32,win32AudioDevice,1,0,0,"Win32 audio device (c) mean");
+/**
+    \fn ctor
+*/
+
 win32AudioDevice::win32AudioDevice(void) 
 {
 	printf("[Win32] Creating audio device\n");
 	_inUse=0;
 }
+/**
+    \fn localStop
+*/
 
 bool win32AudioDevice::localStop(void) 
 {
@@ -65,7 +72,9 @@
 
 	return true;
 }
-
+/**
+    \fn localInit
+*/
 bool win32AudioDevice::localInit(void) 
 {
 	printf("[Win32] Opening Audio, channels=%u freq=%u\n",_channels, _frequency);
@@ -78,7 +87,7 @@
 
 	_inUse = 1;
 	
-	bucketSize = _channels * _frequency;
+	bucketSize = (_channels * _frequency*2*4)/100; // 40 ms bucket * 64 => 3 sec buffer
 
 	WAVEFORMATEX wav;
 
@@ -116,7 +125,9 @@
 
 	return 1;
 }
-
+/**
+    \fn setVolume
+*/
 uint8_t  win32AudioDevice::setVolume(int volume) 
 {
 	uint32_t value;
@@ -128,6 +139,9 @@
 
 	return 1;
 }
+/**
+    \fn sendData
+*/
 
 void win32AudioDevice::sendData(void)
 {
@@ -149,22 +163,19 @@
 			rdIndex += waveHdr[i].dwBufferLength;
 			len -= waveHdr[i].dwBufferLength;
             mutex.unlock();
-			if (waveOutWrite(myDevice, &waveHdr[i], sizeof(WAVEHDR)) == MMSYSERR_NOERROR)
+            MMRESULT er=waveOutWrite(myDevice, &waveHdr[i], sizeof(WAVEHDR));
+			if (er) == MMSYSERR_NOERROR)
 				success = 1;
 			else
+            {
+                handleMM(er);
 				break;
+            }
 		}
 
 		if (len == 0)
 			break;
 	}
-
-	if (len != 0)
-	{
-		printf("[Win32] No audio buffer available, %u bytes discarded\n", len);
-		return ;
-	}
-
 	return ;
 }
 
@@ -175,6 +186,9 @@
 const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
 const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
                                              ADM_CH_LFE,ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT};
+/**
+    \fn getWantedChannelMapping
+*/
 const CHANNEL_TYPE *win32AudioDevice::getWantedChannelMapping(uint32_t channels)
 {
     switch(channels)
@@ -187,6 +201,9 @@
     }
     return NULL;
 }
+/**
+    \fn handleMM
+*/
 void handleMM(MMRESULT err)
 {
 #define ERMM(x) if(err==x) printf("[Win32] "#x"\n");
@@ -196,4 +213,6 @@
 	ERMM(MMSYSERR_NODRIVER);
 	ERMM(WAVERR_BADFORMAT);
 	ERMM(WAVERR_SYNC);
+    ERMM(WAVERR_STILLPLAYING);
 }
+// EOF



From mean at mail.berlios.de  Wed Sep  7 07:28:55 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 07:28:55 +0200
Subject: [Avidemux-svn-commit] r7476 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32
Message-ID: <20110907052855.E8CCC480B11@sheep.berlios.de>

Author: mean
Date: 2011-09-07 07:28:55 +0200 (Wed, 07 Sep 2011)
New Revision: 7476

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
Log:
[win32/audio] Fix  typo

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-07 05:17:19 UTC (rev 7475)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2011-09-07 05:28:55 UTC (rev 7476)
@@ -164,7 +164,7 @@
 			len -= waveHdr[i].dwBufferLength;
             mutex.unlock();
             MMRESULT er=waveOutWrite(myDevice, &waveHdr[i], sizeof(WAVEHDR));
-			if (er) == MMSYSERR_NOERROR)
+			if (er == MMSYSERR_NOERROR)
 				success = 1;
 			else
             {



From mean at mail.berlios.de  Wed Sep  7 08:26:03 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 08:26:03 +0200
Subject: [Avidemux-svn-commit] r7477 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110907062603.E8B194811E3@sheep.berlios.de>

Author: mean
Date: 2011-09-07 08:26:03 +0200 (Wed, 07 Sep 2011)
New Revision: 7477

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[openGl Render] Simplify

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-07 05:28:55 UTC (rev 7476)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-07 06:26:03 UTC (rev 7477)
@@ -53,7 +53,7 @@
 	"}\n";
 
 /**
-
+    \fn ctor
 */
 
 QtGlAccelWidget::QtGlAccelWidget(QWidget *parent, int w, int h) : QGLWidget(parent)
@@ -70,7 +70,7 @@
     glGenTextures(3,textureName);
 }
 /**
-
+    \fn setDisplaySize
 */
 bool QtGlAccelWidget::setDisplaySize(int width,int height)
 {
@@ -80,14 +80,14 @@
     return true;
 }
 /**
-
+        \fn dtor
 */
 QtGlAccelWidget::~QtGlAccelWidget()
 {
     glDeleteTextures(3,textureName);
 }
 /**
-
+    \fn setImage
 */
 
 bool QtGlAccelWidget::setImage(ADMImage *pic)
@@ -98,29 +98,22 @@
     
 	this->imageWidth = imageWidth;
 	this->imageHeight = imageHeight;
-
-	textureRealWidths[0] = imageWidth;
-    textureStrides[0]=pic->GetPitch(PLANAR_Y);
-	textureHeights[0] = imageHeight;
-	textureOffsets[0] = pic->GetReadPtr(PLANAR_Y);
-
-	textureRealWidths[1] = imageWidth / 2;
-    textureStrides[1]=pic->GetPitch(PLANAR_V);
-	textureHeights[1] = imageHeight / 2;
-	textureOffsets[1] = pic->GetReadPtr(PLANAR_V);
-
-	
-	textureRealWidths[2] = imageWidth / 2;
-    textureStrides[2]=pic->GetPitch(PLANAR_U);
-	textureHeights[2] = imageHeight / 2;
-	textureOffsets[2] = pic->GetReadPtr(PLANAR_U);
 
-    updateTexture();
+    for(int i=0;i<3;i++)
+    {
+        ADM_PLANE plane=(ADM_PLANE)i;
+        textureRealWidths[i] = pic->GetWidth(plane);
+        textureStrides[i]    = pic->GetPitch(plane);
+        textureHeights[i]    = pic->GetHeight(plane);
+        textureOffsets[i]    = pic->GetReadPtr(plane);
 
+    }
+    updateTexture();
+    repaint();
     return true;
 }
 /**
-
+    \fn initializeGL
 */
 void QtGlAccelWidget::initializeGL()
 {
@@ -164,11 +157,13 @@
 	}
 
 	glProgram->setUniformValue("texY", 0);
-	glProgram->setUniformValue("texU", 1);
-	glProgram->setUniformValue("texV", 2);
+	glProgram->setUniformValue("texU", 2);
+	glProgram->setUniformValue("texV", 1);
+    if(success==1)
+        printf("[GL Render] Init successful\n");
 }
 /**
-
+    \fn updateTexture
 */
 void QtGlAccelWidget::updateTexture()
 {
@@ -187,59 +182,55 @@
 		glOrtho(0, width(), 0, height(), -1, 1);
 		glProgram->setUniformValue("height", (float)imageHeight);
 	}
-
-	// U
-	glActiveTexture(GL_TEXTURE1);
-	glBindTexture(GL_TEXTURE_RECTANGLE_NV, textureName[1]);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
-	glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
-
+
+//--
+      // Activate texture unit "tex"
+        for(int xplane=2;xplane>=0;xplane--)
+        {
+            glActiveTexture(GL_TEXTURE0+xplane);
+            ADM_PLANE plane=(ADM_PLANE)xplane;
+            glBindTexture(GL_TEXTURE_RECTANGLE_NV, textureName[xplane]); // Use tex engine "texNum"
+            glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
+            glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
+            glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
+            glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
+            glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+
+                if(!firstRun)
+                {
+                    glTexImage2D(GL_TEXTURE_RECTANGLE_NV, 0, GL_LUMINANCE, 
+                                    textureStrides[xplane],
+                                    textureHeights[xplane],
+                                    0, GL_LUMINANCE, GL_UNSIGNED_BYTE, 
+                                    textureOffsets[xplane]);
+                }else
+                {
+                    glTexSubImage2D(GL_TEXTURE_RECTANGLE_NV, 0, 0, 0, 
+                        textureStrides[xplane],
+                        textureHeights[xplane],
+                        GL_LUMINANCE, GL_UNSIGNED_BYTE, 
+                        textureOffsets[xplane]);
+                }
+        }
+
 	if (firstRun)
-		glTexImage2D(GL_TEXTURE_RECTANGLE_NV, 0, GL_LUMINANCE, textureStrides[1], textureHeights[1], 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[1]);
-	else
-		glTexSubImage2D(GL_TEXTURE_RECTANGLE_NV, 0, 0, 0, textureStrides[1], textureHeights[1], GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[1]);
-
-	// V
-	glActiveTexture(GL_TEXTURE2);
-	glBindTexture(GL_TEXTURE_RECTANGLE_NV, textureName[2]);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
-	glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
-
-	if (firstRun)
-		glTexImage2D(GL_TEXTURE_RECTANGLE_NV, 0, GL_LUMINANCE, textureStrides[2], textureHeights[2], 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[2]);
-	else
-		glTexSubImage2D(GL_TEXTURE_RECTANGLE_NV, 0, 0, 0, textureStrides[2], textureHeights[2], GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[2]);
-
-	// Y
-	glActiveTexture(GL_TEXTURE0);
-	glBindTexture(GL_TEXTURE_RECTANGLE_NV, textureName[0]);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
-	glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
-	glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
-
-	if (firstRun)
 	{
-		glTexImage2D(GL_TEXTURE_RECTANGLE_NV, 0, GL_LUMINANCE, textureStrides[0], textureHeights[0], 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[0]);
 		firstRun = false;
 	}
-	else
-		glTexSubImage2D(GL_TEXTURE_RECTANGLE_NV, 0, 0, 0, textureStrides[0], textureHeights[0], GL_LUMINANCE, GL_UNSIGNED_BYTE, textureOffsets[0]);
     doneCurrent();
 }
 /**
-
+    \fn paintGL
 */
 void QtGlAccelWidget::paintGL()
 {
+	glProgram->setUniformValue("texY", 0);
+	glProgram->setUniformValue("texU", 2);
+	glProgram->setUniformValue("texV", 1);
+    glProgram->setUniformValue("height", (float)imageHeight);
+
     makeCurrent();
+    glPushMatrix();
 	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 	glBegin(GL_QUADS);
 	glTexCoord2i(0, 0);
@@ -251,6 +242,7 @@
 	glTexCoord2i(0, imageHeight);
 	glVertex2i(0, height());
 	glEnd();
+    glPopMatrix();
     doneCurrent();
 }
 /**
@@ -298,7 +290,7 @@
         return false;
     }
 
-	
+	printf("[GL Render] Setting widget display size to %d x %d\n",imageWidth,imageHeight);
     glWidget->setDisplaySize(displayWidth,displayHeight);
 	glWidget->show();
     return true;



From mean at mail.berlios.de  Wed Sep  7 10:03:08 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 10:03:08 +0200
Subject: [Avidemux-svn-commit] r7478 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110907080308.A900D4811E3@sheep.berlios.de>

Author: mean
Date: 2011-09-07 10:03:08 +0200 (Wed, 07 Sep 2011)
New Revision: 7478

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[openGl] Change things a bit so that it works on win32

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-07 06:26:03 UTC (rev 7477)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-07 08:03:08 UTC (rev 7478)
@@ -109,7 +109,6 @@
 
     }
     updateTexture();
-    repaint();
     return true;
 }
 /**
@@ -167,7 +166,7 @@
 */
 void QtGlAccelWidget::updateTexture()
 {
-    makeCurrent();
+    
 	if (!textureOffsets[0])
 	{
 		printf("[Render] Buffer not set\n");
@@ -217,7 +216,7 @@
 	{
 		firstRun = false;
 	}
-    doneCurrent();
+    
 }
 /**
     \fn paintGL
@@ -229,9 +228,7 @@
 	glProgram->setUniformValue("texV", 1);
     glProgram->setUniformValue("height", (float)imageHeight);
 
-    makeCurrent();
-    glPushMatrix();
-	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 	glBegin(GL_QUADS);
 	glTexCoord2i(0, 0);
 	glVertex2i(0, 0);
@@ -242,8 +239,7 @@
 	glTexCoord2i(0, imageHeight);
 	glVertex2i(0, height());
 	glEnd();
-    glPopMatrix();
-    doneCurrent();
+    
 }
 /**
     \fn ctor
@@ -299,9 +295,11 @@
     \fn displayImage
 */
 bool QtGlRender::displayImage(ADMImage *pic)
-{
+{
+    glWidget->makeCurrent();
 	glWidget->setImage(pic);
-	glWidget->repaint();
+	glWidget->repaint();
+    glWidget->doneCurrent();
 	return true;
 }
 /**



From mean at mail.berlios.de  Wed Sep  7 18:34:27 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 18:34:27 +0200
Subject: [Avidemux-svn-commit] r7479 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20110907163427.1DB66481248@sheep.berlios.de>

Author: mean
Date: 2011-09-07 18:34:26 +0200 (Wed, 07 Sep 2011)
New Revision: 7479

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
Log:
[TS] Beging writing brute force stream indexing, in case there is not PAT/PMT (TRP files)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-07 16:34:26 UTC (rev 7479)
@@ -0,0 +1,153 @@
+/** *************************************************************************
+    \file ADM_tsPatPmt.cpp
+    \brief Analyze pat & pmt
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+    
+      
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "ADM_ts.h"
+#include "ADM_demuxerInternal.h"
+#include "ADM_tsPatPmt.h"
+
+#include "ADM_a52info.h"
+#include "ADM_mp3info.h"
+
+
+#define TS_MAX_PACKET_SCAN 500
+#define MAX_PID (1<<17)
+#define MAX_BUFFER_SIZE (10*1024)
+
+static bool idContent(int pid,tsPacket *ts);
+
+/**
+    \fn scanForPrograms
+    \brief Lookup PAT & PMT to get tracks
+*/
+bool TS_guessContent(const char *file,uint32_t *nbTracks, ADM_TS_TRACK **outTracks)
+{
+    ADM_info("[TS demuxer] Brute force reading...\n");
+    bool result=false;
+    ADM_TS_TRACK *tracks=NULL;
+    *outTracks=NULL;
+    *nbTracks=0;
+    uint32_t nb=0;
+
+    tsPacket *ts=new tsPacket();
+    ts->open(file,FP_PROBE);
+
+    int packetRead=0;
+    int *map=new int[MAX_PID];
+    memset(map,0,MAX_PID*sizeof(int));
+    uint8_t *buffer=new uint8_t[MAX_BUFFER_SIZE];
+    int pid;
+    uint32_t packetSize;
+    uint64_t pts,dts,at;
+    while(packetRead++<TS_MAX_PACKET_SCAN)
+    {
+            if(false==ts->getNextPid(&pid))
+            {
+                    printf("Read %d packets\n",packetRead);
+                    break;
+            }
+            if(pid<MAX_PID)
+            {
+                map[pid]++;
+            }
+    }
+    // Keep only seen packet with more than 5 packets and >16
+    std::vector <int>listOfPid;    
+    for(int i=17;i<MAX_PID;i++)
+    {
+        if(map[i]>5) listOfPid.push_back(i);
+    }
+    delete [] map;
+    map=NULL;
+    
+    for(int i=0;i<listOfPid.size();i++)
+    {
+        printf("Found stuff in pid=%d\n",listOfPid[i]);
+        //  Read PES
+        idContent(listOfPid[i],ts);
+        // Try to id the packet...
+        
+    }
+    ts->close();
+    delete ts;
+    ts=NULL;
+    delete [] buffer;
+    buffer=NULL;
+    return result;
+}
+/**
+    \fn idContent
+*/
+bool idContent(int pid,tsPacket *ts)
+{
+TS_PESpacket pes(pid);
+TS_PESpacket pes2(pid);
+        if(false==ts->getNextPES( &pes)) 
+        {
+            ADM_warning("\tCannot get PES\n");
+            return false;
+        }
+        if(false==ts->getNextPES( &pes2)) 
+        {
+            ADM_warning("\tCannot get PES2\n");
+            return false;
+        }
+
+        printf("\t Read %d bytes\n",(int)pes.payloadSize);
+        // 
+        uint32_t fq,br,chan,syncoff;
+        uint32_t fq2,br2,chan2,syncoff2;
+        uint8_t *ptr=pes.payload;
+        uint32_t len=pes.payloadSize;
+        uint8_t *ptr2=pes2.payload;
+        uint32_t len2=pes2.payloadSize;
+
+        // Is it AC3 ??
+        if( ADM_AC3GetInfo(ptr,len, &fq, &br, &chan,&syncoff))
+        {
+                ADM_info("Maybe AC3... \n");
+                // Try on 2nd packet...
+                if( ADM_AC3GetInfo(ptr2,len2, &fq2, &br2, &chan2,&syncoff2))
+                {
+                    if((fq==fq2) && (br2==br) && (chan==chan2))
+                    {
+                        ADM_warning("\tProbably AC3 : Fq=%d br=%d chan=%d\n",(int)fq,(int)br,(int)chan);
+                        return true;
+                    }
+                }
+
+        }
+        MpegAudioInfo minfo,minfo2;
+        if( getMpegFrameInfo(ptr,len,&minfo,NULL,&syncoff))
+        {
+                    ADM_info("Maybe MP2... \n");
+                    if( getMpegFrameInfo(ptr2,len2,&minfo2,&minfo,&syncoff))
+                    {
+                        ADM_warning("\tProbably MP2 : Fq=%d br=%d chan=%d\n", (int)minfo.samplerate,
+                                                                    (int)minfo.bitrate,
+                                                                    (int)minfo.mode);
+                        return true;
+                    }
+        }
+        
+        
+    ADM_info("\t Unrecognized.\n");
+    return false;
+}
+        
+
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2011-09-07 08:03:08 UTC (rev 7478)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2011-09-07 16:34:26 UTC (rev 7479)
@@ -51,8 +51,12 @@
 
     if(TS_scanForPrograms(file,&nbTracks,&tracks)==false) 
     {
-        printf("[Ts Indexer] Scan of pmt failed\n");
-        return false;
+            printf("[Ts Indexer] Scan of pmt failed\n");
+            if(TS_guessContent(file,&nbTracks,&tracks)==false) 
+            {
+                printf("[Ts Indexer] Brute force scan failed\n");
+                return false;
+            }
     }
     ADM_assert(tracks);
     ADM_assert(nbTracks);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.h	2011-09-07 08:03:08 UTC (rev 7478)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.h	2011-09-07 16:34:26 UTC (rev 7479)
@@ -79,6 +79,15 @@
 */
 
 bool TS_scanForPrograms(const char *file,uint32_t *nbTracks, ADM_TS_TRACK **tracks);
+/**
+    \fn TS_guessContent
+    \brief Analyze a stream and returns tracks within, guess what tracks actually are..
+    @param in:file File to open
+    @param out:nbTracks Number of tracks found
+    @param out:tracks, to be freed by delete [] by the caller
+*/
 
+bool TS_guessContent(const char *file,uint32_t *nbTracks, ADM_TS_TRACK **tracks);
+
 #endif
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2011-09-07 08:03:08 UTC (rev 7478)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2011-09-07 16:34:26 UTC (rev 7479)
@@ -13,6 +13,7 @@
         ADM_tsComputeTimeStamp.cpp
         dmxTSPacket.cpp
         ADM_tsPatPmt.cpp
+        ADM_tsBruteForce.cpp
         ADM_tsGetBits.cpp
 )
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2011-09-07 08:03:08 UTC (rev 7478)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2011-09-07 16:34:26 UTC (rev 7479)
@@ -537,9 +537,47 @@
 */      
 bool        tsPacket::getPacket(uint32_t maxSize, uint8_t *pid, uint32_t *packetSize,uint64_t *opts,uint64_t *odts,uint8_t *buffer,uint64_t *startAt)
 {
+    return true;
+}
+/** 
+    \fn getNextPid
+*/  
+bool        tsPacket::getNextPid(int *pid)
+{
+ uint8_t scratch[188+4];
+    int count=0;
+nextPackx:
 
-        return false;
-       
+    if(false==getSinglePacket(scratch)) return false;
+    uint32_t id=scratch[1]+((scratch[0]&0x1F)<<8);
+    count++;
+    if(count>MAX_SKIPPED_PACKET) return false;
+    *pid=id;
+    
+    int payloadUnitStart=scratch[0]&0x40;
+    int fieldControl=(scratch[2]>>4)&3;
+    int continuity=(scratch[2]&0xf);
+    int len=TS_PACKET_LEN-4; // useful datas
+
+    if(!(fieldControl & 1)) 
+    {
+        goto nextPackx;
+    }
+    uint8_t *start,*end;
+    start=scratch+3;
+    end=scratch+TS_PACKET_LEN-1;
+
+    if((fieldControl & 2)) // Adaptation layer
+    {
+        int payloadSize=*start++;
+        start+=payloadSize;
+    }
+    int size=(int)(end-start);
+    if(size<=0)  
+    {
+        goto nextPackx;
+    }
+    return true;
 }
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2011-09-07 08:03:08 UTC (rev 7478)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2011-09-07 16:34:26 UTC (rev 7479)
@@ -121,6 +121,7 @@
     virtual bool        open(const char *filenames,FP_TYPE append);
     virtual bool        close(void);
     virtual bool        getPacket(uint32_t maxSize, uint8_t *pid, uint32_t *packetSize,uint64_t *pts,uint64_t *dts,uint8_t *buffer,uint64_t *startAt);
+            bool        getNextPid(int *pid);
     virtual uint64_t    getPos(void);
     virtual bool        setPos(uint64_t pos);
 protected:



From mean at mail.berlios.de  Wed Sep  7 18:34:28 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  7 Sep 2011 18:34:28 +0200
Subject: [Avidemux-svn-commit] r7480 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20110907163428.6AAA1481248@sheep.berlios.de>

Author: mean
Date: 2011-09-07 18:34:28 +0200 (Wed, 07 Sep 2011)
New Revision: 7480

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
Log:
[TS/Demux] Slightly better brute force demuxing, still crappy

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-07 16:34:26 UTC (rev 7479)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-07 16:34:28 UTC (rev 7480)
@@ -23,12 +23,13 @@
 #include "ADM_a52info.h"
 #include "ADM_mp3info.h"
 
+#include "ADM_coreUtils.h"
 
 #define TS_MAX_PACKET_SCAN 500
 #define MAX_PID (1<<17)
 #define MAX_BUFFER_SIZE (10*1024)
 
-static bool idContent(int pid,tsPacket *ts);
+static bool idContent(int pid,tsPacket *ts,ADM_TS_TRACK_TYPE & trackType);
 
 /**
     \fn scanForPrograms
@@ -43,6 +44,7 @@
     *nbTracks=0;
     uint32_t nb=0;
 
+
     tsPacket *ts=new tsPacket();
     ts->open(file,FP_PROBE);
 
@@ -73,14 +75,32 @@
     }
     delete [] map;
     map=NULL;
-    
-    for(int i=0;i<listOfPid.size();i++)
+    if(listOfPid.size())
     {
-        printf("Found stuff in pid=%d\n",listOfPid[i]);
-        //  Read PES
-        idContent(listOfPid[i],ts);
-        // Try to id the packet...
-        
+        tracks=new ADM_TS_TRACK[listOfPid.size()];
+        memset(tracks,0,sizeof(ADM_TS_TRACK)*listOfPid.size());
+        int validTracks=0;
+        ADM_TS_TRACK_TYPE trackType;
+        for(int i=0;i<listOfPid.size();i++)
+        {
+            printf("Found stuff in pid=%d\n",listOfPid[i]);
+            //  Read PES
+            if(true==idContent(listOfPid[i],ts,trackType))
+            {
+                tracks[validTracks].trackPid=listOfPid[i];
+                tracks[validTracks].trackType=trackType;
+                validTracks++;
+            }        
+        }
+        if(!validTracks)
+        {
+            delete [] tracks;
+        }else
+        {
+            *outTracks=tracks;
+            *nbTracks=validTracks;
+            result=true;
+        }
     }
     ts->close();
     delete ts;
@@ -92,7 +112,7 @@
 /**
     \fn idContent
 */
-bool idContent(int pid,tsPacket *ts)
+bool idContent(int pid,tsPacket *ts,ADM_TS_TRACK_TYPE & trackType)
 {
 TS_PESpacket pes(pid);
 TS_PESpacket pes2(pid);
@@ -106,7 +126,7 @@
             ADM_warning("\tCannot get PES2\n");
             return false;
         }
-
+        
         printf("\t Read %d bytes\n",(int)pes.payloadSize);
         // 
         uint32_t fq,br,chan,syncoff;
@@ -116,6 +136,27 @@
         uint8_t *ptr2=pes2.payload;
         uint32_t len2=pes2.payloadSize;
 
+        if(!ptr[0] && !ptr[1] && ptr[2]==1 && ptr[3]==0xe0) // probably video
+        {
+            // Only supports Mpeg2 video and H264
+            // For mpeg2 we scan for slice i.e. 00 00 01 00 etc...
+            // we need 2 consecutive slice
+            uint8_t scode,scode2;
+            if(ADM_findMpegStartCode(ptr+4,ptr+len,&scode,&syncoff))
+            {
+                ADM_warning("Found startcode1 =%x\n",scode);
+            }
+            if(ADM_findMpegStartCode(ptr2+4,ptr2+len2,&scode2,&syncoff))
+            {
+                ADM_warning("Found startcode1 =%x\n",scode2);
+            }
+            if(scode==9 && scode2==9) // AU delimiter
+            {
+                trackType=ADM_TS_H264;
+                return true;
+            }
+            return false;
+        }
         // Is it AC3 ??
         if( ADM_AC3GetInfo(ptr,len, &fq, &br, &chan,&syncoff))
         {
@@ -126,26 +167,29 @@
                     if((fq==fq2) && (br2==br) && (chan==chan2))
                     {
                         ADM_warning("\tProbably AC3 : Fq=%d br=%d chan=%d\n",(int)fq,(int)br,(int)chan);
+                        trackType=ADM_TS_AC3;
                         return true;
                     }
                 }
 
         }
+        // We easily have false positive with mp2...
         MpegAudioInfo minfo,minfo2;
         if( getMpegFrameInfo(ptr,len,&minfo,NULL,&syncoff))
         {
-                    ADM_info("Maybe MP2... \n");
-                    if( getMpegFrameInfo(ptr2,len2,&minfo2,&minfo,&syncoff))
+                    if(minfo.bitrate>=128)
                     {
-                        ADM_warning("\tProbably MP2 : Fq=%d br=%d chan=%d\n", (int)minfo.samplerate,
-                                                                    (int)minfo.bitrate,
-                                                                    (int)minfo.mode);
-                        return true;
+                        ADM_info("Maybe MP2... \n");
+                        if( getMpegFrameInfo(ptr2,len2,&minfo2,&minfo,&syncoff))
+                        {
+                            ADM_warning("\tProbably MP2 : Fq=%d br=%d chan=%d\n", (int)minfo.samplerate,
+                                                                        (int)minfo.bitrate,
+                                                                        (int)minfo.mode);
+                            trackType=ADM_TS_MPEG_AUDIO;
+                            return true;
+                        }
                     }
         }
-        
-        
-    ADM_info("\t Unrecognized.\n");
     return false;
 }
         



From mean at mail.berlios.de  Thu Sep  8 09:53:13 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 09:53:13 +0200
Subject: [Avidemux-svn-commit] r7481 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: . ADM_render
Message-ID: <20110908075314.3A9D7481248@sheep.berlios.de>

Author: mean
Date: 2011-09-08 09:53:13 +0200 (Thu, 08 Sep 2011)
New Revision: 7481

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
Log:
[preview] Dont display full size then zoom out, do both at the same time (faster+avoid pops)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-07 16:34:28 UTC (rev 7480)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-08 07:53:13 UTC (rev 7481)
@@ -42,7 +42,7 @@
 #include "ADM_imageResizer.h"
 #include "DIA_coreToolkit.h"
 
-
+extern uint8_t              UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
 static void                 previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);
 static ADM_PREVIEW_MODE     previewMode=ADM_PREVIEW_NONE;
 
@@ -83,13 +83,34 @@
       @param h : height
 */
 
-void admPreview::setMainDimension(uint32_t w, uint32_t h)
+void admPreview::setMainDimension(uint32_t w, uint32_t h,renderZoom nzoom)
 {
   
   if(rdrImage) delete rdrImage;
   rdrImage=new ADMImageDefault(w,h);
   rdrPhysicalW=w;
   rdrPhysicalH=h;
+  if(nzoom==ZOOM_AUTO)
+  {
+      uint32_t phyW,phyH;
+      UI_getPhysicalScreenSize(NULL, &phyW,&phyH);
+      if(3*phyW<4*w || 3*phyH<4*h)
+      {
+          if(phyW<w/2 || phyH<h/2)
+          {
+                    nzoom=ZOOM_1_4;
+          }else
+          {
+                    nzoom=ZOOM_1_2;
+          }
+         
+      }
+      else
+      {
+          nzoom=ZOOM_1_1;
+      }
+  }
+  zoom=nzoom;
   renderDisplayResize(rdrPhysicalW,rdrPhysicalH,zoom);
  // Install our hook, we will do it more than needed
  // but it does not really harm
@@ -159,7 +180,7 @@
 
 void 	admPreview::start( void )
 {
-            ADM_info("admPreview, killing\n");
+            ADM_info("admPreview,starting\n");
 }
 /**
       \fn admPreview::stop

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2011-09-07 16:34:28 UTC (rev 7480)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2011-09-08 07:53:13 UTC (rev 7481)
@@ -33,7 +33,7 @@
       static bool seekToIntraPts(uint64_t timeframe);
       static void start(void);
       static void stop(void);
-      static void setMainDimension(uint32_t, uint32_t );
+      static void setMainDimension(uint32_t, uint32_t ,renderZoom);
       static void deferDisplay(bool onoff);
       static void displayNow(void);
       static void cleanUp(void);  

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2011-09-07 16:34:28 UTC (rev 7480)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2011-09-08 07:53:13 UTC (rev 7481)
@@ -30,6 +30,7 @@
         ZOOM_1_1,
         ZOOM_2,
         ZOOM_4,
+        ZOOM_AUTO,
         ZOOM_INVALID
 }renderZoom;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-09-07 16:34:28 UTC (rev 7480)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-09-08 07:53:13 UTC (rev 7481)
@@ -51,7 +51,7 @@
 //******** GUI Function**************
 //***********************************
 
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+
 extern uint8_t GUI_jobs(void);
 extern const char * GUI_getCustomJsScript(uint32_t nb);
 extern const char * GUI_getCustomPyScript(uint32_t nb);
@@ -600,39 +600,14 @@
     }
 
   // Init renderer
-    admPreview::setMainDimension(avifileinfo->width, avifileinfo->height);
-
-
+    admPreview::setMainDimension(avifileinfo->width, avifileinfo->height,ZOOM_AUTO);
   // Draw first frame
-  GUI_setAllFrameAndTime();
-  A_ResetMarkers();
-//  getFirstVideoFilter(); // Rebuild filter if needed
+    GUI_setAllFrameAndTime();
+    A_ResetMarkers();
+    A_Rewind();
+    ADM_info(" conf updated \n");
+    UI_setDecoderName(video_body->getVideoDecoderName());
 
-  /* Zoom out if needed */
-  uint32_t phyW,phyH;
-  UI_getPhysicalScreenSize(NULL, &phyW,&phyH);
-  if(3*phyW<4*avifileinfo->width || 3*phyH<4*avifileinfo->height)
-  {
-      if(phyW<avifileinfo->width/2 || phyH<avifileinfo->height/2)
-      {
-                currentZoom=ZOOM_1_4;
-      }else
-      {
-                currentZoom=ZOOM_1_2;
-      }
-     changePreviewZoom(currentZoom);
-  }
-  else
-  {
-      currentZoom=ZOOM_1_1;
-      changePreviewZoom(currentZoom);
-  }
-
-
-   A_Rewind();
-   ADM_info(" conf updated \n");
-   UI_setDecoderName(video_body->getVideoDecoderName());
-
 }
 
 //___________________________________________
@@ -997,7 +972,7 @@
   if (avifileinfo)		// already opened ?
     {				// delete everything
       // if preview is on
-      admPreview::setMainDimension(0, 0);
+      admPreview::setMainDimension(0, 0,ZOOM_1_1);
       if(getPreviewMode()!=ADM_PREVIEW_NONE)
       {
         admPreview::stop();
@@ -1174,8 +1149,11 @@
 */
 void A_Rewind(void)
 {
+               admPreview::stop();
                video_body->rewind();
+               admPreview::start();
                admPreview::samePicture();
+               admPreview::samePicture();
                GUI_setCurrentFrameAndTime();
 }
 void brokenAct(void)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-07 16:34:28 UTC (rev 7480)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-08 07:53:13 UTC (rev 7481)
@@ -145,7 +145,7 @@
    // Resize the output window to original size...
    ADM_info("Restoring display.\n");
    
-   admPreview::setMainDimension(info.width,info.height);
+   admPreview::setMainDimension(info.width,info.height,ZOOM_AUTO);
    admPreview::seekToTime(oldTimeFrame);
    UI_purge();
    
@@ -215,7 +215,7 @@
     int nb=videoChain->size();
     videoFilter=(*videoChain)[nb-1];
     FilterInfo *info=videoFilter->getInfo();
-    admPreview::setMainDimension(info->width,info->height);
+    admPreview::setMainDimension(info->width,info->height,ZOOM_AUTO);
 
     initializeAudio();
     return true;



From mean at mail.berlios.de  Thu Sep  8 19:50:03 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 19:50:03 +0200
Subject: [Avidemux-svn-commit] r7482 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_audioFilter/src
	avidemux/common/ADM_audiocodec avidemux/common/ADM_editor
	avidemux/common/ADM_videoCodec/src
	avidemux/common/ADM_videoEncoder/src
	avidemux/common/ADM_videoFilter2/src
	avidemux_core/ADM_core/include avidemux_core/ADM_core/src
	avidemux_core/ADM_coreAudioDevice/src
	avidemux_core/ADM_coreAudioParser/src
	avidemux_core/ADM_coreDemuxer/src avidemux_core/ADM_coreMuxer/src
	avidemux_core/ADM_coreTinyPy/src
	avidemux_core/ADM_coreVideoEncoder/src
Message-ID: <20110908175003.636D948125C@sheep.berlios.de>

Author: mean
Date: 2011-09-08 19:50:02 +0200 (Thu, 08 Sep 2011)
New Revision: 7482

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp
Log:
[all] Fix some memleaks

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -167,6 +167,7 @@
                 ListOfAudioEncoder[i]=b;
              }
         }
+        clearDirectoryContent(nbFile,files);
 	return 1;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -150,7 +150,7 @@
 		tryLoadingAudioPlugin(files[i]);
 
 	printf("[ADM_ad_plugin] Scanning done, found %d codec\n", (int)ADM_audioPlugins.size());
-
+        clearDirectoryContent(nbFile,files);
 	return 1;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -105,8 +105,14 @@
 	_segments.deleteAll();
     if(_pp) delete _pp;
     _pp=NULL;
-    if(_imageBuffer) delete  _imageBuffer;
-    _imageBuffer=NULL;
+    if(_imageBuffer) 
+    {
+        if(_imageBuffer->quant)
+            delete [] _imageBuffer->quant;
+        _imageBuffer->quant=NULL;
+        delete  _imageBuffer;
+        _imageBuffer=NULL;
+    }
 
 }
 /**
@@ -232,7 +238,14 @@
         _pp->forcedQuant=0;
         _pp->update();
 
-        if(_imageBuffer) delete _imageBuffer;
+        if(_imageBuffer) 
+        {
+            if(_imageBuffer->quant)
+                delete [] _imageBuffer->quant;
+            _imageBuffer->quant=NULL;
+            delete _imageBuffer;
+            _imageBuffer=NULL;
+        }
         _imageBuffer=new ADMImageDefault(info.width,info.height);
         _imageBuffer->_qSize= ((info.width+15)>>4)*((info.height+15)>>4);
         _imageBuffer->quant=new uint8_t[_imageBuffer->_qSize];

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -120,6 +120,7 @@
 		tryLoadingEncoderPlugin(files[i]);
     
 	printf("[ADM_vd6_plugin] Scanning done\n");
+        clearDirectoryContent(nbFile,files);
 
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -160,6 +160,7 @@
                 ListOfEncoders[i]=b;
              }
         }
+        clearDirectoryContent(nbFile,files);
 
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -205,7 +205,7 @@
 		tryLoadingVideoFilterPlugin(files[i]);
 
 	printf("[ADM_vf_plugin] Scanning done, found %d video filer(s)\n", (int)ADM_vf_getNbFilters());
-
+    clearDirectoryContent(nbFile,files);
 	return 1;
 }
 /**
@@ -220,6 +220,11 @@
         for(int i=0;i<nb;i++)
         {
             ADM_vf_plugin *a=ADM_videoFilterPluginsList[cat][i];
+            if(a->nameOfLibrary)
+            {
+                ADM_dealloc(a->nameOfLibrary);
+                a->nameOfLibrary=NULL;
+            }
             delete a;
             ADM_videoFilterPluginsList[cat][i]=NULL;
         }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h	2011-09-08 17:50:02 UTC (rev 7482)
@@ -37,5 +37,5 @@
 char *ADM_getHomeRelativePath(const char *base1, const char *base2=NULL,const char *base3=NULL);
 #endif
 uint8_t buildDirectoryContent(uint32_t *outnb,const char *base, char *jobName[],int maxElems,const char *ext);
-
+uint8_t clearDirectoryContent(const uint32_t nb, char *jobName[]);
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -574,6 +574,19 @@
 
 	return 1;
 }
+/**
+    \fn clearDirectoryContent
+*/
+uint8_t    clearDirectoryContent(const uint32_t nb, char *jobName[])
+{
+    for(int i=0;i<nb;i++)
+        if(jobName[i])
+        {
+            ADM_dealloc(jobName[i]);
+            jobName[i]=NULL;
+        }
+    return true;
+}
 //------------------------------------------------------------------
 
 /*

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -121,6 +121,7 @@
 		tryLoadingFilterPlugin(files[i]);
 
 	printf("[ADM_av_plugin] Scanning done\n");
+        clearDirectoryContent(nbFile,files);
 
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -137,6 +137,7 @@
     }
     if(codec)
     {
+        avcodec_close(CONTEXT);
         av_free(CONTEXT);
         codec=NULL;
     }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -103,6 +103,7 @@
     for(int i=0;i<nb;i++)
         ADM_info("Demuxer plugin : %s, priority :%d\n",ListOfDemuxers[i]->name,(int)ListOfDemuxers[i]->priority);
     printf("[ADM_dm_plugin] Scanning done, %d demuxers found\n",(int)nb);
+        clearDirectoryContent(nbFile,files);
 	return 1;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -131,6 +131,7 @@
                 ListOfMuxers[i]=b;
              }
         }
+        clearDirectoryContent(nbFile,files);
 	return 1;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -248,11 +248,7 @@
         _tp_list_append(tp,list.list.val,tp_string_copy(tp,tem,strlen(tem)));
     }
     // free the list
-    for(int i=0;i<nb;i++)
-    {
-        ADM_dealloc(items[i]);
-        items[i]=NULL;
-    }
+    clearDirectoryContent(nb,items);
     return list;
 
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp	2011-09-08 07:53:13 UTC (rev 7481)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp	2011-09-08 17:50:02 UTC (rev 7482)
@@ -204,8 +204,7 @@
             ADM_copyFile(list[i],s.c_str());
         }
     }
-    for(int i=0;i<nb;i++)
-        ADM_dealloc(list[i]);
+    clearDirectoryContent(nb,list);
     return true;
 }
 /**
@@ -234,8 +233,7 @@
         // Remove extension
         listOut.push_back(s);
     }
-    for(int i=0;i<nb;i++)
-        ADM_dealloc(list[i]);
+    clearDirectoryContent(nb,list);
     return true;
 }
 



From mean at mail.berlios.de  Thu Sep  8 19:50:04 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 19:50:04 +0200
Subject: [Avidemux-svn-commit] r7483 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml
Message-ID: <20110908175004.92D1A48125C@sheep.berlios.de>

Author: mean
Date: 2011-09-08 19:50:04 +0200 (Thu, 08 Sep 2011)
New Revision: 7483

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp
Log:
[openDml/demux] cosmetic

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp	2011-09-08 17:50:02 UTC (rev 7482)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp	2011-09-08 17:50:04 UTC (rev 7483)
@@ -141,6 +141,9 @@
 	close();
 
 }
+/**
+    \fn close
+*/
 uint8_t    OpenDMLHeader::close( void )
 {
 	if(_fd)



From mean at mail.berlios.de  Thu Sep  8 19:50:06 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 19:50:06 +0200
Subject: [Avidemux-svn-commit] r7484 - in
	branches/avidemux_2.6_branch_mean/avidemux: cli
	common/ADM_render gtk qt4
Message-ID: <20110908175006.292C248125C@sheep.berlios.de>

Author: mean
Date: 2011-09-08 19:50:05 +0200 (Thu, 08 Sep 2011)
New Revision: 7484

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[build] Link xv at render level, else does not work with oneiric

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-08 17:50:04 UTC (rev 7483)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-08 17:50:05 UTC (rev 7484)
@@ -79,10 +79,6 @@
 	TARGET_LINK_LIBRARIES(avidemux3_cli ${GETTEXT_LIBRARY_DIR})
 ENDIF (GETTEXT_FOUND)
 
-# XVideo
-IF (USE_XV)
-        TARGET_LINK_LIBRARIES(avidemux3_cli ${XVIDEO_LIBRARY_DIR})
-ENDIF (USE_XV)
 
 # SDL
 IF (USE_SDL)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2011-09-08 17:50:04 UTC (rev 7483)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2011-09-08 17:50:05 UTC (rev 7484)
@@ -39,4 +39,7 @@
        TARGET_LINK_LIBRARIES(${ADM_LIB}  ADM_coreVDPAU6)
 ENDIF (USE_VDPAU)
 
+IF (USE_XV)
+	TARGET_LINK_LIBRARIES(${ADM_LIB} ${XVIDEO_LIBRARY_DIR})
+ENDIF (USE_XV)
 ADM_INSTALL_LIB(${ADM_LIB})

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-08 17:50:04 UTC (rev 7483)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-08 17:50:05 UTC (rev 7484)
@@ -86,10 +86,6 @@
 	TARGET_LINK_LIBRARIES(avidemux3_gtk ${GETTEXT_LIBRARY_DIR})
 ENDIF (GETTEXT_FOUND)
 
-# XVideo
-IF (USE_XV)
-        TARGET_LINK_LIBRARIES(avidemux3_gtk ${XVIDEO_LIBRARY_DIR})
-ENDIF (USE_XV)
 
 # SDL
 IF (USE_SDL)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-08 17:50:04 UTC (rev 7483)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-08 17:50:05 UTC (rev 7484)
@@ -114,10 +114,6 @@
 	TARGET_LINK_LIBRARIES(avidemux3_qt4 ${GETTEXT_LIBRARY_DIR})
 ENDIF (GETTEXT_FOUND)
 
-# XVideo
-IF (USE_XV)
-	TARGET_LINK_LIBRARIES(avidemux3_qt4 ${XVIDEO_LIBRARY_DIR})
-ENDIF (USE_XV)
 
 # SDL
 IF (USE_SDL)
@@ -177,3 +173,4 @@
 #
 include(admPackager)
 admPackager(qt4Package)
+include(admConfigSummary)



From mean at mail.berlios.de  Thu Sep  8 19:50:07 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 19:50:07 +0200
Subject: [Avidemux-svn-commit] r7485 - in
	branches/avidemux_2.6_branch_mean/avidemux: common/ADM_editor
	common/ADM_osSupport qt4/ADM_userInterfaces/ADM_dialog
	qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110908175007.D58E348125C@sheep.berlios.de>

Author: mean
Date: 2011-09-08 19:50:07 +0200 (Thu, 08 Sep 2011)
New Revision: 7485

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPacket.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp
Log:
[editor] Replace pointer by vector for audioTrack + dont erase vptr in ctor (duh!)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPacket.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPacket.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -281,7 +281,7 @@
 ADM_audioStreamTrack *ADM_Composer::getTrack(uint32_t refVideo)
 {
     _VIDEOS *v=_segments.getRefVideo(refVideo);
-    if(!v->audioTracks) return NULL;
+    if(!v->audioTracks.size()) return NULL;
 
     return v->audioTracks[v->currentAudioStream];
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -266,8 +266,6 @@
   if (!nbAStream)
     {
       printf ("[Editor] *** NO AUDIO ***\n");
-      video.audioTracks = NULL;
-      video.nbAudioStream=0;
       video.currentAudioStream=0;
     }
   else
@@ -281,8 +279,7 @@
 
       _VIDEOS *thisVid=&(video);
       // Create streams
-      thisVid->audioTracks=new ADM_audioStreamTrack*[nbAStream];
-      thisVid->nbAudioStream=nbAStream;
+      
       for(int i=0;i<nbAStream;i++)
       {
             ADM_audioStreamTrack *track=new ADM_audioStreamTrack;
@@ -307,7 +304,7 @@
             stream->getExtraData(&extraLen,&extraData);
             track->codec=getAudioCodec(header->encoding,header,extraLen,extraData);
 
-            thisVid->audioTracks[i]=track;
+            thisVid->audioTracks.push_back(track);
 
       }
     }
@@ -466,17 +463,17 @@
 
     _VIDEOS *v=_segments.getRefVideo(ref);
     ADM_assert(v);
-
-    if(!v->nbAudioStream)
+    int nb=v->audioTracks.size();
+    if(!nb)
     {
         *nbStreams=0;
         *infos=NULL;
         return true;
     }
 
-    *nbStreams=v->nbAudioStream;
-    *infos=new audioInfo[*nbStreams];
-    for(int i=0;i<*nbStreams;i++)
+    *nbStreams=nb;
+    *infos=new audioInfo[nb];
+    for(int i=0;i<nb;i++)
     {
         WAVHeader *wav=&(v->audioTracks[i]->wavheader);
         audioInfo *t=(*infos)+i;
@@ -524,8 +521,7 @@
         }
         _VIDEOS *v=_segments.getRefVideo(ref);
         ADM_assert(v);
-        ADM_audioStreamTrack **trks=v->audioTracks;
-        uint32_t nb=v->nbAudioStream;
+        uint32_t nb=v->audioTracks.size();
         if(newstream>=nb)
         {
             ADM_warning("[Editor::changeAudioStream] New stream exceeds # of stream (%d/%d)\n",(int)newstream,(int)nb);
@@ -533,8 +529,8 @@
         }
         v->currentAudioStream=newstream;
         // Change our header also
-        wavHeader.frequency=trks[newstream]->wavheader.frequency;
-        wavHeader.channels=trks[newstream]->wavheader.channels;
+        wavHeader.frequency=v->audioTracks[newstream]->wavheader.frequency;
+        wavHeader.channels=v->audioTracks[newstream]->wavheader.channels;
         //ADM_warning("New fq=%d\n",(int)wavHeader.frequency);
         return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -14,6 +14,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "ADM_cpp.h"
 #include "ADM_default.h"
 #include "ADM_segment.h"
 #include "ADM_codec.h"
@@ -176,19 +177,22 @@
       v->_aviheader=NULL;
      // Delete audio codec too
      // audioStream will be deleted by the demuxer
-      if(v->audioTracks)
-      {
-            for(int i=0;i<v->nbAudioStream;i++)
+      
+      
+            int nb=v->audioTracks.size();
+            for(int i=0;i<nb;i++)
             {
-#if 0 // Deleted elsewhere ?
-                if(v->audioTracks[i])
-                    delete v->audioTracks[i];
+
+                ADM_audioStreamTrack *t=v->audioTracks[i];
+                v->audioTracks[i]=NULL;
+#if 1 // Deleted elsewhere ?
+                if(t)
+                    delete t;
 #endif
-                v->audioTracks[i]=NULL;
             }
-            delete [] v->audioTracks;
-            v->audioTracks=NULL;
-      }
+            v->audioTracks.clear();
+            
+      
     }
 
     videos.clear();

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-08 17:50:07 UTC (rev 7485)
@@ -39,8 +39,15 @@
     uint64_t         size;
 
 public:
-    ADM_audioStreamTrack() {memset(this,0,sizeof(*this));}
-virtual    ~ADM_audioStreamTrack();
+    ADM_audioStreamTrack() {
+                stream=NULL;
+                info=NULL;
+                codec=NULL;
+                duration=size=0;
+                vbr=false;
+                memset(&wavheader,0,sizeof(wavheader));
+        }
+    ~ADM_audioStreamTrack();
 };
 /**
     \struct _VIDEOS
@@ -53,10 +60,9 @@
       ADMColorScalerSimple *color; /// Color conversion if needed
 
       /* Audio part */
-
-      uint32_t nbAudioStream;
       uint32_t currentAudioStream;
-      ADM_audioStreamTrack **audioTracks;
+      vector <ADM_audioStreamTrack *>  audioTracks;
+      
 
       uint32_t _nb_video_frames; /// Really needed ?
       EditorCache *_videoCache; /// Decoded video cache

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -15,7 +15,8 @@
  ***************************************************************************/
 
 
-#include <string>
+#include <string>
+#include "ADM_cpp.h"
 #include "ADM_default.h"
 #include "DIA_coreToolkit.h"
 #include "ADM_editor/ADM_edit.hxx"

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -11,7 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "ADM_cpp.h"
 #include <math.h>
 
 #include "Q_props.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -11,7 +11,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "ADM_cpp.h"
 #include "config.h"
 
 #include "ADM_inttype.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp	2011-09-08 17:50:05 UTC (rev 7484)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp	2011-09-08 17:50:07 UTC (rev 7485)
@@ -12,6 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "ADM_cpp.h"
 #include "config.h"
 #include "ADM_inttype.h"
 #include <string>



From mean at mail.berlios.de  Thu Sep  8 19:50:09 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  8 Sep 2011 19:50:09 +0200
Subject: [Avidemux-svn-commit] r7486 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux/common/ADM_audioFilter/src
	avidemux/common/ADM_audiocodec avidemux/common/ADM_editor
	avidemux/common/ADM_videoEncoder/src
	avidemux_core/ADM_coreAudioDevice/src
Message-ID: <20110908175009.91FD548125C@sheep.berlios.de>

Author: mean
Date: 2011-09-08 19:50:09 +0200 (Thu, 08 Sep 2011)
New Revision: 7486

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
Log:
[all] More memleak

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -181,6 +181,7 @@
         delete a;
         ListOfAudioEncoder[i]=NULL;
 	}
+    
     ListOfAudioEncoder.clear();
     return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_pluginLoad.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -192,6 +192,7 @@
     for(int i=0;i<ADM_audioPlugins.size();i++)
     {
         ADM_ad_plugin *a=ADM_audioPlugins[i];
+        ADM_dealloc(a->name );
         delete a;
         ADM_audioPlugins[i]=NULL;
     }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -113,6 +113,9 @@
         delete  _imageBuffer;
         _imageBuffer=NULL;
     }
+    if(_scratch)
+        delete  _scratch;
+    _scratch=NULL;
 
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -176,6 +176,7 @@
                         if(ListOfEncoders[i]) delete ListOfEncoders[i];
                         ListOfEncoders[i]=NULL;
                 }
+        ListOfEncoders.clear();
 }
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -89,6 +89,7 @@
 extern bool ADM_mx_cleanup(void);
 extern bool ADM_vf_cleanup(void);
 extern bool ADM_dm_cleanup(void);
+extern void ADM_ve6_cleanup(void);
 extern bool ADM_vf_clearFilters(void);
 
 extern bool vdpauProbe(void);
@@ -392,6 +393,7 @@
     ADM_vf_clearFilters();
     ADM_vf_cleanup();
     ADM_dm_cleanup();
+    ADM_ve6_cleanup();
 #if defined( USE_VDPAU) 
   #if (ADM_UI_TYPE_BUILD!=ADM_UI_CLI)
     printf("cleaning VDPAU...\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-08 17:50:07 UTC (rev 7485)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-08 17:50:09 UTC (rev 7486)
@@ -199,6 +199,10 @@
 */
 void AVDM_cleanup(void)
 {
+    int nb=ListOfAudioDevices.size();
+    for(int i=0;i<nb;i++)
+            delete ListOfAudioDevices[i];
+    ListOfAudioDevices.clear();
 	if(device)
 	{
 		delete device;



From mean at mail.berlios.de  Fri Sep  9 08:32:05 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri,  9 Sep 2011 08:32:05 +0200
Subject: [Avidemux-svn-commit] r7487 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src
Message-ID: <20110909063205.C1BC0481270@sheep.berlios.de>

Author: mean
Date: 2011-09-09 08:32:05 +0200 (Fri, 09 Sep 2011)
New Revision: 7487

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
Log:
[vdpau] Avoid dealing with already destroyed buffers/context

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-08 17:50:09 UTC (rev 7486)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-09 06:32:05 UTC (rev 7487)
@@ -20,7 +20,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "ADM_cpp.h"
 #include "ADM_default.h"
 
 #ifdef USE_VDPAU
@@ -43,7 +43,8 @@
 
 static bool         vdpauWorking=false;
 static admMutex     surfaceMutex;
-
+static bool         destroyingFlag=false;
+static vector   <void *> destroyedList;
 #define aprintf(...) {}
 
 typedef enum 
@@ -54,6 +55,21 @@
     ADM_VDPAU_VC1=3
 }ADM_VDPAU_TYPE;
 /**
+    \fn hasBeenDestroyed
+    \brief If the context has been destroyed, dont attempt to manipulate the buffers attached
+*/
+static bool hasBeenDestroyed(void *ptr)
+{
+    int nb=destroyedList.size();
+    for(int i=0;i<nb;i++)
+    {
+        if(destroyedList[i]==ptr)
+            return true;
+    }
+    return false;
+}
+
+/**
     \fn markSurfaceUsed
     \brief mark the surfave as used. Can be called multiple time.
 */
@@ -61,6 +77,8 @@
 {
     vdpauContext *vd=(vdpauContext*)v;
     vdpau_render_state *render=(vdpau_render_state *)cookie;
+    if(destroyingFlag) // check that the surface has not been destroyed already...
+         if(hasBeenDestroyed(vd)) return true;
     render->refCount++;
     return true;
 }
@@ -72,6 +90,8 @@
 {
     vdpauContext *vd=(vdpauContext*)v;
     vdpau_render_state *render=(vdpau_render_state *)cookie;
+    if(destroyingFlag) // check that the surface has not been destroyed already...
+         if(hasBeenDestroyed(vd)) return true;
     render->refCount--;
     if(!render->refCount)
     {
@@ -276,6 +296,8 @@
 :decoderFF (w,h,fcc,extraDataLen,extraData,bpp)
 {
         destroying=false;
+        destroyingFlag=false; 
+        destroyedList.clear();
         alive=true;
         scratch=NULL;
         _context->opaque          = this;
@@ -350,6 +372,8 @@
 {
         ADM_info("[VDPAU] Cleaning up\n");
         destroying=true;
+        destroyingFlag=true;
+        destroyedList.push_back(VDPAU);
         for(int i=0;i<NB_SURFACE;i++)
         {
             if(VDPAU->renders[i])



From mean at mail.berlios.de  Fri Sep  9 08:32:06 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri,  9 Sep 2011 08:32:06 +0200
Subject: [Avidemux-svn-commit] r7488 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110909063206.F1F10481270@sheep.berlios.de>

Author: mean
Date: 2011-09-09 08:32:06 +0200 (Fri, 09 Sep 2011)
New Revision: 7488

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_vdpauRender.cpp
Log:
[render] Cleanup + memleak

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-09 06:32:05 UTC (rev 7487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-09 06:32:06 UTC (rev 7488)
@@ -126,6 +126,12 @@
 void renderDestroy(void)
 {
     ADM_info("Cleaning up Render\n");
+    if(renderer)
+    {
+        renderer->stop();
+        delete renderer;
+        renderer=NULL;
+    }
 }
 
 /**
@@ -402,5 +408,4 @@
         calcDisplayFromZoom(zoom);
         return true;
 }
-
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_vdpauRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_vdpauRender.cpp	2011-09-09 06:32:05 UTC (rev 7487)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_vdpauRender.cpp	2011-09-09 06:32:06 UTC (rev 7488)
@@ -39,8 +39,17 @@
 */
 vdpauRender::vdpauRender( void )
 {
+    
+}
+/**
+    \?n dtor
+*/
+vdpauRender::~vdpauRender()
+{
 
+    cleanup();
 }
+
 /**
     \fn init
 */
@@ -205,5 +214,4 @@
     renderCompleteRedrawRequest();
     return true;
 }
-
 #endif



From mean at mail.berlios.de  Fri Sep  9 08:32:08 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri,  9 Sep 2011 08:32:08 +0200
Subject: [Avidemux-svn-commit] r7489 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20110909063208.54D88481270@sheep.berlios.de>

Author: mean
Date: 2011-09-09 08:32:07 +0200 (Fri, 09 Sep 2011)
New Revision: 7489

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
Log:
[Ts Indexer] Try to detect mpeg2 in TRP files

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-09 06:32:06 UTC (rev 7488)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-09 06:32:07 UTC (rev 7489)
@@ -110,6 +110,21 @@
     return result;
 }
 /**
+    \fn mpeg2StartCode
+    \brief returns true if the start code is potentially the 1st startcode of a PES packet inside DVB
+            We only accept pic 1st slice / Seq start/Gop start and extension
+*/
+static bool mpeg2StartCode(int code)
+{
+    if(code==0) return true;
+    if(code==0xB3) return true; // seq start
+    if(code==0xB8) return true; // GOP start
+    if(code==0xB5) return true; // GOP start
+    if(code==0xBA) return true; // GOP start
+    if(code==0xB2) return true; // GOP start
+    return false;
+}
+/**
     \fn idContent
 */
 bool idContent(int pid,tsPacket *ts,ADM_TS_TRACK_TYPE & trackType)
@@ -148,13 +163,21 @@
             }
             if(ADM_findMpegStartCode(ptr2+4,ptr2+len2,&scode2,&syncoff))
             {
-                ADM_warning("Found startcode1 =%x\n",scode2);
+                ADM_warning("Found startcode2 =%x\n",scode2);
             }
-            if(scode==9 && scode2==9) // AU delimiter
+            if(scode==9 && scode2==9) // AU delimiter => H264
             {
                 trackType=ADM_TS_H264;
+                ADM_warning("Probably H264\n");
                 return true;
             }
+            if(mpeg2StartCode(scode) && mpeg2StartCode(scode2)) // Maybe Mpeg2 ?
+            {
+                trackType=ADM_TS_MPEG2;
+                ADM_warning("Probably Mpeg2\n");
+                return true;
+            }
+            ADM_warning("dont know what it is...\n");
             return false;
         }
         // Is it AC3 ??



From mean at mail.berlios.de  Fri Sep  9 10:23:54 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri,  9 Sep 2011 10:23:54 +0200
Subject: [Avidemux-svn-commit] r7490 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110909082355.270A8481270@sheep.berlios.de>

Author: mean
Date: 2011-09-09 10:23:54 +0200 (Fri, 09 Sep 2011)
New Revision: 7490

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
Log:
[render] Try to cleanup + dont update the window when we dont have data

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-09 06:32:07 UTC (rev 7489)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-09 08:23:54 UTC (rev 7490)
@@ -77,6 +77,7 @@
     displayWidth=width;
     displayHeight=height;
     resize(displayWidth,displayHeight);
+    firstRun = true;
     return true;
 }
 /**
@@ -84,6 +85,8 @@
 */
 QtGlAccelWidget::~QtGlAccelWidget()
 {
+    if(glProgram) delete glProgram;
+    glProgram=NULL;
     glDeleteTextures(3,textureName);
 }
 /**
@@ -240,7 +243,8 @@
 	glVertex2i(0, height());
 	glEnd();
     
-}
+}
+//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 /**
     \fn ctor
 */
@@ -248,7 +252,15 @@
 {
 	glWidget = NULL;
 
+}
+/**
+    \fn dtor
+*/
+QtGlRender::~QtGlRender(void)
+{
+	stop();
 }
+
 /**
     \fn stop
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-09 06:32:07 UTC (rev 7489)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-09 08:23:54 UTC (rev 7490)
@@ -57,6 +57,7 @@
 static uint8_t      _lock=0;
 
 static const UI_FUNCTIONS_T *HookFunc=NULL;
+static bool  enableDraw=true;
 
 refreshSB refreshCallback=NULL;
 /**
@@ -120,6 +121,7 @@
 uint8_t renderInit( void )
 {
 	draw=MUI_getDrawWidget(  );
+    enableDraw=false;
 	return 1;
 }
 
@@ -132,6 +134,7 @@
         delete renderer;
         renderer=NULL;
     }
+    enableDraw=false;
 }
 
 /**
@@ -159,6 +162,7 @@
 uint8_t renderDisplayResize(uint32_t w, uint32_t h,renderZoom zoom)
 {
         bool create=false;
+        enableDraw=false;
         ADM_info("Render to %"LU"x%"LU" zoom=%d\n",w,h,zoom);
         if(!renderer) create=true;
         else
@@ -167,7 +171,11 @@
         }
         if(create)
         {
-            if(renderer) delete renderer;
+            if(renderer) 
+            {
+                renderer->stop();
+                delete renderer;
+            }
             renderer=NULL;
             phyW=w;
             phyH=h;
@@ -202,9 +210,12 @@
 //----------------------------------------
 uint8_t renderUpdateImage(ADMImage *image)
 {
+    
     ADM_assert(!_lock);
+    enableDraw=true;
     if(renderer->getPreferedImage()!=image->refType)
             image->hwDownloadFromRef();
+    
     renderer->displayImage(image);
     return 1;
 }
@@ -217,6 +228,7 @@
 uint8_t renderRefresh(void)
 {
       if(_lock) return 1;
+      if(enableDraw==false) return true;
       if(renderer)
         renderer->refresh();
       return 1;
@@ -228,6 +240,7 @@
 bool renderCompleteRedrawRequest(void)
 {
     ADM_info("RedrawRequest\n");
+    if(enableDraw==false) return true;
     if(refreshCallback)
         refreshCallback();
     return true;
@@ -237,6 +250,7 @@
 */
 uint8_t renderExpose(void)
 {
+    if(enableDraw==false) return true;
     renderRefresh();
     return 1;
 }
@@ -351,6 +365,7 @@
 */
 uint8_t renderStopPlaying( void )
 {      
+      
       return true;
 }
 /**



From mean at mail.berlios.de  Sat Sep 10 08:45:25 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 08:45:25 +0200
Subject: [Avidemux-svn-commit] r7491 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110910064525.A1F38481264@sheep.berlios.de>

Author: mean
Date: 2011-09-10 08:45:25 +0200 (Sat, 10 Sep 2011)
New Revision: 7491

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[qtGl] Let qt destroy the widget

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-09 08:23:54 UTC (rev 7490)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-10 06:45:25 UTC (rev 7491)
@@ -87,7 +87,9 @@
 {
     if(glProgram) delete glProgram;
     glProgram=NULL;
-    glDeleteTextures(3,textureName);
+    if(textureName[0])
+        glDeleteTextures(3,textureName);
+    textureName[0]=0;
 }
 /**
     \fn setImage
@@ -268,9 +270,10 @@
 bool QtGlRender::stop(void)
 {
 	printf("[GL Render] Renderer closed\n");
-
+#if 0 // deleted by qt
 	if (glWidget)
 		delete glWidget;
+#endif
     glWidget=NULL;
     return true;
 }



From mean at mail.berlios.de  Sat Sep 10 08:45:26 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 08:45:26 +0200
Subject: [Avidemux-svn-commit] r7492 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: . ADM_render
Message-ID: <20110910064526.CA4F6481264@sheep.berlios.de>

Author: mean
Date: 2011-09-10 08:45:26 +0200 (Sat, 10 Sep 2011)
New Revision: 7492

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[render] Let Qt destroy widget at exit (part2)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-10 06:45:25 UTC (rev 7491)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-10 06:45:26 UTC (rev 7492)
@@ -270,10 +270,8 @@
 bool QtGlRender::stop(void)
 {
 	printf("[GL Render] Renderer closed\n");
-#if 0 // deleted by qt
 	if (glWidget)
 		delete glWidget;
-#endif
     glWidget=NULL;
     return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-10 06:45:25 UTC (rev 7491)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-10 06:45:26 UTC (rev 7492)
@@ -385,7 +385,7 @@
     
     admPreview::destroy();
     UI_End();
-    renderDestroy();
+    //renderDestroy();
 
     ADM_ad_cleanup();
     ADM_ae_cleanup();



From mean at mail.berlios.de  Sat Sep 10 17:05:35 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 17:05:35 +0200
Subject: [Avidemux-svn-commit] r7493 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_editor avidemux_core/ADM_core/include
Message-ID: <20110910150535.8975F481270@sheep.berlios.de>

Author: mean
Date: 2011-09-10 17:05:35 +0200 (Sat, 10 Sep 2011)
New Revision: 7493

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/admPackage.txt
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
Log:
[Edit] Use BVector instead of vector, dont use memset but proper ctor

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2011-09-10 06:45:26 UTC (rev 7492)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2011-09-10 15:05:35 UTC (rev 7493)
@@ -611,7 +611,7 @@
 {
     ADM_assert(ref<_segments.getNbRefVideos());
     _SEGMENT seg;
-    memset(&seg,0,sizeof(seg));
+    
     seg._durationUs=duration;
     seg._reference=ref;
     seg._refStartTimeUs=startRef;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-10 06:45:26 UTC (rev 7492)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-10 15:05:35 UTC (rev 7493)
@@ -150,7 +150,6 @@
   aviInfo    info;
   uint32_t   magic;
   _VIDEOS video;
-    memset(&video,0,sizeof(video));
 
 	if(!strcmp(name, AVS_PROXY_DUMMY_FILE))
         magic=0;
@@ -307,7 +306,7 @@
             stream->getExtraData(&extraLen,&extraData);
             track->codec=getAudioCodec(header->encoding,header,extraLen,extraData);
 
-            thisVid->audioTracks.push_back(track);
+            thisVid->audioTracks.pushBack(track);
 
       }
     }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2011-09-10 06:45:26 UTC (rev 7492)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2011-09-10 15:05:35 UTC (rev 7493)
@@ -36,7 +36,7 @@
  #include "ADM_audioStream.h"
  #include "ADM_audiocodec/ADM_audiocodec.h"
  #include "ADM_segment.h"
- #include <vector>
+ #include <BVector.h>
 
 #define ADM_EDITOR_AUDIO_BUFFER_SIZE (128*1024*6*sizeof(float))
 #define AVS_PROXY_DUMMY_FILE "::ADM_AVS_PROXY::" 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-10 06:45:26 UTC (rev 7492)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-10 15:05:35 UTC (rev 7493)
@@ -29,7 +29,8 @@
 
 ADM_EditorSegment::ADM_EditorSegment(void)
 {
-
+    segments.setCapacity(5);
+    videos.setCapacity(5);
 }
 ADM_EditorSegment::~ADM_EditorSegment()
 {
@@ -80,7 +81,6 @@
   aviInfo       info;
   _SEGMENT      seg;
 
-  memset(&seg,0,sizeof(seg));
 
   ref->_aviheader->getVideoInfo (&info);
   ref->_aviheader->getExtraHeaderData (&l, &d);
@@ -121,8 +121,8 @@
             ref->firstFramePts=pts;
         }
 
-    segments.push_back(seg);
-    videos.push_back(*ref);
+    segments.pushBack(seg);
+    videos.pushBack(*ref);
     updateStartTime();
     return true;
 }
@@ -143,7 +143,7 @@
 bool        ADM_EditorSegment::addSegment(_SEGMENT *seg)
 {
     ADM_info("Adding a new segment\n");
-    segments.push_back(*seg);
+    segments.pushBack(*seg);
     updateStartTime();
     return true;
 }
@@ -215,11 +215,11 @@
     {
         _SEGMENT seg;
         _VIDEOS  *vid=&(videos[i]);
-        memset(&seg,0,sizeof(seg));
+
         seg._durationUs=vid->_aviheader->getVideoDuration();
         seg._reference=i;
         vid->_aviheader->getVideoInfo(&info);
-        segments.push_back(seg);
+        segments.pushBack(seg);
     }
     updateStartTime();
     return true;
@@ -488,7 +488,7 @@
     if(startSeg==endSeg)
     {
         // Split the seg int two..
-        segments.insert(segments.begin()+startSeg+1,*getSegment(startSeg)); 
+        segments.insert(startSeg+1,*getSegment(startSeg)); 
         endSeg=startSeg+1;
 
     }
@@ -505,7 +505,7 @@
     // 2- Kill the segment in between
     for(int i=startSeg+1;i<endSeg;i++)
     {
-        segments.erase(segments.begin()+startSeg+1);
+        segments.removeAt(startSeg+1);
     }
     updateStartTime();
     removeEmptySegments();
@@ -631,7 +631,7 @@
                 if(seg->_durationUs==0) index=i;
         }
         if(index==-1) break;
-        segments.erase(segments.begin()+index);
+        segments.removeAt(index);
     }
     return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-10 06:45:26 UTC (rev 7492)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-10 15:05:35 UTC (rev 7493)
@@ -16,7 +16,7 @@
  ***************************************************************************/
 #ifndef ADM_SEGMENT_H
 #define ADM_SEGMENT_H
-#include <vector>
+#include <BVector.h>
 class ADM_audioStream;
 class ADM_Audiocodec;
 class decoders;
@@ -53,15 +53,16 @@
     \struct _VIDEOS
     \brief The _VIDEOS struct is a video we have loaded.
 */
-typedef struct
+class _VIDEOS
 {
+public:
       vidHeader *_aviheader; /// Demuxer
       decoders *decoder; /// Video codec
       ADMColorScalerSimple *color; /// Color conversion if needed
 
       /* Audio part */
       uint32_t currentAudioStream;
-      vector <ADM_audioStreamTrack *>  audioTracks;
+      BVector <ADM_audioStreamTrack *>  audioTracks;
       
 
       uint32_t _nb_video_frames; /// Really needed ?
@@ -75,28 +76,54 @@
       uint64_t timeIncrementInUs; /// in case the video has no PTS, time increment (us)
 
       uint64_t firstFramePts; /// Pts of firstFrame
-}_VIDEOS;
 
+    _VIDEOS()
+    {
+        currentAudioStream=0;
+        _aviheader=NULL;
+        decoder=NULL;
+        color=NULL;
+        _nb_video_frames=0;
+        _videoCache=NULL;
+        lastSentFrame=0;
+        lastDecodedPts=0;
+        lastReadPts=0;
+        timeIncrementInUs=0;
+        firstFramePts=0;
+    }
+
+};
+
 /**
     \struct _SEGMENT
     \brief The video is a collection of segment.
             Each segment refers to its source (the reference) and the part of the source the segment is made of.
 */
-typedef struct
+class _SEGMENT
 {
+public:
         uint32_t _reference; /// Reference video
         uint64_t _refStartTimeUs; /// Starting time in reference
         uint64_t _startTimeUs; /// Start time in current (=sum(_duration of previous seg))
         uint64_t _durationUs; ///
         uint32_t _dropBframes;
         uint64_t _refStartDts;
-        
-} _SEGMENT;
+        void clear(void) 
+        {
+            _reference=0;
+            _refStartTimeUs=0;
+            _startTimeUs=0;
+            _durationUs=0;
+            _dropBframes=0;
+            _refStartDts=0;
+        }
+        _SEGMENT() {clear();}
+};
 /*
     Use vectors to store our videos & segments
 */
-typedef std::vector <_VIDEOS>  ListOfVideos;
-typedef std::vector <_SEGMENT> ListOfSegments;
+typedef BVector <_VIDEOS>  ListOfVideos;
+typedef BVector <_SEGMENT> ListOfSegments;
 
 /**
     \class ADM_EditorSegment

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h	2011-09-10 15:05:35 UTC (rev 7493)
@@ -0,0 +1,285 @@
+#ifndef BVECTOR_HPP
+#define BVECTOR_HPP
+
+#include <new>
+#include <cstring>
+
+// MEANX : Simplified a lot, the original code had maybe alignment issues
+/**
+* @author Berenger
+* @version 0.5
+* @date 24 novembre 2009
+* @file BVector.hpp
+* @package Utils
+* @brief Basic vecctor based on a memory area
+*
+* This Vector used a memory area, so you have to use it as an array.
+* So it is easy and fast to put data at start/end position.
+* But it takes a long time to insert or remove value in the center arrea
+*
+* @must You must give the buffer size if you know it!
+*
+* @example BVector<int> vec(100);
+* @example for(int i = 0 ; i < 10 ;++i) vec.pushBack(i);
+* @example
+* @example vec[0] = 99;
+* @example vec[2] = 100;
+* @example
+* @example vec.insert(0u,25);
+* @example vec.insert(5u,25);
+* @example
+* @example for(int i = 0 ; i < 5 ;++i) vec.popBack();
+*
+* @example for(BVector<int>::iterator iter( vec.begin() ); iter != vec.end() ; ++iter){
+* @example 	(*iter)+=5;
+* @example }
+*/
+
+#define DefaultSize 5
+
+template<class T>
+class BVector {
+protected:
+        T* buffer;                                  /**< memory area*/
+
+        int capacity;                               /**< memory capacity*/
+        static const int SizeOfT = sizeof(T);	   /**< size of the object*/
+
+        int currentIndex;                                 /**< start index*/
+
+public:
+        /**
+        *@brief constructor
+        */
+        BVector(){
+                this->buffer = new T[DefaultSize];// MEANX
+                this->capacity = DefaultSize;
+                this->currentIndex = 0;
+        }
+
+        /**
+        *@brief constructor
+        *@param inSize the buffer size
+        *@param inPointOfStart the point of start [0;1]
+        */
+        BVector(const int inSize){
+                this->buffer = new T[inSize];
+                this->capacity = inSize;
+                this->currentIndex=0;
+        }
+
+        /**
+        *@brief destructor
+        */
+        virtual ~BVector(){
+                
+                delete [] this->buffer;
+                this->buffer=NULL;
+        }
+
+        /**
+        *@brief get the buffer capacity
+        *@return the buffer capacity
+        */
+        int getCapacity() const{
+                return this->capacity;
+        }
+
+        /**
+        *@brief set the buffer capacity
+        *@param in_capacity to change the capacity
+        */
+        void setCapacity(int in_capacity);
+
+        /**
+        *@brief get a const reference of a given value
+        *@param inPosition the query position
+        *@return the value
+        */
+        T& operator[](const int inPosition ){
+                return this->buffer[inPosition];
+        }
+
+        /**
+        *@brief get a const reference of a given value
+        *@param inPosition the query position
+        *@return the value
+        */
+        const T& operator[](const int inPosition ) const{
+                return this->buffer[inPosition];
+        }
+
+        /**
+        *@brief Append a value
+        *@param inValue the value to append
+        */
+        virtual void append ( const T & inValue )
+        {
+
+                setCapacity( size()+1);                
+                this->buffer[this->currentIndex++]=inValue;
+        }
+
+        /**
+        *@brief Append a value
+        *@param other the vector to append
+        */
+        virtual void append ( const BVector<T> & other ){
+
+                setCapacity(size() + other.size());
+
+                for(int index = 0 ; index < other.currentIndex ; ++index )
+                {
+                        this->buffer[this->currentIndex++]=other.buffer[index];
+                }
+        }
+
+        /**
+        *@brief delete all, then size = 0
+        */
+        void clear(){
+                this->currentIndex=0;
+        }
+
+        /**
+        *@brief count the value
+        *@param inValue the value to test
+        *@return the value occured number
+        */
+        int size() const{
+                return this->currentIndex;
+        }
+
+        /**
+        *@brief test if the vector is empty
+        *@return true if vector is empty
+        */
+        bool empty() const{
+                return !this->currentIndex;
+        }
+
+        /**
+        *@brief insert a value at a certain position
+        *@param inPosition where to insert
+        *@param inValue the value to put
+        */
+        void insert ( int inPosition, T inValue );
+
+        /**
+        *@brief pop the last node
+        */
+        void popBack(){
+                if(this->currentIndex)
+                {
+                        --this->currentIndex;
+                }
+        }
+        /**
+        *@brief pop the first node
+        */
+        void popFront(){
+                if(this->currentIndex)
+                {
+                        memmove(buffer,buffer+1,sizeof(T)*(this->currentIndex-1));
+                        --this->currentIndex;
+                }
+        }
+
+        /**
+        *@brief push a new node in back
+        *@param inValue the new value
+        */
+        void pushBack( const T & inValue )
+        {
+                append(inValue);
+        }
+        /**
+        *@brief push a new node in front
+        *@param inValue the new value
+        */
+        void pushFront( const T & inValue )
+        {
+                 if(!this->currentIndex) {append(inValue);return;}
+                 setCapacity( size()+1);
+                 memmove(this->buffer+1,this->buffer,sizeof(T)*(this->currentIndex));
+                 this->buffer[0]=inValue;
+                 this->currentIndex++;
+                    
+        }
+        /**
+        *@brief remove a value at a position
+        *@param inPosition the position to delete
+        */
+        void removeAt ( int inPosition );
+
+        /**
+        *@brief set the vector from another
+        *@param other the vector to copy
+        *@return the current vector
+        */
+        BVector<T> & operator= ( const BVector<T> & other ){
+                clear();
+                append(other);
+                return *this;
+        }
+
+};
+
+template <typename T>
+void BVector<T>::setCapacity(int in_capacity){
+        const int currentSize = this->currentIndex;
+        int pointOfStart = 0;
+
+        if( in_capacity < this->capacity)
+        {
+                return; // no shrink...
+        }
+
+
+        T* nbuffer = new T[in_capacity]; 
+
+        memcpy(&nbuffer[0],&this->buffer[0],sizeof(T)*currentSize);
+
+        delete [] this->buffer;
+        this->buffer = nbuffer;
+        this->capacity = in_capacity;
+}
+template <typename T>
+void BVector<T>::insert ( int inPosition, T inValue )
+{
+    int last=this->currentIndex;
+    if(last-1==inPosition)
+    {
+        append(inValue);
+        return;
+    }
+    setCapacity(last+1);
+    int tail=last-inPosition;
+    memmove(buffer+inPosition+1,buffer+inPosition,sizeof(T)*tail);
+    buffer[inPosition]=inValue;
+    this->currentIndex++;
+}
+
+template <typename T>
+void BVector<T>::removeAt( int inPosition )
+{
+    if(inPosition==currentIndex-1) 
+    {
+            popBack();
+            return;
+    }
+    int tail=this->currentIndex-inPosition-1;
+    memmove(buffer+inPosition,buffer+inPosition+1,sizeof(T)*tail);
+    this->currentIndex--;
+}
+
+
+// EOF
+
+
+
+
+
+
+#endif
+

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/admPackage.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/admPackage.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/admPackage.txt	2011-09-10 15:05:35 UTC (rev 7493)
@@ -0,0 +1,4 @@
+Name   : BVecor
+URL    : http://berenger.eu/blog/
+License: LGPL
+



From mean at mail.berlios.de  Sat Sep 10 17:05:37 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 17:05:37 +0200
Subject: [Avidemux-svn-commit] r7494 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_audioFilter/src
	avidemux_plugins/ADM_demuxers/Matroska
	avidemux_plugins/ADM_demuxers/MpegPS
	avidemux_plugins/ADM_demuxers/OpenDml
Message-ID: <20110910150537.9265C481270@sheep.berlios.de>

Author: mean
Date: 2011-09-10 17:05:37 +0200 (Sat, 10 Sep 2011)
New Revision: 7494

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_ps.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psComputeTimeStamp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.h
Log:
[all] Replace vector by BVector

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -14,11 +14,11 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <vector>
+#include <BVector.h>
 #include "ADM_default.h"
 #include "audioencoderInternal.h"
 #include "ADM_dynamicLoading.h"
-std::vector <ADM_audioEncoder *> ListOfAudioEncoder;
+BVector <ADM_audioEncoder *> ListOfAudioEncoder;
 
 static AUDIOENCODER  currentEncoder=0; //0 is always dummy
 
@@ -117,7 +117,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     
 
-    ListOfAudioEncoder.push_back(dll->encoderBlock); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfAudioEncoder.append(dll->encoderBlock); // Needed for cleanup. FIXME TODO Delete it.
     printf("[AudioEncoder] Registered filter %s as  %s\n",file,dll->encoderBlock->description);
     return true;
 	// Fail!
@@ -139,7 +139,7 @@
 	uint32_t nbFile;
     // Add the copy encoder
     ADM_AudioEncoderLoader *copy=new ADM_AudioEncoderLoader("copy","Copy");
-    ListOfAudioEncoder.push_back(copy->encoderBlock);
+    ListOfAudioEncoder.append(copy->encoderBlock);
     //
 	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
 	printf("[ADM_ae_plugin] Scanning directory %s\n",path);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkv.h	2011-09-10 15:05:37 UTC (rev 7494)
@@ -25,7 +25,7 @@
 #include "ADM_Video.h"
 #include "ADM_audioStream.h"
 #include "ADM_ebml.h"
-#include <vector>
+#include <BVector.h>
 #define MKV_MAX_REPEAT_HEADER_SIZE 16
 /**
     \struct mkvIndex
@@ -40,7 +40,7 @@
     uint64_t Pts;   // Pts in us
 }mkvIndex;
 
-typedef std::vector <mkvIndex > mkvListOfIndex;
+typedef BVector <mkvIndex > mkvListOfIndex;
 /**
     \struct mkvTrak
     \brief Hold information about a give track, the track #0  is always video.
@@ -134,7 +134,7 @@
     char                    *_filename;
     mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
 
-    vector <mkvIndex    >   _clusters;
+    BVector <mkvIndex    >   _clusters;
 
     uint32_t                _nbAudioTrack;
     uint32_t                _currentAudioTrack;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvIndexer.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -205,7 +205,7 @@
 
     }
   }
-  Track->index.push_back(ix);
+  Track->index.append(ix);
 
   return 1;
 }
@@ -353,7 +353,7 @@
      work->update(segment.tell()>>10,fileSize>>10);
      tmpCluster.pos=segment.tell();
      tmpCluster.size=alen;
-     _clusters.push_back(tmpCluster);
+     _clusters.append(tmpCluster);
 
      // Normally the timecode is the 1st one following
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_ps.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_ps.h	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_ps.h	2011-09-10 15:05:37 UTC (rev 7494)
@@ -25,10 +25,10 @@
 #include "dmx_io.h"
 #include "ADM_indexFile.h"
 #include "dmxPSPacket.h"
-#include <vector>
+#include <BVector.h>
 #include "ADM_coreDemuxerMpeg.h"
-using std::vector;
 
+
 /**
     \struct scrGap
     \brief Map gap/reset in the scr flow to put everything back to linear / monotonic
@@ -38,7 +38,7 @@
     uint64_t position;
     uint64_t timeOffset;
 }scrGap;
-typedef vector <scrGap> ListOfScr;
+typedef BVector <scrGap> ListOfScr;
 
 /**
     \fn ADM_psAccess
@@ -54,7 +54,7 @@
                 
 public:
                 bool            setTimeOffset(uint64_t of) {dtsOffset=of;return true;}
-                vector          <ADM_mpgAudioSeekPoint >seekPoints;
+                BVector        <ADM_mpgAudioSeekPoint >seekPoints;
                                   ADM_psAccess(const char *name,uint8_t pid,bool append); 
                 virtual           ~ADM_psAccess();
                                     /// Hint, the stream is pure CBR (AC3,MP2,MP3)
@@ -125,7 +125,7 @@
     bool    processVideoIndex(char *buffer);
     bool    processAudioIndex(char *buffer);
 
-    std::vector <dmxFrame *> ListOfFrames;      
+    BVector <dmxFrame *> ListOfFrames;      
     fileParser      parser;
     uint32_t       lastFrame;
     psPacketLinear *psPacket;
@@ -133,7 +133,7 @@
     bool            updatePtsDts(void);
 protected:
     ListOfScr                       listOfScrGap;
-    vector <ADM_psTrackDescriptor *>listOfAudioTracks;
+    BVector <ADM_psTrackDescriptor *>listOfAudioTracks;
   public:
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -57,7 +57,7 @@
             s.position=at;
             s.dts=dts;
             s.size=size;
-            seekPoints.push_back(s);
+            seekPoints.append(s);
             return true;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -180,7 +180,7 @@
                         ADM_assert(0);
 
         }
-        list->push_back(info);
+        list->append(info);
         return true;
 er:
         delete info;
@@ -195,7 +195,7 @@
     while( list->size())
     {
         delete (*list)[0];
-        list->erase(list->begin());
+        list->popFront();
     }
     delete list;
     return true;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.h	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psAudioProbe.h	2011-09-10 15:05:37 UTC (rev 7494)
@@ -16,15 +16,15 @@
  ***************************************************************************/
 #ifndef ADM_PS_AUDIO_PROBE_H
 #define ADM_PS_AUDIO_PROBE_H
-#include <vector>
-using std::vector;
+#include <BVector.h>
+
 typedef struct
 {
     WAVHeader header;
     uint8_t   esID;
 }psAudioTrackInfo;
 
-typedef vector <psAudioTrackInfo*> listOfPsAudioTracks;
+typedef BVector <psAudioTrackInfo*> listOfPsAudioTracks;
 
 /// Returns a list of audio tracks found in the file.
 listOfPsAudioTracks *psProbeAudio(const char *fileName);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psComputeTimeStamp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psComputeTimeStamp.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psComputeTimeStamp.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -36,7 +36,7 @@
         for(int i=0;i<listOfAudioTracks.size();i++)
         {
 
-            vector          <ADM_mpgAudioSeekPoint > *seekPoints=&(listOfAudioTracks[i]->access->seekPoints);
+            BVector          <ADM_mpgAudioSeekPoint > *seekPoints=&(listOfAudioTracks[i]->access->seekPoints);
             uint64_t dts=(*seekPoints)[0].dts;
             if(dts!=ADM_NO_PTS) continue;
             ADM_warning("[PS] Audio track %d has no timestamp for first seek point, guessing...\n",i);
@@ -56,7 +56,7 @@
             // Remove first seek point with no PTS...
             if(offset) ADM_info("Deleting %d seekPoints with no timestamp\n",offset);
             for(int rm=0;rm<offset;rm++)
-                    (*seekPoints).erase( (*seekPoints).begin());
+                    (*seekPoints).popFront();
 #else
 
             // Compute the missing DTS using byterate and assuming CBR
@@ -102,7 +102,7 @@
         // at video
         for(int i=0;i<listOfAudioTracks.size();i++)
         {
-            vector          <ADM_mpgAudioSeekPoint > *seekPoints=&(listOfAudioTracks[i]->access->seekPoints);
+            BVector          <ADM_mpgAudioSeekPoint > *seekPoints=&(listOfAudioTracks[i]->access->seekPoints);
             uint64_t secondDts=(*seekPoints)[0].dts;
             uint64_t secondSize=(*seekPoints)[0].size;
             if(secondSize && listOfAudioTracks[i]->header.byterate)
@@ -120,7 +120,7 @@
                 sk.dts=firstDts;
                 sk.size=0;
                 sk.position=ListOfFrames[0]->startAt;
-                (*seekPoints).insert( (*seekPoints).begin(),sk);
+                (*seekPoints).pushFront(sk);
 
             }
         }

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -120,7 +120,7 @@
         uint64_t         lastValidVideoDts;
         uint64_t         timeOffset; // In 90 khz Tick
         bool             handleScrReset(uint64_t dts);
-        vector <scrGap>  listOfScrReset;
+        BVector <scrGap> listOfScrReset;
         bool             writeScrReset(void);
 public:
                 PsIndexer(void);
@@ -604,7 +604,7 @@
               scrGap newGap;
               newGap.position=newPosition;
               newGap.timeOffset=newOffset;
-              listOfScrReset.push_back(newGap);
+              listOfScrReset.append(newGap);
               return true;
         }else
         {

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -171,7 +171,7 @@
                         case 'B': frame->pictureType=AVI_FIELD_STRUCTURE+AVI_BOTTOM_FIELD;break;
                 }
                 frame->len=len;
-                ListOfFrames.push_back(frame);
+                ListOfFrames.append(frame);
                 count++;
                 if(!next) 
                 {
@@ -251,7 +251,7 @@
             desc->stream=NULL;
             desc->access=access;
             memcpy(&(desc->header),&hdr,sizeof(hdr));
-            listOfAudioTracks.push_back(desc);
+            listOfAudioTracks.append(desc);
 
 
     }
@@ -291,7 +291,7 @@
         scrGap gap;
         gap.position=position;
         gap.timeOffset=timeOffset;
-        listOfScrGap.push_back(gap);
+        listOfScrGap.append(gap);
     }
   
     return true;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.cpp	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.cpp	2011-09-10 15:05:37 UTC (rev 7494)
@@ -69,7 +69,7 @@
                 current.offset=start;
                 current.size=ONE_CHUNK;
                 current.dts=ADM_NO_PTS;
-                myIndex.push_back(current);
+                myIndex.append(current);
                 start+=ONE_CHUNK;
                 size-=ONE_CHUNK;
             }
@@ -77,13 +77,13 @@
                 current.offset=start;
                 current.size=size;
                 current.dts=ADM_NO_PTS;
-                myIndex.push_back(current);
+                myIndex.append(current);
         }
 
     }else
     {       // Duplicate index as is
         for(int i=0;i<nbChunk;i++)
-          myIndex.push_back(idx[i]);
+          myIndex.append(idx[i]);
     }
     fd=ADM_fopen(name,"r");
     ADM_assert(fd);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.h	2011-09-10 15:05:35 UTC (rev 7493)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/OpenDml/ADM_odml_audio.h	2011-09-10 15:05:37 UTC (rev 7494)
@@ -1,7 +1,7 @@
 #ifndef ADM_ODML_AUDIO_H
 #define ADM_ODML_AUDIO_H
-#include <vector>
-using std::vector;
+#include <BVector.h>
+
 #include "ADM_audioStream.h"
 class odmlIndex;
 /**
@@ -16,7 +16,7 @@
                 uint32_t pos;
                 FILE     *fd;
                 uint32_t currentIndex;
-                vector <odmlIndex> myIndex;
+                BVector <odmlIndex> myIndex;
                 uint32_t   nbIndex;
                 WAVHeader *wavHeader;
                 uint64_t  currentPosition;



From mean at mail.berlios.de  Sat Sep 10 17:05:41 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 17:05:41 +0200
Subject: [Avidemux-svn-commit] r7495 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_videoCodec/src
	avidemux/common/ADM_videoEncoder/src
	avidemux/common/ADM_videoFilter2/include
	avidemux/common/ADM_videoFilter2/src avidemux_core/ADM_core/include
	avidemux_core/ADM_coreAudio/include avidemux_core/ADM_coreAudio/src
	avidemux_core/ADM_coreAudioDevice/src
	avidemux_core/ADM_coreDemuxer/src
	avidemux_core/ADM_coreDemuxerMpeg/include
	avidemux_core/ADM_coreDemuxerMpeg/src
	avidemux_core/ADM_coreMuxer/src avidemux_core/ADM_coreTinyPy/src
Message-ID: <20110910150541.3111C481270@sheep.berlios.de>

Author: mean
Date: 2011-09-10 17:05:40 +0200 (Sat, 10 Sep 2011)
New Revision: 7495

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilters.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStreamMP3.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamMP3.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/ADM_indexFile.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/dmx_io.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/ADM_indexFile.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/dmx_io.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
Log:
[all] Replace vector by BVector continued

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_dynVideoDecoder.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -13,7 +13,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "ADM_default.h"
-#include <vector>
+#include <BVector.h>
 
 #include "DIA_fileSel.h"
 #include "ADM_coreVideoDecoderInternal.h"
@@ -48,7 +48,7 @@
         }
 };
 
-std::vector <ADM_videoDecoder6 *> ListOfDecoders;
+BVector <ADM_videoDecoder6 *> ListOfDecoders;
 // 
 
 /**
@@ -86,7 +86,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     if(dll->desc->apiVersion!=ADM_VIDEO_DECODER_API_VERSION) Fail(WrongApiVersion);
 //fixme todo also check uiType    
-    ListOfDecoders.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfDecoders.append(dll); // Needed for cleanup. FIXME TODO Delete it.
     printf("[VideoDecoder6] Registered filter %s as  %s\n",file,dll->desc->description);
     return true;
 	// Fail!

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -21,6 +21,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "ADM_cpp.h"
+#include "BVector.h"
 #include "ADM_default.h"
 
 #ifdef USE_VDPAU
@@ -44,7 +45,7 @@
 static bool         vdpauWorking=false;
 static admMutex     surfaceMutex;
 static bool         destroyingFlag=false;
-static vector   <void *> destroyedList;
+static BVector   <void *> destroyedList;
 #define aprintf(...) {}
 
 typedef enum 
@@ -373,7 +374,7 @@
         ADM_info("[VDPAU] Cleaning up\n");
         destroying=true;
         destroyingFlag=true;
-        destroyedList.push_back(VDPAU);
+        destroyedList.append(VDPAU);
         for(int i=0;i<NB_SURFACE;i++)
         {
             if(VDPAU->renders[i])

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -16,7 +16,7 @@
 
 
 #include "ADM_default.h"
-#include <vector>
+#include <BVector.h>
 
 #include "DIA_fileSel.h"
 
@@ -55,7 +55,7 @@
         }
 };
 
-std::vector <ADM_videoEncoder6 *> ListOfEncoders;
+BVector <ADM_videoEncoder6 *> ListOfEncoders;
 // 
 ADM_videoEncoderDesc copyDesc={
         "Copy",
@@ -109,7 +109,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     if(dll->desc->apiVersion!=ADM_VIDEO_ENCODER_API_VERSION) Fail(WrongApiVersion);
 //fixme todo also check uiType    
-    ListOfEncoders.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfEncoders.append(dll); // Needed for cleanup. FIXME TODO Delete it.
     printf("[VideoEncoder6] Registered filter %s as  %s\n",file,dll->desc->description);
     return true;
 	// Fail!
@@ -141,7 +141,7 @@
     // Add our copy encoder....
     ADM_videoEncoder6 *dll=new ADM_videoEncoder6("copyADM");
     dll->desc=&copyDesc;
-    ListOfEncoders.push_back(dll);
+    ListOfEncoders.append(dll);
 
 	for(int i=0;i<nbFile;i++)
 		tryLoadingEncoderPlugin(files[i]);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilters.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilters.h	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilters.h	2011-09-10 15:05:40 UTC (rev 7495)
@@ -15,7 +15,7 @@
  ***************************************************************************/
 #ifndef ADM_VIDEO_FILTERS_H
 #define ADM_VIDEO_FILTERS_H
-
+#include "BVector.h"
 class ADM_coreVideoFilter;
 /**
     \struct ADM_VideoFilterElment
@@ -26,7 +26,7 @@
     ADM_coreVideoFilter *instance;
 }ADM_VideoFilterElement;
 
-extern std::vector<ADM_VideoFilterElement> ADM_VideoFilters;
+extern BVector<ADM_VideoFilterElement> ADM_VideoFilters;
 
 // Get list
 uint32_t                ADM_vf_getSize(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_pluginLoad.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -17,7 +17,7 @@
 #include "ADM_coreVideoFilterInternal.h"
 #include "ADM_dynamicLoading.h"
 #include "ADM_videoFilterApi.h"
-#include <vector>
+#include <BVector.h>
 
 #if 1
 #define aprintf printf
@@ -75,7 +75,7 @@
 		};
 };
 
-std::vector<ADM_vf_plugin *> ADM_videoFilterPluginsList[VF_MAX];
+BVector<ADM_vf_plugin *> ADM_videoFilterPluginsList[VF_MAX];
 /**
  * 	\fn tryLoadingVideoFilterPlugin
  *  \brief try to load the plugin given as argument..
@@ -128,7 +128,7 @@
     }else   
     {
         plugin->tag=ADM_videoFilterPluginsList[info->category].size()+info->category*100;
-        ADM_videoFilterPluginsList[info->category].push_back(plugin);
+        ADM_videoFilterPluginsList[info->category].append(plugin);
     }
 
 	return 1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -11,6 +11,7 @@
  *   the Free Software Foundation; either version 2 of the License, or     *
  *   (at your option) any later version.                                   *
  ***************************************************************************/
+#include "BVector.h"
 #include "ADM_default.h"
 #include "ADM_videoFilterApi.h"
 #include "ADM_videoFilters.h"
@@ -19,7 +20,7 @@
 #include "ADM_filterThread.h"
 static ADM_coreVideoFilter *bridge=NULL;
 
-std::vector<ADM_VideoFilterElement> ADM_VideoFilters;
+BVector <ADM_VideoFilterElement> ADM_VideoFilters;
 
 /**
     \fn ADM_vf_getSize
@@ -86,7 +87,7 @@
     ADM_VideoFilterElement e;
     e.tag=tag;
     e.instance=nw;
-    ADM_VideoFilters.push_back(e);
+    ADM_VideoFilters.append(e);
     return true;
 }
 /**
@@ -98,7 +99,7 @@
     ADM_assert(bridge);
     ADM_coreVideoFilter *f=bridge;
     
-    std::vector<ADM_coreVideoFilter *> bin;
+    BVector <ADM_coreVideoFilter *> bin;
     for(int i=0;i<ADM_VideoFilters.size();i++)
     {
             // Get configuration
@@ -108,7 +109,7 @@
             old->getCoupledConf(&c);
             ADM_coreVideoFilter *nw=ADM_vf_createFromTag(tag,f,c);
             ADM_VideoFilters[i].instance=nw;
-            bin.push_back(old);
+            bin.append(old);
             if(c) delete c;
             f=nw;
     }
@@ -132,7 +133,7 @@
     // last filter, destroy..
     ADM_VideoFilterElement *e=&(ADM_VideoFilters[index]);
     delete e->instance;
-    ADM_VideoFilters.erase(ADM_VideoFilters.begin() + index);        
+    ADM_VideoFilters.removeAt(index);        
     return ADM_vf_recreateChain();
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/BVector.h	2011-09-10 15:05:40 UTC (rev 7495)
@@ -234,8 +234,10 @@
         {
                 return; // no shrink...
         }
+        // Grow by at least 50%
+        int targetCap=(this->capacity*3)/2;
+        if(targetCap>in_capacity) in_capacity=targetCap;
 
-
         T* nbuffer = new T[in_capacity]; 
 
         memcpy(&nbuffer[0],&this->buffer[0],sizeof(T)*currentSize);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStreamMP3.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStreamMP3.h	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStreamMP3.h	2011-09-10 15:05:40 UTC (rev 7495)
@@ -17,8 +17,7 @@
 #define ADM_audioStreamMP3_H
 
 #include "ADM_audioStreamBuffered.h"
-#include <vector>
-using namespace std;
+#include <BVector.h>
 
 typedef struct
 {
@@ -34,7 +33,7 @@
 class ADM_audioStreamMP3 : public ADM_audioStreamBuffered
 {
         protected:
-                      vector <MP3_seekPoint *> seekPoints;
+                      BVector <MP3_seekPoint *> seekPoints;
         bool            buildTimeMap(void);
         public:
 /// Default constructor

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamMP3.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamMP3.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStreamMP3.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -168,7 +168,7 @@
             seek->offset=access->getPos();
             seek->timeStamp=lastDts;
             // Mark this point
-            seekPoints.push_back(seek);
+            seekPoints.append(seek);
             markCounter=0;
         }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -14,14 +14,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <vector>
+#include <BVector.h>
 #include "ADM_default.h"
 #include "ADM_audiodevice.h"
 #include "audio_out.h"
 #include "ADM_audioDeviceInternal.h"
 #include "prefs.h"
 #include "ADM_dynamicLoading.h"
-std::vector <ADM_AudioDevices *> ListOfAudioDevices;
+BVector <ADM_AudioDevices *> ListOfAudioDevices;
 
 
 static audioDeviceThreaded *device=NULL;
@@ -80,7 +80,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     if(dll->apiVersion!=ADM_AUDIO_DEVICE_API_VERSION) Fail(WrongApiVersion);
 
-    ListOfAudioDevices.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfAudioDevices.append(dll); // Needed for cleanup. FIXME TODO Delete it.
     printf("[Filters] Registered filter %s as  %s\n",file,dll->descriptor);
     return true;
 	// Fail!
@@ -107,7 +107,7 @@
                                 DummyCreateAudioDevice,
                                 DummyDeleteAudioDevice);
     
-    ListOfAudioDevices.push_back(dummyDevice); 
+    ListOfAudioDevices.append(dummyDevice); 
 	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
 	printf("[ADM_av_plugin] Scanning directory %s\n",path);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/src/ADM_dynaDemuxer.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -13,14 +13,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <vector>
+#include <BVector.h>
 #include "ADM_default.h"
 #include "ADM_demuxerInternal.h"
 bool ADM_dm_cleanup(void);
 void ADM_demuxersCleanup(void);
 vidHeader *ADM_demuxerSpawn(uint32_t magic,const char *name);
 
-std::vector <ADM_demuxer *> ListOfDemuxers;
+BVector <ADM_demuxer *> ListOfDemuxers;
 
 
 /**
@@ -54,7 +54,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     if(dll->apiVersion!=ADM_DEMUXER_API_VERSION) Fail(WrongApiVersion);
 
-    ListOfDemuxers.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfDemuxers.append(dll); // Needed for cleanup. FIXME TODO Delete it.
     printf("[Demuxers] Registered filter %s as  %s\n",file,dll->descriptor);
     return true;
 	// Fail!

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/ADM_indexFile.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/ADM_indexFile.h	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/ADM_indexFile.h	2011-09-10 15:05:40 UTC (rev 7495)
@@ -17,7 +17,7 @@
 
 #ifndef ADM_INDEXFILE_H
 #define ADM_INDEXFILE_H
-#include <vector>
+#include <BVector.h>
 /**
     \class indexFile
     \brief Read a index file easily
@@ -57,7 +57,7 @@
     void            purgeTokens(void);
 
     FILE            *file;
-    std::vector <dmxToken *> ListOfTokens;
+    BVector         <dmxToken *> ListOfTokens;
 public:
 
         indexFile();
@@ -74,4 +74,4 @@
 
 };
 
-#endif
\ No newline at end of file
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/dmx_io.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/dmx_io.h	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/include/dmx_io.h	2011-09-10 15:05:40 UTC (rev 7495)
@@ -17,8 +17,7 @@
 #ifndef FPARSER_
 #define FPARSER_
 #define DMX_BUFFER 1024*100
-#include <vector>
-using std::vector;
+#include <BVector.h>
 
 /*
         _off is the logical offset in the file
@@ -57,7 +56,7 @@
             uint64_t _off;              // Absolute offset
             
             uint32_t _curFd;        
-            vector <fdIo> listOfFd;
+            BVector <fdIo> listOfFd;
             uint64_t _head,_tail,_size;       
            
         public:

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/ADM_indexFile.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/ADM_indexFile.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/ADM_indexFile.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -92,11 +92,10 @@
 */
 void  indexFile::purgeTokens(void)
 {
-    while(ListOfTokens.size())
-    {
-        delete ListOfTokens[0];
-        ListOfTokens.erase(ListOfTokens.begin());
-    }
+    int nb=ListOfTokens.size();
+    for(int i=0;i<nb;i++)
+        delete ListOfTokens[i];
+    ListOfTokens.clear();
 }
 /**
 
@@ -193,7 +192,7 @@
             *tail=0;
             tail++;
             dmxToken *tk=new dmxToken(head,tail);
-            ListOfTokens.push_back(tk);
+            ListOfTokens.append(tk);
         }
     }
     return true;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/dmx_io.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/dmx_io.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxerMpeg/src/dmx_io.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -103,7 +103,7 @@
                 fseeko( f, 0, SEEK_SET );
                  newFd.fileSizeCumul=0;
                 _size=newFd.fileSize;
-                listOfFd.push_back(newFd);
+                listOfFd.append(newFd);
                 aprintf( " file: %s, size: %"LLU"\n", filename, newFd.fileSize );
                 aprintf( " found 1 files \n" );
                 aprintf( "Done \n" );
@@ -165,7 +165,7 @@
                 aprintf( " file %d: %s, size: %"LLU"\n", (count + 1), outName.c_str(),
                                             myFd.fileSize );
 
-                listOfFd.push_back(myFd);
+                listOfFd.append(myFd);
                 count++;
                 current++;
         } 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -14,7 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 
-#include <vector>
+#include <BVector.h>
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "ADM_muxerProto.h"
@@ -22,7 +22,7 @@
 
 ADM_muxer *ADM_muxerSpawn(uint32_t magic,const char *name);
 
-std::vector <ADM_dynMuxer *> ListOfMuxers;
+BVector <ADM_dynMuxer *> ListOfMuxers;
 /**
     \fn ADM_mux_configure
     \brief 
@@ -83,7 +83,7 @@
     if(!dll->initialised) Fail(CannotLoad);
     if(dll->apiVersion!=ADM_MUXER_API_VERSION) Fail(WrongApiVersion);
 
-    ListOfMuxers.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfMuxers.append(dll); // Needed for cleanup. FIXME TODO Delete it.
     printf("[Muxers] Registered filter %s as  %s\n",file,dll->descriptor);
     return true;
 	// Fail!

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-10 15:05:37 UTC (rev 7494)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-10 15:05:40 UTC (rev 7495)
@@ -14,6 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "ADM_cpp.h"
+#include "BVector.h"
 #include "ADM_default.h"
 
 #include <stdarg.h>
@@ -37,7 +38,7 @@
                                 {"get_file_size",tinyPy_getFileSize},
                                 {NULL,NULL}
                         };
-static vector <admPyClassDescriptor> listOfPyClass;;
+static BVector <admPyClassDescriptor> listOfPyClass;;
 
 extern void tp_hook_set_syslib(const char *sysLib);
 /**
@@ -194,7 +195,7 @@
     admPyClassDescriptor  classDesc;
     classDesc.className=string(className);
     classDesc.desc=string(desc);
-    listOfPyClass.push_back(classDesc);
+    listOfPyClass.append(classDesc);
     
     tp_set(INSTANCE, INSTANCE->builtins, tp_string(className), classPy(INSTANCE));
     return true;



From mean at mail.berlios.de  Sat Sep 10 18:05:03 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 18:05:03 +0200
Subject: [Avidemux-svn-commit] r7496 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src
Message-ID: <20110910160503.69D72481270@sheep.berlios.de>

Author: mean
Date: 2011-09-10 18:05:03 +0200 (Sat, 10 Sep 2011)
New Revision: 7496

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
Log:
[vdpau] memleak

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-10 15:05:40 UTC (rev 7495)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2011-09-10 16:05:03 UTC (rev 7496)
@@ -375,6 +375,9 @@
         destroying=true;
         destroyingFlag=true;
         destroyedList.append(VDPAU);
+        if(scratch)
+            delete scratch;
+        scratch=NULL;
         for(int i=0;i<NB_SURFACE;i++)
         {
             if(VDPAU->renders[i])



From mean at mail.berlios.de  Sat Sep 10 18:05:04 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 10 Sep 2011 18:05:04 +0200
Subject: [Avidemux-svn-commit] r7497 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav
Message-ID: <20110910160504.9B12B481270@sheep.berlios.de>

Author: mean
Date: 2011-09-10 18:05:04 +0200 (Sat, 10 Sep 2011)
New Revision: 7497

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
Log:
[lav/audio decoder] Use matching delete

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2011-09-10 16:05:03 UTC (rev 7496)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2011-09-10 16:05:04 UTC (rev 7497)
@@ -226,7 +226,7 @@
  ADM_AudiocoderLavcodec::~ADM_AudiocoderLavcodec()
  {
         avcodec_close(_context);
-        ADM_dealloc(_context);
+        av_free(_context);
         _contextVoid=NULL;
 }
 /**



From mean at mail.berlios.de  Sun Sep 11 18:42:58 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 11 Sep 2011 18:42:58 +0200
Subject: [Avidemux-svn-commit] r7499 -
	branches/avidemux_2.5_branch_gruntster/autononreg
Message-ID: <20110911164258.532B0481349@sheep.berlios.de>

Author: mean
Date: 2011-09-11 18:42:58 +0200 (Sun, 11 Sep 2011)
New Revision: 7499

Modified:
   branches/avidemux_2.5_branch_gruntster/autononreg/fpstest.js
Log:
[js] update testfps

Modified: branches/avidemux_2.5_branch_gruntster/autononreg/fpstest.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/autononreg/fpstest.js	2011-09-11 07:09:23 UTC (rev 7498)
+++ branches/avidemux_2.5_branch_gruntster/autononreg/fpstest.js	2011-09-11 16:42:58 UTC (rev 7499)
@@ -1,6 +1,6 @@
 //AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
 var app = new Avidemux();
-var file="/work/samples/2mn.avi";
+var file="/work/samples/avi/2mn.avi";
 var goodfps=23976;
 var fps;
 /* Load file
@@ -8,7 +8,7 @@
 app.load(file);
 /* Test get fps 
 */
-fps=app.video.getFps1000();
+fps=app.video.fps1000;
 //app.displayInfo("FPS "+fps);
 if(fps==goodfps)
 {
@@ -18,14 +18,14 @@
 	app.displayError("Wrong fps ");
 }
 fps=10000;
-app.video.setFps1000(fps);
+app.video.fps1000=fps;
 fps=90;
-fps=app.video.getFps1000();
+fps=app.video.fps1000;
 //app.displayInfo("FPS "+fps);
 if(fps!=10000)
 {
 	app.displayError("Testfps failed");
 }
-
+print("All ok");
 /* End of test
 */



From mean at mail.berlios.de  Sun Sep 11 18:42:59 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 11 Sep 2011 18:42:59 +0200
Subject: [Avidemux-svn-commit] r7500 -
	branches/avidemux_2.5_branch_gruntster/autononreg
Message-ID: <20110911164259.62A70481349@sheep.berlios.de>

Author: mean
Date: 2011-09-11 18:42:59 +0200 (Sun, 11 Sep 2011)
New Revision: 7500

Modified:
   branches/avidemux_2.5_branch_gruntster/autononreg/fcctest.js
Log:
[js] update fcc test

Modified: branches/avidemux_2.5_branch_gruntster/autononreg/fcctest.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/autononreg/fcctest.js	2011-09-11 16:42:58 UTC (rev 7499)
+++ branches/avidemux_2.5_branch_gruntster/autononreg/fcctest.js	2011-09-11 16:42:59 UTC (rev 7500)
@@ -1,6 +1,6 @@
 //AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
 var app = new Avidemux();
-var file="/work/samples/2mn.avi";
+var file="/work/samples/avi/2mn.avi";
 var goodfcc="DIV3";
 var fps;
 /* Load file
@@ -8,7 +8,7 @@
 app.load(file);
 /* Test get fps 
 */
-fps=app.video.getFCC();
+fps=app.video.fcc;
 //app.displayInfo("FPS "+fps);
 if(fps==goodfcc)
 {
@@ -18,6 +18,6 @@
 	app.displayError("Good:"+goodfcc+"Bad:"+fps);
 	app.displayError("Wrong fcc ");
 }
-
+print("All ok");
 /* End of test
 */



From mean at mail.berlios.de  Sun Sep 11 18:43:00 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 11 Sep 2011 18:43:00 +0200
Subject: [Avidemux-svn-commit] r7501 -
	branches/avidemux_2.5_branch_gruntster/autononreg
Message-ID: <20110911164300.5DA73481349@sheep.berlios.de>

Author: mean
Date: 2011-09-11 18:43:00 +0200 (Sun, 11 Sep 2011)
New Revision: 7501

Modified:
   branches/avidemux_2.5_branch_gruntster/autononreg/nbframestest.js
Log:
[js] update framecount test

Modified: branches/avidemux_2.5_branch_gruntster/autononreg/nbframestest.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/autononreg/nbframestest.js	2011-09-11 16:42:59 UTC (rev 7500)
+++ branches/avidemux_2.5_branch_gruntster/autononreg/nbframestest.js	2011-09-11 16:43:00 UTC (rev 7501)
@@ -1,13 +1,13 @@
 //AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
 var app = new Avidemux();
-var file="/work/samples/2mn.avi";
+var file="/work/samples/avi/2mn.avi";
 var nbf;
 /* Load file
 */
 app.load(file);
 /* Test get nbf 
 */
-nbf=app.video.getNbFrames();
+nbf=app.video.frameCount;
 	displayInfo("Nb frames:"+nbf);
 
 /* End of test



From mean at mail.berlios.de  Sun Sep 11 18:43:01 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 11 Sep 2011 18:43:01 +0200
Subject: [Avidemux-svn-commit] r7502 -
	branches/avidemux_2.5_branch_gruntster/autononreg
Message-ID: <20110911164301.55C3C481349@sheep.berlios.de>

Author: mean
Date: 2011-09-11 18:43:01 +0200 (Sun, 11 Sep 2011)
New Revision: 7502

Modified:
   branches/avidemux_2.5_branch_gruntster/autononreg/width.js
Log:
[js] update width test

Modified: branches/avidemux_2.5_branch_gruntster/autononreg/width.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/autononreg/width.js	2011-09-11 16:43:00 UTC (rev 7501)
+++ branches/avidemux_2.5_branch_gruntster/autononreg/width.js	2011-09-11 16:43:01 UTC (rev 7502)
@@ -1,6 +1,6 @@
 //AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
 var app = new Avidemux();
-var file="/work/samples/2mn.avi";
+var file="/work/samples/avi/2mn.avi";
 var goodwidth=512;
 var goodheight=384;
 var fps;
@@ -9,7 +9,7 @@
 app.load(file);
 /* Test get fps 
 */
-fps=app.video.getWidth();
+fps=app.video.width;
 //app.displayInfo("FPS "+fps);
 if(fps==goodwidth)
 {
@@ -18,7 +18,7 @@
 {
 	app.displayError("Wrong width "+fps+"expected "+goodwidth);
 }
-fps=app.video.getHeight();
+fps=app.video.height;
 //app.displayInfo("FPS "+fps);
 if(fps==goodheight)
 {
@@ -28,6 +28,6 @@
 	app.displayError("Wrong height "+fps+"expected "+goodheight);
 }
 
-
+print("all ok");
 /* End of test
 */



From mean at mail.berlios.de  Mon Sep 12 11:22:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:19 +0200
Subject: [Avidemux-svn-commit] r7503 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/vdpauFilters
Message-ID: <20110912092219.A1A20481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:19 +0200 (Mon, 12 Sep 2011)
New Revision: 7503

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/vdpauFilters/ADM_vidVdpauFilter.cpp
Log:
[vdpau] Speed up vdpau resize filter using identity matrix

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/vdpauFilters/ADM_vidVdpauFilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/vdpauFilters/ADM_vidVdpauFilter.cpp	2011-09-11 16:43:01 UTC (rev 7502)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/vdpauFilters/ADM_vidVdpauFilter.cpp	2011-09-12 09:22:19 UTC (rev 7503)
@@ -46,6 +46,7 @@
                     uint32_t             currentIndex;
                     VdpVideoMixer        mixer;
                     bool                 uploadImage(ADMImage *next,uint32_t surfaceIndex,uint32_t frameNumber) ;
+                    bool                 setIdentityCSC(void);
 
 public:
         virtual bool         goToTime(uint64_t usSeek); 
@@ -68,6 +69,23 @@
                         "vdpau: Resize image using vdpau." // Description
                     );
 
+/**
+    \fn setIdentityCSC
+    \brief set the RGB/YUV matrix to identity so that data are still YUV at the end
+            Should not work, but it does.
+*/
+bool vdpauVideoFilter::setIdentityCSC(void)
+{
+    ADM_info("Setting custom CSC\n");
+    const VdpCSCMatrix   matrix={{1.,0,0,0},{0,1.,0,0},{0,0,1.,0}};    
+    VdpVideoMixerAttribute attributes_key[]={VDP_VIDEO_MIXER_ATTRIBUTE_CSC_MATRIX};
+    const void * attribute_values[] = {&matrix};
+    
+    VdpStatus st = admVdpau::mixerSetAttributesValue(mixer, 1,attributes_key, (void * const *)attribute_values);
+    if(st!=VDP_STATUS_OK)
+        ADM_error("Cannot set custom matrix (CSC)\n");
+    return true;
+}
 //
 /**
     \fn goToTime
@@ -118,6 +136,7 @@
         ADM_error("Cannot create mixer\n");
         goto badInit;
     } 
+    setIdentityCSC();
     tempBuffer=new uint8_t[info.width*info.height*4];
     scaler=new ADMColorScalerSimple( info.width,info.height, ADM_COLOR_RGB32A,ADM_COLOR_YV12);
     ADM_info("VDPAU setup ok\n");
@@ -249,7 +268,7 @@
     next->GetReadPlanes(planes);
 
     // Put out stuff in input...
-    printf("Uploading image to surface %d\n",surfaceIndex%ADM_NB_SURFACES);
+    //printf("Uploading image to surface %d\n",surfaceIndex%ADM_NB_SURFACES);
 
     if(VDP_STATUS_OK!=admVdpau::surfacePutBits( 
             input[surfaceIndex%ADM_NB_SURFACES],
@@ -267,7 +286,7 @@
 */
 bool vdpauVideoFilter::getNextFrame(uint32_t *fn,ADMImage *image)
 {
-    
+     bool r=false;
      if(passThrough) return previousFilter->getNextFrame(fn,image);
     // regular image, in fact we get the next image here
     VdpVideoSurface tmpSurface=VDP_INVALID_HANDLE;
@@ -286,7 +305,7 @@
         printf("image is already vdpau %d\n",(int)tmpSurface);
     }else
     {
-        printf("Uploading image to vdpau\n");
+        //printf("Uploading image to vdpau\n");
         if(false==uploadImage(next,0,nextFrame)) 
                 {
                     vidCache->unlockAll();
@@ -314,29 +333,13 @@
         vidCache->unlockAll();
         return false;
     }
-    // Convert from VDP_RGBA_FORMAT_B8G8R8A8 to YV12
-    uint32_t sourceStride[3]={info.width*4,0,0};
-    uint8_t  *sourceData[3]={tempBuffer,NULL,NULL};
-    uint32_t destStride[3];
-    uint8_t  *destData[3];
-
-    image->GetPitches(destStride);
-    image->GetWritePlanes(destData);
-
-    // Invert U&V
-    uint32_t ts;
-    uint8_t  *td;
-#if 0
-    ts=destStride[2];destStride[2]=destStride[1];destStride[1]=ts;
-    td=destData[2];destData[2]=destData[1];destData[1]=td;
-#endif
-    scaler->convertPlanes(  sourceStride,destStride,     
-                            sourceData,destData);
+    r=image->convertFromYUV444(tempBuffer);
+   
     nextFrame++;
     currentIndex++;
     vidCache->unlockAll();
     
-    return true;
+    return r;
 }
 #else // USE_VDPAU
 static void dumy_func2(void)



From mean at mail.berlios.de  Mon Sep 12 11:22:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:20 +0200
Subject: [Avidemux-svn-commit] r7504 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <20110912092220.A9F3C481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:20 +0200 (Mon, 12 Sep 2011)
New Revision: 7504

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
Log:
[all] Remove some unused vars

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-12 09:22:19 UTC (rev 7503)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-12 09:22:20 UTC (rev 7504)
@@ -89,6 +89,7 @@
     wavbuf=NULL;
     videoFilter=NULL;
     videoChain=NULL;
+    initialized=false;
 }
 /**
     \fn ~GUIPlayback

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2011-09-12 09:22:19 UTC (rev 7503)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2011-09-12 09:22:20 UTC (rev 7504)
@@ -152,7 +152,6 @@
   uint32_t written, max;
   uint64_t dts;
   DIA_workingBase *work;
-  FILE *out;
 #define ONE_STRIKE (64*1024)
   uint8_t *buffer=NULL;
 



From mean at mail.berlios.de  Mon Sep 12 11:22:21 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:21 +0200
Subject: [Avidemux-svn-commit] r7505 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110912092221.C0CC8481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:21 +0200 (Mon, 12 Sep 2011)
New Revision: 7505

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[glRender] optimize

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:20 UTC (rev 7504)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:21 UTC (rev 7505)
@@ -32,7 +32,14 @@
 static const char *yuvToRgb =
 	"#extension GL_ARB_texture_rectangle: enable\n"
 	"uniform sampler2DRect texY, texU, texV;\n"
-	"uniform float height;\n"
+	"uniform float height;\n"
+    "const mat4 mytrix=mat4( 1,   0,         1.5958,   0,"
+                            "1,  -0.39173,  -0.81290,  0,"
+                            "1,   2.017,      0,       0,"
+                            "0,        0,     0,       1);\n"
+                            
+    "const vec4 offsetx=vec4(-0.07276875,-0.5,-0.5,0);\n"
+    "const vec4 factorx=vec4(1.1643,1,1,1);\n"
 
 	"void main(void) {\n"
 	"  float nx = gl_TexCoord[0].x;\n"
@@ -41,15 +48,10 @@
 	"  float u = texture2DRect(texU, vec2(nx / 2.0, ny / 2.0)).r;\n"
 	"  float v = texture2DRect(texV, vec2(nx / 2.0, ny / 2.0)).r;\n"
 
-	"  y = 1.1643 * (y - 0.0625);\n"
-	"  u = u - 0.5;\n"
-	"  v = v - 0.5;\n"
-
-	"  float r = y + 1.5958 * v;\n"
-	"  float g = y - 0.39173 * u - 0.81290 * v;\n"
-	"  float b = y + 2.017 * u;\n"
-
-	"  gl_FragColor = vec4(r, g, b, 1.0);\n"
+    "  vec4 inx=vec4(y,u,v,1.0);\n"
+    "  vec4 inx2=(factorx*inx)+offsetx;\n"
+    "  vec4 outx=inx2*mytrix;\n"
+	"  gl_FragColor = outx;\n"
 	"}\n";
 
 /**
@@ -321,10 +323,12 @@
 bool QtGlRender::changeZoom(renderZoom newZoom)
 {
     ADM_info("changing zoom, qtGl render.\n");
+    glWidget->makeCurrent();
     calcDisplayFromZoom(newZoom);
     currentZoom=newZoom;
     glWidget->setDisplaySize(displayWidth,displayHeight);
     glWidget->repaint();
+    glWidget->doneCurrent();
     return true;
 }
 /**



From mean at mail.berlios.de  Mon Sep 12 11:22:22 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:22 +0200
Subject: [Avidemux-svn-commit] r7506 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110912092222.D4B32481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:22 +0200 (Mon, 12 Sep 2011)
New Revision: 7506

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[glRender] Optimize more

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:21 UTC (rev 7505)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:22 UTC (rev 7506)
@@ -40,13 +40,16 @@
                             
     "const vec4 offsetx=vec4(-0.07276875,-0.5,-0.5,0);\n"
     "const vec4 factorx=vec4(1.1643,1,1,1);\n"
+    "const vec2 factorTex=vec2(0.5,0.5);"
 
 	"void main(void) {\n"
 	"  float nx = gl_TexCoord[0].x;\n"
-	"  float ny = height - gl_TexCoord[0].y;\n"
-	"  float y = texture2DRect(texY, vec2(nx, ny)).r;\n"
-	"  float u = texture2DRect(texU, vec2(nx / 2.0, ny / 2.0)).r;\n"
-	"  float v = texture2DRect(texV, vec2(nx / 2.0, ny / 2.0)).r;\n"
+	"  float ny = height - gl_TexCoord[0].y;\n"
+    "  vec2 coord=vec2(nx,ny);"
+    "  vec2 coord2=coord*factorTex;"
+	"  float y = texture2DRect(texY, coord).r;\n"
+	"  float u = texture2DRect(texU, coord2).r;\n"
+	"  float v = texture2DRect(texV, coord2).r;\n"
 
     "  vec4 inx=vec4(y,u,v,1.0);\n"
     "  vec4 inx2=(factorx*inx)+offsetx;\n"



From mean at mail.berlios.de  Mon Sep 12 11:22:23 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:23 +0200
Subject: [Avidemux-svn-commit] r7507 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <20110912092224.09268481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:23 +0200 (Mon, 12 Sep 2011)
New Revision: 7507

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
Log:
[render] Dont forget current zoom when performing playback

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-12 09:22:22 UTC (rev 7506)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-12 09:22:23 UTC (rev 7507)
@@ -116,8 +116,14 @@
  // but it does not really harm
   renderHookRefreshRequest(admPreview::updateImage);
 }
+/**
+    \fn getCurrentZoom
+*/
+renderZoom admPreview::getCurrentZoom()
+{
+    return zoom;
+}
 
-
 /**
       \fn getPreviewMode
       \brief returns current preview mode

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2011-09-12 09:22:22 UTC (rev 7506)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2011-09-12 09:22:23 UTC (rev 7507)
@@ -45,5 +45,6 @@
       static void destroy(void);
       static bool updateImage(void);
       static ADM_HW_IMAGE getPreferedHwImageFormat(void);
+      static renderZoom getCurrentZoom();
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-12 09:22:22 UTC (rev 7506)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-12 09:22:23 UTC (rev 7507)
@@ -111,6 +111,7 @@
     uint32_t max,err;
     uint64_t oldTimeFrame;
     aviInfo info;
+    renderZoom oldZoom=admPreview::getCurrentZoom();
     video_body->getVideoInfo(&info);
 
     // check we got everything...
@@ -146,7 +147,7 @@
    // Resize the output window to original size...
    ADM_info("Restoring display.\n");
    
-   admPreview::setMainDimension(info.width,info.height,ZOOM_AUTO);
+   admPreview::setMainDimension(info.width,info.height,oldZoom);
    admPreview::seekToTime(oldTimeFrame);
    UI_purge();
    



From mean at mail.berlios.de  Mon Sep 12 11:22:25 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:25 +0200
Subject: [Avidemux-svn-commit] r7508 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110912092225.30168481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:24 +0200 (Mon, 12 Sep 2011)
New Revision: 7508

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
Log:
[qtGl render] Factorize openGl init, display glError if any

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:23 UTC (rev 7507)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:24 UTC (rev 7508)
@@ -27,8 +27,8 @@
 #include "GUI_render.h"
 
 #include "GUI_accelRender.h"
-#include "GUI_qtGlRender.h"
-
+#include "GUI_qtGlRender.h"
+
 static const char *yuvToRgb =
 	"#extension GL_ARB_texture_rectangle: enable\n"
 	"uniform sampler2DRect texY, texU, texV;\n"
@@ -57,12 +57,57 @@
 	"  gl_FragColor = outx;\n"
 	"}\n";
 
+typedef void (*_glActiveTexture) (GLenum);
+static _glActiveTexture myGlActiveTexture=NULL;
+
+static bool initedOnced=false;
+static bool initedValue=false;
 /**
+    \fn checkGlError
+*/
+static bool checkGlError(const char *op)
+{
+#if 1
+    GLenum er=glGetError();
+    if(!er) return true;
+    ADM_error("[GLERROR]%s: %d => %s\n",op,er,gluErrorString(er));
+    return false;
+#else
+
+    return true;
+#endif
+}          
+
+
+/**
+    \fn initOnce
+*/
+static bool initOnce(QGLWidget *widget)
+{
+    if(initedOnced) return initedValue;
+
+	myGlActiveTexture = (_glActiveTexture)widget->context()->getProcAddress(QLatin1String("glActiveTexture"));
+    initedOnced=true;
+	if (!myGlActiveTexture)
+	{
+		initedValue = false;
+		printf("[GL Render] Active Texture function not found!\n");
+        return false;
+	}
+    initedValue=true;
+	printf("[GL Render] OpenGL Vendor: %s\n", glGetString(GL_VENDOR));
+	printf("[GL Render] OpenGL Renderer: %s\n", glGetString(GL_RENDERER));
+	printf("[GL Render] OpenGL Version: %s\n", glGetString(GL_VERSION));
+	printf("[GL Render] OpenGL Extensions: %s\n", glGetString(GL_EXTENSIONS));
+    return true;
+}
+/**
     \fn ctor
 */
 
 QtGlAccelWidget::QtGlAccelWidget(QWidget *parent, int w, int h) : QGLWidget(parent)
-{
+{
+    ADM_info("\t Creating glWidget\n");
 	memset(textureRealWidths, 0, sizeof(textureRealWidths));
     memset(textureStrides, 0, sizeof(textureStrides));
 	memset(textureHeights, 0, sizeof(textureHeights));
@@ -90,6 +135,7 @@
 */
 QtGlAccelWidget::~QtGlAccelWidget()
 {
+    ADM_info("\t Deleting glWidget\n");
     if(glProgram) delete glProgram;
     glProgram=NULL;
     if(textureName[0])
@@ -127,24 +173,13 @@
 void QtGlAccelWidget::initializeGL()
 {
 	int success = 1;
-
-#ifndef QT_OPENGL_ES
-	glActiveTexture = (_glActiveTexture)this->context()->getProcAddress(QLatin1String("glActiveTexture"));
-
-	if (!glActiveTexture)
-	{
-		success = 0;
-		printf("[GL Render] Active Texture function not found!\n");
-	}
-#endif
-
-	printf("[GL Render] OpenGL Vendor: %s\n", glGetString(GL_VENDOR));
-	printf("[GL Render] OpenGL Renderer: %s\n", glGetString(GL_RENDERER));
-	printf("[GL Render] OpenGL Version: %s\n", glGetString(GL_VERSION));
-	printf("[GL Render] OpenGL Extensions: %s\n", glGetString(GL_EXTENSIONS));
 
-
-
+    if(!initOnce(this))
+    {
+        ADM_warning("No QtGl support\n");
+        success=false;
+        
+    }
 	glProgram = new QGLShaderProgram(this);
 
 	if (success && !glProgram->addShaderFromSourceCode(QGLShader::Fragment, yuvToRgb))
@@ -176,13 +211,17 @@
 */
 void QtGlAccelWidget::updateTexture()
 {
-    
+    checkGlError("Entering UpdateTexture");
 	if (!textureOffsets[0])
 	{
 		printf("[Render] Buffer not set\n");
 		return;
 	}
-
+    if(!myGlActiveTexture)
+    {
+        ADM_error("No glActiveTexture\n");
+        return;
+    }
 	if (firstRun)
 	{
 		glViewport(0, 0, width(), height());
@@ -193,25 +232,27 @@
 	}
 
 //--
+        
       // Activate texture unit "tex"
         for(int xplane=2;xplane>=0;xplane--)
         {
-            glActiveTexture(GL_TEXTURE0+xplane);
+            myGlActiveTexture(GL_TEXTURE0+xplane);
             ADM_PLANE plane=(ADM_PLANE)xplane;
             glBindTexture(GL_TEXTURE_RECTANGLE_NV, textureName[xplane]); // Use tex engine "texNum"
             glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
             glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
             glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
             glTexParameteri(GL_TEXTURE_RECTANGLE_NV, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
-            glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+            glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
 
-                if(!firstRun)
+                if(firstRun)
                 {
                     glTexImage2D(GL_TEXTURE_RECTANGLE_NV, 0, GL_LUMINANCE, 
                                     textureStrides[xplane],
                                     textureHeights[xplane],
                                     0, GL_LUMINANCE, GL_UNSIGNED_BYTE, 
                                     textureOffsets[xplane]);
+                    checkGlError("texImage2D");
                 }else
                 {
                     glTexSubImage2D(GL_TEXTURE_RECTANGLE_NV, 0, 0, 0, 
@@ -219,9 +260,10 @@
                         textureHeights[xplane],
                         GL_LUMINANCE, GL_UNSIGNED_BYTE, 
                         textureOffsets[xplane]);
+                    checkGlError("subImage2D");
                 }
         }
-
+        
 	if (firstRun)
 	{
 		firstRun = false;
@@ -237,7 +279,8 @@
 	glProgram->setUniformValue("texU", 2);
 	glProgram->setUniformValue("texV", 1);
     glProgram->setUniformValue("height", (float)imageHeight);
-
+    checkGlError("setUniformValue");
+    
     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 	glBegin(GL_QUADS);
 	glTexCoord2i(0, 0);
@@ -256,7 +299,8 @@
     \fn ctor
 */
 QtGlRender::QtGlRender(void)
-{
+{
+    ADM_info("Creating GL Renderer\n");
 	glWidget = NULL;
 
 }
@@ -264,7 +308,8 @@
     \fn dtor
 */
 QtGlRender::~QtGlRender(void)
-{
+{
+    ADM_info("Destroying GL Renderer\n");
 	stop();
 }
 
@@ -274,7 +319,7 @@
 
 bool QtGlRender::stop(void)
 {
-	printf("[GL Render] Renderer closed\n");
+	ADM_info("[GL Render] Renderer closed\n");
 	if (glWidget)
 		delete glWidget;
     glWidget=NULL;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-09-12 09:22:23 UTC (rev 7507)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-09-12 09:22:24 UTC (rev 7508)
@@ -19,13 +19,16 @@
 #include "GUI_render.h"
 #include "GUI_accelRender.h"
 #include "ADM_colorspace.h"
-
+/**
+    \class QtGlAccelWidget
+*/
 class QtGlAccelWidget : public QGLWidget
 {
 private:
 	int             imageWidth, imageHeight;
     int             displayWidth,displayHeight;
-	bool            firstRun;
+	bool            firstRun;
+    
 
 	QGLShaderProgram *glProgram;
 	GLsizei textureRealWidths[3];
@@ -33,10 +36,6 @@
 	GLsizei textureHeights[3];
 	uint8_t *textureOffsets[3];
     GLuint  textureName[3];
-#ifndef QT_OPENGL_ES
-	typedef void (*_glActiveTexture) (GLenum);
-	_glActiveTexture glActiveTexture;
-#endif
 
 protected:
 	void initializeGL();
@@ -51,7 +50,7 @@
 };
 
 /**
-    \fn class XvRender
+    \fn class QtGlRender
 */
 class QtGlRender: public VideoRenderBase
 {



From mean at mail.berlios.de  Mon Sep 12 11:22:26 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 11:22:26 +0200
Subject: [Avidemux-svn-commit] r7509 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110912092226.3E220481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 11:22:26 +0200 (Mon, 12 Sep 2011)
New Revision: 7509

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[glRender] Release shader prior to deleting it

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:24 UTC (rev 7508)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-12 09:22:26 UTC (rev 7509)
@@ -136,7 +136,12 @@
 QtGlAccelWidget::~QtGlAccelWidget()
 {
     ADM_info("\t Deleting glWidget\n");
-    if(glProgram) delete glProgram;
+    if(glProgram) 
+    {
+        
+        glProgram->release();
+        delete glProgram;
+    }
     glProgram=NULL;
     if(textureName[0])
         glDeleteTextures(3,textureName);
@@ -292,6 +297,7 @@
 	glTexCoord2i(0, imageHeight);
 	glVertex2i(0, height());
 	glEnd();
+    checkGlError("draw");
     
 }
 //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!



From mean at mail.berlios.de  Mon Sep 12 16:44:08 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 16:44:08 +0200
Subject: [Avidemux-svn-commit] r7510 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	. glResize
Message-ID: <20110912144408.4475D481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 16:44:07 +0200 (Mon, 12 Sep 2011)
New Revision: 7510

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_json.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.ui
Log:
[gl] New filter : resize usingopenGl

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/CMakeLists.txt	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,7 @@
+INCLUDE(vf_plugin)
+INCLUDE(vf_plugin_qt4gl)
+
+
+SET(ADM_vf_sampleGlFrag_SRCS sampleGl.cpp)
+INIT_VIDEO_FILTER_GLQT4(ADM_vf_glResize "${ADM_vf_sampleGlFrag_SRCS}" "sampleGl.h" "sampleGl" "${ADM_vf_sampleGl_SRCS}")
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.conf	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.conf	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,4 @@
+gl_resize{
+uint32_t:width;
+uint32_t:height;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize.h	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,8 @@
+// automatically generated by admSerialization.py do not edit
+#ifndef ADM_gl_resize_CONF_H
+#define ADM_gl_resize_CONF_H
+typedef struct {
+uint32_t width;
+uint32_t height;
+}gl_resize;
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_desc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_desc.cpp	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,6 @@
+// automatically generated by admSerialization.py, do not edit!
+extern const ADM_paramList gl_resize_param[]={
+ {"width",offsetof(gl_resize,width),"uint32_t",ADM_param_uint32_t},
+ {"height",offsetof(gl_resize,height),"uint32_t",ADM_param_uint32_t},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_json.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/resize_json.cpp	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,19 @@
+// automatically generated by admSerialization.py, do not edit!
+#include "ADM_default.h"
+#include "ADM_paramList.h"
+#include "ADM_coreJson.h"
+#include "resize.h"
+bool  gl_resize_jserialize(const char *file, const gl_resize *key){
+admJson json;
+json.addUint32("width",key->width);
+json.addUint32("height",key->height);
+return json.dumpToFile(file);
+};
+bool  gl_resize_jdeserialize(const char *file, const ADM_paramList *tmpl,gl_resize *key){
+admJsonToCouple json;
+CONFcouple *c=json.readFromFile(file);
+if(!c) {ADM_error("Cannot read json file");return false;}
+bool r= ADM_paramLoadPartial(c,tmpl,key);
+delete c;
+return r;
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,202 @@
+/** *************************************************************************
+                    \fn       openGlFragmentSample.cpp  
+                    \brief    simple fragment shader
+
+    This one is combining the 3 textures and apply the shader once
+
+
+    copyright            : (C) 2011 by mean
+
+bench : 1280*720, null shader, 20 ms, 95% of it in download texture.
+            Download Texture
+                RGB2Y=5ms               (MMX it)
+                toQimage=14 ms  <<==    TOO SLOW
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_openGL.h"
+#define ADM_LEGACY_PROGGY
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "T_openGL.h"
+#include "T_openGLFilter.h"
+#include "sampleGl.h"
+#include "ADM_clock.h"
+#include "DIA_factory.h"
+
+
+#include "resize.h"
+#include "resize_desc.cpp"
+
+/**
+    \class openGlResize
+*/
+class openGlResize : public  ADM_coreVideoFilterQtGl
+{
+protected:
+
+protected:
+                ADMImage    *original;
+                gl_resize    configuration;
+                        bool render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo);
+public:
+                             openGlResize(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                            ~openGlResize();
+
+        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+                bool         configure( void) ;
+};
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   openGlResize,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_QT4+ADM_UI_GL,         // UI
+                        VF_OPENGL,            // Category
+                        "glResize",            // internal name (must be uniq!)
+                        "OpenGl Resize",            // Display name
+                        "Resize using openGl." // Description
+                    );
+
+// Now implements the interesting parts
+/**
+    \fn openGlResize
+    \brief constructor
+*/
+openGlResize::openGlResize(  ADM_coreVideoFilter *in,CONFcouple *setup) : ADM_coreVideoFilterQtGl(in,setup)
+{
+UNUSED_ARG(setup);
+        if(!setup || !ADM_paramLoad(setup,gl_resize_param,&configuration))
+        {
+            // Default value
+            configuration.width=info.width;
+            configuration.height=info.height;
+        }
+        original=new ADMImageDefault(in->getInfo()->width,in->getInfo()->height);
+        info.width=configuration.width;
+        info.height=configuration.height;
+        resizeFBO(info.width,info.height);
+}
+        
+/**
+    \fn openGlResize
+    \brief destructor
+*/
+openGlResize::~openGlResize()
+{
+        delete original;
+        original=NULL;
+}
+
+/**
+    \fn getFrame
+    \brief Get a processed frame
+*/
+bool openGlResize::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+    // since we do nothing, just get the output of previous filter
+    if(false==previousFilter->getNextFrame(fn,original))
+    {
+        ADM_warning("FlipFilter : Cannot get frame\n");
+        return false;
+    }
+    widget->makeCurrent();
+    glPushMatrix();
+    fboY->bind();
+    checkGlError("bind");
+    uploadAllPlanes(original);
+    render(image,PLANAR_Y,fboY);
+    downloadTextures(image,fboY);
+    image->copyInfo(original);
+    firstRun=false;
+    fboY->release();
+    glPopMatrix();
+    widget->doneCurrent();
+    checkGlError("last");
+    return true;
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         openGlResize::getCoupledConf(CONFcouple **couples)
+{
+    return ADM_paramSave(couples, gl_resize_param,&configuration);
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *openGlResize::getConfiguration(void)
+{
+    static char bfer[256];
+    snprintf(bfer,255,"Resize to %d x %d.",(int)configuration.width,(int)configuration.height);
+    return bfer;
+}
+
+
+/**
+    \fn render
+*/
+bool openGlResize::render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo)
+{
+    int width=image->GetWidth(plane);
+    int height=image->GetHeight(plane);
+
+    int orgwidth=previousFilter->getInfo()->width;
+    int orgheight=previousFilter->getInfo()->height;
+
+    glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);
+	glViewport(0, 0, width, height);
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0, width, 0, height, -1, 1);
+    checkGlError("setup");
+    //
+    glBegin(GL_QUADS);
+        glTexCoord2i(0, 0);
+        glVertex2i(0, 0);
+        glTexCoord2i(orgwidth, 0);
+        glVertex2i(width, 0);
+        glTexCoord2i(orgwidth, orgheight);
+        glVertex2i(width ,height);
+        glTexCoord2i(0, orgheight);
+        glVertex2i(0, height);
+	glEnd();	// draw cube background
+    checkGlError("Draw");
+    return true;
+}
+/**
+    \fn updateInfo
+*/
+bool openGlResize::configure( void) 
+{
+    
+     
+     diaElemUInteger  tWidth(&(configuration.width),QT_TR_NOOP("Width :"),16,2048);
+     diaElemUInteger  tHeight(&(configuration.height),QT_TR_NOOP("Height :"),16,2048);
+     
+     diaElem *elems[]={&tWidth,&tHeight};
+     
+     if(diaFactoryRun(QT_TR_NOOP("glResize"),sizeof(elems)/sizeof(diaElem *),elems))
+     {
+                info.width=configuration.width;
+                info.height=configuration.height;
+                ADM_info("New dimension : %d x %d\n",info.width,info.height);
+                firstRun=true;
+                resizeFBO(info.width,info.height);
+                return 1;
+     }
+    
+     return 0;
+}
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,23 @@
+// Invert x & y
+static const char *myShaderY =
+	"#extension GL_ARB_texture_rectangle: enable\n"
+	"uniform sampler2DRect myTextureY;\n" // tex unit 0
+    "uniform sampler2DRect myTextureU;\n" // tex unit 1
+    "uniform sampler2DRect myTextureV;\n" // tex unit 2
+    "uniform float myWidth;\n"
+    "uniform float myHeight;\n"
+    "uniform float teta;\n"
+
+	"void main(void) {\n"
+    "  float mx = gl_TexCoord[0].x-myWidth/2;\n"
+	"  float my = gl_TexCoord[0].y-myHeight/2;\n"
+    "  float c=cos(teta); \n"
+    "  float s=sin(teta); \n"
+    "  float nx=mx*c-my*s;\n"
+    "  float ny=mx*s+my*c;\n"
+    "  vec4 texvalV = texture2DRect(myTextureV, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, vec2(nx+myWidth/2,ny+myHeight/2));\n"
+	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
+	"}\n";
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.ui	2011-09-12 14:44:07 UTC (rev 7510)
@@ -0,0 +1,724 @@
+<ui version="4.0" >
+ <class>resizeDialog</class>
+ <widget class="QDialog" name="resizeDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>350</width>
+    <height>342</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Resize</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <widget class="QGroupBox" name="groupBox_2" >
+     <property name="title" >
+      <string>Aspect Ratio</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <widget class="QCheckBox" name="lockArCheckBox" >
+        <property name="text" >
+         <string>Lock Aspect Ratio</string>
+        </property>
+        <property name="checked" >
+         <bool>true</bool>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label_4" >
+          <property name="text" >
+           <string>Source:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxSource" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_3" >
+          <property name="text" >
+           <string>Destination:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxDestination" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox" >
+     <property name="title" >
+      <string>Resize Dimensions</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label" >
+          <property name="text" >
+           <string>Width:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxWidth" >
+          <property name="maximum" >
+           <number>2900</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_2" >
+          <property name="text" >
+           <string>Height:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxHeight" >
+          <property name="maximum" >
+           <number>2000</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <widget class="QCheckBox" name="checkBoxRoundup" >
+        <property name="text" >
+         <string>Round to the Nearest Multiple of 16</string>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Vertical</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>312</width>
+          <height>4</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>12</number>
+          </property>
+          <item>
+           <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QLabel" name="label_8" >
+                <property name="text" >
+                 <string>1%</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_5" >
+                <property name="text" >
+                 <string>Percent</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_9" >
+                <property name="text" >
+                 <string>200%</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <widget class="QSlider" name="horizontalSlider" >
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="maximum" >
+               <number>200</number>
+              </property>
+              <property name="value" >
+               <number>100</number>
+              </property>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QSpinBox" name="percentageSpinBox" >
+            <property name="maximum" >
+             <number>200</number>
+            </property>
+            <property name="minimum" >
+             <number>1</number>
+            </property>
+            <property name="value" >
+             <number>100</number>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <widget class="QLabel" name="label_10" >
+            <property name="text" >
+             <string>Error X / Y:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="labelErrorXY" >
+            <property name="text" >
+             <string>0.00 / 0.00</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>40</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Fixed</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>332</width>
+       <height>6</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label_6" >
+       <property name="text" >
+        <string>Resize Method:</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QComboBox" name="comboBoxAlgo" >
+       <item>
+        <property name="text" >
+         <string>Bilinear</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Bicubic</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Lanzcos3</string>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::MinimumExpanding</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>16</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>lockArCheckBox</tabstop>
+  <tabstop>comboBoxSource</tabstop>
+  <tabstop>comboBoxDestination</tabstop>
+  <tabstop>spinBoxWidth</tabstop>
+  <tabstop>spinBoxHeight</tabstop>
+  <tabstop>checkBoxRoundup</tabstop>
+  <tabstop>horizontalSlider</tabstop>
+  <tabstop>percentageSpinBox</tabstop>
+  <tabstop>comboBoxAlgo</tabstop>
+  <tabstop>buttonBox</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>resizeDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_8</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>39</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_5</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>150</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_9</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>267</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>horizontalSlider</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>156</x>
+     <y>164</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>percentageSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>317</x>
+     <y>155</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>checkBoxRoundup</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>95</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_10</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>55</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>labelErrorXY</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>114</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_4</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>46</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxSource</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>94</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_3</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>188</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxDestination</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>247</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From mean at mail.berlios.de  Mon Sep 12 16:44:09 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 16:44:09 +0200
Subject: [Avidemux-svn-commit] r7511 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs: include src
Message-ID: <20110912144409.AECD3481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 16:44:09 +0200 (Mon, 12 Sep 2011)
New Revision: 7511

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[Gl] Add resizeFBO

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-12 14:44:07 UTC (rev 7510)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGLFilter.h	2011-09-12 14:44:09 UTC (rev 7511)
@@ -35,6 +35,9 @@
                             QGLShaderProgram     *glProgramUV;
                             int                   firstRun;
                             GLuint                texName[3];
+
+                            bool                  resizeFBO(uint32_t w,uint32_t h);
+
 protected:
                             // image <--> texture
                             void uploadAllPlanes(ADMImage *image);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-12 14:44:07 UTC (rev 7510)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-12 14:44:09 UTC (rev 7511)
@@ -177,6 +177,15 @@
     // glTexture TODO
 }
 /**
+    \fn resizeFBO
+*/
+bool ADM_coreVideoFilterQtGl::resizeFBO(uint32_t w,uint32_t h)
+{
+    if(fboY) delete fboY;
+    fboY=new QGLFramebufferObject(w,h);
+    return true;
+}
+/**
     \fn dtor
 */
 ADM_coreVideoFilterQtGl::~ADM_coreVideoFilterQtGl()



From mean at mail.berlios.de  Mon Sep 12 16:44:10 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 16:44:10 +0200
Subject: [Avidemux-svn-commit] r7512 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src
Message-ID: <20110912144410.D41F8481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 16:44:10 +0200 (Mon, 12 Sep 2011)
New Revision: 7512

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
Log:
[tinypy] Use right size for BVector as we use a complex type (cannot grow)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-12 14:44:09 UTC (rev 7511)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-12 14:44:10 UTC (rev 7512)
@@ -38,7 +38,7 @@
                                 {"get_file_size",tinyPy_getFileSize},
                                 {NULL,NULL}
                         };
-static BVector <admPyClassDescriptor> listOfPyClass;;
+static BVector <admPyClassDescriptor> listOfPyClass(20);; // warning exceeding it will cause a crash!
 
 extern void tp_hook_set_syslib(const char *sysLib);
 /**



From mean at mail.berlios.de  Mon Sep 12 16:44:11 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 16:44:11 +0200
Subject: [Avidemux-svn-commit] r7513 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl
Message-ID: <20110912144411.EE3CC481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 16:44:11 +0200 (Mon, 12 Sep 2011)
New Revision: 7513

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
Log:
[gl] Add new filter (not working)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-12 14:44:10 UTC (rev 7512)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-12 14:44:11 UTC (rev 7513)
@@ -6,3 +6,4 @@
 ADD_SUBDIRECTORY(glBenchmark)
 #ADD_SUBDIRECTORY(sample_vertex)
 #ADD_SUBDIRECTORY(glVdpau)
+ADD_SUBDIRECTORY(glResize)



From mean at mail.berlios.de  Mon Sep 12 16:44:13 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Sep 2011 16:44:13 +0200
Subject: [Avidemux-svn-commit] r7514 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src
Message-ID: <20110912144413.55C80481300@sheep.berlios.de>

Author: mean
Date: 2011-09-12 16:44:13 +0200 (Mon, 12 Sep 2011)
New Revision: 7514

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[gl] dont destroy widget, let qt do it, even if it might be a mem leak

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-12 14:44:11 UTC (rev 7513)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-12 14:44:13 UTC (rev 7514)
@@ -200,7 +200,9 @@
     fboY=NULL;
     if(fboUV) delete fboUV;
     fboUV=NULL;
-    if(widget) delete widget;       
+    // MEMLEAK : CAUSE A CRASH
+    // Will be deleted when top level widget is cleared out by Qt
+    //if(widget) delete widget;       
     widget=NULL;
     if(ADM_glHasARB)
         ADM_glExt::deleteBuffers(1,&bufferARB);



From gruntster at mail.berlios.de  Mon Sep 12 17:20:34 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 12 Sep 2011 17:20:34 +0200
Subject: [Avidemux-svn-commit] r7515 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_libraries cmake
Message-ID: <20110912152034.6E33E48112D@sheep.berlios.de>

Author: gruntster
Date: 2011-09-12 17:20:33 +0200 (Mon, 12 Sep 2011)
New Revision: 7515

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.3.tar.bz2
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.2.tar.bz2
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] upgrade ffmpeg to 0.8.3

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.2.tar.bz2
===================================================================
(Binary files differ)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.3.tar.bz2 (from rev 7428, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.2.tar.bz2)
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-09-12 14:44:13 UTC (rev 7514)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-09-12 15:20:33 UTC (rev 7515)
@@ -1,6 +1,6 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 0.8.2)
+set(FFMPEG_VERSION 0.8.3)
 set(FFMPEG_SOURCE_ARCHIVE "ffmpeg-${FFMPEG_VERSION}.tar.bz2")
 set(FFMPEG_SOURCE_ARCHIVE_DIR "ffmpeg-${FFMPEG_VERSION}")
 



From gruntster at mail.berlios.de  Tue Sep 13 11:34:44 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 11:34:44 +0200
Subject: [Avidemux-svn-commit] r7516 - in branches/avidemux_2.6_branch_mean:
	avidemux avidemux/common avidemux_core
	avidemux_core/ADM_core/src avidemux_plugins/ADM_autoScrips
	avidemux_plugins/ADM_videoEncoder/x264 cmake
Message-ID: <20110913093444.AF101481223@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 11:34:44 +0200 (Tue, 13 Sep 2011)
New Revision: 7516

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_autoScrips/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
   branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/vd_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/ve_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake
Log:
[plugin] remove hardcoded plugins dir

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-13 09:34:44 UTC (rev 7516)
@@ -274,14 +274,14 @@
 #else
     const char *startDir=ADM_RELATIVE_LIB_DIR;
 #endif
-    char *adPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioDecoder");
-    char *avPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioDevices");    
-    char *aePlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioEncoders");    
-    char *dmPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","demuxers");    
-    char *mxPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","muxers");    
-    char *vePlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","videoEncoders");    
-    char *vdPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","videoDecoders");    
-    char *vfPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","videoFilters");
+    char *adPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "audioDecoder");
+    char *avPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "audioDevices");    
+    char *aePlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "audioEncoders");    
+    char *dmPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "demuxers");    
+    char *mxPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "muxers");    
+    char *vePlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "videoEncoders");    
+    char *vdPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "videoDecoders");    
+    char *vfPlugins = ADM_getInstallRelativePath(startDir, ADM_PLUGIN_DIR, "videoFilters");
 
     ADM_mx_loadPlugins(mxPlugins);
     delete [] mxPlugins;

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -7,6 +7,12 @@
 
 SET(CMAKE_MODULE_PATH "${AVIDEMUX_TOP_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")
 
+IF (WIN32)
+	SET(ADM_PLUGIN_DIR "plugins")
+ELSE (WIN32)
+	SET(ADM_PLUGIN_DIR "ADM_plugins6")
+ENDIF (WIN32)
+
 ########################################
 # Shared cmake part
 ########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-13 09:34:44 UTC (rev 7516)
@@ -250,7 +250,7 @@
 {
 	if (ADM_autodir )
 		return ADM_autodir;
-    ADM_autodir = ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, "ADM_plugins6", "autoScripts");
+    ADM_autodir = ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "autoScripts");
 	return ADM_autodir;
 }
 /**
@@ -260,7 +260,7 @@
 const char *ADM_getSystemPluginSettingsDir(void)
 {
     if(ADM_systemPluginSettings) return ADM_systemPluginSettings;
-    ADM_systemPluginSettings=ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, "ADM_plugins6", "pluginSettings");
+    ADM_systemPluginSettings=ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "pluginSettings");
     return ADM_systemPluginSettings;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-09-13 09:34:44 UTC (rev 7516)
@@ -13,6 +13,12 @@
 SET(CMAKE_MODULE_PATH "${AVIDEMUX_TOP_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")
 SET(ADM_PROJECT admCore)
 
+IF (WIN32)
+	SET(ADM_PLUGIN_DIR "plugins")
+ELSE (WIN32)
+	SET(ADM_PLUGIN_DIR "ADM_plugins6")
+ENDIF (WIN32)
+
 ADD_DEFINITIONS(-D_FILE_OFFSET_BITS=64 -D_LARGE_FILES)
 include(admMainChecks)
 include(admAsNeeded)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_autoScrips/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_autoScrips/CMakeLists.txt	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_autoScrips/CMakeLists.txt	2011-09-13 09:34:44 UTC (rev 7516)
@@ -1,4 +1,4 @@
-SET(AUTOSCRIPT_DIR "${AVIDEMUX_LIB_DIR}/ADM_plugins6/autoScripts/")
+SET(AUTOSCRIPT_DIR "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/autoScripts/")
 
 FILE(GLOB py_files ${CMAKE_CURRENT_SOURCE_DIR}/*.py)
 FILE(GLOB py_libFiles ${CMAKE_CURRENT_SOURCE_DIR}/lib/*.py)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/CMakeLists.txt	2011-09-13 09:34:44 UTC (rev 7516)
@@ -35,7 +35,7 @@
   endif((DO_GTK) OR (DO_CLI))
   # ------------- PRESET -----------
   if((DO_GTK) OR (DO_CLI) OR (DO_QT4))
-    SET(PRESET_DIR "${AVIDEMUX_LIB_DIR}/ADM_plugins6/pluginSettings/x264/1/")
+    SET(PRESET_DIR "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/pluginSettings/x264/1/")
 
     FILE(GLOB json_files ${CMAKE_CURRENT_SOURCE_DIR}/preset/*.json)
     message(STATUS "Presets found : ${json_files}")

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -3,6 +3,7 @@
 
 #define ADM_INSTALL_DIR "${CMAKE_INSTALL_PREFIX}"
 #define ADM_RELATIVE_LIB_DIR "${AVIDEMUX_RELATIVE_LIB_DIR}"
+#define ADM_PLUGIN_DIR "${ADM_PLUGIN_DIR}"
 
 // GCC - CPU
 #cmakedefine ADM_BIG_ENDIAN

Modified: branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -5,7 +5,7 @@
 
 MACRO(INSTALL_AUDIODECODER _lib)
 	TARGET_LINK_LIBRARIES(${_lib} ADM_core6 )
-	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/ADM_plugins6/audioDecoder/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/audioDecoder/")
 ENDMACRO(INSTALL_AUDIODECODER)
 ############## ADD_VIDEO_FILTER ###################"
 MACRO(ADD_AUDIO_DECODER name)

Modified: branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -14,6 +14,6 @@
 ENDMACRO(ADD_AUDIO_ENCODER name)
 
 MACRO(INSTALL_AUDIOENCODER _lib)
-	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/ADM_plugins6/audioEncoders/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/audioEncoders/")
 	TARGET_LINK_LIBRARIES(${_lib} ADM_core6 ADM_coreUI6 ADM_coreAudio6 ADM_coreAudioEncoder6 ADM_coreUtils6)
 ENDMACRO(INSTALL_AUDIOENCODER)

Modified: branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -7,7 +7,7 @@
 ENDMACRO(INIT_AUDIO_DEVICE)
 
 MACRO(INSTALL_AUDIO_DEVICE _lib)
-	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/ADM_plugins6/audioDevices/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/audioDevices/")
 ENDMACRO(INSTALL_AUDIO_DEVICE)
 
 

Modified: branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -3,7 +3,7 @@
 
 MACRO(INSTALL_DEMUXER _lib)
         TARGET_LINK_LIBRARIES(${_lib} ADM_core6 ADM_coreUtils6 ADM_coreAudio6 ADM_coreImage6 ADM_coreUI6 ADM_core6 ADM_coreDemuxer6)
-	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/ADM_plugins6/demuxers/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/demuxers/")
 ENDMACRO(INSTALL_DEMUXER)
 
 MACRO(ADD_DEMUXER name)

Modified: branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -4,7 +4,7 @@
 
 MACRO(INSTALL_MUXER _lib)
         TARGET_LINK_LIBRARIES(${_lib} ADM_core6 ADM_coreUtils6 ADM_coreAudio6 ADM_coreImage6 ADM_coreUI6 ADM_core6 ADM_coreMuxer6)
-	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/ADM_plugins6/muxers/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/muxers/")
 ENDMACRO(INSTALL_MUXER)
 
 MACRO(ADD_MUXER name)

Modified: branches/avidemux_2.6_branch_mean/cmake/vd_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/vd_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/vd_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -1,7 +1,7 @@
 #
 #  Macro to declare an video decoder plugin
 #
-SET(VD_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/ADM_plugins6/videoDecoders/")
+SET(VD_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/videoDecoders/")
 MACRO(INIT_VIDEO_DECODER _lib)
 	INCLUDE_DIRECTORIES("${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/ADM_core/include")
 	INCLUDE_DIRECTORIES("${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/ADM_coreVideoCodec/include")

Modified: branches/avidemux_2.6_branch_mean/cmake/ve_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ve_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/ve_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -1,7 +1,7 @@
 #
 #  Macro to declare an video encoder plugin
 #
-SET(VE_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/ADM_plugins6/videoEncoders/")
+SET(VE_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/videoEncoders/")
 MACRO(INIT_VIDEO_ENCODER _lib)
 	INCLUDE_DIRECTORIES("${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/ADM_core/include")
 	INCLUDE_DIRECTORIES("${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/ADM_coreVideoEncoder/include")

Modified: branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake	2011-09-12 15:20:33 UTC (rev 7515)
+++ branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake	2011-09-13 09:34:44 UTC (rev 7516)
@@ -1,5 +1,5 @@
 include(admAsNeeded)
-SET(VF_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/ADM_plugins6/videoFilters/")
+SET(VF_PLUGIN_DIR "${AVIDEMUX_LIB_DIR}/${ADM_PLUGIN_DIR}/videoFilters/")
 ############## INIT_VIDEO_FILTER_INTERNAL ###################"
 MACRO(INIT_VIDEO_FILTER_INTERNAL _lib)
     INCLUDE_DIRECTORIES(.)



From mean at mail.berlios.de  Tue Sep 13 14:38:18 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 14:38:18 +0200
Subject: [Avidemux-svn-commit] r7517 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize
Message-ID: <20110913123818.F39AC48125A@sheep.berlios.de>

Author: mean
Date: 2011-09-13 14:38:18 +0200 (Tue, 13 Sep 2011)
New Revision: 7517

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
Log:
[glResize] fix filter

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp	2011-09-13 09:34:44 UTC (rev 7516)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.cpp	2011-09-13 12:38:18 UTC (rev 7517)
@@ -85,6 +85,30 @@
         info.width=configuration.width;
         info.height=configuration.height;
         resizeFBO(info.width,info.height);
+        widget->makeCurrent();
+        fboY->bind();
+        printf("Compiling shader \n");
+        glProgramY = new QGLShaderProgram(context);
+        ADM_assert(glProgramY);
+        if ( !glProgramY->addShaderFromSourceCode(QGLShader::Fragment, myShaderY))
+        {
+                ADM_error("[GL Render] Fragment log: %s\n", glProgramY->log().toUtf8().constData());
+                ADM_assert(0);
+        }
+        if ( !glProgramY->link())
+        {
+            ADM_error("[GL Render] Link log: %s\n", glProgramY->log().toUtf8().constData());
+            ADM_assert(0);
+        }
+
+        if ( !glProgramY->bind())
+        {
+                ADM_error("[GL Render] Binding FAILED\n");
+                ADM_assert(0);
+        }
+
+        fboY->release();
+        widget->doneCurrent();
 }
         
 /**
@@ -114,6 +138,9 @@
     fboY->bind();
     checkGlError("bind");
     uploadAllPlanes(original);
+    glProgramY->setUniformValue("myTextureU", 1); 
+    glProgramY->setUniformValue("myTextureV", 2); 
+    glProgramY->setUniformValue("myTextureY", 0); 
     render(image,PLANAR_Y,fboY);
     downloadTextures(image,fboY);
     image->copyInfo(original);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	2011-09-13 09:34:44 UTC (rev 7516)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	2011-09-13 12:38:18 UTC (rev 7517)
@@ -4,20 +4,13 @@
 	"uniform sampler2DRect myTextureY;\n" // tex unit 0
     "uniform sampler2DRect myTextureU;\n" // tex unit 1
     "uniform sampler2DRect myTextureV;\n" // tex unit 2
-    "uniform float myWidth;\n"
-    "uniform float myHeight;\n"
-    "uniform float teta;\n"
-
+    "const vec2 half_vec=vec2(0.5,0.5);\n"
 	"void main(void) {\n"
-    "  float mx = gl_TexCoord[0].x-myWidth/2;\n"
-	"  float my = gl_TexCoord[0].y-myHeight/2;\n"
-    "  float c=cos(teta); \n"
-    "  float s=sin(teta); \n"
-    "  float nx=mx*c-my*s;\n"
-    "  float ny=mx*s+my*c;\n"
-    "  vec4 texvalV = texture2DRect(myTextureV, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
-    "  vec4 texvalU = texture2DRect(myTextureU, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
-	"  vec4 texvalY = texture2DRect(myTextureY, vec2(nx+myWidth/2,ny+myHeight/2));\n"
+    "  vec2 full_coord=gl_TexCoord[0];\n"
+    "  vec2 half_coord=full_coord*half_vec;"
+    "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, full_coord);\n"
 	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
 	"}\n";
 



From mean at mail.berlios.de  Tue Sep 13 14:38:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 14:38:20 +0200
Subject: [Avidemux-svn-commit] r7518 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src
Message-ID: <20110913123820.D99AB48125A@sheep.berlios.de>

Author: mean
Date: 2011-09-13 14:38:20 +0200 (Tue, 13 Sep 2011)
New Revision: 7518

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[gl] Manipulate FBO under the right context

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-13 12:38:18 UTC (rev 7517)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-09-13 12:38:20 UTC (rev 7518)
@@ -181,8 +181,11 @@
 */
 bool ADM_coreVideoFilterQtGl::resizeFBO(uint32_t w,uint32_t h)
 {
+    widget->makeCurrent();
     if(fboY) delete fboY;
     fboY=new QGLFramebufferObject(w,h);
+    widget->doneCurrent();
+    checkGlError("resizeFBO");
     return true;
 }
 /**



From mean at mail.berlios.de  Tue Sep 13 14:38:22 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 14:38:22 +0200
Subject: [Avidemux-svn-commit] r7519 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	sample_distort sample_fragment2
Message-ID: <20110913123822.3599F48125A@sheep.berlios.de>

Author: mean
Date: 2011-09-13 14:38:22 +0200 (Tue, 13 Sep 2011)
New Revision: 7519

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h
Log:
[gl] Simplify shaders

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-13 12:38:20 UTC (rev 7518)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-13 12:38:22 UTC (rev 7519)
@@ -4,16 +4,17 @@
 	"uniform sampler2DRect myTextureY;\n" // tex unit 0
     "uniform sampler2DRect myTextureU;\n" // tex unit 1
     "uniform sampler2DRect myTextureV;\n" // tex unit 2
+    "const vec2 half_vec=vec2(0.5,0.5);\n"
     "uniform float myWidth;\n"
     "uniform float myHeight;\n"
     "uniform float teta;\n"
 
 	"void main(void) {\n"
-    "  float nx = gl_TexCoord[0].x;\n"
-	"  float ny = gl_TexCoord[0].y;\n"
-    "  vec4 texvalV = texture2DRect(myTextureV, vec2(nx/2,ny/2));\n"
-    "  vec4 texvalU = texture2DRect(myTextureU, vec2(nx/2,ny/2));\n"
-	"  vec4 texvalY = texture2DRect(myTextureY, vec2(nx,ny));\n"
+    "  vec2 full_coord=gl_TexCoord[0];\n"
+    "  vec2 half_coord=full_coord*half_vec;"
+    "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, full_coord);\n"
 	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
 	"}\n";
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h	2011-09-13 12:38:20 UTC (rev 7518)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h	2011-09-13 12:38:22 UTC (rev 7519)
@@ -7,17 +7,20 @@
     "uniform float myWidth;\n"
     "uniform float myHeight;\n"
     "uniform float teta;\n"
+    "const vec2 half_vec=vec2(0.5,0.5);\n"
 
 	"void main(void) {\n"
-    "  float mx = gl_TexCoord[0].x-myWidth/2;\n"
-	"  float my = gl_TexCoord[0].y-myHeight/2;\n"
+    "  vec2 sizexy=vec2(myWidth/2,myHeight/2);\n"
+    "  vec2 full_coord=gl_TexCoord[0]-sizexy;\n"
     "  float c=cos(teta); \n"
     "  float s=sin(teta); \n"
-    "  float nx=mx*c-my*s;\n"
-    "  float ny=mx*s+my*c;\n"
-    "  vec4 texvalV = texture2DRect(myTextureV, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
-    "  vec4 texvalU = texture2DRect(myTextureU, vec2(nx/2+myWidth/4,ny/2+myHeight/4));\n"
-	"  vec4 texvalY = texture2DRect(myTextureY, vec2(nx+myWidth/2,ny+myHeight/2));\n"
+    "  mat2 mymatrix=mat2(c,-s,s,c);"
+    "  "
+    "  vec2 new_coord=full_coord*mymatrix+sizexy;\n"
+    "  vec2 half_coord=new_coord*half_vec;\n"
+    "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, new_coord);\n"
 	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
 	"}\n";
 



From mean at mail.berlios.de  Tue Sep 13 14:38:23 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 14:38:23 +0200
Subject: [Avidemux-svn-commit] r7520 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreImage/src ADM_coreUtils/src
Message-ID: <20110913123823.B003248125A@sheep.berlios.de>

Author: mean
Date: 2011-09-13 14:38:23 +0200 (Tue, 13 Sep 2011)
New Revision: 7520

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
Log:
[core] use av_free everywhere rather than delete context

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2011-09-13 12:38:22 UTC (rev 7519)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2011-09-13 12:38:23 UTC (rev 7520)
@@ -219,7 +219,7 @@
     if(context)
     {
         avcodec_close (context);
-        ADM_dealloc (context);
+        av_free (context);
     }
     context=NULL;
     return result;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2011-09-13 12:38:22 UTC (rev 7519)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2011-09-13 12:38:23 UTC (rev 7520)
@@ -630,7 +630,10 @@
     // cleanup
 theEnd:
     if(ctx)
+    {
         avcodec_close(ctx);
+        av_free(ctx);
+    }
     if(parser)
         av_parser_close(parser);
     return r;



From gruntster at mail.berlios.de  Tue Sep 13 18:09:05 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 18:09:05 +0200
Subject: [Avidemux-svn-commit] r7521 - in branches/avidemux_2.6_branch_mean:
	avidemux/winInstaller foreignBuilds/mswin/avidemux
	foreignBuilds/mswin/avidemux/Tools foreignBuilds/mswin/faac
	foreignBuilds/mswin/faad foreignBuilds/mswin/libogg
	foreignBuilds/mswin/libvpx foreignBuilds/mswin/nspr
	foreignBuilds/mswin/x264 foreignBuilds/mswin/xvid
Message-ID: <20110913160905.D19E648125B@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 18:09:05 +0200 (Tue, 13 Sep 2011)
New Revision: 7521

Added:
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/PageHeaderGtk.bmp
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/makefile
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/makefile
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/PageHeader.bmp
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/genlog.sh
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/svnlog.xslt
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch
Log:
[mswin] update build scripts

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/PageHeader.bmp
===================================================================
(Binary files differ)

Added: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/PageHeaderGtk.bmp
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/PageHeaderGtk.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-13 16:09:05 UTC (rev 7521)
@@ -2,42 +2,86 @@
 # Included files
 ##########################
 !include Sections.nsh
-!include MUI.nsh
-!include WinMessages.nsh
-!include revision.nsh
+!include MUI2.nsh
+!include nsDialogs.nsh
+!include Memento.nsh
+!include FileFunc.nsh
+!include WordFunc.nsh
+!include ${NSIDIR}\revision.nsh
 
-Name "Avidemux 2.4.2 r${REVISION}"
-
 SetCompressor /SOLID lzma
 SetCompressorDictSize 96
 
 ##########################
 # Defines
 ##########################
-!define INTERNALNAME "Avidemux 2.4"
-!define REGKEY "SOFTWARE\${INTERNALNAME}"
-!define UNINST_REGKEY "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${INTERNALNAME}"
-!define VERSION 2.4.2.${REVISION}
+
+!define PRODUCT_VERSION "2.6.0.${REVISION}"
+!define PRODUCT_NAME "Avidemux 2.6"
+!define PRODUCT_FULLNAME "Avidemux ${PRODUCT_VERSION} (${BUILD_BITS}-bit beta)"
+
+!if ${BUILD_BITS} == 64
+	!define SHORTCUT_NAME "${PRODUCT_NAME}"
+	!define REG_GROUPNAME "${PRODUCT_NAME} (${BUILD_BITS}-bit)"
+!else
+	!define SHORTCUT_NAME "${PRODUCT_NAME} (${BUILD_BITS}-bit)"
+	!define REG_GROUPNAME "${PRODUCT_NAME}"
+!endif
+
+!define REGKEY "SOFTWARE\${REG_GROUPNAME}"
+!define UNINST_REGKEY "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${REG_GROUPNAME}"
 !define COMPANY "Free Software Foundation"
 !define URL "http://www.avidemux.org"
 
-!define INSTALL_OPTS_INI "InstallOptions.ini"
+!ifndef INST_GTK
+!ifndef INST_QT
+!define INST_GTK
+!define INST_QT
+!endif
+!endif
 
+!ifdef INST_GTK
+!ifdef INST_QT
+!define INST_BOTH
+!endif
+!endif
+
+!ifdef INST_BOTH
+OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_full_win${BUILD_BITS}.exe"
+Name "${PRODUCT_FULLNAME} Full"
+!else ifdef INST_QT
+OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_win${BUILD_BITS}.exe"
+Name "${PRODUCT_FULLNAME}"
+!else ifdef INST_GTK
+OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_gtk_win${BUILD_BITS}.exe"
+Name "${PRODUCT_FULLNAME} GTK+"
+!endif
+
 ##########################
+# Memento defines
+##########################
+!define MEMENTO_REGISTRY_ROOT HKLM
+!define MEMENTO_REGISTRY_KEY "${REGKEY}"
+
+##########################
 # MUI defines
 ##########################
 !define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install-blue-full.ico"
 !define MUI_HEADERIMAGE
 !define MUI_HEADERIMAGE_RIGHT
-!define MUI_HEADERIMAGE_BITMAP "PageHeader.bmp"
+!ifdef INST_GTK
+!define MUI_HEADERIMAGE_BITMAP "${NSIDIR}\PageHeaderGtk.bmp"
+!else
+!define MUI_HEADERIMAGE_BITMAP "${NSIDIR}\PageHeader.bmp"
+!endif
 !define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM
 !define MUI_STARTMENUPAGE_REGISTRY_KEY "${REGKEY}"
 !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup
 !define MUI_STARTMENUPAGE_DEFAULTFOLDER Avidemux
 !define MUI_STARTMENUPAGE_NODISABLE
-!define MUI_WELCOMEFINISHPAGE_BITMAP "WelcomeFinishStrip.bmp"
-!define MUI_UNICON "..\xpm\adm.ico"
-!define MUI_UNFINISHPAGE_NOAUTOCLOSE
+!define MUI_WELCOMEFINISHPAGE_BITMAP "${NSIDIR}\WelcomeFinishStrip.bmp"
+!define MUI_UNWELCOMEFINISHPAGE_BITMAP "${NSIDIR}\WelcomeFinishStrip.bmp"
+!define MUI_UNICON "${NSIDIR}\..\common\xpm\adm.ico"
 !define MUI_COMPONENTSPAGE_NODESC
 
 ##########################
@@ -47,32 +91,44 @@
 Var CreateStartMenuGroup
 Var CreateQuickLaunchIcon
 Var StartMenuGroup
+Var PreviousVersion
+Var PreviousVersionState
+Var ReinstallUninstall
 
 ##########################
 # Installer pages
 ##########################
+!define MUI_WELCOMEPAGE_TITLE "${PRODUCT_FULLNAME} Setup Wizard"
 !insertmacro MUI_PAGE_WELCOME
-!insertmacro MUI_PAGE_LICENSE License.rtf
+!insertmacro MUI_PAGE_LICENSE "${NSIDIR}\License.rtf"
+ Page custom ReinstallPage ReinstallPageLeave
+!ifdef INST_BOTH
 !define MUI_PAGE_CUSTOMFUNCTION_LEAVE CheckSelectedUIs
+!endif
 !insertmacro MUI_PAGE_COMPONENTS
 Page custom InstallOptionsPage
 !define MUI_PAGE_CUSTOMFUNCTION_PRE IsStartMenuRequired
 !insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup
 !insertmacro MUI_PAGE_DIRECTORY
 !define MUI_PAGE_CUSTOMFUNCTION_PRE ActivateInternalSections
+!define MUI_PAGE_CUSTOMFUNCTION_SHOW InstFilesPageShow
+!define MUI_PAGE_CUSTOMFUNCTION_LEAVE InstFilesPageLeave
 !insertmacro MUI_PAGE_INSTFILES
 !define MUI_FINISHPAGE_RUN
 !define MUI_FINISHPAGE_RUN_FUNCTION RunAvidemux
-!define MUI_FINISHPAGE_RUN_TEXT "Run ${INTERNALNAME} now"
+!define MUI_FINISHPAGE_RUN_TEXT "Run ${PRODUCT_NAME} now"
 !define MUI_FINISHPAGE_SHOWREADME "$INSTDIR\Change Log.html"
 !define MUI_FINISHPAGE_SHOWREADME_TEXT "View Change Log now"
-!define MUI_FINISHPAGE_LINK "Visit the Avidemux Win32 Builds website"
-!define MUI_FINISHPAGE_LINK_LOCATION "http://www.razorbyte.com.au/avidemux/"
+!define MUI_FINISHPAGE_LINK "Visit the Avidemux Builds for Windows website"
+!define MUI_FINISHPAGE_LINK_LOCATION "http://avidemux.razorbyte.com.au/"
 !define MUI_PAGE_CUSTOMFUNCTION_PRE ConfigureFinishPage
-!define MUI_PAGE_CUSTOMFUNCTION_SHOW OnShowFinishPage
 !insertmacro MUI_PAGE_FINISH
+
+!define MUI_PAGE_CUSTOMFUNCTION_PRE un.ConfirmPagePre
 !insertmacro MUI_UNPAGE_CONFIRM
 !insertmacro MUI_UNPAGE_INSTFILES
+!define MUI_PAGE_CUSTOMFUNCTION_PRE un.FinishPagePre
+!insertmacro MUI_UNPAGE_FINISH
 
 ##########################
 # Installer languages
@@ -80,574 +136,1055 @@
 !insertmacro MUI_LANGUAGE English
 
 ##########################
-#Reserve files
+# Installer attributes
 ##########################
-ReserveFile "${INSTALL_OPTS_INI}"
-!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS
+!if ${BUILD_BITS} == 64
+	InstallDir "$PROGRAMFILES64\${PRODUCT_NAME}"
+!else
+	InstallDir "$PROGRAMFILES\${PRODUCT_NAME}"
+!endif
 
-##########################
-# Installer attributes
-##########################
-OutFile avidemux_2.4_r${REVISION}_win32.exe
-InstallDir "$PROGRAMFILES\Avidemux 2.4"
 CRCCheck on
 XPStyle on
 ShowInstDetails nevershow
-VIProductVersion 2.4.2.${REVISION}
+ShowUninstDetails nevershow
+VIProductVersion ${PRODUCT_VERSION}
 VIAddVersionKey ProductName Avidemux
-VIAddVersionKey ProductVersion "${VERSION}"
+VIAddVersionKey ProductVersion "${PRODUCT_VERSION}"
 VIAddVersionKey FileVersion ""
 VIAddVersionKey FileDescription ""
 VIAddVersionKey LegalCopyright ""
 InstallDirRegKey HKLM "${REGKEY}" Path
-ShowUninstDetails nevershow
 BrandingText "Packaged by Gruntster"
 InstType Standard
 InstType Full
 
 ##########################
+# Uninstaller macros
+##########################
+!insertmacro un.GetOptions
+!insertmacro un.GetParameters
+
+!define UninstallLogPath "$INSTDIR\uninstall.log"
+Var UninstallLogHandle
+
+; Uninstall log file missing.
+LangString UninstallLogMissing ${LANG_ENGLISH} "uninstall.log not found!$\r$\nUninstallation cannot proceed!"
+
+!macro InstallFile FILEREGEX
+	File "${FILEREGEX}"
+	!define Index 'Line${__LINE__}'
+	${GetFileName} "${FILEREGEX}" $R0
+	FindFirst $0 $1 "$OUTDIR\$R0"
+	StrCmp $0 "" "${Index}-End"
+"${Index}-Loop:"
+	StrCmp $1 "" "${Index}-End"
+	FileWrite $UninstallLogHandle "$OUTDIR\$1$\r$\n"
+	FindNext $0 $1
+	Goto "${Index}-Loop"
+"${Index}-End:"
+	!undef Index
+!macroend
+!define File "!insertmacro InstallFile"
+ 
+!macro InstallFolder FILEREGEX
+	File /r "${FILEREGEX}\*"
+	Push "$OUTDIR"
+	Call InstallFolderInternal
+!macroend
+!define Folder "!insertmacro InstallFolder"
+ 
+Function InstallFolderInternal
+	Pop $9
+	!define Index 'Line${__LINE__}'
+	FindFirst $0 $1 "$9\*"
+	StrCmp $0 "" "${Index}-End"
+"${Index}-Loop:"
+	StrCmp $1 "" "${Index}-End"
+	StrCmp $1 "." "${Index}-Next"
+	StrCmp $1 ".." "${Index}-Next"
+	IfFileExists "$9\$1\*" 0 "${Index}-Write"
+		Push $0
+		Push $9
+		Push "$9\$1"
+		Call InstallFolderInternal
+		Pop $9
+		Pop $0
+		Goto "${Index}-Next"
+"${Index}-Write:"
+	FileWrite $UninstallLogHandle "$9\$1$\r$\n"
+"${Index}-Next:"
+	FindNext $0 $1
+	Goto "${Index}-Loop"
+"${Index}-End:"
+	!undef Index
+FunctionEnd
+
+; WriteUninstaller macro
+!macro WriteUninstaller Path
+	WriteUninstaller "${Path}"
+	FileWrite $UninstallLogHandle "${Path}$\r$\n"
+!macroend
+!define WriteUninstaller "!insertmacro WriteUninstaller"
+
+##########################
 # Macros
 ##########################
 !macro InstallGtkLanguage LANG_NAME LANG_CODE
+!ifdef INST_GTK
 	SetOverwrite on
 
 	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} installGtk${LANG_CODE} endGtk${LANG_CODE}
 
 installGtk${LANG_CODE}:
     SetOutPath $INSTDIR\share\locale\${LANG_CODE}\LC_MESSAGES
-    File ..\..\..\avidemux_2.4_build\share\locale\${LANG_CODE}\LC_MESSAGES\avidemux.mo
-    File ..\..\..\avidemux_2.4_build\share\locale\${LANG_CODE}\LC_MESSAGES\gtk20.mo
+    ${File} share\locale\${LANG_CODE}\LC_MESSAGES\avidemux.mo
+    ${File} share\locale\${LANG_CODE}\LC_MESSAGES\gtk20.mo
 
-    WriteRegStr HKLM "${REGKEY}\Components" ${LANG_NAME} 1
 endGtk${LANG_CODE}:
+!endif
 !macroend
 
-!macro InstallQt4Language LANG_NAME LANG_CODE
+!macro InstallQtLanguage LANG_NAME LANG_CODE
+!ifdef INST_QT
 	SetOverwrite on
 
-	!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} installQt4${LANG_CODE} endQt4${LANG_CODE}
+	!insertmacro SectionFlagIsSet ${SecUiQt} ${SF_SELECTED} installQt${LANG_CODE} endQt${LANG_CODE}
 
-installQt4${LANG_CODE}:	
+installQt${LANG_CODE}:
 	SetOutPath $INSTDIR\i18n
-    File ..\..\..\avidemux_2.4_build\i18n\avidemux_${LANG_CODE}.qm
-    File ..\..\..\avidemux_2.4_build\i18n\qt_${LANG_CODE}.qm
-    
-    WriteRegStr HKLM "${REGKEY}\Components" ${LANG_NAME} 1
-endQt4${LANG_CODE}:    
-!macroend
+    ${File} i18n\avidemux_${LANG_CODE}.qm
+    ${File} i18n\qt_${LANG_CODE}.qm
 
-!macro UninstallLanguage LANG_NAME LANG_CODE
-    RmDir /r /REBOOTOK $INSTDIR\share\locale\${LANG_CODE}
-    Delete /REBOOTOK $INSTDIR\i18n\avidemux_${LANG_CODE}.qm
-    Delete /REBOOTOK $INSTDIR\i18n\qt_${LANG_CODE}.qm
-    
-    DeleteRegValue HKLM "${REGKEY}\Components" ${LANG_NAME}
+endQt${LANG_CODE}:
+!endif
 !macroend
 
-# Macro for selecting sections based on registry setting
-!macro SELECT_SECTION SECTION_NAME SECTION_ID
-    Push $R0
-    ReadRegStr $R0 HKLM "${REGKEY}\Components" "${SECTION_NAME}"
-    StrCmp $R0 1 0 next${SECTION_ID}
-    !insertmacro SelectSection "${SECTION_ID}"
-    GoTo done${SECTION_ID}
-next${SECTION_ID}:
-    !insertmacro UnselectSection "${SECTION_ID}"
-done${SECTION_ID}:
-    Pop $R0
-!macroend
-
 ##########################
 # Installer sections
 ##########################
-Section "Core files (required)" SecCore
+Section -OpenLogFile
+	CreateDirectory "$INSTDIR"
+	FileOpen $UninstallLogHandle ${UninstallLogPath} a
+	FileSeek $UninstallLogHandle 0 END
+SectionEnd
+
+Section "Avidemux Core" SecCore
     SectionIn 1 2 RO
     SetOutPath $INSTDIR
     SetOverwrite on
-    File "..\..\..\avidemux_2.4_build\Build Info.txt"
-    File "..\..\..\avidemux_2.4_build\Change Log.html"
-    File ..\..\..\avidemux_2.4_build\zlib1.dll
-    File ..\..\..\avidemux_2.4_build\freetype6.dll
-    File ..\..\..\avidemux_2.4_build\iconv.dll
-    File ..\..\..\avidemux_2.4_build\intl.dll
-    File ..\..\..\avidemux_2.4_build\libaften.dll
-    File ..\..\..\avidemux_2.4_build\libexpat.dll
-    File ..\..\..\avidemux_2.4_build\libfaac.dll
-    File ..\..\..\avidemux_2.4_build\libfaad2.dll
-    File ..\..\..\avidemux_2.4_build\libfontconfig-1.dll
-    File ..\..\..\avidemux_2.4_build\libglib-2.0-0.dll
-    File ..\..\..\avidemux_2.4_build\libmp3lame-0.dll
-    File ..\..\..\avidemux_2.4_build\libpng12-0.dll
-    File ..\..\..\avidemux_2.4_build\libx264.dll
-    File ..\..\..\avidemux_2.4_build\libxml2.dll
-    File ..\..\..\avidemux_2.4_build\ogg.dll
-    File ..\..\..\avidemux_2.4_build\pthreadGC2.dll
-    File ..\..\..\avidemux_2.4_build\SDL.dll
-    File ..\..\..\avidemux_2.4_build\vorbis.dll
-    File ..\..\..\avidemux_2.4_build\vorbisenc.dll
-    File ..\..\..\avidemux_2.4_build\xmltok.dll
-    File ..\..\..\avidemux_2.4_build\xvidcore.dll
-    SetOutPath $INSTDIR\etc\fonts
-    File /r ..\..\..\avidemux_2.4_build\etc\fonts\*
+    ${File} "Build Info.txt"
+    ${File} "Change Log.html"
+    ${File} zlib1.dll
+    ${File} libstdc++*.dll
 
-    # if $PROFILE\avidemux exists and $APPDATA\avidemux doesn't, then move it
-    IfFileExists "$PROFILE\avidemux" 0 end
-    IfFileExists "$APPDATA\avidemux" end
+!if ${BUILD_BITS} == 32
+    ${File} freetype6.dll
+	${File} pthreadGC2-w32.dll
+!endif
 
-    Rename "$PROFILE\avidemux" "$APPDATA\avidemux"
+!if ${BUILD_BITS} == 64
+    ${File} libfreetype-6.dll
+	${File} pthreadGC2-w64.dll
+!endif
 
-end:
-    WriteRegStr HKLM "${REGKEY}\Components" "Core files (required)" 1
+    ${File} libgcc_s_sjlj-1.dll
+	${File} nspr4.dll
+    ${File} libjs.dll
+    ${File} libADM_core6.dll
+    ${File} libADM_coreAudio6.dll
+	${File} libADM_coreAudioDevice6.dll
+	${File} libADM_coreAudioEncoder6.dll
+	${File} libADM_coreAudioFilterAPI6.dll
+	${File} libADM_coreDemuxer6.dll
+	${File} libADM_coreDemuxerMpeg6.dll
+    ${File} libADM_coreImage6.dll
+	${File} libADM_coreImageLoader6.dll
+	${File} libADM_coreJobs.dll
+	${File} libADM_coreMuxer6.dll
+	${File} libADM_coreSocket6.dll
+	${File} libADM_coreSqlLight3.dll
+	${File} libADM_coreTinyPy6.dll
+    ${File} libADM_coreUI6.dll
+	${File} libADM_coreUtils6.dll
+	${File} libADM_coreVideoCodec6.dll
+	${File} libADM_coreVideoEncoder6.dll
+	${File} libADM_coreVideoFilter6.dll
+    ${File} libxml2-*.dll
+    ${File} AUTHORS.
+    ${File} COPYING.
+    ${File} README.
+    ${File} avcodec-*.dll
+    ${File} avformat-*.dll
+    ${File} avutil-*.dll
+    ${File} postproc-*.dll
+    ${File} swscale-*.dll
 SectionEnd
 
 SectionGroup /e "User interfaces" SecGrpUI
-    Section "Command line" SecUiCli
-        SectionIn 1 2
+    ${MementoUnselectedSection} "Command Line" SecUiCli
+        SectionIn 2
         SetOutPath $INSTDIR
         SetOverwrite on
-        File ..\..\..\avidemux_2.4_build\avidemux2_cli.exe
-        WriteRegStr HKLM "${REGKEY}\Components" "Command line" 1
-    SectionEnd
+        ${File} avidemux3_cli.exe
+        ${File} libADM_render6_cli.dll
+        ${File} libADM_UI_Cli6.dll
+    ${MementoSectionEnd}
 
-    Section GTK+ SecUiGtk
-        SectionIn 1 2
+!ifdef INST_BOTH
+	${MementoUnselectedSection} GTK+ SecUiGtk
+	SectionIn 2
+!else ifdef INST_GTK
+	${MementoSection} GTK+ SecUiGtk
+	SectionIn 1 2 RO
+!endif
+!ifdef INST_BOTH | INST_GTK
         SetOverwrite on
         SetOutPath $INSTDIR\etc\gtk-2.0
-        File /r ..\..\..\avidemux_2.4_build\etc\gtk-2.0\*
+        ${Folder} etc\gtk-2.0
         SetOutPath $INSTDIR\etc\pango
-        File /r ..\..\..\avidemux_2.4_build\etc\pango\*
+        ${Folder} etc\pango
         SetOutPath $INSTDIR\lib\gtk-2.0
-        File /r ..\..\..\avidemux_2.4_build\lib\gtk-2.0\*
+        ${Folder} lib\gtk-2.0
         SetOutPath $INSTDIR\share\themes
-        File /r ..\..\..\avidemux_2.4_build\share\themes\*
+        ${Folder} share\themes
         SetOutPath $INSTDIR
-        File ..\..\..\avidemux_2.4_build\avidemux2_gtk.exe
-        File ..\..\..\avidemux_2.4_build\gtk2_prefs.exe
-        File ..\..\..\avidemux_2.4_build\libatk-1.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libcairo-2.dll
-        File ..\..\..\avidemux_2.4_build\libgdk_pixbuf-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libgdk-win32-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libgmodule-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libgobject-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libgthread-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libgtk-win32-2.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libpango-1.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libpangocairo-1.0-0.dll
-        File ..\..\..\avidemux_2.4_build\libpangowin32-1.0-0.dll
-        WriteRegStr HKLM "${REGKEY}\Components" GTK+ 1
-    SectionEnd
-    
-    Section Qt4 SecUiQt4
-        SectionIn 2
+        ${File} avidemux3_gtk.exe
+        ${File} gtk2_prefs.exe
+		${File} intl.dll
+        ${File} libADM_render_gtk.dll
+        ${File} libADM_UIGtk.dll
+        ${File} libatk-1.0-0.dll
+        ${File} libcairo-2.dll
+        ${File} libgdk_pixbuf-2.0-0.dll
+        ${File} libgdk-win32-2.0-0.dll
+        ${File} libgio-2.0-0.dll
+        ${File} libglib-2.0-0.dll
+        ${File} libgmodule-2.0-0.dll
+        ${File} libgobject-2.0-0.dll
+        ${File} libgthread-2.0-0.dll
+        ${File} libgtk-win32-2.0-0.dll
+        ${File} libpango-1.0-0.dll
+        ${File} libpangocairo-1.0-0.dll
+        ${File} libpangoft2-1.0-0.dll
+        ${File} libpangowin32-1.0-0.dll
+        ${File} libpng14-14.dll
+		${File} SDL.dll
+    ${MementoSectionEnd}
+!endif
+
+!ifdef INST_QT
+    ${MementoSection} Qt SecUiQt
+!ifdef INST_BOTH
+        SectionIn 1 2
+!else
+		SectionIn 1 2 RO
+!endif
         SetOutPath $INSTDIR
         SetOverwrite on
-        File ..\..\..\avidemux_2.4_build\QtGui4.dll
-        File ..\..\..\avidemux_2.4_build\avidemux2_qt4.exe
-        File ..\..\..\avidemux_2.4_build\mingwm10.dll
-        File ..\..\..\avidemux_2.4_build\QtCore4.dll
-        WriteRegStr HKLM "${REGKEY}\Components" Qt4 1
-    SectionEnd    
+        ${File} avidemux3_qt4.exe
+		${File} avidemux3_jobs.exe
+        ${File} libADM_render6_qt4.dll
+        ${File} libADM_UIQT46.dll
+        ${File} QtCore4.dll
+		${File} QtGui4.dll
+		${File} QtOpenGL4.dll
+    ${MementoSectionEnd}
+!endif
 SectionGroupEnd
 
-SectionGroup "Additional languages" SecGrpLang
-    Section "Catalan (GTK+ only)" SecLangCatalan
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Catalan ca
-    SectionEnd
+SectionGroup Plugins SecGrpPlugin
+	SectionGroup "Audio Decoders" SecGrpAudioDecoder
+		${MementoSection} "?-law" SecAudDecUlaw
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_ulaw.dll
+		${MementoSectionEnd}
+		${MementoSection} "AAC (FAAD)" SecAudDecFaad
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_faad.dll
+			SetOutPath $INSTDIR
+			${File} libfaad2.dll
+		${MementoSectionEnd}
+		${MementoSection} "AAC, AC-3, ADPCM IMA AMV, DTS, E-AC-3, MP2, MP3, Nellymoser, QDesign, WMA (libavcodec)" SecAudDecAvcodec
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_lav.dll
+		${MementoSectionEnd}
+		${MementoSection} "AC-3 (liba52)" SecAudDecA52
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_a52.dll
+		${MementoSectionEnd}
+		${MementoSection} "ADPCM IMA" SecAudDecImaAdpcm
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_ima_adpcm.dll
+		${MementoSectionEnd}
+		${MementoSection} "ADPCM Microsoft" SecAudDecMsAdpcm
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_ms_adpcm.dll
+		${MementoSectionEnd}
+		${MementoSection} "AMR-NB" SecAudDecOpencoreAmrNb
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_opencore_amrnb.dll
+			SetOutPath $INSTDIR
+			${File} libopencore-amrnb-*.dll
+		${MementoSectionEnd}
+		${MementoSection} "AMR-WB" SecAudDecOpencoreAmrWb
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_opencore_amrwb.dll
+			SetOutPath $INSTDIR
+			${File} libopencore-amrwb-*.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP2, MP3 (MAD)" SecAudDecMad
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_Mad.dll
+		${MementoSectionEnd}
+		${MementoSection} "Vorbis" SecAudDecVorbis
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDecoder
+			${File} plugins\audioDecoder\libADM_ad_vorbis.dll
+			SetOutPath $INSTDIR
+			${File} libogg-0.dll
+			${File} libvorbis-0.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Audio Devices" SecGrpAudioDevice
+		${MementoSection} "Waveform" SecAudDevWaveform
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioDevices
+			${File} plugins\audioDevices\libADM_av_win32.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Audio Encoders" SecGrpAudioEncoder
+		${MementoSection} "AAC (FAAC)" SecAudEncFaac
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_faac.dll
+			SetOutPath $INSTDIR
+			${File} libfaac.dll
+		${MementoSectionEnd}
+		${MementoSection} "AAC (libavcodec)" SecAudEncLavAac
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_lav_aac.dll
+		${MementoSectionEnd}
+		${MementoSection} "AC-3 (Aften)" SecAudDecAften
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_aften.dll
+			SetOutPath $INSTDIR
+			${File} aften.dll
+		${MementoSectionEnd}
+		${MementoSection} "AC-3 (libavcodec)" SecAudEncLavAc3
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_lav_ac3.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP2 (libavcodec)" SecAudEncLavMp2
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_lav_mp2.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP2 (TwoLAME)" SecAudEncTwoLame
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_twolame.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP3" SecAudEncLame
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_lame.dll
+			SetOutPath $INSTDIR
+			${File} libmp3lame-0.dll
+		${MementoSectionEnd}
+		${MementoSection} "PCM" SecAudEncPcm
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_pcm.dll
+		${MementoSectionEnd}
+		${MementoSection} "Vorbis" SecAudEncVorbis
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\audioEncoders
+			${File} plugins\audioEncoders\libADM_ae_vorbis.dll
+			SetOutPath $INSTDIR
+			${File} libogg-0.dll
+			${File} libvorbis-0.dll
+			${File} libvorbisenc-2.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Demuxers" SecGrpDemuxers
+		${MementoSection} "ASF" SecDemuxAsf
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_asf.dll
+		${MementoSectionEnd}
+		${MementoSection} "Avisynth Proxy" SecDemuxAvisynth
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_avsproxy.dll
+		${MementoSectionEnd}
+		${MementoSection} "BMP, JPEG, PNG Images" SecDemuxImage
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_pic.dll
+		${MementoSectionEnd}
+		${MementoSection} "Flash Video" SecDemuxFlv
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_flv.dll
+		${MementoSectionEnd}
+		${MementoSection} "Matroska" SecDemuxMatroska
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_matroska.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP4" SecDemuxMp4
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_mp4.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-PS" SecDemuxMpegPs
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_ps.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-TS" SecDemuxMpegTs
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_ts.dll
+		${MementoSectionEnd}
+		${MementoSection} "MXF" SecDemuxMxf
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_mxf.dll
+		${MementoSectionEnd}
+		${MementoSection} "OpenDML AVI" SecDemuxOpenDml
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\demuxers
+			${File} plugins\demuxers\libADM_dm_opendml.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Muxers" SecGrpMuxers
+		${MementoSection} "Dummy [Raw Audio/Video]" SecMuxDummy
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_dummy.dll
+		${MementoSectionEnd}
+		${MementoSection} "Flash Video" SecMuxLavFlv
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_flv.dll
+		${MementoSectionEnd}
+		${MementoSection} "Matroska" SecMuxLavMatroska
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_Mkv.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP4 (libavcodec)" SecMuxLavMp4
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_mp4.dll
+		${MementoSectionEnd}
+		${MementoSection} "MP4 (MP4v2)" SecMuxMp4v2
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_mp4v2.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-PS" SecMuxLavMpegPs
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_ffPS.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-TS" SecMuxLavMpegTs
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_ffTS.dll
+		${MementoSectionEnd}
+		${MementoSection} "OpenDML AVI" SecMuxOpenDml
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_avi.dll
+		${MementoSectionEnd}
+		${MementoSection} "Raw Video" SecMuxRaw
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\muxers
+			${File} plugins\muxers\libADM_mx_raw.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Video Decoders" SecGrpVideoDecoder
+		${MementoSection} "VP8" SecVidDecVpx
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoDecoders
+			${File} plugins\videoDecoders\libADM_vd_vpx.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Video Encoders" SecGrpVideoEncoder
+		${MementoSection} "[Null]" SecVidEncNull
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_null.dll
+		${MementoSectionEnd}
+		${MementoSection} "Huffyuv, FFVHuff" SecVidEncLavHuffyuv
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_huff.dll
+		${MementoSectionEnd}
+		${MementoSection} "JPEG" SecVidEncLavJpeg
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_jpeg.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-2" SecVidEncLavMpeg2
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_ffMpeg2.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-4 ASP (libavcodec)" SecVidEncLavMpeg4asp
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_ffMpeg4.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-4 ASP (Xvid)" SecVidEncXvid
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_xvid4.dll
+			SetOutPath $INSTDIR
+			${File} xvidcore.dll
+		${MementoSectionEnd}
+		${MementoSection} "MPEG-4 AVC" SecVidEncX264
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
 
-    Section "Czech (GTK+ only)" SecLangCzech
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Czech cs
-    SectionEnd
-
-    Section "French" SecLangFrench
-        SectionIn 2
-        !insertmacro InstallGtkLanguage French fr
-        !insertmacro InstallQt4Language French fr
-    SectionEnd
-
-    Section "German (GTK+ only)" SecLangGerman
-        SectionIn 2
-        !insertmacro InstallGtkLanguage German de
-    SectionEnd
-
-    Section "Greek (GTK+ only)" SecLangGreek
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Greek el
-    SectionEnd
-
-    Section "Italian" SecLangItalian
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Italian it
-        !insertmacro InstallQt4Language Italian it
-    SectionEnd
-
-    Section "Japanese (GTK+ only)" SecLangJapanese
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Japanese ja
-    SectionEnd
-
-    Section "Russian (GTK+ only)" SecLangRussian
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Russian ru
-    SectionEnd
-
-    Section "Serbian Cyrillic (GTK+ only)" SecLangSerbianCyrillic
-        SectionIn 2
-        !insertmacro InstallGtkLanguage SerbianCyrillic sr
-    SectionEnd
-
-    Section "Serbian Latin (GTK+ only)" SecLangSerbianLatin
-        SectionIn 2
-        !insertmacro InstallGtkLanguage SerbianLatin sr at latin
-    SectionEnd
-
-    Section "Spanish (GTK+ only)" SecLangSpanish
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Spanish es
-    SectionEnd
-
-    Section "Turkish (GTK+ only)" SecLangTurkish
-        SectionIn 2
-        !insertmacro InstallGtkLanguage Turkish tr
-    SectionEnd
+			!insertmacro SectionFlagIsSet ${SecUiCli} ${SF_SELECTED} InstallCli CheckGtk
+InstallCli:
+			${File} plugins\videoEncoders\libADM_ve_x264_other.dll
+CheckGtk:
+!ifdef INST_GTK
+			!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt
+InstallGtk:
+			${File} plugins\videoEncoders\libADM_vidEnc_x264_Gtk.dll
+CheckQt:
+!endif
+!ifdef INST_QT
+			!insertmacro SectionFlagIsSet ${SecUiQt} ${SF_SELECTED} InstallQt End
+InstallQt:
+			${File} plugins\videoEncoders\libADM_ve_x264_qt4.dll
+End:
+!endif
+			SetOutPath $INSTDIR
+			${File} libx264-*.dll
+		${MementoSectionEnd}
+		${MementoSection} "PNG" SecVidEncLavPng
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_png.dll
+		${MementoSectionEnd}
+		${MementoSection} "Sorenson Spark" SecVidEncSorenson
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_ffFlv1.dll
+		${MementoSectionEnd}
+		${MementoSection} "YV12" SecVidEncYv12
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoders
+			${File} plugins\videoEncoders\libADM_ve_yv12.dll
+		${MementoSectionEnd}
+	SectionGroupEnd
+	SectionGroup "Video Filters" SecGrpVideoFilter
+		SectionGroup "Transform Filters" SecGrpVideoFilterTransform
+			${MementoSection} "Add Black Borders" SecVidFltBlackBorders
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_addBorders.dll
+			${MementoSectionEnd}
+			${MementoSection} "Add Logo" SecVidFltLogo
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_logo.dll
+			${MementoSectionEnd}
+			${MementoSection} "Blacken Borders" SecVidFltBlackenBorders
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_blackenBorders.dll
+			${MementoSectionEnd}
+			${MementoSection} "Change FPS" SecVidFltChangeFps
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_changeFps.dll
+			${MementoSectionEnd}
+			${MementoSection} "Crop" SecVidFltCrop
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				!insertmacro SectionFlagIsSet ${SecUiCli} ${SF_SELECTED} InstallCli CheckGtk
+InstallCli:
+				${File} plugins\videoFilters\libADM_vf_CropCli.dll
+CheckGtk:
+!ifdef INST_GTK
+				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt
+InstallGtk:
+				${File} plugins\videoFilters\libADM_vf_CropGtk.dll
+CheckQt:
+!endif
+!ifdef INST_QT
+				!insertmacro SectionFlagIsSet ${SecUiQt} ${SF_SELECTED} InstallQt End
+InstallQt:
+				${File} plugins\videoFilters\libADM_vf_cropQt4.dll
+End:
+!endif
+			${MementoSectionEnd}
+			${MementoSection} "Greyscale" SecVidFltLumaOnly
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_lumaOnly.dll
+			${MementoSectionEnd}
+			${MementoSection} "Horizontal Flip" SecVidFltHorizontalFlip
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_hf_hflip.dll
+			${MementoSectionEnd}
+			${MementoSection} "libswscale Resize" SecVidFltSwscaleResize
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				!insertmacro SectionFlagIsSet ${SecUiCli} ${SF_SELECTED} InstallCli CheckGtk
+InstallCli:
+				${File} plugins\videoFilters\libADM_vf_swscaleResize_cli.dll
+CheckGtk:
+!ifdef INST_GTK
+				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt
+InstallGtk:
+				${File} plugins\videoFilters\libADM_vf_swscaleResize_gtk.dll
+CheckQt:
+!endif
+!ifdef INST_QT
+				!insertmacro SectionFlagIsSet ${SecUiQt} ${SF_SELECTED} InstallQt End
+InstallQt:
+				${File} plugins\videoFilters\libADM_vf_swscaleResize_qt4.dll
+End:
+!endif
+			${MementoSectionEnd}
+			${MementoSection} "Resample FPS" SecVidFltResampleFps
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_resampleFps.dll
+			${MementoSectionEnd}
+			${MementoSection} "Rotate" SecVidFltRotate
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_rotate.dll
+			${MementoSectionEnd}
+			${MementoSection} "Vertical Flip" SecVidFltVerticalFlip
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_vflip.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Interlacing Filters" SecGrpVideoFilterInterlacing
+			${MementoSection} "Decomb Decimate" SecVidFltDecombDecimate
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_decimate.dll
+			${MementoSectionEnd}
+			${MementoSection} "Decomb Telecide" SecVidFltDecombTelecide
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_telecide.dll
+			${MementoSectionEnd}
+			${MementoSection} "Kernel Deint" SecVidFltKernelDeint
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_kernelDeint.dll
+			${MementoSectionEnd}
+			${MementoSection} "libavcodec Deinterlacers" SecVidFltLavDeinterlacers
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_lavDeint.dll
+			${MementoSectionEnd}
+			${MementoSection} "Stack Fields" SecVidFltStackFields
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_stackField.dll
+			${MementoSectionEnd}
+			${MementoSection} "Unstack Fields" SecVidFltUnstackFields
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_unstackField.dll
+			${MementoSectionEnd}
+			${MementoSection} "Yadif" SecVidFltYadif
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_yadif.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Colour Filters" SecGrpVideoFilterColour
+			${MementoSection} "Avisynth Colour YUV" SecVidFltAvisynthColourYuv
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_colorYuv.dll
+			${MementoSectionEnd}
+			${MementoSection} "Remove Plane" SecVidFltRemovePlane
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_removePlane.dll
+			${MementoSectionEnd}
+			${MementoSection} "Swap U and V" SecVidFltSwapUandV
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_swapUV.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Noise Filters" SecGrpVideoFilterNoise
+			${MementoSection} "Gaussian Convolution" SecVidFltGauss
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_gauss.dll
+			${MementoSectionEnd}
+			${MementoSection} "Large Median (5x5)" SecVidFltMediam5x5
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_largeMedian.dll
+			${MementoSectionEnd}
+			${MementoSection} "Mean Convolution" SecVidFltMean
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_mean.dll
+			${MementoSectionEnd}
+			${MementoSection} "Median Convolution" SecVidFltMedian
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_median.dll
+			${MementoSectionEnd}
+			${MementoSection} "MPlayer Denoise 3D" SecVidFltMPlayerDenoise3d
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_denoise3d.dll
+			${MementoSectionEnd}
+			${MementoSection} "MPlayer Denoise 3D HQ" SecVidFltMPlayerHqdn3d
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_denoise3dhq.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Sharpness Filters" SecGrpVideoFilterSharpness
+			${MementoSection} "Sharpen" SecVidFltSharpen
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_sharpen.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Subtitle Filters" SecGrpVideoFilterSubtitle
+			${MementoSection} "ASS, SSA" SecVidFltAssSsa
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_ssa.dll
+				SetOutPath $INSTDIR
+				${File} libfontconfig-1.dll
+				SetOutPath $INSTDIR\etc\fonts
+				${Folder} etc\fonts
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "OpenGL Filters" SecGrpVideoFilterOpenGl
+			${MementoSection} "Fragment Shader" SecVidFltOpenGlFragmentShader
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_sampleGlFrag2.dll
+			${MementoSectionEnd}
+			${MementoSection} "Read Back Benchmark" SecVidFltOpenGlReadBack
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_glBenchmark.dll
+			${MementoSectionEnd}
+			${MementoSection} "Resize" SecVidFltOpenGlResize
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_glResize.dll
+			${MementoSectionEnd}
+			${MementoSection} "Wave" SecVidFltOpenGlWave
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_sampleGlVertex.dll
+			${MementoSectionEnd}
+			${MementoSection} "Yadif" SecVidFltOpenGlYadif
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_glYadif.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+		SectionGroup "Miscellaneous Filters" SecGrpVideoFilterMiscellaneous
+			${MementoUnselectedSection} "Dummy" SecVidFltDummy
+				SectionIn 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_dummy.dll
+			${MementoSectionEnd}
+			${MementoSection} "Print Information" SecVidFltPrintInfo
+				SectionIn 1 2
+				SetOverwrite on
+				SetOutPath $INSTDIR\plugins\videoFilters
+				${File} plugins\videoFilters\libADM_vf_printInfo.dll
+			${MementoSectionEnd}
+		SectionGroupEnd
+	SectionGroupEnd
 SectionGroupEnd
 
-Section AvsProxy SecAvsProxy
+${MementoUnselectedSection} "Avisynth Proxy" SecAvsProxy
     SectionIn 2
     SetOutPath $INSTDIR
     SetOverwrite on
-    File /r ..\..\..\avidemux_2.4_build\avsproxy.exe
-    File /r ..\..\..\avidemux_2.4_build\avsproxy_gui.exe
-    WriteRegStr HKLM "${REGKEY}\Components" "AvsProxy" 1
-SectionEnd
+    ${File} avsproxy.exe
+    ${File} avsproxy_gui.exe
+${MementoSectionEnd}
 
-Section "Sample external filter" SecFilter
-    SectionIn 2
-    SetOutPath $INSTDIR\plugin
-    SetOverwrite on
-    File /r ..\..\..\avidemux_2.4_build\plugin\*
-    WriteRegStr HKLM "${REGKEY}\Components" "Sample external filter" 1
-SectionEnd
-
-Section "-Start menu Change Log" SecStartMenuChangeLog
+${MementoSection} "-Start menu Change Log" SecStartMenuChangeLog
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
     CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Change Log.lnk" "$INSTDIR\Change Log.html"
     !insertmacro MUI_STARTMENU_WRITE_END
-    WriteRegStr HKLM "${REGKEY}\Components" "Start menu" 1
-SectionEnd
+${MementoSectionEnd}
 
-Section "-Start menu GTK+" SecStartMenuGtk
+${MementoSection} "-Start menu GTK+" SecStartMenuGtk
+!ifdef INST_GTK
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
     !insertmacro MUI_STARTMENU_WRITE_END
-    WriteRegStr HKLM "${REGKEY}\Components" "Start menu" 1
-SectionEnd
+!endif
+${MementoSectionEnd}
 
-Section "-Start menu Qt4" SecStartMenuQt4
+${MementoSection} "-Start menu Qt" SecStartMenuQt
+!ifdef INST_QT
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} Qt4.lnk" $INSTDIR\avidemux2_qt4.exe
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
     !insertmacro MUI_STARTMENU_WRITE_END
-    WriteRegStr HKLM "${REGKEY}\Components" "Start menu" 1
-SectionEnd
+!endif
+${MementoSectionEnd}
 
-Section "-Start menu AVS Proxy GUI" SecStartMenuAvsProxyGui
+${MementoSection} "-Start menu AVS Proxy GUI" SecStartMenuAvsProxyGui
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
     CreateShortcut "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI.lnk" "$INSTDIR\avsproxy_gui.exe"
     !insertmacro MUI_STARTMENU_WRITE_END
-    WriteRegStr HKLM "${REGKEY}\Components" "Start menu" 1
-SectionEnd
+${MementoSectionEnd}
 
-Section "-Quick Launch GTK+" SecQuickLaunchGtk
+${MementoSection} "-Quick Launch GTK+" SecQuickLaunchGtk
+!ifdef INST_GTK
     SetOutPath $INSTDIR
-    CreateShortcut "$QUICKLAUNCH\${INTERNALNAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
-    WriteRegStr HKLM "${REGKEY}\Components" "Quick Launch" 1
-SectionEnd
+    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+!endif
+${MementoSectionEnd}
 
-Section "-Quick Launch Qt4" SecQuickLaunchQt4
+${MementoSection} "-Quick Launch Qt" SecQuickLaunchQt
+!ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$QUICKLAUNCH\${INTERNALNAME} Qt4.lnk" $INSTDIR\avidemux2_qt4.exe
-    WriteRegStr HKLM "${REGKEY}\Components" "Quick Launch" 1
-SectionEnd
+    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
+!endif
+${MementoSectionEnd}
 
-Section "-Desktop GTK+" SecDesktopGtk
+${MementoSection} "-Desktop GTK+" SecDesktopGtk
+!ifdef INST_GTK
     SetOutPath $INSTDIR
-    CreateShortcut "$DESKTOP\${INTERNALNAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
-    WriteRegStr HKLM "${REGKEY}\Components" "Desktop" 1
-SectionEnd
+    CreateShortcut "$DESKTOP\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+!endif
+${MementoSectionEnd}
 
-Section "-Desktop Qt4" SecDesktopQt4
+${MementoSection} "-Desktop Qt" SecDesktopQt
+!ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$DESKTOP\${INTERNALNAME} Qt4.lnk" $INSTDIR\avidemux2_qt4.exe
-    WriteRegStr HKLM "${REGKEY}\Components" "Desktop" 1
-SectionEnd
+    CreateShortcut "$DESKTOP\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
+!endif
+${MementoSectionEnd}
 
+${MementoSectionDone}
+
 Section -post SecUninstaller
     SectionIn 1 2
     WriteRegStr HKLM "${REGKEY}" Path $INSTDIR
+    WriteRegStr HKLM "${REGKEY}" Version ${PRODUCT_VERSION}
     SetOutPath $INSTDIR
     WriteUninstaller $INSTDIR\uninstall.exe
-    WriteRegStr HKLM "${UNINST_REGKEY}" DisplayName "${INTERNALNAME}"
-    WriteRegStr HKLM "${UNINST_REGKEY}" DisplayVersion "${VERSION}"
+    WriteRegStr HKLM "${UNINST_REGKEY}" DisplayName "${SHORTCUT_NAME}"
+    WriteRegStr HKLM "${UNINST_REGKEY}" DisplayVersion "${PRODUCT_VERSION}"
     WriteRegStr HKLM "${UNINST_REGKEY}" DisplayIcon $INSTDIR\uninstall.exe
     WriteRegStr HKLM "${UNINST_REGKEY}" UninstallString $INSTDIR\uninstall.exe
     WriteRegDWORD HKLM "${UNINST_REGKEY}" NoModify 1
     WriteRegDWORD HKLM "${UNINST_REGKEY}" NoRepair 1
 SectionEnd
 
-##########################
-# Uninstaller sections
-##########################
-Section /o "un.Sample external filter" UnSecFilter
-    RmDir /r /REBOOTOK $INSTDIR\plugin
-    DeleteRegValue HKLM "${REGKEY}\Components" "Sample external filter"
+Section -CloseLogFile
+	FileClose $UninstallLogHandle
+	SetFileAttributes ${UninstallLogPath} HIDDEN
 SectionEnd
+ 
+Section Uninstall
+	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup	
 
-Section /o "un.AvsProxy" UnSecAvsProxy
-    Delete /REBOOTOK $INSTDIR\avsproxy.exe
-    Delete /REBOOTOK $INSTDIR\avsproxy_gui.exe
-    DeleteRegValue HKLM "${REGKEY}\Components" "AvsProxy"
-SectionEnd
+!ifdef INST_GTK
+	Delete /REBOOTOK "$QUICKLAUNCH\${SHORTCUT_NAME} GTK+.lnk"
+    Delete /REBOOTOK "$DESKTOP\${SHORTCUT_NAME} GTK+.lnk"
+    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME} GTK+.lnk"
+!endif
 
-Section /o un.Catalan UnSecLangCatalan
-	!insertmacro UninstallLanguage Catalan ca
-SectionEnd
+!ifdef INST_QT
+    Delete /REBOOTOK "$QUICKLAUNCH\${SHORTCUT_NAME}.lnk"
+    Delete /REBOOTOK "$DESKTOP\${SHORTCUT_NAME}.lnk"
+    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME}.lnk"
+!endif
 
-Section /o un.Czech UnSecLangCzech
-	!insertmacro UninstallLanguage Czech cs
-SectionEnd
-
-Section /o un.French UnSecLangFrench
-	!insertmacro UninstallLanguage French fr
-SectionEnd
-
-Section /o un.German UnSecLangGerman
-	!insertmacro UninstallLanguage German de
-SectionEnd
-
-Section /o un.Greek UnSecLangGreek
-	!insertmacro UninstallLanguage Greek el
-SectionEnd
-
-Section /o un.Italian UnSecLangItalian
-	!insertmacro UninstallLanguage Italian it
-SectionEnd
-
-Section /o un.Japanese UnSecLangJapanese
-	!insertmacro UninstallLanguage Japanese ja
-SectionEnd
-
-Section /o un.Russian UnSecLangRussian
-	!insertmacro UninstallLanguage Russian ru
-SectionEnd
-
-Section /o un.Serbian UnSecLangSerbianCyrillic
-	!insertmacro UninstallLanguage SerbianCyrillic sr
-SectionEnd
-
-Section /o un.SerbianLatin UnSecLangSerbianLatin
-	!insertmacro UninstallLanguage SerbianLatin sr at latin
-SectionEnd
-
-Section /o un.Spanish UnSecLangSpanish
-	!insertmacro UninstallLanguage Spanish es
-SectionEnd
-
-Section /o un.Turkish UnSecLangTurkish
-	!insertmacro UninstallLanguage Turkish tr
-SectionEnd
-
-Section /o un.GTK+ UnSecUiGtk
-    Delete /REBOOTOK $INSTDIR\libpangowin32-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libpangocairo-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libpango-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgtk-win32-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgthread-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgobject-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgmodule-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgdk-win32-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgdk_pixbuf-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libcairo-2.dll
-    Delete /REBOOTOK $INSTDIR\libatk-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\gtk2_prefs.exe
-    Delete /REBOOTOK $INSTDIR\avidemux2_gtk.exe
-    RmDir /r /REBOOTOK $INSTDIR\share\themes
-    RmDir /r /REBOOTOK $INSTDIR\lib\gtk-2.0
-    RmDir /r /REBOOTOK $INSTDIR\etc\gtk-2.0
-    RmDir /r /REBOOTOK $INSTDIR\etc\pango
-    DeleteRegValue HKLM "${REGKEY}\Components" GTK+
-SectionEnd
-
-Section /o un.Qt4 UnSecUiQt4
-    Delete /REBOOTOK $INSTDIR\QtCore4.dll
-    Delete /REBOOTOK $INSTDIR\mingwm10.dll
-    Delete /REBOOTOK $INSTDIR\avidemux2_qt4.exe
-    Delete /REBOOTOK $INSTDIR\QtGui4.dll
-    DeleteRegValue HKLM "${REGKEY}\Components" Qt4
-SectionEnd
-
-Section /o "un.Command line" UnSecUiCli
-    Delete /REBOOTOK $INSTDIR\avidemux2_cli.exe
-    DeleteRegValue HKLM "${REGKEY}\Components" "Command line"
-SectionEnd
-
-Section /o "un.Core files (required)" UnSecCore
-    Delete /REBOOTOK $INSTDIR\xvidcore.dll
-    Delete /REBOOTOK $INSTDIR\xmltok.dll
-    Delete /REBOOTOK $INSTDIR\vorbisenc.dll
-    Delete /REBOOTOK $INSTDIR\vorbis.dll
-    Delete /REBOOTOK $INSTDIR\SDL.dll
-    Delete /REBOOTOK $INSTDIR\pthreadGC2.dll
-    Delete /REBOOTOK $INSTDIR\ogg.dll
-    Delete /REBOOTOK $INSTDIR\libxml2.dll
-    Delete /REBOOTOK $INSTDIR\libx264.dll
-    Delete /REBOOTOK $INSTDIR\libpng12-0.dll
-    Delete /REBOOTOK $INSTDIR\libmp3lame-0.dll
-    Delete /REBOOTOK $INSTDIR\libglib-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libfontconfig-1.dll
-    Delete /REBOOTOK $INSTDIR\libfaad2.dll
-    Delete /REBOOTOK $INSTDIR\libfaac.dll
-    Delete /REBOOTOK $INSTDIR\libexpat.dll
-    Delete /REBOOTOK $INSTDIR\libaften.dll
-    Delete /REBOOTOK $INSTDIR\intl.dll
-    Delete /REBOOTOK $INSTDIR\iconv.dll
-    Delete /REBOOTOK $INSTDIR\freetype6.dll
-    Delete /REBOOTOK $INSTDIR\zlib1.dll
-    Delete /REBOOTOK "$INSTDIR\Build Info.txt"
-    Delete /REBOOTOK "$INSTDIR\Change Log.html"
-    Delete /REBOOTOK "$INSTDIR\stdout.txt"
-    Delete /REBOOTOK "$INSTDIR\stderr.txt"
-    RmDir /r /REBOOTOK $INSTDIR\etc\fonts
-    DeleteRegValue HKLM "${REGKEY}\Components" Avidemux
-    
-    RmDir /REBOOTOK $INSTDIR\share\gettext
-    RmDir /REBOOTOK $INSTDIR\share
-SectionEnd
-
-Section /o "un.Start menu" UnSecStartMenu
-    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Change Log.lnk"
-    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} GTK+.lnk"
-    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} Qt4.lnk"
+	Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Change Log.lnk"
     Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI.lnk"
-SectionEnd
-
-Section /o "un.Quick Launch" UnSecQuickLaunch
-    Delete /REBOOTOK "$QUICKLAUNCH\${INTERNALNAME} GTK+.lnk"
-    Delete /REBOOTOK "$QUICKLAUNCH\${INTERNALNAME} Qt4.lnk"
-SectionEnd
-
-Section /o "un.Desktop" UnSecDesktop
-    Delete /REBOOTOK "$DESKTOP\${INTERNALNAME} GTK+.lnk"
-    Delete /REBOOTOK "$DESKTOP\${INTERNALNAME} Qt4.lnk"
-SectionEnd
-
-Section un.post UnSecUninstaller
-    RmDir /REBOOTOK $INSTDIR\etc
-    RmDir /REBOOTOK $INSTDIR\i18n
-    RmDir /REBOOTOK $INSTDIR\lib
-    RmDir /REBOOTOK $INSTDIR\share\locale
-    RmDir /REBOOTOK $INSTDIR\share
+    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup
+    DeleteRegValue HKLM "${REGKEY}" StartMenuGroup
     
     DeleteRegKey HKLM "${UNINST_REGKEY}"
-    Delete /REBOOTOK $INSTDIR\uninstall.exe
-    DeleteRegValue HKLM "${REGKEY}" StartMenuGroup
     DeleteRegValue HKLM "${REGKEY}" Path
-    DeleteRegKey /IfEmpty HKLM "${REGKEY}\Components"
     DeleteRegKey /IfEmpty HKLM "${REGKEY}"
-    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup
-    RmDir /REBOOTOK $INSTDIR
-    Push $R0
-    StrCpy $R0 $StartMenuGroup 1
-    StrCmp $R0 ">" no_smgroup
-no_smgroup:
+
+	FileOpen $UninstallLogHandle "${UninstallLogPath}" r
+UninstallLoop:
+    ClearErrors
+    FileRead $UninstallLogHandle $R0
+    IfErrors UninstallEnd
+	Push $R0
+    Call un.TrimNewLines
     Pop $R0
+    Delete "$R0"
+    Goto UninstallLoop
+UninstallEnd:
+	FileClose $UninstallLogHandle
+	Delete "${UninstallLogPath}"
+	Delete "$INSTDIR\uninstall.exe"
+	Push "\"
+	Call un.RemoveEmptyDirs
+	RMDir "$INSTDIR"
 SectionEnd
 
 ##########################
 # Installer functions
 ##########################
 Function .onInit
-    ReadRegStr $R0  HKLM "${UNINST_REGKEY}" "UninstallString"
-    StrCmp $R0 "" startInstall
- 
-    MessageBox MB_YESNO|MB_ICONEXCLAMATION "${INTERNALNAME} has already been installed. $\n$\nDo you want to remove \
-      the previous version before installing $(^Name)?" IDNO startInstall
-  
-    # Run the uninstaller
-    ClearErrors
-    ExecWait '$R0 _?=$INSTDIR' ; Do not copy the uninstaller to a temp file
+	Call LoadPreviousSettings
 
-startInstall:
+	ReadRegStr $PreviousVersion HKLM "${REGKEY}" Version
+
+	${If} $PreviousVersion != ""
+		${VersionCompare} ${PRODUCT_VERSION} $PreviousVersion $PreviousVersionState
+	${EndIf}
+	
     InitPluginsDir
-    
-    !insertmacro MUI_INSTALLOPTIONS_EXTRACT "${INSTALL_OPTS_INI}"
+    SetShellVarContext all
+FunctionEnd
 
-    # Make sure a User Interface is selected in previous install preferences
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "Command line"
-    StrCmp $0 1 populate
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "GTK+"
-    StrCmp $0 1 populate
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "Qt4"
-    StrCmp $0 1 populate
-
-    # No UI exists, so go with defaults
-    Goto end
-
-    #Select sections based on last install
-populate:
-    !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
-    !insertmacro SELECT_SECTION "Command line" ${SecUiCli}
-    !insertmacro SELECT_SECTION Qt4 ${SecUiQt4}
-    !insertmacro SELECT_SECTION GTK+ ${SecUiGtk}
-    !insertmacro SELECT_SECTION Catalan ${SecLangCatalan}
-    !insertmacro SELECT_SECTION Czech ${SecLangCzech}
-    !insertmacro SELECT_SECTION French ${SecLangFrench}
-    !insertmacro SELECT_SECTION German ${SecLangGerman}
-    !insertmacro SELECT_SECTION Greek ${SecLangGreek}
-    !insertmacro SELECT_SECTION Italian ${SecLangItalian}
-    !insertmacro SELECT_SECTION Japanese ${SecLangJapanese}
-    !insertmacro SELECT_SECTION Russian ${SecLangRussian}
-    !insertmacro SELECT_SECTION SerbianCyrillic ${SecLangSerbianCyrillic}
-    !insertmacro SELECT_SECTION SerbianLatin ${SecLangSerbianLatin}
-    !insertmacro SELECT_SECTION Spanish ${SecLangSpanish}
-    !insertmacro SELECT_SECTION Turkish ${SecLangTurkish}
-    !insertmacro SELECT_SECTION "Sample external filter" ${SecFilter}
-    !insertmacro SELECT_SECTION AvsProxy ${SecAvsProxy}
-
-    #startMenu:
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "Start menu"
-    !insertmacro MUI_INSTALLOPTIONS_WRITE "${INSTALL_OPTS_INI}" "Field 3" "State" $0
-    
-    #desktop:
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "Desktop"
-    !insertmacro MUI_INSTALLOPTIONS_WRITE "${INSTALL_OPTS_INI}" "Field 2" "State" $0
-    
-    #quickLaunch:
-    ReadRegStr $0 HKLM "${REGKEY}\Components" "Quick Launch"
-    !insertmacro MUI_INSTALLOPTIONS_WRITE "${INSTALL_OPTS_INI}" "Field 4" "State" $0
-    
-end:
+Function .onInstSuccess
+	${MementoSectionSave}
 FunctionEnd
 
+!ifdef INST_BOTH
 Function .onSelChange
 	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end checkCLI
 checkCLI:
 	!insertmacro SectionFlagIsSet ${SecUiCli} ${SF_SELECTED} end disable
-	
+
 disable:  # GTK langs only
 	SectionSetFlags ${SecLangCatalan} SF_RO
 	SectionSetFlags ${SecLangCzech} SF_RO
 	SectionSetFlags ${SecLangFrench} SF_RO
 	SectionSetFlags ${SecLangGerman} SF_RO
-	SectionSetFlags ${SecLangGreek} SF_RO	
+	SectionSetFlags ${SecLangGreek} SF_RO
 	SectionSetFlags ${SecLangJapanese} SF_RO
 	SectionSetFlags ${SecLangRussian} SF_RO
 	SectionSetFlags ${SecLangSerbianCyrillic} SF_RO
@@ -656,7 +1193,66 @@
 	SectionSetFlags ${SecLangTurkish} SF_RO
 end:
 FunctionEnd
+!endif
 
+Function LoadPreviousSettings
+    ${MementoSectionRestore}
+	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
+
+#checkStartMenuGtk:
+	!insertmacro SectionFlagIsSet ${SecStartMenuGtk} ${SF_SELECTED} enableStartMenu checkStartMenuQt
+checkStartMenuQt:
+	!insertmacro SectionFlagIsSet ${SecStartMenuQt} ${SF_SELECTED} enableStartMenu checkDesktopGtk
+
+enableStartMenu:
+	StrCpy $CreateStartMenuGroup 1
+
+checkDesktopGtk:
+	!insertmacro SectionFlagIsSet ${SecDesktopGtk} ${SF_SELECTED} enableDesktop checkDesktopQt
+checkDesktopQt:
+	!insertmacro SectionFlagIsSet ${SecDesktopQt} ${SF_SELECTED} enableDesktop checkQuickLaunchGtk
+
+enableDesktop:
+	StrCpy $CreateDesktopIcon 1
+	
+checkQuickLaunchGtk:
+	!insertmacro SectionFlagIsSet ${SecQuickLaunchGtk} ${SF_SELECTED} enableQuickLaunch checkQuickLaunchQt
+checkQuickLaunchQt:
+	!insertmacro SectionFlagIsSet ${SecQuickLaunchQt} ${SF_SELECTED} enableQuickLaunch end
+
+enableQuickLaunch:
+	StrCpy $CreateQuickLaunchIcon 1	
+
+end:
+FunctionEnd
+
+Function RunUninstaller
+    ReadRegStr $R1  HKLM "${UNINST_REGKEY}" "UninstallString"
+
+	${If} $R1 == ""
+		Return
+	${EndIf}
+
+	;Run uninstaller
+	HideWindow
+	ClearErrors
+	
+	${If} $PreviousVersionState == 0
+	${AndIf} $ReinstallUninstall == 1
+		ExecWait '$R1 _?=$INSTDIR'
+	${Else}
+		ExecWait '$R1 /frominstall _?=$INSTDIR'
+	${EndIf}
+
+	IfErrors NoRemoveUninstaller
+	IfFileExists "$INSTDIR\uninstall.exe" 0 NoRemoveUninstaller
+		Delete "$R1"
+		RMDir $INSTDIR
+
+NoRemoveUninstaller:
+FunctionEnd
+
+!ifdef INST_BOTH
 Function CheckSelectedUIs
 	!insertmacro SectionFlagIsSet ${SecGrpUI} ${SF_SELECTED} end checkPartial
 checkPartial:
@@ -666,24 +1262,67 @@
     Abort
 end:
 FunctionEnd
+!endif
 
 LangString INSTALL_OPTS_PAGE_TITLE ${LANG_ENGLISH} "Choose Install Options"
 LangString INSTALL_OPTS_PAGE_SUBTITLE ${LANG_ENGLISH} "Choose where to install Avidemux icons."
+Var dlgInstallOptions
+Var lblCreateIcons
+Var chkDesktop
+Var chkStartMenu
+Var chkQuickLaunch
 
 Function InstallOptionsPage
-    Call IsInstallOptionsRequired
+	Call IsInstallOptionsRequired
+	!insertmacro MUI_HEADER_TEXT "$(INSTALL_OPTS_PAGE_TITLE)" "$(INSTALL_OPTS_PAGE_SUBTITLE)"
 
-    !insertmacro MUI_HEADER_TEXT "$(INSTALL_OPTS_PAGE_TITLE)" "$(INSTALL_OPTS_PAGE_SUBTITLE)"
-    !insertmacro MUI_INSTALLOPTIONS_DISPLAY "${INSTALL_OPTS_INI}"
-    
-    Call ReadInstallOptions
+	nsDialogs::Create 1018
+	Pop $dlgInstallOptions
+
+	${If} $dlgInstallOptions == error
+		Abort
+	${EndIf}
+
+	${NSD_CreateLabel} 0 0u 100% 12u "Create icons for Avidemux:"
+	Pop $lblCreateIcons
+
+	${NSD_CreateCheckBox} 0 18u 100% 12u "On my &Desktop"
+	Pop $chkDesktop
+	${NSD_SetState} $chkDesktop $CreateDesktopIcon
+	${NSD_OnClick} $chkDesktop UpdateInstallOptions
+
+	${NSD_CreateCheckBox} 0 36u 100% 12u "In my &Start Menu Programs folder"
+	Pop $chkStartMenu
+	${NSD_SetState} $chkStartMenu $CreateStartMenuGroup
+	${NSD_OnClick} $chkStartMenu UpdateInstallOptions
+
+	${NSD_CreateCheckBox} 0 54u 100% 12u "In my &Quick Launch bar"
+	Pop $chkQuickLaunch
+	${NSD_SetState} $chkQuickLaunch $CreateQuickLaunchIcon
+	${NSD_OnClick} $chkQuickLaunch UpdateInstallOptions
+
+	nsDialogs::Show
 FunctionEnd
 
+Function UpdateInstallOptions
+	${NSD_GetState} $chkDesktop $CreateDesktopIcon
+	${NSD_GetState} $chkStartMenu $CreateStartMenuGroup
+	${NSD_GetState} $chkQuickLaunch $CreateQuickLaunchIcon
+FunctionEnd
+
 Function IsInstallOptionsRequired
-	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end resetOptions
-	!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} end resetOptions
+!ifdef INST_GTK
+	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end checkQt
+checkQt:
+!ifndef INST_BOTH
+Goto end
+!endif
+!endif
+!ifdef INST_QT
+	!insertmacro SectionFlagIsSet ${SecUiQt} ${SF_SELECTED} end resetOptions
+resetOptions:
+!endif
 
-resetOptions:
     StrCpy $CreateDesktopIcon 0
     StrCpy $CreateStartMenuGroup 0
     StrCpy $CreateQuickLaunchIcon 0
@@ -692,15 +1331,9 @@
 end:
 FunctionEnd
 
-Function ReadInstallOptions
-    !insertmacro MUI_INSTALLOPTIONS_READ $CreateDesktopIcon "${INSTALL_OPTS_INI}" "Field 2" "State"
-    !insertmacro MUI_INSTALLOPTIONS_READ $CreateStartMenuGroup "${INSTALL_OPTS_INI}" "Field 3" "State"
-    !insertmacro MUI_INSTALLOPTIONS_READ $CreateQuickLaunchIcon "${INSTALL_OPTS_INI}" "Field 4" "State"
-FunctionEnd
-
 Function IsStartMenuRequired
     StrCmp $CreateStartMenuGroup 1 +2
-        Abort    
+        Abort
 FunctionEnd
 
 Function ActivateInternalSections
@@ -709,105 +1342,260 @@
     IntOp $0 $0 & ${SF_SELECTED}
     IntOp $0 $0 & $CreateStartMenuGroup
     SectionSetFlags ${SecStartMenuAvsProxyGui} $0
-    
+
     #Change Log shortcut:
     SectionSetFlags ${SecStartMenuChangeLog} $CreateStartMenuGroup
 
+!ifdef INST_GTK
     #GTK shortcuts:
     SectionGetFlags ${SecUiGtk} $0
     IntOp $0 $0 & ${SF_SELECTED}
 
     IntOp $1 $0 & $CreateDesktopIcon
     SectionSetFlags ${SecDesktopGtk} $1
-    
+
     IntOp $1 $0 & $CreateQuickLaunchIcon
     SectionSetFlags ${SecQuickLaunchGtk} $1
-    
+
     IntOp $1 $0 & $CreateStartMenuGroup
     SectionSetFlags ${SecStartMenuGtk} $1
-    
-    #Qt4 shortcuts:
-    SectionGetFlags ${SecUiQt4} $0
+!endif
+
+!ifdef INST_QT
+    #Qt shortcuts:
+    SectionGetFlags ${SecUiQt} $0
     IntOp $0 $0 & ${SF_SELECTED}
-    
+
     IntOp $1 $0 & $CreateDesktopIcon
-    SectionSetFlags ${SecDesktopQt4} $1
-    
+    SectionSetFlags ${SecDesktopQt} $1
+
     IntOp $1 $0 & $CreateQuickLaunchIcon
-    SectionSetFlags ${SecQuickLaunchQt4} $1
-    
+    SectionSetFlags ${SecQuickLaunchQt} $1
+
     IntOp $1 $0 & $CreateStartMenuGroup
-    SectionSetFlags ${SecStartMenuQt4} $1
+    SectionSetFlags ${SecStartMenuQt} $1
+!endif
 FunctionEnd
 
+Function InstFilesPageShow
+	${If} $ReinstallUninstall != ""
+		Call RunUninstaller
+		BringToFront
+	${EndIf}
+FunctionEnd
+
+Function InstFilesPageLeave
+	; Don't advance automatically if details expanded
+	FindWindow $R0 "#32770" "" $HWNDPARENT
+	GetDlgItem $R0 $R0 1016
+	System::Call user32::IsWindowVisible(i$R0)i.s
+	Pop $R0
+
+	StrCmp $R0 0 +2
+	SetAutoClose false
+FunctionEnd
+
 Function ConfigureFinishPage
+!ifdef INST_GTK
     SectionGetFlags ${SecUiGtk} $0
     IntOp $0 $0 & ${SF_SELECTED}
     StrCmp $0 ${SF_SELECTED} end
-    
-    SectionGetFlags ${SecUiQt4} $0
+!endif
+
+!ifdef INST_QT
+    SectionGetFlags ${SecUiQt} $0
     IntOp $0 $0 & ${SF_SELECTED}
     StrCmp $0 ${SF_SELECTED} end
+!endif
 
     DeleteINISec "$PLUGINSDIR\ioSpecial.ini" "Field 4"
-        
+
 end:
 FunctionEnd
 
-Function OnShowFinishPage
-    # Make hyperlink underlined to keep it consistent with web browsers
-    GetDlgItem $0 $MUI_HWND 1205
-    CreateFont $1 "$(^Font)" 9 500 /UNDERLINE
-    SendMessage $0 ${WM_SETFONT} $1 0    
-FunctionEnd
-
 Function RunAvidemux
     SetOutPath $INSTDIR
 
-#GTK:
-    SectionGetFlags ${SecUiGtk} $0
+!ifdef INST_QT
+#Qt:
+    SectionGetFlags ${SecUiQt} $0
     IntOp $0 $0 & ${SF_SELECTED}
-    
-    StrCmp $0 ${SF_SELECTED} 0 Qt4
-        Exec "$INSTDIR\avidemux2_gtk.exe"
 
+    StrCmp $0 ${SF_SELECTED} 0 GTK
+        Exec "$INSTDIR\avidemux3_qt4.exe"
+
     Goto end
-    
-Qt4:
-    SectionGetFlags ${SecUiQt4} $0
+GTK:
+!endif
+
+!ifdef INST_GTK
+    SectionGetFlags ${SecUiGtk} $0
     IntOp $0 $0 & ${SF_SELECTED}
-    
+
     StrCmp $0 ${SF_SELECTED} 0 End
-        Exec "$INSTDIR\avidemux2_qt4.exe"    
-    
+        Exec "$INSTDIR\avidemux3_gtk.exe"
+!endif
+
 end:
 FunctionEnd
 
+Var ReinstallUninstallButton
+
+Function ReinstallPage
+	${If} $PreviousVersion == ""
+		Abort
+	${EndIf}
+
+	nsDialogs::Create /NOUNLOAD 1018
+	Pop $0
+
+	${If} $PreviousVersionState == 1
+		!insertmacro MUI_HEADER_TEXT "Already Installed" "Choose how you want to install ${PRODUCT_FULLNAME}."
+		nsDialogs::CreateItem /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 0 0 100% 40 "An older version of Avidemux is installed on your system.  Select the operation you want to perform and click Next to continue."
+		Pop $R0
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_VCENTER}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${WS_GROUP}|${WS_TABSTOP} 0 10 55 100% 30 "Upgrade Avidemux using previous settings (recommended)"
+		Pop $ReinstallUninstallButton
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_TOP}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 10 85 100% 50 "Change settings (advanced)"
+		Pop $R0
+
+		${If} $ReinstallUninstall == ""
+			StrCpy $ReinstallUninstall 1
+		${EndIf}
+	${ElseIf} $PreviousVersionState == 2
+		!insertmacro MUI_HEADER_TEXT "Already Installed" "Choose how you want to install ${PRODUCT_FULLNAME}."
+		nsDialogs::CreateItem /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 0 0 100% 40 "A newer version of Avidemux is already installed! It is not recommended that you downgrade to an older version. Select the operation you want to perform and click Next to continue."
+		Pop $R0
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_VCENTER}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${WS_GROUP}|${WS_TABSTOP} 0 10 55 100% 30 "Downgrade Avidemux using previous settings (recommended)"
+		Pop $ReinstallUninstallButton
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_TOP}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 10 85 100% 50 "Change settings (advanced)"
+		Pop $R0
+
+		${If} $ReinstallUninstall == ""
+			StrCpy $ReinstallUninstall 1
+		${EndIf}
+	${ElseIf} $PreviousVersionState == 0
+		!insertmacro MUI_HEADER_TEXT "Already Installed" "Choose the maintenance option to perform."
+		nsDialogs::CreateItem /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 0 0 100% 40 "${PRODUCT_FULLNAME} is already installed. Select the operation you want to perform and click Next to continue."
+		Pop $R0
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_VCENTER}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${WS_GROUP}|${WS_TABSTOP} 0 10 55 100% 30 "Add/Remove/Reinstall components"
+		Pop $R0
+		nsDialogs::CreateItem /NOUNLOAD BUTTON ${BS_AUTORADIOBUTTON}|${BS_TOP}|${BS_MULTILINE}|${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 10 85 100% 50 "Uninstall Avidemux"
+		Pop $ReinstallUninstallButton
+
+		${If} $ReinstallUninstall == ""
+			StrCpy $ReinstallUninstall 2
+		${EndIf}
+	${Else}
+		MessageBox MB_ICONSTOP "Unknown value of PreviousVersionState, aborting" /SD IDOK
+		Abort
+	${EndIf}
+
+	${If} $ReinstallUninstall == "1"
+		SendMessage $ReinstallUninstallButton ${BM_SETCHECK} 1 0
+	${Else}
+		SendMessage $R0 ${BM_SETCHECK} 1 0
+	${EndIf}
+
+	nsDialogs::Show
+FunctionEnd
+
+Function ReinstallPageLeave
+	SendMessage $ReinstallUninstallButton ${BM_GETCHECK} 0 0 $R0
+
+	${If} $R0 == 1
+		; Option to uninstall old version selected
+		StrCpy $ReinstallUninstall 1
+	${Else}
+		; Custom up/downgrade or add/remove/reinstall
+		StrCpy $ReinstallUninstall 2
+	${EndIf}
+
+	${If} $ReinstallUninstall == 1
+		${If} $PreviousVersionState == 0
+			Call RunUninstaller
+			Quit
+		${Else}
+			; Need to reload defaults. User could have
+			; chosen custom, change something, went back and selected
+			; the express option.
+			Call LoadPreviousSettings
+		${EndIf}
+	${EndIf}
+FunctionEnd
+
+
 ##########################
 # Uninstaller functions
 ##########################
 Function un.onInit
-    ReadRegStr $INSTDIR HKLM "${REGKEY}" Path
-    !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
-    !insertmacro SELECT_SECTION "Core files (required)" ${UnSecCore}
-    !insertmacro SELECT_SECTION "Command line" ${UnSecUiCli}
-    !insertmacro SELECT_SECTION Qt4 ${UnSecUiQt4}
-    !insertmacro SELECT_SECTION GTK+ ${UnSecUiGtk}
-    !insertmacro SELECT_SECTION Catalan ${UnSecLangCatalan}
-    !insertmacro SELECT_SECTION Czech ${UnSecLangCzech}
-    !insertmacro SELECT_SECTION French ${UnSecLangFrench}
-    !insertmacro SELECT_SECTION German ${UnSecLangGerman}
-    !insertmacro SELECT_SECTION Greek ${UnSecLangGreek}
-    !insertmacro SELECT_SECTION Italian ${UnSecLangItalian}
-    !insertmacro SELECT_SECTION Japanese ${UnSecLangJapanese}
-    !insertmacro SELECT_SECTION Russian ${UnSecLangRussian}
-    !insertmacro SELECT_SECTION SerbianCyrillic ${UnSecLangSerbianCyrillic}
-    !insertmacro SELECT_SECTION SerbianLatin ${UnSecLangSerbianLatin}
-    !insertmacro SELECT_SECTION Spanish ${UnSecLangSpanish}
-    !insertmacro SELECT_SECTION Turkish ${UnSecLangTurkish}
-    !insertmacro SELECT_SECTION AvsProxy ${UnSecAvsProxy}
-    !insertmacro SELECT_SECTION "Sample external filter" ${UnSecFilter}
-    !insertmacro SELECT_SECTION "Start menu" ${UnSecStartMenu}
-    !insertmacro SELECT_SECTION "Quick Launch" ${UnSecQuickLaunch}
-    !insertmacro SELECT_SECTION "Desktop" ${UnSecDesktop}
+	SetShellVarContext all
 FunctionEnd
+
+; TrimNewlines (copied from NSIS documentation)
+; input, top of stack  (e.g. whatever$\r$\n)
+; output, top of stack (replaces, with e.g. whatever)
+; modifies no other variables.
+Function un.TrimNewlines
+	Exch $R0
+	Push $R1
+	Push $R2
+	StrCpy $R1 0
+
+loop:
+	IntOp $R1 $R1 - 1
+	StrCpy $R2 $R0 1 $R1
+	StrCmp $R2 "$\r" loop
+	StrCmp $R2 "$\n" loop
+	IntOp $R1 $R1 + 1
+	IntCmp $R1 0 no_trim_needed
+	StrCpy $R0 $R0 $R1
+
+no_trim_needed:
+	Pop $R2
+	Pop $R1
+	Exch $R0
+FunctionEnd
+ 
+Function un.RemoveEmptyDirs
+	Pop $9
+	!define Index 'Line${__LINE__}'
+	FindFirst $0 $1 "$INSTDIR$9*"
+	StrCmp $0 "" "${Index}-End"
+"${Index}-Loop:"
+	StrCmp $1 "" "${Index}-End"
+	StrCmp $1 "." "${Index}-Next"
+	StrCmp $1 ".." "${Index}-Next"
+	Push $0
+	Push $1
+	Push $9
+	Push "$9$1\"
+	Call un.RemoveEmptyDirs
+	Pop $9
+	Pop $1
+	Pop $0
+;"${Index}-Remove:"
+	RMDir "$INSTDIR$9$1"
+"${Index}-Next:"
+	FindNext $0 $1
+	Goto "${Index}-Loop"
+"${Index}-End:"
+	FindClose $0
+	!undef Index
+FunctionEnd
+
+Function un.ConfirmPagePre
+	${un.GetParameters} $R0
+	${un.GetOptions} $R0 "/frominstall" $R1
+	${Unless} ${Errors}
+		Abort
+	${EndUnless}
+FunctionEnd
+
+Function un.FinishPagePre
+	${un.GetParameters} $R0
+	${un.GetOptions} $R0 "/frominstall" $R1
+	${Unless} ${Errors}
+		SetRebootFlag false
+		Abort
+	${EndUnless}
+FunctionEnd

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/genlog.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/genlog.sh	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/genlog.sh	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,4 +1,4 @@
-svn log --stop-on-copy --xml ../.. > svn.xml
-xsltproc svnlog.xslt svn.xml > "../../../avidemux_2.4_build/Change Log.html"
-xsltproc revision.xslt svn.xml > revision.nsh
-rm svn.xml
+svn log --stop-on-copy --xml $SOURCEDIR > "svn [$BUILDBITS].xml"
+xsltproc svnlog.xslt "svn [$BUILDBITS].xml" > "$BUILDDIR/Change Log.html"
+xsltproc revision.xslt "svn [$BUILDBITS].xml" > revision.nsh
+rm "svn [$BUILDBITS].xml"

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/svnlog.xslt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/svnlog.xslt	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/svnlog.xslt	2011-09-13 16:09:05 UTC (rev 7521)
@@ -53,10 +53,10 @@
           padding-bottom: 5px;
           }
         </style>
-        <title>Avidemux 2.4 Change Log</title>
+        <title>Avidemux 2.6 Change Log</title>
       </head>
       <body>
-        <h1>Avidemux 2.4 Change Log</h1>
+        <h1>Avidemux 2.6 Change Log</h1>
         <div align="center">
           <table class="build">
             <tr>

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -4,24 +4,36 @@
 if errorlevel 1 goto error
 pause
 
+make install
+if errorlevel 1 goto error
+
 cd "%sourceDir%\%buildCliFolder%"
 cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/cli
 
 if errorlevel 1 goto error
 pause
 
+make install
+if errorlevel 1 goto error
+
 cd "%sourceDir%\%buildGtkFolder%"
-cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/gtk
+rem cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/gtk
 
 if errorlevel 1 goto error
-pause
+rem pause
 
+rem make install
+if errorlevel 1 goto error
+
 cd "%sourceDir%\%buildQtFolder%"
 cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/qt4
 
 if errorlevel 1 goto error
 pause
 
+make install
+if errorlevel 1 goto error
+
 set msysSourceDir=%sourceDir:\=/%
 cd "%sourceDir%\%buildPluginFolder%"
 cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_SOURCE_DIR="%msysSourceDir%" -DPLUGIN_UI=ALL %DebugFlags% ../../avidemux_plugins
@@ -29,30 +41,8 @@
 if errorlevel 1 goto error
 pause
 
-cd "%sourceDir%\%buildCoreFolder%"
-make install
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%\%buildCliFolder%"
-make install
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%\%buildGtkFolder%"
-make install
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%\%buildQtFolder%"
-make install
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%\%buildPluginFolder%"
 rmdir /s /q "%buildDir%\plugins" 2> NUL
 make install
-
 if errorlevel 1 goto error
 goto :EOF
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -43,7 +43,5 @@
 goto end
 
 :error
-exit /b 1
-
 :end
 pause
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,7 +1,7 @@
 set PATH=%msysDir%\bin;%PATH%
 
 echo -- Generating Change Log.html --
-cd "..\..\installer"
+cd "..\..\..\avidemux\wininstaller"
 sh genlog.sh
 
 echo -- Generating Package Notes.html --

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,4 +1,4 @@
-set zipFile=avidemux_sdk_2.5_r%revisionNo%_win.zip
+set zipFile=avidemux_sdk_2.6_r%revisionNo%_win.zip
 
 if "%BuildBits%" == "32" (
 	set sdk32BuildDir=%sdkBuildDir%

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,17 +1,17 @@
-set baseFile=avidemux_2.5_r%revisionNo%_win%BuildBits%
+set baseFile=avidemux_2.6_r%revisionNo%_win%BuildBits%
 set zipFile=%baseFile%.zip
 
 copy "%buildDir%\Change Log.html" "%packageDir%"
 move "Tools\Package Notes [%BuildBits%].html" "%packageDir%\Package Notes.html"
 
 cd %buildDir%
-if "%BuildBits%" == "32" (
-	echo -- Generating GTK+ Installer --
-	"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
-)
+rem if "%BuildBits%" == "32" (
+rem	echo -- Generating GTK+ Installer --
+rem	"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\..\avidemux\wininstaller" /DEXEDIR="%packageDir%" "%curDir%\..\..\..\avidemux\wininstaller\avidemux.nsi"
+rem )
 
 echo -- Generating Qt Installer --
-"%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+"%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\..\avidemux\wininstaller" /DEXEDIR="%packageDir%" "%curDir%\..\..\..\avidemux\wininstaller\avidemux.nsi"
 
 mkdir "%packageDir%\temp"
 cd "%packageDir%\temp"

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -26,8 +26,8 @@
 	goto error
 )
 
-if exist "%ProgramFiles32%\7-zip" (
-	set SevenZipDir=%ProgramFiles32%\7-zip
+if exist "%ProgramFiles%\7-zip" (
+	set SevenZipDir=%ProgramFiles%\7-zip
 ) else (
 	echo 7-zip could not be found.  Please download from http://www.7-zip.org
 	goto error

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,6 +1,6 @@
-if not exist "..\..\..\installer\revision.nsh" goto end
+if not exist "..\..\..\..\avidemux\wininstaller\revision.nsh" goto end
 
-copy "Revision No template.bat" + "..\..\..\installer\revision.nsh" temp.bat > NUL
+copy "Revision No template.bat" + "..\..\..\..\avidemux\wininstaller\revision.nsh" temp.bat > NUL
 
 call temp.bat
 del temp.bat

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1 +1 @@
-xsltproc touch_files.xslt "../Package Notes.xml" > "../Touch 2.5 Files [$BUILDBITS].html"
\ No newline at end of file
+xsltproc touch_files.xslt "../Package Notes.xml" > "../Touch 2.6 Files [$BUILDBITS].html"
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt	2011-09-13 16:09:05 UTC (rev 7521)
@@ -54,10 +54,10 @@
           padding-bottom: 5px;
           }
         </style>
-        <title>Avidemux 2.5 Win32 Package Notes</title>
+        <title>Avidemux 2.6 Windows Package Notes</title>
       </head>
       <body>
-        <h1>Avidemux 2.5 Win32 Package Notes</h1>
+        <h1>Avidemux 2.6 Windows Package Notes</h1>
         <div>
           <xsl:apply-templates select="buildentry" />
         </div>

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -49,10 +49,15 @@
 
 copy ".\include\*.h" "%usrLocalDir%\include"
 cd libfaac
-gcc -s -O3 -shared -I../include *.c -o"%usrLocalDir%/bin/libfaac.dll" -Wl,--out-implib,"%usrLocalDir%/lib/libfaac.a"
+copy "%curDir%\makefile."
+
+make
 if errorlevel 1 goto end
 
+copy libfaac.dll "%usrLocalDir%/bin"
+copy libfaac.a "%usrLocalDir%/lib"
 copy "%usrLocalDir%\bin\libfaac.dll" "%admBuildDir%"
+
 goto end
 
 :error

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/makefile
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/makefile	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/makefile	2011-09-13 16:09:05 UTC (rev 7521)
@@ -0,0 +1,5 @@
+CFLAGS =-s -O3 -shared -I../include -Wl,--out-implib,libfaac.a
+SRC=$(wildcard *.c)
+
+libfaac.dll: $(SRC)
+	gcc -o $@ $^ $(CFLAGS)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -49,10 +49,15 @@
 
 copy ".\include\*.h" "%usrLocalDir%\include"
 cd libfaad
-gcc -s -O3 -DHAVE_MEMCPY=1 -DHAVE_STRING_H=1 -DHAVE_STDINT_H=1 -I../include -I"." *.c -shared -o "%usrLocalDir%/bin/libfaad2.dll" -Wl,--out-implib,"%usrLocalDir%/lib/libfaad.a"
+copy "%curDir%\makefile."
+
+make
 if errorlevel 1 goto end
 
+copy libfaad2.dll "%usrLocalDir%/bin"
+copy libfaad.a "%usrLocalDir%/lib"
 copy "%usrLocalDir%\bin\libfaad2.dll" "%admBuildDir%"
+
 goto end
 
 :error

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/makefile
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/makefile	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/makefile	2011-09-13 16:09:05 UTC (rev 7521)
@@ -0,0 +1,5 @@
+CFLAGS =-s -O3 -shared -DHAVE_MEMCPY=1 -DHAVE_STRING_H=1 -DHAVE_STDINT_H=1 -I../include -I"." -Wl,--out-implib,libfaad.a
+SRC=$(wildcard *.c)
+
+libfaad2.dll: $(SRC)
+	gcc -o $@ $^ $(CFLAGS)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -17,9 +17,9 @@
 call "../Set Common Environment Variables"
 if errorlevel 1 goto end
 
-set package=libogg-1.2.1.tar.gz
-set sourceFolder=libogg-1.2.1-%BuildBits%
-set tarFolder=libogg-1.2.1
+set package=libogg-1.3.0.tar.gz
+set sourceFolder=libogg-1.3.0-%BuildBits%
+set tarFolder=libogg-1.3.0
 set curDir=%CD%
 
 if not exist %package% (

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -17,9 +17,9 @@
 call "../Set Common Environment Variables"
 if errorlevel 1 goto end
 
-set package=libvpx-v0.9.5.tar.bz2
-set sourceFolder=libvpx-0.9.5-%BuildBits%
-set tarFolder=libvpx-v0.9.5
+set package=libvpx-v0.9.7-p1.tar.bz2
+set sourceFolder=libvpx-0.9.7-p1-%BuildBits%
+set tarFolder=libvpx-v0.9.7-p1
 set curDir=%CD%
 
 if not exist %package% (

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -20,15 +20,15 @@
 call "../Set Common Environment Variables"
 if errorlevel 1 goto end
 
-set package=nspr-4.8.6.tar.gz
-set sourceFolder=nspr-4.8.6-%BuildBits%
-set tarFolder=nspr-4.8.6
+set package=nspr-4.8.9.tar.gz
+set sourceFolder=nspr-4.8.9-%BuildBits%
+set tarFolder=nspr-4.8.9
 set curDir=%CD%
 
 if not exist %package% (
 	echo.
 	echo Downloading
-	wget ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v4.8.6/src/%package%
+	wget ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v4.8.9/src/%package%
 )
 
 if errorlevel 1 goto end

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -29,13 +29,13 @@
 if errorlevel 1 goto end
 
 echo Downloading from git
-git clone git://git.videolan.org/x264.git %sourceFolder%
+call git clone git://git.videolan.org/x264.git %sourceFolder%
 if errorlevel 1 goto end
 
 cd "%devDir%/%sourceFolder%"
 
-if "%BuildBits%" == "32" sh ./configure --prefix=%usrLocalDir% --enable-shared
-if "%BuildBits%" == "64" sh ./configure --prefix=%usrLocalDir% --enable-shared --host=x86_64-pc-mingw32
+if "%BuildBits%" == "32" sh ./configure --prefix=%usrLocalDir% --enable-shared --enable-win32thread
+if "%BuildBits%" == "64" sh ./configure --prefix=%usrLocalDir% --enable-shared --enable-win32thread --host=x86_64-pc-mingw32
 
 if errorlevel 1 goto end
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat	2011-09-13 16:09:05 UTC (rev 7521)
@@ -17,8 +17,8 @@
 call "../Set Common Environment Variables"
 if errorlevel 1 goto end
 
-set package=xvidcore-1.2.2.tar.gz
-set sourceFolder=xvidcore-1.2.2-%BuildBits%
+set package=xvidcore-1.3.2.tar.gz
+set sourceFolder=xvidcore-1.3.2-%BuildBits%
 set curDir=%CD%
 
 if not exist %package% (

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch	2011-09-13 12:38:23 UTC (rev 7520)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch	2011-09-13 16:09:05 UTC (rev 7521)
@@ -1,11 +1,12 @@
---- build/generic/configure.orig	2009-05-28 18:13:31 +0100
-+++ build/generic/configure	2010-11-27 10:25:35 +0000
-@@ -1319,7 +1319,7 @@
- API_MAJOR="4"
- API_MINOR="2"
- 
--minimum_yasm_minor_version=8
-+minimum_yasm_minor_version=1
- minimum_nasm_minor_version=0
- minimum_nasm_major_version=2
- nasm_prog="nasm"
+--- build/generic/configure.orig	2011-03-17 14:31:52 +0000
++++ build/generic/configure	2011-05-21 16:22:55 +0100
+@@ -4325,8 +4325,7 @@
+ $as_echo "ok" >&6; }
+ 	STATIC_LIB="xvidcore.\$(STATIC_EXTENSION)"
+ 	SHARED_LIB="xvidcore.\$(SHARED_EXTENSION)"
+-	SPECIFIC_LDFLAGS="-mno-cygwin -shared -Wl,--dll,--out-implib,\$@.a libxvidcore.def"
+-	SPECIFIC_CFLAGS="-mno-cygwin"
++	SPECIFIC_LDFLAGS="-shared -Wl,--dll,--out-implib,\$@.a libxvidcore.def"
+ 	;;
+      darwin*|raphsody*)
+ 	STATIC_LIB="libxvidcore.\$(STATIC_EXTENSION)"



From mean at mail.berlios.de  Tue Sep 13 18:46:39 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 18:46:39 +0200
Subject: [Avidemux-svn-commit] r7522 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20110913164639.AEA294812C7@sheep.berlios.de>

Author: mean
Date: 2011-09-13 18:46:39 +0200 (Tue, 13 Sep 2011)
New Revision: 7522

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
Log:
[editor] Revert BVector change, it does not work with classes

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-13 16:09:05 UTC (rev 7521)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-13 16:46:39 UTC (rev 7522)
@@ -306,7 +306,7 @@
             stream->getExtraData(&extraLen,&extraData);
             track->codec=getAudioCodec(header->encoding,header,extraLen,extraData);
 
-            thisVid->audioTracks.pushBack(track);
+            thisVid->audioTracks.push_back(track);
 
       }
     }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-13 16:09:05 UTC (rev 7521)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-13 16:46:39 UTC (rev 7522)
@@ -29,8 +29,6 @@
 
 ADM_EditorSegment::ADM_EditorSegment(void)
 {
-    segments.setCapacity(5);
-    videos.setCapacity(5);
 }
 ADM_EditorSegment::~ADM_EditorSegment()
 {
@@ -121,8 +119,8 @@
             ref->firstFramePts=pts;
         }
 
-    segments.pushBack(seg);
-    videos.pushBack(*ref);
+    segments.push_back(seg);
+    videos.push_back(*ref);
     updateStartTime();
     return true;
 }
@@ -143,7 +141,7 @@
 bool        ADM_EditorSegment::addSegment(_SEGMENT *seg)
 {
     ADM_info("Adding a new segment\n");
-    segments.pushBack(*seg);
+    segments.push_back(*seg);
     updateStartTime();
     return true;
 }
@@ -219,7 +217,7 @@
         seg._durationUs=vid->_aviheader->getVideoDuration();
         seg._reference=i;
         vid->_aviheader->getVideoInfo(&info);
-        segments.pushBack(seg);
+        segments.push_back(seg);
     }
     updateStartTime();
     return true;
@@ -488,7 +486,7 @@
     if(startSeg==endSeg)
     {
         // Split the seg int two..
-        segments.insert(startSeg+1,*getSegment(startSeg)); 
+        segments.insert(segments.begin()+startSeg+1,*getSegment(startSeg)); 
         endSeg=startSeg+1;
 
     }
@@ -505,7 +503,7 @@
     // 2- Kill the segment in between
     for(int i=startSeg+1;i<endSeg;i++)
     {
-        segments.removeAt(startSeg+1);
+        segments.erase(segments.begin()+startSeg+1);
     }
     updateStartTime();
     removeEmptySegments();
@@ -631,7 +629,7 @@
                 if(seg->_durationUs==0) index=i;
         }
         if(index==-1) break;
-        segments.removeAt(index);
+        segments.erase(segments.begin()+index);
     }
     return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-13 16:09:05 UTC (rev 7521)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2011-09-13 16:46:39 UTC (rev 7522)
@@ -16,7 +16,7 @@
  ***************************************************************************/
 #ifndef ADM_SEGMENT_H
 #define ADM_SEGMENT_H
-#include <BVector.h>
+#include <vector>
 class ADM_audioStream;
 class ADM_Audiocodec;
 class decoders;
@@ -62,7 +62,7 @@
 
       /* Audio part */
       uint32_t currentAudioStream;
-      BVector <ADM_audioStreamTrack *>  audioTracks;
+      std::vector <ADM_audioStreamTrack *>  audioTracks;
       
 
       uint32_t _nb_video_frames; /// Really needed ?
@@ -122,8 +122,8 @@
 /*
     Use vectors to store our videos & segments
 */
-typedef BVector <_VIDEOS>  ListOfVideos;
-typedef BVector <_SEGMENT> ListOfSegments;
+typedef std::vector <_VIDEOS>  ListOfVideos;
+typedef std::vector <_SEGMENT> ListOfSegments;
 
 /**
     \class ADM_EditorSegment



From mean at mail.berlios.de  Tue Sep 13 18:46:42 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 18:46:42 +0200
Subject: [Avidemux-svn-commit] r7523 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux/common/ADM_audioFilter/src
	avidemux_core/ADM_coreAudioDevice/src
Message-ID: <20110913164642.2D84F4812C7@sheep.berlios.de>

Author: mean
Date: 2011-09-13 18:46:41 +0200 (Tue, 13 Sep 2011)
New Revision: 7523

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
Log:
[audioEncoder/audioDevice] memleak

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-13 16:46:39 UTC (rev 7522)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-13 16:46:41 UTC (rev 7523)
@@ -18,8 +18,8 @@
 #include "ADM_default.h"
 #include "audioencoderInternal.h"
 #include "ADM_dynamicLoading.h"
-BVector <ADM_audioEncoder *> ListOfAudioEncoder;
 
+
 static AUDIOENCODER  currentEncoder=0; //0 is always dummy
 
 static AUDIOENCODER ADM_encoderByName(const char *name);
@@ -82,6 +82,8 @@
             
         }
 };
+static BVector <ADM_audioEncoder *> ListOfAudioEncoder;
+static BVector <ADM_AudioEncoderLoader *> ListOfAudioEncoderLoader;
 
 /**
         \fn ADM_ae_getPluginNbEncoders
@@ -116,8 +118,8 @@
 	ADM_AudioEncoderLoader *dll=new ADM_AudioEncoderLoader(file);
     if(!dll->initialised) Fail(CannotLoad);
     
-
-    ListOfAudioEncoder.append(dll->encoderBlock); // Needed for cleanup. FIXME TODO Delete it.
+    ListOfAudioEncoderLoader.append(dll);
+    ListOfAudioEncoder.append(dll->encoderBlock);  // will be destroyed when Loader is destroyed
     printf("[AudioEncoder] Registered filter %s as  %s\n",file,dll->encoderBlock->description);
     return true;
 	// Fail!
@@ -175,14 +177,14 @@
 */
 bool ADM_ae_cleanup(void)
 {
-    for(uint32_t i=1;i<ListOfAudioEncoder.size();i++)
+    for(uint32_t i=0;i<ListOfAudioEncoderLoader.size();i++)
 	{
-		ADM_audioEncoder *a=ListOfAudioEncoder[i];
+		ADM_AudioEncoderLoader *a=ListOfAudioEncoderLoader[i];
         delete a;
-        ListOfAudioEncoder[i]=NULL;
+        ListOfAudioEncoderLoader[i]=NULL;
 	}
     
-    ListOfAudioEncoder.clear();
+    ListOfAudioEncoderLoader.clear();
     return true;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-13 16:46:39 UTC (rev 7522)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-13 16:46:41 UTC (rev 7523)
@@ -376,10 +376,10 @@
 	quitSdl();
 #endif
 
-#ifdef HAVE_AUDIO
+
 	AVDM_cleanup();
-#endif
 
+
 	destroyGUI();
     destroyPrefs();
     

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-13 16:46:39 UTC (rev 7522)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audiodevice.cpp	2011-09-13 16:46:41 UTC (rev 7523)
@@ -205,7 +205,7 @@
     ListOfAudioDevices.clear();
 	if(device)
 	{
-		delete device;
+// FIXME		delete device;
 		device=NULL;
 	}
 }



From mean at mail.berlios.de  Tue Sep 13 18:46:43 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 18:46:43 +0200
Subject: [Avidemux-svn-commit] r7524 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110913164643.737324812C7@sheep.berlios.de>

Author: mean
Date: 2011-09-13 18:46:43 +0200 (Tue, 13 Sep 2011)
New Revision: 7524

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[qtGl] Set a default value to texture

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-13 16:46:41 UTC (rev 7523)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-13 16:46:43 UTC (rev 7524)
@@ -117,6 +117,7 @@
 	imageHeight = h;
 	firstRun = true;
 	glProgram = NULL;
+    textureName[0]=textureName[1]=textureName[2]=0;
     glGenTextures(3,textureName);
 }
 /**



From mean at mail.berlios.de  Tue Sep 13 20:46:16 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 13 Sep 2011 20:46:16 +0200
Subject: [Avidemux-svn-commit] r7525 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	glResize sample_distort sample_fragment2
Message-ID: <20110913184616.9C17148125B@sheep.berlios.de>

Author: mean
Date: 2011-09-13 20:46:16 +0200 (Tue, 13 Sep 2011)
New Revision: 7525

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h
Log:
[gl] dont cast vec4 to vec3, ATI compiler does not like it

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	2011-09-13 16:46:43 UTC (rev 7524)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glResize/sampleGl.h	2011-09-13 18:46:16 UTC (rev 7525)
@@ -6,7 +6,7 @@
     "uniform sampler2DRect myTextureV;\n" // tex unit 2
     "const vec2 half_vec=vec2(0.5,0.5);\n"
 	"void main(void) {\n"
-    "  vec2 full_coord=gl_TexCoord[0];\n"
+    "  vec2 full_coord=gl_TexCoord[0].xy;\n"
     "  vec2 half_coord=full_coord*half_vec;"
     "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
     "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-13 16:46:43 UTC (rev 7524)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-13 18:46:16 UTC (rev 7525)
@@ -10,7 +10,7 @@
     "uniform float teta;\n"
 
 	"void main(void) {\n"
-    "  vec2 full_coord=gl_TexCoord[0];\n"
+    "  vec2 full_coord=gl_TexCoord[0].xy\n"
     "  vec2 half_coord=full_coord*half_vec;"
     "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
     "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h	2011-09-13 16:46:43 UTC (rev 7524)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2/sampleGl.h	2011-09-13 18:46:16 UTC (rev 7525)
@@ -11,7 +11,7 @@
 
 	"void main(void) {\n"
     "  vec2 sizexy=vec2(myWidth/2,myHeight/2);\n"
-    "  vec2 full_coord=gl_TexCoord[0]-sizexy;\n"
+    "  vec2 full_coord=gl_TexCoord[0].xy-sizexy;\n"
     "  float c=cos(teta); \n"
     "  float s=sin(teta); \n"
     "  mat2 mymatrix=mat2(c,-s,s,c);"



From gruntster at mail.berlios.de  Tue Sep 13 22:08:16 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 22:08:16 +0200
Subject: [Avidemux-svn-commit] r7526 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_osSupport
	avidemux/qt4/ADM_userInterfaces/ADM_gui
	avidemux_core/ADM_core/src avidemux_core/ADM_coreJobs/src
	avidemux_core/ADM_coreUtils/src
Message-ID: <20110913200816.596F44812C7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 22:08:16 +0200 (Tue, 13 Sep 2011)
New Revision: 7526

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreJobs/src/ADM_coreJobs.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
Log:
[core] fix odd (and sometimes invalid) path formatting

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_osSupport/ADM_crashHook.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -15,7 +15,7 @@
  ***************************************************************************/
 
 
-#include <string>
+#include <string>
 #include "ADM_cpp.h"
 #include "ADM_default.h"
 #include "DIA_coreToolkit.h"
@@ -25,7 +25,7 @@
 #define CRASH_FILE "crash.py"
 
 void saveCrashProject(void);
-extern char *ADM_getBaseDir(void);
+extern char *ADM_getBaseDir(void);
 bool A_parseTinyPyScript(const char *name);
 
 /**
@@ -41,7 +41,6 @@
   crashCount++;
   char *where=new char[strlen(baseDir)+strlen(name)+2];
   strcpy(where,baseDir);
-  strcat(where,"/");
   strcat(where,name);
   printf("Saving crash file to %s\n",where);
   video_body->saveAsPyScript (where);
@@ -59,7 +58,6 @@
   static int crashCount=0;
   char *where=new char[strlen(baseDir)+strlen(name)+2];
   strcpy(where,baseDir);
-  strcat(where,"/");
   strcat(where,name);
   if(ADM_fileExist(where))
   {

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2_menu.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -105,17 +105,17 @@
         switch(pool)
         {
             case JS_CUSTOM:
-                subDir=string("/js/");
+                subDir=string("js");
                 ext=string(".js");
                 topDir=customFolder;
                 break;
             case PY_CUSTOM:
-                subDir=string("/py/");
+                subDir=string("py");
                 ext=string(".py");
                 topDir=customFolder;
                 break;
             case PY_AUTO:
-                subDir=string("/");
+                subDir=string("");
                 ext=string(".py");
                 topDir=autoFolder;
                 break;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -36,21 +36,22 @@
 #define WIN32_PORTABLE_MODE 1
 
 #ifdef __WIN32
-static const char *separator="\\";
+static const char *SEPARATOR="\\";
+
 #ifdef WIN32_PORTABLE_MODE
-    const char *ADM_DIR_NAME="\\settings";
+    const char *ADM_DIR_NAME="settings";
     bool portable=true;
 #else
-    const char *ADM_DIR_NAME="\\avidemux6";
+    const char *ADM_DIR_NAME="avidemux6";
     bool portable=false;
 #endif
 #elif defined __HAIKU__
-static const char *separator="/";
-const char *ADM_DIR_NAME="/config/settings/avidemux6";
+static const char *SEPARATOR="/";
+const char *ADM_DIR_NAME="config/settings/avidemux6";
 
 #else
-static const char *separator="/";
-const char *ADM_DIR_NAME="/.avidemux6";
+static const char *SEPARATOR="/";
+const char *ADM_DIR_NAME=".avidemux6";
 #endif
 
 static char ADM_basedir[1024] = {0};
@@ -293,38 +294,54 @@
 	return ADM_jobdir;
 }
 
+static void AddSeparator(char *path)
+{
+	if (path && (strlen(path) < strlen(SEPARATOR) || strncmp(path + strlen(path) - strlen(SEPARATOR), SEPARATOR, strlen(SEPARATOR)) != 0))
+		strcat(path, SEPARATOR);
+}
+
 /**
  * 	\fn ADM_getRelativePath
  */
-static char *ADM_getRelativePath(const char *base0,const char *base1, const char *base2,const char *base3)
+static char *ADM_getRelativePath(const char *base0, const char *base1, const char *base2, const char *base3)
 {
 	char *result;
-	int length = strlen(base1);
+	int length = strlen(base0) + 2;
 
+	if (base1)
+		length += strlen(base1) + 1;
+
 	if (base2)
-		length += strlen(base2);
+		length += strlen(base2) + 1;
 
 	if (base3)
-		length += strlen(base3);
+		length += strlen(base3) + 1;
 
-	length += strlen(base0);
-	length += 5; // Slashes + end 0
-	result = (char *)new char [length];
+	result = (char *)new char[length];
 	strcpy(result, base0);
-	strcat(result, separator);
+	AddSeparator(result);
 
-	strcat(result, base1);
-	strcat(result, separator);
-
-	if (base2)
+	if (base1)
 	{
-		strcat(result, base2);
-		strcat(result, separator);
+		if (strlen(base1))
+		{
+			strcat(result, base1);
+			strcat(result, SEPARATOR);
+		}
 
-		if (base3)
+		if (base2)
 		{
-			strcat(result, base3);
-			strcat(result, separator);
+			if (strlen(base2))
+			{
+				strcat(result, base2);
+				strcat(result, SEPARATOR);
+			}
+
+			if (base3 && strlen(base3))
+			{
+				strcat(result, base3);				
+				strcat(result, SEPARATOR);
+			}
 		}
 	}
 
@@ -335,29 +352,28 @@
  * 	\fn char *ADM_getHomeRelativePath(const char *base1, const char *base2=NULL,const char *base3=NULL);
  *  \brief Returns home directory +base 1 + base 2... The return value is a copy, and must be deleted []
  */
-char *ADM_getHomeRelativePath(const char *base1, const char *base2,const char *base3)
+char *ADM_getHomeRelativePath(const char *base1, const char *base2, const char *base3)
 {
 	return ADM_getRelativePath(ADM_getBaseDir(), base1, base2, base3);
 }
 
-char *ADM_getInstallRelativePath(const char *base1, const char *base2,const char *base3)
+char *ADM_getInstallRelativePath(const char *base1, const char *base2, const char *base3)
 {
-#ifdef __WIN32
-       	wchar_t wcModuleName[MAX_PATH];
-
-	GetModuleFileNameW(0, wcModuleName, sizeof(wcModuleName) / sizeof(wchar_t));
-
-	int len = wideCharStringToUtf8(wcModuleName, -1, NULL);
-	char moduleName[len];
-
-	wideCharStringToUtf8(wcModuleName, -1, moduleName);
-
-
-	char *slash = strrchr(moduleName, '\\');
-		
-	if (slash)
-		*slash = '\0';
-
+#ifdef __WIN32
+	wchar_t wcModuleName[MAX_PATH];
+
+	GetModuleFileNameW(0, wcModuleName, sizeof(wcModuleName) / sizeof(wchar_t));
+
+	int len = wideCharStringToUtf8(wcModuleName, -1, NULL);
+	char moduleName[len];
+
+	wideCharStringToUtf8(wcModuleName, -1, moduleName);
+
+	char *slash = strrchr(moduleName, '\\');
+		
+	if (slash)
+		*slash = '\0';
+
 	return ADM_getRelativePath(moduleName, base1, base2, base3);
 #elif defined(__APPLE__)
 #define MAX_PATH_SIZE 1024
@@ -395,8 +411,13 @@
 
 	// Get the base directory
 #ifdef __WIN32
-    if(portable==false)
+    if (portable)
     {
+        // Portable mode...
+        home = ADM_getInstallRelativePath(NULL, NULL, NULL);
+    }
+	else
+    {
         wchar_t wcHome[MAX_PATH];
 
         if (SHGetFolderPathW(NULL, CSIDL_APPDATA, NULL, 0, wcHome) == S_OK)
@@ -411,18 +432,15 @@
             printf("Oops: can't determine the Application Data folder.");
             home = ADM_strdup("c:\\");
         }
-    }else
-    {
-        // Portable mode...
-        home=ADM_strdup(ADM_getInstallRelativePath("","",""));
     }
 #else
 	const char* homeEnv = getenv("HOME");
 
 	if (homeEnv)
 	{
-		home = new char[strlen(homeEnv) + 1];
+		home = new char[strlen(homeEnv) + 2];
 		strcpy(home, homeEnv);
+		strcpy(home, SEPARATOR);
 	}
 	else
 	{
@@ -436,6 +454,8 @@
 
 	strcpy(ADM_basedir, home);
 	strcat(ADM_basedir, ADM_DIR_NAME);
+	strcat(ADM_basedir, SEPARATOR);
+
     delete [] home;
     home=NULL;
 
@@ -550,7 +570,6 @@
 		int xbase = len - extlen;
 
 		if (memcmp(d_name + xbase, ext, extlen))
-			//if (direntry->d_name[len-1]!='s' || direntry->d_name[len-2]!='j' || direntry->d_name[len-3]!='.')
 		{
 			printf("ignored: %s\n", d_name);
 			continue;
@@ -558,7 +577,7 @@
 
 		jobName[dirmax] = (char *)ADM_alloc(strlen(base) + strlen(d_name) + 2);
 		strcpy(jobName[dirmax], base);
-		strcat(jobName[dirmax], "/");
+		AddSeparator(jobName[dirmax]);
 		strcat(jobName[dirmax], d_name);
 		dirmax++;
 
@@ -821,4 +840,5 @@
     return false;
 #endif
 }
+
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -436,10 +436,9 @@
 	// Redirect output to log file in the user's profile directory
 	const char* logFile = "admlog.txt";
 	char* baseDir = ADM_getBaseDir();
-	char *logPath = new char[strlen(baseDir) + 2 + strlen(logFile)];
+	char *logPath = new char[strlen(baseDir) + strlen(logFile) + 1];
 
 	strcpy(logPath, baseDir);
-	strcat(logPath, "/");
 	strcat(logPath, logFile);
 
 	FILE *stream = fopen(logPath, "w");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreJobs/src/ADM_coreJobs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreJobs/src/ADM_coreJobs.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreJobs/src/ADM_coreJobs.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -126,7 +126,7 @@
 {
     dbFile=new char[1024];
     strcpy(dbFile,ADM_getBaseDir());
-    strcat(dbFile,"/jobs.sql");
+    strcat(dbFile,"jobs.sql");
     
     ADM_info("Initializing database (%s)\n",dbFile);
     if(!ADM_fileExist(dbFile))

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2011-09-13 18:46:16 UTC (rev 7525)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2011-09-13 20:08:16 UTC (rev 7526)
@@ -159,14 +159,13 @@
    char *dir_adm;
    std::string path;
 
-
     dir_adm=ADM_getBaseDir();
     if(!dir_adm) return false;
 
     path=string(dir_adm);
-    path=path+std::string("/");
     path=path+std::string(CONFIG);
     ADM_info("Loading prefs from %s\n",path.c_str());
+
     // exist ?
     if(!ADM_fileExist(path.c_str()))
     {
@@ -196,7 +195,6 @@
     if(!dir_adm) return RC_FAILED;
 
     path=string(dir_adm);
-    path=path+std::string("/");
     path=path+std::string(CONFIG);
     string tmp=path;
     tmp=tmp+string(".tmp");



From gruntster at mail.berlios.de  Tue Sep 13 22:11:33 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 22:11:33 +0200
Subject: [Avidemux-svn-commit] r7527 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110913201133.EA7284812C7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 22:11:33 +0200 (Tue, 13 Sep 2011)
New Revision: 7527

Modified:
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[sdl] apply r6683

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2011-09-13 20:08:16 UTC (rev 7526)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2011-09-13 20:11:33 UTC (rev 7527)
@@ -40,7 +40,7 @@
 /* use libsamplerate */
 #cmakedefine USE_SRC
 
-#if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
+#if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK
 /* SDL detected */
 #cmakedefine USE_SDL
 #endif



From gruntster at mail.berlios.de  Tue Sep 13 22:13:23 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 22:13:23 +0200
Subject: [Avidemux-svn-commit] r7528 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <20110913201323.A0C174812C7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 22:13:23 +0200 (Tue, 13 Sep 2011)
New Revision: 7528

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[mswin] apply r6684

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-13 20:11:33 UTC (rev 7527)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-13 20:13:23 UTC (rev 7528)
@@ -128,34 +128,40 @@
 
 int main(int argc, char *argv[])
 {
-#if defined(__WIN32) && defined(USE_SDL)
-//	redirectStdoutToFile();
+	char uiDesc[15];
+	getUIDescription(uiDesc);
+
+#if defined(_WIN32)
+	if (strcmp(uiDesc, "CLI") != 0)
+		redirectStdoutToFile();
 #endif
 
 #if defined(ADM_DEBUG) && defined(FIND_LEAKS)
 	new_progname = argv[0];
 #endif
 
-#ifndef __MINGW32__
+#ifndef _WIN32
 	// thx smurf uk :)
     installSigHandler();
 #endif
 
     printf("*************************\n");
     printf("  Avidemux v" VERSION);
+
   	if(ADM_SUBVERSION)
 	{
 		printf(" (r%04u)", ADM_SUBVERSION);
 	}
+
     printf("\n*************************\n");
     printf(" http://www.avidemux.org\n");
-    printf(" Code      : Mean, JSC, Gruntster \n");
-    printf(" GFX       : Nestor Di , nestordi at augcyl.org\n");
+    printf(" Code      : Mean, JSC, Grant Pedersen\n");
+    printf(" GFX       : Nestor Di, nestordi at augcyl.org\n");
     printf(" Design    : Jakub Misak\n");
     printf(" FreeBSD   : Anish Mistry, amistry at am-productions.biz\n");
     printf(" Audio     : Mihail Zenkov\n");
-    printf(" MacOsX    : Kuisathaverat\n");
-    printf(" Win32     : Gruntster\n\n");
+    printf(" Mac OS X  : Kuisathaverat, Harry van der Wolf\n");
+    printf(" Win32     : Grant Pedersen\n\n");
 
 #ifdef __GNUC__
 	printf("Compiler: GCC %s\n", __VERSION__);
@@ -163,7 +169,7 @@
 
 	printf("Build Target: ");
 
-#if defined(__WIN32)
+#if defined(_WIN32)
 	printf("Microsoft Windows");
 #elif defined(__APPLE__)
 	printf("Apple");
@@ -179,13 +185,9 @@
 	printf(" (PowerPC)");
 #endif
 
-	printf("\n");
+	printf("\nUser Interface: %s\n", uiDesc);
 
-	char uiDesc[15];
-	getUIDescription(uiDesc);
-	printf("User Interface: %s\n", uiDesc);
-
-#ifdef __WIN32
+#ifdef _WIN32
 	char version[250];
 
 	if (getWindowsVersion(version))
@@ -195,8 +197,9 @@
 #if defined(__USE_LARGEFILE) && defined(__USE_LARGEFILE64)
 	printf("\nLarge file available: %d offset\n", __USE_FILE_OFFSET64);
 #endif
-        // getTime
-        printf("Current time :%s\n",ADM_epochToString(ADM_getSecondsSinceEpoch()));
+
+    // getTime
+    printf("Time: %s\n", ADM_epochToString(ADM_getSecondsSinceEpoch()));
 	// Start counting memory
 	ADM_memStatInit();
     ADM_InitMemcpy();
@@ -218,7 +221,7 @@
 
 	atexit(onexit);
 
-#ifdef __MINGW32__
+#ifdef _WIN32
     win32_netInit();
 #endif
 



From gruntster at mail.berlios.de  Tue Sep 13 23:50:12 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 23:50:12 +0200
Subject: [Avidemux-svn-commit] r7529 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110913215012.9FF934812C7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 23:50:12 +0200 (Tue, 13 Sep 2011)
New Revision: 7529

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[qt] tighten up main gui again

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2011-09-13 20:13:23 UTC (rev 7528)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2011-09-13 21:50:12 UTC (rev 7529)
@@ -11,12 +11,6 @@
     <height>640</height>
    </rect>
   </property>
-  <property name="minimumSize">
-   <size>
-    <width>640</width>
-    <height>640</height>
-   </size>
-  </property>
   <property name="windowTitle">
    <string>Avidemux</string>
   </property>
@@ -106,7 +100,7 @@
      <x>0</x>
      <y>0</y>
      <width>640</width>
-     <height>21</height>
+     <height>22</height>
     </rect>
    </property>
    <widget class="QMenu" name="menuHelp">
@@ -1278,8 +1272,8 @@
    </property>
    <property name="minimumSize">
     <size>
-     <width>136</width>
-     <height>143</height>
+     <width>120</width>
+     <height>0</height>
     </size>
    </property>
    <property name="features">



From gruntster at mail.berlios.de  Tue Sep 13 23:53:43 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Sep 2011 23:53:43 +0200
Subject: [Avidemux-svn-commit] r7530 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110913215343.A76D04812C7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-13 23:53:43 +0200 (Tue, 13 Sep 2011)
New Revision: 7530

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_debug.cpp
Log:
[mswin] strip colour from output to improve readability of log file for mswin

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_debug.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_debug.cpp	2011-09-13 21:50:12 UTC (rev 7529)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_debug.cpp	2011-09-13 21:53:43 UTC (rev 7530)
@@ -86,8 +86,11 @@
 
 static void ADM_prettyPrint(const char *func,const char *color, const char *p)
 {
+#if _WIN32
+	printf("[%s] %s", func, p);
+#else
     printf("%s [%s]  %s %s",color,func,p,ADM_DEFAULT_COLOR);
-
+#endif
 }
 
 



From mean at mail.berlios.de  Wed Sep 14 09:46:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 09:46:20 +0200
Subject: [Avidemux-svn-commit] r7531 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort
Message-ID: <20110914074621.33978481287@sheep.berlios.de>

Author: mean
Date: 2011-09-14 09:46:20 +0200 (Wed, 14 Sep 2011)
New Revision: 7531

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
Log:
[gl] fix typo

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-13 21:53:43 UTC (rev 7530)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/sample_distort/sampleGl.h	2011-09-14 07:46:20 UTC (rev 7531)
@@ -10,7 +10,7 @@
     "uniform float teta;\n"
 
 	"void main(void) {\n"
-    "  vec2 full_coord=gl_TexCoord[0].xy\n"
+    "  vec2 full_coord=gl_TexCoord[0].xy;\n"
     "  vec2 half_coord=full_coord*half_vec;"
     "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
     "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"



From mean at mail.berlios.de  Wed Sep 14 09:46:22 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 09:46:22 +0200
Subject: [Avidemux-svn-commit] r7532 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20110914074622.345A9481287@sheep.berlios.de>

Author: mean
Date: 2011-09-14 09:46:21 +0200 (Wed, 14 Sep 2011)
New Revision: 7532

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
Log:
[Ts/brute force] Read more packets, rewind to identidy tracks. Not 100% ok yet

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-14 07:46:20 UTC (rev 7531)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-14 07:46:21 UTC (rev 7532)
@@ -25,7 +25,8 @@
 
 #include "ADM_coreUtils.h"
 
-#define TS_MAX_PACKET_SCAN 500
+#define TS_MAX_PACKET_SCAN     2000
+#define TS_NB_PACKET_THRESHOLD 5
 #define MAX_PID (1<<17)
 #define MAX_BUFFER_SIZE (10*1024)
 
@@ -71,7 +72,7 @@
     std::vector <int>listOfPid;    
     for(int i=17;i<MAX_PID;i++)
     {
-        if(map[i]>5) listOfPid.push_back(i);
+        if(map[i]>TS_NB_PACKET_THRESHOLD) listOfPid.push_back(i);
     }
     delete [] map;
     map=NULL;
@@ -81,7 +82,11 @@
         memset(tracks,0,sizeof(ADM_TS_TRACK)*listOfPid.size());
         int validTracks=0;
         ADM_TS_TRACK_TYPE trackType;
+        printf("List of found PID:\n");
         for(int i=0;i<listOfPid.size();i++)
+            printf("\t Pid=%d\n",listOfPid[i]);
+        printf("List end.\n");
+        for(int i=0;i<listOfPid.size();i++)
         {
             printf("Found stuff in pid=%d\n",listOfPid[i]);
             //  Read PES
@@ -131,6 +136,7 @@
 {
 TS_PESpacket pes(pid);
 TS_PESpacket pes2(pid);
+        ts->setPos(0);
         if(false==ts->getNextPES( &pes)) 
         {
             ADM_warning("\tCannot get PES\n");



From mean at mail.berlios.de  Wed Sep 14 09:46:23 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 09:46:23 +0200
Subject: [Avidemux-svn-commit] r7533 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110914074623.82E04481287@sheep.berlios.de>

Author: mean
Date: 2011-09-14 09:46:23 +0200 (Wed, 14 Sep 2011)
New Revision: 7533

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
Log:
[fileIo] Fix removing $home from path to prefs

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-14 07:46:21 UTC (rev 7532)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-14 07:46:23 UTC (rev 7533)
@@ -440,7 +440,6 @@
 	{
 		home = new char[strlen(homeEnv) + 2];
 		strcpy(home, homeEnv);
-		strcpy(home, SEPARATOR);
 	}
 	else
 	{
@@ -453,6 +452,7 @@
 	// Try to open the .avidemux directory
 
 	strcpy(ADM_basedir, home);
+	strcat(ADM_basedir, SEPARATOR);
 	strcat(ADM_basedir, ADM_DIR_NAME);
 	strcat(ADM_basedir, SEPARATOR);
 
@@ -461,7 +461,7 @@
 
 	if (!ADM_mkdir(ADM_basedir))
 	{
-		printf("Oops: cannot create the .avidemux directory");
+		ADM_error("Oops: cannot create the .avidemux directoryi (%s)\n",ADM_basedir);
 		return NULL;
 	}
 



From mean at mail.berlios.de  Wed Sep 14 09:46:24 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 09:46:24 +0200
Subject: [Avidemux-svn-commit] r7534 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20110914074624.9B5FC481287@sheep.berlios.de>

Author: mean
Date: 2011-09-14 09:46:24 +0200 (Wed, 14 Sep 2011)
New Revision: 7534

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
Log:
[ts/Demux] Brute force : be more permissive

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-14 07:46:23 UTC (rev 7533)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsBruteForce.cpp	2011-09-14 07:46:24 UTC (rev 7534)
@@ -130,62 +130,97 @@
     return false;
 }
 /**
+    \fn idContentE0
+    \brief try to identify video content, with pes-id=0xe0
+    We read 5 startcode and if 4 or 5 looks like mpeg2/h264 ones we mark the stream as mpeg2/h264
+*/
+static bool idContentE0(int pid,tsPacket *ts,ADM_TS_TRACK_TYPE & trackType)
+{
+    int nbTry=5;
+    int threshold=3;
+    int nbSuccessMpeg2=0;
+    int nbSuccessH264=0;
+    for(int i=0;i<nbTry;i++)
+    {
+        TS_PESpacket pes(pid);
+        if(false==ts->getNextPES( &pes)) 
+        {
+            ADM_warning("\tCannot get PES\n");
+            return false;
+        }
+        uint8_t *ptr=pes.payload;
+        uint32_t len=pes.payloadSize,syncoff;
+        uint8_t  scode;
+        if(ADM_findMpegStartCode(ptr+4,ptr+len,&scode,&syncoff))
+        {
+            ADM_warning("Found startcode1 =%x\n",scode);
+        }else continue;
+        if(scode==9) // AU delimiter => H264
+        {
+            nbSuccessH264++;
+            continue;
+        }
+        if(mpeg2StartCode(scode))
+        {
+            nbSuccessMpeg2++;
+            continue;
+        }
+    }
+    if(nbSuccessH264>threshold)
+    {
+        trackType=ADM_TS_H264;
+        ADM_warning("Probably H264\n");
+        return true;
+    }
+    if(nbSuccessMpeg2>threshold)
+    {
+        trackType=ADM_TS_MPEG2;
+        ADM_warning("Probably Mpeg2\n");
+        return true;
+    }
+    ADM_warning("dont know what it is...\n");
+    return false;
+}
+/**
     \fn idContent
 */
 bool idContent(int pid,tsPacket *ts,ADM_TS_TRACK_TYPE & trackType)
 {
 TS_PESpacket pes(pid);
 TS_PESpacket pes2(pid);
+
         ts->setPos(0);
         if(false==ts->getNextPES( &pes)) 
         {
             ADM_warning("\tCannot get PES\n");
             return false;
         }
+        uint8_t *ptr=pes.payload;
+        uint32_t len=pes.payloadSize;
+
+
+        // 
+       
+
+        if(!ptr[0] && !ptr[1] && ptr[2]==1 && ptr[3]==0xe0) // probably video
+        {
+          return idContentE0(pid,ts,trackType);
+        }
+
+        // Read a 2nd packet for confirmation
+
         if(false==ts->getNextPES( &pes2)) 
         {
             ADM_warning("\tCannot get PES2\n");
             return false;
         }
+        uint8_t *ptr2=pes2.payload;
+        uint32_t len2=pes2.payloadSize;
         
-        printf("\t Read %d bytes\n",(int)pes.payloadSize);
-        // 
+        printf("\t Read %d bytes\n",(int)pes.payloadSize);  
         uint32_t fq,br,chan,syncoff;
         uint32_t fq2,br2,chan2,syncoff2;
-        uint8_t *ptr=pes.payload;
-        uint32_t len=pes.payloadSize;
-        uint8_t *ptr2=pes2.payload;
-        uint32_t len2=pes2.payloadSize;
 
-        if(!ptr[0] && !ptr[1] && ptr[2]==1 && ptr[3]==0xe0) // probably video
-        {
-            // Only supports Mpeg2 video and H264
-            // For mpeg2 we scan for slice i.e. 00 00 01 00 etc...
-            // we need 2 consecutive slice
-            uint8_t scode,scode2;
-            if(ADM_findMpegStartCode(ptr+4,ptr+len,&scode,&syncoff))
-            {
-                ADM_warning("Found startcode1 =%x\n",scode);
-            }
-            if(ADM_findMpegStartCode(ptr2+4,ptr2+len2,&scode2,&syncoff))
-            {
-                ADM_warning("Found startcode2 =%x\n",scode2);
-            }
-            if(scode==9 && scode2==9) // AU delimiter => H264
-            {
-                trackType=ADM_TS_H264;
-                ADM_warning("Probably H264\n");
-                return true;
-            }
-            if(mpeg2StartCode(scode) && mpeg2StartCode(scode2)) // Maybe Mpeg2 ?
-            {
-                trackType=ADM_TS_MPEG2;
-                ADM_warning("Probably Mpeg2\n");
-                return true;
-            }
-            ADM_warning("dont know what it is...\n");
-            return false;
-        }
         // Is it AC3 ??
         if( ADM_AC3GetInfo(ptr,len, &fq, &br, &chan,&syncoff))
         {



From mean at mail.berlios.de  Wed Sep 14 10:48:36 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 10:48:36 +0200
Subject: [Avidemux-svn-commit] r7535 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110914084836.4B4A1481287@sheep.berlios.de>

Author: mean
Date: 2011-09-14 10:48:36 +0200 (Wed, 14 Sep 2011)
New Revision: 7535

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[qtGl] try to avoid double free

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-14 07:46:24 UTC (rev 7534)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-09-14 08:48:36 UTC (rev 7535)
@@ -327,8 +327,11 @@
 bool QtGlRender::stop(void)
 {
 	ADM_info("[GL Render] Renderer closed\n");
-	if (glWidget)
+	if (glWidget)
+    {
+        glWidget->setParent(NULL);
 		delete glWidget;
+    }
     glWidget=NULL;
     return true;
 }



From gruntster at mail.berlios.de  Wed Sep 14 11:32:14 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 11:32:14 +0200
Subject: [Avidemux-svn-commit] r7536 - in branches/avidemux_2.6_branch_mean:
	avidemux/cli avidemux/common avidemux/gtk avidemux/qt4
	avidemux/qt4/ADM_jobs/src avidemux_core/ADM_core/src
Message-ID: <20110914093214.8958048129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 11:32:13 +0200 (Wed, 14 Sep 2011)
New Revision: 7536

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_apple.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_mswin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp
Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
Log:
[log] apply r7295 & r7296

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 09:32:13 UTC (rev 7536)
@@ -90,7 +90,7 @@
 ###########################################
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
-	target_link_libraries(avidemux3_cli winmm -mwindows -Wl,-subsystem,console)
+	target_link_libraries(avidemux3_cli winmm -mwindows -Wl,-subsystem,console -Wl,--export-all-symbols)
 ENDIF (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -20,9 +20,7 @@
 
 #ifdef __MINGW32__
 #define UNICODE
-#include <winbase.h>
 #include <windows.h>
-#include <excpt.h>
 #endif
 
 #include "config.h"
@@ -98,14 +96,20 @@
 extern void loadPlugins(void);
 extern void InitFactory(void);
 extern void InitCoreToolkit(void);
+
 #ifdef __MINGW32__
-extern EXCEPTION_DISPOSITION exceptionHandler(struct _EXCEPTION_RECORD* pExceptionRec, void* pEstablisherFrame, struct _CONTEXT* pContextRecord, void* pDispatcherContext);
 extern int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
+#endif
+
+#if defined(_WIN64)
+extern LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo);
+#elif defined(_WIN32)
+extern EXCEPTION_DISPOSITION ExceptionHandler(struct _EXCEPTION_RECORD *exceptionRecord, void *establisherFrame, struct _CONTEXT *contextRecord, void *dispatcherContext);
 #else
 extern void installSigHandler(void);
 #endif
 
-#ifdef __WIN32
+#ifdef _WIN32
 extern bool getWindowsVersion(char* version);
 extern void redirectStdoutToFile(void);
 #endif
@@ -338,8 +342,10 @@
     else
 		ADM_assert(0); 
 
-#ifdef __MINGW32__
-	__try1(exceptionHandler);
+#if defined(_WIN64)
+	SetUnhandledExceptionFilter(ExceptionFilter);
+#elif defined(_WIN32)
+	__try1(ExceptionHandler);
 #endif
 
 #if defined( USE_VDPAU) 
@@ -357,8 +363,8 @@
 
     UI_RunApp();
 
-#ifdef __MINGW32__
-	__except1(exceptionHandler);
+#if defined(_WIN32) && defined(_X86_)
+	__except1;
 #endif
 
     printf("Normal exit\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 09:32:13 UTC (rev 7536)
@@ -103,12 +103,7 @@
 ###########################################
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
-
-	IF (MINGW)
-		target_link_libraries(avidemux3_gtk -mno-cygwin)
-	ENDIF (MINGW)
-
-	target_link_libraries(avidemux3_gtk winmm -mwindows)
+	target_link_libraries(avidemux3_gtk winmm -mwindows -Wl,--export-all-symbols)
 ENDIF (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -16,7 +16,6 @@
 
 #ifdef __MINGW32__
 #include <windows.h>
-#include <excpt.h>
 #endif
 
 #include "config.h"
@@ -36,8 +35,11 @@
 extern void ADM_memStatEnd( void );
 extern void InitFactory(void);
 extern void InitCoreToolkit(void);
-#ifdef __MINGW32__
-extern EXCEPTION_DISPOSITION exceptionHandler(struct _EXCEPTION_RECORD* pExceptionRec, void* pEstablisherFrame, struct _CONTEXT* pContextRecord, void* pDispatcherContext);
+
+#if defined(_WIN64)
+extern LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo);
+#elif defined(_WIN32)
+extern EXCEPTION_DISPOSITION ExceptionHandler(struct _EXCEPTION_RECORD *exceptionRecord, void *establisherFrame, struct _CONTEXT *contextRecord, void *dispatcherContext);
 #else
 extern void installSigHandler(void);
 #endif
@@ -54,8 +56,8 @@
 
 int main(int argc, char *argv[])
 {
-#if defined(__WIN32) && defined(USE_SDL)
-//	redirectStdoutToFile();
+#if defined(_WIN32)
+	redirectStdoutToFile();
 #endif
 
 #if defined(ADM_DEBUG) && defined(FIND_LEAKS)
@@ -139,16 +141,18 @@
     quotaInit();
 
 
-#ifdef __MINGW32__
-	__try1(exceptionHandler);
+#if defined(_WIN64)
+	SetUnhandledExceptionFilter(ExceptionFilter);
+#elif defined(_WIN32)
+	__try1(ExceptionHandler);
 #endif
 
     // Init jobs
     ADM_jobInit();
     jobRun(argc,argv);
 
-#ifdef __MINGW32__
-	__except1(exceptionHandler);
+#if defined(_WIN32) && defined(_X86_)
+	__except1;
 #endif
 
     printf("Normal exit\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 09:32:13 UTC (rev 7536)
@@ -131,12 +131,7 @@
 ###########################################
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
-
-	IF (MINGW)
-		target_link_libraries(avidemux3_qt4 -mno-cygwin)
-	ENDIF (MINGW)
-
-	target_link_libraries(avidemux3_qt4 winmm -mwindows)
+	target_link_libraries(avidemux3_qt4 winmm -mwindows -Wl,--export-all-symbols)
 ENDIF (WIN32)
 
 IF (APPLE)

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump.cpp	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -1,363 +0,0 @@
-/***************************************************************************
-  Try to display interesting crash dump
-
-    copyright            : (C) 2007 by mean, (C) 2007 Gruntster
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
-#include <unistd.h>
-#include <math.h>
-#include <string>
-#ifdef __MINGW32__
-#include <windows.h>
-#include <excpt.h>
-#include <imagehlp.h>
-#else
-#include <cxxabi.h>
-#endif
-
-#include "ADM_default.h"
-using namespace std;
-// Our callback to give UI formatted informations....
-static ADM_saveFunction *mysaveFunction=NULL;
-static ADM_fatalFunction *myFatalFunction=NULL;
-/**
-        \fn ADM_setCrashHook
-        \brief install crash handlers (save + display)
-*/
-void ADM_setCrashHook(ADM_saveFunction *save, ADM_fatalFunction *fatal)
-{
-        mysaveFunction=save;
-        myFatalFunction=fatal;
-}
-
-extern char *ADM_getBaseDir(void);
-extern void A_parseECMAScript(const char *name);
-
-#ifdef __APPLE__
-void installSigHandler() {}
-
-void ADM_backTrack(const char *info,int lineno,const char *file)
-{
-	char bfr[1024];
-
-	if (mysaveFunction)
-		mysaveFunction();
-
-	snprintf(bfr,1024,"%s\n file %s, line %d\n", info, file, lineno);
-
-	if(myFatalFunction)
-		myFatalFunction("Crash",bfr);
-
-	exit(-1);
-}
-#elif defined(__MINGW32__)
-typedef struct STACK_FRAME
-{
-    STACK_FRAME* ebp;	// address of the calling function frame
-    uint8_t* retAddr;	// return address
-    uint32_t param[0];	// parameter list (could be empty)
-} STACK_FRAME;
-
-static void dumpFrame(void* processId, void* frameAddr)
-{
-#ifdef ADM_CPU_X86_64
-#define ARCH_DWORD DWORD64
-#else
-#define ARCH_DWORD DWORD
-#endif
-
-	MEMORY_BASIC_INFORMATION mbi;
-	char moduleName[MAX_PATH];
-	HMODULE moduleAddr;
-	ARCH_DWORD symDisplacement;
-	IMAGEHLP_SYMBOL* pSymbol;
-
-	if (VirtualQuery(frameAddr, &mbi, sizeof(mbi)))
-	{
-		moduleName[0] = 0;
-		moduleAddr = (HMODULE)mbi.AllocationBase;
-		
-		GetModuleFileName(moduleAddr, moduleName, MAX_PATH);
-
-		printf("%s(", moduleName);
-
-		if (SymGetSymFromAddr(processId, (ARCH_DWORD)frameAddr, &symDisplacement, pSymbol))
-			printf("%s", pSymbol->Name);
-		else
-			printf("<unknown>");
-
-		printf("+0x%X) [0x%08X]\n", (ARCH_DWORD)frameAddr - (ARCH_DWORD)moduleAddr, frameAddr);
-
-		fflush(stdout);
-	}
-}
-	
-static void dumpExceptionInfo(void* processId, struct _EXCEPTION_RECORD* pExceptionRec, struct _CONTEXT* pContextRecord)
-{
-	printf("\n*********** EXCEPTION **************\n");
-	printf("Registers:\n");
-#ifdef ADM_CPU_X86_64
-	printf("RAX: %08X  RBX: %08X  RCX: %08X  RDX: %08X  RSI: %08X  RDI: %08X  RSP: %08X  RBP: %08X\n", pContextRecord->Rax, pContextRecord->Rbx, pContextRecord->Rcx, pContextRecord->Rdx, pContextRecord->Rsi, pContextRecord->Rdi, pContextRecord->Rsp, pContextRecord->Rbp);
-	printf("R8: %08X  R9: %08X  R10: %08X  R11: %08X  R12: %08X  R13: %08X  R14: %08X  R15: %08X\n", pContextRecord->R8, pContextRecord->R9, pContextRecord->R10, pContextRecord->R11, pContextRecord->R12, pContextRecord->R13, pContextRecord->R14, pContextRecord->R15);
-	printf("RIP: %08X  EFlags: %08X\n\n", pContextRecord->Rip, pContextRecord->EFlags);
-#else
-	printf("EAX: %08X  EBX: %08X  ECX: %08X  EDX: %08X  ESI: %08X\n", pContextRecord->Eax, pContextRecord->Ebx, pContextRecord->Ecx, pContextRecord->Edx, pContextRecord->Esi);
-	printf("EDI: %08X  ESP: %08X  EBP: %08X  EIP: %08X  EFlags: %08X\n\n", pContextRecord->Edi, pContextRecord->Esp, pContextRecord->Ebp, pContextRecord->Eip, pContextRecord->EFlags);
-#endif
-
-	printf("Exception Code: ");
-
-	switch (pExceptionRec->ExceptionCode)
-	{
-		case EXCEPTION_ACCESS_VIOLATION:
-			printf("EXCEPTION_ACCESS_VIOLATION");
-			break;
-		case EXCEPTION_ARRAY_BOUNDS_EXCEEDED:
-			printf("EXCEPTION_ARRAY_BOUNDS_EXCEEDED");
-			break;
-		case EXCEPTION_BREAKPOINT:
-			printf("EXCEPTION_BREAKPOINT");
-			break;
-		case EXCEPTION_DATATYPE_MISALIGNMENT:
-			printf("EXCEPTION_DATATYPE_MISALIGNMENT");
-			break;
-		case EXCEPTION_FLT_DENORMAL_OPERAND:
-			printf("EXCEPTION_FLT_DENORMAL_OPERAND");
-			break;
-		case EXCEPTION_FLT_DIVIDE_BY_ZERO:
-			printf("EXCEPTION_FLT_DIVIDE_BY_ZERO");
-			break;
-		case EXCEPTION_FLT_INEXACT_RESULT:
-			printf("EXCEPTION_FLT_INEXACT_RESULT");
-			break;
-		case EXCEPTION_FLT_INVALID_OPERATION:
-			printf("EXCEPTION_FLT_INVALID_OPERATION");
-			break;
-		case EXCEPTION_FLT_OVERFLOW:
-			printf("EXCEPTION_FLT_OVERFLOW");
-			break;
-		case EXCEPTION_FLT_STACK_CHECK:
-			printf("EXCEPTION_FLT_STACK_CHECK");
-			break;
-		case EXCEPTION_FLT_UNDERFLOW:
-			printf("EXCEPTION_FLT_UNDERFLOW");
-			break;
-		case EXCEPTION_ILLEGAL_INSTRUCTION:
-			printf("EXCEPTION_ILLEGAL_INSTRUCTION");
-			break;
-		case EXCEPTION_IN_PAGE_ERROR:
-			printf("EXCEPTION_IN_PAGE_ERROR");
-			break;
-		case EXCEPTION_INT_DIVIDE_BY_ZERO:
-			printf("EXCEPTION_INT_DIVIDE_BY_ZERO");
-			break;
-		case EXCEPTION_INT_OVERFLOW:
-			printf("EXCEPTION_INT_OVERFLOW");
-			break;
-		case EXCEPTION_INVALID_DISPOSITION:
-			printf("EXCEPTION_INVALID_DISPOSITION");
-			break;
-		case EXCEPTION_NONCONTINUABLE_EXCEPTION:
-			printf("EXCEPTION_NONCONTINUABLE_EXCEPTION");
-			break;
-		case EXCEPTION_PRIV_INSTRUCTION:
-			printf("EXCEPTION_PRIV_INSTRUCTION");
-			break;
-		case EXCEPTION_SINGLE_STEP:
-			printf("EXCEPTION_SINGLE_STEP");
-			break;
-		case EXCEPTION_STACK_OVERFLOW:
-			printf("EXCEPTION_STACK_OVERFLOW");
-			break;
-		default:
-			printf("UNKNOWN");
-	}
-	
-	printf(" (%08X)\n", pExceptionRec->ExceptionCode);
-	printf("Exception Flags: %08X\n", pExceptionRec->ExceptionFlags);
-
-	printf("\nOrigin:\n");
-
-#ifdef ADM_CPU_X86_64
-	dumpFrame(processId, (void*)pContextRecord->Rip);
-#else
-	dumpFrame(processId, (void*)pContextRecord->Eip);
-#endif
-
-	printf("*********** EXCEPTION **************\n");
-	fflush(stdout);
-}
-
-extern "C"
-{
-void dumpBackTrace(void* processId)
-{
-	if (!processId)
-		processId = GetCurrentProcess();
-
-	const int maxAddrCount = 32;
-
-	printf("\n*********** BACKTRACE **************\n");
-
-	// Get frame address using builtin GCC function.
-	STACK_FRAME* stackFrame = (STACK_FRAME*)__builtin_frame_address(0);
-
-    for (int retAddrCount = 0; (retAddrCount < maxAddrCount) && !IsBadReadPtr(stackFrame, sizeof(STACK_FRAME)) && !IsBadCodePtr(FARPROC(stackFrame->retAddr)); retAddrCount++, stackFrame = stackFrame->ebp)
-    {
-		printf("Frame %2d: ", retAddrCount);
-		dumpFrame(processId, stackFrame->retAddr);
-		fflush(stdout);
-    }
-
-	printf("*********** BACKTRACE **************\n\n");
-}
-}
-
-void ADM_backTrack(const char *info,int lineno,const char *file)
-{	
-	fflush(stderr);
-	fflush(stdout);
-
-	if (mysaveFunction)
-		mysaveFunction();
-
-	if (myFatalFunction)
-		myFatalFunction("Crash", "Press OK to build crash info");
-
-	void* currentProcessId = GetCurrentProcess();
-
-	SymInitialize(currentProcessId, NULL, TRUE);
-	dumpBackTrace(currentProcessId);
-	SymCleanup(currentProcessId);
-
-	printf("Assert failed at file %s, line %d\n\n",file,lineno);
-
-	exit(-1);
-}
-
-EXCEPTION_DISPOSITION exceptionHandler(struct _EXCEPTION_RECORD* pExceptionRec, void* pEstablisherFrame, struct _CONTEXT* pContextRecord, void* pDispatcherContext)
-{
-	fflush(stderr);
-	fflush(stdout);
-	static int running=0;
-
-	if(running)
-		exit(1);
-
-	running=1;
-
-	if (mysaveFunction)
-		mysaveFunction();
-
-	if (myFatalFunction)
-		myFatalFunction("Crash", "Press OK to build crash info");
-
-	void* currentProcessId = GetCurrentProcess();
-
-	SymInitialize(currentProcessId, NULL, TRUE);
-
-	dumpExceptionInfo(currentProcessId, pExceptionRec, pContextRecord);
-	fflush(stdout);
-	dumpBackTrace(currentProcessId);
-
-	SymCleanup(currentProcessId);
-
-	exit(1);
-}
-#else
-#include <signal.h>
-
-#if !defined( __CYGWIN__) && !defined(__HAIKU__)
-#include <execinfo.h>
-#endif
-
-void sig_segfault_handler(int signo);
-void installSigHandler()
-{
-    signal(11, sig_segfault_handler); // show stacktrace on default
-}
-
-
-/**
-      \fn sig_segfault_handler
-      \brief our segfault handler
-
-*/
-void sig_segfault_handler(int signo)
-{
-     
-     static int running=0;
-      if(running) 
-      {
-        signo=0;
-        exit(1);
-      }
-      running=0; 
-      ADM_backTrack("Segfault",0,"??");
-}
-
-void ADM_backTrack(const char *info,int lineno,const char *file)
-{
-	char wholeStuff[2048];
-    char buffer[4096];
-    char in[2048];
-	void *stack[20];
-	char **functions;
-	int count, i;
-
-	wholeStuff[0]=0;
-
-	if(mysaveFunction)
-		mysaveFunction();
-
-#if !defined( __CYGWIN__) && !defined(__HAIKU__)
-	printf("\n*********** BACKTRACK **************\n");
-
-	count = backtrace(stack, 20);
-	functions = backtrace_symbols(stack, count);
-	sprintf(wholeStuff,"%s\n at line %d, file %s",info,lineno,file);
-    string guiOut(wholeStuff); 
-    int status;
-    size_t size=2047;
-    // it looks like that xxxx (functionName+0x***) XXXX
-	for (i=0; i < count; i++) 
-	{
-        char *s=strstr(functions[i],"(");
-        buffer[0]=0;
-        if(s && strstr(s+1,"+"))
-        {
-            strcpy(in,s+1);
-            char *e=strstr(in,"+");
-            *e=0;                
-            __cxxabiv1::__cxa_demangle(in,buffer,&size,&status);
-            if(status) strcpy(buffer,in);
-        }else       
-            strcpy(buffer,functions[i]);
-        printf("%s:%d:<%s>:%d\n",functions[i],i,buffer,status);
-        guiOut+=string(buffer)+string("\n");
-		
-	}
-	printf("*********** BACKTRACK **************\n");
-
-	if(myFatalFunction)
-		myFatalFunction("Crash", guiOut.c_str()); // FIXME
-#endif	//__CYGWIN__
-
-	exit(-1); // _exit(1) ???
-}
-#endif
-//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_apple.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_apple.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_apple.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -0,0 +1,54 @@
+/***************************************************************************
+  Try to display interesting crash dump
+
+    copyright            : (C) 2007 by mean, (C) 2007 Gruntster
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <unistd.h>
+#include <cxxabi.h>
+
+#include "ADM_default.h"
+
+// Our callback to give UI formatted informations....
+static ADM_saveFunction *mysaveFunction=NULL;
+static ADM_fatalFunction *myFatalFunction=NULL;
+/**
+        \fn ADM_setCrashHook
+        \brief install crash handlers (save + display)
+*/
+void ADM_setCrashHook(ADM_saveFunction *save, ADM_fatalFunction *fatal)
+{
+        mysaveFunction=save;
+        myFatalFunction=fatal;
+}
+
+void installSigHandler() {}
+
+void ADM_backTrack(const char *info,int lineno,const char *file)
+{
+	char bfr[1024];
+
+	if (mysaveFunction)
+		mysaveFunction();
+
+	snprintf(bfr,1024,"%s\n file %s, line %d\n", info, file, lineno);
+
+	if(myFatalFunction)
+		myFatalFunction("Crash",bfr);
+
+	exit(-1);
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_mswin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_mswin.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_mswin.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -0,0 +1,290 @@
+/***************************************************************************
+  Try to display interesting crash dump
+
+    copyright            : (C) 2007 by mean, (C) 2007 Gruntster
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <windows.h>
+#include <imagehlp.h>
+#include <cxxabi.h>
+
+extern "C"
+{
+typedef void ADM_saveFunction(void);
+typedef void ADM_fatalFunction(const char *title, const char *info);
+void ADM_setCrashHook(ADM_saveFunction *save, ADM_fatalFunction *fatal);
+void ADM_backTrack(const char *info, int lineno, const char *file);
+}
+
+static ADM_saveFunction *mysaveFunction = NULL;
+static ADM_fatalFunction *myFatalFunction = NULL;
+
+void ADM_setCrashHook(ADM_saveFunction *save, ADM_fatalFunction *fatal)
+{
+	mysaveFunction = save;
+	myFatalFunction = fatal;
+}
+
+static void PrintFunction(const char *moduleName, const char *functionName, DWORD_PTR frameAddress, DWORD_PTR frameOffset)
+{
+	if (functionName)
+	{
+		char *cxaFunction = (char*)malloc(strlen(functionName) + 2);
+
+		cxaFunction[0] = '_';
+		strcpy(cxaFunction + 1, functionName);
+
+		int status;
+		char *demangledName = __cxxabiv1::__cxa_demangle(cxaFunction, NULL, NULL, &status);
+
+		free(cxaFunction);
+
+		if (status == 0)
+			printf(demangledName);
+		else
+			printf(functionName);
+
+		if (demangledName)
+			free(demangledName);
+	}
+	else
+		printf("unknown function");
+
+	if (frameOffset)
+		printf(" <+0x%X>", frameOffset);
+
+	if (moduleName)
+		printf("  [%s]\n", moduleName);
+	else
+		printf("  [unknown module]\n");
+
+	fflush(stdout);
+}
+
+static bool DumpFrame(void *process, DWORD_PTR frameAddress)
+{
+	const int functionLength = 255;
+	IMAGEHLP_SYMBOL *symbol = (IMAGEHLP_SYMBOL*)malloc(sizeof(IMAGEHLP_SYMBOL) + functionLength);
+	DWORD_PTR moduleBase = SymGetModuleBase(process, frameAddress);
+	const char *moduleName = NULL, *functionName = NULL;
+	DWORD_PTR displacement;
+	char moduleFilename[MAX_PATH];
+
+	symbol->SizeOfStruct = (sizeof(*symbol)) + functionLength;
+	symbol->MaxNameLength = functionLength - 1;
+
+	if (moduleBase && GetModuleFileName((HINSTANCE)moduleBase, moduleFilename, MAX_PATH))
+		moduleName = moduleFilename;
+
+	if (SymGetSymFromAddr(process, frameAddress, &displacement, symbol))
+		functionName = symbol->Name;
+
+	PrintFunction(moduleName, functionName, frameAddress, displacement);
+
+	free(symbol);
+}
+
+static void DumpExceptionInfo(void *processId, struct _EXCEPTION_RECORD *exceptionRec, struct _CONTEXT *contextRecord)
+{
+	printf("\n*********** EXCEPTION **************\n");
+	printf("Registers:\n");
+#ifdef _WIN64
+	printf("RAX: %08X  RBX: %08X  RCX: %08X  RDX: %08X  RSI: %08X  RDI: %08X  RSP: %08X  RBP: %08X\n", contextRecord->Rax, contextRecord->Rbx, contextRecord->Rcx, contextRecord->Rdx, contextRecord->Rsi, contextRecord->Rdi, contextRecord->Rsp, contextRecord->Rbp);
+	printf("R8: %08X  R9: %08X  R10: %08X  R11: %08X  R12: %08X  R13: %08X  R14: %08X  R15: %08X\n", contextRecord->R8, contextRecord->R9, contextRecord->R10, contextRecord->R11, contextRecord->R12, contextRecord->R13, contextRecord->R14, contextRecord->R15);
+	printf("RIP: %08X  EFlags: %08X\n\n", contextRecord->Rip, contextRecord->EFlags);
+#else
+	printf("EAX: %08X  EBX: %08X  ECX: %08X  EDX: %08X  ESI: %08X\n", contextRecord->Eax, contextRecord->Ebx, contextRecord->Ecx, contextRecord->Edx, contextRecord->Esi);
+	printf("EDI: %08X  ESP: %08X  EBP: %08X  EIP: %08X  EFlags: %08X\n\n", contextRecord->Edi, contextRecord->Esp, contextRecord->Ebp, contextRecord->Eip, contextRecord->EFlags);
+#endif
+
+	printf("Exception Code: ");
+
+	switch (exceptionRec->ExceptionCode)
+	{
+		case EXCEPTION_ACCESS_VIOLATION:
+			printf("EXCEPTION_ACCESS_VIOLATION");
+			break;
+		case EXCEPTION_ARRAY_BOUNDS_EXCEEDED:
+			printf("EXCEPTION_ARRAY_BOUNDS_EXCEEDED");
+			break;
+		case EXCEPTION_BREAKPOINT:
+			printf("EXCEPTION_BREAKPOINT");
+			break;
+		case EXCEPTION_DATATYPE_MISALIGNMENT:
+			printf("EXCEPTION_DATATYPE_MISALIGNMENT");
+			break;
+		case EXCEPTION_FLT_DENORMAL_OPERAND:
+			printf("EXCEPTION_FLT_DENORMAL_OPERAND");
+			break;
+		case EXCEPTION_FLT_DIVIDE_BY_ZERO:
+			printf("EXCEPTION_FLT_DIVIDE_BY_ZERO");
+			break;
+		case EXCEPTION_FLT_INEXACT_RESULT:
+			printf("EXCEPTION_FLT_INEXACT_RESULT");
+			break;
+		case EXCEPTION_FLT_INVALID_OPERATION:
+			printf("EXCEPTION_FLT_INVALID_OPERATION");
+			break;
+		case EXCEPTION_FLT_OVERFLOW:
+			printf("EXCEPTION_FLT_OVERFLOW");
+			break;
+		case EXCEPTION_FLT_STACK_CHECK:
+			printf("EXCEPTION_FLT_STACK_CHECK");
+			break;
+		case EXCEPTION_FLT_UNDERFLOW:
+			printf("EXCEPTION_FLT_UNDERFLOW");
+			break;
+		case EXCEPTION_ILLEGAL_INSTRUCTION:
+			printf("EXCEPTION_ILLEGAL_INSTRUCTION");
+			break;
+		case EXCEPTION_IN_PAGE_ERROR:
+			printf("EXCEPTION_IN_PAGE_ERROR");
+			break;
+		case EXCEPTION_INT_DIVIDE_BY_ZERO:
+			printf("EXCEPTION_INT_DIVIDE_BY_ZERO");
+			break;
+		case EXCEPTION_INT_OVERFLOW:
+			printf("EXCEPTION_INT_OVERFLOW");
+			break;
+		case EXCEPTION_INVALID_DISPOSITION:
+			printf("EXCEPTION_INVALID_DISPOSITION");
+			break;
+		case EXCEPTION_NONCONTINUABLE_EXCEPTION:
+			printf("EXCEPTION_NONCONTINUABLE_EXCEPTION");
+			break;
+		case EXCEPTION_PRIV_INSTRUCTION:
+			printf("EXCEPTION_PRIV_INSTRUCTION");
+			break;
+		case EXCEPTION_SINGLE_STEP:
+			printf("EXCEPTION_SINGLE_STEP");
+			break;
+		case EXCEPTION_STACK_OVERFLOW:
+			printf("EXCEPTION_STACK_OVERFLOW");
+			break;
+		default:
+			printf("UNKNOWN");
+	}
+	
+	printf(" (%08X)\n", exceptionRec->ExceptionCode);
+	printf("Exception Flags: %08X\n", exceptionRec->ExceptionFlags);
+
+	printf("\nOrigin:\n");
+
+#ifdef _WIN64
+	DumpFrame(processId, contextRecord->Rip);
+#else
+	DumpFrame(processId, contextRecord->Eip);
+#endif
+
+	printf("*********** EXCEPTION **************\n");
+	fflush(stdout);
+}
+
+void DumpBackTrace(void *processId)
+{
+	printf("\n*********** BACKTRACE **************\n");
+
+	typedef VOID NTAPI RtlCaptureContext_(PCONTEXT ContextRecord);
+
+	HANDLE process = GetCurrentProcess();
+	HANDLE thread = GetCurrentThread();
+	HINSTANCE hinstLib = LoadLibrary("kernel32.dll");
+	RtlCaptureContext_* contextFunc = (RtlCaptureContext_*)GetProcAddress(hinstLib, "RtlCaptureContext");
+	STACKFRAME frame;
+	CONTEXT context;
+	int limit = 50;
+	DWORD machineType;
+
+	memset(&frame, 0, sizeof(STACKFRAME));
+	memset(&context, 0, sizeof(CONTEXT));
+
+	context.ContextFlags = CONTEXT_FULL;
+	contextFunc(&context);
+
+#if _WIN64
+	machineType = IMAGE_FILE_MACHINE_AMD64;
+
+    frame.AddrPC.Offset = context.Rip;
+	frame.AddrStack.Offset = context.Rsp;
+	frame.AddrFrame.Offset = context.Rbp;
+#else
+	machineType = IMAGE_FILE_MACHINE_I386;
+
+	frame.AddrPC.Offset = context.Eip;
+	frame.AddrStack.Offset = context.Esp;
+	frame.AddrFrame.Offset = context.Ebp;
+#endif
+
+    frame.AddrPC.Mode = AddrModeFlat;
+    frame.AddrStack.Mode = AddrModeFlat;
+    frame.AddrFrame.Mode = AddrModeFlat;
+
+	while (StackWalk(machineType, process, thread, &frame, &context, 0, SymFunctionTableAccess, SymGetModuleBase, 0))
+	{
+        if (limit-- == 0)
+			break;
+
+		DumpFrame(process, frame.AddrPC.Offset);
+	}
+
+	printf("*********** BACKTRACE **************\n\n");
+}
+
+void HandleException(struct _EXCEPTION_RECORD *exceptionRecord, struct _CONTEXT *contextRecord)
+{
+	fflush(stderr);
+	fflush(stdout);	
+
+	static int running = 0;
+
+	if (running)
+		exit(1);
+
+	running = 1;
+
+	if (mysaveFunction)
+		mysaveFunction();
+
+	if (myFatalFunction)
+		myFatalFunction("Crash", "Press OK to build crash info");
+
+	void *process = GetCurrentProcess();
+
+	SymInitialize(process, NULL, TRUE);
+
+	if (exceptionRecord != NULL && contextRecord != NULL)
+	{
+		DumpExceptionInfo(process, exceptionRecord, contextRecord);
+	}
+
+	DumpBackTrace(process);
+	SymCleanup(process);
+
+	exit(1);
+}
+
+EXCEPTION_DISPOSITION ExceptionHandler(struct _EXCEPTION_RECORD *exceptionRecord, void *establisherFrame, struct _CONTEXT *contextRecord, void *dispatcherContext)
+{
+	HandleException(exceptionRecord, contextRecord);
+}
+
+LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo)
+{
+	HandleException(exceptionInfo->ExceptionRecord, exceptionInfo->ContextRecord);
+}
+
+void ADM_backTrack(const char *info, int lineno, const char *file)
+{	
+	HandleException(NULL, NULL);
+}

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp (from rev 7528, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp	2011-09-14 09:32:13 UTC (rev 7536)
@@ -0,0 +1,107 @@
+/***************************************************************************
+  Try to display interesting crash dump
+
+    copyright            : (C) 2007 by mean, (C) 2007 Gruntster
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <unistd.h>
+#include <cxxabi.h>
+#include <signal.h>
+#include <execinfo.h>
+
+#include "ADM_default.h"
+
+// Our callback to give UI formatted informations....
+static ADM_saveFunction *mysaveFunction=NULL;
+static ADM_fatalFunction *myFatalFunction=NULL;
+
+/**
+        \fn ADM_setCrashHook
+        \brief install crash handlers (save + display)
+*/
+void ADM_setCrashHook(ADM_saveFunction *save, ADM_fatalFunction *fatal)
+{
+        mysaveFunction=save;
+        myFatalFunction=fatal;
+}
+
+/**
+      \fn sig_segfault_handler
+      \brief our segfault handler
+*/
+void sig_segfault_handler(int signo)
+{
+     static int running=0;
+      if(running) 
+      {
+        signo=0;
+        exit(1);
+      }
+      running=0; 
+      ADM_backTrack("Segfault",0,"??");
+}
+
+void ADM_backTrack(const char *info,int lineno,const char *file)
+{
+	char wholeStuff[2048];
+    char buffer[4096];
+    char in[2048];
+	void *stack[20];
+	char **functions;
+	int count, i;
+
+	wholeStuff[0]=0;
+
+	if(mysaveFunction)
+		mysaveFunction();
+
+#ifndef(__HAIKU__)
+	printf("\n*********** BACKTRACK **************\n");
+
+	count = backtrace(stack, 20);
+	functions = backtrace_symbols(stack, count);
+	sprintf(wholeStuff,"%s\n at line %d, file %s",info,lineno,file);
+    int status;
+    size_t size=2047;
+    // it looks like that xxxx (functionName+0x***) XXXX
+	for (i=0; i < count; i++) 
+	{
+        char *s=strstr(functions[i],"(");
+        buffer[0]=0;
+        if(s && strstr(s+1,"+"))
+        {
+            strcpy(in,s+1);
+            char *e=strstr(in,"+");
+            *e=0;                
+            __cxxabiv1::__cxa_demangle(in,buffer,&size,&status);
+            if(status) strcpy(buffer,in);
+        }else       
+            strcpy(buffer,functions[i]);
+        printf("%s:%d:<%s>:%d\n",functions[i],i,buffer,status);
+		strcat(wholeStuff,buffer);
+		strcat(wholeStuff,"\n");
+	}
+
+	printf("*********** BACKTRACK **************\n");
+
+	if(myFatalFunction)
+		myFatalFunction("Crash", wholeStuff); // FIXME
+
+	exit(-1); // _exit(1) ???
+}
+#endif
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2011-09-14 08:48:36 UTC (rev 7535)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2011-09-14 09:32:13 UTC (rev 7536)
@@ -1,18 +1,25 @@
 SET(ADM_core_SRCS 
 	ADM_cpuCap.cpp  ADM_memcpy.cpp  ADM_memsupport.cpp  ADM_threads.cpp  ADM_win32.cpp
-	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_crashdump.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp
+	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp
         ADM_debug.cpp 
         ADM_queue.cpp
         ADM_benchmark.cpp
 )
 
+IF (MINGW)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_mswin.cpp)
+ELSEIF (APPLE)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_apple.cpp)
+ELSE (MINGW)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_unix.cpp)
+ENDIF (MINGW)
+
 ADM_ADD_SHARED_LIBRARY(ADM_core6 ${ADM_core_SRCS})
 ADD_TARGET_DEFINITIONS(ADM_core6 ADM_DEBUG FIND_LEAKS)
 
 IF (MINGW)
 	TARGET_LINK_LIBRARIES(ADM_core6 "${PTHREAD_LIBRARIES}" imagehlp ws2_32)
 	ADD_TARGET_CFLAGS(ADM_core6 "-I${PTHREAD_INCLUDE_DIR}")
-	ADD_TARGET_CFLAGS(ADM_core6 "-fpermissive")
 ELSEIF (APPLE)
 	ADD_TARGET_LDFLAGS(ADM_core6 "-framework Carbon")
 ENDIF (MINGW)
@@ -24,7 +31,5 @@
 
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)
 
-# pthreads
-
 ADM_LINK_THREAD(ADM_core6)
 ADM_INSTALL_LIB(ADM_core6)



From gruntster at mail.berlios.de  Wed Sep 14 11:34:05 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 11:34:05 +0200
Subject: [Avidemux-svn-commit] r7537 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110914093406.10D9948129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 11:34:05 +0200 (Wed, 14 Sep 2011)
New Revision: 7537

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp
Log:
[win64] apply r4354

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp	2011-09-14 09:32:13 UTC (rev 7536)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp	2011-09-14 09:34:05 UTC (rev 7537)
@@ -140,7 +140,7 @@
     "movsb\n"
     "2:"
     : "=&c" (d0), "=&D" (d1), "=&S" (d2)
-    :"0" (n/4), "q" (n),"1" ((long) to),"2" ((long) from)
+    :"0" (n/4), "q" (n),"1" ((intptr_t) to),"2" ((intptr_t) from)
     : "memory");
 
   return (to);
@@ -181,7 +181,7 @@
   {
     register unsigned long int delta;
     /* Align destinition to MMREG_SIZE -boundary */
-    delta = ((unsigned long int)uto)&(SSE_MMREG_SIZE-1);
+    delta = ((intptr_t)uto)&(SSE_MMREG_SIZE-1);
     if(delta)
     {
       delta=SSE_MMREG_SIZE-delta;
@@ -190,7 +190,7 @@
     }
     i = len >> 6; /* len/64 */
     len&=63;
-    if(((unsigned long)ufrom) & 15)
+    if(((intptr_t)ufrom) & 15)
       /* if SRC is misaligned */
       for(; i>0; i--)
       {
@@ -257,7 +257,7 @@
   {
     register unsigned long int delta;
     /* Align destinition to MMREG_SIZE -boundary */
-    delta = ((unsigned long int)uto)&(MMX_MMREG_SIZE-1);
+    delta = ((intptr_t)uto)&(MMX_MMREG_SIZE-1);
     if(delta)
     {
       delta=MMX_MMREG_SIZE-delta;
@@ -324,7 +324,7 @@
   {
     register unsigned long int delta;
     /* Align destinition to MMREG_SIZE -boundary */
-    delta = ((unsigned long int)uto)&(MMX_MMREG_SIZE-1);
+    delta = ((intptr_t)uto)&(MMX_MMREG_SIZE-1);
     if(delta)
     {
       delta=MMX_MMREG_SIZE-delta;
@@ -375,33 +375,7 @@
 }
 #endif /* ARCH_X86 */
 
-static struct {
-  const char *name;
-  void *(* function)(void *to, const void *from, size_t len);
-
-  uint64_t time; /* This type could be used for non-MSC build too! */
-
-  uint32_t cpu_require;
-} memcpy_method[] =
-{
-  { NULL, NULL, 0, 0 },
-  { "libc memcpy()", memcpy, 0, 0 },
 #if defined(ADM_CPU_X86)
-  { "linux kernel memcpy()", linux_kernel_memcpy, 0, 0 },
-#if defined(ADM_CPU_X86)
-  { "MMX optimized memcpy()", mmx_memcpy, 0, 0 },
-  { "MMXEXT optimized memcpy()", mmx2_memcpy, 0, 0 },
-  { "SSE optimized memcpy()", sse_memcpy, 0, 0|0 },
-#endif
-#endif /* ARCH_X86 */
-#if 0 && defined(ADM_CPU_PPC) && !defined (__APPLE__)
-  { "ppcasm_memcpy()", ppcasm_memcpy, 0, 0 },
-  { "ppcasm_cacheable_memcpy()", ppcasm_cacheable_memcpy, 0, FF_MM_ACCEL_PPC_CACHE32 },
-#endif /* ARCH_PPC && !HOST_OS_DARWIN */
-  { NULL, NULL, 0, 0 }
-};
-
-#if defined(ADM_CPU_X86)
 static unsigned long long int rdtsc(void)
 {
   unsigned long long int x=0;
@@ -436,7 +410,7 @@
 	stop=rdtsc();
 	ADM_dealloc(src);
 	ADM_dealloc(dst);
-	printf("Method :%s \tTime:%lu\n",name,(unsigned long int)stop-start);
+	printf("Method :%s \tTime:%lu\n",name,stop-start);
 	return 1;
 
 }



From gruntster at mail.berlios.de  Wed Sep 14 11:42:50 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 11:42:50 +0200
Subject: [Avidemux-svn-commit] r7538 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110914094250.EB22448129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 11:42:50 +0200 (Wed, 14 Sep 2011)
New Revision: 7538

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
Log:
[fileio] only add separator if needed

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-14 09:34:05 UTC (rev 7537)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-14 09:42:50 UTC (rev 7538)
@@ -1,365 +1,365 @@
-/***************************************************************************
-                    
-    copyright            : (C) 2006 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <dirent.h>
-#include <errno.h>
-#include <sys/stat.h>
-#include <unistd.h>
-
-#if defined(__APPLE__)
- #include <Carbon/Carbon.h>
-#else
- #include <fcntl.h>
- #ifdef __WIN32
-  #include <direct.h>
-  #include <shlobj.h>
- #endif
-#endif
-
-#include "ADM_default.h"
-
-#define WIN32_PORTABLE_MODE 1
-
-#ifdef __WIN32
-static const char *SEPARATOR="\\";
-
-#ifdef WIN32_PORTABLE_MODE
-    const char *ADM_DIR_NAME="settings";
-    bool portable=true;
-#else
-    const char *ADM_DIR_NAME="avidemux6";
-    bool portable=false;
-#endif
-#elif defined __HAIKU__
-static const char *SEPARATOR="/";
-const char *ADM_DIR_NAME="config/settings/avidemux6";
-
-#else
-static const char *SEPARATOR="/";
-const char *ADM_DIR_NAME=".avidemux6";
-#endif
-
-static char ADM_basedir[1024] = {0};
-static char *ADM_jobdir = NULL;
-static char *ADM_customdir = NULL;
-static char *ADM_autodir = NULL;
-static char *ADM_systemPluginSettings=NULL;
-static char *ADM_userPluginSettings=NULL;
-static int baseDirDone = 0;
-
-#undef fread
-#undef fwrite
-#undef fopen
-#undef fclose
-
-#ifdef __WIN32
-extern int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
-extern int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
-#endif
-
-size_t ADM_fread (void *ptr, size_t size, size_t n, FILE *sstream)
-{
-	return fread(ptr,size,n,sstream);
-}
-
-size_t ADM_fwrite(const void *ptr, size_t size, size_t n, FILE *sstream)
-{
-	return fwrite(ptr,size,n,sstream);
-}
-/**
-    \fn ADM_eraseFile
-*/
-uint8_t ADM_eraseFile(const char *file)
-{
-    if(!unlink(file))
-        return true;
-    return false;
-}
-/**
-    \fn ADM_fileSize
-    \brief return filesize, -1 on error
-*/
-int64_t ADM_fileSize(const char *file)
-{
-    FILE *f=ADM_fopen(file,"r");
-    if(!f) return -1;
-    fseeko(f,0,SEEK_END);
-    int64_t v=ftello(f);
-    fclose(f);
-    return v;
-}
-/**
-    \fn ADM_fopen
-    \brief utf8 aware fopen, so that we can use utf8 string even on win32
-*/
-FILE *ADM_fopen(const char *file, const char *mode)
-{
-#ifdef __MINGW32__
-	// Override fopen to handle Unicode filenames and to ensure exclusive access when initially writing to a file.
-	int fileNameLength = utf8StringToWideChar(file, -1, NULL);
-	wchar_t wcFile[fileNameLength];
-	int creation = 0, access = 0;
-	HANDLE hFile;
-
-	utf8StringToWideChar(file, -1, wcFile);
-
-	if (strchr(mode, 'w'))
-	{
-		creation = CREATE_ALWAYS;
-		access = GENERIC_WRITE;
-
-		if (strchr(mode, '+'))
-			access |= GENERIC_READ;
-	}
-	else if (strchr(mode, 'r'))
-	{
-		creation = OPEN_EXISTING;
-		access = GENERIC_READ;
-
-		if (strchr(mode, '+'))
-			access = GENERIC_WRITE;
-	}
-	else if (strchr(mode, 'a'))
-	{
-		creation = OPEN_ALWAYS;
-		access = GENERIC_WRITE;
-
-		if (strchr(mode, '+'))
-			access |= GENERIC_READ;
-	}
-
-	if (creation & GENERIC_WRITE)
-	{
-		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
-
-		if (hFile == INVALID_HANDLE_VALUE)
-			return NULL;
-		else
-			CloseHandle(hFile);
-	}
-
-	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
-
-	if (hFile == INVALID_HANDLE_VALUE)
-		return NULL;
-	else
-		return _fdopen(_open_osfhandle((intptr_t)hFile, 0), mode);
-#else
-	return fopen(file, mode);
-#endif
-}
-
-#if __WIN32
-extern "C"
-{
-	// libavformat uses open (in the file_open function) so we need to override that too.
-	// Following the same rules as ADM_fopen.
-	int ADM_open(const char *path, int oflag, ...)
-	{
-		int fileNameLength = utf8StringToWideChar(path, -1, NULL);
-		wchar_t wcFile[fileNameLength];
-		int creation = 0, access = 0;
-		HANDLE hFile;
-
-		utf8StringToWideChar(path, -1, wcFile);
-
-		if (oflag & O_WRONLY || oflag & O_RDWR)
-		{
-			access = GENERIC_WRITE;
-
-			if (oflag & O_RDWR)
-				access |= GENERIC_READ;
-
-			if (oflag & O_CREAT)
-			{
-				if (oflag & O_EXCL)
-					creation = CREATE_NEW;
-				else if (oflag & O_TRUNC)
-					creation = CREATE_ALWAYS;
-				else
-					creation = OPEN_ALWAYS;
-			}
-			else if (oflag & O_TRUNC)
-				creation = TRUNCATE_EXISTING;
-		}
-		else if (oflag & O_RDONLY)
-			creation = OPEN_EXISTING;
-
-		if (creation & GENERIC_WRITE)
-		{
-			hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
-
-			if (hFile == INVALID_HANDLE_VALUE)
-				return -1;
-			else
-				CloseHandle(hFile);
-		}
-
-		hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
-
-		if (hFile == INVALID_HANDLE_VALUE)
-			return -1;
-		else
-			return _open_osfhandle((intptr_t)hFile, oflag);
-	}
-}
-#endif
-
-int ADM_fclose(FILE *file)
-{
-	return fclose(file); 
-}
-
-/*
-      Get the  directory where jobs are stored
-******************************************************/
-char *ADM_getCustomDir(void)
-{
-	if (ADM_customdir)
-		return ADM_customdir;
-
-	ADM_customdir = ADM_getHomeRelativePath("custom");
-
-	if (!ADM_mkdir(ADM_customdir))
-	{
-		printf("can't create custom directory (%s).\n", ADM_customdir);
-		return NULL;
-	}
-
-	return ADM_customdir;
-}
-/**
-    \fn ADM_getAutoDir
-    \brief  Get the  directory where auto script are stored. No need to free the string.
-******************************************************/
-char *ADM_getAutoDir(void)
-{
-	if (ADM_autodir )
-		return ADM_autodir;
-    ADM_autodir = ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "autoScripts");
-	return ADM_autodir;
-}
-/**
-    \fn ADM_getPluginSettingsDir
-    \brief Get the folder containing the plugin settings (presets etc..)
-*/
-const char *ADM_getSystemPluginSettingsDir(void)
-{
-    if(ADM_systemPluginSettings) return ADM_systemPluginSettings;
-    ADM_systemPluginSettings=ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "pluginSettings");
-    return ADM_systemPluginSettings;
-}
-/**
-
-*/
-const char *ADM_getUserPluginSettingsDir(void)
-{
-    if(ADM_userPluginSettings) return ADM_userPluginSettings;
-    ADM_userPluginSettings=ADM_getHomeRelativePath("pluginSettings");
-    return ADM_userPluginSettings;
-}
-
-/*
-      Get the  directory where jobs are stored
-******************************************************/
-char *ADM_getJobDir(void)
-{
-	if (ADM_jobdir)
-		return ADM_jobdir;
-
-	ADM_jobdir = ADM_getHomeRelativePath("jobs");
-
-
-	if (!ADM_mkdir(ADM_jobdir))
-	{
-		printf("can't create custom directory (%s).\n", ADM_jobdir);
-		return NULL;
-	}
-
-	return ADM_jobdir;
-}
-
-static void AddSeparator(char *path)
-{
-	if (path && (strlen(path) < strlen(SEPARATOR) || strncmp(path + strlen(path) - strlen(SEPARATOR), SEPARATOR, strlen(SEPARATOR)) != 0))
-		strcat(path, SEPARATOR);
-}
-
-/**
- * 	\fn ADM_getRelativePath
- */
-static char *ADM_getRelativePath(const char *base0, const char *base1, const char *base2, const char *base3)
-{
-	char *result;
-	int length = strlen(base0) + 2;
-
-	if (base1)
-		length += strlen(base1) + 1;
-
-	if (base2)
-		length += strlen(base2) + 1;
-
-	if (base3)
-		length += strlen(base3) + 1;
-
-	result = (char *)new char[length];
-	strcpy(result, base0);
-	AddSeparator(result);
-
-	if (base1)
-	{
-		if (strlen(base1))
-		{
-			strcat(result, base1);
-			strcat(result, SEPARATOR);
-		}
-
-		if (base2)
-		{
-			if (strlen(base2))
-			{
-				strcat(result, base2);
-				strcat(result, SEPARATOR);
-			}
-
-			if (base3 && strlen(base3))
-			{
-				strcat(result, base3);				
-				strcat(result, SEPARATOR);
-			}
-		}
-	}
-
-	return result;
-}
-
-/**
- * 	\fn char *ADM_getHomeRelativePath(const char *base1, const char *base2=NULL,const char *base3=NULL);
- *  \brief Returns home directory +base 1 + base 2... The return value is a copy, and must be deleted []
- */
-char *ADM_getHomeRelativePath(const char *base1, const char *base2, const char *base3)
-{
-	return ADM_getRelativePath(ADM_getBaseDir(), base1, base2, base3);
-}
-
-char *ADM_getInstallRelativePath(const char *base1, const char *base2, const char *base3)
-{
+/***************************************************************************
+                    
+    copyright            : (C) 2006 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <dirent.h>
+#include <errno.h>
+#include <sys/stat.h>
+#include <unistd.h>
+
+#if defined(__APPLE__)
+ #include <Carbon/Carbon.h>
+#else
+ #include <fcntl.h>
+ #ifdef __WIN32
+  #include <direct.h>
+  #include <shlobj.h>
+ #endif
+#endif
+
+#include "ADM_default.h"
+
+#define WIN32_PORTABLE_MODE 1
+
 #ifdef __WIN32
+static const char *SEPARATOR="\\";
+
+#ifdef WIN32_PORTABLE_MODE
+    const char *ADM_DIR_NAME="settings";
+    bool portable=true;
+#else
+    const char *ADM_DIR_NAME="avidemux6";
+    bool portable=false;
+#endif
+#elif defined __HAIKU__
+static const char *SEPARATOR="/";
+const char *ADM_DIR_NAME="config/settings/avidemux6";
+
+#else
+static const char *SEPARATOR="/";
+const char *ADM_DIR_NAME=".avidemux6";
+#endif
+
+static char ADM_basedir[1024] = {0};
+static char *ADM_jobdir = NULL;
+static char *ADM_customdir = NULL;
+static char *ADM_autodir = NULL;
+static char *ADM_systemPluginSettings=NULL;
+static char *ADM_userPluginSettings=NULL;
+static int baseDirDone = 0;
+
+#undef fread
+#undef fwrite
+#undef fopen
+#undef fclose
+
+#ifdef __WIN32
+extern int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
+extern int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
+#endif
+
+size_t ADM_fread (void *ptr, size_t size, size_t n, FILE *sstream)
+{
+	return fread(ptr,size,n,sstream);
+}
+
+size_t ADM_fwrite(const void *ptr, size_t size, size_t n, FILE *sstream)
+{
+	return fwrite(ptr,size,n,sstream);
+}
+/**
+    \fn ADM_eraseFile
+*/
+uint8_t ADM_eraseFile(const char *file)
+{
+    if(!unlink(file))
+        return true;
+    return false;
+}
+/**
+    \fn ADM_fileSize
+    \brief return filesize, -1 on error
+*/
+int64_t ADM_fileSize(const char *file)
+{
+    FILE *f=ADM_fopen(file,"r");
+    if(!f) return -1;
+    fseeko(f,0,SEEK_END);
+    int64_t v=ftello(f);
+    fclose(f);
+    return v;
+}
+/**
+    \fn ADM_fopen
+    \brief utf8 aware fopen, so that we can use utf8 string even on win32
+*/
+FILE *ADM_fopen(const char *file, const char *mode)
+{
+#ifdef __MINGW32__
+	// Override fopen to handle Unicode filenames and to ensure exclusive access when initially writing to a file.
+	int fileNameLength = utf8StringToWideChar(file, -1, NULL);
+	wchar_t wcFile[fileNameLength];
+	int creation = 0, access = 0;
+	HANDLE hFile;
+
+	utf8StringToWideChar(file, -1, wcFile);
+
+	if (strchr(mode, 'w'))
+	{
+		creation = CREATE_ALWAYS;
+		access = GENERIC_WRITE;
+
+		if (strchr(mode, '+'))
+			access |= GENERIC_READ;
+	}
+	else if (strchr(mode, 'r'))
+	{
+		creation = OPEN_EXISTING;
+		access = GENERIC_READ;
+
+		if (strchr(mode, '+'))
+			access = GENERIC_WRITE;
+	}
+	else if (strchr(mode, 'a'))
+	{
+		creation = OPEN_ALWAYS;
+		access = GENERIC_WRITE;
+
+		if (strchr(mode, '+'))
+			access |= GENERIC_READ;
+	}
+
+	if (creation & GENERIC_WRITE)
+	{
+		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
+
+		if (hFile == INVALID_HANDLE_VALUE)
+			return NULL;
+		else
+			CloseHandle(hFile);
+	}
+
+	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
+
+	if (hFile == INVALID_HANDLE_VALUE)
+		return NULL;
+	else
+		return _fdopen(_open_osfhandle((intptr_t)hFile, 0), mode);
+#else
+	return fopen(file, mode);
+#endif
+}
+
+#if __WIN32
+extern "C"
+{
+	// libavformat uses open (in the file_open function) so we need to override that too.
+	// Following the same rules as ADM_fopen.
+	int ADM_open(const char *path, int oflag, ...)
+	{
+		int fileNameLength = utf8StringToWideChar(path, -1, NULL);
+		wchar_t wcFile[fileNameLength];
+		int creation = 0, access = 0;
+		HANDLE hFile;
+
+		utf8StringToWideChar(path, -1, wcFile);
+
+		if (oflag & O_WRONLY || oflag & O_RDWR)
+		{
+			access = GENERIC_WRITE;
+
+			if (oflag & O_RDWR)
+				access |= GENERIC_READ;
+
+			if (oflag & O_CREAT)
+			{
+				if (oflag & O_EXCL)
+					creation = CREATE_NEW;
+				else if (oflag & O_TRUNC)
+					creation = CREATE_ALWAYS;
+				else
+					creation = OPEN_ALWAYS;
+			}
+			else if (oflag & O_TRUNC)
+				creation = TRUNCATE_EXISTING;
+		}
+		else if (oflag & O_RDONLY)
+			creation = OPEN_EXISTING;
+
+		if (creation & GENERIC_WRITE)
+		{
+			hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
+
+			if (hFile == INVALID_HANDLE_VALUE)
+				return -1;
+			else
+				CloseHandle(hFile);
+		}
+
+		hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
+
+		if (hFile == INVALID_HANDLE_VALUE)
+			return -1;
+		else
+			return _open_osfhandle((intptr_t)hFile, oflag);
+	}
+}
+#endif
+
+int ADM_fclose(FILE *file)
+{
+	return fclose(file); 
+}
+
+/*
+      Get the  directory where jobs are stored
+******************************************************/
+char *ADM_getCustomDir(void)
+{
+	if (ADM_customdir)
+		return ADM_customdir;
+
+	ADM_customdir = ADM_getHomeRelativePath("custom");
+
+	if (!ADM_mkdir(ADM_customdir))
+	{
+		printf("can't create custom directory (%s).\n", ADM_customdir);
+		return NULL;
+	}
+
+	return ADM_customdir;
+}
+/**
+    \fn ADM_getAutoDir
+    \brief  Get the  directory where auto script are stored. No need to free the string.
+******************************************************/
+char *ADM_getAutoDir(void)
+{
+	if (ADM_autodir )
+		return ADM_autodir;
+    ADM_autodir = ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "autoScripts");
+	return ADM_autodir;
+}
+/**
+    \fn ADM_getPluginSettingsDir
+    \brief Get the folder containing the plugin settings (presets etc..)
+*/
+const char *ADM_getSystemPluginSettingsDir(void)
+{
+    if(ADM_systemPluginSettings) return ADM_systemPluginSettings;
+    ADM_systemPluginSettings=ADM_getInstallRelativePath(ADM_RELATIVE_LIB_DIR, ADM_PLUGIN_DIR, "pluginSettings");
+    return ADM_systemPluginSettings;
+}
+/**
+
+*/
+const char *ADM_getUserPluginSettingsDir(void)
+{
+    if(ADM_userPluginSettings) return ADM_userPluginSettings;
+    ADM_userPluginSettings=ADM_getHomeRelativePath("pluginSettings");
+    return ADM_userPluginSettings;
+}
+
+/*
+      Get the  directory where jobs are stored
+******************************************************/
+char *ADM_getJobDir(void)
+{
+	if (ADM_jobdir)
+		return ADM_jobdir;
+
+	ADM_jobdir = ADM_getHomeRelativePath("jobs");
+
+
+	if (!ADM_mkdir(ADM_jobdir))
+	{
+		printf("can't create custom directory (%s).\n", ADM_jobdir);
+		return NULL;
+	}
+
+	return ADM_jobdir;
+}
+
+static void AddSeparator(char *path)
+{
+	if (path && (strlen(path) < strlen(SEPARATOR) || strncmp(path + strlen(path) - strlen(SEPARATOR), SEPARATOR, strlen(SEPARATOR)) != 0))
+		strcat(path, SEPARATOR);
+}
+
+/**
+ * 	\fn ADM_getRelativePath
+ */
+static char *ADM_getRelativePath(const char *base0, const char *base1, const char *base2, const char *base3)
+{
+	char *result;
+	int length = strlen(base0) + 2;
+
+	if (base1)
+		length += strlen(base1) + 1;
+
+	if (base2)
+		length += strlen(base2) + 1;
+
+	if (base3)
+		length += strlen(base3) + 1;
+
+	result = (char *)new char[length];
+	strcpy(result, base0);
+	AddSeparator(result);
+
+	if (base1)
+	{
+		if (strlen(base1))
+		{
+			strcat(result, base1);
+			strcat(result, SEPARATOR);
+		}
+
+		if (base2)
+		{
+			if (strlen(base2))
+			{
+				strcat(result, base2);
+				strcat(result, SEPARATOR);
+			}
+
+			if (base3 && strlen(base3))
+			{
+				strcat(result, base3);				
+				strcat(result, SEPARATOR);
+			}
+		}
+	}
+
+	return result;
+}
+
+/**
+ * 	\fn char *ADM_getHomeRelativePath(const char *base1, const char *base2=NULL,const char *base3=NULL);
+ *  \brief Returns home directory +base 1 + base 2... The return value is a copy, and must be deleted []
+ */
+char *ADM_getHomeRelativePath(const char *base1, const char *base2, const char *base3)
+{
+	return ADM_getRelativePath(ADM_getBaseDir(), base1, base2, base3);
+}
+
+char *ADM_getInstallRelativePath(const char *base1, const char *base2, const char *base3)
+{
+#ifdef __WIN32
 	wchar_t wcModuleName[MAX_PATH];
 
 	GetModuleFileNameW(0, wcModuleName, sizeof(wcModuleName) / sizeof(wchar_t));
@@ -374,471 +374,471 @@
 	if (slash)
 		*slash = '\0';
 
-	return ADM_getRelativePath(moduleName, base1, base2, base3);
-#elif defined(__APPLE__)
-#define MAX_PATH_SIZE 1024
-
-	char buffer[MAX_PATH_SIZE];
-
-	CFURLRef url(CFBundleCopyExecutableURL(CFBundleGetMainBundle()));
-	buffer[0] = '\0';
-
-	if (url)
-	{
-		CFURLGetFileSystemRepresentation(url, true, (UInt8*)buffer, MAX_PATH_SIZE);
-		CFRelease(url);
-
-		char *slash = strrchr(buffer, '/');
-		
-		if (slash)
-			*slash = '\0';
-	}
-
-	return ADM_getRelativePath(buffer, base1, base2, base3);
-#else
-	return ADM_getRelativePath(ADM_INSTALL_DIR, base1, base2, base3);
-#endif
-}
-/*
-      Get the root directory for .avidemux stuff
-******************************************************/
-char *ADM_getBaseDir(void)
-{
-	char *home;
-
-	if (baseDirDone)
-		return ADM_basedir;
-
-	// Get the base directory
-#ifdef __WIN32
-    if (portable)
-    {
-        // Portable mode...
-        home = ADM_getInstallRelativePath(NULL, NULL, NULL);
-    }
-	else
-    {
-        wchar_t wcHome[MAX_PATH];
-
-        if (SHGetFolderPathW(NULL, CSIDL_APPDATA, NULL, 0, wcHome) == S_OK)
-        {
-            int len = wideCharStringToUtf8(wcHome, -1, NULL);
-            home = new char[len];
-
-            wideCharStringToUtf8(wcHome, -1, home);
-        }
-        else
-        {
-            printf("Oops: can't determine the Application Data folder.");
-            home = ADM_strdup("c:\\");
-        }
-    }
-#else
-	const char* homeEnv = getenv("HOME");
-
-	if (homeEnv)
-	{
-		home = new char[strlen(homeEnv) + 2];
-		strcpy(home, homeEnv);
-	}
-	else
-	{
-		printf("Oops: can't determine $HOME.");
-
-		return NULL;
-	}
-#endif
-
-	// Try to open the .avidemux directory
-
-	strcpy(ADM_basedir, home);
-	strcat(ADM_basedir, SEPARATOR);
-	strcat(ADM_basedir, ADM_DIR_NAME);
-	strcat(ADM_basedir, SEPARATOR);
-
-    delete [] home;
-    home=NULL;
-
-	if (!ADM_mkdir(ADM_basedir))
-	{
-		ADM_error("Oops: cannot create the .avidemux directoryi (%s)\n",ADM_basedir);
-		return NULL;
-	}
-
-	// Now built the filename
-	baseDirDone = 1;
-	printf("Using %s as base directory for prefs/jobs/...\n", ADM_basedir);
-	return ADM_basedir;
-}
-
-#ifdef __WIN32
-#define DIR _WDIR
-#define dirent _wdirent
-#define opendir _wopendir
-#define readdir _wreaddir
-#define closedir _wclosedir
-#endif
-
-/*----------------------------------------
-      Create a directory
-      If it already exists, do nothing
-------------------------------------------*/
-uint8_t ADM_mkdir(const char *dirname)
-{
-	DIR *dir = NULL;
-
-#ifdef __WIN32
-	int dirNameLength = utf8StringToWideChar(dirname, -1, NULL);
-	wchar_t dirname2[dirNameLength];
-
-	utf8StringToWideChar(dirname, -1, dirname2);
-#else
-	const char* dirname2 = dirname;
-#endif
-
-	// Check it already exists ?
-	dir = opendir(dirname2);
-
-	if (dir)
-	{ 
-		printf("Directory %s exists.Good.\n", dirname);
-		closedir(dir);
-		return 1;
-	}
-#ifdef __WIN32
-	if (_wmkdir(dirname2))
-	{
-		printf("Oops: mkdir failed on %s\n", dirname);
-		return 0;
-	}
-#else
-	printf("Creating dir :%s\n", dirname2);
-	mkdir(dirname2,0755);
-
-#endif
-
-	if ((dir = opendir(dirname2)) == NULL)
-		return 0;
-
-	closedir(dir);
-
-	return 1;
-}
-/**
- *  \fn buildDirectoryContent
- * 	\brief Returns the content of a dir with the extension ext. The receiving array must be allocated by caller
- * (just the array, not the names themselves)
- */
-uint8_t buildDirectoryContent(uint32_t *outnb, const char *base, char *jobName[], int maxElems, const char *ext)
-{
-	DIR *dir;
-	struct dirent *direntry;
-	int dirmax = 0, len;
-	int extlen = strlen(ext);
-
-	ADM_assert(extlen);
-
-#ifdef __WIN32
-	int dirNameLength = utf8StringToWideChar(base, -1, NULL);
-	wchar_t base2[dirNameLength];
-
-	utf8StringToWideChar(base, -1, base2);
-#else
-	const char *base2 = base;
-#endif
-
-	dir = opendir(base2);
-	if (!dir)
-		return 0;
-
-	while ((direntry = readdir(dir)))
-	{
-#ifdef __WIN32
-		int dirLength = wideCharStringToUtf8(direntry->d_name, -1, NULL);
-		char d_name[dirLength];
-
-		wideCharStringToUtf8(direntry->d_name, -1, d_name);
-#else
-		const char *d_name = direntry->d_name;
-#endif
-
-		len = strlen(d_name);
-
-		if (len < (extlen + 1))
-			continue;
-
-		int xbase = len - extlen;
-
-		if (memcmp(d_name + xbase, ext, extlen))
-		{
-			printf("ignored: %s\n", d_name);
-			continue;
-		}
-
-		jobName[dirmax] = (char *)ADM_alloc(strlen(base) + strlen(d_name) + 2);
-		strcpy(jobName[dirmax], base);
-		AddSeparator(jobName[dirmax]);
-		strcat(jobName[dirmax], d_name);
-		dirmax++;
-
-		if (dirmax >= maxElems)
-		{
-			printf("[jobs]: Max # of jobs exceeded\n");
-			break;
-		}
-	}
-
-	closedir(dir);
-	*outnb = dirmax;
-
-	return 1;
-}
-/**
-    \fn clearDirectoryContent
-*/
-uint8_t    clearDirectoryContent(const uint32_t nb, char *jobName[])
-{
-    for(int i=0;i<nb;i++)
-        if(jobName[i])
-        {
-            ADM_dealloc(jobName[i]);
-            jobName[i]=NULL;
-        }
-    return true;
-}
-//------------------------------------------------------------------
-
-/*
-
-** note: it modifies it's first argument
-*/
-void simplify_path(char **buf)
-{
-	unsigned int last1slash = 0;
-	unsigned int last2slash = 0;
-
-	while (!strncmp(*buf, "/../", 4))
-		memmove(*buf, *buf + 3, strlen(*buf + 3) + 1);
-
-	for (unsigned int i = 0; i < strlen(*buf) - 2; i++)
-		while (!strncmp(*buf + i, "/./", 3))
-			memmove(*buf + i, *buf + i + 2, strlen(*buf + i + 2) + 1);
-
-	for (unsigned int i = 0; i < strlen(*buf) - 3; i++)
-	{
-		if (*(*buf + i) == '/')
-		{
-			last2slash = last1slash;
-			last1slash = i;
-		}
-
-		if (!strncmp(*buf + i, "/../", 4))
-		{
-			memmove(*buf + last2slash, *buf + i + 3, strlen(*buf + i + 3) + 1);
-
-			return simplify_path(buf);
-		}
-	}
-}
-
-/**
-        \fn ADM_PathCanonize
-        \brief Canonize the path, returns a copy of the absolute path given as parameter
-*/
-char *ADM_PathCanonize(const char *tmpname)
-{
-	char path[300];
-	char *out;
-
-	if (!getcwd(path, 300))
-	{
-		fprintf(stderr, "\ngetcwd() failed with: %s (%u)\n", strerror(errno), errno);
-		path[0] = '\0';
-	}
-
-	if (!tmpname || tmpname[0] == 0)
-	{
-		out = new char[strlen(path) + 2];
-		strcpy(out, path);
-#ifndef __WIN32
-		strcat(out, "/");
-#else
-		strcat(out, "\\");
-#endif
-		printf("\n Canonizing null string ??? (%s)\n", out);
-	}
-	else if (tmpname[0] == '/'
-#if defined(__WIN32)
-		|| tmpname[1] == ':'
-#endif
-		)
-	{
-		out = new char[strlen(tmpname) + 1];
-		strcpy(out, tmpname);
-
-		return out;
-	}
-	else
-	{
-		out = new char[strlen(path) + strlen(tmpname) + 6];
-		strcpy(out, path);
-#ifndef __WIN32
-		strcat(out, "/");
-#else
-		strcat(out, "\\");
-#endif
-		strcat(out, tmpname);
-	}
-
-	simplify_path(&out);
-
-	return out;
-}
-
-/**
-        \fn ADM_PathStripName
-	\brief Returns path only /foo/bar.avi -> /foo INPLACE, no copy done
-
-*/
-void ADM_PathStripName(char *str)
-{
-	int len = strlen(str);
-
-	if (len <= 1)
-		return;
-
-	len--;
-
-#ifndef __WIN32
-	while (*(str + len) != '/' && len)
-#else
-	while (*(str + len) != '\\' && len)
-#endif
-	{
-		*(str + len) = 0;
-		len--;
-	}
-}
-
-/**
-    \fn ADM_GetFileName
-    \brief Get the filename without path. /foo/bar.avi -> bar.avi INPLACE, NO COPY
-
-*/
-const char *ADM_GetFileName(const char *str)
-{
-	const char *filename;
-	const char *filename2;
-
-#ifndef __WIN32
-	filename = strrchr(str, '/');
-#else
-	filename = strrchr(str, '\\');
-	filename2 = strrchr(str, '/');
-
-	if (filename2 && filename)
-		if (filename2 > filename)
-			filename = filename2;
-#endif
-
-	if (filename)
-		return filename + 1;
-	else
-		return str;
-}
-
-/**
-    \fn ADM_PathSplit
-    \brief Split path into absolute path+name and extention i.e. /foo/bar/zee.avi -> /foo/bar/zee,avi.             Copy are returned
-
-*/
-void ADM_PathSplit(const char *str, char **root, char **ext)
-{
-	char *full;
-	uint32_t l;
-
-	full = ADM_PathCanonize(str);
-	// Search the last
-	l = strlen(full);
-	l--;
-	ADM_assert(l > 0);
-
-	while (*(full + l) != '.' && l)
-		l--;
-
-	if (!l || l == (strlen(full) - 1))
-	{
-		if (l == (strlen(full) - 1))
-			*(full + l) = 0;  // remove trailing
-
-		*ext = new char[2];
-		*root = full;
-		strcpy(*ext, "");
-
-		return;
-	}
-	// else we do get an extension
-	// starting at l+1
-	uint32_t suff;
-
-	suff = strlen(full) - l - 1;
-	*ext = new char[suff + 1];
-	strcpy(*ext, full + l + 1);
-	*(full + l) = 0;
-	*root = full;
-}
-/**
-    \fn ADM_copyFile
-*/
-uint8_t ADM_copyFile(const char *source, const char *target)
-{
-    FILE *fin=ADM_fopen(source,"rb");
-    if(!fin)
-    {
-        ADM_error("Cannot open %s for reading\n",source);
-        return false;
-    }
-    FILE *fout=ADM_fopen(target,"wb");
-    if(!fout)
-    {
-        fclose(fin);
-        ADM_error("Cannot open %s for writting\n",target);
-        return false;
-    }
-    uint8_t buffer[1024];
-    while(!feof(fin))
-    {
-        int r=fread(buffer,1,1024,fin);
-        fwrite(buffer,1,r,fout);
-        if(r!=1024) break;
-    }
-
-    fclose(fin);
-    fclose(fout);
-    return true;
-}
-
-/**
-    \fn ADM_copyFile
-*/
-uint8_t ADM_renameFile(const char *source, const char *target)
-{
-#ifdef __MINGW32__
-	int sourceFileNameLength = utf8StringToWideChar(source, -1, NULL);
-    int targetFileNameLength = utf8StringToWideChar(target, -1, NULL);
-    wchar_t wcFileSource[sourceFileNameLength];
-    wchar_t wcFileTarget[targetFileNameLength];
-    
-    utf8StringToWideChar(source, -1, wcFileSource);
-    utf8StringToWideChar(target, -1, wcFileTarget);
-   
-    if(!_wrename(wcFileSource,wcFileTarget)) return true;
-    ADM_error("Failed to rename %s to %s\n",source,target);
-    return false;
-#else
-    if(!rename(source,target)) return true;
-    return false;
-#endif
-}
-
-// EOF
+	return ADM_getRelativePath(moduleName, base1, base2, base3);
+#elif defined(__APPLE__)
+#define MAX_PATH_SIZE 1024
+
+	char buffer[MAX_PATH_SIZE];
+
+	CFURLRef url(CFBundleCopyExecutableURL(CFBundleGetMainBundle()));
+	buffer[0] = '\0';
+
+	if (url)
+	{
+		CFURLGetFileSystemRepresentation(url, true, (UInt8*)buffer, MAX_PATH_SIZE);
+		CFRelease(url);
+
+		char *slash = strrchr(buffer, '/');
+		
+		if (slash)
+			*slash = '\0';
+	}
+
+	return ADM_getRelativePath(buffer, base1, base2, base3);
+#else
+	return ADM_getRelativePath(ADM_INSTALL_DIR, base1, base2, base3);
+#endif
+}
+/*
+      Get the root directory for .avidemux stuff
+******************************************************/
+char *ADM_getBaseDir(void)
+{
+	char *home;
+
+	if (baseDirDone)
+		return ADM_basedir;
+
+	// Get the base directory
+#ifdef __WIN32
+    if (portable)
+    {
+        // Portable mode...
+        home = ADM_getInstallRelativePath(NULL, NULL, NULL);
+    }
+	else
+    {
+        wchar_t wcHome[MAX_PATH];
+
+        if (SHGetFolderPathW(NULL, CSIDL_APPDATA, NULL, 0, wcHome) == S_OK)
+        {
+            int len = wideCharStringToUtf8(wcHome, -1, NULL);
+            home = new char[len];
+
+            wideCharStringToUtf8(wcHome, -1, home);
+        }
+        else
+        {
+            printf("Oops: can't determine the Application Data folder.");
+            home = ADM_strdup("c:\\");
+        }
+    }
+#else
+	const char* homeEnv = getenv("HOME");
+
+	if (homeEnv)
+	{
+		home = new char[strlen(homeEnv) + 2];
+		strcpy(home, homeEnv);
+	}
+	else
+	{
+		printf("Oops: can't determine $HOME.");
+
+		return NULL;
+	}
+#endif
+
+	// Try to open the .avidemux directory
+
+	strcpy(ADM_basedir, home);
+	AddSeparator(ADM_basedir);
+	strcat(ADM_basedir, ADM_DIR_NAME);
+	strcat(ADM_basedir, SEPARATOR);
+
+    delete [] home;
+    home=NULL;
+
+	if (!ADM_mkdir(ADM_basedir))
+	{
+		ADM_error("Oops: cannot create the .avidemux directoryi (%s)\n",ADM_basedir);
+		return NULL;
+	}
+
+	// Now built the filename
+	baseDirDone = 1;
+	printf("Using %s as base directory for prefs/jobs/...\n", ADM_basedir);
+	return ADM_basedir;
+}
+
+#ifdef __WIN32
+#define DIR _WDIR
+#define dirent _wdirent
+#define opendir _wopendir
+#define readdir _wreaddir
+#define closedir _wclosedir
+#endif
+
+/*----------------------------------------
+      Create a directory
+      If it already exists, do nothing
+------------------------------------------*/
+uint8_t ADM_mkdir(const char *dirname)
+{
+	DIR *dir = NULL;
+
+#ifdef __WIN32
+	int dirNameLength = utf8StringToWideChar(dirname, -1, NULL);
+	wchar_t dirname2[dirNameLength];
+
+	utf8StringToWideChar(dirname, -1, dirname2);
+#else
+	const char* dirname2 = dirname;
+#endif
+
+	// Check it already exists ?
+	dir = opendir(dirname2);
+
+	if (dir)
+	{ 
+		printf("Directory %s exists.Good.\n", dirname);
+		closedir(dir);
+		return 1;
+	}
+#ifdef __WIN32
+	if (_wmkdir(dirname2))
+	{
+		printf("Oops: mkdir failed on %s\n", dirname);
+		return 0;
+	}
+#else
+	printf("Creating dir :%s\n", dirname2);
+	mkdir(dirname2,0755);
+
+#endif
+
+	if ((dir = opendir(dirname2)) == NULL)
+		return 0;
+
+	closedir(dir);
+
+	return 1;
+}
+/**
+ *  \fn buildDirectoryContent
+ * 	\brief Returns the content of a dir with the extension ext. The receiving array must be allocated by caller
+ * (just the array, not the names themselves)
+ */
+uint8_t buildDirectoryContent(uint32_t *outnb, const char *base, char *jobName[], int maxElems, const char *ext)
+{
+	DIR *dir;
+	struct dirent *direntry;
+	int dirmax = 0, len;
+	int extlen = strlen(ext);
+
+	ADM_assert(extlen);
+
+#ifdef __WIN32
+	int dirNameLength = utf8StringToWideChar(base, -1, NULL);
+	wchar_t base2[dirNameLength];
+
+	utf8StringToWideChar(base, -1, base2);
+#else
+	const char *base2 = base;
+#endif
+
+	dir = opendir(base2);
+	if (!dir)
+		return 0;
+
+	while ((direntry = readdir(dir)))
+	{
+#ifdef __WIN32
+		int dirLength = wideCharStringToUtf8(direntry->d_name, -1, NULL);
+		char d_name[dirLength];
+
+		wideCharStringToUtf8(direntry->d_name, -1, d_name);
+#else
+		const char *d_name = direntry->d_name;
+#endif
+
+		len = strlen(d_name);
+
+		if (len < (extlen + 1))
+			continue;
+
+		int xbase = len - extlen;
+
+		if (memcmp(d_name + xbase, ext, extlen))
+		{
+			printf("ignored: %s\n", d_name);
+			continue;
+		}
+
+		jobName[dirmax] = (char *)ADM_alloc(strlen(base) + strlen(d_name) + 2);
+		strcpy(jobName[dirmax], base);
+		AddSeparator(jobName[dirmax]);
+		strcat(jobName[dirmax], d_name);
+		dirmax++;
+
+		if (dirmax >= maxElems)
+		{
+			printf("[jobs]: Max # of jobs exceeded\n");
+			break;
+		}
+	}
+
+	closedir(dir);
+	*outnb = dirmax;
+
+	return 1;
+}
+/**
+    \fn clearDirectoryContent
+*/
+uint8_t    clearDirectoryContent(const uint32_t nb, char *jobName[])
+{
+    for(int i=0;i<nb;i++)
+        if(jobName[i])
+        {
+            ADM_dealloc(jobName[i]);
+            jobName[i]=NULL;
+        }
+    return true;
+}
+//------------------------------------------------------------------
+
+/*
+
+** note: it modifies it's first argument
+*/
+void simplify_path(char **buf)
+{
+	unsigned int last1slash = 0;
+	unsigned int last2slash = 0;
+
+	while (!strncmp(*buf, "/../", 4))
+		memmove(*buf, *buf + 3, strlen(*buf + 3) + 1);
+
+	for (unsigned int i = 0; i < strlen(*buf) - 2; i++)
+		while (!strncmp(*buf + i, "/./", 3))
+			memmove(*buf + i, *buf + i + 2, strlen(*buf + i + 2) + 1);
+
+	for (unsigned int i = 0; i < strlen(*buf) - 3; i++)
+	{
+		if (*(*buf + i) == '/')
+		{
+			last2slash = last1slash;
+			last1slash = i;
+		}
+
+		if (!strncmp(*buf + i, "/../", 4))
+		{
+			memmove(*buf + last2slash, *buf + i + 3, strlen(*buf + i + 3) + 1);
+
+			return simplify_path(buf);
+		}
+	}
+}
+
+/**
+        \fn ADM_PathCanonize
+        \brief Canonize the path, returns a copy of the absolute path given as parameter
+*/
+char *ADM_PathCanonize(const char *tmpname)
+{
+	char path[300];
+	char *out;
+
+	if (!getcwd(path, 300))
+	{
+		fprintf(stderr, "\ngetcwd() failed with: %s (%u)\n", strerror(errno), errno);
+		path[0] = '\0';
+	}
+
+	if (!tmpname || tmpname[0] == 0)
+	{
+		out = new char[strlen(path) + 2];
+		strcpy(out, path);
+#ifndef __WIN32
+		strcat(out, "/");
+#else
+		strcat(out, "\\");
+#endif
+		printf("\n Canonizing null string ??? (%s)\n", out);
+	}
+	else if (tmpname[0] == '/'
+#if defined(__WIN32)
+		|| tmpname[1] == ':'
+#endif
+		)
+	{
+		out = new char[strlen(tmpname) + 1];
+		strcpy(out, tmpname);
+
+		return out;
+	}
+	else
+	{
+		out = new char[strlen(path) + strlen(tmpname) + 6];
+		strcpy(out, path);
+#ifndef __WIN32
+		strcat(out, "/");
+#else
+		strcat(out, "\\");
+#endif
+		strcat(out, tmpname);
+	}
+
+	simplify_path(&out);
+
+	return out;
+}
+
+/**
+        \fn ADM_PathStripName
+	\brief Returns path only /foo/bar.avi -> /foo INPLACE, no copy done
+
+*/
+void ADM_PathStripName(char *str)
+{
+	int len = strlen(str);
+
+	if (len <= 1)
+		return;
+
+	len--;
+
+#ifndef __WIN32
+	while (*(str + len) != '/' && len)
+#else
+	while (*(str + len) != '\\' && len)
+#endif
+	{
+		*(str + len) = 0;
+		len--;
+	}
+}
+
+/**
+    \fn ADM_GetFileName
+    \brief Get the filename without path. /foo/bar.avi -> bar.avi INPLACE, NO COPY
+
+*/
+const char *ADM_GetFileName(const char *str)
+{
+	const char *filename;
+	const char *filename2;
+
+#ifndef __WIN32
+	filename = strrchr(str, '/');
+#else
+	filename = strrchr(str, '\\');
+	filename2 = strrchr(str, '/');
+
+	if (filename2 && filename)
+		if (filename2 > filename)
+			filename = filename2;
+#endif
+
+	if (filename)
+		return filename + 1;
+	else
+		return str;
+}
+
+/**
+    \fn ADM_PathSplit
+    \brief Split path into absolute path+name and extention i.e. /foo/bar/zee.avi -> /foo/bar/zee,avi.             Copy are returned
+
+*/
+void ADM_PathSplit(const char *str, char **root, char **ext)
+{
+	char *full;
+	uint32_t l;
+
+	full = ADM_PathCanonize(str);
+	// Search the last
+	l = strlen(full);
+	l--;
+	ADM_assert(l > 0);
+
+	while (*(full + l) != '.' && l)
+		l--;
+
+	if (!l || l == (strlen(full) - 1))
+	{
+		if (l == (strlen(full) - 1))
+			*(full + l) = 0;  // remove trailing
+
+		*ext = new char[2];
+		*root = full;
+		strcpy(*ext, "");
+
+		return;
+	}
+	// else we do get an extension
+	// starting at l+1
+	uint32_t suff;
+
+	suff = strlen(full) - l - 1;
+	*ext = new char[suff + 1];
+	strcpy(*ext, full + l + 1);
+	*(full + l) = 0;
+	*root = full;
+}
+/**
+    \fn ADM_copyFile
+*/
+uint8_t ADM_copyFile(const char *source, const char *target)
+{
+    FILE *fin=ADM_fopen(source,"rb");
+    if(!fin)
+    {
+        ADM_error("Cannot open %s for reading\n",source);
+        return false;
+    }
+    FILE *fout=ADM_fopen(target,"wb");
+    if(!fout)
+    {
+        fclose(fin);
+        ADM_error("Cannot open %s for writting\n",target);
+        return false;
+    }
+    uint8_t buffer[1024];
+    while(!feof(fin))
+    {
+        int r=fread(buffer,1,1024,fin);
+        fwrite(buffer,1,r,fout);
+        if(r!=1024) break;
+    }
+
+    fclose(fin);
+    fclose(fout);
+    return true;
+}
+
+/**
+    \fn ADM_copyFile
+*/
+uint8_t ADM_renameFile(const char *source, const char *target)
+{
+#ifdef __MINGW32__
+	int sourceFileNameLength = utf8StringToWideChar(source, -1, NULL);
+    int targetFileNameLength = utf8StringToWideChar(target, -1, NULL);
+    wchar_t wcFileSource[sourceFileNameLength];
+    wchar_t wcFileTarget[targetFileNameLength];
+    
+    utf8StringToWideChar(source, -1, wcFileSource);
+    utf8StringToWideChar(target, -1, wcFileTarget);
+   
+    if(!_wrename(wcFileSource,wcFileTarget)) return true;
+    ADM_error("Failed to rename %s to %s\n",source,target);
+    return false;
+#else
+    if(!rename(source,target)) return true;
+    return false;
+#endif
+}
+
+// EOF



From mean at mail.berlios.de  Wed Sep 14 12:55:03 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 12:55:03 +0200
Subject: [Avidemux-svn-commit] r7539 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src
Message-ID: <20110914105503.CCA0E481301@sheep.berlios.de>

Author: mean
Date: 2011-09-14 12:55:03 +0200 (Wed, 14 Sep 2011)
New Revision: 7539

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
Log:
[core/tinypy] Revert BVector on pyClass, since they are a class BVector cannot handle them

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-14 09:42:50 UTC (rev 7538)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreTinyPy/src/ADM_tinypy.cpp	2011-09-14 10:55:03 UTC (rev 7539)
@@ -14,7 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "ADM_cpp.h"
-#include "BVector.h"
+#include "vector"
 #include "ADM_default.h"
 
 #include <stdarg.h>
@@ -38,7 +38,7 @@
                                 {"get_file_size",tinyPy_getFileSize},
                                 {NULL,NULL}
                         };
-static BVector <admPyClassDescriptor> listOfPyClass(20);; // warning exceeding it will cause a crash!
+static vector <admPyClassDescriptor> listOfPyClass; 
 
 extern void tp_hook_set_syslib(const char *sysLib);
 /**
@@ -195,7 +195,7 @@
     admPyClassDescriptor  classDesc;
     classDesc.className=string(className);
     classDesc.desc=string(desc);
-    listOfPyClass.append(classDesc);
+    listOfPyClass.push_back(classDesc);
     
     tp_set(INSTANCE, INSTANCE->builtins, tp_string(className), classPy(INSTANCE));
     return true;



From gruntster at mail.berlios.de  Wed Sep 14 13:36:29 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 13:36:29 +0200
Subject: [Avidemux-svn-commit] r7540 -
	branches/avidemux_2.6_branch_mean/avidemux/winInstaller
Message-ID: <20110914113629.503A048129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 13:36:28 +0200 (Wed, 14 Sep 2011)
New Revision: 7540

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
Log:
[mswin] remove MPlayer Denoise 3D HQ from installer since it's a dud plugin

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-14 10:55:03 UTC (rev 7539)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-14 11:36:28 UTC (rev 7540)
@@ -941,12 +941,6 @@
 				SetOutPath $INSTDIR\plugins\videoFilters
 				${File} plugins\videoFilters\libADM_vf_denoise3d.dll
 			${MementoSectionEnd}
-			${MementoSection} "MPlayer Denoise 3D HQ" SecVidFltMPlayerHqdn3d
-				SectionIn 1 2
-				SetOverwrite on
-				SetOutPath $INSTDIR\plugins\videoFilters
-				${File} plugins\videoFilters\libADM_vf_denoise3dhq.dll
-			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup "Sharpness Filters" SecGrpVideoFilterSharpness
 			${MementoSection} "Sharpen" SecVidFltSharpen



From gruntster at mail.berlios.de  Wed Sep 14 14:01:36 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 14:01:36 +0200
Subject: [Avidemux-svn-commit] r7541 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	common/ADM_commonUI qt4/ADM_userInterfaces
	qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110914120137.2F2B648129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 14:01:36 +0200 (Wed, 14 Sep 2011)
New Revision: 7541

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
Log:
[prefs] try to make video renderers sound a little more user friendly (toolkit is largely superfluous)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2011-09-14 11:36:28 UTC (rev 7540)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2011-09-14 12:01:36 UTC (rev 7541)
@@ -28,6 +28,7 @@
 #endif
 
 extern void 		AVDM_audioPref( void );
+extern const char* getNativeRendererDesc();
 
 
 
@@ -230,7 +231,7 @@
         diaElemToggle   togTagMp3(&balternate_mp3_tag,QT_TR_NOOP("_Use alternative tag for MP3 in .mp4"));
         
         diaMenuEntry videoMode[]={
-                             {RENDER_GTK,      QT_TR_NOOP("GTK+ (slow)"),NULL}
+                             {RENDER_GTK, getNativeRendererDesc(), NULL}
 #ifdef USE_XV
                              ,{RENDER_XV,   QT_TR_NOOP("XVideo (best)"),NULL}
 #endif
@@ -238,13 +239,13 @@
                              ,{RENDER_VDPAU,   QT_TR_NOOP("VDPAU (best)"),NULL}
 #endif
 #ifdef USE_OPENGL
-                             ,{RENDER_QTOPENGL,   QT_TR_NOOP("Qt OpenGl (best)"),NULL}
+                             ,{RENDER_QTOPENGL,   QT_TR_NOOP("OpenGL (best)"),NULL}
 #endif
 
 #ifdef USE_SDL
 #ifdef __WIN32
-                             ,{RENDER_SDL,      QT_TR_NOOP("SDL (GDI)"),NULL}
-							 ,{RENDER_DIRECTX,      QT_TR_NOOP("SDL (DirectX)"),NULL}
+                             ,{RENDER_SDL,      QT_TR_NOOP("MS Windows GDI (SDL)"),NULL}
+							 ,{RENDER_DIRECTX,      QT_TR_NOOP("MS Windows DirectX (SDL)"),NULL}
 #else
 							 ,{RENDER_SDL,      QT_TR_NOOP("SDL (good)"),NULL}
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2011-09-14 11:36:28 UTC (rev 7540)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2011-09-14 12:01:36 UTC (rev 7541)
@@ -87,27 +87,25 @@
 
 void ADM_Qvideo::paintEvent(QPaintEvent *ev)
 {
-	if(!displayW || !displayH || !rgbDataBuffer )
-		return ;
+	if (paintEngineType == -1)
 	{
+		QPainter painter(this);
 
-       if (paintEngineType == -1)
-       {
-               QPainter painter(this);
+		if (painter.isActive())
+			paintEngineType = painter.paintEngine()->type();
 
-               if (painter.isActive())
-                       paintEngineType = painter.paintEngine()->type();
+		painter.end();
+	}
 
-               painter.end();
-       }
+	if (!displayW || !displayH || !rgbDataBuffer )
+		return;
 
-        if(true==renderExposeEventFromUI())
-        {
-            QImage image(rgbDataBuffer,displayW,displayH,QImage::Format_RGB32);
-            QPainter painter(this);
-            painter.drawImage(QPoint(0,0),image);
-            painter.end();
-        }
+	if (renderExposeEventFromUI())
+	{
+		QImage image(rgbDataBuffer,displayW,displayH,QImage::Format_RGB32);
+		QPainter painter(this);
+		painter.drawImage(QPoint(0,0),image);
+		painter.end();
 	}
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-09-14 11:36:28 UTC (rev 7540)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-09-14 12:01:36 UTC (rev 7541)
@@ -150,21 +150,21 @@
 	switch (paintEngineType)
 	{
 		case QPaintEngine::X11:
-			return QT_TR_NOOP("Qt (X11)");
+			return QT_TR_NOOP("X11");
 		case QPaintEngine::Windows:
-			return QT_TR_NOOP("Qt (MS Windows GDI)");
+			return QT_TR_NOOP("MS Windows GDI");
 		case QPaintEngine::CoreGraphics:
-			return QT_TR_NOOP("Qt (Mac OS X Quartz 2D)");
+			return QT_TR_NOOP("Mac OS X Quartz 2D");
 		case QPaintEngine::QuickDraw:
-			return QT_TR_NOOP("Qt (Mac OS X QuickDraw)");
+			return QT_TR_NOOP("Mac OS X QuickDraw");
 		case QPaintEngine::OpenGL:
-			return QT_TR_NOOP("Qt (OpenGL)");
+			return QT_TR_NOOP("OpenGL");
 #if QT_VERSION >= 0x040400
 		case QPaintEngine::Direct3D:
-			return QT_TR_NOOP("Qt (MS Windows Direct3D)");
+			return QT_TR_NOOP("MS Windows Direct3D");
 #endif
 		case QPaintEngine::Raster:
-			return QT_TR_NOOP("Qt (Default Raster)");
+			return QT_TR_NOOP("Default Raster");
 	}
 
 	return "Qt";



From gruntster at mail.berlios.de  Wed Sep 14 14:18:07 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 14:18:07 +0200
Subject: [Avidemux-svn-commit] r7542 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	cli/ADM_userInterfaces gtk/ADM_userInterfaces
Message-ID: <20110914121808.31F7448129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 14:18:07 +0200 (Wed, 14 Sep 2011)
New Revision: 7542

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp
Log:
[prefs] add native renderer desc to CLI and GTK

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp	2011-09-14 12:01:36 UTC (rev 7541)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp	2011-09-14 12:18:07 UTC (rev 7542)
@@ -33,6 +33,11 @@
 	sprintf(desc, "CLI");
 }
 
+const char* getNativeRendererDesc(void)
+{
+	return "";
+}
+
 ADM_UI_TYPE UI_GetCurrentUI(void)
 {
   return ADM_UI_CLI;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp	2011-09-14 12:01:36 UTC (rev 7541)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp	2011-09-14 12:18:07 UTC (rev 7542)
@@ -49,6 +49,11 @@
   return ADM_UI_GTK;
 }
 
+const char* getNativeRendererDesc(void)
+{
+	return QT_TR_NOOP("GTK+");
+}
+
 void getMainWindowHandles(long int *handle,long int *nativeHandle)
 {
 	*handle = (long int)guiRootWindow;



From mean at mail.berlios.de  Wed Sep 14 14:54:40 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 14:54:40 +0200
Subject: [Avidemux-svn-commit] r7543 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110914125440.A98C548129A@sheep.berlios.de>

Author: mean
Date: 2011-09-14 14:54:40 +0200 (Wed, 14 Sep 2011)
New Revision: 7543

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp
Log:
[core/crashdump] fix compilation

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp	2011-09-14 12:18:07 UTC (rev 7542)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_crashdump_unix.cpp	2011-09-14 12:54:40 UTC (rev 7543)
@@ -38,6 +38,14 @@
         mysaveFunction=save;
         myFatalFunction=fatal;
 }
+void sig_segfault_handler(int signo);
+/**
+    \fn installSigHandler
+*/
+void installSigHandler()
+{
+    signal(11, sig_segfault_handler); // show stacktrace on default
+}
 
 /**
       \fn sig_segfault_handler
@@ -69,7 +77,7 @@
 	if(mysaveFunction)
 		mysaveFunction();
 
-#ifndef(__HAIKU__)
+#if !defined(__HAIKU__)
 	printf("\n*********** BACKTRACK **************\n");
 
 	count = backtrace(stack, 20);



From mean at mail.berlios.de  Wed Sep 14 17:42:17 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 17:42:17 +0200
Subject: [Avidemux-svn-commit] r7545 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
Message-ID: <20110914154217.C95F74812C3@sheep.berlios.de>

Author: mean
Date: 2011-09-14 17:42:17 +0200 (Wed, 14 Sep 2011)
New Revision: 7545

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
Log:
[gtk] Encoding window auto sized (patch by darkshadow)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2011-09-14 15:42:15 UTC (rev 7544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2011-09-14 15:42:17 UTC (rev 7545)
@@ -496,7 +496,7 @@
   GtkWidget *label67;
 
   dialog1 = gtk_window_new (GTK_WINDOW_TOPLEVEL);
-  gtk_widget_set_size_request (dialog1, 500, -1);
+  gtk_widget_set_size_request (dialog1, -1, -1);
   gtk_container_set_border_width (GTK_CONTAINER (dialog1), 12);
   gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("Encoding..."));
   gtk_window_set_position (GTK_WINDOW (dialog1), GTK_WIN_POS_CENTER_ON_PARENT);



From mean at mail.berlios.de  Wed Sep 14 17:42:18 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 17:42:18 +0200
Subject: [Avidemux-svn-commit] r7546 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
Message-ID: <20110914154219.0999F4812C3@sheep.berlios.de>

Author: mean
Date: 2011-09-14 17:42:18 +0200 (Wed, 14 Sep 2011)
New Revision: 7546

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp
Log:
[gtk] Job dialog window size (patch by darkshadow)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp	2011-09-14 15:42:17 UTC (rev 7545)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp	2011-09-14 15:42:18 UTC (rev 7546)
@@ -108,7 +108,7 @@
         //
          
         int running=1;
-        gtk_widget_set_usize(WID(treeview1), 180, 300);
+        //gtk_widget_set_usize(WID(treeview1), -1, -1);
         while(running)
         {
                 int sel=0,event;
@@ -260,6 +260,7 @@
   gtk_box_pack_start (GTK_BOX (dialog_vbox1), hbox1, TRUE, TRUE, 0);
 
   scrolledwindow1 = gtk_scrolled_window_new (NULL, NULL);
+  gtk_widget_set_size_request (dialog1, 500, 250);
   gtk_widget_show (scrolledwindow1);
   gtk_box_pack_start (GTK_BOX (hbox1), scrolledwindow1, TRUE, TRUE, 0);
   gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (scrolledwindow1), GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
@@ -268,7 +269,7 @@
   treeview1 = gtk_tree_view_new ();
   gtk_widget_show (treeview1);
   gtk_container_add (GTK_CONTAINER (scrolledwindow1), treeview1);
-  //gtk_widget_set_size_request (treeview1, 300, -1);
+  gtk_widget_set_size_request (treeview1, 500, 250);
 
   vbuttonbox1 = gtk_vbutton_box_new ();
   gtk_widget_show (vbuttonbox1);



From mean at mail.berlios.de  Wed Sep 14 17:42:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 17:42:20 +0200
Subject: [Avidemux-svn-commit] r7547 -
	branches/avidemux_2.5_branch_gruntster/po
Message-ID: <20110914154220.3B1DE4812C3@sheep.berlios.de>

Author: mean
Date: 2011-09-14 17:42:19 +0200 (Wed, 14 Sep 2011)
New Revision: 7547

Modified:
   branches/avidemux_2.5_branch_gruntster/po/de.po
Log:
[i18n] German translation (patch by darkshadow)

Modified: branches/avidemux_2.5_branch_gruntster/po/de.po
===================================================================
--- branches/avidemux_2.5_branch_gruntster/po/de.po	2011-09-14 15:42:18 UTC (rev 7546)
+++ branches/avidemux_2.5_branch_gruntster/po/de.po	2011-09-14 15:42:19 UTC (rev 7547)
@@ -4841,7 +4841,7 @@
 #: avidemux/gtk_gui.cpp:2077
 #, c-format
 msgid "Audio track %d (%s/%d channels/%d kbit per s/%d ms shift)"
-msgstr "Audio Stur %d (%s/%d Kan?le/%d kbit pro s/%d ms Verschiebung)"
+msgstr "Audio Spur %d (%s/%d Kan?le/%d kbit pro s/%d ms Verschiebung)"
 
 #: avidemux/gtk_gui.cpp:2083
 msgid "_Track from video:"



From gruntster at mail.berlios.de  Wed Sep 14 19:26:43 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 19:26:43 +0200
Subject: [Avidemux-svn-commit] r7548 - in
	branches/avidemux_2.6_branch_mean/avidemux: cli gtk qt4
	qt4/ADM_jobs/src winInstaller
Message-ID: <20110914172643.B653848122D@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 19:26:43 +0200 (Wed, 14 Sep 2011)
New Revision: 7548

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
Log:
[link] use friendly executable names for apple and mswin

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 15:42:19 UTC (rev 7547)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
@@ -88,6 +88,10 @@
 ###########################################
 # OS Specific
 ###########################################
+if (WIN32 OR APPLE)
+	set_property(TARGET avidemux3_cli PROPERTY OUTPUT_NAME avidemux_cli)
+endif (WIN32 OR APPLE)
+
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
 	target_link_libraries(avidemux3_cli winmm -mwindows -Wl,-subsystem,console -Wl,--export-all-symbols)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 15:42:19 UTC (rev 7547)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
@@ -101,6 +101,10 @@
 ###########################################
 # OS Specific
 ###########################################
+if (WIN32 OR APPLE)
+	set_property(TARGET avidemux3_gtk PROPERTY OUTPUT_NAME avidemux_gtk)
+endif (WIN32 OR APPLE)
+
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
 	target_link_libraries(avidemux3_gtk winmm -mwindows -Wl,--export-all-symbols)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-14 15:42:19 UTC (rev 7547)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
@@ -38,13 +38,11 @@
 ###########################################
 # OS Specific
 ###########################################
-IF (WIN32)
-#	target_link_libraries(avidemux3_jobs ADM_osSupport)
+if (WIN32 OR APPLE)
+	set_property(TARGET avidemux3_jobs PROPERTY OUTPUT_NAME avidemux_jobs)
+endif (WIN32 OR APPLE)
 
-	IF (MINGW)
-		target_link_libraries(avidemux3_jobs -mno-cygwin)
-	ENDIF (MINGW)
-
+IF (WIN32)
 	target_link_libraries(avidemux3_jobs winmm -mwindows)
 ENDIF (WIN32)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 15:42:19 UTC (rev 7547)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
@@ -129,6 +129,10 @@
 ###########################################
 # OS Specific
 ###########################################
+if (WIN32 OR APPLE)
+	set_property(TARGET avidemux3_qt4 PROPERTY OUTPUT_NAME avidemux)
+endif (WIN32 OR APPLE)
+
 IF (WIN32)
 	target_link_libraries(ADM_osSupport)
 	target_link_libraries(avidemux3_qt4 winmm -mwindows -Wl,--export-all-symbols)

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-14 15:42:19 UTC (rev 7547)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-14 17:26:43 UTC (rev 7548)
@@ -326,7 +326,7 @@
         SectionIn 2
         SetOutPath $INSTDIR
         SetOverwrite on
-        ${File} avidemux3_cli.exe
+        ${File} avidemux_cli.exe
         ${File} libADM_render6_cli.dll
         ${File} libADM_UI_Cli6.dll
     ${MementoSectionEnd}
@@ -349,7 +349,7 @@
         SetOutPath $INSTDIR\share\themes
         ${Folder} share\themes
         SetOutPath $INSTDIR
-        ${File} avidemux3_gtk.exe
+        ${File} avidemux_gtk.exe
         ${File} gtk2_prefs.exe
 		${File} intl.dll
         ${File} libADM_render_gtk.dll
@@ -382,8 +382,8 @@
 !endif
         SetOutPath $INSTDIR
         SetOverwrite on
-        ${File} avidemux3_qt4.exe
-		${File} avidemux3_jobs.exe
+        ${File} avidemux.exe
+		${File} avidemux_jobs.exe
         ${File} libADM_render6_qt4.dll
         ${File} libADM_UIQT46.dll
         ${File} QtCore4.dll
@@ -1416,7 +1416,7 @@
     IntOp $0 $0 & ${SF_SELECTED}
 
     StrCmp $0 ${SF_SELECTED} 0 GTK
-        Exec "$INSTDIR\avidemux3_qt4.exe"
+        Exec "$INSTDIR\avidemux_qt4.exe"
 
     Goto end
 GTK:
@@ -1427,7 +1427,7 @@
     IntOp $0 $0 & ${SF_SELECTED}
 
     StrCmp $0 ${SF_SELECTED} 0 End
-        Exec "$INSTDIR\avidemux3_gtk.exe"
+        Exec "$INSTDIR\avidemux_gtk.exe"
 !endif
 
 end:



From gruntster at mail.berlios.de  Wed Sep 14 20:01:57 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 20:01:57 +0200
Subject: [Avidemux-svn-commit] r7549 - in branches/avidemux_2.6_branch_mean:
	avidemux/qt4/ADM_userInterfaces/ADM_dialog
	avidemux/qt4/ADM_userInterfaces/ADM_filters
	avidemux/qt4/ADM_userInterfaces/ADM_gui
	avidemux/qt4/ADM_userInterfaces/ADM_ocr
	avidemux/qt4/ADM_userInterfaces/ADM_shell
	avidemux_plugins/ADM_videoEncoder/x264/qt4
	avidemux_plugins/ADM_videoFilters/ASharp/qt4
	avidemux_plugins/ADM_videoFilters/ChromaShift/qt4
	avidemux_plugins/ADM_videoFilters/Contrast/qt4
	avidemux_plugins/ADM_videoFilters/Eq2/qt4
	avidemux_plugins/ADM_videoFilters/Hue/qt4
	avidemux_plugins/ADM_videoFilters/Srt/qt4
	avidemux_plugins/ADM_videoFilters6/crop/qt4
	avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D cmake
Message-ID: <20110914180158.4011D48122D@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 20:01:57 +0200 (Wed, 14 Sep 2011)
New Revision: 7549

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake
Log:
[qt] r4390 & r4557

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,10 +18,11 @@
 #include "config.h"
 #include "Q_about.h"
 #include "ADM_inttype.h"
+#include "ADM_toolkitQt.h"
 
 extern uint8_t DIA_license(void);
 
-Ui_aboutWindow::Ui_aboutWindow()
+Ui_aboutWindow::Ui_aboutWindow(QWidget* parent) : QDialog(parent)
 {
 	Q_INIT_RESOURCE(about);
 
@@ -44,9 +45,12 @@
 
 uint8_t DIA_about(void)
 {
-	Ui_aboutWindow dialog;
+	Ui_aboutWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&dialog);
 
 	dialog.exec();
 
+	qtUnregisterDialog(&dialog);
+
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -10,7 +10,7 @@
 	Ui_aboutDialog ui;
 
 public:
-	Ui_aboutWindow();
+	Ui_aboutWindow(QWidget* parent);
 
 private slots:
 	void licenseButton_clicked(bool);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -24,8 +24,9 @@
 #include "audioeng_buildfilters.h"
 #include "ADM_video/ADM_vidMisc.h"
 #include "ADM_encoder/adm_encConfig.h"
+#include "ADM_toolkitQt.h"
 
-calculatorDialog::calculatorDialog()
+calculatorDialog::calculatorDialog(QWidget* parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -249,11 +250,14 @@
 	if (!avifileinfo)
 		return;
 
-	calculatorDialog dialog;
+	calculatorDialog dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&dialog);
 
 	if (dialog.exec() == QDialog::Accepted)
 		videoCodecSetFinalSize(dialog.videoSize());
 
+	qtUnregisterDialog(&dialog);
+
 	*sizeInMeg = dialog.videoSize();
 	*avgBitrate = dialog.videoBitrate();
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,7 +16,7 @@
 	unsigned int getPictureSize(void);
 
 public:
-	calculatorDialog();
+	calculatorDialog(QWidget* parent);
 	~calculatorDialog();
 
 	unsigned int videoSize(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,11 +21,13 @@
 #include "DIA_coreToolkit.h"
 #include "avidemutils.h"
 #include "ADM_vidMisc.h"
+#include "ADM_toolkitQt.h"
 
 extern void UI_purge(void);
 static int stopReq=0;
 extern bool ADM_slaveReportProgress(uint32_t percent);
-encodingWindow::encodingWindow() : QDialog()
+
+encodingWindow::encodingWindow(QWidget *parent) : QDialog(parent, Qt::WindowTitleHint | Qt::WindowSystemMenuHint | Qt::WindowMinimizeButtonHint)
  {
 	ui.setupUi(this);
 
@@ -109,7 +111,8 @@
 {
         WINDOW=NULL;
         stopReq=0;
-        WINDOW=(void *)new encodingWindow();
+        WINDOW=(void *)new encodingWindow(qtLastRegisteredDialog());
+		qtRegisterDialog(window);
         window->setModal(TRUE);
         window->show();
 
@@ -132,6 +135,7 @@
 {
 	bool shutdownRequired = (window->ui.checkBoxShutdown->checkState() == Qt::Checked);
     encodingWindow *w=window;
+	qtUnregisterDialog(w);
 	if(w) delete w;
 	WINDOW=NULL;
 #if 0

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -30,7 +30,7 @@
      Q_OBJECT
 
  public:
-     encodingWindow();
+     encodingWindow(QWidget *parent);
      Ui_encodingDialog ui;
 
  public slots:

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,8 +16,9 @@
  ***************************************************************************/
 #include "ADM_inttype.h"
 #include "Q_license.h"
+#include "ADM_toolkitQt.h"
 
-Ui_licenseWindow::Ui_licenseWindow()
+Ui_licenseWindow::Ui_licenseWindow(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -697,9 +698,11 @@
 
 uint8_t DIA_license(void)
 {
-	Ui_licenseWindow dialog;
+	Ui_licenseWindow dialog(qtLastRegisteredDialog());
 
+	qtRegisterDialog(&dialog);
 	dialog.exec();
+	qtUnregisterDialog(&dialog);
 
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -11,7 +11,7 @@
 	Ui_licenseDialog ui;
 
 public:
-	Ui_licenseWindow();
+	Ui_licenseWindow(QWidget *parent);
 };
 
 #endif	// Q_license_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,11 +18,12 @@
 #include "avi_vars.h"
 #include "avidemutils.h"
 #include "ADM_vidMisc.h"
+#include "ADM_toolkitQt.h"
 
 static const char *yesno[2]={QT_TR_NOOP("No"),QT_TR_NOOP("Yes")};
 extern const char *getStrFromAudioCodec( uint32_t codec);
 
-propWindow::propWindow() : QDialog()
+propWindow::propWindow(QWidget *parent) : QDialog(parent)
  {
      ui.setupUi(this);
      uint8_t gmc, qpel,vop;
@@ -109,15 +110,16 @@
 */
 void DIA_properties( void )
 {
+	if (playing)
+		return;
 
-      if (playing)
-        return;
-      if (!avifileinfo)
-        return;
-     // Fetch info
-     propWindow *propwindow=new propWindow ;
-     propwindow->exec();
-     delete propwindow;
+	if (!avifileinfo)
+		return;
+
+	propWindow propwindow(qtLastRegisteredDialog());
+	qtRegisterDialog(&propwindow);
+	propwindow.exec();
+	qtUnregisterDialog(&propwindow);
 }  
 //********************************************
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -3,12 +3,12 @@
 
 #include "ui_props.h"
 
-class propWindow : public QDialog
-{
-	Q_OBJECT
-
-public:
-	propWindow();
-	Ui_propsDialog ui;
-};
-#endif	// Q_props_h
+class propWindow : public QDialog
+{
+	Q_OBJECT
+
+public:
+	propWindow(QWidget *parent);
+	Ui_propsDialog ui;
+};
+#endif	// Q_props_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,12 +18,13 @@
 
 #include "Q_vobsub.h"
 #include "DIA_fileSel.h"
+#include "ADM_toolkitQt.h"
 #if 0
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_vobsubWindow::Ui_vobsubWindow(vobSubParam *parm)
+  Ui_vobsubWindow::Ui_vobsubWindow(QWidget *parent, vobSubParam *parm) : QDialog(parent)
   {
     uint32_t width,height;
     	this->param=parm;
@@ -99,14 +100,20 @@
 */
 uint8_t DIA_vobsub(vobSubParam *param)
 {
-        uint8_t ret=0;
-        Ui_vobsubWindow dialog(param);        
-        if(dialog.exec()==QDialog::Accepted)
-        {
-        	dialog.gather();
-            ret=1;
-        }
-        return ret;
+	uint8_t ret=0;
+	Ui_vobsubWindow dialog(param);
+
+	qtRegisterDialog(&dialog);
+
+	if(dialog.exec()==QDialog::Accepted)
+	{
+		dialog.gather();
+		ret=1;
+	}
+
+	qtUnregisterDialog(&dialog);
+
+	return ret;
 }
 //____________________________________
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,7 +16,7 @@
 	void fillLanguage(const char *file);
 
 public:
-	Ui_vobsubWindow(vobSubParam *param);
+	Ui_vobsubWindow(QWidget *parent, vobSubParam *param);
 	~Ui_vobsubWindow();
 	Ui_vobSubDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,14 +17,15 @@
 #include "ADM_default.h"
 #include "ADM_vidMisc.h"
 #include "DIA_working.h"
+#include "ADM_toolkitQt.h"
 
 extern void UI_purge(void);
 
-workWindow::workWindow()     : QDialog()
+workWindow::workWindow(QWidget *parent) : QDialog(parent)
  {
      ui.setupUi(this);
      active=true;
-     setWindowModality (Qt::ApplicationModal);
+     setWindowModality(Qt::ApplicationModal);
      connect( ui.buttonCancel,SIGNAL(clicked(bool)),this,SLOT(stop(bool)));
  }
  void workWindow::stop(bool a) 
@@ -54,16 +55,15 @@
 };
 //********************************************************
 
-DIA_workingQt4::DIA_workingQt4( const char *title ) : DIA_workingBase(title)
+DIA_workingQt4::DIA_workingQt4(const char *title) : DIA_workingBase(title)
 {
-  workWindow *wind;
-  wind=new workWindow();
-  _priv=(void *)wind;
-  wind->setWindowTitle(title);
-  postCtor();
+	workWindow *wind = new workWindow(qtLastRegisteredDialog());
+	qtRegisterDialog(wind);
+    _priv=(void *)wind;
+	wind->setWindowTitle(title);
+	postCtor();  
+}
 
-  
-}
 void DIA_workingQt4 :: postCtor( void )
 {
   workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
@@ -140,14 +140,21 @@
     closeDialog();
 }
 
-void DIA_workingQt4::closeDialog( void )
+void DIA_workingQt4::closeDialog(void)
 {
-  workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
-    if(wind) delete wind;
-    wind=NULL;
-    _priv=NULL;
-   
+	workWindow *wind = (workWindow*)_priv;
+	ADM_assert(wind);
+
+	if (wind)
+	{
+		qtUnregisterDialog(wind);
+		delete wind;
+	}
+
+	wind = NULL;
+	_priv = NULL;
 }
+
 /**
     \fn createWorking
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -7,11 +7,11 @@
 {
 	Q_OBJECT
     
-public:
+public:
     bool active;
-	workWindow();
-	Ui_workingDialog ui;
-public slots:
+	workWindow(QWidget *parent);
+	Ui_workingDialog ui;
+public slots:
     void stop(bool a);
 };
 #endif	// Q_working_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,11 +21,9 @@
 
 #include "T_index_pg.h"
 #include "ADM_default.h"
-//#include "ADM_videoFilter.h"
-//#include "ADM_encoderConf.h"
-//#include "ADM_encoder/adm_encoder.h"
 #include "DIA_idx_pg.h"
 #include "ADM_vidMisc.h"
+#include "ADM_toolkitQt.h"
 
 extern void UI_purge( void );
 
@@ -94,7 +92,8 @@
 
 DIA_progressIndexing::DIA_progressIndexing(const char *name)
 {
-        dialog=new Ui_indexingDialog(name);
+        dialog=new Ui_indexingDialog(qtLastRegisteredDialog(), name);
+		qtRegisterDialog(dialog);
         clock.reset();
         aborted=0;
 	_nextUpdate=0;
@@ -105,6 +104,7 @@
 DIA_progressIndexing::~DIA_progressIndexing()
 {
         ADM_assert(dialog);
+		qtUnregisterDialog(dialog);
         delete dialog;
         dialog=NULL;
 }
@@ -162,7 +162,7 @@
         return 1;
 }
 //****************************** CLASS ***********************
-Ui_indexingDialog::Ui_indexingDialog(const char *name)
+Ui_indexingDialog::Ui_indexingDialog(QWidget *parent, const char *name) : QDialog(parent)
 {
       abted=0;
       ui.setupUi(this);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -34,7 +34,7 @@
 public:
 	int abted;
 	Ui_iDialog ui;
-	Ui_indexingDialog(const char *name);
+	Ui_indexingDialog(QWidget *parent, const char *name);
 	~Ui_indexingDialog();
 	void setTime(const char *f);
 	void setImage(const char *f);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,228 +21,217 @@
 #include "DIA_coreUI_internal.h"
 #include "ADM_default.h"
 #include "prefs.h"
+#include "ADM_toolkitQt.h"
 
 static int beQuiet=0;
-extern QWidget *QuiMainWindows;
+
 namespace ADM_Qt4CoreUIToolkit
 {
-//****************************************************************************************************
-void            GUI_Alert(const char *alertstring)
-{
-    QMessageBox::StandardButton reply;
-              reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Alert")),
-                                        QString::fromUtf8(alertstring),
-                                        QMessageBox::Ok );
-}
-//****************************************************************************************************
-void            GUI_Info(const char *alertstring)
-{
-    QMessageBox::StandardButton reply;
-              reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Info")),
-                                        QString::fromUtf8(alertstring),
-                                        QMessageBox::Ok );
-}
+	void GUI_Alert(const char *alertstring)
+	{
+		QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Alert")),
+			QString::fromUtf8(alertstring), QMessageBox::Ok );
+	}
 
-//****************************************************************************************************
-void            GUI_Info_HIG(const ADM_LOG_LEVEL level,const char *primary, const char *secondary_format)
-{
-  uint32_t msglvl=2;
-  char alertstring[1024];
+	void GUI_Info(const char *alertstring)
+	{
+		QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Info")),
+			QString::fromUtf8(alertstring), QMessageBox::Ok );
+	}
 
-        prefs->get(MESSAGE_LEVEL,&msglvl);
+	void GUI_Info_HIG(const ADM_LOG_LEVEL level,const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
 
-        if(msglvl<level)
-        {
-                printf("Info : %s \n",primary);
-                return;
-        }
+		prefs->get(MESSAGE_LEVEL,&msglvl);
 
-        if(! secondary_format)
-        {
-            snprintf(alertstring,1024,"<big><b>%s</b></big>",primary);
-         }else
-         {
-        	 snprintf(alertstring,1024,"<big><b>%s</b></big><br><br>%s",primary,secondary_format);
-         }
-        QString info=QString::fromUtf8(alertstring);
-        QString info2=info.replace("\n","<br>");
-        QMessageBox::StandardButton reply;
-        reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Info")),
-                                    info,
-                                    QMessageBox::Ok );
+		if(msglvl<level)
+		{
+			printf("Info : %s \n",primary);
+			return;
+		}
 
-}
-//****************************************************************************************************
-void            GUI_Error_HIG(const char *primary, const char *secondary_format)
-{
-  uint32_t msglvl=2;
-  char alertstring[1024];
-  
-  
-        prefs->get(MESSAGE_LEVEL,&msglvl);
+		if(! secondary_format)
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big>";
+		else
+		{
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big><br><br>" + QString::fromUtf8(secondary_format);
+			alertString.replace("\n", "<br>");
+		}
 
-        if(msglvl==ADM_LOG_NONE) 
-        {
-                printf("Error :%s\n",primary);
-                return;
-        }
+		QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Info")),
+			alertString, QMessageBox::Ok);
+	}
 
-        if(! secondary_format)
-        {
-            snprintf(alertstring,1024,"<big><b>%s</b></big>",primary);
-         }else
-         {
-        	 snprintf(alertstring,1024,"<big><b>%s</b></big><br><br>%s",primary,secondary_format);
-         }
-          QMessageBox::StandardButton reply;
-          QString info=QString::fromUtf8(alertstring);
-          QString info2=info.replace("\n","<br>");
-          reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Info")),
-                                    info2,
-                                    QMessageBox::Ok );
-}
-//****************************************************************************************************
-int             GUI_Confirmation_HIG(const char *button_confirm, const char *primary, const char *secondary_format)
-{
-uint32_t msglvl=2;
-char alertstring[1024];
+	void GUI_Error_HIG(const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
 
-        if (beQuiet)
-              {
-                      printf("Info: %s\n", primary);
-                      return 0;
-              }
-        
-        if (!secondary_format)
-        {
-              snprintf(alertstring,1024,"<big><b>%s</b></big>",primary);
-        }
-        else
-        {	
-        	snprintf(alertstring,1024,"<big><b>%s</b></big><br><br>%s",primary,secondary_format);
-        }
-          QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Confirmation")),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-        return 0; 
-}
-//****************************************************************************************************
-int             GUI_YesNo(const char *primary, const char *secondary_format)
-{
-uint32_t msglvl=2;
-char alertstring[1024];
-        if (beQuiet)
-              {
-                      printf("Info: %s\n", primary);
-                      return 0;
-              }
-        
-        if (!secondary_format)
-        {
-              snprintf(alertstring,1024,"<big><b>%s</b></big>",primary);
-        }
-        else
-        {	
-        	snprintf(alertstring,1024,"<big><b>%s</b></big><br><br>%s",primary,secondary_format);
-        }
-          QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Confirmation")),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-        return 0; 
-}
-//****************************************************************************************************
-int             GUI_Question(const char *alertstring)
-{
- QMessageBox::StandardButton reply;
-          if (beQuiet)
-              {
-                      printf("Question: %s\n", alertstring);
-                      return 0;
-              }
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP("Question")),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-          return 0;
-}
-/**
-    \fn GUI_Alternate(char *title,char *choice1,char *choice2)
-    \brief Popup a dialog box name title with 2 buttons (choice1/choice2)
-    \return 0 if first is selected, 1 if second
-*/
+		prefs->get(MESSAGE_LEVEL,&msglvl);
+
+		if(msglvl==ADM_LOG_NONE) 
+		{
+			printf("Error :%s\n",primary);
+			return;
+		}
+
+		if(! secondary_format)
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big>";
+		else
+		{
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big><br><br>" + QString::fromUtf8(secondary_format);
+			alertString.replace("\n", "<br>");
+		}
+
+		QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Info")),
+			alertString, QMessageBox::Ok);
+	}
+
+	int GUI_Confirmation_HIG(const char *button_confirm, const char *primary, const char *secondary_format)
+	{
+		QString alertString;
+
+		if (beQuiet)
+		{
+			printf("Info: %s\n", primary);
+			return 0;
+		}
+
+		if (!secondary_format)
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big>";
+		else
+		{	
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big><br><br>" + QString::fromUtf8(secondary_format);
+			alertString.replace("\n", "<br>");
+		}
+
+		QMessageBox::StandardButton reply;
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Confirmation")),
+			alertString, QMessageBox::Yes | QMessageBox::No);
+
+		if (reply == QMessageBox::Yes)
+			return 1;
+
+		return 0; 
+	}
+
+	int GUI_YesNo(const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
+
+		if (beQuiet)
+		{
+			printf("Info: %s\n", primary);
+			return 0;
+		}
+
+		if (!secondary_format)
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big>";
+		else
+		{	
+			alertString = "<big><b>" + QString::fromUtf8(primary) + "</b></big><br><br>" + QString::fromUtf8(secondary_format);
+			alertString.replace("\n", "<br>");
+		}
+
+		QMessageBox::StandardButton reply;
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Confirmation")),
+			alertString, QMessageBox::Yes | QMessageBox::No );
+
+		if (reply == QMessageBox::Yes)
+			return 1;
+
+		return 0; 
+	}
+
+	int GUI_Question(const char *alertstring)
+	{
+		QMessageBox::StandardButton reply;
+
+		if (beQuiet)
+		{
+			printf("Question: %s\n", alertstring);
+			return 0;
+		}
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP("Question")),
+			QString::fromUtf8(alertstring), QMessageBox::Yes | QMessageBox::No);
+
+		if (reply==QMessageBox::Yes)
+			return 1;
+
+		return 0;
+	}
+	/**
+	\fn GUI_Alternate(char *title,char *choice1,char *choice2)
+	\brief Popup a dialog box name title with 2 buttons (choice1/choice2)
+	\return 0 if first is selected, 1 if second
+	*/
 int      GUI_Alternate(const char *title,const char *choice1,const char *choice2)
-{
-int reply;
-QMessageBox *box;
-    if (beQuiet)
-              {
-                      printf("Alternate<%s>: %s or %s\n", title,choice1,choice2);
-                      return 0;
-              }
+	{
+		if (beQuiet)
+		{
+			printf("Alternate<%s>: %s or %s\n", title,choice1,choice2);
+			return 0;
+		}
 
-char alertstring[1024];
+		QMessageBox box(qtLastRegisteredDialog());
 
-        box=new QMessageBox(QuiMainWindows);
-        box->setWindowTitle(QString::fromUtf8(QT_TR_NOOP("Question ?")));
-        box->addButton(choice1,QMessageBox::YesRole);
-        box->addButton(choice2,QMessageBox::NoRole);
-         if (title)
-        {
-              snprintf(alertstring,1024,"%s",title);
-        }else
-        {
-            snprintf(alertstring,1024,QT_TR_NOOP("Question"));
-        }
-        box->setText(QString::fromUtf8(alertstring));
-        box->setIcon(QMessageBox::Question);
-        reply = box->exec();
-        delete box;
-        printf("Reply:%d\n",reply);
-        if(reply==0) return 1;
-        return 0;
+		box.setWindowTitle(QString::fromUtf8(QT_TR_NOOP("Question?")));
+		box.addButton(QString::fromUtf8(choice1),QMessageBox::YesRole);
+		box.addButton(QString::fromUtf8(choice2),QMessageBox::NoRole);
 
-}
-//****************************************************************************************************
-uint8_t  GUI_getDoubleValue(double *valye, float min, float max, const char *title)
-{
-  
-  
-  return 0; 
-}
-//****************************************************************************************************
-uint8_t		GUI_isQuiet(void)
-{
-    return beQuiet;
-}
-//****************************************************************************************************
-void            GUI_Verbose(void)
-{
-    beQuiet=0;
-}
-//****************************************************************************************************
-void            GUI_Quiet(void)
-{
-  beQuiet=1;
-}
-//****************************************************************************************************
-extern DIA_workingBase *createWorking(const char *title);
-extern DIA_encodingBase *createEncoding(uint64_t duration);
+		if (title)
+			box.setText(QString::fromUtf8(title));
+		else
+			box.setText(QObject::tr("Question"));
 
-void getVersion(uint32_t *maj,uint32_t *minor)
-{
-    *maj=ADM_CORE_TOOLKIT_MAJOR;
-    *minor=ADM_CORE_TOOLKIT_MINOR;
-}
+		box.setIcon(QMessageBox::Question);
 
-void UI_purge( void )
-{
-	QCoreApplication::processEvents ();
+		if (box.exec() == 0)
+			return 1;
+		else
+			return 0;
+	}
+
+	uint8_t  GUI_getDoubleValue(double *valye, float min, float max, const char *title)
+	{
+		return 0; 
+	}
+
+	uint8_t	GUI_isQuiet(void)
+	{
+		return beQuiet;
+	}
+
+	void GUI_Verbose(void)
+	{
+		beQuiet=0;
+	}
+
+	void GUI_Quiet(void)
+	{
+		beQuiet=1;
+	}
+
+	extern DIA_workingBase *createWorking(const char *title);
+	extern DIA_encodingBase *createEncoding(uint64_t duration);
+
+	void getVersion(uint32_t *maj,uint32_t *minor)
+	{
+		*maj=ADM_CORE_TOOLKIT_MAJOR;
+		*minor=ADM_CORE_TOOLKIT_MINOR;
+	}
+
+	void UI_purge( void )
+	{
+		QCoreApplication::processEvents ();
+	}
 }
-}
 
 static CoreToolkitDescriptor Qt4CoreToolkitDescriptor=
 {
@@ -264,6 +253,5 @@
 void InitCoreToolkit(void )
 {
 	DIA_toolkitInit(&Qt4CoreToolkitDescriptor);
-	
 }
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -39,6 +39,7 @@
 #include "ADM_filterCategory.h"
 #include "ADM_videoFilterApi.h"
 #include "ADM_videoFilters.h"
+#include "ADM_toolkitQt.h"
 
 #include "prefs.h"
 
@@ -480,7 +481,7 @@
 }
   /**
   */
-filtermainWindow::filtermainWindow()     : QDialog()
+filtermainWindow::filtermainWindow(QWidget* parent) : QDialog(parent)
  {
         
     ui.setupUi(this);
@@ -561,10 +562,13 @@
 */
 int GUI_handleVFilter(void)
 {
-        filtermainWindow dialog;
-        if(QDialog::Accepted==dialog.exec())
-        {
-        }
+	filtermainWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&dialog);
+
+	dialog.exec();
+
+	qtUnregisterDialog(&dialog);
+
 	return 0;
 }
 /** 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -33,7 +33,7 @@
 	Q_OBJECT
 
 public:
-	filtermainWindow();
+	filtermainWindow(QWidget* parent);
     ~filtermainWindow();
 	void buildActiveFilterList(void);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,1251 +1,1253 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "ADM_cpp.h"
-#include "config.h"
-
-#include "ADM_inttype.h"
-#include <QtCore/QFileInfo>
-#include <QtCore/QUrl>
-#include <QtGui/QKeyEvent>
-#include <QtGui/QGraphicsView>
-
-#define MENU_DECLARE
-#include "Q_gui2.h"
-#include "ADM_default.h"
-
-#include "DIA_fileSel.h"
-#include "ADM_vidMisc.h"
-#include "prefs.h"
-#include "avi_vars.h"
-
-#include "ADM_render/GUI_renderInternal.h"
-#include "ADM_coreVideoEncoderInternal.h"
-#include "ADM_muxerProto.h"
-#include "T_vumeter.h"
-#include "DIA_coreToolkit.h"
-
-#ifdef USE_OPENGL
-extern bool ADM_glHasActiveTexture(void);
-void UI_Qt4InitGl(void);
-void UI_Qt4CleanGl(void);
-#endif
-
-extern int global_argc;
-extern char **global_argv;
-
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
-extern int automation(void );
-extern void HandleAction(Action a);
-extern int encoderGetEncoderCount (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-uint32_t audioEncoderGetNumberOfEncoders(void);
-const char  *audioEncoderGetDisplayName(uint32_t i);
-extern void checkCrashFile(void);
-extern void UI_QT4VideoWidget(QFrame *frame);
-extern void loadTranslator(void);
-extern void initTranslator(void);
-extern void destroyTranslator(void);
-extern ADM_RENDER_TYPE UI_getPreferredRender(void);
-extern int A_openAvi(const char *name);
-extern int A_appendAvi(const char *name);
-extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
-
-
-int SliderIsShifted=0;
-static void setupMenus(void);
-static int shiftKeyHeld=0;
-static ADM_QSlider *slider=NULL;
-static int _upd_in_progres=0;
-static int currentFps = 0;
-static int frameCount = 0;
-static int currentFrame = 0;
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
-uint32_t ADM_ve6_getNbEncoders(void);
-void UI_refreshCustomMenu(void);
-QWidget *QuiMainWindows=NULL;
-QWidget *VuMeter=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-extern void saveCrashProject(void);
-extern uint8_t AVDM_setVolume(int volume);
-extern bool ADM_QPreviewCleanup(void);
-
-
-
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
-
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-
-#include "translation_table.h"   
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct 
-{
-	const char *name;
-	Action     action; 
-}adm_qt4_translation;
-
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-	LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
-void UI_updateFrameCount(uint32_t curFrame);
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-extern void UI_purge(void);
-/*
-    Declare the class that will be our main window
-
-*/
-
-void MainWindow::comboChanged(int z)
-{
-	const char *source=qPrintable(sender()->objectName());
-
-	if(!strcmp(source,"comboBoxVideo"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxVideo->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonVideoConf->setEnabled(b);
-		ui.pushButtonVideoFilter->setEnabled(b);
-		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
-	}
-	else if(!strcmp(source,"comboBoxAudio"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxAudio->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonAudioConf->setEnabled(b);
-		ui.pushButtonAudioFilter->setEnabled(b);
-		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
-	}
-	else
-		printf("From +: %s\n",source);
-}
-
-void MainWindow::sliderValueChanged(int u) 
-{
-	if(!_upd_in_progres)
-		HandleAction(ACT_Scale);
-}
-
-void MainWindow::sliderMoved(int value)
-{
-	SliderIsShifted = shiftKeyHeld;
-}
-
-void MainWindow::sliderReleased(void)
-{
-	SliderIsShifted = 0;
-}
-
-void MainWindow::thumbSlider_valueEmitted(int value)
-{
-        if (value > 0)
-                nextIntraFrame();
-        else
-                previousIntraFrame();
-}
-
-void MainWindow::volumeChange( int u )
-{
-	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
-		return;
-
-	_upd_in_progres++;
-
-	int vol = ui.horizontalSlider_2->value();
-
-	AVDM_setVolume(vol);
-	_upd_in_progres--;
-}
-
-void MainWindow::audioToggled(bool checked)
-{
-	if (checked)
-		AVDM_setVolume(ui.horizontalSlider_2->value());
-	else
-		AVDM_setVolume(0);
-}
-
-void MainWindow::previewModeChanged(QAction *action)
-{
-	HandleAction(ACT_PreviewChanged);
-}
-
-void MainWindow::timeChangeFinished(void)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentFrameChanged(void)
-{
-//	HandleAction(ACT_JumpToFrame);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentTimeChanged(void)
-{
-	HandleAction(ACT_GotoTime);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-/**
-    \fn ctor
-*/
-MainWindow::MainWindow() : QMainWindow()
-{
-	ui.setupUi(this);
-
-#if defined(__APPLE__) && defined(USE_SDL)
-	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
-	ui.actionPreferences->setMenuRole(QAction::NoRole);
-	ui.actionQuit->setMenuRole(QAction::NoRole);
-#endif
-
-	// Preview modes
-	QActionGroup *groupPreviewModes = new QActionGroup(this);
-
-	groupPreviewModes->addAction(ui.actionPreviewInput);
-	groupPreviewModes->addAction(ui.actionPreviewOutput);
-	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
-
-	/*
-	Connect our button to buttonPressed
-	*/
-#define PROCESS CONNECT_TB
-	LIST_OF_BUTTONS
-#undef PROCESS
-
-	//ACT_VideoCodecChanged
-	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-
-	// Slider
-	slider=ui.horizontalSlider;
-	slider->setMinimum(0);
-	slider->setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
-	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
-	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
-
-   // Thumb slider
-    ui.sliderPlaceHolder->installEventFilter(this);
-    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
-    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
-
-	// Volume slider
-	QSlider *volSlider=ui.horizontalSlider_2;
-	volSlider->setMinimum(0);
-	volSlider->setMaximum(100);
-	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
-
-	// default state
-	bool b=0;
-	ui.pushButtonVideoConf->setEnabled(b);
-	ui.pushButtonVideoFilter->setEnabled(b);
-	ui.pushButtonAudioConf->setEnabled(b);
-	ui.pushButtonAudioFilter->setEnabled(b);
-
-	/* Time Shift */
-	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
-
-	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
-	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
-	ui.currentTime->setValidator(timeValidator);
-	ui.currentTime->setInputMask("99:99:99.999");
-
-	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
-
-    // Build file,... menu
-    buildMyMenu();
-
-	/* Build the custom menu */
-    jsMenu=new QMenu("javaScript");
-    pyMenu=new QMenu("tinyPython");
-    autoMenu=ui.menuAuto ;//new QMenu("autoPython");
-    ui.menuCustom->addMenu(jsMenu);
-    ui.menuCustom->addMenu(pyMenu);
-    //ui.menuAuto->addMenu(autoMenu);
-	buildCustomMenu();
-
-    recentFiles=new QMenu("Recent Files");
-    recentProjects=new QMenu("Recent Projects");
-    ui.menuRecent->addMenu(recentFiles);
-    ui.menuRecent->addMenu(recentProjects);
-    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
-
-	this->installEventFilter(this);
-	slider->installEventFilter(this);
-    
-	//ui.currentTime->installEventFilter(this);
-
-	this->setFocus(Qt::OtherFocusReason);
-
-	setAcceptDrops(true);
-    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
-
-    // Hook also the toolbar
-    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-
-	QWidget* dummy0 = new QWidget();
-	QWidget* dummy1 = new QWidget();
-	QWidget* dummy2 = new QWidget();
-	QWidget* dummy3 = new QWidget();
-	QWidget* dummy4 = new QWidget();
-
-	ui.codecWidget->setTitleBarWidget(dummy0);
-	ui.navigationWidget->setTitleBarWidget(dummy1);
-	ui.selectionWidget->setTitleBarWidget(dummy2);
-	ui.volumeWidget->setTitleBarWidget(dummy3);
-	ui.audioMetreWidget->setTitleBarWidget(dummy4);
-
-	this->resize(1, 1);
-}
-/**
-    \fn searchToolBar
-*/
-typedef struct 
-{
-    const char *name;
-    Action event;
-}toolBarTranslate;
-
-toolBarTranslate toolbar[]=
-{
-{"actionOpen",              ACT_OPEN_VIDEO},
-{"actionSave_video",        ACT_SAVE_VIDEO},
-{"actionProperties",        ACT_VIDEO_PROPERTIES},
-{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
-{"actionSave_project",      ACT_SAVE_PY_PROJECT},
-//{"actionPreviewInput",ACT_PreviewToggle},
-//{"actionPreviewOutput",ACT_PreviewToggle},
-
-{NULL,ACT_DUMMY}
-};
-void MainWindow::searchToolBar(QAction *action)
-{
-        toolBarTranslate *t=toolbar;
-        QString me(action->objectName());
-        const char *name=me.toUtf8().constData();
-        while(t->name)
-        {
-            if(!strcmp(name,t->name))
-            {
-                HandleAction(t->event);
-                return;
-            }
-            t++;
-        }
-        ADM_warning("Toolbar:Cannot handle %s\n",name);
-}
-/**
-    \fn buildFileMenu
-*/
-bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
-{
-    QMenu *subMenu=NULL;
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        switch(m->type)
-        {
-            case MENU_SEPARATOR:
-                root->addSeparator();
-                break;
-            case MENU_SUBMENU:
-                {
-                    subMenu=root->addMenu(m->text);
-                }
-                break;
-            case MENU_SUBACTION:
-            case MENU_ACTION:
-                {   
-                        QMenu *insert=root;
-                        if(m->type==MENU_SUBACTION) insert=subMenu;
-                        QAction *a=NULL;
-                        if(m->icon) 
-                        {
-                            QIcon icon(m->icon);
-                            a=insert->addAction(icon,m->text);
-                        }else
-                            a=insert->addAction(m->text);
-                        m->cookie=(void *)a;
-                        if(m->shortCut)
-                        {
-                            QKeySequence s(m->shortCut);
-                            a->setShortcut(s);
-                        }
-                        break;
-                }
-            default:
-                break;
-        }
-    }
-    return true;
-}
-/**
-    buildFileMenu
-*/
-bool MainWindow::buildMyMenu(void)
-{
-    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
-    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
-
-    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
-    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
-
-    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
-    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
-
-    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
-    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
-
-    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
-    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
-
-    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
-    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
-
-    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
-    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
-
-    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
-    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
-
-    return true;
-}
-
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-	HandleAction (ACT_TimeShift) ;
-}
-/**
-    \fn searchMenu
-*/
-void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
-{
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        if(m->cookie==(void*)action)
-        {
-            HandleAction (m->event);
-        }
-    }
-}
-
-/**
-    \fn searchFileMenu
-*/
-#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
-    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
-
-MKMENU(File)
-MKMENU(Edit)
-//MKMENU(Recent)
-MKMENU(View)
-MKMENU(Tool)
-MKMENU(Go)
-//MKMENU(Custom)
-MKMENU(Audio)
-MKMENU(Video)
-MKMENU(Help)
-
-
-
-/*
-      We receive a button press event
-*/
-void MainWindow::buttonPressed(void)
-{
-	// Receveid a key press Event, look into table..
-    QObject *obj=sender();
-    if(!obj) return;
-    QString me(obj->objectName());
-    
-	Action action=searchTranslationTable(qPrintable(me));
-    
-
-	if(action!=ACT_DUMMY)
-		HandleAction (action);
-
-}
-void MainWindow::toolButtonPressed(bool i)
-{
-	buttonPressed();
-}
-
-bool MainWindow::eventFilter(QObject* watched, QEvent* event)
-{
-	QKeyEvent *keyEvent;
-
-	switch (event->type())
-	{
-		case QEvent::KeyPress:
-			keyEvent = (QKeyEvent*)event;
-
-			if (watched == slider)
-			{
-				switch (keyEvent->key())
-				{
-					case Qt::Key_Left:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Back25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Back50Frames);
-						else
-							HandleAction(ACT_PreviousFrame);
-
-						return true;
-					case Qt::Key_Right:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Forward25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Forward50Frames);
-						else
-							HandleAction(ACT_NextFrame);
-
-						return true;
-					case Qt::Key_Up:
-						HandleAction(ACT_NextKFrame);
-						return true;
-					case Qt::Key_Down:
-						HandleAction(ACT_PreviousKFrame);
-						return true;
-					case Qt::Key_Shift:
-						shiftKeyHeld = 1;
-						break;
-				}
-			}
-			else if (keyEvent->key() == Qt::Key_Space)
-			{
-				HandleAction(ACT_PlayAvi);
-				return true;
-			}
-
-			break;
-        case QEvent::Resize:
-            if (watched == ui.sliderPlaceHolder)
-            {
-                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
-                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
-            }
-            break;
-
-		case QEvent::KeyRelease:
-			keyEvent = (QKeyEvent*)event;
-
-			if (keyEvent->key() == Qt::Key_Shift)
-				shiftKeyHeld = 0;
-
-			break;
-		case QEvent::FocusOut:
-            break;
-        default:
-            break;
-	}
-
-	return QObject::eventFilter(watched, event);
-}
-/**
-    \fn buildRecentMenu
-*/
-bool MainWindow::buildRecentMenu(void)
-{
-    const char **names;
-	names=prefs->get_lastfiles();
-    // Purge entries...
-    recentFiles->clear();
-    for(int i=0;i<4;i++)
-    {
-        if(names[i])
-        {
-            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
-        }else
-            recentFileAction[i]=NULL;
-    }
-	return true;
-}
-/**
-    \fn searchRecentFiles
-*/
-void MainWindow::searchRecentFiles(QAction * action)
-{
-    for(int i=0;i<4;i++)
-    {
-            QAction *a= recentFileAction[i];
-            if(!a) continue;
-
-            if(a==action) 
-            {
-                HandleAction((Action)(ACT_RECENT0+i));
-                return;
-            }
-    }
-}
-void MainWindow::mousePressEvent(QMouseEvent* event)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
-{
-	if (event->mimeData()->hasFormat("text/uri-list"))
-		event->acceptProposedAction();
-}
-
-void MainWindow::dropEvent(QDropEvent *event)
-{
-	QList<QUrl> urlList;
-	QString fileName;
-	QFileInfo info;
-    const char *cFileName;
-
-	if (event->mimeData()->hasUrls())
-	{
-		urlList = event->mimeData()->urls();
-
-		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
-		{
-			fileName = urlList[fileIndex].toLocalFile();
-			info.setFile(fileName);
-            cFileName=ADM_strdup(fileName.toUtf8().constData());
-            ADM_info("Drop event %s\n",cFileName);
-			if (info.isFile())
-			{
-				if (avifileinfo)
-                {
-                    ADM_info("Appending..\n");
-                    A_appendAvi(cFileName);
-                }
-				else
-                {
-                    ADM_info("Opening..\n");
-                    A_openAvi(cFileName);
-                }
-			}else
-            {
-                ADM_warning("Dropped item is not a file\n");
-            }
-            ADM_dealloc(cFileName);
-		}
-	}
-
-	event->acceptProposedAction();
-}
-
-void MainWindow::previousIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepDown();
-	else
-		HandleAction(ACT_PreviousKFrame);
-}
-
-void MainWindow::nextIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepUp();
-	else
-		HandleAction(ACT_NextKFrame);
-}
-
-MainWindow::~MainWindow()
-{
-	clearCustomMenu();
-    delete thumbSlider;
-    thumbSlider=NULL;
-}
-
-void MainWindow::closeEvent(QCloseEvent *event)
-{
-static bool first=true;
-    ADM_warning("Close event\n");
-    if(first)
-    {
-        first=false;
-        HandleAction(ACT_EXIT);
-    }
-    event->accept();
-//         event->ignore();
-
-}
-
-
-static const UI_FUNCTIONS_T UI_Hooks=
-    {
-        ADM_RENDER_API_VERSION_NUMBER,
-        UI_getWindowInfo,
-        UI_updateDrawWindowSize,
-        UI_rgbDraw,
-        UI_getDrawWidget,
-        UI_getPreferredRender
-        
-    };
-QApplication *myApplication=NULL;
-/**
-    \fn  UI_Init
-    \brief First part of UI initialization
-
-*/
-int UI_Init(int nargc,char **nargv)
-{
-    ADM_info("Starting QT4 GUI...\n");
-	initTranslator();
-
-	global_argc=nargc;
-	global_argv=nargv;
-	ADM_renderLibInit(&UI_Hooks);
-    Q_INIT_RESOURCE(avidemux);
-	Q_INIT_RESOURCE(filter);
-
-	myApplication=new QApplication (global_argc, global_argv);
-	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
-
-	loadTranslator();
-
-	MainWindow *mw = new MainWindow();
-	mw->show();
-
-	QuiMainWindows = (QWidget*)mw;
-
-	uint32_t w, h;
-
-	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
-	printf("The screen seems to be %u x %u px\n",w,h);
-
-	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu();
-
-    // Init vumeter
-    VuMeter=mw->ui.frameVU;
-    UI_InitVUMeter(mw->ui.frameVU);
-	return 0;
-}
-/**
-
-*/
-bool UI_End(void)
-{
-    ADM_QPreviewCleanup();
-    return true;
-}
-void UI_refreshCustomMenu(void)
-{
-	((MainWindow*)QuiMainWindows)->buildCustomMenu();
-}
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-int UI_getCurrentPreview(void)
-{
-	int index;
-
-	if (WIDGET(actionPreviewOutput)->isChecked())
-		index = 1;
-	else if (WIDGET(actionPreviewSide)->isChecked())
-		index = 2;
-	else if (WIDGET(actionPreviewTop)->isChecked())
-		index = 3;
-	else if (WIDGET(actionPreviewSeparate)->isChecked())
-		index = 4;
-	else
-		index = 0;
-
-	return index;
-}
-
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-void UI_setCurrentPreview(int ne)
-{
-	switch (ne)
-	{
-		case 1:
-			WIDGET(actionPreviewOutput)->setChecked(true);
-			break;
-		case 2:
-			WIDGET(actionPreviewSide)->setChecked(true);
-			break;
-		case 3:
-			WIDGET(actionPreviewTop)->setChecked(true);
-			break;
-		case 4:
-			WIDGET(actionPreviewSeparate)->setChecked(true);
-			break;
-		default:
-			WIDGET(actionPreviewInput)->setChecked(true);
-	}
-}
-/**
-        \fn FatalFunctionQt
-*/
-static void FatalFunctionQt(const char *title, const char *info)
-{
-	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
-}
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-	
-	setupMenus();
-    ADM_setCrashHook(&saveCrashProject, &FatalFunctionQt);
-	checkCrashFile();
-    // Create an openGL context
-#ifdef USE_OPENGL
-    bool enabled;
-    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
-    if(enabled)
-        UI_Qt4InitGl();
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_cpp.h"
+#include "config.h"
+
+#include "ADM_inttype.h"
+#include <QtCore/QFileInfo>
+#include <QtCore/QUrl>
+#include <QtGui/QKeyEvent>
+#include <QtGui/QGraphicsView>
+
+#define MENU_DECLARE
+#include "Q_gui2.h"
+#include "ADM_default.h"
+#include "ADM_toolkitQt.h"
+
+#include "DIA_fileSel.h"
+#include "ADM_vidMisc.h"
+#include "prefs.h"
+#include "avi_vars.h"
+
+#include "ADM_render/GUI_renderInternal.h"
+#include "ADM_coreVideoEncoderInternal.h"
+#include "ADM_muxerProto.h"
+#include "T_vumeter.h"
+#include "DIA_coreToolkit.h"
+
+#ifdef USE_OPENGL
+extern bool ADM_glHasActiveTexture(void);
+void UI_Qt4InitGl(void);
+void UI_Qt4CleanGl(void);
 #endif
-
-	if (global_argc >= 2)
-		automation();
-
-    myApplication->exec();
-#ifdef USE_OPENGL
-    if(enabled)
-        UI_Qt4CleanGl();
-#endif
-	destroyTranslator();
-    delete myApplication;
-    myApplication=NULL;
-    return 1;
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
-	{
-		if(!strcmp(name, myTranslationTable[i].name))
-		{
-			return  myTranslationTable[i].action;
-		}
-	}
-	printf("WARNING: Signal not found in translation table %s\n",name);
-	return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video & audio co
-*/
-void setupMenus(void)
-{
-	uint32_t nbVid;
-    uint32_t maj,mn,pa;
-	const char *name;
-
-	nbVid=ADM_ve6_getNbEncoders();
-	printf("Found %d video encoder(s)\n",nbVid);
-	for(uint32_t i=1;i<nbVid;i++)
-	{
-		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
-		WIDGET(comboBoxVideo)->addItem(name);
-	}
-
-	// And A codec
-
-	uint32_t nbAud;
-
-    nbAud=audioEncoderGetNumberOfEncoders();
-	printf("Found %d audio encoder(s)\n",nbAud);		       
-	for(uint32_t i=1;i<nbAud;i++)
-	{
-		name=audioEncoderGetDisplayName(i);
-		WIDGET(comboBoxAudio)->addItem(name);
-	}
-
-	/*   Fill in output format window */
-	uint32_t nbFormat=ADM_mx_getNbMuxers();
-
-	printf("Found %d format(s)\n",nbFormat);
-	for(uint32_t i=0;i<nbFormat;i++)
-	{
-        const char *name=ADM_mx_getDisplayName(i);
-		WIDGET(comboBoxFormat)->addItem(name);	
-	}
-
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-	double v;
-	if(!slider) v=0;
-	v= (double)(slider->value());
-	v/=10000000;
-	return v;
-}
-void UI_setScale( double val )
-{
-	if(_upd_in_progres) return;
-	_upd_in_progres++;
-	slider->setValue( (int)(val * 10000000));
-	_upd_in_progres--;
-}
-
-int UI_readCurFrame(void)
-{
-	return 0;
-}
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
-{
-	int success = 0;
-
-	QString timeText = WIDGET(currentTime)->text();
-	int pos;
-
-	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
-	{
-		uint32_t frame;
-
-		hh = (uint16_t)timeText.left(2).toUInt();
-		mm = (uint16_t)timeText.mid(3, 2).toUInt();
-		ss = (uint16_t)timeText.mid(6, 2).toUInt();
-		ms = (uint16_t)timeText.right(3).toUInt();
-
-		time2frame(&frame, currentFps, hh, mm, ss, ms);
-
-		if (frame <= frameCount)
-			success = 1;
-	}
-
-	return success;
-}
-
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(const char *name)
-{
-	char *title;
-	const char* defaultTitle = "Avidemux";
-
-	if (name && (*name) )
-	{
-		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
-
-		strcpy(title, name);
-		strcat(title, " - ");
-		strcat(title, defaultTitle);
-	}
-	else
-	{
-		title = new char[strlen(defaultTitle) + 1];
-
-		strcpy(title, defaultTitle);
-	}
-
-	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
-	delete [] title;
-}
-
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-	char string[100];
-	char	c='?';
-    const char *f="???";
-	switch(frametype&AVI_FRAME_TYPE_MASK)
-	{
-	case AVI_KEY_FRAME: c='I';break;
-	case AVI_B_FRAME: c='B';break;
-	case 0: c='P';break;
-	default:c='?';break;
-
-	}
-    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
-	{
-	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
-    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
-    case AVI_FRAME_STRUCTURE: f="FRM";break;
-	default:f="???";
-
-                    break;
-	}
-	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
-	WIDGET(label_8)->setText(string);	
-
-}
-
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-void UI_updateFrameCount(uint32_t curFrame)
-{
-	
-}
-
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-	
-}
-
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
-	char text[80];   
-	uint32_t mm,hh,ss,ms;
-
-	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
-	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-}
-
-
-
-/**
-    \fn UI_setCurrentTime
-    \brief Set current PTS of displayed video
-*/
-void UI_setCurrentTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-
-}
-
-/**
-    \fn UI_setTotalTime
-    \brief SEt the total duration of video
-*/
-void UI_setTotalTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-    WIDGET(totalTime)->setText(text);
-    slider->setTotalDuration(curTime);
-}
-/**
-    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
-    \brief  Display frame # for marker A & B
-*/
-void UI_setMarkers(uint64_t a, uint64_t b)
-{
-	char text[80];
-    uint64_t absoluteA=a,absoluteB=b;
-    uint32_t hh,mm,ss,ms;
-    uint32_t timems;
-    a/=1000;
-    b/=1000;
-
-    timems=(uint32_t)(a);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerA)->setText(text);
-
-	timems=(uint32_t)(b);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerB)->setText(text);
-
-	slider->setMarkers(absoluteA, absoluteB);
-}
-
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-int 	UI_getCurrentVCodec(void)
-{
-	int i=WIDGET(comboBoxVideo)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-	int b=!!i;
-	WIDGET(comboBoxVideo)->setCurrentIndex(i);
-
-	WIDGET(pushButtonVideoConf)->setEnabled(b);
-	WIDGET(pushButtonVideoFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-	int i=WIDGET(comboBoxAudio)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-WIDGET(comboBoxAudio)->setCurrentIndex(i);
-WIDGET(pushButtonAudioConf)->setEnabled(b);
-WIDGET(pushButtonAudioFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-int 	UI_GetCurrentFormat( void )
-{
-	int i=WIDGET(comboBoxFormat)->currentIndex();
-	if(i<0) i=0;
-	return (int)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
-{
-	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
-    return 1;
-}
-
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
-		*onoff=1;
-	else
-		*onoff=0;
-	*value=WIDGET(spinBox_TimeValue)->value();
-	return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (onoff && value)
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
-	else
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
-	WIDGET(spinBox_TimeValue)->setValue(value);
-	return 1;
-}
-/**
-    \fn UI_setVUMeter
-*/
-bool UI_setVUMeter( uint32_t volume[6])
-{
-    UI_vuUpdate( volume);
-    return true;
-}
-/**
-    \fn setDecodeName
-*/
-bool UI_setDecoderName(const char *name)
-{
-    WIDGET(labelVideoDecoder)->setText(name);	
-    return true;
-}
-/**
-    \fn UI_hasOpengl
-*/
-bool UI_hasOpenGl(void)
-{
-#ifndef USE_OPENGL
-    return false;
-#else
-    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
-    bool enabled;
-    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
-    return enabled;
-#endif
-}
-//********************************************
-//EOF
+
+extern int global_argc;
+extern char **global_argv;
+
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern int encoderGetEncoderCount (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+uint32_t audioEncoderGetNumberOfEncoders(void);
+const char  *audioEncoderGetDisplayName(uint32_t i);
+extern void checkCrashFile(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
+extern int A_openAvi(const char *name);
+extern int A_appendAvi(const char *name);
+extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
+
+
+int SliderIsShifted=0;
+static void setupMenus(void);
+static int shiftKeyHeld=0;
+static ADM_QSlider *slider=NULL;
+static int _upd_in_progres=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
+uint32_t ADM_ve6_getNbEncoders(void);
+void UI_refreshCustomMenu(void);
+QWidget *QuiMainWindows=NULL;
+QWidget *VuMeter=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+extern void saveCrashProject(void);
+extern uint8_t AVDM_setVolume(int volume);
+extern bool ADM_QPreviewCleanup(void);
+
+
+
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
+
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+
+#include "translation_table.h"   
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct 
+{
+	const char *name;
+	Action     action; 
+}adm_qt4_translation;
+
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+	LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+extern void UI_purge(void);
+/*
+    Declare the class that will be our main window
+
+*/
+
+void MainWindow::comboChanged(int z)
+{
+	const char *source=qPrintable(sender()->objectName());
+
+	if(!strcmp(source,"comboBoxVideo"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxVideo->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonVideoConf->setEnabled(b);
+		ui.pushButtonVideoFilter->setEnabled(b);
+		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
+	}
+	else if(!strcmp(source,"comboBoxAudio"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxAudio->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonAudioConf->setEnabled(b);
+		ui.pushButtonAudioFilter->setEnabled(b);
+		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
+	}
+	else
+		printf("From +: %s\n",source);
+}
+
+void MainWindow::sliderValueChanged(int u) 
+{
+	if(!_upd_in_progres)
+		HandleAction(ACT_Scale);
+}
+
+void MainWindow::sliderMoved(int value)
+{
+	SliderIsShifted = shiftKeyHeld;
+}
+
+void MainWindow::sliderReleased(void)
+{
+	SliderIsShifted = 0;
+}
+
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+        if (value > 0)
+                nextIntraFrame();
+        else
+                previousIntraFrame();
+}
+
+void MainWindow::volumeChange( int u )
+{
+	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
+		return;
+
+	_upd_in_progres++;
+
+	int vol = ui.horizontalSlider_2->value();
+
+	AVDM_setVolume(vol);
+	_upd_in_progres--;
+}
+
+void MainWindow::audioToggled(bool checked)
+{
+	if (checked)
+		AVDM_setVolume(ui.horizontalSlider_2->value());
+	else
+		AVDM_setVolume(0);
+}
+
+void MainWindow::previewModeChanged(QAction *action)
+{
+	HandleAction(ACT_PreviewChanged);
+}
+
+void MainWindow::timeChangeFinished(void)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentFrameChanged(void)
+{
+//	HandleAction(ACT_JumpToFrame);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentTimeChanged(void)
+{
+	HandleAction(ACT_GotoTime);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+/**
+    \fn ctor
+*/
+MainWindow::MainWindow() : QMainWindow()
+{
+	qtRegisterDialog(this);
+	ui.setupUi(this);
+
+#if defined(__APPLE__) && defined(USE_SDL)
+	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
+	ui.actionPreferences->setMenuRole(QAction::NoRole);
+	ui.actionQuit->setMenuRole(QAction::NoRole);
+#endif
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes->addAction(ui.actionPreviewInput);
+	groupPreviewModes->addAction(ui.actionPreviewOutput);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
+#define PROCESS CONNECT_TB
+	LIST_OF_BUTTONS
+#undef PROCESS
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider->setMinimum(0);
+	slider->setMaximum(1000000000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
+
+   // Thumb slider
+    ui.sliderPlaceHolder->installEventFilter(this);
+    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider->setMinimum(0);
+	volSlider->setMaximum(100);
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
+
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf->setEnabled(b);
+	ui.pushButtonVideoFilter->setEnabled(b);
+	ui.pushButtonAudioConf->setEnabled(b);
+	ui.pushButtonAudioFilter->setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
+
+	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.currentTime->setValidator(timeValidator);
+	ui.currentTime->setInputMask("99:99:99.999");
+
+	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
+    // Build file,... menu
+    buildMyMenu();
+
+	/* Build the custom menu */
+    jsMenu=new QMenu("javaScript");
+    pyMenu=new QMenu("tinyPython");
+    autoMenu=ui.menuAuto ;//new QMenu("autoPython");
+    ui.menuCustom->addMenu(jsMenu);
+    ui.menuCustom->addMenu(pyMenu);
+    //ui.menuAuto->addMenu(autoMenu);
+	buildCustomMenu();
+
+    recentFiles=new QMenu("Recent Files");
+    recentProjects=new QMenu("Recent Projects");
+    ui.menuRecent->addMenu(recentFiles);
+    ui.menuRecent->addMenu(recentProjects);
+    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
+
+	this->installEventFilter(this);
+	slider->installEventFilter(this);
+    
+	//ui.currentTime->installEventFilter(this);
+
+	this->setFocus(Qt::OtherFocusReason);
+
+	setAcceptDrops(true);
+    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
+
+    // Hook also the toolbar
+    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+
+	QWidget* dummy0 = new QWidget();
+	QWidget* dummy1 = new QWidget();
+	QWidget* dummy2 = new QWidget();
+	QWidget* dummy3 = new QWidget();
+	QWidget* dummy4 = new QWidget();
+
+	ui.codecWidget->setTitleBarWidget(dummy0);
+	ui.navigationWidget->setTitleBarWidget(dummy1);
+	ui.selectionWidget->setTitleBarWidget(dummy2);
+	ui.volumeWidget->setTitleBarWidget(dummy3);
+	ui.audioMetreWidget->setTitleBarWidget(dummy4);
+
+	this->resize(1, 1);
+}
+/**
+    \fn searchToolBar
+*/
+typedef struct 
+{
+    const char *name;
+    Action event;
+}toolBarTranslate;
+
+toolBarTranslate toolbar[]=
+{
+{"actionOpen",              ACT_OPEN_VIDEO},
+{"actionSave_video",        ACT_SAVE_VIDEO},
+{"actionProperties",        ACT_VIDEO_PROPERTIES},
+{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
+{"actionSave_project",      ACT_SAVE_PY_PROJECT},
+//{"actionPreviewInput",ACT_PreviewToggle},
+//{"actionPreviewOutput",ACT_PreviewToggle},
+
+{NULL,ACT_DUMMY}
+};
+void MainWindow::searchToolBar(QAction *action)
+{
+        toolBarTranslate *t=toolbar;
+        QString me(action->objectName());
+        const char *name=me.toUtf8().constData();
+        while(t->name)
+        {
+            if(!strcmp(name,t->name))
+            {
+                HandleAction(t->event);
+                return;
+            }
+            t++;
+        }
+        ADM_warning("Toolbar:Cannot handle %s\n",name);
+}
+/**
+    \fn buildFileMenu
+*/
+bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
+{
+    QMenu *subMenu=NULL;
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        switch(m->type)
+        {
+            case MENU_SEPARATOR:
+                root->addSeparator();
+                break;
+            case MENU_SUBMENU:
+                {
+                    subMenu=root->addMenu(m->text);
+                }
+                break;
+            case MENU_SUBACTION:
+            case MENU_ACTION:
+                {   
+                        QMenu *insert=root;
+                        if(m->type==MENU_SUBACTION) insert=subMenu;
+                        QAction *a=NULL;
+                        if(m->icon) 
+                        {
+                            QIcon icon(m->icon);
+                            a=insert->addAction(icon,m->text);
+                        }else
+                            a=insert->addAction(m->text);
+                        m->cookie=(void *)a;
+                        if(m->shortCut)
+                        {
+                            QKeySequence s(m->shortCut);
+                            a->setShortcut(s);
+                        }
+                        break;
+                }
+            default:
+                break;
+        }
+    }
+    return true;
+}
+/**
+    buildFileMenu
+*/
+bool MainWindow::buildMyMenu(void)
+{
+    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
+    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
+
+    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
+    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
+
+    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
+    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
+
+    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
+    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
+
+    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
+    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
+
+    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
+    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
+
+    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
+    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
+
+    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
+    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
+
+    return true;
+}
+
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+	HandleAction (ACT_TimeShift) ;
+}
+/**
+    \fn searchMenu
+*/
+void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
+{
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        if(m->cookie==(void*)action)
+        {
+            HandleAction (m->event);
+        }
+    }
+}
+
+/**
+    \fn searchFileMenu
+*/
+#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
+    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
+
+MKMENU(File)
+MKMENU(Edit)
+//MKMENU(Recent)
+MKMENU(View)
+MKMENU(Tool)
+MKMENU(Go)
+//MKMENU(Custom)
+MKMENU(Audio)
+MKMENU(Video)
+MKMENU(Help)
+
+
+
+/*
+      We receive a button press event
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+    QObject *obj=sender();
+    if(!obj) return;
+    QString me(obj->objectName());
+    
+	Action action=searchTranslationTable(qPrintable(me));
+    
+
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	QKeyEvent *keyEvent;
+
+	switch (event->type())
+	{
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
+
+			if (watched == slider)
+			{
+				switch (keyEvent->key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
+
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
+
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
+			}
+			else if (keyEvent->key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
+
+			break;
+        case QEvent::Resize:
+            if (watched == ui.sliderPlaceHolder)
+            {
+                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
+                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
+            }
+            break;
+
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent->key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+            break;
+        default:
+            break;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+/**
+    \fn buildRecentMenu
+*/
+bool MainWindow::buildRecentMenu(void)
+{
+    const char **names;
+	names=prefs->get_lastfiles();
+    // Purge entries...
+    recentFiles->clear();
+    for(int i=0;i<4;i++)
+    {
+        if(names[i])
+        {
+            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
+        }else
+            recentFileAction[i]=NULL;
+    }
+	return true;
+}
+/**
+    \fn searchRecentFiles
+*/
+void MainWindow::searchRecentFiles(QAction * action)
+{
+    for(int i=0;i<4;i++)
+    {
+            QAction *a= recentFileAction[i];
+            if(!a) continue;
+
+            if(a==action) 
+            {
+                HandleAction((Action)(ACT_RECENT0+i));
+                return;
+            }
+    }
+}
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+{
+	if (event->mimeData()->hasFormat("text/uri-list"))
+		event->acceptProposedAction();
+}
+
+void MainWindow::dropEvent(QDropEvent *event)
+{
+	QList<QUrl> urlList;
+	QString fileName;
+	QFileInfo info;
+    const char *cFileName;
+
+	if (event->mimeData()->hasUrls())
+	{
+		urlList = event->mimeData()->urls();
+
+		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
+		{
+			fileName = urlList[fileIndex].toLocalFile();
+			info.setFile(fileName);
+            cFileName=ADM_strdup(fileName.toUtf8().constData());
+            ADM_info("Drop event %s\n",cFileName);
+			if (info.isFile())
+			{
+				if (avifileinfo)
+                {
+                    ADM_info("Appending..\n");
+                    A_appendAvi(cFileName);
+                }
+				else
+                {
+                    ADM_info("Opening..\n");
+                    A_openAvi(cFileName);
+                }
+			}else
+            {
+                ADM_warning("Dropped item is not a file\n");
+            }
+            ADM_dealloc(cFileName);
+		}
+	}
+
+	event->acceptProposedAction();
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+    delete thumbSlider;
+    thumbSlider=NULL;
+}
+
+void MainWindow::closeEvent(QCloseEvent *event)
+{
+static bool first=true;
+    ADM_warning("Close event\n");
+    if(first)
+    {
+        first=false;
+        HandleAction(ACT_EXIT);
+    }
+    event->accept();
+//         event->ignore();
+
+}
+
+
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
+QApplication *myApplication=NULL;
+/**
+    \fn  UI_Init
+    \brief First part of UI initialization
+
+*/
+int UI_Init(int nargc,char **nargv)
+{
+    ADM_info("Starting QT4 GUI...\n");
+	initTranslator();
+
+	global_argc=nargc;
+	global_argv=nargv;
+	ADM_renderLibInit(&UI_Hooks);
+    Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+
+	myApplication=new QApplication (global_argc, global_argv);
+	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
+
+	loadTranslator();
+
+	MainWindow *mw = new MainWindow();
+	mw->show();
+
+	QuiMainWindows = (QWidget*)mw;
+
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
+	printf("The screen seems to be %u x %u px\n",w,h);
+
+	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu();
+
+    // Init vumeter
+    VuMeter=mw->ui.frameVU;
+    UI_InitVUMeter(mw->ui.frameVU);
+	return 0;
+}
+/**
+
+*/
+bool UI_End(void)
+{
+    ADM_QPreviewCleanup();
+    return true;
+}
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)->buildCustomMenu();
+}
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+int UI_getCurrentPreview(void)
+{
+	int index;
+
+	if (WIDGET(actionPreviewOutput)->isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)->isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)->isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)->isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
+}
+
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+void UI_setCurrentPreview(int ne)
+{
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)->setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)->setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)->setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)->setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)->setChecked(true);
+	}
+}
+/**
+        \fn FatalFunctionQt
+*/
+static void FatalFunctionQt(const char *title, const char *info)
+{
+	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
+}
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+	
+	setupMenus();
+    ADM_setCrashHook(&saveCrashProject, &FatalFunctionQt);
+	checkCrashFile();
+    // Create an openGL context
+#ifdef USE_OPENGL
+    bool enabled;
+    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
+    if(enabled)
+        UI_Qt4InitGl();
+#endif
+
+	if (global_argc >= 2)
+		automation();
+
+    myApplication->exec();
+#ifdef USE_OPENGL
+    if(enabled)
+        UI_Qt4CleanGl();
+#endif
+	destroyTranslator();
+    delete myApplication;
+    myApplication=NULL;
+    return 1;
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf("WARNING: Signal not found in translation table %s\n",name);
+	return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video & audio co
+*/
+void setupMenus(void)
+{
+	uint32_t nbVid;
+    uint32_t maj,mn,pa;
+	const char *name;
+
+	nbVid=ADM_ve6_getNbEncoders();
+	printf("Found %d video encoder(s)\n",nbVid);
+	for(uint32_t i=1;i<nbVid;i++)
+	{
+		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
+		WIDGET(comboBoxVideo)->addItem(name);
+	}
+
+	// And A codec
+
+	uint32_t nbAud;
+
+    nbAud=audioEncoderGetNumberOfEncoders();
+	printf("Found %d audio encoder(s)\n",nbAud);		       
+	for(uint32_t i=1;i<nbAud;i++)
+	{
+		name=audioEncoderGetDisplayName(i);
+		WIDGET(comboBoxAudio)->addItem(name);
+	}
+
+	/*   Fill in output format window */
+	uint32_t nbFormat=ADM_mx_getNbMuxers();
+
+	printf("Found %d format(s)\n",nbFormat);
+	for(uint32_t i=0;i<nbFormat;i++)
+	{
+        const char *name=ADM_mx_getDisplayName(i);
+		WIDGET(comboBoxFormat)->addItem(name);	
+	}
+
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider->value());
+	v/=10000000;
+	return v;
+}
+void UI_setScale( double val )
+{
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider->setValue( (int)(val * 10000000));
+	_upd_in_progres--;
+}
+
+int UI_readCurFrame(void)
+{
+	return 0;
+}
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(currentTime)->text();
+	int pos;
+
+	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&frame, currentFps, hh, mm, ss, ms);
+
+		if (frame <= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(const char *name)
+{
+	char *title;
+	const char* defaultTitle = "Avidemux";
+
+	if (name && (*name) )
+	{
+		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
+
+		strcpy(title, name);
+		strcat(title, " - ");
+		strcat(title, defaultTitle);
+	}
+	else
+	{
+		title = new char[strlen(defaultTitle) + 1];
+
+		strcpy(title, defaultTitle);
+	}
+
+	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
+	delete [] title;
+}
+
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+	char string[100];
+	char	c='?';
+    const char *f="???";
+	switch(frametype&AVI_FRAME_TYPE_MASK)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
+
+	}
+    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
+	{
+	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
+    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
+    case AVI_FRAME_STRUCTURE: f="FRM";break;
+	default:f="???";
+
+                    break;
+	}
+	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
+	WIDGET(label_8)->setText(string);	
+
+}
+
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+void UI_updateFrameCount(uint32_t curFrame)
+{
+	
+}
+
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+	
+}
+
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+	char text[80];   
+	uint32_t mm,hh,ss,ms;
+
+	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
+	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+}
+
+
+
+/**
+    \fn UI_setCurrentTime
+    \brief Set current PTS of displayed video
+*/
+void UI_setCurrentTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+
+}
+
+/**
+    \fn UI_setTotalTime
+    \brief SEt the total duration of video
+*/
+void UI_setTotalTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+    WIDGET(totalTime)->setText(text);
+    slider->setTotalDuration(curTime);
+}
+/**
+    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
+    \brief  Display frame # for marker A & B
+*/
+void UI_setMarkers(uint64_t a, uint64_t b)
+{
+	char text[80];
+    uint64_t absoluteA=a,absoluteB=b;
+    uint32_t hh,mm,ss,ms;
+    uint32_t timems;
+    a/=1000;
+    b/=1000;
+
+    timems=(uint32_t)(a);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerA)->setText(text);
+
+	timems=(uint32_t)(b);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerB)->setText(text);
+
+	slider->setMarkers(absoluteA, absoluteB);
+}
+
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+int 	UI_getCurrentVCodec(void)
+{
+	int i=WIDGET(comboBoxVideo)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+	int b=!!i;
+	WIDGET(comboBoxVideo)->setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)->setEnabled(b);
+	WIDGET(pushButtonVideoFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+	int i=WIDGET(comboBoxAudio)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+WIDGET(comboBoxAudio)->setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)->setEnabled(b);
+WIDGET(pushButtonAudioFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+int 	UI_GetCurrentFormat( void )
+{
+	int i=WIDGET(comboBoxFormat)->currentIndex();
+	if(i<0) i=0;
+	return (int)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
+{
+	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
+    return 1;
+}
+
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)->value();
+	return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+	if (onoff && value)
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)->setValue(value);
+	return 1;
+}
+/**
+    \fn UI_setVUMeter
+*/
+bool UI_setVUMeter( uint32_t volume[6])
+{
+    UI_vuUpdate( volume);
+    return true;
+}
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)->setText(name);	
+    return true;
+}
+/**
+    \fn UI_hasOpengl
+*/
+bool UI_hasOpenGl(void)
+{
+#ifndef USE_OPENGL
+    return false;
+#else
+    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
+    bool enabled;
+    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
+    return enabled;
+#endif
+}
+//********************************************
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,6 +17,7 @@
  ***************************************************************************/
 
 #include "Q_ocr.h"
+#include "ADM_toolkitQt.h"
 
 extern void UI_purge(void);
 
@@ -46,7 +47,7 @@
 	smallCanvas->resize(w*2, h*2); 
 }
 
-Ui_ocrWindow::Ui_ocrWindow(void)
+Ui_ocrWindow::Ui_ocrWindow(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 	ui.textEdit->setReadOnly(TRUE);
@@ -260,8 +261,9 @@
 {
 	   Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
 	   ADM_assert(dialog==gDialog);
-		
-		
+
+	   qtUnregisterDialog(dialog);
+
 	   gDialog=NULL;
 	   delete dialog;
 	   return 1;	
@@ -273,8 +275,8 @@
 
 void 	*ADM_ocrUiSetup(void)
 {
-	
-	   Ui_ocrWindow *dialog=new Ui_ocrWindow;
+	   Ui_ocrWindow *dialog=new Ui_ocrWindow(qtLastRegisteredDialog());
+	   qtRegisterDialog(dialog);
 	   dialog->setModal(TRUE);
 	   dialog->show();
 	   gDialog=dialog;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -13,7 +13,7 @@
 	Q_OBJECT
 
 public:
-	Ui_ocrWindow(void);
+	Ui_ocrWindow(QWidget *parent);
 	~Ui_ocrWindow();
 	Ui_DialogOcr ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,157 +1,159 @@
-/***************************************************************************
-
-    \file Q_shell.cpp
-    \brief UI for qt4 shell interface
-    \author mean, fixount at free.fr 2007/2009
-        
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include <vector>
-#include "ADM_inttype.h"
-#include <QtCore/QFileInfo>
-#include <QtCore/QUrl>
-#include <QtGui/QKeyEvent>
-#include <QtGui/QGraphicsView>
-#include "Q_shell.h"
-#include "ADM_default.h"
-#include "ui_shell.h"
-/**
-    \fn qShell
-*/
-qShell::qShell(jsShellEvaluate *s) : QDialog()
-{
-    ADM_info("Setting up JS shell..\n");
-    evaluator=s;
-    for(int i=0;i<Q_SHELL_HISTORY;i++)
-                    history[i]=NULL;
-
-    ui.setupUi(this);
-    ui.textBrowser_2->installEventFilter(this);
-    connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
-    connect((ui.clear),SIGNAL(clicked(bool)),this,SLOT(clear(bool)));
-    print(SCRIPT_LOG_NORMAL,"Enter your commands then press the evaluate button or CTRL+ENTER.\n");
-    print(SCRIPT_LOG_NORMAL,"You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n");
-    indexRead=indexWrite=0;
-}
-/**
-    \fn ~qShell
-*/
-qShell::~qShell()
-{
-    ADM_info("Destroying JS shell..\n");
-    for(int i=0;i<Q_SHELL_HISTORY;i++)
-    {
-            if(history[i]) delete history[i];
-            history[i]=NULL;
-    }
-
-} 
-bool qShell::run(void)
-{
-    this->exec();
-    return true;
-}
-/**
-        \fn evaluate
-        \brief callback for the evaluate button
-*/
-bool            qShell::evaluate(bool x)
-{
-    ADM_info("Evaluating...\n");
-    // 1 Get text from UI
-    QString text=ui.textBrowser_2->toPlainText();
-    int dex=indexWrite & (Q_SHELL_HISTORY-1);
-    if(history[dex]) delete history[dex];
-    history[dex]=new QString(text);
-    indexWrite++;
-    indexRead=indexWrite-1; // Points to the last one
-
-    ui.textBrowser->setFontItalic(true);
-    ui.textBrowser->append(text);
-    ui.textBrowser->setFontItalic(false);
-    ui.textBrowser_2->setPlainText("");
-    evaluator(text.toAscii());
-    return true;
-}
-/**
-    \fn print
-*/
-bool qShell::print(SCRIPT_LOG_TYPE type,const char *s)
-{
-    QString string(s);
-    //printf("**%s",s);
-    switch(type)
-    {
-        case SCRIPT_LOG_NORMAL: ui.textBrowser->setTextColor(QColor(0,0,0));break;
-        case SCRIPT_LOG_ERROR : ui.textBrowser->setTextColor(QColor(255,0,0));break;
-    }
-    ui.textBrowser->insertPlainText(string);
-    ui.textBrowser->setTextColor(QColor(0,0,0));
-    return true;
-}
-/**
-    \fn clear
-*/
-bool qShell::clear(bool x)
-{
-    ui.textBrowser->clear();
-    return true;
-}
-/**
-    \fn eventFilter
-    \brief 
-*/
+/***************************************************************************
+
+    \file Q_shell.cpp
+    \brief UI for qt4 shell interface
+    \author mean, fixount at free.fr 2007/2009
+        
+    
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include <vector>
+#include "ADM_inttype.h"
+#include <QtCore/QFileInfo>
+#include <QtCore/QUrl>
+#include <QtGui/QKeyEvent>
+#include <QtGui/QGraphicsView>
+#include "Q_shell.h"
+#include "ADM_default.h"
+#include "ui_shell.h"
+#include "ADM_toolkitQt.h"
+
+/**
+    \fn qShell
+*/
+qShell::qShell(QWidget *parent, jsShellEvaluate *s) : QDialog(parent)
+{
+    ADM_info("Setting up JS shell..\n");
+    evaluator=s;
+    for(int i=0;i<Q_SHELL_HISTORY;i++)
+                    history[i]=NULL;
+
+    ui.setupUi(this);
+    ui.textBrowser_2->installEventFilter(this);
+    connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
+    connect((ui.clear),SIGNAL(clicked(bool)),this,SLOT(clear(bool)));
+    print(SCRIPT_LOG_NORMAL,"Enter your commands then press the evaluate button or CTRL+ENTER.\n");
+    print(SCRIPT_LOG_NORMAL,"You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n");
+    indexRead=indexWrite=0;
+}
+/**
+    \fn ~qShell
+*/
+qShell::~qShell()
+{
+    ADM_info("Destroying JS shell..\n");
+    for(int i=0;i<Q_SHELL_HISTORY;i++)
+    {
+            if(history[i]) delete history[i];
+            history[i]=NULL;
+    }
+
+} 
+bool qShell::run(void)
+{
+    this->exec();
+    return true;
+}
+/**
+        \fn evaluate
+        \brief callback for the evaluate button
+*/
+bool            qShell::evaluate(bool x)
+{
+    ADM_info("Evaluating...\n");
+    // 1 Get text from UI
+    QString text=ui.textBrowser_2->toPlainText();
+    int dex=indexWrite & (Q_SHELL_HISTORY-1);
+    if(history[dex]) delete history[dex];
+    history[dex]=new QString(text);
+    indexWrite++;
+    indexRead=indexWrite-1; // Points to the last one
+
+    ui.textBrowser->setFontItalic(true);
+    ui.textBrowser->append(text);
+    ui.textBrowser->setFontItalic(false);
+    ui.textBrowser_2->setPlainText("");
+    evaluator(text.toAscii());
+    return true;
+}
+/**
+    \fn print
+*/
+bool qShell::print(SCRIPT_LOG_TYPE type,const char *s)
+{
+    QString string(s);
+    //printf("**%s",s);
+    switch(type)
+    {
+        case SCRIPT_LOG_NORMAL: ui.textBrowser->setTextColor(QColor(0,0,0));break;
+        case SCRIPT_LOG_ERROR : ui.textBrowser->setTextColor(QColor(255,0,0));break;
+    }
+    ui.textBrowser->insertPlainText(string);
+    ui.textBrowser->setTextColor(QColor(0,0,0));
+    return true;
+}
+/**
+    \fn clear
+*/
+bool qShell::clear(bool x)
+{
+    ui.textBrowser->clear();
+    return true;
+}
+/**
+    \fn eventFilter
+    \brief 
+*/
 bool qShell::eventFilter(QObject* watched, QEvent* event)
 {
-	if(event->type()==QEvent::KeyPress)
+	if(event->type()==QEvent::KeyPress)
     {
-			QKeyEvent *keyEvent = (QKeyEvent*)event;
+			QKeyEvent *keyEvent = (QKeyEvent*)event;
             if(keyEvent->modifiers() == Qt::ControlModifier)
                 switch (keyEvent->key())
                 {
-                    case Qt::Key_PageUp:   previousCommand();return true;break;
-                    case Qt::Key_PageDown: nextCommand();return true;break;
-                    default:break;
-                }
-    }
-    return QObject::eventFilter(watched, event);
-}
-/**
-    \fn previousCommand
-*/
-bool   qShell::previousCommand(void)
-{
-    int dex=indexRead & (Q_SHELL_HISTORY-1);
-    QString *copy=history[dex];
-    if(indexRead) indexRead--;
-    if(!copy) return true;
-    ui.textBrowser_2->clear();
-    ui.textBrowser_2->append(*copy);
-    return true;
-}
-/**
-    \fn nextCommand
-*/
-bool   qShell::nextCommand(void)
-{
-    if(indexRead+1<indexWrite) indexRead++;
-            else return true;
-    int dex=indexRead & (Q_SHELL_HISTORY-1);
-    QString *copy=history[dex];
-    if(!copy) return true;
-    ui.textBrowser_2->clear();
-    ui.textBrowser_2->append(*copy);
-    return true;
-}
-//EOF
-
-
+                    case Qt::Key_PageUp:   previousCommand();return true;break;
+                    case Qt::Key_PageDown: nextCommand();return true;break;
+                    default:break;
+                }
+    }
+    return QObject::eventFilter(watched, event);
+}
+/**
+    \fn previousCommand
+*/
+bool   qShell::previousCommand(void)
+{
+    int dex=indexRead & (Q_SHELL_HISTORY-1);
+    QString *copy=history[dex];
+    if(indexRead) indexRead--;
+    if(!copy) return true;
+    ui.textBrowser_2->clear();
+    ui.textBrowser_2->append(*copy);
+    return true;
+}
+/**
+    \fn nextCommand
+*/
+bool   qShell::nextCommand(void)
+{
+    if(indexRead+1<indexWrite) indexRead++;
+            else return true;
+    int dex=indexRead & (Q_SHELL_HISTORY-1);
+    QString *copy=history[dex];
+    if(!copy) return true;
+    ui.textBrowser_2->clear();
+    ui.textBrowser_2->append(*copy);
+    return true;
+}
+//EOF
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -24,7 +24,7 @@
     int                  indexWrite;
     int                  indexRead;
 public:
-                    qShell(jsShellEvaluate *s) ;
+                    qShell(QWidget *parent, jsShellEvaluate *s);
     virtual         ~qShell() ;
     bool            run(void);
     bool            print(SCRIPT_LOG_TYPE type, const char *s);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -5,6 +5,7 @@
 
 #include "Q_shell.h"
 #include "ADM_default.h"
+#include "ADM_toolkitQt.h"
 /**
     \fn qt4ShellLogger
     \brief Redirect output to the shell
@@ -22,10 +23,15 @@
 */
 bool ADM_startShell(jsShellEvaluate eval)
 {
-        qShell *s= new qShell(eval);
+        qShell *s= new qShell(qtLastRegisteredDialog(), eval);
+		qtRegisterDialog(s);
+
         ADM_scriptRegisterLogger((void *)s,qt4ShellLogger);
         s->run();
+
         ADM_scriptUnregisterLogger();
+		qtUnregisterDialog(s);
+
         delete s;
         return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,6 +18,7 @@
 #include "Q_x264.h"
 #include "ADM_paramList.h"
 #include "DIA_coreToolkit.h"
+#include "ADM_toolkitQt.h"
 
 static int pluginVersion=1;
 
@@ -61,19 +62,26 @@
 */
 bool x264_ui(x264_encoder *settings)
 {
-    x264Dialog dialog(NULL,settings);
+	bool success = false;
+    x264Dialog dialog(qtLastRegisteredDialog(), settings);
+
+	qtRegisterDialog(&dialog);
+
     if (dialog.exec() == QDialog::Accepted)
     {
             dialog.download();
             memcpy(settings,&myCopy,sizeof(myCopy));
-            return true;
+            success = true;
     }
-    return false;
+
+	qtUnregisterDialog(&dialog);
+
+    return success;
 }
 /**
 
 */  
-x264Dialog::x264Dialog(QWidget *parent, void *param)
+x264Dialog::x264Dialog(QWidget *parent, void *param) : QDialog(parent)
 {
        ui.setupUi(this);
         connect(ui.encodingModeComboBox, SIGNAL(currentIndexChanged(int)), this, SLOT(encodingModeComboBox_currentIndexChanged(int)));

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include "Q_asharp.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_asharpWindow::Ui_asharpWindow(ASHARP_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_asharpWindow::Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -111,12 +112,16 @@
 {
         uint8_t ret=0;
         
-        Ui_asharpWindow dialog(param,in);        
+        Ui_asharpWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyASharp *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_asharpWindow(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
+	Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param, AVDMGenericVideoStream *in);
 	~Ui_asharpWindow();
 	Ui_asharpDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,8 +21,9 @@
  ***************************************************************************/
 
 #include "Q_chromashift.h"
-#include <math.h>
-Ui_chromaShiftWindow::Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in)
+#include "ADM_toolkitQt.h"
+
+Ui_chromaShiftWindow::Ui_chromaShiftWindow(QWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -103,13 +104,18 @@
 uint8_t DIA_getChromaShift( AVDMGenericVideoStream *in,CHROMASHIFT_PARAM    *param )
 {
         uint8_t ret=0;
-        
-        Ui_chromaShiftWindow dialog(param,in);        
+
+        Ui_chromaShiftWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -14,7 +14,7 @@
  public:
      flyChromaShift *myCrop;
      ADM_QCanvas *canvas;
-     Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_chromaShiftWindow(CQWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_chromaShiftWindow();
      Ui_chromashiftDialog ui;
  public slots:

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include "Q_contrast.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_contrastWindow::Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_contrastWindow::Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -115,13 +116,17 @@
 uint8_t DIA_contrast(AVDMGenericVideoStream *in,CONTRAST_PARAM *param)
 {
         uint8_t ret=0;
-        
-        Ui_contrastWindow dialog(param,in);        
+        Ui_contrastWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyContrast *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
+	Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
 	~Ui_contrastWindow();
 	Ui_contrastDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -15,12 +15,13 @@
  ***************************************************************************/
 
 #include "Q_eq2.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_eq2Window::Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in)
+  Ui_eq2Window::Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -122,13 +123,18 @@
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in)
 {
         uint8_t ret=0;
-        
-        Ui_eq2Window dialog(param,in);        
+        Ui_eq2Window dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,7 +17,7 @@
 public:
 	flyEq2 *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in);
+	Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in);
 	~Ui_eq2Window();
 	Ui_eq2Dialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include "Q_hue.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_hueWindow::Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in)
+  Ui_hueWindow::Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -101,13 +102,18 @@
 uint8_t DIA_getHue(Hue_Param *param,AVDMGenericVideoStream *in)
 {
         uint8_t ret=0;
-        
-        Ui_hueWindow dialog(param,in);        
+        Ui_hueWindow dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyHue *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in);
+	Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in);
 	~Ui_hueWindow();
 	Ui_hueDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,12 +18,13 @@
 
 //#include "config.h"
 #include "Q_srt.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_srtWindow::Ui_srtWindow(SRT_POS_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_srtWindow::Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -123,7 +124,10 @@
         SRT_POS_PARAM param;
         param.fontSize=*size;
         param.position=*position;
-        Ui_srtWindow dialog(&param,in);        
+        Ui_srtWindow dialog(qtLastRegisteredDialog(), &param,in);
+
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(&param);
@@ -131,6 +135,9 @@
             *position=param.position;
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -22,7 +22,7 @@
 public:
 	flySrtPos *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_srtWindow(SRT_POS_PARAM *param, AVDMGenericVideoStream *in);
+	Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param, AVDMGenericVideoStream *in);
 	~Ui_srtWindow();
 	Ui_srtDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,14 +19,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#if 1
 #include "Q_crop.h"
+#include "ADM_toolkitQt.h"
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_cropWindow::Ui_cropWindow(crop *param,ADM_coreVideoFilter *in)
+Ui_cropWindow::Ui_cropWindow(QWidget* parent, crop *param,ADM_coreVideoFilter *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -155,15 +155,18 @@
 {
         uint8_t ret=0;
         
-        Ui_cropWindow dialog(param,in);        
+        Ui_cropWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&dialog);
+
         return ret;
 }
 //____________________________________
 // EOF
-
-#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,7 +17,7 @@
 public:
 	flyCrop *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_cropWindow(crop *param,ADM_coreVideoFilter *in);
+	Ui_cropWindow(QWidget* parent, crop *param,ADM_coreVideoFilter *in);
 	~Ui_cropWindow();
 	Ui_cropDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,10 +1,10 @@
 INCLUDE(vf_plugin)
 
 
-SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
-ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
-INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
-INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
+#SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
+#ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
+#INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
+#INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
 
 SET(ADM_vf_denoise3d_SRCS ADM_vidMPLD3Dlow.cpp)
 ADD_VIDEO_FILTER(ADM_vf_denoise3d SHARED ${ADM_vf_denoise3d_SRCS})

Modified: branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake	2011-09-14 18:01:57 UTC (rev 7549)
@@ -5,12 +5,13 @@
 MACRO(ADD_VIDEO_ENCODER_QT4 name srcQ headerQ uiQ)
         #INIT_VIDEO_ENCODER(${name})
         INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
+		INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/qt4/ADM_UIs/include/)
         QT4_WRAP_UI(qt4_ui ${uiQ}.ui)
         QT4_WRAP_CPP(qt4_cpp ${headerQ})
         ADD_LIBRARY(${name} SHARED ${ARGN} ${srcQ} ${qt4_cpp} ${qt4_ui})
 	AS_NEEDED(${name})
         ADD_TARGET_CFLAGS(${name} "-DADM_UI_TYPE_BUILD=4")
-        #TARGET_LINK_LIBRARIES( ${name} ADM_UIQT46  ADM_render6_qt4)
+        TARGET_LINK_LIBRARIES( ${name} ADM_UIQT46 )
         TARGET_LINK_LIBRARIES(${name} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY})
 
 ENDMACRO(ADD_VIDEO_ENCODER_QT4 )



From gruntster at mail.berlios.de  Wed Sep 14 20:46:23 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 14 Sep 2011 20:46:23 +0200
Subject: [Avidemux-svn-commit] r7550 - in branches/avidemux_2.6_branch_mean:
	avidemux/cli avidemux/gtk avidemux/qt4
	avidemux/qt4/ADM_jobs/src cmake
Message-ID: <20110914184624.60F4B48129A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-14 20:46:23 +0200 (Wed, 14 Sep 2011)
New Revision: 7550

Added:
   branches/avidemux_2.6_branch_mean/cmake/admWin32.rc.in
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[mswin] r3709

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-14 18:46:23 UTC (rev 7550)
@@ -22,11 +22,6 @@
 
 INCLUDE_DIRECTORIES(BEFORE "${CMAKE_BINARY_DIR}/config/cli/")
 
-###########################################
-# Executable
-###########################################
-ADD_EXECUTABLE(avidemux3_cli ${ADM_EXE_SRCS})
-
 ########################################
 # Add subdirectories 
 ########################################
@@ -38,6 +33,35 @@
 ADD_SOURCE_CFLAGS(../common/main.cpp "-DADM_SUBVERSION=${ADM_SUBVERSION}")
 
 ###########################################
+# Version Info
+###########################################
+if (WIN32)
+	# add icon and version info
+	SET(FILEVERSION_STRING "${VERSION}.${ADM_SUBVERSION}")
+	SET(PRODUCTVERSION_STRING "${VERSION}")
+	STRING(REPLACE "." "," FILEVERSION ${FILEVERSION_STRING})
+	STRING(REPLACE "." "," PRODUCTVERSION ${PRODUCTVERSION_STRING})
+	SET(PRODUCTVERSION "${PRODUCTVERSION},0")
+
+	IF (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-x86-64")
+	ELSE (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-i386")
+	ENDIF (ADM_CPU_X86_64)
+
+	SET(AVIDEMUX_ICON "adm.ico")
+	SET(ADM_WIN_RES "adm.obj")
+	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
+	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+endif (WIN32)
+
+###########################################
+# Executable
+###########################################
+ADD_EXECUTABLE(avidemux3_cli ${ADM_EXE_SRCS})
+
+###########################################
 # Construct common libraries
 ###########################################
 IF (ADM_DEBUG AND FIND_LEAKS)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-14 18:46:23 UTC (rev 7550)
@@ -25,11 +25,6 @@
 
 INCLUDE_DIRECTORIES(BEFORE "${CMAKE_BINARY_DIR}/config/gtk/")
 
-###########################################
-# Executable
-###########################################
-ADD_EXECUTABLE(avidemux3_gtk ${ADM_EXE_SRCS})
-
 ########################################
 # Add subdirectories 
 ########################################
@@ -41,6 +36,35 @@
 ADD_SOURCE_CFLAGS(../common/main.cpp "-DADM_SUBVERSION=${ADM_SUBVERSION}")
 
 ###########################################
+# Version Info
+###########################################
+if (WIN32)
+	# add icon and version info
+	SET(FILEVERSION_STRING "${VERSION}.${ADM_SUBVERSION}")
+	SET(PRODUCTVERSION_STRING "${VERSION}")
+	STRING(REPLACE "." "," FILEVERSION ${FILEVERSION_STRING})
+	STRING(REPLACE "." "," PRODUCTVERSION ${PRODUCTVERSION_STRING})
+	SET(PRODUCTVERSION "${PRODUCTVERSION},0")
+
+	IF (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-x86-64")
+	ELSE (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-i386")
+	ENDIF (ADM_CPU_X86_64)
+
+	SET(AVIDEMUX_ICON "adm.ico")
+	SET(ADM_WIN_RES "adm.obj")
+	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
+	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+endif (WIN32)
+
+###########################################
+# Executable
+###########################################
+ADD_EXECUTABLE(avidemux3_gtk ${ADM_EXE_SRCS})
+
+###########################################
 # Construct common libraries
 ###########################################
 IF (ADM_DEBUG AND FIND_LEAKS)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-14 18:46:23 UTC (rev 7550)
@@ -25,6 +25,30 @@
         )
 
 ###########################################
+# Version Info
+###########################################
+if (WIN32)
+	# add icon and version info
+	SET(FILEVERSION_STRING "${VERSION}.${ADM_SUBVERSION}")
+	SET(PRODUCTVERSION_STRING "${VERSION}")
+	STRING(REPLACE "." "," FILEVERSION ${FILEVERSION_STRING})
+	STRING(REPLACE "." "," PRODUCTVERSION ${PRODUCTVERSION_STRING})
+	SET(PRODUCTVERSION "${PRODUCTVERSION},0")
+
+	IF (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-x86-64")
+	ELSE (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-i386")
+	ENDIF (ADM_CPU_X86_64)
+
+	SET(AVIDEMUX_ICON "adm.ico")
+	SET(ADM_WIN_RES "adm.obj")
+	SET(ADM_JOB_SRCS ${ADM_JOB_SRCS} ${ADM_WIN_RES})
+	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+endif (WIN32)
+
+###########################################
 # Executable
 ###########################################
 include(admCoreIncludes)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-14 18:46:23 UTC (rev 7550)
@@ -37,10 +37,6 @@
 # Add job control
 ###########################################
 ADD_SUBDIRECTORY(ADM_jobs)
-###########################################
-# Executable
-###########################################
-ADD_EXECUTABLE(avidemux3_qt4 ${ADM_EXE_SRCS})
 
 ########################################
 # Add subdirectories 
@@ -69,6 +65,35 @@
 ADD_SOURCE_CFLAGS(../common/main.cpp "-DADM_SUBVERSION=${ADM_SUBVERSION}")
 
 ###########################################
+# Version Info
+###########################################
+if (WIN32)
+	# add icon and version info
+	SET(FILEVERSION_STRING "${VERSION}.${ADM_SUBVERSION}")
+	SET(PRODUCTVERSION_STRING "${VERSION}")
+	STRING(REPLACE "." "," FILEVERSION ${FILEVERSION_STRING})
+	STRING(REPLACE "." "," PRODUCTVERSION ${PRODUCTVERSION_STRING})
+	SET(PRODUCTVERSION "${PRODUCTVERSION},0")
+
+	IF (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-x86-64")
+	ELSE (ADM_CPU_X86_64)
+		SET(WIN_RES_TARGET "pe-i386")
+	ENDIF (ADM_CPU_X86_64)
+
+	SET(AVIDEMUX_ICON "adm.ico")
+	SET(ADM_WIN_RES "adm.obj")
+	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
+	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+endif (WIN32)
+
+###########################################
+# Executable
+###########################################
+ADD_EXECUTABLE(avidemux3_qt4 ${ADM_EXE_SRCS})
+
+###########################################
 # Construct common libraries
 ###########################################
 IF (ADM_DEBUG AND FIND_LEAKS)

Added: branches/avidemux_2.6_branch_mean/cmake/admWin32.rc.in
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admWin32.rc.in	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admWin32.rc.in	2011-09-14 18:46:23 UTC (rev 7550)
@@ -0,0 +1,31 @@
+VS_VERSION_INFO VERSIONINFO
+ FILEVERSION     ${FILEVERSION}
+ PRODUCTVERSION  ${PRODUCTVERSION}
+ FILEFLAGSMASK   0x3fL
+ FILEFLAGS       0x0L
+ FILEOS          0x4L
+ FILETYPE        0x1L
+ FILESUBTYPE     0x0L
+BEGIN
+    BLOCK "StringFileInfo"
+    BEGIN
+        BLOCK "040904B0"
+        BEGIN
+            VALUE "CompanyName",      "Free Software Foundation"
+            VALUE "FileDescription",  "Avidemux ${PRODUCTVERSION_STRING}"
+            VALUE "FileVersion",      "${FILEVERSION_STRING}"
+            VALUE "InternalName",     "avidemux"
+            VALUE "LegalCopyright",   "Copyright ? 2001-2011 Free Software Foundation"
+            VALUE "OriginalFilename", ""
+            VALUE "ProductName",      "Avidemux"
+            VALUE "ProductVersion",   "${PRODUCTVERSION_STRING}"
+        END
+    END
+
+    BLOCK "VarFileInfo"
+    BEGIN
+        VALUE "Translation", 0x409, 1200
+    END
+END
+
+100 ICON "${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/common/xpm/${AVIDEMUX_ICON}"
\ No newline at end of file



From mean at mail.berlios.de  Wed Sep 14 21:21:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 14 Sep 2011 21:21:19 +0200
Subject: [Avidemux-svn-commit] r7551 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20110914192119.D6BC448129A@sheep.berlios.de>

Author: mean
Date: 2011-09-14 21:21:19 +0200 (Wed, 14 Sep 2011)
New Revision: 7551

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
Log:
[editor] Be more verbose when requestion out of range video/segmens

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-14 18:46:23 UTC (rev 7550)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2011-09-14 19:21:19 UTC (rev 7551)
@@ -228,7 +228,12 @@
 */
 _SEGMENT     *ADM_EditorSegment::getSegment(int i)
 {
-    ADM_assert(i<segments.size());
+    int sz=segments.size();
+    if(i>=sz)
+    {
+        ADM_info("Request for segment out of range : %d / %d\n",i,sz);
+        ADM_assert(0);
+    }
     return &(segments[i]);
 }
 /**
@@ -237,7 +242,12 @@
 */
 _VIDEOS     *ADM_EditorSegment::getRefVideo(int i)
 {
-    ADM_assert(i<videos.size());
+    int sz=videos.size();
+    if(i>=sz)
+    {
+        ADM_info("Request for video out of range : %d / %d\n",i,sz);
+        ADM_assert(0);
+    }
     return &(videos[i]);
 }
 /**



From mean at mail.berlios.de  Thu Sep 15 07:49:38 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 07:49:38 +0200
Subject: [Avidemux-svn-commit] r7552 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110915054938.59AB9481306@sheep.berlios.de>

Author: mean
Date: 2011-09-15 07:49:37 +0200 (Thu, 15 Sep 2011)
New Revision: 7552

Added:
   branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake
Log:
[build] Fix using windres when cross compiling with xmingw

Added: branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake	2011-09-15 05:49:37 UTC (rev 7552)
@@ -0,0 +1,7 @@
+IF(WIN32)
+        IF(CROSS)
+                SET(WINDRES ${CMAKE_CROSS_PREFI}-windres)
+        ELSE(CROSS)
+                SET(WINDRES windres.exe)
+        ENDIF(CROSS)
+ENDIF(WIN32)



From mean at mail.berlios.de  Thu Sep 15 07:49:39 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 07:49:39 +0200
Subject: [Avidemux-svn-commit] r7553 - in
	branches/avidemux_2.6_branch_mean/avidemux: cli gtk qt4
	qt4/ADM_jobs/src
Message-ID: <20110915054939.887EC481306@sheep.berlios.de>

Author: mean
Date: 2011-09-15 07:49:39 +0200 (Thu, 15 Sep 2011)
New Revision: 7553

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[build] Fix using windres when cross compiling with xmingw

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-15 05:49:37 UTC (rev 7552)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
@@ -53,7 +53,8 @@
 	SET(ADM_WIN_RES "adm.obj")
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+        include(admWindRes)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINDRES} -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-15 05:49:37 UTC (rev 7552)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
@@ -56,7 +56,8 @@
 	SET(ADM_WIN_RES "adm.obj")
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+        include(admWindRes)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINRES}.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-15 05:49:37 UTC (rev 7552)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
@@ -44,8 +44,9 @@
 	SET(AVIDEMUX_ICON "adm.ico")
 	SET(ADM_WIN_RES "adm.obj")
 	SET(ADM_JOB_SRCS ${ADM_JOB_SRCS} ${ADM_WIN_RES})
+        include(admWindRes)
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINRES} -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 05:49:37 UTC (rev 7552)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
@@ -84,8 +84,9 @@
 	SET(AVIDEMUX_ICON "adm.ico")
 	SET(ADM_WIN_RES "adm.obj")
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
+        include(admWindRes)
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND windres.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINDRES} -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################



From mean at mail.berlios.de  Thu Sep 15 08:37:14 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 08:37:14 +0200
Subject: [Avidemux-svn-commit] r7554 - in
	branches/avidemux_2.6_branch_mean/avidemux: gtk qt4/ADM_jobs/src
Message-ID: <20110915063714.7C9C2481306@sheep.berlios.de>

Author: mean
Date: 2011-09-15 08:37:14 +0200 (Thu, 15 Sep 2011)
New Revision: 7554

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
Log:
[build] fix typo (winres vs windres)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-09-15 06:37:14 UTC (rev 7554)
@@ -57,7 +57,7 @@
 	SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ${ADM_WIN_RES})
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
         include(admWindRes)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINRES}.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINDRES}.exe -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-15 05:49:39 UTC (rev 7553)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-09-15 06:37:14 UTC (rev 7554)
@@ -46,7 +46,7 @@
 	SET(ADM_JOB_SRCS ${ADM_JOB_SRCS} ${ADM_WIN_RES})
         include(admWindRes)
 	CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admWin32.rc.in" ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc IMMEDIATE)
-	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINRES} -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
+	ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} COMMAND ${WINDRES} -F ${WIN_RES_TARGET} -i ${CMAKE_CURRENT_BINARY_DIR}/admWin.rc -o ${CMAKE_CURRENT_BINARY_DIR}/${ADM_WIN_RES} -O coff --define VS_VERSION_INFO=1)
 endif (WIN32)
 
 ###########################################



From mean at mail.berlios.de  Thu Sep 15 09:00:14 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 09:00:14 +0200
Subject: [Avidemux-svn-commit] r7555 - in branches/avidemux_2.6_branch_mean:
	cmake foreignBuilds
Message-ID: <20110915070014.13F06481306@sheep.berlios.de>

Author: mean
Date: 2011-09-15 09:00:13 +0200 (Thu, 15 Sep 2011)
New Revision: 7555

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_qt4
Log:
[build] windres, part2

Modified: branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake	2011-09-15 06:37:14 UTC (rev 7554)
+++ branches/avidemux_2.6_branch_mean/cmake/admWindRes.cmake	2011-09-15 07:00:13 UTC (rev 7555)
@@ -1,7 +1,5 @@
-IF(WIN32)
         IF(CROSS)
-                SET(WINDRES ${CMAKE_CROSS_PREFI}-windres)
+                SET(WINDRES ${CMAKE_WINDRES})
         ELSE(CROSS)
                 SET(WINDRES windres.exe)
         ENDIF(CROSS)
-ENDIF(WIN32)

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	2011-09-15 06:37:14 UTC (rev 7554)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	2011-09-15 07:00:13 UTC (rev 7555)
@@ -14,6 +14,7 @@
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
         -DQT_HOME:STRING=$QT_HOME \
 	-DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
+        -DCMAKE_WINDRES=$CROSS_PREFIX-windres \
         -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
         -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
         -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_qt4
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_qt4	2011-09-15 06:37:14 UTC (rev 7554)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_qt4	2011-09-15 07:00:13 UTC (rev 7555)
@@ -13,6 +13,7 @@
 cmake   -DCROSS=$MINGW \
         -DCMAKE_INCLUDE_PATH=$MINGW/include -DCMAKE_LIBRARY_PATH=$MINGW/lib \
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
+        -DCMAKE_WINDRES=$CROSS_PREFIX-windres \
         -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
         -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
         -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \



From gruntster at mail.berlios.de  Thu Sep 15 14:22:38 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 14:22:38 +0200
Subject: [Avidemux-svn-commit] r7556 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux_core/ADM_core/include
	avidemux_core/ADM_core/src
Message-ID: <20110915122239.342A148135A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 14:22:38 +0200 (Thu, 15 Sep 2011)
New Revision: 7556

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_misc.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_misc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
Log:
[core] refactor mainly around mswin functions

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 07:00:13 UTC (rev 7555)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 12:22:38 UTC (rev 7556)
@@ -17,34 +17,20 @@
  *                                                                         *
  ***************************************************************************/
 #include "ADM_cpp.h"
-
-#ifdef __MINGW32__
-#define UNICODE
-#include <windows.h>
-#endif
-
 #include "config.h"
 #include "ADM_default.h"
 #include "ADM_threads.h"
 #include "DIA_uiTypes.h"
 #include "ADM_preview.h"
+#include "ADM_win32.h"
 #define __DECLARE__
 #include "avi_vars.h"
 
 #include "prefs.h"
 #include "audio_out.h"
 #include "ADM_assert.h"
+#include "ADM_script2/include/ADM_scriptIf.h"
 
-
-static bool setPrefsDefault(void);
-extern void  ADM_lavInit();
-extern void  ADM_lavDestroy();
-extern void  ADM_lavFormatInit(void);
-extern bool  vdpauProbe(void);
-extern "C" {
-     extern uint8_t     ADM_InitMemcpy(void);
-};
-
 #ifdef USE_SDL
 extern "C" {
 	#ifdef __HAIKU__
@@ -57,9 +43,14 @@
 #include "ADM_render/GUI_sdlRender.h"
 #endif
 
-#include "ADM_script2/include/ADM_scriptIf.h"
-void onexit( void );
-//extern void automation(int argc, char **argv);
+static bool setPrefsDefault(void);
+extern void  ADM_lavInit();
+extern void  ADM_lavDestroy();
+extern void  ADM_lavFormatInit(void);
+extern bool  vdpauProbe(void);
+extern "C" {
+     extern uint8_t     ADM_InitMemcpy(void);
+};
 
 extern void registerVideoFilters( void );
 extern void filterCleanUp( void );
@@ -97,10 +88,6 @@
 extern void InitFactory(void);
 extern void InitCoreToolkit(void);
 
-#ifdef __MINGW32__
-extern int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
-#endif
-
 #if defined(_WIN64)
 extern LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo);
 #elif defined(_WIN32)
@@ -109,29 +96,46 @@
 extern void installSigHandler(void);
 #endif
 
-#ifdef _WIN32
-extern bool getWindowsVersion(char* version);
-extern void redirectStdoutToFile(void);
-#endif
-
 extern uint8_t  quotaInit(void);
 extern void ADMImage_stat( void );
-extern uint8_t win32_netInit(void);
 
 extern int UI_Init(int nargc,char **nargv);
 extern int UI_RunApp(void);
 extern bool UI_End(void);
-extern void renderDestroy(void);
 extern bool ADM_jobInit(void);
-extern bool ADM_jobShutDown(void);
+
 // Spidermonkey/Scripting stuff  
 #if defined(ADM_DEBUG) && defined(FIND_LEAKS)
 extern const char* new_progname;
 extern int check_leaks();
 #endif
 
-int main(int argc, char *argv[])
+void onexit(void);
+int startAvidemux(int argc, char *argv[]);
+
+int main(int _argc, char *_argv[])
 {
+	char **argv;
+	int argc;
+
+#ifdef _WIN32
+	getUtf8CommandLine(&argc, &argv);
+#else
+	argv = _argv;
+	argc = _argc;
+#endif
+
+	int exitVal = startAvidemux(argc, argv);
+
+#ifdef _WIN32
+	freeUtf8CommandLine(argc, argv);
+#endif
+
+	return exitVal;
+}
+
+int startAvidemux(int argc, char *argv[])
+{
 	char uiDesc[15];
 	getUIDescription(uiDesc);
 
@@ -204,6 +208,12 @@
 
     // getTime
     printf("Time: %s\n", ADM_epochToString(ADM_getSecondsSinceEpoch()));
+
+	for(int i = 0; i < argc; i++)
+	{
+		printf("%d: %s\n", i, argv[i]);
+	}
+
 	// Start counting memory
 	ADM_memStatInit();
     ADM_InitMemcpy();
@@ -229,37 +239,7 @@
     win32_netInit();
 #endif
 
-    // unicode command line...
-    char    **Aargv=NULL;
-    int     Aargc=0;
-#if _WIN32
-     wchar_t **wargv = CommandLineToArgvW (GetCommandLineW (), &Aargc);
-     if (wargv && Aargc)
-     {
-        Aargv=new char *[Aargc];
-        for(int i=0;i<Aargc;i++)
-        {
-            char *utf8;
-            wchar_t   *w=wargv[i];
-            int     lin=wcslen(w);
-            int     lout= wideCharStringToUtf8(w, lin,NULL);
-            utf8=new char[lout+1];
-            memset(utf8,0,lout+1);
-            wideCharStringToUtf8(w,lin,utf8);
-            Aargv[i]=utf8;
-        }
-        for(int i=0;i<Aargc;i++)
-            printf("%d : %s\n",i,Aargv[i]);
-        
-     }
-#else
-    Aargv=argv;
-    Aargc=argc;
-
-#endif
-
-
-    UI_Init(Aargc,Aargv);
+    UI_Init(argc, argv);
     AUDMEncoder_initDither();
 
     // Hook our UI...
@@ -394,7 +374,6 @@
     
     admPreview::destroy();
     UI_End();
-    //renderDestroy();
 
     ADM_ad_cleanup();
     ADM_ae_cleanup();

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_misc.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_misc.h	2011-09-15 07:00:13 UTC (rev 7555)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_misc.h	2011-09-15 12:22:38 UTC (rev 7556)
@@ -62,11 +62,6 @@
 
 	int getpriority(int which, int who);
 	int setpriority(int which, int who, int value);
-
-	#define RB_POWER_OFF 0x4321fedc
-	#define SHTDN_REASON_FLAG_PLANNED 0x80000000
-
-	int shutdown_win32(void);
 #else
 	#include <sys/resource.h>
 #endif

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h	2011-09-15 12:22:38 UTC (rev 7556)
@@ -0,0 +1,17 @@
+#if defined(_WIN32) && !defined ADM_WIN32_H
+#define ADM_WIN32_H
+
+uint8_t win32_netInit(void);
+int shutdown_win32(void);
+bool getWindowsVersion(char* version);
+void redirectStdoutToFile(void);
+
+int ansiStringToWideChar(const char *ansiString, int ansiStringLength, wchar_t *wideCharString);
+int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
+int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
+int ansiStringToUtf8(const char *ansiString, int ansiStringLength, char *utf8String);
+
+void getUtf8CommandLine(int *argc, char **argv[]);
+void freeUtf8CommandLine(int argc, char *argv[]);
+
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_misc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_misc.cpp	2011-09-15 07:00:13 UTC (rev 7555)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_misc.cpp	2011-09-15 12:22:38 UTC (rev 7556)
@@ -23,15 +23,12 @@
 #include <time.h>
 #include <math.h>
 #include <string.h>
-#ifndef __WIN32
-#include <unistd.h>
-#endif
-//#include <gtk/gtk.h>
 #include <ctype.h>
 #include <sys/time.h>
 
 #include "ADM_default.h"
 #include "ADM_assert.h"
+#include "ADM_win32.h"
 
 #include "ADM_vidMisc.h"
 #undef fopen

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-15 07:00:13 UTC (rev 7555)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-15 12:22:38 UTC (rev 7556)
@@ -2,21 +2,14 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <windows.h>
-
-#ifdef __MINGW32__
 #include <winsock2.h>
-#endif
-
 #include "ADM_default.h" 
 
-extern char *ADM_getBaseDir(void);
-
 void ADM_usleep(unsigned long us)
 {
 	Sleep(us/1000);
 }
 
-#ifdef __MINGW32__
 uint8_t win32_netInit(void)
 {
 	WSADATA wsaData;
@@ -34,7 +27,6 @@
 	printf("WinSock ok\n");
 	return 1;
 }
-#endif
 
 #ifndef HAVE_GETTIMEOFDAY
 extern "C"
@@ -507,4 +499,44 @@
 
 	return multiByteStringLen;
 }
+
+void getUtf8CommandLine(int *argc, char **argv[])
+{
+	wchar_t **wargv = CommandLineToArgvW(GetCommandLineW(), argc);
+
+	if (wargv)
+	{
+		*argv = new char *[*argc];
+
+		for (int i = 0; i < *argc; i++)
+		{
+			wchar_t *warg = wargv[i];
+			int wargLength = wcslen(warg);
+			int utf8Length = wideCharStringToUtf8(warg, wargLength, NULL);
+			char *utf8 = new char[utf8Length + 1];
+
+			wideCharStringToUtf8(warg, wargLength, utf8);
+			utf8[utf8Length] = '\0';
+			(*argv)[i] = utf8;
+		}
+
+		LocalFree(wargv);
+	}
+	else
+	{
+		*argc = 0;
+		*argv = NULL;
+	}
+}
+
+void freeUtf8CommandLine(int argc, char *argv[])
+{
+	for (int i = 0; i < argc; i++)
+	{
+		delete [] argv[i];
+	}
+
+	delete [] argv;
+}
+
 #endif	// __WIN32



From gruntster at mail.berlios.de  Thu Sep 15 16:55:44 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 16:55:44 +0200
Subject: [Avidemux-svn-commit] r7557 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux_core/ADM_core/include
Message-ID: <20110915145545.07E8648135A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 16:55:44 +0200 (Thu, 15 Sep 2011)
New Revision: 7557

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_apple.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_mswin.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[core] refactor mainly around registering exception handler

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 12:22:38 UTC (rev 7556)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 14:55:44 UTC (rev 7557)
@@ -23,6 +23,7 @@
 #include "DIA_uiTypes.h"
 #include "ADM_preview.h"
 #include "ADM_win32.h"
+#include "ADM_crashdump.h"
 #define __DECLARE__
 #include "avi_vars.h"
 
@@ -87,15 +88,6 @@
 extern void loadPlugins(void);
 extern void InitFactory(void);
 extern void InitCoreToolkit(void);
-
-#if defined(_WIN64)
-extern LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo);
-#elif defined(_WIN32)
-extern EXCEPTION_DISPOSITION ExceptionHandler(struct _EXCEPTION_RECORD *exceptionRecord, void *establisherFrame, struct _CONTEXT *contextRecord, void *dispatcherContext);
-#else
-extern void installSigHandler(void);
-#endif
-
 extern uint8_t  quotaInit(void);
 extern void ADMImage_stat( void );
 
@@ -118,6 +110,13 @@
 	char **argv;
 	int argc;
 
+#if defined(_WIN32) && (ADM_UI_TYPE_BUILD == ADM_UI_GTK || ADM_UI_TYPE_BUILD == ADM_UI_QT4)
+	// redirect output before registering exception handler so error dumps are captured
+	redirectStdoutToFile();
+#endif
+
+	installSigHandler();
+
 #ifdef _WIN32
 	getUtf8CommandLine(&argc, &argv);
 #else
@@ -125,34 +124,23 @@
 	argc = _argc;
 #endif
 
+#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
+	new_progname = argv[0];
+#endif
+
 	int exitVal = startAvidemux(argc, argv);
 
 #ifdef _WIN32
 	freeUtf8CommandLine(argc, argv);
 #endif
 
+	uninstallSigHandler();
+
 	return exitVal;
 }
 
 int startAvidemux(int argc, char *argv[])
 {
-	char uiDesc[15];
-	getUIDescription(uiDesc);
-
-#if defined(_WIN32)
-	if (strcmp(uiDesc, "CLI") != 0)
-		redirectStdoutToFile();
-#endif
-
-#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
-	new_progname = argv[0];
-#endif
-
-#ifndef _WIN32
-	// thx smurf uk :)
-    installSigHandler();
-#endif
-
     printf("*************************\n");
     printf("  Avidemux v" VERSION);
 
@@ -193,6 +181,8 @@
 	printf(" (PowerPC)");
 #endif
 
+	char uiDesc[15];
+	getUIDescription(uiDesc);
 	printf("\nUser Interface: %s\n", uiDesc);
 
 #ifdef _WIN32
@@ -206,7 +196,6 @@
 	printf("\nLarge file available: %d offset\n", __USE_FILE_OFFSET64);
 #endif
 
-    // getTime
     printf("Time: %s\n", ADM_epochToString(ADM_getSecondsSinceEpoch()));
 
 	for(int i = 0; i < argc; i++)
@@ -322,12 +311,6 @@
     else
 		ADM_assert(0); 
 
-#if defined(_WIN64)
-	SetUnhandledExceptionFilter(ExceptionFilter);
-#elif defined(_WIN32)
-	__try1(ExceptionHandler);
-#endif
-
 #if defined( USE_VDPAU) 
   #if (ADM_UI_TYPE_BUILD!=ADM_UI_CLI)
     printf("Probing for VDPAU...\n");
@@ -343,10 +326,6 @@
 
     UI_RunApp();
 
-#if defined(_WIN32) && defined(_X86_)
-	__except1;
-#endif
-
     printf("Normal exit\n");
     return 0;
 }

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump.h	2011-09-15 14:55:44 UTC (rev 7557)
@@ -0,0 +1,8 @@
+#ifndef ADM_CRASHDUMP_H
+#define ADM_CRASHDUMP_H
+
+#include "ADM_crashdump_mswin.h"
+#include "ADM_crashdump_apple.h"
+#include "ADM_crashdump_unix.h"
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_apple.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_apple.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_apple.h	2011-09-15 14:55:44 UTC (rev 7557)
@@ -0,0 +1,7 @@
+#if defined(APPLE) && !defined ADM_CRASHDUMP_APPLE_H
+#define ADM_CRASHDUMP_APPLE_H
+
+void installSigHandler(void);
+#define uninstallSigHandler()
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_mswin.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_mswin.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_mswin.h	2011-09-15 14:55:44 UTC (rev 7557)
@@ -0,0 +1,14 @@
+#if defined(_WIN32) && !defined ADM_CRASHDUMP_MSWIN_H
+#define ADM_CRASHDUMP_MSWIN_H
+
+#if defined(_WIN64)
+LONG WINAPI ExceptionFilter(struct _EXCEPTION_POINTERS *exceptionInfo);
+#define installSigHandler() SetUnhandledExceptionFilter(ExceptionFilter)
+#define uninstallSigHandler()
+#else
+EXCEPTION_DISPOSITION ExceptionHandler(struct _EXCEPTION_RECORD *exceptionRecord, void *establisherFrame, struct _CONTEXT *contextRecord, void *dispatcherContext);
+#define installSigHandler() __try1(ExceptionHandler)
+#define uninstallSigHandler() __except1
+#endif
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h	2011-09-15 14:55:44 UTC (rev 7557)
@@ -0,0 +1,7 @@
+#if defined(UNIX) && !defined ADM_CRASHDUMP_UNIX_H
+#define ADM_CRASHDUMP_UNIX_H
+
+void installSigHandler(void);
+#define uninstallSigHandler()
+
+#endif



From gruntster at mail.berlios.de  Thu Sep 15 17:05:30 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 17:05:30 +0200
Subject: [Avidemux-svn-commit] r7558 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include
Message-ID: <20110915150530.A771C48135A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 17:05:30 +0200 (Thu, 15 Sep 2011)
New Revision: 7558

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h
Log:
[core] everyone has to be different...

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h	2011-09-15 14:55:44 UTC (rev 7557)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_crashdump_unix.h	2011-09-15 15:05:30 UTC (rev 7558)
@@ -1,4 +1,4 @@
-#if defined(UNIX) && !defined ADM_CRASHDUMP_UNIX_H
+#if defined(unix) && !defined ADM_CRASHDUMP_UNIX_H
 #define ADM_CRASHDUMP_UNIX_H
 
 void installSigHandler(void);



From mean at mail.berlios.de  Thu Sep 15 18:15:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 18:15:19 +0200
Subject: [Avidemux-svn-commit] r7559 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20110915161519.94DB348135A@sheep.berlios.de>

Author: mean
Date: 2011-09-15 18:15:19 +0200 (Thu, 15 Sep 2011)
New Revision: 7559

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
Log:
[Editor] Make sure audioSeg =0 when closing a video

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-15 15:05:30 UTC (rev 7558)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2011-09-15 16:15:19 UTC (rev 7559)
@@ -444,6 +444,7 @@
 uint8_t ADM_Composer::cleanup (void)
 {
   _segments.deleteAll();
+  _audioSeg = 0;
   return 1;
 }
 



From mean at mail.berlios.de  Thu Sep 15 18:15:21 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 18:15:21 +0200
Subject: [Avidemux-svn-commit] r7560 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110915161521.C59BE48135A@sheep.berlios.de>

Author: mean
Date: 2011-09-15 18:15:21 +0200 (Thu, 15 Sep 2011)
New Revision: 7560

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
Log:
[render] make sure we have a valid renderer

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-15 16:15:19 UTC (rev 7559)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-15 16:15:21 UTC (rev 7560)
@@ -210,7 +210,11 @@
 //----------------------------------------
 uint8_t renderUpdateImage(ADMImage *image)
 {
-    
+    if(!renderer)
+    {
+        ADM_warning("Render update image without renderer\n");
+        return 0;
+    }
     ADM_assert(!_lock);
     enableDraw=true;
     if(renderer->getPreferedImage()!=image->refType)



From mean at mail.berlios.de  Thu Sep 15 18:54:13 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 15 Sep 2011 18:54:13 +0200
Subject: [Avidemux-svn-commit] r7561 -
	branches/avidemux_2.5_branch_gruntster/po
Message-ID: <20110915165414.5A63848135F@sheep.berlios.de>

Author: mean
Date: 2011-09-15 18:54:12 +0200 (Thu, 15 Sep 2011)
New Revision: 7561

Modified:
   branches/avidemux_2.5_branch_gruntster/po/avidemux_it.ts
   branches/avidemux_2.5_branch_gruntster/po/it.po
Log:
[i18n] It translation update by zoppo

Modified: branches/avidemux_2.5_branch_gruntster/po/avidemux_it.ts
===================================================================
--- branches/avidemux_2.5_branch_gruntster/po/avidemux_it.ts	2011-09-15 16:15:21 UTC (rev 7560)
+++ branches/avidemux_2.5_branch_gruntster/po/avidemux_it.ts	2011-09-15 16:54:12 UTC (rev 7561)
@@ -4,3642 +4,2806 @@
 <context>
     <name></name>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="124"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="172"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="140"/>
         <source>Cannot initialize the video stream</source>
-        <translation>Impossibile inizializzare il flusso video</translation>
+        <translation type="obsolete">Impossibile inizializzare il flusso video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="129"/>
         <source>Dummy</source>
-        <translation>Fittizio</translation>
+        <translation type="obsolete">Fittizio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="130"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="178"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="230"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="148"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="242"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="66"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="75"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2060"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2159"/>
         <source>None</source>
-        <translation>Nessuno</translation>
+        <translation type="obsolete">Nessuno</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="138"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="186"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="175"/>
         <source>Filter init failed</source>
-        <translation>Inizializzazione filtro fallita</translation>
+        <translation type="obsolete">Inizializzazione filtro fallita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="142"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="190"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="186"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="333"/>
         <source>Encoding</source>
-        <translation>Codifica</translation>
+        <translation type="obsolete">Codifica</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="195"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="311"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="297"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="449"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="304"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="266"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="444"/>
         <source>Error while encoding</source>
-        <translation>Errore durante la codifica</translation>
+        <translation type="obsolete">Errore durante la codifica</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="202"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="318"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="304"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="456"/>
         <source>KeyFrame error</source>
-        <translation>Errore fotogramma chiave</translation>
+        <translation type="obsolete">Errore fotogramma chiave</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="202"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="318"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="304"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="456"/>
         <source>The beginning frame is not a key frame.
 Please move the A marker.</source>
-        <translation>Il fotogramma iniziale non ? un fotogramma chiave.
+        <translation type="obsolete">Il fotogramma iniziale non ? un fotogramma chiave.
 Spostare il segnalibro A.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="48"/>
         <source>_Dynamic range compression</source>
-        <translation>Compressione intervallo _dinamico</translation>
+        <translation type="obsolete">Compressione intervallo _dinamico</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="50"/>
         <source>_Time shift (ms):</source>
-        <translation>_Ritardo (ms):</translation>
+        <translation type="obsolete">_Ritardo (ms):</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="50"/>
         <source>Time shift value (ms)</source>
-        <translation>Ritardo (ms)</translation>
+        <translation type="obsolete">Ritardo (ms)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="58"/>
         <source>R_esampling (Hz):</source>
-        <translation>Ricampionam_ento (Hz):</translation>
+        <translation type="obsolete">Ricampionam_ento (Hz):</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="58"/>
         <source>Resampling frequency (Hz)</source>
-        <translation>Frequenza di ricampionamento (Hz)</translation>
+        <translation type="obsolete">Frequenza di ricampionamento (Hz)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="67"/>
         <source>Film to PAL</source>
-        <translation>Da film a PAL</translation>
+        <translation type="obsolete">Da film a PAL</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="68"/>
         <source>PAL to Film</source>
-        <translation>Da PAL a film</translation>
+        <translation type="obsolete">Da PAL a film</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="71"/>
         <source>_Frame rate change:</source>
-        <translation>Variazione _frame rate:</translation>
+        <translation type="obsolete">Variazione _frame rate:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="76"/>
         <source>Automatic (max -3 dB)</source>
-        <translation>Automatico (massimo -3 dB)</translation>
+        <translation type="obsolete">Automatico (massimo -3 dB)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="77"/>
         <source>Manual</source>
-        <translation>Manuale</translation>
+        <translation type="obsolete">Manuale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="79"/>
         <source>_Gain mode:</source>
-        <translation>Modalit? _guadagno:</translation>
+        <translation type="obsolete">Modalit? _guadagno:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="81"/>
         <source>G_ain value:</source>
-        <translation>V_alore guadagno:</translation>
+        <translation type="obsolete">V_alore guadagno:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="83"/>
         <source>Gain</source>
-        <translation>Amplificazione</translation>
+        <translation type="obsolete">Amplificazione</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="88"/>
         <source>No change</source>
-        <translation>Nessun cambiamento</translation>
+        <translation type="obsolete">Nessun cambiamento</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="89"/>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="290"/>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="213"/>
         <source>Mono</source>
-        <translation>Mono</translation>
+        <translation type="obsolete">Mono</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="90"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="266"/>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="288"/>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="211"/>
         <source>Stereo</source>
-        <translation>Stereo</translation>
+        <translation type="obsolete">Stereo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="91"/>
         <source>Stereo+surround</source>
-        <translation>Stereo + surround</translation>
+        <translation type="obsolete">Stereo + surround</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="92"/>
         <source>Stereo+center</source>
-        <translation>Stereo + centro</translation>
+        <translation type="obsolete">Stereo + centro</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="93"/>
         <source>Stereo+center+surround</source>
-        <translation>Stereo + centro + surround</translation>
+        <translation type="obsolete">Stereo + centro + surround</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="94"/>
         <source>Stereo front+stereo rear</source>
-        <translation>Stereo frontale + stereo posteriore</translation>
+        <translation type="obsolete">Stereo frontale + stereo posteriore</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="95"/>
         <source>5 channels</source>
-        <translation>5 canali</translation>
+        <translation type="obsolete">5 canali</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="96"/>
         <source>5.1</source>
-        <translation>5.1</translation>
+        <translation type="obsolete">5.1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="97"/>
         <source>Dolby Pro Logic</source>
-        <translation>Dolby Pro Logic</translation>
+        <translation type="obsolete">Dolby Pro Logic</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="98"/>
         <source>Dolby Pro Logic II</source>
-        <translation>Dolby Pro Logic II</translation>
+        <translation type="obsolete">Dolby Pro Logic II</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="101"/>
         <source>_Mixer:</source>
-        <translation>_Mixer:</translation>
+        <translation type="obsolete">_Mixer:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp" line="105"/>
         <source>Audio Filters</source>
-        <translation>Filtri audio</translation>
+        <translation type="obsolete">Filtri audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="55"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="124"/>
         <source>No data</source>
-        <translation>Nessun dato</translation>
+        <translation type="obsolete">Nessun dato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="228"/>
         <source>Bitrate Histogram</source>
-        <translation>Istogramma bitrate</translation>
+        <translation type="obsolete">Istogramma bitrate</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="80"/>
         <source>Fontconfig</source>
-        <translation>Fontconfig</translation>
+        <translation type="obsolete">Fontconfig</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="82"/>
         <source>SDL</source>
-        <translation>SDL</translation>
+        <translation type="obsolete">SDL</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="83"/>
         <source>XVideo</source>
-        <translation>XVideo</translation>
+        <translation type="obsolete">XVideo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="85"/>
         <source>AltiVec</source>
-        <translation>AltiVec</translation>
+        <translation type="obsolete">AltiVec</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="86"/>
         <source>PowerPC</source>
-        <translation>PowerPC</translation>
+        <translation type="obsolete">PowerPC</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="87"/>
         <source>x86</source>
-        <translation>x86</translation>
+        <translation type="obsolete">x86</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="88"/>
         <source>x86-64</source>
-        <translation>x86-64</translation>
+        <translation type="obsolete">x86-64</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="95"/>
         <source>Libraries</source>
-        <translation>Librerie</translation>
+        <translation type="obsolete">Librerie</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="96"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="328"/>
         <source>CPU</source>
-        <translation>CPU</translation>
+        <translation type="obsolete">CPU</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="100"/>
         <source>Built-in Support</source>
-        <translation>Supporto incorporato</translation>
+        <translation type="obsolete">Supporto incorporato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp" line="9"/>
         <source>_Hours:</source>
-        <translation>O_re:</translation>
+        <translation type="obsolete">O_re:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp" line="10"/>
         <source>_Minutes:</source>
-        <translation>_Minuti:</translation>
+        <translation type="obsolete">_Minuti:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp" line="11"/>
         <source>_Seconds:</source>
-        <translation>_Secondi:</translation>
+        <translation type="obsolete">_Secondi:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp" line="27"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="22"/>
         <source>_Swap U and V</source>
-        <translation>_Inverti U e V</translation>
+        <translation type="obsolete">_Inverti U e V</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp" line="28"/>
         <source>Show motion _vectors</source>
-        <translation>Mostra _vettori movimento</translation>
+        <translation type="obsolete">Mostra _vettori movimento</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp" line="30"/>
         <source>Decoder Options</source>
-        <translation>Opzioni decoder</translation>
+        <translation type="obsolete">Opzioni decoder</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="164"/>
         <source>_Use systray while encoding</source>
-        <translation>Rid_uci nell&apos;area di notifica durante la codifica</translation>
+        <translation type="obsolete">Rid_uci nell&apos;area di notifica durante la codifica</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="165"/>
         <source>_Accept non-standard audio frequency for DVD</source>
-        <translation>_Accetta frequenze audio non standard per DVD</translation>
+        <translation type="obsolete">_Accetta frequenze audio non standard per DVD</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="166"/>
         <source>Create _OpenDML files</source>
-        <translation>_Crea file OpenDML</translation>
+        <translation type="obsolete">_Crea file OpenDML</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="167"/>
         <source>Automatically _index MPEG files</source>
-        <translation>_Indicizza automaticamente i file MPEG</translation>
+        <translation type="obsolete">_Indicizza automaticamente i file MPEG</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="168"/>
         <source>Automatically _swap A and B if A&gt;B</source>
-        <translation>In_verti automaticamente A e B se A&gt;B</translation>
+        <translation type="obsolete">In_verti automaticamente A e B se A&gt;B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="169"/>
         <source>_Disable NUV audio sync</source>
-        <translation>_Disattiva sincronizzazione audio NUV</translation>
+        <translation type="obsolete">_Disattiva sincronizzazione audio NUV</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="171"/>
         <source>Automatically _build VBR map</source>
-        <translation>_Crea automaticamente la mappa VBR</translation>
+        <translation type="obsolete">_Crea automaticamente la mappa VBR</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="172"/>
         <source>Automatically _rebuild index</source>
-        <translation>_Ricostrusci automaticamente l&apos;indice</translation>
+        <translation type="obsolete">_Ricostrusci automaticamente l&apos;indice</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="173"/>
         <source>Automatically remove _packed bitstream</source>
-        <translation>Rimuovi automaticamente il _flusso di bit compresso</translation>
+        <translation type="obsolete">Rimuovi automaticamente il _flusso di bit compresso</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="175"/>
         <source>SIMD</source>
-        <translation>SIMD</translation>
+        <translation type="obsolete">SIMD</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="177"/>
         <source>Enable all SIMD</source>
-        <translation>Attiva tutti</translation>
+        <translation type="obsolete">Attiva tutti</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="178"/>
         <source>Enable MMX</source>
-        <translation>Attiva MMX</translation>
+        <translation type="obsolete">Attiva MMX</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="179"/>
         <source>Enable MMXEXT</source>
-        <translation>Attiva MMXEXT</translation>
+        <translation type="obsolete">Attiva MMXEXT</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="180"/>
         <source>Enable 3DNOW</source>
-        <translation>Attiva 3DNOW</translation>
+        <translation type="obsolete">Attiva 3DNOW</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="181"/>
         <source>Enable 3DNOWEXT</source>
-        <translation>Attiva 3DNOWEXT</translation>
+        <translation type="obsolete">Attiva 3DNOWEXT</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="182"/>
         <source>Enable SSE</source>
-        <translation>Attiva SSE</translation>
+        <translation type="obsolete">Attiva SSE</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="183"/>
         <source>Enable SSE2</source>
-        <translation>Attiva SSE2</translation>
+        <translation type="obsolete">Attiva SSE2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="184"/>
         <source>Enable SSE3</source>
-        <translation>Attiva SSE3</translation>
+        <translation type="obsolete">Attiva SSE3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="185"/>
         <source>Enable SSSE3</source>
-        <translation>Attiva SSSE3</translation>
+        <translation type="obsolete">Attiva SSSE3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="206"/>
         <source>_lavc threads:</source>
-        <translation>Thread _lavc:</translation>
+        <translation type="obsolete">Thread _lavc:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="208"/>
         <source>Multi-threading</source>
-        <translation>Multi-threading</translation>
+        <translation type="obsolete">Multi-threading</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="212"/>
         <source>High</source>
-        <translation>Alta</translation>
+        <translation type="obsolete">Alta</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="213"/>
         <source>Above normal</source>
-        <translation>Al di sopra del normale</translation>
+        <translation type="obsolete">Al di sopra del normale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="215"/>
         <source>Below normal</source>
-        <translation>Al di sotto del normale</translation>
+        <translation type="obsolete">Al di sotto del normale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="216"/>
         <source>Low</source>
-        <translation>Bassa</translation>
+        <translation type="obsolete">Bassa</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="218"/>
         <source>_Encoding priority:</source>
-        <translation>Priorit? di _codifica:</translation>
+        <translation type="obsolete">Priorit? di _codifica:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="219"/>
         <source>_Indexing/unpacking priority:</source>
-        <translation>Priorit? di _indicizzazione/decompressione:</translation>
+        <translation type="obsolete">Priorit? di _indicizzazione/decompressione:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="220"/>
         <source>_Playback priority:</source>
-        <translation>_Priorit? riproduzione:</translation>
+        <translation type="obsolete">_Priorit? riproduzione:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="222"/>
         <source>Prioritisation</source>
-        <translation>Prioritizzazione</translation>
+        <translation type="obsolete">Prioritizzazione</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="227"/>
         <source>_Use alternative tag for MP3 in .mp4</source>
-        <translation>_Usa etichette alternative per gli MP3 in file .mp4</translation>
+        <translation type="obsolete">_Usa etichette alternative per gli MP3 in file .mp4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="231"/>
         <source>Qt (OpenGL)</source>
-        <translation>Qt (OpenGL)</translation>
+        <translation type="obsolete">Qt (OpenGL)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="234"/>
         <source>XVideo (best)</source>
-        <translation>XVideo (migliore)</translation>
+        <translation type="obsolete">XVideo (migliore)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="238"/>
         <source>SDL (MS Windows GDI)</source>
-        <translation>SDL (MS Windows GDI)</translation>
+        <translation type="obsolete">SDL (MS Windows GDI)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="239"/>
         <source>SDL (MS Windows DirectX)</source>
-        <translation>SDL (MS Windows DirectX)</translation>
+        <translation type="obsolete">SDL (MS Windows DirectX)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="241"/>
         <source>SDL (good)</source>
-        <translation>SDL (buono)</translation>
+        <translation type="obsolete">SDL (buono)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="246"/>
         <source>Video _display:</source>
-        <translation>_Visualizzazione video:</translation>
+        <translation type="obsolete">_Visualizzazione video:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="249"/>
         <source>No alerts</source>
-        <translation>Nessun avviso</translation>
+        <translation type="obsolete">Nessun avviso</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="250"/>
         <source>Display only error alerts</source>
-        <translation>Visualizza solo gli avvisi di errore</translation>
+        <translation type="obsolete">Visualizza solo gli avvisi di errore</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="251"/>
         <source>Display all alerts</source>
-        <translation>Visualizza tutti gli avvisi</translation>
+        <translation type="obsolete">Visualizza tutti gli avvisi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="253"/>
         <source>_Message level:</source>
-        <translation>Livello _messaggio:</translation>
+        <translation type="obsolete">Livello _messaggio:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="259"/>
         <source>Master</source>
-        <translation>Master</translation>
+        <translation type="obsolete">Master</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="260"/>
         <source>_Volume control:</source>
-        <translation>Controllo _volume:</translation>
+        <translation type="obsolete">Controllo _volume:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="265"/>
         <source>No downmixing</source>
-        <translation>Nessun downmixing</translation>
+        <translation type="obsolete">Nessun downmixing</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="267"/>
         <source>Pro Logic</source>
-        <translation>Pro Logic</translation>
+        <translation type="obsolete">Pro Logic</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="268"/>
         <source>Pro Logic II</source>
-        <translation>Pro Logic II</translation>
+        <translation type="obsolete">Pro Logic II</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="270"/>
         <source>_Local playback downmixing:</source>
-        <translation>Downmixing riproduzione _locale:</translation>
+        <translation type="obsolete">Downmixing riproduzione _locale:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="284"/>
         <source>_AudioDevice</source>
-        <translation>Dispositivo _audio</translation>
+        <translation type="obsolete">Dispositivo _audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="289"/>
         <source>De_ringing</source>
-        <translation>_Deringing</translation>
+        <translation type="obsolete">_Deringing</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="290"/>
         <source>_Strength:</source>
-        <translation>_Intensit?:</translation>
+        <translation type="obsolete">_Intensit?:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="291"/>
         <source>Default Postprocessing</source>
-        <translation>Postprocessing predefinito</translation>
+        <translation type="obsolete">Postprocessing predefinito</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="298"/>
         <source>Use _Global GlyphSet</source>
-        <translation>Usa set di _glifi globale</translation>
+        <translation type="obsolete">Usa set di _glifi globale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="299"/>
         <source>Gl_yphSet:</source>
-        <translation>Set di gl_ifi:</translation>
+        <translation type="obsolete">Set di gl_ifi:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="304"/>
         <source>User Interface</source>
-        <translation>Interfaccia utente</translation>
+        <translation type="obsolete">Interfaccia utente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="308"/>
         <source>Automation</source>
-        <translation>Automazione</translation>
+        <translation type="obsolete">Automazione</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="312"/>
         <source>Input</source>
-        <translation>Input</translation>
+        <translation type="obsolete">Input</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="316"/>
         <source>Output</source>
-        <translation>Output</translation>
+        <translation type="obsolete">Output</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="324"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2059"/>
         <source>Video</source>
-        <translation>Video</translation>
+        <translation type="obsolete">Video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="332"/>
         <source>Threading</source>
-        <translation>Threading</translation>
+        <translation type="obsolete">Threading</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="336"/>
         <source>Global GlyphSet</source>
-        <translation>Set di glifi globale</translation>
+        <translation type="obsolete">Set di glifi globale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="340"/>
         <source>Preferences</source>
-        <translation>Preferenze</translation>
+        <translation type="obsolete">Preferenze</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="289"/>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="212"/>
         <source>Joint stereo</source>
-        <translation>Joint stereo</translation>
+        <translation type="obsolete">Joint stereo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="293"/>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="228"/>
         <source>C_hannel mode:</source>
-        <translation>Modalit? _canali:</translation>
+        <translation type="obsolete">Modalit? _canali:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="297"/>
         <source>CBR</source>
-        <translation>CBR</translation>
+        <translation type="obsolete">CBR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="298"/>
         <source>ABR</source>
-        <translation>ABR</translation>
+        <translation type="obsolete">ABR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="300"/>
         <source>Extreme</source>
-        <translation>Estremo</translation>
+        <translation type="obsolete">Estremo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="303"/>
         <source>Bit_rate mode:</source>
-        <translation>Modalit? bit_rate:</translation>
+        <translation type="obsolete">Modalit? bit_rate:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="323"/>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="311"/>
         <source>_Quality:</source>
-        <translation>_Qualit?:</translation>
+        <translation type="obsolete">_Qualit?:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="325"/>
         <source>_Disable reservoir</source>
-        <translation>_Disattiva riserva</translation>
+        <translation type="obsolete">_Disattiva riserva</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="329"/>
         <source>LAME Configuration</source>
-        <translation>Configurazione LAME</translation>
+        <translation type="obsolete">Configurazione LAME</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="21"/>
         <source>_Filter strength:</source>
-        <translation>Intensit? _filtro:</translation>
+        <translation type="obsolete">Intensit? _filtro:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="32"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="287"/>
         <source>_Horizontal deblocking</source>
-        <translation>Deblocking o_rizzontale</translation>
+        <translation type="obsolete">Deblocking o_rizzontale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="33"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="288"/>
         <source>_Vertical deblocking</source>
-        <translation>Deblocking _verticale</translation>
+        <translation type="obsolete">Deblocking _verticale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="34"/>
         <source>_Deringing</source>
-        <translation>_Deringing</translation>
+        <translation type="obsolete">_Deringing</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp" line="32"/>
         <source>_Shrink Factor:</source>
-        <translation>Fattore di _compressione:</translation>
+        <translation type="obsolete">Fattore di _compressione:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="35"/>
         <source>_VOB file(s):</source>
-        <translation>File _VOB:</translation>
+        <translation type="obsolete">File _VOB:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="36"/>
         <source>_IFO file:</source>
-        <translation>File _IFO:</translation>
+        <translation type="obsolete">File _IFO:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="42"/>
         <source>VOB to VobSub</source>
-        <translation>Da VOB a VobSub</translation>
+        <translation type="obsolete">Da VOB a VobSub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="46"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="51"/>
         <source>The selected vobfile does not exist</source>
-        <translation>Il file vob selezionato non esiste</translation>
+        <translation type="obsolete">Il file vob selezionato non esiste</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="56"/>
         <source>Please select a correct VobSub path/dir</source>
-        <translation>Seleziona un percorso VobSub corretto</translation>
+        <translation type="obsolete">Seleziona un percorso VobSub corretto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="210"/>
         <source>Max. bitrate:</source>
-        <translation>Bitrate massimo:</translation>
+        <translation type="obsolete">Bitrate massimo:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="211"/>
         <source>Average bitrate:</source>
-        <translation>Bitrate medio:</translation>
+        <translation type="obsolete">Bitrate medio:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="212"/>
         <source>Number of I frames:</source>
-        <translation>Numero di fotogrammi I:</translation>
+        <translation type="obsolete">Numero di fotogrammi I:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="213"/>
         <source>Number of P frames:</source>
-        <translation>Numero di fotogrammi P:</translation>
+        <translation type="obsolete">Numero di fotogrammi P:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="214"/>
         <source>Number of B frames:</source>
-        <translation>Numero di fotogrammi B:</translation>
+        <translation type="obsolete">Numero di fotogrammi B:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp" line="215"/>
         <source>Max. B frames:</source>
-        <translation>Numero massimo di fotogrammi B:</translation>
+        <translation type="obsolete">Numero massimo di fotogrammi B:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp" line="14"/>
         <source>Go to Time</source>
-        <translation>Vai al tempo</translation>
+        <translation type="obsolete">Vai al tempo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp" line="35"/>
         <source>Requant Configuration</source>
-        <translation>Configurazione Requant</translation>
+        <translation type="obsolete">Configurazione Requant</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="322"/>
         <source>NTSC 4:3</source>
-        <translation>NTSC 4:3</translation>
+        <translation type="obsolete">NTSC 4:3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="323"/>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="324"/>
         <source>NTSC 16:9</source>
-        <translation>NTSC 16:9</translation>
+        <translation type="obsolete">NTSC 16:9</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="325"/>
         <source>PAL 4:3</source>
-        <translation>PAL 4:3</translation>
+        <translation type="obsolete">PAL 4:3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="326"/>
         <source>PAL 16:9</source>
-        <translation>PAL 16:9</translation>
+        <translation type="obsolete">PAL 16:9</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="327"/>
         <source>1:1</source>
-        <translation>1:1</translation>
+        <translation type="obsolete">1:1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp" line="329"/>
         <source>Unknown</source>
-        <translation>Sconosciuto</translation>
+        <translation type="obsolete">Sconosciuto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="35"/>
         <source>Select VOB file(s)</source>
-        <translation>Seleziona file VOB</translation>
+        <translation type="obsolete">Seleziona file VOB</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="36"/>
         <source>Select IFO file</source>
-        <translation>Seleziona file IFO</translation>
+        <translation type="obsolete">Seleziona file IFO</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="37"/>
         <source>VobSub file:</source>
-        <translation>File VobSub:</translation>
+        <translation type="obsolete">File VobSub:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp" line="37"/>
         <source>Select VobSub file</source>
-        <translation>Seleziona file VobSub</translation>
+        <translation type="obsolete">Seleziona file VobSub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp" line="81"/>
         <source>Gettext</source>
-        <translation>Gettext</translation>
+        <translation type="obsolete">Gettext</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_jobs_save.cpp" line="7"/>
         <source>_Job name:</source>
-        <translation>Nome _attivit?:</translation>
+        <translation type="obsolete">Nome _attivit?:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_jobs_save.cpp" line="8"/>
         <source>Output _File:</source>
-        <translation>_File in uscita:</translation>
+        <translation type="obsolete">_File in uscita:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_jobs_save.cpp" line="8"/>
         <source>Select Video To Write</source>
-        <translation>Seleziona il video da scrivere</translation>
+        <translation type="obsolete">Seleziona il video da scrivere</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_jobs_save.cpp" line="11"/>
         <source>Save Job</source>
-        <translation>Salva attivit?</translation>
+        <translation type="obsolete">Salva attivit?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp" line="38"/>
         <source>Postprocessing</source>
-        <translation>Postprocessing</translation>
+        <translation type="obsolete">Postprocessing</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="264"/>
         <source>Select ECMAScript to Run</source>
-        <translation>Seleziona uno script ECMA da eseguire</translation>
+        <translation type="obsolete">Seleziona uno script ECMA da eseguire</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="295"/>
         <source>Audio filters cannot be applied in Copy mode</source>
-        <translation>I filtri audio non possono essere applicati in modalit? Copia</translation>
+        <translation type="obsolete">I filtri audio non possono essere applicati in modalit? Copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="295"/>
         <source>To apply filters the audio must be transcoded.</source>
-        <translation>Per applicare i filtri l&apos;audio deve essere convertito.</translation>
+        <translation type="obsolete">Per applicare i filtri l&apos;audio deve essere convertito.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="350"/>
         <source>Obsolete</source>
-        <translation>Obsoleto</translation>
+        <translation type="obsolete">Obsoleto</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="378"/>
         <source>Not coded in this version</source>
-        <translation>Non incluso in questa versione</translation>
+        <translation type="obsolete">Non incluso in questa versione</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="393"/>
         <source>Select Video/Image File...</source>
-        <translation>Seleziona un file video/immagine...</translation>
+        <translation type="obsolete">Seleziona un file video/immagine...</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="437"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="449"/>
         <source>Select Workbench to Save</source>
-        <translation>Seleziona il progetto da salvare</translation>
+        <translation type="obsolete">Seleziona il progetto da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="479"/>
         <source>Select Raw File to Save</source>
-        <translation>Seleziona il file Raw da salvare</translation>
+        <translation type="obsolete">Seleziona il file Raw da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="489"/>
         <source>Select AVI File...</source>
-        <translation>Seleziona un file video...</translation>
+        <translation type="obsolete">Seleziona un file video...</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="492"/>
         <source>Select AVI File to Append...</source>
-        <translation>Seleziona il file video da aggiungere...</translation>
+        <translation type="obsolete">Seleziona il file video da aggiungere...</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="496"/>
         <source>Select File to Save Audio</source>
-        <translation>Seleziona il file audio da salvare</translation>
+        <translation type="obsolete">Seleziona il file audio da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="530"/>
         <source>Select JPEG Sequence to Save</source>
-        <translation>Seleziona la sequenza JPEG da salvare</translation>
+        <translation type="obsolete">Seleziona la sequenza JPEG da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="533"/>
         <source>Select BMP to Save</source>
-        <translation>Seleziona il file BMP da salvare</translation>
+        <translation type="obsolete">Seleziona il file BMP da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="537"/>
         <source>Select JPEG to Save</source>
-        <translation>Seleziona il file JPEG da salvare</translation>
+        <translation type="obsolete">Seleziona il file JPEG da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="602"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="725"/>
         <source>Select File to Save</source>
-        <translation>Seleziona il file da salvare</translation>
+        <translation type="obsolete">Seleziona il file da salvare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="666"/>
         <source>Select MP3 to Load</source>
-        <translation>Seleziona il file MP3 da caricare</translation>
+        <translation type="obsolete">Seleziona il file MP3 da caricare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="669"/>
         <source>Select AC3 to Load</source>
-        <translation>Seleziona il file AC3 da caricare</translation>
+        <translation type="obsolete">Seleziona il file AC3 da caricare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="672"/>
         <source>Select WAV to Load</source>
-        <translation>Seleziona il file WAV da caricare</translation>
+        <translation type="obsolete">Seleziona il file WAV da caricare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="712"/>
         <source>Go to Frame</source>
-        <translation>Vai al fotogramma</translation>
+        <translation type="obsolete">Vai al fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="712"/>
         <source>_Go to frame:</source>
-        <translation>_Vai al fotogramma:</translation>
+        <translation type="obsolete">_Vai al fotogramma:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="717"/>
         <source>Out of bounds</source>
-        <translation>Oltre i limiti</translation>
+        <translation type="obsolete">Oltre i limiti</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="723"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="731"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="778"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1970"/>
         <source>Marker A &gt; B</source>
-        <translation>Segnalibro A &gt; B</translation>
+        <translation type="obsolete">Segnalibro A &gt; B</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="723"/>
         <source>An invalid frame range has been selected.  Make sure marker A is placed before marker B.</source>
-        <translation>L&apos;intervallo di fotogrammi selezionato non ? valido. Assicurati che il segnalibro A preceda il segnalibro B.</translation>
+        <translation type="obsolete">L&apos;intervallo di fotogrammi selezionato non ? valido. Assicurati che il segnalibro A preceda il segnalibro B.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="731"/>
         <source>Cannot copy.</source>
-        <translation>Impossibile copiare.</translation>
+        <translation type="obsolete">Impossibile copiare.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="743"/>
         <source>Something bad happened (II))</source>
-        <translation>C&apos;? stato qualche errore (II)</translation>
+        <translation type="obsolete">C&apos;? stato qualche errore (II)</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="757"/>
         <source>Are you sure?</source>
-        <translation>Sei sicuro?</translation>
+        <translation type="obsolete">Sei sicuro?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="778"/>
         <source>Cannot cut.</source>
-        <translation>Impossibile tagliare.</translation>
+        <translation type="obsolete">Impossibile tagliare.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="821"/>
         <source>Use custom value</source>
-        <translation>Usa valore personalizzato</translation>
+        <translation type="obsolete">Usa valore personalizzato</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="822"/>
         <source>Frame Rate</source>
-        <translation>Frame rate</translation>
+        <translation type="obsolete">Frame rate</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="822"/>
         <source>_Frames per second</source>
-        <translation>_Fotogrammi al secondo</translation>
+        <translation type="obsolete">_Fotogrammi al secondo</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="825"/>
         <source>PAL - 25 FPS</source>
-        <translation>PAL - 25 FPS</translation>
+        <translation type="obsolete">PAL - 25 FPS</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="826"/>
         <source>FILM - 24 FPS</source>
-        <translation>FILM - 24 FPS</translation>
+        <translation type="obsolete">FILM - 24 FPS</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="827"/>
         <source>NTSC - 30 FPS</source>
-        <translation>NTSC - 30 FPS</translation>
+        <translation type="obsolete">NTSC - 30 FPS</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="829"/>
         <source>Standard Frame Rate:</source>
-        <translation>Frame rate standard:</translation>
+        <translation type="obsolete">Frame rate standard:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="835"/>
         <source>Change Frame Rate</source>
-        <translation>Cambia frame rate</translation>
+        <translation type="obsolete">Cambia frame rate</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="871"/>
         <source>Width is not a multiple of 8</source>
-        <translation>La larghezza non ? un multiplo di 8</translation>
+        <translation type="obsolete">La larghezza non ? un multiplo di 8</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="872"/>
         <source>This will make trouble for AVI files.</source>
-        <translation>Questo causer? un problema per i file AVI.</translation>
+        <translation type="obsolete">Questo causer? un problema per i file AVI.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="883"/>
         <source>Video filters cannot be applied in Copy mode</source>
-        <translation>I filtri video non possono essere applicati in modalit? Copia</translation>
+        <translation type="obsolete">I filtri video non possono essere applicati in modalit? Copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="883"/>
         <source>To apply filters the video must be transcoded.</source>
-        <translation>Per applicare i filtri il video deve essere convertito.</translation>
+        <translation type="obsolete">Per applicare i filtri il video deve essere convertito.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="888"/>
         <source>Rebuild all Keyframes?</source>
-        <translation>Ricostruire tutti i fotogrammi chiave?</translation>
+        <translation type="obsolete">Ricostruire tutti i fotogrammi chiave?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="944"/>
         <source>Permission error</source>
-        <translation>Errore di permesso</translation>
+        <translation type="obsolete">Errore di permesso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="947"/>
         <source>&quot;%s&quot; does not exist.</source>
-        <translation>&quot;%s&quot; non esiste.</translation>
+        <translation type="obsolete">&quot;%s&quot; non esiste.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="950"/>
         <source>Error opening file</source>
-        <translation>Errore nell&apos;apertura del file</translation>
+        <translation type="obsolete">Errore nell&apos;apertura del file</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="950"/>
         <source>Error opening &quot;%s&quot;.</source>
-        <translation>Errore nell&apos;apertura di &quot;%s&quot;.</translation>
+        <translation type="obsolete">Errore nell&apos;apertura di &quot;%s&quot;.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="994"/>
         <source>Cannot open project using the video loader.</source>
-        <translation>Impossibile aprire il progetto usando il caricatore video.</translation>
+        <translation type="obsolete">Impossibile aprire il progetto usando il caricatore video.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="995"/>
         <source>Try &apos;File&apos; -&gt; &apos;Load/Run Project...&apos;</source>
-        <translation>Prova &apos;File&apos; -&gt; &apos;Carica/esegui progetto...&apos;</translation>
+        <translation type="obsolete">Prova &apos;File&apos; -&gt; &apos;Carica/esegui progetto...&apos;</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="997"/>
         <source>Could not open the file</source>
-        <translation>Impossibile aprire il file</translation>
+        <translation type="obsolete">Impossibile aprire il file</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1031"/>
         <source>Multiple Audio Tracks</source>
-        <translation>Tracce audio multiple</translation>
+        <translation type="obsolete">Tracce audio multiple</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1031"/>
         <source>The file you just loaded contains several audio tracks.
 Go to Audio-&gt;MainTrack to select the active one.</source>
-        <translation>Il file appena caricato contiene diverse tracce audio.
+        <translation type="obsolete">Il file appena caricato contiene diverse tracce audio.
 Vai a &apos;Audio&apos; -&gt; &apos;Traccia principale&apos; per selezionare la traccia attiva.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1085"/>
         <source>No audio decoder found for this file</source>
-        <translation>Nessun decoder trovato per questo file</translation>
+        <translation type="obsolete">Nessun decoder trovato per questo file</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1086"/>
         <source>Save (A+V) will generate bad AVI. Save audio will work.</source>
-        <translation>Salvare (A+V) generer? un file AVI difettoso. Salvare l&apos;audio funzioner?.</translation>
+        <translation type="obsolete">Salvare (A+V) generer? un file AVI difettoso. Salvare l&apos;audio funzioner?.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1145"/>
         <source>Something failed when appending</source>
-        <translation>Errore durante l&apos;aggiunta</translation>
+        <translation type="obsolete">Errore durante l&apos;aggiunta</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1156"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1989"/>
         <source>Something bad happened (II)</source>
-        <translation>C&apos;? stato qualche errore (II)</translation>
+        <translation type="obsolete">C&apos;? stato qualche errore (II)</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1220"/>
         <source>Cannot save the audio in copy mode</source>
-        <translation>Impossibile salvare l&apos;audio in modalit? copia</translation>
+        <translation type="obsolete">Impossibile salvare l&apos;audio in modalit? copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1220"/>
         <source>Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM.</source>
-        <translation>Seleziona il codec audio WAV PCM, altrimenti il file audio sar? PCM grezzo.</translation>
+        <translation type="obsolete">Seleziona il codec audio WAV PCM, altrimenti il file audio sar? PCM grezzo.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1228"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1596"/>
         <source>Saving audio</source>
-        <translation>Salvataggio audio in corso</translation>
+        <translation type="obsolete">Salvataggio audio in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1305"/>
         <source>Get Frame</source>
-        <translation>Prendi fotogramma</translation>
+        <translation type="obsolete">Prendi fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1305"/>
         <source>Cannot get this frame to save</source>
-        <translation>Impossibile salvare questo fotogramma</translation>
+        <translation type="obsolete">Impossibile salvare questo fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1343"/>
         <source>Mark A &gt; B</source>
-        <translation>Segnalibro A &gt; B</translation>
+        <translation type="obsolete">Segnalibro A &gt; B</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1343"/>
         <source>Set your markers correctly.</source>
-        <translation>Imposta i tuoi segnalibri correttamente.</translation>
+        <translation type="obsolete">Imposta i tuoi segnalibri correttamente.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1352"/>
         <source>Saving as set of jpegs</source>
-        <translation>Salvataggio come gruppo di jpeg in corso</translation>
+        <translation type="obsolete">Salvataggio come gruppo di jpeg in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1358"/>
         <source>Cannot decode frame</source>
-        <translation>Impossibile decodificare il fotogramma</translation>
+        <translation type="obsolete">Impossibile decodificare il fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1358"/>
         <source>Aborting.</source>
-        <translation>Annullamento in corso.</translation>
+        <translation type="obsolete">Annullamento in corso.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1369"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1388"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2333"/>
         <source>Done</source>
-        <translation>Fatto</translation>
+        <translation type="obsolete">Fatto</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1369"/>
         <source>Saved %d images.</source>
-        <translation>%d immagini salvate.</translation>
+        <translation type="obsolete">%d immagini salvate.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1371"/>
         <source>Error</source>
-        <translation>Errore</translation>
+        <translation type="obsolete">Errore</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1371"/>
         <source>Could not save all images.</source>
-        <translation>Impossibile salvare tutte le immagini.</translation>
+        <translation type="obsolete">Impossibile salvare tutte le immagini.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1388"/>
         <source>Saved &quot;%s&quot;.</source>
-        <translation>&quot;%s&quot; salvato.</translation>
+        <translation type="obsolete">&quot;%s&quot; salvato.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1390"/>
         <source>BMP op failed</source>
-        <translation>Op. BMP fallita</translation>
+        <translation type="obsolete">Op. BMP fallita</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1390"/>
         <source>Saving %s as a BMP file failed.</source>
-        <translation>Salvataggio di %s come file BMP fallito.</translation>
+        <translation type="obsolete">Salvataggio di %s come file BMP fallito.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1412"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1478"/>
         <source>Failed to open the file</source>
-        <translation>L&apos;apertura del file ? fallita</translation>
+        <translation type="obsolete">L&apos;apertura del file ? fallita</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1412"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1478"/>
         <source>Not a WAV file?</source>
-        <translation>Non ? un file WAV?</translation>
+        <translation type="obsolete">Non ? un file WAV?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1413"/>
         <source>WAV open file failed...</source>
-        <translation>L&apos;apertura del file WAV ? fallita...</translation>
+        <translation type="obsolete">L&apos;apertura del file WAV ? fallita...</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1550"/>
         <source>Cannot decompress audio frame</source>
-        <translation>Impossibile decomprimere il segmento audio</translation>
+        <translation type="obsolete">Impossibile decomprimere il segmento audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1564"/>
         <source>Memory Error</source>
-        <translation>Errore di memoria</translation>
+        <translation type="obsolete">Errore di memoria</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1617"/>
         <source>No frames to encode</source>
-        <translation>Nessun fotogramma da codificare</translation>
+        <translation type="obsolete">Nessun fotogramma da codificare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1617"/>
         <source>Please check markers. Is &quot;A&gt;&quot; == &quot;&gt;B&quot;?</source>
-        <translation>Controlla i segnalibri. ? &quot;A&gt;&quot; == &quot;&gt;B&quot;?</translation>
+        <translation type="obsolete">Controlla i segnalibri. ? &quot;A&gt;&quot; == &quot;&gt;B&quot;?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1756"/>
         <source>Saving raw video stream</source>
-        <translation>Salvataggio flusso video grezzo in corso</translation>
+        <translation type="obsolete">Salvataggio flusso video grezzo in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1905"/>
         <source>Checking video</source>
-        <translation>Verifica video in corso</translation>
+        <translation type="obsolete">Verifica video in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1921"/>
         <source>No error found</source>
-        <translation>Nessun errore trovato</translation>
+        <translation type="obsolete">Nessun errore trovato</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1925"/>
         <source>Errors found in %u frames</source>
-        <translation>Errori trovati in %u fotogrammi</translation>
+        <translation type="obsolete">Errori trovati in %u fotogrammi</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1943"/>
         <source>Cannot decompress the audio stream</source>
-        <translation>Impossibile decomprimere il flusso audio</translation>
+        <translation type="obsolete">Impossibile decomprimere il flusso audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1943"/>
         <source>Switch audio codec to Copy.</source>
-        <translation>Sposta la codifica audio su Copia.</translation>
+        <translation type="obsolete">Sposta la codifica audio su Copia.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1970"/>
         <source>Cannot delete the selection.</source>
-        <translation>Impossibile eliminare la selezione.</translation>
+        <translation type="obsolete">Impossibile eliminare la selezione.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1975"/>
         <source>You can&apos;t remove all frames</source>
-        <translation>Non puoi rimuovere tutti i fotogrammi</translation>
+        <translation type="obsolete">Non puoi rimuovere tutti i fotogrammi</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="1982"/>
         <source>Something bad happened</source>
-        <translation>C&apos;? stato qualche errore</translation>
+        <translation type="obsolete">C&apos;? stato qualche errore</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2051"/>
         <source>Could not get tracks info</source>
-        <translation>Impossibile ottenere informazioni sulla traccia</translation>
+        <translation type="obsolete">Impossibile ottenere informazioni sulla traccia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2059"/>
         <source>Take audio from video file</source>
-        <translation>Recupera audio dal file video</translation>
+        <translation type="obsolete">Recupera audio dal file video</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2060"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2159"/>
         <source>No audio</source>
-        <translation>Nessuna traccia audio</translation>
+        <translation type="obsolete">Nessuna traccia audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2061"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2160"/>
         <source>External AC3</source>
-        <translation>AC3 esterno</translation>
+        <translation type="obsolete">AC3 esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2061"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2160"/>
         <source>Take audio from external AC3 file</source>
-        <translation>Prendi l&apos;audio da un file AC3 esterno</translation>
+        <translation type="obsolete">Prendi l&apos;audio da un file AC3 esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2062"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2161"/>
         <source>External MP3</source>
-        <translation>MP3 esterno</translation>
+        <translation type="obsolete">MP3 esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2062"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2161"/>
         <source>Take audio from external MP3 file</source>
-        <translation>Prendi l&apos;audio da un file MP3 esterno</translation>
+        <translation type="obsolete">Prendi l&apos;audio da un file MP3 esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2063"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2162"/>
         <source>External WAV</source>
-        <translation>WAV esterno</translation>
+        <translation type="obsolete">WAV esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2063"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2162"/>
         <source>Take audio from external WAV file</source>
-        <translation>Prendi l&apos;audio da un file WAV esterno</translation>
+        <translation type="obsolete">Prendi l&apos;audio da un file WAV esterno</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2067"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2167"/>
         <source>_Audio source:</source>
-        <translation>Sorgente _audio:</translation>
+        <translation type="obsolete">Sorgente _audio:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2071"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2168"/>
         <source>_External file:</source>
-        <translation>File _esterno:</translation>
+        <translation type="obsolete">File _esterno:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2071"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2168"/>
         <source>Select file</source>
-        <translation>Seleziona un file</translation>
+        <translation type="obsolete">Seleziona un file</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2080"/>
         <source>Audio track %d (%s/%d channels/%d kbit per s/%d ms shift)</source>
-        <translation>Traccia audio %d (%s / %d canali / %d kbps / ritardo %d ms)</translation>
+        <translation type="obsolete">Traccia audio %d (%s / %d canali / %d kbps / ritardo %d ms)</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2086"/>
         <source>_Track from video:</source>
-        <translation>_Traccia dal video:</translation>
+        <translation type="obsolete">_Traccia dal video:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2096"/>
         <source>Main Audio Track</source>
-        <translation>Traccia audio principale</translation>
+        <translation type="obsolete">Traccia audio principale</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2102"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2180"/>
         <source>Cannot load</source>
-        <translation>Impossibile caricare</translation>
+        <translation type="obsolete">Impossibile caricare</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2102"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2180"/>
         <source>The selected audio file does not exist.</source>
-        <translation>Il file audio selezionato non esiste.</translation>
+        <translation type="obsolete">Il file audio selezionato non esiste.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2177"/>
         <source>Second Audio Track</source>
-        <translation>Traccia audio secondaria</translation>
+        <translation type="obsolete">Traccia audio secondaria</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2209"/>
         <source>Error loading the MP3 file</source>
-        <translation>Errore nel caricamento del file MP3</translation>
+        <translation type="obsolete">Errore nel caricamento del file MP3</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2218"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2240"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="2262"/>
         <source>Second track loaded</source>
-        <translation>Seconda traccia caricata</translation>
+        <translation type="obsolete">Seconda traccia caricata</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2232"/>
         <source>Error loading the AC3 file</source>
-        <translation>Errore nel caricamento del file AC3</translation>
+        <translation type="obsolete">Errore nel caricamento del file AC3</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2254"/>
         <source>Error loading the WAV file</source>
-        <translation>Errore nel caricamento del file WAV</translation>
+        <translation type="obsolete">Errore nel caricamento del file WAV</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2321"/>
         <source>Saving failed</source>
-        <translation>Salvataggio fallito</translation>
+        <translation type="obsolete">Salvataggio fallito</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2321"/>
         <source>Saving the job failed. Maybe you have permission issue with ~/.avidemux</source>
-        <translation>Il salvataggio dell&apos;attivit? ? fallito. Forse c&apos;? un problema di permesso con ~/.avidemux</translation>
+        <translation type="obsolete">Il salvataggio dell&apos;attivit? ? fallito. Forse c&apos;? un problema di permesso con ~/.avidemux</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2333"/>
         <source>File %s has been successfully saved.</source>
-        <translation>Il file %s ? stato salvato con successo.</translation>
+        <translation type="obsolete">Il file %s ? stato salvato con successo.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2337"/>
         <source>File %s was NOT saved correctly.</source>
-        <translation>Il file %s non ? stato salvato correttamente.</translation>
+        <translation type="obsolete">Il file %s non ? stato salvato correttamente.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2503"/>
         <source>AvsProxy</source>
-        <translation>AvsProxy</translation>
+        <translation type="obsolete">AvsProxy</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2503"/>
         <source>Failed to connect to avsproxy.
 Is it running ?</source>
-        <translation>Connessione a avsproxy fallita.
+        <translation type="obsolete">Connessione a avsproxy fallita.
 ? in esecuzione?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2508"/>
         <source>avsproxy</source>
-        <translation>avsproxy</translation>
+        <translation type="obsolete">avsproxy</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2536"/>
         <source>Frame type:</source>
-        <translation>Tipo di fotogramma:</translation>
+        <translation type="obsolete">Tipo di fotogramma:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2537"/>
         <source>Frame size:</source>
-        <translation>Dimensione fotogramma:</translation>
+        <translation type="obsolete">Dimensione fotogramma:</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2539"/>
         <source>Frame Hex Dump</source>
-        <translation>Hex Dump fotogramma</translation>
+        <translation type="obsolete">Hex Dump fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_edit.cpp" line="71"/>
         <source>Avidemux detected VBR MP3 audio in this file. For keeping audio/video in sync, time map is needed. Build it now?
 
 You can do it later with &quot;Audio -&gt; Build VBR Time Map&quot;.</source>
-        <translation>Avidemux ha rilevato un audio MP3 VBR in questo file. Per mantenere la sincronizzazione audio/video, ? necessaria la time map. Crearla ora?
+        <translation type="obsolete">Avidemux ha rilevato un audio MP3 VBR in questo file. Per mantenere la sincronizzazione audio/video, ? necessaria la time map. Crearla ora?
 
 Puoi farlo successivamente con \&quot;Audio -&gt; Crea time map VBR\&quot;.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="63"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="214"/>
         <source>Normal</source>
-        <translation>Normale</translation>
+        <translation type="obsolete">Normale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="64"/>
         <source>Mux every N video frames</source>
-        <translation>Esegui muxing ogni N fotogrammi</translation>
+        <translation type="obsolete">Esegui muxing ogni N fotogrammi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="65"/>
         <source>Mux by packet size</source>
-        <translation>Esegui muxing per dimensione pacchetto</translation>
+        <translation type="obsolete">Esegui muxing per dimensione pacchetto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="68"/>
         <source>Muxing _type:</source>
-        <translation>_Tipo di muxing:</translation>
+        <translation type="obsolete">_Tipo di muxing:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="69"/>
         <source>_Split every MB:</source>
-        <translation>_Dividi ogni MB:</translation>
+        <translation type="obsolete">_Dividi ogni MB:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="71"/>
         <source>Mux _every x video frames:</source>
-        <translation>_Esegui muxing ogni N fotogrammi:</translation>
+        <translation type="obsolete">_Esegui muxing ogni N fotogrammi:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="72"/>
         <source>Mux in _blocks of x bytes:</source>
-        <translation>Esegui muxing in _blocchi di X byte:</translation>
+        <translation type="obsolete">Esegui muxing in _blocchi di X byte:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="79"/>
         <source>AVI Muxer Options</source>
-        <translation>Opzioni Muxer AVI</translation>
+        <translation type="obsolete">Opzioni Muxer AVI</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="485"/>
         <source>DTS</source>
-        <translation>DTS</translation>
+        <translation type="obsolete">DTS</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="486"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="258"/>
         <source>PCM</source>
-        <translation>PCM</translation>
+        <translation type="obsolete">PCM</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="487"/>
         <source>MP2</source>
-        <translation>MP2</translation>
+        <translation type="obsolete">MP2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="488"/>
         <source>MP3</source>
-        <translation>MP3</translation>
+        <translation type="obsolete">MP3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="489"/>
         <source>WMA</source>
-        <translation>WMA</translation>
+        <translation type="obsolete">WMA</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="490"/>
         <source>LPCM</source>
-        <translation>LPCM</translation>
+        <translation type="obsolete">LPCM</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="491"/>
         <source>AC3</source>
-        <translation>AC3</translation>
+        <translation type="obsolete">AC3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="492"/>
         <source>Ogg Vorbis</source>
-        <translation>Ogg Vorbis</translation>
+        <translation type="obsolete">Ogg Vorbis</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="494"/>
         <source>AAC</source>
-        <translation>AAC</translation>
+        <translation type="obsolete">AAC</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="495"/>
         <source>QDM2</source>
-        <translation>QDM2</translation>
+        <translation type="obsolete">QDM2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="496"/>
         <source>AMR-NB</source>
-        <translation>AMR-NB</translation>
+        <translation type="obsolete">AMR-NB</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="497"/>
         <source>AMR-WB</source>
-        <translation>AMR-WB</translation>
+        <translation type="obsolete">AMR-WB</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="498"/>
         <source>MSADPCM</source>
-        <translation>MSADPCM</translation>
+        <translation type="obsolete">MSADPCM</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="499"/>
         <source>ULAW</source>
-        <translation>ULAW</translation>
+        <translation type="obsolete">ULAW</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="500"/>
         <source>IMA ADPCM</source>
-        <translation>IMA ADPCM</translation>
+        <translation type="obsolete">IMA ADPCM</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="501"/>
         <source>8-bit PCM</source>
-        <translation>PCM 8-bit</translation>
+        <translation type="obsolete">PCM 8-bit</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="503"/>
         <source>Unknown codec</source>
-        <translation>Codec sconosciuto</translation>
+        <translation type="obsolete">Codec sconosciuto</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2337"/>
         <source>Failed</source>
-        <translation>Fallito</translation>
+        <translation type="obsolete">Fallito</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_audiofilter/audiofilter_buildchain.cpp" line="288"/>
         <source>Codec Error</source>
-        <translation>Errore codec</translation>
+        <translation type="obsolete">Errore codec</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_audiofilter/audiofilter_buildchain.cpp" line="288"/>
         <source>The number of channels is greater than what the selected audio codec can do.
 Either change codec or use the mixer filter to have less channels.</source>
-        <translation>Il numero di canali ? maggiore di quello supportato dal codec audio selezionato.
+        <translation type="obsolete">Il numero di canali ? maggiore di quello supportato dal codec audio selezionato.
 Cambia il codec o usa il filtro mixer per ridurre i canali.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_audiofilter/audiofilter_buildchain.cpp" line="300"/>
         <source>[BuildChain] Encoder initialization failed</source>
-        <translation>[BuildChain] Inizializzazione encoder fallita</translation>
+        <translation type="obsolete">[BuildChain] Inizializzazione encoder fallita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_audiofilter/audiofilter_buildchain.cpp" line="300"/>
         <source>Not activated, make sure number of channels and bitrate are compatible with encoder!</source>
-        <translation>Non attivo, assicurarsi che il numero di canali e il bitrate siano compatibili con l&apos;encoder!</translation>
+        <translation type="obsolete">Non attivo, assicurarsi che il numero di canali e il bitrate siano compatibili con l&apos;encoder!</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_codecs/ADM_ffmp43.cpp" line="44"/>
         <source>Internal error finding codec</source>
-        <translation>Errore interno nel cercare il codec</translation>
+        <translation type="obsolete">Errore interno nel cercare il codec</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="127"/>
-        <location filename="../avidemux/ADM_ocr/adm_glyph.cpp" line="217"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="326"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="103"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="108"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="115"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="124"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="221"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="227"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="234"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="243"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="947"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1557"/>
         <source>File error</source>
-        <translation>Errore file</translation>
+        <translation type="obsolete">Errore file</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="127"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="944"/>
         <source>Cannot open &quot;%s&quot;.</source>
-        <translation>Impossibile aprire &quot;%s&quot;.</translation>
+        <translation type="obsolete">Impossibile aprire &quot;%s&quot;.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="140"/>
         <source>%s already exists.
 
 Do you want to replace it?</source>
-        <translation>%s gi? esiste.
+        <translation type="obsolete">%s gi? esiste.
 
 Vuoi sostituirlo?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="167"/>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="181"/>
         <source>It is possible that you are trying to overwrite an input file!</source>
-        <translation>? possibile che tu stia provando a sovrascrivere un file di ingresso!</translation>
+        <translation type="obsolete">? possibile che tu stia provando a sovrascrivere un file di ingresso!</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="192"/>
         <source>Cannot write the file</source>
-        <translation>Impossibile scrivere il file</translation>
+        <translation type="obsolete">Impossibile scrivere il file</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_coreUI/src/DIA_fileSel.cpp" line="192"/>
         <source>No write access to &quot;%s&quot;.</source>
-        <translation>Divieto di scrittura per &quot;%s&quot;.</translation>
+        <translation type="obsolete">Divieto di scrittura per &quot;%s&quot;.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="54"/>
         <source>AVI</source>
-        <translation>AVI</translation>
+        <translation type="obsolete">AVI</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="55"/>
         <source>AVI, dual audio</source>
-        <translation>AVI, doppio audio</translation>
+        <translation type="obsolete">AVI, doppio audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="56"/>
         <source>AVI, pack VOP</source>
-        <translation>AVI, compr. VOP</translation>
+        <translation type="obsolete">AVI, compr. VOP</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="57"/>
         <source>AVI, unpack VOP</source>
-        <translation>AVI, decompr. VOP</translation>
+        <translation type="obsolete">AVI, decompr. VOP</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="58"/>
         <source>MPEG-PS (A+V)</source>
-        <translation>MPEG-PS (A+V)</translation>
+        <translation type="obsolete">MPEG-PS (A+V)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="59"/>
         <source>MPEG-TS (A+V)</source>
-        <translation>MPEG-TS (A+V)</translation>
+        <translation type="obsolete">MPEG-TS (A+V)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="60"/>
         <source>MPEG video</source>
-        <translation>MPEG video</translation>
+        <translation type="obsolete">MPEG video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="61"/>
-        <location filename="../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp" line="493"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="116"/>
         <source>MP4</source>
-        <translation>MP4</translation>
+        <translation type="obsolete">MP4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="62"/>
         <source>MP4 (PSP)</source>
-        <translation>MP4 (PSP)</translation>
+        <translation type="obsolete">MP4 (PSP)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="63"/>
         <source>OGM</source>
-        <translation>OGM</translation>
+        <translation type="obsolete">OGM</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="64"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="177"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="244"/>
         <source>FLV</source>
-        <translation>FLV</translation>
+        <translation type="obsolete">FLV</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="65"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="117"/>
         <source>MKV</source>
-        <translation>MKV</translation>
+        <translation type="obsolete">MKV</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_editor/ADM_outputfmt.h" line="66"/>
         <source>DUMMY</source>
-        <translation>FITTIZIO</translation>
+        <translation type="obsolete">FITTIZIO</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_encoder/ADM_encCodecDesc.h" line="9"/>
         <source>YV12 (raw)</source>
-        <translation>YV12 (raw)</translation>
+        <translation type="obsolete">YV12 (raw)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_encoder/ADM_encCodecDesc.h" line="31"/>
         <source>MPEG-2 requant</source>
-        <translation>MPEG-2 requant</translation>
+        <translation type="obsolete">MPEG-2 requant</translation>
     </message>
     <message>
         <source>dummy</source>
         <translation type="obsolete">fittizio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_encoder/ADM_encCodecDesc.h" line="51"/>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="132"/>
-        <location filename="../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp" line="164"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="180"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="226"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="247"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="150"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="238"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="250"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="173"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="177"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="339"/>
         <source>Copy</source>
-        <translation>Copia</translation>
+        <translation type="obsolete">Copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="46"/>
         <source>VobSub</source>
-        <translation>VobSub</translation>
+        <translation type="obsolete">VobSub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="46"/>
         <source>Embed VobSub subtitles into picture.</source>
-        <translation>Incorpora sottotitoli VobSub nell&apos;immagine.</translation>
+        <translation type="obsolete">Incorpora sottotitoli VobSub nell&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="47"/>
         <source>DVB sub</source>
-        <translation>Sottotitoli DVB</translation>
+        <translation type="obsolete">Sottotitoli DVB</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="47"/>
         <source>Embed DVB-T subtitle.</source>
-        <translation>Incorpora sottotitoli DVB-T.</translation>
+        <translation type="obsolete">Incorpora sottotitoli DVB-T.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="50"/>
         <source>Compute Average</source>
-        <translation>Calcolo media</translation>
+        <translation type="obsolete">Calcolo media</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="50"/>
         <source>Compute average luma value for each pixel throughout all frames, and save to file</source>
-        <translation>Calcola il valore medio di luma per ogni pixel su tutti i fotogrammi, e salva su file.</translation>
+        <translation type="obsolete">Calcola il valore medio di luma per ogni pixel su tutti i fotogrammi, e salva su file.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="51"/>
         <source>Threshold</source>
-        <translation>Threshold</translation>
+        <translation type="obsolete">Threshold</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="51"/>
         <source>Force too-bright/too-dim pixels to 0 and the rest to 255 or vice-versa</source>
-        <translation>Forza i pixel troppo luminosi/scuri a 0 e il resto a 255 o viceversa.</translation>
+        <translation type="obsolete">Forza i pixel troppo luminosi/scuri a 0 e il resto a 255 o viceversa.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="52"/>
         <source>Particle List</source>
-        <translation>Lista particelle</translation>
+        <translation type="obsolete">Lista particelle</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="52"/>
         <source>Identify &apos;particles&apos; (groups of pixels)</source>
-        <translation>Identifica le &apos;particelle&apos; (gruppi di pixel).</translation>
+        <translation type="obsolete">Identifica le &apos;particelle&apos; (gruppi di pixel).</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="53"/>
         <source>Eraser</source>
-        <translation>Gomma</translation>
+        <translation type="obsolete">Gomma</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="53"/>
         <source>&quot;Erase&quot; arbitrary areas of each frame</source>
-        <translation>&quot;Cancella&quot; aree arbitrarie di ogni fotogramma.</translation>
+        <translation type="obsolete">&quot;Cancella&quot; aree arbitrarie di ogni fotogramma.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="54"/>
         <source>Swiss Army Knife</source>
-        <translation>Swiss Army Knife</translation>
+        <translation type="obsolete">Swiss Army Knife</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="54"/>
         <source>Apply operation like P&apos;=P*A, P-A, P+A, etc. using a convolution, rolling average, image from file, or constant</source>
-        <translation>Applica operazioni come P&apos;=P*A, P-A, P+A, ecc. usando convoluzione, media mobile, immagine da file, o costante.</translation>
+        <translation type="obsolete">Applica operazioni come P&apos;=P*A, P-A, P+A, ecc. usando convoluzione, media mobile, immagine da file, o costante.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="57"/>
         <source>Partial</source>
-        <translation>Parziale</translation>
+        <translation type="obsolete">Parziale</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="58"/>
         <source>Add Framenumber</source>
-        <translation>Aggiungi numero fotogramma</translation>
+        <translation type="obsolete">Aggiungi numero fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_declaration.cpp" line="58"/>
         <source>Print frame number directly in image</source>
-        <translation>Stampa numero fotogramma direttamente sull&apos;immagine.</translation>
+        <translation type="obsolete">Stampa numero fotogramma direttamente sull&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_saveload.cpp" line="149"/>
         <source>Problem reading XML filters</source>
-        <translation>Problema di lettura dei filtri XML</translation>
+        <translation type="obsolete">Problema di lettura dei filtri XML</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_saveload.cpp" line="157"/>
         <source>No filter found</source>
-        <translation>Nessun filtro trovato</translation>
+        <translation type="obsolete">Nessun filtro trovato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_saveload.cpp" line="193"/>
         <source>Could not find a filter</source>
-        <translation>Impossibile trovare un filtro</translation>
+        <translation type="obsolete">Impossibile trovare un filtro</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_saveload.cpp" line="201"/>
         <source>No tag found</source>
-        <translation>Nessuna etichetta trovata</translation>
+        <translation type="obsolete">Nessuna etichetta trovata</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_filter/filter_saveload.cpp" line="281"/>
         <source>Node not found</source>
-        <translation>Nodo non trovato</translation>
+        <translation type="obsolete">Nodo non trovato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp" line="145"/>
         <source>There is several mpeg file, append them ?</source>
-        <translation>Ci sono diversi file mpeg, vuoi unirli?</translation>
+        <translation type="obsolete">Ci sono diversi file mpeg, vuoi unirli?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp" line="244"/>
         <source>Can&apos;t determine aspect ratio</source>
-        <translation>Impossibile determinare le proporzioni</translation>
+        <translation type="obsolete">Impossibile determinare le proporzioni</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp" line="184"/>
         <source>Wrong Colorspace</source>
-        <translation>Spazio di colore errato</translation>
+        <translation type="obsolete">Spazio di colore errato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp" line="184"/>
         <source>Only YV12/I420 or YUY2/I422 JPegs are supported</source>
-        <translation>Sono supportate solo le immagini JPeg YV12/I420 o YUY2/I422</translation>
+        <translation type="obsolete">Sono supportate solo le immagini JPeg YV12/I420 o YUY2/I422</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="75"/>
         <source>Output file error</source>
-        <translation>Errore file di uscita</translation>
+        <translation type="obsolete">Errore file di uscita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="75"/>
         <source>Could not open &quot;%s&quot; for writing.</source>
-        <translation>Impossibile aprire &quot;%s&quot; per la scrittura.</translation>
+        <translation type="obsolete">Impossibile aprire &quot;%s&quot; per la scrittura.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="83"/>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="89"/>
         <source>Input file error</source>
-        <translation>Errore file di ingresso</translation>
+        <translation type="obsolete">Errore file di ingresso</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="83"/>
         <source>Unknown source type</source>
-        <translation>Tipo di sorgente sconosciuto</translation>
+        <translation type="obsolete">Tipo di sorgente sconosciuto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="89"/>
         <source>Bitmap source failed</source>
-        <translation>Sorgente bitmap fallita</translation>
+        <translation type="obsolete">Sorgente bitmap fallita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="97"/>
         <source>Problem loading sub</source>
-        <translation>Problema di caricamento sottotitoli</translation>
+        <translation type="obsolete">Problema di caricamento sottotitoli</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_ocrEngine.cpp" line="97"/>
         <source>No subs</source>
-        <translation>Nessun sottotitolo</translation>
+        <translation type="obsolete">Nessun sottotitolo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="250"/>
         <source>Ifo error</source>
-        <translation>Errore file ifo</translation>
+        <translation type="obsolete">Errore file ifo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="250"/>
         <source>Error reading ifo file, aborting.</source>
-        <translation>Errore di lettura del file ifo, annullamento in corso.</translation>
+        <translation type="obsolete">Errore di lettura del file ifo, annullamento in corso.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="258"/>
         <source>Cannot write .idx</source>
-        <translation>Impossibile scrivere il file .idx</translation>
+        <translation type="obsolete">Impossibile scrivere il file .idx</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="271"/>
         <source>Cannot write .sub</source>
-        <translation>Impossibile scrivere il file .sub</translation>
+        <translation type="obsolete">Impossibile scrivere il file .sub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="283"/>
         <source>Problem opening the mpeg files</source>
-        <translation>Problema apertura file mpeg</translation>
+        <translation type="obsolete">Problema apertura file mpeg</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/ADM_vob2vobsub.cpp" line="296"/>
         <source>Generating VobSub file</source>
-        <translation>Creazione file VobSub</translation>
+        <translation type="obsolete">Creazione file VobSub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/adm_glyph.cpp" line="169"/>
         <source>Could not write the file</source>
-        <translation>Impossibile scrivere il file</translation>
+        <translation type="obsolete">Impossibile scrivere il file</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_ocr/adm_glyph.cpp" line="217"/>
         <source>Could not read &quot;%s&quot;.</source>
-        <translation>Impossibile leggere &quot;%s&quot;.</translation>
+        <translation type="obsolete">Impossibile leggere &quot;%s&quot;.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_crashHook.cpp" line="64"/>
         <source>Load it</source>
-        <translation>Carica</translation>
+        <translation type="obsolete">Carica</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_crashHook.cpp" line="64"/>
         <source>Crash file</source>
-        <translation>File di crash</translation>
+        <translation type="obsolete">File di crash</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_crashHook.cpp" line="65"/>
         <source>I have detected a crash file. 
 Do you want to load it  ?
 (It will be deleted in all cases, you should save it if you want to keep it)</source>
-        <translation>Rilevato un file di crash.
+        <translation type="obsolete">Rilevato un file di crash.
 Vuoi caricarlo?
 (Sar? eliminato in ogni caso se non lo salvi)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="134"/>
         <source>Unsupported video</source>
-        <translation>Video non supportato</translation>
+        <translation type="obsolete">Video non supportato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="134"/>
         <source>Only FLV1 and VP6 video are supported</source>
-        <translation>Sono supportati solo i video FLV1 e VP6</translation>
+        <translation type="obsolete">Sono supportati solo i video FLV1 e VP6</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="156"/>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="161"/>
         <source>Unsupported audio</source>
-        <translation>Audio non supportato</translation>
+        <translation type="obsolete">Audio non supportato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="156"/>
         <source>Audio must be mp3 for flv output.</source>
-        <translation>L&apos;audio di un video flv deve essere mp3.</translation>
+        <translation type="obsolete">L&apos;audio di un video flv deve essere mp3.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="161"/>
         <source>Frequency must be 44100, 22050 or 11025 Hz.</source>
-        <translation>La frequenza deve essere 44100, 22050 o 11025 Hz.</translation>
+        <translation type="obsolete">La frequenza deve essere 44100, 22050 o 11025 Hz.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp" line="215"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="211"/>
         <source>Cannot initialize the audio stream</source>
-        <translation>Impossibile inizializzare il flusso audio</translation>
+        <translation type="obsolete">Impossibile inizializzare il flusso audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="115"/>
         <source>PSP</source>
-        <translation>PSP</translation>
+        <translation type="obsolete">PSP</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="168"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="194"/>
         <source>Reuse the existing log file?</source>
-        <translation>Riutilizzare il file log esistente?</translation>
+        <translation type="obsolete">Riutilizzare il file log esistente?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="229"/>
         <source>Invalid audio stream detected</source>
-        <translation>Rilevato flusso audio non valido</translation>
+        <translation type="obsolete">Rilevato flusso audio non valido</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="229"/>
         <source>The audio stream may be invalid for this container.
 
 Continue anyway?</source>
-        <translation>Il flusso audio potrebbe non essere giusto per questo contenitore.
+        <translation type="obsolete">Il flusso audio potrebbe non essere giusto per questo contenitore.
 
 Continuare comunque?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="415"/>
         <source>1st Pass</source>
-        <translation>1a passata</translation>
+        <translation type="obsolete">1a passata</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp" line="488"/>
         <source>2nd Pass</source>
-        <translation>2a passata</translation>
+        <translation type="obsolete">2a passata</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="79"/>
         <source>This is not MPEG compatible</source>
-        <translation>Non ? compatibile con MPEG</translation>
+        <translation type="obsolete">Non ? compatibile con MPEG</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="79"/>
         <source>You can&apos;t use the Copy codec.</source>
-        <translation>Non puoi usare il codec Copia.</translation>
+        <translation type="obsolete">Non puoi usare il codec Copia.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="84"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="113"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="124"/>
         <source>There is no audio track</source>
-        <translation>Non ci sono tracce audio</translation>
+        <translation type="obsolete">Non ci sono tracce audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="91"/>
         <source>The first frame is not intra frame</source>
-        <translation>Il primo fotogramma non ? un fotogramma chiave</translation>
+        <translation type="obsolete">Il primo fotogramma non ? un fotogramma chiave</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="91"/>
         <source>Use the &amp;lt;&amp;lt; and the &amp;gt;&amp;gt; buttons to move using Intra frames.</source>
-        <translation>Usa i pulsanti &amp;lt;&amp;lt; e &amp;gt;&amp;gt; per spostarti sui fotogrammi chiave.</translation>
+        <translation type="obsolete">Usa i pulsanti &amp;lt;&amp;lt; e &amp;gt;&amp;gt; per spostarti sui fotogrammi chiave.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="103"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="134"/>
         <source>Audio track is not suitable</source>
-        <translation>La traccia audio non ? adatta</translation>
+        <translation type="obsolete">La traccia audio non ? adatta</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="135"/>
         <source>For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo).</source>
-        <translation>Per un DVD, l&apos;audio deve essere MP2 (stereo), AC3, DTS o LPCM (stereo) a 48 kHz.</translation>
+        <translation type="obsolete">Per un DVD, l&apos;audio deve essere MP2 (stereo), AC3, DTS o LPCM (stereo) a 48 kHz.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="174"/>
         <source>---</source>
-        <translation>---</translation>
+        <translation type="obsolete">---</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="175"/>
         <source>Saving</source>
-        <translation>Salvataggio in corso</translation>
+        <translation type="obsolete">Salvataggio in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="182"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="222"/>
         <source>MPEG TS</source>
-        <translation>MPEG TS</translation>
+        <translation type="obsolete">MPEG TS</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="183"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="223"/>
         <source>MPEG VCD</source>
-        <translation>MPEG VCD</translation>
+        <translation type="obsolete">MPEG VCD</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="184"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="224"/>
         <source>MPEG SVCD</source>
-        <translation>MPEG SVCD</translation>
+        <translation type="obsolete">MPEG SVCD</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp" line="185"/>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="225"/>
         <source>MPEG DVD</source>
-        <translation>MPEG DVD</translation>
+        <translation type="obsolete">MPEG DVD</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="147"/>
         <source>For VCD, audio must be 44.1 kHz MP2.</source>
-        <translation>Per un VCD, l&apos;audio deve essere MP2 a 44.1 kHz.</translation>
+        <translation type="obsolete">Per un VCD, l&apos;audio deve essere MP2 a 44.1 kHz.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="159"/>
         <source>For SVCD, audio must be 44.1 kHz MP2.</source>
-        <translation>Per un SVCD, l&apos;audio deve essere MP2 a 44.1 kHz.</translation>
+        <translation type="obsolete">Per un SVCD, l&apos;audio deve essere MP2 a 44.1 kHz.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="171"/>
         <source>For DVD, audio must be 48 kHz MP2, AC3 or LPCM.</source>
-        <translation>Per un DVD, l&apos;audio deve essere MP2, AC3 o LPCM a 48 kHz.</translation>
+        <translation type="obsolete">Per un DVD, l&apos;audio deve essere MP2, AC3 o LPCM a 48 kHz.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="211"/>
         <source>MPEG Requantizer</source>
-        <translation>MPEG Requantizer</translation>
+        <translation type="obsolete">MPEG Requantizer</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="221"/>
         <source>MPEG ES</source>
-        <translation>MPEG ES</translation>
+        <translation type="obsolete">MPEG ES</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="235"/>
         <source>Pass 1/2</source>
-        <translation>Passata 1/2</translation>
+        <translation type="obsolete">Passata 1/2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="326"/>
-        <location filename="../avidemux/gtk_gui.cpp" line="1557"/>
         <source>Cannot open &quot;%s&quot; for writing.</source>
-        <translation>Impossibile aprire &quot;%s&quot; per la scrittura.</translation>
+        <translation type="obsolete">Impossibile aprire &quot;%s&quot; per la scrittura.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp" line="331"/>
         <source>Pass 2/2</source>
-        <translation>Passata 2/2</translation>
+        <translation type="obsolete">Passata 2/2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="243"/>
         <source>Select a directory</source>
-        <translation>Seleziona una cartella</translation>
+        <translation type="obsolete">Seleziona una cartella</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="514"/>
         <source>Uinteger</source>
-        <translation>Uinteger</translation>
+        <translation type="obsolete">Uinteger</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="517"/>
         <source>Test uinteger</source>
-        <translation>Prova uinteger</translation>
+        <translation type="obsolete">Prova uinteger</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="529"/>
         <source>Float</source>
-        <translation>Float</translation>
+        <translation type="obsolete">Float</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="547"/>
         <source>Toggle</source>
-        <translation>Commuta</translation>
+        <translation type="obsolete">Commuta</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="569"/>
         <source>No Strategy</source>
-        <translation>Nessuna strategia</translation>
+        <translation type="obsolete">Nessuna strategia</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="570"/>
         <source>3:2 Pulldown</source>
-        <translation>3:2 Pulldown</translation>
+        <translation type="obsolete">3:2 Pulldown</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="571"/>
         <source>Pal/Secam</source>
-        <translation>Pal/Secam</translation>
+        <translation type="obsolete">Pal/Secam</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="572"/>
         <source>NTSC converted from PAL</source>
-        <translation>NTSC convertito da PAL</translation>
+        <translation type="obsolete">NTSC convertito da PAL</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_script/ADM_JSFunctions.cpp" line="574"/>
         <source>menu</source>
-        <translation>menu</translation>
+        <translation type="obsolete">menu</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="81"/>
         <source>Select idx file:</source>
-        <translation>Seleziona un file idx:</translation>
+        <translation type="obsolete">Seleziona un file idx:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="82"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="198"/>
         <source>Use GlyphSet (optional):</source>
-        <translation>Usa set di glifi (opzionale):</translation>
+        <translation type="obsolete">Usa set di glifi (opzionale):</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="82"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="198"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="299"/>
         <source>Select GlyphSet file</source>
-        <translation>Seleziona il set di glifi</translation>
+        <translation type="obsolete">Seleziona il set di glifi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="83"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="199"/>
         <source>Output SRT file</source>
-        <translation>File SRT in uscita</translation>
+        <translation type="obsolete">File SRT in uscita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="83"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="199"/>
         <source>Save SRT file</source>
-        <translation>Salva il file SRT</translation>
+        <translation type="obsolete">Salva il file SRT</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="93"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="210"/>
         <source>Select input and ouput files</source>
-        <translation>Seleziona file di ingresso e di uscita</translation>
+        <translation type="obsolete">Seleziona file di ingresso e di uscita</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="103"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="115"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="234"/>
         <source>The idx/sub file does not exist.</source>
-        <translation>Il file idx/sub non esiste.</translation>
+        <translation type="obsolete">Il file idx/sub non esiste.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="108"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="227"/>
         <source>Please Select a valid output SRT file.</source>
-        <translation>Seleziona un file SRT in uscita valido.</translation>
+        <translation type="obsolete">Seleziona un file SRT in uscita valido.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="124"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="243"/>
         <source>Cannot load the glyphset file.</source>
-        <translation>Impossibile caricare il set di glifi.</translation>
+        <translation type="obsolete">Impossibile caricare il set di glifi.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="143"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="264"/>
         <source>GlyphSet filename</source>
-        <translation>Nome file del set di glifi</translation>
+        <translation type="obsolete">Nome file del set di glifi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="143"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="264"/>
         <source>Save GlyphSet file</source>
-        <translation>Salva il set di glifi</translation>
+        <translation type="obsolete">Salva il set di glifi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="145"/>
         <source>Save Glyph</source>
-        <translation>Salva glifo</translation>
+        <translation type="obsolete">Salva glifo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="196"/>
         <source>Input TS:</source>
-        <translation>TS in ingresso:</translation>
+        <translation type="obsolete">TS in ingresso:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="196"/>
         <source>Select TS file</source>
-        <translation>Seleziona un file TS</translation>
+        <translation type="obsolete">Seleziona un file TS</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="197"/>
         <source>Subtitle PID:</source>
-        <translation>PID sottotitoli:</translation>
+        <translation type="obsolete">PID sottotitoli:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="221"/>
         <source>Please Select a valid TS file.</source>
-        <translation>Seleziona un file TS valido.</translation>
+        <translation type="obsolete">Seleziona un file TS valido.</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp" line="266"/>
         <source>Save GlyphSet</source>
-        <translation>Salva il set di glifi</translation>
+        <translation type="obsolete">Salva il set di glifi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="45"/>
         <source>Audio Plugins</source>
-        <translation>Plugin audio</translation>
+        <translation type="obsolete">Plugin audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="68"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp" line="320"/>
         <source>Audio</source>
-        <translation>Audio</translation>
+        <translation type="obsolete">Audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="74"/>
         <source>Video Encoder Plugins</source>
-        <translation>Plugin encoder video</translation>
+        <translation type="obsolete">Plugin encoder video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="98"/>
         <source>Video Encoder</source>
-        <translation>Encoder video</translation>
+        <translation type="obsolete">Encoder video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="103"/>
         <source>Audio Device Plugins</source>
-        <translation>Plugin dispositivo audio</translation>
+        <translation type="obsolete">Plugin dispositivo audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="125"/>
         <source>Audio Device</source>
-        <translation>Dispositivo audio</translation>
+        <translation type="obsolete">Dispositivo audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="132"/>
         <source>Audio Encoder Plugins</source>
-        <translation>Plugin encoder audio</translation>
+        <translation type="obsolete">Plugin encoder audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="154"/>
         <source>Audio Encoders</source>
-        <translation>Encoder audio</translation>
+        <translation type="obsolete">Encoder audio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_plugins.cpp" line="161"/>
         <source>Plugins Info</source>
-        <translation>Info plugin</translation>
+        <translation type="obsolete">Info plugin</translation>
     </message>
     <message>
-        <location filename="../avidemux/GUI_jobs.cpp" line="37"/>
         <source>Oops</source>
-        <translation>Ops</translation>
+        <translation type="obsolete">Ops</translation>
     </message>
     <message>
-        <location filename="../avidemux/GUI_jobs.cpp" line="37"/>
         <source>Something very wrong happened when building joblist.</source>
-        <translation>Errore grave durante la costruzione della lista attivit?.</translation>
+        <translation type="obsolete">Errore grave durante la costruzione della lista attivit?.</translation>
     </message>
     <message>
-        <location filename="../avidemux/GUI_jobs.cpp" line="42"/>
         <source>There are no jobs stored</source>
-        <translation>Non ci sono attivit? immagazzinate</translation>
+        <translation type="obsolete">Non ci sono attivit? immagazzinate</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="74"/>
-        <location filename="../avidemux/gui_navigate.cpp" line="112"/>
-        <location filename="../avidemux/gui_navigate.cpp" line="394"/>
-        <location filename="../avidemux/gui_navigate.cpp" line="430"/>
         <source>Decompressing error</source>
-        <translation>Errore decompressione</translation>
+        <translation type="obsolete">Errore decompressione</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="74"/>
         <source>Cannot decode next frame.</source>
-        <translation>Impossibile decodificare il prossimo fotogramma.</translation>
+        <translation type="obsolete">Impossibile decodificare il prossimo fotogramma.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="112"/>
-        <location filename="../avidemux/gui_navigate.cpp" line="430"/>
         <source>Cannot decode keyframe.</source>
-        <translation>Impossibile decodificare il fotogramma chiave.</translation>
+        <translation type="obsolete">Impossibile decodificare il fotogramma chiave.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="238"/>
         <source>Seeking</source>
-        <translation>Ricerca in corso</translation>
+        <translation type="obsolete">Ricerca in corso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="319"/>
         <source>Finding black frames</source>
-        <translation>Ricerca fotogrammi neri</translation>
+        <translation type="obsolete">Ricerca fotogrammi neri</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_navigate.cpp" line="394"/>
         <source>Cannot decode the frame.</source>
-        <translation>Impossibile decodificare il fotogramma.</translation>
+        <translation type="obsolete">Impossibile decodificare il fotogramma.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="78"/>
         <source>Dual audio can only be used in copy mode</source>
-        <translation>Il doppio audio pu? essere usato solo in modalit? copia</translation>
+        <translation type="obsolete">Il doppio audio pu? essere usato solo in modalit? copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="78"/>
         <source>Select Copy as the video codec.</source>
-        <translation>Seleziona Copia come codec video.</translation>
+        <translation type="obsolete">Seleziona Copia come codec video.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="198"/>
-        <location filename="../avidemux/gui_savenew.cpp" line="214"/>
-        <location filename="../avidemux/gui_savenew.cpp" line="227"/>
         <source>Incompatible output format</source>
-        <translation>Formato in uscita incompatibile</translation>
+        <translation type="obsolete">Formato in uscita incompatibile</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="248"/>
         <source>There is no second track</source>
-        <translation>Non c&apos;? una seconda traccia</translation>
+        <translation type="obsolete">Non c&apos;? una seconda traccia</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="248"/>
         <source>Select a second audio track in the Audio menu.</source>
-        <translation>Seleziona una seconda traccia nel menu Audio.</translation>
+        <translation type="obsolete">Seleziona una seconda traccia nel menu Audio.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="252"/>
         <source>Select dual audio AVI to write</source>
-        <translation>Seleziona il file AVI con doppio audio da scrivere</translation>
+        <translation type="obsolete">Seleziona il file AVI con doppio audio da scrivere</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="274"/>
-        <location filename="../avidemux/gui_savenew.cpp" line="292"/>
         <source>This cannot have packed VOP</source>
-        <translation>Non pu? avere VOP compresso</translation>
+        <translation type="obsolete">Non pu? avere VOP compresso</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="274"/>
-        <location filename="../avidemux/gui_savenew.cpp" line="292"/>
         <source>It is not MPEG-4 video. File will not be saved.</source>
-        <translation>Non ? un video MPEG-4. Il file non verr? salvato.</translation>
+        <translation type="obsolete">Non ? un video MPEG-4. Il file non verr? salvato.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="338"/>
         <source>You may need smart copy.
 Enable it?</source>
-        <translation>Potresti avere bisogno di una copia intelligente.
+        <translation type="obsolete">Potresti avere bisogno di una copia intelligente.
 Attivarla?</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="341"/>
         <source>Smart Copy</source>
-        <translation>Copia intelligente</translation>
+        <translation type="obsolete">Copia intelligente</translation>
     </message>
     <message>
-        <location filename="../avidemux/gui_savenew.cpp" line="341"/>
         <source>_Q factor (set 4):</source>
-        <translation>Fattore _Q (4 predefinito):</translation>
+        <translation type="obsolete">Fattore _Q (4 predefinito):</translation>
     </message>
     <message>
-        <location filename="../avidemux/guiplay.cpp" line="352"/>
         <source>Trouble initializing audio device</source>
-        <translation>Problema nell&apos;inizializzare il dispositivo audio</translation>
+        <translation type="obsolete">Problema nell&apos;inizializzare il dispositivo audio</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp" line="244"/>
-        <location filename="../plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp" line="273"/>
-        <location filename="../plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp" line="321"/>
-        <location filename="../plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp" line="220"/>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="227"/>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="310"/>
         <source>_Bitrate:</source>
-        <translation>_Bitrate:</translation>
+        <translation type="obsolete">_Bitrate:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp" line="250"/>
-        <location filename="../plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp" line="276"/>
-        <location filename="../plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp" line="223"/>
         <source>Aften Configuration</source>
-        <translation>Configurazione Aften</translation>
+        <translation type="obsolete">Configurazione Aften</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp" line="231"/>
         <source>TwoLame Configuration</source>
-        <translation>Configurazione TwoLame</translation>
+        <translation type="obsolete">Configurazione TwoLame</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="295"/>
         <source>VBR</source>
-        <translation>VBR</translation>
+        <translation type="obsolete">VBR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="296"/>
         <source>Quality based</source>
-        <translation>Basato sulla qualit?</translation>
+        <translation type="obsolete">Basato sulla qualit?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="298"/>
         <source>_Mode:</source>
-        <translation>_Modalit?:</translation>
+        <translation type="obsolete">_Modalit?:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp" line="314"/>
         <source>Vorbis Configuration</source>
-        <translation>Configurazione Vorbis</translation>
+        <translation type="obsolete">Configurazione Vorbis</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ASharp/ADM_vidAsharp.cpp" line="61"/>
         <source>asharp</source>
-        <translation>asharp</translation>
+        <translation type="obsolete">asharp</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ASharp/ADM_vidAsharp.cpp" line="64"/>
         <source>Adaptative sharpener by MarcFD.</source>
-        <translation>Nitidizzatore adattativo di MarcFD.</translation>
+        <translation type="obsolete">Nitidizzatore adattativo di MarcFD.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AddBorders/ADM_vidAddBorder.cpp" line="30"/>
         <source>Add black borders</source>
-        <translation>Aggiunta bordi neri</translation>
+        <translation type="obsolete">Aggiunta bordi neri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AddBorders/ADM_vidAddBorder.cpp" line="33"/>
         <source>Add pure black border(s).</source>
-        <translation>Aggiunge bordi neri.</translation>
+        <translation type="obsolete">Aggiunge bordi neri.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/ADM_vidAnimated.cpp" line="36"/>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="54"/>
         <source>Animated Menu</source>
-        <translation>Menu animato</translation>
+        <translation type="obsolete">Menu animato</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/ADM_vidAnimated.cpp" line="39"/>
         <source>Create a video made of 6 mini windows, very useful to do DVD menus.</source>
-        <translation>Crea un video fatto di 6 piccole finestre, molto utile per fare menu di DVD.</translation>
+        <translation type="obsolete">Crea un video fatto di 6 piccole finestre, molto utile per fare menu di DVD.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="37"/>
         <source>_Background Image:</source>
-        <translation>Immagine di _sfonfo:</translation>
+        <translation type="obsolete">Immagine di _sfonfo:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="37"/>
         <source>Select background image</source>
-        <translation>Seleziona immagine di sfonfo</translation>
+        <translation type="obsolete">Seleziona immagine di sfonfo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="38"/>
         <source>_NTSC (default is PAL):</source>
-        <translation>N_TSC (predefinito ? Pal):</translation>
+        <translation type="obsolete">N_TSC (predefinito ? Pal):</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="39"/>
         <source>Vignette _Width:</source>
-        <translation>_Larghezza vignetta:</translation>
+        <translation type="obsolete">_Larghezza vignetta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="40"/>
         <source>Vignette _Height:</source>
-        <translation>_Altezza vignetta:</translation>
+        <translation type="obsolete">_Altezza vignetta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="43"/>
         <source>Vignette frame number</source>
-        <translation>Numero di fotogrammi vignetta</translation>
+        <translation type="obsolete">Numero di fotogrammi vignetta</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Animated/DIA_animated.cpp" line="47"/>
         <source>Timecode:</source>
-        <translation>Timecode:</translation>
+        <translation type="obsolete">Timecode:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Ass/ADM_vidASS.cpp" line="47"/>
         <source>ASS</source>
-        <translation>ASS</translation>
+        <translation type="obsolete">ASS</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Ass/ADM_vidASS.cpp" line="50"/>
         <source>Add ASS/SSA subtitles to the picture.</source>
-        <translation>Aggiunge sottotitoli ASS/SSA all&apos;immagine.</translation>
+        <translation type="obsolete">Aggiunge sottotitoli ASS/SSA all&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvisynthResize/ADM_vidResize.cpp" line="36"/>
         <source>Resize</source>
-        <translation>Ridimensionamento</translation>
+        <translation type="obsolete">Ridimensionamento</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvisynthResize/ADM_vidResize.cpp" line="39"/>
         <source>Picture resizer ported from Avisynth (C Version, slow).</source>
-        <translation>Ridimensionatore immagini di Avisynth (versione C, lento).</translation>
+        <translation type="obsolete">Ridimensionatore immagini di Avisynth (versione C, lento).</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvisynthResize/ADM_vidResize.cpp" line="240"/>
-        <location filename="../plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp" line="130"/>
         <source>Width and height cannot be 0</source>
-        <translation>Larghezza e altezza non possono essere 0</translation>
+        <translation type="obsolete">Larghezza e altezza non possono essere 0</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvisynthResize/ADM_vidResize.cpp" line="242"/>
-        <location filename="../plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp" line="132"/>
         <source>Width and height cannot be odd</source>
-        <translation>Larghezza e altezza non possono essere dispari</translation>
+        <translation type="obsolete">Larghezza e altezza non possono essere dispari</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="488"/>
         <source>Avisynth script filter (avsfilter), ver 0.7a(internal)</source>
-        <translation>Filtro script di Avisynth (avsfilter), ver 0.7a(interno)</translation>
+        <translation type="obsolete">Filtro script di Avisynth (avsfilter), ver 0.7a(interno)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="491"/>
         <source>Use avisynth script as video filter.</source>
-        <translation>Utilizza uno script di Avisynth come filtro video.</translation>
+        <translation type="obsolete">Utilizza uno script di Avisynth come filtro video.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlackenBorders/ADM_vidBlackenBorders.cpp" line="59"/>
         <source>Blacken borders</source>
-        <translation>Annerimento bordi</translation>
+        <translation type="obsolete">Annerimento bordi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlackenBorders/ADM_vidBlackenBorders.cpp" line="62"/>
         <source>Fill borders with pure black. Doesn&apos;t alter size.</source>
-        <translation>Annerisce i bordi. Non altera le dimensioni.</translation>
+        <translation type="obsolete">Annerisce i bordi. Non altera le dimensioni.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlendRemover/ADM_vidBlendRemoval.cpp" line="59"/>
         <source>Blend Removal</source>
-        <translation>Rimozione miscela</translation>
+        <translation type="obsolete">Rimozione miscela</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlendRemover/ADM_vidBlendRemoval.cpp" line="62"/>
         <source>Try to remove blending.</source>
-        <translation>Tenta rimozione blending.</translation>
+        <translation type="obsolete">Tenta rimozione blending.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlendRemover/ADM_vidHardIvtcRemoval.cpp" line="69"/>
         <source>Remove IVTC that has been analog captured or resized.</source>
-        <translation>Rimouve IVTC che ? stato catturato analogicamente o ridimensionato.</translation>
+        <translation type="obsolete">Rimouve IVTC che ? stato catturato analogicamente o ridimensionato.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/CNR2/ADM_vidCNR2.cpp" line="83"/>
         <source>Cnr2</source>
-        <translation>Cnr2</translation>
+        <translation type="obsolete">Cnr2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/CNR2/ADM_vidCNR2.cpp" line="86"/>
         <source>Chroma noise reduction filter by MarcFD/Tritical..</source>
-        <translation>Filtro di riduzione rumore croma di MarcFD/Tritical.</translation>
+        <translation type="obsolete">Filtro di riduzione rumore croma di MarcFD/Tritical.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Chroma/ADM_vidChromaU.cpp" line="27"/>
         <source>Chroma U</source>
-        <translation>Croma U</translation>
+        <translation type="obsolete">Croma U</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Chroma/ADM_vidChromaU.cpp" line="30"/>
         <source>Keep chroma U only.</source>
-        <translation>Mantiene solo croma U.</translation>
+        <translation type="obsolete">Mantiene solo croma U.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Chroma/ADM_vidChromaV.cpp" line="27"/>
         <source>Chroma V</source>
-        <translation>Croma V</translation>
+        <translation type="obsolete">Croma V</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Chroma/ADM_vidChromaV.cpp" line="30"/>
         <source>Keep chroma V only.</source>
-        <translation>Mantiene solo croma V.</translation>
+        <translation type="obsolete">Mantiene solo croma V.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ChromaShift/ADM_vidChromaShift.cpp" line="36"/>
         <source>Chroma shift</source>
-        <translation>Traslazione croma</translation>
+        <translation type="obsolete">Traslazione croma</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ChromaShift/ADM_vidChromaShift.cpp" line="39"/>
         <source>Shift chroma U/V to fix badly synced luma/chroma.</source>
-        <translation>Trasla croma U/V per correggere luma/croma mal sincronizzate.</translation>
+        <translation type="obsolete">Trasla croma U/V per correggere luma/croma mal sincronizzate.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Contrast/ADM_vidContrast.cpp" line="34"/>
         <source>Contrast</source>
-        <translation>Contrasto</translation>
+        <translation type="obsolete">Contrasto</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Contrast/ADM_vidContrast.cpp" line="37"/>
         <source>Adjust contrast, brightness and colors.</source>
-        <translation>Regola contrasto, luminosit? e colori.</translation>
+        <translation type="obsolete">Regola contrasto, luminosit? e colori.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Crop/ADM_vidCrop.cpp" line="53"/>
         <source>Crop</source>
-        <translation>Crop</translation>
+        <translation type="obsolete">Crop</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Crop/ADM_vidCrop.cpp" line="56"/>
         <source>Remove lines from top/bottom/left/right.</source>
-        <translation>Rimuove righe in alto, in basso, a sinistra, a destra.</translation>
+        <translation type="obsolete">Rimuove righe in alto, in basso, a sinistra, a destra.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/CurveEditor/ADM_vidCurveEditor.cpp" line="48"/>
         <source>Color Curve Editor</source>
-        <translation>Editor curva colore</translation>
+        <translation type="obsolete">Editor curva colore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/CurveEditor/ADM_vidCurveEditor.cpp" line="51"/>
         <source>Color adjustment by color curves in YUV color space.</source>
-        <translation>Regolazione del colore con curve di colore nello spazio colori YUV.</translation>
+        <translation type="obsolete">Regolazione del colore con curve di colore nello spazio colori YUV.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Decimate/ADM_vidDecDec.cpp" line="155"/>
         <source>Decomb Decimate</source>
-        <translation>Decimazione Decomb</translation>
+        <translation type="obsolete">Decimazione Decomb</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Decimate/ADM_vidDecDec.cpp" line="158"/>
         <source>Useful to remove dupes left by Telecide.</source>
-        <translation>Utile per rimuovere duplicati lasciati da Telecide.</translation>
+        <translation type="obsolete">Utile per rimuovere duplicati lasciati da Telecide.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Deinterlace/ADM_vidDeinterlace.cpp" line="36"/>
         <source>Deinterlace</source>
-        <translation>Deinterlacciamento</translation>
+        <translation type="obsolete">Deinterlacciamento</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Deinterlace/ADM_vidDeinterlace.cpp" line="39"/>
         <source>Mask interlacing artifacts. Port of Smart deinterlace.</source>
-        <translation>Maschera artefatti interlacciati. Da Smart deinterlace.</translation>
+        <translation type="obsolete">Maschera artefatti interlacciati. Da Smart deinterlace.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Delta/ADM_vidDelta.cpp" line="39"/>
         <source>Luma delta</source>
-        <translation>Delta luma</translation>
+        <translation type="obsolete">Delta luma</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Delta/ADM_vidDelta.cpp" line="42"/>
         <source>Difference between current and previous picture.</source>
-        <translation>Differenza tra immagine corrente e precedente.</translation>
+        <translation type="obsolete">Differenza tra immagine corrente e precedente.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Denoise/ADM_vidDenoise.cpp" line="38"/>
         <source>Denoise</source>
-        <translation>Rimozione rumore</translation>
+        <translation type="obsolete">Rimozione rumore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Denoise/ADM_vidDenoise.cpp" line="41"/>
         <source>Port of Transcode DNR.</source>
-        <translation>Port di Transcode DNR.</translation>
+        <translation type="obsolete">Port di Transcode DNR.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/DgBob/ADM_vidDGbob.cpp" line="65"/>
         <source>DG Bob</source>
-        <translation>DG Bob</translation>
+        <translation type="obsolete">DG Bob</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/DgBob/ADM_vidDGbob.cpp" line="68"/>
         <source>Donald Graft Bob.</source>
-        <translation>Filtro Bob di Donald Graft.</translation>
+        <translation type="obsolete">Filtro sdoppiamento di Donald Graft.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/DropOut/ADM_vidDropOut.cpp" line="31"/>
         <source>Drop</source>
-        <translation>Drop</translation>
+        <translation type="obsolete">Drop</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/DropOut/ADM_vidDropOut.cpp" line="34"/>
         <source>Drop damaged fields (e.g. from VHS capture).</source>
-        <translation>Elimina semiquadri danneggiati (per esempio da cattura VHS).</translation>
+        <translation type="obsolete">Elimina semiquadri danneggiati (per esempio da cattura VHS).</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Eq2/ADM_vidEq2.cpp" line="59"/>
         <source>MPlayer eq2</source>
-        <translation>MPlayer eq2</translation>
+        <translation type="obsolete">MPlayer eq2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Eq2/ADM_vidEq2.cpp" line="62"/>
         <source>Adjust contrast, brightness, saturation and gamma.</source>
-        <translation>Regola contrasto, luminosit?, saturazione e gamma.</translation>
+        <translation type="obsolete">Regola contrasto, luminosit?, saturazione e gamma.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Equalizer/ADM_vidEqualizer.cpp" line="44"/>
         <source>Luma equalizer</source>
-        <translation>Equalizzatore luma</translation>
+        <translation type="obsolete">Equalizzatore luma</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Equalizer/ADM_vidEqualizer.cpp" line="47"/>
         <source>Luma correction filter with histogram.</source>
-        <translation>Filtro correzione luma con istogramma.</translation>
+        <translation type="obsolete">Filtro correzione luma con istogramma.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp" line="42"/>
         <source>Fade</source>
-        <translation>Dissolvenza</translation>
+        <translation type="obsolete">Dissolvenza</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp" line="45"/>
         <source>Fade in/out.</source>
-        <translation>Dissolvenza in ingresso/uscita.</translation>
+        <translation type="obsolete">Dissolvenza in ingresso/uscita.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Gauss.cpp" line="27"/>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="26"/>
         <source>Gauss smooth</source>
-        <translation>Nitidizzazione gaussiana</translation>
+        <translation type="obsolete">Attenuazione gaussiana</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Gauss.cpp" line="30"/>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="26"/>
         <source>Gaussian smooth. Blur the picture.</source>
-        <translation>Nitidizza in modo gaussiano. Sfoca l&apos;immagine.</translation>
+        <translation type="obsolete">Attenua in modo gaussiano. Sfoca l&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="27"/>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Median.cpp" line="27"/>
         <source>Median</source>
-        <translation>Median</translation>
+        <translation type="obsolete">Median</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="27"/>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Median.cpp" line="30"/>
         <source>Median kernel 3x3. Remove high frequency noise.</source>
-        <translation>Kernel mediana 3x3. Rimuove rumore ad alta frequenza.</translation>
+        <translation type="obsolete">Kernel mediana 3x3. Rimuove rumore ad alta frequenza.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="31"/>
         <source>Mean</source>
-        <translation>Mean</translation>
+        <translation type="obsolete">Mean</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Mean.cpp" line="34"/>
         <source>Mean (blur) kernel.</source>
-        <translation>Kernel media (sfocatura).</translation>
+        <translation type="obsolete">Kernel media (sfocatura).</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Sharpen.cpp" line="27"/>
         <source>Sharpen</source>
-        <translation>Nitidizzazione</translation>
+        <translation type="obsolete">Nitidizzazione</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FastConvolution/Sharpen.cpp" line="30"/>
         <source>Enhance difference between near pixels.</source>
-        <translation>Aumenta differenza tra pixel vicini.</translation>
+        <translation type="obsolete">Aumenta differenza tra pixel vicini.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FluxSmooth/ADM_vidFlux.cpp" line="57"/>
         <source>FluxSmooth</source>
-        <translation>FluxSmooth</translation>
+        <translation type="obsolete">FluxSmooth</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/FluxSmooth/ADM_vidFlux.cpp" line="60"/>
         <source>Spatio-temporal cleaner by Ross Thomas.</source>
-        <translation>Pulizia spazio-temporale di Ross Thomas.</translation>
+        <translation type="obsolete">Pulizia spazio-temporale di Ross Thomas.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ForcedPP/ADM_vidForcedPP.cpp" line="32"/>
         <source>Forced postprocessing</source>
-        <translation>Postprocessing forzato</translation>
+        <translation type="obsolete">Postprocessing forzato</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ForcedPP/ADM_vidForcedPP.cpp" line="35"/>
         <source>Apply blind postprocessing..</source>
-        <translation>Forza postprocessing.</translation>
+        <translation type="obsolete">Forza postprocessing.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Hue/ADM_vidHue.cpp" line="53"/>
         <source>MPlayer hue</source>
-        <translation>MPlayer hue</translation>
+        <translation type="obsolete">MPlayer hue</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Hue/ADM_vidHue.cpp" line="56"/>
         <source>Adjust hue and saturation.</source>
-        <translation>Regola tonalit? e saturazione.</translation>
+        <translation type="obsolete">Regola tonalit? e saturazione.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidHzStackField.cpp" line="34"/>
         <source>Horizontal Stack Field</source>
-        <translation>Impilamento orizzontale</translation>
+        <translation type="obsolete">Impilamento orizzontale</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidHzStackField.cpp" line="37"/>
         <source>Put both fields side by side.</source>
-        <translation>Mette due semiquadri uno accanto all&apos;altro.</translation>
+        <translation type="obsolete">Mette due semiquadri uno accanto all&apos;altro.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidMergeField.cpp" line="36"/>
         <source>Merge fields</source>
-        <translation>Fusione semiquadri</translation>
+        <translation type="obsolete">Fusione semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidMergeField.cpp" line="39"/>
         <source>Merge two pictures as if they were two fields.</source>
-        <translation>Unisce due immagini come se fossero due semiquadri.</translation>
+        <translation type="obsolete">Unisce due immagini come se fossero due semiquadri.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidSeparateField.cpp" line="32"/>
         <source>Separate Fields</source>
-        <translation>Separazione semiquadri</translation>
+        <translation type="obsolete">Separazione semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidSeparateField.cpp" line="35"/>
         <source>Each field becomes full picture, half sized.</source>
-        <translation>Ogni semiquadro diventa un&apos;immagine intera, dimezzata.</translation>
+        <translation type="obsolete">Ogni semiquadro diventa un&apos;immagine intera, dimezzata.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidStackField.cpp" line="35"/>
         <source>Stack fields</source>
-        <translation>Impilamento semiquadri</translation>
+        <translation type="obsolete">Impilamento semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidStackField.cpp" line="38"/>
         <source>Put two fields on top of one another.</source>
-        <translation>Mette due semiquadri uno sopra l&apos;altro.</translation>
+        <translation type="obsolete">Mette due semiquadri uno sopra l&apos;altro.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidUnstackField.cpp" line="34"/>
         <source>Unstack fields</source>
-        <translation>Disimpilamento semiquadri</translation>
+        <translation type="obsolete">Disimpilamento semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KeepField/ADM_vidUnstackField.cpp" line="37"/>
         <source>Interleave top and bottom part of the picture.</source>
-        <translation>Interconnette le parti superiore e inferiore dell&apos;immagine.</translation>
+        <translation type="obsolete">Interconnette le parti superiore e inferiore dell&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KernelDeint/ADM_vidKernelDeint.cpp" line="48"/>
         <source>KernelDeint</source>
-        <translation>KernelDeint</translation>
+        <translation type="obsolete">KernelDeint</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/KernelDeint/ADM_vidKernelDeint.cpp" line="51"/>
         <source>Kernel deinterlacer by Donald Graft.</source>
-        <translation>Deinterlacciatore kernel di Donald Graft.</translation>
+        <translation type="obsolete">Deinterlacciatore kernel di Donald Graft.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/LargeMedian/ADM_vidLargeMedian.cpp" line="34"/>
-        <location filename="../plugins/ADM_videoFilters/Unblend/ADM_vidUnblend.cpp" line="47"/>
         <source>Median (5x5)</source>
-        <translation>Median (5x5)</translation>
+        <translation type="obsolete">Median (5x5)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/LargeMedian/ADM_vidLargeMedian.cpp" line="37"/>
         <source>Median kernel 5x5. Good for reducing chroma noise.</source>
-        <translation>Kernel mediana 5x5. Riduce rumore croma.</translation>
+        <translation type="obsolete">Kernel mediana 5x5. Riduce rumore croma.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Logo/ADM_vidLogo.cpp" line="65"/>
         <source>Logo</source>
-        <translation>Logo</translation>
+        <translation type="obsolete">Logo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Logo/ADM_vidLogo.cpp" line="68"/>
         <source>Add a png as logo.</source>
-        <translation>Aggiunge un&apos;immagine png come logo.</translation>
+        <translation type="obsolete">Aggiunge un&apos;immagine png come logo.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/LumaOnly/ADM_vidLuma.cpp" line="28"/>
         <source>Luma only</source>
-        <translation>Solo luma</translation>
+        <translation type="obsolete">Solo luma</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/LumaOnly/ADM_vidLuma.cpp" line="31"/>
         <source>Convert picture to greyscale (black and white).</source>
-        <translation>Converte l&apos;immagine in scala di grigi (bianco e nero).</translation>
+        <translation type="obsolete">Converte l&apos;immagine in scala di grigi (bianco e nero).</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp" line="44"/>
         <source>MPlayer delogo</source>
-        <translation>MPlayer delogo</translation>
+        <translation type="obsolete">MPlayer delogo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp" line="47"/>
         <source>Blend a logo by interpolating its surrounding box.</source>
-        <translation>Nasconde un logo interpolando la casella circostante.</translation>
+        <translation type="obsolete">Nasconde un logo interpolando la casella circostante.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MSharpen/ADM_vidMSharpen.cpp" line="80"/>
         <source>MSharpen</source>
-        <translation>MSharpen</translation>
+        <translation type="obsolete">MSharpen</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MSharpen/ADM_vidMSharpen.cpp" line="83"/>
         <source>Sharpen edges without amplifying noise. By Donald Graft.</source>
-        <translation>Rende nitidi i margini senza amplificare il rumore. Di Donald Graft.</translation>
+        <translation type="obsolete">Rende nitidi i margini senza amplificare il rumore. Di Donald Graft.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MSmooth/ADM_vidMsmooth.cpp" line="103"/>
         <source>MSmooth by Donald Graft</source>
-        <translation>MSmooth di Donald Graft</translation>
+        <translation type="obsolete">MSmooth di Donald Graft</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MSmooth/ADM_vidMsmooth.cpp" line="106"/>
         <source>Smooth the image, don&apos;t blur edges. Useful on anime.</source>
-        <translation>Leviga l&apos;immagine, non sfoca i margini. Utile per l&apos;anime.</translation>
+        <translation type="obsolete">Attenua l&apos;immagine, non sfoca i margini. Utile per l&apos;anime.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp" line="76"/>
         <source>mcDeinterlace</source>
-        <translation>mcDeinterlace</translation>
+        <translation type="obsolete">mcDeinterlace</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp" line="79"/>
         <source>Motion compensation deinterlacer. Ported from MPlayer.</source>
-        <translation>Deinterlacciatore compensazione movimento. Da MPlayer.</translation>
+        <translation type="obsolete">Deinterlacciatore compensazione movimento. Da MPlayer.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp" line="63"/>
         <source>mosaic</source>
-        <translation>Mosaico</translation>
+        <translation type="obsolete">Mosaico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp" line="66"/>
         <source>Split the picture into tiny thumbnails.</source>
-        <translation>Divide l&apos;immagine in piccole miniature.</translation>
+        <translation type="obsolete">Divide l&apos;immagine in piccole miniature.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerDenoise3D/ADM_vidMPLD3D.cpp" line="32"/>
         <source>MPlayer hqdn3d</source>
-        <translation>MPlayer hqdn3d</translation>
+        <translation type="obsolete">MPlayer hqdn3d</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerDenoise3D/ADM_vidMPLD3D.cpp" line="35"/>
         <source>High quality version of denoise3d. Slower but more precise.</source>
-        <translation>Versione ad alta qualit? di denoise3d. Pi? lenta ma pi? precisa.</translation>
+        <translation type="obsolete">Versione ad alta qualit? di denoise3d. Pi? lenta ma pi? precisa.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerDenoise3D/ADM_vidMPLD3Dlow.cpp" line="33"/>
         <source>MPlayer denoise3d</source>
-        <translation>MPlayer denoise3d</translation>
+        <translation type="obsolete">MPlayer denoise3d</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerDenoise3D/ADM_vidMPLD3Dlow.cpp" line="36"/>
         <source>Reduce noise, smooth image, increase compressibility.</source>
-        <translation>Riduce il rumore, leviga le immagini, aumenta la comprimibilit?.</translation>
+        <translation type="obsolete">Riduce il rumore, attenua l&apos;immagine, aumenta la comprimibilit?.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp" line="83"/>
         <source>MPlayer resize</source>
-        <translation>Ridimensionamento MPlayer</translation>
+        <translation type="obsolete">Ridimensionamento MPlayer</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp" line="86"/>
         <source>Change image size. Faster than Avisynth&apos;s Resize.</source>
-        <translation>Cambia la dimensione dell&apos;immagine. Pi? veloce del ridimensionamento di Avisynth.</translation>
+        <translation type="obsolete">Cambia la dimensione dell&apos;immagine. Pi? veloce del ridimensionamento di Avisynth.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/PalShift/ADM_vidPalShift.cpp" line="32"/>
         <source>PAL field shift</source>
-        <translation>PAL Field Shift</translation>
+        <translation type="obsolete">PAL Field Shift</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/PalShift/ADM_vidPalShift.cpp" line="35"/>
         <source>Shift fields by one. Useful for some PAL movies.</source>
-        <translation>Trasla semiquadri di uno. Utile per alcuni film Pal.</translation>
+        <translation type="obsolete">Trasla semiquadri di uno. Utile per alcuni film Pal.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/PalShift/ADM_vidPalSmart.cpp" line="41"/>
         <source>PAL smart</source>
-        <translation>PAL Smart</translation>
+        <translation type="obsolete">PAL Smart</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/PalShift/ADM_vidPalSmart.cpp" line="44"/>
         <source>Smartly revert non constant PAL field shift.</source>
-        <translation>Annulla intelligentemente le traslazioni di semiquadri Pal non costanti.</translation>
+        <translation type="obsolete">Annulla intelligentemente le traslazioni di semiquadri Pal non costanti.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Pulldown/ADM_vidPulldown.cpp" line="38"/>
         <source>Pulldown</source>
-        <translation>Pulldown</translation>
+        <translation type="obsolete">Pulldown</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Pulldown/ADM_vidPulldown.cpp" line="41"/>
         <source>Convert 24 fps to 30 fps by repeating fields.</source>
-        <translation>Converte da 24 fps a 30 fps ripetendo i semiquadri.</translation>
+        <translation type="obsolete">Converte da 24 fps a 30 fps ripetendo i semiquadri.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ResampleFps/ADM_vidResampleFPS.cpp" line="54"/>
         <source>Resample fps</source>
-        <translation>Ricampionamento fps</translation>
+        <translation type="obsolete">Ricampionamento fps</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/ResampleFps/ADM_vidResampleFPS.cpp" line="57"/>
         <source>Change framerate while keeping duration.</source>
-        <translation>Cambia frame rate mantenendo la durata.</translation>
+        <translation type="obsolete">Cambia frame rate mantenendo la durata.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Reverse/ADM_vidReverse.cpp" line="33"/>
         <source>Reverse</source>
-        <translation>Al contrario</translation>
+        <translation type="obsolete">Al contrario</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Reverse/ADM_vidReverse.cpp" line="36"/>
         <source>Play video backward.</source>
-        <translation>Riproduce il video all&apos;indietro.</translation>
+        <translation type="obsolete">Riproduce il video all&apos;indietro.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="54"/>
         <source>Rotate</source>
-        <translation>Rotazione</translation>
+        <translation type="obsolete">Rotazione</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="57"/>
         <source>Rotate the picture by 90, 180 or 270 degrees.</source>
-        <translation>Ruota l&apos;immagine di 90, 180 o 270 gradi.</translation>
+        <translation type="obsolete">Ruota l&apos;immagine di 90, 180 o 270 gradi.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Soften/ADM_vidSoften.cpp" line="55"/>
         <source>Soften</source>
-        <translation>Attenuazione</translation>
+        <translation type="obsolete">Attenuazione</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Soften/ADM_vidSoften.cpp" line="58"/>
         <source>A variant of stabilize.</source>
-        <translation>Una variante di stabilizzazione.</translation>
+        <translation type="obsolete">Una variante di stabilizzazione.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/ADM_vidSRT.cpp" line="35"/>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="109"/>
         <source>Subtitler</source>
-        <translation>Sottotitolatore</translation>
+        <translation type="obsolete">Sottotitolatore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/ADM_vidSRT.cpp" line="38"/>
         <source>Add srt/sub subtitles to the picture.</source>
-        <translation>Aggiunge sottotitoli srt/sub all&apos;immagine.</translation>
+        <translation type="obsolete">Aggiunge sottotitoli srt/sub all&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="38"/>
         <source>Arabic</source>
-        <translation>Arabo</translation>
+        <translation type="obsolete">Arabo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="39"/>
         <source>Baltic</source>
-        <translation>Baltico</translation>
+        <translation type="obsolete">Baltico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="40"/>
         <source>Chinese Simplified (GB2312)</source>
-        <translation>Cinese semplificato (GB2312)</translation>
+        <translation type="obsolete">Cinese semplificato (GB2312)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="41"/>
         <source>Chinese Traditional (Big5)</source>
-        <translation>Cinese tradizionale (Big5)</translation>
+        <translation type="obsolete">Cinese tradizionale (Big5)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="42"/>
         <source>Cyrillic</source>
-        <translation>Cirillico</translation>
+        <translation type="obsolete">Cirillico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="43"/>
         <source>Latin-1 (Western European)</source>
-        <translation>Latino-1 (Europa occidentale)</translation>
+        <translation type="obsolete">Latino-1 (Europa occidentale)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="44"/>
         <source>Latin-2 (Central European)</source>
-        <translation>Latino-2 (Europa centrale)</translation>
+        <translation type="obsolete">Latino-2 (Europa centrale)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="45"/>
         <source>Greek</source>
-        <translation>Greco</translation>
+        <translation type="obsolete">Greco</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="46"/>
         <source>Hebrew</source>
-        <translation>Ebraico</translation>
+        <translation type="obsolete">Ebraico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="47"/>
         <source>Slovene</source>
-        <translation>Sloveno</translation>
+        <translation type="obsolete">Sloveno</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="48"/>
         <source>Turkish</source>
-        <translation>Turco</translation>
+        <translation type="obsolete">Turco</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="49"/>
         <source>UTF-8</source>
-        <translation>UTF-8</translation>
+        <translation type="obsolete">UTF-8</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="50"/>
         <source>UTF-16</source>
-        <translation>UTF-16</translation>
+        <translation type="obsolete">UTF-16</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="85"/>
         <source>_Subtitle file:</source>
-        <translation>File _sottotitoli:</translation>
+        <translation type="obsolete">File _sottotitoli:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="85"/>
         <source>Select Subtitle file</source>
-        <translation>Seleziona un file sottotitoli</translation>
+        <translation type="obsolete">Seleziona un file sottotitoli</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="86"/>
         <source>_Font (TTF):</source>
-        <translation>Carattere (_TTF):</translation>
+        <translation type="obsolete">Carattere (_TTF):</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="86"/>
         <source>Select TTF file</source>
-        <translation>Seleziona un file TTF</translation>
+        <translation type="obsolete">Seleziona un file TTF</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="101"/>
         <source>_Encoding:</source>
-        <translation>Co_difica:</translation>
+        <translation type="obsolete">Co_difica:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="103"/>
         <source>S_elect C_olor</source>
-        <translation>Seleziona co_lore</translation>
+        <translation type="obsolete">Seleziona co_lore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="104"/>
         <source>Set Size and _Position</source>
-        <translation>Imposta dimensione e _posizione</translation>
+        <translation type="obsolete">Imposta dimensione e _posizione</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="105"/>
         <source>_Auto split</source>
-        <translation>A capo _automatico</translation>
+        <translation type="obsolete">A capo _automatico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Srt/DIA_srt.cpp" line="106"/>
         <source>_Delay (ms):</source>
-        <translation>_Ritardo (ms):</translation>
+        <translation type="obsolete">_Ritardo (ms):</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Stabilize/ADM_vidStabilize.cpp" line="31"/>
-        <location filename="../plugins/ADM_videoFilters/Stabilize/ADM_vidStabilize.cpp" line="34"/>
         <source>Light denoiser.</source>
-        <translation>Rimozione rumore leggera</translation>
+        <translation type="obsolete">Rimozione rumore leggera</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidKeepEvenFields.cpp" line="34"/>
         <source>Keep even fields</source>
-        <translation>Mantenimento fotogrammi pari</translation>
+        <translation type="obsolete">Mantenimento fotogrammi pari</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidKeepEvenFields.cpp" line="37"/>
         <source>Keep top fields. Gives a half height picture..</source>
-        <translation>Mantiene i fotogrammi superiori. Restituisce un&apos;immagine dimezzata.</translation>
+        <translation type="obsolete">Mantiene i fotogrammi superiori. Restituisce un&apos;immagine dimezzata.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidKeepOddFields.cpp" line="35"/>
         <source>Keep odd fields</source>
-        <translation>Mantenimento fotogrammi dispari</translation>
+        <translation type="obsolete">Mantenimento fotogrammi dispari</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidKeepOddFields.cpp" line="38"/>
         <source>Keep bottom fields. Gives a half height picture..</source>
-        <translation>Mantiene i fotogrammi inferiori. Restituisce un&apos;immagine dimezzata.</translation>
+        <translation type="obsolete">Mantiene i fotogrammi inferiori. Restituisce un&apos;immagine dimezzata.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidSwapFields.cpp" line="31"/>
         <source>Swap fields</source>
-        <translation>Inversione semiquadri</translation>
+        <translation type="obsolete">Inversione semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidSwapFields.cpp" line="34"/>
         <source>Swap top and bottom fields.</source>
-        <translation>Inverte semiquadri superiore e inferiore.</translation>
+        <translation type="obsolete">Inverte semiquadri superiore e inferiore.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidSwapSmart.cpp" line="35"/>
         <source>Smart swap fields</source>
-        <translation>Inversione semiquadri intelligente</translation>
+        <translation type="obsolete">Inversione semiquadri intelligente</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapField/ADM_vidSwapSmart.cpp" line="38"/>
         <source>Smartly swap fields. Needed when field order changes.</source>
-        <translation>Inverte semiquadri intelligentemente. Necessario quando l&apos;ordine semiquadri cambia.</translation>
+        <translation type="obsolete">Inverte semiquadri intelligentemente. Necessario quando l&apos;ordine semiquadri cambia.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapUV/ADM_vidUVSwap.cpp" line="28"/>
         <source>Swap U and V</source>
-        <translation>Inversione U e V</translation>
+        <translation type="obsolete">Inversione U e V</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/SwapUV/ADM_vidUVSwap.cpp" line="31"/>
         <source>Invert chroma U and chroma V.</source>
-        <translation>Inverte croma U e croma V.</translation>
+        <translation type="obsolete">Inverte croma U e croma V.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/TIsophote/ADM_vidTisophote.cpp" line="46"/>
         <source>TIsophote</source>
-        <translation>TIsophote</translation>
+        <translation type="obsolete">TIsophote</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/TIsophote/ADM_vidTisophote.cpp" line="49"/>
         <source>Port of TIsophote by tritical .</source>
-        <translation>Port di TIsophote di tritical.</translation>
+        <translation type="obsolete">Port di TIsophote di tritical.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/ADM_vidTdeint.cpp" line="154"/>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="108"/>
         <source>TDeint</source>
-        <translation>TDeint</translation>
+        <translation type="obsolete">TDeint</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/ADM_vidTdeint.cpp" line="157"/>
         <source>Motion adaptative deinterlacer by Tritical.</source>
-        <translation>Deinterlacciatore movimento adattativo di Tritical.</translation>
+        <translation type="obsolete">Deinterlacciatore movimento adattativo di Tritical.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="32"/>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="38"/>
         <source>Auto (might not work)</source>
-        <translation>Automatico (potrebbe non funzionare)</translation>
+        <translation type="obsolete">Automatico (potrebbe non funzionare)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="33"/>
         <source>Top field first</source>
-        <translation>Prima il semiquadro superiore</translation>
+        <translation type="obsolete">Prima il semiquadro superiore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="34"/>
         <source>Bottom field first</source>
-        <translation>Prima il semiquadro inferiore</translation>
+        <translation type="obsolete">Prima il semiquadro inferiore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="39"/>
         <source>Bottom field (keep top)</source>
-        <translation>Semiquadro inferiore (mantieni superiore)</translation>
+        <translation type="obsolete">Semiquadro inferiore (mantieni superiore)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="40"/>
         <source>Top field (keep bottom)</source>
-        <translation>Semiquadro superiore (mantieni inferiore)</translation>
+        <translation type="obsolete">Semiquadro superiore (mantieni inferiore)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="45"/>
         <source>Cubic interpolation</source>
-        <translation>Interpolazione cubica</translation>
+        <translation type="obsolete">Interpolazione cubica</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="46"/>
         <source>Modified ELA</source>
-        <translation>ELA modificato</translation>
+        <translation type="obsolete">ELA modificato</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="47"/>
         <source>Kernel interpolation</source>
-        <translation>Interpolazione Kernel</translation>
+        <translation type="obsolete">Interpolazione Kernel</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="48"/>
         <source>Modified ELA-2</source>
-        <translation>ELA-2 modificato</translation>
+        <translation type="obsolete">ELA-2 modificato</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="53"/>
         <source>4 fields check</source>
-        <translation>Controllo 4 semiquadri</translation>
+        <translation type="obsolete">Controllo 4 semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="54"/>
         <source>5 fields check</source>
-        <translation>Controllo 5 semiquadri</translation>
+        <translation type="obsolete">Controllo 5 semiquadri</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="55"/>
         <source>4 fields check (no avg)</source>
-        <translation>Controllo 4 semiquadri (no media)</translation>
+        <translation type="obsolete">Controllo 4 semiquadri (no media)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="56"/>
         <source>5 fields check (no avg)</source>
-        <translation>Controllo 5 semiquadri (no media)</translation>
+        <translation type="obsolete">Controllo 5 semiquadri (no media)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="62"/>
         <source>No link</source>
-        <translation>Nessun collegamento</translation>
+        <translation type="obsolete">Nessun collegamento</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="63"/>
         <source>Full link</source>
-        <translation>Collegamento completo</translation>
+        <translation type="obsolete">Collegamento completo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="64"/>
         <source>Y to UV</source>
-        <translation>Da Y a UV</translation>
+        <translation type="obsolete">Da Y a UV</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="65"/>
         <source>UV to Y</source>
-        <translation>Da UV a Y</translation>
+        <translation type="obsolete">Da UV a Y</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="69"/>
         <source>0</source>
-        <translation>0</translation>
+        <translation type="obsolete">0</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="70"/>
         <source>1</source>
-        <translation>1</translation>
+        <translation type="obsolete">1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="71"/>
         <source>2</source>
-        <translation>2</translation>
+        <translation type="obsolete">2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="78"/>
         <source>_Field order:</source>
-        <translation>Ordine _semiquadri:</translation>
+        <translation type="obsolete">Ordine _semiquadri:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="79"/>
         <source>_Interpolate:</source>
-        <translation>_Interpola:</translation>
+        <translation type="obsolete">_Interpola:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="81"/>
         <source>_Type:</source>
-        <translation>_Tipo:</translation>
+        <translation type="obsolete">_Tipo:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="82"/>
         <source>_MntMode:</source>
-        <translation>_MntMode:</translation>
+        <translation type="obsolete">_MntMode:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="83"/>
         <source>_Link:</source>
-        <translation>_Collegamento:</translation>
+        <translation type="obsolete">_Collegamento:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="84"/>
         <source>_AP type:</source>
-        <translation>Tipo _AP:</translation>
+        <translation type="obsolete">Tipo _AP:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="87"/>
         <source>Use ch_roma to evalute</source>
-        <translation>Usa c_roma per valutare</translation>
+        <translation type="obsolete">Usa c_roma per valutare</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="88"/>
         <source>Try _weave</source>
-        <translation>Prova _intreccio</translation>
+        <translation type="obsolete">Prova _intreccio</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="89"/>
         <source>_Denoise</source>
-        <translation>_Rimuovi rumore</translation>
+        <translation type="obsolete">_Rimuovi rumore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="90"/>
         <source>_Sharp</source>
-        <translation>_Nitido</translation>
+        <translation type="obsolete">_Nitido</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="91"/>
         <source>_Evalute all frames</source>
-        <translation>_Valuta tutti i fotogrammi</translation>
+        <translation type="obsolete">_Valuta tutti i fotogrammi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="94"/>
         <source>Motion threshold, l_uma:</source>
-        <translation>Soglia movimento, l_uma:</translation>
+        <translation type="obsolete">Soglia movimento, l_uma:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="95"/>
         <source>Motion threshold, c_hroma:</source>
-        <translation>Soglia movimento, c_roma:</translation>
+        <translation type="obsolete">Soglia movimento, c_roma:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="96"/>
         <source>Area com_bing threshold:</source>
-        <translation>Soglia area com_bing:</translation>
+        <translation type="obsolete">Soglia area com_bing:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="97"/>
         <source>Combe_d threshold:</source>
-        <translation>Soglia _combing:</translation>
+        <translation type="obsolete">Soglia _combing:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="98"/>
         <source>Artefact _protection threshold:</source>
-        <translation>Soglia di _protezione artefatto:</translation>
+        <translation type="obsolete">Soglia di _protezione artefatto:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp" line="99"/>
         <source>Debug:</source>
-        <translation>Debug:</translation>
+        <translation type="obsolete">Debug:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Telecide/ADM_vidDecTelecide.cpp" line="54"/>
         <source>Decomb Telecide</source>
-        <translation>Decomb Telecide</translation>
+        <translation type="obsolete">Decomb Telecide</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Telecide/ADM_vidDecTelecide.cpp" line="57"/>
         <source>Great deinterlacing package including IVTC.</source>
-        <translation>Grande pacchetto di deinterlacciamento comprendente IVTC.</translation>
+        <translation type="obsolete">Grande pacchetto di deinterlacciamento comprendente IVTC.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/TemporalCleaner/ADM_vidVlad.cpp" line="71"/>
         <source>Temporal Cleaner</source>
-        <translation>Temporal Cleaner</translation>
+        <translation type="obsolete">Temporal Cleaner</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/TemporalCleaner/ADM_vidVlad.cpp" line="74"/>
         <source>Vlad59&apos;s Avisynth port of Jim Casaburi&apos;s denoiser.</source>
-        <translation>Port Avisynth di Vlad59 del filtro di rimozione del rumore di Jim Casaburi.</translation>
+        <translation type="obsolete">Port Avisynth di Vlad59 del filtro di rimozione del rumore di Jim Casaburi.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Unblend/ADM_vidUnblend.cpp" line="50"/>
         <source>Unblend by Bach</source>
-        <translation>Unblend di Bach</translation>
+        <translation type="obsolete">Unblend di Bach</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/VerticalFlip/ADM_vidFlipV.cpp" line="48"/>
         <source>Vertical flip</source>
-        <translation>Capovolgimento verticale</translation>
+        <translation type="obsolete">Capovolgimento verticale</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/VerticalFlip/ADM_vidFlipV.cpp" line="51"/>
         <source>Vertically flip the picture.</source>
-        <translation>Capovolge verticalmente l&apos;immagine.</translation>
+        <translation type="obsolete">Capovolge verticalmente l&apos;immagine.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Whirl/ADM_vidWhirl.cpp" line="59"/>
         <source>Whirl</source>
-        <translation>Effetto vortice</translation>
+        <translation type="obsolete">Effetto vortice</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Whirl/ADM_vidWhirl.cpp" line="62"/>
         <source>Useless whirlwind effect.</source>
-        <translation>Inutile effetto vortice.</translation>
+        <translation type="obsolete">Inutile effetto vortice.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="77"/>
         <source>yadif</source>
-        <translation>yadif</translation>
+        <translation type="obsolete">yadif</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="80"/>
         <source>Yet Another DeInterlacer. Ported from MPlayer.</source>
-        <translation>Un&apos;altro deinterlacciatore. Da MPlayer.</translation>
+        <translation type="obsolete">Un&apos;altro deinterlacciatore. Da MPlayer.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/colorYUV/ADM_vidColorYuv.cpp" line="69"/>
         <source>Avisynth ColorYUV</source>
-        <translation>Avisynth ColorYUV</translation>
+        <translation type="obsolete">Avisynth ColorYUV</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/colorYUV/ADM_vidColorYuv.cpp" line="72"/>
         <source>Alter colors (auto white balance etc...). Ported from Avisynth.</source>
-        <translation>Corregge colori (bilanciamento automatico del bianco, ecc.). Da Avisynth.</translation>
+        <translation type="obsolete">Corregge colori (bilanciamento automatico del bianco, ecc.). Da Avisynth.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp" line="91"/>
         <source>libavcodec deinterlacer</source>
-        <translation>Deinterlacciatore libavcodec</translation>
+        <translation type="obsolete">Deinterlacciatore libavcodec</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp" line="94"/>
         <source>All FFmpeg deinterlace filters (bicubic, median, ...).</source>
-        <translation>Tutti i filtri di deinterlacciamento FFmpeg (bicubico, mediano, ...).</translation>
+        <translation type="obsolete">Tutti i filtri di deinterlacciamento FFmpeg (bicubico, mediano, ...).</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/BlendRemover/ADM_vidHardIvtcRemoval.cpp" line="66"/>
         <source>Hard pulldown removal</source>
-        <translation>Rimozione pulldown forte</translation>
+        <translation type="obsolete">Rimozione pulldown forte</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_misc.cpp" line="17"/>
         <source>%u minutes</source>
-        <translation>%u minuti</translation>
+        <translation type="obsolete">%u minuti</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_misc.cpp" line="21"/>
         <source>%u minute</source>
-        <translation>%u minuto</translation>
+        <translation type="obsolete">%u minuto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_misc.cpp" line="29"/>
         <source>%u second</source>
-        <translation>%u secondo</translation>
+        <translation type="obsolete">%u secondo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_osSupport/ADM_misc.cpp" line="33"/>
         <source>%u seconds</source>
-        <translation>%u secondi</translation>
+        <translation type="obsolete">%u secondi</translation>
     </message>
 </context>
 <context>
     <name>ADMImage</name>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2590"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2602"/>
         <source>Memory error</source>
         <translation>Errore di memoria</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2597"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2609"/>
         <source>Error converting to BMP</source>
         <translation>Errore conversione in BMP</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2604"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2616"/>
         <source>Something bad happened</source>
         <translation>C&apos;? stato qualche errore</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2694"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2706"/>
         <source>Cannot encode the frame</source>
         <translation>Impossibile codificare il fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2691"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2703"/>
         <source>File error</source>
         <translation>Errore file</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2691"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2703"/>
         <source>Cannot open &quot;%s&quot; for writing.</source>
         <translation>Impossibile aprire &quot;%s&quot; per la scrittura.</translation>
     </message>
     <message>
-        <location filename="../avidemux/gtk_gui.cpp" line="2701"/>
+        <location filename="../avidemux/gtk_gui.cpp" line="2713"/>
         <source>Cannot initialise JPEG encoder</source>
         <translation>Impossibile avviare l&apos;encoder JPEG</translation>
     </message>
@@ -3647,32 +2811,42 @@
 <context>
     <name>ADMVideoAVSfilter</name>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="538"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="541"/>
+        <source>_wine app file:</source>
+        <translation>File applicazione _wine:</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="542"/>
+        <source>Select wine filename[wine/cedega/etc.]</source>
+        <translation>Seleziona il nome file di wine [wine/cedega/etc.]</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="544"/>
         <source>_loader file:</source>
         <translation>File _loader:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="539"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="545"/>
         <source>Select loader filename[avsload.exe]</source>
-        <translation>Seleziona il nome del file loader [avsload.exe]</translation>
+        <translation>Seleziona il nome file del loader [avsload.exe]</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="541"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="547"/>
         <source>_avs file:</source>
         <translation>File _avs:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="542"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="548"/>
         <source>Select avs filename[*.avs]</source>
         <translation>Seleziona il nome del file avs [*.avs]</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="543"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="549"/>
         <source>_pipe timeout:</source>
         <translation>_Pipe timeout:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="547"/>
+        <location filename="../plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp" line="553"/>
         <source>AvsFilter config</source>
         <translation>Configurazione AvsFilter</translation>
     </message>
@@ -4307,8 +3481,22 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="261"/>
+        <source>90?</source>
+        <translation>90?</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="262"/>
+        <source>180?</source>
+        <translation>180?</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="263"/>
+        <source>270?</source>
+        <translation>270?</translation>
+    </message>
+    <message>
         <source>90??</source>
-        <translation>90??</translation>
+        <translation type="obsolete">90??</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="262"/>
@@ -4316,9 +3504,8 @@
         <translation>180 gradi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="262"/>
         <source>180??</source>
-        <translation>180??</translation>
+        <translation type="obsolete">180??</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="263"/>
@@ -4326,9 +3513,8 @@
         <translation>270 gradi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="263"/>
         <source>270??</source>
-        <translation>270??</translation>
+        <translation type="obsolete">270??</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Rotate/ADM_vidRotate.cpp" line="265"/>
@@ -4690,7 +3876,7 @@
     <message>
         <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="138"/>
         <source>Bob, temporal &amp; spatial check</source>
-        <translation>Bob, verifica temporale e spaziale</translation>
+        <translation>Sdoppia, verifica temporale e spaziale</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="139"/>
@@ -4700,7 +3886,7 @@
     <message>
         <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="140"/>
         <source>Bob, skip spatial temporal check</source>
-        <translation>Bob, salta verifica temporale spaziale</translation>
+        <translation>Sdoppia, salta verifica temporale e spaziale</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp" line="143"/>
@@ -5860,11 +5046,15 @@
         <translation>Sostituisci (interpola)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoFilters/Decimate/ADM_vidDecDec.cpp" line="173"/>
         <source>Discard longer dupe (anim??s)</source>
-        <translation>Scarta duplicati pi? lunghi</translation>
+        <translation type="obsolete">Scarta duplicati pi? lunghi</translation>
     </message>
     <message>
+        <location filename="../plugins/ADM_videoFilters/Decimate/ADM_vidDecDec.cpp" line="173"/>
+        <source>Discard longer dupe (anim?s)</source>
+        <translation>Scarta duplicati pi? lunghi (anime)</translation>
+    </message>
+    <message>
         <location filename="../plugins/ADM_videoFilters/Decimate/ADM_vidDecDec.cpp" line="174"/>
         <source>Pulldown dupe removal</source>
         <translation>Rimozione duplicati pulldown</translation>
@@ -6422,7 +5612,7 @@
 <context>
     <name>MP4Header</name>
     <message>
-        <location filename="../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp" line="626"/>
+        <location filename="../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp" line="634"/>
         <source>Problem reading SVQ3 headers</source>
         <translation>Problema di lettura delle intestazioni SVQ3</translation>
     </message>
@@ -6493,8 +5683,8 @@
     <message>
         <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="182"/>
         <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="310"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1780"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1783"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1784"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1787"/>
         <source>Filters</source>
         <translation>Filtri</translation>
     </message>
@@ -6646,361 +5836,361 @@
         <translation>A&amp;uto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1481"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1482"/>
         <source>&amp;Open...</source>
         <translation>&amp;Apri...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1484"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1485"/>
         <source>Ctrl+O</source>
         <translation>Ctrl+O</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1489"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1493"/>
         <source>&amp;Append...</source>
         <translation>A&amp;ggiungi...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1492"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1496"/>
         <source>Ctrl+Alt+A</source>
         <translation>Ctrl+Alt+A</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1502"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1506"/>
         <source>Cu&amp;t</source>
         <translation>&amp;Taglia</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1505"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1509"/>
         <source>Ctrl+X</source>
         <translation>Ctrl+X</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1510"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1514"/>
         <source>&amp;Copy</source>
         <translation>&amp;Copia</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1513"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1517"/>
         <source>Ctrl+C</source>
         <translation>Ctrl+C</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1518"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1522"/>
         <source>&amp;Paste</source>
         <translation>&amp;Incolla</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1521"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1525"/>
         <source>Ctrl+V</source>
         <translation>Ctrl+V</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1526"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1530"/>
         <source>&amp;Delete</source>
         <translation>&amp;Elimina</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1529"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1533"/>
         <source>Del</source>
         <translation>Canc</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1537"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1540"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1543"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1541"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1544"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1547"/>
         <source>Set Marker A</source>
         <translation>Imposta segnalibro A</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1546"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1550"/>
         <source>[</source>
         <translation>[</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1554"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1557"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1560"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1558"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1561"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1564"/>
         <source>Set Marker B</source>
         <translation>Imposta segnalibro B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1563"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1567"/>
         <source>]</source>
         <translation>]</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1571"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1575"/>
         <source>&amp;Information...</source>
         <translation>&amp;Informazioni...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1574"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1578"/>
         <source>Alt+Return</source>
         <translation>Alt+Invio</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1582"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1586"/>
         <source>Save &amp;Video...</source>
         <translation>Salva &amp;video...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1585"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1588"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1589"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1592"/>
         <source>Save Video</source>
         <translation>Salva video</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1596"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1600"/>
         <source>Save &amp;BMP Image...</source>
         <translation>Salva immagine &amp;BMP...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1599"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1602"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1603"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1606"/>
         <source>Save BMP Image</source>
         <translation>Salva immagine BMP</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1607"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1611"/>
         <source>Save &amp;JPEG Image...</source>
         <translation>Salva immagine &amp;JPEG...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1610"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1613"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1614"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1617"/>
         <source>Save JPEG Image</source>
         <translation>Salva immagine JPEG</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1621"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1625"/>
         <source>&amp;Load/Run Project...</source>
         <translation>&amp;Carica/esegui progetto...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1624"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1627"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1628"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1631"/>
         <source>Load/Run Project</source>
         <translation>Carica/esegui progetto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1635"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1639"/>
         <source>Save &amp;Project</source>
         <translation>Salva &amp;progetto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1638"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1641"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1642"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1645"/>
         <source>Save Project</source>
         <translation>Salva progetto</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1591"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1595"/>
         <source>Ctrl+S</source>
         <translation>Ctrl+S</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1649"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1653"/>
         <source>Save P&amp;roject As...</source>
         <translation>Salva p&amp;rogetto con nome...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1652"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1655"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1656"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1659"/>
         <source>Save Project As</source>
         <translation>Salva progetto con nome</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1663"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1667"/>
         <source>&amp;Zoom 1:4</source>
         <translation>&amp;Zoom 1:4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1666"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1670"/>
         <source>Ctrl+Shift+4</source>
         <translation>Ctrl+Shift+4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1674"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1678"/>
         <source>Z&amp;oom 1:2</source>
         <translation>Z&amp;oom 1:2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1677"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1681"/>
         <source>Ctrl+Shift+2</source>
         <translation>Ctrl+Shift+2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1688"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1692"/>
         <source>Zoom &amp;1:1</source>
         <translation>Zoom &amp;1:1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1691"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1695"/>
         <source>Ctrl+Alt+1</source>
         <translation>Ctrl+Alt+1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1699"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1703"/>
         <source>Zoom &amp;2:1</source>
         <translation>Zoom &amp;2:1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1702"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1706"/>
         <source>Ctrl+Alt+2</source>
         <translation>Ctrl+Alt+2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1707"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1711"/>
         <source>&amp;Decoder Options...</source>
         <translation>Opzioni &amp;decoder...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1710"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1713"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1714"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1717"/>
         <source>Decoder Options</source>
         <translation>Opzioni decoder</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1716"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1720"/>
         <source>F3</source>
         <translation>F3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1721"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1725"/>
         <source>&amp;Postprocessing...</source>
         <translation>&amp;Postprocessing...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1724"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1728"/>
         <source>F4</source>
         <translation>F4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1729"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1733"/>
         <source>&amp;Frame Rate...</source>
         <translation>&amp;Frame rate...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1732"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1735"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1736"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1739"/>
         <source>Frame Rate</source>
         <translation>Frame rate</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1740"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1744"/>
         <source>Fil&amp;ters...</source>
         <translation>Fil&amp;tri...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1743"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1747"/>
         <source>Ctrl+Alt+F</source>
         <translation>Ctrl+Alt+F</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1748"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1752"/>
         <source>&amp;Main Track...</source>
         <translation>Traccia &amp;principale...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1753"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1757"/>
         <source>&amp;Secondary Track...</source>
         <translation>Traccia &amp;secondaria...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1758"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1761"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1764"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1762"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1765"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1768"/>
         <source>Build VBR Time Map</source>
         <translation>Crea time map VBR</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1769"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1773"/>
         <source>S&amp;ave...</source>
         <translation>S&amp;alva...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1772"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1776"/>
         <source>Ctrl+Alt+S</source>
         <translation>Ctrl+Alt+S</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1777"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1781"/>
         <source>&amp;Filters</source>
         <translation>&amp;Filtri</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1794"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1798"/>
         <source>&amp;Calculator...</source>
         <translation>&amp;Calcolatrice...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1797"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1801"/>
         <source>F7</source>
         <translation>F7</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1802"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1806"/>
         <source>&amp;Rebuild I &amp;&amp; B Frames</source>
         <translation>&amp;Ricostruisci fotogrammi I &amp;&amp; B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1805"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1808"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1809"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1812"/>
         <source>Rebuild I &amp; B Frames</source>
         <translation>Ricostruisci fotogrammi I &amp; B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1813"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1817"/>
         <source>&amp;Bitrate Histogram...</source>
         <translation>Istogramma &amp;bitrate...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1816"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1819"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1820"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1823"/>
         <source>Bitrate Histogram</source>
         <translation>Istogramma bitrate</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1824"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1828"/>
         <source>&amp;Scan for Black Frames...</source>
         <translation>C&amp;erca fotogrammi neri...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1827"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1830"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1831"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1834"/>
         <source>Scan for Black Frames</source>
         <translation>Cerca fotogrammi neri</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1835"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1839"/>
         <source>&amp;VOB -&gt; VobSub...</source>
         <translation>&amp;VOB -&gt; VobSub...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1838"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1841"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1842"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1845"/>
         <source>VOB -&gt; VobSub</source>
         <translation>VOB -&gt; VobSub</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1846"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1850"/>
         <source>&amp;OCR (VobSub -&gt; srt)...</source>
         <translation>&amp;OCR (VobSub -&gt; srt)...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1849"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1852"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1853"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1856"/>
         <source>OCR (VobSub -&gt; srt)</source>
         <translation>OCR (VobSub -&gt; srt)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2047"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2051"/>
         <source>P</source>
         <translation>P</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1860"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1864"/>
         <source>P&amp;revious Frame</source>
         <translation>Fotogramma p&amp;recedente</translation>
     </message>
@@ -7010,351 +6200,351 @@
         <translation>Progetti recenti</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1497"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1501"/>
         <source>E&amp;xit</source>
         <translation>&amp;Esci</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1863"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1867"/>
         <source>Left</source>
         <translation>Sinistra</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1871"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1875"/>
         <source>&amp;Next Frame</source>
         <translation>Fotogramma &amp;successivo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1874"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1878"/>
         <source>Right</source>
         <translation>Destra</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1882"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1886"/>
         <source>Pr&amp;evious Intra Frame</source>
         <translation>Fotogramma chiave pr&amp;ecedente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1885"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1888"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1889"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1892"/>
         <source>Previous Intra Frame</source>
         <translation>Fotogramma chiave precedente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1891"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1895"/>
         <source>Down</source>
         <translation>Gi?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1899"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1903"/>
         <source>Next &amp;Intra Frame</source>
         <translation>Fotogramma ch&amp;iave successivo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1902"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1905"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1906"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1909"/>
         <source>Next Intra Frame</source>
         <translation>Fotogramma chiave successivo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1908"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1912"/>
         <source>Up</source>
         <translation>Su</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1916"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1920"/>
         <source>Previou&amp;s Black Frame</source>
         <translation>Fotogramma nero pre&amp;cedente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1919"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1922"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1923"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1926"/>
         <source>Previous Black Frame</source>
         <translation>Fotogramma nero precedente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1930"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1934"/>
         <source>Ne&amp;xt Black Frame</source>
         <translation>Fotogramma nero successi&amp;vo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1933"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1936"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1937"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1940"/>
         <source>Next Black Frame</source>
         <translation>Fotogramma nero successivo</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1944"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1948"/>
         <source>&amp;First Frame</source>
         <translation>Primo &amp;fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1947"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1951"/>
         <source>Home</source>
         <translation>Home</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1955"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1959"/>
         <source>&amp;Last Frame</source>
         <translation>&amp;Ultimo fotogramma</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1958"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1962"/>
         <source>End</source>
         <translation>Fine</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1966"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1970"/>
         <source>Jump to Marker &amp;A</source>
         <translation>Vai al segnalibro &amp;A</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1969"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1972"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1973"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1976"/>
         <source>Jump to Marker A</source>
         <translation>Vai al segnalibro A</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1975"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1979"/>
         <source>Ctrl+[</source>
         <translation>Ctrl+[</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1983"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1987"/>
         <source>Jump to Marker &amp;B</source>
         <translation>Vai al segnalibro &amp;B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1986"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1989"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1990"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1993"/>
         <source>Jump to Marker B</source>
         <translation>Vai al segnalibro B</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1992"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1996"/>
         <source>Ctrl+]</source>
         <translation>Ctrl+]</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="1997"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2001"/>
         <source>Jump to Fra&amp;me...</source>
         <translation>Vai al fotogra&amp;mma...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2000"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2004"/>
         <source>Ctrl+F</source>
         <translation>Ctrl+F</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2005"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2009"/>
         <source>Jump to &amp;Time...</source>
         <translation>Vai al &amp;tempo...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2008"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2012"/>
         <source>Ctrl+T</source>
         <translation>Ctrl+T</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2013"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2017"/>
         <source>&amp;Built-in Support...</source>
         <translation>&amp;Supporto incorporato...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2016"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2019"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2020"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2023"/>
         <source>Built-in Support</source>
         <translation>Supporto incorporato</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2024"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2028"/>
         <source>&amp;About Avidemux...</source>
         <translation>Informazioni su &amp;Avidemux...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2027"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2030"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2031"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2034"/>
         <source>About Avidemux</source>
         <translation>Informazioni su Avidemux</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2038"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2042"/>
         <source>&amp;Play/Stop</source>
         <translation>&amp;Play/Stop</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2041"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2044"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2045"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2048"/>
         <source>Play/Stop</source>
         <translation>Play/Stop</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2052"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2056"/>
         <source>Recent0</source>
         <translation>Recent0</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2057"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2061"/>
         <source>Recent1</source>
         <translation>Recent1</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2062"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2066"/>
         <source>Recent2</source>
         <translation>Recent2</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2067"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2071"/>
         <source>Recent3</source>
         <translation>Recent3</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2072"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2076"/>
         <source>Add to &amp;Joblist...</source>
         <translation>Aggiungi alla &amp;lista attivit?...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2075"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2078"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2079"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2082"/>
         <source>Add to Joblist</source>
         <translation>Aggiungi alla lista attivit?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2083"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2087"/>
         <source>View &amp;Joblist...</source>
         <translation>Mostra &amp;lista attivit?...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2086"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2089"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2090"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2093"/>
         <source>View Joblist</source>
         <translation>Mostra lista attivit?</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2092"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2096"/>
         <source>Ctrl+J</source>
         <translation>Ctrl+J</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2097"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2101"/>
         <source>Co&amp;nnect to avsproxy</source>
         <translation>Co&amp;nnetti a avsproxy</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2100"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2103"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2104"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2107"/>
         <source>Connect to avsproxy</source>
         <translation>Connetti a avsproxy</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2108"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2112"/>
         <source>&amp;Reset Edits</source>
         <translation>A&amp;nnulla modifiche</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2211"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2215"/>
         <source>P&amp;lugins...</source>
         <translation>P&amp;lugin...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2216"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2220"/>
         <source>Recent4</source>
         <translation>Recent4</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2221"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2225"/>
         <source>Recent5</source>
         <translation>Recent5</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2226"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2230"/>
         <source>RecentProject0</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2231"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2235"/>
         <source>RecentProject1</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2236"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2240"/>
         <source>RecentProject2</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2241"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2245"/>
         <source>RecentProject3</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2246"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2250"/>
         <source>RecentProject4</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2251"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2255"/>
         <source>RecentProject5</source>
         <translation></translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2256"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2260"/>
         <source>&amp;Plugin Manager...</source>
         <translation>Gestore &amp;plugin...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2113"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2117"/>
         <source>OCR (&amp;TS -&gt; srt)...</source>
         <translation>OCR (&amp;TS -&gt; srt)...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2116"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2119"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2120"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2123"/>
         <source>OCR (TS -&gt; srt)</source>
         <translation>OCR (TS -&gt; srt)</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2124"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2128"/>
         <source>Edit &amp;Glyphs...</source>
         <translation>Modifica &amp;glifi...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2127"/>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2130"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2131"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2134"/>
         <source>Edit Glyphs</source>
         <translation>Modifica glifi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2144"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2148"/>
         <source>&amp;Input</source>
         <translation>&amp;Input</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2155"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2159"/>
         <source>&amp;Output</source>
         <translation>&amp;Output</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2166"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2170"/>
         <source>Si&amp;de</source>
         <translation>&amp;Affiancati lateralmente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2177"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2181"/>
         <source>&amp;Top</source>
         <translation>Affiancati ver&amp;ticalmente</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2188"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2192"/>
         <source>&amp;Separate</source>
         <translation>&amp;Separati</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2193"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2197"/>
         <source>&amp;Close</source>
         <translation>&amp;Chiudi</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2196"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2200"/>
         <source>Ctrl+W</source>
         <translation>Ctrl+W</translation>
     </message>
@@ -7364,7 +6554,7 @@
         <translation>ms</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2201"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2205"/>
         <source>Save Selection as JPEG Images...</source>
         <translation>Salva selezione in immagini JPEG...</translation>
     </message>
@@ -7379,7 +6569,7 @@
         <translation>B:</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2206"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui" line="2210"/>
         <source>&amp;Preferences...</source>
         <translation>&amp;Preferenze...</translation>
     </message>
@@ -7388,7 +6578,7 @@
         <translation type="obsolete">&amp;Plugin...</translation>
     </message>
     <message>
-        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp" line="1022"/>
+        <location filename="../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp" line="1041"/>
         <source>%1 (%2)</source>
         <translation>%1 (%2)</translation>
     </message>
@@ -8630,8 +7820,8 @@
         <translation>&lt;personalizzato&gt;</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="216"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui" line="67"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="216"/>
         <source>Save As</source>
         <translation>Salva con nome</translation>
     </message>
@@ -8641,40 +7831,40 @@
         <translation>File di configurazione Xvid (*.xml)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="251"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="253"/>
         <source>Are you sure you wish to delete the selected configuration?</source>
         <translation>Sei sicuro di voler eliminare la configurazione selezionata?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="271"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="273"/>
         <source>Target Bitrate:</source>
         <translation>Bitrate finale:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="272"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="292"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="274"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="294"/>
         <source>kbit/s</source>
         <translation>kbit/s</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="278"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="280"/>
         <source>Quantiser:</source>
         <translation>Quantizzatore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="284"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui" line="148"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="286"/>
         <source>Target Video Size:</source>
         <translation>Dimensione video finale:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="285"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui" line="233"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="287"/>
         <source>MB</source>
         <translation>MB</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="291"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp" line="293"/>
         <source>Average Bitrate:</source>
         <translation>Bitrate medio:</translation>
     </message>
@@ -9049,7 +8239,7 @@
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui" line="1772"/>
         <source>Smoother:</source>
-        <translation>Livellamento:</translation>
+        <translation>Attenuazione:</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui" line="1779"/>
@@ -9849,6 +9039,11 @@
 <context>
     <name>lavMuxer</name>
     <message>
+        <location filename="../avidemux/ADM_outputs/ADM_lavformat.cpp" line="214"/>
+        <source>Can&apos;t mux that video codec into MKV</source>
+        <translation>Impossibile inserire quel codec video in MKV</translation>
+    </message>
+    <message>
         <location filename="../avidemux/ADM_outputs/ADM_lavformat.cpp" line="373"/>
         <source>Incompatible frame rate</source>
         <translation>Frame rate incompatibile</translation>
@@ -10579,72 +9774,72 @@
 <context>
     <name>x264ConfigDialog</name>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="198"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="205"/>
         <source>&lt;default&gt;</source>
         <translation>&lt;predefinito&gt;</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="199"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="206"/>
         <source>&lt;custom&gt;</source>
         <translation>&lt;personalizzato&gt;</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="326"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="62"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="333"/>
         <source>Save As</source>
         <translation>Salva con nome</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="326"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="333"/>
         <source>x264 Configuration File (*.xml)</source>
         <translation>File di configurazione x264 (*.xml)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="361"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="369"/>
         <source>Are you sure you wish to delete the selected configuration?</source>
         <translation>Sei sicuro di voler eliminare la configurazione selezionata?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="379"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="387"/>
         <source>Target Bitrate:</source>
         <translation>Bitrate finale:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="380"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="399"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3089"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3119"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="388"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="407"/>
         <source>kbit/s</source>
         <translation>kbit/s</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="384"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="392"/>
         <source>Quantiser:</source>
         <translation>Quantizzatore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="388"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="396"/>
         <source>Quality:</source>
         <translation>Qualit?:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="393"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="137"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="401"/>
         <source>Target Video Size:</source>
         <translation>Dimensione video finale:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="394"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="227"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="402"/>
         <source>MB</source>
         <translation>MB</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="398"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="406"/>
         <source>Average Bitrate:</source>
         <translation>Bitrate medio:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="452"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="460"/>
         <source>Macroblock-Tree optimisation requires Variance Adaptive Quantisation to be enabled.  Variance Adaptive Quantisation will automatically be enabled.
 
 Do you wish to continue?</source>
@@ -10669,7 +9864,7 @@
 Continuare?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="511"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="519"/>
         <source>Macroblock-Tree optimisation requires Variance Adaptive Quantisation to be enabled.  Macroblock-Tree optimisation will automatically be disabled.
 
 Do you wish to continue?</source>
@@ -10678,7 +9873,7 @@
 Continuare?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="535"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="543"/>
         <source>Are you sure you wish to delete the selected zone?</source>
         <translation>Sei sicuro di voler eliminare la zona selezionata?</translation>
     </message>
@@ -10694,7 +9889,7 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="69"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3296"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3326"/>
         <source>Delete</source>
         <translation>Elimina</translation>
     </message>
@@ -10747,7 +9942,7 @@
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="341"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="514"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2322"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2348"/>
         <source>Quantiser</source>
         <translation>Quantizzatore</translation>
     </message>
@@ -10764,42 +9959,57 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="658"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3454"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3484"/>
         <source>frames</source>
         <translation>fotogrammi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2945"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2866"/>
+        <source>Variance AQ:</source>
+        <translation>QA a varianza:</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2879"/>
+        <source>Normal</source>
+        <translation>Normale</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2884"/>
+        <source>Auto Variance AQ</source>
+        <translation>QA a varianza automatica</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2975"/>
         <source>Advanced 1</source>
         <translation>Avanzate 1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3330"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3360"/>
         <source>Multithreading</source>
         <translation>Multithreading</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3350"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3380"/>
         <source>Disable</source>
         <translation>Disattiva</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3357"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3387"/>
         <source>Auto-detect</source>
         <translation>Rilevamento automatico</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3412"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3442"/>
         <source>Enforce Repeatability</source>
         <translation>Applica ripetibilit?</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3419"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3449"/>
         <source>Slice-based Threading</source>
         <translation>Multithreading sulle fette</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3434"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3464"/>
         <source>Custom Threaded Lookahead Buffer:</source>
         <translation>Buffer suddiviso personalizzato sui successivi</translation>
     </message>
@@ -10859,9 +10069,8 @@
         <translation>Accuratezza sotto-pixel</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="865"/>
         <source>9 (Best)</source>
-        <translation>9 (migliore)</translation>
+        <translation type="obsolete">9 (migliore)</translation>
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="943"/>
@@ -10892,16 +10101,17 @@
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1129"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1632"/>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1674"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="99"/>
         <source>Disabled</source>
         <translation>Disattivata</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1134"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="100"/>
         <source>Blind Offset</source>
         <translation>Compensazione alla cieca</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1139"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp" line="101"/>
         <source>Smart Analysis</source>
         <translation>Analisi intelligente</translation>
     </message>
@@ -10917,7 +10127,7 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1188"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4308"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4338"/>
         <source>None</source>
         <translation>Nessuna</translation>
     </message>
@@ -10933,7 +10143,7 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1203"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3537"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3567"/>
         <source>Auto</source>
         <translation>Auto</translation>
     </message>
@@ -11012,7 +10222,7 @@
     </message>
     <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1391"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2887"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2910"/>
         <source>Strength:</source>
         <translation>Intensit?:</translation>
     </message>
@@ -11100,7 +10310,7 @@
         <translation>Controllo bitrate ramificato a macroblocchi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3375"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3405"/>
         <source>Custom:</source>
         <comment>multithreading</comment>
         <translation>Personalizzato:</translation>
@@ -11111,6 +10321,21 @@
         <translation>Aggiornamento periodico fotogrammi chiave</translation>
     </message>
     <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="865"/>
+        <source>10 (Best)</source>
+        <translation>10 (migliore)</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1134"/>
+        <source>Weighted References</source>
+        <translation>Riferimenti pesati</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1139"/>
+        <source>Weighted References + Duplicates</source>
+        <translation>Riferimenti e duplicati pesati</translation>
+    </message>
+    <message>
         <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1373"/>
         <source>Loop Filter:</source>
         <translation>In-loop deblocking:</translation>
@@ -11172,584 +10397,588 @@
         <translation>Analisi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1966"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1960"/>
         <source>Mixed References</source>
         <translation>Riferimenti misti</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1973"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1967"/>
         <source>Chroma Motion Estimation</source>
         <translation>Stima movimento croma</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1988"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1982"/>
         <source>Trellis Quantization:</source>
         <translation>Quantizzazione Trellis:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1999"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1993"/>
         <source>Final Macroblock Only</source>
         <translation>Solo macroblocco finale</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2004"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="1998"/>
         <source>Always On</source>
         <translation>Sempre attiva</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2027"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2021"/>
         <source>Fast Skip Detection on P-frames</source>
         <translation>Rilevamento sommario sui fotogrammi P</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2034"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2028"/>
         <source>DCT Decimation on P-frames</source>
         <translation>Decimazione DCT sui fotogrammi P</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2049"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2037"/>
         <source>Psychovisual Rate Distortion Optimisation:</source>
         <translation>Ottimizzazione psicovisuale distorsione bitrate:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2089"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2074"/>
+        <source>Psychovisual Trellis:</source>
+        <translation>Trellis psicovisuale:</translation>
+    </message>
+    <message>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2111"/>
         <source>Noise Reduction:</source>
         <translation>Riduzione rumore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2121"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2147"/>
         <source>Luma Quantisation Deadzone</source>
         <translation>Quantizzazione luma a zona morta</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2141"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2167"/>
         <source>Intra Luma Quantisation Deadzone:</source>
         <translation>Quantizzazione Intra luma a zona morta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2148"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2174"/>
         <source>Inter Luma Quantisation Deadzone:</source>
         <translation>Quantizzazione Inter luma a zona morta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2226"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2252"/>
         <source>Quantisation Matrix</source>
         <translation>Matrice di quantizzazione</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2246"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2272"/>
         <source>Flat Matrix</source>
         <translation>Matrice piana</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2256"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2282"/>
         <source>JVT Matrix</source>
         <translation>Matrice JVT</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2271"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2297"/>
         <source>Custom Matrix</source>
         <translation>Matrice personalizzata</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2281"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3289"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2307"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3319"/>
         <source>Edit</source>
         <translation>Modifica</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2334"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2354"/>
         <source>Quantiser Control</source>
         <translation>Controllo quantizzatore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2387"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2407"/>
         <source>Maximum Quantiser:</source>
         <translation>Quantizzatore massimo:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2394"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2414"/>
         <source>I and P-frame Quantiser Ratio:</source>
         <translation>Rapporto quantizzatore fotogrammi I e P:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2497"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2715"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3052"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2517"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2732"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3082"/>
         <source>%</source>
         <translation>%</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2519"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2539"/>
         <source>Maximum Quantiser Step:</source>
         <translation>Massima variazione quantizzatore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2559"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2579"/>
         <source>P and B-frame Quantiser Ratio:</source>
         <translation>Rapporto quantizzatore fotogrammi P e B:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2566"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2586"/>
         <source>Average Bitrate Tolerance:</source>
         <translation>Tolleranza bitrate medio:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2573"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2593"/>
         <source>Chroma to Luma Quantiser Offset:</source>
         <translation>Compensazione quantizzatore croma rispetto a luma:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2616"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2633"/>
         <source>Minimum Quantiser:</source>
         <translation>Quantizzatore minimo:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2670"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2687"/>
         <source>Quantiser Curve Compression</source>
         <translation>Compressione curva quantizzatore</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2690"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2707"/>
         <source>Quantiser Curve Compression:</source>
         <translation>Compressione curva quantizzatore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2747"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2764"/>
         <source>Reduce Fluctuation Before Curve Compression:</source>
         <translation>Riduci fluttuazioni prima di compressione curva:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2829"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2846"/>
         <source>Reduce Fluctuation After Curve Compression:</source>
         <translation>Riduci fluttuazioni dopo compressione curva:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2841"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2858"/>
         <source>Adaptive Quantisation</source>
         <translation>Quantizzazione adattiva</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2861"/>
         <source>Variance AQ</source>
-        <translation>QA a varianza</translation>
+        <translation type="obsolete">QA a varianza</translation>
     </message>
     <message>
         <source>Advanced</source>
         <translation type="obsolete">Avanzate</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2963"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2993"/>
         <source>Video Buffer Verifier</source>
         <translation>Verifica buffer video</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2983"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3013"/>
         <source>Maximum VBV Bitrate:</source>
         <translation>Massimo bitrate VBV:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="2990"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3020"/>
         <source>Initial VBV Buffer Occupancy:</source>
         <translation>Occupazione iniziale buffer VBV:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3012"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3042"/>
         <source>kbit</source>
         <translation>kbit</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3111"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3141"/>
         <source>VBV Buffer Size:</source>
         <translation>Dimensione buffer VBV:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3123"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3153"/>
         <source>Slicing</source>
         <translation>Suddivisione in fette</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3135"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3165"/>
         <source>Slices per Frame:</source>
         <translation>Fette per fotogramma:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3142"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3172"/>
         <source>Maximum Size per Slice:</source>
         <translation>Dimensione massima di una fetta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3164"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3194"/>
         <source>bytes</source>
         <translation>byte</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3186"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3216"/>
         <source>Maximum Macroblocks per Slice:</source>
         <translation>Massimo numero di macroblocchi per fetta:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3256"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3286"/>
         <source>Zones</source>
         <translation>Zone</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3282"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3312"/>
         <source>Add</source>
         <translation>Aggiungi</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3324"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3354"/>
         <source>Advanced 2</source>
         <translation>Avanzate 2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3493"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3523"/>
         <source>Output 1</source>
         <translation>Output 1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3505"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3535"/>
         <source>Output</source>
         <translation>Output</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3542"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3663"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3572"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3693"/>
         <source>1</source>
         <translation>1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3547"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3577"/>
         <source>1.1</source>
         <translation>1.1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3552"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3582"/>
         <source>1.2</source>
         <translation>1.2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3557"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3587"/>
         <source>1.3</source>
         <translation>1.3</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3562"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3592"/>
         <source>2</source>
         <translation>2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3567"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3597"/>
         <source>2.1</source>
         <translation>2.1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3572"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3602"/>
         <source>2.2</source>
         <translation>2.2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3577"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3668"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3607"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3698"/>
         <source>3</source>
         <translation>3</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3582"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3612"/>
         <source>3.1</source>
         <translation>3.1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3587"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3617"/>
         <source>3.2</source>
         <translation>3.2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3592"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3622"/>
         <source>4</source>
         <translation>4</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3597"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3627"/>
         <source>4.1</source>
         <translation>4.1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3602"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3632"/>
         <source>4.2</source>
         <translation>4.2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3607"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3637"/>
         <source>5</source>
         <translation>5</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3612"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3642"/>
         <source>5.1</source>
         <translation>5.1</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3635"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3665"/>
         <source>Sequence Parameter Set Identifer:</source>
         <translation>Identificatore set di parametri di sequenza:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3642"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3672"/>
         <source>IDC Level:</source>
         <translation>Livello IDC:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3658"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3688"/>
         <source>0</source>
         <translation>0</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3673"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3703"/>
         <source>7</source>
         <translation>7</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3678"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3708"/>
         <source>15</source>
         <translation>15</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3683"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3713"/>
         <source>31</source>
         <translation>31</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3708"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3738"/>
         <source>Generate Access Unit Delimiters</source>
         <translation>Genera delimitatori di unit? di accesso</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3718"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3748"/>
         <source>Pixel Aspect Ratio</source>
         <translation>Proporzioni pixel</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3738"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3768"/>
         <source>Custom:</source>
         <comment>PAR</comment>
         <translation>Personalizzato:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3748"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3778"/>
         <source>As Input</source>
         <translation>Come in ingresso</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3809"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3839"/>
         <source>:</source>
         <translation>:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3844"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3874"/>
         <source>Predefined Aspect Ratio:</source>
         <translation>Proporzioni predefinite:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3863"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3893"/>
         <source>16:15 (PAL 4:3)</source>
         <translation>16:15 (PAL 4:3)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3868"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3898"/>
         <source>64:45 (PAL 16:9)</source>
         <translation>64:45 (PAL 16:9)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3873"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3903"/>
         <source>8:9 (NTSC 4:3)</source>
         <translation>8:9 (NTSC 4:3)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3878"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3908"/>
         <source>32:27 (NTSC 16:9)</source>
         <translation>32:27 (NTSC 16:9)</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3920"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3950"/>
         <source>Output 2</source>
         <translation>Output 2</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3926"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3956"/>
         <source>Video Usability Information</source>
         <translation>Informazioni usabilit? video</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3932"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3962"/>
         <source>These settings are only suggestions for the playback equipment.  Use at your own risk.</source>
         <translation>Queste impostazioni sono solo suggerimenti per il dispositivo di riproduzione. Utilizzarle a proprio rischio.</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3976"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4028"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4092"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4161"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4240"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4006"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4058"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4122"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4191"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4270"/>
         <source>Undefined</source>
         <translation>Non definito</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4097"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4166"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4245"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4127"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4196"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4275"/>
         <source>BT709</source>
         <translation>BT709</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4102"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4171"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4132"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4201"/>
         <source>BT470M</source>
         <translation>BT470M</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4107"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4176"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4255"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4137"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4206"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4285"/>
         <source>BT470BG</source>
         <translation>BT470BG</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4181"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4211"/>
         <source>Linear</source>
         <translation>Lineare</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4186"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4216"/>
         <source>LOG100</source>
         <translation>LOG100</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4191"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4221"/>
         <source>LOG316</source>
         <translation>LOG316</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4196"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4226"/>
         <source>SMPTEL170M</source>
         <translation>SMPTEL170M</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4117"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4201"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4265"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4147"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4231"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4295"/>
         <source>SMPTE240M</source>
         <translation>SMPTE240M</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4076"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4106"/>
         <source>Colour Primaries:</source>
         <translation>Colori primari:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3981"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4011"/>
         <source>Show</source>
         <translation>Mostra</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3986"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4016"/>
         <source>Crop</source>
         <translation>Crop</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4250"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4280"/>
         <source>FCC</source>
         <translation>FCC</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4112"/>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4260"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4142"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4290"/>
         <source>SMPTE170M</source>
         <translation>SMPTE170M</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4270"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4300"/>
         <source>GBR</source>
         <translation>GBR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4275"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4305"/>
         <source>YCgCo</source>
         <translation>YCgCo</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4224"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4254"/>
         <source>Colour Matrix:</source>
         <translation>Matrice colore:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4033"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4063"/>
         <source>Component</source>
         <translation>Component</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4038"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4068"/>
         <source>PAL</source>
         <translation>PAL</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4043"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4073"/>
         <source>NTSC</source>
         <translation>NTSC</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4048"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4078"/>
         <source>SECAM</source>
         <translation>SECAM</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4053"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4083"/>
         <source>MAC</source>
         <translation>MAC</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4122"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4152"/>
         <source>Film</source>
         <translation>Film</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4145"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4175"/>
         <source>Transfer Characteristics:</source>
         <translation>Caratteristiche di trasferimento:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4298"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4328"/>
         <source>HRD Parameters:</source>
         <translation>Parametri HRD:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4313"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4343"/>
         <source>VBR</source>
         <translation>VBR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4318"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4348"/>
         <source>CBR</source>
         <translation>CBR</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4341"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4371"/>
         <source>Chroma Sample Location:</source>
         <translation>Posizione campione croma:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4009"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4039"/>
         <source>Video Format:</source>
         <translation>Formato video:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3960"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="3990"/>
         <source>Overscan:</source>
         <translation>Overscan:</translation>
     </message>
     <message>
-        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4380"/>
+        <location filename="../plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui" line="4410"/>
         <source>Full Range Samples</source>
         <translation>Campioni a gamma completa</translation>
     </message>

Modified: branches/avidemux_2.5_branch_gruntster/po/it.po
===================================================================
--- branches/avidemux_2.5_branch_gruntster/po/it.po	2011-09-15 16:15:21 UTC (rev 7560)
+++ branches/avidemux_2.5_branch_gruntster/po/it.po	2011-09-15 16:54:12 UTC (rev 7561)
@@ -7,8 +7,8 @@
 msgstr ""
 "Project-Id-Version: Avidemux\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-09-29 22:35+0100\n"
-"PO-Revision-Date: 2010-10-01 15:48+0100\n"
+"POT-Creation-Date: 2011-07-10 18:48+0100\n"
+"PO-Revision-Date: 2011-07-15 11:17+0100\n"
 "Last-Translator: Matteo 'Maff' Angelino <matteo.maff at gmail dot com>\n"
 "Language-Team: Avidemux Italian Translation\n"
 "MIME-Version: 1.0\n"
@@ -160,14 +160,14 @@
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:227
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:234
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:243
-#: avidemux/gtk_gui.cpp:947
-#: avidemux/gtk_gui.cpp:1557
-#: avidemux/gtk_gui.cpp:2691
+#: avidemux/gtk_gui.cpp:937
+#: avidemux/gtk_gui.cpp:1569
+#: avidemux/gtk_gui.cpp:2703
 msgid "File error"
 msgstr "Errore file"
 
 #: avidemux/ADM_coreUI/src/DIA_fileSel.cpp:127
-#: avidemux/gtk_gui.cpp:944
+#: avidemux/gtk_gui.cpp:934
 #, c-format
 msgid "Cannot open \"%s\"."
 msgstr "Impossibile aprire \"%s\"."
@@ -368,7 +368,7 @@
 
 #: avidemux/ADM_filter/filter_declaration.cpp:51
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_threshold.cpp:395
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:980
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1009
 msgid "Threshold"
 msgstr "Threshold"
 
@@ -439,7 +439,7 @@
 msgid "Size is not (s)QCIF"
 msgstr "La dimensione non ? (s)QCIF"
 
-#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp:626
+#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp:634
 msgid "Problem reading SVQ3 headers"
 msgstr "Problema di lettura delle intestazioni SVQ3"
 
@@ -669,6 +669,10 @@
 msgid "%u seconds"
 msgstr "%u secondi"
 
+#: avidemux/ADM_outputs/ADM_lavformat.cpp:214
+msgid "Can't mux that video codec into MKV"
+msgstr "Impossibile inserire quel codec video in MKV"
+
 #: avidemux/ADM_outputs/ADM_lavformat.cpp:373
 msgid "Incompatible frame rate"
 msgstr "Frame rate incompatibile"
@@ -728,11 +732,11 @@
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:555
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:570
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp:206
-#: avidemux/gtk_gui.cpp:2060
-#: avidemux/gtk_gui.cpp:2159
+#: avidemux/gtk_gui.cpp:2072
+#: avidemux/gtk_gui.cpp:2171
 #: plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp:197
 #: plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp:197
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1182
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1211
 #: plugins/ADM_videoFilters/colorYUV/gtk/DIA_coloryuv.cpp:357
 #: plugins/ADM_videoFilters/colorYUV/gtk/DIA_coloryuv.cpp:365
 #: plugins/ADM_videoFilters/colorYUV/gtk/DIA_coloryuv.cpp:373
@@ -849,7 +853,7 @@
 msgstr "Inizializzazione filtro fallita"
 
 #: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:131
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:415
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:418
 msgid "1st Pass"
 msgstr "1a passata"
 
@@ -867,7 +871,7 @@
 msgstr "Codifica"
 
 #: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:263
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:488
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:491
 msgid "2nd Pass"
 msgstr "2a passata"
 
@@ -889,7 +893,7 @@
 #: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:195
 #: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:311
 #: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:297
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:449
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:452
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:304
 #: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:266
 #: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:444
@@ -899,14 +903,14 @@
 #: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:202
 #: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:318
 #: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:304
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:456
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:459
 msgid "KeyFrame error"
 msgstr "Errore fotogramma chiave"
 
 #: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:202
 #: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:318
 #: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:304
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:456
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:459
 msgid ""
 "The beginning frame is not a key frame.\n"
 "Please move the A marker."
@@ -1039,8 +1043,8 @@
 
 #: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:326
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:101
-#: avidemux/gtk_gui.cpp:1557
-#: avidemux/gtk_gui.cpp:2691
+#: avidemux/gtk_gui.cpp:1569
+#: avidemux/gtk_gui.cpp:2703
 #, c-format
 msgid "Cannot open \"%s\" for writing."
 msgstr "Impossibile aprire \"%s\" per la scrittura."
@@ -1069,44 +1073,44 @@
 msgid "Pass 2"
 msgstr "Passata 2"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:243
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:244
 msgid "Select a directory"
 msgstr "Seleziona una cartella"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:514
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:515
 msgid "Uinteger"
 msgstr "Uinteger"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:517
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:518
 msgid "Test uinteger"
 msgstr "Prova uinteger"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:529
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:530
 msgid "Float"
 msgstr "Float"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:547
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:548
 msgid "Toggle"
 msgstr "Toggle"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:569
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:570
 msgid "No Strategy"
 msgstr "Nessuna strategia"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:570
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:571
 msgid "3:2 Pulldown"
 msgstr "3:2 Pulldown"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:571
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:572
 msgid "Pal/Secam"
 msgstr "Pal/Secam"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:572
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:573
 #: plugins/ADM_videoFilters/Telecide/ADM_vidDecTelecide.cpp:79
 msgid "NTSC converted from PAL"
 msgstr "NTSC convertito da PAL"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:574
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:575
 msgid "menu"
 msgstr "menu"
 
@@ -1223,7 +1227,7 @@
 
 #: avidemux/ADM_UIs/ADM_GTK/src/FAC_threadCount.cpp:100
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:544
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:859
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:888
 msgid "Custom"
 msgstr "Personalizzato"
 
@@ -1836,7 +1840,7 @@
 msgstr "Output"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:324
-#: avidemux/gtk_gui.cpp:2059
+#: avidemux/gtk_gui.cpp:2071
 msgid "Video"
 msgstr "Video"
 
@@ -3056,7 +3060,7 @@
 msgstr "Riuscito"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:9
-#: avidemux/gtk_gui.cpp:2337
+#: avidemux/gtk_gui.cpp:2349
 msgid "Failed"
 msgstr "Fallito"
 
@@ -4583,8 +4587,8 @@
 
 #: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:187
 #: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:321
-#: avidemux/gtk_gui.cpp:2071
-#: avidemux/gtk_gui.cpp:2168
+#: avidemux/gtk_gui.cpp:2083
+#: avidemux/gtk_gui.cpp:2180
 msgid "Select file"
 msgstr "Seleziona file"
 
@@ -4752,206 +4756,202 @@
 msgid "Output values:"
 msgstr "Valori in uscita:"
 
-#: avidemux/gtk_gui.cpp:264
+#: avidemux/gtk_gui.cpp:263
 msgid "Select ECMAScript to Run"
 msgstr "Seleziona uno script ECMA da eseguire"
 
-#: avidemux/gtk_gui.cpp:295
+#: avidemux/gtk_gui.cpp:294
 msgid "Audio filters cannot be applied in Copy mode"
 msgstr "I filtri audio non possono essere applicati in modalit? Copia"
 
-#: avidemux/gtk_gui.cpp:295
+#: avidemux/gtk_gui.cpp:294
 msgid "To apply filters the audio must be transcoded."
 msgstr "Per applicare i filtri l'audio deve essere convertito."
 
-#: avidemux/gtk_gui.cpp:350
-msgid "Obsolete"
-msgstr "Obsoleto"
-
-#: avidemux/gtk_gui.cpp:378
+#: avidemux/gtk_gui.cpp:368
 msgid "Not coded in this version"
 msgstr "Non incluso in questa versione"
 
-#: avidemux/gtk_gui.cpp:393
+#: avidemux/gtk_gui.cpp:383
 msgid "Select Video/Image File..."
 msgstr "Seleziona un file video/immagine..."
 
-#: avidemux/gtk_gui.cpp:437
-#: avidemux/gtk_gui.cpp:449
+#: avidemux/gtk_gui.cpp:427
+#: avidemux/gtk_gui.cpp:439
 msgid "Select Workbench to Save"
 msgstr "Seleziona il progetto da salvare"
 
-#: avidemux/gtk_gui.cpp:479
+#: avidemux/gtk_gui.cpp:469
 msgid "Select Raw File to Save"
 msgstr "Seleziona il file Raw da salvare"
 
-#: avidemux/gtk_gui.cpp:489
+#: avidemux/gtk_gui.cpp:479
 msgid "Select AVI File..."
 msgstr "Seleziona un file video..."
 
-#: avidemux/gtk_gui.cpp:492
+#: avidemux/gtk_gui.cpp:482
 msgid "Select AVI File to Append..."
 msgstr "Seleziona il file video da aggiungere..."
 
-#: avidemux/gtk_gui.cpp:496
+#: avidemux/gtk_gui.cpp:486
 msgid "Select File to Save Audio"
 msgstr "Seleziona il file audio da salvare"
 
-#: avidemux/gtk_gui.cpp:530
+#: avidemux/gtk_gui.cpp:520
 msgid "Select JPEG Sequence to Save"
 msgstr "Seleziona la sequenza JPEG da salvare"
 
-#: avidemux/gtk_gui.cpp:533
+#: avidemux/gtk_gui.cpp:523
 msgid "Select BMP to Save"
 msgstr "Seleziona il file BMP da salvare"
 
-#: avidemux/gtk_gui.cpp:537
+#: avidemux/gtk_gui.cpp:527
 msgid "Select JPEG to Save"
 msgstr "Seleziona il file JPEG da salvare"
 
-#: avidemux/gtk_gui.cpp:602
-#: avidemux/gtk_gui.cpp:725
+#: avidemux/gtk_gui.cpp:592
+#: avidemux/gtk_gui.cpp:715
 msgid "Select File to Save"
 msgstr "Seleziona il file da salvare"
 
-#: avidemux/gtk_gui.cpp:666
+#: avidemux/gtk_gui.cpp:656
 msgid "Select MP3 to Load"
 msgstr "Seleziona il file MP3 da caricare"
 
-#: avidemux/gtk_gui.cpp:669
+#: avidemux/gtk_gui.cpp:659
 msgid "Select AC3 to Load"
 msgstr "Seleziona il file AC3 da caricare"
 
-#: avidemux/gtk_gui.cpp:672
+#: avidemux/gtk_gui.cpp:662
 msgid "Select WAV to Load"
 msgstr "Seleziona il file WAV da caricare"
 
-#: avidemux/gtk_gui.cpp:712
+#: avidemux/gtk_gui.cpp:702
 msgid "Go to Frame"
 msgstr "Vai al fotogramma"
 
-#: avidemux/gtk_gui.cpp:712
+#: avidemux/gtk_gui.cpp:702
 msgid "_Go to frame:"
 msgstr "_Vai al fotogramma:"
 
-#: avidemux/gtk_gui.cpp:717
+#: avidemux/gtk_gui.cpp:707
 msgid "Out of bounds"
 msgstr "Oltre i limiti"
 
-#: avidemux/gtk_gui.cpp:723
-#: avidemux/gtk_gui.cpp:731
-#: avidemux/gtk_gui.cpp:778
-#: avidemux/gtk_gui.cpp:1970
+#: avidemux/gtk_gui.cpp:713
+#: avidemux/gtk_gui.cpp:721
+#: avidemux/gtk_gui.cpp:768
+#: avidemux/gtk_gui.cpp:1982
 msgid "Marker A > B"
 msgstr "Segnalibro A > B"
 
-#: avidemux/gtk_gui.cpp:723
+#: avidemux/gtk_gui.cpp:713
 msgid "An invalid frame range has been selected.  Make sure marker A is placed before marker B."
 msgstr "L'intervallo di fotogrammi selezionato non ? valido. Assicurati che il segnalibro A preceda il segnalibro B."
 
-#: avidemux/gtk_gui.cpp:731
+#: avidemux/gtk_gui.cpp:721
 msgid "Cannot copy."
 msgstr "Impossibile copiare."
 
-#: avidemux/gtk_gui.cpp:743
+#: avidemux/gtk_gui.cpp:733
 msgid "Something bad happened (II))"
 msgstr "C'? stato qualche errore (II)"
 
-#: avidemux/gtk_gui.cpp:757
+#: avidemux/gtk_gui.cpp:747
 msgid "Are you sure?"
 msgstr "Sei sicuro?"
 
-#: avidemux/gtk_gui.cpp:778
+#: avidemux/gtk_gui.cpp:768
 msgid "Cannot cut."
 msgstr "Impossibile tagliare."
 
-#: avidemux/gtk_gui.cpp:821
+#: avidemux/gtk_gui.cpp:811
 msgid "Use custom value"
 msgstr "Usa valore personalizzato"
 
-#: avidemux/gtk_gui.cpp:822
+#: avidemux/gtk_gui.cpp:812
 msgid "Frame Rate"
 msgstr "Frame rate"
 
-#: avidemux/gtk_gui.cpp:822
+#: avidemux/gtk_gui.cpp:812
 msgid "_Frames per second"
 msgstr "_Fotogrammi al secondo"
 
-#: avidemux/gtk_gui.cpp:825
+#: avidemux/gtk_gui.cpp:815
 msgid "PAL - 25 FPS"
 msgstr "PAL - 25 FPS"
 
-#: avidemux/gtk_gui.cpp:826
+#: avidemux/gtk_gui.cpp:816
 msgid "FILM - 24 FPS"
 msgstr "FILM - 24 FPS"
 
-#: avidemux/gtk_gui.cpp:827
+#: avidemux/gtk_gui.cpp:817
 msgid "NTSC - 30 FPS"
 msgstr "NTSC - 30 FPS"
 
-#: avidemux/gtk_gui.cpp:829
+#: avidemux/gtk_gui.cpp:819
 msgid "Standard Frame Rate:"
 msgstr "Frame rate standard:"
 
-#: avidemux/gtk_gui.cpp:835
+#: avidemux/gtk_gui.cpp:825
 msgid "Change Frame Rate"
 msgstr "Cambia frame rate"
 
-#: avidemux/gtk_gui.cpp:871
+#: avidemux/gtk_gui.cpp:861
 msgid "Width is not a multiple of 8"
 msgstr "La larghezza non ? un multiplo di 8"
 
-#: avidemux/gtk_gui.cpp:872
+#: avidemux/gtk_gui.cpp:862
 msgid "This will make trouble for AVI files."
 msgstr "Questo causer? un problema per i file AVI."
 
-#: avidemux/gtk_gui.cpp:883
+#: avidemux/gtk_gui.cpp:873
 msgid "Video filters cannot be applied in Copy mode"
 msgstr "I filtri video non possono essere applicati in modalit? Copia"
 
-#: avidemux/gtk_gui.cpp:883
+#: avidemux/gtk_gui.cpp:873
 msgid "To apply filters the video must be transcoded."
 msgstr "Per applicare i filtri il video deve essere convertito."
 
-#: avidemux/gtk_gui.cpp:888
+#: avidemux/gtk_gui.cpp:878
 msgid "Rebuild all Keyframes?"
 msgstr "Ricostruire tutti i fotogrammi chiave?"
 
-#: avidemux/gtk_gui.cpp:944
+#: avidemux/gtk_gui.cpp:934
 msgid "Permission error"
 msgstr "Errore di permesso"
 
-#: avidemux/gtk_gui.cpp:947
+#: avidemux/gtk_gui.cpp:937
 #, c-format
 msgid "\"%s\" does not exist."
 msgstr "\"%s\" non esiste."
 
-#: avidemux/gtk_gui.cpp:950
+#: avidemux/gtk_gui.cpp:940
 msgid "Error opening file"
 msgstr "Errore nell'apertura del file"
 
-#: avidemux/gtk_gui.cpp:950
+#: avidemux/gtk_gui.cpp:940
 #, c-format
 msgid "Error opening \"%s\"."
 msgstr "Errore nell'apertura di \"%s\"."
 
-#: avidemux/gtk_gui.cpp:994
+#: avidemux/gtk_gui.cpp:984
 msgid "Cannot open project using the video loader."
 msgstr "Impossibile aprire il progetto usando il caricatore video."
 
-#: avidemux/gtk_gui.cpp:995
+#: avidemux/gtk_gui.cpp:985
 msgid "Try 'File' -> 'Load/Run Project...'"
 msgstr "Prova 'File' -> 'Carica/esegui progetto...'"
 
-#: avidemux/gtk_gui.cpp:997
+#: avidemux/gtk_gui.cpp:987
 msgid "Could not open the file"
 msgstr "Impossibile aprire il file"
 
-#: avidemux/gtk_gui.cpp:1031
+#: avidemux/gtk_gui.cpp:1021
 msgid "Multiple Audio Tracks"
 msgstr "Tracce audio multiple"
 
-#: avidemux/gtk_gui.cpp:1031
+#: avidemux/gtk_gui.cpp:1021
 msgid ""
 "The file you just loaded contains several audio tracks.\n"
 "Go to Audio->MainTrack to select the active one."
@@ -4959,286 +4959,290 @@
 "Il file appena caricato contiene diverse tracce audio.\n"
 "Vai a 'Audio' -> 'Traccia principale' per selezionare la traccia attiva."
 
-#: avidemux/gtk_gui.cpp:1085
+#: avidemux/gtk_gui.cpp:1075
 msgid "No audio decoder found for this file"
 msgstr "Nessun decoder trovato per questo file"
 
-#: avidemux/gtk_gui.cpp:1086
+#: avidemux/gtk_gui.cpp:1076
 msgid "Save (A+V) will generate bad AVI. Save audio will work."
 msgstr "Salvare (A+V) generer? un file AVI difettoso. Salvare l'audio funzioner?."
 
-#: avidemux/gtk_gui.cpp:1145
+#: avidemux/gtk_gui.cpp:1135
 msgid "Something failed when appending"
 msgstr "Errore durante l'aggiunta"
 
-#: avidemux/gtk_gui.cpp:1156
-#: avidemux/gtk_gui.cpp:1989
+#: avidemux/gtk_gui.cpp:1146
+#: avidemux/gtk_gui.cpp:2001
 msgid "Something bad happened (II)"
 msgstr "C'? stato qualche errore (II)"
 
-#: avidemux/gtk_gui.cpp:1220
+#: avidemux/gtk_gui.cpp:1210
 msgid "Cannot save the audio in copy mode"
 msgstr "Impossibile salvare l'audio in modalit? copia"
 
-#: avidemux/gtk_gui.cpp:1220
+#: avidemux/gtk_gui.cpp:1210
 msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "Seleziona il codec audio WAV PCM, altrimenti il file audio sar? PCM grezzo."
 
-#: avidemux/gtk_gui.cpp:1228
-#: avidemux/gtk_gui.cpp:1596
+#: avidemux/gtk_gui.cpp:1218
+#: avidemux/gtk_gui.cpp:1608
 msgid "Saving audio"
 msgstr "Salvataggio audio in corso"
 
-#: avidemux/gtk_gui.cpp:1305
+#: avidemux/gtk_gui.cpp:1295
 msgid "Get Frame"
 msgstr "Prendi fotogramma"
 
-#: avidemux/gtk_gui.cpp:1305
+#: avidemux/gtk_gui.cpp:1295
 msgid "Cannot get this frame to save"
 msgstr "Impossibile salvare questo fotogramma"
 
-#: avidemux/gtk_gui.cpp:1343
+#: avidemux/gtk_gui.cpp:1333
 msgid "Mark A > B"
 msgstr "Segnalibro A > B"
 
-#: avidemux/gtk_gui.cpp:1343
+#: avidemux/gtk_gui.cpp:1333
 msgid "Set your markers correctly."
 msgstr "Imposta i tuoi segnalibri correttamente."
 
-#: avidemux/gtk_gui.cpp:1352
+#: avidemux/gtk_gui.cpp:1342
 msgid "Saving as set of jpegs"
 msgstr "Salvataggio come gruppo di jpeg in corso"
 
-#: avidemux/gtk_gui.cpp:1358
+#: avidemux/gtk_gui.cpp:1348
 msgid "Cannot decode frame"
 msgstr "Impossibile decodificare il fotogramma"
 
-#: avidemux/gtk_gui.cpp:1358
+#: avidemux/gtk_gui.cpp:1348
 msgid "Aborting."
 msgstr "Annullamento in corso."
 
-#: avidemux/gtk_gui.cpp:1369
-#: avidemux/gtk_gui.cpp:1388
-#: avidemux/gtk_gui.cpp:2333
+#: avidemux/gtk_gui.cpp:1359
+#: avidemux/gtk_gui.cpp:1378
+#: avidemux/gtk_gui.cpp:2345
 msgid "Done"
 msgstr "Fatto"
 
-#: avidemux/gtk_gui.cpp:1369
+#: avidemux/gtk_gui.cpp:1359
 #, c-format
 msgid "Saved %d images."
 msgstr "%d immagini salvate."
 
-#: avidemux/gtk_gui.cpp:1371
+#: avidemux/gtk_gui.cpp:1361
 msgid "Error"
 msgstr "Errore"
 
-#: avidemux/gtk_gui.cpp:1371
+#: avidemux/gtk_gui.cpp:1361
 msgid "Could not save all images."
 msgstr "Impossibile salvare tutte le immagini."
 
-#: avidemux/gtk_gui.cpp:1388
+#: avidemux/gtk_gui.cpp:1378
 #, c-format
 msgid "Saved \"%s\"."
 msgstr "\"%s\" salvato."
 
-#: avidemux/gtk_gui.cpp:1390
+#: avidemux/gtk_gui.cpp:1380
 msgid "BMP op failed"
 msgstr "Op. BMP fallita"
 
-#: avidemux/gtk_gui.cpp:1390
+#: avidemux/gtk_gui.cpp:1380
 #, c-format
 msgid "Saving %s as a BMP file failed."
 msgstr "Salvataggio di %s come file BMP fallito."
 
-#: avidemux/gtk_gui.cpp:1412
-#: avidemux/gtk_gui.cpp:1478
+#: avidemux/gtk_gui.cpp:1395
+#: avidemux/gtk_gui.cpp:1422
+#: avidemux/gtk_gui.cpp:1448
 msgid "Failed to open the file"
 msgstr "L'apertura del file ? fallita"
 
-#: avidemux/gtk_gui.cpp:1412
-#: avidemux/gtk_gui.cpp:1478
+#: avidemux/gtk_gui.cpp:1395
+msgid "Not an AC3 file?"
+msgstr "Non ? un file AC3?"
+
+#: avidemux/gtk_gui.cpp:1422
+msgid "Not an MP3 file?"
+msgstr "Non ? un file MP3?"
+
+#: avidemux/gtk_gui.cpp:1448
 msgid "Not a WAV file?"
 msgstr "Non ? un file WAV?"
 
-#: avidemux/gtk_gui.cpp:1413
-msgid "WAV open file failed..."
-msgstr "L'apertura del file WAV ? fallita"
-
-#: avidemux/gtk_gui.cpp:1550
+#: avidemux/gtk_gui.cpp:1562
 msgid "Cannot decompress audio frame"
 msgstr "Impossibile decomprimere il segmento audio"
 
-#: avidemux/gtk_gui.cpp:1564
+#: avidemux/gtk_gui.cpp:1576
 msgid "Memory Error"
 msgstr "Errore di memoria"
 
-#: avidemux/gtk_gui.cpp:1617
+#: avidemux/gtk_gui.cpp:1629
 msgid "No frames to encode"
 msgstr "Nessun fotogramma da codificare"
 
-#: avidemux/gtk_gui.cpp:1617
+#: avidemux/gtk_gui.cpp:1629
 msgid "Please check markers. Is \"A>\" == \">B\"?"
 msgstr "Controlla i segnalibri. ? \"A>\" == \">B\"?"
 
-#: avidemux/gtk_gui.cpp:1756
+#: avidemux/gtk_gui.cpp:1768
 msgid "Saving raw video stream"
 msgstr "Salvataggio flusso video grezzo in corso"
 
-#: avidemux/gtk_gui.cpp:1905
+#: avidemux/gtk_gui.cpp:1917
 msgid "Checking video"
 msgstr "Verifica video in corso"
 
-#: avidemux/gtk_gui.cpp:1921
+#: avidemux/gtk_gui.cpp:1933
 msgid "No error found"
 msgstr "Nessun errore trovato"
 
-#: avidemux/gtk_gui.cpp:1925
+#: avidemux/gtk_gui.cpp:1937
 #, c-format
 msgid "Errors found in %u frames"
 msgstr "Errori trovati in %u fotogrammi"
 
-#: avidemux/gtk_gui.cpp:1943
+#: avidemux/gtk_gui.cpp:1955
 msgid "Cannot decompress the audio stream"
 msgstr "Impossibile decomprimere il flusso audio"
 
-#: avidemux/gtk_gui.cpp:1943
+#: avidemux/gtk_gui.cpp:1955
 msgid "Switch audio codec to Copy."
 msgstr "Sposta la codifica audio su Copia."
 
-#: avidemux/gtk_gui.cpp:1970
+#: avidemux/gtk_gui.cpp:1982
 msgid "Cannot delete the selection."
 msgstr "Impossibile eliminare la selezione."
 
-#: avidemux/gtk_gui.cpp:1975
+#: avidemux/gtk_gui.cpp:1987
 msgid "You can't remove all frames"
 msgstr "Non puoi rimuovere tutti i fotogrammi"
 
-#: avidemux/gtk_gui.cpp:1982
-#: avidemux/gtk_gui.cpp:2604
+#: avidemux/gtk_gui.cpp:1994
+#: avidemux/gtk_gui.cpp:2616
 msgid "Something bad happened"
 msgstr "C'? stato qualche errore"
 
-#: avidemux/gtk_gui.cpp:2051
+#: avidemux/gtk_gui.cpp:2063
 msgid "Could not get tracks info"
 msgstr "Impossibile ottenere informazioni sulla traccia"
 
-#: avidemux/gtk_gui.cpp:2059
+#: avidemux/gtk_gui.cpp:2071
 msgid "Take audio from video file"
 msgstr "Recupera audio dal file video"
 
-#: avidemux/gtk_gui.cpp:2060
-#: avidemux/gtk_gui.cpp:2159
+#: avidemux/gtk_gui.cpp:2072
+#: avidemux/gtk_gui.cpp:2171
 msgid "No audio"
 msgstr "Nessuna traccia audio"
 
-#: avidemux/gtk_gui.cpp:2061
-#: avidemux/gtk_gui.cpp:2160
+#: avidemux/gtk_gui.cpp:2073
+#: avidemux/gtk_gui.cpp:2172
 msgid "External AC3"
 msgstr "AC3 esterno"
 
-#: avidemux/gtk_gui.cpp:2061
-#: avidemux/gtk_gui.cpp:2160
+#: avidemux/gtk_gui.cpp:2073
+#: avidemux/gtk_gui.cpp:2172
 msgid "Take audio from external AC3 file"
 msgstr "Prendi l'audio da un file AC3 esterno"
 
-#: avidemux/gtk_gui.cpp:2062
-#: avidemux/gtk_gui.cpp:2161
+#: avidemux/gtk_gui.cpp:2074
+#: avidemux/gtk_gui.cpp:2173
 msgid "External MP3"
 msgstr "MP3 esterno"
 
-#: avidemux/gtk_gui.cpp:2062
-#: avidemux/gtk_gui.cpp:2161
+#: avidemux/gtk_gui.cpp:2074
+#: avidemux/gtk_gui.cpp:2173
 msgid "Take audio from external MP3 file"
 msgstr "Prendi l'audio da un file MP3 esterno"
 
-#: avidemux/gtk_gui.cpp:2063
-#: avidemux/gtk_gui.cpp:2162
+#: avidemux/gtk_gui.cpp:2075
+#: avidemux/gtk_gui.cpp:2174
 msgid "External WAV"
 msgstr "WAV esterno"
 
-#: avidemux/gtk_gui.cpp:2063
-#: avidemux/gtk_gui.cpp:2162
+#: avidemux/gtk_gui.cpp:2075
+#: avidemux/gtk_gui.cpp:2174
 msgid "Take audio from external WAV file"
 msgstr "Prendi l'audio da un file WAV esterno"
 
-#: avidemux/gtk_gui.cpp:2067
-#: avidemux/gtk_gui.cpp:2167
+#: avidemux/gtk_gui.cpp:2079
+#: avidemux/gtk_gui.cpp:2179
 msgid "_Audio source:"
 msgstr "Sorgente _audio:"
 
-#: avidemux/gtk_gui.cpp:2071
-#: avidemux/gtk_gui.cpp:2168
+#: avidemux/gtk_gui.cpp:2083
+#: avidemux/gtk_gui.cpp:2180
 msgid "_External file:"
 msgstr "File _esterno:"
 
-#: avidemux/gtk_gui.cpp:2080
+#: avidemux/gtk_gui.cpp:2092
 #, c-format
 msgid "Audio track %d (%s/%d channels/%d kbit per s/%d ms shift)"
 msgstr "Traccia audio %d (%s / %d canali / %d kbps / ritardo %d ms)"
 
-#: avidemux/gtk_gui.cpp:2086
+#: avidemux/gtk_gui.cpp:2098
 msgid "_Track from video:"
 msgstr "_Traccia dal video:"
 
-#: avidemux/gtk_gui.cpp:2096
+#: avidemux/gtk_gui.cpp:2108
 msgid "Main Audio Track"
 msgstr "Traccia audio principale"
 
-#: avidemux/gtk_gui.cpp:2102
-#: avidemux/gtk_gui.cpp:2180
+#: avidemux/gtk_gui.cpp:2114
+#: avidemux/gtk_gui.cpp:2192
 msgid "Cannot load"
 msgstr "Impossibile caricare"
 
-#: avidemux/gtk_gui.cpp:2102
-#: avidemux/gtk_gui.cpp:2180
+#: avidemux/gtk_gui.cpp:2114
+#: avidemux/gtk_gui.cpp:2192
 msgid "The selected audio file does not exist."
 msgstr "Il file audio selezionato non esiste."
 
-#: avidemux/gtk_gui.cpp:2177
+#: avidemux/gtk_gui.cpp:2189
 msgid "Second Audio Track"
 msgstr "Traccia audio secondaria"
 
-#: avidemux/gtk_gui.cpp:2209
+#: avidemux/gtk_gui.cpp:2221
 msgid "Error loading the MP3 file"
 msgstr "Errore nel caricamento del file MP3"
 
-#: avidemux/gtk_gui.cpp:2218
-#: avidemux/gtk_gui.cpp:2240
-#: avidemux/gtk_gui.cpp:2262
+#: avidemux/gtk_gui.cpp:2230
+#: avidemux/gtk_gui.cpp:2252
+#: avidemux/gtk_gui.cpp:2274
 msgid "Second track loaded"
 msgstr "Seconda traccia caricata"
 
-#: avidemux/gtk_gui.cpp:2232
+#: avidemux/gtk_gui.cpp:2244
 msgid "Error loading the AC3 file"
 msgstr "Errore nel caricamento del file AC3"
 
-#: avidemux/gtk_gui.cpp:2254
+#: avidemux/gtk_gui.cpp:2266
 msgid "Error loading the WAV file"
 msgstr "Errore nel caricamento del file WAV"
 
-#: avidemux/gtk_gui.cpp:2321
+#: avidemux/gtk_gui.cpp:2333
 msgid "Saving failed"
 msgstr "Salvataggio fallito"
 
-#: avidemux/gtk_gui.cpp:2321
+#: avidemux/gtk_gui.cpp:2333
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
 msgstr "Il salvataggio dell'attivit? ? fallito. Forse c'? un problema di permesso con ~/.avidemux"
 
-#: avidemux/gtk_gui.cpp:2333
+#: avidemux/gtk_gui.cpp:2345
 #, c-format
 msgid "File %s has been successfully saved."
 msgstr "Il file %s ? stato salvato con successo."
 
-#: avidemux/gtk_gui.cpp:2337
+#: avidemux/gtk_gui.cpp:2349
 #, c-format
 msgid "File %s was NOT saved correctly."
 msgstr "Il file %s non ? stato salvato correttamente."
 
-#: avidemux/gtk_gui.cpp:2503
+#: avidemux/gtk_gui.cpp:2515
 msgid "AvsProxy"
 msgstr "AvsProxy"
 
-#: avidemux/gtk_gui.cpp:2503
+#: avidemux/gtk_gui.cpp:2515
 msgid ""
 "Failed to connect to avsproxy.\n"
 "Is it running ?"
@@ -5246,35 +5250,35 @@
 "Connessione a avsproxy fallita.\n"
 "? in esecuzione?"
 
-#: avidemux/gtk_gui.cpp:2508
+#: avidemux/gtk_gui.cpp:2520
 msgid "avsproxy"
 msgstr "avsproxy"
 
-#: avidemux/gtk_gui.cpp:2536
+#: avidemux/gtk_gui.cpp:2548
 msgid "Frame type:"
 msgstr "Tipo di fotogramma:"
 
-#: avidemux/gtk_gui.cpp:2537
+#: avidemux/gtk_gui.cpp:2549
 msgid "Frame size:"
 msgstr "Dimensione fotogramma:"
 
-#: avidemux/gtk_gui.cpp:2539
+#: avidemux/gtk_gui.cpp:2551
 msgid "Frame Hex Dump"
 msgstr "Hex Dump fotogramma"
 
-#: avidemux/gtk_gui.cpp:2590
+#: avidemux/gtk_gui.cpp:2602
 msgid "Memory error"
 msgstr "Errore di memoria"
 
-#: avidemux/gtk_gui.cpp:2597
+#: avidemux/gtk_gui.cpp:2609
 msgid "Error converting to BMP"
 msgstr "Errore conversione in BMP"
 
-#: avidemux/gtk_gui.cpp:2694
+#: avidemux/gtk_gui.cpp:2706
 msgid "Cannot encode the frame"
 msgstr "Impossibile codificare il fotogramma"
 
-#: avidemux/gtk_gui.cpp:2701
+#: avidemux/gtk_gui.cpp:2713
 msgid "Cannot initialise JPEG encoder"
 msgstr "Impossibile avviare l'encoder JPEG"
 
@@ -5373,7 +5377,7 @@
 #: plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp:244
 #: plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp:273
 #: plugins/ADM_audioEncoders/lame/audioencoder_lame.cpp:321
-#: plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp:220
+#: plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp:222
 #: plugins/ADM_audioEncoders/twolame/audioencoder_twolame.cpp:227
 #: plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp:310
 msgid "_Bitrate:"
@@ -5381,7 +5385,7 @@
 
 #: plugins/ADM_audioEncoders/aften/audioencoder_aften.cpp:250
 #: plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp:276
-#: plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp:223
+#: plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp:225
 msgid "Aften Configuration"
 msgstr "Configurazione Aften"
 
@@ -5519,7 +5523,7 @@
 
 #: plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp:216
 #: plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp:216
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:620
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:637
 msgid "Encoding Mode"
 msgstr "Modalit? di codifica"
 
@@ -5724,595 +5728,611 @@
 msgid "Stream _type:"
 msgstr "Tipo di flusso:"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:177
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:179
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:397
 msgid "Target bitrate (kb/s)"
 msgstr "Bitrate finale (kb/s)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:181
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:183
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:405
 msgid "Target video size (MB)"
 msgstr "Dimensione video finale (MB)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:185
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:187
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:409
 msgid "Average bitrate (kb/s)"
 msgstr "Bitrate medio (kb/s)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:599
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:616
 msgid "x264 Configuration"
 msgstr "Configurazione x264"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:627
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:644
 msgid "Quantizer"
 msgstr "Quantizzatore"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:634
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:651
 msgid "Target Size"
 msgstr "Dimensione finale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:647
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:664
 msgid "Constant Quantizer - Each frame will have the same compression. Low numbers equal higher quality while high numbers equal lower quality."
 msgstr "Quantizzatore costante - Ogni fotogramma avr? la stessa compressione. A valori minori corrisponde una maggiore qualit?, a valori maggiori una qualit? minore."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:655
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:672
 msgid "Target bitrate or file size"
 msgstr "Bitrate o dimensione finale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:663
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:680
 msgid "Single Pass - Quality Quantizer (Average)"
 msgstr "Passata singola - Quantizzatore qualit? (media)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:664
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:681
 msgid "Single Pass - Quality Quantizer (Constant)"
 msgstr "Passata singola - Quantizzatore qualit? (costante)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:665
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:682
 msgid "Single Pass - Bitrate (Average)"
 msgstr "Passata singola - Bitrate (medio)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:666
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:683
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:824
 msgid "Two Pass - Video Size"
 msgstr "Due passate - Dimensione video"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:667
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:684
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:828
 msgid "Two Pass - Average Bitrate"
 msgstr "Due passate - Bitrate medio"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:669
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:686
 msgid "Bitrate"
 msgstr "Bitrate"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:702
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:719
 msgid "Partition Decision"
 msgstr "Decisione partizione"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:709
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:726
 msgid "Method"
 msgstr "Metodo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:721
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:738
 msgid "1 - QPel SAD (Fastest)"
 msgstr "1 - QPel SAD (pi? veloce)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:722
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:739
 msgid "2 - QPel SATD"
 msgstr "2 - QPel SATD"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:723
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:740
 msgid "3 - HPel on MB then QPel"
 msgstr "3 - HPel sui MB poi QPel"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:724
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:741
 msgid "4 - Always QPel"
 msgstr "4 - Sempre QPel"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:725
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:742
 msgid "5 - QPel + Bidirectional ME"
 msgstr "5 - QPel + ME bidirezionale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:726
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:743
 msgid "6 - RD on I/P frames (Default)"
 msgstr "6 - RD sui fotogrammi I/P (predefinito)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:727
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:744
 msgid "7 - RD on all frames"
 msgstr "7 - RD su tutti i fotogrammi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:728
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:745
 msgid "8 - RD refinement on I/P frames"
 msgstr "8 - Rifinimento RD sui fotogrammi I/P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:729
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:746
 msgid "9 - RD refinement on all frames"
 msgstr "9 - Rifinimento RD su tutti i fotogrammi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:736
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:753
 msgid "Diamond Search"
 msgstr "Ricerca romboidale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:737
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:754
 msgid "Hexagonal Search"
 msgstr "Ricerca esagonale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:738
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:755
 msgid "Uneven Multi-hexagon"
 msgstr "Multi-esagono irregolare"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:739
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:756
 msgid "Exhaustive Search"
 msgstr "Ricerca esaustiva"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:740
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:757
 msgid "Hadamard Exhaustive Search"
 msgstr "Ricerca esaustiva Hadamard"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:748
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:765
 msgid "Max. Ref. Frames"
 msgstr ""
 "Numero massimo di\n"
 "fotogrammi di riferimento"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:755
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:772
 msgid "Range"
 msgstr "Intervallo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:768
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:785
 msgid "Define how many pixels are analysed for motion estimation. The higher the range the more accurate the analysis but the slower the encoding time."
 msgstr "Definisci il numero di pixel da analizzare. Maggiore ? l'intervallo, pi? accurata ? l'analisi, ma pi? lenta ? la codifica."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:777
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:794
 msgid "Set how many previous frames can be referenced by a P/B-frame. Numbers above 5 do not seem to improve quality greatly. Numbers 3 to 5 are recommended."
 msgstr "Imposta a quanti fotogrammi precedenti pu? riferirsi un fotogramma P/B. Valori superiori a 5 non sembrano migliorare molto la qualit?. Sono consigliati i valori da 3 a 5."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:780
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:797
 msgid "Chroma ME"
 msgstr "Stima movimento croma"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:785
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:802
 msgid "Use color information for detecting motion to improve quality"
 msgstr "Usa informazioni cromatiche per la rilevazione del movimento per migliorare la qualit?"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:788
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:805
 msgid "Mixed Refs"
 msgstr "Riferimenti misti "
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:793
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:810
 msgid "Calculate referencing individually based on each partition"
 msgstr "Calcola i riferimenti basati individualmente su ogni partizione"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:799
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:816
 msgid "Fast P-Skip"
 msgstr "Fast P-Skip"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:802
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:819
 msgid "Early skip detection on P-frames to speedup encoding. Quality will be slightly reduced."
 msgstr "Rilevamento sommario sui fotogrammi P per velocizzare la codifica. La qualit? sar? leggermente ridotta."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:805
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:822
 msgid "DCT Decimate"
 msgstr "Decimazione DCT"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:810
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:827
 msgid "Interlaced"
 msgstr "Interlacciato"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:813
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:830
 msgid "Input video is interlaced"
 msgstr "Il video in ingresso ? interlacciato"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:815
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:835
+msgid "Bottom Field First"
+msgstr "Prima il semiquadro inferiore"
+
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:837
+msgid "Top Field First"
+msgstr "Prima il semiquadro superiore"
+
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:840
+msgid "Fake Interlace"
+msgstr "Finto interlacciato"
+
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:842
+msgid "Select type of interlace"
+msgstr "Seleziona il tipo di interlacciamento"
+
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:844
 msgid "<b>Motion Estimation</b>"
 msgstr "<b>Stima movimento</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:844
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:855
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:873
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:884
 msgid "Enforce the size of a decoded pixel decoded to a certain value. Set this to 1:1 for non-anamorphic video."
 msgstr "Forza le dimensioni di un pixel decodificato a un certo valore. Impostare su 1:1 per un video non anamorfico."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:845
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:856
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:874
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:885
 #: plugins/ADM_videoFilters/Tdeint/DIA_tdeint.cpp:70
 msgid "1"
 msgstr "1"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:848
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:877
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1076
 msgid ":"
 msgstr ":"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:864
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:893
 msgid "Set a custom aspect ratio. The default 1:1 is recommended for most video."
 msgstr "Imposta proporzioni personalizzate. L'impostazione predefinita 1:1 ? raccomandata per la maggior parte dei video."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:869
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:898
 msgid "Predefined Aspect Ratio"
 msgstr "Proporzioni predefinite "
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:874
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:903
 msgid "Set a common predefined aspect ratio"
 msgstr "Imposta proporzioni comuni predefinite"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:878
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:907
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1065
 msgid "As Input"
 msgstr "Come in ingresso"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:899
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:928
 msgid "<b>Sample Aspect Ratio</b>"
 msgstr "<b>Campionamento proporzioni</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:926
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:955
 msgid "CABAC"
 msgstr "CABAC"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:929
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:958
 msgid "Lossless compression technique that reduces bitrate by approximately 10%. Increases encoding and decoding time."
 msgstr "Tecnica di compressione senza perdita che riduce il bitrate di circa il 10%. Aumenta il tempo di codifica e decodifica."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:936
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:965
 msgid "Trellis"
 msgstr "Trellis"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:945
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:974
 msgid "Use Trellis Rate Distortion Optimisation to find optimal encoding for each block. Level 0 equals disabled, level 1 equals normal and level 2 equals high."
 msgstr "Usa l'ottimizzazione distorsione Trellis per trovare la codifica ottimale per ogni blocco. 0 significa disattivata, 1 normale e 2 alta."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:952
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:981
 msgid "Noise Reduction"
 msgstr "Riduzione rumore"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:961
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:990
 msgid "Set the amount of noise reduction"
 msgstr "Imposta il livello di riduzione rumore"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:968
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:997
 msgid "Deblocking Filter"
 msgstr "Filtro deblocking "
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:971
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1000
 msgid "Enable in-loop deblocking to filter the video"
 msgstr "Attiva filtro deblocking in-loop"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:988
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1017
 msgid "Strength"
 msgstr "Intensit?"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1002
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1031
 msgid "Threshold for block detection. Positive values will detect more blocks, negative values will detect less."
 msgstr "Soglia rilevamento blocchi. Valori positivi rileveranno pi? blocchi, negativi meno."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1011
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1040
 msgid "Positive values will soften the video, negative values will sharpen"
 msgstr "Valori positivi renderanno il video pi? sfocato, negativi pi? nitido"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1014
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1043
 msgid "<b>Misc. Options</b>"
 msgstr "<b>Opzioni varie</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1019
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1048
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1091
 msgid "Motion & Misc"
 msgstr "Movimento e varie"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1045
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1074
 msgid "8x8 Transform"
 msgstr "Trasformata 8x8"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1048
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1077
 msgid "General block breakdown transformation"
 msgstr "Trasformazione per la ripartizione generale dei blocchi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1051
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1080
 msgid "8x8, 8x16 and 16x8 P-frame search"
 msgstr "Ricerca fotogrammi P 8x8, 8x16 e 16x8"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1054
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1083
 msgid "Improve the P-frame quality"
 msgstr "Migliora la qualit? dei fotogrammi P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1057
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1086
 msgid "8x8, 8x16 and 16x8 B-frame search"
 msgstr "Ricerca fotogrammi B 8x8, 8x16 e 16x8"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1060
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1089
 msgid "Improve the B-frame quality"
 msgstr "Migliora la qualit? dei fotogrammi B"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1063
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1092
 msgid "4x4, 4x8 and 8x4 P-frame search"
 msgstr "Ricerca fotogrammi P 4x4, 4x8 e 8x4"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1066
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1095
 msgid "Further improve the P-frame quality"
 msgstr "Migliora ulteriormente la qualit? dei fotogrammi P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1068
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1097
 msgid "8x8 Intra search"
 msgstr "Ricerca Intra 8x8"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1071
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1100
 msgid "Enable DCT Intra block search to improve quality"
 msgstr "Attiva ricerca blocchi Intra DCT per migliorare la qualit?"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1074
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1103
 msgid "4x4 Intra search"
 msgstr "Ricerca Intra 4x4"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1077
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1106
 msgid "Further enable DCT Intra block search to improve quality"
 msgstr "Attiva ricerca blocchi Intra DCT per migliorare ulteriormente la qualit?"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1080
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1109
 msgid "<b>Partition Macroblocks</b>"
 msgstr "<b>Partizione macroblocchi</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1104
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1133
 msgid "Bias"
 msgstr "Polarizzazione"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1111
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1140
 msgid "Max Consecutive"
 msgstr "Max consecutivi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1124
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1153
 msgid "Increase / decrease probability for how often B-frames are used. It will not violate the maximum consecutive frame limit."
 msgstr "Aumenta / diminuisce la probabilit? di utilizzo dei fotogrammi B. Non superer? il limite massimo di fotogrammi consecutivi."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1133
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1162
 msgid "Set the maximum number of consecutive B-frames. This defines how many duplicate frames can be dropped. Numbers 2 to 5 are recommended. This greatly improves the use of bitrate and quality."
 msgstr "Imposta il massimo numero di fotogrammi B consecutivi. Questa opzione definisce quanti fotogrammi duplicati possono essere eliminati. Sono consigliati i valori da 2 a 5. Migliora molto l'uso del bitrate e la qualit?."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1147
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1176
 msgid "Weighted Biprediction"
 msgstr "Previsione ponderata"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1152
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1181
 msgid "Enables weighting of B-frames to help fades"
 msgstr "Attiva ponderazione dei fotogrammi B per migliorare le dissolvenze"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1155
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1184
 msgid "Adaptative DCT"
 msgstr "DCT adattativo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1160
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1189
 msgid "Use fewer B-frames if needed. This is always recommended. If not enabled, the codec will always use the maximum number of consecutive B-frames."
 msgstr "Usa meno fotogrammi B se necessario. Sempre consigliato. Se disattivato, il codec user? sempre il numero massimo di fotogrammi B consecutivi."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1163
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1192
 msgid "Use as Reference"
 msgstr "Usa come riferimento"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1168
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1197
 msgid "Allow B-frames to make references non-linearly to another B-frame (instead of creating a duplicate copy)"
 msgstr "Consenti ai fotogrammi B di fare riferimento a un altro fotogramma B in modo non lineare"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1174
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1203
 msgid "B-Frame Direct Mode"
 msgstr "Modalit? diretta fotogrammi B "
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1183
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1212
 msgid "Spatial"
 msgstr "Spaziale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1184
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1213
 msgid "Temporal"
 msgstr "Temporale"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1185
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1214
 msgid "Auto"
 msgstr "Auto"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1187
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1216
 msgid "<b>B-Frames</b>"
 msgstr "<b>Fotogrammi B</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1192
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1221
 msgid "Partitions & Frames"
 msgstr "Partizioni & Fotogrammi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1227
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1256
 msgid "Set how much \"bitrate bonus\" a keyframe can get"
 msgstr "Imposta quanti \"bonus di bitrate\" pu? avere un fotogramma chiave"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1236
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1265
 msgid "Set how much bitrate is deducted from a B-frame as compared to the previous P-frame"
 msgstr "Imposta quanto bitrate ? dedotto dal fotogramma B rispetto al precedente fotogramma P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1245
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1274
 msgid "Define how much the bitrate can fluctuate over the entire video. 0% results in a constant bitrate stream, while 100% results in a pure quality based bitrate stream."
 msgstr "Definisci quanto pu? fluttuare il bitrate sull'intero video. 0% significa un flusso a bitrate costante, mentre 100% significa un flusso bitrate basato sulla qualit?."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1248
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1277
 msgid "Keyframe Boost (%)"
 msgstr "Amplifica fotogrammi chiave (%)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1255
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1284
 msgid "B-frame Reduction (%)"
 msgstr "Riduzione fotogrammi B (%)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1262
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1291
 msgid "Bitrate Variability (%)"
 msgstr "Variabilit? bitrate (%)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1269
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1298
 msgid "<b>Bitrate</b>"
 msgstr "<b>Bitrate</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1289
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1318
 msgid "Min QP"
 msgstr "QP minimo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1296
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1325
 msgid "Max QP"
 msgstr "QP massimo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1303
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1332
 msgid "Max QP Step"
 msgstr "Massima variazione QP"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1317
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1346
 msgid "Enforce a minimum quantizer level"
 msgstr "Imponi un livelo di quantizzatore minimo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1326
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1355
 msgid "Enforce a maximum quantizer level"
 msgstr "Imponi un livelo di quantizzatore massimo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1335
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1364
 msgid "Define how much the quantizer rate can change between two consecutive frames"
 msgstr "Definisci quanto pu? cambiare la quantizzazione tra due fotogrammi consecutivi"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1338
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1367
 msgid "<b>Quantization Limits</b>"
 msgstr "<b>Limiti di quantizzazione</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1365
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1394
 msgid "Increase / decrease sensitivity for detecting scene changes. Improves I-frame usage and quality."
 msgstr "Aumenta / diminuisci la sensibilita per rilevare cambiamenti di scena. Migliora l'uso dei fotogrammi I e la qualit?."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1368
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1397
 msgid "Scene Cut Threshold"
 msgstr "Soglia di taglio scena"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1375
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1404
 msgid "Min IDR Frame Interval"
 msgstr "Intervallo minimo fotogrammi IDR"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1388
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1417
 msgid "Set minimum frame interval between IDR frames. Defines the minimum amount a frame can be reused and referenced by other frames before a new IDR frame is established."
 msgstr "Imposta l'intervallo minimo tra fotogrammi IDR. Definisce il minimo numero di volte che un fotogramma pu? essere riutilizzato o preso a riferimento da altri fotogrammi prima che sia stabilito un nuovo IDR."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1397
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1426
 msgid "Set maximum frame interval between IDR frames. Defines the maximum amount a frame can be reused and referenced by other frames before a new IDR frame is established."
 msgstr "Imposta l'intervallo massimo tra fotogrammi IDR. Definisce il massimo numero di volte che un fotogramma pu? essere riutilizzato o preso a riferimento da altri fotogrammi prima che sia stabilito un nuovo IDR."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1400
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1429
 msgid "Max IDR Frame Interval"
 msgstr "Intervallo massimo fotogrammi IDR"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1407
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1436
 msgid "<b>More Rate Settings</b>"
 msgstr "<b>Altre opzioni</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1427
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1456
 msgid "VBV Buffer Size"
 msgstr "Dimensione buffer VBV"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1434
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1463
 msgid "Initial VBV Buffer (%)"
 msgstr "Buffer VBV iniziale (%)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1441
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1470
 msgid "Maximum Local Bitrate"
 msgstr "Bitrate locale massimo"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1472
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1501
 msgid "<b>Video Buffer Verifier</b>"
 msgstr "<b>Verifica buffer video</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1477
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1506
 msgid "Rate Control"
 msgstr "Controllo bitrate"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1505
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1534
 msgid "Bitrate Variance"
 msgstr "Varianza bitrate"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1518
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1547
 msgid "Allowed variance of average bitrate. Lower values mean less variance. Higher values mean more variance."
 msgstr "Varianza consentita del bitrate medio. Valori pi? alti significano maggiore varianza."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1527
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1556
 msgid "Allowed variance of average quantizer or quality. Lower values mean less variance. Higher values mean more variance. Note that 0 means constant quality while 1 means constant fluctuation. Recommended 0.6."
 msgstr "Varianza consentita della qualit? media. Valori pi? alti significano maggiore varianza. Nota che 0 significa qualit? costante mentre 1 fluttuazione costante. 0,6 consigliato."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1536
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1565
 msgid "Reduced fluctuations in Quantizer (before curve compression)"
 msgstr "Fluttuazioni ridotte nel quantizzatore (prima di compressione curva)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1547
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1576
 msgid "Quantizer Compression"
 msgstr "Compressione quantizzatore"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1554
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1583
 msgid "Temp. Blur of Est. Frame Complexity"
 msgstr "Sfocatura temp. complessit? fotogramma est."
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1561
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1590
 msgid "Temp. Blur of Quant. after CC"
 msgstr "Sfocatura temp. quant. dopo CC"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1568
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1597
 msgid "<b>Misc</b>"
 msgstr "<b>Varie</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1594
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1623
 msgid "Quantization factors used between I and P-frames"
 msgstr "Fattori di quantizzazione usati tra fotogrammi I e P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1603
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1632
 msgid "Quantization used between P and B-frames"
 msgstr "Quantizzazione usata tra fotogrammi P e B"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1612
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1641
 msgid "Quantization difference between chroma (color) and luma (brightness)"
 msgstr "Differenza di quantizzazione tra croma (colore) e luma (luminost?)"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1615
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1644
 msgid "Factor between I and P-frame Quants"
 msgstr "Fattore tra quantizzatori fotogrammi I e P"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1622
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1651
 msgid "Factor between P and B-frame Quants"
 msgstr "Fattore tra quantizzatori fotogrammi P e B"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1629
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1658
 msgid "Chroma QP Offset"
 msgstr "Offset Croma QP"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1636
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1665
 msgid "<b>Quantizers</b>"
 msgstr "<b>Quantizzatori</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1654
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1683
 msgid "Flat Matrix"
 msgstr "Matrice piana"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1661
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1690
 msgid "JVT Matrix"
 msgstr "Matrice JVT"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1671
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1700
 msgid "Custom Matrix"
 msgstr "Matrice personalizzata"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1681
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1710
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1153
 msgid "Open CQM file"
 msgstr "Apri file CQM"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1689
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1718
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1161
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1586
 msgid "Edit Custom Matrix"
 msgstr "Modifica matrice personalizzata"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1692
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1721
 msgid "Edit loaded custom quantization matrix file"
 msgstr "Modifica la matrice di quantizzazione personalizzata caricata"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1694
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1723
 msgid "<b>Quantization Matrices</b>"
 msgstr "<b>Matrici quantizzazione</b>"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1699
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1728
 msgid "More"
 msgstr "Altro"
 
-#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1707
+#: plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp:1736
 msgid "_Defaults"
 msgstr "_Predefiniti"
 
@@ -6578,7 +6598,7 @@
 
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1111
 msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
-msgstr "I quantizzatori H.263 levigano le immagini (utile a bassi bitrate)"
+msgstr "I quantizzatori H.263 attenuano le immagini (utile a bassi bitrate)"
 
 #: plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp:1115
 msgid "_MPEG"
@@ -6898,35 +6918,43 @@
 msgid "Width and height cannot be odd"
 msgstr "Larghezza e altezza non possono essere dispari"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:488
-msgid "Avisynth script filter (avsfilter), ver 0.7a(internal)"
-msgstr "Filtro script di Avisynth (avsfilter), ver 0.7a(interno)"
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:493
+msgid "Avisynth script filter ("
+msgstr "Filtro script di Avisynth ("
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:491
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:496
 msgid "Use avisynth script as video filter."
 msgstr "Utilizza uno script di Avisynth come filtro video."
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:538
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:541
+msgid "_wine app file:"
+msgstr "File applicazione _wine:"
+
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:542
+msgid "Select wine filename[wine/cedega/etc.]"
+msgstr "Seleziona il nome file di wine [wine/cedega/etc.]"
+
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:544
 msgid "_loader file:"
 msgstr "File _loader:"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:539
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:545
 msgid "Select loader filename[avsload.exe]"
-msgstr "Seleziona il nome del file loader [avsload.exe]"
+msgstr "Seleziona il nome file del loader [avsload.exe]"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:541
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:547
 msgid "_avs file:"
 msgstr "File _avs:"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:542
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:548
 msgid "Select avs filename[*.avs]"
 msgstr "Seleziona il nome del file avs [*.avs]"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:543
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:549
 msgid "_pipe timeout:"
 msgstr "_Pipe timeout:"
 
-#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:547
+#: plugins/ADM_videoFilters/AvsFilter/avsfilter.cpp:553
 msgid "AvsFilter config"
 msgstr "Configurazione AvsFilter"
 
@@ -7361,7 +7389,7 @@
 
 #: plugins/ADM_videoFilters/DgBob/ADM_vidDGbob.cpp:68
 msgid "Donald Graft Bob."
-msgstr "Filtro Bob di Donald Graft."
+msgstr "Filtro sdoppiamento di Donald Graft."
 
 #: plugins/ADM_videoFilters/DgBob/ADM_vidDGbob.cpp:78
 #: plugins/ADM_videoFilters/KernelDeint/ADM_vidKernelDeint.cpp:70
@@ -7545,12 +7573,12 @@
 #: plugins/ADM_videoFilters/FastConvolution/Gauss.cpp:27
 #: plugins/ADM_videoFilters/FastConvolution/Mean.cpp:26
 msgid "Gauss smooth"
-msgstr "Nitidizzazione gaussiana"
+msgstr "Attenuazione gaussiana"
 
 #: plugins/ADM_videoFilters/FastConvolution/Gauss.cpp:30
 #: plugins/ADM_videoFilters/FastConvolution/Mean.cpp:26
 msgid "Gaussian smooth. Blur the picture."
-msgstr "Nitidizza in modo gaussiano. Sfoca l'immagine."
+msgstr "Attenua in modo gaussiano. Sfoca l'immagine."
 
 #: plugins/ADM_videoFilters/FastConvolution/Mean.cpp:27
 #: plugins/ADM_videoFilters/FastConvolution/Median.cpp:27
@@ -7931,7 +7959,7 @@
 
 #: plugins/ADM_videoFilters/MplayerDenoise3D/ADM_vidMPLD3Dlow.cpp:36
 msgid "Reduce noise, smooth image, increase compressibility."
-msgstr "Riduce il rumore, leviga le immagini, aumenta la comprimibilit?."
+msgstr "Riduce il rumore, attenua l'immagine, aumenta la comprimibilit?."
 
 #: plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp:83
 msgid "MPlayer resize"
@@ -7964,7 +7992,7 @@
 
 #: plugins/ADM_videoFilters/MSmooth/ADM_vidMsmooth.cpp:106
 msgid "Smooth the image, don't blur edges. Useful on anime."
-msgstr "Leviga l'immagine, non sfoca i margini. Utile per l'anime."
+msgstr "Attenua l'immagine, non sfoca i margini. Utile per l'anime."
 
 #: plugins/ADM_videoFilters/MSmooth/ADM_vidMsmooth.cpp:181
 msgid "_High quality"
@@ -8594,7 +8622,7 @@
 
 #: plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp:138
 msgid "Bob, temporal & spatial check"
-msgstr "Bob, verifica temporale e spaziale"
+msgstr "Sdoppia, verifica temporale e spaziale"
 
 #: plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp:139
 msgid "Skip spatial temporal check"
@@ -8602,7 +8630,7 @@
 
 #: plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp:140
 msgid "Bob, skip spatial temporal check"
-msgstr "Bob, salta verifica temporale spaziale"
+msgstr "Sdoppia, salta verifica temporale spaziale"
 
 #: plugins/ADM_videoFilters/Yadif/ADM_vidYadif.cpp:148
 msgid "_Order:"
@@ -8656,5 +8684,14 @@
 msgid "Video CD"
 msgstr "Video CD"
 
+#~ msgid "Obsolete"
+#~ msgstr "Obsoleto"
+
+#~ msgid "WAV open file failed..."
+#~ msgstr "L'apertura del file WAV ? fallita"
+
+#~ msgid "Avisynth script filter (avsfilter), ver 0.7a(internal)"
+#~ msgstr "Filtro script di Avisynth (avsfilter), ver 0.7a(interno)"
+
 #~ msgid "dummy"
 #~ msgstr "fittizio"



From gruntster at mail.berlios.de  Thu Sep 15 19:30:31 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 19:30:31 +0200
Subject: [Avidemux-svn-commit] r7562 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20110915173031.A1C974811D7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 19:30:31 +0200 (Thu, 15 Sep 2011)
New Revision: 7562

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
Log:
[mswin] simplify utf-16 to utf-8 conversion of command line

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-15 16:54:12 UTC (rev 7561)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-09-15 17:30:31 UTC (rev 7562)
@@ -502,22 +502,19 @@
 
 void getUtf8CommandLine(int *argc, char **argv[])
 {
-	wchar_t **wargv = CommandLineToArgvW(GetCommandLineW(), argc);
-
-	if (wargv)
-	{
-		*argv = new char *[*argc];
-
-		for (int i = 0; i < *argc; i++)
-		{
-			wchar_t *warg = wargv[i];
-			int wargLength = wcslen(warg);
-			int utf8Length = wideCharStringToUtf8(warg, wargLength, NULL);
-			char *utf8 = new char[utf8Length + 1];
-
-			wideCharStringToUtf8(warg, wargLength, utf8);
-			utf8[utf8Length] = '\0';
-			(*argv)[i] = utf8;
+	wchar_t **wargv = CommandLineToArgvW(GetCommandLineW(), argc);
+
+	if (wargv)
+	{
+		*argv = new char *[*argc];
+
+		for (int i = 0; i < *argc; i++)
+		{
+			int utf8Length = wideCharStringToUtf8(wargv[i], -1, NULL);
+			char *utf8 = new char[utf8Length];
+
+			wideCharStringToUtf8(wargv[i], -1, utf8);
+			(*argv)[i] = utf8;
 		}
 
 		LocalFree(wargv);



From gruntster at mail.berlios.de  Thu Sep 15 21:02:48 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 21:02:48 +0200
Subject: [Avidemux-svn-commit] r7563 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux/qt4 avidemux_core/ADM_core/include
	avidemux_core/ADM_core/src
Message-ID: <20110915190248.7728E48135A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 21:02:47 +0200 (Thu, 15 Sep 2011)
New Revision: 7563

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
Log:
[mswin] default working files to user's profile but provide a --portable parameter for the nut jobs

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 17:30:31 UTC (rev 7562)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-15 19:02:47 UTC (rev 7563)
@@ -104,11 +104,11 @@
 
 void onexit(void);
 int startAvidemux(int argc, char *argv[]);
+bool isPortableMode(int argc, char *argv[]);
 
 int main(int _argc, char *_argv[])
 {
-	char **argv;
-	int argc;
+	ADM_initBaseDir(isPortableMode(_argc, _argv));
 
 #if defined(_WIN32) && (ADM_UI_TYPE_BUILD == ADM_UI_GTK || ADM_UI_TYPE_BUILD == ADM_UI_QT4)
 	// redirect output before registering exception handler so error dumps are captured
@@ -117,6 +117,9 @@
 
 	installSigHandler();
 
+	char **argv;
+	int argc;
+
 #ifdef _WIN32
 	getUtf8CommandLine(&argc, &argv);
 #else
@@ -198,9 +201,9 @@
 
     printf("Time: %s\n", ADM_epochToString(ADM_getSecondsSinceEpoch()));
 
-	for(int i = 0; i < argc; i++)
-	{
-		printf("%d: %s\n", i, argv[i]);
+	for(int i = 0; i < argc; i++)
+	{
+		printf("%d: %s\n", i, argv[i]);
 	}
 
 	// Start counting memory
@@ -401,9 +404,21 @@
     #endif
 #endif
 }
-extern void checkCrashFile(void);
-void dummyXref(void)
+
+bool isPortableMode(int argc, char *argv[])
 {
-    checkCrashFile();
+	bool portableMode = false;
+
+	for (int i = 0; i < argc; i++)
+	{
+		if (strcmp(argv[i], "--portable") == 0)
+		{
+			portableMode = true;
+			break;
+		}
+	}
+
+	return portableMode;
 }
+
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 17:30:31 UTC (rev 7562)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 19:02:47 UTC (rev 7563)
@@ -160,7 +160,7 @@
 endif (WIN32 OR APPLE)
 
 IF (WIN32)
-	target_link_libraries(ADM_osSupport)
+	target_link_libraries(avidemux3_qt4 ADM_osSupport6)
 	target_link_libraries(avidemux3_qt4 winmm -mwindows -Wl,--export-all-symbols)
 ENDIF (WIN32)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h	2011-09-15 17:30:31 UTC (rev 7562)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_files.h	2011-09-15 19:02:47 UTC (rev 7563)
@@ -16,6 +16,9 @@
  ***************************************************************************/
 #ifndef ADM_FILES_H
 #define ADM_FILES_H
+#ifdef __cplusplus
+void ADM_initBaseDir(bool portableMode);
+#endif
 // Returns dir to ~/.avidemux, no need to free it
 char *ADM_getBaseDir(void);
 // Returns dir to ~/.avidemux/jobs, no need to free it

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h	2011-09-15 17:30:31 UTC (rev 7562)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_win32.h	2011-09-15 19:02:47 UTC (rev 7563)
@@ -1,6 +1,8 @@
 #if defined(_WIN32) && !defined ADM_WIN32_H
 #define ADM_WIN32_H
 
+#include "ADM_inttype.h"
+
 uint8_t win32_netInit(void);
 int shutdown_win32(void);
 bool getWindowsVersion(char* version);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-15 17:30:31 UTC (rev 7562)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2011-09-15 19:02:47 UTC (rev 7563)
@@ -19,8 +19,9 @@
 #include <dirent.h>
 #include <errno.h>
 #include <sys/stat.h>
-#include <unistd.h>
 
+#include "ADM_win32.h"
+
 #if defined(__APPLE__)
  #include <Carbon/Carbon.h>
 #else
@@ -33,25 +34,10 @@
 
 #include "ADM_default.h"
 
-#define WIN32_PORTABLE_MODE 1
-
 #ifdef __WIN32
 static const char *SEPARATOR="\\";
-
-#ifdef WIN32_PORTABLE_MODE
-    const char *ADM_DIR_NAME="settings";
-    bool portable=true;
 #else
-    const char *ADM_DIR_NAME="avidemux6";
-    bool portable=false;
-#endif
-#elif defined __HAIKU__
 static const char *SEPARATOR="/";
-const char *ADM_DIR_NAME="config/settings/avidemux6";
-
-#else
-static const char *SEPARATOR="/";
-const char *ADM_DIR_NAME=".avidemux6";
 #endif
 
 static char ADM_basedir[1024] = {0};
@@ -60,18 +46,12 @@
 static char *ADM_autodir = NULL;
 static char *ADM_systemPluginSettings=NULL;
 static char *ADM_userPluginSettings=NULL;
-static int baseDirDone = 0;
 
 #undef fread
 #undef fwrite
 #undef fopen
 #undef fclose
 
-#ifdef __WIN32
-extern int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
-extern int wideCharStringToUtf8(const wchar_t *wideCharString, int wideCharStringLength, char *utf8String);
-#endif
-
 size_t ADM_fread (void *ptr, size_t size, size_t n, FILE *sstream)
 {
 	return fread(ptr,size,n,sstream);
@@ -399,19 +379,22 @@
 	return ADM_getRelativePath(ADM_INSTALL_DIR, base1, base2, base3);
 #endif
 }
+
 /*
       Get the root directory for .avidemux stuff
 ******************************************************/
 char *ADM_getBaseDir(void)
 {
-	char *home;
+	return ADM_basedir;
+}
 
-	if (baseDirDone)
-		return ADM_basedir;
+void ADM_initBaseDir(bool portableMode)
+{
+	char *home = NULL;
 
 	// Get the base directory
 #ifdef __WIN32
-    if (portable)
+    if (portableMode)
     {
         // Portable mode...
         home = ADM_getInstallRelativePath(NULL, NULL, NULL);
@@ -444,31 +427,43 @@
 	else
 	{
 		printf("Oops: can't determine $HOME.");
-
-		return NULL;
 	}
 #endif
 
 	// Try to open the .avidemux directory
 
-	strcpy(ADM_basedir, home);
-	AddSeparator(ADM_basedir);
-	strcat(ADM_basedir, ADM_DIR_NAME);
-	strcat(ADM_basedir, SEPARATOR);
+	if (home)
+	{
+		strcpy(ADM_basedir, home);
+		AddSeparator(ADM_basedir);
 
-    delete [] home;
-    home=NULL;
+#ifdef _WIN32
+		const char *ADM_DIR_NAME;
 
-	if (!ADM_mkdir(ADM_basedir))
-	{
-		ADM_error("Oops: cannot create the .avidemux directoryi (%s)\n",ADM_basedir);
-		return NULL;
-	}
+		if (portableMode)
+			ADM_DIR_NAME = "settings";
+		else
+			ADM_DIR_NAME = "avidemux";
+#elif defined __HAIKU__
+		const char *ADM_DIR_NAME = "config/settings/avidemux6";
+#else
+		const char *ADM_DIR_NAME = ".avidemux6";
+#endif
 
-	// Now built the filename
-	baseDirDone = 1;
-	printf("Using %s as base directory for prefs/jobs/...\n", ADM_basedir);
-	return ADM_basedir;
+		strcat(ADM_basedir, ADM_DIR_NAME);
+		strcat(ADM_basedir, SEPARATOR);
+
+		delete [] home;
+
+		if (ADM_mkdir(ADM_basedir))
+		{
+			printf("Using %s as base directory for prefs, jobs, etc.\n", ADM_basedir);
+		}
+		else
+		{
+			ADM_error("Oops: cannot create the .avidemux directoryi (%s)\n", ADM_basedir);
+		}
+	}
 }
 
 #ifdef __WIN32



From gruntster at mail.berlios.de  Thu Sep 15 21:12:20 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Sep 2011 21:12:20 +0200
Subject: [Avidemux-svn-commit] r7564 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4
Message-ID: <20110915191221.0801E48135A@sheep.berlios.de>

Author: gruntster
Date: 2011-09-15 21:12:20 +0200 (Thu, 15 Sep 2011)
New Revision: 7564

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[qt] link problem isn't just with windows

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 19:02:47 UTC (rev 7563)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-09-15 19:12:20 UTC (rev 7564)
@@ -130,6 +130,7 @@
 	ADM_shellQt4
 	ADM_toolkit6
 	ADM_coreAudioDevice6
+	ADM_osSupport6
 )
 
 ###########################################
@@ -160,7 +161,6 @@
 endif (WIN32 OR APPLE)
 
 IF (WIN32)
-	target_link_libraries(avidemux3_qt4 ADM_osSupport6)
 	target_link_libraries(avidemux3_qt4 winmm -mwindows -Wl,--export-all-symbols)
 ENDIF (WIN32)
 



From mean at mail.berlios.de  Fri Sep 16 08:55:28 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 16 Sep 2011 08:55:28 +0200
Subject: [Avidemux-svn-commit] r7565 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl
Message-ID: <20110916065528.981EB48123F@sheep.berlios.de>

Author: mean
Date: 2011-09-16 08:55:28 +0200 (Fri, 16 Sep 2011)
New Revision: 7565

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
Log:
[glFilter] Remove glYadif, its unfinished

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-15 19:12:20 UTC (rev 7564)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-16 06:55:28 UTC (rev 7565)
@@ -1,5 +1,5 @@
 #ADD_SUBDIRECTORY(glSmooth)
-ADD_SUBDIRECTORY(glYadif)
+#ADD_SUBDIRECTORY(glYadif)
 #ADD_SUBDIRECTORY(sample_fragment)
 ADD_SUBDIRECTORY(sample_fragment2)
 ADD_SUBDIRECTORY(sample_distort)



From gruntster at mail.berlios.de  Fri Sep 16 20:08:20 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 16 Sep 2011 20:08:20 +0200
Subject: [Avidemux-svn-commit] r7566 - in branches/avidemux_2.6_branch_mean:
	avidemux/winInstaller foreignBuilds/mswin/avidemux
Message-ID: <20110916180821.1BC4248123F@sheep.berlios.de>

Author: gruntster
Date: 2011-09-16 20:08:20 +0200 (Fri, 16 Sep 2011)
New Revision: 7566

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
Log:
[mswin] corrections to installer

Modified: branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-16 06:55:28 UTC (rev 7565)
+++ branches/avidemux_2.6_branch_mean/avidemux/winInstaller/avidemux.nsi	2011-09-16 18:08:20 UTC (rev 7566)
@@ -16,8 +16,9 @@
 # Defines
 ##########################
 
-!define PRODUCT_VERSION "2.6.0.${REVISION}"
-!define PRODUCT_NAME "Avidemux 2.6"
+!define CORE_VERSION "2.6"
+!define PRODUCT_VERSION "${CORE_VERSION}.0.${REVISION}"
+!define PRODUCT_NAME "Avidemux ${CORE_VERSION}"
 !define PRODUCT_FULLNAME "Avidemux ${PRODUCT_VERSION} (${BUILD_BITS}-bit beta)"
 
 !if ${BUILD_BITS} == 64
@@ -47,13 +48,13 @@
 !endif
 
 !ifdef INST_BOTH
-OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_full_win${BUILD_BITS}.exe"
+OutFile "${EXEDIR}\avidemux_${CORE_VERSION}_r${REVISION}_full_win${BUILD_BITS}.exe"
 Name "${PRODUCT_FULLNAME} Full"
 !else ifdef INST_QT
-OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_win${BUILD_BITS}.exe"
+OutFile "${EXEDIR}\avidemux_${CORE_VERSION}_r${REVISION}_win${BUILD_BITS}.exe"
 Name "${PRODUCT_FULLNAME}"
 !else ifdef INST_GTK
-OutFile "${EXEDIR}\avidemux_2.6_r${REVISION}_gtk_win${BUILD_BITS}.exe"
+OutFile "${EXEDIR}\avidemux_${CORE_VERSION}_r${REVISION}_gtk_win${BUILD_BITS}.exe"
 Name "${PRODUCT_FULLNAME} GTK+"
 !endif
 
@@ -291,6 +292,7 @@
     ${File} libgcc_s_sjlj-1.dll
 	${File} nspr4.dll
     ${File} libjs.dll
+	${File} libADM_audioParser6.dll
     ${File} libADM_core6.dll
     ${File} libADM_coreAudio6.dll
 	${File} libADM_coreAudioDevice6.dll
@@ -319,6 +321,8 @@
     ${File} avutil-*.dll
     ${File} postproc-*.dll
     ${File} swscale-*.dll
+    SetOutPath $INSTDIR\plugins\autoScripts
+    ${Folder} plugins\autoScripts
 SectionEnd
 
 SectionGroup /e "User interfaces" SecGrpUI
@@ -725,6 +729,8 @@
 			${File} plugins\videoEncoders\libADM_ve_x264_qt4.dll
 End:
 !endif
+			SetOutPath $INSTDIR\plugins\pluginSettings\x264
+			${Folder} plugins\pluginSettings\x264
 			SetOutPath $INSTDIR
 			${File} libx264-*.dll
 		${MementoSectionEnd}
@@ -987,20 +993,8 @@
 				SetOutPath $INSTDIR\plugins\videoFilters
 				${File} plugins\videoFilters\libADM_vf_sampleGlVertex.dll
 			${MementoSectionEnd}
-			${MementoSection} "Yadif" SecVidFltOpenGlYadif
-				SectionIn 1 2
-				SetOverwrite on
-				SetOutPath $INSTDIR\plugins\videoFilters
-				${File} plugins\videoFilters\libADM_vf_glYadif.dll
-			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup "Miscellaneous Filters" SecGrpVideoFilterMiscellaneous
-			${MementoUnselectedSection} "Dummy" SecVidFltDummy
-				SectionIn 2
-				SetOverwrite on
-				SetOutPath $INSTDIR\plugins\videoFilters
-				${File} plugins\videoFilters\libADM_vf_dummy.dll
-			${MementoSectionEnd}
 			${MementoSection} "Print Information" SecVidFltPrintInfo
 				SectionIn 1 2
 				SetOverwrite on
@@ -1023,7 +1017,7 @@
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Change Log.lnk" "$INSTDIR\Change Log.html"
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Change Log ${CORE_VERSION}.lnk" "$INSTDIR\Change Log.html"
     !insertmacro MUI_STARTMENU_WRITE_END
 ${MementoSectionEnd}
 
@@ -1032,7 +1026,7 @@
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux_gtk.exe
     !insertmacro MUI_STARTMENU_WRITE_END
 !endif
 ${MementoSectionEnd}
@@ -1042,7 +1036,7 @@
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux.exe
     !insertmacro MUI_STARTMENU_WRITE_END
 !endif
 ${MementoSectionEnd}
@@ -1051,35 +1045,35 @@
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI.lnk" "$INSTDIR\avsproxy_gui.exe"
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI ${CORE_VERSION}.lnk" "$INSTDIR\avsproxy_gui.exe"
     !insertmacro MUI_STARTMENU_WRITE_END
 ${MementoSectionEnd}
 
 ${MementoSection} "-Quick Launch GTK+" SecQuickLaunchGtk
 !ifdef INST_GTK
     SetOutPath $INSTDIR
-    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux_gtk.exe
 !endif
 ${MementoSectionEnd}
 
 ${MementoSection} "-Quick Launch Qt" SecQuickLaunchQt
 !ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
+    CreateShortcut "$QUICKLAUNCH\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux.exe
 !endif
 ${MementoSectionEnd}
 
 ${MementoSection} "-Desktop GTK+" SecDesktopGtk
 !ifdef INST_GTK
     SetOutPath $INSTDIR
-    CreateShortcut "$DESKTOP\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux2_gtk.exe
+    CreateShortcut "$DESKTOP\${SHORTCUT_NAME} GTK+.lnk" $INSTDIR\avidemux_gtk.exe
 !endif
 ${MementoSectionEnd}
 
 ${MementoSection} "-Desktop Qt" SecDesktopQt
 !ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$DESKTOP\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux2.exe
+    CreateShortcut "$DESKTOP\${SHORTCUT_NAME}.lnk" $INSTDIR\avidemux.exe
 !endif
 ${MementoSectionEnd}
 
@@ -1119,8 +1113,8 @@
     Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\${SHORTCUT_NAME}.lnk"
 !endif
 
-	Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Change Log.lnk"
-    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI.lnk"
+	Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Change Log ${CORE_VERSION}.lnk"
+    Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI ${CORE_VERSION}.lnk"
     RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup
     DeleteRegValue HKLM "${REGKEY}" StartMenuGroup
     
@@ -1167,28 +1161,6 @@
 	${MementoSectionSave}
 FunctionEnd
 
-!ifdef INST_BOTH
-Function .onSelChange
-	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end checkCLI
-checkCLI:
-	!insertmacro SectionFlagIsSet ${SecUiCli} ${SF_SELECTED} end disable
-
-disable:  # GTK langs only
-	SectionSetFlags ${SecLangCatalan} SF_RO
-	SectionSetFlags ${SecLangCzech} SF_RO
-	SectionSetFlags ${SecLangFrench} SF_RO
-	SectionSetFlags ${SecLangGerman} SF_RO
-	SectionSetFlags ${SecLangGreek} SF_RO
-	SectionSetFlags ${SecLangJapanese} SF_RO
-	SectionSetFlags ${SecLangRussian} SF_RO
-	SectionSetFlags ${SecLangSerbianCyrillic} SF_RO
-	SectionSetFlags ${SecLangSerbianLatin} SF_RO
-	SectionSetFlags ${SecLangSpanish} SF_RO
-	SectionSetFlags ${SecLangTurkish} SF_RO
-end:
-FunctionEnd
-!endif
-
 Function LoadPreviousSettings
     ${MementoSectionRestore}
 	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
@@ -1416,7 +1388,7 @@
     IntOp $0 $0 & ${SF_SELECTED}
 
     StrCmp $0 ${SF_SELECTED} 0 GTK
-        Exec "$INSTDIR\avidemux_qt4.exe"
+        Exec "$INSTDIR\avidemux.exe"
 
     Goto end
 GTK:

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2011-09-16 06:55:28 UTC (rev 7565)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2011-09-16 18:08:20 UTC (rev 7566)
@@ -33,7 +33,7 @@
 mkdir "%packageDir%"
 
 cd "%curDir%"
-call "2b. Package SDK.bat"
+rem call "2b. Package SDK.bat"
 if errorlevel 1 goto error
 
 cd "%curDir%"

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2011-09-16 06:55:28 UTC (rev 7565)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2011-09-16 18:08:20 UTC (rev 7566)
@@ -17,9 +17,6 @@
 cd "%packageDir%\temp"
 "%SevenZipDir%\7z" x "%packageDir%\%baseFile%.exe"
 rmdir /s/q $PLUGINSDIR
-mkdir scripts
-move $_OUTDIR\auto scripts
-move $_OUTDIR\video scripts
 mkdir etc\fonts\conf.d
 copy "%buildDir%\etc\fonts\conf.d" etc\fonts\conf.d\
 move $_OUTDIR\conf.avail etc\fonts



From mean at mail.berlios.de  Tue Sep 20 07:52:18 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 20 Sep 2011 07:52:18 +0200
Subject: [Avidemux-svn-commit] r7568 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2
Message-ID: <20110920055218.42BD7481359@sheep.berlios.de>

Author: mean
Date: 2011-09-20 07:52:17 +0200 (Tue, 20 Sep 2011)
New Revision: 7568

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp
Log:
[mp4v2] Put video track as 1st track

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp	2011-09-17 09:00:10 UTC (rev 7567)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2.cpp	2011-09-20 05:52:17 UTC (rev 7568)
@@ -196,14 +196,14 @@
             ADM_error("[mp4v2]Cannot set timescale to us\n");
             return false;
         }
-        if(false==initAudio())
+        if(false==initVideo())
         {
-            ADM_error("Cannot init audio\n");
+            ADM_error("Cannot init video\n");
             return false;
         }
-        if(false==initVideo())
+        if(false==initAudio())
         {
-            ADM_error("Cannot init video\n");
+            ADM_error("Cannot init audio\n");
             return false;
         }
 



From mean at mail.berlios.de  Thu Sep 22 08:08:17 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 22 Sep 2011 08:08:17 +0200
Subject: [Avidemux-svn-commit] r7569 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl:
	. glRotate
Message-ID: <20110922060818.1B48D481225@sheep.berlios.de>

Author: mean
Date: 2011-09-22 08:08:17 +0200 (Thu, 22 Sep 2011)
New Revision: 7569

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.ui
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
Log:
[glFilters] Skeleton for glRotate

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-20 05:52:17 UTC (rev 7568)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/CMakeLists.txt	2011-09-22 06:08:17 UTC (rev 7569)
@@ -7,3 +7,4 @@
 #ADD_SUBDIRECTORY(sample_vertex)
 #ADD_SUBDIRECTORY(glVdpau)
 ADD_SUBDIRECTORY(glResize)
+ADD_SUBDIRECTORY(glRotate)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/CMakeLists.txt	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,7 @@
+INCLUDE(vf_plugin)
+INCLUDE(vf_plugin_qt4gl)
+
+
+SET(ADM_vf_rotateGlFrag_SRCS rotateGl.cpp)
+INIT_VIDEO_FILTER_GLQT4(ADM_vf_rotateGlFrag2 "${ADM_vf_rotateGlFrag_SRCS}" "rotateGl.h" "rotateGl" "${ADM_vf_rotateGl_SRCS}")
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,3 @@
+gl_rotate{
+uint32_t:angle;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,7 @@
+// automatically generated by admSerialization.py do not edit
+#ifndef ADM_gl_rotate_CONF_H
+#define ADM_gl_rotate_CONF_H
+typedef struct {
+uint32_t angle;
+}gl_rotate;
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,189 @@
+/** *************************************************************************
+                    \file     rotateGl
+                    \brief    Rotate picture
+
+   
+                    copyright            : (C) 2011 by mean
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_openGL.h"
+#define ADM_LEGACY_PROGGY
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "T_openGL.h"
+#include "T_openGLFilter.h"
+#include "rotateGl.h"
+#include "ADM_clock.h"
+#include "rotate.h"
+#include "rotate_desc.cpp"
+/**
+    \class rotateGl
+*/
+class rotateGl : public  ADM_coreVideoFilterQtGl
+{
+protected:
+               gl_rotate     params;
+                ADMImage    *original;
+protected:
+                        bool render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo);
+public:
+                             rotateGl(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                            ~rotateGl();
+
+        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) {return true;}             /// Start graphical user interface
+};
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   rotateGl,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_QT4+ADM_UI_GL,         // UI
+                        VF_OPENGL,            // Category
+                        "glRotate",            // internal name (must be uniq!)
+                        "OpenGl Rotate",            // Display name
+                        "Rotate image." // Description
+                    );
+
+// Now implements the interesting parts
+/**
+    \fn rotateGl
+    \brief constructor
+*/
+rotateGl::rotateGl(  ADM_coreVideoFilter *in,CONFcouple *setup) : ADM_coreVideoFilterQtGl(in,setup)
+{
+UNUSED_ARG(setup);
+        original=new ADMImageDefault(in->getInfo()->width,in->getInfo()->height);
+        if(!setup || !ADM_paramLoad(setup,gl_rotate_param,&params))
+        {
+            // Default value
+            params.angle=0;
+        }
+        widget->makeCurrent();
+        fboY->bind();
+        printf("Compiling shader \n");
+        glProgramY = new QGLShaderProgram(context);
+        ADM_assert(glProgramY);
+        if ( !glProgramY->addShaderFromSourceCode(QGLShader::Fragment, myShaderY))
+        {
+                ADM_error("[GL Render] Fragment log: %s\n", glProgramY->log().toUtf8().constData());
+                ADM_assert(0);
+        }
+        if ( !glProgramY->link())
+        {
+            ADM_error("[GL Render] Link log: %s\n", glProgramY->log().toUtf8().constData());
+            ADM_assert(0);
+        }
+
+        if ( !glProgramY->bind())
+        {
+                ADM_error("[GL Render] Binding FAILED\n");
+                ADM_assert(0);
+        }
+
+        fboY->release();
+        widget->doneCurrent();
+
+}
+/**
+    \fn rotateGl
+    \brief destructor
+*/
+rotateGl::~rotateGl()
+{
+    if(original) delete original;
+    original=NULL;
+}
+
+/**
+    \fn getFrame
+    \brief Get a processed frame
+*/
+bool rotateGl::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+    // since we do nothing, just get the output of previous filter
+    if(false==previousFilter->getNextFrame(fn,original))
+    {
+        ADM_warning("FlipFilter : Cannot get frame\n");
+        return false;
+    }
+    widget->makeCurrent();
+    glPushMatrix();
+    // size is the last one...
+    fboY->bind();
+
+    glProgramY->setUniformValue("myTextureU", 1); 
+    glProgramY->setUniformValue("myTextureV", 2); 
+    glProgramY->setUniformValue("myTextureY", 0); 
+
+    uploadAllPlanes(original);
+
+    render(image,PLANAR_Y,fboY);
+
+    downloadTextures(image,fboY);
+
+    fboY->release();
+    firstRun=false;
+    glPopMatrix();
+    widget->doneCurrent();
+    
+    return true;
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         rotateGl::getCoupledConf(CONFcouple **couples)
+{
+    return ADM_paramSave(couples, gl_rotate_param,&params);
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *rotateGl::getConfiguration(void)
+{
+    static char st[200];
+    snprintf(st,199,"openGl rotate :%d degrees",params.angle);
+    return st;
+}
+
+
+/**
+    \fn render
+*/
+bool rotateGl::render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo)
+{
+    int width=image->GetWidth(plane);
+    int height=image->GetHeight(plane);
+
+    glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);
+	glViewport(0, 0, width, height);
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0, width, 0, height, -1, 1);
+
+    //
+    glBegin(GL_QUADS);
+	glTexCoord2i(0, 0);
+	glVertex2i(0, 0);
+	glTexCoord2i(width, 0);
+	glVertex2i(width, 0);
+	glTexCoord2i(width, height);
+	glVertex2i(width ,height);
+	glTexCoord2i(0, height);
+	glVertex2i(0, height);
+	glEnd();	// draw cube background
+    return true;
+}
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.h	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,17 @@
+// Invert x & y
+static const char *myShaderY =
+	"#extension GL_ARB_texture_rectangle: enable\n"
+	"uniform sampler2DRect myTextureY;\n" // tex unit 0
+    "uniform sampler2DRect myTextureU;\n" // tex unit 1
+    "uniform sampler2DRect myTextureV;\n" // tex unit 2
+    "const vec2 half_vec=vec2(0.5,0.5);\n"
+
+	"void main(void) {\n"
+    "  vec2 full_coord=gl_TexCoord[0].xy;\n"
+    "  vec2 half_coord=full_coord*half_vec;\n"
+    "  vec4 texvalV = texture2DRect(myTextureV, half_coord);\n"
+    "  vec4 texvalU = texture2DRect(myTextureU, half_coord);\n"
+	"  vec4 texvalY = texture2DRect(myTextureY, full_coord);\n"
+	"  gl_FragColor = vec4(texvalY.r, texvalU.r, texvalV.r, 1.0);\n"
+	"}\n";
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.ui	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,724 @@
+<ui version="4.0" >
+ <class>resizeDialog</class>
+ <widget class="QDialog" name="resizeDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>350</width>
+    <height>342</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Resize</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <widget class="QGroupBox" name="groupBox_2" >
+     <property name="title" >
+      <string>Aspect Ratio</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <widget class="QCheckBox" name="lockArCheckBox" >
+        <property name="text" >
+         <string>Lock Aspect Ratio</string>
+        </property>
+        <property name="checked" >
+         <bool>true</bool>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label_4" >
+          <property name="text" >
+           <string>Source:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxSource" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_3" >
+          <property name="text" >
+           <string>Destination:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QComboBox" name="comboBoxDestination" >
+          <item>
+           <property name="text" >
+            <string>1:1</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>4:3</string>
+           </property>
+          </item>
+          <item>
+           <property name="text" >
+            <string>16:9</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox" >
+     <property name="title" >
+      <string>Resize Dimensions</string>
+     </property>
+     <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>9</number>
+      </property>
+      <property name="spacing" >
+       <number>6</number>
+      </property>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <widget class="QLabel" name="label" >
+          <property name="text" >
+           <string>Width:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxWidth" >
+          <property name="maximum" >
+           <number>2900</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>30</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_2" >
+          <property name="text" >
+           <string>Height:</string>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSpinBox" name="spinBoxHeight" >
+          <property name="maximum" >
+           <number>2000</number>
+          </property>
+          <property name="minimum" >
+           <number>16</number>
+          </property>
+          <property name="singleStep" >
+           <number>2</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <widget class="QCheckBox" name="checkBoxRoundup" >
+        <property name="text" >
+         <string>Round to the Nearest Multiple of 16</string>
+        </property>
+       </widget>
+      </item>
+      <item>
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Vertical</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>312</width>
+          <height>4</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>12</number>
+          </property>
+          <item>
+           <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QLabel" name="label_8" >
+                <property name="text" >
+                 <string>1%</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_5" >
+                <property name="text" >
+                 <string>Percent</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+              <item>
+               <widget class="QLabel" name="label_9" >
+                <property name="text" >
+                 <string>200%</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <widget class="QSlider" name="horizontalSlider" >
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="maximum" >
+               <number>200</number>
+              </property>
+              <property name="value" >
+               <number>100</number>
+              </property>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QSpinBox" name="percentageSpinBox" >
+            <property name="maximum" >
+             <number>200</number>
+            </property>
+            <property name="minimum" >
+             <number>1</number>
+            </property>
+            <property name="value" >
+             <number>100</number>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <widget class="QLabel" name="label_10" >
+            <property name="text" >
+             <string>Error X / Y:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="labelErrorXY" >
+            <property name="text" >
+             <string>0.00 / 0.00</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>40</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Fixed</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>332</width>
+       <height>6</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label_6" >
+       <property name="text" >
+        <string>Resize Method:</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QComboBox" name="comboBoxAlgo" >
+       <item>
+        <property name="text" >
+         <string>Bilinear</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Bicubic</string>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Lanzcos3</string>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::MinimumExpanding</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>16</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>lockArCheckBox</tabstop>
+  <tabstop>comboBoxSource</tabstop>
+  <tabstop>comboBoxDestination</tabstop>
+  <tabstop>spinBoxWidth</tabstop>
+  <tabstop>spinBoxHeight</tabstop>
+  <tabstop>checkBoxRoundup</tabstop>
+  <tabstop>horizontalSlider</tabstop>
+  <tabstop>percentageSpinBox</tabstop>
+  <tabstop>comboBoxAlgo</tabstop>
+  <tabstop>buttonBox</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>resizeDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_8</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>39</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_5</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>150</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_9</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>267</x>
+     <y>148</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>horizontalSlider</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>156</x>
+     <y>164</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>percentageSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>317</x>
+     <y>155</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>checkBoxRoundup</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>184</x>
+     <y>95</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>184</x>
+     <y>117</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_10</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>55</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>labelErrorXY</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>155</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>114</x>
+     <y>251</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_4</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>46</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxSource</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>94</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>label_3</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>188</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>lockArCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>comboBoxDestination</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>182</x>
+     <y>69</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>247</x>
+     <y>95</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,5 @@
+// automatically generated by admSerialization.py, do not edit!
+extern const ADM_paramList gl_rotate_param[]={
+ {"angle",offsetof(gl_rotate,angle),"uint32_t",ADM_param_uint32_t},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp	2011-09-22 06:08:17 UTC (rev 7569)
@@ -0,0 +1,18 @@
+// automatically generated by admSerialization.py, do not edit!
+#include "ADM_default.h"
+#include "ADM_paramList.h"
+#include "ADM_coreJson.h"
+#include "rotate.h"
+bool  gl_rotate_jserialize(const char *file, const gl_rotate *key){
+admJson json;
+json.addUint32("angle",key->angle);
+return json.dumpToFile(file);
+};
+bool  gl_rotate_jdeserialize(const char *file, const ADM_paramList *tmpl,gl_rotate *key){
+admJsonToCouple json;
+CONFcouple *c=json.readFromFile(file);
+if(!c) {ADM_error("Cannot read json file");return false;}
+bool r= ADM_paramLoadPartial(c,tmpl,key);
+delete c;
+return r;
+};



From mean at mail.berlios.de  Thu Sep 22 08:08:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 22 Sep 2011 08:08:19 +0200
Subject: [Avidemux-svn-commit] r7570 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate
Message-ID: <20110922060819.11B03481225@sheep.berlios.de>

Author: mean
Date: 2011-09-22 08:08:18 +0200 (Thu, 22 Sep 2011)
New Revision: 7570

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp
Log:
[glRotate] Add configuration dialog

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf	2011-09-22 06:08:17 UTC (rev 7569)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.conf	2011-09-22 06:08:18 UTC (rev 7570)
@@ -1,3 +1,3 @@
 gl_rotate{
-uint32_t:angle;
+int32_t:angle;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h	2011-09-22 06:08:17 UTC (rev 7569)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate.h	2011-09-22 06:08:18 UTC (rev 7570)
@@ -2,6 +2,6 @@
 #ifndef ADM_gl_rotate_CONF_H
 #define ADM_gl_rotate_CONF_H
 typedef struct {
-uint32_t angle;
+int32_t angle;
 }gl_rotate;
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:17 UTC (rev 7569)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:18 UTC (rev 7570)
@@ -25,6 +25,7 @@
 #include "ADM_clock.h"
 #include "rotate.h"
 #include "rotate_desc.cpp"
+#include "DIA_factory.h"
 /**
     \class rotateGl
 */
@@ -42,7 +43,7 @@
         virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
         virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
         virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
-        virtual bool         configure(void) {return true;}             /// Start graphical user interface
+        virtual bool         configure(void) ;             /// Start graphical user interface
 };
 
 // Add the hook to make it valid plugin
@@ -158,6 +159,26 @@
     return st;
 }
 
+/**
+    \fn configure
+*/
+bool rotateGl::configure( void) 
+{
+    
+     
+     diaElemInteger  tAngle(&(params.angle),QT_TR_NOOP("Angle :"),-190,190);
+   
+     
+     diaElem *elems[]={&tAngle};
+     
+     if(diaFactoryRun(QT_TR_NOOP("glRotate"),sizeof(elems)/sizeof(diaElem *),elems))
+     {
+                ADM_info("New angle : %d \n",params.angle);
+                return 1;
+     }
+    
+     return 0;
+}
 
 /**
     \fn render

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp	2011-09-22 06:08:17 UTC (rev 7569)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_desc.cpp	2011-09-22 06:08:18 UTC (rev 7570)
@@ -1,5 +1,5 @@
 // automatically generated by admSerialization.py, do not edit!
 extern const ADM_paramList gl_rotate_param[]={
- {"angle",offsetof(gl_rotate,angle),"uint32_t",ADM_param_uint32_t},
+ {"angle",offsetof(gl_rotate,angle),"int32_t",ADM_param_int32_t},
 {NULL,0,NULL}
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp	2011-09-22 06:08:17 UTC (rev 7569)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotate_json.cpp	2011-09-22 06:08:18 UTC (rev 7570)
@@ -5,7 +5,7 @@
 #include "rotate.h"
 bool  gl_rotate_jserialize(const char *file, const gl_rotate *key){
 admJson json;
-json.addUint32("angle",key->angle);
+json.addInt32("angle",key->angle);
 return json.dumpToFile(file);
 };
 bool  gl_rotate_jdeserialize(const char *file, const ADM_paramList *tmpl,gl_rotate *key){



From mean at mail.berlios.de  Thu Sep 22 08:08:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 22 Sep 2011 08:08:20 +0200
Subject: [Avidemux-svn-commit] r7571 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate
Message-ID: <20110922060820.2A2D6481225@sheep.berlios.de>

Author: mean
Date: 2011-09-22 08:08:19 +0200 (Thu, 22 Sep 2011)
New Revision: 7571

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
Log:
[glRotate] Gen rotated quad as a glList (incomplete)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:18 UTC (rev 7570)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:19 UTC (rev 7571)
@@ -32,8 +32,10 @@
 class rotateGl : public  ADM_coreVideoFilterQtGl
 {
 protected:
-               gl_rotate     params;
+                gl_rotate    params;
                 ADMImage    *original;
+                GLuint       glList;
+                bool         genQuad(void);
 protected:
                         bool render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo);
 public:
@@ -91,7 +93,8 @@
                 ADM_error("[GL Render] Binding FAILED\n");
                 ADM_assert(0);
         }
-
+        glList=glGenLists(1);
+        genQuad();
         fboY->release();
         widget->doneCurrent();
 
@@ -104,6 +107,7 @@
 {
     if(original) delete original;
     original=NULL;
+    glDeleteLists(glList,1);
 }
 
 /**
@@ -174,13 +178,63 @@
      if(diaFactoryRun(QT_TR_NOOP("glRotate"),sizeof(elems)/sizeof(diaElem *),elems))
      {
                 ADM_info("New angle : %d \n",params.angle);
+                widget->makeCurrent();
+                genQuad();
+                widget->doneCurrent();
                 return 1;
      }
     
      return 0;
 }
-
 /**
+    \fn     translate
+    \brief  compute the quad after rotation
+*/
+static bool translate(int &x,int &y,float c,float s,int w2,int h2)
+{
+    float xx=x;
+    float yy=y;
+    xx-=w2;
+    yy-=h2;
+    
+    xx=xx*c-yy*s;
+    yy=xx*s+yy*c;
+
+    x=xx+w2;
+    y=yy+h2;
+    return true;
+}
+/**
+    \fn     genQuad
+    \brief  compute the quad
+*/
+
+bool rotateGl::genQuad(void)
+{
+  int width=info.width;
+  int height=info.height;
+  int w2=width/2;
+  int h2=height/2;
+  float c=cos(params.angle);
+  float s=sin(params.angle);
+
+
+#define POINT(a,b) x=a;y=b;translate(x,y,c,s,w2,h2); glTexCoord2i(a, b);glVertex2i(x, y);
+  
+  glDeleteLists(glList,1);
+  glNewList(glList,GL_COMPILE);
+  glBegin(GL_QUADS);
+        int x=0,y=0;
+
+        POINT(0,0);
+        POINT(width,0);
+        POINT(width,height);
+        POINT(0,height);
+
+  glEnd();
+  glEndList();
+}
+/**
     \fn render
 */
 bool rotateGl::render(ADMImage *image,ADM_PLANE plane,QGLFramebufferObject *fbo)
@@ -193,18 +247,8 @@
     glMatrixMode(GL_PROJECTION);
     glLoadIdentity();
     glOrtho(0, width, 0, height, -1, 1);
-
-    //
-    glBegin(GL_QUADS);
-	glTexCoord2i(0, 0);
-	glVertex2i(0, 0);
-	glTexCoord2i(width, 0);
-	glVertex2i(width, 0);
-	glTexCoord2i(width, height);
-	glVertex2i(width ,height);
-	glTexCoord2i(0, height);
-	glVertex2i(0, height);
-	glEnd();	// draw cube background
+    glCallList(glList);
+    
     return true;
 }
 //EOF



From mean at mail.berlios.de  Thu Sep 22 08:08:21 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 22 Sep 2011 08:08:21 +0200
Subject: [Avidemux-svn-commit] r7572 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate
Message-ID: <20110922060821.33D72481225@sheep.berlios.de>

Author: mean
Date: 2011-09-22 08:08:21 +0200 (Thu, 22 Sep 2011)
New Revision: 7572

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
Log:
[glRotate] Finished

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:19 UTC (rev 7571)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6_openGl/glRotate/rotateGl.cpp	2011-09-22 06:08:21 UTC (rev 7572)
@@ -55,7 +55,7 @@
                         VF_OPENGL,            // Category
                         "glRotate",            // internal name (must be uniq!)
                         "OpenGl Rotate",            // Display name
-                        "Rotate image." // Description
+                        "Rotate image by a small amount." // Description
                     );
 
 // Now implements the interesting parts
@@ -119,7 +119,7 @@
     // since we do nothing, just get the output of previous filter
     if(false==previousFilter->getNextFrame(fn,original))
     {
-        ADM_warning("FlipFilter : Cannot get frame\n");
+        ADM_warning("glRotate : Cannot get frame\n");
         return false;
     }
     widget->makeCurrent();
@@ -141,7 +141,7 @@
     firstRun=false;
     glPopMatrix();
     widget->doneCurrent();
-    
+    image->copyInfo(original);
     return true;
 }
 /**
@@ -170,7 +170,7 @@
 {
     
      
-     diaElemInteger  tAngle(&(params.angle),QT_TR_NOOP("Angle :"),-190,190);
+     diaElemInteger  tAngle(&(params.angle),QT_TR_NOOP("Angle (?):"),-190,190);
    
      
      diaElem *elems[]={&tAngle};
@@ -190,18 +190,19 @@
     \fn     translate
     \brief  compute the quad after rotation
 */
+
 static bool translate(int &x,int &y,float c,float s,int w2,int h2)
 {
-    float xx=x;
-    float yy=y;
+    float xx=x,xx2;
+    float yy=y,yy2;
     xx-=w2;
     yy-=h2;
     
-    xx=xx*c-yy*s;
-    yy=xx*s+yy*c;
+    xx2=xx*c-yy*s;
+    yy2=xx*s+yy*c;
 
-    x=xx+w2;
-    y=yy+h2;
+    x=xx2+w2;
+    y=yy2+h2;
     return true;
 }
 /**
@@ -215,10 +216,15 @@
   int height=info.height;
   int w2=width/2;
   int h2=height/2;
-  float c=cos(params.angle);
-  float s=sin(params.angle);
 
+#define PI 3.14159265
+  float angleRad=(float)params.angle;
+    angleRad=angleRad*PI/180.;
 
+  float c=cos(angleRad);
+  float s=sin(angleRad);
+
+
 #define POINT(a,b) x=a;y=b;translate(x,y,c,s,w2,h2); glTexCoord2i(a, b);glVertex2i(x, y);
   
   glDeleteLists(glList,1);



From gruntster at mail.berlios.de  Thu Sep 22 21:48:26 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 22 Sep 2011 21:48:26 +0200
Subject: [Avidemux-svn-commit] r7573 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_libraries cmake cmake/patches
Message-ID: <20110922194827.299614813E7@sheep.berlios.de>

Author: gruntster
Date: 2011-09-22 21:48:26 +0200 (Thu, 22 Sep 2011)
New Revision: 7573

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.4.tar.bz2
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.3.tar.bz2
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
Log:
[ffmpeg] upgrade ffmpeg to 0.8.4

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.3.tar.bz2
===================================================================
(Binary files differ)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.4.tar.bz2 (from rev 7572, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.3.tar.bz2)
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-09-22 06:08:21 UTC (rev 7572)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-09-22 19:48:26 UTC (rev 7573)
@@ -1,6 +1,6 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 0.8.3)
+set(FFMPEG_VERSION 0.8.4)
 set(FFMPEG_SOURCE_ARCHIVE "ffmpeg-${FFMPEG_VERSION}.tar.bz2")
 set(FFMPEG_SOURCE_ARCHIVE_DIR "ffmpeg-${FFMPEG_VERSION}")
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-09-22 06:08:21 UTC (rev 7572)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-09-22 19:48:26 UTC (rev 7573)
@@ -2,7 +2,7 @@
 
 export curDir=$PWD
 export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
-export origFfmpegPath=../ffmpeg-0.8.1
+export origFfmpegPath=../ffmpeg-0.8.4
 
 function updatePatch {
 	#cd $ffmpegPath

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-09-22 06:08:21 UTC (rev 7572)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-09-22 19:48:26 UTC (rev 7573)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.1/libavcodec/h264.c	2011-08-05 21:20:16 +0100
-+++ libavcodec/h264.c	2011-08-05 21:20:16 +0100
-@@ -4179,6 +4179,20 @@
+--- ../ffmpeg-0.8.4/libavcodec/h264.c	2011-09-22 20:39:58 +0100
++++ libavcodec/h264.c	2011-09-22 20:39:58 +0100
+@@ -4217,6 +4217,20 @@
      { FF_PROFILE_UNKNOWN },
  };
  

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-09-22 06:08:21 UTC (rev 7572)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-09-22 19:48:26 UTC (rev 7573)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/mpegvideo.c	2011-06-23 20:23:54 +0100
-+++ libavcodec/mpegvideo.c	2011-06-23 20:23:54 +0100
-@@ -736,7 +736,11 @@
+--- ../ffmpeg-0.8.4/libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
++++ libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
+@@ -737,7 +737,11 @@
      FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
  
      s->parse_context.state= -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-09-22 06:08:21 UTC (rev 7572)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-09-22 19:48:26 UTC (rev 7573)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavformat/isom.c	2011-06-23 20:23:55 +0100
-+++ libavformat/isom.c	2011-06-23 20:23:55 +0100
-@@ -237,7 +237,10 @@
+--- ../ffmpeg-0.8.4/libavformat/isom.c	2011-09-22 20:39:59 +0100
++++ libavformat/isom.c	2011-09-22 20:39:59 +0100
+@@ -239,7 +239,10 @@
      { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
      { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
  



From mean at mail.berlios.de  Sat Sep 24 09:11:14 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:14 +0200
Subject: [Avidemux-svn-commit] r7574 - in branches/avidemux_2.6_branch_mean:
	avidemux/cli avidemux/gtk avidemux/qt4 avidemux_core
	avidemux_plugins cmake
Message-ID: <20110924071115.3EF7C4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:14 +0200 (Sat, 24 Sep 2011)
New Revision: 7574

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageDebian.cmake
   branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
   branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageDebian.cmake
   branches/avidemux_2.6_branch_mean/avidemux_core/corePackageDebian.cmake
   branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageDebian.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[all] libxml2 is no longer needed

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageDebian.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageDebian.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -13,7 +13,7 @@
 
 # Build our deps list
 # Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
 # Add optional DEPS here
 SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -1,4 +1,4 @@
-##############################
+#############################
 # DEBIAN
 ##############################
 include(debianArch)
@@ -13,7 +13,7 @@
 
 # Build our deps list
 # Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
 # Add optional DEPS here
 SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageDebian.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageDebian.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -13,7 +13,7 @@
 
 # Build our deps list
 # Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
 # Add optional DEPS here
 SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/corePackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/corePackageDebian.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/corePackageDebian.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -13,7 +13,7 @@
 
 # Build our deps list
 # Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), pkg-config, libpng12-0, libxml2")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxv1, zlib1g (>=1:1.1.4), pkg-config, libpng12-0 ")
 # Add optional DEPS here
 SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageDebian.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageDebian.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -13,7 +13,7 @@
 
 # Build our deps list
 # Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
 # Add optional DEPS here
 SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
 #

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -18,19 +18,7 @@
 
 MESSAGE("")
 
-########################################
-# Libxml2
-########################################
-INCLUDE(admCheckLibxml2)
 
-checkLibxml2()
-
-IF (LIBXML2_FOUND)
-	SET(USE_LIBXML2 1)
-ELSEIF (LIBXML2_FOUND)
-	MESSAGE(${ARGV4} "Could not find Libxml2")
-ENDIF (LIBXML2_FOUND)
-
 ########################################
 # pthreads
 ########################################

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2011-09-22 19:48:26 UTC (rev 7573)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2011-09-24 07:11:14 UTC (rev 7574)
@@ -31,9 +31,6 @@
 /* FreeType2 detected */
 #cmakedefine USE_FREETYPE
 
-/* Libxml2 is available */
-#cmakedefine USE_LIBXML2
-
 /* libvpx is available */
 #cmakedefine USE_VPX
 



From mean at mail.berlios.de  Sat Sep 24 09:11:16 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:16 +0200
Subject: [Avidemux-svn-commit] r7575 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110924071116.5A6D54813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:16 +0200 (Sat, 24 Sep 2011)
New Revision: 7575

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
Log:
[All] Tweak project to make life easier with eclipse

Modified: branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2011-09-24 07:11:14 UTC (rev 7574)
+++ branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2011-09-24 07:11:16 UTC (rev 7575)
@@ -1,3 +1,12 @@
+# eclipse
+SET(CMAKE_VERBOSE_MAKEFILE ON)
+IF(CMAKE_COMPILER_IS_GNUCC)
+  SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fmessage-length=0")
+ENDIF(CMAKE_COMPILER_IS_GNUCC)
+IF(CMAKE_COMPILER_IS_GNUCXX)
+  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fmessage-length=0")
+ENDIF(CMAKE_COMPILER_IS_GNUCXX)
+#/
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_core/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreAudioFilter/include)



From mean at mail.berlios.de  Sat Sep 24 09:11:17 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:17 +0200
Subject: [Avidemux-svn-commit] r7576 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20110924071117.D1F364813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:17 +0200 (Sat, 24 Sep 2011)
New Revision: 7576

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
Log:
[render] make dtor virtual + nitpick break missing in default:

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2011-09-24 07:11:17 UTC (rev 7576)
@@ -29,7 +29,7 @@
                         bool baseInit(uint32_t w,uint32_t h,renderZoom zoom);
        public:
                                 VideoRenderBase( void) {scaler=NULL;currentZoom=ZOOM_1_1;};
-                                ~VideoRenderBase() {if(scaler) delete scaler;scaler=NULL;}
+              virtual          ~VideoRenderBase() {if(scaler) delete scaler;scaler=NULL;}
               virtual	bool    init(GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)=0;
               virtual	bool    stop(void)=0;
               virtual   bool    displayImage(ADMImage *pic)=0;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-09-24 07:11:17 UTC (rev 7576)
@@ -60,7 +60,7 @@
                             QtGlAccelWidget *glWidget;
       public:
                              QtGlRender( void ) ;
-                             ~QtGlRender();
+              virtual        ~QtGlRender();
               virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2011-09-24 07:11:17 UTC (rev 7576)
@@ -194,7 +194,7 @@
                     case ZOOM_1_1: mul=4;break;
                     case ZOOM_2:   mul=8;break;
                     case ZOOM_4:   mul=16;break;
-                    default : ADM_assert(0);
+                    default : ADM_assert(0);break;
     
             }
         MUI_updateDrawWindowSize(draw,(w*mul)/4,(h*mul)/4);
@@ -408,7 +408,7 @@
                     case ZOOM_1_1: mul=4;break;
                     case ZOOM_2:   mul=8;break;
                     case ZOOM_4:   mul=16;break;
-                    default : ADM_assert(0);
+                    default : ADM_assert(0);break;
     
             }
         displayWidth=(imageWidth*mul)/4;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2011-09-24 07:11:17 UTC (rev 7576)
@@ -30,7 +30,7 @@
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newZoom);
-              virtual   bool    usingUIRedraw(void) {return true;};
+              virtual   bool usingUIRedraw(void) {return true;};
 };
 
 void initSdl(int videoDevice);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2011-09-24 07:11:17 UTC (rev 7576)
@@ -54,6 +54,13 @@
 
 }
 /**
+ * \fn XvRender dtor
+ */
+XvRender::~XvRender()
+{
+
+}
+/**
     \fn init
 */
 bool XvRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2011-09-24 07:11:16 UTC (rev 7575)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2011-09-24 07:11:17 UTC (rev 7576)
@@ -26,7 +26,7 @@
                             GUI_WindowInfo info;
       public:
                              XvRender( void ) ;
-                             ~XvRender();
+              virtual        ~XvRender();
               virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);



From mean at mail.berlios.de  Sat Sep 24 09:11:19 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:19 +0200
Subject: [Avidemux-svn-commit] r7577 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src
Message-ID: <20110924071119.B314F4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:19 +0200 (Sat, 24 Sep 2011)
New Revision: 7577

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp
Log:
[audioFilter] make dtor virtual + nitpick break missing in default:

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-24 07:11:17 UTC (rev 7576)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audio_encoderPlugin.cpp	2011-09-24 07:11:19 UTC (rev 7577)
@@ -23,8 +23,8 @@
 static AUDIOENCODER  currentEncoder=0; //0 is always dummy
 
 static AUDIOENCODER ADM_encoderByName(const char *name);
-static const char *ADM_audioEncoderById(AUDIOENCODER id);
 
+
 /**
     \class ADM_AudioEncoderLoader
     \brief Helper class to load plugins

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter.cpp	2011-09-24 07:11:17 UTC (rev 7576)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter.cpp	2011-09-24 07:11:19 UTC (rev 7577)
@@ -66,7 +66,7 @@
                     playback.mixerConf=CHANNEL_DOLBY_PROLOGIC2;
                     break;
             default:
-                    ADM_assert(0);
+                    ADM_assert(0);break;
       }
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp	2011-09-24 07:11:17 UTC (rev 7576)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp	2011-09-24 07:11:19 UTC (rev 7577)
@@ -49,7 +49,7 @@
                                 this->access=access;
                                 son=s;
                         }
-                        ~ADM_audioStream_autoDelete()
+                        virtual ~ADM_audioStream_autoDelete()
                         {
                                 ADM_info("Killing son audioStream\n");
                                 delete son;



From mean at mail.berlios.de  Sat Sep 24 09:11:21 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:21 +0200
Subject: [Avidemux-svn-commit] r7578 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20110924071121.180624813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:20 +0200 (Sat, 24 Sep 2011)
New Revision: 7578

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edCache.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edIdentify.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
Log:
[editor] make dtor virtual + nitpick break missing in default:

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edCache.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edCache.cpp	2011-09-24 07:11:19 UTC (rev 7577)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edCache.cpp	2011-09-24 07:11:20 UTC (rev 7578)
@@ -166,17 +166,18 @@
 void EditorCache::dump( void)
 {
     printf("ReadIndex:%"LU", WriteIndex:%"LU"\n",readIndex,writeIndex);
-	for(int i=0;i<_nbImage;i++)
-	{
-        cacheElem *e=&(_elem[i]);
-        switch(e->pts)
+    for(int i=0;i<_nbImage;i++)
+    {
+      cacheElem *e=&(_elem[i]);
+      switch(e->pts)
         {
             case ADM_NO_PTS:  printf("Not used %d\n",i);break;
             default:
                 printf("Edcache content[%d]: PTS : %"LLU" us%"LLU" ms\n",i,
                                                                     e->image->Pts,e->image->Pts/1000);
+                break;
         }
-	}
+    }
 }
 /**
     \fn findJustAfter

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edIdentify.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edIdentify.cpp	2011-09-24 07:11:19 UTC (rev 7577)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edIdentify.cpp	2011-09-24 07:11:20 UTC (rev 7578)
@@ -25,8 +25,6 @@
 #include "ADM_coreDemuxerMpeg/include/dmx_identify.h"
 
 
-DMX_TYPE dmxIdentify(const char *name);
-
 /**
 	Read the magic of a file i.e. its 16 first bytes
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2011-09-24 07:11:19 UTC (rev 7577)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2011-09-24 07:11:20 UTC (rev 7578)
@@ -235,7 +235,7 @@
                 case FILMCONV_NONE:      ;break;
                 case FILMCONV_PAL2FILM:  qfprintf(fd,"adm.audioPal2film=1;\n");break;
                 case FILMCONV_FILM2PAL:  qfprintf(fd,"adm.audioFilm2pal=1;\n");break;
-                default:ADM_assert(0);
+                default:ADM_assert(0);break;
         }
    
        

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2011-09-24 07:11:19 UTC (rev 7577)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2011-09-24 07:11:20 UTC (rev 7578)
@@ -212,7 +212,7 @@
                 case FILMCONV_NONE:      ;break;
                 case FILMCONV_PAL2FILM:  qfprintf(fd,"adm.audioPal2film=1\n");break;
                 case FILMCONV_FILM2PAL:  qfprintf(fd,"adm.audioFilm2pal=1\n");break;
-                default:ADM_assert(0);
+                default:ADM_assert(0);break;
         }
    // --------- Normalize ----------------
         ADM_GAINMode mode;



From mean at mail.berlios.de  Sat Sep 24 09:11:22 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:22 +0200
Subject: [Avidemux-svn-commit] r7579 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4: ADM_UIs/src
	ADM_userInterfaces/ADM_gui
Message-ID: <20110924071122.A6CEC4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:22 +0200 (Sat, 24 Sep 2011)
New Revision: 7579

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[qt4] add missing break + remove unused forward declarations

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp	2011-09-24 07:11:20 UTC (rev 7578)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp	2011-09-24 07:11:22 UTC (rev 7579)
@@ -132,6 +132,7 @@
     case COMPRESS_AQ: Mx(COMPRESS_AQ);Vx(qz);break;
     default :
           ADM_assert(0);
+          break;
   }
 }
 void ADM_Qbitrate::comboChanged(int i)
@@ -172,7 +173,7 @@
           M(_minQ,maxQ);
           S(compress->qz);
           break;
-    default:ADM_assert(0);
+    default:ADM_assert(0);break;
   }
 }
 ADM_Qbitrate::~ADM_Qbitrate()

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp	2011-09-24 07:11:20 UTC (rev 7578)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp	2011-09-24 07:11:22 UTC (rev 7579)
@@ -101,7 +101,7 @@
 			r=FileSel_SelectDir(selectDesc,buffer,MAX_SEL,txt);
 			break;
 		default:
-			ADM_assert(0);
+			ADM_assert(0);break;
 	}
 	if(r)
 	{

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp	2011-09-24 07:11:20 UTC (rev 7578)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp	2011-09-24 07:11:22 UTC (rev 7579)
@@ -88,7 +88,7 @@
 		case TT_TOGGLE_INT:
 			((diaElemToggleInt *)_toggle)->updateMe();break;
 		default:
-			ADM_assert(0);
+			ADM_assert(0);break;
 	}
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-24 07:11:20 UTC (rev 7578)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-24 07:11:22 UTC (rev 7579)
@@ -816,6 +816,7 @@
 			break;
 		default:
 			WIDGET(actionPreviewInput)->setChecked(true);
+			break;
 	}
 }
 /**



From mean at mail.berlios.de  Sat Sep 24 09:11:24 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:24 +0200
Subject: [Avidemux-svn-commit] r7580 - in
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2:
	js src
Message-ID: <20110924071124.216AA4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:23 +0200 (Sat, 24 Sep 2011)
New Revision: 7580

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp
Log:
[script2] Remove unused fwd declaration

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp	2011-09-24 07:11:22 UTC (rev 7579)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsIf.cpp	2011-09-24 07:11:23 UTC (rev 7580)
@@ -143,7 +143,7 @@
             const char *t=jsHooks[i].text;
             if(t)
                 jsLog("%s",t);
-            return dump(jsHooks[i].jsFunctions);
+            dump(jsHooks[i].jsFunctions);
         }
     }
 //    if(!strcasecmp(s,"load")) return dump(jsGetAvidemuxFunctions());

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp	2011-09-24 07:11:22 UTC (rev 7579)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/js/ADM_jsVideo.cpp	2011-09-24 07:11:23 UTC (rev 7580)
@@ -28,8 +28,8 @@
 #include "ADM_videoFilters.h"
 #include "GUI_ui.h"
 extern ADM_Composer *video_body;
-bool A_setVideoCodec(const char *nm);
 
+
 /**
     \fn Codec
     

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp	2011-09-24 07:11:22 UTC (rev 7579)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptIf.cpp	2011-09-24 07:11:23 UTC (rev 7580)
@@ -18,8 +18,8 @@
 #include <vector>
 #include "ADM_editor/ADM_edit.hxx"
 #include "DIA_coreToolkit.h"
-void    A_Resync(void);
 
+
 /* our variables */
 static scriptLoggerFunc *scriptLogger=NULL;
 static void             *scriptLoggerCookie=NULL;



From mean at mail.berlios.de  Sat Sep 24 09:11:25 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:25 +0200
Subject: [Avidemux-svn-commit] r7581 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit
Message-ID: <20110924071125.58AC44813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:25 +0200 (Sat, 24 Sep 2011)
New Revision: 7581

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp
Log:
[automation] Remove unused fwd declaration

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp	2011-09-24 07:11:23 UTC (rev 7580)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_toolkit/automation.cpp	2011-09-24 07:11:25 UTC (rev 7581)
@@ -46,20 +46,13 @@
 
 extern bool ADM_slaveConnect(uint32_t port);
 
-extern int A_loadNone( void );
+
 extern void GUI_Quiet( void);
 extern void GUI_Verbose( void);
 extern void audioFilter_SetBitrate( int i);
-extern void videoCodecSelectByName(const char *name);
-extern int videoCodecConfigure(char *p,uint32_t i, uint8_t  *c);
-extern void updateLoaded( void );
-extern void setPostProc(int v,int s);
-extern void HandleAction(Action action) ;
 extern void show_info(char *p);
 extern const char *getStrFromAudioCodec( uint32_t codec);
 extern void frame2time(uint32_t frame, uint32_t fps, uint16_t * hh, uint16_t * mm, uint16_t * ss, uint16_t * ms);
-extern uint8_t ADM_aviSetSplitSize(uint32_t size);
-extern void updateLoaded(void );
 extern uint8_t A_rebuildKeyFrame (void);
 extern uint8_t scriptAddVar(char *var,char *value);
 
@@ -99,7 +92,6 @@
 static void setVar(char *in);
 //
 uint8_t trueFalse(char *p);
-extern uint8_t runProbe(const char *file);
 //_________________________________________________________________________
 
 
@@ -177,7 +169,6 @@
 	MPEG2ENC_SVCD,   // pseudo codec with profile
 	MPEG2ENC_DVD     // pseudo codec with profile
 } codec_t;
-static codec_t codec = SOME_UNKNOWN;
 
 //void automation(int argc, char **argv)
 int automation(void )
@@ -271,9 +262,6 @@
 void call_quit        (char *p) { UNUSED_ARG(p); exit(0);                            }
 
 
-
-extern void audioSetResample(uint32_t fq);
-
 void call_normalize   (char *p)
 {
   int32_t i;



From mean at mail.berlios.de  Sat Sep 24 09:11:26 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:26 +0200
Subject: [Avidemux-svn-commit] r7582 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec
Message-ID: <20110924071126.8FC8A4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:26 +0200 (Sat, 24 Sep 2011)
New Revision: 7582

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp
Log:
[audiocodec] lint nitpick

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp	2011-09-24 07:11:25 UTC (rev 7581)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp	2011-09-24 07:11:26 UTC (rev 7582)
@@ -63,6 +63,7 @@
                   		break;
             default:
             	out= ADM_ad_searchCodec(fourcc,info,extra,extraData);
+            	break;
         	}
 
 	if (out == NULL)



From mean at mail.berlios.de  Sat Sep 24 09:11:27 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:27 +0200
Subject: [Avidemux-svn-commit] r7583 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_muxerGate/src
Message-ID: <20110924071127.D55024813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:27 +0200 (Sat, 24 Sep 2011)
New Revision: 7583

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_muxerGate/src/ADM_videoCopyFromAnnexB.cpp
Log:
[muxerGate] Remove unused fwd declaration

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_muxerGate/src/ADM_videoCopyFromAnnexB.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_muxerGate/src/ADM_videoCopyFromAnnexB.cpp	2011-09-24 07:11:26 UTC (rev 7582)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_muxerGate/src/ADM_videoCopyFromAnnexB.cpp	2011-09-24 07:11:27 UTC (rev 7583)
@@ -66,7 +66,7 @@
         case 1:case 5:case 6: case 7: case 8: case 9:case 0xc:
                 break;
         default:
-            ADM_warning("Invalid NAL 0x%x\n",nal);
+            ADM_warning("Invalid NAL 0x%x\n",nal);break;
     }
     if(nal<=12) ADM_info("Nal : %s",nalType[nal]);
     return true;



From mean at mail.berlios.de  Sat Sep 24 09:11:29 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:29 +0200
Subject: [Avidemux-svn-commit] r7584 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include
Message-ID: <20110924071129.1894A4813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:28 +0200 (Sat, 24 Sep 2011)
New Revision: 7584

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilterBridge.h
Log:
[filterBridge] Dtor is virtual

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilterBridge.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilterBridge.h	2011-09-24 07:11:27 UTC (rev 7583)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_videoFilterBridge.h	2011-09-24 07:11:28 UTC (rev 7584)
@@ -34,7 +34,7 @@
         bool                getNextFrameBase(uint32_t *frameNumber,ADMImage *image);      
 public:
                             ADM_videoFilterBridge(uint64_t startTime, uint64_t endTime);
-                            ~ADM_videoFilterBridge();
+       virtual             ~ADM_videoFilterBridge();
        virtual bool         goToTime(uint64_t usSeek);  
        virtual bool         getNextFrame(uint32_t *frameNumber,ADMImage *image);      
                bool         getNextFrameAs(ADM_HW_IMAGE type,uint32_t *frameNumber,ADMImage *image);



From mean at mail.berlios.de  Sat Sep 24 09:11:30 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:30 +0200
Subject: [Avidemux-svn-commit] r7585 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <20110924071130.873354813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:30 +0200 (Sat, 24 Sep 2011)
New Revision: 7585

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[main] lint nitpicks

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -227,7 +227,7 @@
       case ADM_PREVIEW_OUTPUT:     
         renderUpdateImage(rdrImage);
         break;
-      default: ADM_assert(0);
+      default: ADM_assert(0);break;
     }
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -50,24 +50,17 @@
 //***********************************
 //******** GUI Function**************
 //***********************************
-
-
-extern uint8_t GUI_jobs(void);
 extern const char * GUI_getCustomJsScript(uint32_t nb);
 extern const char * GUI_getCustomPyScript(uint32_t nb);
 extern const char * GUI_getAutoPyScript(uint32_t nb);
 
-extern uint8_t GUI_getFrameContent(ADMImage *image, uint32_t frame);
 extern int     GUI_handleVFilter (void);
-extern void    GUI_setMarks (uint32_t a, uint32_t b);
-extern void    GUI_displayBitrate( void );
 // Debug functions
        void    GUI_showCurrentFrameHex(void);
        void    GUI_showSize(void);
 
        void    GUI_avsProxy(void);
        uint8_t GUI_close(void);
-extern int     GUI_GoToFrame(uint32_t frame);;
 extern bool    GUI_GoToTime(uint64_t time);
 //***********************************
 //******** DIA Function**************
@@ -75,19 +68,16 @@
 extern uint8_t DIA_about( void );
 extern void    DIA_properties( void);
 extern uint8_t DIA_Preferences(void);
-extern uint8_t DIA_gotoTime(uint16_t *hh, uint32_t *mm, uint32_t *ss);
 extern uint8_t DIA_builtin(void);
-extern void    DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate );
 extern uint8_t DIA_pluginsInfo(void);
 
-extern void filterCleanUp (void);
 static void ReSync (void);
 static void cleanUp (void);
 void        updateLoaded (void);
-extern void encoderSetLogFile (char *name);
-extern void videoCodecConfigureUI(int codecIndex = -1);
-extern void audioCodecChanged(int newcodec);
-extern void videoCodecChanged(int newcodec);
+
+
+
+
 extern bool ADM_mux_configure(int index);
 void brokenAct(void);
 //
@@ -449,7 +439,6 @@
 //    mode 1: Suspicious
 //_____________________________________________________________
 
-extern void GUI_PreviewEnd (void);
 /**
         \fn A_openAvi
         \brief Open (replace mode) a video

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -37,7 +37,6 @@
 
 extern void UI_purge(void);
 extern uint8_t DIA_gotoTime(uint32_t *hh, uint32_t *mm, uint32_t *ss);
-extern bool SliderIsShifted;
 bool   GUI_GoToTime(uint64_t time);
 uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss,uint32_t ms);
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -43,7 +43,6 @@
 //___________________________________
 uint8_t stop_req;
 
-extern renderZoom currentZoom;
 extern ADM_Composer *video_body;
 static uint32_t originalPriority;
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -38,7 +38,6 @@
 // Local prototypes
 #include "A_functions.h"
 int      A_Save(const char *name);
-uint8_t  GUI_getFrameContent(ADMImage *image, uint32_t frame);
 extern   ADM_audioStream  *audioCreateEncodingStream(bool globalHeader,uint64_t startTime,int32_t shift);
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -46,8 +46,7 @@
 ADM_muxer               *ADM_MuxerSpawnFromIndex(int index);
 extern ADM_audioStream  *audioCreateEncodingStream(bool globalHeader,uint64_t startTime,int32_t shift);
 extern ADM_audioStream  *audioCreateCopyStream(uint64_t startTime,int32_t shift,ADM_audioStream *input);
-extern ADM_videoStream  *createVideoStream(ADM_coreVideoEncoder *encoder);
-extern int              ADM_MuxerIndexFromName(const char *name);
+
 /**
     \class admSaver
     \brief Wrapper for saving

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-24 07:11:28 UTC (rev 7584)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2011-09-24 07:11:30 UTC (rev 7585)
@@ -403,6 +403,7 @@
             prefs->set(VIDEODEVICE,(uint32_t)1); // XV
     #endif
 #endif
+    return true;
 }
 
 bool isPortableMode(int argc, char *argv[])



From mean at mail.berlios.de  Sat Sep 24 09:11:31 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 24 Sep 2011 09:11:31 +0200
Subject: [Avidemux-svn-commit] r7586 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/gtk
Message-ID: <20110924071131.ED4A34813DE@sheep.berlios.de>

Author: mean
Date: 2011-09-24 09:11:31 +0200 (Sat, 24 Sep 2011)
New Revision: 7586

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/gtk/gtk_resize.cpp
Log:
[gtk_resize] remove warning

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/gtk/gtk_resize.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/gtk/gtk_resize.cpp	2011-09-24 07:11:30 UTC (rev 7585)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/gtk/gtk_resize.cpp	2011-09-24 07:11:31 UTC (rev 7586)
@@ -186,7 +186,7 @@
 	}
 	aprintf("source mul %02.2f , dst mul : %02.2f\n",sr_mul,dst_mul);
 	x=x*sr_mul*dst_mul;
-	y=y;
+	y=y*1;
 
 	// normalize it to recover 100% width
 	y=y/(x/ow);



From mean at mail.berlios.de  Sun Sep 25 09:06:24 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 25 Sep 2011 09:06:24 +0200
Subject: [Avidemux-svn-commit] r7587 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110925070624.77732481200@sheep.berlios.de>

Author: mean
Date: 2011-09-25 09:06:23 +0200 (Sun, 25 Sep 2011)
New Revision: 7587

Added:
   branches/avidemux_2.6_branch_mean/cmake/CMakeParseArguments285.cmake
Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindPackageHandleStandardArgs.cmake
Log:
[build] Add newer CMakeParseArguments to be compatible with cmake < 2.8.5

Added: branches/avidemux_2.6_branch_mean/cmake/CMakeParseArguments285.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/CMakeParseArguments285.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/CMakeParseArguments285.cmake	2011-09-25 07:06:23 UTC (rev 7587)
@@ -0,0 +1,138 @@
+# CMAKE_PARSE_ARGUMENTS(<prefix> <options> <one_value_keywords> <multi_value_keywords> args...)
+#
+# CMAKE_PARSE_ARGUMENTS() is intended to be used in macros or functions for
+# parsing the arguments given to that macro or function.
+# It processes the arguments and defines a set of variables which hold the
+# values of the respective options.
+#
+# The <options> argument contains all options for the respective macro,
+# i.e. keywords which can be used when calling the macro without any value
+# following, like e.g. the OPTIONAL keyword of the install() command.
+#
+# The <one_value_keywords> argument contains all keywords for this macro
+# which are followed by one value, like e.g. DESTINATION keyword of the
+# install() command.
+#
+# The <multi_value_keywords> argument contains all keywords for this macro
+# which can be followed by more than one value, like e.g. the TARGETS or
+# FILES keywords of the install() command.
+#
+# When done, CMAKE_PARSE_ARGUMENTS() will have defined for each of the
+# keywords listed in <options>, <one_value_keywords> and
+# <multi_value_keywords> a variable composed of the given <prefix>
+# followed by "_" and the name of the respective keyword.
+# These variables will then hold the respective value from the argument list.
+# For the <options> keywords this will be TRUE or FALSE.
+#
+# All remaining arguments are collected in a variable
+# <prefix>_UNPARSED_ARGUMENTS, this can be checked afterwards to see whether
+# your macro was called with unrecognized parameters.
+#
+# As an example here a my_install() macro, which takes similar arguments as the
+# real install() command:
+#
+#   function(MY_INSTALL)
+#     set(options OPTIONAL FAST)
+#     set(oneValueArgs DESTINATION RENAME)
+#     set(multiValueArgs TARGETS CONFIGURATIONS)
+#     cmake_parse_arguments(MY_INSTALL "${options}" "${oneValueArgs}" "${multiValueArgs}" ${ARGN} )
+#     ...
+#
+# Assume my_install() has been called like this:
+#   my_install(TARGETS foo bar DESTINATION bin OPTIONAL blub)
+#
+# After the cmake_parse_arguments() call the macro will have set the following
+# variables:
+#   MY_INSTALL_OPTIONAL = TRUE
+#   MY_INSTALL_FAST = FALSE (this option was not used when calling my_install()
+#   MY_INSTALL_DESTINATION = "bin"
+#   MY_INSTALL_RENAME = "" (was not used)
+#   MY_INSTALL_TARGETS = "foo;bar"
+#   MY_INSTALL_CONFIGURATIONS = "" (was not used)
+#   MY_INSTALL_UNPARSED_ARGUMENTS = "blub" (no value expected after "OPTIONAL"
+#
+# You can the continue and process these variables.
+#
+# Keywords terminate lists of values, e.g. if directly after a one_value_keyword
+# another recognized keyword follows, this is interpreted as the beginning of
+# the new option.
+# E.g. my_install(TARGETS foo DESTINATION OPTIONAL) would result in
+# MY_INSTALL_DESTINATION set to "OPTIONAL", but MY_INSTALL_DESTINATION would
+# be empty and MY_INSTALL_OPTIONAL would be set to TRUE therefor.
+
+#=============================================================================
+# Copyright 2010 Alexander Neundorf <neundorf at kde.org>
+#
+# Distributed under the OSI-approved BSD License (the "License");
+# see accompanying file Copyright.txt for details.
+#
+# This software is distributed WITHOUT ANY WARRANTY; without even the
+# implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+# See the License for more information.
+#=============================================================================
+# (To distribute this file outside of CMake, substitute the full
+#  License text for the above reference.)
+
+
+if(__CMAKE_PARSE_ARGUMENTS_INCLUDED)
+  return()
+endif()
+set(__CMAKE_PARSE_ARGUMENTS_INCLUDED TRUE)
+
+
+function(CMAKE_PARSE_ARGUMENTS prefix _optionNames _singleArgNames _multiArgNames)
+  # first set all result variables to empty/FALSE
+  foreach(arg_name ${_singleArgNames} ${_multiArgNames})
+    set(${prefix}_${arg_name})
+  endforeach(arg_name)
+
+  foreach(option ${_optionNames})
+    set(${prefix}_${option} FALSE)
+  endforeach(option)
+
+  set(${prefix}_UNPARSED_ARGUMENTS)
+
+  set(insideValues FALSE)
+  set(currentArgName)
+
+  # now iterate over all arguments and fill the result variables
+  foreach(currentArg ${ARGN})
+    list(FIND _optionNames "${currentArg}" optionIndex)  # ... then this marks the end of the arguments belonging to this keyword
+    list(FIND _singleArgNames "${currentArg}" singleArgIndex)  # ... then this marks the end of the arguments belonging to this keyword
+    list(FIND _multiArgNames "${currentArg}" multiArgIndex)  # ... then this marks the end of the arguments belonging to this keyword
+
+    if(${optionIndex} EQUAL -1  AND  ${singleArgIndex} EQUAL -1  AND  ${multiArgIndex} EQUAL -1)
+      if(insideValues)
+        if("${insideValues}" STREQUAL "SINGLE")
+          set(${prefix}_${currentArgName} ${currentArg})
+          set(insideValues FALSE)
+        elseif("${insideValues}" STREQUAL "MULTI")
+          list(APPEND ${prefix}_${currentArgName} ${currentArg})
+        endif()
+      else(insideValues)
+        list(APPEND ${prefix}_UNPARSED_ARGUMENTS ${currentArg})
+      endif(insideValues)
+    else()
+      if(NOT ${optionIndex} EQUAL -1)
+        set(${prefix}_${currentArg} TRUE)
+        set(insideValues FALSE)
+      elseif(NOT ${singleArgIndex} EQUAL -1)
+        set(currentArgName ${currentArg})
+        set(${prefix}_${currentArgName})
+        set(insideValues "SINGLE")
+      elseif(NOT ${multiArgIndex} EQUAL -1)
+        set(currentArgName ${currentArg})
+        set(${prefix}_${currentArgName})
+        set(insideValues "MULTI")
+      endif()
+    endif()
+
+  endforeach(currentArg)
+
+  # propagate the result variables to the caller:
+  foreach(arg_name ${_singleArgNames} ${_multiArgNames} ${_optionNames})
+    set(${prefix}_${arg_name}  ${${prefix}_${arg_name}} PARENT_SCOPE)
+  endforeach(arg_name)
+  set(${prefix}_UNPARSED_ARGUMENTS ${${prefix}_UNPARSED_ARGUMENTS} PARENT_SCOPE)
+
+endfunction(CMAKE_PARSE_ARGUMENTS _options _singleArgs _multiArgs)

Modified: branches/avidemux_2.6_branch_mean/cmake/FindPackageHandleStandardArgs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindPackageHandleStandardArgs.cmake	2011-09-24 07:11:31 UTC (rev 7586)
+++ branches/avidemux_2.6_branch_mean/cmake/FindPackageHandleStandardArgs.cmake	2011-09-25 07:06:23 UTC (rev 7587)
@@ -83,7 +83,7 @@
 #  License text for the above reference.)
 
 INCLUDE(FindPackageMessage)
-INCLUDE(CMakeParseArguments)
+INCLUDE(CMakeParseArguments285)
 
 # internal helper macro
 MACRO(_FPHSA_FAILURE_MESSAGE _msg)



From mean at mail.berlios.de  Sun Sep 25 10:03:28 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 25 Sep 2011 10:03:28 +0200
Subject: [Avidemux-svn-commit] r7588 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20110925080328.B1ECE48120E@sheep.berlios.de>

Author: mean
Date: 2011-09-25 10:03:28 +0200 (Sun, 25 Sep 2011)
New Revision: 7588

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindOpenGL.cmake
Log:
[build] Fix build on cmake 2.8.2 (ubuntu maverick)

Modified: branches/avidemux_2.6_branch_mean/cmake/FindOpenGL.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindOpenGL.cmake	2011-09-25 07:06:23 UTC (rev 7587)
+++ branches/avidemux_2.6_branch_mean/cmake/FindOpenGL.cmake	2011-09-25 08:03:28 UTC (rev 7588)
@@ -149,7 +149,8 @@
 
 # handle the QUIETLY and REQUIRED arguments and set OPENGL_FOUND to TRUE if
 # all listed variables are TRUE
-INCLUDE(${CMAKE_CURRENT_LIST_DIR}/FindPackageHandleStandardArgs.cmake)
+# DOES NOT WORK ON CMAKE 2.8.2 INCLUDE(${CMAKE_CURRENT_LIST_DIR}/FindPackageHandleStandardArgs.cmake)
+INCLUDE(FindPackageHandleStandardArgs)
 FIND_PACKAGE_HANDLE_STANDARD_ARGS(OpenGL DEFAULT_MSG OPENGL_gl_LIBRARY)
 
 MARK_AS_ADVANCED(



From mean at mail.berlios.de  Tue Sep 27 20:26:38 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 27 Sep 2011 20:26:38 +0200
Subject: [Avidemux-svn-commit] r7589 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110927182639.132884813E0@sheep.berlios.de>

Author: mean
Date: 2011-09-27 20:26:38 +0200 (Tue, 27 Sep 2011)
New Revision: 7589

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[Q_gui2] Back to unix EOL

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-25 08:03:28 UTC (rev 7588)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-27 18:26:38 UTC (rev 7589)
@@ -1,1254 +1,1254 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "ADM_cpp.h"
-#include "config.h"
-
-#include "ADM_inttype.h"
-#include <QtCore/QFileInfo>
-#include <QtCore/QUrl>
-#include <QtGui/QKeyEvent>
-#include <QtGui/QGraphicsView>
-
-#define MENU_DECLARE
-#include "Q_gui2.h"
-#include "ADM_default.h"
-#include "ADM_toolkitQt.h"
-
-#include "DIA_fileSel.h"
-#include "ADM_vidMisc.h"
-#include "prefs.h"
-#include "avi_vars.h"
-
-#include "ADM_render/GUI_renderInternal.h"
-#include "ADM_coreVideoEncoderInternal.h"
-#include "ADM_muxerProto.h"
-#include "T_vumeter.h"
-#include "DIA_coreToolkit.h"
-
-#ifdef USE_OPENGL
-extern bool ADM_glHasActiveTexture(void);
-void UI_Qt4InitGl(void);
-void UI_Qt4CleanGl(void);
-#endif
-
-extern int global_argc;
-extern char **global_argv;
-
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
-extern int automation(void );
-extern void HandleAction(Action a);
-extern int encoderGetEncoderCount (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-uint32_t audioEncoderGetNumberOfEncoders(void);
-const char  *audioEncoderGetDisplayName(uint32_t i);
-extern void checkCrashFile(void);
-extern void UI_QT4VideoWidget(QFrame *frame);
-extern void loadTranslator(void);
-extern void initTranslator(void);
-extern void destroyTranslator(void);
-extern ADM_RENDER_TYPE UI_getPreferredRender(void);
-extern int A_openAvi(const char *name);
-extern int A_appendAvi(const char *name);
-extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
-
-
-int SliderIsShifted=0;
-static void setupMenus(void);
-static int shiftKeyHeld=0;
-static ADM_QSlider *slider=NULL;
-static int _upd_in_progres=0;
-static int currentFps = 0;
-static int frameCount = 0;
-static int currentFrame = 0;
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
-uint32_t ADM_ve6_getNbEncoders(void);
-void UI_refreshCustomMenu(void);
-QWidget *QuiMainWindows=NULL;
-QWidget *VuMeter=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-extern void saveCrashProject(void);
-extern uint8_t AVDM_setVolume(int volume);
-extern bool ADM_QPreviewCleanup(void);
-
-
-
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
-
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-
-#include "translation_table.h"   
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct 
-{
-	const char *name;
-	Action     action; 
-}adm_qt4_translation;
-
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-	LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
-void UI_updateFrameCount(uint32_t curFrame);
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-extern void UI_purge(void);
-/*
-    Declare the class that will be our main window
-
-*/
-
-void MainWindow::comboChanged(int z)
-{
-	const char *source=qPrintable(sender()->objectName());
-
-	if(!strcmp(source,"comboBoxVideo"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxVideo->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonVideoConf->setEnabled(b);
-		ui.pushButtonVideoFilter->setEnabled(b);
-		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
-	}
-	else if(!strcmp(source,"comboBoxAudio"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxAudio->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonAudioConf->setEnabled(b);
-		ui.pushButtonAudioFilter->setEnabled(b);
-		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
-	}
-	else
-		printf("From +: %s\n",source);
-}
-
-void MainWindow::sliderValueChanged(int u) 
-{
-	if(!_upd_in_progres)
-		HandleAction(ACT_Scale);
-}
-
-void MainWindow::sliderMoved(int value)
-{
-	SliderIsShifted = shiftKeyHeld;
-}
-
-void MainWindow::sliderReleased(void)
-{
-	SliderIsShifted = 0;
-}
-
-void MainWindow::thumbSlider_valueEmitted(int value)
-{
-        if (value > 0)
-                nextIntraFrame();
-        else
-                previousIntraFrame();
-}
-
-void MainWindow::volumeChange( int u )
-{
-	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
-		return;
-
-	_upd_in_progres++;
-
-	int vol = ui.horizontalSlider_2->value();
-
-	AVDM_setVolume(vol);
-	_upd_in_progres--;
-}
-
-void MainWindow::audioToggled(bool checked)
-{
-	if (checked)
-		AVDM_setVolume(ui.horizontalSlider_2->value());
-	else
-		AVDM_setVolume(0);
-}
-
-void MainWindow::previewModeChanged(QAction *action)
-{
-	HandleAction(ACT_PreviewChanged);
-}
-
-void MainWindow::timeChangeFinished(void)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentFrameChanged(void)
-{
-//	HandleAction(ACT_JumpToFrame);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentTimeChanged(void)
-{
-	HandleAction(ACT_GotoTime);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-/**
-    \fn ctor
-*/
-MainWindow::MainWindow() : QMainWindow()
-{
-	qtRegisterDialog(this);
-	ui.setupUi(this);
-
-#if defined(__APPLE__) && defined(USE_SDL)
-	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
-	ui.actionPreferences->setMenuRole(QAction::NoRole);
-	ui.actionQuit->setMenuRole(QAction::NoRole);
-#endif
-
-	// Preview modes
-	QActionGroup *groupPreviewModes = new QActionGroup(this);
-
-	groupPreviewModes->addAction(ui.actionPreviewInput);
-	groupPreviewModes->addAction(ui.actionPreviewOutput);
-	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
-
-	/*
-	Connect our button to buttonPressed
-	*/
-#define PROCESS CONNECT_TB
-	LIST_OF_BUTTONS
-#undef PROCESS
-
-	//ACT_VideoCodecChanged
-	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-
-	// Slider
-	slider=ui.horizontalSlider;
-	slider->setMinimum(0);
-	slider->setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
-	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
-	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
-
-   // Thumb slider
-    ui.sliderPlaceHolder->installEventFilter(this);
-    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
-    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
-
-	// Volume slider
-	QSlider *volSlider=ui.horizontalSlider_2;
-	volSlider->setMinimum(0);
-	volSlider->setMaximum(100);
-	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
-
-	// default state
-	bool b=0;
-	ui.pushButtonVideoConf->setEnabled(b);
-	ui.pushButtonVideoFilter->setEnabled(b);
-	ui.pushButtonAudioConf->setEnabled(b);
-	ui.pushButtonAudioFilter->setEnabled(b);
-
-	/* Time Shift */
-	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
-
-	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
-	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
-	ui.currentTime->setValidator(timeValidator);
-	ui.currentTime->setInputMask("99:99:99.999");
-
-	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
-
-    // Build file,... menu
-    buildMyMenu();
-
-	/* Build the custom menu */
-    jsMenu=new QMenu("javaScript");
-    pyMenu=new QMenu("tinyPython");
-    autoMenu=ui.menuAuto ;//new QMenu("autoPython");
-    ui.menuCustom->addMenu(jsMenu);
-    ui.menuCustom->addMenu(pyMenu);
-    //ui.menuAuto->addMenu(autoMenu);
-	buildCustomMenu();
-
-    recentFiles=new QMenu("Recent Files");
-    recentProjects=new QMenu("Recent Projects");
-    ui.menuRecent->addMenu(recentFiles);
-    ui.menuRecent->addMenu(recentProjects);
-    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
-
-	this->installEventFilter(this);
-	slider->installEventFilter(this);
-    
-	//ui.currentTime->installEventFilter(this);
-
-	this->setFocus(Qt::OtherFocusReason);
-
-	setAcceptDrops(true);
-    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
-
-    // Hook also the toolbar
-    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-
-	QWidget* dummy0 = new QWidget();
-	QWidget* dummy1 = new QWidget();
-	QWidget* dummy2 = new QWidget();
-	QWidget* dummy3 = new QWidget();
-	QWidget* dummy4 = new QWidget();
-
-	ui.codecWidget->setTitleBarWidget(dummy0);
-	ui.navigationWidget->setTitleBarWidget(dummy1);
-	ui.selectionWidget->setTitleBarWidget(dummy2);
-	ui.volumeWidget->setTitleBarWidget(dummy3);
-	ui.audioMetreWidget->setTitleBarWidget(dummy4);
-
-	this->resize(1, 1);
-}
-/**
-    \fn searchToolBar
-*/
-typedef struct 
-{
-    const char *name;
-    Action event;
-}toolBarTranslate;
-
-toolBarTranslate toolbar[]=
-{
-{"actionOpen",              ACT_OPEN_VIDEO},
-{"actionSave_video",        ACT_SAVE_VIDEO},
-{"actionProperties",        ACT_VIDEO_PROPERTIES},
-{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
-{"actionSave_project",      ACT_SAVE_PY_PROJECT},
-//{"actionPreviewInput",ACT_PreviewToggle},
-//{"actionPreviewOutput",ACT_PreviewToggle},
-
-{NULL,ACT_DUMMY}
-};
-void MainWindow::searchToolBar(QAction *action)
-{
-        toolBarTranslate *t=toolbar;
-        QString me(action->objectName());
-        const char *name=me.toUtf8().constData();
-        while(t->name)
-        {
-            if(!strcmp(name,t->name))
-            {
-                HandleAction(t->event);
-                return;
-            }
-            t++;
-        }
-        ADM_warning("Toolbar:Cannot handle %s\n",name);
-}
-/**
-    \fn buildFileMenu
-*/
-bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
-{
-    QMenu *subMenu=NULL;
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        switch(m->type)
-        {
-            case MENU_SEPARATOR:
-                root->addSeparator();
-                break;
-            case MENU_SUBMENU:
-                {
-                    subMenu=root->addMenu(m->text);
-                }
-                break;
-            case MENU_SUBACTION:
-            case MENU_ACTION:
-                {   
-                        QMenu *insert=root;
-                        if(m->type==MENU_SUBACTION) insert=subMenu;
-                        QAction *a=NULL;
-                        if(m->icon) 
-                        {
-                            QIcon icon(m->icon);
-                            a=insert->addAction(icon,m->text);
-                        }else
-                            a=insert->addAction(m->text);
-                        m->cookie=(void *)a;
-                        if(m->shortCut)
-                        {
-                            QKeySequence s(m->shortCut);
-                            a->setShortcut(s);
-                        }
-                        break;
-                }
-            default:
-                break;
-        }
-    }
-    return true;
-}
-/**
-    buildFileMenu
-*/
-bool MainWindow::buildMyMenu(void)
-{
-    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
-    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
-
-    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
-    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
-
-    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
-    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
-
-    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
-    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
-
-    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
-    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
-
-    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
-    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
-
-    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
-    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
-
-    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
-    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
-
-    return true;
-}
-
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-	HandleAction (ACT_TimeShift) ;
-}
-/**
-    \fn searchMenu
-*/
-void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
-{
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        if(m->cookie==(void*)action)
-        {
-            HandleAction (m->event);
-        }
-    }
-}
-
-/**
-    \fn searchFileMenu
-*/
-#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
-    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
-
-MKMENU(File)
-MKMENU(Edit)
-//MKMENU(Recent)
-MKMENU(View)
-MKMENU(Tool)
-MKMENU(Go)
-//MKMENU(Custom)
-MKMENU(Audio)
-MKMENU(Video)
-MKMENU(Help)
-
-
-
-/*
-      We receive a button press event
-*/
-void MainWindow::buttonPressed(void)
-{
-	// Receveid a key press Event, look into table..
-    QObject *obj=sender();
-    if(!obj) return;
-    QString me(obj->objectName());
-    
-	Action action=searchTranslationTable(qPrintable(me));
-    
-
-	if(action!=ACT_DUMMY)
-		HandleAction (action);
-
-}
-void MainWindow::toolButtonPressed(bool i)
-{
-	buttonPressed();
-}
-
-bool MainWindow::eventFilter(QObject* watched, QEvent* event)
-{
-	QKeyEvent *keyEvent;
-
-	switch (event->type())
-	{
-		case QEvent::KeyPress:
-			keyEvent = (QKeyEvent*)event;
-
-			if (watched == slider)
-			{
-				switch (keyEvent->key())
-				{
-					case Qt::Key_Left:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Back25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Back50Frames);
-						else
-							HandleAction(ACT_PreviousFrame);
-
-						return true;
-					case Qt::Key_Right:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Forward25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Forward50Frames);
-						else
-							HandleAction(ACT_NextFrame);
-
-						return true;
-					case Qt::Key_Up:
-						HandleAction(ACT_NextKFrame);
-						return true;
-					case Qt::Key_Down:
-						HandleAction(ACT_PreviousKFrame);
-						return true;
-					case Qt::Key_Shift:
-						shiftKeyHeld = 1;
-						break;
-				}
-			}
-			else if (keyEvent->key() == Qt::Key_Space)
-			{
-				HandleAction(ACT_PlayAvi);
-				return true;
-			}
-
-			break;
-        case QEvent::Resize:
-            if (watched == ui.sliderPlaceHolder)
-            {
-                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
-                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
-            }
-            break;
-
-		case QEvent::KeyRelease:
-			keyEvent = (QKeyEvent*)event;
-
-			if (keyEvent->key() == Qt::Key_Shift)
-				shiftKeyHeld = 0;
-
-			break;
-		case QEvent::FocusOut:
-            break;
-        default:
-            break;
-	}
-
-	return QObject::eventFilter(watched, event);
-}
-/**
-    \fn buildRecentMenu
-*/
-bool MainWindow::buildRecentMenu(void)
-{
-    const char **names;
-	names=prefs->get_lastfiles();
-    // Purge entries...
-    recentFiles->clear();
-    for(int i=0;i<4;i++)
-    {
-        if(names[i])
-        {
-            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
-        }else
-            recentFileAction[i]=NULL;
-    }
-	return true;
-}
-/**
-    \fn searchRecentFiles
-*/
-void MainWindow::searchRecentFiles(QAction * action)
-{
-    for(int i=0;i<4;i++)
-    {
-            QAction *a= recentFileAction[i];
-            if(!a) continue;
-
-            if(a==action) 
-            {
-                HandleAction((Action)(ACT_RECENT0+i));
-                return;
-            }
-    }
-}
-void MainWindow::mousePressEvent(QMouseEvent* event)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
-{
-	if (event->mimeData()->hasFormat("text/uri-list"))
-		event->acceptProposedAction();
-}
-
-void MainWindow::dropEvent(QDropEvent *event)
-{
-	QList<QUrl> urlList;
-	QString fileName;
-	QFileInfo info;
-    const char *cFileName;
-
-	if (event->mimeData()->hasUrls())
-	{
-		urlList = event->mimeData()->urls();
-
-		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
-		{
-			fileName = urlList[fileIndex].toLocalFile();
-			info.setFile(fileName);
-            cFileName=ADM_strdup(fileName.toUtf8().constData());
-            ADM_info("Drop event %s\n",cFileName);
-			if (info.isFile())
-			{
-				if (avifileinfo)
-                {
-                    ADM_info("Appending..\n");
-                    A_appendAvi(cFileName);
-                }
-				else
-                {
-                    ADM_info("Opening..\n");
-                    A_openAvi(cFileName);
-                }
-			}else
-            {
-                ADM_warning("Dropped item is not a file\n");
-            }
-            ADM_dealloc(cFileName);
-		}
-	}
-
-	event->acceptProposedAction();
-}
-
-void MainWindow::previousIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepDown();
-	else
-		HandleAction(ACT_PreviousKFrame);
-}
-
-void MainWindow::nextIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepUp();
-	else
-		HandleAction(ACT_NextKFrame);
-}
-
-MainWindow::~MainWindow()
-{
-	clearCustomMenu();
-    delete thumbSlider;
-    thumbSlider=NULL;
-}
-
-void MainWindow::closeEvent(QCloseEvent *event)
-{
-static bool first=true;
-    ADM_warning("Close event\n");
-    if(first)
-    {
-        first=false;
-        HandleAction(ACT_EXIT);
-    }
-    event->accept();
-//         event->ignore();
-
-}
-
-
-static const UI_FUNCTIONS_T UI_Hooks=
-    {
-        ADM_RENDER_API_VERSION_NUMBER,
-        UI_getWindowInfo,
-        UI_updateDrawWindowSize,
-        UI_rgbDraw,
-        UI_getDrawWidget,
-        UI_getPreferredRender
-        
-    };
-QApplication *myApplication=NULL;
-/**
-    \fn  UI_Init
-    \brief First part of UI initialization
-
-*/
-int UI_Init(int nargc,char **nargv)
-{
-    ADM_info("Starting QT4 GUI...\n");
-	initTranslator();
-
-	global_argc=nargc;
-	global_argv=nargv;
-	ADM_renderLibInit(&UI_Hooks);
-    Q_INIT_RESOURCE(avidemux);
-	Q_INIT_RESOURCE(filter);
-
-	myApplication=new QApplication (global_argc, global_argv);
-	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
-
-	loadTranslator();
-
-	MainWindow *mw = new MainWindow();
-	mw->show();
-
-	QuiMainWindows = (QWidget*)mw;
-
-	uint32_t w, h;
-
-	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
-	printf("The screen seems to be %u x %u px\n",w,h);
-
-	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu();
-
-    // Init vumeter
-    VuMeter=mw->ui.frameVU;
-    UI_InitVUMeter(mw->ui.frameVU);
-	return 0;
-}
-/**
-
-*/
-bool UI_End(void)
-{
-    ADM_QPreviewCleanup();
-    return true;
-}
-void UI_refreshCustomMenu(void)
-{
-	((MainWindow*)QuiMainWindows)->buildCustomMenu();
-}
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-int UI_getCurrentPreview(void)
-{
-	int index;
-
-	if (WIDGET(actionPreviewOutput)->isChecked())
-		index = 1;
-	else if (WIDGET(actionPreviewSide)->isChecked())
-		index = 2;
-	else if (WIDGET(actionPreviewTop)->isChecked())
-		index = 3;
-	else if (WIDGET(actionPreviewSeparate)->isChecked())
-		index = 4;
-	else
-		index = 0;
-
-	return index;
-}
-
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-void UI_setCurrentPreview(int ne)
-{
-	switch (ne)
-	{
-		case 1:
-			WIDGET(actionPreviewOutput)->setChecked(true);
-			break;
-		case 2:
-			WIDGET(actionPreviewSide)->setChecked(true);
-			break;
-		case 3:
-			WIDGET(actionPreviewTop)->setChecked(true);
-			break;
-		case 4:
-			WIDGET(actionPreviewSeparate)->setChecked(true);
-			break;
-		default:
-			WIDGET(actionPreviewInput)->setChecked(true);
-			break;
-	}
-}
-/**
-        \fn FatalFunctionQt
-*/
-static void FatalFunctionQt(const char *title, const char *info)
-{
-	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
-}
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-	
-	setupMenus();
-    ADM_setCrashHook(&saveCrashProject, &FatalFunctionQt);
-	checkCrashFile();
-    // Create an openGL context
-#ifdef USE_OPENGL
-    bool enabled;
-    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
-    if(enabled)
-        UI_Qt4InitGl();
-#endif
-
-	if (global_argc >= 2)
-		automation();
-
-    myApplication->exec();
-#ifdef USE_OPENGL
-    if(enabled)
-        UI_Qt4CleanGl();
-#endif
-	destroyTranslator();
-    delete myApplication;
-    myApplication=NULL;
-    return 1;
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
-	{
-		if(!strcmp(name, myTranslationTable[i].name))
-		{
-			return  myTranslationTable[i].action;
-		}
-	}
-	printf("WARNING: Signal not found in translation table %s\n",name);
-	return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video & audio co
-*/
-void setupMenus(void)
-{
-	uint32_t nbVid;
-    uint32_t maj,mn,pa;
-	const char *name;
-
-	nbVid=ADM_ve6_getNbEncoders();
-	printf("Found %d video encoder(s)\n",nbVid);
-	for(uint32_t i=1;i<nbVid;i++)
-	{
-		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
-		WIDGET(comboBoxVideo)->addItem(name);
-	}
-
-	// And A codec
-
-	uint32_t nbAud;
-
-    nbAud=audioEncoderGetNumberOfEncoders();
-	printf("Found %d audio encoder(s)\n",nbAud);		       
-	for(uint32_t i=1;i<nbAud;i++)
-	{
-		name=audioEncoderGetDisplayName(i);
-		WIDGET(comboBoxAudio)->addItem(name);
-	}
-
-	/*   Fill in output format window */
-	uint32_t nbFormat=ADM_mx_getNbMuxers();
-
-	printf("Found %d format(s)\n",nbFormat);
-	for(uint32_t i=0;i<nbFormat;i++)
-	{
-        const char *name=ADM_mx_getDisplayName(i);
-		WIDGET(comboBoxFormat)->addItem(name);	
-	}
-
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-	double v;
-	if(!slider) v=0;
-	v= (double)(slider->value());
-	v/=10000000;
-	return v;
-}
-void UI_setScale( double val )
-{
-	if(_upd_in_progres) return;
-	_upd_in_progres++;
-	slider->setValue( (int)(val * 10000000));
-	_upd_in_progres--;
-}
-
-int UI_readCurFrame(void)
-{
-	return 0;
-}
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
-{
-	int success = 0;
-
-	QString timeText = WIDGET(currentTime)->text();
-	int pos;
-
-	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
-	{
-		uint32_t frame;
-
-		hh = (uint16_t)timeText.left(2).toUInt();
-		mm = (uint16_t)timeText.mid(3, 2).toUInt();
-		ss = (uint16_t)timeText.mid(6, 2).toUInt();
-		ms = (uint16_t)timeText.right(3).toUInt();
-
-		time2frame(&frame, currentFps, hh, mm, ss, ms);
-
-		if (frame <= frameCount)
-			success = 1;
-	}
-
-	return success;
-}
-
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(const char *name)
-{
-	char *title;
-	const char* defaultTitle = "Avidemux";
-
-	if (name && (*name) )
-	{
-		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
-
-		strcpy(title, name);
-		strcat(title, " - ");
-		strcat(title, defaultTitle);
-	}
-	else
-	{
-		title = new char[strlen(defaultTitle) + 1];
-
-		strcpy(title, defaultTitle);
-	}
-
-	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
-	delete [] title;
-}
-
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-	char string[100];
-	char	c='?';
-    const char *f="???";
-	switch(frametype&AVI_FRAME_TYPE_MASK)
-	{
-	case AVI_KEY_FRAME: c='I';break;
-	case AVI_B_FRAME: c='B';break;
-	case 0: c='P';break;
-	default:c='?';break;
-
-	}
-    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
-	{
-	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
-    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
-    case AVI_FRAME_STRUCTURE: f="FRM";break;
-	default:f="???";
-
-                    break;
-	}
-	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
-	WIDGET(label_8)->setText(string);	
-
-}
-
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-void UI_updateFrameCount(uint32_t curFrame)
-{
-	
-}
-
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-	
-}
-
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
-	char text[80];   
-	uint32_t mm,hh,ss,ms;
-
-	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
-	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-}
-
-
-
-/**
-    \fn UI_setCurrentTime
-    \brief Set current PTS of displayed video
-*/
-void UI_setCurrentTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-
-}
-
-/**
-    \fn UI_setTotalTime
-    \brief SEt the total duration of video
-*/
-void UI_setTotalTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-    WIDGET(totalTime)->setText(text);
-    slider->setTotalDuration(curTime);
-}
-/**
-    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
-    \brief  Display frame # for marker A & B
-*/
-void UI_setMarkers(uint64_t a, uint64_t b)
-{
-	char text[80];
-    uint64_t absoluteA=a,absoluteB=b;
-    uint32_t hh,mm,ss,ms;
-    uint32_t timems;
-    a/=1000;
-    b/=1000;
-
-    timems=(uint32_t)(a);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerA)->setText(text);
-
-	timems=(uint32_t)(b);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerB)->setText(text);
-
-	slider->setMarkers(absoluteA, absoluteB);
-}
-
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-int 	UI_getCurrentVCodec(void)
-{
-	int i=WIDGET(comboBoxVideo)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-	int b=!!i;
-	WIDGET(comboBoxVideo)->setCurrentIndex(i);
-
-	WIDGET(pushButtonVideoConf)->setEnabled(b);
-	WIDGET(pushButtonVideoFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-	int i=WIDGET(comboBoxAudio)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-WIDGET(comboBoxAudio)->setCurrentIndex(i);
-WIDGET(pushButtonAudioConf)->setEnabled(b);
-WIDGET(pushButtonAudioFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-int 	UI_GetCurrentFormat( void )
-{
-	int i=WIDGET(comboBoxFormat)->currentIndex();
-	if(i<0) i=0;
-	return (int)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
-{
-	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
-    return 1;
-}
-
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
-		*onoff=1;
-	else
-		*onoff=0;
-	*value=WIDGET(spinBox_TimeValue)->value();
-	return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (onoff && value)
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
-	else
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
-	WIDGET(spinBox_TimeValue)->setValue(value);
-	return 1;
-}
-/**
-    \fn UI_setVUMeter
-*/
-bool UI_setVUMeter( uint32_t volume[6])
-{
-    UI_vuUpdate( volume);
-    return true;
-}
-/**
-    \fn setDecodeName
-*/
-bool UI_setDecoderName(const char *name)
-{
-    WIDGET(labelVideoDecoder)->setText(name);	
-    return true;
-}
-/**
-    \fn UI_hasOpengl
-*/
-bool UI_hasOpenGl(void)
-{
-#ifndef USE_OPENGL
-    return false;
-#else
-    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
-    bool enabled;
-    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
-    return enabled;
-#endif
-}
-//********************************************
-//EOF
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_cpp.h"
+#include "config.h"
+
+#include "ADM_inttype.h"
+#include <QtCore/QFileInfo>
+#include <QtCore/QUrl>
+#include <QtGui/QKeyEvent>
+#include <QtGui/QGraphicsView>
+
+#define MENU_DECLARE
+#include "Q_gui2.h"
+#include "ADM_default.h"
+#include "ADM_toolkitQt.h"
+
+#include "DIA_fileSel.h"
+#include "ADM_vidMisc.h"
+#include "prefs.h"
+#include "avi_vars.h"
+
+#include "ADM_render/GUI_renderInternal.h"
+#include "ADM_coreVideoEncoderInternal.h"
+#include "ADM_muxerProto.h"
+#include "T_vumeter.h"
+#include "DIA_coreToolkit.h"
+
+#ifdef USE_OPENGL
+extern bool ADM_glHasActiveTexture(void);
+void UI_Qt4InitGl(void);
+void UI_Qt4CleanGl(void);
+#endif
+
+extern int global_argc;
+extern char **global_argv;
+
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern int encoderGetEncoderCount (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+uint32_t audioEncoderGetNumberOfEncoders(void);
+const char  *audioEncoderGetDisplayName(uint32_t i);
+extern void checkCrashFile(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
+extern int A_openAvi(const char *name);
+extern int A_appendAvi(const char *name);
+extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
+
+
+int SliderIsShifted=0;
+static void setupMenus(void);
+static int shiftKeyHeld=0;
+static ADM_QSlider *slider=NULL;
+static int _upd_in_progres=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
+uint32_t ADM_ve6_getNbEncoders(void);
+void UI_refreshCustomMenu(void);
+QWidget *QuiMainWindows=NULL;
+QWidget *VuMeter=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+extern void saveCrashProject(void);
+extern uint8_t AVDM_setVolume(int volume);
+extern bool ADM_QPreviewCleanup(void);
+
+
+
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
+
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+
+#include "translation_table.h"   
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct 
+{
+	const char *name;
+	Action     action; 
+}adm_qt4_translation;
+
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+	LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+extern void UI_purge(void);
+/*
+    Declare the class that will be our main window
+
+*/
+
+void MainWindow::comboChanged(int z)
+{
+	const char *source=qPrintable(sender()->objectName());
+
+	if(!strcmp(source,"comboBoxVideo"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxVideo->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonVideoConf->setEnabled(b);
+		ui.pushButtonVideoFilter->setEnabled(b);
+		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
+	}
+	else if(!strcmp(source,"comboBoxAudio"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxAudio->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonAudioConf->setEnabled(b);
+		ui.pushButtonAudioFilter->setEnabled(b);
+		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
+	}
+	else
+		printf("From +: %s\n",source);
+}
+
+void MainWindow::sliderValueChanged(int u) 
+{
+	if(!_upd_in_progres)
+		HandleAction(ACT_Scale);
+}
+
+void MainWindow::sliderMoved(int value)
+{
+	SliderIsShifted = shiftKeyHeld;
+}
+
+void MainWindow::sliderReleased(void)
+{
+	SliderIsShifted = 0;
+}
+
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+        if (value > 0)
+                nextIntraFrame();
+        else
+                previousIntraFrame();
+}
+
+void MainWindow::volumeChange( int u )
+{
+	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
+		return;
+
+	_upd_in_progres++;
+
+	int vol = ui.horizontalSlider_2->value();
+
+	AVDM_setVolume(vol);
+	_upd_in_progres--;
+}
+
+void MainWindow::audioToggled(bool checked)
+{
+	if (checked)
+		AVDM_setVolume(ui.horizontalSlider_2->value());
+	else
+		AVDM_setVolume(0);
+}
+
+void MainWindow::previewModeChanged(QAction *action)
+{
+	HandleAction(ACT_PreviewChanged);
+}
+
+void MainWindow::timeChangeFinished(void)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentFrameChanged(void)
+{
+//	HandleAction(ACT_JumpToFrame);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentTimeChanged(void)
+{
+	HandleAction(ACT_GotoTime);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+/**
+    \fn ctor
+*/
+MainWindow::MainWindow() : QMainWindow()
+{
+	qtRegisterDialog(this);
+	ui.setupUi(this);
+
+#if defined(__APPLE__) && defined(USE_SDL)
+	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
+	ui.actionPreferences->setMenuRole(QAction::NoRole);
+	ui.actionQuit->setMenuRole(QAction::NoRole);
+#endif
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes->addAction(ui.actionPreviewInput);
+	groupPreviewModes->addAction(ui.actionPreviewOutput);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
+#define PROCESS CONNECT_TB
+	LIST_OF_BUTTONS
+#undef PROCESS
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider->setMinimum(0);
+	slider->setMaximum(1000000000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
+
+   // Thumb slider
+    ui.sliderPlaceHolder->installEventFilter(this);
+    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider->setMinimum(0);
+	volSlider->setMaximum(100);
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
+
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf->setEnabled(b);
+	ui.pushButtonVideoFilter->setEnabled(b);
+	ui.pushButtonAudioConf->setEnabled(b);
+	ui.pushButtonAudioFilter->setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
+
+	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.currentTime->setValidator(timeValidator);
+	ui.currentTime->setInputMask("99:99:99.999");
+
+	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
+    // Build file,... menu
+    buildMyMenu();
+
+	/* Build the custom menu */
+    jsMenu=new QMenu("javaScript");
+    pyMenu=new QMenu("tinyPython");
+    autoMenu=ui.menuAuto ;//new QMenu("autoPython");
+    ui.menuCustom->addMenu(jsMenu);
+    ui.menuCustom->addMenu(pyMenu);
+    //ui.menuAuto->addMenu(autoMenu);
+	buildCustomMenu();
+
+    recentFiles=new QMenu("Recent Files");
+    recentProjects=new QMenu("Recent Projects");
+    ui.menuRecent->addMenu(recentFiles);
+    ui.menuRecent->addMenu(recentProjects);
+    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
+
+	this->installEventFilter(this);
+	slider->installEventFilter(this);
+    
+	//ui.currentTime->installEventFilter(this);
+
+	this->setFocus(Qt::OtherFocusReason);
+
+	setAcceptDrops(true);
+    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
+
+    // Hook also the toolbar
+    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+
+	QWidget* dummy0 = new QWidget();
+	QWidget* dummy1 = new QWidget();
+	QWidget* dummy2 = new QWidget();
+	QWidget* dummy3 = new QWidget();
+	QWidget* dummy4 = new QWidget();
+
+	ui.codecWidget->setTitleBarWidget(dummy0);
+	ui.navigationWidget->setTitleBarWidget(dummy1);
+	ui.selectionWidget->setTitleBarWidget(dummy2);
+	ui.volumeWidget->setTitleBarWidget(dummy3);
+	ui.audioMetreWidget->setTitleBarWidget(dummy4);
+
+	this->resize(1, 1);
+}
+/**
+    \fn searchToolBar
+*/
+typedef struct 
+{
+    const char *name;
+    Action event;
+}toolBarTranslate;
+
+toolBarTranslate toolbar[]=
+{
+{"actionOpen",              ACT_OPEN_VIDEO},
+{"actionSave_video",        ACT_SAVE_VIDEO},
+{"actionProperties",        ACT_VIDEO_PROPERTIES},
+{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
+{"actionSave_project",      ACT_SAVE_PY_PROJECT},
+//{"actionPreviewInput",ACT_PreviewToggle},
+//{"actionPreviewOutput",ACT_PreviewToggle},
+
+{NULL,ACT_DUMMY}
+};
+void MainWindow::searchToolBar(QAction *action)
+{
+        toolBarTranslate *t=toolbar;
+        QString me(action->objectName());
+        const char *name=me.toUtf8().constData();
+        while(t->name)
+        {
+            if(!strcmp(name,t->name))
+            {
+                HandleAction(t->event);
+                return;
+            }
+            t++;
+        }
+        ADM_warning("Toolbar:Cannot handle %s\n",name);
+}
+/**
+    \fn buildFileMenu
+*/
+bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
+{
+    QMenu *subMenu=NULL;
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        switch(m->type)
+        {
+            case MENU_SEPARATOR:
+                root->addSeparator();
+                break;
+            case MENU_SUBMENU:
+                {
+                    subMenu=root->addMenu(m->text);
+                }
+                break;
+            case MENU_SUBACTION:
+            case MENU_ACTION:
+                {   
+                        QMenu *insert=root;
+                        if(m->type==MENU_SUBACTION) insert=subMenu;
+                        QAction *a=NULL;
+                        if(m->icon) 
+                        {
+                            QIcon icon(m->icon);
+                            a=insert->addAction(icon,m->text);
+                        }else
+                            a=insert->addAction(m->text);
+                        m->cookie=(void *)a;
+                        if(m->shortCut)
+                        {
+                            QKeySequence s(m->shortCut);
+                            a->setShortcut(s);
+                        }
+                        break;
+                }
+            default:
+                break;
+        }
+    }
+    return true;
+}
+/**
+    buildFileMenu
+*/
+bool MainWindow::buildMyMenu(void)
+{
+    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
+    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
+
+    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
+    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
+
+    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
+    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
+
+    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
+    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
+
+    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
+    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
+
+    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
+    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
+
+    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
+    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
+
+    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
+    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
+
+    return true;
+}
+
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+	HandleAction (ACT_TimeShift) ;
+}
+/**
+    \fn searchMenu
+*/
+void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
+{
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        if(m->cookie==(void*)action)
+        {
+            HandleAction (m->event);
+        }
+    }
+}
+
+/**
+    \fn searchFileMenu
+*/
+#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
+    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
+
+MKMENU(File)
+MKMENU(Edit)
+//MKMENU(Recent)
+MKMENU(View)
+MKMENU(Tool)
+MKMENU(Go)
+//MKMENU(Custom)
+MKMENU(Audio)
+MKMENU(Video)
+MKMENU(Help)
+
+
+
+/*
+      We receive a button press event
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+    QObject *obj=sender();
+    if(!obj) return;
+    QString me(obj->objectName());
+    
+	Action action=searchTranslationTable(qPrintable(me));
+    
+
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	QKeyEvent *keyEvent;
+
+	switch (event->type())
+	{
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
+
+			if (watched == slider)
+			{
+				switch (keyEvent->key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
+
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
+
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
+			}
+			else if (keyEvent->key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
+
+			break;
+        case QEvent::Resize:
+            if (watched == ui.sliderPlaceHolder)
+            {
+                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
+                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
+            }
+            break;
+
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent->key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+            break;
+        default:
+            break;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+/**
+    \fn buildRecentMenu
+*/
+bool MainWindow::buildRecentMenu(void)
+{
+    const char **names;
+	names=prefs->get_lastfiles();
+    // Purge entries...
+    recentFiles->clear();
+    for(int i=0;i<4;i++)
+    {
+        if(names[i])
+        {
+            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
+        }else
+            recentFileAction[i]=NULL;
+    }
+	return true;
+}
+/**
+    \fn searchRecentFiles
+*/
+void MainWindow::searchRecentFiles(QAction * action)
+{
+    for(int i=0;i<4;i++)
+    {
+            QAction *a= recentFileAction[i];
+            if(!a) continue;
+
+            if(a==action) 
+            {
+                HandleAction((Action)(ACT_RECENT0+i));
+                return;
+            }
+    }
+}
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+{
+	if (event->mimeData()->hasFormat("text/uri-list"))
+		event->acceptProposedAction();
+}
+
+void MainWindow::dropEvent(QDropEvent *event)
+{
+	QList<QUrl> urlList;
+	QString fileName;
+	QFileInfo info;
+    const char *cFileName;
+
+	if (event->mimeData()->hasUrls())
+	{
+		urlList = event->mimeData()->urls();
+
+		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
+		{
+			fileName = urlList[fileIndex].toLocalFile();
+			info.setFile(fileName);
+            cFileName=ADM_strdup(fileName.toUtf8().constData());
+            ADM_info("Drop event %s\n",cFileName);
+			if (info.isFile())
+			{
+				if (avifileinfo)
+                {
+                    ADM_info("Appending..\n");
+                    A_appendAvi(cFileName);
+                }
+				else
+                {
+                    ADM_info("Opening..\n");
+                    A_openAvi(cFileName);
+                }
+			}else
+            {
+                ADM_warning("Dropped item is not a file\n");
+            }
+            ADM_dealloc(cFileName);
+		}
+	}
+
+	event->acceptProposedAction();
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+    delete thumbSlider;
+    thumbSlider=NULL;
+}
+
+void MainWindow::closeEvent(QCloseEvent *event)
+{
+static bool first=true;
+    ADM_warning("Close event\n");
+    if(first)
+    {
+        first=false;
+        HandleAction(ACT_EXIT);
+    }
+    event->accept();
+//         event->ignore();
+
+}
+
+
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
+QApplication *myApplication=NULL;
+/**
+    \fn  UI_Init
+    \brief First part of UI initialization
+
+*/
+int UI_Init(int nargc,char **nargv)
+{
+    ADM_info("Starting QT4 GUI...\n");
+	initTranslator();
+
+	global_argc=nargc;
+	global_argv=nargv;
+	ADM_renderLibInit(&UI_Hooks);
+    Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+
+	myApplication=new QApplication (global_argc, global_argv);
+	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
+
+	loadTranslator();
+
+	MainWindow *mw = new MainWindow();
+	mw->show();
+
+	QuiMainWindows = (QWidget*)mw;
+
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
+	printf("The screen seems to be %u x %u px\n",w,h);
+
+	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu();
+
+    // Init vumeter
+    VuMeter=mw->ui.frameVU;
+    UI_InitVUMeter(mw->ui.frameVU);
+	return 0;
+}
+/**
+
+*/
+bool UI_End(void)
+{
+    ADM_QPreviewCleanup();
+    return true;
+}
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)->buildCustomMenu();
+}
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+int UI_getCurrentPreview(void)
+{
+	int index;
+
+	if (WIDGET(actionPreviewOutput)->isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)->isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)->isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)->isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
+}
+
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+void UI_setCurrentPreview(int ne)
+{
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)->setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)->setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)->setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)->setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)->setChecked(true);
+			break;
+	}
+}
+/**
+        \fn FatalFunctionQt
+*/
+static void FatalFunctionQt(const char *title, const char *info)
+{
+	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
+}
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+	
+	setupMenus();
+    ADM_setCrashHook(&saveCrashProject, &FatalFunctionQt);
+	checkCrashFile();
+    // Create an openGL context
+#ifdef USE_OPENGL
+    bool enabled;
+    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
+    if(enabled)
+        UI_Qt4InitGl();
+#endif
+
+	if (global_argc >= 2)
+		automation();
+
+    myApplication->exec();
+#ifdef USE_OPENGL
+    if(enabled)
+        UI_Qt4CleanGl();
+#endif
+	destroyTranslator();
+    delete myApplication;
+    myApplication=NULL;
+    return 1;
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf("WARNING: Signal not found in translation table %s\n",name);
+	return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video & audio co
+*/
+void setupMenus(void)
+{
+	uint32_t nbVid;
+    uint32_t maj,mn,pa;
+	const char *name;
+
+	nbVid=ADM_ve6_getNbEncoders();
+	printf("Found %d video encoder(s)\n",nbVid);
+	for(uint32_t i=1;i<nbVid;i++)
+	{
+		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
+		WIDGET(comboBoxVideo)->addItem(name);
+	}
+
+	// And A codec
+
+	uint32_t nbAud;
+
+    nbAud=audioEncoderGetNumberOfEncoders();
+	printf("Found %d audio encoder(s)\n",nbAud);		       
+	for(uint32_t i=1;i<nbAud;i++)
+	{
+		name=audioEncoderGetDisplayName(i);
+		WIDGET(comboBoxAudio)->addItem(name);
+	}
+
+	/*   Fill in output format window */
+	uint32_t nbFormat=ADM_mx_getNbMuxers();
+
+	printf("Found %d format(s)\n",nbFormat);
+	for(uint32_t i=0;i<nbFormat;i++)
+	{
+        const char *name=ADM_mx_getDisplayName(i);
+		WIDGET(comboBoxFormat)->addItem(name);	
+	}
+
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider->value());
+	v/=10000000;
+	return v;
+}
+void UI_setScale( double val )
+{
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider->setValue( (int)(val * 10000000));
+	_upd_in_progres--;
+}
+
+int UI_readCurFrame(void)
+{
+	return 0;
+}
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(currentTime)->text();
+	int pos;
+
+	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&frame, currentFps, hh, mm, ss, ms);
+
+		if (frame <= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(const char *name)
+{
+	char *title;
+	const char* defaultTitle = "Avidemux";
+
+	if (name && (*name) )
+	{
+		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
+
+		strcpy(title, name);
+		strcat(title, " - ");
+		strcat(title, defaultTitle);
+	}
+	else
+	{
+		title = new char[strlen(defaultTitle) + 1];
+
+		strcpy(title, defaultTitle);
+	}
+
+	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
+	delete [] title;
+}
+
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+	char string[100];
+	char	c='?';
+    const char *f="???";
+	switch(frametype&AVI_FRAME_TYPE_MASK)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
+
+	}
+    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
+	{
+	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
+    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
+    case AVI_FRAME_STRUCTURE: f="FRM";break;
+	default:f="???";
+
+                    break;
+	}
+	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
+	WIDGET(label_8)->setText(string);	
+
+}
+
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+void UI_updateFrameCount(uint32_t curFrame)
+{
+	
+}
+
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+	
+}
+
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+	char text[80];   
+	uint32_t mm,hh,ss,ms;
+
+	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
+	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+}
+
+
+
+/**
+    \fn UI_setCurrentTime
+    \brief Set current PTS of displayed video
+*/
+void UI_setCurrentTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+
+}
+
+/**
+    \fn UI_setTotalTime
+    \brief SEt the total duration of video
+*/
+void UI_setTotalTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+    WIDGET(totalTime)->setText(text);
+    slider->setTotalDuration(curTime);
+}
+/**
+    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
+    \brief  Display frame # for marker A & B
+*/
+void UI_setMarkers(uint64_t a, uint64_t b)
+{
+	char text[80];
+    uint64_t absoluteA=a,absoluteB=b;
+    uint32_t hh,mm,ss,ms;
+    uint32_t timems;
+    a/=1000;
+    b/=1000;
+
+    timems=(uint32_t)(a);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerA)->setText(text);
+
+	timems=(uint32_t)(b);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerB)->setText(text);
+
+	slider->setMarkers(absoluteA, absoluteB);
+}
+
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+int 	UI_getCurrentVCodec(void)
+{
+	int i=WIDGET(comboBoxVideo)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+	int b=!!i;
+	WIDGET(comboBoxVideo)->setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)->setEnabled(b);
+	WIDGET(pushButtonVideoFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+	int i=WIDGET(comboBoxAudio)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+WIDGET(comboBoxAudio)->setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)->setEnabled(b);
+WIDGET(pushButtonAudioFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+int 	UI_GetCurrentFormat( void )
+{
+	int i=WIDGET(comboBoxFormat)->currentIndex();
+	if(i<0) i=0;
+	return (int)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
+{
+	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
+    return 1;
+}
+
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)->value();
+	return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+	if (onoff && value)
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)->setValue(value);
+	return 1;
+}
+/**
+    \fn UI_setVUMeter
+*/
+bool UI_setVUMeter( uint32_t volume[6])
+{
+    UI_vuUpdate( volume);
+    return true;
+}
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)->setText(name);	
+    return true;
+}
+/**
+    \fn UI_hasOpengl
+*/
+bool UI_hasOpenGl(void)
+{
+#ifndef USE_OPENGL
+    return false;
+#else
+    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
+    bool enabled;
+    prefs->get(FEATURES_ENABLE_OPENGL,&enabled);
+    return enabled;
+#endif
+}
+//********************************************
+//EOF



From mean at mail.berlios.de  Tue Sep 27 20:26:40 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 27 Sep 2011 20:26:40 +0200
Subject: [Avidemux-svn-commit] r7590 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20110927182640.2CA5F4813E0@sheep.berlios.de>

Author: mean
Date: 2011-09-27 20:26:39 +0200 (Tue, 27 Sep 2011)
New Revision: 7590

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[qt4] Dont keep using a value that has been destroyed

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-27 18:26:38 UTC (rev 7589)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-27 18:26:39 UTC (rev 7590)
@@ -358,18 +358,20 @@
 void MainWindow::searchToolBar(QAction *action)
 {
         toolBarTranslate *t=toolbar;
-        QString me(action->objectName());
-        const char *name=me.toUtf8().constData();
+
+        char *name=ADM_strdup(action->objectName().toUtf8().constData());
         while(t->name)
         {
             if(!strcmp(name,t->name))
             {
                 HandleAction(t->event);
+                ADM_dealloc( name);
                 return;
             }
             t++;
         }
         ADM_warning("Toolbar:Cannot handle %s\n",name);
+        ADM_dealloc( name);
 }
 /**
     \fn buildFileMenu



From mean at mail.berlios.de  Fri Sep 30 07:29:45 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 30 Sep 2011 07:29:45 +0200
Subject: [Avidemux-svn-commit] r7591 - in branches/avidemux_2.6_branch_mean:
	. avidemux_core/ffmpeg_package/patches cmake foreignBuilds
Message-ID: <20110930052945.508AF48125B@sheep.berlios.de>

Author: mean
Date: 2011-09-30 07:29:44 +0200 (Fri, 30 Sep 2011)
New Revision: 7591

Added:
   branches/avidemux_2.6_branch_mean/bootStrapCrossMac106.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mac104_core
Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config_macosx.mak.diff
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config.mak.diff
   branches/avidemux_2.6_branch_mean/cmake/admAsNeeded.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
Log:
[build] Cross compilation for macOsX : Core

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config.mak.diff	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config.mak.diff	2011-09-30 05:29:44 UTC (rev 7591)
@@ -1,8 +1,6 @@
---- config.mak.old	2009-05-01 19:26:13.808782802 +0200
-+++ config.mak	2009-05-01 18:10:25.000085291 +0200
-@@ -60,7 +60,7 @@
- BUILD_SHARED=yes
- PIC=-fPIC -DPIC
+--- config.mak	2011-09-29 06:10:57.072423557 +0000
++++ config.mak	2011-09-29 06:11:44.896423943 +0000
+@@ -59,7 +59,7 @@
  LIBTARGET=
 -SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
 +SLIBNAME=$(SLIBPREF)ADM6$(FULLNAME)$(SLIBSUF)

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config_macosx.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config_macosx.mak.diff	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ffmpeg_package/patches/config_macosx.mak.diff	2011-09-30 05:29:44 UTC (rev 7591)
@@ -1,13 +0,0 @@
---- config.mak.old	2009-05-01 19:26:13.808782802 +0200
-+++ config.mak	2009-05-01 18:10:25.000085291 +0200
-@@ -60,7 +60,7 @@
- INSTALL=install
- LIBTARGET=
--SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
--SLIBNAME_WITH_VERSION=$(SLIBPREF)$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
--SLIBNAME_WITH_MAJOR=$(SLIBPREF)$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
-+SLIBNAME=$(SLIBPREF)ADM6$(FULLNAME)$(SLIBSUF)
-+SLIBNAME_WITH_VERSION=$(SLIBPREF)ADM6$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
-+SLIBNAME_WITH_MAJOR=$(SLIBPREF)ADM6$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
- SLIB_CREATE_DEF_CMD=
- SLIB_EXTRA_CMD=

Added: branches/avidemux_2.6_branch_mean/bootStrapCrossMac106.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrapCrossMac106.sh	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/bootStrapCrossMac106.sh	2011-09-30 05:29:44 UTC (rev 7591)
@@ -0,0 +1,46 @@
+#!/bin/bash
+# ** Put your config here **
+export CROSS_PREFIX=i686-apple-darwin10
+export SDLDIR=/opt/mac
+export TOOLCHAIN_DIR=/opt/mac/bin
+export XSDK=/opt/mac/SDKs/MacOSX10.6.sdk/usr
+export QT_HOME=/opt/mac/Qt/4.5.2
+# ** Put your config here **
+
+fail()
+{
+        echo "** Failed at $1**"
+        exit 1
+}
+
+Process()
+{
+        export BUILDDIR=$1
+        export SCRIPT=$2
+        echo "Building $BUILDDIR from $SOURCEDIR"
+        rm -Rf ./$BUILDDIR
+        mkdir $BUILDDIR || fail mkdir
+        cd $BUILDDIR 
+        sh $TOP/foreignBuilds/$SCRIPT || fail cmake
+        make -j 2 > /tmp/log$BUILDDIR || fail make
+        make install || fail make_install
+}
+
+echo "**BootStrapping avidemux **"
+export TOP=$PWD
+echo "Top dir : $TOP"
+echo "** CORE **"
+cd $TOP
+Process buildMingwCore cross_mac104_core
+echo "** QT4 **"
+cd $TOP
+Process buildMingwQt4 cross_mac104_qt4 
+#echo "** GTK **"
+#cd $TOP
+#Process buildGtk ../avidemux/gtk
+echo "** Plugins **"
+cd $TOP
+Process buildMingwPlugins cross_mac104_plugins 
+echo "** All done **"
+cd $TOP
+echo "** ALL DONE **"

Modified: branches/avidemux_2.6_branch_mean/cmake/admAsNeeded.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admAsNeeded.cmake	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/cmake/admAsNeeded.cmake	2011-09-30 05:29:44 UTC (rev 7591)
@@ -1,5 +1,7 @@
 MACRO(AS_NEEDED name)
-        TARGET_LINK_LIBRARIES( ${name} "-Wl,--as-needed")
+	IF(NOT APPLE)
+        	TARGET_LINK_LIBRARIES( ${name} "-Wl,--as-needed")
+	ENDIF(NOT APPLE)
 ENDMACRO(AS_NEEDED name)
 
 MACRO(ADM_ADD_SHARED_LIBRARY name )

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-09-30 05:29:44 UTC (rev 7591)
@@ -27,6 +27,7 @@
 
 FIND_PACKAGE(Threads)
 if(CROSS)
+	IF(NOT APPLE)
 			  IF(X86_64_SUPPORTED)
                           	SET(PTHREAD_LIBRARIES "-lpthreadGC2-w64")
 			  ELSE(X86_64_SUPPORTED)
@@ -34,6 +35,7 @@
 			  ENDIF(X86_64_SUPPORTED)
 			  MESSAGE(STATUS "Cross compile override using ${PTHREAD_LIBRARIES} hardcoded")
 			  MESSAGE(STATUS "INCLUDE=<${PTHREAD_INCLUDE_DIR}>, LIB=<${PTHREAD_LIBRARIES}>")
+	ENDIF(NOT APPLE)
 			  SET(PTHREAD_FOUND TRUE)
 endif(CROSS)
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2011-09-30 05:29:44 UTC (rev 7591)
@@ -60,9 +60,10 @@
 		patch_file("${FFMPEG_SOURCE_DIR}" "${patchFile}")
 	endforeach(patchFile)
 
-	if (UNIX)
-		patch_file("${FFMPEG_SOURCE_DIR}" "${FFMPEG_PATCH_DIR}/common.mak.diff")
-	endif (UNIX)
+	if (UNIX )
+			MESSAGE(STATUS "Patching Linux common.mak")
+			patch_file("${FFMPEG_SOURCE_DIR}" "${FFMPEG_PATCH_DIR}/common.mak.diff") 
+	endif (UNIX )
 
 	message("")
 endif (FFMPEG_PERFORM_PATCH)
@@ -119,6 +120,20 @@
 
 #  Cross compiler override (win32 & win64)
 if (CROSS)
+if(APPLE)
+	xadd(--prefix=/opt/mac)
+	xadd(--host-cc=gcc)
+	xadd(--cc=${CMAKE_CROSS_PREFIX}-gcc)
+	xadd(--ld=${CMAKE_CROSS_PREFIX}-gcc) # Not an error !
+	xadd(--ar=${CMAKE_CROSS_PREFIX}-ar) 
+	xadd(--nm=${CMAKE_CROSS_PREFIX}-nm) 
+	xadd(--strip=${CMAKE_CROSS_PREFIX}-strip) 
+
+	set(CROSS_OS darwin)	
+
+	set(CROSS_ARCH i386)
+
+else(APPLE)
 	xadd(--prefix=/mingw)
 	xadd(--host-cc=gcc)
 	xadd(--cc=${CMAKE_CROSS_PREFIX}-gcc)
@@ -135,6 +150,7 @@
 		set(CROSS_ARCH i386)
 	endif (ADM_CPU_64BIT)
 
+endif(APPLE)
 	message(STATUS "Using cross compilation flag: ${FFMPEG_FLAGS}")
 endif (CROSS)
 
@@ -209,13 +225,16 @@
 	execute_process(COMMAND ${CMAKE_COMMAND} -E copy "./libavutil/avconfig.h" "${CMAKE_BINARY_DIR}/config/libavutil"
 					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
 
-	if (APPLE)
+	   if (UNIX)
 		find_package(Patch)
-		patch_file("${FFMPEG_BINARY_DIR}" "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/patches/config_macosx.mak.diff")
-	elseif (UNIX)
-		find_package(Patch)
-		patch_file("${FFMPEG_BINARY_DIR}" "${FFMPEG_PATCH_DIR}/config.mak.diff")
-	endif (APPLE)
+		IF(APPLE)
+			MESSAGE(STATUS "Patching config.mak - mac(2)")
+			patch_file("${FFMPEG_BINARY_DIR}" "${FFMPEG_PATCH_DIR}/config.mak.mac.diff")
+		ELSE(APPLE)
+			MESSAGE(STATUS "Patching config.mak - linux (2)")
+			patch_file("${FFMPEG_BINARY_DIR}" "${FFMPEG_PATCH_DIR}/config.mak.diff")
+		ENDIF(APPLE)
+	   endif (UNIX)
 
 	message("")
 endif (FFMPEG_PERFORM_BUILD)

Modified: branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2011-09-27 18:26:39 UTC (rev 7590)
+++ branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2011-09-30 05:29:44 UTC (rev 7591)
@@ -3,8 +3,8 @@
 SET(CMAKE_C_FLAGS $ENV{CFLAGS})
 SET(CMAKE_CXX_FLAGS $ENV{CXXFLAGS})
 SET(CMAKE_LD_FLAGS $ENV{LDFLAGS})
+cmake_policy(SET CMP0004 OLD)
 
-
 IF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES "^${CMAKE_CXX_COMPILER_WORKS}$")
 	SET(FRESH_BUILD 1)
 ENDIF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES "^${CMAKE_CXX_COMPILER_WORKS}$")

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mac104_core
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mac104_core	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mac104_core	2011-09-30 05:29:44 UTC (rev 7591)
@@ -0,0 +1,23 @@
+#!/bin/bash
+export PKG_CONFIG_PATH=$XSDK/lib/pkgconfig
+export PKG_CONFIG_LIBDIR=$XSDK/lib/pkgconfig
+export CXXFLAGS="-arch i386"
+export CFLAGS="$CXXFLAGS"
+export CPPFLAGS="$CXXFLAGS"
+export LDFLAGS="-L$XSDK/lib"
+export PATH=$XSDK/bin:$PATH:$TOOLCHAIN_DIR
+pkg-config --list-all
+#export DEBUG="-DVERBOSE=1 -DDEBUG=1  -DCMAKE_BUILD_TYPE=Debug    "
+echo "<<<<<<<<<<<<Cross compiling core ($XSDK)>>>>>>>>>>>>>>>>"
+cmake   -DCROSS=$XSDK \
+	-DCROSS_MAC=104 \
+	-DCMAKE_SYSTEM_NAME=Darwin  \
+        -DCMAKE_INSTALL_PREFIX=$XSDK/Release \
+	-DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
+        -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
+        -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
+        -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \
+        -DCMAKE_AR:STRING=$CROSS_PREFIX-ar \
+        $DEBUG\
+        -DAVIDEMUX_TOP_SOURCE_DIR="$TOP"  \
+        $TOP/avidemux_core



