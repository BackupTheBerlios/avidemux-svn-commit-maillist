<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3664 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3664%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200710221535.l9MFZXtW026120%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000933.html">
   <LINK REL="Next"  HREF="000935.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3664 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3664%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200710221535.l9MFZXtW026120%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3664 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Oct 22 17:35:33 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000933.html">[Avidemux-svn-commit] r3663 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
</A></li>
        <LI>Next message: <A HREF="000935.html">[Avidemux-svn-commit] r3665 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialogFactory ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#934">[ date ]</a>
              <a href="thread.html#934">[ thread ]</a>
              <a href="subject.html#934">[ subject ]</a>
              <a href="author.html#934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2007-10-22 17:35:19 +0200 (Mon, 22 Oct 2007)
New Revision: 3664

Added:
   branches/avidemux_2.4_branch/avidemux/gui_action.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/Makefile.am
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[Win32] remove std::string from common headers to eliminate utf-8 conflict on Win32

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -13,7 +13,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include &quot;default.h&quot;
 
 #include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
 #include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
@@ -29,8 +28,7 @@
 diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
                          const char * defaultSuffix,const char *selectFileDesc)
   : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix),
-    paramIsStdString (false)
+    defaultSuffix (defaultSuffix)
 {
   param=(void *)filename;
   paramTitle=toggleTitle;
@@ -43,23 +41,6 @@
   _write=writemode;
 }
 
-diaElemFile::diaElemFile(uint32_t writemode,std::string *filename,const char *toggleTitle,
-                         const char * defaultSuffix,const char *selectFileDesc)
-  : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix),
-    paramIsStdString (true)
-{
-  param=(void *)filename;
-  paramTitle=toggleTitle;
-
-  if (!tip || strlen(tip) == 0)
-	  this-&gt;tip = toggleTitle;
-  else
-      this-&gt;tip = selectFileDesc;
-
-  _write=writemode;
-}
-
 diaElemFile::~diaElemFile()
 {
 GtkWidget **wid=(GtkWidget **)myWidget;
@@ -96,12 +77,8 @@
   gtk_widget_show (entry);
   if(param)
   {
-      const char * val;
-      if (paramIsStdString)
-          val = ((std::string *)param)-&gt;c_str();
-      else
-          val = *((char **)param);
-      gtk_entry_set_text (GTK_ENTRY (entry), val);
+      char **val=(char **)param;
+      gtk_entry_set_text (GTK_ENTRY (entry), *val);
   }
   gtk_label_set_mnemonic_widget (GTK_LABEL(label), entry);
   
@@ -136,17 +113,9 @@
 void diaElemFile::getMe(void)
 {
   GtkWidget **widget=(GtkWidget **)myWidget;
-  const char * val = gtk_entry_get_text (GTK_ENTRY (widget[0]));
-  if (paramIsStdString)
-  {
-      *((std::string *)param) = val;
-  }
-  else
-  {
-      char **name=(char **)param;
-      if(*name) delete [] *name;
-      *name = ADM_strdup(val);
-  }
+  char **name=(char **)param;
+  if(*name) delete *name;
+  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
 }
 
 void diaElemFile::changeFile(void)
@@ -192,17 +161,10 @@
   }
   if(t)
   {
-    if (paramIsStdString)
-    {
-        *((std::string *)param) = buffer;
-    }
-    else
-    {
-        char **name=(char **)param;
-        if(*name) delete [] *name;
-        *name = ADM_strdup(buffer);
-    }
-    gtk_entry_set_text (GTK_ENTRY (widget), buffer);
+    char **name=(char **)param;
+    if(*name) delete [] *name;
+    *name =ADM_strdup(buffer);
+     gtk_entry_set_text (GTK_ENTRY (widget), *name);
   }
   
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -171,13 +171,6 @@
  
 }
 
-diaElemFile::diaElemFile(uint32_t write,std::string * filename,const char *toggleTitle,
-                         const char *defaultSuffix, const char *tip)
-  : diaElem(ELEM_FILE_READ)
-{
- 
-}
-
 diaElemFile::~diaElemFile()
 {
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -141,8 +141,7 @@
 diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
                          const char *defaultSuffix,const char *selectFileDesc)
   : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix),
-    paramIsStdString (false)
+    defaultSuffix (defaultSuffix)
 {
   param=(void *)filename;
   paramTitle=shortkey(toggleTitle);
@@ -155,23 +154,6 @@
   _write=writemode;
 }
 
-diaElemFile::diaElemFile(uint32_t writemode,std::string *filename,const char *toggleTitle,
-                         const char * defaultSuffix,const char *selectFileDesc)
-  : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix),
-    paramIsStdString (true)
-{
-  param=(void *)filename;
-  paramTitle=shortkey(toggleTitle);
-
-  if (!selectFileDesc || strlen(selectFileDesc) == 0)
-	  tip = toggleTitle;
-  else
-      tip = selectFileDesc;
-
-  _write=writemode;
-}
-
 diaElemFile::~diaElemFile()
 {
   if(paramTitle)
@@ -181,32 +163,21 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
  ADM_Qfilesel *fs;
- const char * val;
- if (paramIsStdString)
-     val = ((std::string *)param)-&gt;c_str();
- else
-     val = *((const char **)param);
   if(_write)
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, val, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
   else
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, val, layout, line,ADM_FILEMODE_READ, 0, tip);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_READ, 0, tip);
   myWidget=(void *)fs; 
 }
 void diaElemFile::getMe(void)
 {
+  
+  char **n=(char **)param;
+  if(*n) ADM_dealloc(*n);
+  
   ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
   QString s=(fs-&gt;edit)-&gt;text();
-  const char * val = s.toLatin1();
-  if (paramIsStdString)
-  {
-      *((std::string *)param) = val;
-  }
-  else
-  {
-      char **n=(char **)param;
-      if(*n) ADM_dealloc(*n);
-      *n=ADM_strdup(val);
-  }
+  *n=ADM_strdup( s.toLatin1() );
 }
 void diaElemFile::enable(uint32_t onoff)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-10-22 15:35:19 UTC (rev 3664)
@@ -17,7 +17,6 @@
 #define DIA_FACTORY_H
 
 #include &quot;ADM_assert.h&quot;
-#include &lt;string&gt;
 
 typedef enum 
 {
@@ -331,13 +330,10 @@
 
 protected:
     const char * defaultSuffix;
-    bool paramIsStdString;
 public:
   
   diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,
               const char *defaultSuffix = 0,const char *tip=NULL);
-  diaElemFile(uint32_t writeMode,std::string *filename,const char *toggleTitle,
-              const char *defaultSuffix = 0,const char *tip=NULL);
   virtual ~diaElemFile() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -11,29 +11,10 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#include &lt;config.h&gt;
 
-
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;math.h&gt;
-#include &quot;ADM_lavcodec.h&quot;
 #include &quot;default.h&quot;
-#include &quot;ADM_colorspace/ADM_rgb.h&quot;
-
-#include &quot;ADM_image.h&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
-#include &quot;DIA_flyAsharp.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+
 /**
       \fn DIA_lavDecoder
       \brief Dialog for lavcodec *DECODER* option

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h	2007-10-22 15:35:19 UTC (rev 3664)
@@ -20,9 +20,6 @@
  #ifndef __CONFCOUPLE__
  #define __CONFCOUPLE__
 
-#include &lt;string&gt;
-
-
 class CONFcouple
 {
 	private:
@@ -39,7 +36,6 @@
 			uint8_t setCouple(const char *name,int32_t value);
 			uint8_t setCouple(const char *name,const char *value);
 			uint8_t setCouple(const char *name,const ADM_filename *value);
-			uint8_t setCouple(const char *name,const std::string &amp; value);
 			uint8_t setCouple(const char *name,double value);
 			uint8_t setCouple(const char *name,float value);
 
@@ -47,7 +43,6 @@
 			uint8_t getCouple(const char *name,uint32_t *value);
 			uint8_t getCouple(const char *name,char **value);
 			uint8_t getCouple(const char *name,ADM_filename **value);
-			uint8_t getCouple(const char *name,std::string *value);
 			uint8_t getCouple(const char *name,double *value);
 			uint8_t getCouple(const char *name,float *value);
 			uint32_t getNumber(void) { return nb;};

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -19,7 +19,7 @@
 
 #include &quot;fourcc.h&quot;
 #include &quot;avio.hxx&quot;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 #include &quot;ADM_video/ADM_confCouple.h&quot;
 static char tmpstring[1024]; // should be enougth
@@ -109,17 +109,7 @@
 	cur++;
 	return 1;
 }
-uint8_t CONFcouple::setCouple(const char *myname,const std::string &amp; val)
-{
-	ADM_assert(cur&lt;nb);
 
-	name[cur]=ADM_strdup(myname);
-	value[cur]=ADM_strdup(val.c_str());
-	cur++;
-	return 1;
-}
-
-
 uint8_t CONFcouple::getCouple(const char *myname,uint32_t *val)
 {
 	int32_t index=lookupName(myname);
@@ -156,15 +146,7 @@
 	*val=(ADM_filename *)ADM_strdup(value[index]);
 	return 1;
 }
-uint8_t CONFcouple::getCouple(const char *myname,std::string *val)
-{
-	int32_t index=lookupName(myname);
 
-	ADM_assert(index!=-1);
-	ADM_assert(index&lt;(int)nb);
-	*val=value[index];
-	return 1;
-}
 uint8_t CONFcouple::getCouple(const char *myname,float *val)
 {
 	int32_t index=lookupName(myname);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-10-22 15:35:19 UTC (rev 3664)
@@ -17,7 +17,7 @@
  
 #define ADM_FILTER_API_VERSION 1
 /**
-	Not for filter writters :
+	Note for filter writers :
 
 		The constructor accept 2 parameters
 
@@ -26,7 +26,7 @@
 						&quot;size&quot; &quot;13&quot; for example. Passing null means either
 						it has no parameters or set the default value for them.
 
-				_uncompressed : optionnal internal buffer
+				_uncompressed : optional internal buffer
 
 				configure return 1 if the conf has changed, 0 else.
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -74,7 +74,8 @@
         GET(bottom_crop);
         GET(output_format);
 
-        GET(output_file);
+		char* tmp;
+        GET2(output_file, tmp);
         GET(camera_number);
         GET(debug);
     }
@@ -99,7 +100,6 @@
     ADM_assert(_param);
     *couples = new CONFcouple(particleParam.nb);
 
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
     CSET(min_area);
     CSET(max_area);
     CSET(left_crop);
@@ -107,7 +107,7 @@
     CSET(top_crop);
     CSET(bottom_crop);
     CSET(output_format);
-    CSET(output_file);
+	(*couples)-&gt;setCouple(&quot;output_file&quot;, _param-&gt;output_file.c_str());
     CSET(camera_number);
     CSET(debug);
 
@@ -168,8 +168,10 @@
         (&amp;(_param-&gt;bottom_crop),
          QT_TR_NOOP(&quot;_Bottom crop (ignore particles in):&quot;), 0, 0x7fffffff);
 
+	char* file = ADM_strdup(_param-&gt;output_file.c_str());
+
     diaElemFile output_file
-        (1, &amp;(_param-&gt;output_file), QT_TR_NOOP(&quot;_Output File:&quot;), NULL, QT_TR_NOOP(&quot;Select file&quot;));
+        (1, &amp;file, QT_TR_NOOP(&quot;_Output File:&quot;), NULL, QT_TR_NOOP(&quot;Select file&quot;));
 
     diaElemUInteger camera_number
         (&amp;(_param-&gt;camera_number), QT_TR_NOOP(&quot;_Camera number:&quot;), 1, 0x7fffffff);
@@ -183,6 +185,10 @@
 
     ret = diaFactoryRun (&quot;Particle Detection Configuration&quot;,
                          sizeof (elems) / sizeof (diaElem *), elems);
+
+	_param-&gt;output_file = file;
+	delete[] file;
+
     return ret;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -108,7 +108,8 @@
         GET(tool);
         GET(input_type);
 
-        GET(input_file);
+		char* tmp;
+        GET2(input_file, tmp);
         GET(load_bias);
         GET(load_multiplier);
 
@@ -229,11 +230,10 @@
     if (myInfo-&gt;oldConf == 0)
         pimap.erase (0);
 
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
     CSET(tool);
     CSET(input_type);
 
-    CSET(input_file);
+    (*couples)-&gt;setCouple(&quot;input_file&quot;, _param-&gt;input_file.c_str());
     CSET(load_bias);
     CSET(load_multiplier);
 
@@ -315,8 +315,10 @@
         ADM_assert (ret == 255); // 255 = whizzy dialog not implemented
     }
 
+	char* file = ADM_strdup(_param-&gt;input_file.c_str());
+
     diaElemFile input_file
-        (0, &amp;(_param-&gt;input_file),
+        (0, &amp;file,
          QT_TR_NOOP(&quot;Input _File (image or convolution kernel):&quot;), NULL, QT_TR_NOOP(&quot;Select file&quot;));
     diaElemFloat load_bias
         (&amp;(_param-&gt;load_bias),
@@ -383,6 +385,10 @@
         myInfo-&gt;image_data_invalid = true;
         myInfo-&gt;histogram_data_invalid = true;
     }
+
+	_param-&gt;input_file = file;
+	delete[] file;
+
     return ret;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-10-22 15:35:19 UTC (rev 3664)
@@ -4,7 +4,7 @@
 #  It is not for the faint of heart and pretty ugly
 #
 ##########################################################
-SET(adm_EXE_SRCS ADM_preview.cpp  gtk_gui.cpp  gui_autodrive.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp)
+SET(adm_EXE_SRCS ADM_preview.cpp  gtk_gui.cpp  gui_autodrive.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp  gui_action.cpp)
 
 include_directories(ADM_userInterfaces/ADM_commonUI ADM_outputs)
 add_definitions(${GLIB_CFLAGS})

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-10-22 15:35:19 UTC (rev 3664)
@@ -61,7 +61,7 @@
 
 adm_src =   guiplay.cpp  \
 	gui_savenew.cpp  gui_navigate.cpp gtk_gui.cpp   \
-	main.cpp   \
+	main.cpp   gui_action.cpp  \
 	gui_autodrive.cpp GUI_jobs.cpp ADM_preview.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -20,13 +20,11 @@
 #include &lt;stdlib.h&gt;
 #include &lt;math.h&gt;
 
-
 #include &lt;time.h&gt;
 #include &lt;sys/time.h&gt;
 #include &lt;fcntl.h&gt;	/* O_RDONLY */
 #include &lt;errno.h&gt;
 #include &lt;glib.h&gt;
-
     
 #include &quot;ADM_lavcodec.h&quot;
 
@@ -38,7 +36,6 @@
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_toolkit/bitmap.h&quot;
 
-
 #include &quot;ADM_audio/aviaudio.hxx&quot;
 #include &quot;ADM_audio/audioex.h&quot;
 #include &quot;ADM_audiofilter/audioprocess.hxx&quot;
@@ -169,133 +166,6 @@
 extern void A_jog(void);
 extern void DIA_glyphEdit(void);
 
-struct ActionNameNum
-{
-    const Action num;
-    const char * const name;
-};
-
-// The getActionName() function assumes that the following array is sorted by
-// action number, and further that it can be indexed by action number based on
-// the action number of the first entry.
-
-const ActionNameNum action_names [] =
-{
-#define ACT(_name) { ACT_ ## _name, # _name },
-#include &quot;gui_action.names&quot;
-#undef ACT
-    //   { ACT_INVALID, 0 }
-};
-
-const int ACTION_NAME_COUNT = sizeof (action_names) / sizeof (action_names[0]);
-
-// One might think to use a map here, instead of a vector (and in fact I did),
-// but Scott Meyers in _Effective STL_ advises (in item 23) that it is more
-// efficient to use a sorted vector when we are doing a bunch of insertions
-// followed by mostly (in our case exclusively) lookups.
-
-#include &lt;vector&gt;
-using std::vector;
-#include &lt;utility&gt;
-using std::pair;
-using std::make_pair;
-#include &lt;iterator&gt;
-using std::back_inserter;
-#include &lt;algorithm&gt;
-using std::transform;
-using std::sort;
-using std::equal_range;
-
-typedef pair &lt;const char *, Action&gt; ActionNamePair;
-typedef vector &lt;ActionNamePair&gt; ActionNameVec;
-typedef ActionNameVec::iterator ActionNameIter;
-
-class ActionNameCompare
-{
-public:
-    bool operator () (const ActionNamePair &amp; lhs, // for sorting
-                      const ActionNamePair &amp; rhs) const
-    {
-        return doLess (lhs.first, rhs.first);
-    }
-
-    bool operator () (const ActionNamePair &amp; lhs, // for lookups 1
-                      const ActionNamePair::first_type &amp; rhs) const
-    {
-        return doLess (lhs.first, rhs);
-    }
-
-    bool operator () (const ActionNamePair::first_type &amp; lhs, // for lookups 2
-                      const ActionNamePair &amp; rhs) const
-    {
-        return doLess (lhs, rhs.first);
-    }
-
-private:
-
-    bool doLess (const ActionNamePair::first_type &amp; lhs,
-                 const ActionNamePair::first_type &amp; rhs) const
-    {
-        return (strcasecmp (lhs, rhs) &lt; 0);
-    }
-};
-
-class MakeActionNamePair
-{
-public:
-    ActionNamePair operator () (const ActionNameNum &amp; ann)
-    {
-        return make_pair (ann.name, ann.num);
-    }
-};
-
-static ActionNameVec action_name_vec;
-
-void initActionNameVec (void)
-{
-    action_name_vec.reserve (ACTION_NAME_COUNT);
-    transform (action_names, action_names + ACTION_NAME_COUNT,
-               back_inserter (action_name_vec), MakeActionNamePair());
-    sort (action_name_vec.begin(), action_name_vec.end(),
-          ActionNameCompare());
-}
-
-Action lookupActionByName (const char * name)
-{
-    if (action_name_vec.empty())
-        initActionNameVec();
-
-    pair &lt;ActionNameIter, ActionNameIter&gt; range
-        = equal_range (action_name_vec.begin(),
-                       action_name_vec.end(), name,
-                       ActionNameCompare());
-    if (range.first == range.second)
-        return ACT_INVALID;
-    else
-        return range.first-&gt;second;
-}
-
-const char * getActionName (Action act)
-{
-    uint32_t index = act - action_names [0].num;
-    return (action_names [index].name);
-}
-
-void dumpActionNames (const char * filename)
-{
-    if (action_name_vec.empty())
-        initActionNameVec();
-
-    printf (&quot;# Action names (which can be used in %s, &quot;
-            &quot;though some should not be):\n&quot;, filename);
-    ActionNameIter it = action_name_vec.begin();
-    while (it != action_name_vec.end())
-    {
-        printf (&quot;#     %s\n&quot;, it-&gt;first);
-        ++it;
-    }
-}
-
 //___________________________________________
 // serialization of user event through gui
 //

Added: branches/avidemux_2.4_branch/avidemux/gui_action.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.cpp	2007-10-20 17:15:18 UTC (rev 3663)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.cpp	2007-10-22 15:35:19 UTC (rev 3664)
@@ -0,0 +1,129 @@
+#include &lt;stdio.h&gt;
+#include &lt;vector&gt;
+using std::vector;
+#include &lt;utility&gt;
+using std::pair;
+using std::make_pair;
+#include &lt;iterator&gt;
+using std::back_inserter;
+#include &lt;algorithm&gt;
+using std::transform;
+using std::sort;
+using std::equal_range;
+
+#include &quot;gui_action.hxx&quot;
+
+struct ActionNameNum
+{
+    const Action num;
+    const char * const name;
+};
+
+// The getActionName() function assumes that the following array is sorted by
+// action number, and further that it can be indexed by action number based on
+// the action number of the first entry.
+
+const ActionNameNum action_names [] =
+{
+#define ACT(_name) { ACT_ ## _name, # _name },
+#include &quot;gui_action.names&quot;
+#undef ACT
+    //   { ACT_INVALID, 0 }
+};
+
+const int ACTION_NAME_COUNT = sizeof (action_names) / sizeof (action_names[0]);
+
+// One might think to use a map here, instead of a vector (and in fact I did),
+// but Scott Meyers in _Effective STL_ advises (in item 23) that it is more
+// efficient to use a sorted vector when we are doing a bunch of insertions
+// followed by mostly (in our case exclusively) lookups.
+
+typedef pair &lt;const char *, Action&gt; ActionNamePair;
+typedef vector &lt;ActionNamePair&gt; ActionNameVec;
+typedef ActionNameVec::iterator ActionNameIter;
+
+class ActionNameCompare
+{
+public:
+    bool operator () (const ActionNamePair &amp; lhs, // for sorting
+                      const ActionNamePair &amp; rhs) const
+    {
+        return doLess (lhs.first, rhs.first);
+    }
+
+    bool operator () (const ActionNamePair &amp; lhs, // for lookups 1
+                      const ActionNamePair::first_type &amp; rhs) const
+    {
+        return doLess (lhs.first, rhs);
+    }
+
+    bool operator () (const ActionNamePair::first_type &amp; lhs, // for lookups 2
+                      const ActionNamePair &amp; rhs) const
+    {
+        return doLess (lhs, rhs.first);
+    }
+
+private:
+
+    bool doLess (const ActionNamePair::first_type &amp; lhs,
+                 const ActionNamePair::first_type &amp; rhs) const
+    {
+        return (strcasecmp (lhs, rhs) &lt; 0);
+    }
+};
+
+class MakeActionNamePair
+{
+public:
+    ActionNamePair operator () (const ActionNameNum &amp; ann)
+    {
+        return make_pair (ann.name, ann.num);
+    }
+};
+
+static ActionNameVec action_name_vec;
+
+void initActionNameVec (void)
+{
+    action_name_vec.reserve (ACTION_NAME_COUNT);
+    transform (action_names, action_names + ACTION_NAME_COUNT,
+               back_inserter (action_name_vec), MakeActionNamePair());
+    sort (action_name_vec.begin(), action_name_vec.end(),
+          ActionNameCompare());
+}
+
+Action lookupActionByName (const char * name)
+{
+    if (action_name_vec.empty())
+        initActionNameVec();
+
+    pair &lt;ActionNameIter, ActionNameIter&gt; range
+        = equal_range (action_name_vec.begin(),
+                       action_name_vec.end(), name,
+                       ActionNameCompare());
+    if (range.first == range.second)
+        return ACT_INVALID;
+    else
+        return range.first-&gt;second;
+}
+
+const char * getActionName (Action act)
+{
+    uint32_t index = act - action_names [0].num;
+    return (action_names [index].name);
+}
+
+void dumpActionNames (const char * filename)
+{
+    if (action_name_vec.empty())
+        initActionNameVec();
+
+    printf (&quot;# Action names (which can be used in %s, &quot;
+            &quot;though some should not be):\n&quot;, filename);
+    ActionNameIter it = action_name_vec.begin();
+    while (it != action_name_vec.end())
+    {
+        printf (&quot;#     %s\n&quot;, it-&gt;first);
+        ++it;
+    }
+}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000933.html">[Avidemux-svn-commit] r3663 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
</A></li>
	<LI>Next message: <A HREF="000935.html">[Avidemux-svn-commit] r3665 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialogFactory ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#934">[ date ]</a>
              <a href="thread.html#934">[ thread ]</a>
              <a href="subject.html#934">[ subject ]</a>
              <a href="author.html#934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
