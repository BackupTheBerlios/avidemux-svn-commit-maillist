<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4427 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_UIs/ADM_CLI/src ADM_UIs/ADM_GTK/src	ADM_UIs/ADM_QT4/include ADM_UIs/ADM_QT4/src ADM_core/include	ADM_core/src ADM_coreUI/include ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui xpm
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4427%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_UIs/ADM_CLI/src%20ADM_UIs/ADM_GTK/src%0A%09ADM_UIs/ADM_QT4/include%20ADM_UIs/ADM_QT4/src%20ADM_core/include%0A%09ADM_core/src%20ADM_coreUI/include%20ADM_userInterfaces/ADM_QT4%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20xpm&In-Reply-To=%3C200810010943.m919hX4m002372%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001666.html">
   <LINK REL="Next"  HREF="001668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4427 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_UIs/ADM_CLI/src ADM_UIs/ADM_GTK/src	ADM_UIs/ADM_QT4/include ADM_UIs/ADM_QT4/src ADM_core/include	ADM_core/src ADM_coreUI/include ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui xpm</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4427%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_UIs/ADM_CLI/src%20ADM_UIs/ADM_GTK/src%0A%09ADM_UIs/ADM_QT4/include%20ADM_UIs/ADM_QT4/src%20ADM_core/include%0A%09ADM_core/src%20ADM_coreUI/include%20ADM_userInterfaces/ADM_QT4%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20xpm&In-Reply-To=%3C200810010943.m919hX4m002372%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4427 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_UIs/ADM_CLI/src ADM_UIs/ADM_GTK/src	ADM_UIs/ADM_QT4/include ADM_UIs/ADM_QT4/src ADM_core/include	ADM_core/src ADM_coreUI/include ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui xpm">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Oct  1 11:43:33 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001666.html">[Avidemux-svn-commit] r4426 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_UIs/ADM_QT4/include avidemux/ADM_UIs/ADM_QT4/src	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics	avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4	plugins/ADM_videoFilters/ASharp/qt4	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/ChromaShift/qt4	plugins/ADM_videoFilters/Contrast/qt4	plugins/ADM_videoFilters/Crop/qt4 plugins/ADM_videoFilters/Eq2/qt4	plugins/ADM_videoFilters/Hue/qt4	plugins/ADM_videoFilters/MplayerResize/qt4	plugins/ADM_videoFilters/Srt/qt4 po
</A></li>
        <LI>Next message: <A HREF="001668.html">[Avidemux-svn-commit] r4428 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/src avidemux/ADM_coreUI/include	avidemux/ADM_userInterfaces/ADM_GTK	avidemux/ADM_userInterfaces/ADM_NONE	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_audioEncoders/lame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1667">[ date ]</a>
              <a href="thread.html#1667">[ thread ]</a>
              <a href="subject.html#1667">[ subject ]</a>
              <a href="author.html#1667">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-10-01 11:42:52 +0200 (Wed, 01 Oct 2008)
New Revision: 4427

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h
   branches/avidemux_2.5_branch_gruntster/avidemux/xpm/avidemux.ico
   branches/avidemux_2.5_branch_gruntster/avidemux/xpm/avidemux.o
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_CLI/src/FAC_toggle.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_filesel.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bar.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_button.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_float.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_frame.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_hex.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_integer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_matrix.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_menu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_notch.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_readOnlyText.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_slider.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_threadCount.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_toggle.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_bar.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_float.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_frame.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_hex.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_integer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_matrix.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_readOnlyText.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_button.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_assert.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_misc.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factoryStubs.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/button_mapping
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_savenew.cpp
Log:
[Merge] integrate changes from 2.4 branch (r4398)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_CLI/src/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_CLI/src/FAC_toggle.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_CLI/src/FAC_toggle.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -52,6 +52,8 @@
 
 }
 
+int diaElemToggle::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 diaElemInteger::diaElemInteger(int32_t *intValue,const char *toggleTitle, int32_t min, int32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -75,6 +77,8 @@
   
 }
 void diaElemInteger::enable(uint32_t onoff) {}
+int diaElemInteger::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -94,6 +98,8 @@
  
 }
 void diaElemUInteger::enable(uint32_t onoff) {}
+int diaElemUInteger::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 
 diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, 
@@ -115,6 +121,8 @@
  
 }
 void diaElemFloat::enable(uint32_t onoff) {}
+int diaElemFloat::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 
 diaElemBar::diaElemBar(uint32_t percent,const char *toggleTitle)
@@ -135,6 +143,8 @@
  
 }
 
+int diaElemBar::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 
 diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -163,6 +173,9 @@
 void diaElemMenu::finalize(void)
 { 
 }
+
+int diaElemMenu::getRequiredLayout(void) { return 0; }
+
 void   diaElemMenu::updateMe(void)
 {
 }
@@ -195,6 +208,9 @@
 {
   
 }
+
+int diaElemFile::getRequiredLayout(void) { return 0; }
+
 diaElemBitrate::~diaElemBitrate()
 {
   
@@ -208,6 +224,9 @@
 {
  
 }
+
+int diaElemBitrate::getRequiredLayout(void) { return 0; }
+
 void diaElemFile::changeFile(void)
 {
 }
@@ -234,6 +253,8 @@
  
 }
 
+int diaElemReadOnlyText::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
   : diaElem(ELEM_NOTCH)
@@ -251,6 +272,8 @@
 }
  void diaElemNotch::getMe(void) {};
 
+int diaElemNotch::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip)  : diaElemDirSelectBase() {}
 diaElemDirSelect::~diaElemDirSelect() {}
@@ -259,6 +282,7 @@
   
 void diaElemDirSelect::changeFile(void) {}
 void   diaElemDirSelect::enable(uint32_t onoff){}
+int diaElemDirSelect::getRequiredLayout(void) { return 0; }
 //******************************************************
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
     : diaElem(ELEM_NOTCH) {}
@@ -266,7 +290,7 @@
 void diaElemText::setMe(void *dialog, void *opaque,uint32_t line) {}
 void diaElemText::getMe(void) {}  
 void diaElemText::enable(uint32_t onoff) {};
-            
+int diaElemText::getRequiredLayout(void) { return 0; }
 //******************************************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
@@ -296,6 +320,8 @@
 void diaElemMenuDynamic::finalize(void)
 { 
 }
+int diaElemMenuDynamic::getRequiredLayout(void) { return 0; }
+
 //******************************************************
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
   : diaElemFrameBase()
@@ -325,6 +351,8 @@
 void diaElemFrame::finalize(void)
 {
 }
+
+int diaElemFrame::getRequiredLayout(void) { return 0; }
 //**************************
 
   
@@ -333,6 +361,7 @@
   void diaElemHex::setMe(void *dialog, void *opaque,uint32_t line) {};
   void diaElemHex::getMe(void) {} ;
   void diaElemHex::finalize(void) {};
+  int diaElemHex::getRequiredLayout(void) { return 0; }
 //**************************
 diaElemToggleUint::diaElemToggleUint(uint32_t *toggleValue,const char *toggleTitle, uint32_t *uintval, const char *name,uint32_t min,uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE_UINT)
@@ -365,6 +394,9 @@
 {
    
 }
+
+int diaElemToggleUint::getRequiredLayout(void) { return 0; }
+
 //**************************
 diaElemToggleInt::diaElemToggleInt(uint32_t *toggleValue,const char *toggleTitle, int32_t *uintval, const char *name,int32_t min,int32_t max,const char *tip)
   :diaElem(ELEM_TOGGLE_INT)
@@ -384,6 +416,9 @@
 {
   
 }
+
+int diaElemToggleInt::getRequiredLayout(void) { return 0; }
+
 void   diaElemToggleInt::finalize(void)
 {
 }
@@ -413,6 +448,9 @@
 {
 
 }
+
+int diaElemButton::getRequiredLayout(void) { return 0; }
+
 //***
 #if 0
  template &lt;typename T&gt;
@@ -441,6 +479,9 @@
   {
   }
   
+template &lt;typename T&gt;
+int diaElemGenericSlider&lt;T&gt;::getRequiredLayout(void) { return 0; }
+
  template class diaElemGenericSlider &lt;int32_t&gt;;
  template class diaElemGenericSlider &lt;uint32_t&gt;;
  template class diaElemGenericSlider &lt;ELEM_TYPE_FLOAT&gt;;
@@ -468,6 +509,7 @@
  {
  }
 
+int diaElemMatrix::getRequiredLayout(void) { return 0; }
 
 
 //***
@@ -475,5 +517,6 @@
 diaElemThreadCount::~diaElemThreadCount() {}
 void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line) {}
 void diaElemThreadCount::getMe(void) {}
+int diaElemThreadCount::getRequiredLayout(void) { return 0; }
 
 //EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_filesel.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_filesel.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -33,6 +33,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 class diaElemDirSelect : public diaElemDirSelectBase
 {
@@ -46,6 +47,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 static void fileRead(void *w,void *p);
 static void dirSel(void *w,void *p);
@@ -206,6 +208,8 @@
      gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
 }
 
+int diaElemFile::getRequiredLayout(void) { return 0; }
+
 void fileRead(void *w,void *p)
 {
   diaElemFile *me=(diaElemFile *)p;
@@ -335,6 +339,8 @@
 
 }
 
+int diaElemDirSelect::getRequiredLayout(void) { return 0; }
+
 void dirSel(void *w,void *p)
 {
   diaElemDirSelect *me=(diaElemDirSelect *)p;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bar.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bar.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bar.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -27,6 +27,7 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 diaElemBar::diaElemBar(uint32_t percent,const char *toggleTitle)
@@ -73,6 +74,8 @@
 {
   
 }
+
+int diaElemBar::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -29,6 +29,7 @@
   void setMaxQz(uint32_t qz);
   void setMinQz(uint32_t qz);
   void updateMe(void);
+  int getRequiredLayout(void);
 };
 
 static void cb_mod(void *w,void *p);
@@ -257,6 +258,9 @@
   }
   memcpy(param,&amp;copy,sizeof(copy));
 }
+
+int diaElemBitrate::getRequiredLayout(void) { return 0; }
+
 void diaElemBitrate::updateMe(void)
 {
   // Read current value

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_button.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_button.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_button.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -31,6 +31,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
@@ -74,6 +75,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
 
+int diaElemButton::getRequiredLayout(void) { return 0; }
+
 void cb_button (GtkWidget *widget,gpointer callback_data)
 {
   diaElemButton *button=(diaElemButton *)callback_data;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_float.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_float.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_float.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -31,6 +31,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, 
@@ -98,6 +99,8 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemFloat::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_frame.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_frame.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -29,6 +29,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
   : diaElemFrameBase()
@@ -115,6 +116,8 @@
    GtkWidget *widget=(GtkWidget *)myWidget;
    gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemFrame::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -128,4 +131,3 @@
 	delete a;
 }
 //EOF
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_hex.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_hex.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_hex.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -29,6 +29,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 
 #define HEX_NB_LINE   8
@@ -226,6 +227,8 @@
 
 };
 
+int diaElemHex::getRequiredLayout(void) { return 0; }
+
 } // End of namespace
 //****************************Hoook*****************
 
@@ -239,6 +242,3 @@
 	delete a;
 }
 //EOF
-
-
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_integer.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_integer.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -30,6 +30,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -42,6 +43,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 
@@ -114,6 +116,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 
+int diaElemInteger::getRequiredLayout(void) { return 0; }
+
 //**********************************************************************************
 
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
@@ -186,6 +190,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 
+int diaElemUInteger::getRequiredLayout(void) { return 0; }
+
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_matrix.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_matrix.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_matrix.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -28,6 +28,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
@@ -128,6 +129,8 @@
 			  gtk_widget_set_sensitive( GTK_WIDGET(arrayWidget[index++]),onoff);
 		  }
 }
+
+int diaElemMatrix::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_menu.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_menu.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -37,6 +37,7 @@
   virtual void      updateMe(void);
   virtual void      enable(uint32_t onoff) ;
   virtual void      finalize(void);
+  int getRequiredLayout(void);
 };
 //**********************
 class diaElemMenu : public diaElemMenuBase
@@ -56,7 +57,8 @@
   virtual uint8_t   link(diaMenuEntry *entry,uint32_t onoff,diaElem *w);
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
-  void      finalize(void);;
+  void      finalize(void);
+  int getRequiredLayout(void);
 };
 //**********************
 diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -116,6 +118,9 @@
 {
   dyna-&gt;finalize();
 }
+
+int diaElemMenu::getRequiredLayout(void) { return 0; }
+
 //*******************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
@@ -249,6 +254,9 @@
 {
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
+
+int diaElemMenuDynamic::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu(void *w,void *p)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_notch.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_notch.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_notch.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -29,6 +29,7 @@
   virtual ~diaElemNotch() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) {};
+  int getRequiredLayout(void);
 };
 
 
@@ -71,7 +72,8 @@
                     (GtkAttachOptions) (0), 0, 0);
   
 }
-//****************************************************
+
+int diaElemNotch::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_readOnlyText.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_readOnlyText.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -27,7 +27,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 
 class diaElemText : public diaElem
@@ -40,6 +40,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 
@@ -90,6 +91,9 @@
  
   
 }
+
+int diaElemReadOnlyText::getRequiredLayout(void) { return 0; }
+
 /***************************************************************/
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_ROTEXT)
@@ -148,6 +152,8 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemText::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_slider.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_slider.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_slider.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -32,6 +32,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 class diaElemSlider : public diaElemSliderBase
@@ -46,8 +47,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  
-  
+  int getRequiredLayout(void);
 };
 
 //****************************************************
@@ -137,6 +137,9 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemSlider::getRequiredLayout(void) { return 0; }
+
 //********************** USLIDER***********
 
 
@@ -224,6 +227,9 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemUSlider::getRequiredLayout(void) { return 0; }
+
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_threadCount.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_threadCount.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_threadCount.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -29,6 +29,7 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 static void customToggled(void *widget, void *userData);
@@ -137,6 +138,8 @@
 	}
 }
 
+int diaElemThreadCount::getRequiredLayout(void) { return 0; }
+
 void customToggled(void *widget, void *userData)
 {
 	diaElemThreadCount *elem = (diaElemThreadCount*)userData;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_toggle.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_toggle.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -30,6 +30,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 
 class diaElemToggleUint : public diaElem
@@ -48,6 +49,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 class diaElemToggleInt : public diaElem
 {
@@ -65,6 +67,7 @@
   void      finalize(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 static void cb_menu(void *w,void *p);
@@ -156,6 +159,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
 
+int diaElemToggle::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu(void *w,void *p)
 {
@@ -251,6 +256,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(wuint),onoff);
 }
 
+int diaElemToggleUint::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu2(void *w,void *p)
 {
@@ -321,6 +328,8 @@
   if(*emb&gt;_max) *emb=_max;
 }
 
+int diaElemToggleInt::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu3(void *w,void *p)
 {

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -0,0 +1,2 @@
+#define FAC_QT_GRIDLAYOUT 1
+#define FAC_QT_VBOXLAYOUT 2
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_bar.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_bar.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_bar.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -35,6 +36,7 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -69,6 +71,8 @@
 void diaElemBar::getMe(void)
 {
 }
+
+int diaElemBar::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // nameapsce
 
 diaElem  *qt4CreateBar(uint32_t percent,const char *toggleTitle)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_float.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_float.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_float.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -38,6 +39,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
@@ -61,18 +63,23 @@
 {
   QDoubleSpinBox *box=new QDoubleSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
  box-&gt;setValue(*(ELEM_TYPE_FLOAT *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
+ layout-&gt;addLayout(hboxLayout,line,1);
  
 }
 void diaElemFloat::getMe(void)
@@ -94,6 +101,8 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemFloat::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_frame.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_frame.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -38,6 +39,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
@@ -66,18 +68,42 @@
 
 void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
 {
-	QGridLayout *layout = (QGridLayout*)opaque;
+	QVBoxLayout *layout = (QVBoxLayout*)opaque;
 	QGroupBox *groupBox = new QGroupBox(QString::fromUtf8(paramTitle));
-	QGridLayout *layout2 = new QGridLayout(groupBox);
-	int v = 0;
+	QVBoxLayout *vboxlayout = new QVBoxLayout(groupBox);
+	QLayout *layout2 = NULL;
+	int currentLayout = 0;
+	int v;
 
 	for (int i = 0; i &lt; nbElems; i++)
 	{
+		if (elems[i]-&gt;getRequiredLayout() != currentLayout)
+		{
+			if (layout2)
+				vboxlayout-&gt;addLayout(layout2);
+
+			switch (elems[i]-&gt;getRequiredLayout())
+			{
+				case FAC_QT_GRIDLAYOUT:
+					layout2 = new QGridLayout();
+					break;
+				case FAC_QT_VBOXLAYOUT:
+					layout2 = new QVBoxLayout();
+					break;
+			}
+
+			currentLayout = elems[i]-&gt;getRequiredLayout();
+			v = 0;
+		}
+
 		elems[i]-&gt;setMe(groupBox, layout2, v); 
 		v += elems[i]-&gt;getSize();
 	}
 
-	layout-&gt;addWidget(groupBox, line, 0);
+	if (layout2)
+		vboxlayout-&gt;addLayout(layout2);
+
+	layout-&gt;addWidget(groupBox);
 }
 
 //*****************************
@@ -99,6 +125,8 @@
 {
   
 }
+
+int diaElemFrame::getRequiredLayout(void) { return FAC_QT_VBOXLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_hex.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_hex.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_hex.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -16,6 +16,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 namespace ADM_qt4Factory
 {
@@ -31,6 +32,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 extern const char *shortkey(const char *);
   diaElemHex::diaElemHex(const char *toggleTitle, uint32_t dataSize,uint8_t *data) :diaElem(ELEM_HEXDUMP){};
@@ -38,6 +40,7 @@
   void diaElemHex::setMe(void *dialog, void *opaque,uint32_t line) {};
   void diaElemHex::getMe(void) {} ;
   void diaElemHex::finalize(void) {};
+  int diaElemHex::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 //******************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_integer.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_integer.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -48,7 +50,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
-  
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -71,19 +73,24 @@
 {
   QSpinBox *box=new QSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
  box-&gt;setValue(*(int32_t *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+ text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
- 
+ layout-&gt;addLayout(hboxLayout,line,1);
 }
 void diaElemInteger::getMe(void)
 {
@@ -104,6 +111,9 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemInteger::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -125,18 +135,24 @@
 {
   QSpinBox *box=new QSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
  box-&gt;setValue(*(uint32_t *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+ text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
+ layout-&gt;addLayout(hboxLayout,line,1);
 }
 void diaElemUInteger::getMe(void)
 {
@@ -158,6 +174,9 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemUInteger::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //********************************************
 //****************************************************
 } // End of namespace

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_matrix.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_matrix.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_matrix.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
@@ -118,6 +120,8 @@
 				  
 			  }
 }
+
+int diaElemMatrix::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 }
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -19,6 +19,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -35,6 +36,7 @@
   virtual ~diaElemNotch() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) {};
+  int getRequiredLayout(void);
 };
 diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
   : diaElem(ELEM_NOTCH)
@@ -60,8 +62,8 @@
  box-&gt;show();
  layout-&gt;addWidget(box,line,0);
 }
-//******************************************************
-//****************************************************
+
+int diaElemNotch::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -75,5 +77,3 @@
 	delete a;
 }
 //EOF
-
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_readOnlyText.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_readOnlyText.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -35,7 +36,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 
 class diaElemText : public diaElem
@@ -48,6 +49,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -84,6 +86,9 @@
 
  
 }
+
+int diaElemReadOnlyText::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //*********************************
 
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
@@ -133,6 +138,8 @@
   else
     lineEdit-&gt;setDisabled(TRUE);
 }
+
+int diaElemText::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -156,5 +163,3 @@
 	delete a;
 }
 //EOF
-
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -16,6 +16,7 @@
 #include &quot;T_bitrate.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -30,16 +31,16 @@
   void getMe(void);
   void setMaxQz(uint32_t qz);
   void setMinQz(uint32_t qz);
-  
+  int getRequiredLayout(void);
   void updateMe(void);
 };
 
-ADM_Qbitrate::ADM_Qbitrate(QWidget *z,COMPRES_PARAMS *p,uint32_t minQ, uint32_t mq,QGridLayout *layout,int line) : QWidget(z) 
+ADM_Qbitrate::ADM_Qbitrate(COMPRES_PARAMS *p,uint32_t minQ, uint32_t mq,QGridLayout *layout,int line)
 {
 	compress=p;
-	combo=new QComboBox(z);
+	combo=new QComboBox();
 
-	_minQ = minQ;
+	_minQ=minQ;
 	maxQ=mq;
 	int index=0,set=-1;
 #define add(x,z,y) if(compress-&gt;capabilities &amp; ADM_ENC_CAP_##x) {combo-&gt;addItem(QString::fromUtf8(y));\
@@ -53,31 +54,39 @@
 	add(2PASS,2PASS,QT_TR_NOOP(&quot;Two Pass - Video Size&quot;));
 	add(2PASS_BR,2PASS_BITRATE,QT_TR_NOOP(&quot;Two Pass - Average Bitrate&quot;));
 
-	combo-&gt;show();
-
-	text1=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Encoding mode&quot;)),z);
+	text1=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Encoding mode&quot;)));
 	text1-&gt;setBuddy(combo);
-	text1-&gt;show();
 
-	box=new QSpinBox(z);
-	box-&gt;show();
+	box=new QSpinBox();
 
-	text2=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Bitrate&quot;)),z);
+	text2=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Bitrate&quot;)));
 	text2-&gt;setBuddy(combo);
 
+	QHBoxLayout *hboxLayout = new QHBoxLayout();
+	QHBoxLayout *hboxLayout2 = new QHBoxLayout();
+	QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+	QSpacerItem *spacer2 = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+	hboxLayout-&gt;addWidget(combo);
+	hboxLayout-&gt;addItem(spacer);
+
 	layout-&gt;addWidget(text1,line,0);
-	layout-&gt;addWidget(combo,line,1);
+	layout-&gt;addItem(hboxLayout,line,1);
 
+	hboxLayout2-&gt;addWidget(box);
+	hboxLayout2-&gt;addItem(spacer2);
+
 	layout-&gt;addWidget(text2,line+1,0);
-	layout-&gt;addWidget(box,line+1,1);
+	layout-&gt;addItem(hboxLayout2,line+1,1);
 
 	if(set!=-1) 
 	{
 		combo-&gt;setCurrentIndex(set);
 		comboChanged(set);
 	}
+	connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
 
-	QObject::connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
+
 }
 
 /**
@@ -201,22 +210,13 @@
   maxQ=qz; 
 }
 
-diaElemBitrate::~diaElemBitrate()
-{
-  ADM_assert(myWidget);
-#if 0 // Automatically deleted as it is a child of main dialog
-  ADM_Qbitrate *z=(ADM_Qbitrate *)myWidget;
-  
-  if(z) delete z;
+diaElemBitrate::~diaElemBitrate() {};
 
-  myWidget=NULL;
-#endif
-}
 void diaElemBitrate::setMe(void *dialog, void *opaque,uint32_t line)
 {
   QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qbitrate *b=new ADM_Qbitrate( (QWidget *)dialog,(COMPRES_PARAMS *)&amp;copy,minQ,maxQ,layout,line);
+  ADM_Qbitrate *b=new ADM_Qbitrate((COMPRES_PARAMS *)&amp;copy,minQ,maxQ,layout,line);
   myWidget=(void *)b;
   
 }
@@ -226,6 +226,7 @@
   memcpy(param,&amp;copy,sizeof(copy));
 }
 
+int diaElemBitrate::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -26,7 +26,7 @@
 		COMPRES_PARAMS  *compress;
 		uint32_t        maxQ, _minQ;
 
-		ADM_Qbitrate(QWidget *z, COMPRES_PARAMS *p, uint32_t minQ, uint32_t mq, QGridLayout *layout, int line);
+		ADM_Qbitrate(COMPRES_PARAMS *p, uint32_t minQ, uint32_t mq, QGridLayout *layout, int line);
 		virtual ~ADM_Qbitrate();
 		void readBack(void);
 	};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_button.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_button.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_button.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -15,6 +15,7 @@
 
 #include &quot;T_button.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 namespace ADM_Qt4Factory
@@ -30,6 +31,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 ADM_Qbutton::ADM_Qbutton(QWidget *z,QGridLayout *layout,const char *blah,int line,ADM_FAC_CALLBACK *cb, void *cookie) : QWidget(z) 
@@ -86,6 +88,8 @@
 
 }
 
+int diaElemButton::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 }; // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -23,6 +23,7 @@
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;DIA_coreUI_internal.h&quot;
 #include &quot;ADM_toolkitQt.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 static void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab);
 
@@ -46,16 +47,38 @@
   QSpacerItem *spacer = new QSpacerItem(20, 16, QSizePolicy::Minimum, QSizePolicy::Fixed);
   QDialogButtonBox *buttonBox = new QDialogButtonBox();
   QVBoxLayout *vboxLayout = new QVBoxLayout();
-  QGridLayout *layout = new QGridLayout();
+  QLayout *layout = NULL;
+  int currentLayout = 0;
 
  int  v=0;
-  for(int i=0;i&lt;nb;i++)
-  {
-    ADM_assert(elems[i]);
-     elems[i]-&gt;setMe( (void *)&amp;dialog,layout,v); 
-     v+=elems[i]-&gt;getSize();
-    
-  }
+
+ for(int i=0;i&lt;nb;i++)
+ {
+	 ADM_assert(elems[i]);
+
+	 if (elems[i]-&gt;getRequiredLayout() != currentLayout)
+	 {
+		 if (layout)
+			 vboxLayout-&gt;addLayout(layout);
+
+		 switch (elems[i]-&gt;getRequiredLayout())
+		 {
+			 case FAC_QT_GRIDLAYOUT:
+				 layout = new QGridLayout();
+				 break;
+			 case FAC_QT_VBOXLAYOUT:
+				 layout = new QVBoxLayout();
+				 break;
+		 }
+
+		 currentLayout = elems[i]-&gt;getRequiredLayout();
+		 v = 0;
+	 }
+
+	 elems[i]-&gt;setMe( (void *)&amp;dialog,layout,v);
+	 v+=elems[i]-&gt;getSize();
+ }
+
    for(int i=0;i&lt;nb;i++)
   {
     ADM_assert(elems[i]);
@@ -68,7 +91,9 @@
    QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
    QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
 
-   vboxLayout-&gt;addLayout(layout);
+   if (layout)
+	   vboxLayout-&gt;addLayout(layout);
+
    vboxLayout-&gt;addItem(spacer);
    vboxLayout-&gt;addWidget(buttonBox);
 
@@ -145,6 +170,11 @@
 
 	 dialog.setLayout(vboxLayout);
 
+	 // Expand to see all tabs but still allow the window to be resized smaller
+	 wtabs-&gt;setUsesScrollButtons(false);
+	 dialog.adjustSize();
+	 wtabs-&gt;setUsesScrollButtons(true);
+
   if(dialog.exec()==QDialog::Accepted)
   {
       // Read tabs
@@ -172,9 +202,11 @@
 void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab)
 {
 
-  QWidget *wid=new QWidget;
-  QGridLayout *layout=new QGridLayout(wid);
+  QWidget *wid=new QWidget;  
   QSpacerItem *spacerItem = new QSpacerItem(20, 40, QSizePolicy::Minimum, QSizePolicy::Expanding);
+  int currentLayout = 0;
+  QVBoxLayout *vboxLayout = new QVBoxLayout(wid);
+  QLayout *layout = NULL;
   
   /* First compute the size of our window */
   int vsize=0;
@@ -184,14 +216,34 @@
      vsize+=tab-&gt;dias[i]-&gt;getSize(); 
   }
 
- int  v=0;
-  for(int i=0;i&lt;tab-&gt;nbElems;i++)
-  {
-     ADM_assert(tab-&gt;dias[i]);
-     tab-&gt;dias[i]-&gt;setMe( wid,layout,v); 
-     v+=tab-&gt;dias[i]-&gt;getSize();
-    
-  }
+	int  v=0;
+
+	for(int i=0;i&lt;tab-&gt;nbElems;i++)
+	{
+		ADM_assert(tab-&gt;dias[i]);
+
+		if (tab-&gt;dias[i]-&gt;getRequiredLayout() != currentLayout)
+		{
+			if (layout)
+				vboxLayout-&gt;addLayout(layout);
+
+			switch (tab-&gt;dias[i]-&gt;getRequiredLayout())
+			{
+				case FAC_QT_GRIDLAYOUT:
+					layout = new QGridLayout();
+					break;
+				case FAC_QT_VBOXLAYOUT:
+					layout = new QVBoxLayout();
+					break;
+			}
+
+			currentLayout = tab-&gt;dias[i]-&gt;getRequiredLayout();
+			v = 0;
+		}
+
+		tab-&gt;dias[i]-&gt;setMe( wid,layout,v); 
+		v+=tab-&gt;dias[i]-&gt;getSize();
+	}
   
   wtab-&gt;addTab(wid,QString::fromUtf8(tab-&gt;title));
   for(int i=0;i&lt;tab-&gt;nbElems;i++)
@@ -199,7 +251,10 @@
     tab-&gt;dias[i]-&gt;finalize(); 
   }
 
-  layout-&gt;addItem(spacerItem, v, 0);
+  if (layout)
+	  vboxLayout-&gt;addLayout(layout);
+
+  vboxLayout-&gt;addItem(spacerItem);
 }
 
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -18,6 +18,7 @@
 //#include &quot;prefs.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;DIA_fileSel.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 void GUI_FileSelRead(const char *label, char * * name);
@@ -40,6 +41,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 class diaElemDirSelect : public diaElemDirSelectBase
 {
@@ -53,6 +55,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 void ADM_Qfilesel::buttonPressed(QAbstractButton *s)
@@ -106,18 +109,14 @@
 	}
 }
 
-ADM_Qfilesel::ADM_Qfilesel(QWidget *z,const char *title,const char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc) : 
-	QWidget(z), defaultSuffix (defaultSuffix), selectDesc (selectDesc)
+ADM_Qfilesel::ADM_Qfilesel(const char *title,const char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc) : 
+	defaultSuffix (defaultSuffix), selectDesc (selectDesc)
 {          
 	fileMode=mode;
-	edit=new QLineEdit(QString::fromUtf8(entry),z);
+	edit=new QLineEdit(QString::fromUtf8(entry));
+	button=new QDialogButtonBox(QDialogButtonBox::Open,Qt::Horizontal);
+	text=new QLabel(QString::fromUtf8(title));
 
-	edit-&gt;show();
-
-	button=new QDialogButtonBox(QDialogButtonBox::Open,Qt::Horizontal,z);
-	button-&gt;show();
-
-	text=new QLabel(QString::fromUtf8(title),z);
 	text-&gt;setBuddy(edit);
 	layout-&gt;addWidget(text,line,0);
 	layout-&gt;addWidget(edit,line,1);
@@ -163,9 +162,9 @@
  QGridLayout *layout=(QGridLayout*) opaque;
  ADM_Qfilesel *fs;
   if(_write)
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
+      fs=new ADM_Qfilesel(paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
   else
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_READ, 0, tip);
+      fs=new ADM_Qfilesel(paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_READ, 0, tip);
   myWidget=(void *)fs; 
 }
 
@@ -181,10 +180,18 @@
 
 void diaElemFile::enable(uint32_t onoff)
 {
-  ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
-  fs-&gt;setEnabled(onoff);
+	ADM_Qfilesel *fs = (ADM_Qfilesel*)myWidget;
+
+	ADM_assert(fs);
+
+	fs-&gt;text-&gt;setEnabled(onoff);
+	fs-&gt;edit-&gt;setEnabled(onoff);
+	fs-&gt;button-&gt;setEnabled(onoff);
 }
 void diaElemFile::changeFile(void) {}
+
+int diaElemFile::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //****************************
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *selectDirDesc) :
 	diaElemDirSelectBase()
@@ -208,7 +215,7 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog, paramTitle, *(char **)param, layout, line, ADM_FILEMODE_DIR, 0, tip);
+  ADM_Qfilesel *fs=new ADM_Qfilesel(paramTitle, *(char **)param, layout, line, ADM_FILEMODE_DIR, 0, tip);
   myWidget=(void *)fs; 
 }
 
@@ -222,9 +229,20 @@
   *n=ADM_strdup(s.toUtf8().constData());
 }
 
-void diaElemDirSelect::enable(uint32_t onoff) {}
-  
+void diaElemDirSelect::enable(uint32_t onoff)
+{
+	ADM_Qfilesel *fs = (ADM_Qfilesel*)myWidget;
+
+	ADM_assert(fs);
+
+	fs-&gt;text-&gt;setEnabled(onoff);
+	fs-&gt;edit-&gt;setEnabled(onoff);
+	fs-&gt;button-&gt;setEnabled(onoff);
+}
+
 void diaElemDirSelect::changeFile(void) {}
+
+int diaElemDirSelect::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -249,5 +267,3 @@
 	delete a;
 }
 //EOF
-
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_filesel.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -32,7 +32,7 @@
 		const char *defaultSuffix;
 		const char *selectDesc;
 
-		ADM_Qfilesel(QWidget *z, const char *title, const char *entry, QGridLayout *layout, int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc);
+		ADM_Qfilesel(const char *title, const char *entry, QGridLayout *layout, int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc);
 		~ADM_Qfilesel();
 	};
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -15,6 +15,7 @@
 
 #include &quot;T_menu.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QLabel&gt;
@@ -40,11 +41,12 @@
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
   void      finalize(void);;
+  int getRequiredLayout(void);
 };
 
 /**/
 
-ADM_QComboBox::ADM_QComboBox(QWidget *root,diaElemMenuDynamic *menu) : QComboBox(root)
+ADM_QComboBox::ADM_QComboBox(diaElemMenuDynamic *menu)
 {
 	_menu=menu;
 }
@@ -117,6 +119,9 @@
 {
   dyna-&gt;finalize();
 }
+
+int diaElemMenu::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //*********************************
 //* DYNAMIC                       *
 //*********************************
@@ -140,11 +145,15 @@
 }
 void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
 {
-  ADM_QComboBox *combo=new ADM_QComboBox( (QWidget *)dialog,this);
+  ADM_QComboBox *combo=new ADM_QComboBox(this);
+
   QGridLayout *layout=(QGridLayout*) opaque;
      myWidget=(void *)combo; 
 
-	 QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+	 QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle));
+	 text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
+
+	 QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
   
   // Fill in combobox
   int mem=0;
@@ -158,6 +167,7 @@
    text-&gt;setBuddy(combo);
    layout-&gt;addWidget(text,line,0);
    layout-&gt;addWidget(combo,line,1);
+   layout-&gt;addItem(spacer,line,2);
    
    combo-&gt;connectMe();
 }
@@ -236,7 +246,8 @@
 {
   finalize();
 }
-//********************
+
+int diaElemMenuDynamic::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 }; // End of namespace
 
 diaElem  *qt4CreateMenu(uint32_t *intValue,const char *itle, uint32_t nb,         const diaMenuEntry *menu,const char *tip)
@@ -260,5 +271,3 @@
 }
 
 //EOF
-
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_menu.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -1,13 +1,13 @@
-#ifndef T_menu_h
-#define T_menu_h
-
-#include &lt;QtGui/QComboBox&gt;
-
-#include &quot;ADM_inttype.h&quot;
-#include &quot;DIA_factory.h&quot;
-
+#ifndef T_menu_h
+#define T_menu_h
+
+#include &lt;QtGui/QComboBox&gt;
+
+#include &quot;ADM_inttype.h&quot;
+#include &quot;DIA_factory.h&quot;
+
 namespace ADM_qt4Factory
-{
+{
 	class diaElemMenuDynamic : public diaElemMenuDynamicBase
 	{
 	public:
@@ -20,8 +20,9 @@
 		virtual void      updateMe(void);
 		virtual void      enable(uint32_t onoff) ;
 		virtual void      finalize(void);
-	};
-
+		int getRequiredLayout(void);
+	};
+
 	class ADM_QComboBox : public QComboBox
 	{
 		Q_OBJECT
@@ -33,8 +34,8 @@
 		diaElemMenuDynamic *_menu;
 
 	public:
-		ADM_QComboBox(QWidget *root,diaElemMenuDynamic *menu);
+		ADM_QComboBox(diaElemMenuDynamic *menu);
 		void connectMe(void);
-	};
-}
-#endif	// T_menu_h
+	};
+}
+#endif	// T_menu_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -16,6 +16,7 @@
 #include &quot;T_slider.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QHBoxLayout&gt;
@@ -35,6 +36,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 class diaElemSlider : public diaElemSliderBase
@@ -49,8 +51,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  
-  
+  int getRequiredLayout(void);
 };
 
 int SpinSlider::value()
@@ -149,6 +150,8 @@
     box-&gt;setDisabled(1);
 }
 
+int diaElemUSlider::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 diaElemSlider::diaElemSlider(int32_t *value,const char *toggleTitle, int32_t min,int32_t max,int32_t incr,const char *tip)
   : diaElemSliderBase()
 {
@@ -204,6 +207,7 @@
     box-&gt;setDisabled(1);
 }
 
+int diaElemSlider::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_slider.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -1,12 +1,12 @@
-#ifndef T_slider_h
-#define T_slider_h
-
-#include &lt;QtGui/QSlider&gt;
-#include &lt;QtGui/QSpinBox&gt;
-#include &lt;QtGui/QWidget&gt;
-
+#ifndef T_slider_h
+#define T_slider_h
+
+#include &lt;QtGui/QSlider&gt;
+#include &lt;QtGui/QSpinBox&gt;
+#include &lt;QtGui/QWidget&gt;
+
 namespace ADM_qt4Factory
-{
+{
 	class SpinSlider : public QWidget
 	{
 		Q_OBJECT
@@ -26,6 +26,6 @@
 	private:
 		QSlider * slider;
 		QSpinBox * spinner;
-	};
-}
-#endif	// T_slider_h
+	};
+}
+#endif	// T_slider_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -16,6 +16,7 @@
 #include &quot;T_threadCount.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char* shortkey(const char*);
 
@@ -31,6 +32,7 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 void ADM_QthreadCount::radioGroupChanged(QAbstractButton *s)
@@ -130,6 +132,9 @@
 	else
 		*val = (threadCount-&gt;spinBox)-&gt;value();
 }
+
+int diaElemThreadCount::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //**********************
 } // End of namesapce
 //**********************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -19,6 +19,7 @@
 #include &quot;T_toggle.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 
 class diaElemToggleUint : public diaElem
@@ -54,6 +56,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 class diaElemToggleInt : public diaElem
 {
@@ -71,6 +74,7 @@
   void      finalize(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 void ADM_QCheckBox::changed(int i)
@@ -120,14 +124,14 @@
 void diaElemToggle::setMe(void *dialog, void *opaque,uint32_t l)
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE);
- QGridLayout *layout=(QGridLayout*) opaque;
+ QVBoxLayout *layout=(QVBoxLayout*) opaque;
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,l,0);
+
+ layout-&gt;addWidget(box);
  box-&gt;connectMe();
 }
 void diaElemToggle::getMe(void)
@@ -192,6 +196,9 @@
     nbLink++;
     return 1;
 }
+
+int diaElemToggle::getRequiredLayout(void) { return FAC_QT_VBOXLAYOUT; }
+
 //******************************************************
 // An UInt and a toggle linked...
 //******************************************************
@@ -217,13 +224,13 @@
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE_UINT);
  QGridLayout *layout=(QGridLayout*) opaque;
+ QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,line,0);
+
  // Now add spin
  QSpinBox *spin=new QSpinBox((QWidget *)dialog);
  widgetUint=(void *)spin; 
@@ -231,8 +238,14 @@
  spin-&gt;setMinimum(_min);
  spin-&gt;setMaximum(_max);
  spin-&gt;setValue(*(uint32_t *)emb);
- spin-&gt;show();
- layout-&gt;addWidget(spin,line,1);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(spin);
+ hboxLayout-&gt;addItem(spacer);
+
+ layout-&gt;addWidget(box,line,0);
+ layout-&gt;addLayout(hboxLayout,line,1);
  box-&gt;connectMe();
 }
 
@@ -290,6 +303,8 @@
   }
 }
 
+int diaElemToggleUint::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //******************************************************
 // An Int and a toggle linked...
 //******************************************************
@@ -315,13 +330,13 @@
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE_INT);
  QGridLayout *layout=(QGridLayout*) opaque;
+ QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,line,0);
+
  // Now add spin
  QSpinBox *spin=new QSpinBox((QWidget *)dialog);
  widgetUint=(void *)spin; 
@@ -329,8 +344,14 @@
  spin-&gt;setMinimum(_min);
  spin-&gt;setMaximum(_max);
  spin-&gt;setValue(*emb);
- spin-&gt;show();
- layout-&gt;addWidget(spin,line,1);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(spin);
+ hboxLayout-&gt;addItem(spacer);
+
+ layout-&gt;addWidget(box,line,0);
+ layout-&gt;addLayout(hboxLayout,line,1);
  box-&gt;connectMe();
 }
 
@@ -352,6 +373,8 @@
  *emb=u;
 }
 
+int diaElemToggleInt::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 void   diaElemToggleInt::finalize(void)
 {
   updateMe();

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_toggle.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -1,18 +1,18 @@
-#ifndef T_toggle_h
-#define T_toggle_h
-
-#include &lt;QtGui/QCheckBox&gt;
-#include &lt;QtGui/QWidget&gt;
-
+#ifndef T_toggle_h
+#define T_toggle_h
+
+#include &lt;QtGui/QCheckBox&gt;
+#include &lt;QtGui/QWidget&gt;
+
 namespace ADM_qt4Factory
-{
+{
 	typedef enum
 	{
 		TT_TOGGLE,
 		TT_TOGGLE_UINT,
 		TT_TOGGLE_INT
-	} TOG_TYPE;
-
+	} TOG_TYPE;
+
 	class ADM_QCheckBox : public QCheckBox
 	{
 		Q_OBJECT
@@ -27,6 +27,6 @@
 	public:
 		ADM_QCheckBox(const QString &amp; str, QWidget *root, void *toggle, TOG_TYPE type);
 		void connectMe(void);
-	};
-}
-#endif	// T_toggle_h
+	};
+}
+#endif	// T_toggle_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_assert.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_assert.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_assert.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -106,12 +106,16 @@
         #define LLX &quot;I64x&quot;
         #define LLU &quot;I64u&quot;
         
-		char *ADM_slashToBackSlash(const char *in);
-        #define ADM_cleanupPath(x) ADM_slashToBackSlash(x)
+		extern char *ADM_backSlashToForward(const char *in);
+		extern char *ADM_forwardSlashToBack(const char *in);
+
+        #define ADM_cleanupPath(x) ADM_backSlashToForward(x)
+		#define ADM_fixupPath(x) ADM_forwardSlashToBack(x)
 #else
         #define LLX &quot;llx&quot;
         #define LLU &quot;llu&quot;
         #define ADM_cleanupPath(x) ADM_strdup(x)
+		#define ADM_fixupPath(x) ADM_strdup(x)
 #endif
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_misc.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_misc.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_misc.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -236,7 +236,7 @@
     This function convert the later to the former
 
 */
-extern char *ADM_slashToBackSlash(const char *in)
+char *ADM_backSlashToForward(const char *in)
 {
     char *out,*cout;
     int n;
@@ -251,6 +251,23 @@
     return cout;
     
 }
+
+char *ADM_forwardSlashToBack(const char *in)
+{
+    char *out,*cout;
+    int n;
+    n=strlen(in);
+    cout=out=(char *)ADM_alloc(n+1);   
+    for(int i=0;i&lt;n+1;i++)
+    {
+        if(   in[i]=='/') out[i]='\\';
+        else    out[i]=in[i];
+        
+    }
+    return cout;
+    
+}
+
 /*
     
 */

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -79,6 +79,7 @@
           
   virtual void enable(uint32_t onoff) {}
   virtual void finalize(void) {} // in case some widget needs some stuff just before using them
+  virtual int getRequiredLayout(void)=0;
 };
 /*********************************************/
 #define MENU_MAX_lINK 10
@@ -106,6 +107,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
@@ -122,6 +124,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /************************************/
 class diaElemSliderBase : public diaElem
@@ -148,6 +151,7 @@
   void      getMe(void);
   void      enable(uint32_t onoff) ;
   uint8_t   setDigits(uint32_t digits) ;
+  int getRequiredLayout(void);
 };
 class diaElemSlider : public diaElemSliderBase
 {
@@ -162,7 +166,7 @@
   void      getMe(void);
   void      enable(uint32_t onoff) ;
   uint8_t   setDigits(uint32_t digits) ;
-  
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *CREATE_TOGGLE(uint32_t *toggleValue,const char *toggleTitle, const char *tip);
@@ -191,6 +195,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *CREATE_TOGGLE_UINT(uint32_t *toggleValue,const char *toggleTitle, uint32_t *uintval, 
@@ -211,6 +216,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 typedef diaElem *CREATE_TOGGLE_INT(uint32_t *toggleValue,const char *toggleTitle, int32_t *intval, 
 									const char *name,int32_t min,int32_t max,const char *tip=NULL);
@@ -228,6 +234,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      finalize(void);
+  int getRequiredLayout(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
 };
@@ -244,6 +251,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -256,7 +264,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
-  
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem  *(CREATE_BAR_T)(uint32_t percent,const char *toggleTitle);
@@ -271,6 +279,7 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
@@ -287,6 +296,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef struct diaMenuEntry
@@ -357,6 +367,7 @@
   virtual void      updateMe(void);
   virtual void      enable(uint32_t onoff) ;
   virtual void      finalize(void);
+  int getRequiredLayout(void);
 };
 
 class diaElemMenuBase : public diaElem
@@ -387,6 +398,7 @@
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
   void      finalize(void);;
+  int getRequiredLayout(void);
 };
 
 /*************************************************/
@@ -417,6 +429,7 @@
   void setMinQz(uint32_t qz);
   
   void updateMe(void);
+  int getRequiredLayout(void);
 };
 #endif
 /*************************************************/
@@ -449,6 +462,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem *CREATE_DIR_T(char **filename,const char *toggleTitle,const char *tip);
@@ -473,6 +487,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 /*************************************************/
 /* The text MUST be copied internally ! */
@@ -486,7 +501,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem *(CREATE_TEXT_T )(char **readOnly,const char *toggleTitle, const char *tip);
@@ -501,6 +516,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
@@ -514,6 +530,7 @@
   virtual ~diaElemNotch() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *(CREATE_TAB_T )(const char *toggleTitle, uint32_t nb, diaElem **content);
@@ -562,6 +579,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 /**********************************************/
 typedef diaElem *(CREATE_HEX_T )(const char *toggleTitle, uint32_t dataSize,uint8_t *data);
@@ -577,6 +595,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 /**********************************************/
 typedef diaElem *(CREATE_THREADCOUNT_T)(uint32_t *value, const char *title, const char *tip = NULL);
@@ -589,6 +608,7 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factoryStubs.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factoryStubs.h	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factoryStubs.h	2008-10-01 09:42:52 UTC (rev 4427)
@@ -27,6 +27,10 @@
 	{ \
 	ADM_assert(internalPointer); \
 	internalPointer-&gt;getMe(); \
+	} \
+int      aClass::getRequiredLayout(void)\
+	{ \
+	ADM_assert(internalPointer); \
+	return internalPointer-&gt;getRequiredLayout(); \
 	} 
-
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -22,7 +22,7 @@
 {
 	ui.setupUi(this);
 
-	ui.licenseTextEdit-&gt;setHtml(QT_TR_NOOP(&quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD HTML 4.01 Transitional//EN\&quot;&gt;&quot; \
+	ui.licenseTextEdit-&gt;setHtml(QString::fromUtf8(QT_TR_NOOP(&quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD HTML 4.01 Transitional//EN\&quot;&gt;&quot; \
 	&quot;&quot; \
 	&quot;&lt;html&gt;&quot; \
 	&quot;&lt;head&gt;&quot; \
@@ -693,7 +693,7 @@
 	&quot;    &lt;span style='font-size:10.0pt; font-family:Arial'&gt; &lt;/span&gt;&lt;/p&gt;&quot; \
 	&quot;  &lt;/div&gt;&quot; \
 	&quot;&lt;/body&gt;&quot; \
-	&quot;&lt;/html&gt;&quot;));
+	&quot;&lt;/html&gt;&quot;)));
 }
 
 uint8_t DIA_license(void)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -43,9 +43,9 @@
         qpel=!!(info &amp; ADM_QPEL_ON);
         gmc=!!(info &amp; ADM_GMC_ON);
 
-#define FILLTEXT(a,b,c) {snprintf(text,79,b,c);ui.a-&gt;setText(text);}
-#define FILLTEXT4(a,b,c,d) {snprintf(text,79,b,c,d);ui.a-&gt;setText(text);}
-#define FILLTEXT5(a,b,c,d,e) {snprintf(text,79,b,c,d,e);ui.a-&gt;setText(text);}
+#define FILLTEXT(a,b,c) {snprintf(text,79,b,c);ui.a-&gt;setText(QString::fromUtf8(text));}
+#define FILLTEXT4(a,b,c,d) {snprintf(text,79,b,c,d);ui.a-&gt;setText(QString::fromUtf8(text));}
+#define FILLTEXT5(a,b,c,d,e) {snprintf(text,79,b,c,d,e);ui.a-&gt;setText(QString::fromUtf8(text));}
         
         FILLTEXT4(labeImageSize,QT_TR_NOOP(&quot;%lu x %lu&quot;), avifileinfo-&gt;width,avifileinfo-&gt;height);
         FILLTEXT(labelFrameRate, QT_TR_NOOP(&quot;%2.3f fps&quot;), (float) avifileinfo-&gt;fps1000 / 1000.F);
@@ -56,14 +56,14 @@
                 frame2time(avifileinfo-&gt;nb_frames, avifileinfo-&gt;fps1000,
                           &amp;hh, &amp;mm, &amp;ss, &amp;ms);
                 snprintf(text,79, QT_TR_NOOP(&quot;%02d:%02d:%02d.%03d&quot;), hh, mm, ss, ms);
-                ui.labelVideoDuration-&gt;setText(text);
+                ui.labelVideoDuration-&gt;setText(QString::fromUtf8(text));
           }
         war=video_body-&gt;getPARWidth();
         har=video_body-&gt;getPARHeight();
         getAspectRatioFromAR(war,har, &amp;s);
-        FILLTEXT5(LabelAspectRatio,QT_TR_NOOP(&quot;%s (%u:%u)&quot;), s,war,har);
+		FILLTEXT5(LabelAspectRatio,QT_TR_NOOP(&quot;%s (%u:%u)&quot;), s,war,har);
 #define SET_YES(a,b) ui.a-&gt;setText(yesno[b])
-#define FILLQT_TR_NOOP(q) ui.q-&gt;setText(text);
+#define FILLQT_TR_NOOP(q) ui.q-&gt;setText(QString::fromUtf8(text));
         SET_YES(LabelPackedBitstream,vop);
         SET_YES(LabelQuarterPixel,qpel);
         SET_YES(LabelGMC,gmc);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -445,11 +445,11 @@
   
   for (uint32_t i = 0; i &lt; vec.size(); i++)
     {
-          QString str = QString(&quot;&lt;b&gt;&quot;) + vec[i]-&gt;name + QString(&quot;&lt;/b&gt;&lt;br&gt;\n&lt;small&gt;&quot;) + vec[i]-&gt;description + QString(&quot;&lt;/small&gt;&quot;);
+		QString str = QString(&quot;&lt;b&gt;&quot;) + QString::fromUtf8(vec[i]-&gt;name) + QString(&quot;&lt;/b&gt;&lt;br&gt;\n&lt;small&gt;&quot;) + QString::fromUtf8(vec[i]-&gt;description) + QString(&quot;&lt;/small&gt;&quot;);
          
           QListWidgetItem *item;
           item=new QListWidgetItem(str,availableList,ALL_FILTER_BASE+i+family*100);
-          item-&gt;setToolTip(vec[i]-&gt;description);
+          item-&gt;setToolTip(QString::fromUtf8(vec[i]-&gt;description));
           availableList-&gt;addItem(item);
      }
 
@@ -612,7 +612,7 @@
 				++conf;
 		}
 
-		QString str = QString(&quot;&lt;b&gt;&quot;) + name + QString(&quot;&lt;/b&gt;&lt;br&gt;\n&lt;small&gt;&quot;) + conf + QString(&quot;&lt;/small&gt;&quot;);
+		QString str = QString(&quot;&lt;b&gt;&quot;) + QString::fromUtf8(name) + QString(&quot;&lt;/b&gt;&lt;br&gt;\n&lt;small&gt;&quot;) + QString::fromUtf8(conf) + QString(&quot;&lt;/small&gt;&quot;);
 		QListWidgetItem *item=new QListWidgetItem(str,activeList,ACTIVE_FILTER_BASE+i);
 		activeList-&gt;addItem(item);
 	}
@@ -727,4 +727,3 @@
         return diaFactoryRun(QT_TR_NOOP(&quot;Partial Video Filter&quot;),3,tabs);
 }
 //EOF
-

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -740,7 +740,7 @@
 	printf(&quot;Found %d format(s)\n&quot;,nbFormat);
 	for(uint32_t i=0;i&lt;nbFormat;i++)
 	{
-		WIDGET(comboBoxFormat)-&gt;addItem(QT_TR_NOOP(ADM_allOutputFormat[i].text));	
+		WIDGET(comboBoxFormat)-&gt;addItem(QString::fromUtf8(QT_TR_NOOP(ADM_allOutputFormat[i].text)));	
 	}
 
 }
@@ -858,7 +858,7 @@
 
 	}
 	sprintf(string,QT_TR_NOOP(&quot;%c (%02d)&quot;),c,qp);
-	WIDGET(label_8)-&gt;setText(string);	
+	WIDGET(label_8)-&gt;setText(QString::fromUtf8(string));
 
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -69,9 +69,10 @@
 
 		if (!fileName.isNull() )
 		{
-			const char *s = fileName.toUtf8().constData();
-			*name = ADM_strdup(s);
-			prefs-&gt;set(pref_entry, (ADM_filename*)*name);
+			fileName = QDir::toNativeSeparators(fileName);
+			const char *s=fileName.toUtf8().constData();
+			*name=ADM_strdup(s);
+			prefs-&gt;set(pref_entry,(ADM_filename *)*name);
 		}
 
 		if (str)
@@ -136,8 +137,9 @@
 
 		if (!fileName.isNull())
 		{
-			const char *s = fileName.toUtf8().constData();
-			strncpy(target, s, max);
+			fileName = QDir::toNativeSeparators(fileName);
+			const char *s=fileName.toUtf8().constData();
+			strncpy(target,s,max);
 
 			return 1;
 		}
@@ -167,8 +169,9 @@
 
 		if (!fileName.isNull())
 		{
-			const char *s = fileName.toUtf8().constData();
-			strncpy(target, s, max);
+			fileName = QDir::toNativeSeparators(fileName);
+			const char *s=fileName.toUtf8().constData();
+			strncpy(target,s,max);
 
 			return 1;
 		}
@@ -198,9 +201,9 @@
 
 		if (!fileName.isNull())
 		{
-			const char *s = fileName.toUtf8().constData();
-			strncpy(target, s, max);
-
+			fileName = QDir::toNativeSeparators(fileName);
+			const char *s=fileName.toUtf8().constData();
+			strncpy(target,s,max);
 			return 1;
 		}
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -47,9 +47,9 @@
 	{
 		QByteArray translatedMessage = QApplication::translate(&quot;&quot;, __msgid).toUtf8();
 		int copyLength = translatedMessage.length() + 1;
-		char* buffer = new char[translatorLoaded ? translatedMessage.length() + 1 : MAX_UNLOADED_MSG_LENGTH + 1];
+		char* buffer = new char[translatorLoaded ? copyLength : MAX_UNLOADED_MSG_LENGTH + 1];
 
-		if (copyLength &gt; MAX_UNLOADED_MSG_LENGTH + 1)
+		if (!translatorLoaded &amp;&amp; copyLength &gt; MAX_UNLOADED_MSG_LENGTH + 1)
 		{
 			copyLength = MAX_UNLOADED_MSG_LENGTH;
 			buffer[MAX_UNLOADED_MSG_LENGTH] = '\0';

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-10-01 09:42:52 UTC (rev 4427)
@@ -434,14 +434,14 @@
 
 	ADD_LIB_ALL_TARGETS(winmm)
 
-	ADD_TARGET_LDFLAGS(avidemux2_cli &quot;-Wl,-subsystem,console&quot;)
+	ADD_TARGET_LDFLAGS(avidemux2_cli &quot;-Wl,-subsystem,console ${CMAKE_SOURCE_DIR}/avidemux/xpm/adm.o&quot;)
 
 	IF (ADM_UI_GTK)
-		ADD_TARGET_LDFLAGS(avidemux2_gtk &quot;-mwindows&quot;)
+		ADD_TARGET_LDFLAGS(avidemux2_gtk &quot;-mwindows ${CMAKE_SOURCE_DIR}/avidemux/xpm/adm.o&quot;)
 	ENDIF (ADM_UI_GTK)
 
 	IF (ADM_UI_QT4)
-		ADD_TARGET_LDFLAGS(avidemux2_qt4 &quot;-mwindows&quot;)
+		ADD_TARGET_LDFLAGS(avidemux2_qt4 &quot;-mwindows ${CMAKE_SOURCE_DIR}/avidemux/xpm/avidemux.o&quot;)
 	ENDIF (ADM_UI_QT4)
 ENDIF (WIN32)
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/button_mapping
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/button_mapping	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/button_mapping	2008-10-01 09:42:52 UTC (rev 4427)
@@ -45,7 +45,6 @@
 #     Begin
 #     Bitrate
 #     BitRate
-#     BrokenAvi
 #     BUILT_IN
 #     ChangeFPS
 #     CLOSE

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -77,7 +77,6 @@
 int A_loadMP3 (char *name);
 int A_loadNone( void );
 void A_saveAudioDecodedTest (char *name);
-void A_openBrokenAvi (const char *name);
 int A_openAvi2 (const char *name, uint8_t mode);
 int A_appendAvi (const char *name);
 void A_externalAudioTrack( void );
@@ -117,7 +116,6 @@
 char * actual_workbench_file;
 void A_saveWorkbench (const char *name);
 void updateLoaded (void);
-extern void encoderSetLogFile (char *name);
 extern void videoCodecSelect (void);
 extern uint8_t DIA_about( void );
 extern uint8_t DIA_RecentFiles( char **name );
@@ -290,11 +288,6 @@
  #endif     
       prefs-&gt;save ();
       return;
-    case ACT_SetLogFile:
-//      GUI_FileSelWrite (&quot;Select log File to use&quot;, encoderSetLogFile);
-      GUI_Error_HIG(QT_TR_NOOP(&quot;Obsolete&quot;), NULL);
-      return;
-      break;
     case ACT_SetMuxParam:
       ADM_aviUISetMuxer();
       return;
@@ -362,15 +355,6 @@
 	case ACT_OpenAvi:
           GUI_FileSelRead (QT_TR_NOOP(&quot;Select AVI File...&quot;), (SELFILE_CB *)A_openAvi);
 	  break;
-
-	case ACT_BrokenAvi:
-	  printf (&quot;\n Opening in broken mode...\n&quot;);
-          GUI_FileSelRead (QT_TR_NOOP(&quot;Select AVI File...&quot;), A_openBrokenAvi);
-	  break;
-
-
-	default:
-	  ;
 	}
       return;
     }
@@ -488,9 +472,6 @@
     case ACT_OpenAvi:
       GUI_FileSelRead (QT_TR_NOOP(&quot;Select AVI File...&quot;),(SELFILE_CB *) A_openAvi);
       break;
-    case ACT_BrokenAvi:
-      GUI_FileSelRead (QT_TR_NOOP(&quot;Select AVI File...&quot;), A_openBrokenAvi);
-      break;
     case ACT_AppendAvi:
       GUI_FileSelRead (QT_TR_NOOP(&quot;Select AVI File to Append...&quot;),(SELFILE_CB *) A_appendAvi);
       break;
@@ -873,12 +854,6 @@
 //    mode 1: Suspicious
 //_____________________________________________________________
 
-void
-A_openBrokenAvi (const char *name)
-{
-  A_openAvi2 (name, 1);
-}
-
 int
 A_openAvi (const char *name)
 {
@@ -887,6 +862,7 @@
 extern void GUI_PreviewEnd (void);
 int A_openAvi2 (const char *name, uint8_t mode)
 {
+	char *path = ADM_fixupPath(name);
   uint8_t res;
   char *longname;
   uint32_t magic[4];
@@ -896,16 +872,26 @@
     return 0;
   /// check if name exists
   FILE *fd;
-  fd = fopen (name, &quot;rb&quot;);
-  if (!fd){
-    if( errno == EACCES ){
-      GUI_Error_HIG(QT_TR_NOOP(&quot;Permission error&quot;), QT_TR_NOOP(&quot;Cannot open \&quot;%s\&quot;.&quot;), name);
-    }
-    if( errno == ENOENT ){
-      GUI_Error_HIG(QT_TR_NOOP(&quot;File error&quot;), QT_TR_NOOP(&quot;\&quot;%s\&quot; does not exist.&quot;), name);
-    }
-    return 0;
+  fd = fopen (path, &quot;rb&quot;);
+
+  if (!fd)
+  {
+	  switch (errno)
+	  {
+		  case EACCES:
+			  GUI_Error_HIG(QT_TR_NOOP(&quot;Permission error&quot;), QT_TR_NOOP(&quot;Cannot open \&quot;%s\&quot;.&quot;), path);
+			  break;
+		  case ENOENT:
+			  GUI_Error_HIG(QT_TR_NOOP(&quot;File error&quot;), QT_TR_NOOP(&quot;\&quot;%s\&quot; does not exist.&quot;), path);
+			  break;
+		  default:
+			  GUI_Error_HIG(QT_TR_NOOP(&quot;Error opening file&quot;), QT_TR_NOOP(&quot;Error opening \&quot;%s\&quot;.&quot;), path);
+	  }
+
+	  delete [] path;
+	  return 0;
   }
+
   if( 4 == fread(magic,4,4,fd) )
      id=R32(magic[0]);
   fclose (fd);
@@ -918,6 +904,8 @@
   ** we may get a relative path by cmdline
   */
   longname = ADM_PathCanonize(name);
+  delete [] path;
+
   if (mode)
     res = video_body-&gt;addFile (longname, 1);
   else
@@ -1084,17 +1072,19 @@
 int
 A_appendAvi (const char *name)
 {
+	char *path = ADM_fixupPath(name);
 
-
   if (playing)
     return 0;
   DIA_StartBusy ();
-  if (!video_body-&gt;addFile (name))
+  if (!video_body-&gt;addFile (path))
     {
       DIA_StopBusy ();
       GUI_Error_HIG (QT_TR_NOOP(&quot;Something failed when appending&quot;), NULL);
+	  delete [] path;
       return 0;
     }
+  delete [] path;
   DIA_StopBusy ();
 
 
@@ -1347,22 +1337,26 @@
 int
 A_loadAC3 (char *name)
 {
+	char *path = ADM_fixupPath(name);
+
   if (!avifileinfo)
     return 0;
 
 
   AVDMAC3AudioStream *ac3 = new AVDMAC3AudioStream ();
 
-  if (ac3-&gt;open (name) == 0)
+  if (ac3-&gt;open (path) == 0)
     {
       GUI_Error_HIG (QT_TR_NOOP(&quot;Failed to open the file&quot;), QT_TR_NOOP(&quot;Not a WAV file?&quot;));
       printf (QT_TR_NOOP(&quot;WAV open file failed...&quot;));
       delete ac3;
+	  delete [] path;
       return 0;
     }
   //currentaudiostream=wav;
-  A_changeAudioStream (ac3, AudioAC3,name);
+  A_changeAudioStream (ac3, AudioAC3,path);
   wavinfo = currentaudiostream-&gt;getInfo ();
+  delete [] path;
   return 1;
 }
 int A_loadNone( void )
@@ -1378,19 +1372,24 @@
 //_____________________________________________________________
 int A_loadMP3(char *name)
 {
+	char *path = ADM_fixupPath(name);
+
     if (!avifileinfo)
         return 0;
     AVDMMP3AudioStream *mp3 = new AVDMMP3AudioStream();
 
-    if (mp3-&gt;open(name) == 0)
+    if (mp3-&gt;open(path) == 0)
       {
           printf(&quot;MP3 open file failed...&quot;);
           delete mp3;
+		  delete [] path;
           return 0;
       }
+
     //currentaudiostream=mp3;
-    A_changeAudioStream(mp3, AudioMP3,name);
+    A_changeAudioStream(mp3, AudioMP3,path);
     wavinfo = currentaudiostream-&gt;getInfo();
+	delete [] path;
     return 1;
 }
 //_____________________________________________________________
@@ -1403,6 +1402,8 @@
 int
 A_loadWave (char *name)
 {
+	char *path = ADM_fixupPath(name);
+
   if (!avifileinfo)
   {
         printf(&quot;No video loaded\n&quot;);
@@ -1410,16 +1411,18 @@
    }
   AVDMWavAudioStream *wav = new AVDMWavAudioStream ();
 
-  if (wav-&gt;open (name) == 0)
+  if (wav-&gt;open (path) == 0)
     {
       GUI_Error_HIG (QT_TR_NOOP(&quot;Failed to open the file&quot;), QT_TR_NOOP(&quot;Not a WAV file?&quot;));
       printf (&quot;WAV open file failed...&quot;);
       delete wav;
+	  delete [] path;
       return 0;
     }
   //currentaudiostream=wav;
-  A_changeAudioStream (wav, AudioWav,name);
+  A_changeAudioStream (wav, AudioWav,path);
   wavinfo = currentaudiostream-&gt;getInfo ();
+  delete [] path;
   return 1;
 }
 AudioSource getCurrentAudioSource(char **name)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2008-10-01 09:42:52 UTC (rev 4427)
@@ -1,6 +1,5 @@
 ACT(OpenAvi)
 ACT(AppendAvi)
-ACT(BrokenAvi)
 ACT(AviInfo)
 ACT(CLOSE)
 ACT(Exit)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_savenew.cpp	2008-10-01 00:03:46 UTC (rev 4426)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_savenew.cpp	2008-10-01 09:42:52 UTC (rev 4427)
@@ -155,6 +155,8 @@
 		
 	}
         printf(&quot;Output format:%d\n&quot;,UI_GetCurrentFormat());
+		char *path = ADM_fixupPath(name);
+
 	switch(family)
 	{
 		case CodecFamilyAVI:
@@ -162,35 +164,35 @@
 					switch(UI_GetCurrentFormat())
 					{
 						case ADM_DUMMY:
-					                            			ret=oplug_dummy(name);
+					                            			ret=oplug_dummy(path);
 					                            			break;
 						case ADM_FLV:
-                            			ret=oplug_flv(name);
+                            			ret=oplug_flv(path);
                             			break;
                         case ADM_MP4:
                         case ADM_PSP:
                         case ADM_MATROSKA:
                         
-                                                    ret=oplug_mp4(name,UI_GetCurrentFormat());
+                                                    ret=oplug_mp4(path,UI_GetCurrentFormat());
                                                     break;
 						case ADM_AVI:
-								ret=A_SaveAudioNVideo(name);
+								ret=A_SaveAudioNVideo(path);
 								break;
 						case ADM_OGM:
-								ret=ogmSave(name);
+								ret=ogmSave(path);
 								break;
 						case ADM_ES:
-								ret=ADM_saveRaw(name);
+								ret=ADM_saveRaw(path);
 								break;
 						case ADM_AVI_DUAL:
-								ret=A_SaveAudioDualAudio(name);
+								ret=A_SaveAudioDualAudio(path);
 								break;
                                                 case ADM_AVI_PAK:
-								ret=A_SavePackedVop(name);
+								ret=A_SavePackedVop(path);
 								break;
 
 						case ADM_AVI_UNP:
-								ret=A_SaveUnpackedVop(name);
+								ret=A_SaveUnpackedVop(path);
 								break;
 						default:
                                                   GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible output format&quot;), NULL);
@@ -206,7 +208,7 @@
                                                 {
                                                   case ADM_PS:
                                                   case ADM_TS:
-						          ret=mpeg_passthrough(name,UI_GetCurrentFormat());
+						          ret=mpeg_passthrough(path,UI_GetCurrentFormat());
                                                           break;
                                                   default:
                                                     GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible output format&quot;), NULL);
@@ -219,7 +221,7 @@
                         case ADM_TS:
                         case ADM_PS:
                         case ADM_ES:
-                                ret=oplug_mpegff(name,UI_GetCurrentFormat());;
+                                ret=oplug_mpegff(path,UI_GetCurrentFormat());;
                                 break;
                         default:
                           GUI_Error_HIG(QT_TR_NOOP(&quot;Incompatible output format&quot;), NULL);
@@ -227,9 +229,12 @@
                     break;
                 default:
                             ADM_assert(0);
-                            return 0;
+							delete [] path;
+							return 0;
         }
         getFirstVideoFilter(0,avifileinfo-&gt;nb_frames);
+		delete [] path;
+
         return ret;
 }
 uint8_t  A_SaveAudioDualAudio(const char *inname)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/xpm/avidemux.ico (from rev 4398, branches/avidemux_2.4_branch/avidemux/xpm/avidemux.ico)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/xpm/avidemux.o (from rev 4398, branches/avidemux_2.4_branch/avidemux/xpm/avidemux.o)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001666.html">[Avidemux-svn-commit] r4426 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_UIs/ADM_QT4/include avidemux/ADM_UIs/ADM_QT4/src	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics	avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4	plugins/ADM_videoFilters/ASharp/qt4	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/ChromaShift/qt4	plugins/ADM_videoFilters/Contrast/qt4	plugins/ADM_videoFilters/Crop/qt4 plugins/ADM_videoFilters/Eq2/qt4	plugins/ADM_videoFilters/Hue/qt4	plugins/ADM_videoFilters/MplayerResize/qt4	plugins/ADM_videoFilters/Srt/qt4 po
</A></li>
	<LI>Next message: <A HREF="001668.html">[Avidemux-svn-commit] r4428 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/src avidemux/ADM_coreUI/include	avidemux/ADM_userInterfaces/ADM_GTK	avidemux/ADM_userInterfaces/ADM_NONE	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_audioEncoders/lame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1667">[ date ]</a>
              <a href="thread.html#1667">[ thread ]</a>
              <a href="subject.html#1667">[ subject ]</a>
              <a href="author.html#1667">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
