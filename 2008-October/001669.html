<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4429 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/include avidemux/ADM_UIs/ADM_QT4/src	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	plugins/ADM_videoFilters/ASharp	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/MplayerResize/qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4429%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_UIs/ADM_QT4/include%20avidemux/ADM_UIs/ADM_QT4/src%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09plugins/ADM_videoFilters/ASharp%0A%09plugins/ADM_videoFilters/AvisynthResize/qt4%0A%09plugins/ADM_videoFilters/MplayerResize/qt4&In-Reply-To=%3C200810011509.m91F9l8r032441%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001668.html">
   <LINK REL="Next"  HREF="001670.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4429 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/include avidemux/ADM_UIs/ADM_QT4/src	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	plugins/ADM_videoFilters/ASharp	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/MplayerResize/qt4</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4429%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_UIs/ADM_QT4/include%20avidemux/ADM_UIs/ADM_QT4/src%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09plugins/ADM_videoFilters/ASharp%0A%09plugins/ADM_videoFilters/AvisynthResize/qt4%0A%09plugins/ADM_videoFilters/MplayerResize/qt4&In-Reply-To=%3C200810011509.m91F9l8r032441%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4429 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/include avidemux/ADM_UIs/ADM_QT4/src	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	plugins/ADM_videoFilters/ASharp	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/MplayerResize/qt4">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Oct  1 17:09:47 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001668.html">[Avidemux-svn-commit] r4428 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/src avidemux/ADM_coreUI/include	avidemux/ADM_userInterfaces/ADM_GTK	avidemux/ADM_userInterfaces/ADM_NONE	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_audioEncoders/lame
</A></li>
        <LI>Next message: <A HREF="001670.html">[Avidemux-svn-commit] r4430 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_UIs/ADM_QT4/src ADM_coreImage/src	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_QT4/ADM_gui/pics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1669">[ date ]</a>
              <a href="thread.html#1669">[ thread ]</a>
              <a href="subject.html#1669">[ subject ]</a>
              <a href="author.html#1669">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-10-01 17:09:22 +0200 (Wed, 01 Oct 2008)
New Revision: 4429

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_color.cpp
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/toolkit.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/AvisynthResize/qt4/Q_resize.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/qt4/Q_resize.cpp
Log:
[Merge] integrate changes from 2.4 branch (r4412)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h	2008-10-01 15:09:22 UTC (rev 4429)
@@ -19,6 +19,18 @@
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
+
+class FlyDialogEventFilter : public QObject
+{
+	ADM_flyDialog *flyDialog;
+
+public:
+	FlyDialogEventFilter(ADM_flyDialog *flyDialog);
+
+protected:
+	bool eventFilter(QObject *obj, QEvent *event);
+};
+
 class ADM_flyDialogQt4 : public ADM_flyDialog
 {
 public:

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt	2008-10-01 15:09:22 UTC (rev 4429)
@@ -2,16 +2,16 @@
 
 QT4_WRAP_CPP(${ADM_LIB}_source
 	T_bitrate.h  T_button.h  T_dialogFactory.h  T_filesel.h  T_menu.h  T_slider.h
-	T_threadCount.h  T_toggle.h)
+	T_threadCount.h  T_toggle.h  T_notch.h)
 
 SET(${ADM_LIB}_T
 	T_bitrate.cpp  T_button.cpp  T_dialogFactory.cpp  T_filesel.cpp  T_menu.cpp
-	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp
+	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp  T_notch.cpp
     T_flyDialogQt4.cpp T_QCanvas.cpp
 )
 
 SET(${ADM_LIB}_SRCS
-	FAC_bar.cpp    FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp  FAC_aspectRatio.cpp
+	FAC_bar.cpp    FAC_frame.cpp  FAC_integer.cpp  FAC_aspectRatio.cpp
 	FAC_float.cpp  FAC_hex.cpp    FAC_readOnlyText.cpp  toolkit.cpp
 	FAC_matrix.cpp  DIA_none.cpp  ${${ADM_LIB}_source}  ${${ADM_LIB}_T})
 

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -1,79 +0,0 @@
-/***************************************************************************
-  FAC_toggle.cpp
-  Handle dialog factory element : Toggle
-  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
-***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include &lt;QtGui/QGridLayout&gt;
-#include &lt;QtGui/QCheckBox&gt;
-
-#include &quot;ADM_default.h&quot;
-#include &quot;DIA_factory.h&quot;
-#include &quot;ADM_dialogFactoryQt4.h&quot;
-
-extern const char *shortkey(const char *);
-
-namespace ADM_qt4Factory
-{
-
-
-class diaElemNotch : public diaElem
-{
-  uint32_t yesno;
-public:
-  
-  diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip=NULL);
-  virtual ~diaElemNotch() ;
-  void setMe(void *dialog, void *opaque,uint32_t line);
-  void getMe(void) {};
-  int getRequiredLayout(void);
-};
-diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
-  : diaElem(ELEM_NOTCH)
-{
-  yesno=yes;
-  paramTitle=toggleTitle;
-  this-&gt;tip=tip;
-}
-
-diaElemNotch::~diaElemNotch()
-{
-  
-}
-void diaElemNotch::setMe(void *dialog, void *opaque,uint32_t line)
-{
-  QCheckBox *box=new QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog);
- QGridLayout *layout=(QGridLayout*) opaque;
- myWidget=(void *)box; 
- if( yesno)
- {
-    box-&gt;setCheckState(Qt::Checked); 
- }
- box-&gt;show();
- layout-&gt;addWidget(box,line,0);
-}
-
-int diaElemNotch::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
-} // End of namespace
-//****************************Hoook*****************
-
-diaElem  *qt4CreateNotch(uint32_t yes,const char *toggleTitle, const char *tip)
-{
-	return new  ADM_qt4Factory::diaElemNotch(yes,toggleTitle, tip);
-}
-void qt4DestroyNotch(diaElem *e)
-{
-	ADM_qt4Factory::diaElemNotch *a=(ADM_qt4Factory::diaElemNotch *)e;
-	delete a;
-}
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -13,6 +13,8 @@
 ***************************************************************************///
 
 
+#include &lt;QtCore/QEvent&gt;
+#include &lt;QtCore/QCoreApplication&gt;
 #include &lt;QtGui/QGraphicsView&gt;
 #include &lt;QtGui/QSlider&gt;
 
@@ -21,6 +23,29 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
+
+extern float UI_calcZoomToFitScreen(QWidget* window, QWidget* canvas, uint32_t imageWidth, uint32_t imageHeight);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w, uint32_t *h);
+
+FlyDialogEventFilter::FlyDialogEventFilter(ADM_flyDialog *flyDialog)
+{
+	this-&gt;flyDialog = flyDialog;
+}
+
+bool FlyDialogEventFilter::eventFilter(QObject *obj, QEvent *event)
+{
+	if (event-&gt;type() == QEvent::Show)
+	{
+		QWidget* parent = (QWidget*)obj;
+		uint32_t screenWidth, screenHeight;
+
+		UI_getPhysicalScreenSize(parent, &amp;screenWidth, &amp;screenHeight);
+		flyDialog-&gt;recomputeSize();
+		QCoreApplication::processEvents();
+		parent-&gt;move((screenWidth - parent-&gt;frameSize().width()) / 2, (screenHeight - parent-&gt;frameSize().height()) / 2);
+	}
+}
+
   ADM_flyDialogQt4::ADM_flyDialogQt4(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod):
                                 ADM_flyDialog(width,height,in,canvas,slider,yuv,resizeMethod) 
@@ -33,15 +58,26 @@
 	QWidget *graphicsView = ((ADM_QCanvas*)_canvas)-&gt;parentWidget();
 	QSlider  *slider=(QSlider *)_slider;
 
+	if (!reInit)
+	{
+		FlyDialogEventFilter *eventFilter = new FlyDialogEventFilter(this);
+
+		if (slider)
+			slider-&gt;setMaximum(_in-&gt;getInfo()-&gt;nb_frames);
+
+		graphicsView-&gt;parentWidget()-&gt;installEventFilter(eventFilter);
+	}
+
+	((ADM_QCanvas*)_canvas)-&gt;changeSize(_zoomW, _zoomH);
 	graphicsView-&gt;setMinimumSize(_zoomW, _zoomH);
 	graphicsView-&gt;resize(_zoomW, _zoomH);
+}
 
-	if (slider)
-		slider-&gt;setMaximum(_in-&gt;getInfo()-&gt;nb_frames);
+float ADM_flyDialogQt4::calcZoomFactor(void)
+{
+	return UI_calcZoomToFitScreen(((ADM_QCanvas*)_canvas)-&gt;parentWidget()-&gt;parentWidget(), ((ADM_QCanvas*)_canvas)-&gt;parentWidget(), _w, _h);
 }
 
-float ADM_flyDialogQt4::calcZoomFactor(void) {return 1;}
-
 uint8_t  ADM_flyDialogQt4::display(void)
 {
    ADM_QCanvas *view=(ADM_QCanvas *)_canvas;

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.cpp (from rev 4427, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/FAC_notch.cpp	2008-10-01 09:42:52 UTC (rev 4427)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -0,0 +1,89 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;T_notch.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
+
+extern const char *shortkey(const char *);
+
+namespace ADM_qt4Factory
+{
+
+QCheckBoxReadOnly::QCheckBoxReadOnly(QCheckBox *box, bool state)
+{
+	this-&gt;box = box;
+	this-&gt;state = state;
+}
+
+void QCheckBoxReadOnly::stateChanged(int state)
+{
+	box-&gt;setCheckState(this-&gt;state ? Qt::Checked : Qt::Unchecked);
+}
+
+class diaElemNotch : public diaElem
+{
+  uint32_t yesno;
+public:
+  
+  diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip=NULL);
+  virtual ~diaElemNotch() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void) {};
+  int getRequiredLayout(void);
+};
+
+diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
+  : diaElem(ELEM_NOTCH)
+{
+  yesno=yes;
+  paramTitle=toggleTitle;
+  this-&gt;tip=tip;
+}
+
+diaElemNotch::~diaElemNotch()
+{
+  
+}
+void diaElemNotch::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  QCheckBox *box=new QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog);
+  QCheckBoxReadOnly *readOnlyReceiver = new QCheckBoxReadOnly(box, yesno);
+ QGridLayout *layout=(QGridLayout*) opaque;
+ myWidget=(void *)box; 
+ if( yesno)
+ {
+    box-&gt;setCheckState(Qt::Checked); 
+ }
+
+ QObject::connect(box, SIGNAL(stateChanged(int)), readOnlyReceiver, SLOT(stateChanged(int)));
+ layout-&gt;addWidget(box,line,0);
+}
+
+int diaElemNotch::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+} // End of namespace
+//****************************Hoook*****************
+
+diaElem  *qt4CreateNotch(uint32_t yes,const char *toggleTitle, const char *tip)
+{
+	return new  ADM_qt4Factory::diaElemNotch(yes,toggleTitle, tip);
+}
+void qt4DestroyNotch(diaElem *e)
+{
+	ADM_qt4Factory::diaElemNotch *a=(ADM_qt4Factory::diaElemNotch *)e;
+	delete a;
+}
+//EOF


Property changes on: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.h	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_notch.h	2008-10-01 15:09:22 UTC (rev 4429)
@@ -0,0 +1,26 @@
+#ifndef T_NOTCH_H
+#define T_NOTCH_H
+
+#include &lt;QtGui/QGridLayout&gt;
+#include &lt;QtGui/QCheckBox&gt;
+
+#include &quot;DIA_factory.h&quot;
+
+namespace ADM_qt4Factory
+{
+	class QCheckBoxReadOnly : public QObject
+	{
+		Q_OBJECT
+
+	private:
+		QCheckBox *box;
+		bool state;
+
+	public:
+		QCheckBoxReadOnly(QCheckBox *box, bool state);
+
+		public slots:
+			void stateChanged(int state);
+	};
+}
+#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/toolkit.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/toolkit.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/toolkit.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -1,4 +1,6 @@
 #include &lt;QtCore/QStack&gt;
+#include &lt;QtGui/QApplication&gt;
+#include &lt;QtGui/QDesktopWidget&gt;
 
 #include &quot;ADM_toolkitQt.h&quot;
 #include &quot;ADM_assert.h&quot;
@@ -26,3 +28,46 @@
 	else
 		return NULL;
 }
+
+uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h)
+{
+	QRect qrect = QApplication::desktop()-&gt;availableGeometry();
+
+	*w = (uint32_t)qrect.width();
+	*h = (uint32_t)qrect.height();
+}
+
+// Calculate the zoom ratio required to fit the whole image on the screen.
+float UI_calcZoomToFitScreen(QWidget* window, QWidget* canvas, uint32_t imageWidth, uint32_t imageHeight)
+{
+	int windowWidth, windowHeight;
+	int drawingWidth, drawingHeight;
+	uint32_t screenWidth, screenHeight;
+
+	windowWidth = window-&gt;frameSize().width();
+	windowHeight = window-&gt;frameSize().height();
+
+	drawingWidth = canvas-&gt;frameSize().width();
+	drawingHeight = canvas-&gt;frameSize().height();
+
+	UI_getPhysicalScreenSize(window, &amp;screenWidth, &amp;screenHeight);
+
+	// Take drawing area out of the equation, how much extra do we need for additional controls?
+	windowWidth -= drawingWidth;
+	windowHeight -= drawingHeight;
+
+	// This is the true amount of screen real estate we can work with
+	screenWidth -= windowWidth;
+	screenHeight -= windowHeight;
+
+	// Calculate zoom ratio
+	if (imageWidth &gt; screenWidth || imageHeight &gt; screenHeight)
+	{
+		float widthRatio = (float)screenWidth / (float)imageWidth;
+		float heightRatio = (float)screenHeight / (float)imageHeight;
+
+		return (widthRatio &lt; heightRatio ? widthRatio : heightRatio);
+	}
+	else
+		return 1;
+}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2008-10-01 15:09:22 UTC (rev 4429)
@@ -16,7 +16,7 @@
 	${${ADM_LIB}_headers}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource}  Q_about.cpp  
 	Q_calculator.cpp  Q_encoding.cpp  Q_license.cpp
 	Q_jobs.cpp  Q_props.cpp   Q_vobsub.cpp  Q_working.cpp   T_index_pg.cpp
-	alert_qt4.cpp  DIA_busy.cpp  DIA_none.cpp  DIA_xvid4.cpp  OCR_none.cpp)
+	alert_qt4.cpp  DIA_busy.cpp  DIA_none.cpp  DIA_xvid4.cpp  OCR_none.cpp  DIA_color.cpp)
 
 ADD_DEFINITIONS(-DADM_SUBVERSION=${ADM_SUBVERSION})
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_color.cpp (from rev 4412, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_color.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_color.cpp	2008-09-26 13:54:27 UTC (rev 4412)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_color.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -0,0 +1,20 @@
+#include &lt;QtGui/QColorDialog&gt;
+
+#include &quot;ADM_toolkitQt.h&quot;
+
+int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b)
+{
+	QColor initialColor = QColor(*r, *g, *b);
+	QColor color = QColorDialog::getColor(initialColor, qtLastRegisteredDialog());
+
+	if (color.isValid())
+	{
+		*r = color.red();
+		*g = color.green();
+		*b = color.blue();
+
+		return 1;
+	}
+
+	return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -251,6 +251,7 @@
 	slider=ui.horizontalSlider;
 	slider-&gt;setMinimum(0);
 	slider-&gt;setMaximum(1000000000);
+	slider-&gt;setPageStep(10000000);
 	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
 	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
 	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -17,7 +17,7 @@
 
 #include &quot;Q_preview.h&quot;
 
-Ui_previewWindow::Ui_previewWindow(QWidget *parent, int width, int height) : QDialog(parent, Qt::WindowTitleHint)
+Ui_previewWindow::Ui_previewWindow(QWidget *parent, int width, int height) : QDialog(parent)
 {
 	ui.setupUi(this);
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -29,6 +29,7 @@
 #include &quot;Q_preview.h&quot;
 #include &quot;../ADM_render/GUI_render.h&quot;
 #include &quot;../ADM_render/GUI_accelRender.h&quot;
+#include &quot;gui_action.hxx&quot;
     
 void UI_QT4VideoWidget(QFrame *host);
 static QFrame *hostFrame=NULL;
@@ -37,12 +38,24 @@
 extern QWidget *QuiMainWindows;
  
 extern void UI_purge( void );
+extern void UI_setCurrentPreview(int ne);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w, uint32_t *h);
 
 static Ui_previewWindow *previewWindow = NULL;
 
+void PreviewEventReceiver::previewClose()
+{
+	UI_setCurrentPreview(0);
+	HandleAction(ACT_PreviewChanged);
+}
+
+static PreviewEventReceiver *eventReceiver = NULL;
+
 void DIA_previewInit(uint32_t width, uint32_t height)
 {
+	eventReceiver = new PreviewEventReceiver;
 	previewWindow = new Ui_previewWindow(QuiMainWindows, width, height);
+	QObject::connect(previewWindow, SIGNAL(rejected()), eventReceiver, SLOT(previewClose()));
 	previewWindow-&gt;show();
 }
 
@@ -69,6 +82,7 @@
 	{
 		delete previewWindow;
 		previewWindow = NULL;
+		delete eventReceiver;
 	}
 }
 
@@ -220,7 +234,3 @@
 	xinfo-&gt;width = displayW;
 	xinfo-&gt;height = displayH;
 }
-
-
-//****************************************************************************************************
-//EOF 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.h	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.h	2008-10-01 15:09:22 UTC (rev 4429)
@@ -4,6 +4,14 @@
 #include &lt;QtGui/QPaintEvent&gt;
 #include &lt;QtGui/QWidget&gt;
 
+class PreviewEventReceiver : public QObject
+{
+	Q_OBJECT
+
+public slots:
+	void previewClose();
+};
+
 class  ADM_Qvideo : public QWidget
 {
 	Q_OBJECT

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -21,11 +21,4 @@
 uint8_t UI_arrow_enabled(void) {return 1;}
 uint8_t UI_arrow_disabled(void) {return 1;}
 
-uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h)
-{
-	QRect qrect = QApplication::desktop()-&gt;availableGeometry();
-
-	*w = (uint32_t)qrect.width();
-	*h = (uint32_t)qrect.height();
-}
 // EOF

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h	2008-10-01 15:09:22 UTC (rev 4429)
@@ -2,7 +2,6 @@
 #ifndef _ASHARP_PARAM
 #define _ASHARP_PARAM
 #define uc uint8_t
-#define bool uint8_t
 
  void asharp_run_c(      uc* planeptr, int pitch,
                                         int height, int width, 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/AvisynthResize/qt4/Q_resize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/AvisynthResize/qt4/Q_resize.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/AvisynthResize/qt4/Q_resize.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -32,6 +32,7 @@
      ui.spinBoxWidth-&gt;setValue(_param-&gt;width);
      ui.spinBoxHeight-&gt;setValue(_param-&gt;height);
      ui.horizontalSlider-&gt;setValue(100);
+	 ui.comboBoxAlgo-&gt;setCurrentIndex(_param-&gt;algo);
      updateWidthHeightSpinners();
 
 	 connect(ui.comboBoxSource, SIGNAL(currentIndexChanged(int)), this, SLOT(aspectRatioChanged(int)));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/qt4/Q_resize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/qt4/Q_resize.cpp	2008-10-01 13:49:39 UTC (rev 4428)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/qt4/Q_resize.cpp	2008-10-01 15:09:22 UTC (rev 4429)
@@ -32,6 +32,7 @@
      ui.spinBoxWidth-&gt;setValue(_param-&gt;width);
      ui.spinBoxHeight-&gt;setValue(_param-&gt;height);
      ui.horizontalSlider-&gt;setValue(100);
+	 ui.comboBoxAlgo-&gt;setCurrentIndex(_param-&gt;algo);
      updateWidthHeightSpinners();
 
 	 connect(ui.comboBoxSource, SIGNAL(currentIndexChanged(int)), this, SLOT(aspectRatioChanged(int)));


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001668.html">[Avidemux-svn-commit] r4428 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_UIs/ADM_QT4/src avidemux/ADM_coreUI/include	avidemux/ADM_userInterfaces/ADM_GTK	avidemux/ADM_userInterfaces/ADM_NONE	avidemux/ADM_userInterfaces/ADM_QT4	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_audioEncoders/lame
</A></li>
	<LI>Next message: <A HREF="001670.html">[Avidemux-svn-commit] r4430 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_UIs/ADM_QT4/src ADM_coreImage/src	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_QT4/ADM_gui/pics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1669">[ date ]</a>
              <a href="thread.html#1669">[ thread ]</a>
              <a href="subject.html#1669">[ subject ]</a>
              <a href="author.html#1669">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
