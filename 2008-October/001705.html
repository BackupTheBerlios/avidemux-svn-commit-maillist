<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4467 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/include	avidemux/ADM_coreImage/src avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_utilities cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4467%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_codecs%20avidemux/ADM_coreImage/include%0A%09avidemux/ADM_coreImage/src%20avidemux/ADM_libraries/ADM_ffmpeg%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_utilities%20cmake&In-Reply-To=%3C200810151513.m9FFDuBV012846%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001704.html">
   <LINK REL="Next"  HREF="001706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4467 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/include	avidemux/ADM_coreImage/src avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_utilities cmake</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4467%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_codecs%20avidemux/ADM_coreImage/include%0A%09avidemux/ADM_coreImage/src%20avidemux/ADM_libraries/ADM_ffmpeg%0A%09avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec%0A%09avidemux/ADM_libraries/ADM_utilities%20cmake&In-Reply-To=%3C200810151513.m9FFDuBV012846%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4467 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/include	avidemux/ADM_coreImage/src avidemux/ADM_libraries/ADM_ffmpeg	avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec	avidemux/ADM_libraries/ADM_utilities cmake">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Oct 15 17:13:56 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001704.html">[Avidemux-svn-commit] r4466 - in branches/avidemux_2.4_branch: .	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
        <LI>Next message: <A HREF="001706.html">[Avidemux-svn-commit] r4468 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr	plugins/ADM_videoFilters/CNR2 plugins/ADM_videoFilters/CNR2/qt4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1705">[ date ]</a>
              <a href="thread.html#1705">[ thread ]</a>
              <a href="subject.html#1705">[ subject ]</a>
              <a href="author.html#1705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-10-15 17:13:45 +0200 (Wed, 15 Oct 2008)
New Revision: 4467

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_rgb.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/png.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
Log:
[Merge] integrate changes from 2.4 branch (r4437)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2008-10-15 15:13:45 UTC (rev 4467)
@@ -57,7 +57,6 @@
 #include &quot;ADM_codecs/ADM_theora_dec.h&quot;
 #endif
 
-#include &quot;ADM_codecs/ADM_png.h&quot;
 
 #include &quot;ADM_assert.h&quot;
 #include &quot;prefs.h&quot;
@@ -253,13 +252,11 @@
 
       return (decoders *) (new decoderFFhuff (w, h, extraLen, extraData,bpp));
     }
-#ifdef USE_PNG
   if (fourCC::check (fcc, (uint8_t *) &quot;PNG &quot;))
     {
 
-      return (decoders *) (new decoderPng (w, h));
+      return (decoders *) (new decoderFFPng (w, h));
     }
-#endif
  if (fourCC::check (fcc, (uint8_t *) &quot;cvid&quot;))
     {
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2008-10-15 15:13:45 UTC (rev 4467)
@@ -416,13 +416,21 @@
       // we do it or not
       out-&gt;_colorspace = ADM_COLOR_YV12;
       break;
-
+	case PIX_FMT_RGB24:
+	  out-&gt;_colorspace = ADM_COLOR_RGB24;
+	  break;
     case PIX_FMT_RGBA32:
       out-&gt;_colorspace = ADM_COLOR_RGB32A;
       break;
     case PIX_FMT_RGB555:
       out-&gt;_colorspace = ADM_COLOR_RGB555;
       break;
+    case PIX_FMT_GRAY8:
+      out-&gt;_colorspace = ADM_COLOR_GRAY8;
+      break;
+    case PIX_FMT_PAL8:
+      out-&gt;_colorspace = ADM_COLOR_PAL8;
+      break;
     default:
       printf (&quot;[lavc] Unhandled colorspace: %d\n&quot;, _context-&gt;pix_fmt);
       return 0;
@@ -542,6 +550,11 @@
   _refCopy = 1;			// YUV420 only
   WRAP_Open (CODEC_ID_FFV1);
 }
+decoderFFPng::decoderFFPng (uint32_t w, uint32_t h):decoderFF (w, h)
+{
+  WRAP_Open (CODEC_ID_PNG);
+}
+
 decoderFF_ffhuff::decoderFF_ffhuff (uint32_t w, uint32_t h, uint32_t l, uint8_t * d,uint32_t bpp):decoderFF (w,
 	   h)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.h	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.h	2008-10-15 15:13:45 UTC (rev 4467)
@@ -252,6 +252,12 @@
   decoderFFV1 (uint32_t w, uint32_t h);
 
 };
+class decoderFFPng : public decoderFF
+{
+public:
+	decoderFFPng(uint32_t w, uint32_t h);
+};
+
 class decoderFFMJPEG:public decoderFF
 {
 protected:

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.cpp	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.cpp	2008-10-15 15:13:45 UTC (rev 4467)
@@ -1,180 +0,0 @@
-/***************************************************************************
-                          ADM_png.cpp  -  description
-                             -------------------
-    begin                : Sat Sep 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#ifdef USE_PNG
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-//#include &quot;ADM_colorspace/colorspace.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_codecs/ADM_png.h&quot;
-extern &quot;C&quot;
-{
-#include &quot;png.h&quot;
-}
-#include &quot;ADM_assert.h&quot;
-
-#define PNG_PTR ((png_structp)png_ptr)
-#define INFO_PTR ((png_infop)info_ptr)
-#define INFO_END ((png_infop)end_info)
-/*
-   	Initialize codec
-*/
-static void user_read_data (png_structp png_ptr, png_bytep data, png_size_t length);
-
-void decoderPng::recalc (void)
-{
-  int mul;
-  if (colorspace == ADM_COLOR_RGB24)
-    mul = 3;
-
-  else
-    mul = 4;
-  for (int i = 0; i &lt; _h; i++)
-    rows[i] = decoded + mul * _w * i;
-}
-
-
-decoderPng::decoderPng (uint32_t w, uint32_t h):decoders (w, h)
-{
-  rows = NULL;
-  decoded = NULL;
-  colorspace = ADM_COLOR_RGB24;
-
-  //****************************
-  // Prepare the decoded buffer*
-  //****************************
-  decoded = new uint8_t[4 * w * h];	// We take a bit more to be able to decode 32 bits png
-  // without causing a segfault
-  rows = new uint8_t *[h];
-  recalc ();
-}
- void decoderPng::Init (void)
-{
-  png_ptr =
-    (void *) png_create_read_struct (PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
-  ADM_assert (png_ptr);
-  info_ptr = (void *) png_create_info_struct (PNG_PTR);
-  ADM_assert (info_ptr);
-  end_info = (void *) png_create_info_struct (PNG_PTR);
-  ADM_assert (end_info);
-  memset (&amp;io, 0, sizeof (io));
-  png_set_read_fn (PNG_PTR, &amp;io, user_read_data);
-  png_set_rows (PNG_PTR, INFO_PTR, (png_byte **) rows);
-}
-void decoderPng::Cleanup (void)
-{
-  png_destroy_read_struct ((png_structpp) &amp; png_ptr, (png_infopp) &amp; info_ptr,
-			   (png_infopp) &amp; end_info);
-}
-decoderPng::~decoderPng ()
-{
-  delete[]rows;
-  delete[]decoded;
-}
-/*
-   	Uncompress frame, set flags if needed
-*/
-uint8_t decoderPng::uncompress(ADMCompressedImage * in, ADMImage * out)
-{
-  int bpp;
-  int colortype;
-
-  // Check if it is png, and fill it
-  if (!!png_sig_cmp (in-&gt;data, 0, 8))
-
-    {
-      printf (&quot;[PNG] wrong sig\n&quot;);
-      return 0;
-    }
-
-  //
-  //
-gain2:
-  Init ();
-  io.data = in-&gt;data;
-  io.size = in-&gt;dataLength;
-  io.cur = 0;
-  png_read_png (PNG_PTR, INFO_PTR, PNG_TRANSFORM_IDENTITY, NULL);
-
-  // Check if it is 24 or 32 bits RGB 
-  bpp = png_get_bit_depth (PNG_PTR, INFO_PTR);
-//   printf(&quot;Bpp:%u\n&quot;,bpp);
-  // if needed we change colorspace 
-  colortype = png_get_color_type (PNG_PTR, INFO_PTR);
-  // 
-  if (colorspace == ADM_COLOR_RGB24 &amp;&amp; colortype == PNG_COLOR_TYPE_RGB_ALPHA)	// RGB32
-    {
-
-      // Switch to 32 bits
-      colorspace = ADM_COLOR_RGB32A;
-      recalc ();
-      goto gain2;
-    }
-
-  else if (colorspace == ADM_COLOR_RGB32A &amp;&amp; colortype == PNG_COLOR_TYPE_RGB)
-
-    {
-
-      // Switch to 24 bits
-      colorspace = ADM_COLOR_RGB24;
-      recalc ();
-      goto gain2;
-    }
-  ADM_assert (out-&gt;_isRef);
-  out-&gt;_planes[0] = decoded;
-  out-&gt;_planes[1] = NULL;
-  out-&gt;_planes[2] = NULL;
-  if (colorspace == ADM_COLOR_RGB32A)
-    out-&gt;_planeStride[0] = _w * 4;
-
-  else
-    out-&gt;_planeStride[0] = _w * 3;
-  out-&gt;_planeStride[1] = 0;
-  out-&gt;_planeStride[2] = 0;
-  out-&gt;_colorspace = colorspace;
-  Cleanup ();
-  return 1;
-}
-
-// ******************************************************
-//    Memory based IO
-// ******************************************************
-void user_read_data (png_structp png_ptr, png_bytep data, png_size_t length)
-{
-  memAccess *ac;
-  ac = (memAccess *) png_get_io_ptr (png_ptr);
-  ADM_assert (length + ac-&gt;cur &lt;= ac-&gt;size);	// or &lt; ?
-  memcpy (data, ac-&gt;data + ac-&gt;cur, length);
-  ac-&gt;cur += length;
-} 
-
-void user_write_data (png_structp png_ptr, png_bytep data, png_size_t length)
-{
-} 
-
-void user_flush_data (png_structp png_ptr)
-{
-}
-//EOF
-#endif /*  */

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.h	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_png.h	2008-10-15 15:13:45 UTC (rev 4467)
@@ -1,78 +0,0 @@
-/***************************************************************************
-                          ADM_png  -  description
-                             -------------------
-    copyright            : (C) 2005 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
- 
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/ 
-#ifndef PNG_H_A
-#define PNG_H_A
-#ifdef USE_PNG
-
-typedef struct memAccess 
-{
-  
-int size;
-   
-int cur;
-   
-uint8_t * data;
-
-
-} memAccess;
-
-
-class decoderPng:public decoders 
-{
-
-protected:
-memAccess io;
-  
-ADM_colorspace colorspace;
-  
-void *png_ptr;
-  
-void *info_ptr;
-  
-void *end_info;
-  
-
-uint8_t ** rows;
-  
-uint8_t * decoded;
-  
-void Init (void);
-  
-void Cleanup (void);
-  
-void recalc (void);
-
-public:
-decoderPng (uint32_t w, uint32_t h);
-  
-virtual ~ decoderPng ();
-  
-virtual uint8_t uncompress(ADMCompressedImage * in, ADMImage * out);
-  
-uint8_t dontcopy (void)
-  {
-    return 1;
-  }
-
-
-
-};
-
-#endif /* 
- */
-#endif /* 
- */

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2008-10-15 15:13:45 UTC (rev 4467)
@@ -1,13 +1,9 @@
 SET(ADM_codecs_SRCS 
-	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_png.cpp    ADM_theora_dec.cpp   ADM_xvid.cpp
+	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_theora_dec.cpp   ADM_xvid.cpp
 	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
 
-IF (USE_PNG)
-	 ADD_SOURCE_CFLAGS(ADM_png.cpp ${PNG_CFLAGS})
-ENDIF (USE_PNG)
-
 IF (USE_XVID_4)
 	ADD_SOURCE_CFLAGS(ADM_xvid4.cpp -I${XVID_INCLUDE_DIR})
 ENDIF (USE_XVID_4)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_rgb.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_rgb.h	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_rgb.h	2008-10-15 15:13:45 UTC (rev 4467)
@@ -33,7 +33,9 @@
     ADM_COLOR_YUV422,
     ADM_COLOR_YUV422P,
 	ADM_COLOR_YUV411,
-	ADM_COLOR_YUV444
+	ADM_COLOR_YUV444,
+	ADM_COLOR_GRAY8,
+	ADM_COLOR_PAL8
  } ADM_colorspace;
 #define ADM_COLOR_BACKWARD 0x8000
 #define ADM_COLOR_MASK     0x7FFF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2008-10-15 15:13:45 UTC (rev 4467)
@@ -496,6 +496,8 @@
                 case ADM_COLOR_YUV411:c=PIX_FMT_YUV411P;break;
 				case ADM_COLOR_YUV422:c=PIX_FMT_YUV422P;break;
 				case ADM_COLOR_YUV444:c=PIX_FMT_YUV444P;break;
+                case ADM_COLOR_GRAY8:c=PIX_FMT_GRAY8;break;
+				case ADM_COLOR_PAL8:c=PIX_FMT_PAL8;break;
                 default: ADM_assert(0);
     }
          _context=(void *)sws_getContext(

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/CMakeLists.txt	2008-10-15 15:13:45 UTC (rev 4467)
@@ -18,7 +18,7 @@
 	dvbsub_parser.c  dvbsubdec.c  dvbsub.c  xiph.c  sp5xdec.c  nellymoserdec.c
 	ADM_lavcodec.cpp  pthread.c  huffman.c  wmv2dec.c  wmv2.c  h264pred.c  intrax8.c
 	intrax8dsp.c  dnxhddata.c  faanidct.c  ac3_parser.c  aac_ac3_parser.c
-	aac_parser.c  mpegaudiodecheader.c)
+	aac_parser.c  mpegaudiodecheader.c  pngdec.c  png.c)
 
 IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/png.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/png.c	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/png.c	2008-10-15 15:13:45 UTC (rev 4467)
@@ -20,7 +20,7 @@
  */
 #include &quot;avcodec.h&quot;
 #include &quot;bytestream.h&quot;
-#include &quot;png.h&quot;
+#include &quot;ff_png.h&quot;
 
 const uint8_t ff_pngsig[8] = {137, 80, 78, 71, 13, 10, 26, 10};
 const uint8_t ff_mngsig[8] = {138, 77, 78, 71, 13, 10, 26, 10};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/config.h	2008-10-15 15:13:45 UTC (rev 4467)
@@ -44,6 +44,7 @@
 #define ENABLE_FLV_DECODER 1
 #define ENABLE_SNOW_DECODER 1
 #define ENABLE_AMV_DECODER 1
+#define ENABLE_PNG_DECODER 1
 #define ENABLE_PCX_DECODER 0
 #define ENABLE_SUNRAST_DECODER 0
 #define ENABLE_VB_DECODER 0
@@ -136,7 +137,6 @@
 #define ENABLE_H261_DECODER 0
 #define ENABLE_H263I_DECODER 0
 #define ENABLE_JPEGLS_DECODER 0
-#define ENABLE_PNG_DECODER 0
 #define ENABLE_QTRLE_DECODER 0
 #define ENABLE_RAWVIDEO_DECODER 0
 #define ENABLE_ROQ_DECODER 0

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/ffconf.c	2008-10-15 15:13:45 UTC (rev 4467)
@@ -55,6 +55,7 @@
     DECLARE_DECODER (FLV, flv);
     DECLARE_DECODER (SNOW, snow);
     DECLARE_DECODER (AMV, amv);
+	DECLARE_DECODER (PNG, png);
 #undef DECLARE_DECODER
 #define DECLARE_DECODER(a,b); printf(&quot;#define ENABLE_&quot;#a&quot;_DECODER 0\n&quot;); 
     DECLARE_DECODER(PCX, aasc);
@@ -152,7 +153,6 @@
     DECLARE_DECODER (H261, h261);
 	DECLARE_DECODER (H263I, h263i);
     DECLARE_DECODER (JPEGLS, jpegls);
-    DECLARE_DECODER (PNG, png);
     DECLARE_DECODER (QTRLE, qtrle);
     DECLARE_DECODER (RAWVIDEO, rawvideo);
     DECLARE_DECODER (ROQ, roq);
@@ -359,6 +359,7 @@
 	DECLARE_MUXER(PSP, psp)
 	DECLARE_MUXER(TG2, tg2)
 	DECLARE_MUXER(TGP, tgp)
+	DECLARE_MUXER(IPOD, iPod)
 
 	printf(&quot;#define CONFIG_ENCODERS 1\n&quot;);
 	printf(&quot;#define CONFIG_DVVIDEO_ENCODER 1\n&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2008-10-15 15:13:45 UTC (rev 4467)
@@ -21,7 +21,6 @@
 
 #include &quot;ADM_codecs/ADM_codec.h&quot;
 #include &quot;ADM_codecs/ADM_ffmp43.h&quot;
-#include &quot;ADM_codecs/ADM_png.h&quot;
 
 #include &quot;ADM_toolkit/bitmap.h&quot;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
@@ -330,7 +329,7 @@
     
  	   ADMImage tmpImage(w,h,1);
     	// Decode PNG
-    	decoderPng decoder(w,h);
+    	decoderFFPng decoder(w,h);
     	ADMCompressedImage bin;
     	bin.data=data;
     	bin.dataLength=size; // This is more than actually, but who cares...
@@ -338,9 +337,14 @@
     	decoder.uncompress (&amp;bin, &amp;tmpImage);
     	
     	ADMImage *image=new ADMImage(w,h);
-    	COL_RGB24_to_YV12( w, h,tmpImage._planes[0],image-&gt;data);
-    
+
+		COL_Generic2YV12 *convert = new COL_Generic2YV12(tmpImage._width, tmpImage._height, tmpImage._colorspace);
+
+		convert-&gt;transform(tmpImage._planes, tmpImage._planeStride, image-&gt;data);
+
+    	delete convert;
     	delete [] data;
+
     	return image;		
 }
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-10-15 15:13:45 UTC (rev 4467)
@@ -339,23 +339,6 @@
 	ADD_LIB_ALL_TARGETS(&quot;${PTHREAD_LIBRARIES}&quot;)
 ENDIF (UNIX AND PTHREAD_FOUND)
 
-# PNG
-IF (USE_PNG)
-	TARGET_LINK_LIBRARIES(avidemux2_cli ${PNG_LIBRARIES})
-	
-	IF (ADM_UI_GTK)
-		TARGET_LINK_LIBRARIES(avidemux2_gtk ${PNG_LIBRARIES})
-	ENDIF (ADM_UI_GTK)
-	
-	IF (ADM_UI_QT4)
-		IF (APPLE AND NOT QT_USE_FRAMEWORKS)
-			TARGET_LINK_LIBRARIES(avidemux2_qt4 ${PNG_LIBRARIES})
-		ELSEIF (NOT APPLE)
-			TARGET_LINK_LIBRARIES(avidemux2_qt4 ${PNG_LIBRARIES})
-		ENDIF (APPLE AND NOT QT_USE_FRAMEWORKS)
-	ENDIF (ADM_UI_QT4)
-ENDIF (USE_PNG)
-
 # Libxml2
 ADD_LIB_ALL_TARGETS(&quot;${LIBXML2_LIBRARIES}&quot;)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake	2008-10-15 15:13:45 UTC (rev 4467)
@@ -32,23 +32,6 @@
 ENDIF (LIBXML2_FOUND)
 
 ########################################
-# libpng
-########################################
-MESSAGE(STATUS &quot;Checking for libpng&quot;)
-MESSAGE(STATUS &quot;*******************&quot;)
-
-FIND_PACKAGE(PNG)
-PRINT_LIBRARY_INFO(&quot;libpng&quot; PNG_FOUND &quot;${PNG_INCLUDE_DIR} ${PNG_DEFINITIONS}&quot; &quot;${PNG_LIBRARIES}&quot; FATAL_ERROR)
-
-FOREACH(_flag ${PNG_INCLUDE_DIR})
-	SET(PNG_CFLAGS ${PNG_CFLAGS} -I${_flag})
-ENDFOREACH(_flag)
-
-SET(PNG_CFLAGS ${PNG_CFLAGS} ${PNG_DEFINITIONS})
-SET(USE_PNG 1)
-MESSAGE(&quot;&quot;)
-
-########################################
 # pthreads
 ########################################
 MESSAGE(STATUS &quot;Checking for pthreads&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-10-15 14:45:48 UTC (rev 4466)
+++ branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2008-10-15 15:13:45 UTC (rev 4467)
@@ -67,9 +67,6 @@
 
 #define USE_MJPEG
 
-/* libpng is available */
-#cmakedefine USE_PNG
-
 /* use libsamplerate */
 #cmakedefine USE_SRC
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001704.html">[Avidemux-svn-commit] r4466 - in branches/avidemux_2.4_branch: .	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
	<LI>Next message: <A HREF="001706.html">[Avidemux-svn-commit] r4468 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr	plugins/ADM_videoFilters/CNR2 plugins/ADM_videoFilters/CNR2/qt4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1705">[ date ]</a>
              <a href="thread.html#1705">[ thread ]</a>
              <a href="subject.html#1705">[ subject ]</a>
              <a href="author.html#1705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
