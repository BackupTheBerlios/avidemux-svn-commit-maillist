<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r7385 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_commonUI avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7385%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_commonUI%20avidemux/qt4/ADM_UIs/include%0A%09avidemux/qt4/ADM_UIs/src%20avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux_core/ADM_coreUtils/include%20avidemux_core/ADM_coreUtils/src&In-Reply-To=%3C20110805055709.B203A480F4A%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004535.html">
   <LINK REL="Next"  HREF="004537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r7385 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_commonUI avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src</H1>
    <B>mean at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7385%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_commonUI%20avidemux/qt4/ADM_UIs/include%0A%09avidemux/qt4/ADM_UIs/src%20avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux_core/ADM_coreUtils/include%20avidemux_core/ADM_coreUtils/src&In-Reply-To=%3C20110805055709.B203A480F4A%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r7385 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_commonUI avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src">mean at mail.berlios.de
       </A><BR>
    <I>Fri Aug  5 07:57:09 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004535.html">[Avidemux-svn-commit] r7384 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src	avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2
</A></li>
        <LI>Next message: <A HREF="004537.html">[Avidemux-svn-commit] r7386 - in	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_script	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4536">[ date ]</a>
              <a href="thread.html#4536">[ thread ]</a>
              <a href="subject.html#4536">[ subject ]</a>
              <a href="author.html#4536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2011-08-05 07:57:09 +0200 (Fri, 05 Aug 2011)
New Revision: 7385

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/prefs2_list.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.conf
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_json.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_pref.h
Log:
[QT4] Add a toggle to enable/disable openGL support

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2011-08-05 05:57:09 UTC (rev 7385)
@@ -69,7 +69,11 @@
 bool     bvdpau=false;
 bool     hzd,vzd,dring;
 bool     capsMMX,capsMMXEXT,caps3DNOW,caps3DNOWEXT,capsSSE,capsSSE2,capsSSE3,capsSSSE3,capsAll;
+bool     hasOpenGl=false;
 
+#ifdef USE_OPENGL
+          prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;hasOpenGl);
+#endif
 
 	olddevice=newdevice=AVDM_getCurrentDevice();
 
@@ -157,7 +161,12 @@
         olddevice=newdevice=AVDM_getCurrentDevice();
         // Audio device
         /************************ Build diaelems ****************************************/
-        diaElemToggle useVdpau(&amp;bvdpau,QT_TR_NOOP(&quot;_Use VDPAU for decoding H264&quot;));
+        diaElemToggle useVdpau(&amp;bvdpau,QT_TR_NOOP(&quot;Decode video using VDPAU&quot;));
+        diaElemToggle useOpenGl(&amp;hasOpenGl,QT_TR_NOOP(&quot;Enable openGl support&quot;));
+#ifndef USE_OPENGL
+        useOpenGl.disable();
+#endif
+        
         diaElemToggle useSysTray(&amp;useTray,QT_TR_NOOP(&quot;_Use systray while encoding&quot;));
         diaElemToggle allowAnyMpeg(&amp;mpeg_no_limit,QT_TR_NOOP(&quot;_Accept non-standard audio frequency for DVD&quot;));
         diaElemToggle openDml(&amp;use_odml,QT_TR_NOOP(&quot;Create _OpenDML files&quot;));
@@ -324,8 +333,8 @@
 
         
         /* Video */
-        diaElem *diaVideo[]={&amp;menuVideoMode,&amp;framePP,&amp;useVdpau};
-        diaElemTabs tabVideo(QT_TR_NOOP(&quot;Video&quot;),3,(diaElem **)diaVideo);
+        diaElem *diaVideo[]={&amp;menuVideoMode,&amp;framePP,&amp;useVdpau,&amp;useOpenGl};
+        diaElemTabs tabVideo(QT_TR_NOOP(&quot;Video&quot;),4,(diaElem **)diaVideo);
         
         /* CPU tab */
 		diaElem *diaCpu[]={&amp;frameSimd};
@@ -342,7 +351,10 @@
         diaElemTabs *tabs[]={&amp;tabUser,&amp;tabOutput,&amp;tabAudio,&amp;tabVideo,&amp;tabCpu,&amp;tabThreading};
         if( diaFactoryRunTabs(QT_TR_NOOP(&quot;Preferences&quot;),6,tabs))
 	{
-        	
+        	//
+#ifdef USE_OPENGL
+          prefs-&gt;set(FEATURES_ENABLE_OPENGL,hasOpenGl);
+#endif
         	// cpu caps
         		if(capsAll)
         		{

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h	2011-08-05 05:57:09 UTC (rev 7385)
@@ -52,5 +52,6 @@
 
 bool UI_setVUMeter( uint32_t volume[6]); // Volume between 0 and 255.
 bool UI_setDecoderName(const char *name);
+bool UI_hasOpenGl(void);
 #endif
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-08-05 05:57:09 UTC (rev 7385)
@@ -31,5 +31,6 @@
 typedef void APIENTRY (GlActiveTexture_Type)(GLenum texture);
 bool ADM_setActiveTexture(GlActiveTexture_Type *set);
 GlActiveTexture_Type *ADM_getActiveTexture(void);
+bool ADM_hasActiveTexture(void);
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-08-05 05:57:09 UTC (rev 7385)
@@ -28,7 +28,16 @@
 }
 
 /**
+    \fn ADM_hasActiveTexture
+*/
+bool ADM_hasActiveTexture(void)
+{
+    if(!myActiveTexture) return false;
+    return true;
+}
 
+/**
+
 */
 bool ADM_setGlWidget(QGLWidget *w)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-08-05 05:57:09 UTC (rev 7385)
@@ -36,6 +36,7 @@
 #include &quot;DIA_coreToolkit.h&quot;
 
 #ifdef USE_OPENGL
+extern bool ADM_hasActiveTexture(void);
 void UI_Qt4InitGl(void);
 void UI_Qt4CleanGl(void);
 #endif
@@ -835,7 +836,10 @@
 	checkCrashFile();
     // Create an openGL context
 #ifdef USE_OPENGL
-    UI_Qt4InitGl();
+    bool enabled;
+    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
+    if(enabled)
+        UI_Qt4InitGl();
 #endif
 
 	if (global_argc &gt;= 2)
@@ -843,7 +847,8 @@
 
     myApplication-&gt;exec();
 #ifdef USE_OPENGL
-   UI_Qt4CleanGl();
+    if(enabled)
+        UI_Qt4CleanGl();
 #endif
 	destroyTranslator();
     delete myApplication;
@@ -1228,5 +1233,19 @@
     WIDGET(labelVideoDecoder)-&gt;setText(name);	
     return true;
 }
+/**
+    \fn UI_hasOpengl
+*/
+bool UI_hasOpenGl(void)
+{
+#ifndef USE_OPENGL
+    return false;
+#else
+    if(!ADM_hasActiveTexture()) return false; // ADM_setActiveTexure
+    bool enabled;
+    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
+    return enabled;
+#endif
+}
 //********************************************
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/prefs2_list.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/prefs2_list.h	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/prefs2_list.h	2011-08-05 05:57:09 UTC (rev 7385)
@@ -10,6 +10,7 @@
 FEATURES_MPEG_NO_LIMIT, 	//bool
 FEATURES_ALTERNATE_MP3_TAG, 	//bool
 FEATURES_VDPAU, 	//bool
+FEATURES_ENABLE_OPENGL, 	//bool
 LASTFILES_LASTDIR_READ, 	//string
 LASTFILES_LASTDIR_WRITE, 	//string
 LASTFILES_FILE1, 	//string

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.conf	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.conf	2011-08-05 05:57:09 UTC (rev 7385)
@@ -26,6 +26,7 @@
 bool:mpeg_no_limit,                    0,      0,      1
 bool:alternate_mp3_tag,                1,      0,      1
 bool:vdpau,                            0,      0,      1
+bool:enable_opengl,                    0,      0,      1
 }
 #
 lastfiles{

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.h	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2.h	2011-08-05 05:57:09 UTC (rev 7385)
@@ -15,6 +15,7 @@
 	bool mpeg_no_limit;
 	bool alternate_mp3_tag;
 	bool vdpau;
+	bool enable_opengl;
 }features;
 struct  {
 	char * lastdir_read;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_desc.cpp	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_desc.cpp	2011-08-05 05:57:09 UTC (rev 7385)
@@ -12,6 +12,7 @@
  {&quot;features.mpeg_no_limit&quot;,offsetof(my_prefs_struct,features.mpeg_no_limit),&quot;bool&quot;,ADM_param_bool},
  {&quot;features.alternate_mp3_tag&quot;,offsetof(my_prefs_struct,features.alternate_mp3_tag),&quot;bool&quot;,ADM_param_bool},
  {&quot;features.vdpau&quot;,offsetof(my_prefs_struct,features.vdpau),&quot;bool&quot;,ADM_param_bool},
+ {&quot;features.enable_opengl&quot;,offsetof(my_prefs_struct,features.enable_opengl),&quot;bool&quot;,ADM_param_bool},
  {&quot;lastfiles.lastdir_read&quot;,offsetof(my_prefs_struct,lastfiles.lastdir_read),&quot;char *&quot;,ADM_param_string},
  {&quot;lastfiles.lastdir_write&quot;,offsetof(my_prefs_struct,lastfiles.lastdir_write),&quot;char *&quot;,ADM_param_string},
  {&quot;lastfiles.file1&quot;,offsetof(my_prefs_struct,lastfiles.file1),&quot;char *&quot;,ADM_param_string},

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_json.cpp	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_json.cpp	2011-08-05 05:57:09 UTC (rev 7385)
@@ -18,6 +18,7 @@
 json.addBool(&quot;mpeg_no_limit&quot;,key-&gt;features.mpeg_no_limit);
 json.addBool(&quot;alternate_mp3_tag&quot;,key-&gt;features.alternate_mp3_tag);
 json.addBool(&quot;vdpau&quot;,key-&gt;features.vdpau);
+json.addBool(&quot;enable_opengl&quot;,key-&gt;features.enable_opengl);
 json.endNode();
 json.addNode(&quot;lastfiles&quot;);
 json.addString(&quot;lastdir_read&quot;,key-&gt;lastfiles.lastdir_read);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_pref.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_pref.h	2011-08-04 05:54:25 UTC (rev 7384)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs2_pref.h	2011-08-05 05:57:09 UTC (rev 7385)
@@ -23,6 +23,7 @@
 { FEATURES_MPEG_NO_LIMIT,&quot;features.mpeg_no_limit&quot;                     ,ADM_param_bool    	,&quot;0&quot;,	0,	1},
 { FEATURES_ALTERNATE_MP3_TAG,&quot;features.alternate_mp3_tag&quot;             ,ADM_param_bool    	,&quot;1&quot;,	0,	1},
 { FEATURES_VDPAU,&quot;features.vdpau&quot;                                     ,ADM_param_bool    	,&quot;0&quot;,	0,	1},
+{ FEATURES_ENABLE_OPENGL,&quot;features.enable_opengl&quot;                     ,ADM_param_bool    	,&quot;0&quot;,	0,	1},
 { LASTFILES_LASTDIR_READ,&quot;lastfiles.lastdir_read&quot;                     ,ADM_param_string  	,&quot;&quot;,	0,	0},
 { LASTFILES_LASTDIR_WRITE,&quot;lastfiles.lastdir_write&quot;                   ,ADM_param_string  	,&quot;&quot;,	0,	0},
 { LASTFILES_FILE1,&quot;lastfiles.file1&quot;                                   ,ADM_param_string  	,&quot;&quot;,	0,	0},


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004535.html">[Avidemux-svn-commit] r7384 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src	avidemux_plugins/ADM_videoFilters6_openGl/sample_fragment2
</A></li>
	<LI>Next message: <A HREF="004537.html">[Avidemux-svn-commit] r7386 - in	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_script	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4536">[ date ]</a>
              <a href="thread.html#4536">[ thread ]</a>
              <a href="subject.html#4536">[ subject ]</a>
              <a href="author.html#4536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
