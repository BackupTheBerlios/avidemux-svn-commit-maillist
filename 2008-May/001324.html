<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4067 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_filter	ADM_videoFilter plugins/ADM_videoFilters	plugins/ADM_videoFilters/ASharp plugins/ADM_videoFilters/ASharp/gtk	plugins/ADM_videoFilters/ASharp/qt4	plugins/ADM_videoFilters/Contrast	plugins/ADM_videoFilters/Contrast/gtk	plugins/ADM_videoFilters/Contrast/qt4 plugins/ADM_videoFilters/Crop	plugins/ADM_videoFilters/Crop/gtk plugins/ADM_videoFilters/Crop/qt4	plugins/ADM_videoFilters/Eq2 plugins/ADM_videoFilters/Eq2/gtk	plugins/ADM_videoFilters/Eq2/qt4 plugins/ADM_videoFilters/Hue	plugins/ADM_videoFilters/Hue/gtk plugins/ADM_videoFilters/Hue/qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4067%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_filter%0A%09ADM_videoFilter%20plugins/ADM_videoFilters%0A%09plugins/ADM_videoFilters/ASharp%20plugins/ADM_videoFilters/ASharp/gtk%0A%09plugins/ADM_videoFilters/ASharp/qt4%0A%09plugins/ADM_videoFilters/Contrast%0A%09plugins/ADM_videoFilters/Contrast/gtk%0A%09plugins/ADM_videoFilters/Contrast/qt4%20plugins/ADM_videoFilters/Crop%0A%09plugins/ADM_videoFilters/Crop/gtk%20plugins/ADM_videoFilters/Crop/qt4%0A%09plugins/ADM_videoFilters/Eq2%20plugins/ADM_videoFilters/Eq2/gtk%0A%09plugins/ADM_videoFilters/Eq2/qt4%20plugins/ADM_videoFilters/Hue%0A%09plugins/ADM_videoFilters/Hue/gtk%20plugins/ADM_videoFilters/Hue/qt4&In-Reply-To=%3C200805261750.m4QHoOKV020529%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001323.html">
   <LINK REL="Next"  HREF="001325.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4067 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_filter	ADM_videoFilter plugins/ADM_videoFilters	plugins/ADM_videoFilters/ASharp plugins/ADM_videoFilters/ASharp/gtk	plugins/ADM_videoFilters/ASharp/qt4	plugins/ADM_videoFilters/Contrast	plugins/ADM_videoFilters/Contrast/gtk	plugins/ADM_videoFilters/Contrast/qt4 plugins/ADM_videoFilters/Crop	plugins/ADM_videoFilters/Crop/gtk plugins/ADM_videoFilters/Crop/qt4	plugins/ADM_videoFilters/Eq2 plugins/ADM_videoFilters/Eq2/gtk	plugins/ADM_videoFilters/Eq2/qt4 plugins/ADM_videoFilters/Hue	plugins/ADM_videoFilters/Hue/gtk plugins/ADM_videoFilters/Hue/qt4</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4067%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_filter%0A%09ADM_videoFilter%20plugins/ADM_videoFilters%0A%09plugins/ADM_videoFilters/ASharp%20plugins/ADM_videoFilters/ASharp/gtk%0A%09plugins/ADM_videoFilters/ASharp/qt4%0A%09plugins/ADM_videoFilters/Contrast%0A%09plugins/ADM_videoFilters/Contrast/gtk%0A%09plugins/ADM_videoFilters/Contrast/qt4%20plugins/ADM_videoFilters/Crop%0A%09plugins/ADM_videoFilters/Crop/gtk%20plugins/ADM_videoFilters/Crop/qt4%0A%09plugins/ADM_videoFilters/Eq2%20plugins/ADM_videoFilters/Eq2/gtk%0A%09plugins/ADM_videoFilters/Eq2/qt4%20plugins/ADM_videoFilters/Hue%0A%09plugins/ADM_videoFilters/Hue/gtk%20plugins/ADM_videoFilters/Hue/qt4&In-Reply-To=%3C200805261750.m4QHoOKV020529%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4067 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_filter	ADM_videoFilter plugins/ADM_videoFilters	plugins/ADM_videoFilters/ASharp plugins/ADM_videoFilters/ASharp/gtk	plugins/ADM_videoFilters/ASharp/qt4	plugins/ADM_videoFilters/Contrast	plugins/ADM_videoFilters/Contrast/gtk	plugins/ADM_videoFilters/Contrast/qt4 plugins/ADM_videoFilters/Crop	plugins/ADM_videoFilters/Crop/gtk plugins/ADM_videoFilters/Crop/qt4	plugins/ADM_videoFilters/Eq2 plugins/ADM_videoFilters/Eq2/gtk	plugins/ADM_videoFilters/Eq2/qt4 plugins/ADM_videoFilters/Hue	plugins/ADM_videoFilters/Hue/gtk plugins/ADM_videoFilters/Hue/qt4">mean at mail.berlios.de
       </A><BR>
    <I>Mon May 26 19:50:24 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001323.html">[Avidemux-svn-commit] r4066 - in	branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters:	AvisynthResize/qt4 MplayerResize/qt4
</A></li>
        <LI>Next message: <A HREF="001325.html">[Avidemux-svn-commit] r4068 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_filter avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_video avidemux/ADM_videoFilter	avidemux/plugins/ADM_videoFilters	avidemux/plugins/ADM_videoFilters/Rotate	avidemux/plugins/ADM_videoFilters/Srt	avidemux/plugins/ADM_videoFilters/Srt/gtk	avidemux/plugins/ADM_videoFilters/Srt/qt4	avidemux/plugins/ADM_videoFilters/Tdeint cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1324">[ date ]</a>
              <a href="thread.html#1324">[ thread ]</a>
              <a href="subject.html#1324">[ subject ]</a>
              <a href="author.html#1324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-05-26 19:50:21 +0200 (Mon, 26 May 2008)
New Revision: 4067

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidAsharp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/CMakeLists.txt
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/gtk/DIA_asharp.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/gtk/DIA_contrast.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/gtk/DIA_crop.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/gtk/DIA_eq2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/gtk/DIA_hue.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
Log:
[Filters] FlyDialog


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -43,22 +43,11 @@
 
 //ko -- ko -- ko -- ko ko --ko -ko
 	
-// VF_FIXME REGISTERX(VF_TRANSFORM, &quot;crop&quot;,QT_TR_NOOP(&quot;Crop&quot;),QT_TR_NOOP(&quot;Remove lines from top/bottom/left/right.&quot;),VF_CROP,1,crop_create,crop_script);  
+  
 REGISTERX(VF_TRANSFORM, &quot;rotate&quot;,QT_TR_NOOP(&quot;Rotate&quot;),QT_TR_NOOP(&quot;Rotate the picture by 90, 180 or 270 degrees.&quot;),VF_ROTATE,1,rotate_create,rotate_script);
 REGISTERX(VF_INTERLACING, &quot;tdeint&quot;,QT_TR_NOOP(&quot;TDeint&quot;),QT_TR_NOOP(&quot;Motion adaptative deinterlacer by Tritical.&quot;),VF_TDEINT,1,tdeint_create,tdeint_script);
 
-//FLyDyalog
-#if 0
-    REGISTERX(VF_COLORS, &quot;eq2&quot;,QT_TR_NOOP(&quot;MPlayer eq2&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness, saturation and gamma.&quot;),VF_EQ2,1,Eq2_create,Eq2_script);
-    REGISTERX(VF_COLORS, &quot;hue&quot;,QT_TR_NOOP(&quot;MPlayer hue&quot;),QT_TR_NOOP(&quot;Adjust hue and saturation.&quot;),VF_HUE,1,hue_create,hue_script);
-    REGISTERX(VF_COLORS, &quot;contrast&quot;,QT_TR_NOOP(&quot;Contrast&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness and colors.&quot;),VF_CONTRAST,1,contrast_create,contrast_script);
-    REGISTERX(VF_SHARPNESS, &quot;asharp&quot;,QT_TR_NOOP(&quot;asharp&quot;),QT_TR_NOOP(&quot;Adaptative sharpener by MarcFD.&quot;),VF_ASHARP,1,asharp_create,asharp_script);    
-#endif    
 
-// Custom UI    
-	
-
-
 REGISTERX(VF_MISC, &quot;animatedmenu&quot;,QT_TR_NOOP(&quot;Animated Menu&quot;), QT_TR_NOOP(&quot;Create a video made of 6 mini windows, very useful to do DVD menus.&quot;),
         VF_ANIMATED,1,animated_create,animated_script);
     

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,18 +0,0 @@
-
-#ifndef _ASHARP_PARAM
-#define _ASHARP_PARAM
-#define uc uint8_t
-#define bool uint8_t
-
- void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf );
-
-typedef struct ASHARP_PARAM
-{
-        double          t; // Threshold 0:nothing max : 5 ?
-        double          d; // Strength : 0 means nothing, &gt;0  adaptative t is maximum
-        double          b; // Block adaptative sharpening -1 disabled
-        uint32_t        bf;
-}ASHARP_PARAM;
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,284 +0,0 @@
-/**/
-/***************************************************************************
-                          ADM_vidASharp  -  description
-                             -------------------   
-    Port of avisynth one
-
- ***************************************************************************/
-/*
-        
-        Copyright (C) 2003 Donald A. Graft
-        Copyright (C) 2002 Marc Fauconneau
-        This program is free software; you can redistribute it and/or modify
-        it under the terms of the GNU General Public License as published by
-        the Free Software Foundation.
-
-        This program is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-        GNU General Public License for more details.
-
-        You should have received a copy of the GNU General Public License
-        along with this program; if not, write to the Free Software
-        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-*/
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_videoFilter.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-#include &quot;ADM_vidASharp_param.h&quot;
-class ASharp : public AVDMGenericVideoStream
-{
-private:
-        
-        VideoCache      *vidCache;
-        ASHARP_PARAM    *_param;
-        int32_t        T,D,B,B2;
-        
-public:    
-
-                        ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)   ;
-                        ~ASharp();
-
-
-                        void update(void);         
-        char            *printConf( void );
-        uint8_t         configure(AVDMGenericVideoStream *in);
-        uint8_t         getCoupledConf( CONFcouple **couples);
-        uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-};
-
-BUILD_CREATE(asharp_create,ASharp);
-static FILTER_PARAM asharp_param={4,{&quot;t&quot;, &quot;b&quot;,&quot;d&quot;, &quot;bf&quot;}};
-
-
-SCRIPT_CREATE(asharp_script,ASharp,asharp_param);
-//_______________________________________________
-
-ASharp::ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)
-
-{
-        _in=in;         
-        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-        _info.encoding=1;
-        _uncompressed=NULL;             
-        _info.encoding=1;
-
-
-        _param=new ASHARP_PARAM;
-       
-        if(couples)
-                {
-                     GET(t);
-                     GET(d);
-                     GET(b);
-                     GET(bf); 
-                }
-                else // Default
-                {
-                        _param-&gt;t=2;
-                        _param-&gt;d=4;
-                        _param-&gt;b=-1;
-                        _param-&gt;bf=0;
-                }                              
-                update();
-                vidCache=new VideoCache(5,in);
-}
-//________________________________________________________
-void ASharp::update( void)
-{
-                // parameters floating point to fixed point convertion
-                T = (int)(_param-&gt;t*(4&lt;&lt;7));
-                D = (int)(_param-&gt;d*(4&lt;&lt;7));
-                B = (int)(256-_param-&gt;b*64);
-                B2= (int)(256-_param-&gt;b*48);
-
-                // clipping (recommended for SIMD code)
-
-                if (T&lt;-(4&lt;&lt;7)) T = -(4&lt;&lt;7); // yes, negatives values are accepted
-                if (D&lt;0) D = 0;
-                if (B&lt;0) B = 0;
-                if (B2&lt;0) B2 = 0;
-
-                if (T&gt;(32*(4&lt;&lt;7))) T = (32*(4&lt;&lt;7));
-                if (D&gt;(16*(4&lt;&lt;7))) D = (16*(4&lt;&lt;7));
-                if (B&gt;256) B = 256;
-                if (B2&gt;256) B2 = 256;
-
-}
-//________________________________________________________
-uint8_t ASharp::getCoupledConf( CONFcouple **couples)
-{
-        *couples=NULL;
-        *couples=new CONFcouple(4);
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-               CSET(t);
-               CSET(d);
-               CSET(b);
-               CSET(bf);    
-        return 1;
-}
-//________________________________________________________
-ASharp::~ASharp(void)
-{
-
-        if(vidCache) delete vidCache;     
-
-     
-        vidCache=NULL;
-
-}
-
-extern uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
-//________________________________________________________
-uint8_t ASharp::configure(AVDMGenericVideoStream *in)
-{
-uint8_t r=0;
-        _in=in;
-        if( DIA_getASharp(_param, _in))
-        {
-                r=1;
-        }
-        update();
-        return r;
-}
-
-//________________________________________________________
-char *ASharp::printConf( void )
-{
-        static char buf[50];
-
-        ADM_assert(_param);
-        sprintf((char *)buf,&quot; ASharp (MarcFD)&quot;);
-        return buf;
-}
-        
-//________________________________________________________
-uint8_t ASharp::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                ADMImage *data,uint32_t *flags)
-{
-ADMImage *src;
-ADMImage *dst;
-
-        dst=data;
-        if(frame&gt;=_info.nb_frames) return 0;
-        src=vidCache-&gt;getImage(frame);
-        dst-&gt;duplicate(src);
-        asharp_run_c(     dst-&gt;GetWritePtr(PLANAR_Y),
-                        dst-&gt;GetPitch(PLANAR_Y), 
-                        _info.height,
-                        _info.width,
-                        T,
-                        D,
-                        B,
-                        B2,
-                        _param-&gt;bf);
-
-        vidCache-&gt;unlockAll();
-
-        return 1;
-}
-
-
-
-
-void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf )
-        {
-                uc* lineptr = new uc[width];
-                int p = pitch;
-                int y,x;
-                uc* cfp = planeptr+pitch;
-                uc* lp = lineptr;
-                memcpy(lp,planeptr,width);
-                for (y=1;y&lt;height-1;y++) {
-                        int last = cfp[0];
-                        for (x=0;x&lt;width-1;x++) {
-
-                                int avg = 0;
-                                int dev = 0;
-                                int T2;
-                                int diff;
-                                int tmp;
-
-                                avg += lp[x-1];
-                                avg += lp[x  ];
-                                avg += lp[x+1];
-                                avg += last;
-                                avg += cfp[x    ];
-                                avg += cfp[x  +1];
-                                avg += cfp[x+p-1];
-                                avg += cfp[x+p  ];
-                                avg += cfp[x+p+1];
-
-                                avg *= (65535/9);
-                                avg &gt;&gt;= 16;
-
-                                #define CHECK(A) \
-                                if (abs(A-cfp[x])&gt;dev) dev = abs(A-cfp[x]);
-                                
-                                if (bf) {
-
-                                if (y%8&gt;0) {
-                                        if (x%8&gt;0) CHECK(lp[x-1])
-                                        CHECK(lp[x  ])
-                                        if (x%8&lt;7) CHECK(lp[x+1])
-                                }
-                                if (x%8&gt;0) CHECK(last)
-                                if (x%8&lt;7) CHECK(cfp[x  +1])
-                                if (y%8&lt;7) {
-                                        if (x%8&gt;0) CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        if (x%8&lt;7) CHECK(cfp[x+p+1])
-                                }
-
-                                } else {
-                                        CHECK(lp[x-p-1])
-                                        CHECK(lp[x-p  ])
-                                        CHECK(lp[x-p+1])
-                                        CHECK(last)
-                                        CHECK(cfp[x  +1])
-                                        CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        CHECK(cfp[x+p+1])
-                                }
-
-                                T2 = T;
-                                diff = cfp[x]-avg;
-                                int D2 = D;
-
-                                if (x%8==6) D2=(D2*B2)&gt;&gt;8;
-                                if (x%8==7) D2=(D2*B)&gt;&gt;8;
-                                if (x%8==0) D2=(D2*B)&gt;&gt;8;
-                                if (x%8==1) D2=(D2*B2)&gt;&gt;8;
-                                if (y%8==6) D2=(D2*B2)&gt;&gt;8;
-                                if (y%8==7) D2=(D2*B)&gt;&gt;8;
-                                if (y%8==0) D2=(D2*B)&gt;&gt;8;
-                                if (y%8==1) D2=(D2*B2)&gt;&gt;8;
-
-                                int Da = -32+(D&gt;&gt;7);
-                                if (D&gt;0) T2 = ((((dev&lt;&lt;7)*D2)&gt;&gt;16)+Da)&lt;&lt;4;
-
-                                if (T2&gt;T) T2=T;
-                                if (T2&lt;-32) T2=-32;
-
-                                tmp = (((diff&lt;&lt;7)*T2)&gt;&gt;16)+cfp[x];
-
-                                if (tmp &lt; 0) tmp = 0;
-                                if (tmp &gt; 255) tmp = 255;
-                                lp[x-1] = last;
-                                last = cfp[x];
-                                cfp[x] = tmp;
-                        }
-                        lp[x] = cfp[x];
-                        cfp += pitch;
-                }
-        delete[] lineptr;
-} 
-//**********************************

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,230 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.cpp  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &quot;ADM_default.h&quot;
-#include &lt;math.h&gt;
-
-
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
-
-static FILTER_PARAM contrastParam =
-  { 5, {&quot;offset&quot;, &quot;coef&quot;, &quot;doLuma&quot;, &quot;doChromaU&quot;, &quot;doChromaV&quot;} };
-
-
-SCRIPT_CREATE (contrast_script, ADMVideoContrast, contrastParam);
-
-BUILD_CREATE (contrast_create, ADMVideoContrast);
-
-char *
-ADMVideoContrast::printConf (void)
-{
-  static char buf[50];
-
-  ADM_assert (_param);
-  sprintf ((char *) buf, &quot; contrast : %1.2f %d&quot;, _param-&gt;coef,
-	   _param-&gt;offset);
-  return buf;
-}
-
-//_______________________________________________________________
-
-ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
-				    CONFcouple * couples)
-{
-
-
-  _in = in;
-  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  //   _uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
-  _uncompressed =
-    new ADMImage (_in-&gt;getInfo ()-&gt;width, _in-&gt;getInfo ()-&gt;height);
-  ADM_assert (_uncompressed);
-  _param = NULL;
-  if (couples)
-    {
-      _param = NEW (CONTRAST_PARAM);
-      GET (offset);
-      GET (coef);
-      GET (doLuma);
-      GET (doChromaU);
-      GET (doChromaV);
-    }
-  else
-    {
-      _param = NEW (CONTRAST_PARAM);
-      _param-&gt;offset = 0;
-      _param-&gt;coef = 1.0f;
-      _param-&gt;doLuma = 1;
-      _param-&gt;doChromaU = 1;
-      _param-&gt;doChromaV = 1;
-
-    }
-  buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
-
-
-}
-
-
-uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
-{
-
-  ADM_assert (_param);
-  *couples = new CONFcouple (5);
-
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-  CSET (offset);
-  CSET (coef);
-  CSET (doLuma);
-  CSET (doChromaU);
-  CSET (doChromaV);
-  return 1;
-
-}
-ADMVideoContrast::~ADMVideoContrast ()
-{
-  if (_uncompressed)
-    delete _uncompressed;
-  _uncompressed = 0;
-  DELETE (_param);
-}
-
-//
-//      Remove y and v just keep U and expand it
-//
-uint8_t
-  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
-					   uint32_t * len,
-					   ADMImage * data, uint32_t * flags)
-{
-  //uint32_t x,w;
-
-  ADM_assert (_param);
- if(frame&gt;= _info.nb_frames) return 0;
-
-
-  if (!_in-&gt;getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
-    return 0;
-  *len = _info.width * _info.height + (_info.width * _info.height &gt;&gt; 1);
-
-  uint32_t sz = _info.width * _info.height;
-  // luma 
-  if (_param-&gt;doLuma)
-    {
-      if (!doContrast (_uncompressed-&gt;data, data-&gt;data, _tableFlat,
-		       _info.width, _info.height))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data, _uncompressed-&gt;data, sz);
-    }
-  // ______u_____________         
-
-  if (_param-&gt;doChromaU)
-    {
-      if (!doContrast (_uncompressed-&gt;data + sz, data-&gt;data + sz, _tableNZ,
-		       _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data + sz, _uncompressed-&gt;data + sz, sz &gt;&gt; 2);
-    }
-
-  // ______v_____________         
-  if (_param-&gt;doChromaV)
-    {
-
-      if (!doContrast
-	  (_uncompressed-&gt;data + sz + (sz &gt;&gt; 2), data-&gt;data + sz + (sz &gt;&gt; 2),
-	   _tableNZ, _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data + sz + (sz &gt;&gt; 2),
-	      _uncompressed-&gt;data + sz + (sz &gt;&gt; 2), sz &gt;&gt; 2);
-    }
-
-
-
-
-  return 1;
-}
-
-uint8_t
-buildContrastTable (float coef, int8_t off,
-		    uint8_t * tableFlat, uint8_t * tableNZ)
-{
-  float f;
-
-  for (uint32_t i = 0; i &lt; 256; i++)
-    {
-      f = i;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-      f += off;
-      if (f &lt; 0.)
-	f = 0.;
-      if (f &gt; 255.)
-	f = 255.;
-      *(tableFlat + i) = (uint8_t) floor (f);
-
-      f = i;
-      f -= 128;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-
-//                                      f+=off;
-      if (f &lt; -127.)
-	f = -127.;
-      if (f &gt; 127.)
-	f = 127.;
-      f += 128.;
-      *(tableNZ + i) = (uint8_t) floor (f);
-    }
-  return 0;
-}
-
-uint8_t
-doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
-	    uint32_t w, uint32_t h)
-{
-
-  for (uint32_t y = h * w; y &gt; 0; y--)
-    {
-      *out++ = table[*in++];
-    }
-
-  return 1;
-
-}
-uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
-uint8_t
-ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
-{
-  if(DIA_contrast(_in,_param))
-  {
-    buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
-    return 1;
-  }
-  return 0;
-}
-
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,57 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.h  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef _CONTRAST_
-#define _CONTRAST_
-
-typedef struct 
-{
-		float 	coef;
-		int32_t  offset;
-		uint32_t	doLuma;
-		uint32_t	doChromaU;
-		uint32_t	doChromaV;
-		
-	
-	}CONTRAST_PARAM;
-	
-  uint8_t buildContrastTable( float coef,int8_t off,	
-  								uint8_t *tableFlat,uint8_t *tableNZ);
-  uint8_t doContrast(uint8_t *in,uint8_t *out,uint8_t *table,
-												uint32_t w,uint32_t h);
-
-
- class  ADMVideoContrast:public AVDMGenericVideoStream
- {
-
- protected:
-				virtual char 					*printConf(void);
-				CONTRAST_PARAM					*_param;
-				uint8_t						_tableFlat[256];
-				uint8_t						_tableNZ[256];
-
- public:
-
-					ADMVideoContrast(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  					virtual ~ADMVideoContrast();
-		          virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          																	ADMImage *data,uint32_t *flags);
-					virtual uint8_t 	configure( AVDMGenericVideoStream *instream) ;
-
- 					virtual uint8_t	getCoupledConf( CONFcouple **couples);
- 				
- }     ;
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,217 +0,0 @@
-/***************************************************************************
-                          ADM_vidCrop.cpp  -  description
-                             -------------------
-          Crop top/left/right/bottom
-
-          Each one ,must be even
-
-
-    begin                : Sun Mar 24 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_videoFilter.h&quot;
-
-
-typedef struct
-{
-        uint32_t left,right;
-        uint32_t top,bottom;
-}CROP_PARAMS;
-
-class  AVDMVideoStreamCrop:public AVDMGenericVideoStream
- {
-
- protected:
-                CROP_PARAMS          *_param;
-
- public:
-
-                                AVDMVideoStreamCrop(  AVDMGenericVideoStream *in,CONFcouple *couples);
-        virtual                 ~AVDMVideoStreamCrop();
-        virtual uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                                                ADMImage *data,uint32_t *flags);
-        virtual char    *printConf(void) ;
-                  uint8_t       configure( AVDMGenericVideoStream *instream);
-          virtual uint8_t       getCoupledConf( CONFcouple **couples);
-
-
- }     ;
- 
-static FILTER_PARAM cropParam={4,{&quot;left&quot;,&quot;right&quot;,&quot;top&quot;,&quot;bottom&quot;}};
-
-
-SCRIPT_CREATE(crop_script,AVDMVideoStreamCrop,cropParam);
-
-char *AVDMVideoStreamCrop::printConf( void )
-{
- 	static char buf[50];
- 	
- 	sprintf((char *)buf,&quot; Crop %lu x %lu --&gt; %lu x %lu&quot;,
- 				_in-&gt;getInfo()-&gt;width,
- 				_in-&gt;getInfo()-&gt;height,
- 				_info.width,
- 				_info.height);
-        return buf;
-}
-
-//_______________________________________________________________
-
-AVDMVideoStreamCrop::AVDMVideoStreamCrop(
-									AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-
-  	_in=in;		
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-	
-		if(couples)
-		{
-			_param=	NEW(CROP_PARAMS);
-			GET(left);
-			GET(right);
-			GET(top);
-			GET(bottom);
-				// Consistency check
-				if(  _in-&gt;getInfo()-&gt;width&lt;(_param-&gt;right+_param-&gt;left))
-						{
-                      		printf(&quot;\n Warning Cropping too much width ! Width reseted !\n&quot;);
-								_param-&gt;right=_param-&gt;left=0;
-						}
-				if(  _in-&gt;getInfo()-&gt;height&lt;(_param-&gt;bottom+_param-&gt;top))
-						{
-                      		printf(&quot;\n Warning Cropping too much height ! Height reseted !\n&quot;);
-								_param-&gt;bottom=_param-&gt;top=0;
-						}
-
-			_info.width=_in-&gt;getInfo()-&gt;width-_param-&gt;right-_param-&gt;left;		
-			_info.height=_in-&gt;getInfo()-&gt;height-_param-&gt;bottom-_param-&gt;top;	
-			
-		}	
-			else 			
-		{	// default parameter	
-				_param=	NEW(CROP_PARAMS); ;
-				_param-&gt;left=_param-&gt;top=
-				_param-&gt;right=_param-&gt;bottom=0;
-		}				
-					
- 	//_uncompressed=(uint8_t *)malloc(3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height);
- 	//_uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
-	_uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
-  	ADM_assert(_uncompressed);
-  	_info.encoding=1;
-	  
-
-  	  	
-}
-AVDMVideoStreamCrop::~AVDMVideoStreamCrop()
-{
- 	delete _uncompressed;
- 	DELETE(_param);
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoStreamCrop::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-
-			ADM_assert(frame&lt;_info.nb_frames);
-			ADM_assert(_param);									
-		if(frame&gt;= _info.nb_frames) return 0;
-			// read uncompressed frame
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-       		
-       		// Crop Y luma
-       		uint32_t y,x,line;
-       		uint8_t *src,*src2,*dest;
-       		
-       		y=_in-&gt;getInfo()-&gt;height;
-       		x=_in-&gt;getInfo()-&gt;width;
-       		line=_info.width;
-       		src=YPLANE(_uncompressed)+_param-&gt;top*x+_param-&gt;left;
-       		dest=YPLANE(data);
-       		
-       		for(uint32_t k=_info.height;k&gt;0;k--)
-       			{
-       			 	    memcpy(dest,src,line);
-       			 	    src+=x;
-       			 	    dest+=line;
-       			}
-       		 // Crop U  &amp; V
-       		 	src=UPLANE(_uncompressed)+(x*_param-&gt;top&gt;&gt;2)+(_param-&gt;left&gt;&gt;1);
-       		 	src2=VPLANE(_uncompressed)+(x*_param-&gt;top&gt;&gt;2)+(_param-&gt;left&gt;&gt;1);
-			dest=UPLANE(data);
-       		 	line&gt;&gt;=1;
-       		 	x&gt;&gt;=1;       		       		 	
-       		 		for(uint32_t k=((_info.height)&gt;&gt;1);k&gt;0;k--)
-       		 		{
-       		 	    	  	memcpy(dest,src,line);
-       			 	    	src+=x;
-       			 	    	dest+=line;
-       		 		}
-			dest=VPLANE(data);	
-       		 		for(uint32_t k=((_info.height)&gt;&gt;1);k&gt;0;k--)
-       		 		{
-       		 	    	  	memcpy(dest,src2,line);
-       			 	    	src2+=x;
-       			 	    	dest+=line;
-       		 		}	
-       		  *flags=0;
-       		  *len= _info.width*_info.height+(_info.width*_info.height&gt;&gt;1);
-		  data-&gt;copyInfo(_uncompressed);
-      return 1;
-}
-/**
-	Return the configuration as a couple of string
-	Up to the client to free them afterward
-*/
-uint8_t	AVDMVideoStreamCrop::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_assert(_param);
-			*couples=new CONFcouple(4);
-
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-			CSET(left);
-			CSET(right);
-			CSET(top);
-			CSET(bottom);
-			return 1;
-
-}
-extern int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in);
-uint8_t AVDMVideoStreamCrop::configure( AVDMGenericVideoStream *instream)
-
-{
-		uint8_t r;
-		uint32_t w,h;
-    	if(r = (DIA_getCropParams(&quot;Crop Settings&quot;,_param,instream )))
-    	{
-			w=_param-&gt;left+_param-&gt;right;
-			h=_param-&gt;top+_param-&gt;bottom;
-			ADM_assert(w&lt;instream-&gt;getInfo()-&gt;width);
-			ADM_assert(h&lt;instream-&gt;getInfo()-&gt;height);
-			_info.width=instream-&gt;getInfo()-&gt;width-w;
-			_info.height=instream-&gt;getInfo()-&gt;height-h;
-		}
-		return r;
-}
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,387 +0,0 @@
-/***************************************************************************
-                          Hue/Saturation filter ported from mplayer 
- (c)  * Software equalizer (brightness, contrast, gamma, saturation)
- *
- * Hampa Hug &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">hampa at hampa.ch</A>&gt; (original LUT gamma/contrast/brightness filter)
- * Daniel Moreno &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">comac at comac.darktech.org</A>&gt; (saturation, R/G/B gamma support)
- * Richard Felker (original MMX contrast/brightness code (vf_eq.c))
- * Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michalni at gmx.at</A>&gt; (LUT16)
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &quot;ADM_default.h&quot;
-#include &lt;math.h&gt;
-
-
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;DIA_factory.h&quot;
-
-
-
-#include &quot;ADM_vidEq2.h&quot;
-static FILTER_PARAM Eq2Param={8,{&quot;contrast&quot;,&quot;brightness&quot;,&quot;saturation&quot;,
-                                &quot;gamma&quot;,&quot;gamma_weight&quot;,&quot;rgamma&quot;,&quot;ggamma&quot;,&quot;bgamma&quot;}};
-
-/*=====================================*/
-/*=====================================*/
-class  ADMVideoEq2:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            void            update(void);
-            Eq2_Param       *_param;    
-            VideoCache      *vidCache; 
-            float           _hue;
-            float           _saturation;
-            Eq2Settings     settings;            
-  public:
-                
-                        ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *setup);
-    virtual             ~ADMVideoEq2();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(Eq2_script,ADMVideoEq2,Eq2Param);
-BUILD_CREATE(Eq2_create,ADMVideoEq2);
-
-
-uint8_t ADMVideoEq2::configure(AVDMGenericVideoStream *in)
-{
-  uint8_t r=1;
-  float h,s;
-  _in=in;   
-  r=DIA_getEQ2Param(_param,in);
-  update();
-  return r;        
-}
-char *ADMVideoEq2::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf,&quot; Eq2 :Cont:%1.2f Brigh:%1.2f Sat:%1.2f&quot;,
-                _param-&gt;contrast,_param-&gt;brightness,_param-&gt;saturation);
-  return buf;
-}
-
-ADMVideoEq2::ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  Eq2_Param;
-  if(couples)
-  {                 
-    GET(contrast); 
-    GET(brightness);    
-    GET(saturation); 
-    GET(gamma); 
-    GET(gamma_weight); 
-    GET(rgamma); 
-    GET(ggamma); 
-    GET(bgamma); 
-  }
-  else
-  {
-    _param-&gt;contrast =1.0;                
-    _param-&gt;brightness=0.0;
-    _param-&gt;saturation =1.0;  
-    _param-&gt;gamma =1.0; 
-    _param-&gt;gamma_weight=1.0; 
-    _param-&gt;rgamma =1.0; 
-    _param-&gt;ggamma =1.0; 
-    _param-&gt;bgamma =1.0;    
-  }      
-  vidCache=new VideoCache(1,_in);
-  update();
-    
-   
-}
-void ADMVideoEq2::update(void)
-{
-   update_lut(&amp;settings,_param);      
-}
-ADMVideoEq2::~ADMVideoEq2()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoEq2::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(8);
-
-
-                CSET(contrast);
-                CSET(brightness);
-                CSET(saturation);
-                CSET(gamma); 
-                CSET(gamma_weight); 
-                CSET(rgamma); 
-                CSET(ggamma); 
-                CSET(bgamma); 
-                return 1;
-}
-
-
-uint8_t ADMVideoEq2::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc=NULL;
-  
-
-  if(frame&gt;=_info.nb_frames) return 0;
-  
-  mysrc=vidCache-&gt;getImage(frame);
-  if(!mysrc) return 0;
-  
-  uint32_t w,h;
-  w=_info.width;
-  h=_info.height;
-
-#ifdef ADM_CPU_X86
-  if(CpuCaps::hasMMX())
-  {
-        affine_1d_MMX(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w&gt;&gt;=1;
-        h&gt;&gt;=1;
-        affine_1d_MMX(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        affine_1d_MMX(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-   }
-   else
-#endif
-   {
-        apply_lut(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w&gt;&gt;=1;
-        h&gt;&gt;=1;
-        apply_lut(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        apply_lut(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-    }
-  vidCache-&gt;unlockAll();
-  
-  
-  return 1;
-}
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param)
-{
-     memset(settings,0,sizeof(settings));
-
-    settings-&gt;param[0].lut_clean=0;
-    settings-&gt;param[1].lut_clean=0;
-    settings-&gt;param[2].lut_clean=0;
-    settings-&gt;contrast=_param-&gt;contrast;
-    settings-&gt;brightness=_param-&gt;brightness;
-    settings-&gt;saturation=_param-&gt;saturation;
-    
-    settings-&gt;ggamma=_param-&gt;ggamma;
-    settings-&gt;bgamma=_param-&gt;bgamma;
-    settings-&gt;rgamma=_param-&gt;rgamma;
-    settings-&gt;gamma=_param-&gt;gamma;
-
-    settings-&gt;gamma_weight=_param-&gt;gamma_weight;
-    
-    if(settings-&gt;ggamma&lt;0.1) settings-&gt;ggamma=0.1;
-    
-    settings-&gt;param[0].c=_param-&gt;contrast;  
-    settings-&gt;param[0].b=_param-&gt;brightness;;
-    settings-&gt;param[0].g=settings-&gt;gamma*settings-&gt;ggamma;
-    settings-&gt;param[0].w=settings-&gt;gamma_weight;
-    
-    
-    	
-    settings-&gt;param[1].c=_param-&gt;saturation;
-    settings-&gt;param[1].b=0;
-    settings-&gt;param[1].g=sqrt(settings-&gt;bgamma/settings-&gt;ggamma);
-    settings-&gt;param[1].w=settings-&gt;gamma_weight;
-    
-    settings-&gt;param[2].c=_param-&gt;saturation;
-    settings-&gt;param[2].b=0;
-    settings-&gt;param[2].g=sqrt(settings-&gt;rgamma/settings-&gt;ggamma);
-    settings-&gt;param[2].w=settings-&gt;gamma_weight;
-    
-    //printf(&quot;GGamma:%f\n&quot;,settings-&gt;ggamma);
-    create_lut(&amp;(settings-&gt;param[0]));
-    create_lut(&amp;(settings-&gt;param[1]));
-    create_lut(&amp;(settings-&gt;param[2])); 
-}          
-
-void create_lut (oneSetting *par)
-{
-  unsigned i;
-  double   g, v;
-  double   lw, gw;
-
-  g = par-&gt;g;
-  gw = par-&gt;w;
-  lw = 1.0 - gw;
-
-  if ((g &lt; 0.001) || (g &gt; 1000.0)) {
-    g = 1.0;
-  }
-
-  g = 1.0 / g;
-
-  for (i = 0; i &lt; 256; i++) {
-    v = (double) i / 255.0;
-    v = par-&gt;c * (v - 0.5) + 0.5 + par-&gt;b;
-
-    if (v &lt;= 0.0) {
-      par-&gt;lut[i] = 0;
-    }
-    else {
-      v = v*lw + pow(v, g)*gw;
-
-      if (v &gt;= 1.0) {
-        par-&gt;lut[i] = 255;
-      }
-      else {
-        par-&gt;lut[i] = (unsigned char) (256.0 * v);
-      }
-    }
-  }
-
-#ifdef LUT16
-  for(i=0; i&lt;256*256; i++){
-    par-&gt;lut16[i]= par-&gt;lut[i&amp;0xFF] + (par-&gt;lut[i&gt;&gt;8]&lt;&lt;8);
-  }
-#endif
-
-  par-&gt;lut_clean = 1;
-}
-
-#ifdef ADM_CPU_X86
-
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{
-  unsigned i;
-  int      contrast, brightness;
-  unsigned dstep, sstep,w3;
-  int      pel;
-  short    int brvec[4];
-  short    int contvec[4];
-  w3=w&gt;&gt;3;
-//  printf(&quot;\nmmx: src=%p dst=%p w=%d h=%d ds=%d ss=%d\n&quot;,src,dst,w,h,dstride,sstride);
-  if(par-&gt;g!=1.0) return apply_lut(par,dst,src,w,h);
-  //printf(&quot;MMX\n&quot;);
-  contrast = (int) (par-&gt;c * 256 * 16);
-  brightness = ((int) (100.0 * par-&gt;b + 100.0) * 511) / 200 - 128 - contrast / 32;
-
-  brvec[0] = brvec[1] = brvec[2] = brvec[3] = brightness;
-  contvec[0] = contvec[1] = contvec[2] = contvec[3] = contrast;
-
-  
-  asm volatile (
-        &quot;movq (%0), %%mm3 \n\t&quot;
-        &quot;movq (%1), %%mm4 \n\t&quot;
-        ::  &quot;r&quot; (brvec),&quot;r&quot; (contvec)
-        
-        );
-  while (h-- &gt; 0) {
-    asm volatile (
-      &quot;pxor %%mm0, %%mm0 \n\t&quot;
-      &quot;movl %4, %%eax\n\t&quot;
-      &quot;.p2align 4 \n\t&quot;
-      &quot;lop%=: \n\t&quot;
-      &quot;movq (%0), %%mm1 \n\t&quot;
-      &quot;movq (%0), %%mm2 \n\t&quot;
-      &quot;punpcklbw %%mm0, %%mm1 \n\t&quot;
-      &quot;punpckhbw %%mm0, %%mm2 \n\t&quot;
-      &quot;psllw $4, %%mm1 \n\t&quot;
-      &quot;psllw $4, %%mm2 \n\t&quot;
-      &quot;pmulhw %%mm4, %%mm1 \n\t&quot;
-      &quot;pmulhw %%mm4, %%mm2 \n\t&quot;
-      &quot;paddw %%mm3, %%mm1 \n\t&quot;
-      &quot;paddw %%mm3, %%mm2 \n\t&quot;
-      &quot;packuswb %%mm2, %%mm1 \n\t&quot;
-      &quot;add $8, %0 \n\t&quot;
-      &quot;movq %%mm1, (%1) \n\t&quot;
-      &quot;add $8, %1 \n\t&quot;
-      &quot;decl %%eax \n\t&quot;
-      &quot;jnz lop%= \n\t&quot;
-      : &quot;=r&quot; (src), &quot;=r&quot; (dst)
-      : &quot;0&quot; (src), &quot;1&quot; (dst), &quot;r&quot; (w3)
-      : &quot;%eax&quot;
-    );
-
-    for (i = w &amp; 7; i &gt; 0; i--) {
-      pel = ((*src++ * contrast) &gt;&gt; 12) + brightness;
-      if (pel &amp; 768) {
-        pel = (-pel) &gt;&gt; 31;
-      }
-      *dst++ = pel;
-    }
-
-  }
-
-  asm volatile ( &quot;emms \n\t&quot; ::: &quot;memory&quot; );
-}
-#endif
-
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{           
-            
-    
-  unsigned int dstride,  sstride;
-  unsigned int i, j, w2;
-  unsigned char *lut;
-  uint16_t *lut16;
-
-   dstride=sstride=w;
-
-  lut = par-&gt;lut;
-#ifdef LUT16
-  lut16 = par-&gt;lut16;
-  w2= (w&gt;&gt;3)&lt;&lt;2;
-  for (j = 0; j &lt; h; j++) {
-    uint16_t *src16= (uint16_t*)src;
-    uint16_t *dst16= (uint16_t*)dst;
-    for (i = 0; i &lt; w2; i+=4) {
-      dst16[i+0] = lut16[src16[i+0]];
-      dst16[i+1] = lut16[src16[i+1]];
-      dst16[i+2] = lut16[src16[i+2]];
-      dst16[i+3] = lut16[src16[i+3]];
-    }
-    i &lt;&lt;= 1;
-#else
-  w2= (w&gt;&gt;3)&lt;&lt;3;
-  for (j = 0; j &lt; h; j++) {
-    for (i = 0; i &lt; w2; i+=8) {
-      dst[i+0] = lut[src[i+0]];
-      dst[i+1] = lut[src[i+1]];
-      dst[i+2] = lut[src[i+2]];
-      dst[i+3] = lut[src[i+3]];
-      dst[i+4] = lut[src[i+4]];
-      dst[i+5] = lut[src[i+5]];
-      dst[i+6] = lut[src[i+6]];
-      dst[i+7] = lut[src[i+7]];
-    }
-#endif
-    for (; i &lt; w; i++) {
-      dst[i] = lut[src[i]];
-    }
-
-    src += sstride;
-    dst += dstride;
-  }
-}  
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,61 +0,0 @@
-
-#ifndef EQ2_PARAM
-#define EQ2_PARAM
-#define LUT16
-typedef struct Eq2_Param
-{
-  float     contrast ;      /* 1.0 means do nothing..*/    
-  float     brightness;     /* 0 means */
-  float     saturation;
-  
-  float     gamma;
-  float     gamma_weight;
-  float     rgamma;
-  float     ggamma;
-  float     bgamma;
-}Eq2_Param;
-//*************************
-
-
-typedef struct oneSetting {
-  unsigned char lut[256];
-#ifdef LUT16
-  uint16_t lut16[256*256];
-#endif
-  int           lut_clean;
-
-  double        c;
-  double        b;
-  double        g;
-  double        w;
-} oneSetting;
-typedef struct Eq2Settings {
-  oneSetting param[3];
-
-  double        contrast;
-  double        brightness;
-  double        saturation;
-
-  double        gamma;
-  double        gamma_weight;
-  double        rgamma;
-  double        ggamma;
-  double        bgamma;
-
- 
-} Eq2Settings;
-//*************************
-uint8_t DIA_getEQ2Param(Eq2_Param *param,AVDMGenericVideoStream *in);
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param);
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h);
-void create_lut (oneSetting *par);
-
-#ifdef ADM_CPU_X86
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-                unsigned int w, unsigned int h);
-#endif
-
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,166 +0,0 @@
-/***************************************************************************
-                          Hue/Saturation filter ported from mplayer 
- (c) Michael Niedermayer
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;ADM_default.h&quot;
-#include &lt;math.h&gt;
-
-
-#include &quot;ADM_videoFilter.h&quot;
-
-
-#include &quot;DIA_enter.h&quot;
-
-
-#include &quot;ADM_vidHue.h&quot;
-static FILTER_PARAM HueParam={2,{&quot;hue&quot;,&quot;saturation&quot;}};
-
-extern uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in);
-
-class  ADMVideoHue:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            void            update(void);
-            Hue_Param       *_param;    
-            VideoCache      *vidCache; 
-            float           _hue;
-            float           _saturation;
-  public:
-                
-                        ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *setup);
-    virtual             ~ADMVideoHue();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(hue_script,ADMVideoHue,HueParam);
-BUILD_CREATE(hue_create,ADMVideoHue);
-
-void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
-		    int w, int h, float hue, float sat)
-{
-	int i;
-	const int s= (int)rint(sin(hue) * (1&lt;&lt;16) * sat);
-	const int c= (int)rint(cos(hue) * (1&lt;&lt;16) * sat);
-
-	while (h--) {
-		for (i = 0; i&lt;w; i++)
-		{
-			const int u= usrc[i] - 128;
-			const int v= vsrc[i] - 128;
-			int new_u= (c*u - s*v + (1&lt;&lt;15) + (128&lt;&lt;16))&gt;&gt;16;
-			int new_v= (s*u + c*v + (1&lt;&lt;15) + (128&lt;&lt;16))&gt;&gt;16;
-			if(new_u &amp; 768) new_u= (-new_u)&gt;&gt;31;
-			if(new_v &amp; 768) new_v= (-new_v)&gt;&gt;31;
-			udst[i]= new_u;
-			vdst[i]= new_v;
-		}
-		usrc += srcstride;
-		vsrc += srcstride;
-		udst += dststride;
-		vdst += dststride;
-	}
-}
-
-
-uint8_t ADMVideoHue::configure(AVDMGenericVideoStream *in)
-{
-uint8_t r=0;
-  _in=in;   
-  r=  DIA_getHue(_param, in);
-  if(r) update();
-  return r;  
-}
-char *ADMVideoHue::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf,&quot; Hue :%2.2f %2.2f&quot;,_param-&gt;hue,_param-&gt;saturation);
-  return buf;
-}
-
-ADMVideoHue::ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  Hue_Param;
-  if(couples)
-  {                 
-    GET(hue);    
-    GET(saturation); 
-  }
-  else
-  {
-    _param-&gt;hue =0.0;                
-    _param-&gt;saturation=1.0;
-  }      
-  vidCache=new VideoCache(1,_in);
-  update();
-}
-void ADMVideoHue::update(void)
-{
-    _hue=_param-&gt;hue*M_PI/180.;
-    _saturation=(100+_param-&gt;saturation)/100;
-}
-ADMVideoHue::~ADMVideoHue()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoHue::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(2);
-
-
-                CSET(hue);
-                CSET(saturation);
-                return 1;
-}
-
-
-uint8_t ADMVideoHue::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc=NULL;
-  
-
-  if(frame&gt;=_info.nb_frames) return 0;
-  
-  mysrc=vidCache-&gt;getImage(frame);
-  if(!mysrc) return 0;
-  memcpy(YPLANE(data),YPLANE(mysrc),_info.width*_info.height);
-  HueProcess_C(VPLANE(data), UPLANE(data),
-        VPLANE(mysrc), UPLANE(mysrc),
-        _info.width&gt;&gt;1,_info.width&gt;&gt;1,
-        _info.width&gt;&gt;1,_info.height&gt;&gt;1, 
-        _hue, _saturation);
- 
-  vidCache-&gt;unlockAll();
-  
-  
-  return 1;
-}
-
-  
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,11 +0,0 @@
-/*
-
-*/
-
-typedef struct Hue_Param
-{
-  float     hue ;           /* -180 to 180 */
-  float     saturation;     /* -180 to 180 */
-}Hue_Param;
- void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
-		    int w, int h, float hue, float sat);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -4,11 +4,6 @@
 	ADM_vidTdeint.cpp
 	ADM_vidAnimated.cpp
 	ADM_vidDvbSub.cpp
-	ADM_vidHue.cpp
-	ADM_vidCrop.cpp
-	ADM_vidEq2.cpp
-	ADM_vidContrast.cpp
-	ADM_vidAsharp.cpp
 	ADM_vidVobsub.cpp
 	ADM_vidVobSubRender.cpp
 	ADM_vobsubinfo.cpp

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidASharp_param.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidASharp_param.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,18 @@
+
+#ifndef _ASHARP_PARAM
+#define _ASHARP_PARAM
+#define uc uint8_t
+#define bool uint8_t
+
+ void asharp_run_c(      uc* planeptr, int pitch,
+                                        int height, int width, 
+                                        int     T,int D, int B, int B2, bool bf );
+
+typedef struct ASHARP_PARAM
+{
+        double          t; // Threshold 0:nothing max : 5 ?
+        double          d; // Strength : 0 means nothing, &gt;0  adaptative t is maximum
+        double          b; // Block adaptative sharpening -1 disabled
+        uint32_t        bf;
+}ASHARP_PARAM;
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidAsharp.cpp (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/ADM_vidAsharp.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,288 @@
+/**/
+/***************************************************************************
+                          ADM_vidASharp  -  description
+                             -------------------   
+    Port of avisynth one
+
+ ***************************************************************************/
+/*
+        
+        Copyright (C) 2003 Donald A. Graft
+        Copyright (C) 2002 Marc Fauconneau
+        This program is free software; you can redistribute it and/or modify
+        it under the terms of the GNU General Public License as published by
+        the Free Software Foundation.
+
+        This program is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+        GNU General Public License for more details.
+
+        You should have received a copy of the GNU General Public License
+        along with this program; if not, write to the Free Software
+        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+*/
+
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+
+#include &quot;ADM_vidASharp_param.h&quot;
+class ASharp : public AVDMGenericVideoStream
+{
+private:
+        
+        VideoCache      *vidCache;
+        ASHARP_PARAM    *_param;
+        int32_t        T,D,B,B2;
+        
+public:    
+
+                        ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)   ;
+                        ~ASharp();
+
+
+                        void update(void);         
+        char            *printConf( void );
+        uint8_t         configure(AVDMGenericVideoStream *in);
+        uint8_t         getCoupledConf( CONFcouple **couples);
+        uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
+};
+
+
+static FILTER_PARAM asharp_param={4,{&quot;t&quot;, &quot;b&quot;,&quot;d&quot;, &quot;bf&quot;}};
+
+
+//REGISTERX(VF_SHARPNESS, &quot;asharp&quot;,QT_TR_NOOP(&quot;asharp&quot;),QT_TR_NOOP(&quot;&quot;
+//    &quot;Adaptative sharpener by MarcFD.&quot;),VF_ASHARP,1,asharp_create,asharp_script);
+VF_DEFINE_FILTER_UI(ASharp,asharp_param,
+    asharp,
+                                QT_TR_NOOP(&quot;asharp&quot;),
+                                1,
+                                VF_SHARPNESS,
+                                QT_TR_NOOP(&quot;Adaptative sharpener by MarcFD.&quot;));
+
+
+//_______________________________________________
+
+ASharp::ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)
+
+{
+        _in=in;         
+        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+        _info.encoding=1;
+        _uncompressed=NULL;             
+        _info.encoding=1;
+
+
+        _param=new ASHARP_PARAM;
+       
+        if(couples)
+                {
+                     GET(t);
+                     GET(d);
+                     GET(b);
+                     GET(bf); 
+                }
+                else // Default
+                {
+                        _param-&gt;t=2;
+                        _param-&gt;d=4;
+                        _param-&gt;b=-1;
+                        _param-&gt;bf=0;
+                }                              
+                update();
+                vidCache=new VideoCache(5,in);
+}
+//________________________________________________________
+void ASharp::update( void)
+{
+                // parameters floating point to fixed point convertion
+                T = (int)(_param-&gt;t*(4&lt;&lt;7));
+                D = (int)(_param-&gt;d*(4&lt;&lt;7));
+                B = (int)(256-_param-&gt;b*64);
+                B2= (int)(256-_param-&gt;b*48);
+
+                // clipping (recommended for SIMD code)
+
+                if (T&lt;-(4&lt;&lt;7)) T = -(4&lt;&lt;7); // yes, negatives values are accepted
+                if (D&lt;0) D = 0;
+                if (B&lt;0) B = 0;
+                if (B2&lt;0) B2 = 0;
+
+                if (T&gt;(32*(4&lt;&lt;7))) T = (32*(4&lt;&lt;7));
+                if (D&gt;(16*(4&lt;&lt;7))) D = (16*(4&lt;&lt;7));
+                if (B&gt;256) B = 256;
+                if (B2&gt;256) B2 = 256;
+
+}
+//________________________________________________________
+uint8_t ASharp::getCoupledConf( CONFcouple **couples)
+{
+        *couples=NULL;
+        *couples=new CONFcouple(4);
+#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
+               CSET(t);
+               CSET(d);
+               CSET(b);
+               CSET(bf);    
+        return 1;
+}
+//________________________________________________________
+ASharp::~ASharp(void)
+{
+
+        if(vidCache) delete vidCache;     
+
+     
+        vidCache=NULL;
+
+}
+
+extern uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
+//________________________________________________________
+uint8_t ASharp::configure(AVDMGenericVideoStream *in)
+{
+uint8_t r=0;
+        _in=in;
+        if( DIA_getASharp(_param, _in))
+        {
+                r=1;
+        }
+        update();
+        return r;
+}
+
+//________________________________________________________
+char *ASharp::printConf( void )
+{
+        static char buf[50];
+
+        ADM_assert(_param);
+        sprintf((char *)buf,&quot; ASharp (MarcFD)&quot;);
+        return buf;
+}
+        
+//________________________________________________________
+uint8_t ASharp::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                ADMImage *data,uint32_t *flags)
+{
+ADMImage *src;
+ADMImage *dst;
+
+        dst=data;
+        if(frame&gt;=_info.nb_frames) return 0;
+        src=vidCache-&gt;getImage(frame);
+        dst-&gt;duplicate(src);
+        asharp_run_c(     dst-&gt;GetWritePtr(PLANAR_Y),
+                        dst-&gt;GetPitch(PLANAR_Y), 
+                        _info.height,
+                        _info.width,
+                        T,
+                        D,
+                        B,
+                        B2,
+                        _param-&gt;bf);
+
+        vidCache-&gt;unlockAll();
+
+        return 1;
+}
+
+
+
+
+void asharp_run_c(      uc* planeptr, int pitch,
+                                        int height, int width, 
+                                        int     T,int D, int B, int B2, bool bf )
+        {
+                uc* lineptr = new uc[width];
+                int p = pitch;
+                int y,x;
+                uc* cfp = planeptr+pitch;
+                uc* lp = lineptr;
+                memcpy(lp,planeptr,width);
+                for (y=1;y&lt;height-1;y++) {
+                        int last = cfp[0];
+                        for (x=0;x&lt;width-1;x++) {
+
+                                int avg = 0;
+                                int dev = 0;
+                                int T2;
+                                int diff;
+                                int tmp;
+
+                                avg += lp[x-1];
+                                avg += lp[x  ];
+                                avg += lp[x+1];
+                                avg += last;
+                                avg += cfp[x    ];
+                                avg += cfp[x  +1];
+                                avg += cfp[x+p-1];
+                                avg += cfp[x+p  ];
+                                avg += cfp[x+p+1];
+
+                                avg *= (65535/9);
+                                avg &gt;&gt;= 16;
+
+                                #define CHECK(A) \
+                                if (abs(A-cfp[x])&gt;dev) dev = abs(A-cfp[x]);
+                                
+                                if (bf) {
+
+                                if (y%8&gt;0) {
+                                        if (x%8&gt;0) CHECK(lp[x-1])
+                                        CHECK(lp[x  ])
+                                        if (x%8&lt;7) CHECK(lp[x+1])
+                                }
+                                if (x%8&gt;0) CHECK(last)
+                                if (x%8&lt;7) CHECK(cfp[x  +1])
+                                if (y%8&lt;7) {
+                                        if (x%8&gt;0) CHECK(cfp[x+p-1])
+                                        CHECK(cfp[x+p  ])
+                                        if (x%8&lt;7) CHECK(cfp[x+p+1])
+                                }
+
+                                } else {
+                                        CHECK(lp[x-p-1])
+                                        CHECK(lp[x-p  ])
+                                        CHECK(lp[x-p+1])
+                                        CHECK(last)
+                                        CHECK(cfp[x  +1])
+                                        CHECK(cfp[x+p-1])
+                                        CHECK(cfp[x+p  ])
+                                        CHECK(cfp[x+p+1])
+                                }
+
+                                T2 = T;
+                                diff = cfp[x]-avg;
+                                int D2 = D;
+
+                                if (x%8==6) D2=(D2*B2)&gt;&gt;8;
+                                if (x%8==7) D2=(D2*B)&gt;&gt;8;
+                                if (x%8==0) D2=(D2*B)&gt;&gt;8;
+                                if (x%8==1) D2=(D2*B2)&gt;&gt;8;
+                                if (y%8==6) D2=(D2*B2)&gt;&gt;8;
+                                if (y%8==7) D2=(D2*B)&gt;&gt;8;
+                                if (y%8==0) D2=(D2*B)&gt;&gt;8;
+                                if (y%8==1) D2=(D2*B2)&gt;&gt;8;
+
+                                int Da = -32+(D&gt;&gt;7);
+                                if (D&gt;0) T2 = ((((dev&lt;&lt;7)*D2)&gt;&gt;16)+Da)&lt;&lt;4;
+
+                                if (T2&gt;T) T2=T;
+                                if (T2&lt;-32) T2=-32;
+
+                                tmp = (((diff&lt;&lt;7)*T2)&gt;&gt;16)+cfp[x];
+
+                                if (tmp &lt; 0) tmp = 0;
+                                if (tmp &gt; 255) tmp = 255;
+                                lp[x-1] = last;
+                                last = cfp[x];
+                                cfp[x] = tmp;
+                        }
+                        lp[x] = cfp[x];
+                        cfp += pitch;
+                }
+        delete[] lineptr;
+} 
+//**********************************

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,20 @@
+INCLUDE(vf_plugin)
+
+
+SET(asharpCommon_SRCS 
+ADM_vidAsharp.cpp  DIA_flyAsharp.cpp
+)
+
+INCLUDE(vf_plugin_gtk)
+INCLUDE(vf_plugin_qt4)
+
+SET(asharpGtk_SRCS gtk/DIA_asharp.cpp)
+SET(asharpQT_SRCS  qt4/Q_asharp.cpp)
+SET(asharpQT_HEADERS  qt4/Q_asharp.h)
+SET(asharpQT_UI    qt4/asharp)
+
+INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_asharp_qt4 
+                ${asharpQT_SRCS} ${asharpQT_HEADERS} ${asharpQT_UI} ${asharpCommon_SRCS})
+INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_asharp_gtk 
+                ${asharpGtk_SRCS} ${asharpCommon_SRCS})
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -19,16 +19,15 @@
  *                                                                         *
  ***************************************************************************/
 
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_default.h&quot;
 
-
 #include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
-#include &quot;ADM_assert.h&quot;
 
+
 /************* COMMON PART *********************/
 uint8_t  flyASharp::update(void)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/DIA_flyAsharp.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -2,7 +2,7 @@
 
 #ifndef FLY_ASHARP_H
 #define FLY_ASHARP_H
-class flyASharp : public ADM_flyDialog
+class flyASharp : public FLY_DIALOG_TYPE
 {
   
   public:
@@ -13,6 +13,6 @@
    uint8_t    upload(void);
    uint8_t    update(void);
    flyASharp (uint32_t width,uint32_t height,AVDMGenericVideoStream *in,
-                                    void *canvas, void *slider) : ADM_flyDialog(width, height,in,canvas, slider,1,RESIZE_AUTO) {};
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,1,RESIZE_AUTO) {};
 };
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/gtk/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/gtk/DIA_asharp.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/gtk/DIA_asharp.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -26,7 +26,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -4,9 +4,9 @@
 #include &quot;ui_asharp.h&quot;
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
-#include &quot;ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h&quot;
+#include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 
 class Ui_asharpWindow : public QDialog

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -44,3 +44,8 @@
 ADD_SUBDIRECTORY(colorYUV)
 ADD_SUBDIRECTORY(Equalizer)
 ADD_SUBDIRECTORY(MPDelogo)
+ADD_SUBDIRECTORY(ASharp)
+ADD_SUBDIRECTORY(Contrast)
+ADD_SUBDIRECTORY(Eq2)
+ADD_SUBDIRECTORY(Hue)
+ADD_SUBDIRECTORY(Crop)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.cpp (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,231 @@
+/***************************************************************************
+                          ADM_vidContrast.cpp  -  description
+                             -------------------
+    begin                : Sun Sep 22 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_vidContrast.h&quot;
+#include &lt;math.h&gt;
+static FILTER_PARAM contrastParam =
+  { 5, {&quot;offset&quot;, &quot;coef&quot;, &quot;doLuma&quot;, &quot;doChromaU&quot;, &quot;doChromaV&quot;} };
+
+//REGISTERX(VF_COLORS, &quot;contrast&quot;,QT_TR_NOOP(&quot;Contrast&quot;),
+//    QT_TR_NOOP(&quot;Adjust contrast, brightness and colors.&quot;),VF_CONTRAST,1,contrast_create,contrast_script);
+
+VF_DEFINE_FILTER_UI(ADMVideoContrast,contrastParam,
+    contrast,
+                                QT_TR_NOOP(&quot;Contrast&quot;),
+                                1,
+                                VF_COLORS,
+                                QT_TR_NOOP(&quot;Adjust contrast, brightness and colors.&quot;));
+char *
+ADMVideoContrast::printConf (void)
+{
+  static char buf[50];
+
+  ADM_assert (_param);
+  sprintf ((char *) buf, &quot; contrast : %1.2f %d&quot;, _param-&gt;coef,
+	   _param-&gt;offset);
+  return buf;
+}
+
+//_______________________________________________________________
+
+ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
+				    CONFcouple * couples)
+{
+
+
+  _in = in;
+  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
+  _info.encoding = 1;
+  //   _uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
+  _uncompressed =
+    new ADMImage (_in-&gt;getInfo ()-&gt;width, _in-&gt;getInfo ()-&gt;height);
+  ADM_assert (_uncompressed);
+  _param = NULL;
+  if (couples)
+    {
+      _param = NEW (CONTRAST_PARAM);
+      GET (offset);
+      GET (coef);
+      GET (doLuma);
+      GET (doChromaU);
+      GET (doChromaV);
+    }
+  else
+    {
+      _param = NEW (CONTRAST_PARAM);
+      _param-&gt;offset = 0;
+      _param-&gt;coef = 1.0f;
+      _param-&gt;doLuma = 1;
+      _param-&gt;doChromaU = 1;
+      _param-&gt;doChromaV = 1;
+
+    }
+  buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
+
+
+}
+
+
+uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
+{
+
+  ADM_assert (_param);
+  *couples = new CONFcouple (5);
+
+#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
+  CSET (offset);
+  CSET (coef);
+  CSET (doLuma);
+  CSET (doChromaU);
+  CSET (doChromaV);
+  return 1;
+
+}
+ADMVideoContrast::~ADMVideoContrast ()
+{
+  if (_uncompressed)
+    delete _uncompressed;
+  _uncompressed = 0;
+  DELETE (_param);
+}
+
+//
+//      Remove y and v just keep U and expand it
+//
+uint8_t
+  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
+					   uint32_t * len,
+					   ADMImage * data, uint32_t * flags)
+{
+  //uint32_t x,w;
+
+  ADM_assert (_param);
+ if(frame&gt;= _info.nb_frames) return 0;
+
+
+  if (!_in-&gt;getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+    return 0;
+  *len = _info.width * _info.height + (_info.width * _info.height &gt;&gt; 1);
+
+  uint32_t sz = _info.width * _info.height;
+  // luma 
+  if (_param-&gt;doLuma)
+    {
+      if (!doContrast (_uncompressed-&gt;data, data-&gt;data, _tableFlat,
+		       _info.width, _info.height))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data, _uncompressed-&gt;data, sz);
+    }
+  // ______u_____________         
+
+  if (_param-&gt;doChromaU)
+    {
+      if (!doContrast (_uncompressed-&gt;data + sz, data-&gt;data + sz, _tableNZ,
+		       _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data + sz, _uncompressed-&gt;data + sz, sz &gt;&gt; 2);
+    }
+
+  // ______v_____________         
+  if (_param-&gt;doChromaV)
+    {
+
+      if (!doContrast
+	  (_uncompressed-&gt;data + sz + (sz &gt;&gt; 2), data-&gt;data + sz + (sz &gt;&gt; 2),
+	   _tableNZ, _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data + sz + (sz &gt;&gt; 2),
+	      _uncompressed-&gt;data + sz + (sz &gt;&gt; 2), sz &gt;&gt; 2);
+    }
+
+
+
+
+  return 1;
+}
+
+uint8_t
+buildContrastTable (float coef, int8_t off,
+		    uint8_t * tableFlat, uint8_t * tableNZ)
+{
+  float f;
+
+  for (uint32_t i = 0; i &lt; 256; i++)
+    {
+      f = i;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+      f += off;
+      if (f &lt; 0.)
+	f = 0.;
+      if (f &gt; 255.)
+	f = 255.;
+      *(tableFlat + i) = (uint8_t) floor (f);
+
+      f = i;
+      f -= 128;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+
+//                                      f+=off;
+      if (f &lt; -127.)
+	f = -127.;
+      if (f &gt; 127.)
+	f = 127.;
+      f += 128.;
+      *(tableNZ + i) = (uint8_t) floor (f);
+    }
+  return 0;
+}
+
+uint8_t
+doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
+	    uint32_t w, uint32_t h)
+{
+
+  for (uint32_t y = h * w; y &gt; 0; y--)
+    {
+      *out++ = table[*in++];
+    }
+
+  return 1;
+
+}
+uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
+uint8_t
+ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
+{
+  if(DIA_contrast(_in,_param))
+  {
+    buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
+    return 1;
+  }
+  return 0;
+}
+
+// EOF

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.h (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidContrast.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/ADM_vidContrast.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,57 @@
+/***************************************************************************
+                          ADM_vidContrast.h  -  description
+                             -------------------
+    begin                : Sun Sep 22 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef _CONTRAST_
+#define _CONTRAST_
+
+typedef struct 
+{
+		float 	coef;
+		int32_t  offset;
+		uint32_t	doLuma;
+		uint32_t	doChromaU;
+		uint32_t	doChromaV;
+		
+	
+	}CONTRAST_PARAM;
+	
+  uint8_t buildContrastTable( float coef,int8_t off,	
+  								uint8_t *tableFlat,uint8_t *tableNZ);
+  uint8_t doContrast(uint8_t *in,uint8_t *out,uint8_t *table,
+												uint32_t w,uint32_t h);
+
+
+ class  ADMVideoContrast:public AVDMGenericVideoStream
+ {
+
+ protected:
+				virtual char 					*printConf(void);
+				CONTRAST_PARAM					*_param;
+				uint8_t						_tableFlat[256];
+				uint8_t						_tableNZ[256];
+
+ public:
+
+					ADMVideoContrast(  AVDMGenericVideoStream *in,CONFcouple *setup);
+  					virtual ~ADMVideoContrast();
+		          virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+          																	ADMImage *data,uint32_t *flags);
+					virtual uint8_t 	configure( AVDMGenericVideoStream *instream) ;
+
+ 					virtual uint8_t	getCoupledConf( CONFcouple **couples);
+ 				
+ }     ;
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,20 @@
+INCLUDE(vf_plugin)
+
+
+SET(contrastCommon_SRCS 
+ADM_vidContrast.cpp  DIA_flyContrast.cpp
+)
+
+INCLUDE(vf_plugin_gtk)
+INCLUDE(vf_plugin_qt4)
+
+SET(contrastGtk_SRCS gtk/DIA_contrast.cpp)
+SET(contrastQT_SRCS  qt4/Q_contrast.cpp)
+SET(contrastQT_HEADERS  qt4/Q_contrast.h)
+SET(contrastQT_UI    qt4/contrast)
+
+INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_contrast_qt4 
+                ${contrastQT_SRCS} ${contrastQT_HEADERS} ${contrastQT_UI} ${contrastCommon_SRCS})
+INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_contrast_gtk 
+                ${contrastGtk_SRCS} ${contrastCommon_SRCS})
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -15,14 +15,12 @@
  *                                                                         *
  ***************************************************************************/
 
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_default.h&quot;
 
-//#include &quot;ADM_colorspace/ADM_rgb.h&quot;
-
 #include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;ADM_vidContrast.h&quot;
 #include &quot;DIA_flyContrast.h&quot;
 /************* COMMON PART *********************/
 uint8_t  flyContrast::update(void)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/DIA_flyContrast.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -2,7 +2,7 @@
 
 #ifndef FLY_CONTRAST_H
 #define FLY_CONTRAST_H
-class flyContrast : public ADM_flyDialog
+class flyContrast : public FLY_DIALOG_TYPE
 {
   
   public:
@@ -13,7 +13,7 @@
    uint8_t    upload(void);
    uint8_t    update(void);
    flyContrast (uint32_t width,uint32_t height,AVDMGenericVideoStream *in,
-                                    void *canvas, void *slider) : ADM_flyDialog(width, height,in,canvas, slider,1,RESIZE_AUTO)
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,1,RESIZE_AUTO)
                     {
                       
                     };

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/gtk/DIA_contrast.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/gtk/DIA_contrast.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/gtk/DIA_contrast.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -15,12 +15,8 @@
  *                                                                         *
  ***************************************************************************/
 #include &quot;ADM_toolkitGtk.h&quot;
-#include &quot;fourcc.h&quot;
-
-
-
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
+#include &quot;ADM_vidContrast.h&quot;
 
 
 #include &quot;DIA_flyDialog.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,12 +1,12 @@
 #ifndef Q_contrast_h
 #define Q_contrast_h
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ui_contrast.h&quot;
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
-#include &quot;ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h&quot;
+#include &quot;ADM_vidContrast.h&quot;
+
+
 #include &quot;DIA_flyContrast.h&quot;
 
 class Ui_contrastWindow : public QDialog

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop.cpp (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidCrop.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,217 @@
+/***************************************************************************
+                          ADM_vidCrop.cpp  -  description
+                             -------------------
+          Crop top/left/right/bottom
+
+          Each one ,must be even
+
+
+    begin                : Sun Mar 24 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;DIA_factory.h&quot;
+
+
+#include &quot;ADM_vidCrop_param.h&quot;
+class  AVDMVideoStreamCrop:public AVDMGenericVideoStream
+ {
+
+ protected:
+                CROP_PARAMS          *_param;
+
+ public:
+
+                                AVDMVideoStreamCrop(  AVDMGenericVideoStream *in,CONFcouple *couples);
+        virtual                 ~AVDMVideoStreamCrop();
+        virtual uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                                                ADMImage *data,uint32_t *flags);
+        virtual char    *printConf(void) ;
+                  uint8_t       configure( AVDMGenericVideoStream *instream);
+          virtual uint8_t       getCoupledConf( CONFcouple **couples);
+
+
+ }     ;
+ 
+static FILTER_PARAM cropParam={4,{&quot;left&quot;,&quot;right&quot;,&quot;top&quot;,&quot;bottom&quot;}};
+
+
+VF_DEFINE_FILTER_UI(AVDMVideoStreamCrop,cropParam,
+    crop,
+                                QT_TR_NOOP(&quot;Crop&quot;),
+                                1,
+                                VF_TRANSFORM,
+                                QT_TR_NOOP(&quot;Remove lines from top/bottom/left/right.&quot;));
+
+
+char *AVDMVideoStreamCrop::printConf( void )
+{
+ 	static char buf[50];
+ 	
+ 	sprintf((char *)buf,&quot; Crop %lu x %lu --&gt; %lu x %lu&quot;,
+ 				_in-&gt;getInfo()-&gt;width,
+ 				_in-&gt;getInfo()-&gt;height,
+ 				_info.width,
+ 				_info.height);
+        return buf;
+}
+
+//_______________________________________________________________
+
+AVDMVideoStreamCrop::AVDMVideoStreamCrop(
+									AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+
+
+  	_in=in;		
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+	
+		if(couples)
+		{
+			_param=	NEW(CROP_PARAMS);
+			GET(left);
+			GET(right);
+			GET(top);
+			GET(bottom);
+				// Consistency check
+				if(  _in-&gt;getInfo()-&gt;width&lt;(_param-&gt;right+_param-&gt;left))
+						{
+                      		printf(&quot;\n Warning Cropping too much width ! Width reseted !\n&quot;);
+								_param-&gt;right=_param-&gt;left=0;
+						}
+				if(  _in-&gt;getInfo()-&gt;height&lt;(_param-&gt;bottom+_param-&gt;top))
+						{
+                      		printf(&quot;\n Warning Cropping too much height ! Height reseted !\n&quot;);
+								_param-&gt;bottom=_param-&gt;top=0;
+						}
+
+			_info.width=_in-&gt;getInfo()-&gt;width-_param-&gt;right-_param-&gt;left;		
+			_info.height=_in-&gt;getInfo()-&gt;height-_param-&gt;bottom-_param-&gt;top;	
+			
+		}	
+			else 			
+		{	// default parameter	
+				_param=	NEW(CROP_PARAMS); ;
+				_param-&gt;left=_param-&gt;top=
+				_param-&gt;right=_param-&gt;bottom=0;
+		}				
+					
+ 	//_uncompressed=(uint8_t *)malloc(3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height);
+ 	//_uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
+	_uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
+  	ADM_assert(_uncompressed);
+  	_info.encoding=1;
+	  
+
+  	  	
+}
+AVDMVideoStreamCrop::~AVDMVideoStreamCrop()
+{
+ 	delete _uncompressed;
+ 	DELETE(_param);
+}
+
+//
+//	Basically ask a uncompressed frame from editor and ask
+//		GUI to decompress it .
+//
+
+uint8_t AVDMVideoStreamCrop::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+
+			ADM_assert(frame&lt;_info.nb_frames);
+			ADM_assert(_param);									
+		if(frame&gt;= _info.nb_frames) return 0;
+			// read uncompressed frame
+       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
+       		
+       		// Crop Y luma
+       		uint32_t y,x,line;
+       		uint8_t *src,*src2,*dest;
+       		
+       		y=_in-&gt;getInfo()-&gt;height;
+       		x=_in-&gt;getInfo()-&gt;width;
+       		line=_info.width;
+       		src=YPLANE(_uncompressed)+_param-&gt;top*x+_param-&gt;left;
+       		dest=YPLANE(data);
+       		
+       		for(uint32_t k=_info.height;k&gt;0;k--)
+       			{
+       			 	    memcpy(dest,src,line);
+       			 	    src+=x;
+       			 	    dest+=line;
+       			}
+       		 // Crop U  &amp; V
+       		 	src=UPLANE(_uncompressed)+(x*_param-&gt;top&gt;&gt;2)+(_param-&gt;left&gt;&gt;1);
+       		 	src2=VPLANE(_uncompressed)+(x*_param-&gt;top&gt;&gt;2)+(_param-&gt;left&gt;&gt;1);
+			dest=UPLANE(data);
+       		 	line&gt;&gt;=1;
+       		 	x&gt;&gt;=1;       		       		 	
+       		 		for(uint32_t k=((_info.height)&gt;&gt;1);k&gt;0;k--)
+       		 		{
+       		 	    	  	memcpy(dest,src,line);
+       			 	    	src+=x;
+       			 	    	dest+=line;
+       		 		}
+			dest=VPLANE(data);	
+       		 		for(uint32_t k=((_info.height)&gt;&gt;1);k&gt;0;k--)
+       		 		{
+       		 	    	  	memcpy(dest,src2,line);
+       			 	    	src2+=x;
+       			 	    	dest+=line;
+       		 		}	
+       		  *flags=0;
+       		  *len= _info.width*_info.height+(_info.width*_info.height&gt;&gt;1);
+		  data-&gt;copyInfo(_uncompressed);
+      return 1;
+}
+/**
+	Return the configuration as a couple of string
+	Up to the client to free them afterward
+*/
+uint8_t	AVDMVideoStreamCrop::getCoupledConf( CONFcouple **couples)
+{
+
+			ADM_assert(_param);
+			*couples=new CONFcouple(4);
+
+#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
+			CSET(left);
+			CSET(right);
+			CSET(top);
+			CSET(bottom);
+			return 1;
+
+}
+extern int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in);
+uint8_t AVDMVideoStreamCrop::configure( AVDMGenericVideoStream *instream)
+
+{
+		uint8_t r;
+		uint32_t w,h;
+    	if(r = (DIA_getCropParams(&quot;Crop Settings&quot;,_param,instream )))
+    	{
+			w=_param-&gt;left+_param-&gt;right;
+			h=_param-&gt;top+_param-&gt;bottom;
+			ADM_assert(w&lt;instream-&gt;getInfo()-&gt;width);
+			ADM_assert(h&lt;instream-&gt;getInfo()-&gt;height);
+			_info.width=instream-&gt;getInfo()-&gt;width-w;
+			_info.height=instream-&gt;getInfo()-&gt;height-h;
+		}
+		return r;
+}
+

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop_param.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/ADM_vidCrop_param.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,10 @@
+#ifndef DIA_CROP_PARAM_H
+#define DIA_CROP_PARAM_H
+typedef struct
+{
+        uint32_t left,right;
+        uint32_t top,bottom;
+}CROP_PARAMS;
+#endif
+
+

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,20 @@
+INCLUDE(vf_plugin)
+
+
+SET(CropCommon_SRCS 
+ADM_vidCrop.cpp  DIA_flyCrop.cpp
+)
+
+INCLUDE(vf_plugin_gtk)
+INCLUDE(vf_plugin_qt4)
+
+SET(CropGtk_SRCS gtk/DIA_crop.cpp)
+SET(CropQT_SRCS  qt4/Q_crop.cpp)
+SET(CropQT_HEADERS  qt4/Q_crop.h)
+SET(CropQT_UI    qt4/crop)
+
+INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_crop_qt4 
+                ${CropQT_SRCS} ${CropQT_HEADERS} ${CropQT_UI} ${CropCommon_SRCS})
+INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_Crop_gtk 
+                ${CropGtk_SRCS} ${CropCommon_SRCS})
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -16,14 +16,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_default.h&quot;
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-//#include &quot;ADM_colorspace/ADM_rgb.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+
+
+
 #include &quot;DIA_flyCrop.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/DIA_flyCrop.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,6 +1,6 @@
 #ifndef FLY_CROP_H
 #define FLY_CROP_H
-class flyCrop : public ADM_flyDialog
+class flyCrop : public FLY_DIALOG_TYPE
 {
   
   public:
@@ -11,6 +11,6 @@
    uint8_t    upload(void);
    uint8_t    autocrop(void);
    flyCrop (uint32_t width,uint32_t height,AVDMGenericVideoStream *in,
-                                    void *canvas, void *slider) : ADM_flyDialog(width, height,in,canvas, slider,0,RESIZE_LAST) {};
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,0,RESIZE_LAST) {};
 };
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/gtk/DIA_crop.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/gtk/DIA_crop.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/gtk/DIA_crop.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -22,15 +22,14 @@
 
 #include &quot;ADM_toolkitGtk.h&quot;
 
-
-
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 
-
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyCrop.h&quot;
-#if 0
+#include &quot;ADM_vidCrop_param.h&quot;
+
+#if 1
 static GtkWidget	*create_dialog1 (void);
 
 /* Link between UI and core */

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -19,7 +19,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#if 0
+#if 1
 #include &quot;Q_crop.h&quot;
 
 //

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Crop/qt4/Q_crop.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,13 +1,14 @@
 #ifndef Q_crop_h
 #define Q_crop_h
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ui_crop.h&quot;
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;DIA_flyCrop.h&quot;
-#if 0
+#include &quot;ADM_vidCrop_param.h&quot;
+#if 1
 class Ui_cropWindow : public QDialog
 {
 	Q_OBJECT

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.cpp (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,387 @@
+/***************************************************************************
+                          Hue/Saturation filter ported from mplayer 
+ (c)  * Software equalizer (brightness, contrast, gamma, saturation)
+ *
+ * Hampa Hug &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">hampa at hampa.ch</A>&gt; (original LUT gamma/contrast/brightness filter)
+ * Daniel Moreno &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">comac at comac.darktech.org</A>&gt; (saturation, R/G/B gamma support)
+ * Richard Felker (original MMX contrast/brightness code (vf_eq.c))
+ * Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michalni at gmx.at</A>&gt; (LUT16)
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;DIA_factory.h&quot;
+
+#include &lt;math.h&gt;
+
+#include &quot;ADM_vidEq2.h&quot;
+static FILTER_PARAM Eq2Param={8,{&quot;contrast&quot;,&quot;brightness&quot;,&quot;saturation&quot;,
+                                &quot;gamma&quot;,&quot;gamma_weight&quot;,&quot;rgamma&quot;,&quot;ggamma&quot;,&quot;bgamma&quot;}};
+
+/*=====================================*/
+/*=====================================*/
+class  ADMVideoEq2:public AVDMGenericVideoStream
+{
+
+  protected:
+    AVDMGenericVideoStream  *_in;           
+    virtual char            *printConf(void);
+            void            update(void);
+            Eq2_Param       *_param;    
+            VideoCache      *vidCache; 
+            float           _hue;
+            float           _saturation;
+            Eq2Settings     settings;            
+  public:
+                
+                        ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *setup);
+    virtual             ~ADMVideoEq2();
+    virtual uint8_t     configure(AVDMGenericVideoStream *in);
+    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                          ADMImage *data,uint32_t *flags);
+
+             uint8_t     getCoupledConf( CONFcouple **couples);
+}     ;
+
+
+VF_DEFINE_FILTER_UI(ADMVideoEq2,Eq2Param,
+    eq2,
+                                QT_TR_NOOP(&quot;MPlayer eq2&quot;),
+                                1,
+                                VF_COLORS,
+                                QT_TR_NOOP(&quot;Adjust contrast, brightness, saturation and gamma.&quot;));
+
+uint8_t ADMVideoEq2::configure(AVDMGenericVideoStream *in)
+{
+  uint8_t r=1;
+  float h,s;
+  _in=in;   
+  r=DIA_getEQ2Param(_param,in);
+  update();
+  return r;        
+}
+char *ADMVideoEq2::printConf( void )
+{
+  static char buf[50];
+        
+  sprintf((char *)buf,&quot; Eq2 :Cont:%1.2f Brigh:%1.2f Sat:%1.2f&quot;,
+                _param-&gt;contrast,_param-&gt;brightness,_param-&gt;saturation);
+  return buf;
+}
+
+ADMVideoEq2::ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+  
+  _in=in;         
+  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+  _info.encoding=1; 
+  _param=new  Eq2_Param;
+  if(couples)
+  {                 
+    GET(contrast); 
+    GET(brightness);    
+    GET(saturation); 
+    GET(gamma); 
+    GET(gamma_weight); 
+    GET(rgamma); 
+    GET(ggamma); 
+    GET(bgamma); 
+  }
+  else
+  {
+    _param-&gt;contrast =1.0;                
+    _param-&gt;brightness=0.0;
+    _param-&gt;saturation =1.0;  
+    _param-&gt;gamma =1.0; 
+    _param-&gt;gamma_weight=1.0; 
+    _param-&gt;rgamma =1.0; 
+    _param-&gt;ggamma =1.0; 
+    _param-&gt;bgamma =1.0;    
+  }      
+  vidCache=new VideoCache(1,_in);
+  update();
+    
+   
+}
+void ADMVideoEq2::update(void)
+{
+   update_lut(&amp;settings,_param);      
+}
+ADMVideoEq2::~ADMVideoEq2()
+{
+  delete _param;
+  delete vidCache;
+  
+}
+uint8_t ADMVideoEq2::getCoupledConf( CONFcouple **couples)
+{
+  ADM_assert(_param);
+  *couples=new CONFcouple(8);
+
+
+                CSET(contrast);
+                CSET(brightness);
+                CSET(saturation);
+                CSET(gamma); 
+                CSET(gamma_weight); 
+                CSET(rgamma); 
+                CSET(ggamma); 
+                CSET(bgamma); 
+                return 1;
+}
+
+
+uint8_t ADMVideoEq2::getFrameNumberNoAlloc(uint32_t frame,
+                                             uint32_t *len,
+                                             ADMImage *data,
+                                             uint32_t *flags)
+{
+  ADMImage *mysrc=NULL;
+  
+
+  if(frame&gt;=_info.nb_frames) return 0;
+  
+  mysrc=vidCache-&gt;getImage(frame);
+  if(!mysrc) return 0;
+  
+  uint32_t w,h;
+  w=_info.width;
+  h=_info.height;
+
+#ifdef ADM_CPU_X86
+  if(CpuCaps::hasMMX())
+  {
+        affine_1d_MMX(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
+        w&gt;&gt;=1;
+        h&gt;&gt;=1;
+        affine_1d_MMX(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
+        affine_1d_MMX(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
+   }
+   else
+#endif
+   {
+        apply_lut(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
+        w&gt;&gt;=1;
+        h&gt;&gt;=1;
+        apply_lut(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
+        apply_lut(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
+    }
+  vidCache-&gt;unlockAll();
+  
+  
+  return 1;
+}
+
+void update_lut(Eq2Settings *settings,Eq2_Param *_param)
+{
+     memset(settings,0,sizeof(settings));
+
+    settings-&gt;param[0].lut_clean=0;
+    settings-&gt;param[1].lut_clean=0;
+    settings-&gt;param[2].lut_clean=0;
+    settings-&gt;contrast=_param-&gt;contrast;
+    settings-&gt;brightness=_param-&gt;brightness;
+    settings-&gt;saturation=_param-&gt;saturation;
+    
+    settings-&gt;ggamma=_param-&gt;ggamma;
+    settings-&gt;bgamma=_param-&gt;bgamma;
+    settings-&gt;rgamma=_param-&gt;rgamma;
+    settings-&gt;gamma=_param-&gt;gamma;
+
+    settings-&gt;gamma_weight=_param-&gt;gamma_weight;
+    
+    if(settings-&gt;ggamma&lt;0.1) settings-&gt;ggamma=0.1;
+    
+    settings-&gt;param[0].c=_param-&gt;contrast;  
+    settings-&gt;param[0].b=_param-&gt;brightness;;
+    settings-&gt;param[0].g=settings-&gt;gamma*settings-&gt;ggamma;
+    settings-&gt;param[0].w=settings-&gt;gamma_weight;
+    
+    
+    	
+    settings-&gt;param[1].c=_param-&gt;saturation;
+    settings-&gt;param[1].b=0;
+    settings-&gt;param[1].g=sqrt(settings-&gt;bgamma/settings-&gt;ggamma);
+    settings-&gt;param[1].w=settings-&gt;gamma_weight;
+    
+    settings-&gt;param[2].c=_param-&gt;saturation;
+    settings-&gt;param[2].b=0;
+    settings-&gt;param[2].g=sqrt(settings-&gt;rgamma/settings-&gt;ggamma);
+    settings-&gt;param[2].w=settings-&gt;gamma_weight;
+    
+    //printf(&quot;GGamma:%f\n&quot;,settings-&gt;ggamma);
+    create_lut(&amp;(settings-&gt;param[0]));
+    create_lut(&amp;(settings-&gt;param[1]));
+    create_lut(&amp;(settings-&gt;param[2])); 
+}          
+
+void create_lut (oneSetting *par)
+{
+  unsigned i;
+  double   g, v;
+  double   lw, gw;
+
+  g = par-&gt;g;
+  gw = par-&gt;w;
+  lw = 1.0 - gw;
+
+  if ((g &lt; 0.001) || (g &gt; 1000.0)) {
+    g = 1.0;
+  }
+
+  g = 1.0 / g;
+
+  for (i = 0; i &lt; 256; i++) {
+    v = (double) i / 255.0;
+    v = par-&gt;c * (v - 0.5) + 0.5 + par-&gt;b;
+
+    if (v &lt;= 0.0) {
+      par-&gt;lut[i] = 0;
+    }
+    else {
+      v = v*lw + pow(v, g)*gw;
+
+      if (v &gt;= 1.0) {
+        par-&gt;lut[i] = 255;
+      }
+      else {
+        par-&gt;lut[i] = (unsigned char) (256.0 * v);
+      }
+    }
+  }
+
+#ifdef LUT16
+  for(i=0; i&lt;256*256; i++){
+    par-&gt;lut16[i]= par-&gt;lut[i&amp;0xFF] + (par-&gt;lut[i&gt;&gt;8]&lt;&lt;8);
+  }
+#endif
+
+  par-&gt;lut_clean = 1;
+}
+
+#ifdef ADM_CPU_X86
+
+void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
+  unsigned int w, unsigned int h)
+{
+  unsigned i;
+  int      contrast, brightness;
+  unsigned dstep, sstep,w3;
+  int      pel;
+  short    int brvec[4];
+  short    int contvec[4];
+  w3=w&gt;&gt;3;
+//  printf(&quot;\nmmx: src=%p dst=%p w=%d h=%d ds=%d ss=%d\n&quot;,src,dst,w,h,dstride,sstride);
+  if(par-&gt;g!=1.0) return apply_lut(par,dst,src,w,h);
+  //printf(&quot;MMX\n&quot;);
+  contrast = (int) (par-&gt;c * 256 * 16);
+  brightness = ((int) (100.0 * par-&gt;b + 100.0) * 511) / 200 - 128 - contrast / 32;
+
+  brvec[0] = brvec[1] = brvec[2] = brvec[3] = brightness;
+  contvec[0] = contvec[1] = contvec[2] = contvec[3] = contrast;
+
+  
+  asm volatile (
+        &quot;movq (%0), %%mm3 \n\t&quot;
+        &quot;movq (%1), %%mm4 \n\t&quot;
+        ::  &quot;r&quot; (brvec),&quot;r&quot; (contvec)
+        
+        );
+  while (h-- &gt; 0) {
+    asm volatile (
+      &quot;pxor %%mm0, %%mm0 \n\t&quot;
+      &quot;movl %4, %%eax\n\t&quot;
+      &quot;.p2align 4 \n\t&quot;
+      &quot;lop%=: \n\t&quot;
+      &quot;movq (%0), %%mm1 \n\t&quot;
+      &quot;movq (%0), %%mm2 \n\t&quot;
+      &quot;punpcklbw %%mm0, %%mm1 \n\t&quot;
+      &quot;punpckhbw %%mm0, %%mm2 \n\t&quot;
+      &quot;psllw $4, %%mm1 \n\t&quot;
+      &quot;psllw $4, %%mm2 \n\t&quot;
+      &quot;pmulhw %%mm4, %%mm1 \n\t&quot;
+      &quot;pmulhw %%mm4, %%mm2 \n\t&quot;
+      &quot;paddw %%mm3, %%mm1 \n\t&quot;
+      &quot;paddw %%mm3, %%mm2 \n\t&quot;
+      &quot;packuswb %%mm2, %%mm1 \n\t&quot;
+      &quot;add $8, %0 \n\t&quot;
+      &quot;movq %%mm1, (%1) \n\t&quot;
+      &quot;add $8, %1 \n\t&quot;
+      &quot;decl %%eax \n\t&quot;
+      &quot;jnz lop%= \n\t&quot;
+      : &quot;=r&quot; (src), &quot;=r&quot; (dst)
+      : &quot;0&quot; (src), &quot;1&quot; (dst), &quot;r&quot; (w3)
+      : &quot;%eax&quot;
+    );
+
+    for (i = w &amp; 7; i &gt; 0; i--) {
+      pel = ((*src++ * contrast) &gt;&gt; 12) + brightness;
+      if (pel &amp; 768) {
+        pel = (-pel) &gt;&gt; 31;
+      }
+      *dst++ = pel;
+    }
+
+  }
+
+  asm volatile ( &quot;emms \n\t&quot; ::: &quot;memory&quot; );
+}
+#endif
+
+void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
+  unsigned int w, unsigned int h)
+{           
+            
+    
+  unsigned int dstride,  sstride;
+  unsigned int i, j, w2;
+  unsigned char *lut;
+  uint16_t *lut16;
+
+   dstride=sstride=w;
+
+  lut = par-&gt;lut;
+#ifdef LUT16
+  lut16 = par-&gt;lut16;
+  w2= (w&gt;&gt;3)&lt;&lt;2;
+  for (j = 0; j &lt; h; j++) {
+    uint16_t *src16= (uint16_t*)src;
+    uint16_t *dst16= (uint16_t*)dst;
+    for (i = 0; i &lt; w2; i+=4) {
+      dst16[i+0] = lut16[src16[i+0]];
+      dst16[i+1] = lut16[src16[i+1]];
+      dst16[i+2] = lut16[src16[i+2]];
+      dst16[i+3] = lut16[src16[i+3]];
+    }
+    i &lt;&lt;= 1;
+#else
+  w2= (w&gt;&gt;3)&lt;&lt;3;
+  for (j = 0; j &lt; h; j++) {
+    for (i = 0; i &lt; w2; i+=8) {
+      dst[i+0] = lut[src[i+0]];
+      dst[i+1] = lut[src[i+1]];
+      dst[i+2] = lut[src[i+2]];
+      dst[i+3] = lut[src[i+3]];
+      dst[i+4] = lut[src[i+4]];
+      dst[i+5] = lut[src[i+5]];
+      dst[i+6] = lut[src[i+6]];
+      dst[i+7] = lut[src[i+7]];
+    }
+#endif
+    for (; i &lt; w; i++) {
+      dst[i] = lut[src[i]];
+    }
+
+    src += sstride;
+    dst += dstride;
+  }
+}  
+

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.h (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidEq2.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/ADM_vidEq2.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,61 @@
+
+#ifndef EQ2_PARAM
+#define EQ2_PARAM
+#define LUT16
+typedef struct Eq2_Param
+{
+  float     contrast ;      /* 1.0 means do nothing..*/    
+  float     brightness;     /* 0 means */
+  float     saturation;
+  
+  float     gamma;
+  float     gamma_weight;
+  float     rgamma;
+  float     ggamma;
+  float     bgamma;
+}Eq2_Param;
+//*************************
+
+
+typedef struct oneSetting {
+  unsigned char lut[256];
+#ifdef LUT16
+  uint16_t lut16[256*256];
+#endif
+  int           lut_clean;
+
+  double        c;
+  double        b;
+  double        g;
+  double        w;
+} oneSetting;
+typedef struct Eq2Settings {
+  oneSetting param[3];
+
+  double        contrast;
+  double        brightness;
+  double        saturation;
+
+  double        gamma;
+  double        gamma_weight;
+  double        rgamma;
+  double        ggamma;
+  double        bgamma;
+
+ 
+} Eq2Settings;
+//*************************
+uint8_t DIA_getEQ2Param(Eq2_Param *param,AVDMGenericVideoStream *in);
+
+void update_lut(Eq2Settings *settings,Eq2_Param *_param);
+void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
+  unsigned int w, unsigned int h);
+void create_lut (oneSetting *par);
+
+#ifdef ADM_CPU_X86
+void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
+                unsigned int w, unsigned int h);
+#endif
+
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,20 @@
+INCLUDE(vf_plugin)
+
+
+SET(eq2Common_SRCS 
+ADM_vidEq2.cpp  DIA_flyEq2.cpp
+)
+
+INCLUDE(vf_plugin_gtk)
+INCLUDE(vf_plugin_qt4)
+
+SET(eq2Gtk_SRCS gtk/DIA_eq2.cpp)
+SET(eq2QT_SRCS  qt4/Q_eq2.cpp)
+SET(eq2QT_HEADERS  qt4/Q_eq2.h)
+SET(eq2QT_UI    qt4/eq2)
+
+INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_eq2_qt4 
+                ${eq2QT_SRCS} ${eq2QT_HEADERS} ${eq2QT_UI} ${eq2Common_SRCS})
+INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_eq2_gtk 
+                ${eq2Gtk_SRCS} ${eq2Common_SRCS})
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -14,17 +14,12 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include &quot;config.h&quot;
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
 #include &lt;math.h&gt;
-#include &quot;ADM_default.h&quot;
 
-
-#include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;ADM_vidEq2.h&quot;
+
 #include &quot;DIA_flyEq2.h&quot;
 
 /************* COMMON PART *********************/

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/DIA_flyEq2.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -14,8 +14,8 @@
  ***************************************************************************/
 #ifndef FLY_EQ2_H
 #define FLY_EQ2_H
-#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
-class flyEq2 : public ADM_flyDialog
+#include &quot;ADM_vidEq2.h&quot;
+class flyEq2 : public FLY_DIALOG_TYPE
 {
   
   public:
@@ -26,7 +26,7 @@
    uint8_t    upload(void);
    uint8_t    update(void);
    			  flyEq2 (uint32_t width,uint32_t height,AVDMGenericVideoStream *in, void *canvas, void *slider) : 
-                                    	ADM_flyDialog(width, height,in,canvas, slider,1,RESIZE_AUTO)
+   			 FLY_DIALOG_TYPE(width, height,in,canvas, slider,1,RESIZE_AUTO)
                     {
                       
                     };

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/gtk/DIA_eq2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/gtk/DIA_eq2.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/gtk/DIA_eq2.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -16,12 +16,14 @@
  *                                                                         *
  ***************************************************************************/
 #include &quot;ADM_toolkitGtk.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
 
+
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 
-#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_vidEq2.h&quot;
+
 #include &quot;DIA_flyEq2.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,12 +1,10 @@
 #ifndef Q_eq2_h
 #define Q_eq2_h
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ui_eq2.h&quot;
 #include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
-#include &quot;ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h&quot;
+
+#include &quot;ADM_vidEq2.h&quot;
 #include &quot;DIA_flyEq2.h&quot;
 
 class Ui_eq2Window : public QDialog

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.cpp (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,166 @@
+/***************************************************************************
+                          Hue/Saturation filter ported from mplayer 
+ (c) Michael Niedermayer
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_vidHue.h&quot;
+#include &quot;math.h&quot;
+static FILTER_PARAM HueParam={2,{&quot;hue&quot;,&quot;saturation&quot;}};
+
+extern uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in);
+
+class  ADMVideoHue:public AVDMGenericVideoStream
+{
+
+  protected:
+    AVDMGenericVideoStream  *_in;           
+    virtual char            *printConf(void);
+            void            update(void);
+            Hue_Param       *_param;    
+            VideoCache      *vidCache; 
+            float           _hue;
+            float           _saturation;
+  public:
+                
+                        ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *setup);
+    virtual             ~ADMVideoHue();
+    virtual uint8_t     configure(AVDMGenericVideoStream *in);
+    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                          ADMImage *data,uint32_t *flags);
+
+             uint8_t     getCoupledConf( CONFcouple **couples);
+}     ;
+
+
+VF_DEFINE_FILTER_UI(ADMVideoHue,
+          HueParam,
+          hue,
+          QT_TR_NOOP(&quot;MPlayer hue&quot;),
+          1,
+          VF_COLORS,
+          QT_TR_NOOP(&quot;Adjust hue and saturation.&quot;));
+
+void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
+		    int w, int h, float hue, float sat)
+{
+	int i;
+	const int s= (int)rint(sin(hue) * (1&lt;&lt;16) * sat);
+	const int c= (int)rint(cos(hue) * (1&lt;&lt;16) * sat);
+
+	while (h--) {
+		for (i = 0; i&lt;w; i++)
+		{
+			const int u= usrc[i] - 128;
+			const int v= vsrc[i] - 128;
+			int new_u= (c*u - s*v + (1&lt;&lt;15) + (128&lt;&lt;16))&gt;&gt;16;
+			int new_v= (s*u + c*v + (1&lt;&lt;15) + (128&lt;&lt;16))&gt;&gt;16;
+			if(new_u &amp; 768) new_u= (-new_u)&gt;&gt;31;
+			if(new_v &amp; 768) new_v= (-new_v)&gt;&gt;31;
+			udst[i]= new_u;
+			vdst[i]= new_v;
+		}
+		usrc += srcstride;
+		vsrc += srcstride;
+		udst += dststride;
+		vdst += dststride;
+	}
+}
+
+
+uint8_t ADMVideoHue::configure(AVDMGenericVideoStream *in)
+{
+uint8_t r=0;
+  _in=in;   
+  r=  DIA_getHue(_param, in);
+  if(r) update();
+  return r;  
+}
+char *ADMVideoHue::printConf( void )
+{
+  static char buf[50];
+        
+  sprintf((char *)buf,&quot; Hue :%2.2f %2.2f&quot;,_param-&gt;hue,_param-&gt;saturation);
+  return buf;
+}
+
+ADMVideoHue::ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+  
+  _in=in;         
+  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+  _info.encoding=1; 
+  _param=new  Hue_Param;
+  if(couples)
+  {                 
+    GET(hue);    
+    GET(saturation); 
+  }
+  else
+  {
+    _param-&gt;hue =0.0;                
+    _param-&gt;saturation=1.0;
+  }      
+  vidCache=new VideoCache(1,_in);
+  update();
+}
+void ADMVideoHue::update(void)
+{
+    _hue=_param-&gt;hue*M_PI/180.;
+    _saturation=(100+_param-&gt;saturation)/100;
+}
+ADMVideoHue::~ADMVideoHue()
+{
+  delete _param;
+  delete vidCache;
+  
+}
+uint8_t ADMVideoHue::getCoupledConf( CONFcouple **couples)
+{
+  ADM_assert(_param);
+  *couples=new CONFcouple(2);
+
+
+                CSET(hue);
+                CSET(saturation);
+                return 1;
+}
+
+
+uint8_t ADMVideoHue::getFrameNumberNoAlloc(uint32_t frame,
+                                             uint32_t *len,
+                                             ADMImage *data,
+                                             uint32_t *flags)
+{
+  ADMImage *mysrc=NULL;
+  
+
+  if(frame&gt;=_info.nb_frames) return 0;
+  
+  mysrc=vidCache-&gt;getImage(frame);
+  if(!mysrc) return 0;
+  memcpy(YPLANE(data),YPLANE(mysrc),_info.width*_info.height);
+  HueProcess_C(VPLANE(data), UPLANE(data),
+        VPLANE(mysrc), UPLANE(mysrc),
+        _info.width&gt;&gt;1,_info.width&gt;&gt;1,
+        _info.width&gt;&gt;1,_info.height&gt;&gt;1, 
+        _hue, _saturation);
+ 
+  vidCache-&gt;unlockAll();
+  
+  
+  return 1;
+}
+
+  
+

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.h (from rev 4066, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidHue.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/ADM_vidHue.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,11 @@
+/*
+
+*/
+
+typedef struct Hue_Param
+{
+  float     hue ;           /* -180 to 180 */
+  float     saturation;     /* -180 to 180 */
+}Hue_Param;
+ void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
+		    int w, int h, float hue, float sat);

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/CMakeLists.txt	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/CMakeLists.txt	2008-05-26 17:50:21 UTC (rev 4067)
@@ -0,0 +1,20 @@
+INCLUDE(vf_plugin)
+
+
+SET(HueCommon_SRCS 
+ADM_vidHue.cpp  DIA_flyHue.cpp
+)
+
+INCLUDE(vf_plugin_gtk)
+INCLUDE(vf_plugin_qt4)
+
+SET(HueGtk_SRCS gtk/DIA_hue.cpp)
+SET(HueQT_SRCS  qt4/Q_hue.cpp)
+SET(HueQT_HEADERS  qt4/Q_hue.h)
+SET(HueQT_UI    qt4/hue)
+
+INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_hue_qt4 
+                ${HueQT_SRCS} ${HueQT_HEADERS} ${HueQT_UI} ${HueCommon_SRCS})
+INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_hue_gtk 
+                ${HueGtk_SRCS} ${HueCommon_SRCS})
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -18,21 +18,13 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
-
-
-#include &quot;config.h&quot;
-
-
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_videoFilterDynamic.h&quot;
+#include &quot;DIA_factory.h&quot;
 
-#include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidHue.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_vidHue.h&quot;
+
 #include &quot;DIA_flyHue.h&quot;
 
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/DIA_flyHue.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,6 +1,6 @@
 #ifndef FLY_HUE_H
 #define FLY_HUE_H
-class flyHue : public ADM_flyDialog
+class flyHue : public FLY_DIALOG_TYPE
 {
   
   public:
@@ -11,6 +11,6 @@
    uint8_t    upload(void);
    uint8_t    update(void);
    flyHue (uint32_t width,uint32_t height,AVDMGenericVideoStream *in,
-                                    void *canvas, void *slider) : ADM_flyDialog(width, height,in,canvas, slider,1,RESIZE_AUTO) {};
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,1,RESIZE_AUTO) {};
 };
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/gtk/DIA_hue.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/gtk/DIA_hue.cpp	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/gtk/DIA_hue.cpp	2008-05-26 17:50:21 UTC (rev 4067)
@@ -20,11 +20,11 @@
  ***************************************************************************/
 #include &quot;ADM_toolkitGtk.h&quot;
 
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidHue.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_vidHue.h&quot;
+
 #include &quot;DIA_flyHue.h&quot;
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2008-05-26 07:14:32 UTC (rev 4066)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2008-05-26 17:50:21 UTC (rev 4067)
@@ -1,12 +1,12 @@
 #ifndef Q_hue_h
 #define Q_hue_h
-
+#include &quot;DIA_flyDialog.h&quot;
 #include &quot;ui_hue.h&quot;
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_videoFilter/ADM_vidHue.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
-#include &quot;ADM_UIs/ADM_QT4/include/DIA_flyDialogQt4.h&quot;
+#include &quot;ADM_vidHue.h&quot;
+
+#include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;DIA_flyHue.h&quot;
 
 class Ui_hueWindow : public QDialog


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001323.html">[Avidemux-svn-commit] r4066 - in	branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoFilters:	AvisynthResize/qt4 MplayerResize/qt4
</A></li>
	<LI>Next message: <A HREF="001325.html">[Avidemux-svn-commit] r4068 - in	branches/avidemux_2.5_branch_gruntster: . avidemux	avidemux/ADM_filter avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_video avidemux/ADM_videoFilter	avidemux/plugins/ADM_videoFilters	avidemux/plugins/ADM_videoFilters/Rotate	avidemux/plugins/ADM_videoFilters/Srt	avidemux/plugins/ADM_videoFilters/Srt/gtk	avidemux/plugins/ADM_videoFilters/Srt/qt4	avidemux/plugins/ADM_videoFilters/Tdeint cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1324">[ date ]</a>
              <a href="thread.html#1324">[ thread ]</a>
              <a href="subject.html#1324">[ subject ]</a>
              <a href="author.html#1324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
