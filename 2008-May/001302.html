<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4045 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_editor	ADM_encoder ADM_script plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4045%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_editor%0A%09ADM_encoder%20ADM_script%20plugins/ADM_videoEncoder/ADM_vidEnc_x264%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4&In-Reply-To=%3C200805191606.m4JG6ds2014538%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001301.html">
   <LINK REL="Next"  HREF="001303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4045 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_editor	ADM_encoder ADM_script plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4045%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_editor%0A%09ADM_encoder%20ADM_script%20plugins/ADM_videoEncoder/ADM_vidEnc_x264%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4&In-Reply-To=%3C200805191606.m4JG6ds2014538%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4045 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_editor	ADM_encoder ADM_script plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon May 19 18:06:39 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001301.html">[Avidemux-svn-commit] r4044 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_userInterfaces/ADM_QT4/ADM_dialog	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/MplayerResize/qt4
</A></li>
        <LI>Next message: <A HREF="001303.html">[Avidemux-svn-commit] r4046 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_filter	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter	plugins/ADM_videoFilters plugins/ADM_videoFilters/CNR2	plugins/ADM_videoFilters/CNR2/gtk	plugins/ADM_videoFilters/ChromaShift	plugins/ADM_videoFilters/ChromaShift/gtk	plugins/ADM_videoFilters/ChromaShift/qt4	plugins/ADM_videoFilters/Clean plugins/ADM_videoFilters/Equalizer	plugins/ADM_videoFilters/Equalizer/gtk	plugins/ADM_videoFilters/MPDelogo	plugins/ADM_videoFilters/MPDelogo/gtk	plugins/ADM_videoFilters/PulldownRemoval	plugins/ADM_videoFilters/colorYUV	plugins/ADM_videoFilters/colorYUV/gtk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1302">[ date ]</a>
              <a href="thread.html#1302">[ thread ]</a>
              <a href="subject.html#1302">[ subject ]</a>
              <a href="author.html#1302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-05-19 18:06:20 +0200 (Mon, 19 May 2008)
New Revision: 4045

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.h
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.ui
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
Log:
[x264] zone support

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_edLoadSave.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_edLoadSave.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -45,8 +45,6 @@
 // Ugly but sooo usefull
 extern uint32_t frameStart,frameEnd;
 static uint32_t edFrameStart,edFrameEnd;
-uint8_t loadVideoCodecConf( char *name);
-uint8_t saveVideoCodecConf( char *name);
 const char *getCurrentContainerAsString(void);
 
 uint8_t ADM_Composer::getMarkers(uint32_t *start, uint32_t *end)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -544,16 +544,8 @@
 		options.encodeMode = getVideoEncodePluginMode(mode);
 		options.encodeModeParameter = param;
 
-		if (zparam-&gt;extraSettings)
-			delete [] (char*)zparam-&gt;extraSettings;
+		videoCodecSetConf(0, extraData);
 
-		zparam-&gt;extraSettings = extraData;
-
-		if (extraData)
-			zparam-&gt;extraSettingsLen = strlen((char*)extraData);
-		else
-			zparam-&gt;extraSettingsLen = 0;
-
 		plugin-&gt;setOptions(plugin-&gt;encoderId, &amp;options, (char*)zparam-&gt;extraSettings);
 	}
 	else if (extraConf &amp;&amp; extraData &amp;&amp; zparam-&gt;extraSettingsLen)
@@ -766,11 +758,16 @@
 		if (param-&gt;extraSettings)
 			delete [] (char*)param-&gt;extraSettings;
 
-		param-&gt;extraSettings = new char[extraLen + 1];
-		param-&gt;extraSettingsLen = extraLen;
-
-		memcpy(param-&gt;extraSettings, extraData, extraLen);
-		((char*)param-&gt;extraSettings)[extraLen] = 0;
+		if (extraData)
+		{
+			param-&gt;extraSettingsLen = strlen((char*)extraData);
+			param-&gt;extraSettings = ADM_strdup((char*)extraData);
+		}
+		else
+		{
+			param-&gt;extraSettings = NULL;
+			param-&gt;extraSettingsLen = 0;
+		}
 	}
 	else if (extraLen)
 	{
@@ -781,7 +778,7 @@
 			ADM_assert(0);
 		}
 
-		memcpy (param-&gt;extraSettings, extraData, param-&gt;extraSettingsLen);
+		memcpy(param-&gt;extraSettings, extraData, param-&gt;extraSettingsLen);
 	}
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -310,22 +310,7 @@
 	if (!videoCodecPluginSelectByGuid(guid))
 		*rval = BOOLEAN_TO_JSVAL(false);
 	else
-	{
-		// now do the conf
-		// format CBR=bitrate in kbits
-		//	  CQ=Q
-		//	  2 Pass=size
-		// We have to replace
-		if (!videoCodecConfigure(conf, 0, NULL))
-			*rval = BOOLEAN_TO_JSVAL(false);
-		else
-		{
-			if (!loadVideoCodecConf(data))
-				*rval = BOOLEAN_TO_JSVAL(false);
-			else
-				*rval = BOOLEAN_TO_JSVAL(true);
-		}
-	}
+		*rval = BOOLEAN_TO_JSVAL(videoCodecConfigure(conf, 0, (uint8_t*)data));
 
 	leaveLock();
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt	2008-05-19 16:06:20 UTC (rev 4045)
@@ -14,7 +14,7 @@
 		SET(QT_PLUGIN_NAME &quot;ADM_vidEnc_x264_Qt&quot;)
 		SET(GTK_PLUGIN_NAME &quot;ADM_vidEnc_x264_Gtk&quot;)
 		SET(PLUGIN_SUBDIR &quot;x264&quot;)
-		SET(ADM_vidEnc_x264_SRCS interface.c configGuiLoader.cpp encoder.cpp guiHelper.cpp options.cpp)
+		SET(ADM_vidEnc_x264_SRCS interface.c configGuiLoader.cpp encoder.cpp guiHelper.cpp options.cpp zoneOptions.cpp)
 
 		CONFIGURE_FILE(&quot;${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake&quot; &quot;${CMAKE_CURRENT_BINARY_DIR}/config.h&quot;)
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -63,6 +63,8 @@
 	_encodeOptions.structSize = sizeof(vidEncOptions);
 	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
 	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
+
+	memset(&amp;_param, 0, sizeof(x264_param_t));
 }
 
 x264Encoder::~x264Encoder(void)
@@ -77,6 +79,12 @@
 
 	if (_buffer)
 		delete [] _buffer;
+
+	if (_param.rc.psz_rc_eq)
+		delete [] _param.rc.psz_rc_eq;
+
+	if (_param.rc.zones)
+		delete [] _param.rc.zones;
 }
 
 void x264Encoder::setUiType(int uiType)
@@ -373,7 +381,7 @@
 			encodeParams-&gt;frameType = ADM_VIDENC_FRAMETYPE_B;
 			break;
 		default:
-			printf (&quot;[x264] Unknown image type: %d\n&quot;, picture_out.i_type);
+			printf(&quot;[x264] Unknown image type: %d\n&quot;, picture_out.i_type);
 	}
 
 	encodeParams-&gt;quantiser = picture_out.i_qpplus1;
@@ -611,6 +619,8 @@
 	printf(&quot;[x264] rc.i_vbv_max_bitrate = %d\n&quot;, x264Param-&gt;rc.i_vbv_max_bitrate);
 	printf(&quot;[x264] rc.i_vbv_buffer_size = %d\n&quot;, x264Param-&gt;rc.i_vbv_buffer_size);
 	printf(&quot;[x264] rc.f_vbv_buffer_init = %f\n&quot;, x264Param-&gt;rc.f_vbv_buffer_init);
+	printf(&quot;[x264] rc.i_zones = %d\n&quot;, x264Param-&gt;rc.i_zones);
+	printf(&quot;[x264] rc.psz_rc_eq = %s\n&quot;, x264Param-&gt;rc.psz_rc_eq);
 
 	printf(&quot;[x264] i_level_idc = %d\n&quot;, x264Param-&gt;i_level_idc);
 	printf(&quot;[x264] i_sps_id = %d\n&quot;, x264Param-&gt;i_sps_id);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -14,6 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 
+#include &lt;math.h&gt;
 #include &lt;libxml/parser.h&gt;
 #include &lt;libxml/xmlschemas.h&gt;
 
@@ -36,7 +37,9 @@
 x264Options::~x264Options(void)
 {
 	if (_param.rc.psz_rc_eq)
-		free(_param.rc.psz_rc_eq);
+		delete [] _param.rc.psz_rc_eq;
+
+	clearZones();
 }
 
 x264_param_t* x264Options::getParameters(void)
@@ -45,7 +48,16 @@
 
 	memcpy(param, &amp;_param, sizeof(x264_param_t));
 	param-&gt;rc.psz_rc_eq = strdup(_param.rc.psz_rc_eq);
+	param-&gt;rc.i_zones = getZoneCount();
 
+	if (param-&gt;rc.i_zones)
+	{
+		param-&gt;rc.zones = new x264_zone_t[param-&gt;rc.i_zones];
+
+		for (int zone = 0; zone &lt; param-&gt;rc.i_zones; zone++)
+			_zoneOptions[zone]-&gt;setX264Zone(&amp;param-&gt;rc.zones[zone]);
+	}
+
 	return param;
 }
 
@@ -846,7 +858,7 @@
 	return _param.rc.psz_rc_eq;
 }
 
-void x264Options::setRateControlEquation(char* rateControlEquation)
+void x264Options::setRateControlEquation(char *rateControlEquation)
 {
 	if (_param.rc.psz_rc_eq)
 		free(_param.rc.psz_rc_eq);
@@ -889,9 +901,35 @@
 
 unsigned int x264Options::getZoneCount(void)
 {
-	return _param.rc.i_zones;
+	return _zoneOptions.size();
 }
 
+x264ZoneOptions** x264Options::getZones(void)
+{
+	unsigned int zoneCount = getZoneCount();
+	x264ZoneOptions **zoneOptions = new x264ZoneOptions*[zoneCount];
+
+	for (int zone = 0; zone &lt; zoneCount; zone++)
+		zoneOptions[zone] = _zoneOptions[zone]-&gt;clone();
+
+	return zoneOptions;
+}
+
+void x264Options::clearZones(void)
+{
+	for (int zone = 0; zone &lt; getZoneCount(); zone++)
+		delete _zoneOptions[zone];
+
+	_zoneOptions.clear();
+}
+
+void x264Options::addZone(x264ZoneOptions *zoneOptions)
+{
+	x264ZoneOptions *clonedOptions = zoneOptions-&gt;clone();
+
+	_zoneOptions.push_back(clonedOptions);
+}
+
 bool x264Options::getAccessUnitDelimiters(void)
 {
 	return _param.b_aud;
@@ -926,11 +964,11 @@
 	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)&quot;1.0&quot;);
 	xmlNodePtr xmlNodeRoot;
 	xmlNodePtr xmlNodeChild, xmlNodeChild2;
-	xmlChar* tempBuffer;
+	xmlChar *tempBuffer;
 	int tempBufferSize;
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	char* xml = NULL;
+	char *xml = NULL;
 
 	while (true)
 	{
@@ -1282,12 +1320,25 @@
 
 		if (zoneCount)
 		{
-			xmlNodeChild2 = xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;zone&quot;, NULL);
+			x264ZoneOptions** zoneOptions = getZones();
 
 			for (int zoneIndex = 0; zoneIndex &lt; zoneCount; zoneIndex++)
 			{
+				xmlNodeChild2 = xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;zone&quot;, NULL);
+				x264ZoneOptions* option = zoneOptions[zoneIndex];
 
+				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameStart&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameStart()));
+				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameEnd&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameEnd()));
+
+				if (zoneOptions[zoneIndex]-&gt;getZoneMode() == ZONE_MODE_QUANTISER)
+					xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;quantiser&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter()));
+				else
+					xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;bitrateFactor&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter() / 100.f));
+
+				delete option;
 			}
+
+			delete [] zoneOptions;
 		}
 
 		xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;accessUnitDelimiters&quot;, boolean2String(xmlBuffer, bufferSize, getAccessUnitDelimiters()));
@@ -1325,10 +1376,12 @@
 	return xml;
 }
 
-int x264Options::fromXml(char* xml)
+int x264Options::fromXml(char *xml)
 {
-	const char* schemaFile = &quot;x264Param.xsd&quot;;
-	char* pluginDir = ADM_getPluginPath();
+	clearZones();
+
+	const char *schemaFile = &quot;x264Param.xsd&quot;;
+	char *pluginDir = ADM_getPluginPath();
 	char schemaPath[strlen(pluginDir) + strlen(PLUGIN_SUBDIR) + 1 + strlen(schemaFile) + 1];
 	bool success = false;
 
@@ -1477,7 +1530,7 @@
 	return success;
 }
 
-void x264Options::parseVuiOptions(xmlNode* node)
+void x264Options::parseVuiOptions(xmlNode *node)
 {
 	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
 	{
@@ -1602,7 +1655,7 @@
 	}
 }
 
-void x264Options::parseCqmOption(xmlNode* node, uint8_t cqm[])
+void x264Options::parseCqmOption(xmlNode *node, uint8_t cqm[])
 {
 	int index = 0;
 
@@ -1620,7 +1673,7 @@
 	}
 }
 
-void x264Options::parseAnalyseOptions(xmlNode* node)
+void x264Options::parseAnalyseOptions(xmlNode *node)
 {
 	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
 	{
@@ -1740,7 +1793,7 @@
 	}
 }
 
-void x264Options::parseRateControlOptions(xmlNode* node)
+void x264Options::parseRateControlOptions(xmlNode *node)
 {
 	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
 	{
@@ -1791,6 +1844,8 @@
 				setReduceFluxBeforeCurveCompression(atof(content));
 			else if (strcmp((char*)xmlChild-&gt;name, &quot;reduceFluxAfterCurveCompression&quot;) == 0)
 				setReduceFluxAfterCurveCompression(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;zone&quot;) == 0)
+				parseZoneOptions(xmlChild);
 			else
 				printf(&quot;%s\n&quot;, xmlChild-&gt;name);
 
@@ -1799,29 +1854,52 @@
 	}
 }
 
+void x264Options::parseZoneOptions(xmlNode *zoneNode)
+{
+	x264ZoneOptions option;
 
-xmlChar* x264Options::number2String(xmlChar* buffer, size_t size, int number)
+	for (xmlNode *xmlChild = zoneNode-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		char *content = (char*)xmlNodeGetContent(xmlChild);
+
+		if (strcmp((char*)xmlChild-&gt;name, &quot;frameStart&quot;) == 0)
+			option.setFrameRange(atoi(content), option.getFrameEnd());
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;frameEnd&quot;) == 0)
+			option.setFrameRange(option.getFrameStart(), atoi(content));
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiser&quot;) == 0)
+			option.setQuantiser(atoi(content));
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;bitrateFactor&quot;) == 0)
+			option.setBitrateFactor((int)floor(atoi(content) * 100 + .5));
+
+		xmlFree(content);
+	}
+
+	addZone(&amp;option);
+}
+
+
+xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, int number)
 {
 	snprintf((char*)buffer, size, &quot;%d&quot;, number);
 
 	return buffer;
 }
 
-xmlChar* x264Options::number2String(xmlChar* buffer, size_t size, unsigned int number)
+xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, unsigned int number)
 {
 	snprintf((char*)buffer, size, &quot;%d&quot;, number);
 
 	return buffer;
 }
 
-xmlChar* x264Options::number2String(xmlChar* buffer, size_t size, float number)
+xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, float number)
 {
 	snprintf((char*)buffer, size, &quot;%f&quot;, number);
 
 	return buffer;
 }
 
-xmlChar* x264Options::boolean2String(xmlChar* buffer, size_t size, bool boolean)
+xmlChar* x264Options::boolean2String(xmlChar *buffer, size_t size, bool boolean)
 {
 	if (boolean)
 		strcpy((char*)buffer, &quot;true&quot;);
@@ -1831,7 +1909,7 @@
 	return buffer;
 }
 
-bool x264Options::string2Boolean(char* buffer)
+bool x264Options::string2Boolean(char *buffer)
 {
 	return (strcmp(buffer, &quot;true&quot;) == 0);
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -17,8 +17,11 @@
 #ifndef options_h
 #define options_h
 
+#include &lt;vector&gt;
 #include &lt;libxml/tree.h&gt;
 
+#include &quot;zoneOptions.h&quot;
+
 extern &quot;C&quot;
 {
 #include &quot;x264.h&quot;
@@ -32,17 +35,19 @@
 {
 private:
 	x264_param_t _param;
+	std::vector&lt;x264ZoneOptions*&gt; _zoneOptions;
 	bool _sarAsInput;
 
-	xmlChar* number2String(xmlChar* buffer, size_t size, int number);
-	xmlChar* number2String(xmlChar* buffer, size_t size, unsigned int number);
-	xmlChar* number2String(xmlChar* buffer, size_t size, float number);
-	xmlChar* boolean2String(xmlChar* buffer, size_t size, bool boolean);
-	bool string2Boolean(char* buffer);
-	void parseVuiOptions(xmlNode* node);
-	void parseCqmOption(xmlNode* node, uint8_t cqm[]);
-	void parseAnalyseOptions(xmlNode* node);
-	void parseRateControlOptions(xmlNode* node);
+	xmlChar* number2String(xmlChar *buffer, size_t size, int number);
+	xmlChar* number2String(xmlChar *buffer, size_t size, unsigned int number);
+	xmlChar* number2String(xmlChar *buffer, size_t size, float number);
+	xmlChar* boolean2String(xmlChar *buffer, size_t size, bool boolean);
+	bool string2Boolean(char *buffer);
+	void parseVuiOptions(xmlNode *node);
+	void parseCqmOption(xmlNode *node, uint8_t cqm[]);
+	void parseAnalyseOptions(xmlNode *node);
+	void parseRateControlOptions(xmlNode *node);
+	void parseZoneOptions(xmlNode *zoneNode);
 
 public:
 	x264Options(void);
@@ -269,7 +274,7 @@
 #endif
 
 	char* getRateControlEquation(void);
-	void setRateControlEquation(char* rateControlEquation);
+	void setRateControlEquation(char *rateControlEquation);
 
 	float getQuantiserCurveCompression(void);
 	void setQuantiserCurveCompression(float quantiserCurveCompression);
@@ -281,6 +286,9 @@
 	void setReduceFluxAfterCurveCompression(float reduceFluxAfterCurveCompression);
 
 	unsigned int getZoneCount(void);
+	x264ZoneOptions** getZones(void);
+	void clearZones(void);
+	void addZone(x264ZoneOptions *zoneOptions);
 
 	bool getAccessUnitDelimiters(void);
 	void setAccessUnitDelimiters(bool accessUnitDelimiters);
@@ -289,7 +297,7 @@
 	void setSpsIdentifier(unsigned int spsIdentifier);
 
 	char* toXml(void);
-	int fromXml(char* xml);
+	int fromXml(char *xml);
 };
 
 #endif	// options_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt	2008-05-19 16:06:20 UTC (rev 4045)
@@ -4,9 +4,12 @@
 checkQt4()
 
 IF (QT4_FOUND)
-	QT4_WRAP_UI(x264Qt_headers x264ConfigDialog.ui x264CustomMatrixDialog.ui x264ZonesDialog.ui)
-	QT4_WRAP_CPP(x264Qt_source x264ConfigDialog.h x264CustomMatrixDialog.h x264ZonesDialog.h)
-	SET(ADM_vidEnc_x264_Qt_SRCS ${x264Qt_headers} ${x264Qt_source} x264ConfigDialog.cpp x264CustomMatrixDialog.cpp x264ZonesDialog.cpp)
+	QT4_WRAP_UI(x264Qt_headers
+		x264ConfigDialog.ui x264CustomMatrixDialog.ui)
+	QT4_WRAP_CPP(x264Qt_source
+		x264ConfigDialog.h x264CustomMatrixDialog.h x264ZoneTableModel.h x264ZoneTableDelegate.h)
+	SET(ADM_vidEnc_x264_Qt_SRCS 
+		${x264Qt_headers} ${x264Qt_source} x264ConfigDialog.cpp x264CustomMatrixDialog.cpp x264ZoneTableModel.cpp x264ZoneTableDelegate.cpp)
 	
 	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
 	ADD_LIBRARY(${QT_PLUGIN_NAME} SHARED ${ADM_vidEnc_x264_Qt_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -21,7 +21,6 @@
 
 #include &quot;x264ConfigDialog.h&quot;
 #include &quot;x264CustomMatrixDialog.h&quot;
-#include &quot;x264ZonesDialog.h&quot;
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
@@ -48,8 +47,6 @@
 
 	ui.setupUi(this);
 
-	//connect(ui.defaultButton, SIGNAL(pressed()), this, SLOT(defaultButton_pressed()));
-
 	// General tab
 	lastBitrate = 1500;
 	lastVideoSize = 700;
@@ -85,13 +82,23 @@
 #endif
 
 	// Advanced tab
+	ui.zoneTableView-&gt;sortByColumn(0, Qt::AscendingOrder);
+	ui.zoneTableView-&gt;setModel(&amp;_zoneTableModel);
+	ui.zoneTableView-&gt;setItemDelegate(&amp;_zoneTableDelegate);
+
+	ui.zoneTableView-&gt;setColumnWidth(0, 80);
+	ui.zoneTableView-&gt;setColumnWidth(1, 80);
+	ui.zoneTableView-&gt;setColumnWidth(2, 100);
+	ui.zoneTableView-&gt;setColumnWidth(3, 80);
+
 	connect(ui.zoneAddButton, SIGNAL(pressed()), this, SLOT(zoneAddButton_pressed()));
 	connect(ui.zoneEditButton, SIGNAL(pressed()), this, SLOT(zoneEditButton_pressed()));
+	connect(ui.zoneDeleteButton, SIGNAL(pressed()), this, SLOT(zoneDeleteButton_pressed()));
 	connect(ui.frameTypeFileButton, SIGNAL(pressed()), this, SLOT(frameTypeFileButton_pressed()));	
 
 	loadSettings(encodeOptions, options);
 }
-
+/*
 void x264ConfigDialog::defaultButton_pressed()
 {
 	if (GUI_Question(QT_TR_NOOP(&quot;Are you sure you wish to reset all options to defaults?&quot;)))
@@ -105,7 +112,7 @@
 		loadSettings(&amp;defaultEncodeOptions, &amp;defaultOptions);
 	}
 }
-
+*/
 // General tab
 void x264ConfigDialog::encodingModeComboBox_currentIndexChanged(int index)
 {
@@ -236,20 +243,20 @@
 
 void x264ConfigDialog::zoneAddButton_pressed()
 {
-	x264ZonesDialog dialog;
-
-	if (dialog.exec() == QDialog::Accepted)
-	{
-	}
+	_zoneTableModel.insertRows(0, 1, QModelIndex());
+	ui.zoneTableView-&gt;selectRow(0);
+	ui.zoneTableView-&gt;edit(ui.zoneTableView-&gt;currentIndex());
 }
 
 void x264ConfigDialog::zoneEditButton_pressed()
 {
-	x264ZonesDialog dialog;
+	ui.zoneTableView-&gt;edit(ui.zoneTableView-&gt;currentIndex());
+}
 
-	if (dialog.exec() == QDialog::Accepted)
-	{
-	}
+void x264ConfigDialog::zoneDeleteButton_pressed()
+{
+	if (ui.zoneTableView-&gt;currentIndex().row() &gt;= 0 &amp;&amp; GUI_Question(QT_TR_NOOP(&quot;Are you sure you wish to delete the selected zone?&quot;)))
+		_zoneTableModel.removeRows(ui.zoneTableView-&gt;currentIndex().row(), 1, QModelIndex());
 }
 
 void x264ConfigDialog::frameTypeFileButton_pressed()
@@ -469,6 +476,19 @@
 	ui.vbvBufferSizeSpinBox-&gt;setValue(options-&gt;getVbvBufferSize());
 	ui.vbvBufferOccupancySpinBox-&gt;setValue((int)floor(options-&gt;getVbvInitialOccupancy() * 100 + .5));
 
+	_zoneTableModel.removeRows();
+
+	int zoneCount = options-&gt;getZoneCount();
+
+	if (zoneCount)
+	{
+		x264ZoneOptions** zoneOptions = options-&gt;getZones();
+
+		_zoneTableModel.insertRows(0, zoneCount, QModelIndex(), zoneOptions);
+
+		delete [] zoneOptions;
+	}
+
 	// Output tab
 	if (!options-&gt;getIdcLevel())
 		options-&gt;setIdcLevel(51);
@@ -660,13 +680,16 @@
 	options-&gt;setVbvBufferSize(ui.vbvBufferSizeSpinBox-&gt;value());
 	options-&gt;setVbvInitialOccupancy((float)ui.vbvBufferOccupancySpinBox-&gt;value() / 100);
 
+	options-&gt;clearZones();
+
+	QList&lt;x264ZoneOptions*&gt; zoneOptions = _zoneTableModel.getList();
+
+	for (int zone = 0; zone &lt; zoneOptions.count(); zone++)
+		options-&gt;addZone(zoneOptions[zone]);
+
 	// Output tab
 	options-&gt;setIdcLevel(idcLevel[ui.idcLevelComboBox-&gt;currentIndex()]);
-
-	bool ok;
-	options-&gt;setSpsIdentifier(ui.spsiComboBox-&gt;currentText().toInt(&amp;ok));
-	assert(ok);
-
+	options-&gt;setSpsIdentifier(ui.spsiComboBox-&gt;currentText().toInt());
 	options-&gt;setDeterministic(ui.repeatabilityCheckBox-&gt;isChecked());
 	options-&gt;setAccessUnitDelimiters(ui.accessUnitCheckBox-&gt;isChecked());
 	options-&gt;setComputePsnr(ui.psnrCheckBox-&gt;isChecked());

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -3,6 +3,8 @@
 
 #include &quot;ui_x264ConfigDialog.h&quot;
 #include &quot;../options.h&quot;
+#include &quot;x264ZoneTableModel.h&quot;
+#include &quot;x264ZoneTableDelegate.h&quot;
 
 extern &quot;C&quot;
 {
@@ -15,6 +17,8 @@
 
 private:
 	Ui_x264ConfigDialog ui;
+	x264ZoneTableModel _zoneTableModel;
+	x264ZoneTableDelegate _zoneTableDelegate;
 
 	static const int aspectRatioCount = 4;
 	int predefinedARs[aspectRatioCount][2];
@@ -47,8 +51,6 @@
 	void saveSettings(vidEncOptions *encodeOptions, x264Options *options);
 
 private slots:
-	void defaultButton_pressed();
-
 	// General tab
 	void encodingModeComboBox_currentIndexChanged(int index);
 	void quantiserSlider_valueChanged(int value);
@@ -72,6 +74,7 @@
 	// Advanced Rate Control tab
 	void zoneAddButton_pressed();
 	void zoneEditButton_pressed();
+	void zoneDeleteButton_pressed();
 	void frameTypeFileButton_pressed();
 };
 #endif	// x264ConfigDialog_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2008-05-19 16:06:20 UTC (rev 4045)
@@ -3315,7 +3315,14 @@
              &lt;number&gt;6&lt;/number&gt;
             &lt;/property&gt;
             &lt;item&gt;
-             &lt;widget class=&quot;QListView&quot; name=&quot;listView&quot; /&gt;
+             &lt;widget class=&quot;QTableView&quot; name=&quot;zoneTableView&quot; &gt;
+              &lt;property name=&quot;selectionMode&quot; &gt;
+               &lt;enum&gt;QAbstractItemView::SingleSelection&lt;/enum&gt;
+              &lt;/property&gt;
+              &lt;property name=&quot;selectionBehavior&quot; &gt;
+               &lt;enum&gt;QAbstractItemView::SelectRows&lt;/enum&gt;
+              &lt;/property&gt;
+             &lt;/widget&gt;
             &lt;/item&gt;
             &lt;item&gt;
              &lt;layout class=&quot;QVBoxLayout&quot; &gt;
@@ -4258,7 +4265,6 @@
   &lt;tabstop&gt;quantiserCurveCompressSpinBox&lt;/tabstop&gt;
   &lt;tabstop&gt;quantiserBeforeCompressSpinBox&lt;/tabstop&gt;
   &lt;tabstop&gt;quantiserAfterCompressSpinBox&lt;/tabstop&gt;
-  &lt;tabstop&gt;listView&lt;/tabstop&gt;
   &lt;tabstop&gt;zoneAddButton&lt;/tabstop&gt;
   &lt;tabstop&gt;zoneEditButton&lt;/tabstop&gt;
   &lt;tabstop&gt;zoneDeleteButton&lt;/tabstop&gt;

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,103 @@
+/***************************************************************************
+                         x264ZoneTableDelegate.cpp
+                         -------------------------
+
+    begin                : Fri May 16 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;QtGui/QComboBox&gt;
+#include &lt;QtGui/QSpinBox&gt;
+
+#include &quot;x264ZoneTableDelegate.h&quot;
+
+x264ZoneTableDelegate::x264ZoneTableDelegate(QObject *parent) : QItemDelegate(parent)
+{
+}
+
+QWidget *x264ZoneTableDelegate::createEditor(QWidget *parent, const QStyleOptionViewItem &amp;option, const QModelIndex &amp;index) const
+{
+	QSpinBox *spinBox;
+	QComboBox *comboBox;
+
+	switch (index.column())
+	{
+		case 0:
+			spinBox = new QSpinBox(parent);
+
+			spinBox-&gt;setMinimum(0);
+			spinBox-&gt;setMaximum(9999999);
+
+			return spinBox;
+		case 1:
+			spinBox = new QSpinBox(parent);
+
+			spinBox-&gt;setMinimum(0);
+			spinBox-&gt;setMaximum(9999999);
+
+			return spinBox;
+		case 2:
+			comboBox = new QComboBox(parent);
+
+			comboBox-&gt;addItem(QT_TR_NOOP(&quot;Quantiser&quot;));
+			comboBox-&gt;addItem(QT_TR_NOOP(&quot;Bitrate Factor&quot;));
+
+			return comboBox;
+		case 3:
+			spinBox = new QSpinBox(parent);
+
+			spinBox-&gt;setMinimum(0);
+			spinBox-&gt;setMaximum(9999);
+
+			return spinBox;
+	}
+}
+
+void x264ZoneTableDelegate::setEditorData(QWidget *editor, const QModelIndex &amp;index) const
+{
+	int value = index.model()-&gt;data(index, Qt::EditRole).toInt();
+
+	if (index.column() == 2)
+	{
+		QComboBox *comboBox = static_cast&lt;QComboBox*&gt;(editor);
+		comboBox-&gt;setCurrentIndex(value);
+	}
+	else
+	{
+		QSpinBox *spinBox = static_cast&lt;QSpinBox*&gt;(editor);
+		spinBox-&gt;setValue(value);
+	}
+}
+
+void x264ZoneTableDelegate::setModelData(QWidget *editor, QAbstractItemModel *model, const QModelIndex &amp;index) const
+{
+	int value;
+
+	if (index.column() == 2)
+	{
+		QComboBox *comboBox = static_cast&lt;QComboBox*&gt;(editor);
+		value = comboBox-&gt;currentIndex();
+	}
+	else
+	{
+		QSpinBox *spinBox = static_cast&lt;QSpinBox*&gt;(editor);
+		spinBox-&gt;interpretText();
+		value = spinBox-&gt;value();
+	}
+
+	model-&gt;setData(index, value, Qt::EditRole);
+}
+
+void x264ZoneTableDelegate::updateEditorGeometry(QWidget *editor, const QStyleOptionViewItem &amp;option, const QModelIndex &amp;index) const
+{
+	editor-&gt;setGeometry(option.rect);
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,18 @@
+#ifndef x264ZoneTableDelegate_h
+#define x264ZoneTableDelegate_h
+
+#include &lt;QtCore/QModelIndex&gt;
+#include &lt;QtGui/QItemDelegate&gt;
+
+class x264ZoneTableDelegate : public QItemDelegate
+{
+    Q_OBJECT
+
+public:
+    x264ZoneTableDelegate(QObject *parent = 0);
+    QWidget *createEditor(QWidget *parent, const QStyleOptionViewItem &amp;option, const QModelIndex &amp;index) const;
+    void setEditorData(QWidget *editor, const QModelIndex &amp;index) const;
+    void setModelData(QWidget *editor, QAbstractItemModel *model, const QModelIndex &amp;index) const;
+    void updateEditorGeometry(QWidget *editor, const QStyleOptionViewItem &amp;option, const QModelIndex &amp;index) const;
+};
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,227 @@
+/***************************************************************************
+                           x264ZoneTableModel.cpp
+                           ----------------------
+
+    begin                : Fri May 16 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;x264ZoneTableModel.h&quot;
+
+x264ZoneTableModel::x264ZoneTableModel(QObject *parent) : QAbstractTableModel(parent)
+{
+}
+
+x264ZoneTableModel::x264ZoneTableModel(QList&lt;x264ZoneOptions*&gt; zoneData, QObject *parent) : QAbstractTableModel(parent)
+{
+	_zoneData = zoneData;
+}
+
+x264ZoneTableModel::~x264ZoneTableModel()
+{
+	for (int zone = 0; zone &lt; _zoneData.size(); zone++)
+		delete _zoneData[zone];
+
+	_zoneData.clear();
+}
+
+int x264ZoneTableModel::rowCount(const QModelIndex &amp;parent) const
+{
+	Q_UNUSED(parent);
+
+	return _zoneData.size();
+}
+
+int x264ZoneTableModel::columnCount(const QModelIndex &amp;parent) const
+{
+	Q_UNUSED(parent);
+
+	return 4;
+}
+
+QVariant x264ZoneTableModel::data(const QModelIndex &amp;index, int role) const
+{
+	if (!index.isValid())
+		return QVariant();
+
+	if (index.row() &gt;= _zoneData.size() || index.row() &lt; 0)
+		return QVariant();
+
+    if (role != Qt::DisplayRole &amp;&amp; role != Qt::EditRole)
+        return QVariant();
+
+	x264ZoneOptions *zoneOptions = _zoneData.at(index.row());
+
+	switch (index.column())
+	{
+		case 0:
+			return zoneOptions-&gt;getFrameStart();
+		case 1:
+			return zoneOptions-&gt;getFrameEnd();
+		case 2:
+			if (role == Qt::DisplayRole)
+			{
+				switch (zoneOptions-&gt;getZoneMode())
+				{
+					case ZONE_MODE_QUANTISER:
+						return QT_TR_NOOP(&quot;Quantiser&quot;);
+					case ZONE_MODE_BITRATE_FACTOR:
+						return QT_TR_NOOP(&quot;Bitrate Factor&quot;);
+				}
+			}
+			else if (role == Qt::EditRole)
+			{
+				switch (zoneOptions-&gt;getZoneMode())
+				{
+					case ZONE_MODE_QUANTISER:
+						return 0;
+					case ZONE_MODE_BITRATE_FACTOR:
+						return 1;
+				}
+			}
+
+			break;
+		case 3:
+			return zoneOptions-&gt;getZoneParameter();
+	}
+
+	return QVariant();
+}
+
+QVariant x264ZoneTableModel::headerData(int section, Qt::Orientation orientation, int role) const
+{
+	if (role != Qt::DisplayRole)
+		return QVariant();
+
+	if (orientation == Qt::Horizontal)
+	{
+		switch (section)
+		{
+			case 0:
+				return QT_TR_NOOP(&quot;Frame Start&quot;);    
+			case 1:
+				return QT_TR_NOOP(&quot;Frame End&quot;);
+			case 2:
+				return QT_TR_NOOP(&quot;Mode&quot;);
+			case 3:
+				return QT_TR_NOOP(&quot;Value&quot;);
+			default:
+				return QVariant();
+		}
+	}
+
+	return QVariant();
+}
+
+bool x264ZoneTableModel::insertRows(int position, int rows, const QModelIndex &amp;index)
+{
+	beginInsertRows(index, position, position + rows - 1);
+
+	for (int row = 0; row &lt; rows; row++)
+	{
+		x264ZoneOptions *zoneOptions = new x264ZoneOptions;
+		_zoneData.insert(position + row, zoneOptions);
+	}
+
+	endInsertRows();
+
+	return true;
+}
+
+bool x264ZoneTableModel::insertRows(int position, int rows,  const QModelIndex &amp;index, x264ZoneOptions** zoneOptions)
+{
+	beginInsertRows(index, position, position + rows - 1);
+
+	for (int row = 0; row &lt; rows; row++)
+		_zoneData.insert(position + row, zoneOptions[row]);
+
+	endInsertRows();
+
+	return true;
+}
+
+bool x264ZoneTableModel::removeRows(int row, int count, const QModelIndex &amp;index)
+{
+	beginRemoveRows(index, row, row + count - 1);
+
+	for (int rowCount = 0; rowCount &lt; count; rowCount++)
+	{
+		delete _zoneData[row];
+		_zoneData.removeAt(row);
+	}
+
+	endRemoveRows();
+
+	return true;
+}
+
+bool x264ZoneTableModel::removeRows(void)
+{
+	if (_zoneData.size())
+		return removeRows(0, _zoneData.size(), QModelIndex());
+}
+
+bool x264ZoneTableModel::setData(const QModelIndex &amp;index, const QVariant &amp;value, int role)
+{
+	if (role == Qt::EditRole)
+	{
+		int row = index.row();
+
+		x264ZoneOptions *zoneOptions = _zoneData.value(row);
+
+		switch (index.column())
+		{
+			case 0:
+				zoneOptions-&gt;setFrameRange(value.toUInt(), zoneOptions-&gt;getFrameEnd());
+				break;
+			case 1:
+				zoneOptions-&gt;setFrameRange(zoneOptions-&gt;getFrameStart(), value.toUInt());
+				break;
+			case 2:
+				if (value.toUInt() == 0 &amp;&amp; zoneOptions-&gt;getZoneMode() != ZONE_MODE_QUANTISER)
+					zoneOptions-&gt;setQuantiser(26);
+				else if (value.toUInt() == 1 &amp;&amp; zoneOptions-&gt;getZoneMode() != ZONE_MODE_BITRATE_FACTOR)
+					zoneOptions-&gt;setBitrateFactor(100);
+
+				break;
+			case 3:
+				if (zoneOptions-&gt;getZoneMode() == ZONE_MODE_QUANTISER)
+					zoneOptions-&gt;setQuantiser(value.toUInt());
+				else
+					zoneOptions-&gt;setBitrateFactor(value.toUInt());
+
+				break;
+			default:
+				return false;
+		}
+
+		_zoneData.replace(row, zoneOptions);
+		emit(dataChanged(index, index));
+
+		return true;
+	}
+
+	return false;
+}
+
+Qt::ItemFlags x264ZoneTableModel::flags(const QModelIndex &amp;index) const
+{
+	if (!index.isValid())
+		return Qt::ItemIsEnabled;
+
+	return QAbstractTableModel::flags(index) | Qt::ItemIsEditable;
+}
+
+QList&lt;x264ZoneOptions*&gt; x264ZoneTableModel::getList()
+{
+	return _zoneData;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,35 @@
+#ifndef x264ZoneTableModel_h
+#define x264ZoneTableModel_h
+
+#include &lt;QtCore/QAbstractTableModel&gt;
+#include &lt;QtCore/QPair&gt;
+#include &lt;QtCore/QList&gt;
+
+#include &quot;../zoneOptions.h&quot;
+
+class x264ZoneTableModel : public QAbstractTableModel
+{
+    Q_OBJECT
+
+public:
+    x264ZoneTableModel(QObject *parent = 0);
+    x264ZoneTableModel(QList&lt;x264ZoneOptions*&gt; zoneData, QObject *parent = 0);
+	~x264ZoneTableModel();
+
+    int rowCount(const QModelIndex &amp;parent) const;
+    int columnCount(const QModelIndex &amp;parent) const;
+    QVariant data(const QModelIndex &amp;index, int role) const;
+    QVariant headerData(int section, Qt::Orientation orientation, int role) const;
+    Qt::ItemFlags flags(const QModelIndex &amp;index) const;
+    bool setData(const QModelIndex &amp;index, const QVariant &amp;value, int role = Qt::EditRole);
+    bool insertRows(int position, int rows, const QModelIndex &amp;index = QModelIndex());
+	bool insertRows(int position, int rows, const QModelIndex &amp;index, x264ZoneOptions** zoneOptions);
+	bool removeRows(void);
+    bool removeRows(int position, int rows, const QModelIndex &amp;index = QModelIndex());
+    QList&lt;x264ZoneOptions*&gt; getList();
+
+private:
+    QList&lt;x264ZoneOptions*&gt; _zoneData;
+};
+
+#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -1,25 +0,0 @@
-/***************************************************************************
-                     Q_x264_zones.cpp  -  description
-                     --------------------------------
-
-                      GUI for configuring x264 zones
-
-    begin                : Wed Apr 02 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;x264ZonesDialog.h&quot;
-
-x264ZonesDialog::x264ZonesDialog()
-{
-	ui.setupUi(this);
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -1,19 +0,0 @@
-#ifndef x264ZonesDialog_h
-#define x264ZonesDialog_h
-
-#include &quot;ui_x264ZonesDialog.h&quot;
-
-class x264ZonesDialog : public QDialog
-{
-	Q_OBJECT
-
-private:
-	Ui_x264ZonesDialog ui;
-
-public:
-	x264ZonesDialog();
-
-private slots:
-
-};
-#endif	// x264ZonesDialog_h

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.ui	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZonesDialog.ui	2008-05-19 16:06:20 UTC (rev 4045)
@@ -1,363 +0,0 @@
-&lt;ui version=&quot;4.0&quot; &gt;
- &lt;author&gt;&lt;/author&gt;
- &lt;comment&gt;&lt;/comment&gt;
- &lt;exportmacro&gt;&lt;/exportmacro&gt;
- &lt;class&gt;x264ZonesDialog&lt;/class&gt;
- &lt;widget class=&quot;QDialog&quot; name=&quot;x264ZonesDialog&quot; &gt;
-  &lt;property name=&quot;geometry&quot; &gt;
-   &lt;rect&gt;
-    &lt;x&gt;0&lt;/x&gt;
-    &lt;y&gt;0&lt;/y&gt;
-    &lt;width&gt;187&lt;/width&gt;
-    &lt;height&gt;239&lt;/height&gt;
-   &lt;/rect&gt;
-  &lt;/property&gt;
-  &lt;property name=&quot;windowTitle&quot; &gt;
-   &lt;string&gt;x264 Zones&lt;/string&gt;
-  &lt;/property&gt;
-  &lt;layout class=&quot;QVBoxLayout&quot; &gt;
-   &lt;property name=&quot;margin&quot; &gt;
-    &lt;number&gt;9&lt;/number&gt;
-   &lt;/property&gt;
-   &lt;property name=&quot;spacing&quot; &gt;
-    &lt;number&gt;6&lt;/number&gt;
-   &lt;/property&gt;
-   &lt;item&gt;
-    &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox_2&quot; &gt;
-     &lt;property name=&quot;title&quot; &gt;
-      &lt;string&gt;Range&lt;/string&gt;
-     &lt;/property&gt;
-     &lt;layout class=&quot;QGridLayout&quot; &gt;
-      &lt;property name=&quot;margin&quot; &gt;
-       &lt;number&gt;9&lt;/number&gt;
-      &lt;/property&gt;
-      &lt;property name=&quot;spacing&quot; &gt;
-       &lt;number&gt;6&lt;/number&gt;
-      &lt;/property&gt;
-      &lt;item row=&quot;0&quot; column=&quot;1&quot; &gt;
-       &lt;widget class=&quot;QSpinBox&quot; name=&quot;frameStartSpinBox&quot; &gt;
-        &lt;property name=&quot;maximum&quot; &gt;
-         &lt;number&gt;9999999&lt;/number&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;0&quot; column=&quot;0&quot; &gt;
-       &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot; &gt;
-        &lt;property name=&quot;text&quot; &gt;
-         &lt;string&gt;Start Frame:&lt;/string&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;1&quot; column=&quot;0&quot; &gt;
-       &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot; &gt;
-        &lt;property name=&quot;text&quot; &gt;
-         &lt;string&gt;End Frame:&lt;/string&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;1&quot; column=&quot;1&quot; &gt;
-       &lt;widget class=&quot;QSpinBox&quot; name=&quot;frameEndSpinBox&quot; &gt;
-        &lt;property name=&quot;maximum&quot; &gt;
-         &lt;number&gt;9999999&lt;/number&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;0&quot; column=&quot;2&quot; &gt;
-       &lt;spacer&gt;
-        &lt;property name=&quot;orientation&quot; &gt;
-         &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-        &lt;/property&gt;
-        &lt;property name=&quot;sizeHint&quot; &gt;
-         &lt;size&gt;
-          &lt;width&gt;40&lt;/width&gt;
-          &lt;height&gt;20&lt;/height&gt;
-         &lt;/size&gt;
-        &lt;/property&gt;
-       &lt;/spacer&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;1&quot; column=&quot;2&quot; &gt;
-       &lt;spacer&gt;
-        &lt;property name=&quot;orientation&quot; &gt;
-         &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-        &lt;/property&gt;
-        &lt;property name=&quot;sizeHint&quot; &gt;
-         &lt;size&gt;
-          &lt;width&gt;40&lt;/width&gt;
-          &lt;height&gt;20&lt;/height&gt;
-         &lt;/size&gt;
-        &lt;/property&gt;
-       &lt;/spacer&gt;
-      &lt;/item&gt;
-     &lt;/layout&gt;
-    &lt;/widget&gt;
-   &lt;/item&gt;
-   &lt;item&gt;
-    &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox&quot; &gt;
-     &lt;property name=&quot;title&quot; &gt;
-      &lt;string&gt;Mode&lt;/string&gt;
-     &lt;/property&gt;
-     &lt;layout class=&quot;QGridLayout&quot; &gt;
-      &lt;property name=&quot;margin&quot; &gt;
-       &lt;number&gt;9&lt;/number&gt;
-      &lt;/property&gt;
-      &lt;property name=&quot;spacing&quot; &gt;
-       &lt;number&gt;6&lt;/number&gt;
-      &lt;/property&gt;
-      &lt;item row=&quot;1&quot; column=&quot;1&quot; &gt;
-       &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-        &lt;property name=&quot;margin&quot; &gt;
-         &lt;number&gt;0&lt;/number&gt;
-        &lt;/property&gt;
-        &lt;property name=&quot;spacing&quot; &gt;
-         &lt;number&gt;6&lt;/number&gt;
-        &lt;/property&gt;
-        &lt;item&gt;
-         &lt;widget class=&quot;QSpinBox&quot; name=&quot;bitrateSpinBox&quot; &gt;
-          &lt;property name=&quot;enabled&quot; &gt;
-           &lt;bool&gt;false&lt;/bool&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;maximum&quot; &gt;
-           &lt;number&gt;9999&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;minimum&quot; &gt;
-           &lt;number&gt;1&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;value&quot; &gt;
-           &lt;number&gt;100&lt;/number&gt;
-          &lt;/property&gt;
-         &lt;/widget&gt;
-        &lt;/item&gt;
-        &lt;item&gt;
-         &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot; &gt;
-          &lt;property name=&quot;enabled&quot; &gt;
-           &lt;bool&gt;false&lt;/bool&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;text&quot; &gt;
-           &lt;string&gt;%&lt;/string&gt;
-          &lt;/property&gt;
-         &lt;/widget&gt;
-        &lt;/item&gt;
-        &lt;item&gt;
-         &lt;spacer&gt;
-          &lt;property name=&quot;orientation&quot; &gt;
-           &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;sizeHint&quot; &gt;
-           &lt;size&gt;
-            &lt;width&gt;16&lt;/width&gt;
-            &lt;height&gt;18&lt;/height&gt;
-           &lt;/size&gt;
-          &lt;/property&gt;
-         &lt;/spacer&gt;
-        &lt;/item&gt;
-       &lt;/layout&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;0&quot; column=&quot;1&quot; &gt;
-       &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-        &lt;property name=&quot;margin&quot; &gt;
-         &lt;number&gt;0&lt;/number&gt;
-        &lt;/property&gt;
-        &lt;property name=&quot;spacing&quot; &gt;
-         &lt;number&gt;6&lt;/number&gt;
-        &lt;/property&gt;
-        &lt;item&gt;
-         &lt;widget class=&quot;QSpinBox&quot; name=&quot;quantiserSpinBox&quot; &gt;
-          &lt;property name=&quot;maximum&quot; &gt;
-           &lt;number&gt;51&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;minimum&quot; &gt;
-           &lt;number&gt;1&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;value&quot; &gt;
-           &lt;number&gt;26&lt;/number&gt;
-          &lt;/property&gt;
-         &lt;/widget&gt;
-        &lt;/item&gt;
-        &lt;item&gt;
-         &lt;spacer&gt;
-          &lt;property name=&quot;orientation&quot; &gt;
-           &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;sizeHint&quot; &gt;
-           &lt;size&gt;
-            &lt;width&gt;16&lt;/width&gt;
-            &lt;height&gt;18&lt;/height&gt;
-           &lt;/size&gt;
-          &lt;/property&gt;
-         &lt;/spacer&gt;
-        &lt;/item&gt;
-       &lt;/layout&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;0&quot; column=&quot;0&quot; &gt;
-       &lt;widget class=&quot;QRadioButton&quot; name=&quot;quantiserRadioButton&quot; &gt;
-        &lt;property name=&quot;text&quot; &gt;
-         &lt;string&gt;Quantiser:&lt;/string&gt;
-        &lt;/property&gt;
-        &lt;property name=&quot;checked&quot; &gt;
-         &lt;bool&gt;true&lt;/bool&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-      &lt;item row=&quot;1&quot; column=&quot;0&quot; &gt;
-       &lt;widget class=&quot;QRadioButton&quot; name=&quot;bitrateRadioButton&quot; &gt;
-        &lt;property name=&quot;text&quot; &gt;
-         &lt;string&gt;Bitrate:&lt;/string&gt;
-        &lt;/property&gt;
-       &lt;/widget&gt;
-      &lt;/item&gt;
-     &lt;/layout&gt;
-    &lt;/widget&gt;
-   &lt;/item&gt;
-   &lt;item&gt;
-    &lt;spacer&gt;
-     &lt;property name=&quot;orientation&quot; &gt;
-      &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
-     &lt;/property&gt;
-     &lt;property name=&quot;sizeType&quot; &gt;
-      &lt;enum&gt;QSizePolicy::MinimumExpanding&lt;/enum&gt;
-     &lt;/property&gt;
-     &lt;property name=&quot;sizeHint&quot; &gt;
-      &lt;size&gt;
-       &lt;width&gt;20&lt;/width&gt;
-       &lt;height&gt;20&lt;/height&gt;
-      &lt;/size&gt;
-     &lt;/property&gt;
-    &lt;/spacer&gt;
-   &lt;/item&gt;
-   &lt;item&gt;
-    &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-     &lt;property name=&quot;margin&quot; &gt;
-      &lt;number&gt;0&lt;/number&gt;
-     &lt;/property&gt;
-     &lt;property name=&quot;spacing&quot; &gt;
-      &lt;number&gt;6&lt;/number&gt;
-     &lt;/property&gt;
-     &lt;item&gt;
-      &lt;spacer&gt;
-       &lt;property name=&quot;orientation&quot; &gt;
-        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-       &lt;/property&gt;
-       &lt;property name=&quot;sizeType&quot; &gt;
-        &lt;enum&gt;QSizePolicy::MinimumExpanding&lt;/enum&gt;
-       &lt;/property&gt;
-       &lt;property name=&quot;sizeHint&quot; &gt;
-        &lt;size&gt;
-         &lt;width&gt;1&lt;/width&gt;
-         &lt;height&gt;31&lt;/height&gt;
-        &lt;/size&gt;
-       &lt;/property&gt;
-      &lt;/spacer&gt;
-     &lt;/item&gt;
-     &lt;item&gt;
-      &lt;widget class=&quot;QPushButton&quot; name=&quot;okButton&quot; &gt;
-       &lt;property name=&quot;text&quot; &gt;
-        &lt;string&gt;OK&lt;/string&gt;
-       &lt;/property&gt;
-      &lt;/widget&gt;
-     &lt;/item&gt;
-     &lt;item&gt;
-      &lt;widget class=&quot;QPushButton&quot; name=&quot;cancelButton&quot; &gt;
-       &lt;property name=&quot;text&quot; &gt;
-        &lt;string&gt;Cancel&lt;/string&gt;
-       &lt;/property&gt;
-      &lt;/widget&gt;
-     &lt;/item&gt;
-    &lt;/layout&gt;
-   &lt;/item&gt;
-  &lt;/layout&gt;
- &lt;/widget&gt;
- &lt;pixmapfunction&gt;&lt;/pixmapfunction&gt;
- &lt;tabstops&gt;
-  &lt;tabstop&gt;frameStartSpinBox&lt;/tabstop&gt;
-  &lt;tabstop&gt;frameEndSpinBox&lt;/tabstop&gt;
-  &lt;tabstop&gt;quantiserRadioButton&lt;/tabstop&gt;
-  &lt;tabstop&gt;quantiserSpinBox&lt;/tabstop&gt;
-  &lt;tabstop&gt;bitrateRadioButton&lt;/tabstop&gt;
-  &lt;tabstop&gt;bitrateSpinBox&lt;/tabstop&gt;
-  &lt;tabstop&gt;okButton&lt;/tabstop&gt;
-  &lt;tabstop&gt;cancelButton&lt;/tabstop&gt;
- &lt;/tabstops&gt;
- &lt;resources/&gt;
- &lt;connections&gt;
-  &lt;connection&gt;
-   &lt;sender&gt;okButton&lt;/sender&gt;
-   &lt;signal&gt;clicked()&lt;/signal&gt;
-   &lt;receiver&gt;x264ZonesDialog&lt;/receiver&gt;
-   &lt;slot&gt;accept()&lt;/slot&gt;
-   &lt;hints&gt;
-    &lt;hint type=&quot;sourcelabel&quot; &gt;
-     &lt;x&gt;278&lt;/x&gt;
-     &lt;y&gt;253&lt;/y&gt;
-    &lt;/hint&gt;
-    &lt;hint type=&quot;destinationlabel&quot; &gt;
-     &lt;x&gt;96&lt;/x&gt;
-     &lt;y&gt;254&lt;/y&gt;
-    &lt;/hint&gt;
-   &lt;/hints&gt;
-  &lt;/connection&gt;
-  &lt;connection&gt;
-   &lt;sender&gt;cancelButton&lt;/sender&gt;
-   &lt;signal&gt;clicked()&lt;/signal&gt;
-   &lt;receiver&gt;x264ZonesDialog&lt;/receiver&gt;
-   &lt;slot&gt;reject()&lt;/slot&gt;
-   &lt;hints&gt;
-    &lt;hint type=&quot;sourcelabel&quot; &gt;
-     &lt;x&gt;369&lt;/x&gt;
-     &lt;y&gt;253&lt;/y&gt;
-    &lt;/hint&gt;
-    &lt;hint type=&quot;destinationlabel&quot; &gt;
-     &lt;x&gt;179&lt;/x&gt;
-     &lt;y&gt;282&lt;/y&gt;
-    &lt;/hint&gt;
-   &lt;/hints&gt;
-  &lt;/connection&gt;
-  &lt;connection&gt;
-   &lt;sender&gt;quantiserRadioButton&lt;/sender&gt;
-   &lt;signal&gt;toggled(bool)&lt;/signal&gt;
-   &lt;receiver&gt;quantiserSpinBox&lt;/receiver&gt;
-   &lt;slot&gt;setEnabled(bool)&lt;/slot&gt;
-   &lt;hints&gt;
-    &lt;hint type=&quot;sourcelabel&quot; &gt;
-     &lt;x&gt;64&lt;/x&gt;
-     &lt;y&gt;148&lt;/y&gt;
-    &lt;/hint&gt;
-    &lt;hint type=&quot;destinationlabel&quot; &gt;
-     &lt;x&gt;129&lt;/x&gt;
-     &lt;y&gt;149&lt;/y&gt;
-    &lt;/hint&gt;
-   &lt;/hints&gt;
-  &lt;/connection&gt;
-  &lt;connection&gt;
-   &lt;sender&gt;bitrateRadioButton&lt;/sender&gt;
-   &lt;signal&gt;toggled(bool)&lt;/signal&gt;
-   &lt;receiver&gt;bitrateSpinBox&lt;/receiver&gt;
-   &lt;slot&gt;setEnabled(bool)&lt;/slot&gt;
-   &lt;hints&gt;
-    &lt;hint type=&quot;sourcelabel&quot; &gt;
-     &lt;x&gt;64&lt;/x&gt;
-     &lt;y&gt;172&lt;/y&gt;
-    &lt;/hint&gt;
-    &lt;hint type=&quot;destinationlabel&quot; &gt;
-     &lt;x&gt;129&lt;/x&gt;
-     &lt;y&gt;173&lt;/y&gt;
-    &lt;/hint&gt;
-   &lt;/hints&gt;
-  &lt;/connection&gt;
-  &lt;connection&gt;
-   &lt;sender&gt;bitrateRadioButton&lt;/sender&gt;
-   &lt;signal&gt;toggled(bool)&lt;/signal&gt;
-   &lt;receiver&gt;label_3&lt;/receiver&gt;
-   &lt;slot&gt;setEnabled(bool)&lt;/slot&gt;
-   &lt;hints&gt;
-    &lt;hint type=&quot;sourcelabel&quot; &gt;
-     &lt;x&gt;64&lt;/x&gt;
-     &lt;y&gt;172&lt;/y&gt;
-    &lt;/hint&gt;
-    &lt;hint type=&quot;destinationlabel&quot; &gt;
-     &lt;x&gt;163&lt;/x&gt;
-     &lt;y&gt;173&lt;/y&gt;
-    &lt;/hint&gt;
-   &lt;/hints&gt;
-  &lt;/connection&gt;
- &lt;/connections&gt;
-&lt;/ui&gt;

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.cpp	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.cpp	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,95 @@
+/***************************************************************************
+                              zoneOptions.cpp
+
+    begin                : Thu May 15 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_inttype.h&quot;
+#include &quot;zoneOptions.h&quot;
+
+x264ZoneOptions::x264ZoneOptions(void)
+{
+	_frameStart = _frameEnd = 0;
+	_zoneMode = ZONE_MODE_QUANTISER;
+	_parameter = 26;
+}
+
+x264ZoneOptions::~x264ZoneOptions(void)
+{
+}
+
+zoneMode x264ZoneOptions::getZoneMode(void)
+{
+	return _zoneMode;
+}
+
+unsigned int x264ZoneOptions::getFrameStart(void)
+{
+	return _frameStart;
+}
+
+unsigned int x264ZoneOptions::getFrameEnd(void)
+{
+	return _frameEnd;
+}
+
+void x264ZoneOptions::setFrameRange(unsigned int frameStart, unsigned int frameEnd)
+{
+	_frameStart = frameStart;
+	_frameEnd = frameEnd;
+}
+
+unsigned int x264ZoneOptions::getZoneParameter(void)
+{
+	return _parameter;
+}
+
+void x264ZoneOptions::setQuantiser(unsigned int quantiser)
+{
+	_zoneMode = ZONE_MODE_QUANTISER;
+	_parameter = quantiser;
+}
+
+void x264ZoneOptions::setBitrateFactor(unsigned int bitrateFactor)
+{
+	_zoneMode = ZONE_MODE_BITRATE_FACTOR;
+	_parameter = bitrateFactor;
+}
+
+void x264ZoneOptions::setX264Zone(x264_zone_t *zone)
+{
+	memset(zone, 0, sizeof(x264_zone_t));
+
+	zone-&gt;i_start = _frameStart;
+	zone-&gt;i_end = _frameEnd;
+	zone-&gt;b_force_qp = (getZoneMode() == ZONE_MODE_QUANTISER);
+
+	if (zone-&gt;b_force_qp)
+		zone-&gt;i_qp = _parameter;
+	else
+		zone-&gt;f_bitrate_factor = _parameter / 100.;
+}
+
+x264ZoneOptions* x264ZoneOptions::clone(void)
+{
+	x264ZoneOptions* zoneOptions = new x264ZoneOptions;
+
+	zoneOptions-&gt;setFrameRange(getFrameStart(), getFrameEnd());
+
+	if (getZoneMode() == ZONE_MODE_QUANTISER)
+		zoneOptions-&gt;setQuantiser(getZoneParameter());
+	else
+		zoneOptions-&gt;setBitrateFactor(getZoneParameter());
+
+	return zoneOptions;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.h	2008-05-18 18:02:45 UTC (rev 4044)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/zoneOptions.h	2008-05-19 16:06:20 UTC (rev 4045)
@@ -0,0 +1,53 @@
+/***************************************************************************
+                               zoneOptions.h
+
+    begin                : Thu May 15 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef zoneOptions_h
+#define zoneOptions_h
+
+extern &quot;C&quot;
+{
+#include &quot;x264.h&quot;
+}
+
+typedef enum
+{
+	ZONE_MODE_QUANTISER,
+	ZONE_MODE_BITRATE_FACTOR
+} zoneMode;
+
+class x264ZoneOptions
+{
+private:
+    unsigned int _frameStart, _frameEnd;
+    zoneMode _zoneMode;
+    unsigned int _parameter;
+
+public:
+	x264ZoneOptions(void);
+	~x264ZoneOptions(void);
+
+	zoneMode getZoneMode(void);
+	unsigned int getFrameStart(void);
+	unsigned int getFrameEnd(void);
+	void setFrameRange(unsigned int frameStart, unsigned int frameEnd);
+	unsigned int getZoneParameter(void);
+	void setQuantiser(unsigned int quantiser);
+	void setBitrateFactor(unsigned int bitrateFactor);
+	void setX264Zone(x264_zone_t *zone);
+	x264ZoneOptions* clone(void);
+};
+
+#endif	// zoneOptions_h


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001301.html">[Avidemux-svn-commit] r4044 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_userInterfaces/ADM_QT4/ADM_dialog	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/MplayerResize/qt4
</A></li>
	<LI>Next message: <A HREF="001303.html">[Avidemux-svn-commit] r4046 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_filter	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter	plugins/ADM_videoFilters plugins/ADM_videoFilters/CNR2	plugins/ADM_videoFilters/CNR2/gtk	plugins/ADM_videoFilters/ChromaShift	plugins/ADM_videoFilters/ChromaShift/gtk	plugins/ADM_videoFilters/ChromaShift/qt4	plugins/ADM_videoFilters/Clean plugins/ADM_videoFilters/Equalizer	plugins/ADM_videoFilters/Equalizer/gtk	plugins/ADM_videoFilters/MPDelogo	plugins/ADM_videoFilters/MPDelogo/gtk	plugins/ADM_videoFilters/PulldownRemoval	plugins/ADM_videoFilters/colorYUV	plugins/ADM_videoFilters/colorYUV/gtk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1302">[ date ]</a>
              <a href="thread.html#1302">[ thread ]</a>
              <a href="subject.html#1302">[ subject ]</a>
              <a href="author.html#1302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
