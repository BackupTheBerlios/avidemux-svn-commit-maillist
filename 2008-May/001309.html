<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4052 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_render cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4052%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09avidemux/ADM_userInterfaces/ADM_render%20cmake&In-Reply-To=%3C200805211757.m4LHvY9u014021%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001308.html">
   <LINK REL="Next"  HREF="001310.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4052 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_render cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4052%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09avidemux/ADM_userInterfaces/ADM_render%20cmake&In-Reply-To=%3C200805211757.m4LHvY9u014021%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4052 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_render cmake">mean at mail.berlios.de
       </A><BR>
    <I>Wed May 21 19:57:34 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001308.html">[Avidemux-svn-commit] r4051 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
</A></li>
        <LI>Next message: <A HREF="001310.html">[Avidemux-svn-commit] r4053 - branches/avidemux_2.4_branch/avidemux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1309">[ date ]</a>
              <a href="thread.html#1309">[ thread ]</a>
              <a href="subject.html#1309">[ subject ]</a>
              <a href="author.html#1309">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-05-21 19:57:34 +0200 (Wed, 21 May 2008)
New Revision: 4052

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_gtk.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_qt4.cmake
Log:
[Merge]


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-05-21 17:57:34 UTC (rev 4052)
@@ -48,7 +48,7 @@
 extern int maxWindowWidth, maxWindowHeight; // from GUI_bindings.cpp
 #endif
 
-ColYuvRgb rgbConverter(640,480);
+
 uint32_t lastW,lastH;
 /**
     \brief return pointer to the drawing widget that displays video

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2008-05-21 17:57:34 UTC (rev 4052)
@@ -18,7 +18,7 @@
 static ADM_OUT_FORMAT format=ADM_AVI;
 static int audioCodec=0;
 static int videoCodec=0;
- ColYuvRgb rgbConverter(640,480);
+ 
 
 //**************************************************
 int 	UI_getCurrentACodec(void)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-05-21 17:57:34 UTC (rev 4052)
@@ -38,7 +38,7 @@
 static AccelRender *accelRender=NULL;
 static uint8_t *lastImage=NULL;
 extern QWidget *QuiMainWindows;
- ColYuvRgb rgbConverter(640,480,1);
+ 
 extern void UI_purge( void );
 
 void DIA_previewInit(uint32_t width, uint32_t height) {}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp	2008-05-21 17:57:34 UTC (rev 4052)
@@ -36,8 +36,12 @@
 #include &quot;ADM_colorspace.h&quot;
 
 
-extern ColYuvRgb rgbConverter; // Declared in UI_xxx as it is not the same between GTK and QT (RGB vs BGR or whatever)
 
+static ColYuvRgb rgbConverter(640,480
+#if (ADM_UI_TYPE==QT4)
+,1
+#endif
+);
 
 
 static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
@@ -241,33 +245,8 @@
 uint8_t r=0;
 	ADM_assert(!accel_mode);
         
-#if !defined __WIN32 &amp;&amp; !defined(__APPLE__)
-	// First check if local
-	// We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
-	// in that case we do not even try to use accel
-	
-	// Win32 and Mac/Qt4 don't have DISPLAY
-	displ=getenv(&quot;DISPLAY&quot;);
-	if(!displ)
-	{
-		return 0;
-	}
-	if(strcmp(displ,&quot;:0&quot;) &amp;&amp; strcmp(displ,&quot;:0.0&quot;))
-	{
-		printf(&quot;Looks like remote display, no Xv :%s\n&quot;,displ);
-		return 1;
-	}
-#endif	
+
 	render=MUI_getPreferredRender();
-#if 0	
-        if(prefs-&gt;get(DEVICE_VIDEODEVICE,&amp;renderI)!=RC_OK)
-        {       
-                render=RENDER_GTK;
-        }else
-        {
-                render=(ADM_RENDER_TYPE)renderI;
-        }
-#endif        
         GUI_WindowInfo xinfo;
         MUI_getWindowInfo(draw, &amp;xinfo);
         switch(render)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-05-21 17:57:34 UTC (rev 4052)
@@ -205,6 +205,7 @@
 MACRO (ADD_ADM_LIB_CLI_TARGET _libName)
 	ADD_LIBRARY(${_libName}_cli STATIC ${ARGN})
 	ADD_TARGET_CFLAGS(${_libName}_cli &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+	ADD_TARGET_CFLAGS(${_libName}_cli &quot;-DADM_UI_TYPE=CLI&quot;)
 ENDMACRO (ADD_ADM_LIB_CLI_TARGET)
 
 
@@ -212,6 +213,7 @@
 	IF (ADM_UI_GTK)
 		ADD_LIBRARY(${_libName}_gtk STATIC ${ARGN})
 		ADD_TARGET_CFLAGS(${_libName}_gtk &quot;-I${CMAKE_BINARY_DIR}/config/gtk&quot;)
+		ADD_TARGET_CFLAGS(${_libName}_gtk &quot;-DADM_UI_TYPE=GTK&quot;)
 	ENDIF (ADM_UI_GTK)
 ENDMACRO (ADD_ADM_LIB_GTK_TARGET)
 
@@ -219,7 +221,8 @@
 MACRO (ADD_ADM_LIB_QT4_TARGET _libName)
 	IF (ADM_UI_QT4)
 		ADD_LIBRARY(${_libName}_qt4 STATIC ${ARGN})
-		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-I${CMAKE_BINARY_DIR}/config/qt4&quot;)
+		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-I${CMAKE_BINARY_DIR}/config/qt4 &quot;)
+		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-DADM_UI_TYPE=QT4&quot;)
 	ENDIF (ADM_UI_QT4)
 ENDMACRO (ADD_ADM_LIB_QT4_TARGET)
 
@@ -227,6 +230,7 @@
 MACRO (ADD_ADM_SHARED_LIB_CLI_TARGET _libName)
 	ADD_LIBRARY(${_libName}_cli SHARED ${ARGN})
 	ADD_TARGET_CFLAGS(${_libName}_cli &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+	ADD_TARGET_CFLAGS(${_libName}_cli &quot;-DADM_UI_TYPE=CLI&quot;)
 ENDMACRO (ADD_ADM_SHARED_LIB_CLI_TARGET)
 
 
@@ -234,6 +238,7 @@
 	IF (ADM_UI_GTK)
 		ADD_LIBRARY(${_libName}_gtk SHARED ${ARGN})
 		ADD_TARGET_CFLAGS(${_libName}_gtk &quot;-I${CMAKE_BINARY_DIR}/config/gtk&quot;)
+		ADD_TARGET_CFLAGS(${_libName}_gtk &quot;-DADM_UI_TYPE=GTK&quot;)
 	ENDIF (ADM_UI_GTK)
 ENDMACRO (ADD_ADM_SHARED_LIB_GTK_TARGET)
 
@@ -242,6 +247,7 @@
 	IF (ADM_UI_QT4)
 		ADD_LIBRARY(${_libName}_qt4 SHARED ${ARGN})
 		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-I${CMAKE_BINARY_DIR}/config/qt4&quot;)
+		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-DADM_UI_TYPE=QT4&quot;)
 	ENDIF (ADM_UI_QT4)
 ENDMACRO (ADD_ADM_SHARED_LIB_QT4_TARGET)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_gtk.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_gtk.cmake	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_gtk.cmake	2008-05-21 17:57:34 UTC (rev 4052)
@@ -17,12 +17,13 @@
 
         ADD_LIBRARY(${lib} SHARED ${_srcsCommon} ${_srcsGtk})
         INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/ ../../../ADM_UIs/ADM_GTK/include/)
-        TARGET_LINK_LIBRARIES( ${lib} ADM_UIGtk)
+        TARGET_LINK_LIBRARIES( ${lib} ADM_UIGtk ADM_render_gtk)
         TARGET_LINK_LIBRARIES(${lib} ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
         	
 	IF (GETTEXT_FOUND)
 		TARGET_LINK_LIBRARIES(${lib} ${GETTEXT_LIBRARY_DIR})
 	ENDIF(GETTEXT_FOUND)
+		ADD_TARGET_CFLAGS(${lib} &quot;-DADM_UI_TYPE=GTK&quot;)
         INIT_VIDEOFILTER_PLUGIN(${lib})
         INSTALL_VIDEOFILTER(${lib})
 ENDIF (GTK_FOUND AND GTHREAD_FOUND)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_qt4.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_qt4.cmake	2008-05-21 17:57:33 UTC (rev 4051)
+++ branches/avidemux_2.5_branch_gruntster/cmake/vf_plugin_qt4.cmake	2008-05-21 17:57:34 UTC (rev 4052)
@@ -13,9 +13,9 @@
         MESSAGE(&quot;ZZ CPP&quot; ${qt4_cpp})
         ADD_LIBRARY(${lib} SHARED ${_srcsCommon} ${qt4_cpp}  ${qt4_ui} ${x264Qt_source})
         INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/ ../../../ADM_UIs/ADM_QT4/include/)
-        TARGET_LINK_LIBRARIES( ${lib} ADM_UIQT4)
+        TARGET_LINK_LIBRARIES( ${lib} ADM_UIQT4  ADM_render_qt4)
         TARGET_LINK_LIBRARIES(${lib}  ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} )
-        	
+        ADD_TARGET_CFLAGS(${lib} &quot;-DADM_UI_TYPE=QT4&quot;)
         INIT_VIDEOFILTER_PLUGIN(${lib})
         INSTALL_VIDEOFILTER(${lib})
 ENDIF (QT4_FOUND)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001308.html">[Avidemux-svn-commit] r4051 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
</A></li>
	<LI>Next message: <A HREF="001310.html">[Avidemux-svn-commit] r4053 - branches/avidemux_2.4_branch/avidemux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1309">[ date ]</a>
              <a href="thread.html#1309">[ thread ]</a>
              <a href="subject.html#1309">[ subject ]</a>
              <a href="author.html#1309">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
