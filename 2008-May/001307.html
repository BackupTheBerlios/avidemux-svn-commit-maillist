<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4050 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_filter avidemux/ADM_userInterfaces	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_userInterfaces/ADM_render cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4050%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_filter%20avidemux/ADM_userInterfaces%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/ADM_userInterfaces/ADM_render%20cmake&In-Reply-To=%3C200805211757.m4LHvWxv014001%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001306.html">
   <LINK REL="Next"  HREF="001308.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4050 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_filter avidemux/ADM_userInterfaces	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_userInterfaces/ADM_render cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4050%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_filter%20avidemux/ADM_userInterfaces%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09avidemux/ADM_userInterfaces/ADM_render%20cmake&In-Reply-To=%3C200805211757.m4LHvWxv014001%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4050 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_filter avidemux/ADM_userInterfaces	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI	avidemux/ADM_userInterfaces/ADM_render cmake">mean at mail.berlios.de
       </A><BR>
    <I>Wed May 21 19:57:32 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001306.html">[Avidemux-svn-commit] r4049 - in	branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. qt4
</A></li>
        <LI>Next message: <A HREF="001308.html">[Avidemux-svn-commit] r4051 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1307">[ date ]</a>
              <a href="thread.html#1307">[ thread ]</a>
              <a href="subject.html#1307">[ subject ]</a>
              <a href="author.html#1307">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-05-21 19:57:29 +0200 (Wed, 21 May 2008)
New Revision: 4050

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_accelRender.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_renderInternal.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRenderHelper.m
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.h
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_navigate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/guiplay.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
Log:
[Render] Make render a shared lib


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -32,7 +32,7 @@
 #include &quot;ADM_videoFilter_internal.h&quot;
 #include &quot;ADM_videoFilterDynamic.h&quot;
 #include &quot;ADM_video/ADM_vidPartial.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_PREVIEW

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -39,7 +39,7 @@
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_PREVIEW

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -17,7 +17,7 @@
 #include &lt;math.h&gt;
 #include &quot;ADM_toolkitGtk.h&quot;
 
-#include &quot;../ADM_commonUI/GUI_render.h&quot;
+#include &quot;../ADM_render/GUI_render.h&quot;
 #include &quot;gui_action.hxx&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
@@ -36,10 +36,10 @@
 #include &quot;../ADM_toolkit_gtk/ADM_jogshuttle.h&quot;
 #include &quot;gtkgui.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
-
+#include &quot;ADM_userInterfaces/ADM_render/GUI_renderInternal.h&quot;
 extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
 extern void ADM_initUIGtk(GtkWidget *guiRootWindow);
-
+extern  ADM_RENDER_TYPE UI_getPreferredRender(void);;
 #define WOD(x) lookup_widget (guiRootWindow,#x)
 
 void frame2time(uint32_t frame, uint32_t fps, uint16_t * hh, uint16_t * mm,
@@ -331,6 +331,9 @@
                 physical_jog_shuttle = &amp;(PhysicalJogShuttle::getInstance());
                 physical_jog_shuttle-&gt;registerCBs (NULL, jogButton, jogDial, jogRing);
 #endif 
+                
+                
+                
 	return ret;
 }
 
@@ -1277,12 +1280,30 @@
 	SliderIsShifted=FALSE;
 	return FALSE;
 }
+/****/
 extern int global_argc;
 extern char **global_argv;
 typedef gboolean GCALL       (void *);
 extern int automation(void );
+//********************************************
 extern void initTranslator(void);
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_purge,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
 
+/**
+ *      \fn UI_Init
+ *      \brief Entry point. Initialize renderLib.
+ * 
+ */
 int UI_Init(int argc, char **argv)
 {
 	initTranslator();
@@ -1296,6 +1317,10 @@
     global_argc=argc;
     global_argv=argv;
       
+    
+
+    ADM_renderLibInit(&amp;UI_Hooks);
+    
     gtk_init(&amp;global_argc, &amp;global_argv);
     gdk_rgb_init();
     

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -32,8 +32,8 @@
 
 #include &quot;ADM_misc.h&quot;
 
-#include &quot;../ADM_commonUI/GUI_render.h&quot;
-#include &quot;../ADM_commonUI/GUI_accelRender.h&quot;
+#include &quot;../ADM_render/GUI_render.h&quot;
+#include &quot;../ADM_render/GUI_accelRender.h&quot;
 
 #include &quot;ADM_colorspace.h&quot;
 #include &quot;ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -47,7 +47,7 @@
 
 #include &quot;ADM_ocr/ADM_ocr.h&quot;
 #include &quot;ADM_ocr/ADM_ocrInternal.h&quot;
-
+#include &quot;ADM_userInterfaces/ADM_render/GUI_renderInternal.h&quot;
 extern int global_argc;
 extern char **global_argv;
 extern void initTranslator(void);
@@ -137,14 +137,27 @@
 void *ADM_ocrUiSetup(void) {return 0;}
 uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h) {return 0;}
 ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString) {return ReplyOk;}
+extern void UI_purge(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
 
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_purge,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
 int UI_Init(int nargc, char **nargv)
 {
 	initTranslator();
 
 	global_argc = nargc;
 	global_argv = nargv;
-
+        ADM_renderLibInit(&amp;UI_Hooks);
 	return 0;
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -12,7 +12,7 @@
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_videoFilter.h&quot;
 
-#include &quot;GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 
 void UI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr) {}
 void UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h) {}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -34,7 +34,7 @@
 #include &quot;ADM_audiodevice/audio_out.h&quot;
 #include &quot;ADM_audio/ADM_audiodef.h&quot;
 
-#include &quot;GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -25,7 +25,8 @@
 #include &quot;DIA_fileSel.h&quot;
 #include &quot;ADM_video/ADM_vidMisc.h&quot;
 #include &quot;prefs.h&quot;
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
+
+#include &quot;ADM_userInterfaces/ADM_render/GUI_renderInternal.h&quot;
 extern int global_argc;
 extern char **global_argv;
 
@@ -41,6 +42,7 @@
 extern void loadTranslator(void);
 extern void initTranslator(void);
 extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
 
 int SliderIsShifted=0;
 static void setupMenus(void);
@@ -86,7 +88,7 @@
 int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms);
 void UI_updateFrameCount(uint32_t curFrame);
 void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-
+extern void UI_purge(void);
 /*
     Declare the class that will be our main window
 
@@ -498,14 +500,24 @@
 {
 	clearCustomMenu();
 }
-
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_purge,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
 int UI_Init(int nargc,char **nargv)
 {
 	initTranslator();
 
 	global_argc=nargc;
 	global_argv=nargv;
-
+	ADM_renderLibInit(&amp;UI_Hooks);
 	return 0;
 }
 QWidget *QuiMainWindows=NULL;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -28,8 +28,8 @@
 
 #include &quot;T_preview.h&quot;
 #include &quot;ADM_colorspace.h&quot;
-#include &quot;GUI_render.h&quot;
-#include &quot;GUI_accelRender.h&quot;
+#include &quot;../ADM_render/GUI_render.h&quot;
+#include &quot;../ADM_render/GUI_accelRender.h&quot;
 #include &quot;prefs.h&quot;
 #include &quot;ADM_assert.h&quot;
     

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2008-05-21 17:57:29 UTC (rev 4050)
@@ -2,17 +2,13 @@
 
 SET(${ADM_LIB}_SRCS
 DIA_audioconfig.cpp   DIA_DVDff.cpp           DIA_flyContrast.cpp  DIA_flySrtPos.cpp   DIA_mjpeg.cpp     DIA_resizeWiz.cpp  DIA_v2v.cpp
-DIA_audioFilter.cpp   DIA_flyCrop.cpp      DIA_gototime.cpp    DIA_postproc.cpp  DIA_srt.cpp        GUI_render.cpp
-DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       GUI_sdlRender.cpp
-DIA_builtin.cpp       DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     GUI_xvRender.cpp
+DIA_audioFilter.cpp   DIA_flyCrop.cpp      DIA_gototime.cpp    DIA_postproc.cpp  DIA_srt.cpp        
+DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       
+DIA_builtin.cpp       DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     
 DIA_animated.cpp      DIA_ocr.cpp             DIA_tsSub.cpp        DIA_jobs_save.cpp
 DIA_flyEq2.cpp        DIA_flv1.cpp            DIA_flyThreshold.cpp DIA_flyParticle.cpp DIA_flyEraser.cpp DIA_flySwissArmyKnife.cpp
 )
 
-IF (APPLE)
-	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} GUI_sdlRenderHelper.m)
-ENDIF (APPLE)
 
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
 
-SDLify(GUI_sdlRender.cpp)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -15,7 +15,7 @@
 #include &quot;ADM_default.h&quot;
 
 
-#include &quot;GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -18,7 +18,7 @@
 
 #include &quot;ADM_audiodevice/audio_out.h&quot;
 #include &quot;ADM_assert.h&quot;
-#include &quot;GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 
 
 #include &quot;DIA_factory.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -15,7 +15,7 @@
 
 #ifdef USE_FREETYPE
 #include &quot;ADM_default.h&quot;
-#include &quot;GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,24 +0,0 @@
-//
-// C++ Interface: GUI_accelRender
-//
-// Description: 
-//  Class to hold all accelerated display (xv, sdl....)
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-#ifndef GUI_ACCELRENDER_H
-#define GUI_ACCELRENDER_H
-class AccelRender
-{
-      public:
-                              AccelRender( void) {};
-              virtual	uint8_t init(GUI_WindowInfo * window, uint32_t w, uint32_t h)=0;
-              virtual	uint8_t end(void)=0;
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom=ZOOM_1_1)=0;
-              virtual uint8_t hasHwZoom(void) {return 0;}
-              
-};
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,325 +0,0 @@
-/***************************************************************************
-                          gui_render.cpp  -  description
-
-	The final render a frame. The external interface is the same
-	whatever the mean (RGB/YUV/Xv)
-                             -------------------
-    begin                : Thu Jan 3 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;GUI_render.h&quot;
-#include &quot;GUI_accelRender.h&quot;
-
-#ifdef USE_XV
-#include &quot;GUI_xvRender.h&quot;
-#endif
-
-#ifdef USE_SDL
-#include &quot;GUI_sdlRender.h&quot;
-#endif
-
-#include &quot;prefs.h&quot;
-#include &quot;ADM_colorspace.h&quot;
-
-
-extern uint8_t BitBlit(uint8_t *dst, uint32_t pitchDest,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height);
-extern void UI_purge(void);
-
-static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
-static uint8_t  GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h);
-
-void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
-
-//_____________________________________
-extern ColYuvRgb rgbConverter; // Declared in UI_xxx as it is not the same between GTK and QT (RGB vs BGR or whatever)
-//_____________________________________
-static AccelRender    *accel_mode=NULL;
-static uint8_t        *accelSurface=NULL;
-//_______________________________________
-
-static uint8_t 	            *screenBuffer=NULL;
-static uint8_t		    *lastImage=NULL;
-static void                 *draw=NULL;
-static uint32_t 	     renderW=0,renderH=0; /* Zoomed/display size */
-static uint32_t              phyW=0,phyH=0; /* Unzoomed size, only used when accel can do hw resize */
-static renderZoom            lastZoom;
-static uint8_t               _lock=0;
-//_______________________________________
-/**
-	Render init, initialize internals. Constuctor like function
-
-*/
-uint8_t renderInit( void )
-{
-	draw=UI_getDrawWidget(  );
-	return 1;
-}
-
-void renderDestroy(void)
-{
-	if(screenBuffer) 
-	{
-		delete[] screenBuffer;
-		screenBuffer = NULL;
-	}
-}
-
-/**
-    \fn renderLock
-    \brief Take the weak lock (i.e. not threadsafe)
-*/
-uint8_t renderLock(void)
-{
-  ADM_assert(!_lock);
-  _lock=1; 
-}
-uint8_t renderUnlock(void)
-{
-  ADM_assert(_lock);
-  _lock=0; 
-}
-
-/**
-	Warn the renderer that the display size is changing
-
-*/
-//----------------------------------------
-uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
-{
-	if(screenBuffer) 
-        {
-                delete  [] screenBuffer;
-                screenBuffer=NULL;
-        }
-        screenBuffer=new uint8_t[w*h*4];
-        phyW=pw;
-        phyH=ph;
-  
-        updateWindowSize( draw,w,h);
-        UI_purge();
-        return 1;
-}
-/**
-	Update the image and render it
-	The width and hiehgt must NOT have changed
-
-*/
-//----------------------------------------
-uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom)
-{
-
-    ADM_assert(screenBuffer);
-    lastImage=ptr;
-    ADM_assert(!_lock);
-    if(accel_mode)
-    {
-        lastZoom=zoom;
-        if(accel_mode -&gt;hasHwZoom())
-        {
-           accel_mode-&gt;display(lastImage, phyW, phyH,zoom);
-        }else
-        {
-          accel_mode-&gt;display(lastImage, renderW, renderH,zoom);
-        }
-      
-    }else
-    {
-      GUI_ConvertRGB(ptr,screenBuffer, renderW,renderH);
-      renderRefresh();
-    }
-  return 1;
-
-}
-/**
-	Refresh the image from internal buffer / last image
-	Used for example as call back for X11 events
-
-*/
-//_______________________________________________
-uint8_t renderRefresh(void)
-{
-      if(_lock) return 1;
-      if(!screenBuffer)
-      {
-              if(accel_mode) ADM_assert(0);
-              return 0;
-      }
-
-      if(accel_mode)
-      {
-          if(lastImage)
-               if(accel_mode -&gt;hasHwZoom())
-                {
-                  accel_mode-&gt;display(lastImage, phyW, phyH,lastZoom);
-                }else
-                {
-                  accel_mode-&gt;display(lastImage, renderW, renderH,lastZoom);
-                }
-      }
-      else
-              GUI_RGBDisplay(screenBuffer, renderW, renderH,draw);
-  return 1;
-}
-
-uint8_t renderExpose(void)
-{
-    renderRefresh();
-}
-uint8_t renderStartPlaying( void )
-{
-char *displ;
-unsigned int renderI;
-ADM_RENDER_TYPE render;
-uint8_t r=0;
-	ADM_assert(!accel_mode);
-        
-#if !defined __WIN32 &amp;&amp; !defined(__APPLE__)
-	// First check if local
-	// We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
-	// in that case we do not even try to use accel
-	
-	// Win32 and Mac/Qt4 don't have DISPLAY
-	displ=getenv(&quot;DISPLAY&quot;);
-	if(!displ)
-	{
-		return 0;
-	}
-	if(strcmp(displ,&quot;:0&quot;) &amp;&amp; strcmp(displ,&quot;:0.0&quot;))
-	{
-		printf(&quot;Looks like remote display, no Xv :%s\n&quot;,displ);
-		return 1;
-	}
-#endif	
- 
-        if(prefs-&gt;get(DEVICE_VIDEODEVICE,&amp;renderI)!=RC_OK)
-        {       
-                render=RENDER_GTK;
-        }else
-        {
-                render=(ADM_RENDER_TYPE)renderI;
-        }
-        GUI_WindowInfo xinfo;
-        UI_getWindowInfo(draw, &amp;xinfo);
-        switch(render)
-        {
-        
-#if defined(USE_XV)
-	       case RENDER_XV:
-		accel_mode=new XvAccelRender();
-                if(accel_mode-&gt;hasHwZoom()) r=accel_mode-&gt;init(&amp;xinfo,phyW,phyH);
-                else r=accel_mode-&gt;init(&amp;xinfo,renderW,renderH);
-                if(!r)
-		{
-			delete accel_mode;
-			accel_mode=NULL;
-			printf(&quot;Xv init failed\n&quot;);
-		}
-		else
-		{
-			printf(&quot;Xv init ok\n&quot;);
-		}
-                break;
-#endif
-
-#if defined(USE_SDL)
-			case RENDER_SDL:
-#ifdef __WIN32
-			case RENDER_DIRECTX:
-#endif
-				accel_mode=new sdlAccelRender();
-
-				if(accel_mode-&gt;hasHwZoom()) r=accel_mode-&gt;init(&amp;xinfo,phyW,phyH);
-                else r=accel_mode-&gt;init(&amp;xinfo,renderW,renderH);
-
-                if(!r)
-				{
-					delete accel_mode;
-					accel_mode=NULL;
-				}
-
-                break;
-#endif
-
-            default:break;
-        }
-
-        if(!accel_mode)
-        {
-                rgbConverter.reset(renderW,renderH);
-                printf(&quot;No accel used for rendering\n&quot;);
-        }
-        else
-        {
-           ADM_assert(!accelSurface);
-           accelSurface=new uint8_t[ (renderW*renderH*3)&gt;&gt;1];
-          
-        }
-	
-	return 1;
-}
-/**
-      \fn renderHasAccelZoom
-      \brief returns 1 if accel can do hw zoom
-*/
-uint8_t renderHasAccelZoom(void)
-{
-    if(!accel_mode) return 0;
-    return accel_mode-&gt;hasHwZoom(); 
-}
-
-uint8_t renderStopPlaying( void )
-{
-      
-      if(accel_mode)
-      {
-              accel_mode-&gt;end();
-              delete accel_mode;
-              if(accelSurface) delete [] accelSurface;
-              accelSurface=NULL;
-                              
-      }
-      accel_mode=NULL;	
-      
-      return 1;
-}
-
-
-//___________________________________________________________________________
-//
-//
-uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h)
-{
-    ADM_assert(screenBuffer);
-    renderW = w;
-    renderH = h;
-
-    UI_updateDrawWindowSize(win,w,h);
-    rgbConverter.reset(w,h);
-    return 1;
-}
-
-uint8_t GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h)
-{
-    rgbConverter.reset(w,h);
-    rgbConverter.scale(in,out);
-    return 1;
-}
-void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg)
-{
-    
-    UI_rgbDraw(widg,w,h,dis);
-}
-//EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,109 +0,0 @@
-/****************************************************************************
- copyright            : (C) 2001 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#ifndef GUI_RENDER_H
-#define GUI_RENDER_H
-
-
-#include &quot;ADM_image.h&quot;
-
-class AVDMGenericVideoStream;
-typedef struct
-{
-    void *display;
-    int  window;
-	int x;
-	int y;
-	int width;
-	int height;
-} GUI_WindowInfo;
-
-typedef enum 
-{
-    ADM_PREVIEW_NONE, 
-    ADM_PREVIEW_OUTPUT,
-    ADM_PREVIEW_SIDE,
-    ADM_PREVIEW_TOP,
-    ADM_PREVIEW_SEPARATE
-}ADM_PREVIEW_MODE;
-
-typedef enum 
-{
-        ZOOM_1_4,
-        ZOOM_1_2,
-        ZOOM_1_1,
-        ZOOM_2,
-        ZOOM_4,
-        ZOOM_INVALID
-}renderZoom;
-
-
-ADM_PREVIEW_MODE getPreviewMode(void);
-void             setPreviewMode(ADM_PREVIEW_MODE preview);
-void             changePreviewZoom(renderZoom nzoom);
-
-class admPreview
-{
-  public:
-      static uint8_t update(uint32_t framenum);
-      static void start(void);
-      static void stop(void);
-      static void setMainDimension(uint32_t, uint32_t );
-      static void updateFilters(AVDMGenericVideoStream *first,AVDMGenericVideoStream *last);
-      static void deferDisplay(uint32_t onoff,uint32_t startat);
-      static void displayNow(uint32_t framenum);
-      static void cleanUp(void);  
-      static ADMImage *getBuffer(void);
-};
-
-uint8_t renderInit( void );
-void renderDestroy(void);
-uint8_t renderResize(uint32_t w, uint32_t h,uint32_t phyW,uint32_t phyH);
-uint8_t renderRefresh(void);
-uint8_t renderExpose(void);
-uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom);
-uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t,uint32_t primary);
-
-uint8_t renderStartPlaying( void );
-uint8_t renderStopPlaying( void );
-uint8_t renderHasAccelZoom(void);
-
-uint8_t renderLock(void);
-uint8_t renderUnlock(void);
-
-void *UI_getDrawWidget(void);
-void UI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
-void UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h);
-void UI_getWindowInfo(void *draw, GUI_WindowInfo *xinfo);
-
-typedef enum 
-{
-        RENDER_GTK=0,
-#ifdef USE_XV
-        RENDER_XV=1,
-#endif
-#ifdef USE_SDL
-        RENDER_SDL=2,
-
-#ifdef __WIN32
-		RENDER_DIRECTX=3,
-#endif
-#endif
-        RENDER_LAST       
-
-
-}ADM_RENDER_TYPE;
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,414 +0,0 @@
-/***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-***************************************************************************/
-
-/***************************************************************************
-*                                                                         *
-*   This program is free software; you can redistribute it and/or modify  *
-*   it under the terms of the GNU General Public License as published by  *
-*   the Free Software Foundation; either version 2 of the License, or     *
-*   (at your option) any later version.                                   *
-*                                                                         *
-***************************************************************************///
-//  The pitch stride has to be changed as there could be some padding depending on the OS
-//
-//
-
-#include &quot;config.h&quot;
-
-#if defined(USE_SDL)
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-extern &quot;C&quot; {
-// get rid of warnings due to different definitions
-#undef HAVE_INTTYPES_H
-#undef HAVE_MALLOC_H
-#undef HAVE_STDINT_H
-#undef HAVE_SYS_TYPES_H
-#include &quot;SDL.h&quot;
-#include &quot;SDL_syswm.h&quot;
-}
-
-#include &quot;ADM_colorspace.h&quot;
-
-#include &quot;GUI_render.h&quot;
-
-#include &quot;GUI_accelRender.h&quot;
-#include &quot;GUI_sdlRender.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-#ifdef __WIN32
-#include &quot;prefs.h&quot;
-#endif
-
-#ifdef __APPLE__
-extern &quot;C&quot;
-{
-	void initSdlCocoaView(void* parent, int x, int y, int width, int height, bool carbonParent);
-	void destroyCocoaView(void);
-}
-#endif
-
-//******************************************
-static uint8_t sdl_running=0;
-static SDL_Overlay *sdl_overlay=NULL;
-static SDL_Surface *sdl_display=NULL;
-static SDL_Rect disp;
-#ifdef __WIN32
-HWND sdlWin32;
-#endif
-static ColBase *color=NULL;
-
-sdlAccelRender::sdlAccelRender( void)
-{
-        useYV12=1;
-        decoded=NULL;
-}
-uint8_t sdlAccelRender::end( void)
-{
-        if(sdl_overlay)
-        {
-                SDL_FreeYUVOverlay(sdl_overlay);
-        }
-        if(sdl_display)
-        {
-        		SDL_UnlockSurface(sdl_display);
-                SDL_FreeSurface(sdl_display);
-        }
-        if(sdl_running)
-        {
-                SDL_QuitSubSystem(SDL_INIT_VIDEO);
-
-#ifdef __APPLE__
-				destroyCocoaView();
-#endif
-        }
-        if(decoded)
-        {
-		        delete [] decoded;
-		        decoded=NULL;	
-        }
-        sdl_running=0;
-        sdl_overlay=NULL;
-        sdl_display=NULL;
-        printf(&quot;[SDL] Video subsystem closed and destroyed\n&quot;);        
-}
-uint8_t sdlAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
-{
-	printf(&quot;[SDL] Initialising video subsystem\n&quot;);
-
-#ifdef __APPLE__
-	if (window-&gt;width &gt; w &amp;&amp; window-&gt;height &gt; h)
-	{
-		printf(&quot;[SDL] Disabling acceleration.  Zoom increase not supported on Mac\n&quot;);
-		return 0;
-	}
-#endif
-
-	int bpp;
-	int flags;
-
-    // Ask for the position of the drawing window at start
-    disp.w=w;
-    disp.h=h;
-    disp.x=0;
-    disp.y=0;
-
-    if(!useYV12)
-    {
-		color=new ColBase(720,480);
-		decoded=new uint8_t[w*h*2];
-    }
-
-    // Hack to get SDL to use GTK window, ugly but works
-#if !defined(__WIN32) &amp;&amp; !defined(__APPLE__)
-	char SDL_windowhack[32];
-    int winId=(int)window-&gt;window;
-
-    sprintf(SDL_windowhack,&quot;SDL_WINDOWID=%ld&quot;,winId);
-    putenv(SDL_windowhack);
-#endif
-
-    if (SDL_InitSubSystem(SDL_INIT_VIDEO) &lt; 0) 
-    {
-		printf(&quot;[SDL] FAILED initialising video subsystem\n&quot;);
-		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-
-        return 0;
-    }
-
-    // Do it twice as the 1st time does not work
-    // Hack to get SDL to use GTK window, ugly but works
-#if !defined(__WIN32) &amp;&amp; !defined(__APPLE__)
-    putenv(SDL_windowhack);
-    SDL_QuitSubSystem(SDL_INIT_VIDEO);
-    if (SDL_InitSubSystem(SDL_INIT_VIDEO) &lt; 0) 
-    {
-                printf(&quot;[SDL] FAILED initialising video subsystem\n&quot;);
-                printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-                return 0;
-    }
-#endif
-
-    sdl_running=1;
-    flags = SDL_ANYFORMAT | SDL_HWPALETTE | SDL_HWSURFACE | SDL_NOFRAME;
-    bpp= SDL_VideoModeOK( w, h,  32, flags );
-
-#ifdef __WIN32
-	// SDL window is created and displayed before we get a chance to set the parent.
-	// Therefore, align the SDL overlay with the client area before it is displayed.
-	POINT screenPoint = {};
-	char origin[43];
-
-	ClientToScreen((HWND)window-&gt;display, &amp;screenPoint);
-	snprintf(origin, 43, &quot;SDL_VIDEO_WINDOW_POS=%i,%i&quot;, screenPoint.x, screenPoint.y);
-	putenv(origin);
-#endif
-
-#ifdef __APPLE__
-	void* parent;
-
-	if (window-&gt;display)
-		// Carbon parent (Qt4)
-		parent = window-&gt;display;
-	else
-		// Cocoa parent (GTK)
-		parent = (void*)window-&gt;window;
-
-	if (parent)
-		// Create Cocoa view and attach to Carbon window using custom Objective-C function.
-		// It's a retarded way of doing things but that's what Apple has imposed...
-		initSdlCocoaView(parent, window-&gt;x, window-&gt;y, window-&gt;width, window-&gt;height, (window-&gt;display != NULL));
-#endif
-
-	// SDL will resize our window to width and height passed to SetVideoMode.
-	// This is fine until we use zoomed views so pass window dimensions instead.
-	sdl_display= SDL_SetVideoMode(window-&gt;width, window-&gt;height, bpp, flags);
-
-    if (!sdl_display)
-    {
-        end();
-        printf(&quot;[SDL] Cannot create surface\n&quot;);
-		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-        return 0;
-    }
-
-    SDL_LockSurface(sdl_display);
-
-#ifdef __WIN32
-	struct SDL_SysWMinfo wmInfo;
-	SDL_VERSION(&amp;wmInfo.version);
-
-	if (-1 != SDL_GetWMInfo(&amp;wmInfo))
-	{
-		sdlWin32 = wmInfo.window;
-
-		// Make SDL window a child to prevent it from gaining focus
-		int windowFlags = GetWindowLongPtr(sdlWin32, GWL_STYLE);
-
-		SetWindowLongPtr(sdlWin32, GWL_STYLE, (windowFlags &amp; ~WS_POPUP) | WS_CHILD);
-
-		// Set the SDL window's parent to the main window and reposition
-		SetParent(sdlWin32, (HWND)window-&gt;display);
-		SetWindowPos(sdlWin32, NULL, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
-
-		// The SDL window stole focus before it was made a child, so set focus back to the main window
-		SetFocus((HWND)window-&gt;display);
-	}
-	else
-	{
-		printf(&quot;[SDL] Reparenting failed\n&quot;);
-	}
-#endif
-
-        int cspace;
-        
-        if(useYV12) cspace=SDL_YV12_OVERLAY;
-            else    cspace=SDL_YUY2_OVERLAY;
-        //_______________________________________________________
-        sdl_overlay=SDL_CreateYUVOverlay((w),(h), cspace, sdl_display);
-
-		// DirectX may fail but overlay still created.
-		// Not a showstopper but log failure.
-		if (strlen(SDL_GetError()))
-		{
-			printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-		}
-
-        if(!sdl_overlay)
-        {
-			end();
-			printf(&quot;[SDL] Cannot create SDL overlay\n&quot;);
-			printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-
-			return 0;
-        }
-        
-        printf(&quot;[SDL] Overlay created; type: %d, planes: %d, pitch: %d\n&quot;, sdl_overlay-&gt;hw_overlay, sdl_overlay-&gt;planes, sdl_overlay-&gt;pitches[0]);
-
-        if(!sdl_overlay-&gt;hw_overlay)
-            printf(&quot;[SDL] Hardware acceleration disabled\n&quot;);
-
-        if(!useYV12) color-&gt;reset(w,h);
-
-		printf(&quot;[SDL] Video subsystem initalised successfully\n&quot;);
-
-        return 1;
-}
-
-static void interleave(uint8_t *dst,uint8_t *src,int width, int stride, int lines)
-{
-    for(int y=0;y&lt;lines;y++)
-    {
-        memcpy(dst,src,width);
-        src+=width;
-        dst+=stride;          
-    }   
-}
-uint8_t sdlAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
-{
-#ifdef __WIN32
-	// DirectX playback doesn't refresh correctly if the parent window is moved.
-	// Detect when the parent window has moved and force a coordinate update.
-	if (strcmp(getenv(&quot;SDL_VIDEODRIVER&quot;), &quot;directx&quot;) == 0)
-	{
-		static RECT lastPos;
-
-		RECT currentPos;
-		GetWindowRect(sdlWin32, &amp;currentPos);
-
-		if (currentPos.left != lastPos.left || currentPos.top != lastPos.top)
-		{
-			// By default SetWindowPos doesn't work if the new coordinates are the same as the 
-			// current so use SWP_FRAMECHANGED to force an update.
-			SetWindowPos(sdlWin32, NULL, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED);
-			lastPos = currentPos;
-		}
-	}
-#endif
-
-int pitch;
-int page=w*h;
-        ADM_assert(sdl_overlay);
-        SDL_LockYUVOverlay(sdl_overlay);	
-        pitch=sdl_overlay-&gt;pitches[0];
-//	printf(&quot;SDL: new pitch :%d\n&quot;,pitch);
-        if(useYV12)
-        {
-	        if(pitch==w)
-	            memcpy(sdl_overlay-&gt;pixels[0],ptr,w*h);
-	        else
-	            interleave(sdl_overlay-&gt;pixels[0],ptr,w,pitch,h);
-	            
-	        pitch=sdl_overlay-&gt;pitches[1];
-	        if(pitch==(w&gt;&gt;1))
-	            memcpy(sdl_overlay-&gt;pixels[1],ptr+page,(w*h)&gt;&gt;2);
-	        else
-	            interleave(sdl_overlay-&gt;pixels[1],ptr+page,w&gt;&gt;1,pitch,h&gt;&gt;1);
-	      
-	        pitch=sdl_overlay-&gt;pitches[2];
-	        if(pitch==(w&gt;&gt;1))
-	            memcpy(sdl_overlay-&gt;pixels[2],ptr+(page*5)/4,(w*h)&gt;&gt;2);
-	        else
-	            interleave(sdl_overlay-&gt;pixels[2],ptr+(page*5)/4,w&gt;&gt;1,pitch,h&gt;&gt;1);  	
-        }else
-        {
-	        color-&gt;reset(w,h);
-	        if(pitch==2*w)
-	        {
-	            color-&gt;scale(ptr,sdl_overlay-&gt;pixels[0]);
-	        }
-	        else
-	        {
-	            color-&gt;scale(ptr,decoded);
-	            interleave(sdl_overlay-&gt;pixels[0],decoded,2*w,pitch,h);
-	        }
-        }	
-        uint32_t factor=4;
-               switch(zoom)
-               {
-                   case ZOOM_1_4: factor=1;break;
-                   case ZOOM_1_2: factor=2;break;
-                   case ZOOM_1_1: factor=4;break;
-                   case ZOOM_2:   factor=8;break;
-                   case ZOOM_4:   factor=16;break;
-                   default : ADM_assert(0);
-                 
-               }
-        disp.w=(w*factor)/4;
-        disp.h=(h*factor)/4;
-        disp.x=0;
-        disp.y=0;
-        
-        SDL_UnlockYUVOverlay(sdl_overlay);
-        SDL_DisplayYUVOverlay(sdl_overlay,&amp;disp);
-        
-        return 1;
-}
-
-void initSdl(void)
-{
-	printf(&quot;\n&quot;);
-	quitSdl();
-
-    int sdl_version = (SDL_Linked_Version()-&gt;major*1000)+(SDL_Linked_Version()-&gt;minor*100) + (SDL_Linked_Version()-&gt;patch);
-
-    printf(&quot;[SDL] Version: %u.%u.%u\n&quot;,SDL_Linked_Version()-&gt;major, SDL_Linked_Version()-&gt;minor, SDL_Linked_Version()-&gt;patch);
-
-#ifdef __WIN32
-	uint32_t videoDevice = RENDER_LAST;
-
-	if(!prefs-&gt;get(DEVICE_VIDEODEVICE, &amp;videoDevice) || videoDevice != RENDER_DIRECTX)
-	{
-		printf(&quot;[SDL] Setting video driver to Microsoft Windows GDI\n&quot;);
-		putenv(&quot;SDL_VIDEODRIVER=windib&quot;);
-	}
-	else
-	{
-		printf(&quot;[SDL] Setting video driver to Microsoft DirectX\n&quot;);
-		putenv(&quot;SDL_VIDEODRIVER=directx&quot;);
-	}
-#endif
-
-	uint32_t sdlInitFlags;
-
-	if (sdl_version &gt; 1209)
-		sdlInitFlags = SDL_INIT_EVERYTHING;
-	else
-		sdlInitFlags = 0;
-
-	printf(&quot;[SDL] Initialisation &quot;);
-
-	if (SDL_Init(sdlInitFlags) == 0)
-	{
-		printf(&quot;succeeded\n&quot;);
-
-		char driverName[100];
-
-		if (SDL_VideoDriverName(driverName, 100) != NULL)
-		{
-			printf(&quot;[SDL] Video Driver: %s\n&quot;, driverName);
-		}
-	}
-	else
-	{
-		printf(&quot;FAILED\n&quot;);
-		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
-	}
-
-	printf(&quot;\n&quot;);
-}
-
-void quitSdl(void)
-{
-	if (SDL_WasInit(SDL_INIT_EVERYTHING))
-	{
-		printf(&quot;[SDL] Quitting...\n&quot;);
-		SDL_Quit();
-	}
-}
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,36 +0,0 @@
-
-/***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;GUI_render.h&quot;
-#include &quot;GUI_accelRender.h&quot;
-
-#ifndef TSDLRENDER_H
-#define TSDLRENDER_H
-
-class sdlAccelRender: public AccelRender
-{
-  protected:
-              int     useYV12;
-              uint8_t *decoded;
-      public:
-                                sdlAccelRender( void ) ;
-              virtual	uint8_t init( GUI_WindowInfo * window, uint32_t w, uint32_t h);
-              virtual	uint8_t end(void);
-              virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
-              			uint8_t hasHwZoom(void) {return 1;}
-};
-
-void initSdl(void);
-void quitSdl(void);
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,139 +0,0 @@
-#import &lt;Cocoa/Cocoa.h&gt;
-#import &lt;Carbon/Carbon.h&gt;
-
-static NSWindow* nsParentWindow = nil;
-static NSWindow* nsWindow = nil;
-static NSQuickDrawView* nsView = nil;
-static bool cocoaApplication = false;
-static id oldDelegate = nil;
-static int widgetX = 0, widgetY = 0;
-
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">- at interface</A> SdlCocoaWindow : NSWindow
-- (void)windowDidMove:(id)notification;
-- (void)windowWillMiniaturize:(NSNotification *)notification;
-- (void)windowDidDeminiaturize:(NSNotification *)notification;
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">- at end</A>
-
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">- at implementation</A> SdlCocoaWindow
-- (void)windowDidMove:(id)notification
-{
-	NSRect parentFrame = [nsParentWindow frame];
-	NSPoint point = NSMakePoint(parentFrame.origin.x + widgetX, parentFrame.origin.y + widgetY);
-
-	[self setFrameOrigin:point];
-}
-
-- (void)windowWillMiniaturize:(NSNotification *)notification
-{
-	[self setIsVisible:NO];
-}
-
-- (void)windowDidDeminiaturize:(NSNotification *)notification
-{
-	[self setIsVisible:YES];
-}
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">- at end</A>
-
-void initSdlCocoaView(void* parent, int x, int y, int width, int height, bool carbonParent)
-{
-	printf(&quot;[SDL] Creating Cocoa view x: %d, y: %d, width: %d, height %d, carbon %d\n&quot;, x, y, width, height, carbonParent);
-
-	NSRect contentRect;
-
-	if (carbonParent)
-	{
-		contentRect = NSMakeRect(x, y, width, height);
-
-		if (!nsWindow)
-		{
-			// initWithWindowRef always returns the same result for the same WindowRef
-			nsWindow = [[NSWindow alloc] initWithWindowRef:(WindowRef)parent];
-
-			[nsWindow setContentView:[[[NSView alloc] initWithFrame:contentRect] autorelease]];
-		}
-	}
-	else
-	{
-		contentRect = NSMakeRect(0, 0, width, height);
-		
-		if (!nsWindow)
-		{
-			nsWindow = [[SdlCocoaWindow alloc] initWithContentRect:contentRect styleMask:NSDocModalWindowMask backing:NSBackingStoreBuffered defer:NO];
-
-			nsParentWindow = (NSWindow*)parent;
-			widgetX = x;
-			widgetY = y;
-			oldDelegate = [nsParentWindow delegate];
-			cocoaApplication = true;
-
-			[nsWindow setLevel:NSFloatingWindowLevel];
-			[nsWindow setHasShadow:NO];
-			
-			NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
-	
-			[nc addObserver:nsWindow selector:@selector(windowDidMove:) name:NSWindowDidMoveNotification object:nsParentWindow];
-			[nc addObserver:nsWindow selector:@selector(windowWillMiniaturize:) name:NSWindowWillMiniaturizeNotification object:nsParentWindow];
-			[nc addObserver:nsWindow selector:@selector(windowDidDeminiaturize:) name:NSWindowDidDeminiaturizeNotification object:nsParentWindow];
-		}
-	}
-
-	if (!nsView)
-	{
-		nsView = [[NSQuickDrawView alloc] initWithFrame:contentRect];
-
-		[[nsWindow contentView] addSubview:nsView];
-		[nsView release];
-		
-		if (carbonParent)
-			[nsWindow orderOut:nil];	// very important, otherwise window won't be placed correctly on repeat showings
-		else
-		{
-			NSRect parentFrame = [nsParentWindow frame];
-			NSPoint point = NSMakePoint(parentFrame.origin.x + x, parentFrame.origin.y + y);
-			
-			[nsWindow setFrameOrigin:point];
-		}
-
-		[nsWindow orderFront:nil];
-	}
-	else
-	{
-		[nsView setFrame:contentRect];
-		[[nsWindow contentView] setFrame:contentRect];
-	}
-
-	// finally, set SDL environment variables with all this nonsense
-	char SDL_windowhack[50];
-
-	sprintf(SDL_windowhack,&quot;SDL_NSWindowPointer=%ld&quot;,(int)nsWindow);
-	putenv(SDL_windowhack);
-
-	sprintf(SDL_windowhack,&quot;SDL_NSQuickDrawViewPointer=%ld&quot;,(int)nsView);
-	putenv(SDL_windowhack);
-}
-
-void destroyCocoaView(void)
-{
-	if (cocoaApplication)
-	{
-		[nsParentWindow setDelegate:oldDelegate];
-		
-		// we're using a floating panel so it doesn't automatically get destroyed
-		[nsWindow release];
-		
-		nsWindow = nil;
-		nsView = nil;
-		oldDelegate = nil;
-	}
-	else if (nsWindow)
-	{
-		// Reference count cannot fall below 2 because SDL releases the window when closing
-		// and again when reinitialising (even though this is our own window...).
-		if ([nsWindow retainCount] &gt; 2)
-			[nsWindow release];
-
-		// SDL takes care of all the destroying...a little too much, so make sure our Carbon
-		// window is still displayed (via its Cocoa wrapper)
-		[nsWindow makeKeyAndOrderFront:nil];
-	}
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,405 +0,0 @@
-/***************************************************************************
-                          gui_xv.cpp  -  description
-                             -------------------
-
-	This part is strongly derivated from xine/mplayer/mpeg2dec
-
-    begin                : Tue Jan 1 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-//#define VERBOSE_XV
-
-#ifdef USE_XV
-#include &lt;X11/Xlib.h&gt;
-#include &lt;X11/Xutil.h&gt;
-#include &lt;sys/ipc.h&gt;
-#include &lt;sys/shm.h&gt;
-#include &lt;X11/extensions/XShm.h&gt;
-#include &lt;X11/extensions/Xvlib.h&gt;
-#include &lt;X11/extensions/XShm.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-
-#include &quot;GUI_render.h&quot;
-
-#include &quot;GUI_accelRender.h&quot;
-#include &quot;GUI_xvRender.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-static uint8_t 	GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt);
-static uint8_t 	GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h);
-static void 	GUI_XvEnd( void );
-static uint8_t 	GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom);
-static uint8_t 	GUI_XvSync(void);
-
-static uint8_t getAtom(char *string);
-//________________Wrapper around Xv_______________
-XvAccelRender::XvAccelRender( void ) 
-{
-
-}
-uint8_t XvAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
-{
-	printf(&quot;Xv start\n&quot;);
-	return  GUI_XvInit( window,  w,  h);
-}
-uint8_t XvAccelRender::end(void)
-{
-	 GUI_XvEnd( );
-	 printf(&quot;Xv end\n&quot;);
-	 return 1;
-}
-
-uint8_t XvAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
-{
-	return GUI_XvDisplay(ptr, w, h,zoom);
-}
-//________________Wrapper around Xv_______________
-
-static unsigned int xv_port;
-static uint32_t xv_format;
-static Display *xv_display;
-static XvImage *xvimage = NULL;
-static GC xv_gc;
-static XGCValues xv_xgc;
-static Window xv_win;
-static XShmSegmentInfo Shminfo;
-static uint8_t GUI_XvExpose( void );
-//
-//	Free all ressources allocated by xv
-//
-
-
-void GUI_XvEnd( void )
-{
-	ADM_assert(xv_port);
- 	ADM_assert(xv_display);
-
-
-  	printf(&quot;\n Releasing Xv Port\n&quot;);
-  	XLockDisplay (xv_display);
-	if(XvUngrabPort(xv_display,xv_port,0)!=Success)
- 				printf(&quot;\n Trouble releasing port...\n&quot;);
-	XUnlockDisplay (xv_display);
-
-
-     xvimage=NULL;
-     xv_display=NULL;
-     xv_port=0;
-
-}
-
-//------------------------------------
-uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom)
-{
-    uint32_t destW,destH;
-    if (xvimage)
-      {
-
-	  // put image in shared segment
-
-	  // for YV12, 4 bits for Y 4 bits for u, 4 bits for v
-	  // total 1.5*
-         XLockDisplay (xv_display);
-	  memcpy(xvimage-&gt;data, src, (w*h*3)&gt;&gt;1);
-          uint32_t factor=4;
-        switch(zoom)
-        {
-            case ZOOM_1_4: factor=1;break;
-            case ZOOM_1_2: factor=2;break;
-            case ZOOM_1_1: factor=4;break;
-            case ZOOM_2:   factor=8;break;
-            case ZOOM_4:   factor=16;break;
-            default : ADM_assert(0);
-          
-        }
-	destW=(w*factor)/4;
-        destH=(h*factor)/4;
-        //printf(&quot;%u x %u =&gt; %u x %u\n&quot;,w,h,destW,destH);
-        // And display it !
-#if 1
-	  XvShmPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
-			0, 0, destW, destH,	// dst
-			False);
-#else
-	 XvPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
-			0, 0, w, h	// dst
-			);
-
-#endif
-	  //XSetForeground (xv_display, xv_gc, 0);
-
-	  XSync(xv_display, False);
-	  XUnlockDisplay (xv_display);
-	  //GUI_XvExpose();
-
-      }
-    return 1;
-
-}
-uint8_t GUI_XvSync(void)
-{
-	if(xv_display)
-	  	XSync(xv_display, False);
-	return 1;		
-}
-//------------------------------------
-//
-//------------------------------------
-uint8_t GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h)
-{
-
-
-    unsigned int ver, rel, req, ev, err;
-    unsigned int port, adaptors;
-    static XvAdaptorInfo *ai;
-    static XvAdaptorInfo *curai;
-    
-#if 0
-    win = gtk_widget_get_parent_window(window);
-    xv_display = GDK_WINDOW_XDISPLAY(win);
-//      xv_win= RootWindow(xv_display,0);
-    xv_win = GDK_WINDOW_XWINDOW(GTK_WIDGET(window)-&gt;window);
-#endif    
-
-    xv_display=(Display *)window-&gt;display;
-    xv_win=window-&gt;window;
-    
-    
-#define WDN xv_display
-    xv_port = 0;
-
-    if (Success != XvQueryExtension(WDN, &amp;ver, &amp;rel, &amp;req, &amp;ev, &amp;err))
-      {
-	  printf(&quot;\n Query Extension failed\n&quot;);
-	  goto failed;
-      }
-    /* check for Xvideo support */
-    if (Success != XvQueryAdaptors(WDN,
-				   DefaultRootWindow(WDN), &amp;adaptors, &amp;ai))
-      {
-	  printf(&quot;\n Query Adaptor failed\n&quot;);
-	  goto failed;
-      }
-    curai = ai;
-    XvFormat *formats;
-    // Dump infos
-    port = 0;
-    for (uint16_t i = 0; (!port) &amp;&amp; (i &lt; adaptors); i++)
-      {
-/*
-XvPortID base_id;
-unsigned long num_ports;
-char type;
-char *name;
-unsigned long num_formats;
-XvFormat *formats;
-unsigned long num_adaptors;
-*/
-#ifdef VERBOSE_XV
-	  printf(&quot;\n_______________________________\n&quot;);
-	  printf(&quot;\n Adaptor 		: %d&quot;, i);
-	  printf(&quot;\n Base ID		: %ld&quot;, curai-&gt;base_id);
-	  printf(&quot;\n Nb Port	 	: %lu&quot;, curai-&gt;num_ports);
-	  printf(&quot;\n Type			 	: %d,&quot;,
-		 curai-&gt;type);
-#define CHECK(x) if(curai-&gt;type &amp; x) printf(&quot;|&quot;#x);
-	  CHECK(XvInputMask);
-	  CHECK(XvOutputMask);
-	  CHECK(XvVideoMask);
-	  CHECK(XvStillMask);
-	  CHECK(XvImageMask);
-
-	  printf(&quot;\n Name			 	: %s&quot;,
-		 curai-&gt;name);
-	  printf(&quot;\n Num Adap	 	: %lu&quot;, curai-&gt;num_adaptors);
-	  printf(&quot;\n Num fmt	 	: %lu&quot;, curai-&gt;num_formats);
-#endif	  
-	  formats = curai-&gt;formats;
-
-	  //
-	  uint16_t k;
-
-	  for (k = 0; (k &lt; curai-&gt;num_ports) &amp;&amp; !port; k++)
-	    {
-		if (GUI_XvList(WDN, k + curai-&gt;base_id, &amp;xv_format))
-		    port = k + curai-&gt;base_id;
-	    }
-
-
-	  curai++;
-      }
-    //
-    if (!port)
-      {
-	  printf(&quot;\n no port found&quot;);
-	  goto failed;
-      }
-#ifdef 	COLORSPACE_YV12
-    printf(&quot;\n Xv YV12 found at port :%d, format : %ld&quot;, port, xv_format);
-#else
-    printf(&quot;\n Xv YUY2 found at port :%d, format : %ld&quot;, port, xv_format);
-#endif
-
-    if (Success != XvGrabPort(WDN, port, 0))
-	goto failed;
-    {
-	
-	xv_port = port;
-/*
-   Display *display,
-   XvPortID port,
-   int id,
-   char* data,
-   int width,
-   int height,
-   XShmSegmentInfo *shminfo
-
-*/
-        
-        XSetWindowAttributes xswa;
-        XWindowAttributes attribs;
-        static Atom xv_atom;
-        unsigned long xswamask;
-        int erCode;
-
-        /* check if colorkeying is needed */
-        xv_atom = getAtom( &quot;XV_AUTOPAINT_COLORKEY&quot; );
-        if(xv_atom!=None)
-        {
-                XvSetPortAttribute( xv_display, xv_port, xv_atom, 1 );
-        }
-        else printf(&quot;No autopaint \n&quot;);
-
-        /* if we have to deal with colorkeying ... */
-        
-	xvimage = XvShmCreateImage(WDN, xv_port,
-				   xv_format, 0, w, h, &amp;Shminfo);
-
-	Shminfo.shmid = shmget(IPC_PRIVATE, xvimage-&gt;data_size,
-			       IPC_CREAT | 0777);
-        if(Shminfo.shmid&lt;=0)
-        {
-                printf(&quot;shmget failed\n&quot;);
-        }
-	Shminfo.shmaddr = (char *) shmat(Shminfo.shmid, 0, 0);
-	Shminfo.readOnly = False;
-        if(Shminfo.shmaddr==(char *)-1)
-        {
-                printf(&quot;Shmat failed\n&quot;);
-        }
-	xvimage-&gt;data = Shminfo.shmaddr;
-	XShmAttach(WDN, &amp;Shminfo);
-	XSync(WDN, False);
-	erCode=shmctl(Shminfo.shmid, IPC_RMID, 0);
-        if(erCode)
-        {
-                printf(&quot;Shmctl failed :%d\n&quot;,erCode);
-        }
-	memset(xvimage-&gt;data, 0, xvimage-&gt;data_size);
-
-	xv_xgc.graphics_exposures = False;
-
-	xv_gc = XCreateGC(xv_display, xv_win, 0L, &amp;xv_xgc);
-	
-	//ADM_assert(BadWindow!=XSelectInput(xv_display, xv_win, ExposureMask | VisibilityChangeMask));
-
-    }
-    printf(&quot;\n Xv init succeedeed\n&quot;);
-
-    return 1;
-  failed:
-    printf(&quot;\n Xv init failed..\n&quot;);
-    return 0;
-}
-
-// _________________________________________________
-//
-// _________________________________________________
-uint8_t GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt)
-{
-    XvImageFormatValues *formatValues;
-    int imgfmt;
-    int k, f = 0;
-
-    formatValues = XvListImageFormats(dis, port, &amp;imgfmt);
-// when &quot;formatValues&quot; is NULL, imgfmt should be zero, too 
-//    if (formatValues)
-
-// this will run endless or segfault if the colorspace searched for isn't found
-//	for (k = 0; !f || (k &lt; imgfmt); k++)
-	for (k = 0; !f &amp;&amp; (k &lt; imgfmt); k++)
-	  {
-#ifdef VERBOSE_XV
-	      printf(&quot;\n %lx %d --&gt; %s&quot;, port, formatValues[k].id,
-		     formatValues[k].guid);
-#endif
-#ifdef 	COLORSPACE_YV12
-	      if (!strcmp(formatValues[k].guid, &quot;YV12&quot;))
-#else
-	      if (!strcmp(formatValues[k].guid, &quot;YUY2&quot;))
-#endif
-		{
-		    f = 1;
-		    *fmt = formatValues[k].id;
-		}
-    }// else   
-     //	f = 0; // f has already been initialized zero
-	if (formatValues) //checking if it's no NULL-pointer won't hurt
-	    XFree(formatValues); 
-    return f;
-}
-uint8_t getAtom(char *string)
-{
-  XvAttribute * attributes;
-  int attrib_count,i;
-  Atom xv_atom = None;
-
-  attributes = XvQueryPortAttributes( xv_display, xv_port, &amp;attrib_count );
-  if( attributes!=NULL )
-  {
-    for ( i = 0; i &lt; attrib_count; ++i )
-    {
-      if ( strcmp(attributes[i].name, string ) == 0 )
-      {
-        xv_atom = XInternAtom( xv_display, string, False );
-        break; // found what we want, break out
-      }
-    }
-    XFree( attributes );
-  }
-
-  return xv_atom;
-
-}
-void GUI_XvBuildAtom(Display * dis, Atom * atom, char *string)
-{
-    UNUSED_ARG(dis);
-    UNUSED_ARG(atom);
-    UNUSED_ARG(string);
-}
-
-
-uint8_t GUI_XvRedraw( void )
-{
-	printf(&quot;Xv need redraw !\n&quot;);
-
-}
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,33 +0,0 @@
-
-/***************************************************************************
-    Class to handle Xv accelerated renderer
-    
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef T_XVRENDER_H
-#define T_XVRENDER_H
-class XvAccelRender: public AccelRender
-{
-      public:
-                              XvAccelRender( void ) ;
-              virtual	uint8_t init( GUI_WindowInfo *  window, uint32_t w, uint32_t h);
-              virtual	uint8_t end(void);				
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
-                      uint8_t hasHwZoom(void) {return 1;}
-};
-#endif
-
-
-
-

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_accelRender.h (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_accelRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,24 @@
+//
+// C++ Interface: GUI_accelRender
+//
+// Description: 
+//  Class to hold all accelerated display (xv, sdl....)
+//
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+#ifndef GUI_ACCELRENDER_H
+#define GUI_ACCELRENDER_H
+class AccelRender
+{
+      public:
+                              AccelRender( void) {};
+              virtual	uint8_t init(GUI_WindowInfo * window, uint32_t w, uint32_t h)=0;
+              virtual	uint8_t end(void)=0;
+              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom=ZOOM_1_1)=0;
+              virtual uint8_t hasHwZoom(void) {return 0;}
+              
+};
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,382 @@
+/***************************************************************************
+                          gui_render.cpp  -  description
+
+	The final render a frame. The external interface is the same
+	whatever the mean (RGB/YUV/Xv)
+                             -------------------
+    begin                : Thu Jan 3 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;config.h&quot;
+#include &quot;ADM_assert.h&quot;
+#include &quot;GUI_render.h&quot;
+#include &quot;GUI_renderInternal.h&quot;
+#include &quot;GUI_accelRender.h&quot;
+
+#ifdef USE_XV
+#include &quot;GUI_xvRender.h&quot;
+#endif
+
+#ifdef USE_SDL
+#include &quot;GUI_sdlRender.h&quot;
+#endif
+
+
+#include &quot;ADM_colorspace.h&quot;
+
+
+extern ColYuvRgb rgbConverter; // Declared in UI_xxx as it is not the same between GTK and QT (RGB vs BGR or whatever)
+
+
+
+static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
+static uint8_t  GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h);
+
+// Used by flyDialog
+void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
+
+//_____________________________________
+
+//_____________________________________
+static AccelRender    *accel_mode=NULL;
+static uint8_t        *accelSurface=NULL;
+//_______________________________________
+
+static uint8_t 	*screenBuffer=NULL;
+static uint8_t		*lastImage=NULL;
+static void           *draw=NULL;
+static uint32_t 	 renderW=0,renderH=0; /* Zoomed/display size */
+static uint32_t         phyW=0,phyH=0; /* Unzoomed size, only used when accel can do hw resize */
+static renderZoom       lastZoom;
+static uint8_t          _lock=0;
+
+static const UI_FUNCTIONS_T *HookFunc=NULL;
+//_______________________________________
+/**
+ *      \fn ADM_renderLibInit
+ *      \brief Initialize the renderlib with the needed external functions
+ * 
+ */
+uint8_t ADM_renderLibInit(const UI_FUNCTIONS_T *funcs)
+  {
+    HookFunc=funcs;
+    ADM_assert(funcs-&gt;apiVersion==ADM_RENDER_API_VERSION_NUMBER);
+    return 1;
+  }
+//**************************************
+//**************************************
+//**************************************
+#define RENDER_CHECK(x) {ADM_assert(HookFunc);ADM_assert(HookFunc-&gt;x);}
+static void MUI_purge(void) 
+{
+  RENDER_CHECK(UI_purge); 
+  HookFunc-&gt;UI_purge();
+ }
+static void MUI_getWindowInfo(void *draw, GUI_WindowInfo *xinfo)
+{
+  RENDER_CHECK(UI_getWindowInfo);
+  HookFunc-&gt;UI_getWindowInfo(draw, xinfo);
+}
+static void MUI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h)
+{
+   RENDER_CHECK(UI_updateDrawWindowSize);
+   HookFunc-&gt;UI_updateDrawWindowSize(win,w,h);
+}
+static  void MUI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr)
+{
+    RENDER_CHECK(UI_rgbDraw);
+    HookFunc-&gt;UI_rgbDraw(widg, w,  h,ptr);
+  
+}
+static  void *MUI_getDrawWidget(void)
+{
+  RENDER_CHECK(UI_getDrawWidget);
+  return HookFunc-&gt;UI_getDrawWidget();
+}
+static   ADM_RENDER_TYPE MUI_getPreferredRender(void)
+{
+  RENDER_CHECK(UI_getPreferredRender);
+  return HookFunc-&gt;UI_getPreferredRender();
+}
+//**************************************
+//**************************************
+//**************************************
+
+/**
+	Render init, initialize internals. Constuctor like function
+
+*/
+uint8_t renderInit( void )
+{
+	draw=MUI_getDrawWidget(  );
+	return 1;
+}
+
+void renderDestroy(void)
+{
+	if(screenBuffer) 
+	{
+		delete[] screenBuffer;
+		screenBuffer = NULL;
+	}
+}
+
+/**
+    \fn renderLock
+    \brief Take the weak lock (i.e. not threadsafe)
+*/
+uint8_t renderLock(void)
+{
+  ADM_assert(!_lock);
+  _lock=1; 
+}
+uint8_t renderUnlock(void)
+{
+  ADM_assert(_lock);
+  _lock=0; 
+}
+
+/**
+	Warn the renderer that the display size is changing
+
+*/
+//----------------------------------------
+uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
+{
+	if(screenBuffer) 
+        {
+                delete  [] screenBuffer;
+                screenBuffer=NULL;
+        }
+        screenBuffer=new uint8_t[w*h*4];
+        phyW=pw;
+        phyH=ph;
+  
+        updateWindowSize( draw,w,h);
+        MUI_purge();
+        return 1;
+}
+/**
+	Update the image and render it
+	The width and hiehgt must NOT have changed
+
+*/
+//----------------------------------------
+uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom)
+{
+
+    ADM_assert(screenBuffer);
+    lastImage=ptr;
+    ADM_assert(!_lock);
+    if(accel_mode)
+    {
+        lastZoom=zoom;
+        if(accel_mode -&gt;hasHwZoom())
+        {
+           accel_mode-&gt;display(lastImage, phyW, phyH,zoom);
+        }else
+        {
+          accel_mode-&gt;display(lastImage, renderW, renderH,zoom);
+        }
+      
+    }else
+    {
+      GUI_ConvertRGB(ptr,screenBuffer, renderW,renderH);
+      renderRefresh();
+    }
+  return 1;
+
+}
+/**
+	Refresh the image from internal buffer / last image
+	Used for example as call back for X11 events
+
+*/
+//_______________________________________________
+uint8_t renderRefresh(void)
+{
+      if(_lock) return 1;
+      if(!screenBuffer)
+      {
+              if(accel_mode) ADM_assert(0);
+              return 0;
+      }
+
+      if(accel_mode)
+      {
+          if(lastImage)
+               if(accel_mode -&gt;hasHwZoom())
+                {
+                  accel_mode-&gt;display(lastImage, phyW, phyH,lastZoom);
+                }else
+                {
+                  accel_mode-&gt;display(lastImage, renderW, renderH,lastZoom);
+                }
+      }
+      else
+              GUI_RGBDisplay(screenBuffer, renderW, renderH,draw);
+  return 1;
+}
+
+uint8_t renderExpose(void)
+{
+    renderRefresh();
+}
+uint8_t renderStartPlaying( void )
+{
+char *displ;
+unsigned int renderI;
+ADM_RENDER_TYPE render;
+uint8_t r=0;
+	ADM_assert(!accel_mode);
+        
+#if !defined __WIN32 &amp;&amp; !defined(__APPLE__)
+	// First check if local
+	// We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
+	// in that case we do not even try to use accel
+	
+	// Win32 and Mac/Qt4 don't have DISPLAY
+	displ=getenv(&quot;DISPLAY&quot;);
+	if(!displ)
+	{
+		return 0;
+	}
+	if(strcmp(displ,&quot;:0&quot;) &amp;&amp; strcmp(displ,&quot;:0.0&quot;))
+	{
+		printf(&quot;Looks like remote display, no Xv :%s\n&quot;,displ);
+		return 1;
+	}
+#endif	
+	render=MUI_getPreferredRender();
+#if 0	
+        if(prefs-&gt;get(DEVICE_VIDEODEVICE,&amp;renderI)!=RC_OK)
+        {       
+                render=RENDER_GTK;
+        }else
+        {
+                render=(ADM_RENDER_TYPE)renderI;
+        }
+#endif        
+        GUI_WindowInfo xinfo;
+        MUI_getWindowInfo(draw, &amp;xinfo);
+        switch(render)
+        {
+        
+#if defined(USE_XV)
+	       case RENDER_XV:
+		accel_mode=new XvAccelRender();
+                if(accel_mode-&gt;hasHwZoom()) r=accel_mode-&gt;init(&amp;xinfo,phyW,phyH);
+                else r=accel_mode-&gt;init(&amp;xinfo,renderW,renderH);
+                if(!r)
+		{
+			delete accel_mode;
+			accel_mode=NULL;
+			printf(&quot;Xv init failed\n&quot;);
+		}
+		else
+		{
+			printf(&quot;Xv init ok\n&quot;);
+		}
+                break;
+#endif
+
+#if defined(USE_SDL)
+			case RENDER_SDL:
+#ifdef __WIN32
+			case RENDER_DIRECTX:
+#endif
+				accel_mode=new sdlAccelRender();
+
+				if(accel_mode-&gt;hasHwZoom()) r=accel_mode-&gt;init(&amp;xinfo,phyW,phyH);
+                else r=accel_mode-&gt;init(&amp;xinfo,renderW,renderH);
+
+                if(!r)
+				{
+					delete accel_mode;
+					accel_mode=NULL;
+				}
+
+                break;
+#endif
+
+            default:break;
+        }
+
+        if(!accel_mode)
+        {
+                rgbConverter.reset(renderW,renderH);
+                printf(&quot;No accel used for rendering\n&quot;);
+        }
+        else
+        {
+           ADM_assert(!accelSurface);
+           accelSurface=new uint8_t[ (renderW*renderH*3)&gt;&gt;1];
+          
+        }
+	
+	return 1;
+}
+/**
+      \fn renderHasAccelZoom
+      \brief returns 1 if accel can do hw zoom
+*/
+uint8_t renderHasAccelZoom(void)
+{
+    if(!accel_mode) return 0;
+    return accel_mode-&gt;hasHwZoom(); 
+}
+
+uint8_t renderStopPlaying( void )
+{
+      
+      if(accel_mode)
+      {
+              accel_mode-&gt;end();
+              delete accel_mode;
+              if(accelSurface) delete [] accelSurface;
+              accelSurface=NULL;
+                              
+      }
+      accel_mode=NULL;	
+      
+      return 1;
+}
+
+
+//___________________________________________________________________________
+//
+//
+uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h)
+{
+    ADM_assert(screenBuffer);
+    renderW = w;
+    renderH = h;
+
+    MUI_updateDrawWindowSize(win,w,h);
+    rgbConverter.reset(w,h);
+    return 1;
+}
+
+uint8_t GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h)
+{
+    rgbConverter.reset(w,h);
+    rgbConverter.scale(in,out);
+    return 1;
+}
+void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg)
+{
+    
+    MUI_rgbDraw(widg,w,h,dis);
+}
+//EOF

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.h (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_render.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,109 @@
+/****************************************************************************
+ copyright            : (C) 2001 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#ifndef GUI_RENDER_H
+#define GUI_RENDER_H
+
+
+#include &quot;ADM_image.h&quot;
+
+class AVDMGenericVideoStream;
+typedef struct
+{
+    void *display;
+    int  window;
+	int x;
+	int y;
+	int width;
+	int height;
+} GUI_WindowInfo;
+
+typedef enum 
+{
+    ADM_PREVIEW_NONE, 
+    ADM_PREVIEW_OUTPUT,
+    ADM_PREVIEW_SIDE,
+    ADM_PREVIEW_TOP,
+    ADM_PREVIEW_SEPARATE
+}ADM_PREVIEW_MODE;
+
+typedef enum 
+{
+        ZOOM_1_4,
+        ZOOM_1_2,
+        ZOOM_1_1,
+        ZOOM_2,
+        ZOOM_4,
+        ZOOM_INVALID
+}renderZoom;
+
+
+ADM_PREVIEW_MODE getPreviewMode(void);
+void             setPreviewMode(ADM_PREVIEW_MODE preview);
+void             changePreviewZoom(renderZoom nzoom);
+
+class admPreview
+{
+  public:
+      static uint8_t update(uint32_t framenum);
+      static void start(void);
+      static void stop(void);
+      static void setMainDimension(uint32_t, uint32_t );
+      static void updateFilters(AVDMGenericVideoStream *first,AVDMGenericVideoStream *last);
+      static void deferDisplay(uint32_t onoff,uint32_t startat);
+      static void displayNow(uint32_t framenum);
+      static void cleanUp(void);  
+      static ADMImage *getBuffer(void);
+};
+
+uint8_t renderInit( void );
+void renderDestroy(void);
+uint8_t renderResize(uint32_t w, uint32_t h,uint32_t phyW,uint32_t phyH);
+uint8_t renderRefresh(void);
+uint8_t renderExpose(void);
+uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom);
+uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t,uint32_t primary);
+
+uint8_t renderStartPlaying( void );
+uint8_t renderStopPlaying( void );
+uint8_t renderHasAccelZoom(void);
+
+uint8_t renderLock(void);
+uint8_t renderUnlock(void);
+
+void *UI_getDrawWidget(void);
+void UI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
+void UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h);
+void UI_getWindowInfo(void *draw, GUI_WindowInfo *xinfo);
+
+typedef enum 
+{
+        RENDER_GTK=0,
+#ifdef USE_XV
+        RENDER_XV=1,
+#endif
+#ifdef USE_SDL
+        RENDER_SDL=2,
+
+#ifdef __WIN32
+		RENDER_DIRECTX=3,
+#endif
+#endif
+        RENDER_LAST       
+
+
+}ADM_RENDER_TYPE;
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_renderInternal.h (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_renderInternal.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,34 @@
+/****************************************************************************
+ copyright            : (C) 2001 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#ifndef GUI_RENDER_INTERNAL_H
+#define GUI_RENDER_INTERNAL_H
+
+#define ADM_RENDER_API_VERSION_NUMBER 2
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
+typedef struct
+{
+  int   apiVersion;
+  void (*UI_purge)(void);
+  void (*UI_getWindowInfo)(void *draw, GUI_WindowInfo *xinfo);
+  void (*UI_updateDrawWindowSize)(void *win,uint32_t w,uint32_t h);
+  void (*UI_rgbDraw)(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
+  void *(*UI_getDrawWidget)(void);
+  ADM_RENDER_TYPE (*UI_getPreferredRender)(void);
+  
+}UI_FUNCTIONS_T;
+
+uint8_t ADM_renderLibInit(const UI_FUNCTIONS_T *funcs);
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.cpp (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,414 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+***************************************************************************/
+
+/***************************************************************************
+*                                                                         *
+*   This program is free software; you can redistribute it and/or modify  *
+*   it under the terms of the GNU General Public License as published by  *
+*   the Free Software Foundation; either version 2 of the License, or     *
+*   (at your option) any later version.                                   *
+*                                                                         *
+***************************************************************************///
+//  The pitch stride has to be changed as there could be some padding depending on the OS
+//
+//
+
+#include &quot;config.h&quot;
+
+#if defined(USE_SDL)
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+
+extern &quot;C&quot; {
+// get rid of warnings due to different definitions
+#undef HAVE_INTTYPES_H
+#undef HAVE_MALLOC_H
+#undef HAVE_STDINT_H
+#undef HAVE_SYS_TYPES_H
+#include &quot;SDL.h&quot;
+#include &quot;SDL_syswm.h&quot;
+}
+
+#include &quot;ADM_colorspace.h&quot;
+
+#include &quot;GUI_render.h&quot;
+
+#include &quot;GUI_accelRender.h&quot;
+#include &quot;GUI_sdlRender.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+#ifdef __WIN32
+#include &quot;prefs.h&quot;
+#endif
+
+#ifdef __APPLE__
+extern &quot;C&quot;
+{
+	void initSdlCocoaView(void* parent, int x, int y, int width, int height, bool carbonParent);
+	void destroyCocoaView(void);
+}
+#endif
+
+//******************************************
+static uint8_t sdl_running=0;
+static SDL_Overlay *sdl_overlay=NULL;
+static SDL_Surface *sdl_display=NULL;
+static SDL_Rect disp;
+#ifdef __WIN32
+HWND sdlWin32;
+#endif
+static ColBase *color=NULL;
+
+sdlAccelRender::sdlAccelRender( void)
+{
+        useYV12=1;
+        decoded=NULL;
+}
+uint8_t sdlAccelRender::end( void)
+{
+        if(sdl_overlay)
+        {
+                SDL_FreeYUVOverlay(sdl_overlay);
+        }
+        if(sdl_display)
+        {
+        		SDL_UnlockSurface(sdl_display);
+                SDL_FreeSurface(sdl_display);
+        }
+        if(sdl_running)
+        {
+                SDL_QuitSubSystem(SDL_INIT_VIDEO);
+
+#ifdef __APPLE__
+				destroyCocoaView();
+#endif
+        }
+        if(decoded)
+        {
+		        delete [] decoded;
+		        decoded=NULL;	
+        }
+        sdl_running=0;
+        sdl_overlay=NULL;
+        sdl_display=NULL;
+        printf(&quot;[SDL] Video subsystem closed and destroyed\n&quot;);        
+}
+uint8_t sdlAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
+{
+	printf(&quot;[SDL] Initialising video subsystem\n&quot;);
+
+#ifdef __APPLE__
+	if (window-&gt;width &gt; w &amp;&amp; window-&gt;height &gt; h)
+	{
+		printf(&quot;[SDL] Disabling acceleration.  Zoom increase not supported on Mac\n&quot;);
+		return 0;
+	}
+#endif
+
+	int bpp;
+	int flags;
+
+    // Ask for the position of the drawing window at start
+    disp.w=w;
+    disp.h=h;
+    disp.x=0;
+    disp.y=0;
+
+    if(!useYV12)
+    {
+		color=new ColBase(720,480);
+		decoded=new uint8_t[w*h*2];
+    }
+
+    // Hack to get SDL to use GTK window, ugly but works
+#if !defined(__WIN32) &amp;&amp; !defined(__APPLE__)
+	char SDL_windowhack[32];
+    int winId=(int)window-&gt;window;
+
+    sprintf(SDL_windowhack,&quot;SDL_WINDOWID=%ld&quot;,winId);
+    putenv(SDL_windowhack);
+#endif
+
+    if (SDL_InitSubSystem(SDL_INIT_VIDEO) &lt; 0) 
+    {
+		printf(&quot;[SDL] FAILED initialising video subsystem\n&quot;);
+		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+
+        return 0;
+    }
+
+    // Do it twice as the 1st time does not work
+    // Hack to get SDL to use GTK window, ugly but works
+#if !defined(__WIN32) &amp;&amp; !defined(__APPLE__)
+    putenv(SDL_windowhack);
+    SDL_QuitSubSystem(SDL_INIT_VIDEO);
+    if (SDL_InitSubSystem(SDL_INIT_VIDEO) &lt; 0) 
+    {
+                printf(&quot;[SDL] FAILED initialising video subsystem\n&quot;);
+                printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+                return 0;
+    }
+#endif
+
+    sdl_running=1;
+    flags = SDL_ANYFORMAT | SDL_HWPALETTE | SDL_HWSURFACE | SDL_NOFRAME;
+    bpp= SDL_VideoModeOK( w, h,  32, flags );
+
+#ifdef __WIN32
+	// SDL window is created and displayed before we get a chance to set the parent.
+	// Therefore, align the SDL overlay with the client area before it is displayed.
+	POINT screenPoint = {};
+	char origin[43];
+
+	ClientToScreen((HWND)window-&gt;display, &amp;screenPoint);
+	snprintf(origin, 43, &quot;SDL_VIDEO_WINDOW_POS=%i,%i&quot;, screenPoint.x, screenPoint.y);
+	putenv(origin);
+#endif
+
+#ifdef __APPLE__
+	void* parent;
+
+	if (window-&gt;display)
+		// Carbon parent (Qt4)
+		parent = window-&gt;display;
+	else
+		// Cocoa parent (GTK)
+		parent = (void*)window-&gt;window;
+
+	if (parent)
+		// Create Cocoa view and attach to Carbon window using custom Objective-C function.
+		// It's a retarded way of doing things but that's what Apple has imposed...
+		initSdlCocoaView(parent, window-&gt;x, window-&gt;y, window-&gt;width, window-&gt;height, (window-&gt;display != NULL));
+#endif
+
+	// SDL will resize our window to width and height passed to SetVideoMode.
+	// This is fine until we use zoomed views so pass window dimensions instead.
+	sdl_display= SDL_SetVideoMode(window-&gt;width, window-&gt;height, bpp, flags);
+
+    if (!sdl_display)
+    {
+        end();
+        printf(&quot;[SDL] Cannot create surface\n&quot;);
+		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+        return 0;
+    }
+
+    SDL_LockSurface(sdl_display);
+
+#ifdef __WIN32
+	struct SDL_SysWMinfo wmInfo;
+	SDL_VERSION(&amp;wmInfo.version);
+
+	if (-1 != SDL_GetWMInfo(&amp;wmInfo))
+	{
+		sdlWin32 = wmInfo.window;
+
+		// Make SDL window a child to prevent it from gaining focus
+		int windowFlags = GetWindowLongPtr(sdlWin32, GWL_STYLE);
+
+		SetWindowLongPtr(sdlWin32, GWL_STYLE, (windowFlags &amp; ~WS_POPUP) | WS_CHILD);
+
+		// Set the SDL window's parent to the main window and reposition
+		SetParent(sdlWin32, (HWND)window-&gt;display);
+		SetWindowPos(sdlWin32, NULL, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
+
+		// The SDL window stole focus before it was made a child, so set focus back to the main window
+		SetFocus((HWND)window-&gt;display);
+	}
+	else
+	{
+		printf(&quot;[SDL] Reparenting failed\n&quot;);
+	}
+#endif
+
+        int cspace;
+        
+        if(useYV12) cspace=SDL_YV12_OVERLAY;
+            else    cspace=SDL_YUY2_OVERLAY;
+        //_______________________________________________________
+        sdl_overlay=SDL_CreateYUVOverlay((w),(h), cspace, sdl_display);
+
+		// DirectX may fail but overlay still created.
+		// Not a showstopper but log failure.
+		if (strlen(SDL_GetError()))
+		{
+			printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+		}
+
+        if(!sdl_overlay)
+        {
+			end();
+			printf(&quot;[SDL] Cannot create SDL overlay\n&quot;);
+			printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+
+			return 0;
+        }
+        
+        printf(&quot;[SDL] Overlay created; type: %d, planes: %d, pitch: %d\n&quot;, sdl_overlay-&gt;hw_overlay, sdl_overlay-&gt;planes, sdl_overlay-&gt;pitches[0]);
+
+        if(!sdl_overlay-&gt;hw_overlay)
+            printf(&quot;[SDL] Hardware acceleration disabled\n&quot;);
+
+        if(!useYV12) color-&gt;reset(w,h);
+
+		printf(&quot;[SDL] Video subsystem initalised successfully\n&quot;);
+
+        return 1;
+}
+
+static void interleave(uint8_t *dst,uint8_t *src,int width, int stride, int lines)
+{
+    for(int y=0;y&lt;lines;y++)
+    {
+        memcpy(dst,src,width);
+        src+=width;
+        dst+=stride;          
+    }   
+}
+uint8_t sdlAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
+{
+#ifdef __WIN32
+	// DirectX playback doesn't refresh correctly if the parent window is moved.
+	// Detect when the parent window has moved and force a coordinate update.
+	if (strcmp(getenv(&quot;SDL_VIDEODRIVER&quot;), &quot;directx&quot;) == 0)
+	{
+		static RECT lastPos;
+
+		RECT currentPos;
+		GetWindowRect(sdlWin32, &amp;currentPos);
+
+		if (currentPos.left != lastPos.left || currentPos.top != lastPos.top)
+		{
+			// By default SetWindowPos doesn't work if the new coordinates are the same as the 
+			// current so use SWP_FRAMECHANGED to force an update.
+			SetWindowPos(sdlWin32, NULL, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED);
+			lastPos = currentPos;
+		}
+	}
+#endif
+
+int pitch;
+int page=w*h;
+        ADM_assert(sdl_overlay);
+        SDL_LockYUVOverlay(sdl_overlay);	
+        pitch=sdl_overlay-&gt;pitches[0];
+//	printf(&quot;SDL: new pitch :%d\n&quot;,pitch);
+        if(useYV12)
+        {
+	        if(pitch==w)
+	            memcpy(sdl_overlay-&gt;pixels[0],ptr,w*h);
+	        else
+	            interleave(sdl_overlay-&gt;pixels[0],ptr,w,pitch,h);
+	            
+	        pitch=sdl_overlay-&gt;pitches[1];
+	        if(pitch==(w&gt;&gt;1))
+	            memcpy(sdl_overlay-&gt;pixels[1],ptr+page,(w*h)&gt;&gt;2);
+	        else
+	            interleave(sdl_overlay-&gt;pixels[1],ptr+page,w&gt;&gt;1,pitch,h&gt;&gt;1);
+	      
+	        pitch=sdl_overlay-&gt;pitches[2];
+	        if(pitch==(w&gt;&gt;1))
+	            memcpy(sdl_overlay-&gt;pixels[2],ptr+(page*5)/4,(w*h)&gt;&gt;2);
+	        else
+	            interleave(sdl_overlay-&gt;pixels[2],ptr+(page*5)/4,w&gt;&gt;1,pitch,h&gt;&gt;1);  	
+        }else
+        {
+	        color-&gt;reset(w,h);
+	        if(pitch==2*w)
+	        {
+	            color-&gt;scale(ptr,sdl_overlay-&gt;pixels[0]);
+	        }
+	        else
+	        {
+	            color-&gt;scale(ptr,decoded);
+	            interleave(sdl_overlay-&gt;pixels[0],decoded,2*w,pitch,h);
+	        }
+        }	
+        uint32_t factor=4;
+               switch(zoom)
+               {
+                   case ZOOM_1_4: factor=1;break;
+                   case ZOOM_1_2: factor=2;break;
+                   case ZOOM_1_1: factor=4;break;
+                   case ZOOM_2:   factor=8;break;
+                   case ZOOM_4:   factor=16;break;
+                   default : ADM_assert(0);
+                 
+               }
+        disp.w=(w*factor)/4;
+        disp.h=(h*factor)/4;
+        disp.x=0;
+        disp.y=0;
+        
+        SDL_UnlockYUVOverlay(sdl_overlay);
+        SDL_DisplayYUVOverlay(sdl_overlay,&amp;disp);
+        
+        return 1;
+}
+
+void initSdl(void)
+{
+	printf(&quot;\n&quot;);
+	quitSdl();
+
+    int sdl_version = (SDL_Linked_Version()-&gt;major*1000)+(SDL_Linked_Version()-&gt;minor*100) + (SDL_Linked_Version()-&gt;patch);
+
+    printf(&quot;[SDL] Version: %u.%u.%u\n&quot;,SDL_Linked_Version()-&gt;major, SDL_Linked_Version()-&gt;minor, SDL_Linked_Version()-&gt;patch);
+
+#ifdef __WIN32
+	uint32_t videoDevice = RENDER_LAST;
+
+	if(!prefs-&gt;get(DEVICE_VIDEODEVICE, &amp;videoDevice) || videoDevice != RENDER_DIRECTX)
+	{
+		printf(&quot;[SDL] Setting video driver to Microsoft Windows GDI\n&quot;);
+		putenv(&quot;SDL_VIDEODRIVER=windib&quot;);
+	}
+	else
+	{
+		printf(&quot;[SDL] Setting video driver to Microsoft DirectX\n&quot;);
+		putenv(&quot;SDL_VIDEODRIVER=directx&quot;);
+	}
+#endif
+
+	uint32_t sdlInitFlags;
+
+	if (sdl_version &gt; 1209)
+		sdlInitFlags = SDL_INIT_EVERYTHING;
+	else
+		sdlInitFlags = 0;
+
+	printf(&quot;[SDL] Initialisation &quot;);
+
+	if (SDL_Init(sdlInitFlags) == 0)
+	{
+		printf(&quot;succeeded\n&quot;);
+
+		char driverName[100];
+
+		if (SDL_VideoDriverName(driverName, 100) != NULL)
+		{
+			printf(&quot;[SDL] Video Driver: %s\n&quot;, driverName);
+		}
+	}
+	else
+	{
+		printf(&quot;FAILED\n&quot;);
+		printf(&quot;[SDL] ERROR: %s\n&quot;, SDL_GetError());
+	}
+
+	printf(&quot;\n&quot;);
+}
+
+void quitSdl(void)
+{
+	if (SDL_WasInit(SDL_INIT_EVERYTHING))
+	{
+		printf(&quot;[SDL] Quitting...\n&quot;);
+		SDL_Quit();
+	}
+}
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.h (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,36 @@
+
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;GUI_render.h&quot;
+#include &quot;GUI_accelRender.h&quot;
+
+#ifndef TSDLRENDER_H
+#define TSDLRENDER_H
+
+class sdlAccelRender: public AccelRender
+{
+  protected:
+              int     useYV12;
+              uint8_t *decoded;
+      public:
+                                sdlAccelRender( void ) ;
+              virtual	uint8_t init( GUI_WindowInfo * window, uint32_t w, uint32_t h);
+              virtual	uint8_t end(void);
+              virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
+              			uint8_t hasHwZoom(void) {return 1;}
+};
+
+void initSdl(void);
+void quitSdl(void);
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRenderHelper.m (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRenderHelper.m	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_sdlRenderHelper.m	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,139 @@
+#import &lt;Cocoa/Cocoa.h&gt;
+#import &lt;Carbon/Carbon.h&gt;
+
+static NSWindow* nsParentWindow = nil;
+static NSWindow* nsWindow = nil;
+static NSQuickDrawView* nsView = nil;
+static bool cocoaApplication = false;
+static id oldDelegate = nil;
+static int widgetX = 0, widgetY = 0;
+
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at interface</A> SdlCocoaWindow : NSWindow
+- (void)windowDidMove:(id)notification;
+- (void)windowWillMiniaturize:(NSNotification *)notification;
+- (void)windowDidDeminiaturize:(NSNotification *)notification;
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at end</A>
+
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at implementation</A> SdlCocoaWindow
+- (void)windowDidMove:(id)notification
+{
+	NSRect parentFrame = [nsParentWindow frame];
+	NSPoint point = NSMakePoint(parentFrame.origin.x + widgetX, parentFrame.origin.y + widgetY);
+
+	[self setFrameOrigin:point];
+}
+
+- (void)windowWillMiniaturize:(NSNotification *)notification
+{
+	[self setIsVisible:NO];
+}
+
+- (void)windowDidDeminiaturize:(NSNotification *)notification
+{
+	[self setIsVisible:YES];
+}
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at end</A>
+
+void initSdlCocoaView(void* parent, int x, int y, int width, int height, bool carbonParent)
+{
+	printf(&quot;[SDL] Creating Cocoa view x: %d, y: %d, width: %d, height %d, carbon %d\n&quot;, x, y, width, height, carbonParent);
+
+	NSRect contentRect;
+
+	if (carbonParent)
+	{
+		contentRect = NSMakeRect(x, y, width, height);
+
+		if (!nsWindow)
+		{
+			// initWithWindowRef always returns the same result for the same WindowRef
+			nsWindow = [[NSWindow alloc] initWithWindowRef:(WindowRef)parent];
+
+			[nsWindow setContentView:[[[NSView alloc] initWithFrame:contentRect] autorelease]];
+		}
+	}
+	else
+	{
+		contentRect = NSMakeRect(0, 0, width, height);
+		
+		if (!nsWindow)
+		{
+			nsWindow = [[SdlCocoaWindow alloc] initWithContentRect:contentRect styleMask:NSDocModalWindowMask backing:NSBackingStoreBuffered defer:NO];
+
+			nsParentWindow = (NSWindow*)parent;
+			widgetX = x;
+			widgetY = y;
+			oldDelegate = [nsParentWindow delegate];
+			cocoaApplication = true;
+
+			[nsWindow setLevel:NSFloatingWindowLevel];
+			[nsWindow setHasShadow:NO];
+			
+			NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
+	
+			[nc addObserver:nsWindow selector:@selector(windowDidMove:) name:NSWindowDidMoveNotification object:nsParentWindow];
+			[nc addObserver:nsWindow selector:@selector(windowWillMiniaturize:) name:NSWindowWillMiniaturizeNotification object:nsParentWindow];
+			[nc addObserver:nsWindow selector:@selector(windowDidDeminiaturize:) name:NSWindowDidDeminiaturizeNotification object:nsParentWindow];
+		}
+	}
+
+	if (!nsView)
+	{
+		nsView = [[NSQuickDrawView alloc] initWithFrame:contentRect];
+
+		[[nsWindow contentView] addSubview:nsView];
+		[nsView release];
+		
+		if (carbonParent)
+			[nsWindow orderOut:nil];	// very important, otherwise window won't be placed correctly on repeat showings
+		else
+		{
+			NSRect parentFrame = [nsParentWindow frame];
+			NSPoint point = NSMakePoint(parentFrame.origin.x + x, parentFrame.origin.y + y);
+			
+			[nsWindow setFrameOrigin:point];
+		}
+
+		[nsWindow orderFront:nil];
+	}
+	else
+	{
+		[nsView setFrame:contentRect];
+		[[nsWindow contentView] setFrame:contentRect];
+	}
+
+	// finally, set SDL environment variables with all this nonsense
+	char SDL_windowhack[50];
+
+	sprintf(SDL_windowhack,&quot;SDL_NSWindowPointer=%ld&quot;,(int)nsWindow);
+	putenv(SDL_windowhack);
+
+	sprintf(SDL_windowhack,&quot;SDL_NSQuickDrawViewPointer=%ld&quot;,(int)nsView);
+	putenv(SDL_windowhack);
+}
+
+void destroyCocoaView(void)
+{
+	if (cocoaApplication)
+	{
+		[nsParentWindow setDelegate:oldDelegate];
+		
+		// we're using a floating panel so it doesn't automatically get destroyed
+		[nsWindow release];
+		
+		nsWindow = nil;
+		nsView = nil;
+		oldDelegate = nil;
+	}
+	else if (nsWindow)
+	{
+		// Reference count cannot fall below 2 because SDL releases the window when closing
+		// and again when reinitialising (even though this is our own window...).
+		if ([nsWindow retainCount] &gt; 2)
+			[nsWindow release];
+
+		// SDL takes care of all the destroying...a little too much, so make sure our Carbon
+		// window is still displayed (via its Cocoa wrapper)
+		[nsWindow makeKeyAndOrderFront:nil];
+	}
+}

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,405 @@
+/***************************************************************************
+                          gui_xv.cpp  -  description
+                             -------------------
+
+	This part is strongly derivated from xine/mplayer/mpeg2dec
+
+    begin                : Tue Jan 1 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+
+//#define VERBOSE_XV
+
+#ifdef USE_XV
+#include &lt;X11/Xlib.h&gt;
+#include &lt;X11/Xutil.h&gt;
+#include &lt;sys/ipc.h&gt;
+#include &lt;sys/shm.h&gt;
+#include &lt;X11/extensions/XShm.h&gt;
+#include &lt;X11/extensions/Xvlib.h&gt;
+#include &lt;X11/extensions/XShm.h&gt;
+
+#include &quot;ADM_default.h&quot;
+
+
+#include &quot;GUI_render.h&quot;
+
+#include &quot;GUI_accelRender.h&quot;
+#include &quot;GUI_xvRender.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+static uint8_t 	GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt);
+static uint8_t 	GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h);
+static void 	GUI_XvEnd( void );
+static uint8_t 	GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom);
+static uint8_t 	GUI_XvSync(void);
+
+static uint8_t getAtom(char *string);
+//________________Wrapper around Xv_______________
+XvAccelRender::XvAccelRender( void ) 
+{
+
+}
+uint8_t XvAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
+{
+	printf(&quot;Xv start\n&quot;);
+	return  GUI_XvInit( window,  w,  h);
+}
+uint8_t XvAccelRender::end(void)
+{
+	 GUI_XvEnd( );
+	 printf(&quot;Xv end\n&quot;);
+	 return 1;
+}
+
+uint8_t XvAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
+{
+	return GUI_XvDisplay(ptr, w, h,zoom);
+}
+//________________Wrapper around Xv_______________
+
+static unsigned int xv_port;
+static uint32_t xv_format;
+static Display *xv_display;
+static XvImage *xvimage = NULL;
+static GC xv_gc;
+static XGCValues xv_xgc;
+static Window xv_win;
+static XShmSegmentInfo Shminfo;
+static uint8_t GUI_XvExpose( void );
+//
+//	Free all ressources allocated by xv
+//
+
+
+void GUI_XvEnd( void )
+{
+	ADM_assert(xv_port);
+ 	ADM_assert(xv_display);
+
+
+  	printf(&quot;\n Releasing Xv Port\n&quot;);
+  	XLockDisplay (xv_display);
+	if(XvUngrabPort(xv_display,xv_port,0)!=Success)
+ 				printf(&quot;\n Trouble releasing port...\n&quot;);
+	XUnlockDisplay (xv_display);
+
+
+     xvimage=NULL;
+     xv_display=NULL;
+     xv_port=0;
+
+}
+
+//------------------------------------
+uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom)
+{
+    uint32_t destW,destH;
+    if (xvimage)
+      {
+
+	  // put image in shared segment
+
+	  // for YV12, 4 bits for Y 4 bits for u, 4 bits for v
+	  // total 1.5*
+         XLockDisplay (xv_display);
+	  memcpy(xvimage-&gt;data, src, (w*h*3)&gt;&gt;1);
+          uint32_t factor=4;
+        switch(zoom)
+        {
+            case ZOOM_1_4: factor=1;break;
+            case ZOOM_1_2: factor=2;break;
+            case ZOOM_1_1: factor=4;break;
+            case ZOOM_2:   factor=8;break;
+            case ZOOM_4:   factor=16;break;
+            default : ADM_assert(0);
+          
+        }
+	destW=(w*factor)/4;
+        destH=(h*factor)/4;
+        //printf(&quot;%u x %u =&gt; %u x %u\n&quot;,w,h,destW,destH);
+        // And display it !
+#if 1
+	  XvShmPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
+			0, 0, destW, destH,	// dst
+			False);
+#else
+	 XvPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
+			0, 0, w, h	// dst
+			);
+
+#endif
+	  //XSetForeground (xv_display, xv_gc, 0);
+
+	  XSync(xv_display, False);
+	  XUnlockDisplay (xv_display);
+	  //GUI_XvExpose();
+
+      }
+    return 1;
+
+}
+uint8_t GUI_XvSync(void)
+{
+	if(xv_display)
+	  	XSync(xv_display, False);
+	return 1;		
+}
+//------------------------------------
+//
+//------------------------------------
+uint8_t GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h)
+{
+
+
+    unsigned int ver, rel, req, ev, err;
+    unsigned int port, adaptors;
+    static XvAdaptorInfo *ai;
+    static XvAdaptorInfo *curai;
+    
+#if 0
+    win = gtk_widget_get_parent_window(window);
+    xv_display = GDK_WINDOW_XDISPLAY(win);
+//      xv_win= RootWindow(xv_display,0);
+    xv_win = GDK_WINDOW_XWINDOW(GTK_WIDGET(window)-&gt;window);
+#endif    
+
+    xv_display=(Display *)window-&gt;display;
+    xv_win=window-&gt;window;
+    
+    
+#define WDN xv_display
+    xv_port = 0;
+
+    if (Success != XvQueryExtension(WDN, &amp;ver, &amp;rel, &amp;req, &amp;ev, &amp;err))
+      {
+	  printf(&quot;\n Query Extension failed\n&quot;);
+	  goto failed;
+      }
+    /* check for Xvideo support */
+    if (Success != XvQueryAdaptors(WDN,
+				   DefaultRootWindow(WDN), &amp;adaptors, &amp;ai))
+      {
+	  printf(&quot;\n Query Adaptor failed\n&quot;);
+	  goto failed;
+      }
+    curai = ai;
+    XvFormat *formats;
+    // Dump infos
+    port = 0;
+    for (uint16_t i = 0; (!port) &amp;&amp; (i &lt; adaptors); i++)
+      {
+/*
+XvPortID base_id;
+unsigned long num_ports;
+char type;
+char *name;
+unsigned long num_formats;
+XvFormat *formats;
+unsigned long num_adaptors;
+*/
+#ifdef VERBOSE_XV
+	  printf(&quot;\n_______________________________\n&quot;);
+	  printf(&quot;\n Adaptor 		: %d&quot;, i);
+	  printf(&quot;\n Base ID		: %ld&quot;, curai-&gt;base_id);
+	  printf(&quot;\n Nb Port	 	: %lu&quot;, curai-&gt;num_ports);
+	  printf(&quot;\n Type			 	: %d,&quot;,
+		 curai-&gt;type);
+#define CHECK(x) if(curai-&gt;type &amp; x) printf(&quot;|&quot;#x);
+	  CHECK(XvInputMask);
+	  CHECK(XvOutputMask);
+	  CHECK(XvVideoMask);
+	  CHECK(XvStillMask);
+	  CHECK(XvImageMask);
+
+	  printf(&quot;\n Name			 	: %s&quot;,
+		 curai-&gt;name);
+	  printf(&quot;\n Num Adap	 	: %lu&quot;, curai-&gt;num_adaptors);
+	  printf(&quot;\n Num fmt	 	: %lu&quot;, curai-&gt;num_formats);
+#endif	  
+	  formats = curai-&gt;formats;
+
+	  //
+	  uint16_t k;
+
+	  for (k = 0; (k &lt; curai-&gt;num_ports) &amp;&amp; !port; k++)
+	    {
+		if (GUI_XvList(WDN, k + curai-&gt;base_id, &amp;xv_format))
+		    port = k + curai-&gt;base_id;
+	    }
+
+
+	  curai++;
+      }
+    //
+    if (!port)
+      {
+	  printf(&quot;\n no port found&quot;);
+	  goto failed;
+      }
+#ifdef 	COLORSPACE_YV12
+    printf(&quot;\n Xv YV12 found at port :%d, format : %ld&quot;, port, xv_format);
+#else
+    printf(&quot;\n Xv YUY2 found at port :%d, format : %ld&quot;, port, xv_format);
+#endif
+
+    if (Success != XvGrabPort(WDN, port, 0))
+	goto failed;
+    {
+	
+	xv_port = port;
+/*
+   Display *display,
+   XvPortID port,
+   int id,
+   char* data,
+   int width,
+   int height,
+   XShmSegmentInfo *shminfo
+
+*/
+        
+        XSetWindowAttributes xswa;
+        XWindowAttributes attribs;
+        static Atom xv_atom;
+        unsigned long xswamask;
+        int erCode;
+
+        /* check if colorkeying is needed */
+        xv_atom = getAtom( &quot;XV_AUTOPAINT_COLORKEY&quot; );
+        if(xv_atom!=None)
+        {
+                XvSetPortAttribute( xv_display, xv_port, xv_atom, 1 );
+        }
+        else printf(&quot;No autopaint \n&quot;);
+
+        /* if we have to deal with colorkeying ... */
+        
+	xvimage = XvShmCreateImage(WDN, xv_port,
+				   xv_format, 0, w, h, &amp;Shminfo);
+
+	Shminfo.shmid = shmget(IPC_PRIVATE, xvimage-&gt;data_size,
+			       IPC_CREAT | 0777);
+        if(Shminfo.shmid&lt;=0)
+        {
+                printf(&quot;shmget failed\n&quot;);
+        }
+	Shminfo.shmaddr = (char *) shmat(Shminfo.shmid, 0, 0);
+	Shminfo.readOnly = False;
+        if(Shminfo.shmaddr==(char *)-1)
+        {
+                printf(&quot;Shmat failed\n&quot;);
+        }
+	xvimage-&gt;data = Shminfo.shmaddr;
+	XShmAttach(WDN, &amp;Shminfo);
+	XSync(WDN, False);
+	erCode=shmctl(Shminfo.shmid, IPC_RMID, 0);
+        if(erCode)
+        {
+                printf(&quot;Shmctl failed :%d\n&quot;,erCode);
+        }
+	memset(xvimage-&gt;data, 0, xvimage-&gt;data_size);
+
+	xv_xgc.graphics_exposures = False;
+
+	xv_gc = XCreateGC(xv_display, xv_win, 0L, &amp;xv_xgc);
+	
+	//ADM_assert(BadWindow!=XSelectInput(xv_display, xv_win, ExposureMask | VisibilityChangeMask));
+
+    }
+    printf(&quot;\n Xv init succeedeed\n&quot;);
+
+    return 1;
+  failed:
+    printf(&quot;\n Xv init failed..\n&quot;);
+    return 0;
+}
+
+// _________________________________________________
+//
+// _________________________________________________
+uint8_t GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt)
+{
+    XvImageFormatValues *formatValues;
+    int imgfmt;
+    int k, f = 0;
+
+    formatValues = XvListImageFormats(dis, port, &amp;imgfmt);
+// when &quot;formatValues&quot; is NULL, imgfmt should be zero, too 
+//    if (formatValues)
+
+// this will run endless or segfault if the colorspace searched for isn't found
+//	for (k = 0; !f || (k &lt; imgfmt); k++)
+	for (k = 0; !f &amp;&amp; (k &lt; imgfmt); k++)
+	  {
+#ifdef VERBOSE_XV
+	      printf(&quot;\n %lx %d --&gt; %s&quot;, port, formatValues[k].id,
+		     formatValues[k].guid);
+#endif
+#ifdef 	COLORSPACE_YV12
+	      if (!strcmp(formatValues[k].guid, &quot;YV12&quot;))
+#else
+	      if (!strcmp(formatValues[k].guid, &quot;YUY2&quot;))
+#endif
+		{
+		    f = 1;
+		    *fmt = formatValues[k].id;
+		}
+    }// else   
+     //	f = 0; // f has already been initialized zero
+	if (formatValues) //checking if it's no NULL-pointer won't hurt
+	    XFree(formatValues); 
+    return f;
+}
+uint8_t getAtom(char *string)
+{
+  XvAttribute * attributes;
+  int attrib_count,i;
+  Atom xv_atom = None;
+
+  attributes = XvQueryPortAttributes( xv_display, xv_port, &amp;attrib_count );
+  if( attributes!=NULL )
+  {
+    for ( i = 0; i &lt; attrib_count; ++i )
+    {
+      if ( strcmp(attributes[i].name, string ) == 0 )
+      {
+        xv_atom = XInternAtom( xv_display, string, False );
+        break; // found what we want, break out
+      }
+    }
+    XFree( attributes );
+  }
+
+  return xv_atom;
+
+}
+void GUI_XvBuildAtom(Display * dis, Atom * atom, char *string)
+{
+    UNUSED_ARG(dis);
+    UNUSED_ARG(atom);
+    UNUSED_ARG(string);
+}
+
+
+uint8_t GUI_XvRedraw( void )
+{
+	printf(&quot;Xv need redraw !\n&quot;);
+
+}
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.h (from rev 4049, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.h	2008-05-21 17:57:29 UTC (rev 4050)
@@ -0,0 +1,33 @@
+
+/***************************************************************************
+    Class to handle Xv accelerated renderer
+    
+    copyright            : (C) 2006 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef T_XVRENDER_H
+#define T_XVRENDER_H
+class XvAccelRender: public AccelRender
+{
+      public:
+                              XvAccelRender( void ) ;
+              virtual	uint8_t init( GUI_WindowInfo *  window, uint32_t w, uint32_t h);
+              virtual	uint8_t end(void);				
+              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
+                      uint8_t hasHwZoom(void) {return 1;}
+};
+#endif
+
+
+
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/CMakeLists.txt	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/CMakeLists.txt	2008-05-21 17:57:29 UTC (rev 4050)
@@ -1,5 +1,6 @@
 subdirs(PREORDER ADM_NONE)
 subdirs(PREORDER ADM_commonUI)
+subdirs(PREORDER ADM_render)
 
 if(GTK_FOUND)
 subdirs(PREORDER ADM_GTK)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2008-05-21 17:57:29 UTC (rev 4050)
@@ -273,6 +273,7 @@
 	ADM_dialogFiltersNone_cli
 	ADM_dialogGuiNone_cli
         ADM_UICli
+        ADM_render_cli
 )
 
 IF (ADM_UI_GTK)
@@ -287,6 +288,7 @@
 		ADM_commonUI_gtk
                 ADM_toolkitGtk_gtk
                 ADM_UIGtk
+                ADM_render_gtk
                 )
 ENDIF (ADM_UI_GTK)
 
@@ -302,6 +304,7 @@
 		ADM_commonUI_qt4
 		ADM_dialogQt4_qt4
                 ADM_UIQT4
+                ADM_render_qt4
 )
 ENDIF (ADM_UI_QT4)
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -45,7 +45,7 @@
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
 #include &quot;prefs.h&quot;
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 #include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
 
 #include &quot;ADM_audiodevice/audio_out.h&quot;
@@ -2610,5 +2610,45 @@
         delete [] buffer;
         return 1;
 }
+/**
+ *      \fn UI_getPreferredRender
+ *      \brief Returns to render lib the user preferred rendering method
+ * 
+ */
+ADM_RENDER_TYPE UI_getPreferredRender(void)
+{
+  char *displ;
+  unsigned int renderI;
+  ADM_RENDER_TYPE render;
+
+#if !defined __WIN32 &amp;&amp; !defined(__APPLE__)
+        // First check if local
+        // We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
+        // in that case we do not even try to use accel
+        
+        // Win32 and Mac/Qt4 don't have DISPLAY
+        displ=getenv(&quot;DISPLAY&quot;);
+        if(!displ)
+        {
+                return RENDER_GTK;
+        }
+        if(strcmp(displ,&quot;:0&quot;) &amp;&amp; strcmp(displ,&quot;:0.0&quot;))
+        {
+                printf(&quot;Looks like remote display, no Xv :%s\n&quot;,displ);
+                return RENDER_GTK;
+        }
+#endif  
+ 
+        if(prefs-&gt;get(DEVICE_VIDEODEVICE,&amp;renderI)!=RC_OK)
+        {       
+                render=RENDER_GTK;
+        }else
+        {
+                render=(ADM_RENDER_TYPE)renderI;
+        }
+
+        return render;
+}
+
 //
 // EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gui_navigate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_navigate.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_navigate.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -32,7 +32,7 @@
 #include &quot;gui_action.hxx&quot;
 #include &quot;gtkgui.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_working.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/guiplay.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/guiplay.cpp	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/guiplay.cpp	2008-05-21 17:57:29 UTC (rev 4050)
@@ -36,7 +36,7 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
 #include &quot;gtkgui.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_render.h&quot;
+#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
 #include &quot;ADM_libraries/ADM_utilities/avidemutils.h&quot;
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-05-20 00:07:40 UTC (rev 4049)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admConfigHelper.cmake	2008-05-21 17:57:29 UTC (rev 4050)
@@ -224,6 +224,29 @@
 ENDMACRO (ADD_ADM_LIB_QT4_TARGET)
 
 
+MACRO (ADD_ADM_SHARED_LIB_CLI_TARGET _libName)
+	ADD_LIBRARY(${_libName}_cli SHARED ${ARGN})
+	ADD_TARGET_CFLAGS(${_libName}_cli &quot;-I${CMAKE_BINARY_DIR}/config/cli&quot;)
+ENDMACRO (ADD_ADM_SHARED_LIB_CLI_TARGET)
+
+
+MACRO (ADD_ADM_SHARED_LIB_GTK_TARGET _libName)
+	IF (ADM_UI_GTK)
+		ADD_LIBRARY(${_libName}_gtk SHARED ${ARGN})
+		ADD_TARGET_CFLAGS(${_libName}_gtk &quot;-I${CMAKE_BINARY_DIR}/config/gtk&quot;)
+	ENDIF (ADM_UI_GTK)
+ENDMACRO (ADD_ADM_SHARED_LIB_GTK_TARGET)
+
+
+MACRO (ADD_ADM_SHARED_LIB_QT4_TARGET _libName)
+	IF (ADM_UI_QT4)
+		ADD_LIBRARY(${_libName}_qt4 SHARED ${ARGN})
+		ADD_TARGET_CFLAGS(${_libName}_qt4 &quot;-I${CMAKE_BINARY_DIR}/config/qt4&quot;)
+	ENDIF (ADM_UI_QT4)
+ENDMACRO (ADD_ADM_SHARED_LIB_QT4_TARGET)
+
+
+
 MACRO (ADD_ADM_LIB_ALL_TARGETS _libName)
 	ADD_ADM_LIB_CLI_TARGET(${_libName} ${ARGN})
 	ADD_ADM_LIB_GTK_TARGET(${_libName} ${ARGN})
@@ -231,6 +254,13 @@
 ENDMACRO (ADD_ADM_LIB_ALL_TARGETS)
 
 
+MACRO (ADD_ADM_SHARED_LIB_ALL_TARGETS _libName)
+	ADD_ADM_SHARED_LIB_CLI_TARGET(${_libName} ${ARGN})
+	ADD_ADM_SHARED_LIB_GTK_TARGET(${_libName} ${ARGN})
+	ADD_ADM_SHARED_LIB_QT4_TARGET(${_libName} ${ARGN})
+ENDMACRO (ADD_ADM_SHARED_LIB_ALL_TARGETS)
+
+
 MACRO (ADD_TARGET_LDFLAGS _target)
 	SET(_flags)
 	APPEND_FLAGS(_flags ${ARGN})


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001306.html">[Avidemux-svn-commit] r4049 - in	branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. qt4
</A></li>
	<LI>Next message: <A HREF="001308.html">[Avidemux-svn-commit] r4051 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1307">[ date ]</a>
              <a href="thread.html#1307">[ thread ]</a>
              <a href="subject.html#1307">[ subject ]</a>
              <a href="author.html#1307">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
