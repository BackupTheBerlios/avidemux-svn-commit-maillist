<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2825 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_encoder	ADM_libraries/ADM_xvidratectl ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2825%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_codecs%20ADM_encoder%0A%09ADM_libraries/ADM_xvidratectl%20ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200702161744.l1GHi4Xw014611%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000144.html">
   <LINK REL="Next"  HREF="000146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2825 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_encoder	ADM_libraries/ADM_xvidratectl ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_commonUI</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2825%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_codecs%20ADM_encoder%0A%09ADM_libraries/ADM_xvidratectl%20ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200702161744.l1GHi4Xw014611%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2825 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_encoder	ADM_libraries/ADM_xvidratectl ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_commonUI">mean at mail.berlios.de
       </A><BR>
    <I>Fri Feb 16 18:44:04 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000144.html">[Avidemux-svn-commit] r2824 - in	branches/avidemux_2.4_branch/avidemux: ADM_libraries/ADM_libmpeg2enc	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000146.html">[Avidemux-svn-commit] r2826 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#145">[ date ]</a>
              <a href="thread.html#145">[ thread ]</a>
              <a href="subject.html#145">[ subject ]</a>
              <a href="author.html#145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-02-16 18:44:01 +0100 (Fri, 16 Feb 2007)
New Revision: 2825

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg1.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
Log:
cleanup part 2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -237,7 +237,7 @@
 	  _context-&gt;sample_aspect_ratio.den = 3;
 	}
 
-      _context-&gt;rc_max_rate_header = _settings.maxBitrate * 8;	//1800*1000;// 2400 max, 700 min
+      _context-&gt;rc_max_rate_header = _settings.maxBitrate * 1000;//1800*1000;// 2400 max, 700 min
       _context-&gt;rc_buffer_size_header = _settings.bufferSize * 8 * 1024;
       // If we don't have a maxrate, don't set buffer_size
       if (1 &amp;&amp; !_settings.override_ratecontrol)	// FIXME

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2007-02-16 17:44:01 UTC (rev 2825)
@@ -44,15 +44,15 @@
   int is_dark_masking;		// -1--1
   float qcompress;		// 0.0--1.0
   float qblur;			// 0.0--1.0
-  int minBitrate;
-  int maxBitrate;
-  int user_matrix;		// 0 normal / 1 tmpgenc / 2 anime / 3 kvcd / 4 hr-tmpgenc
-  int gop_size;			// For mpeg1/2 , 12 is good
+  uint32_t minBitrate;          // In kBits/s
+  uint32_t maxBitrate;          // In kBits/s
+  uint32_t user_matrix;		// 0 normal / 1 tmpgenc / 2 anime / 3 kvcd / 4 hr-tmpgenc
+  uint32_t gop_size;			// For mpeg1/2 , 12 is good
   uint16_t *intra_matrix;
   uint16_t *inter_matrix;
-  uint8_t interlaced;
-  uint8_t bff;			// WLA: bottom field first flag
-  uint8_t widescreen;
+  uint32_t interlaced;
+  uint32_t bff;			// WLA: bottom field first flag
+  uint32_t widescreen;          //0 4/3  1 16/9
 
   // new stuff from jakub ui
   int mb_eval;			// Replace hq 0..2
@@ -66,10 +66,10 @@
   int _NORMALIZE_AQP;		// normalize adap quantiz
 
   //
-  int use_xvid_ratecontrol;
-  int bufferSize;		// in KBYTES !!!!
-  int override_ratecontrol;
-  int dummy;
+  uint32_t use_xvid_ratecontrol;
+  uint32_t bufferSize;		// in KBYTES !!!!
+  uint32_t override_ratecontrol;
+  uint32_t dummy;
 
 } FFcodecSetting;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-02-16 17:44:01 UTC (rev 2825)
@@ -233,8 +233,8 @@
   1,
   0.5,				//         qcompress;  /* amount of qscale change between easy &amp; hard scenes (0.0-1.0)*/
   0.5,				//         qblur;      /* amount of qscale smoothing over time (0.0-1.0) */
-  (600 * 1000 &gt;&gt; 3),		// min bitrate in kB/S
-  (2200 * 1000) &gt;&gt; 3,		// max bitrate
+  600 ,   		// min bitrate in kB/S
+  2200 ,		// max bitrate
   0,				// user_matrix 0-&gt;default, 1 tmpg, 2 anim&#65533;, 3 kvcd
   12,				// Safe gop size limit
   NULL,				// inter &amp; intra matrix, will be set depending on user_matrix
@@ -294,7 +294,7 @@
   0.5,				//         qcompress;  /* amount of qscale change between easy &amp; hard scenes (0.0-1.0)*/
   0.5,				//         qblur;      /* amount of qscale smoothing over time (0.0-1.0) */
   0,				// min bitrate in kB/S
-  (8000 * 1000) &gt;&gt; 3,		// max bitrate
+  8000 ,		// max bitrate
   0,				// user_matrix 0-&gt;default, 1 tmpg, 2 anim&#65533;, 3 kvcd
   12,				// Safe gop size limit
   NULL,				// inter &amp; intra matrix, will be set depending on user_matrix
@@ -310,7 +310,7 @@
   0.5,				// spatial masking
   0,				// NAQ
   1,				// Use xvid ratecontrol
-  240,				// buffersize 240 KB for Mpeg2 /
+  224,				// buffersize 240 KB for Mpeg2 /
   0				// DUMMY        
 };
 
@@ -354,7 +354,7 @@
   0.5,				//         qcompress;  /* amount of qscale change between easy &amp; hard scenes (0.0-1.0)*/
   0.5,				//         qblur;      /* amount of qscale smoothing over time (0.0-1.0) */
   0,				// min bitrate in kB/S
-  (2400 * 1000) &gt;&gt; 3,		// max bitrate
+  2400          ,		// max bitrate
   0,				// user_matrix 0-&gt;default, 1 tmpg, 2 anim&#65533;, 3 kvcd
   12,				// Safe gop size limit
   NULL,				// inter &amp; intra matrix, will be set depending on user_matrix

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg1.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg1.cpp	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg1.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -392,7 +392,7 @@
     printf(&quot;[FFmpeg Mpeg1/2] 2pass avg bitrate %u kb/s\n&quot;,br/1000);
   }else ADM_assert(0);
  
-  printf(&quot;[FFmpeg Mpeg1/2] Max bitrate :%u\n&quot;, (_settings.maxBitrate*8)/1000);
+  printf(&quot;[FFmpeg Mpeg1/2] Max bitrate :%u\n&quot;, (_settings.maxBitrate));
   avg_bitrate = br;
   if(_param.mode==COMPRESS_2PASS)
       printf (&quot;\n ** Total size     : %lu MBytes \n&quot;, _param.finalsize);
@@ -417,8 +417,8 @@
       _codec-&gt;setLogFile (_logname);
       //_codec-&gt;setLogFile(&quot;/tmp/dummylog.txt&quot;);
       if (_settings.maxBitrate)
-	if (avg_bitrate &gt; _settings.maxBitrate)
-	  avg_bitrate = _settings.maxBitrate;
+	if (avg_bitrate &gt; _settings.maxBitrate*1000)
+	  avg_bitrate = _settings.maxBitrate*1000;
       _codec-&gt;init (avg_bitrate, _fps);
       printf (&quot;\n FF:ready to encode in 2pass (%s)\n&quot;, _logname);
       _frametogo = 0;
@@ -432,7 +432,7 @@
    
      f=_param.finalsize;
   // Checking against max bitrate
-    uint32_t maxb=_settings.maxBitrate*8;
+    uint32_t maxb=_settings.maxBitrate*1000;
 
     printf(&quot;[FFmpeg1/2] : %u kbps average, %u max\n&quot;,br/1000,maxb/1000);
     if(br&gt;maxb)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -241,12 +241,12 @@
   {
     case COMPRESS_CQ:
           qz=_param.qz;
-          br=8*_settings.maxBitrate;
+          br=_settings.maxBitrate*1000;
           _state = enc_CQ;
       break;
     case COMPRESS_CBR:
           qz=0;
-          br=8*_param.bitrate;
+          br=_param.bitrate*1000;
           _state = enc_CBR;
           break;
     case COMPRESS_2PASS:
@@ -359,7 +359,7 @@
 
   if(_param.mode==COMPRESS_2PASS)
   {
-    br=8*ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
+    br=ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
     size=_param.finalsize;
     printf(&quot;[Mpeg2enc] Final Size: %u MB, avg bitrate %u kb/s \n&quot;,size,br/1000);
   }else if(_param.mode==COMPRESS_2PASS_BITRATE)
@@ -368,17 +368,17 @@
     br=_param.avg_bitrate;
     d=_totalframe;
     d/=_fps1000;
-    d*=_param.avg_bitrate*1000;
-    d/=(8*1024*1024);
+    d*=_param.avg_bitrate*1000*1000;
+    d/=(1024*1024);
     size=(uint32_t )d;
-    br*=8;
-    printf(&quot;[Mpeg2enc]  Final Size: %u MB 2pass avg bitrate %u kb/s\n&quot;,size,br/1000);
+
+    printf(&quot;[Mpeg2enc]  Final Size: %u MB 2pass avg bitrate %u kb/s\n&quot;,size,br);
     
   }else ADM_assert(0);
 
   uint32_t maxbr;
 
-  maxbr=_settings.maxBitrate*8; // B/s
+  maxbr=_settings.maxBitrate*1000; // B/s
 
   printf(&quot;[Mpeg2enc] Max bitrate %u kbps\n&quot;,maxbr/1000);
   /* Check Max bitrate */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h	2007-02-16 17:44:01 UTC (rev 2825)
@@ -53,72 +53,55 @@
 	virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size)FORBIDDEN;
 
 };
-#if 0
-class ADM_oldXvidRc : public ADM_ratecontrol
-{
-protected:
-public:
-			ADM_oldXvidRc(uint32_t fps1000, char *logname);
-	virtual 	~ADM_oldXvidRc() ;
-	/** Maxbr &amp; minbr in kbps, vbvsize in kBytes); Default is none */
-	virtual 	uint8_t setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize);
-	virtual		uint8_t startPass1( void );
-	virtual		uint8_t logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size);
-	virtual		uint8_t startPass2( uint32_t size,uint32_t nbFrame );
-	virtual		uint8_t getQz( uint32_t *qz, ADM_rframe *type );
-	virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size);
 
-};
-#endif
-
 class ADM_newXvidRc :public ADM_ratecontrol
 {
 protected:
-			uint32_t _totalFrame;
+                        uint32_t _totalFrame;
 public:
-			ADM_newXvidRc(uint32_t fps1000, char *logname);
-	virtual 	~ADM_newXvidRc() ;
-	/** Maxbr &amp; minbr in kbps, vbvsize in kBytes); Default is none */
-	virtual 	uint8_t setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize);
-	virtual		uint8_t startPass1( void );
-	virtual		uint8_t logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size);
-	virtual		uint8_t startPass2( uint32_t size,uint32_t nbFrame );
-	virtual		uint8_t getQz( uint32_t *qz, ADM_rframe *type );
-	virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size);
-			// Used for VBV
-			uint8_t getInfo(uint32_t framenum, uint32_t *qz, uint32_t *size,ADM_rframe *type );
+                        ADM_newXvidRc(uint32_t fps1000, char *logname);
+        virtual 	~ADM_newXvidRc() ;
+                        /** Maxbr &amp; minbr in kbps, vbvsize in kBytes); Default is none */
+        virtual 	uint8_t setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize);
+        virtual		uint8_t startPass1( void );
+        virtual		uint8_t logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size);
+        virtual		uint8_t startPass2( uint32_t size,uint32_t nbFrame );
+        virtual		uint8_t getQz( uint32_t *qz, ADM_rframe *type );
+        virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size);
+                        // Used for VBV
+                        uint8_t getInfo(uint32_t framenum, uint32_t *qz, uint32_t *size,ADM_rframe *type );
 
 };
 #define AVG_LOOKUP 5
 class ADM_newXvidRcVBV :public ADM_ratecontrol
 {
 protected:
-			ADM_newXvidRc	*rc;
-			uint32_t	_minbr,_maxbr,_vbvsize;
-			ADM_pass_stat  *_stat;
-			uint32_t	*_lastSize;
-			uint32_t	_roundup;
-			uint32_t	_frame;
-			uint32_t	_vbv_fullness;
-			uint32_t	_byte_per_image;
-			double		_compr[3][AVG_LOOKUP];  
-			uint32_t   _idxI,_idxP,_idxB;
+                        ADM_newXvidRc	*rc;
+                        uint32_t	_minbr,_maxbr,_vbvsize;
+                        ADM_pass_stat  *_stat;
+                        uint32_t	*_lastSize;
+                        uint32_t	_roundup;
+                        uint32_t	_frame;
+                        uint32_t	_vbv_fullness;
+                        uint32_t	_byte_per_image;
+                        double		_compr[3][AVG_LOOKUP];  
+                        uint32_t   _idxI,_idxP,_idxB;
+                        
+                        uint8_t 	project(uint32_t framenum, uint32_t q, ADM_rframe frame);
+                        uint8_t 	checkVBV(uint32_t framenum, uint32_t q, ADM_rframe frame);
+                        float 		getRatio(uint32_t newq, uint32_t oldq, float alpha);
+                        float 		getComp(int oldbits, int qporg, int newbits, int qpused);
 			
-			uint8_t 	project(uint32_t framenum, uint32_t q, ADM_rframe frame);
-			uint8_t 	checkVBV(uint32_t framenum, uint32_t q, ADM_rframe frame);
-			float 		getRatio(uint32_t newq, uint32_t oldq, float alpha);
-			float 		getComp(int oldbits, int qporg, int newbits, int qpused);
-			
 public:
-			ADM_newXvidRcVBV(uint32_t fps1000, char *logname);
-	virtual 	~ADM_newXvidRcVBV() ;
-	/** Maxbr &amp; minbr in kbps, vbvsize in kBytes); Default is none */
-	virtual 	uint8_t setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize);
-	virtual		uint8_t startPass1( void );
-	virtual		uint8_t logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size);
-	virtual		uint8_t startPass2( uint32_t size,uint32_t nbFrame );
-	virtual		uint8_t getQz( uint32_t *qz, ADM_rframe *type );
-	virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size);
+                        ADM_newXvidRcVBV(uint32_t fps1000, char *logname);
+        virtual 	~ADM_newXvidRcVBV() ;
+        /** Maxbr &amp; minbr in kbps, vbvsize in kBytes); Default is none */
+        virtual 	uint8_t setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize);
+        virtual		uint8_t startPass1( void );
+        virtual		uint8_t logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size);
+        virtual		uint8_t startPass2( uint32_t size,uint32_t nbFrame );
+        virtual		uint8_t getQz( uint32_t *qz, ADM_rframe *type );
+        virtual		uint8_t logPass2( uint32_t qz, ADM_rframe ftype,uint32_t size);
         static          uint8_t verifyLog(const char *file,uint32_t nbFrame);
 };
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -32,7 +32,7 @@
 	rc=new ADM_newXvidRc(fps1000,logname);
 	_state=RS_IDLE; 
 	_minbr=0;
-	_maxbr=2*9*1000*1000/8; // ~ 9MB*2
+	_maxbr=2*9*1000*1000; // ~ 9MB*2
 	_vbvsize=5*224*1024;	// 1MB vbv buffer size
 	_stat=NULL;
 	_lastSize=NULL;
@@ -53,12 +53,12 @@
 }
 uint8_t ADM_newXvidRcVBV::setVBVInfo(uint32_t maxbr,uint32_t minbr, uint32_t vbvsize)
 {
-	_maxbr=maxbr;
-	_minbr=minbr;
+	_maxbr=maxbr*1000; // in b/s
+	_minbr=minbr*1000;
 	_vbvsize=vbvsize*1024;
 	printf(&quot;RC: Initializing vbv buffer \n&quot;);
-	printf(&quot;RC: with min br= %lu kbps\n&quot;,(minbr*8)/1000);
-	printf(&quot;RC:      max br= %lu kbps\n&quot;,(maxbr*8)/1000);
+	printf(&quot;RC: with min br= %lu kbps\n&quot;,(minbr)/1000);
+	printf(&quot;RC:      max br= %lu kbps\n&quot;,(maxbr)/1000);
 	printf(&quot;Rc:      VBV   = %lu kB\n&quot;,_vbvsize/1024);
 
 	return 1;
@@ -88,7 +88,7 @@
 	_roundup=(uint32_t )floor((_fps1000+500)/1000);
 	// Do so check
 	_vbv_fullness=(_vbvsize*8)/10; // Buffer starts 80% full
-	_byte_per_image=_maxbr/_roundup;
+	_byte_per_image=(_maxbr&gt;&gt;3)/_roundup;
 	_lastSize=new uint32_t[_roundup];
 	memset(_lastSize,0,_roundup*sizeof(uint32_t));
 	_frame=0;

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -1,741 +0,0 @@
-#include &lt;config.h&gt;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-#include &quot;ADM_lavcodec.h&quot;
-
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-
-
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
-#include &quot;ADM_assert.h&quot; 
-static GtkWidget	*create_dialog1 (void);
-
-				
-#define ENTRY_SET(x,y) {gtk_write_entry(WID(x),(int)conf-&gt;y);}
-#define ENTRY_GET(x,y) {localSettings.y=gtk_read_entry(WID(x));}
-
-
-#define HIST_SET(x) 	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenu_mode)), x)
-#define VAL_SET(x) 	gtk_write_entry(WID(entry_bitrate), x)
-
-static GtkWidget 	*dialog=NULL;		      
-static uint32_t 	mQ,mB,mS,mA;
-static COMPRESSION_MODE mMode;
-static FFcodecSetting localSettings;
-
-static void 		updateMode( void );
-static int 		cb_mod(GtkObject * object, gpointer user_data);
-static void 		upload(GtkWidget *dialog, FFcodecSetting *conf);
-static void 		download(GtkWidget *dialog, FFcodecSetting *conf);
-
-typedef struct bufferSize
-{
-	int num;
-	int size;
-}bufferSize;
-
-bufferSize myBuffer[3]=
-{
-	{0,40},
-	{1,112},
-	{2,224}
-};
-//____________________________________________
-
-uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming)
-{
-	
-
-	int ret;
-	FFcodecSetting *conf=(FFcodecSetting *)incoming-&gt;extraSettings;
-	ADM_assert(incoming-&gt;extraSettingsLen==sizeof(FFcodecSetting));
-	
-	gint r,b;
-
-	dialog=create_dialog1();
-	gtk_register_dialog(dialog);
-	
-	mQ=incoming-&gt;qz;
-	mB=incoming-&gt;bitrate;
-	mS=incoming-&gt;finalsize;	
-	mA=incoming-&gt;avg_bitrate;	
-	mMode=incoming-&gt;mode;
-
-	memcpy(&amp;localSettings,conf,sizeof(localSettings));
-	
-	updateMode();	
-	
-	gtk_signal_connect(GTK_OBJECT(WID(optionmenu_mode)), &quot;changed&quot;,
-                      GTK_SIGNAL_FUNC(cb_mod),                   (void *) 0);
-	
-
-	upload(dialog,conf);
-	
-	ret=0;
-	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-	{
-		int r=-1,value=-1;
-		
-		ret=1;
-		download(dialog,conf);	
-		r=getRangeInMenu(WID(optionmenu_mode));				
-		switch(r)
-			{
-				case 0:
-					incoming-&gt;mode = COMPRESS_CBR;				      
-		      			value = (uint32_t) gtk_read_entry(WID(entry_bitrate));
-					// validate against max/min bitrate
-					if( value &gt; conf-&gt;maxBitrate * 8 / 1000 ){
-                                          GUI_Info_HIG(ADM_LOG_IMPORTANT,_(&quot;Bitrate out of range&quot;),_(&quot;choosing maxBitrate instead&quot;));
-						value = conf-&gt;maxBitrate * 8 / 1000;
-					}
-					if( value &lt; conf-&gt;minBitrate * 8 / 1000 ){
-                                          GUI_Info_HIG(ADM_LOG_IMPORTANT,_(&quot;Bitrate out of range&quot;),_(&quot;choosing minBitrate instead&quot;));
-						value = conf-&gt;minBitrate * 8 / 1000;
-					}
-					// validate against some fixed values - min/maxBitrate may be also out of range
-		      			if (value &gt; 16 &amp;&amp; value &lt; 9900)
-					{
-			    			incoming-&gt;bitrate = value;
-			    			ret = 1;
-		      			}
-					break;
-				case 1:
-					incoming-&gt;mode = COMPRESS_CQ;		      			
-					value = (uint32_t) gtk_spin_button_get_value_as_int(
-								GTK_SPIN_BUTTON(WID(spinbutton_quant)));
-		      			if (value &gt;= 2 &amp;&amp; value &lt;= 32)
-					{
-			    			incoming-&gt;qz = value;
-		      			}
-		      			break;
-
-				case 2:
-		     			incoming-&gt;mode = COMPRESS_2PASS;	
-					value = (uint32_t)
-						gtk_read_entry(WID(entry_bitrate));
-        				if((value&gt;0)&amp;&amp;(value&lt;8200)) // enough for DL DVDs
-          				{
-       						incoming-&gt;finalsize=value;	
-           				}
-            				break;
-                                case 3:
-                                    incoming-&gt;mode = COMPRESS_2PASS_BITRATE;	
-                                    value = (uint32_t)gtk_read_entry(WID(entry_bitrate));
-                                    incoming-&gt;avg_bitrate=value;	
-                                    break;
-		  		default:
-		      			ADM_assert(0);
-				}
-		
-	}
-	gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-
-	return ret;
-}	
-
-
-void upload(GtkWidget *dialog, FFcodecSetting *conf)
-{
- 	gtk_option_menu_set_history (GTK_OPTION_MENU (WID(optionmenu_matrix)),conf-&gt;user_matrix);
-// 	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton1)),(float)conf-&gt;gop_size) ;
-	ENTRY_SET(entry_gopsize,gop_size);
-	
-	if(conf-&gt;interlaced)
-	{
-		if(conf-&gt;bff)
-			RADIO_SET(radiobutton_bff,1);
-		else
-			RADIO_SET(radiobutton_tff,1);			
-			
-	}
-	if(conf-&gt;widescreen)
-		RADIO_SET(radiobutton_ar169,1);			
-	gtk_write_entry(WID(entry_maxbitrate),(conf-&gt;maxBitrate*8)/1000);
-	gtk_write_entry(WID(entry_minbitrate),(conf-&gt;minBitrate*8)/1000);
-	gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(checkbutton_xvid)),conf-&gt;use_xvid_ratecontrol);
-	// Search closer 
-	int h;
-	int vbv=conf-&gt;bufferSize;
-	
-	printf(&quot;incoming vbv:%d\n&quot;,vbv);
-	if(vbv&gt;(myBuffer[2].size+myBuffer[1].size)/2) h=2;
-	else
-		if(vbv&gt;(myBuffer[1].size+myBuffer[0].size)/2) h=1;
-		else
-			h=0;
-	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenu1)),h);
-	
-}
-void download(GtkWidget *dialog, FFcodecSetting *conf)
-{
-	ENTRY_GET(entry_gopsize,gop_size);
-	conf-&gt;user_matrix=getRangeInMenu(WID(optionmenu_matrix));
-	
-	
-	
-	if(RADIO_GET(radiobutton_progr))
-	{
-		conf-&gt;interlaced=0;
-		conf-&gt;bff=0;
-	}
-	else if(RADIO_GET(radiobutton_tff))
-	{
-		conf-&gt;interlaced=1;
-		conf-&gt;bff=0;
-	}
-	else if(RADIO_GET(radiobutton_bff))
-	{
-		conf-&gt;interlaced=1;
-		conf-&gt;bff=1;
-	}
-
-	if(RADIO_GET(radiobutton_ar169))
-	{
-		conf-&gt;widescreen=1;
-	}
-	else	conf-&gt;widescreen=0;
- 	
-	conf-&gt;maxBitrate=(gtk_read_entry(WID(entry_maxbitrate))/8)*1000;
-	conf-&gt;minBitrate=(gtk_read_entry(WID(entry_minbitrate))/8)*1000;
-	conf-&gt;gop_size=(gtk_read_entry(WID(entry_gopsize)));
-	conf-&gt;use_xvid_ratecontrol=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(checkbutton_xvid)));
-	
-	conf-&gt;bufferSize=myBuffer[getRangeInMenu((WID(optionmenu1)))].size;
-}
-
-int cb_mod(GtkObject * object, gpointer user_data)
-{
-int r;
-	r=getRangeInMenu(WID(optionmenu_mode));
-	switch(r)
-	{
-		case 0: mMode=COMPRESS_CBR ;break;
-		case 1: mMode=COMPRESS_CQ ;break;
-		case 2: mMode=COMPRESS_2PASS ;break;
-                case 3: mMode=COMPRESS_2PASS_BITRATE ;break;
-	
-	}
-	updateMode();
-
-}
-
-/**
-
-*/	 
-void updateMode( void )
-{
-uint32_t b;
-		// set the right select button
- 	switch (mMode)
-	    {
-	    	case COMPRESS_CBR:
-			HIST_SET(0);			
-			b=mB;
-			VAL_SET(b);
-			gtk_widget_set_sensitive(WID(spinbutton_quant),0);
-			gtk_widget_set_sensitive(WID(entry_bitrate),1);
-			gtk_label_set_text(GTK_LABEL(WID(label3)),&quot;Bitrate (kb/s):&quot;);
-			break;
-
-		case COMPRESS_2PASS:
-			HIST_SET(2);
-			VAL_SET(mS);
-			gtk_widget_set_sensitive(WID(spinbutton_quant),0);
-			gtk_widget_set_sensitive(WID(entry_bitrate),1);
-			gtk_label_set_text(GTK_LABEL(WID(label3)),&quot;Size (MBytes):&quot;);
-			break;
-		case COMPRESS_2PASS_BITRATE:
-			HIST_SET(3);
-			VAL_SET(mA);
-			gtk_widget_set_sensitive(WID(spinbutton_quant),0);
-			gtk_widget_set_sensitive(WID(entry_bitrate),1);
-			gtk_label_set_text(GTK_LABEL(WID(label3)),&quot;Average bitrate (kb/s):&quot;);
-			break;
-
-	    	case COMPRESS_CQ:
-			HIST_SET(1);
-			gtk_widget_set_sensitive(WID(entry_bitrate),0);
-			gtk_widget_set_sensitive(WID(spinbutton_quant),1);
-			gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_quant)),(gfloat)mQ);
-			break;
-		}
-}
-
-//
-
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *vbox1;
-  GtkWidget *frame1;
-  GtkWidget *table1;
-  GtkWidget *label2;
-  GtkWidget *label3;
-  GtkWidget *label4;
-  GtkWidget *optionmenu_mode;
-  GtkWidget *menu1;
-  GtkWidget *single_pass___bitrate1;
-  GtkWidget *single_pass___quantizer1;
-  GtkWidget *two_pass__1;
-  GtkWidget *two_pass__2;
-  GtkWidget *entry_bitrate;
-  GtkObject *spinbutton_quant_adj;
-  GtkWidget *spinbutton_quant;
-  GtkWidget *label1;
-  GtkWidget *frame2;
-  GtkWidget *table2;
-  GtkWidget *label6;
-  GtkWidget *label7;
-  GtkWidget *entry_minbitrate;
-  GtkWidget *entry_maxbitrate;
-  GtkWidget *label8;
-  GtkWidget *checkbutton_xvid;
-  GtkWidget *label14;
-  GtkWidget *optionmenu1;
-  GtkWidget *menu3;
-  GtkWidget *vcd;
-  GtkWidget *svcd;
-  GtkWidget *dvd;
-  GtkWidget *label5;
-  GtkWidget *frame6;
-  GtkWidget *hbox5;
-  GtkWidget *radiobutton_progr;
-  GSList *radiobutton_progr_group = NULL;
-  GtkWidget *radiobutton_tff;
-  GtkWidget *radiobutton_bff;
-  GtkWidget *label15;
-  GtkWidget *hbox1;
-  GtkWidget *frame3;
-  GtkWidget *hbox2;
-  GtkWidget *radiobutton_ar43;
-  GSList *radiobutton_ar43_group = NULL;
-  GtkWidget *radiobutton_ar169;
-  GtkWidget *label9;
-  GtkWidget *frame4;
-  GtkWidget *optionmenu_matrix;
-  GtkWidget *menu2;
-  GtkWidget *default1;
-  GtkWidget *tmpgenc1;
-  GtkWidget *anime1;
-  GtkWidget *kvcd1;
-  GtkWidget *hrtmpgenc1;
-  GtkWidget *label10;
-  GtkWidget *hbox3;
-  GtkWidget *label11;
-  GtkWidget *entry_gopsize;
-  GtkWidget *frame5;
-  GtkWidget *hbox4;
-  GtkWidget *label13;
-  GtkWidget *label_audiosize;
-  GtkWidget *label12;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;DVD FFmpeg codec settings&quot;));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  vbox1 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
-
-  frame1 = gtk_frame_new (NULL);
-  gtk_widget_show (frame1);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame1, TRUE, TRUE, 0);
-
-  table1 = gtk_table_new (3, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_container_add (GTK_CONTAINER (frame1), table1);
-
-  label2 = gtk_label_new (_(&quot;Encoding Type&quot;));
-  gtk_widget_show (label2);
-  gtk_table_attach (GTK_TABLE (table1), label2, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
-
-  label3 = gtk_label_new (_(&quot;Target Bitrate (kb/s)   &quot;));
-  gtk_widget_show (label3);
-  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
-
-  label4 = gtk_label_new (_(&quot;Quantizer&quot;));
-  gtk_widget_show (label4);
-  gtk_table_attach (GTK_TABLE (table1), label4, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label4), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
-
-  optionmenu_mode = gtk_option_menu_new ();
-  gtk_widget_show (optionmenu_mode);
-  gtk_table_attach (GTK_TABLE (table1), optionmenu_mode, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  menu1 = gtk_menu_new ();
-
-  single_pass___bitrate1 = gtk_menu_item_new_with_mnemonic (_(&quot;Single Pass - Bitrate&quot;));
-  gtk_widget_show (single_pass___bitrate1);
-  gtk_container_add (GTK_CONTAINER (menu1), single_pass___bitrate1);
-
-  single_pass___quantizer1 = gtk_menu_item_new_with_mnemonic (_(&quot;Single Pass - Quantizer&quot;));
-  gtk_widget_show (single_pass___quantizer1);
-  gtk_container_add (GTK_CONTAINER (menu1), single_pass___quantizer1);
-
-  two_pass__1 = gtk_menu_item_new_with_mnemonic (_(&quot;Two Pass (filesize) &quot;));
-  gtk_widget_show (two_pass__1);
-  gtk_container_add (GTK_CONTAINER (menu1), two_pass__1);
-
-  two_pass__2 = gtk_menu_item_new_with_mnemonic (_(&quot;Two Pass (bitrate) &quot;));
-  gtk_widget_show (two_pass__2);
-  gtk_container_add (GTK_CONTAINER (menu1), two_pass__2);
-
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenu_mode), menu1);
-
-  entry_bitrate = gtk_entry_new ();
-  gtk_widget_show (entry_bitrate);
-  gtk_table_attach (GTK_TABLE (table1), entry_bitrate, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  spinbutton_quant_adj = gtk_adjustment_new (2, 2, 32, 1, 10, 10);
-  spinbutton_quant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton_quant_adj), 1, 0);
-  gtk_widget_show (spinbutton_quant);
-  gtk_table_attach (GTK_TABLE (table1), spinbutton_quant, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbutton_quant), TRUE);
-
-  label1 = gtk_label_new (_(&quot;&lt;b&gt;Encoding mode &lt;/b&gt;&quot;));
-  gtk_widget_show (label1);
-  gtk_frame_set_label_widget (GTK_FRAME (frame1), label1);
-  gtk_label_set_use_markup (GTK_LABEL (label1), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  frame2 = gtk_frame_new (NULL);
-  gtk_widget_show (frame2);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame2, TRUE, TRUE, 0);
-
-  table2 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table2);
-  gtk_container_add (GTK_CONTAINER (frame2), table2);
-
-  label6 = gtk_label_new (_(&quot;Minimum Bitrate (kb/s) &quot;));
-  gtk_widget_show (label6);
-  gtk_table_attach (GTK_TABLE (table2), label6, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label6), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label6), 0, 0.5);
-
-  label7 = gtk_label_new (_(&quot;Maximum Bitrate (kb/s)&quot;));
-  gtk_widget_show (label7);
-  gtk_table_attach (GTK_TABLE (table2), label7, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label7), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label7), 0, 0.5);
-
-  entry_minbitrate = gtk_entry_new ();
-  gtk_widget_show (entry_minbitrate);
-  gtk_table_attach (GTK_TABLE (table2), entry_minbitrate, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  entry_maxbitrate = gtk_entry_new ();
-  gtk_widget_show (entry_maxbitrate);
-  gtk_table_attach (GTK_TABLE (table2), entry_maxbitrate, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  label8 = gtk_label_new (_(&quot;Use Xvid Ratecontrol&quot;));
-  gtk_widget_show (label8);
-  gtk_table_attach (GTK_TABLE (table2), label8, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label8), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label8), 0, 0.5);
-
-  checkbutton_xvid = gtk_check_button_new_with_mnemonic (&quot;&quot;);
-  gtk_widget_show (checkbutton_xvid);
-  gtk_table_attach (GTK_TABLE (table2), checkbutton_xvid, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  label14 = gtk_label_new (_(&quot;VBV buffer size&quot;));
-  gtk_widget_show (label14);
-  gtk_table_attach (GTK_TABLE (table2), label14, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label14), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label14), 0, 0.5);
-
-  optionmenu1 = gtk_option_menu_new ();
-  gtk_widget_show (optionmenu1);
-  gtk_table_attach (GTK_TABLE (table2), optionmenu1, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  menu3 = gtk_menu_new ();
-
-  vcd = gtk_menu_item_new_with_mnemonic (_(&quot;VCD: 40 kB&quot;));
-  gtk_widget_show (vcd);
-  gtk_container_add (GTK_CONTAINER (menu3), vcd);
-
-  svcd = gtk_menu_item_new_with_mnemonic (_(&quot;SVCD: 112 kB&quot;));
-  gtk_widget_show (svcd);
-  gtk_container_add (GTK_CONTAINER (menu3), svcd);
-
-  dvd = gtk_menu_item_new_with_mnemonic (_(&quot;DVD: 224 kB&quot;));
-  gtk_widget_show (dvd);
-  gtk_container_add (GTK_CONTAINER (menu3), dvd);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenu1), menu3);
-
-  label5 = gtk_label_new (_(&quot;&lt;b&gt;RateControl&lt;/b&gt;&quot;));
-  gtk_widget_show (label5);
-  gtk_frame_set_label_widget (GTK_FRAME (frame2), label5);
-  gtk_label_set_use_markup (GTK_LABEL (label5), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label5), GTK_JUSTIFY_LEFT);
-
-  frame6 = gtk_frame_new (NULL);
-  gtk_widget_show (frame6);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame6, TRUE, TRUE, 0);
-
-  hbox5 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox5);
-  gtk_container_add (GTK_CONTAINER (frame6), hbox5);
-
-  radiobutton_progr = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;Progressive&quot;));
-  gtk_widget_show (radiobutton_progr);
-  gtk_box_pack_start (GTK_BOX (hbox5), radiobutton_progr, FALSE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobutton_progr), radiobutton_progr_group);
-  radiobutton_progr_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobutton_progr));
-
-  radiobutton_tff = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;Interlaced TFF&quot;));
-  gtk_widget_show (radiobutton_tff);
-  gtk_box_pack_start (GTK_BOX (hbox5), radiobutton_tff, FALSE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobutton_tff), radiobutton_progr_group);
-  radiobutton_progr_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobutton_tff));
-
-  radiobutton_bff = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;Interlaced BFF&quot;));
-  gtk_widget_show (radiobutton_bff);
-  gtk_box_pack_start (GTK_BOX (hbox5), radiobutton_bff, FALSE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobutton_bff), radiobutton_progr_group);
-  radiobutton_progr_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobutton_bff));
-
-  label15 = gtk_label_new (_(&quot;&lt;b&gt;Interlacing&lt;/b&gt;&quot;));
-  gtk_widget_show (label15);
-  gtk_frame_set_label_widget (GTK_FRAME (frame6), label15);
-  gtk_label_set_use_markup (GTK_LABEL (label15), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label15), GTK_JUSTIFY_LEFT);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_box_pack_start (GTK_BOX (vbox1), hbox1, TRUE, TRUE, 0);
-
-  frame3 = gtk_frame_new (NULL);
-  gtk_widget_show (frame3);
-  gtk_box_pack_start (GTK_BOX (hbox1), frame3, TRUE, TRUE, 0);
-
-  hbox2 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox2);
-  gtk_container_add (GTK_CONTAINER (frame3), hbox2);
-
-  radiobutton_ar43 = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;4:3&quot;));
-  gtk_widget_show (radiobutton_ar43);
-  gtk_box_pack_start (GTK_BOX (hbox2), radiobutton_ar43, TRUE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobutton_ar43), radiobutton_ar43_group);
-  radiobutton_ar43_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobutton_ar43));
-
-  radiobutton_ar169 = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;16:9&quot;));
-  gtk_widget_show (radiobutton_ar169);
-  gtk_box_pack_start (GTK_BOX (hbox2), radiobutton_ar169, TRUE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobutton_ar169), radiobutton_ar43_group);
-  radiobutton_ar43_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobutton_ar169));
-
-  label9 = gtk_label_new (_(&quot;&lt;b&gt;Aspect Ratio&lt;/b&gt;&quot;));
-  gtk_widget_show (label9);
-  gtk_frame_set_label_widget (GTK_FRAME (frame3), label9);
-  gtk_label_set_use_markup (GTK_LABEL (label9), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label9), GTK_JUSTIFY_LEFT);
-
-  frame4 = gtk_frame_new (NULL);
-  gtk_widget_show (frame4);
-  gtk_box_pack_start (GTK_BOX (hbox1), frame4, TRUE, TRUE, 0);
-
-  optionmenu_matrix = gtk_option_menu_new ();
-  gtk_widget_show (optionmenu_matrix);
-  gtk_container_add (GTK_CONTAINER (frame4), optionmenu_matrix);
-
-  menu2 = gtk_menu_new ();
-
-  default1 = gtk_menu_item_new_with_mnemonic (_(&quot;Default&quot;));
-  gtk_widget_show (default1);
-  gtk_container_add (GTK_CONTAINER (menu2), default1);
-
-  tmpgenc1 = gtk_menu_item_new_with_mnemonic (_(&quot;Tmpgenc&quot;));
-  gtk_widget_show (tmpgenc1);
-  gtk_container_add (GTK_CONTAINER (menu2), tmpgenc1);
-
-  anime1 = gtk_menu_item_new_with_mnemonic (_(&quot;Anime&quot;));
-  gtk_widget_show (anime1);
-  gtk_container_add (GTK_CONTAINER (menu2), anime1);
-
-  kvcd1 = gtk_menu_item_new_with_mnemonic (_(&quot;KVCD&quot;));
-  gtk_widget_show (kvcd1);
-  gtk_container_add (GTK_CONTAINER (menu2), kvcd1);
-
-  hrtmpgenc1 = gtk_menu_item_new_with_mnemonic (_(&quot;HR-Tmpgenc&quot;));
-  gtk_widget_show (hrtmpgenc1);
-  gtk_container_add (GTK_CONTAINER (menu2), hrtmpgenc1);
-  
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenu_matrix), menu2);
-
-  label10 = gtk_label_new (_(&quot;&lt;b&gt;Matrices&lt;/b&gt;&quot;));
-  gtk_widget_show (label10);
-  gtk_frame_set_label_widget (GTK_FRAME (frame4), label10);
-  gtk_label_set_use_markup (GTK_LABEL (label10), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label10), GTK_JUSTIFY_LEFT);
-
-  hbox3 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox3);
-  gtk_box_pack_start (GTK_BOX (vbox1), hbox3, FALSE, FALSE, 0);
-
-  label11 = gtk_label_new (_(&quot;Gop Size:&quot;));
-  gtk_widget_show (label11);
-  gtk_box_pack_start (GTK_BOX (hbox3), label11, TRUE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label11), GTK_JUSTIFY_LEFT);
-
-  entry_gopsize = gtk_entry_new ();
-  gtk_widget_show (entry_gopsize);
-  gtk_box_pack_start (GTK_BOX (hbox3), entry_gopsize, TRUE, TRUE, 0);
-
-  frame5 = gtk_frame_new (NULL);
-  gtk_widget_show (frame5);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame5, FALSE, FALSE, 0);
-
-  hbox4 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox4);
-  gtk_container_add (GTK_CONTAINER (frame5), hbox4);
-
-  label13 = gtk_label_new (_(&quot;For info, size is : &quot;));
-  gtk_widget_show (label13);
-  gtk_box_pack_start (GTK_BOX (hbox4), label13, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label13), GTK_JUSTIFY_LEFT);
-
-  label_audiosize = gtk_label_new (_(&quot;0&quot;));
-  gtk_widget_show (label_audiosize);
-  gtk_box_pack_start (GTK_BOX (hbox4), label_audiosize, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label_audiosize), GTK_JUSTIFY_LEFT);
-
-  label12 = gtk_label_new (_(&quot;&lt;b&gt;Indicative audio size&lt;/b&gt;&quot;));
-  gtk_widget_show (label12);
-  gtk_frame_set_label_widget (GTK_FRAME (frame5), label12);
-  gtk_label_set_use_markup (GTK_LABEL (label12), TRUE);
-  gtk_label_set_justify (GTK_LABEL (label12), GTK_JUSTIFY_LEFT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, vbox1, &quot;vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame1, &quot;frame1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenu_mode, &quot;optionmenu_mode&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, menu1, &quot;menu1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, single_pass___bitrate1, &quot;single_pass___bitrate1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, single_pass___quantizer1, &quot;single_pass___quantizer1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, two_pass__1, &quot;two_pass__1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entry_bitrate, &quot;entry_bitrate&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbutton_quant, &quot;spinbutton_quant&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame2, &quot;frame2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table2, &quot;table2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label6, &quot;label6&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label7, &quot;label7&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entry_minbitrate, &quot;entry_minbitrate&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entry_maxbitrate, &quot;entry_maxbitrate&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label8, &quot;label8&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, checkbutton_xvid, &quot;checkbutton_xvid&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label14, &quot;label14&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenu1, &quot;optionmenu1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, menu3, &quot;menu3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, vcd, &quot;vcd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, svcd, &quot;svcd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, dvd, &quot;dvd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label5, &quot;label5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame6, &quot;frame6&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox5, &quot;hbox5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, radiobutton_progr, &quot;radiobutton_progr&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, radiobutton_tff, &quot;radiobutton_tff&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, radiobutton_bff, &quot;radiobutton_bff&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label15, &quot;label15&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, &quot;hbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame3, &quot;frame3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox2, &quot;hbox2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, radiobutton_ar43, &quot;radiobutton_ar43&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, radiobutton_ar169, &quot;radiobutton_ar169&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label9, &quot;label9&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame4, &quot;frame4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenu_matrix, &quot;optionmenu_matrix&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, menu2, &quot;menu2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, default1, &quot;default1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, tmpgenc1, &quot;tmpgenc1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, anime1, &quot;anime1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, kvcd1, &quot;kvcd1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hrtmpgenc1, &quot;hrtmpgenc1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label10, &quot;label10&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox3, &quot;hbox3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label11, &quot;label11&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entry_gopsize, &quot;entry_gopsize&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame5, &quot;frame5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox4, &quot;hbox4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label13, &quot;label13&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label_audiosize, &quot;label_audiosize&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label12, &quot;label12&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-02-16 17:44:01 UTC (rev 2825)
@@ -16,7 +16,7 @@
 	DIA_xvid.cpp DIA_crop.cpp DIA_color.cpp DIA_encoding.cpp  DIA_prefs.cpp \
 	DIA_requant.cpp DIA_xvid4.cpp DIA_lavcodec.cpp \
 	DIA_pause.cpp \
-	DIA_DVDff.cpp DIA_lavdecoder.cpp DIA_calculator.cpp DIA_equalizer.cpp \
+	DIA_lavdecoder.cpp DIA_calculator.cpp DIA_equalizer.cpp \
 	DIA_vobsub.cpp DIA_x264.cpp DIA_ocr.cpp  DIA_hue.cpp DIA_eq2.cpp \
 	DIA_asharp.cpp  DIA_idx_pg.cpp DIA_gototime.cpp \
 	DIA_audioTrack.cpp DIA_cnr2.cpp DIA_jobs.cpp DIA_jobs_save.cpp  \
@@ -39,7 +39,7 @@
 EXTRA_DIST =  \
 DIA_mcdeint.cpp     DIA_resize.cpp \
 DIA_cnr2.cpp          DIA_mjpeg.cpp       \
-DIA_DVDff.cpp        DIA_color.cpp         DIA_eq2.cpp          \
+DIA_color.cpp         DIA_eq2.cpp          \
 DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp    DIA_rotate.cpp \
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
 DIA_about.cpp        DIA_tdeint.cpp \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp (from rev 2818, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_DVDff.cpp	2007-02-13 19:16:54 UTC (rev 2818)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp	2007-02-16 17:44:01 UTC (rev 2825)
@@ -0,0 +1,106 @@
+/*
+    Dialog for lavcodec based Mpeg1/mpeg2 codec
+
+
+*/
+#include &lt;config.h&gt;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+
+
+#include &quot;ADM_lavcodec.h&quot;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_codecs/ADM_codec.h&quot;
+#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_assert.h&quot; 
+
+#warning FIXME Old : MaxBitrate in Byte/s, new entry in kb/s
+#warning FIXME Old : MaxBitrate in Byte/s, new entry in kb/s
+#warning FIXME Old : MaxBitrate in Byte/s, new entry in kb/s
+#warning FIXME Old : MaxBitrate in Byte/s new entry in kb/s
+#warning FIXME Old : MaxBitrate in Byte/s new entry in kb/s
+#warning FIXME Old : MaxBitrate in Byte/s new entry in kb/s
+
+
+
+#include &quot;ADM_codecs/ADM_codec.h&quot;
+#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+#include &quot;ADM_assert.h&quot; 
+#include &quot;DIA_factory.h&quot;
+#include &quot;../../ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
+
+/**
+      \fn DIA_DVDffParam
+      \brief Dialog to set encoding options for SVCD/DVD lavcodec based
+*/
+//____________________________________________
+
+uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming)
+{
+	
+
+	int ret;
+	FFcodecSetting *conf=(FFcodecSetting *)incoming-&gt;extraSettings;
+	ADM_assert(incoming-&gt;extraSettingsLen==sizeof(FFcodecSetting));
+
+diaMenuEntry wideM[]={
+  {0,_(&quot;4:3&quot;)},
+  {1,_(&quot;16:9&quot;)}};
+diaMenuEntry matrixM[]={
+  {0,_(&quot;Default&quot;)},
+  {1,_(&quot;Tmpgenc&quot;)},
+  {2,_(&quot;Anime&quot;)},
+  {3,_(&quot;KVCD&quot;)}
+};
+diaMenuEntry interM[]={
+  {0,_(&quot;Progressive&quot;)},
+  {1,_(&quot;Int. TFF&quot;)},
+  {2,_(&quot;Int. BFF&quot;)}
+};
+diaMenuEntry vbvM[3]=
+{
+	{40,&quot;VCD 40 KB&quot;},
+	{112,&quot;SVCD 112 kB&quot;},
+	{224,&quot;DVD 224 KB&quot;}
+};
+
+                      
+         diaElemBitrate bitrate(incoming,NULL);
+         diaElemUInteger maxb(&amp;(conf-&gt;maxBitrate),_(&quot;Max Bitrate&quot;),100,9000);
+         diaElemUInteger minb(&amp;(conf-&gt;minBitrate),_(&quot;Min Bitrate&quot;),0,9000);
+         diaElemToggle    xvid(&amp;(conf-&gt;use_xvid_ratecontrol),_(&quot;Use Xvid Rate Control&quot;));
+         
+         diaElemMenu      vbv(&amp;(conf-&gt;bufferSize),_(&quot;Buffer Size&quot;),3,vbvM);
+         
+         diaElemMenu      widescreen(&amp;(conf-&gt;widescreen),_(&quot;Aspect Ratio&quot;),2,wideM);
+         diaElemMenu      matrix(&amp;(conf-&gt;user_matrix),_(&quot;Matrices&quot;),4,matrixM);
+         diaElemUInteger  gop(&amp;(conf-&gt;gop_size),_(&quot;Gop Size&quot;),1,30);
+         
+uint32_t inter;
+          if(!conf-&gt;interlaced) inter=0;
+            else if(conf-&gt;bff) inter=2;
+                else inter=1;
+         diaElemMenu      interW(&amp;inter,_(&quot;Interlacing&quot;),3,interM);
+  
+      diaElem *elems[9]={&amp;bitrate,&amp;maxb,&amp;minb,&amp;xvid,&amp;vbv,&amp;widescreen,&amp;interW,&amp;matrix,&amp;gop};
+    
+  if( diaFactoryRun(&quot;Mpeg2 Encoding&quot;,9,elems))
+  {
+    switch(inter)
+    {
+      case 0: conf-&gt;interlaced=0;conf-&gt;bff=0;break;
+      case 1: conf-&gt;interlaced=1;conf-&gt;bff=0;break;
+      case 2: conf-&gt;interlaced=1;conf-&gt;bff=1;break;
+      default: ADM_assert(0);
+    }
+    return 1;
+  }
+  return 0;
+}	
+// EOF
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-02-15 08:00:13 UTC (rev 2824)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-02-16 17:44:01 UTC (rev 2825)
@@ -2,10 +2,10 @@
 libADM_CommonUI_a_METASOURCES = AUTO
 libADM_CommonUI_a_SOURCES = GUI_sdlRender.cpp  GUI_xvRender.cpp  \
 DIA_resizeWiz.cpp DIA_builtin.cpp DIA_postproc.cpp DIA_enter.cpp \
-DIA_audioconfig.cpp GUI_render.cpp DIA_SVCD.cpp
+DIA_audioconfig.cpp GUI_render.cpp DIA_SVCD.cpp DIA_DVDff.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
 		-I./../../ADM_libraries/ADM_utilities \
-		-I./../ADM_commonUI -I../.... -I../..../ADM_libraries/ADM_lavutil \
+		-I./../ADM_commonUI -I../../.. -I./../../ADM_libraries/ADM_lavutil \
 		-I./../../ADM_inputs -I../..../ADM_outputs -I../../ADM_ocr


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000144.html">[Avidemux-svn-commit] r2824 - in	branches/avidemux_2.4_branch/avidemux: ADM_libraries/ADM_libmpeg2enc	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000146.html">[Avidemux-svn-commit] r2826 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#145">[ date ]</a>
              <a href="thread.html#145">[ thread ]</a>
              <a href="subject.html#145">[ subject ]</a>
              <a href="author.html#145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
