<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2809 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2809%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200702101035.l1AAZpZK026931%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000133.html">
   <LINK REL="Next"  HREF="000135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2809 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2809%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200702101035.l1AAZpZK026931%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2809 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Sat Feb 10 11:35:51 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000133.html">[Avidemux-svn-commit] r2808 - in branches/avidemux_2.4_branch:	autononreg/dialogFactory avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000135.html">[Avidemux-svn-commit] r2810 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#134">[ date ]</a>
              <a href="thread.html#134">[ thread ]</a>
              <a href="subject.html#134">[ subject ]</a>
              <a href="author.html#134">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-02-10 11:35:49 +0100 (Sat, 10 Feb 2007)
New Revision: 2809

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAss_Params.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ass.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAss_Params.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDenoise.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
dialogFactoy-cation of Ass

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ass.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ass.cpp	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ass.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -1,262 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;config.h&gt;
-
-
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
-# include &lt;math.h&gt;
-
-#include &quot;default.h&quot;
-#ifdef USE_FREETYPE
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_toolkit/filesel.h&quot;
-
-#include &quot;ADM_video/ADM_vidAss_Params.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-#define SPIN_GETI(x,y){param-&gt;y=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;}
-#define SPIN_GET(x,y){param-&gt;y=gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(x))) ;}
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)param-&gt;y) ;}
-#define ASSOCIATE(x,y)   gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),y)
-
-#define   LOADSUB 17   
-     
-static GtkWidget *    create_dialog1 (void);
-uint8_t DIA_ass(ASSParams *param)
-{
-  uint8_t r=0;
-  GtkWidget *dialog=create_dialog1();
-  gtk_register_dialog(dialog);
-  
-  SPIN_SET(spinbuttonScale,font_scale);
-  SPIN_SET(spinbuttonSpacing,line_spacing); 
-  SPIN_SET(spinbuttonTop,top_margin);
-  SPIN_SET(spinbuttonBottom,bottom_margin);
-  if(param-&gt;subfile)
-  {
-    int r;
-    char *s=(char *)(param-&gt;subfile);
-    gtk_editable_delete_text(GTK_EDITABLE(WID(entrySub)), 0,-1);
-    gtk_editable_insert_text(GTK_EDITABLE(WID(entrySub)), s, strlen(s), &amp;r);
-  }
-  ASSOCIATE(button1,LOADSUB);
-  /* Upload */
-  int x=0,d;
-  while(!x)
-  {
-      d=gtk_dialog_run(GTK_DIALOG(dialog));
-      switch(d)
-      {
-        case LOADSUB:
-          {
-            char *name=NULL;
-            GUI_FileSelRead(&quot;Select ASS/SSA file&quot;,&amp;name);
-            if(name)
-            {
-                int r;
-                gtk_editable_delete_text(GTK_EDITABLE(WID(entrySub)), 0,-1);
-                gtk_editable_insert_text(GTK_EDITABLE(WID(entrySub)), name, strlen(name), &amp;r);
-                ADM_dealloc(name);
-            }
-          }
-            break;
-        case GTK_RESPONSE_OK:
-        case GTK_RESPONSE_APPLY:
-              {
-                SPIN_GET(spinbuttonScale,font_scale);
-                SPIN_GET(spinbuttonSpacing,line_spacing); 
-                SPIN_GETI(spinbuttonTop,top_margin);
-                SPIN_GETI(spinbuttonBottom,bottom_margin);
-                char *n;
-                if(param-&gt;subfile)
-                {
-                  ADM_dealloc(param-&gt;subfile);
-                  param-&gt;subfile=NULL;
-                }
-                n=gtk_editable_get_chars(GTK_EDITABLE (WID(entrySub)), 0, -1);
-                printf(&quot;Name :%s\n&quot;,n);
-                param-&gt;subfile=(ADM_filename *)ADM_strdup(n);
-                r=1;
-                x=1;
-                break;
-              }
-        default:
-                r=0;
-                x=1;
-                break;
-      }
-  }
-  gtk_unregister_dialog(dialog);
-  gtk_widget_destroy(dialog);
-  return r; 
-}
-
-GtkWidget *    create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *table1;
-  GtkWidget *label1;
-  GtkWidget *label2;
-  GtkWidget *label3;
-  GtkWidget *label4;
-  GtkWidget *label5;
-  GtkWidget *hbox1;
-  GtkWidget *entrySub;
-  GtkWidget *button1;
-  GtkObject *spinbuttonScale_adj;
-  GtkWidget *spinbuttonScale;
-  GtkObject *spinbuttonSpacing_adj;
-  GtkWidget *spinbuttonSpacing;
-  GtkObject *spinbuttonTop_adj;
-  GtkWidget *spinbuttonTop;
-  GtkObject *spinbuttonBottom_adj;
-  GtkWidget *spinbuttonBottom;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;ASS/SSA Subtitle&quot;));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  table1 = gtk_table_new (5, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), table1, TRUE, TRUE, 0);
-
-  label1 = gtk_label_new (_(&quot;Subtitle file (ass/ssa) :&quot;));
-  gtk_widget_show (label1);
-  gtk_table_attach (GTK_TABLE (table1), label1, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label1), 0, 0.5);
-
-  label2 = gtk_label_new (_(&quot;Font scale :&quot;));
-  gtk_widget_show (label2);
-  gtk_table_attach (GTK_TABLE (table1), label2, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
-
-  label3 = gtk_label_new (_(&quot;Line spacing&quot;));
-  gtk_widget_show (label3);
-  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
-
-  label4 = gtk_label_new (_(&quot;Top margin&quot;));
-  gtk_widget_show (label4);
-  gtk_table_attach (GTK_TABLE (table1), label4, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
-
-  label5 = gtk_label_new (_(&quot;Bottom margin&quot;));
-  gtk_widget_show (label5);
-  gtk_table_attach (GTK_TABLE (table1), label5, 0, 1, 4, 5,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label5), 0, 0.5);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_table_attach (GTK_TABLE (table1), hbox1, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  entrySub = gtk_entry_new ();
-  gtk_widget_show (entrySub);
-  gtk_box_pack_start (GTK_BOX (hbox1), entrySub, TRUE, TRUE, 0);
-
-  button1 = gtk_button_new_from_stock (&quot;gtk-open&quot;);
-  gtk_widget_show (button1);
-  gtk_box_pack_start (GTK_BOX (hbox1), button1, FALSE, FALSE, 0);
-
-  spinbuttonScale_adj = gtk_adjustment_new (1, 0.10000000149, 10, 1, 1, 1);
-  spinbuttonScale = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonScale_adj), 1, 2);
-  gtk_widget_show (spinbuttonScale);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonScale, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonScale), TRUE);
-
-  spinbuttonSpacing_adj = gtk_adjustment_new (1, 0.10000000149, 10, 1, 1, 1);
-  spinbuttonSpacing = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonSpacing_adj), 1, 2);
-  gtk_widget_show (spinbuttonSpacing);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonSpacing, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonSpacing), TRUE);
-
-  spinbuttonTop_adj = gtk_adjustment_new (0, 0, 200, 1, 10, 10);
-  spinbuttonTop = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTop_adj), 1, 0);
-  gtk_widget_show (spinbuttonTop);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTop, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTop), TRUE);
-
-  spinbuttonBottom_adj = gtk_adjustment_new (0, 0, 200, 1, 10, 10);
-  spinbuttonBottom = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBottom_adj), 1, 0);
-  gtk_widget_show (spinbuttonBottom);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonBottom, 1, 2, 4, 5,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonBottom), TRUE);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label5, &quot;label5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, &quot;hbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entrySub, &quot;entrySub&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, button1, &quot;button1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonScale, &quot;spinbuttonScale&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonSpacing, &quot;spinbuttonSpacing&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTop, &quot;spinbuttonTop&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBottom, &quot;spinbuttonBottom&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-
-  return dialog1;
-}
-
-
-
-#endif /* USE_FREETYPE */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-02-10 10:35:49 UTC (rev 2809)
@@ -31,7 +31,7 @@
 	DIA_quota.cpp \
 	DIA_animated.cpp \
 	DIA_partial.cpp \
-	DIA_ass.cpp DIA_bitrateHisto.cpp
+	DIA_bitrateHisto.cpp
 
 
 
@@ -54,6 +54,6 @@
 DIA_busy.cpp         DIA_properties.cpp  DIA_xvid.cpp \
 DIA_busy.h           DIA_lavcodec.cpp     DIA_quota.cpp       DIA_xvid4.cpp \
 DIA_calculator.cpp   DIA_encoding.cpp      DIA_lavdecoder.cpp   DIA_recent.cpp \
-DIA_chromaShift.cpp  DIA_encoding.h        DIA_lavpp_deint.cpp  DIA_requant.cpp DIA_ass.cpp
+DIA_chromaShift.cpp  DIA_encoding.h        DIA_lavpp_deint.cpp  DIA_requant.cpp 
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -80,10 +80,6 @@
 		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
 #endif
 uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
-#ifdef USE_FREETYPE
-#include &quot;ADM_video/ADM_vidAss_Params.h&quot;
-uint8_t DIA_ass(ASSParams *param){return 0;}
-#endif
 uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -80,10 +80,6 @@
 		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
 #endif
 uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
-#ifdef USE_FREETYPE
-#include &quot;ADM_video/ADM_vidAss_Params.h&quot;
-uint8_t DIA_ass(ASSParams *param){return 0;}
-#endif
 uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -1,350 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-/*
-  Initial port from MPlayer by Moonz
-
-*/
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &quot;ADM_assert.h&quot;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidCommonFilter.h&quot;
-#include &quot;ADM_video/ADM_vidASS.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include &quot;ADM_colorspace/ADM_rgb.h&quot;
-
-#ifdef USE_FREETYPE
-
-#ifndef DIR_SEP
-# ifdef WIN32
-#   define DIR_SEP '\\'
-# else
-#   define DIR_SEP '/'
-# endif
-#endif
-
-static FILTER_PARAM assParam={7,
-        { /* float */ &quot;font_scale&quot;,
-          /*float*/ &quot;line_spacing&quot;,
-          /* int */ &quot;top_margin&quot;,
-          /* int */ &quot;bottom_margin&quot;,
-          /* bool */ &quot;extract_embedded_fonts&quot;,
-          /* ADM_filename */ &quot;fonts_dir&quot;,
-          /* ADM_filename */ &quot;subfile&quot; }};
-
-SCRIPT_CREATE(ass_script,ADMVideoSubASS,assParam);
-BUILD_CREATE(ass_create,ADMVideoSubASS);
-
-char *ADMVideoSubASS::printConf() 
-{
-      static char buf[50];
-      sprintf((char *)buf,&quot; ASS/SSA Subtitles: &quot;);
-      
-      char *filename = (char*)_params-&gt;subfile;
-      if(filename)
-      {
-          if(strrchr(filename, DIR_SEP) != NULL &amp;&amp; *(strrchr(filename, DIR_SEP) + 1) != 0)
-              filename = strrchr(filename, DIR_SEP) + 1;
-          strncat(buf, filename, 49-strlen(buf));
-          buf[49] = 0;
-      }else
-      {
-        strcat(buf,&quot; (no sub)&quot;);       
-      }
-      return buf;
-}
-
-//_______________________________________________________________
-
-ADMVideoSubASS::ADMVideoSubASS(AVDMGenericVideoStream *in, CONFcouple *conf) 
-{
-        _in=in;		
-        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-        _params = new ASSParams;
-        ADM_assert(_params);
-        
-        
-        if(conf) {
-                #define _COUPLE_GET(x) conf-&gt;getCouple(#x, &amp;(_params-&gt;x));
-                _COUPLE_GET(font_scale)
-                _COUPLE_GET(line_spacing)
-                _COUPLE_GET(top_margin)
-                _COUPLE_GET(bottom_margin)
-                _COUPLE_GET(subfile)
-                _COUPLE_GET(fonts_dir)
-                _COUPLE_GET(extract_embedded_fonts)
-        }	
-        else {
-                _params-&gt;font_scale = 1.;
-                _params-&gt;line_spacing = _params-&gt;top_margin = _params-&gt;bottom_margin = 0;
-                _params-&gt;subfile = NULL;
-                _params-&gt;fonts_dir = (ADM_filename*)ADM_alloc(6*sizeof(ADM_filename));
-                strcpy((char*)_params-&gt;fonts_dir, &quot;/tmp/&quot;);
-                _params-&gt;extract_embedded_fonts = 1;
-        }
-
-        _uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
-        ADM_assert(_uncompressed);
-        _info.encoding=1;
-
-        /* ASS initialization */
-        _ass_lib = ass_library_init();
-        _ass_track = NULL;
-        _ass_rend = NULL;
-        ADM_assert(_ass_lib);
-        if(_params-&gt;subfile)
-        {
-              if(!init())
-              {
-                GUI_Error_HIG(&quot;Format ?&quot;,&quot;Are you sure this is an ass file ?&quot;); 
-              }
-        }
-
-}
-// **********************************
-uint8_t ADMVideoSubASS::init(void)
-{
-bool use_margins = ( _params-&gt;top_margin | _params-&gt;bottom_margin ) != 0;
-
-        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-        _info.height += _params-&gt;top_margin + _params-&gt;bottom_margin;
-
-        ass_set_fonts_dir(_ass_lib, (const char*)_params-&gt;fonts_dir);
-        ass_set_extract_fonts(_ass_lib, _params-&gt;extract_embedded_fonts);
-        ass_set_style_overrides(_ass_lib, NULL);
-#if ASS_HAS_GLOBAL
-         if(_ass_rend) 
-        {
-              ass_renderer_done(_ass_rend);
-              _ass_rend = NULL;
-         }
-#endif
-        _ass_rend = ass_renderer_init(_ass_lib);
-
-        ADM_assert(_ass_rend);
- 
-        ass_set_frame_size(_ass_rend, _info.width, _info.height);
-        ass_set_margins(_ass_rend, _params-&gt;top_margin, _params-&gt;bottom_margin, 0, 0);
-        ass_set_use_margins(_ass_rend, use_margins);
-        ass_set_font_scale(_ass_rend, _params-&gt;font_scale);
-        ass_set_fonts(_ass_rend, NULL, &quot;Sans&quot;);
-        //~ ass_set_aspect_ratio(_ass_rend, ((double)_info.width) / ((double)_info.height));
-#if ASS_HAS_GLOBAL
-        if(_ass_track) 
-        {
-              ass_free_track(_ass_track);
-              _ass_track = NULL;
-        }
-#endif
-       _ass_track = ass_read_file(_ass_lib, (char*)_params-&gt;subfile, NULL);
-
-        ADM_assert(_ass_track);
-        return 1;
-} 
-
-//*******************************************
-ADMVideoSubASS::~ADMVideoSubASS() 
-{
-      if(_uncompressed) DELETE(_uncompressed);
-      
-      if(_params) 
-      {
-        DELETE(_params-&gt;subfile);
-        DELETE( _params-&gt;fonts_dir);
-        DELETE(_params);
-      }
-#if ASS_HAS_GLOBAL
-        if(_ass_rend) 
-        {
-              ass_renderer_done(_ass_rend);
-              _ass_rend = NULL;
-         }
-
-        if(_ass_track) 
-        {
-              ass_free_track(_ass_track);
-              _ass_track = NULL;
-        }
-        if(_ass_lib) 
-        {
-              ass_library_done(_ass_lib);
-              _ass_lib = NULL;
-        }
-#endif
-}
-//*******************************************
-#define _r(c)  ((c)&gt;&gt;24)
-#define _g(c)  (((c)&gt;&gt;16)&amp;0xFF)
-#define _b(c)  (((c)&gt;&gt;8)&amp;0xFF)
-#define _a(c)  ((c)&amp;0xFF)
-#define rgba2y(c)  ( (( 263*_r(c)  + 516*_g(c) + 100*_b(c)) &gt;&gt; 10) + 16  )
-#define rgba2u(c)  ( (( 450*_r(c) - 376*_g(c) -  73*_b(c)) &gt;&gt; 10) + 128 )
-#define rgba2v(c)  ( ((-152*_r(c) - 298*_g(c) + 450*_b(c)) &gt;&gt; 10) + 128 )
-
-uint8_t ADMVideoSubASS::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data, uint32_t *flags) 
-{
-        uint32_t  i, j, k, l, val;
-        uint8_t y, u, v, opacity;
-        int32_t orig_u, orig_v,klong,newu,newv;
-        uint8_t orig_y;
-        uint8_t *bitmap, *ydata, *udata, *vdata;
-
-        if(frame&gt;=_info.nb_frames)
-        {
-          printf(&quot;[SubAss] out of bound %u/%u\n&quot;,frame,_info.nb_frames); 
-        }
-        ADM_assert(_params);
-
-        int64_t  where = (int64_t)(_info.orgFrame + frame) * 1000000LL /
-                          (int64_t)_info.fps1000;
-
-        if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags))
-                return 0;
-
-        /* Add black borders top / bottom*/
-
-        uint32_t page=_info.width*_info.height;
-        uint32_t top, bottom;
-        top=_info.width * (_params-&gt;top_margin &amp;0xfffe);
-        if(top&gt;page) top=0;
-        
-        if(top)
-        {
-            memset(YPLANE(data),16,top);
-            memset(UPLANE(data),128,top&gt;&gt;2);
-            memset(VPLANE(data),128,top&gt;&gt;2);
-        }
-        memcpy(YPLANE(data) + top, YPLANE(_uncompressed),page-top);
-        memcpy(UPLANE(data) + (top&gt;&gt;2), UPLANE(_uncompressed), (page-top)&gt;&gt;2);
-        memcpy(VPLANE(data) + (top&gt;&gt;2), VPLANE(_uncompressed), (page-top)&gt;&gt;2);
-
-        // Now do bottom
-        top=_info.width * (_params-&gt;bottom_margin&amp;0xfffe);
-        if(top&gt;page) top=0;
-        if(top)
-        {
-            memset(YPLANE(data)+page-top,16,top);
-            memset(UPLANE(data)+((page-top)&gt;&gt;2),128,top&gt;&gt;2);
-            memset(VPLANE(data)+((page-top)&gt;&gt;2),128,top&gt;&gt;2);
-        }
-        // Do we have something to render ?
-        if(!_ass_rend || !_ass_track)
-        {
-          printf(&quot;[Ass] No sub to render\n&quot;);
-          return 1; 
-        }
-
-        ass_image_t *img = ass_render_frame(_ass_rend, _ass_track, where);
-        
-
-        while(img) {
-                  y = rgba2y(img-&gt;color);
-                  u = rgba2u(img-&gt;color);
-                  v = rgba2v(img-&gt;color);
-
-                  opacity = 255 - _a(img-&gt;color);
-
-                  bitmap = img-&gt;bitmap;
-
-                  uint32_t offset=img-&gt;dst_y * _info.width +img-&gt;dst_x;
-                  uint32_t offset2=(img-&gt;dst_y&gt;&gt;1) * (_info.width&gt;&gt;1)+(img-&gt;dst_x &gt;&gt; 1); 
-
-                  ydata = YPLANE(data) + offset ;
-                  udata = UPLANE(data) + offset2 ;
-                  vdata = VPLANE(data) + offset2 ;
-
-                  for(i = 0; i &lt; img-&gt;h; ++i) 
-                  {
-                          for(j = 0; j &lt; img-&gt;w; ++j) 
-                          {
-                                  k = *(bitmap+j) * opacity / 255;
-                                  orig_y = *(ydata+j);
-                                  *(ydata+j) = (k*y + (255-k)*orig_y) / 255;
-                          }
-
-                          bitmap += img-&gt;stride;
-                          ydata += _info.width;
-                  }
-
-                  bitmap = img-&gt;bitmap;
-                  
-                  newu=u-128;
-                  newv=v-128;
-
-                  for(i = 0; i &lt; img-&gt;h; i += 2) 
-                  {
-                          for(j = 0, l = 0; j &lt; img-&gt;w; j += 2, ++l) 
-                          {
-                                  val = 0;
-                                  val += *(bitmap + j);
-                                  val += *(bitmap + j + 1);
-                                  val += *(bitmap + img-&gt;stride + j);
-                                  val += *(bitmap + img-&gt;stride + j + 1);
-                                  val &gt;&gt;= 2;
-
-                                  k = val * opacity / 255;
-                                  orig_u = *(udata+l);
-                                  orig_v = *(vdata+l);
-
-                                  orig_u=( k*u+(255-k)*orig_u)/255;
-                                  orig_v=( k*v+(255-k)*orig_v)/255;
-                                  *(udata+l) = orig_u;
-                                  *(vdata+l) = orig_v;
-                          }
-
-                          bitmap += img-&gt;stride &lt;&lt; 1;
-                          udata += _info.width &gt;&gt; 1;
-                          vdata += _info.width &gt;&gt; 1;
-                  }
-
-                  img = img-&gt;next;
-        }
-
-        return 1;
-}
-
-uint8_t	ADMVideoSubASS::getCoupledConf(CONFcouple **conf) 
-{
-        *conf=new CONFcouple(7);
-
-#define _COUPLE_SET(x) (*conf)-&gt;setCouple(#x, _params-&gt;x);
-        _COUPLE_SET(font_scale)
-        _COUPLE_SET(line_spacing)
-        _COUPLE_SET(top_margin)
-        _COUPLE_SET(bottom_margin)
-        _COUPLE_SET(subfile)
-        _COUPLE_SET(fonts_dir)
-        _COUPLE_SET(extract_embedded_fonts)
-
-        return 1;
-}
-/************************************************/
-extern uint8_t DIA_ass(ASSParams *param);
-uint8_t ADMVideoSubASS::configure(AVDMGenericVideoStream *instream) 
-{
-  _in=instream;
-  if( DIA_ass(_params))
-  {
-    init();
-    return 1; 
-  }
-  return 0;
-}
-#endif /* HAVE_ENCODER */
-#endif /* USE_FREETYPE */

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.h	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.h	2007-02-10 10:35:49 UTC (rev 2809)
@@ -1,34 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef _ADM_ASS_H
-#define _ADM_ASS_H
-
-#ifdef USE_FREETYPE
-#include &quot;ADM_libass/ass.h&quot;
-
-#include &quot;ADM_vidAss_Params.h&quot; 
-class ADMVideoSubASS : public AVDMGenericVideoStream 
-{
-protected:
-        virtual char* printConf(void);
-        ASSParams* _params;
-        ass_library_t *_ass_lib;
-        ass_renderer_t *_ass_rend;
-        ass_track_t *_ass_track;
-        uint8_t init(void);
-public:
-        ADMVideoSubASS(AVDMGenericVideoStream *in, CONFcouple *conf);
-        virtual ~ADMVideoSubASS();
-        virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-        uint8_t configure(AVDMGenericVideoStream *instream);
-        uint8_t	getCoupledConf(CONFcouple **conf);
-};
-#endif /* USE_FREETYPE */
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAss_Params.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAss_Params.h	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAss_Params.h	2007-02-10 10:35:49 UTC (rev 2809)
@@ -1,12 +0,0 @@
-#ifndef ADM_VID_ASS_PARAM_H
-#define ADM_VID_ASS_PARAM_H
-
-typedef struct 
-{
-        float         font_scale, line_spacing;
-        uint32_t      top_margin, bottom_margin;
-        ADM_filename  *subfile, *fonts_dir;
-        uint32_t      extract_embedded_fonts;
-} ASSParams;
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-02-10 10:35:49 UTC (rev 2809)
@@ -49,8 +49,7 @@
  ADM_vidMPdelogo.cpp \
  ADM_vidColorYuv.cpp  \
  ADM_guiResize.cpp \
- ADM_vidAnimated.cpp \
- ADM_vidASS.cpp
+ ADM_vidAnimated.cpp 
 
 				
 
@@ -100,8 +99,7 @@
 ADM_vobsubinfo.cpp \
 ADM_vidCrop.cpp  ADM_vobsubinfo.h \
 swscale_internal.h \
-ADM_vidTdeint_util.txt ADM_vidASS.h ADM_vidASS.cpp \
-ADM_vidAss_Params.h mmx_macros.h
+ADM_vidTdeint_util.txt mmx_macros.h
 
 ####### kdevelop will overwrite this part!!! (end)############
 INCLUDES = $(all_includes) -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil \
@@ -109,4 +107,4 @@
 noinst_HEADERS = ADM_mpdetc.h \
   ADM_cache.h \
 ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h \
-ADM_vidEq2.h ADM_vidASS.h
+ADM_vidEq2.h 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp (from rev 2666, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.cpp	2006-12-29 12:11:05 UTC (rev 2666)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -0,0 +1,371 @@
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+/*
+  Initial port from MPlayer by Moonz
+
+*/
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &quot;ADM_assert.h&quot;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_video/ADM_vidCommonFilter.h&quot;
+#include &quot;ADM_vidASS.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+#include &quot;ADM_colorspace/ADM_rgb.h&quot;
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+#ifdef USE_FREETYPE
+
+#ifndef DIR_SEP
+# ifdef WIN32
+#   define DIR_SEP '\\'
+# else
+#   define DIR_SEP '/'
+# endif
+#endif
+
+static FILTER_PARAM assParam={7,
+        { /* float */ &quot;font_scale&quot;,
+          /*float*/ &quot;line_spacing&quot;,
+          /* int */ &quot;top_margin&quot;,
+          /* int */ &quot;bottom_margin&quot;,
+          /* bool */ &quot;extract_embedded_fonts&quot;,
+          /* ADM_filename */ &quot;fonts_dir&quot;,
+          /* ADM_filename */ &quot;subfile&quot; }};
+
+SCRIPT_CREATE(ass_script,ADMVideoSubASS,assParam);
+BUILD_CREATE(ass_create,ADMVideoSubASS);
+
+char *ADMVideoSubASS::printConf() 
+{
+      static char buf[50];
+      sprintf((char *)buf,&quot; ASS/SSA Subtitles: &quot;);
+      
+      char *filename = (char*)_params-&gt;subfile;
+      if(filename)
+      {
+          if(strrchr(filename, DIR_SEP) != NULL &amp;&amp; *(strrchr(filename, DIR_SEP) + 1) != 0)
+              filename = strrchr(filename, DIR_SEP) + 1;
+          strncat(buf, filename, 49-strlen(buf));
+          buf[49] = 0;
+      }else
+      {
+        strcat(buf,&quot; (no sub)&quot;);       
+      }
+      return buf;
+}
+
+
+uint8_t ADMVideoSubASS::configure(AVDMGenericVideoStream * instream)
+{
+  UNUSED_ARG(instream);
+  
+#define PX(x) &amp;(_params-&gt;x)
+#define MKME(x,y) x=(ELEM_TYPE_FLOAT)_params-&gt;y
+  ELEM_TYPE_FLOAT scale,spacing;
+  
+    MKME(scale,font_scale);
+    MKME(spacing,line_spacing);
+    
+    diaElemFileRead   file((char **)PX(subfile),_(&quot;_Subtitle file (ass/ssa)&quot;));
+    diaElemFloat      dSpacing(&amp;spacing,_(&quot;_Line spacing&quot;),0.10,10.0);
+    diaElemFloat      dScale(&amp;scale,_(&quot;_Font scale&quot;),0.10,10.0);
+    diaElemUInteger   dTop(PX(top_margin),_(&quot;_Top margin&quot;),0,200);
+    diaElemUInteger   dBottom(PX(bottom_margin),_(&quot;_Bottom margin&quot;),0,200);
+    
+       diaElem *elems[5]={&amp;file,&amp;dSpacing,&amp;dScale,&amp;dTop,&amp;dBottom};
+  
+   if( diaFactoryRun(&quot;Denoise&quot;,5,elems))
+   {
+#undef MKME
+#define MKME(x,y) _params-&gt;y=(float)x
+    MKME(scale,font_scale);
+    MKME(spacing,line_spacing);
+
+     return 1;
+   }
+   return 0;
+}
+
+//_______________________________________________________________
+
+ADMVideoSubASS::ADMVideoSubASS(AVDMGenericVideoStream *in, CONFcouple *conf) 
+{
+        _in=in;		
+        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+        _params = new ASSParams;
+        ADM_assert(_params);
+        
+        
+        if(conf) {
+                #define _COUPLE_GET(x) conf-&gt;getCouple(#x, &amp;(_params-&gt;x));
+                _COUPLE_GET(font_scale)
+                _COUPLE_GET(line_spacing)
+                _COUPLE_GET(top_margin)
+                _COUPLE_GET(bottom_margin)
+                _COUPLE_GET(subfile)
+                _COUPLE_GET(fonts_dir)
+                _COUPLE_GET(extract_embedded_fonts)
+        }	
+        else {
+                _params-&gt;font_scale = 1.;
+                _params-&gt;line_spacing = _params-&gt;top_margin = _params-&gt;bottom_margin = 0;
+                _params-&gt;subfile = NULL;
+                _params-&gt;fonts_dir = (ADM_filename*)ADM_alloc(6*sizeof(ADM_filename));
+                strcpy((char*)_params-&gt;fonts_dir, &quot;/tmp/&quot;);
+                _params-&gt;extract_embedded_fonts = 1;
+        }
+
+        _uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
+        ADM_assert(_uncompressed);
+        _info.encoding=1;
+
+        /* ASS initialization */
+        _ass_lib = ass_library_init();
+        _ass_track = NULL;
+        _ass_rend = NULL;
+        ADM_assert(_ass_lib);
+        if(_params-&gt;subfile)
+        {
+              if(!init())
+              {
+                GUI_Error_HIG(&quot;Format ?&quot;,&quot;Are you sure this is an ass file ?&quot;); 
+              }
+        }
+
+}
+// **********************************
+uint8_t ADMVideoSubASS::init(void)
+{
+bool use_margins = ( _params-&gt;top_margin | _params-&gt;bottom_margin ) != 0;
+
+        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+        _info.height += _params-&gt;top_margin + _params-&gt;bottom_margin;
+
+        ass_set_fonts_dir(_ass_lib, (const char*)_params-&gt;fonts_dir);
+        ass_set_extract_fonts(_ass_lib, _params-&gt;extract_embedded_fonts);
+        ass_set_style_overrides(_ass_lib, NULL);
+#if ASS_HAS_GLOBAL
+         if(_ass_rend) 
+        {
+              ass_renderer_done(_ass_rend);
+              _ass_rend = NULL;
+         }
+#endif
+        _ass_rend = ass_renderer_init(_ass_lib);
+
+        ADM_assert(_ass_rend);
+ 
+        ass_set_frame_size(_ass_rend, _info.width, _info.height);
+        ass_set_margins(_ass_rend, _params-&gt;top_margin, _params-&gt;bottom_margin, 0, 0);
+        ass_set_use_margins(_ass_rend, use_margins);
+        ass_set_font_scale(_ass_rend, _params-&gt;font_scale);
+        ass_set_fonts(_ass_rend, NULL, &quot;Sans&quot;);
+        //~ ass_set_aspect_ratio(_ass_rend, ((double)_info.width) / ((double)_info.height));
+#if ASS_HAS_GLOBAL
+        if(_ass_track) 
+        {
+              ass_free_track(_ass_track);
+              _ass_track = NULL;
+        }
+#endif
+       _ass_track = ass_read_file(_ass_lib, (char*)_params-&gt;subfile, NULL);
+
+        ADM_assert(_ass_track);
+        return 1;
+} 
+
+//*******************************************
+ADMVideoSubASS::~ADMVideoSubASS() 
+{
+      if(_uncompressed) DELETE(_uncompressed);
+      
+      if(_params) 
+      {
+        DELETE(_params-&gt;subfile);
+        DELETE( _params-&gt;fonts_dir);
+        DELETE(_params);
+      }
+#if ASS_HAS_GLOBAL
+        if(_ass_rend) 
+        {
+              ass_renderer_done(_ass_rend);
+              _ass_rend = NULL;
+         }
+
+        if(_ass_track) 
+        {
+              ass_free_track(_ass_track);
+              _ass_track = NULL;
+        }
+        if(_ass_lib) 
+        {
+              ass_library_done(_ass_lib);
+              _ass_lib = NULL;
+        }
+#endif
+}
+//*******************************************
+#define _r(c)  ((c)&gt;&gt;24)
+#define _g(c)  (((c)&gt;&gt;16)&amp;0xFF)
+#define _b(c)  (((c)&gt;&gt;8)&amp;0xFF)
+#define _a(c)  ((c)&amp;0xFF)
+#define rgba2y(c)  ( (( 263*_r(c)  + 516*_g(c) + 100*_b(c)) &gt;&gt; 10) + 16  )
+#define rgba2u(c)  ( (( 450*_r(c) - 376*_g(c) -  73*_b(c)) &gt;&gt; 10) + 128 )
+#define rgba2v(c)  ( ((-152*_r(c) - 298*_g(c) + 450*_b(c)) &gt;&gt; 10) + 128 )
+
+uint8_t ADMVideoSubASS::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data, uint32_t *flags) 
+{
+        uint32_t  i, j, k, l, val;
+        uint8_t y, u, v, opacity;
+        int32_t orig_u, orig_v,klong,newu,newv;
+        uint8_t orig_y;
+        uint8_t *bitmap, *ydata, *udata, *vdata;
+
+        if(frame&gt;=_info.nb_frames)
+        {
+          printf(&quot;[SubAss] out of bound %u/%u\n&quot;,frame,_info.nb_frames); 
+        }
+        ADM_assert(_params);
+
+        int64_t  where = (int64_t)(_info.orgFrame + frame) * 1000000LL /
+                          (int64_t)_info.fps1000;
+
+        if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags))
+                return 0;
+
+        /* Add black borders top / bottom*/
+
+        uint32_t page=_info.width*_info.height;
+        uint32_t top, bottom;
+        top=_info.width * (_params-&gt;top_margin &amp;0xfffe);
+        if(top&gt;page) top=0;
+        
+        if(top)
+        {
+            memset(YPLANE(data),16,top);
+            memset(UPLANE(data),128,top&gt;&gt;2);
+            memset(VPLANE(data),128,top&gt;&gt;2);
+        }
+        memcpy(YPLANE(data) + top, YPLANE(_uncompressed),page-top);
+        memcpy(UPLANE(data) + (top&gt;&gt;2), UPLANE(_uncompressed), (page-top)&gt;&gt;2);
+        memcpy(VPLANE(data) + (top&gt;&gt;2), VPLANE(_uncompressed), (page-top)&gt;&gt;2);
+
+        // Now do bottom
+        top=_info.width * (_params-&gt;bottom_margin&amp;0xfffe);
+        if(top&gt;page) top=0;
+        if(top)
+        {
+            memset(YPLANE(data)+page-top,16,top);
+            memset(UPLANE(data)+((page-top)&gt;&gt;2),128,top&gt;&gt;2);
+            memset(VPLANE(data)+((page-top)&gt;&gt;2),128,top&gt;&gt;2);
+        }
+        // Do we have something to render ?
+        if(!_ass_rend || !_ass_track)
+        {
+          printf(&quot;[Ass] No sub to render\n&quot;);
+          return 1; 
+        }
+
+        ass_image_t *img = ass_render_frame(_ass_rend, _ass_track, where);
+        
+
+        while(img) {
+                  y = rgba2y(img-&gt;color);
+                  u = rgba2u(img-&gt;color);
+                  v = rgba2v(img-&gt;color);
+
+                  opacity = 255 - _a(img-&gt;color);
+
+                  bitmap = img-&gt;bitmap;
+
+                  uint32_t offset=img-&gt;dst_y * _info.width +img-&gt;dst_x;
+                  uint32_t offset2=(img-&gt;dst_y&gt;&gt;1) * (_info.width&gt;&gt;1)+(img-&gt;dst_x &gt;&gt; 1); 
+
+                  ydata = YPLANE(data) + offset ;
+                  udata = UPLANE(data) + offset2 ;
+                  vdata = VPLANE(data) + offset2 ;
+
+                  for(i = 0; i &lt; img-&gt;h; ++i) 
+                  {
+                          for(j = 0; j &lt; img-&gt;w; ++j) 
+                          {
+                                  k = *(bitmap+j) * opacity / 255;
+                                  orig_y = *(ydata+j);
+                                  *(ydata+j) = (k*y + (255-k)*orig_y) / 255;
+                          }
+
+                          bitmap += img-&gt;stride;
+                          ydata += _info.width;
+                  }
+
+                  bitmap = img-&gt;bitmap;
+                  
+                  newu=u-128;
+                  newv=v-128;
+
+                  for(i = 0; i &lt; img-&gt;h; i += 2) 
+                  {
+                          for(j = 0, l = 0; j &lt; img-&gt;w; j += 2, ++l) 
+                          {
+                                  val = 0;
+                                  val += *(bitmap + j);
+                                  val += *(bitmap + j + 1);
+                                  val += *(bitmap + img-&gt;stride + j);
+                                  val += *(bitmap + img-&gt;stride + j + 1);
+                                  val &gt;&gt;= 2;
+
+                                  k = val * opacity / 255;
+                                  orig_u = *(udata+l);
+                                  orig_v = *(vdata+l);
+
+                                  orig_u=( k*u+(255-k)*orig_u)/255;
+                                  orig_v=( k*v+(255-k)*orig_v)/255;
+                                  *(udata+l) = orig_u;
+                                  *(vdata+l) = orig_v;
+                          }
+
+                          bitmap += img-&gt;stride &lt;&lt; 1;
+                          udata += _info.width &gt;&gt; 1;
+                          vdata += _info.width &gt;&gt; 1;
+                  }
+
+                  img = img-&gt;next;
+        }
+
+        return 1;
+}
+
+uint8_t	ADMVideoSubASS::getCoupledConf(CONFcouple **conf) 
+{
+        *conf=new CONFcouple(7);
+
+#define _COUPLE_SET(x) (*conf)-&gt;setCouple(#x, _params-&gt;x);
+        _COUPLE_SET(font_scale)
+        _COUPLE_SET(line_spacing)
+        _COUPLE_SET(top_margin)
+        _COUPLE_SET(bottom_margin)
+        _COUPLE_SET(subfile)
+        _COUPLE_SET(fonts_dir)
+        _COUPLE_SET(extract_embedded_fonts)
+
+        return 1;
+}
+/************************************************/
+#endif /* HAVE_ENCODER */
+#endif /* USE_FREETYPE */

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.h (from rev 2666, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASS.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAss_Params.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAss_Params.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDenoise.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDenoise.cpp	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDenoise.cpp	2007-02-10 10:35:49 UTC (rev 2809)
@@ -375,8 +375,6 @@
 			return 0;
 	
 }
-extern uint8_t DIA_dnr(uint32_t *llock,uint32_t *lthresh, uint32_t *clock,
-			uint32_t *cthresh, uint32_t *scene);
 
 
 uint8_t ADMVideoDenoise::configure(AVDMGenericVideoStream * instream)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-02-10 09:37:34 UTC (rev 2808)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-02-10 10:35:49 UTC (rev 2809)
@@ -7,6 +7,7 @@
 #INCLUDES = $(all_includes) 
 
 libADM_videoFilter_a_SOURCES =  \
+ ADM_vidASS.cpp \
  ADM_vidBlend.cpp \
  ADM_vidDeintASM.cpp \
  ADM_vidDecDec.cpp \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000133.html">[Avidemux-svn-commit] r2808 - in branches/avidemux_2.4_branch:	autononreg/dialogFactory avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui	avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000135.html">[Avidemux-svn-commit] r2810 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#134">[ date ]</a>
              <a href="thread.html#134">[ thread ]</a>
              <a href="subject.html#134">[ subject ]</a>
              <a href="author.html#134">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
