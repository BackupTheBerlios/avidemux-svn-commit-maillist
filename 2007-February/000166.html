<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2846 - in branches/avidemux_2.4_branch:	autononreg/dialogFactory avidemux avidemux/ADM_osSupport	avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2846%20-%20in%20branches/avidemux_2.4_branch%3A%0A%09autononreg/dialogFactory%20avidemux%20avidemux/ADM_osSupport%0A%09avidemux/ADM_script%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200702251222.l1PCMVfR015323%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000165.html">
   <LINK REL="Next"  HREF="000167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2846 - in branches/avidemux_2.4_branch:	autononreg/dialogFactory avidemux avidemux/ADM_osSupport	avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_commonUI</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2846%20-%20in%20branches/avidemux_2.4_branch%3A%0A%09autononreg/dialogFactory%20avidemux%20avidemux/ADM_osSupport%0A%09avidemux/ADM_script%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09avidemux/ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200702251222.l1PCMVfR015323%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2846 - in branches/avidemux_2.4_branch:	autononreg/dialogFactory avidemux avidemux/ADM_osSupport	avidemux/ADM_script	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	avidemux/ADM_userInterfaces/ADM_commonUI">mean at mail.berlios.de
       </A><BR>
    <I>Sun Feb 25 13:22:31 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000165.html">[Avidemux-svn-commit] r2845 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000167.html">[Avidemux-svn-commit] r2847 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#166">[ date ]</a>
              <a href="thread.html#166">[ thread ]</a>
              <a href="subject.html#166">[ subject ]</a>
              <a href="author.html#166">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-02-25 13:22:30 +0100 (Sun, 25 Feb 2007)
New Revision: 2846

Added:
   branches/avidemux_2.4_branch/autononreg/dialogFactory/readonlytext.js
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_debug.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/main.cpp
Log:
crash dump + readonlytext dialogFactory

Copied: branches/avidemux_2.4_branch/autononreg/dialogFactory/readonlytext.js (from rev 2731, branches/avidemux_2.4_branch/autononreg/dialogFactory/toggle.js)
===================================================================
--- branches/avidemux_2.4_branch/autononreg/dialogFactory/toggle.js	2007-01-14 13:23:04 UTC (rev 2731)
+++ branches/avidemux_2.4_branch/autononreg/dialogFactory/readonlytext.js	2007-02-25 12:22:30 UTC (rev 2846)
@@ -0,0 +1,10 @@
+//AD  &lt;- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+var app = new Avidemux();
+var file=&quot;/work/samples/2mn.avi&quot;;
+var goodfcc=&quot;DIV3&quot;;
+var fps;
+
+	dialogFactoryRoText();
+
+/* End of test
+*/

Added: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -0,0 +1,178 @@
+/***************************************************************************
+  Try to display interesting crash dump
+
+    copyright            : (C) 2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;config.h&quot;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;stdarg.h&gt;
+#include &lt;string.h&gt;
+#include &lt;default.h&gt;
+#include &lt;ADM_assert.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+
+#ifdef CYG_MANGLING
+void installSigHandler()
+{
+
+}
+#else
+#include &lt;signal.h&gt;
+#include &lt;execinfo.h&gt;
+void sig_segfault_handler(int signo);
+void installSigHandler()
+{
+    signal(11, sig_segfault_handler); // show stacktrace on default
+}
+extern void ADMImage_stat( void );
+
+static int lenCount(uint8_t *start,uint8_t *end,int *d)
+{
+  int val=0;
+  int digit=0;
+  *d=0;
+  while(*start&gt;='0' &amp;&amp; *start&lt;='9' &amp;&amp; start&lt;end) 
+  {
+    val=val*10+*start-'0'; 
+    start++;
+    digit++;
+  }
+  *d=digit;
+  return val;
+}
+
+static int decodeOne(uint8_t *start, uint8_t *end,int *cons)
+{
+  *cons=0;
+  int len,digit;
+  uint8_t *org=start;
+  if(start+2&gt;=end) return 0;
+  switch(*start )
+  {
+    case 'Z':
+    case 'P':  
+      
+        len=lenCount(start+1,end,&amp;digit);
+        start+=1+digit;
+        for(int z=0;z&lt;len;z++) printf(&quot;%c&quot;,*start++);
+        break;
+  }
+  return (int)((uint64_t)start-(uint64_t)org);
+}
+static int demangle(int i,  uint8_t *string)
+{
+ // Search 1st (
+  if(!string) return 0;
+  int len=strlen((char *)string);
+  if(!len) return 0;
+   
+  uint8_t *end=string+len;
+  uint8_t *start=string;
+  
+  while(*start!='(' &amp;&amp; start+3&lt;end) start++;
+  if(*start!='(') return 0;
+  start++;
+  
+  //  _qt(_Z9crashTestP9JSContextP8JSObjectjPlS3_+0) [0x4acf80]
+  
+  if(*start!='_' || start[1]!='Z')
+  {
+    return 0;
+  }
+  // Seems good !
+  start++;
+  start++;  
+  int digit;
+  // Function name..
+  int l=lenCount(start,end,&amp;digit);
+  printf(&quot;\t&lt;&quot;);
+  for(int i=0;i&lt;l;i++)
+  {
+    printf(&quot;%c&quot;,start[digit+i]); 
+  }
+  printf(&quot;&gt;(&quot;);
+  start+=digit+l;
+  
+  // Parama
+  int first=0;
+  while(start+2&lt;end &amp;&amp; *start=='P')
+  {
+    if(!first)  first=1;
+    else
+        printf(&quot;,&quot;);
+    
+      
+    start++;
+    l=lenCount(start,end,&amp;digit);
+    for(int i=0;i&lt;l;i++)
+    {
+      printf(&quot;%c&quot;,start[digit+i]); 
+    }
+    start+=digit+l;
+  }
+  printf(&quot;)\n&quot;);
+  return 1;
+}
+
+/**
+      \fn sig_segfault_handler
+      \brief our segfault handler
+
+*/
+void sig_segfault_handler(int signo)
+{
+     
+     void *stack[20];
+     char **functions;
+     int count, i;
+     static int running=0;
+      if(running) 
+      {
+        signo=0;
+        exit(1);
+      }
+      running=0; 
+      
+      
+      
+      printf(&quot;\n*********** BACKTRACK **************\n&quot;);
+      count = backtrace(stack, 20);
+      functions = backtrace_symbols(stack, count);
+      
+         for (i=0; i &lt; count; i++) 
+         {
+            printf(&quot;Frame %2d: %s \n&quot;, i, functions[i]);
+            demangle(i,(uint8_t *)functions[i]);
+            
+         }
+      printf(&quot;*********** BACKTRACK **************\n&quot;);
+     // Now use dialogFactory
+      diaElemReadOnlyText *txt[count];
+      for(i=0;i&lt;count;i++)
+          txt[i]=new diaElemReadOnlyText(functions[i],&quot;Function:&quot;);
+      diaFactoryRun(&quot;BackTrace&quot;,count,(diaElem **)txt);
+      
+      //
+     printf(&quot;Memory stat:\n&quot;);
+     ADMImage_stat();
+     signo=0; // will keep GCC happy
+     exit(1); // _exit(1) ???
+}
+#endif
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_debug.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_debug.cpp	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_debug.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -16,22 +16,24 @@
  *                                                                         *
  ***************************************************************************/
 
+#include &quot;config.h&quot;
 
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;stdarg.h&gt;
 #include &lt;string.h&gt;
+#include &lt;default.h&gt;
 #include &lt;ADM_assert.h&gt;
 #include &lt;math.h&gt;
 
-#include &quot;config.h&quot;
+
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_DEBUG
 #include &quot;ADM_debug.h&quot;
 
 // put here the module you want to be verbose (MODULE_xxx + MODULE_yyyy+  ....)
 #ifndef masked
-#define masked  (0*MODULE_LAVFORMAT) //+MODULE_3GP) //(MODULE_AUDIO_EDITOR) MODULE_OGM_AUDIO MODULE_REQUANT MODULE_CODEC
+#define masked  (0*MODULE_UNPACKER+ 0*MODULE_LAVFORMAT) //+MODULE_3GP) //(MODULE_AUDIO_EDITOR) MODULE_OGM_AUDIO MODULE_REQUANT MODULE_CODEC
 #endif
 
 // If the entitty is in masked we actually print the string
@@ -58,3 +60,5 @@
   }
 
 }
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/Makefile.am	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/Makefile.am	2007-02-25 12:22:30 UTC (rev 2846)
@@ -8,7 +8,7 @@
 libADM_ossupport_a_SOURCES = \
 ADM_cpuCap.cpp  ADM_memcpy.cpp  ADM_misc.cpp   ADM_quota.cpp    TLK_clock.cpp \
 ADM_debug.cpp   ADM_memory.cpp  ADM_queue.cpp  ADM_threads.cpp  win32.cpp \
-ADM_memsupport.cpp ADM_fileio.cpp
+ADM_memsupport.cpp ADM_fileio.cpp ADM_crashdump.cpp
 
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -74,6 +74,8 @@
 JSBool facFile(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facBitrate(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facBar(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+JSBool facRoText(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 
 
 static JSFunctionSpec adm_functions[] = {
@@ -97,7 +99,9 @@
   {&quot;dialogFactoryMenu&quot;,         facMenu,        0},
   {&quot;dialogFactoryFileSel&quot;,      facFile,        0},
   {&quot;dialogFactoryBitrate&quot;,      facBitrate,        0},
-  {&quot;dialogFactoryBar&quot;,          facBar,        0},
+  {&quot;dialogFactoryBar&quot;,        facBar,        0},
+  {&quot;dialogFactoryRoText&quot;,     facRoText,        0},
+  {&quot;crashTest&quot;,               crashTest,        0},
   {0}
 };
 
@@ -605,5 +609,27 @@
   
   return JS_TRUE;
 }
+JSBool facRoText(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+    
+      diaElemReadOnlyText txt(&quot;blah blah&quot;,&quot;Value:&quot;);
+      
+      diaElem *elems[]={&amp;txt   };
+  if(diaFactoryRun(&quot;Test FileRead&quot;,1,elems))
+  {
+    *rval = BOOLEAN_TO_JSVAL(1);
+    
+  }else
+    *rval = BOOLEAN_TO_JSVAL(0);
+  
+  return JS_TRUE;
+}
+JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+  
+  int *foobar=NULL;
+  *foobar=0; // CRASH!
+  return JS_TRUE;
+}
 
 //EOF 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp (from rev 2818, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-02-13 19:16:54 UTC (rev 2818)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -0,0 +1,79 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;config.h&gt;
+
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
+#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
+#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
+#include &quot;ADM_commonUI/DIA_factory.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+
+
+
+diaElemReadOnlyText::diaElemReadOnlyText(char *readyOnly,const char *toggleTitle,const char *tip)
+  : diaElem(ELEM_ROTEXT)
+{
+  param=(void *)readyOnly;
+  paramTitle=toggleTitle;
+  this-&gt;tip=tip;
+}
+
+diaElemReadOnlyText::~diaElemReadOnlyText()
+{
+  
+}
+void diaElemReadOnlyText::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  GtkWidget *widget;
+  GtkObject *adj;
+  GtkWidget *label,*label2;
+  
+  label = gtk_label_new_with_mnemonic (paramTitle);
+  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
+  gtk_widget_show(label);
+  
+  gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  label2 = gtk_label_new_with_mnemonic ((char *)param);
+  gtk_misc_set_alignment (GTK_MISC (label2), 0.0, 0.5);
+  gtk_widget_show(label2);
+  
+ 
+  
+  gtk_table_attach (GTK_TABLE (opaque), label2, 1, 2, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  gtk_label_set_mnemonic_widget (GTK_LABEL(label), label2);
+  
+  myWidget=(void *)label2;
+  
+}
+void diaElemReadOnlyText::getMe(void)
+{
+ 
+  
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-02-25 12:22:30 UTC (rev 2846)
@@ -9,6 +9,6 @@
 libADM_dialogFactory_a_METASOURCES = AUTO
 
 libADM_dialogFactory_a_SOURCES = DIA_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_float.cpp FAC_menu.cpp \
-				DIA_filesel.cpp FAC_bitrate.cpp FAC_bar.cpp
+				DIA_filesel.cpp FAC_bitrate.cpp FAC_bar.cpp FAC_ReadOnlyText.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -181,6 +181,24 @@
 {
  
 }
-             
 //******************************************************
+diaElemReadOnlyText::diaElemReadOnlyText(char *readyOnly,const char *toggleTitle,const char *tip)
+  : diaElem(ELEM_ROTEXT)
+{
+ 
+} 
+diaElemReadOnlyText::~diaElemReadOnlyText()
+{
+  
+}
+void diaElemReadOnlyText::setMe(void *dialog, void *opaque,uint32_t line)
+{
+ 
+  
+}
+void diaElemReadOnlyText::getMe(void)
+{
+ 
+}            
+//******************************************************
 //EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp (from rev 2818, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-02-13 19:16:54 UTC (rev 2818)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -0,0 +1,71 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;config.h&gt;
+
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;math.h&gt;
+
+#include &lt;QDialog&gt;
+#include &lt;QSpinBox&gt;
+#include &lt;QGridLayout&gt;
+#include &lt;QLabel&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_commonUI/DIA_factory.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+
+extern const char *shortkey(const char *);
+
+
+
+//********************************************************************
+diaElemReadOnlyText::diaElemReadOnlyText(char *readyOnly,const char *toggleTitle,const char *tip)
+  : diaElem(ELEM_TOGGLE)
+{
+  param=(void *)readyOnly;
+  paramTitle=shortkey(toggleTitle);
+  this-&gt;tip=tip;
+ }
+
+diaElemReadOnlyText::~diaElemReadOnlyText()
+{
+  if(paramTitle)
+    delete paramTitle;
+}
+void diaElemReadOnlyText::setMe(void *dialog, void *opaque,uint32_t line)
+{
+
+  QGridLayout *layout=(QGridLayout*) opaque;
+
+   
+ 
+ QLabel *text=new QLabel( this-&gt;paramTitle,(QWidget *)dialog);
+  QLabel *text2=new QLabel( (char *)param,(QWidget *)dialog);
+ text-&gt;setBuddy(text2);
+ layout-&gt;addWidget(text,line,0);
+ layout-&gt;addWidget(text2,line,1);
+ myWidget=(void *)text2;  
+}
+void diaElemReadOnlyText::getMe(void)
+{
+
+ 
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-02-25 12:22:30 UTC (rev 2846)
@@ -3,7 +3,7 @@
 
 libADM_dialogFactory_a_METASOURCES = AUTO
 
-libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_menu.cpp FAC_float.cpp AT_filesel.cpp AT_bitrate.cpp FAC_bar.cpp
+libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_menu.cpp FAC_float.cpp AT_filesel.cpp AT_bitrate.cpp FAC_bar.cpp FAC_readOnlyText.cpp
 
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-02-25 12:22:30 UTC (rev 2846)
@@ -26,6 +26,7 @@
   ELEM_FILE_READ,
   ELEM_BITRATE,
   ELEM_BAR,
+  ELEM_ROTEXT,
   ELEM_MAX=ELEM_TOGGLE
 };
 /*********************************************/
@@ -156,6 +157,20 @@
   
   void changeFile(void);
 };
+/*************************************************/
+class diaElemReadOnlyText : public diaElem
+{
+
+public:
+  
+  diaElemReadOnlyText(char *readyOnly,const char *toggleTitle,const char *tip=NULL);
+  virtual ~diaElemReadOnlyText() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+  
+  void changeFile(void);
+};
+
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 /*********************************************/

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-02-25 09:25:21 UTC (rev 2845)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-02-25 12:22:30 UTC (rev 2846)
@@ -21,7 +21,6 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;glib.h&gt;
-#include &lt;signal.h&gt;
 
 #ifdef HAVE_GETTEXT
 #include &lt;libintl.h&gt;
@@ -42,6 +41,7 @@
 #include &quot;prefs.h&quot;
 #include &quot;ADM_audiodevice/audio_out.h&quot;
 #include &quot;ADM_toolkit/ADM_intfloat.h&quot;
+
 #ifdef USE_XVID_4
 extern void xvid4_init(void);
 #endif
@@ -82,10 +82,8 @@
 extern void ADM_memStat( void );
 extern void ADM_memStatInit( void );
 extern void ADM_memStatEnd( void );
+extern void installSigHandler(void);
 
-
-void sig_segfault_handler(int signo);
-
 extern uint8_t  quotaInit(void);
 extern void ADMImage_stat( void );
 extern uint8_t win32_netInit(void);
@@ -120,8 +118,9 @@
 
 
 // thx smurf uk :)
-    signal(11, sig_segfault_handler); // show stacktrace on default
+    installSigHandler();
 
+
     printf(&quot;\n*******************\n&quot;);
     printf(&quot;  Avidemux 2, v  &quot; VERSION &quot;\n&quot;);
     printf(&quot;*******************\n&quot;);
@@ -278,15 +277,3 @@
         ADM_memStatEnd(  );
         printf(&quot;\n Goodbye...\n\n&quot;);
 }
-void sig_segfault_handler(int signo)
-{
-     ADMImage_stat();
-     g_on_error_stack_trace (&quot;avidemux&quot;);
-     printf(&quot;Memory stat:\n&quot;);
-
-//   g_on_error_query (programname);
-
-
-     signo=0; // will keep GCC happy
-     exit(1); // _exit(1) ???
-}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000165.html">[Avidemux-svn-commit] r2845 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000167.html">[Avidemux-svn-commit] r2847 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#166">[ date ]</a>
              <a href="thread.html#166">[ thread ]</a>
              <a href="subject.html#166">[ subject ]</a>
              <a href="author.html#166">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
