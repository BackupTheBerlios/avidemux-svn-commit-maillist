<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5957 - in branches/avidemux_2.6_branch_mean:	autononreg/dialogFactory avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5957%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09autononreg/dialogFactory%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_dialog%0A%09avidemux_core/ADM_coreUI/include%20avidemux_core/ADM_coreUI/src&In-Reply-To=%3C201003010622.o216MAS2000037%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003161.html">
   <LINK REL="Next"  HREF="003163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5957 - in branches/avidemux_2.6_branch_mean:	autononreg/dialogFactory avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5957%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09autononreg/dialogFactory%20avidemux/common/ADM_script2/include%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/qt4/ADM_userInterfaces/ADM_dialog%0A%09avidemux_core/ADM_coreUI/include%20avidemux_core/ADM_coreUI/src&In-Reply-To=%3C201003010622.o216MAS2000037%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5957 - in branches/avidemux_2.6_branch_mean:	autononreg/dialogFactory avidemux/common/ADM_script2/include	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src">mean at mail.berlios.de
       </A><BR>
    <I>Mon Mar  1 07:22:10 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003161.html">[Avidemux-svn-commit] r5956 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_videoCodec/src	avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux_core/ADM_core/include	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src	avidemux_plugins/ADM_demuxers/Matroska
</A></li>
        <LI>Next message: <A HREF="003163.html">[Avidemux-svn-commit] r5958 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreMuxer/include avidemux_core/ADM_coreMuxer/src	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src	avidemux_plugins/ADM_muxers/muxerAvi	avidemux_plugins/ADM_muxers/muxerFlv	avidemux_plugins/ADM_muxers/muxerMkv	avidemux_plugins/ADM_muxers/muxerMp4	avidemux_plugins/ADM_muxers/muxerRaw	avidemux_plugins/ADM_muxers/muxerffPS	avidemux_plugins/ADM_muxers/muxerffTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3162">[ date ]</a>
              <a href="thread.html#3162">[ thread ]</a>
              <a href="subject.html#3162">[ subject ]</a>
              <a href="author.html#3162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-03-01 07:22:09 +0100 (Mon, 01 Mar 2010)
New Revision: 5957

Added:
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsTestFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.c
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.idl
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp
Log:
[EncodingDialog] Unit test case (js)

Added: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js	2010-03-01 06:22:09 UTC (rev 5957)
@@ -0,0 +1,6 @@
+//AD  &lt;- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print(&quot;Testing factory FileSel&quot;);
+admTestEncoding();
+print(&quot;Testing factory FileSel&quot;);
+/* End of test
+*/

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsTestFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsTestFactory.h	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsTestFactory.h	2010-03-01 06:22:09 UTC (rev 5957)
@@ -39,6 +39,7 @@
 int jsTestFacToggle(void);
 int jsTestFacFloat(void);
 int jsTestFacInt(void);
+int jsTestFacEncoding(void);
 };
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory.cpp	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory.cpp	2010-03-01 06:22:09 UTC (rev 5957)
@@ -18,8 +18,8 @@
 #include &quot;DIA_fileSel.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;ADM_jsTestFactory.h&quot;
+#include &quot;DIA_encoding.h&quot;
 
-
 /**
     \fn crashTest
     \brief Force a crash
@@ -420,5 +420,25 @@
   return false;
       
 }
-
+/**
+    \fn jsTestFacEncoding
+*/
+int jsTestFacEncoding(void)
+{
+    DIA_encodingBase *base=createEncoding(1000*10000LL);
+    base-&gt;setContainer(&quot;the container&quot;);
+    base-&gt;setAudioCodec(&quot;the audio codec&quot;);
+    base-&gt;setVideoCodec(&quot;the video codec&quot;);
+    for(int i=0;i&lt;20;i++)
+    {
+        base-&gt;refresh();
+        base-&gt;pushVideoFrame(10000,1,5*1000LL*i);
+        base-&gt;refresh();
+        
+        ADM_usleep(500*1000);
+    }
+    delete base;
+    base=NULL;
+    return true;
+}
 //EOF 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.c	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.c	2010-03-01 06:22:09 UTC (rev 5957)
@@ -517,34 +517,61 @@
     return var120;
 }
 static JSBool
-jjadmTestCrash(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+jjadmTestEncoding(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
 {
     JSObject *var128;
+    int var129;
     int var132;
+    jsval var133;
     JSBool var127;
     var128 = NULL;
+    var129 = 0;
     var132 = 0;
+    var133 = JSVAL_NULL;
     var127 = JS_FALSE;
     var128 = obj;
     var132 = argc;
-    jsTestCrash();
+    var129 = jsTestFacEncoding();
+    if (JS_NewNumberValue(cx, var129, &amp;var133) != JS_TRUE) {
+        goto do_return;
+    }
+    argv[argc+0] = var133;
+    if (rval) {
+        *rval = var133;
+    }
     var127 = JS_TRUE;
+    do_return:
     return var127;
 }
 static JSBool
+jjadmTestCrash(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+    JSObject *var135;
+    int var139;
+    JSBool var134;
+    var135 = NULL;
+    var139 = 0;
+    var134 = JS_FALSE;
+    var135 = obj;
+    var139 = argc;
+    jsTestCrash();
+    var134 = JS_TRUE;
+    return var134;
+}
+static JSBool
 jjadmTestAssert(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
 {
-    JSObject *var134;
-    int var138;
-    JSBool var133;
-    var134 = NULL;
-    var138 = 0;
-    var133 = JS_FALSE;
-    var134 = obj;
-    var138 = argc;
+    JSObject *var141;
+    int var145;
+    JSBool var140;
+    var141 = NULL;
+    var145 = 0;
+    var140 = JS_FALSE;
+    var141 = obj;
+    var145 = argc;
     jsTestAssert();
-    var133 = JS_TRUE;
-    return var133;
+    var140 = JS_TRUE;
+    return var140;
 }
 static JSPropertySpec jj_static_ps[] = {
     {NULL, 0, 0, NULL, NULL}
@@ -571,6 +598,7 @@
     JS_FS(&quot;admTestFacNotch&quot;, jjadmTestFacNotch, 0, 0, 1),
     JS_FS(&quot;admTestFacThreadCount&quot;, jjadmTestFacThreadCount, 0, 0, 1),
     JS_FS(&quot;admTestFacSlider&quot;, jjadmTestFacSlider, 0, 0, 1),
+    JS_FS(&quot;admTestEncoding&quot;, jjadmTestEncoding, 0, 0, 1),
     JS_FS(&quot;admTestCrash&quot;, jjadmTestCrash, 0, 0, 0),
     JS_FS(&quot;admTestAssert&quot;, jjadmTestAssert, 0, 0, 0),
     JS_FS_END
@@ -594,6 +622,7 @@
     JS_FS(&quot;admTestFacNotch&quot;, jjadmTestFacNotch, 0, 0, 1),
     JS_FS(&quot;admTestFacThreadCount&quot;, jjadmTestFacThreadCount, 0, 0, 1),
     JS_FS(&quot;admTestFacSlider&quot;, jjadmTestFacSlider, 0, 0, 1),
+    JS_FS(&quot;admTestEncoding&quot;, jjadmTestEncoding, 0, 0, 1),
     JS_FS(&quot;admTestCrash&quot;, jjadmTestCrash, 0, 0, 0),
     JS_FS(&quot;admTestAssert&quot;, jjadmTestAssert, 0, 0, 0),
     JS_FS_END

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.idl
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.idl	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsTestFactory_js.idl	2010-03-01 06:22:09 UTC (rev 5957)
@@ -21,6 +21,7 @@
 function int admTestFacNotch   :  jsTestFacNotch   (void  ) &lt;static&gt;;
 function int admTestFacThreadCount:  jsTestFacThreadCount   (void  ) &lt;static&gt;;
 function int admTestFacSlider  :  jsTestFacSlider  (void  ) &lt;static&gt;;
+function int admTestEncoding   :  jsTestFacEncoding  (void  ) &lt;static&gt;;
 function void admTestCrash     :  jsTestCrash      (void  ) &lt;static&gt;;
 function void admTestAssert    :  jsTestAssert     (void  ) &lt;static&gt;;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-03-01 06:22:09 UTC (rev 5957)
@@ -214,7 +214,7 @@
 void DIA_encodingQt4::setBitrate(uint32_t br,uint32_t globalbr)
 {
           ADM_assert(window);
-          snprintf(string,79,&quot;%lu kB/s&quot;,br,globalbr);
+          snprintf(string,79,&quot;%&quot;LU&quot; kB/s&quot;,br,globalbr);
           WRITE(labelVidBitrate);
 
 }
@@ -237,7 +237,7 @@
 void DIA_encodingQt4::setQuantIn(int size)
 {
           ADM_assert(window);
-          sprintf(string,&quot;%lu&quot;,size);
+          sprintf(string,&quot;%&quot;LU,size);
           WRITE(labelQz);
 
 }
@@ -250,7 +250,7 @@
 {
           ADM_assert(window);
           uint64_t mb=size&gt;&gt;20;
-          sprintf(string,&quot;%lu MB&quot;,(int)mb);
+          sprintf(string,&quot;%&quot;LU&quot; MB&quot;,(int)mb);
           WRITE(labelTotalSize);
 
 }
@@ -264,7 +264,7 @@
 {
           ADM_assert(window);
           uint64_t mb=size&gt;&gt;20;
-          sprintf(string,&quot;%lu MB&quot;,(int)mb);
+          sprintf(string,&quot;%&quot;LU&quot; MB&quot;,(int)mb);
           WRITE(labelAudioSize);
 
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h	2010-03-01 06:22:09 UTC (rev 5957)
@@ -60,5 +60,5 @@
                 virtual void refresh(void);
 };
 //********************
-DIA_encodingBase *createEncoding(uint32_t fps1000);
+DIA_encodingBase *createEncoding(uint64_t duration);
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp	2010-03-01 06:22:02 UTC (rev 5956)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp	2010-03-01 06:22:09 UTC (rev 5957)
@@ -20,7 +20,7 @@
 #include &lt;math.h&gt;
 #define  ETA_SAMPLE_PERIOD 60000 //Use last n millis to calculate ETA
 #define  GUI_UPDATE_RATE 500    // Ms
-
+extern void UI_purge(void);
 DIA_encodingBase::DIA_encodingBase( uint64_t duration )
 {
         _originalPriority=getpriority(PRIO_PROCESS, 0);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003161.html">[Avidemux-svn-commit] r5956 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_videoCodec/src	avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux_core/ADM_core/include	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src	avidemux_plugins/ADM_demuxers/Matroska
</A></li>
	<LI>Next message: <A HREF="003163.html">[Avidemux-svn-commit] r5958 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_script2/src	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreMuxer/include avidemux_core/ADM_coreMuxer/src	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src	avidemux_plugins/ADM_muxers/muxerAvi	avidemux_plugins/ADM_muxers/muxerFlv	avidemux_plugins/ADM_muxers/muxerMkv	avidemux_plugins/ADM_muxers/muxerMp4	avidemux_plugins/ADM_muxers/muxerRaw	avidemux_plugins/ADM_muxers/muxerffPS	avidemux_plugins/ADM_muxers/muxerffTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3162">[ date ]</a>
              <a href="thread.html#3162">[ thread ]</a>
              <a href="subject.html#3162">[ subject ]</a>
              <a href="author.html#3162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
