<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6028 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6028%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/cmake%3A%20.%20patches&In-Reply-To=%3C201003272104.o2RL4tLN001251%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003231.html">
   <LINK REL="Next"  HREF="003233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6028 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6028%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/cmake%3A%20.%20patches&In-Reply-To=%3C201003272104.o2RL4tLN001251%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6028 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches">gruntster at mail.berlios.de
       </A><BR>
    <I>Sat Mar 27 22:04:55 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003231.html">[Avidemux-svn-commit] r6027 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
</A></li>
        <LI>Next message: <A HREF="003233.html">[Avidemux-svn-commit] r6029 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc:	. mpeg2enc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3232">[ date ]</a>
              <a href="thread.html#3232">[ thread ]</a>
              <a href="subject.html#3232">[ subject ]</a>
              <a href="author.html#3232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2010-03-27 22:04:46 +0100 (Sat, 27 Mar 2010)
New Revision: 6028

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
Log:
[ffmpeg] update FFmpeg to r22703 &amp; libswscale to r30970

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 22111)	# <A HREF="http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=35b04ac6a5ed6d7e4c7db1945dae4d061ca5000b;sf=tgz">http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=35b04ac6a5ed6d7e4c7db1945dae4d061ca5000b;sf=tgz</A>
-set(SWSCALE_VERSION 30800)	# <A HREF="http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=9f92a66140e3ecd928be9f3359a4560c491c5047;sf=tgz">http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=9f92a66140e3ecd928be9f3359a4560c491c5047;sf=tgz</A>
+set(FFMPEG_VERSION 22703)	# <A HREF="http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=bb116bdcfc2d1059af8475e861c6998c688cb55b;sf=tgz">http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=bb116bdcfc2d1059af8475e861c6998c688cb55b;sf=tgz</A>
+set(SWSCALE_VERSION 30970)	# <A HREF="http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=efc190382dc560b47ab559ff6ecdce77dbc0c1e7;sf=tgz">http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=efc190382dc560b47ab559ff6ecdce77dbc0c1e7;sf=tgz</A>
 
 set(LIBRARY_SOURCE_DIR &quot;${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries&quot;)
 set(FFMPEG_SOURCE_DIR &quot;${LIBRARY_SOURCE_DIR}/ffmpeg&quot;)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,19 +1,19 @@
-*** libavcodec/avcodec.h.old	Sun Feb 28 18:41:01 2010
---- libavcodec/avcodec.h	Sun Feb 28 18:41:01 2010
+*** libavcodec/avcodec.h.old	Sat Mar 27 20:05:32 2010
+--- libavcodec/avcodec.h	Sat Mar 27 20:05:32 2010
 ***************
-*** 589,594 ****
---- 589,596 ----
-  #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///&lt; Use MPEG-2 nonlinear quantizer.
-  #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///&lt; Use a bit reservoir when encoding if possible
+*** 594,599 ****
+--- 594,601 ----
   #define CODEC_FLAG2_MBTREE        0x00040000 ///&lt; Use macroblock tree ratecontrol (x264 only)
+  #define CODEC_FLAG2_PSY           0x00080000 ///&lt; Use psycho visual optimizations.
+  #define CODEC_FLAG2_SSIM          0x00100000 ///&lt; Compute SSIM during encoding, error[] values are undefined.
 + //MEANX: NEVER EVER USE CLOSED GOP ?
 + #define CODEC_FLAG2_32_PULLDOWN   0x80000000
   
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1458,1463 ****
---- 1460,1466 ----
+*** 1464,1469 ****
+--- 1466,1472 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1472,1477 ****
---- 1475,1482 ----
+*** 1478,1483 ****
+--- 1481,1488 ----
        * - decoding: unused
        */
       int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavcodec/ffv1.c.old	Thu Aug 27 21:15:58 2009
---- libavcodec/ffv1.c	Thu Aug 27 21:15:58 2009
+*** libavcodec/ffv1.c.old	Sat Mar 27 20:05:33 2010
+--- libavcodec/ffv1.c	Sat Mar 27 20:05:33 2010
 ***************
-*** 1071,1076 ****
---- 1071,1078 ----
+*** 1070,1075 ****
+--- 1070,1077 ----
           clear_state(f);
       }else{
           p-&gt;key_frame= 0;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,12 +1,14 @@
-*** libavcodec/h263dec.c.old	Sun Jan 17 19:05:15 2010
---- libavcodec/h263dec.c	Sun Jan 17 19:05:15 2010
+*** libavcodec/h263dec.c.old	Sat Mar 27 20:05:34 2010
+--- libavcodec/h263dec.c	Sat Mar 27 20:05:34 2010
 ***************
 *** 119,124 ****
---- 119,141 ----
+--- 119,143 ----
   
       return 0;
   }
 + /* MeanX : Ugly patch to detect vo ppacked stuff ... */
++ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
++ 
 + int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
 + {
 +     MpegEncContext *s = avctx-&gt;priv_data;
@@ -28,7 +30,7 @@
   {
 ***************
 *** 414,419 ****
---- 431,442 ----
+--- 433,444 ----
       } else {
           ret = h263_decode_picture_header(s);
       }
@@ -43,7 +45,7 @@
   
 ***************
 *** 707,712 ****
---- 730,743 ----
+--- 732,745 ----
   
   assert(s-&gt;current_picture.pict_type == s-&gt;current_picture_ptr-&gt;pict_type);
   assert(s-&gt;current_picture.pict_type == s-&gt;pict_type);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,12 +1,14 @@
-*** libavcodec/h264.c.old	Sun Feb 28 18:41:04 2010
---- libavcodec/h264.c	Sun Feb 28 18:41:04 2010
+*** libavcodec/h264.c.old	Sat Mar 27 20:05:35 2010
+--- libavcodec/h264.c	Sat Mar 27 20:05:35 2010
 ***************
-*** 3117,3122 ****
---- 3117,3133 ----
+*** 3116,3121 ****
+--- 3116,3134 ----
       return 0;
   }
   
 + /* MEANX */
++ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);
++ 
 + int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
 + {
 +       H264Context *h = avctx-&gt;priv_data;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavcodec/mpeg12.c.old	Sat Dec 19 22:15:50 2009
---- libavcodec/mpeg12.c	Sat Dec 19 22:15:50 2009
+*** libavcodec/mpeg12.c.old	Sat Mar 27 20:05:36 2010
+--- libavcodec/mpeg12.c	Sat Mar 27 20:05:36 2010
 ***************
-*** 1946,1951 ****
---- 1946,1956 ----
+*** 1948,1953 ****
+--- 1948,1958 ----
           ff_er_frame_end(s);
   
           MPV_frame_end(s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,7 +1,7 @@
-*** libavcodec/mpegvideo.c.old	Sat Jan 23 11:31:10 2010
---- libavcodec/mpegvideo.c	Sat Jan 23 11:31:10 2010
+*** libavcodec/mpegvideo.c.old	Sat Mar 27 20:05:38 2010
+--- libavcodec/mpegvideo.c	Sat Mar 27 20:05:39 2010
 ***************
-*** 614,620 ****
+*** 646,652 ****
       FF_ALLOCZ_OR_GOTO(s-&gt;avctx, s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
   
       s-&gt;parse_context.state= -1;
@@ -9,7 +9,7 @@
          s-&gt;visualization_buffer[0] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
          s-&gt;visualization_buffer[1] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
          s-&gt;visualization_buffer[2] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
---- 614,624 ----
+--- 646,656 ----
       FF_ALLOCZ_OR_GOTO(s-&gt;avctx, s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
   
       s-&gt;parse_context.state= -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavcodec/mpegvideo_enc.c.old	Sun Jan 17 19:05:25 2010
---- libavcodec/mpegvideo_enc.c	Sun Jan 17 19:05:25 2010
+*** libavcodec/mpegvideo_enc.c.old	Sat Mar 27 20:05:40 2010
+--- libavcodec/mpegvideo_enc.c	Sat Mar 27 20:05:40 2010
 ***************
-*** 366,377 ****
---- 366,379 ----
+*** 367,378 ****
+--- 367,380 ----
   
           av_log(avctx, AV_LOG_INFO, &quot;Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n&quot;);
       }
@@ -18,8 +18,8 @@
       if(s-&gt;obmc &amp;&amp; s-&gt;avctx-&gt;mb_decision != FF_MB_DECISION_SIMPLE){
           av_log(avctx, AV_LOG_ERROR, &quot;OBMC is only supported with simple mb decision\n&quot;);
 ***************
-*** 412,421 ****
---- 414,425 ----
+*** 413,422 ****
+--- 415,426 ----
           return -1;
       }
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c.old	Sun Feb 28 18:41:09 2010
---- libavcodec/utils.c	Sun Feb 28 18:41:09 2010
+*** libavcodec/utils.c.old	Sat Mar 27 20:05:41 2010
+--- libavcodec/utils.c	Sat Mar 27 20:05:41 2010
 ***************
-*** 637,646 ****
---- 637,648 ----
+*** 638,647 ****
+--- 638,649 ----
   
       if((avctx-&gt;codec-&gt;capabilities &amp; CODEC_CAP_DELAY) || avpkt-&gt;size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr &lt; avctx-&gt;channels * avctx-&gt;frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, &quot;buffer %d too small\n&quot;, *frame_size_ptr);
 ***************
-*** 1079,1085 ****
+*** 1080,1086 ****
           return -1;
       }
   #if !HAVE_MKSTEMP
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, &quot;/tmp/%sXXXXXX&quot;, prefix);
       fd = mkstemp(*filename);
---- 1081,1087 ----
+--- 1082,1088 ----
           return -1;
       }
   #if !HAVE_MKSTEMP

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavformat/file.c.old	Mon Feb  2 19:49:57 2009
---- libavformat/file.c	Mon Feb  2 19:49:56 2009
+*** libavformat/file.c.old	Sat Mar 27 20:05:42 2010
+--- libavformat/file.c	Sat Mar 27 20:05:42 2010
 ***************
 *** 30,35 ****
---- 30,101 ----
+--- 30,104 ----
   #include &lt;stdlib.h&gt;
   #include &quot;os_support.h&quot;
   
@@ -10,6 +10,9 @@
 + #ifdef __WIN32
 + #include &lt;windows.h&gt;
 + 
++ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
++ int ADM_open(const char *path, int oflag, ...);
++ 
 + int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
 + {
 + 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,5 +1,5 @@
-*** libavformat/flvenc.c.old	Tue Nov 24 18:58:08 2009
---- libavformat/flvenc.c	Tue Nov 24 18:58:08 2009
+*** libavformat/flvenc.c.old	Sat Mar 27 20:05:43 2010
+--- libavformat/flvenc.c	Sat Mar 27 20:05:43 2010
 ***************
 *** 406,412 ****
       &quot;video/x-flv&quot;,
@@ -20,11 +20,13 @@
       CODEC_ID_ADPCM_SWF,
 ***************
 *** 418,420 ****
---- 419,427 ----
+--- 419,429 ----
       .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
       .flags= AVFMT_GLOBALHEADER | AVFMT_VARIABLE_FPS,
   };
 + // MEANX
++ int flvenc_init(void);
++ 
 + int flvenc_init(void)
 + {
 +     av_register_output_format(&amp;flv_muxer);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,8 +1,8 @@
-*** libavformat/matroskaenc.c.old	Sat Jan 23 11:31:16 2010
---- libavformat/matroskaenc.c	Sat Jan 23 11:31:16 2010
+*** libavformat/matroskaenc.c.old	Sat Mar 27 20:05:45 2010
+--- libavformat/matroskaenc.c	Sat Mar 27 20:05:45 2010
 ***************
-*** 395,400 ****
---- 395,401 ----
+*** 403,408 ****
+--- 403,409 ----
   
   static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
   {
@@ -11,8 +11,8 @@
       int header_len[3];
       int first_header_size;
 ***************
-*** 419,424 ****
---- 420,447 ----
+*** 427,432 ****
+--- 428,455 ----
           put_buffer(pb, header_start[j], header_len[j]);
   
       return 0;
@@ -42,46 +42,45 @@
   
   static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
 ***************
-*** 536,541 ****
---- 559,583 ----
+*** 546,551 ****
+--- 569,592 ----
           put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
           put_ebml_float(pb, MATROSKA_ID_TRACKTIMECODESCALE, 1.0);
   
-+ 		/**  MEANX : Add a default duration for video **/
-+ 		if(codec-&gt;codec_type==CODEC_TYPE_VIDEO)
-+ 		{
-+ 			if(codec-&gt;time_base.den &amp;&amp; codec-&gt;time_base.num)
-+ 			{
-+ 				int num = codec-&gt;time_base.num;
-+ 				int den = codec-&gt;time_base.den;
-+ 				unsigned int default_duration;
-+ 				float period = num;
++  		/**  MEANX : Add a default duration for video **/
++  		if(codec-&gt;codec_type==CODEC_TYPE_VIDEO)
++  		{
++  			if(codec-&gt;time_base.den &amp;&amp; codec-&gt;time_base.num)
++  			{
++  				int num = codec-&gt;time_base.num;
++  				int den = codec-&gt;time_base.den;
++  				unsigned int default_duration;
++  				float period = num;
++  
++  				period /= den;
++  				period *= 1000*1000*1000; // in ns
++  				default_duration = (unsigned int)floor(period);
++  				put_ebml_uint(pb, MATROSKA_ID_TRACKDEFAULTDURATION, default_duration);
++  			}
++  		}
++  		/**  MEANX : Add a default duration for video **/
 + 
-+ 				period /= den;
-+ 				period *= 1000*1000*1000; // in ns
-+ 				default_duration = (unsigned int)floor(period);
-+ 				put_ebml_uint(pb, MATROSKA_ID_TRACKDEFAULTDURATION, default_duration);
-+ 			}
-+ 		}
-+ 
-+ 		/**  MEANX : Add a default duration for video **/
-+ 
-          if ((tag = av_metadata_get(st-&gt;metadata, &quot;description&quot;, NULL, 0)))
+          if ((tag = av_metadata_get(st-&gt;metadata, &quot;title&quot;, NULL, 0)))
               put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag-&gt;value);
           tag = av_metadata_get(st-&gt;metadata, &quot;language&quot;, NULL, 0);
 ***************
-*** 955,957 ****
---- 997,1009 ----
+*** 1004,1006 ****
+--- 1045,1057 ----
       .flags = AVFMT_GLOBALHEADER,
       .codec_tag = (const AVCodecTag* const []){ff_codec_wav_tags, 0},
   };
 + // MEANX
 + //
++ int matroskaenc_init(void);
++ 
 + int matroskaenc_init(void)
 + {
 +     av_register_output_format(&amp;matroska_muxer);
 +     return 0;
 + }
 + // /MEANX
-+ 
-+ 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2010-03-23 18:28:21 UTC (rev 6027)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2010-03-27 21:04:46 UTC (rev 6028)
@@ -1,12 +1,14 @@
-*** libavformat/movenc.c.old	Thu Jan  7 19:26:12 2010
---- libavformat/movenc.c	Thu Jan  7 19:26:12 2010
+*** libavformat/movenc.c.old	Sat Mar 27 20:05:46 2010
+--- libavformat/movenc.c	Sat Mar 27 20:05:46 2010
 ***************
-*** 2138,2140 ****
---- 2138,2152 ----
+*** 2140,2142 ****
+--- 2140,2156 ----
       .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
   };
   #endif
 + /* MEANX */
++ int movenc_init(void);
++ 
 + int movenc_init(void)
 + {
 +     av_register_output_format(&amp;mov_muxer);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003231.html">[Avidemux-svn-commit] r6027 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
</A></li>
	<LI>Next message: <A HREF="003233.html">[Avidemux-svn-commit] r6029 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc:	. mpeg2enc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3232">[ date ]</a>
              <a href="thread.html#3232">[ thread ]</a>
              <a href="subject.html#3232">[ subject ]</a>
              <a href="author.html#3232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
