<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3990 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_coreImage/include ADM_filter	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_filters
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3990%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_coreImage/include%20ADM_filter%0A%09ADM_userInterfaces/ADM_GTK/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters&In-Reply-To=%3C200804271720.m3RHKKtj024879%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001249.html">
   <LINK REL="Next"  HREF="001251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3990 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_coreImage/include ADM_filter	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_filters</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3990%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_coreImage/include%20ADM_filter%0A%09ADM_userInterfaces/ADM_GTK/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters&In-Reply-To=%3C200804271720.m3RHKKtj024879%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3990 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_coreImage/include ADM_filter	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_filters">mean at mail.berlios.de
       </A><BR>
    <I>Sun Apr 27 19:20:20 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001249.html">[Avidemux-svn-commit] r3989 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters
</A></li>
        <LI>Next message: <A HREF="001251.html">[Avidemux-svn-commit] r3991 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1250">[ date ]</a>
              <a href="thread.html#1250">[ thread ]</a>
              <a href="subject.html#1250">[ subject ]</a>
              <a href="author.html#1250">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2008-04-27 19:20:19 +0200 (Sun, 27 Apr 2008)
New Revision: 3990

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter_internal.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_dylib.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_saveload.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
Log:
[Merge] Remove resize etc for the moment from metafilters


Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h	2008-04-27 17:20:19 UTC (rev 3990)
@@ -15,7 +15,7 @@
  *                                                                         *
  ***************************************************************************/
  
-#define ADM_FILTER_API_VERSION 1
+#define ADM_FILTER_API_VERSION 2
 /**
 	Note for filter writers :
 
@@ -91,34 +91,49 @@
 
 
 
- class AVDMGenericVideoStream
- {
-   protected:
-      	ADV_Info 					_info;
-   	  ADMImage   					*_uncompressed;
-	  AVDMGenericVideoStream 	*_in;
-/* not really used */
-          uint8_t		getPixel(int32_t x,int32_t y,uint8_t *data);
-          uint8_t		getPixelU(int32_t x,int32_t y,uint8_t *data);
-          uint8_t		setPixelU(uint8_t val,int32_t x,int32_t y,uint8_t *data);
-          uint8_t 	unPackChroma(uint8_t *ssrc,uint8_t *ddst);
-/* /not really used */
-   public:
-          virtual uint32_t   getPARWidth(void);
-          virtual uint32_t   getPARHeight(void);
+ class AVDMGenericVideoStream {
+protected:
+	ADV_Info _info;
+	ADMImage *_uncompressed;
+	AVDMGenericVideoStream *_in;
+	/* not really used */
+	uint8_t getPixel(int32_t x, int32_t y, uint8_t *data);
+	uint8_t getPixelU(int32_t x, int32_t y, uint8_t *data);
+	uint8_t setPixelU(uint8_t val, int32_t x, int32_t y, uint8_t *data);
+	uint8_t unPackChroma(uint8_t *ssrc, uint8_t *ddst);
+	/* /not really used */
+public:
+	virtual uint32_t getPARWidth(void);
+	virtual uint32_t getPARHeight(void);
 
-   	// return 1 -&gt; conf changed need rebuild, 0 means conf not changed
-        virtual 	uint8_t 	configure( AVDMGenericVideoStream *instream)=0;
-          			AVDMGenericVideoStream( void)  {_uncompressed=NULL;_in=NULL;};
-  	virtual 		~AVDMGenericVideoStream( ) {};
-        virtual char 	*printConf(void) { static char *str=(char *)&quot;.&quot;; return str;};
+	// return 1 -&gt; conf changed need rebuild, 0 means conf not changed
+	virtual uint8_t configure(AVDMGenericVideoStream *instream)=0;
+	AVDMGenericVideoStream(void) {
+		_uncompressed=NULL;
+		_in=NULL;
+	}
+	;
+	virtual ~AVDMGenericVideoStream() {
+	}
+	;
+	virtual char *printConf(void) {
+		static char *str=(char *)&quot;.&quot;;
+		return str;
+	}
+	;
 
-        virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          							ADMImage *data,uint32_t *flags)=0;
-          	ADV_Info 	*getInfo( void ) { return &amp;_info;};
-         virtual uint8_t	getCoupledConf( CONFcouple **couples)
-	  				{*couples=NULL;return 0;};
- };
+	virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+			ADMImage *data, uint32_t *flags)=0;
+	ADV_Info *getInfo(void) {
+		return &amp;_info;
+	}
+	;
+	virtual uint8_t getCoupledConf(CONFcouple **couples) {
+		*couples=NULL;
+		return 0;
+	}
+	;
+};
 
 void     DIA_previewInit(uint32_t width, uint32_t height);
 uint8_t  DIA_previewUpdate(uint8_t *data);
@@ -189,5 +204,6 @@
  AVDMGenericVideoStream *getFirstCurrentVideoFilter( void);
 // 
 #include &quot;ADM_videoFilterCache.h&quot;
+ 
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter_internal.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter_internal.h	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter_internal.h	2008-04-27 17:20:19 UTC (rev 3990)
@@ -17,157 +17,63 @@
  #ifndef __VIDEO_FILTERS__
  #define  __VIDEO_FILTERS__
 
-#include &quot;ADM_script/adm_scanner.h&quot;
+#include &quot;ADM_script/adm_scanner.h&quot; // To get MAXPARAM...
 
 typedef enum
 {
-	VF_TRANSFORM,
-	VF_INTERLACING,
-	VF_COLORS,
-	VF_NOISE,
-	VF_SHARPNESS,
-	VF_SUBTITLE,
-	VF_MISC
+	VF_TRANSFORM=0,
+	VF_INTERLACING=1,
+	VF_COLORS=2,
+	VF_NOISE=3,
+	VF_SHARPNESS=4,
+	VF_SUBTITLE=5,
+	VF_MISC=6,
+	VF_MAX=7
 }VF_CATEGORY;
+#define VF_INVALID 		  0
 
-typedef enum
-{
-                VF_INVALID=0,
-                VF_RESIZE=1,
-                VF_CROP,
-                VF_TELECIDE,
-                VF_BLACKEN,
-                VF_SHARPEN,
-                VF_MEAN,
-                VF_MEDIAN,
-                VF_GAUSSIAN,
-                VF_SMOOTHCLEAN,
-                VF_DEINTERLACE,
-                VF_ADDBORDER,
-                VF_PALSHIFT,
-                VF_SWAPUV,
-                VF_CONTRAST,
-                VF_LUMA,
-                VF_CHROMAU,
-                VF_CHROMAV,
-                VF_STABILIZE,
-                VF_FLIP,
-                VF_DENOISE,
-                VF_SUBTILE,
-                VF_LARGEMEDIAN,
-                VF_FLUXSMOOTH,
-                VF_SALT,
-                VF_PARTIAL          ,
-                VF_VLADSMOOTH,
-                VF_ROTATE,
-                VF_DROPOUT,
-                VF_SWAPFIELDS,
-                VF_KEEPODD,
-                VF_KEEPEVEN,
-                VF_SEPARATEFIELDS,
-                VF_MERGEFIELDS,
-                VF_CHROMASHIFT,
-                VF_SMARTSWAPFIELDS,
-                VF_MPLAYERRESIZE,
-                VF_IVTC,
-                VF_PULLDOWN,
-                VF_MPLHQD3D,
-                VF_MPLLQD3D,
-                VF_LAVDEINT,
-                VF_MPDETC,
-                VF_KRNDEINT,
-                VF_FORCEDPP,
-                VF_SOFTEN,
-                VF_DECOMB,
-                VF_DECIMATE,
-                VF_MSMOOTH,
-                VF_STACKFIELD,
-                VF_HZSTACKFIELD,
-                VF_WHIRL,
-                VF_EQUALIZER,
-                VF_VOBSUB,
-                VF_CHFPS,
-                VF_RESAMPLE_FPS,
-                VF_LAVPP_DEINT,
-                VF_UNSTACK_FIELD,
-                VF_HUE,
-                VF_EQ2,
-                VF_DGBOB,
-                VF_MSHARPEN,
-                VF_ASHARP,
-                VF_CNR2,
-                VF_DELTA,
-                VF_UNBLEND,
-                VF_HARDIVTC,
-                VF_MOSAIC,
-                VF_BLENDREMOVAL,
-                VF_TDEINT,
-                VF_MPDELOGO,
-                VF_COLOR_YUV,
-                VF_ANIMATED,
-                VF_MCDEINT,
-                VF_REVERSE,
-                VF_FADE,
-                VF_ASS,
-                VF_YADIF,
-                VF_DVBSUB,
-                VF_LOGO,
-                VF_COMPUTEAVERAGE,
-                VF_ERASER,
-                VF_SWISSARMYKNIFE,
-                VF_THRESHOLD,
-                VF_PARTICLELIST,
-                VF_DUMMY,
-                VF_COUNT,
-                MAX_FILTER = VF_COUNT - 1,
-                VF_EXTERNAL_START=0xF0000000
-          }VF_FILTERS;
+#define VF_PARTIAL_FILTER 9
+#define VF_START_TAG 	  10
 
+typedef uint32_t VF_FILTERS ;
 typedef AVDMGenericVideoStream *(ADM_createT) (AVDMGenericVideoStream *in, CONFcouple *);
 typedef AVDMGenericVideoStream *(ADM_create_from_scriptT) (AVDMGenericVideoStream *in, int n,Arg *args);
 
-         
-   struct FILTER_ENTRY
-   {
-        const char        *name;
-        ADM_createT       *create;
-        void              (*destroy)( AVDMGenericVideoStream *old); /* Maybe needed ...*/
-        VF_FILTERS        tag;
-        uint8_t           viewable;
-        const char        *filtername;
-        const char        *description;
-        ADM_create_from_scriptT *create_from_script;
-        VF_CATEGORY		  category;
-       FILTER_ENTRY (const char * name, ADM_createT * create, VF_FILTERS tag,
-                     uint8_t viewable, const char * filtername,
-                     VF_CATEGORY category=VF_MISC,
-                     const char * description = 0,
-                     ADM_create_from_scriptT * create_from_script = 0)
-           : name (name),
-             create (create),
-             destroy (0),
-             tag (tag),
-             viewable (viewable),
-             filtername (filtername),
-             description (description),
-             category(category),
-             create_from_script (create_from_script)
-       {
-       }
-
-       FILTER_ENTRY ()
-           : name (0),
-             create (0),
-             destroy (0),
-             tag (VF_INVALID),
-             viewable (0),
-             filtername (0),
-             description (0),
-             category(VF_MISC),
-             create_from_script (0)
-       {
-       }
-   };
+class FilterDescriptor
+{
+public:
+	
+	 		const char *name; // external name asprinted
+			const char *filterName; // internal name, used to lookup a filter by its name
+			const char *description; // Description 
+			const VF_CATEGORY category;
+		
+			const ADM_createT *create;
+			const ADM_create_from_scriptT *create_from_script;
+			const void (*destroy)(AVDMGenericVideoStream *old); /* Maybe needed ...*/
+		
+			const uint32_t apiVersion;
+			const uint32_t filterVersion;
+			VF_FILTERS tag;
+			
+		
+			FilterDescriptor(uint32_t tag,
+					const char *name,
+					const char *filtername,
+					const char *descTex,
+					VF_CATEGORY category,
+					AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *),
+					AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),
+					uint32_t apiVersion=ADM_FILTER_API_VERSION,uint32_t filterVersion=1):
+						tag(tag),
+						name(name),filterName(filtername),description(descTex),category(category),
+						create(create),create_from_script(create_from_script),destroy(NULL),
+						apiVersion(apiVersion),filterVersion(filterVersion)
+					
+			{
+				tag=0;
+			}
+};   
  	
    typedef struct
    {
@@ -175,42 +81,28 @@
           AVDMGenericVideoStream *filter;
           CONFcouple             *conf;
    }FILTER;
-
- 
    
+/* Number of activated filters you can have ..*/   
+#define VF_MAX_FILTER 100
+ 
+/* Some utility functions to deal with filter list */   
+FILTER      *getCurrentVideoFilterList (uint32_t * count);
+const FilterDescriptor * filterGetEntryFromTag (VF_FILTERS tag);
+const char *filterGetNameFromTag(VF_FILTERS tag);
+VF_FILTERS 	filterGetTagFromName(char *inname);
+uint8_t 	filterAddScript(VF_FILTERS tags,uint32_t n,Arg *args);
 
-FILTER * getCurrentVideoFilterList (uint32_t * count);
-const FILTER_ENTRY * filterGetEntryFromTag (VF_FILTERS tag);
-const char * filterGetNameFromTag(VF_FILTERS tag);
+/* Statically register filters */
+void registerFilterEx(const char *name,const char *filtername,VF_CATEGORY category,
+		AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *),
+		AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),
+		const char *descText);
 
-  void	filterSetPostProc( void );
-  
-#ifdef USE_LIBXML2
+/* Save / load filters */
 void filterSaveXml(char *name);
 void filterSaveXml(char *name,uint8_t silent);
 void filterLoadXml(char *name);
 int  filterLoadXml(char *name,uint8_t silent);
-#endif
- void filterSave(char *name);
- void filterLoad(char *name);
- int filterLoad(char *name,uint8_t silent);
- void filterSave(char *name,uint8_t silent);
-
 void filterSaveScriptJS(FILE *f);
 
-void registerFilter(const char *name,VF_FILTERS tag,uint8_t viewable,
-                    ADM_createT  *create,
-                    const char *fname);
-                    
-void registerFilterEx(const char *name,VF_FILTERS tag,uint8_t viewable,
-                ADM_createT  *create,
-                const char *filtername,
-                ADM_create_from_scriptT *create_from_script,
-                const char *description);
-                
-void 		filterListAll( void );
-VF_FILTERS 	filterGetTagFromName(char *inname);
-uint8_t 	filterAddScript(VF_FILTERS tags,uint32_t n,Arg *args);
-//AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,uint8_t *conf, AVDMGenericVideoStream *in) ;
-
  #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -38,11 +38,16 @@
 #include &quot;ADM_osSupport/ADM_quota.h&quot;
 //
 // exported vars
-std::vector &lt;FILTER_ENTRY&gt; allfilters;
+std::vector &lt;FilterDescriptor *&gt; allfilters;
+std::vector &lt;FilterDescriptor *&gt; filterCategories[VF_MAX];
+
 uint32_t nb_active_filter=0;
-FILTER  videofilters[MAX_FILTER];
+FILTER  videofilters[VF_MAX_FILTER];
 
+
+
 static uint32_t lastStart=0, lastNb=0;
+static uint32_t tagCount=VF_START_TAG;
 
 extern ADM_Composer *video_body;
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *conf, AVDMGenericVideoStream *in) ;
@@ -83,8 +88,8 @@
 	printf(&quot;\nVideo filters\n&quot;);
 	for(uint32_t i=0;i&lt;allfilters.size();i++)
 	{
-		name=allfilters[ i].filtername;
-		if(allfilters[ i].viewable)
+		name=allfilters[i]-&gt;filterName;
+		
 		{
 			if(name)
 				printf(&quot;\t%s\n&quot;,name);
@@ -95,48 +100,47 @@
 VF_FILTERS filterGetTagFromName(char *inname)
 {
 const char *name;
-	VF_FILTERS filter=VF_DUMMY;
+	VF_FILTERS filter=VF_INVALID;
 	for(uint32_t i=0;i&lt;allfilters.size();i++)
 	{
-		name=allfilters[ i].filtername;
-		if(allfilters[ i].viewable || allfilters[i].tag==VF_PARTIAL)
+		name=allfilters[ i]-&gt;filterName;
+		if( allfilters[i]-&gt;tag==VF_PARTIAL_FILTER)
 		{
 			if(name)
 			{
 				if(strlen(name))
 				{
 					if(!strcasecmp(name,inname))
-						return allfilters[ i].tag; 
+						return allfilters[ i]-&gt;tag; 
 				}
 			}
 		}
 	}
 	return filter;
 }
-void registerFilter(const char *name,VF_FILTERS tag,uint8_t viewable
-		,AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *)
-		,const char *filtername)
-{
-//        printf (&quot;*nb_video_filter() = %d, max %d, name = %s\n&quot;, nb_video_filter(), (MAX_FILTER-1), name);
-        allfilters.push_back (FILTER_ENTRY (name, create, tag, viewable, filtername));
 
-        if(viewable==1)
-	{
-        	aprintf(&quot;\nRegistered filter %lu: %s&quot;,allfilters.size(),name);
-	}
-}
-void registerFilterEx(const char *name,VF_FILTERS tag,uint8_t viewable
-		,AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *)
-		,const char *filtername,AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),const char *desc)
+/**
+ * 	\fn registerFilterEx
+ *  \brief Register a video filter
+ */
+void registerFilterEx(const char *name,const char *filtername,VF_CATEGORY category,
+		AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *),
+		AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),
+		const char *descText)
 {
-//    printf (&quot;nb_video_filter = %d, max %d, name = %s\n&quot;, nb_video_filter, (MAX_FILTER-1), name);
-        allfilters.push_back (FILTER_ENTRY (name, create, tag, viewable,
-                                            filtername, VF_MISC,desc, create_from_script));
 
-        if(viewable==1)
-	{
-        	aprintf(&quot;\nRegistered filter %lu: %s&quot;,allfilters.size(),name);
-	}
+	FilterDescriptor *desc=new FilterDescriptor(tagCount++,filtername,name,
+												descText,
+												category,
+												create,
+												create_from_script);
+	
+		ADM_assert(desc-&gt;category&lt;VF_MAX);
+	
+        allfilters.push_back (desc);
+        filterCategories[desc-&gt;category].push_back(desc);
+        
+        aprintf(&quot;[Filters] Registered filter %s\n&quot;,desc-&gt;name);
 
 
 }
@@ -264,25 +268,13 @@
 	 AVDMGenericVideoStream *filter;
 
 			ADM_assert(tag!=VF_INVALID);
-                        if(tag&gt;=VF_EXTERNAL_START)
+                       
                         {
-                          // start from the end, it is an external filter 
-                          for(uint32_t i=allfilters.size()-1;i&gt;=0;i--)
-                          {
-                              if(tag==allfilters[i].tag)
-                                {
-                                        filter=allfilters[i].create( in, couple);
-                                        return filter;
-                                }
-                          }
-                        } // else search forward
-                        else
-                        {
                           for(unsigned int i=0;i&lt;allfilters.size();i++)
                                   {
-                                          if(tag==allfilters[i].tag)
+                                          if(tag==allfilters[i]-&gt;tag)
                                                   {
-                                                          filter=allfilters[i].create( in, couple);
+                                                          filter=allfilters[i]-&gt;create( in, couple);
                                                           return filter;
                                                   }
                                   }
@@ -294,14 +286,14 @@
 
 
 */
-const FILTER_ENTRY * filterGetEntryFromTag (VF_FILTERS tag)
+const FilterDescriptor * filterGetEntryFromTag (VF_FILTERS tag)
 {
     ADM_assert(tag!=VF_INVALID);
     for(unsigned int i=0;i&lt;allfilters.size();i++)
     {
-        if(tag==allfilters[i].tag)
+        if(tag==allfilters[i]-&gt;tag)
         {
-            return &amp;(allfilters[i]);
+            return (allfilters[i]);
         }
     }
     ADM_assert(0);
@@ -310,7 +302,7 @@
 
 const char  *filterGetNameFromTag(VF_FILTERS tag)
 {
-    const FILTER_ENTRY * entry = filterGetEntryFromTag (tag);
+    const FilterDescriptor * entry = filterGetEntryFromTag (tag);
     ADM_assert(entry);
     return entry-&gt;name;
 }
@@ -441,7 +433,7 @@
 
 	for(unsigned int i=0;i&lt;allfilters.size();i++)
 	{
-		if(tag==allfilters[i].tag)
+		if(tag==allfilters[i]-&gt;tag)
 		{
 			if(nb_active_filter&lt;1)
 			{
@@ -450,12 +442,12 @@
 			}
 			AVDMGenericVideoStream *filter=NULL;
 			CONFcouple *setup=NULL;
-			if(!allfilters[i].create_from_script)
+			if(!allfilters[i]-&gt;create_from_script)
 			{
 				printf(&quot;That filter cannot be created from script\n&quot;);
 				return 0;
 			}
-			filter=allfilters[i].create_from_script(videofilters[nb_active_filter-1].filter,n-1,&amp;(args[1]));
+			filter=allfilters[i]-&gt;create_from_script(videofilters[nb_active_filter-1].filter,n-1,&amp;(args[1]));
 			if(!filter) return 0;
 			videofilters[nb_active_filter].filter=filter;
 			videofilters[nb_active_filter].tag=tag;						
@@ -477,9 +469,9 @@
                         qfprintf(f,&quot;app.video.addFilter(&quot;);
                         for(unsigned int j=0;j&lt;allfilters.size();j++)
                                 {
-                                        if(tag==allfilters[j].tag)
+                                        if(tag==allfilters[j]-&gt;tag)
                                         {       
-                                                qfprintf(f,&quot;\&quot;%s\&quot;&quot;,allfilters[j].filtername);
+                                                qfprintf(f,&quot;\&quot;%s\&quot;&quot;,allfilters[j]-&gt;filterName);
                                                 break;  
                                         }
                                 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_declaration.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -21,17 +21,24 @@
 #include &quot;config.h&quot;
 #include &quot;ADM_default.h&quot;
 
-#ifdef HAVE_ENCODER
 
 
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
-#define FILTERDEC(x) extern   AVDMGenericVideoStream *x(AVDMGenericVideoStream *in, CONFcouple *param)
-#define FILTERDECX(x) extern   AVDMGenericVideoStream *x(AVDMGenericVideoStream *in, int n,Arg *args)
-#define REGISTER(e,a,g,b,c,d) {FILTERDEC(d);registerFilterEx(a,b,c,d,e,NULL,NULL);}
-#define REGISTERX(e,a,g,b,c,d,f) {\
-FILTERDECX(f);\
-FILTERDEC(d);registerFilterEx((char*)a,b,c,d,e,f,(char*)g);\
+/*
+void registerFilterEx(const char *name,const char *filtername,VF_CATEGORY category,
+		AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *),
+		AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),
+		const char *descText)
+*/
+
+#define FILTERDEC_create(x) extern   AVDMGenericVideoStream *x(AVDMGenericVideoStream *in, CONFcouple *param)
+#define FILTERDEC_createFromScript(x) extern   AVDMGenericVideoStream *x(AVDMGenericVideoStream *in, int n,Arg *args)
+
+#define REGISTERX(z,a,b,c,d,e,f,g) {\
+			FILTERDEC_create(f);\
+			FILTERDEC_createFromScript(g);\
+			registerFilterEx((const char*)a,(const char *)b,z,f,g,(const char *)c);\
 }
 
 void registerVideoFilters( void )
@@ -40,155 +47,127 @@
 printf(  &quot;*********************\n&quot;);
 
 	
-	registerFilter(&quot;---- Image size/border alteration----&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-	REGISTERX(&quot;crop&quot;,QT_TR_NOOP(&quot;Crop&quot;),QT_TR_NOOP(&quot;Remove lines from top/bottom/left/right.&quot;),VF_CROP,1,crop_create,crop_script);
-	REGISTERX(&quot;mpresize&quot;,QT_TR_NOOP(&quot;MPlayer resize&quot;),QT_TR_NOOP(&quot;Change image size. Faster than Avisynth's Resize.&quot;),VF_MPLAYERRESIZE,1,mpresize_create,mpresize_script);
-	REGISTERX(&quot;resize&quot;,QT_TR_NOOP(&quot;Resize&quot;),QT_TR_NOOP(&quot;Picture resizer ported from Avisynth.&quot;), VF_RESIZE,1,res_create,resize_script);
-  	REGISTERX(&quot;addblack&quot;,QT_TR_NOOP(&quot;Add black borders&quot;),QT_TR_NOOP(&quot;Add pure black border(s). Enlarges the picture.&quot;),VF_ADDBORDER,1,addBorder_create,addBorder_script);
-	REGISTERX(&quot;blacken&quot;,QT_TR_NOOP(&quot;Blacken borders&quot;),QT_TR_NOOP(&quot;Fill borders with pure black. Doesn't alter size.&quot;),VF_BLACKEN,1,bsmear_create,bsmear_script);
-  	REGISTERX(&quot;vflip&quot;,QT_TR_NOOP(&quot;Vertical flip&quot;),QT_TR_NOOP(&quot;Vertically flip the picture.&quot;),VF_FLIP,1,flipv_create,flipv_script);
-	REGISTERX(&quot;rotate&quot;,QT_TR_NOOP(&quot;Rotate&quot;),QT_TR_NOOP(&quot;Rotate the picture by 90, 180 or 270 degrees.&quot;),VF_ROTATE,1,rotate_create,rotate_script);
-        //REGISTERX(&quot;chfps&quot;,&quot;Change FPS&quot;,VF_CHFPS,1,chfps_create,chfps_script);
-        REGISTERX(&quot;resamplefps&quot;,QT_TR_NOOP(&quot;Resample fps&quot;),QT_TR_NOOP(&quot;Change framerate while keeping duration.&quot;),VF_RESAMPLE_FPS,1,resamplefps_create,resamplefps_script);                
-        REGISTERX(&quot;reverse&quot;,QT_TR_NOOP(&quot;Reverse&quot;),QT_TR_NOOP(&quot;Play video backward.&quot;),VF_REVERSE,1,reverse_create,reverse_script);
-        REGISTERX(&quot;fade&quot;,QT_TR_NOOP(&quot;Fade&quot;),QT_TR_NOOP(&quot;Fade in/out.&quot;),VF_FADE,1,fade_create,fade_script);     
+	REGISTERX(VF_TRANSFORM, &quot;crop&quot;,QT_TR_NOOP(&quot;Crop&quot;),QT_TR_NOOP(&quot;Remove lines from top/bottom/left/right.&quot;),VF_CROP,1,crop_create,crop_script);
+	REGISTERX(VF_TRANSFORM, &quot;mpresize&quot;,QT_TR_NOOP(&quot;MPlayer resize&quot;),QT_TR_NOOP(&quot;Change image size. Faster than Avisynth's Resize.&quot;),VF_MPLAYERRESIZE,1,mpresize_create,mpresize_script);
+	REGISTERX(VF_TRANSFORM, &quot;resize&quot;,QT_TR_NOOP(&quot;Resize&quot;),QT_TR_NOOP(&quot;Picture resizer ported from Avisynth.&quot;), VF_RESIZE,1,res_create,resize_script);
+  	REGISTERX(VF_TRANSFORM, &quot;addblack&quot;,QT_TR_NOOP(&quot;Add black borders&quot;),QT_TR_NOOP(&quot;Add pure black border(s). Enlarges the picture.&quot;),VF_ADDBORDER,1,addBorder_create,addBorder_script);
+	REGISTERX(VF_TRANSFORM, &quot;blacken&quot;,QT_TR_NOOP(&quot;Blacken borders&quot;),QT_TR_NOOP(&quot;Fill borders with pure black. Doesn't alter size.&quot;),VF_BLACKEN,1,bsmear_create,bsmear_script);
+  	REGISTERX(VF_TRANSFORM, &quot;vflip&quot;,QT_TR_NOOP(&quot;Vertical flip&quot;),QT_TR_NOOP(&quot;Vertically flip the picture.&quot;),VF_FLIP,1,flipv_create,flipv_script);
+	REGISTERX(VF_TRANSFORM, &quot;rotate&quot;,QT_TR_NOOP(&quot;Rotate&quot;),QT_TR_NOOP(&quot;Rotate the picture by 90, 180 or 270 degrees.&quot;),VF_ROTATE,1,rotate_create,rotate_script);
+    REGISTERX(VF_TRANSFORM, &quot;resamplefps&quot;,QT_TR_NOOP(&quot;Resample fps&quot;),QT_TR_NOOP(&quot;Change framerate while keeping duration.&quot;),VF_RESAMPLE_FPS,1,resamplefps_create,resamplefps_script);                
+    REGISTERX(VF_TRANSFORM, &quot;reverse&quot;,QT_TR_NOOP(&quot;Reverse&quot;),QT_TR_NOOP(&quot;Play video backward.&quot;),VF_REVERSE,1,reverse_create,reverse_script);
+    REGISTERX(VF_TRANSFORM, &quot;fade&quot;,QT_TR_NOOP(&quot;Fade&quot;),QT_TR_NOOP(&quot;Fade in/out.&quot;),VF_FADE,1,fade_create,fade_script);     
 
-	registerFilter(&quot;----------- Interlacing -------------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-	// Buggy : Removed REGISTER(&quot;IVTC&quot;,VF_IVTC,1,ivtc_create);
-//	REGISTERX(&quot;mpivtc&quot;,&quot;Mplayer ivtc&quot;,VF_MPDETC,1,mpdetc_create,mpdetc_script);	
-        REGISTERX(&quot;YADIF&quot;,QT_TR_NOOP(&quot;yadif&quot;),QT_TR_NOOP(&quot;Yet Another DeInterlacer. Ported from MPlayer.&quot;),VF_YADIF,1,yadif_create,yadif_script);
-        REGISTERX(&quot;mcdeinterlace&quot;,QT_TR_NOOP(&quot;mcDeinterlace&quot;),QT_TR_NOOP(&quot;Motion compensation deinterlacer. Ported from MPlayer.&quot;),VF_MCDEINT,1,mcdeint_create,mcdeint_script);
-	REGISTERX(&quot;deinterlace&quot;,QT_TR_NOOP(&quot;Deinterlace&quot;),QT_TR_NOOP(&quot;Mask interlacing artifacts. Port of Smart deinterlace.&quot;),VF_DEINTERLACE,1,deinterlace_create,deinterlace_script);
-	REGISTERX(&quot;kerneldeint&quot;,QT_TR_NOOP(&quot;KernelDeint&quot;),QT_TR_NOOP(&quot;Kernel deinterlacer by Donald Graft.&quot;),VF_KRNDEINT,1,kerneldeint_create,kerneldeint_script);
-        REGISTERX(&quot;tdeint&quot;,QT_TR_NOOP(&quot;TDeint&quot;),QT_TR_NOOP(&quot;Motion adaptative deinterlacer by Tritical.&quot;),VF_TDEINT,1,tdeint_create,tdeint_script);
-        REGISTERX(&quot;lavcppdeint&quot;,QT_TR_NOOP(&quot;libavcodec deinterlacer&quot;),QT_TR_NOOP(&quot;All FFmpeg deinterlace filters (bicubic, median, ...).&quot;),VF_LAVPP_DEINT,1,lavppdeint_create,lavppdeint_script);
-	REGISTERX(&quot;telecide&quot;,QT_TR_NOOP(&quot;Decomb Telecide&quot;),QT_TR_NOOP(&quot;Great deinterlacing package including IVTC.&quot;),VF_DECOMB,1,decomb_create,decomb_script);
-	REGISTERX(&quot;decimate&quot;,QT_TR_NOOP(&quot;Decomb Decimate&quot;),QT_TR_NOOP(&quot;Useful to remove dupes left by Telecide.&quot;),VF_DECIMATE,1,decimate_create,decimate_script);
-	REGISTERX(&quot;pulldown&quot;,QT_TR_NOOP(&quot;Pulldown&quot;),QT_TR_NOOP(&quot;Convert 24 fps to 30 fps by repeating fields.&quot;),VF_PULLDOWN,1,pulldown_create,pulldown_script);
-	
-	REGISTERX(&quot;dgbob&quot;,&quot;DGBob&quot;,QT_TR_NOOP(&quot;Bobber - convert each field into a full sized frame.&quot;),VF_DGBOB,1,dgbob_create,dgbob_script);
+    REGISTERX(VF_INTERLACING, &quot;YADIF&quot;,QT_TR_NOOP(&quot;yadif&quot;),QT_TR_NOOP(&quot;Yet Another DeInterlacer. Ported from MPlayer.&quot;),VF_YADIF,1,yadif_create,yadif_script);
+    REGISTERX(VF_INTERLACING, &quot;mcdeinterlace&quot;,QT_TR_NOOP(&quot;mcDeinterlace&quot;),QT_TR_NOOP(&quot;Motion compensation deinterlacer. Ported from MPlayer.&quot;),VF_MCDEINT,1,mcdeint_create,mcdeint_script);
+	REGISTERX(VF_INTERLACING, &quot;deinterlace&quot;,QT_TR_NOOP(&quot;Deinterlace&quot;),QT_TR_NOOP(&quot;Mask interlacing artifacts. Port of Smart deinterlace.&quot;),VF_DEINTERLACE,1,deinterlace_create,deinterlace_script);
+	REGISTERX(VF_INTERLACING, &quot;kerneldeint&quot;,QT_TR_NOOP(&quot;KernelDeint&quot;),QT_TR_NOOP(&quot;Kernel deinterlacer by Donald Graft.&quot;),VF_KRNDEINT,1,kerneldeint_create,kerneldeint_script);
+    REGISTERX(VF_INTERLACING, &quot;tdeint&quot;,QT_TR_NOOP(&quot;TDeint&quot;),QT_TR_NOOP(&quot;Motion adaptative deinterlacer by Tritical.&quot;),VF_TDEINT,1,tdeint_create,tdeint_script);
+    REGISTERX(VF_INTERLACING, &quot;lavcppdeint&quot;,QT_TR_NOOP(&quot;libavcodec deinterlacer&quot;),QT_TR_NOOP(&quot;All FFmpeg deinterlace filters (bicubic, median, ...).&quot;),VF_LAVPP_DEINT,1,lavppdeint_create,lavppdeint_script);
+	REGISTERX(VF_INTERLACING, &quot;telecide&quot;,QT_TR_NOOP(&quot;Decomb Telecide&quot;),QT_TR_NOOP(&quot;Great deinterlacing package including IVTC.&quot;),VF_DECOMB,1,decomb_create,decomb_script);
+	REGISTERX(VF_INTERLACING, &quot;decimate&quot;,QT_TR_NOOP(&quot;Decomb Decimate&quot;),QT_TR_NOOP(&quot;Useful to remove dupes left by Telecide.&quot;),VF_DECIMATE,1,decimate_create,decimate_script);
+	REGISTERX(VF_INTERLACING, &quot;pulldown&quot;,QT_TR_NOOP(&quot;Pulldown&quot;),QT_TR_NOOP(&quot;Convert 24 fps to 30 fps by repeating fields.&quot;),VF_PULLDOWN,1,pulldown_create,pulldown_script);	
+	REGISTERX(VF_INTERLACING, &quot;dgbob&quot;,&quot;DGBob&quot;,QT_TR_NOOP(&quot;Bobber - convert each field into a full sized frame.&quot;),VF_DGBOB,1,dgbob_create,dgbob_script);
+    REGISTERX(VF_INTERLACING, &quot;palfieldshift&quot;,QT_TR_NOOP(&quot;PAL field shift&quot;),QT_TR_NOOP(&quot;Shift fields by one. Useful for some PAL movies.&quot;),VF_PALSHIFT,1,addPALShift_create,addPALShift_script);	
+	REGISTERX(VF_INTERLACING, &quot;palsmart&quot;,QT_TR_NOOP(&quot;PAL smart&quot;),QT_TR_NOOP(&quot;Smartly revert non constant PAL field shift.&quot;),VF_TELECIDE,1,telecide_create,telecide_script);
 
-        REGISTERX(&quot;palfieldshift&quot;,QT_TR_NOOP(&quot;PAL field shift&quot;),QT_TR_NOOP(&quot;Shift fields by one. Useful for some PAL movies.&quot;),VF_PALSHIFT,1,addPALShift_create,addPALShift_script);	
-	REGISTERX(&quot;palsmart&quot;,QT_TR_NOOP(&quot;PAL smart&quot;),QT_TR_NOOP(&quot;Smartly revert non constant PAL field shift.&quot;),VF_TELECIDE,1,telecide_create,telecide_script);
-//	REGISTERX(&quot;lavdeint&quot;,&quot;Lavcodec Deinterlacer&quot;,VF_LAVDEINT,1,lavdeint_create,lavdeint_script);
+	//	REGISTERX(&quot;lavdeint&quot;,&quot;Lavcodec Deinterlacer&quot;,VF_LAVDEINT,1,lavdeint_create,lavdeint_script);
         
         
 	
-	REGISTERX(&quot;drop&quot;,QT_TR_NOOP(&quot;Drop&quot;),QT_TR_NOOP(&quot;Drop damaged fields (e.g. from VHS capture).&quot;),VF_DROPOUT,1,dropout_create,dropout_script);
-	REGISTERX(&quot;swapfields&quot;,QT_TR_NOOP(&quot;Swap fields&quot;),QT_TR_NOOP(&quot;Swap top and bottom fields.&quot;),VF_SWAPFIELDS,1,swapfield_create,swapfield_script);
-	REGISTERX(&quot;smartswapfield&quot;,QT_TR_NOOP(&quot;Smart swap fields&quot;),QT_TR_NOOP(&quot;Smartly swap fields. Needed when field order changes.&quot;),VF_SMARTSWAPFIELDS,1,swapsmart_create,swapsmart_script);
+	REGISTERX(VF_INTERLACING, &quot;drop&quot;,QT_TR_NOOP(&quot;Drop&quot;),QT_TR_NOOP(&quot;Drop damaged fields (e.g. from VHS capture).&quot;),VF_DROPOUT,1,dropout_create,dropout_script);
+	REGISTERX(VF_INTERLACING, &quot;swapfields&quot;,QT_TR_NOOP(&quot;Swap fields&quot;),QT_TR_NOOP(&quot;Swap top and bottom fields.&quot;),VF_SWAPFIELDS,1,swapfield_create,swapfield_script);
+	REGISTERX(VF_INTERLACING, &quot;smartswapfield&quot;,QT_TR_NOOP(&quot;Smart swap fields&quot;),QT_TR_NOOP(&quot;Smartly swap fields. Needed when field order changes.&quot;),VF_SMARTSWAPFIELDS,1,swapsmart_create,swapsmart_script);
 
-	REGISTERX(&quot;keepevenfield&quot;,QT_TR_NOOP(&quot;Keep even fields&quot;),QT_TR_NOOP(&quot;Keep top fields. Gives a half height picture.&quot;),VF_KEEPEVEN,1,keepeven_create,keepeven_script);
-	REGISTERX(&quot;keepoddfield&quot;,QT_TR_NOOP(&quot;Keep odd fields&quot;),QT_TR_NOOP(&quot;Keep bottom fileds. Gives a half height picture.&quot;),VF_KEEPODD,1,keepodd_create,keepodd_script);
-	REGISTERX(&quot;separatefields&quot;,QT_TR_NOOP(&quot;Separate fields&quot;),QT_TR_NOOP(&quot;Each field becomes full picture, half sized.&quot;),VF_SEPARATEFIELDS,1, separatefield_create,separatefield_script);
-	REGISTERX(&quot;mergefield&quot;,QT_TR_NOOP(&quot;Merge fields&quot;),QT_TR_NOOP(&quot;Merge two pictures as if they were two fields.&quot;),VF_MERGEFIELDS,1,mergefield_create,mergefield_script);
+	REGISTERX(VF_INTERLACING, &quot;keepevenfield&quot;,QT_TR_NOOP(&quot;Keep even fields&quot;),QT_TR_NOOP(&quot;Keep top fields. Gives a half height picture.&quot;),VF_KEEPEVEN,1,keepeven_create,keepeven_script);
+	REGISTERX(VF_INTERLACING, &quot;keepoddfield&quot;,QT_TR_NOOP(&quot;Keep odd fields&quot;),QT_TR_NOOP(&quot;Keep bottom fileds. Gives a half height picture.&quot;),VF_KEEPODD,1,keepodd_create,keepodd_script);
+	REGISTERX(VF_INTERLACING, &quot;separatefields&quot;,QT_TR_NOOP(&quot;Separate fields&quot;),QT_TR_NOOP(&quot;Each field becomes full picture, half sized.&quot;),VF_SEPARATEFIELDS,1, separatefield_create,separatefield_script);
+	REGISTERX(VF_INTERLACING, &quot;mergefield&quot;,QT_TR_NOOP(&quot;Merge fields&quot;),QT_TR_NOOP(&quot;Merge two pictures as if they were two fields.&quot;),VF_MERGEFIELDS,1,mergefield_create,mergefield_script);
 
-
-        REGISTERX(&quot;hzstackfield&quot;,QT_TR_NOOP(&quot;Hz Stack fields&quot;),QT_TR_NOOP(&quot;Put botj fields side by side.&quot;),VF_HZSTACKFIELD,1,hzstackfield_create,hzstackfield_script);
+    REGISTERX(VF_INTERLACING, &quot;hzstackfield&quot;,QT_TR_NOOP(&quot;Hz Stack fields&quot;),QT_TR_NOOP(&quot;Put botj fields side by side.&quot;),VF_HZSTACKFIELD,1,hzstackfield_create,hzstackfield_script);
         
+	REGISTERX(VF_INTERLACING, &quot;stackfield&quot;,QT_TR_NOOP(&quot;Stack fields&quot;),QT_TR_NOOP(&quot;Put two fields on top of one another.&quot;),VF_STACKFIELD,1,stackfield_create,stackfield_script);
+    REGISTERX(VF_INTERLACING, &quot;unstackfield&quot;,QT_TR_NOOP(&quot;Unstack fields&quot;),QT_TR_NOOP(&quot;Interleave top and bottom part of the picture.&quot;),VF_UNSTACK_FIELD,1,unstackfield_create,unstackfield_script);
 
-	REGISTERX(&quot;stackfield&quot;,QT_TR_NOOP(&quot;Stack fields&quot;),QT_TR_NOOP(&quot;Put two fields on top of one another.&quot;),VF_STACKFIELD,1,stackfield_create,stackfield_script);
-        REGISTERX(&quot;unstackfield&quot;,QT_TR_NOOP(&quot;Unstack fields&quot;),QT_TR_NOOP(&quot;Interleave top and bottom part of the picture.&quot;),VF_UNSTACK_FIELD,1,unstackfield_create,unstackfield_script);
-	
-	registerFilter(&quot;------------ Luma/Chroma ------------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++              
-        REGISTERX(&quot;eq2&quot;,QT_TR_NOOP(&quot;MPlayer eq2&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness, saturation and gamma.&quot;),VF_EQ2,1,Eq2_create,Eq2_script);
-        REGISTERX(&quot;hue&quot;,QT_TR_NOOP(&quot;MPlayer hue&quot;),QT_TR_NOOP(&quot;Adjust hue and saturation.&quot;),VF_HUE,1,hue_create,hue_script);
-        REGISTERX(&quot;contrast&quot;,QT_TR_NOOP(&quot;Contrast&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness and colors.&quot;),VF_CONTRAST,1,contrast_create,contrast_script);
-        REGISTERX(&quot;equalizer&quot;,QT_TR_NOOP(&quot;Luma equalizer&quot;),QT_TR_NOOP(&quot;Luma correction filter with histogram.&quot;),VF_EQUALIZER,1,equalizer_create,equalizer_script);
+    
+    
+    REGISTERX(VF_COLORS, &quot;eq2&quot;,QT_TR_NOOP(&quot;MPlayer eq2&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness, saturation and gamma.&quot;),VF_EQ2,1,Eq2_create,Eq2_script);
+    REGISTERX(VF_COLORS, &quot;hue&quot;,QT_TR_NOOP(&quot;MPlayer hue&quot;),QT_TR_NOOP(&quot;Adjust hue and saturation.&quot;),VF_HUE,1,hue_create,hue_script);
+    REGISTERX(VF_COLORS, &quot;contrast&quot;,QT_TR_NOOP(&quot;Contrast&quot;),QT_TR_NOOP(&quot;Adjust contrast, brightness and colors.&quot;),VF_CONTRAST,1,contrast_create,contrast_script);
+    REGISTERX(VF_COLORS, &quot;equalizer&quot;,QT_TR_NOOP(&quot;Luma equalizer&quot;),QT_TR_NOOP(&quot;Luma correction filter with histogram.&quot;),VF_EQUALIZER,1,equalizer_create,equalizer_script);
 
-        REGISTERX(&quot;swapuv&quot;,QT_TR_NOOP(&quot;Swap U and V&quot;),QT_TR_NOOP(&quot;Invert chroma U and chroma V.&quot;),VF_SWAPUV,1,swapuv_create,swapuv_script);
-        REGISTERX(&quot;chromashift&quot;,QT_TR_NOOP(&quot;Chroma shift&quot;),QT_TR_NOOP(&quot;Shift chroma U/V to fix badly synced luma/chroma.&quot;),VF_CHROMASHIFT,1,create_chromashift,chromashift_script);
+    REGISTERX(VF_COLORS, &quot;swapuv&quot;,QT_TR_NOOP(&quot;Swap U and V&quot;),QT_TR_NOOP(&quot;Invert chroma U and chroma V.&quot;),VF_SWAPUV,1,swapuv_create,swapuv_script);
+    REGISTERX(VF_COLORS, &quot;chromashift&quot;,QT_TR_NOOP(&quot;Chroma shift&quot;),QT_TR_NOOP(&quot;Shift chroma U/V to fix badly synced luma/chroma.&quot;),VF_CHROMASHIFT,1,create_chromashift,chromashift_script);
 
-        REGISTERX(&quot;lumaonly&quot;,QT_TR_NOOP(&quot;Luma only&quot;),QT_TR_NOOP(&quot;Convert picture to greyscale (black and white).&quot;),VF_LUMA,1,luma_create,luma_script);
-        REGISTERX(&quot;chromauonly&quot;,QT_TR_NOOP(&quot;Chroma U only&quot;),QT_TR_NOOP(&quot;Convert picture to grey, keeping only chroma U.&quot;),VF_CHROMAU,1,chromaU_create,chromaU_script);
-        REGISTERX(&quot;chromavonly&quot;,QT_TR_NOOP(&quot;Chroma V only&quot;),QT_TR_NOOP(&quot;Convert picture to grey, keeping only chroma V.&quot;),VF_CHROMAV,1,chromaV_create,chromaV_script);
-       
-        REGISTERX(&quot;delta&quot;,QT_TR_NOOP(&quot;Luma delta&quot;),QT_TR_NOOP(&quot;Difference between current and previous picture.&quot;),VF_DELTA,1,delta_create,delta_script);
-        REGISTERX(&quot;coloryuv&quot;,QT_TR_NOOP(&quot;Avisynth ColorYUV&quot;),QT_TR_NOOP(&quot;Alter colors (auto white balance etc...). Ported from Avisynth.&quot;),VF_COLOR_YUV,1,coloryuv_create,coloryuv_script);
-                 
+    REGISTERX(VF_COLORS, &quot;lumaonly&quot;,QT_TR_NOOP(&quot;Luma only&quot;),QT_TR_NOOP(&quot;Convert picture to greyscale (black and white).&quot;),VF_LUMA,1,luma_create,luma_script);
+    REGISTERX(VF_COLORS, &quot;chromauonly&quot;,QT_TR_NOOP(&quot;Chroma U only&quot;),QT_TR_NOOP(&quot;Convert picture to grey, keeping only chroma U.&quot;),VF_CHROMAU,1,chromaU_create,chromaU_script);
+    REGISTERX(VF_COLORS, &quot;chromavonly&quot;,QT_TR_NOOP(&quot;Chroma V only&quot;),QT_TR_NOOP(&quot;Convert picture to grey, keeping only chroma V.&quot;),VF_CHROMAV,1,chromaV_create,chromaV_script);
+   
+    REGISTERX(VF_COLORS, &quot;delta&quot;,QT_TR_NOOP(&quot;Luma delta&quot;),QT_TR_NOOP(&quot;Difference between current and previous picture.&quot;),VF_DELTA,1,delta_create,delta_script);
+    REGISTERX(VF_COLORS, &quot;coloryuv&quot;,QT_TR_NOOP(&quot;Avisynth ColorYUV&quot;),QT_TR_NOOP(&quot;Alter colors (auto white balance etc...). Ported from Avisynth.&quot;),VF_COLOR_YUV,1,coloryuv_create,coloryuv_script);
 
-
-       
     
-	
-	registerFilter(&quot;-------------- Smoother -------------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-	//   registerFilter(&quot;Temporal smoother&quot;,tempsmooth_create);	
-	REGISTERX(&quot;mpdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer denoise3d&quot;),QT_TR_NOOP(&quot;Reduce noise, smooth image, increase compressibility.&quot;),VF_MPLLQD3D,1,MPD3Dlow_create,MPD3Dlow_script);
-	REGISTERX(&quot;mphqdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer hqdn3d&quot;),QT_TR_NOOP(&quot;High quality version of denoise3d. Slower but more precise.&quot;),VF_MPLHQD3D,1,MPD3D_create,MPD3D_script);
-	REGISTERX(&quot;fluxsmooth&quot;,QT_TR_NOOP(&quot;FluxSmooth&quot;),QT_TR_NOOP(&quot;Spatio-temporal cleaner by Ross Thomas.&quot;),VF_FLUXSMOOTH,1,fluxsmooth_create,fluxsmooth_script);
+    REGISTERX(VF_NOISE, &quot;mpdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer denoise3d&quot;),QT_TR_NOOP(&quot;Reduce noise, smooth image, increase compressibility.&quot;),VF_MPLLQD3D,1,MPD3Dlow_create,MPD3Dlow_script);
+	REGISTERX(VF_NOISE, &quot;mphqdenoise3d&quot;,QT_TR_NOOP(&quot;MPlayer hqdn3d&quot;),QT_TR_NOOP(&quot;High quality version of denoise3d. Slower but more precise.&quot;),VF_MPLHQD3D,1,MPD3D_create,MPD3D_script);
+	REGISTERX(VF_NOISE, &quot;fluxsmooth&quot;,QT_TR_NOOP(&quot;FluxSmooth&quot;),QT_TR_NOOP(&quot;Spatio-temporal cleaner by Ross Thomas.&quot;),VF_FLUXSMOOTH,1,fluxsmooth_create,fluxsmooth_script);
 #ifdef ADM_CPU_X86
-    	REGISTERX(&quot;temporalcleaner&quot;,QT_TR_NOOP(&quot;Temporal Cleaner&quot;),QT_TR_NOOP(&quot;Vlad59's Avisynth port of Jim Casaburi's denoiser.&quot;),VF_VLADSMOOTH,1,vladsmooth_create,vladsmooth_script);
+    	REGISTERX(VF_NOISE, &quot;temporalcleaner&quot;,QT_TR_NOOP(&quot;Temporal Cleaner&quot;),QT_TR_NOOP(&quot;Vlad59's Avisynth port of Jim Casaburi's denoiser.&quot;),VF_VLADSMOOTH,1,vladsmooth_create,vladsmooth_script);
 #endif
-	REGISTERX(&quot;denoise&quot;,QT_TR_NOOP(&quot;Denoise&quot;),QT_TR_NOOP(&quot;Port of Transcode DNR.&quot;),VF_DENOISE,1,denoise_create,denoise_script);
-	REGISTERX(&quot;stabilize&quot;,QT_TR_NOOP(&quot;Stabilize&quot;),QT_TR_NOOP(&quot;Light denoiser.&quot;),VF_STABILIZE,1,stabilize_create,stabilize_script);
+	REGISTERX(VF_NOISE, &quot;denoise&quot;,QT_TR_NOOP(&quot;Denoise&quot;),QT_TR_NOOP(&quot;Port of Transcode DNR.&quot;),VF_DENOISE,1,denoise_create,denoise_script);
+	REGISTERX(VF_NOISE, &quot;stabilize&quot;,QT_TR_NOOP(&quot;Stabilize&quot;),QT_TR_NOOP(&quot;Light denoiser.&quot;),VF_STABILIZE,1,stabilize_create,stabilize_script);
+    REGISTERX(VF_NOISE, &quot;cnr2&quot;,QT_TR_NOOP(&quot;Cnr2&quot;),QT_TR_NOOP(&quot;Chroma noise reduction filter by MarcFD/Tritical.&quot;),VF_CNR2,1,cnr2_create,cnr2_script);	
 
-        REGISTERX(&quot;cnr2&quot;,QT_TR_NOOP(&quot;Cnr2&quot;),QT_TR_NOOP(&quot;Chroma noise reduction filter by MarcFD/Tritical.&quot;),VF_CNR2,1,cnr2_create,cnr2_script);	
+	REGISTERX(VF_SHARPNESS, &quot;msmooth&quot;,QT_TR_NOOP(&quot;MSmooth by Donald Graft&quot;),QT_TR_NOOP(&quot;Smooth the image, don't blur edges. Useful on anime.&quot;),VF_MSMOOTH,1,create_msmooth,msmooth_script);
+	REGISTERX(VF_SHARPNESS, &quot;soften&quot;,QT_TR_NOOP(&quot;Soften&quot;),QT_TR_NOOP(&quot;A variant of stabilize.&quot;),VF_SOFTEN,1,soften_create,soften_script);
 
-	REGISTERX(&quot;msmooth&quot;,QT_TR_NOOP(&quot;MSmooth by Donald Graft&quot;),QT_TR_NOOP(&quot;Smooth the image, don't blur edges. Useful on anime.&quot;),VF_MSMOOTH,1,create_msmooth,msmooth_script);
-	REGISTERX(&quot;soften&quot;,QT_TR_NOOP(&quot;Soften&quot;),QT_TR_NOOP(&quot;A variant of stabilize.&quot;),VF_SOFTEN,1,soften_create,soften_script);
-
 	//REGISTERX(&quot;smoothclean&quot;,&quot;Smooth Clean&quot;,VF_SMOOTHCLEAN,0,smooth_create,smooth_script);
-        registerFilter(&quot;-------- Convolution Kernel ---------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-        REGISTERX(&quot;sharpen&quot;,QT_TR_NOOP(&quot;Sharpen&quot;),QT_TR_NOOP(&quot;Enhance difference between near pixels.&quot;),VF_SHARPEN,1,sharpen_create,sharpen_script);
-        REGISTERX(&quot;msharpen&quot;,QT_TR_NOOP(&quot;MSharpen&quot;),QT_TR_NOOP(&quot;Sharpen edges without amplifying noise. By Donald Graft.&quot;),VF_MSHARPEN,1,msharpen_create,msharpen_script);
-        REGISTERX(&quot;asharp&quot;,QT_TR_NOOP(&quot;asharp&quot;),QT_TR_NOOP(&quot;Adaptative sharpener by MarcFD.&quot;),VF_ASHARP,1,asharp_create,asharp_script);
+    REGISTERX(VF_SHARPNESS, &quot;sharpen&quot;,QT_TR_NOOP(&quot;Sharpen&quot;),QT_TR_NOOP(&quot;Enhance difference between near pixels.&quot;),VF_SHARPEN,1,sharpen_create,sharpen_script);
+    REGISTERX(VF_SHARPNESS, &quot;msharpen&quot;,QT_TR_NOOP(&quot;MSharpen&quot;),QT_TR_NOOP(&quot;Sharpen edges without amplifying noise. By Donald Graft.&quot;),VF_MSHARPEN,1,msharpen_create,msharpen_script);
+    REGISTERX(VF_SHARPNESS, &quot;asharp&quot;,QT_TR_NOOP(&quot;asharp&quot;),QT_TR_NOOP(&quot;Adaptative sharpener by MarcFD.&quot;),VF_ASHARP,1,asharp_create,asharp_script);
 
-        REGISTERX(&quot;gaussian&quot;,QT_TR_NOOP(&quot;Gauss smooth&quot;),QT_TR_NOOP(&quot;Gaussian smooth. Blur the picture.&quot;),VF_GAUSSIAN,1,Gaussian_create,gaussian_script);
-        REGISTERX(&quot;mean&quot;,QT_TR_NOOP(&quot;Mean&quot;),QT_TR_NOOP(&quot;Mean (blur) kernel.&quot;),VF_MEAN,1,mean_create,mean_script);
-        REGISTERX(&quot;median&quot;,QT_TR_NOOP(&quot;Median&quot;),QT_TR_NOOP(&quot;Median kernel 3x3. Remove high frequency noise.&quot;),VF_MEDIAN,1,median_create,median_script);
-        REGISTERX(&quot;largemedian&quot;,QT_TR_NOOP(&quot;Median (5x5)&quot;),QT_TR_NOOP(&quot;Median kernel 5x5. Good for reducing chroma noise.&quot;),VF_LARGEMEDIAN,1,largeMedian_create,largeMedian_script);
-        REGISTERX(&quot;forcedpp&quot;,QT_TR_NOOP(&quot;Forced postprocessing&quot;),QT_TR_NOOP(&quot;Apply blind postprocessing.&quot;),VF_FORCEDPP,1,forcedpp_create,forcedpp_script);        
+    REGISTERX(VF_SHARPNESS, &quot;gaussian&quot;,QT_TR_NOOP(&quot;Gauss smooth&quot;),QT_TR_NOOP(&quot;Gaussian smooth. Blur the picture.&quot;),VF_GAUSSIAN,1,Gaussian_create,gaussian_script);
+    REGISTERX(VF_SHARPNESS, &quot;mean&quot;,QT_TR_NOOP(&quot;Mean&quot;),QT_TR_NOOP(&quot;Mean (blur) kernel.&quot;),VF_MEAN,1,mean_create,mean_script);
+    REGISTERX(VF_SHARPNESS, &quot;median&quot;,QT_TR_NOOP(&quot;Median&quot;),QT_TR_NOOP(&quot;Median kernel 3x3. Remove high frequency noise.&quot;),VF_MEDIAN,1,median_create,median_script);
+    REGISTERX(VF_SHARPNESS, &quot;largemedian&quot;,QT_TR_NOOP(&quot;Median (5x5)&quot;),QT_TR_NOOP(&quot;Median kernel 5x5. Good for reducing chroma noise.&quot;),VF_LARGEMEDIAN,1,largeMedian_create,largeMedian_script);
+    REGISTERX(VF_SHARPNESS, &quot;forcedpp&quot;,QT_TR_NOOP(&quot;Forced postprocessing&quot;),QT_TR_NOOP(&quot;Apply blind postprocessing.&quot;),VF_FORCEDPP,1,forcedpp_create,forcedpp_script);        
 
-	registerFilter(&quot;----------------- Subs --------------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 #ifdef USE_FREETYPE   
-	REGISTERX(&quot;subtitle&quot;,QT_TR_NOOP(&quot;Subtitler&quot;),QT_TR_NOOP(&quot;Add srt/sub subtitles to the picture.&quot;),VF_SUBTILE,1,subtitle_create,subtitle_script);
-	REGISTERX(&quot;ass&quot;,QT_TR_NOOP(&quot;ASS&quot;),QT_TR_NOOP(&quot;Add ASS/SSA subtitles to the picture.&quot;),VF_ASS,1,ass_create,ass_script);
+	REGISTERX(VF_SUBTITLE, &quot;subtitle&quot;,QT_TR_NOOP(&quot;Subtitler&quot;),QT_TR_NOOP(&quot;Add srt/sub subtitles to the picture.&quot;),VF_SUBTILE,1,subtitle_create,subtitle_script);
+	REGISTERX(VF_SUBTITLE, &quot;ass&quot;,QT_TR_NOOP(&quot;ASS&quot;),QT_TR_NOOP(&quot;Add ASS/SSA subtitles to the picture.&quot;),VF_ASS,1,ass_create,ass_script);
 #endif
 
-        REGISTERX(&quot;vobsub&quot;,QT_TR_NOOP(&quot;VobSub&quot;),QT_TR_NOOP(&quot;Embed VobSub subtitles into picture.&quot;),VF_VOBSUB,1,vobsub_create,vobsub_script);
+        REGISTERX(VF_SUBTITLE,&quot;vobsub&quot;,QT_TR_NOOP(&quot;VobSub&quot;),QT_TR_NOOP(&quot;Embed VobSub subtitles into picture.&quot;),VF_VOBSUB,1,vobsub_create,vobsub_script);
 #if 1 //def ADM_DEBUG
-        REGISTERX(&quot;dvbsub&quot;,QT_TR_NOOP(&quot;DVB sub&quot;),QT_TR_NOOP(&quot;Embed DVB-T subtitle.&quot;),VF_DVBSUB,1,dvbsub_create,dvbsub_script);
+        REGISTERX(VF_SUBTITLE,&quot;dvbsub&quot;,QT_TR_NOOP(&quot;DVB sub&quot;),QT_TR_NOOP(&quot;Embed DVB-T subtitle.&quot;),VF_DVBSUB,1,dvbsub_create,dvbsub_script);
 #else
         FILTERDEC(dvbsub_create);
         FILTERDECX(dvbsub_script) ;
 #endif
 
         //*********************
- registerFilter(&quot;-------- Misc ---------&quot;,VF_INVALID,2,NULL,NULL);
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-//	registerFilter(&quot;---- Video Analysis Tools ----&quot;,VF_INVALID,2,NULL,NULL);
-
-        REGISTERX(&quot;blendremover&quot;,QT_TR_NOOP(&quot;Blend remover&quot;),QT_TR_NOOP(&quot;Remove blend between previous and next picture.&quot;),VF_BLENDREMOVAL,1,blendremove_create,blendremove_script);
-        REGISTERX(&quot;hardivtcremove&quot;,QT_TR_NOOP(&quot;Hard pulldown removal&quot;),QT_TR_NOOP(&quot;Remove IVTC that has been analog captured or resized.&quot;),VF_HARDIVTC,1,hardivtc_create,hardivtc_script);
-        REGISTERX(&quot;whirl&quot;,QT_TR_NOOP(&quot;Whirl&quot;),QT_TR_NOOP(&quot;Useless whirlwind effect.&quot;),VF_WHIRL,1,whirl_create,whirl_script);
-        REGISTERX(&quot;mosaic&quot;,QT_TR_NOOP(&quot;Mosaic&quot;),QT_TR_NOOP(&quot;Split the picture into tiny thumbnails.&quot;),VF_MOSAIC,1,     mosaic_create,mosaic_script);
-        REGISTERX(&quot;mpdelogo&quot;,QT_TR_NOOP(&quot;MPlayer delogo&quot;),QT_TR_NOOP(&quot;Blend a logo by interpolating its surrounding box.&quot;),VF_MPDELOGO,1,mpdelogo_create,mpdelogo_script);
-        REGISTERX(&quot;logo&quot;,QT_TR_NOOP(&quot;Logo&quot;),QT_TR_NOOP(&quot;Add a png as logo.&quot;),VF_LOGO,1,logo_create,logo_script);
-        REGISTERX(&quot;animatedmenu&quot;,QT_TR_NOOP(&quot;Animated Menu&quot;),
-            QT_TR_NOOP(&quot;Create a video made of 6 mini windows, very useful to do DVD menus.&quot;),
+ 
+    REGISTERX(VF_MISC, &quot;blendremover&quot;,QT_TR_NOOP(&quot;Blend remover&quot;),QT_TR_NOOP(&quot;Remove blend between previous and next picture.&quot;),VF_BLENDREMOVAL,1,blendremove_create,blendremove_script);
+    REGISTERX(VF_MISC, &quot;hardivtcremove&quot;,QT_TR_NOOP(&quot;Hard pulldown removal&quot;),QT_TR_NOOP(&quot;Remove IVTC that has been analog captured or resized.&quot;),VF_HARDIVTC,1,hardivtc_create,hardivtc_script);
+    REGISTERX(VF_MISC, &quot;whirl&quot;,QT_TR_NOOP(&quot;Whirl&quot;),QT_TR_NOOP(&quot;Useless whirlwind effect.&quot;),VF_WHIRL,1,whirl_create,whirl_script);
+    REGISTERX(VF_MISC, &quot;mosaic&quot;,QT_TR_NOOP(&quot;Mosaic&quot;),QT_TR_NOOP(&quot;Split the picture into tiny thumbnails.&quot;),VF_MOSAIC,1,     mosaic_create,mosaic_script);
+    REGISTERX(VF_MISC, &quot;mpdelogo&quot;,QT_TR_NOOP(&quot;MPlayer delogo&quot;),QT_TR_NOOP(&quot;Blend a logo by interpolating its surrounding box.&quot;),VF_MPDELOGO,1,mpdelogo_create,mpdelogo_script);
+    REGISTERX(VF_MISC, &quot;logo&quot;,QT_TR_NOOP(&quot;Logo&quot;),QT_TR_NOOP(&quot;Add a png as logo.&quot;),VF_LOGO,1,logo_create,logo_script);
+    REGISTERX(VF_MISC, &quot;animatedmenu&quot;,QT_TR_NOOP(&quot;Animated Menu&quot;), QT_TR_NOOP(&quot;Create a video made of 6 mini windows, very useful to do DVD menus.&quot;),
             VF_ANIMATED,1,animated_create,animated_script);
-	REGISTERX(&quot;computeaverage&quot;,QT_TR_NOOP(&quot;Compute Average&quot;),QT_TR_NOOP(&quot;Compute average luma value for each pixel throughout all frames, and save to file&quot;),VF_COMPUTEAVERAGE,1,computeaverage_create,computeaverage_script);
+	REGISTERX(VF_MISC, &quot;computeaverage&quot;,QT_TR_NOOP(&quot;Compute Average&quot;),QT_TR_NOOP(&quot;Compute average luma value for each pixel throughout all frames, and save to file&quot;),VF_COMPUTEAVERAGE,1,computeaverage_create,computeaverage_script);
+	REGISTERX(VF_MISC, &quot;threshold&quot;,QT_TR_NOOP(&quot;Threshold&quot;),QT_TR_NOOP(&quot;Force too-bright/too-dim pixels to 0 and the rest to 255 or vice-versa&quot;),VF_THRESHOLD,1,threshold_create,threshold_script);
+	//REGISTERX(&quot;particlelist&quot;,QT_TR_NOOP(&quot;Particle List&quot;),QT_TR_NOOP(&quot;Identify 'particles' (groups of pixels)&quot;),VF_PARTICLELIST,1,particle_create,particle_script);
 	//REGISTERX(&quot;eraser&quot;,QT_TR_NOOP(&quot;Eraser&quot;),QT_TR_NOOP(&quot;\&quot;Erase\&quot; arbitrary areas of each frame&quot;),VF_ERASER,1,eraser_create,eraser_script);
 	//REGISTERX(&quot;swissarmyknife&quot;,QT_TR_NOOP(&quot;Swiss Army Knife&quot;),QT_TR_NOOP(&quot;Apply operation like P'=P*A, P-A, P+A, etc. using a convolution, rolling average, image from file, or constant&quot;),VF_SWISSARMYKNIFE,1,swissarmyknife_create,swissarmyknife_script);
-	REGISTERX(&quot;threshold&quot;,QT_TR_NOOP(&quot;Threshold&quot;),QT_TR_NOOP(&quot;Force too-bright/too-dim pixels to 0 and the rest to 255 or vice-versa&quot;),VF_THRESHOLD,1,threshold_create,threshold_script);
-	//REGISTERX(&quot;particlelist&quot;,QT_TR_NOOP(&quot;Particle List&quot;),QT_TR_NOOP(&quot;Identify 'particles' (groups of pixels)&quot;),VF_PARTICLELIST,1,particle_create,particle_script);
 
+
 // Does not work
 //        REGISTERX(&quot;unblend&quot;,&quot;Unblend by Bach&quot;,VF_UNBLEND,1,unblend_create,unblend_script);
         
-        REGISTERX(&quot;partial&quot;,QT_TR_NOOP(&quot;Partial&quot;),&quot;&quot;,VF_PARTIAL,0,partial_create,partial_script);
+	REGISTERX(VF_MISC,&quot;partial&quot;,QT_TR_NOOP(&quot;Partial&quot;),&quot;&quot;,VF_PARTIAL,0,partial_create,partial_script);
 //	REGISTER(&quot;&quot;,&quot;Remove Salt&quot;,VF_SALT,0,salt_create);
  printf(&quot;\n&quot;);
 }		
 
 
-//
-
-
-#endif
+// EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_dylib.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_dylib.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_dylib.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -134,7 +134,7 @@
     ADM_assert(desc);
     
     VF_FILTERS id=filterGetTagFromName(name);
-    if(VF_DUMMY!=id)
+    if(VF_INVALID!=id)
     {
       printf(&quot;This filter(%s) is already registered as %u\n&quot;, name,id);
       CLOSELIB(handle);
@@ -144,7 +144,7 @@
     
     printf(&quot;Loaded filter %s, version %d\n&quot;,name,versionP());
   
-   registerFilterEx(name,(VF_FILTERS)dynTag++,1,createP,name,createFromScriptP,desc);
+//   registerFilterEx(name,(VF_FILTERS)dynTag++,1,createP,name,createFromScriptP,desc);
 
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_saveload.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_saveload.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_saveload.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -37,7 +37,7 @@
 #include &quot;avi_vars.h&quot;
 // exported vars
 extern uint32_t nb_active_filter;
-extern FILTER  videofilters[MAX_FILTER];
+extern FILTER  videofilters[VF_MAX_FILTER];
 
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *couple, AVDMGenericVideoStream *in);
 extern void filterCleanUp( void );

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -46,7 +46,7 @@
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h&quot;
 #include &quot;ADM_video/ADM_vidMisc.h&quot;
 //___________________________________________
-extern FILTER videofilters[MAX_FILTER];
+extern FILTER videofilters[VF_MAX_FILTER];
 extern uint32_t nb_active_filter;
 extern ADM_Composer *video_body;
 
@@ -305,7 +305,7 @@
 	createResizeFromParam (getLastVideoFilter (), newx, newy);
 
 
-      videofilters[nb_active_filter].tag = VF_MPLAYERRESIZE;
+      videofilters[nb_active_filter].tag = VF_INVALID; //VF_FIXME
       videofilters[nb_active_filter].filter-&gt;getCoupledConf (&amp;couple);
       videofilters[nb_active_filter].conf = couple;;
       nb_active_filter++;
@@ -318,7 +318,7 @@
 	create_addBorder (videofilters[nb_active_filter - 1].filter,
 			  cropx &gt;&gt; 1, cropx &gt;&gt; 1, cropy &gt;&gt; 1, cropy &gt;&gt; 1);
 
-      videofilters[nb_active_filter].tag = VF_ADDBORDER;
+      videofilters[nb_active_filter].tag = VF_INVALID;  // VF_FIXME
       videofilters[nb_active_filter].filter-&gt;getCoupledConf (&amp;couple);
       videofilters[nb_active_filter].conf = couple;;
       nb_active_filter++;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -49,7 +49,7 @@
 
 #define MAX(a,b) ( (a)&gt;(b) ? (a) : (b) )
 
-extern FILTER  videofilters[MAX_FILTER];
+extern FILTER  videofilters[VF_MAX_FILTER];
 extern uint32_t nb_active_filter;
 
 static void previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -50,10 +50,12 @@
 						    in);
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
 //___________________________________________
-extern FILTER videofilters[MAX_FILTER];
+extern FILTER videofilters[VF_MAX_FILTER];
 extern uint32_t nb_active_filter;
-extern std::vector &lt;FILTER_ENTRY&gt; allfilters;
+extern std::vector &lt;FilterDescriptor *&gt; allfilters;
+extern std::vector &lt;FilterDescriptor *&gt; filterCategories[VF_MAX];
 
+
 extern ADM_Composer *video_body;
 //___________________________________________
 static gulong row_inserted_id;
@@ -89,10 +91,6 @@
 GUI_handleVFilter (void)
 {
 
-#ifndef HAVE_ENCODER
-    return 0;
-}
-#else
     getLastVideoFilter ();	// expand video to full size
 
     // sanity check
@@ -236,7 +234,7 @@
         AVDMGenericVideoStream *replace;
         CONFcouple *conf;
         conf = videofilters[action_parameter].conf;
-        if (videofilters[action_parameter].tag == VF_PARTIAL)	// cannot recurse
+        if (videofilters[action_parameter].tag == VF_PARTIAL_FILTER)	// cannot recurse
         {
             GUI_Error_HIG (QT_TR_NOOP(&quot;The filter is already partial&quot;), NULL);
             break;
@@ -253,7 +251,7 @@
 			videofilters[action_parameter].filter = replace;
 			replace-&gt;getCoupledConf (&amp;conf);
 			videofilters[action_parameter].conf = conf;
-			videofilters[action_parameter].tag = VF_PARTIAL;
+			videofilters[action_parameter].tag = VF_PARTIAL_FILTER;
 			getFirstVideoFilter ();
 			updateFilterList ();
 			setSelectionNumber(nb_active_filter-1, WID(treeview0), stores[0], action_parameter-1);
@@ -368,11 +366,10 @@
     } //end of switch
 }
 /*
- 	Pop-up a list of all available filters
-	Return the tag identifying the filter selected
+ 	\fn getFilterFromSelection
+	\brief returns the tag of the selected filter
 */
-VF_FILTERS
-getFilterFromSelection (void)
+VF_FILTERS getFilterFromSelection (void)
 {
     uint32_t sel = 0;
 	uint8_t ret = 0;
@@ -383,11 +380,15 @@
     page++;
     if ((ret = getSelectionNumber (max, trees[page], stores[page], &amp;sel)))
 	{
-        tag = allfilters[sel+startFilter[page]].tag;
+        tag = filterCategories[page-1][sel]-&gt;tag;
 	}
     return tag;
 }
-
+/**
+ * 	\fn createFilterDialog
+ *  \brief Create the dialog including list of all filters available on the left.
+ * 
+ */
 GtkWidget *
 createFilterDialog (void)
 {
@@ -397,7 +398,7 @@
 #define CALLME_TOOLBAR(x,y) gtk_signal_connect(GTK_OBJECT(WID(x)),&quot;clicked&quot;,  GTK_SIGNAL_FUNC(wrapToolButton), (void *) y);
 #define CALLME(x,y) gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x), y)
 
-	//CALLME (toolbuttonAdd, A_ADD);
+
         // Each of these triggers the following message:
         // Gtk-CRITICAL **: gtk_box_pack_end: assertion `child-&gt;parent == NULL' failed
         CALLME (buttonRemove,		A_REMOVE);
@@ -419,6 +420,8 @@
         
 
     //create treeviews
+    // Treeview zero is reserved and does not contain
+    //
     trees[0]=lookup_widget(dialog,&quot;treeview0&quot;);
     stores[0]=gtk_list_store_new (3, G_TYPE_STRING, G_TYPE_INT, G_TYPE_POINTER);
     #define LOOK(x) {trees[x]=lookup_widget(dialog,&quot;treeview&quot;#x);\
@@ -435,31 +438,26 @@
     //load stores with filter names, get start filter for each page
     char *str=NULL;
     GtkTreeIter iter;
-    int current_tree=0;
-    for (uint32_t i = 0; i &lt; allfilters.size(); i++)
+    
+    // Dispatch each category to the matching tree
+    for(int current_tree=0;current_tree&lt; VF_MAX;current_tree++)
     {
-        if (allfilters[i].viewable==1)
-        {
-		
+    	 std::vector &lt;FilterDescriptor *&gt; vec=filterCategories[current_tree];
+    	for (uint32_t i = 0; i &lt; vec.size(); i++)
+    	{		
 		 str = g_strconcat(
-				 &quot;&lt;span weight=\&quot;bold\&quot;&gt;&quot;, allfilters[i].name, &quot;&lt;/span&gt;\n&quot;,
-                 		//	&quot;&quot;, allfilters[i].description, &quot;&quot;, NULL);
-                 			&quot;&lt;span size=\&quot;smaller\&quot;&gt;&quot;, allfilters[i].description, &quot;&lt;/span&gt;&quot;, NULL);
+				 &quot;&lt;span weight=\&quot;bold\&quot;&gt;&quot;, vec[i]-&gt;name, &quot;&lt;/span&gt;\n&quot;,
+                 &quot;&lt;span size=\&quot;smaller\&quot;&gt;&quot;, vec[i]-&gt;description, &quot;&lt;/span&gt;&quot;, NULL);
 				
-            gtk_list_store_append (stores[current_tree], &amp;iter);
-            gtk_list_store_set (stores[current_tree], &amp;iter, 0, str ,-1);
+            gtk_list_store_append (stores[current_tree+1], &amp;iter);
+            gtk_list_store_set (stores[current_tree+1], &amp;iter, 0, str ,-1);
             g_free(str);
             max++;
-        }else
-        {
-                current_tree++;
-                if(current_tree&gt;=NB_TREE) break;
-                startFilter[current_tree]=i+1;
-        }
+    	}
     }
 
     //setup treeviews
-    for(int i=0;i&lt;NB_TREE;i++)
+    for(int i=0;i&lt;VF_MAX+1;i++)
     {
         renderers[i] = gtk_cell_renderer_text_new();
    		columns[i] = gtk_tree_view_column_new_with_attributes (
@@ -502,9 +500,11 @@
     }
     return dialog;
 }
-
-void
-updateFilterList (void)
+/**
+ * 	\fn updateFilterList
+ *  \brief Update the list of activated filters
+ */
+void updateFilterList (void)
 {
     g_signal_handler_block(stores[0], row_inserted_id);
     g_signal_handler_block(stores[0], row_deleted_id);
@@ -619,4 +619,4 @@
 
 }
 
-#endif
+

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-04-27 13:40:51 UTC (rev 3989)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-04-27 17:20:19 UTC (rev 3990)
@@ -6,6 +6,8 @@
     * I.e.
     0--1000 : QT4 internal
     2000-3000: Filters
+                 Each family starts a category*100 then filter in the order they are in categories
+                 ** 10 Categories MAX !!
     3000-4000  filterFamilyClick Filter
     8000-9000  Active Filter
     
@@ -57,8 +59,10 @@
 /******************************************************/
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
-extern std::vector &lt;FILTER_ENTRY&gt; allfilters;
+extern std::vector &lt;FilterDescriptor *&gt; allfilters;
+extern std::vector &lt;FilterDescriptor *&gt; filterCategories[VF_MAX];
 
+
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
 extern ADM_Composer *video_body;
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *conf, AVDMGenericVideoStream *in) ;
@@ -97,8 +101,8 @@
 	void filterFamilyClick(int  item);
  private slots:
  private:
-        int startFilter[NB_TREE];
-        int filterSize[NB_TREE];
+        
+        
         void setSelected(int sel);
         void displayFamily(uint32_t family);
         void setupFilters(void);
@@ -127,8 +131,13 @@
      int itag=item-&gt;type();
      if(itag&gt;=ALL_FILTER_BASE &amp;&amp; itag &lt; EXTERNAL_FILTER_BASE)
      {
-       tag=allfilters[itag-ALL_FILTER_BASE].tag;
-       
+    	 // Extract family &amp; index
+    	 itag-=ALL_FILTER_BASE;
+    	 int index=itag%100;
+    	 int family=(itag-index)/100;
+    	 ADM_assert(family&lt;VF_MAX);
+    	 ADM_assert(index&lt;filterCategories[family].size());
+         tag=filterCategories[family][index]-&gt;tag;
      }else
      {
         ADM_assert(0); 
@@ -181,6 +190,7 @@
                     videofilters[itag].conf = NULL;
             }
         // recreate derivated filters
+
         for (uint32_t i = itag ; i &lt; nb_active_filter-1; i++)
         {
                     delete videofilters[i ].filter;
@@ -190,6 +200,7 @@
                     videofilters[i ].conf = videofilters[i+1].conf;
                     videofilters[i ].tag = videofilters[i+1].tag;
         }
+        
         /* Delete last filter which is now at last filter -1 */
             delete videofilters[nb_active_filter - 1].filter;
             videofilters[nb_active_filter - 1].filter = NULL;
@@ -329,32 +340,24 @@
 void filtermainWindow::displayFamily(uint32_t family)
 {
   printf(&quot;Family :%u\n&quot;,family);
-  
+  ADM_assert(family&lt;VF_MAX);
+  std::vector &lt;FilterDescriptor *&gt; vec=filterCategories[family];
   availableList-&gt;clear();
   QColor colorgrey;
   colorgrey.setRgb(myBg,myBg,myBg);
   QBrush brush(colorgrey);
   QSize sz;
   
-  for (uint32_t i = 0; i &lt; filterSize[family]; i++)
+  for (uint32_t i = 0; i &lt; vec.size(); i++)
     {
-      int r=startFilter[family]+i;
-
-      if (allfilters[r].viewable==1)
-        {
           QString str; //=&quot;&lt;b&gt;&quot;;
-          str+=allfilters[r].name;
+          str+=vec[i]-&gt;name;
          
           QListWidgetItem *item;
-          if(family==NB_TREE-1)
-                item=new QListWidgetItem(str,availableList,EXTERNAL_FILTER_BASE+i);
-          else
-                item=new QListWidgetItem(str,availableList,ALL_FILTER_BASE+r);
-          item-&gt;setToolTip(allfilters[r].description);
+          item=new QListWidgetItem(str,availableList,ALL_FILTER_BASE+i+family*100);
+          item-&gt;setToolTip(vec[i]-&gt;description);
           if(i&amp;1) item-&gt;setBackground(brush);
           availableList-&gt;addItem(item);
-          
-        }
      }
    
 }
@@ -406,10 +409,12 @@
             GUI_Error_HIG (QT_TR_NOOP(&quot;The filter is already partial&quot;), NULL);
             return;
         }
+
         replace =new ADMVideoPartial (videofilters[itag - 1].
                                       filter,
                                       videofilters[itag].tag,
                                       conf);
+        
         if(replace-&gt;configure (videofilters[itag - 1].filter))
         {
             delete videofilters[itag].filter;
@@ -429,34 +434,7 @@
 */
 void filtermainWindow::setupFilters(void)
 {
-  int current_tree=-1;
-  int current_raw=0;;
   
-  max=0;
-  
-  for (uint32_t i = 0; i &lt; allfilters.size(); i++)
-    {
-      if (allfilters[i].viewable==1)
-        {
-          current_raw++;
-          
-        }else 
-        {
-                current_tree++;
-                if(current_tree) filterSize[current_tree-1]=current_raw;
-                if(current_tree&gt;=NB_TREE) break;
-                startFilter[current_tree]=i+1;
-                current_raw=0;
-                
-        }
-    }
-    ADM_assert(NB_TREE==8);
-    startFilter[NB_TREE-1]=2000;
-    filterSize[NB_TREE-1]=0;
-    for(int i=0;i&lt;NB_TREE;i++)
-    {
-             printf(&quot;%d Start at %d size :%d\n&quot;,i,startFilter[i],filterSize[i]);
-    }
 }
 
 /**
@@ -494,9 +472,7 @@
   */
 filtermainWindow::filtermainWindow()     : QDialog()
  {
-        memset( startFilter,0,sizeof(int)*NB_TREE);
-        memset( filterSize,0,sizeof(int)*NB_TREE);
- 
+        
     ui.setupUi(this);
     setupFilters();  
       


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001249.html">[Avidemux-svn-commit] r3989 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters
</A></li>
	<LI>Next message: <A HREF="001251.html">[Avidemux-svn-commit] r3991 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1250">[ date ]</a>
              <a href="thread.html#1250">[ thread ]</a>
              <a href="subject.html#1250">[ subject ]</a>
              <a href="author.html#1250">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
