<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3986 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_encoder	ADM_plugin ADM_userInterfaces/ADM_GTK	ADM_userInterfaces/ADM_NONE ADM_userInterfaces/ADM_QT4	plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3986%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_encoder%0A%09ADM_plugin%20ADM_userInterfaces/ADM_GTK%0A%09ADM_userInterfaces/ADM_NONE%20ADM_userInterfaces/ADM_QT4%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4&In-Reply-To=%3C200804261914.m3QJEmuN011410%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001245.html">
   <LINK REL="Next"  HREF="001247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3986 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_encoder	ADM_plugin ADM_userInterfaces/ADM_GTK	ADM_userInterfaces/ADM_NONE ADM_userInterfaces/ADM_QT4	plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3986%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20ADM_encoder%0A%09ADM_plugin%20ADM_userInterfaces/ADM_GTK%0A%09ADM_userInterfaces/ADM_NONE%20ADM_userInterfaces/ADM_QT4%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4&In-Reply-To=%3C200804261914.m3QJEmuN011410%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3986 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_encoder	ADM_plugin ADM_userInterfaces/ADM_GTK	ADM_userInterfaces/ADM_NONE ADM_userInterfaces/ADM_QT4	plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4">gruntster at mail.berlios.de
       </A><BR>
    <I>Sat Apr 26 21:14:48 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001245.html">[Avidemux-svn-commit] r3985 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_encoder	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
</A></li>
        <LI>Next message: <A HREF="001247.html">[Avidemux-svn-commit] r3987 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audiofilter avidemux/ADM_encoder	avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF	avidemux/ADM_outputs/oplug_ogm	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/winInstaller po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1246">[ date ]</a>
              <a href="thread.html#1246">[ thread ]</a>
              <a href="subject.html#1246">[ subject ]</a>
              <a href="author.html#1246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-04-26 21:14:38 +0200 (Sat, 26 Apr 2008)
New Revision: 3986

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
Log:
[x264] pass options to plugin

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -18,13 +18,9 @@
 #include &quot;ADM_externalEncoder.h&quot;
 #include &quot;ADM_plugin/ADM_vidEnc_plugin.h&quot;
 
-#include &quot;avi_vars.h&quot;
-
 externalEncoder::externalEncoder(COMPRES_PARAMS *params)
 {
-	memcpy(&amp;_compressParams, params, sizeof(COMPRES_PARAMS));
-
-	_plugin = ADM_vidEnc_getPlugin(params-&gt;extra_param);
+	_plugin = getVideoEncoderPlugin(params-&gt;extra_param);
 	_openPass = false;
 }
 
@@ -47,37 +43,14 @@
 
 	_in = instream;
 
-	vidEncProperties properties;
+	vidEncVideoProperties properties;
 
+	properties.structSize = sizeof(vidEncVideoProperties);
 	properties.width = _w;
 	properties.height = _h;
-	properties.parWidth = video_body-&gt;getPARWidth();
-	properties.parHeight = video_body-&gt;getPARHeight();
+	properties.parWidth = instream-&gt;getPARWidth();
+	properties.parHeight = instream-&gt;getPARHeight();
 
-	switch (_compressParams.mode)
-	{
-		case COMPRESS_AQ:
-			properties.encodeMode = ADM_VIDENC_MODE_AQP;
-			properties.encodeModeParameter = _compressParams.qz;
-			break;
-		case COMPRESS_CQ:
-			properties.encodeMode = ADM_VIDENC_MODE_CQP;
-			properties.encodeModeParameter = _compressParams.qz;
-			break;
-		case COMPRESS_CBR:
-			properties.encodeMode = ADM_VIDENC_MODE_CBR;
-			properties.encodeModeParameter = _compressParams.bitrate;
-			break;
-		case COMPRESS_2PASS:
-			properties.encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
-			properties.encodeModeParameter = _compressParams.finalsize;
-			break;
-		case COMPRESS_2PASS_BITRATE:
-			properties.encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
-			properties.encodeModeParameter = _compressParams.avg_bitrate;
-			break;
-	}
-
 	if (_plugin-&gt;open(_plugin-&gt;encoderId, &amp;properties))
 		return 1;
 	else

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -26,7 +26,6 @@
 class externalEncoder : public Encoder
 {
 private:
-	COMPRES_PARAMS _compressParams;
 	ADM_vidEnc_plugin *_plugin;
 	bool _openPass;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -61,7 +61,7 @@
 
 std::vector&lt;ADM_vidEnc_plugin *&gt; ADM_videoEncoderPlugins;
 
-static int loadVideoPlugin(int uiType, const char *file)
+static int loadVideoEncoderPlugin(int uiType, const char *file)
 {
 	ADM_vidEnc_plugin *plugin = new ADM_vidEnc_plugin(file);
 	int* encoderIds;
@@ -106,7 +106,7 @@
  * 	\fn ADM_vidEnc_loadPlugins
  *  \brief load all audio plugins
  */
-int ADM_vidEnc_loadPlugins(int uiType, const char *path)
+int loadVideoEncoderPlugins(int uiType, const char *path)
 {
 #define MAX_EXTERNAL_FILTER 50
 
@@ -119,7 +119,7 @@
 #endif
 
 	char *files[MAX_EXTERNAL_FILTER];
-	uint32_t nbFile;
+	uint32_t nbFile = 0;
 
 	memset(files, 0, sizeof(char *)*MAX_EXTERNAL_FILTER);
 	printf(&quot;[ADM_vidEnc_plugin] Scanning directory %s\n&quot;, path);
@@ -129,7 +129,7 @@
 		printf(&quot;[ADM_vidEnc_plugin] Cannot parse plugin\n&quot;);
 
 	for (int i = 0; i &lt; nbFile; i++)
-		loadVideoPlugin(uiType, files[i]);
+		loadVideoEncoderPlugin(uiType, files[i]);
 
 	printf(&quot;[ADM_vidEnc_plugin] Scanning done, found %d codec\n&quot;, ADM_videoEncoderPlugins.size());
 
@@ -154,28 +154,116 @@
 
 		sprintf(displayName, &quot;%s (%s)&quot;, codecType, codecName);
 
-		COMPRES_PARAMS *params = &amp;AllVideoCodec[internalCodecCount + i];
+		COMPRES_PARAMS *param = &amp;AllVideoCodec[internalCodecCount + i];
 
-		params-&gt;codec = CodecExternal;
-		params-&gt;menuName = displayName;
-		params-&gt;tagName = displayName;
-		params-&gt;extra_param = i;
+		param-&gt;codec = CodecExternal;
+		param-&gt;menuName = displayName;
+		param-&gt;tagName = displayName;
+		param-&gt;extra_param = i;
 
-		int length = plugin-&gt;getOptions(plugin-&gt;encoderId, NULL, 0);
-		char *options = new char[length + 1];
+		int length = plugin-&gt;getOptions(plugin-&gt;encoderId, NULL, NULL, 0);
+		char *pluginOptions = new char[length + 1];
+		vidEncOptions encodeOptions;
 
-		plugin-&gt;getOptions(plugin-&gt;encoderId, options, length);
-		options[length] = 0;
+		plugin-&gt;getOptions(plugin-&gt;encoderId, &amp;encodeOptions, pluginOptions, length);
+		pluginOptions[length] = 0;
 
-		params-&gt;extraSettings = options;
-		params-&gt;extraSettingsLen = length;
+		updateCompressionParameters(param, encodeOptions.encodeMode, encodeOptions.encodeModeParameter, pluginOptions, length);
 	}
 
 	return 1;
 }
 
-ADM_vidEnc_plugin* ADM_vidEnc_getPlugin(int index)
+void updateCompressionParameters(COMPRES_PARAMS *params, int encodeMode, int encodeModeParameter, char* extraSettings, int extraSettingsLength)
 {
+	COMPRESSION_MODE compressMode = getCompressionMode(encodeMode);
+
+	switch (compressMode)
+	{
+		case COMPRESS_CBR:
+			params-&gt;bitrate = encodeModeParameter;
+			break;
+		case COMPRESS_AQ:
+			params-&gt;qz = encodeModeParameter;
+			break;
+		case COMPRESS_CQ:
+			params-&gt;qz = encodeModeParameter;
+			break;
+		case COMPRESS_2PASS:
+			params-&gt;finalsize = encodeModeParameter;
+			break;
+		case COMPRESS_2PASS_BITRATE:
+			params-&gt;avg_bitrate = encodeModeParameter;
+			break;
+		default:
+			ADM_assert(0);
+	}
+
+	if (params-&gt;extraSettings)
+		delete [] (char*)params-&gt;extraSettings;
+
+	params-&gt;extraSettings = extraSettings;
+	params-&gt;extraSettingsLen = extraSettingsLength;
+}
+
+COMPRESSION_MODE getCompressionMode(int encodeMode)
+{
+	COMPRESSION_MODE mode;
+
+	switch (encodeMode)
+	{
+		case ADM_VIDENC_MODE_AQP:
+			mode = COMPRESS_AQ;
+			break;
+		case ADM_VIDENC_MODE_CQP:
+			mode = COMPRESS_CQ;
+			break;
+		case ADM_VIDENC_MODE_CBR:
+			mode = COMPRESS_CBR;
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			mode = COMPRESS_2PASS;
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			mode = COMPRESS_2PASS_BITRATE;
+			break;
+		default:
+			ADM_assert(0);
+	}
+
+	return mode;
+}
+
+int getVideoEncodePluginMode(COMPRESSION_MODE mode)
+{
+	int encodeMode;
+
+	switch (mode)
+	{
+		case COMPRESS_AQ:
+			encodeMode = ADM_VIDENC_MODE_AQP;
+			break;
+		case COMPRESS_CQ:
+			encodeMode = ADM_VIDENC_MODE_CQP;
+			break;
+		case COMPRESS_CBR:
+			encodeMode = ADM_VIDENC_MODE_CBR;
+			break;
+		case COMPRESS_2PASS:
+			encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+			break;
+		case COMPRESS_2PASS_BITRATE:
+			encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			break;
+		default:
+			ADM_assert(0);
+	}
+
+	return encodeMode;
+}
+
+ADM_vidEnc_plugin* getVideoEncoderPlugin(int index)
+{
 	ADM_assert(index &lt; ADM_videoEncoderPlugins.size());
 
 	return ADM_videoEncoderPlugins[index];

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -19,6 +19,7 @@
 
 #include &quot;ADM_dynamicLoading.h&quot;
 #include &quot;ADM_plugin/ADM_vidEnc_plugin.h&quot;
+#include &quot;ADM_vidEncode.hxx&quot;
 
 typedef int _vidEncGetEncoders(int uiType, int **encoderIds);
 typedef const char* _vidEncGetEncoderName(int encoderId);
@@ -30,14 +31,14 @@
 typedef const char* _vidEncGetEncoderGuid(int encoderId);
 
 typedef int _vidEncIsConfigurable(int encoderId);
-typedef int _vidEncConfigure(int encoderId);
-typedef int _vidEncGetOptions(int encoderId, char *options, int bufferSize);
-typedef int _vidEncSetOptions(int encoderId, char *options);
+typedef int _vidEncConfigure(int encoderId, vidEncVideoProperties *properties);
+typedef int _vidEncGetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+typedef int _vidEncSetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions);
 
 typedef int _vidEncGetPassCount(int encoderId);
 typedef int _vidEncGetCurrentPass(int encoderId);
 
-typedef int _vidEncOpen(int encoderId, vidEncProperties *properties);
+typedef int _vidEncOpen(int encoderId, vidEncVideoProperties *properties);
 typedef int _vidEncBeginPass(int encoderId);
 typedef int _vidEncEncodeFrame(int encoderId, vidEncEncodeParams *encodeParams);
 typedef int _vidFinishPass(int encoderId);
@@ -75,7 +76,10 @@
 		ADM_vidEnc_plugin(const char *file);
 };
 
-ADM_vidEnc_plugin* ADM_vidEnc_getPlugin(int index);
-int ADM_vidEnc_loadPlugins(int uiType, const char *path);
+ADM_vidEnc_plugin* getVideoEncoderPlugin(int index);
+int loadVideoEncoderPlugins(int uiType, const char *path);
+void updateCompressionParameters(COMPRES_PARAMS *params, int encodeMode, int encodeModeParameter, char* extraSettings, int extraSettingsLength);
+COMPRESSION_MODE getCompressionMode(int encodeMode);
+int getVideoEncodePluginMode(COMPRESSION_MODE mode);
 
 #endif // ADM_pluginLoad_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -28,8 +28,8 @@
 #include &quot;ADM_vidEncode.hxx&quot;
 #include &quot;ADM_videoFilter.h&quot;
 
+#include &quot;avi_vars.h&quot;
 
-
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_ENCODER
 #include &quot;ADM_osSupport/ADM_debug.h&quot;
@@ -440,23 +440,40 @@
 
 	if (currentCodecType == CodecExternal)
 	{
-		ADM_vidEnc_plugin *plugin = ADM_vidEnc_getPlugin(param-&gt;extra_param);
+		ADM_vidEnc_plugin *plugin = getVideoEncoderPlugin(param-&gt;extra_param);
+		vidEncOptions encodeOptions;
+		vidEncVideoProperties properties;
 
-		plugin-&gt;setOptions(plugin-&gt;encoderId, (char*)param-&gt;extraSettings);
+		if (avifileinfo)
+		{
+			aviInfo info;
+			video_body-&gt;getVideoInfo(&amp;info);
 
+			properties.width = info.width;
+			properties.height = info.height;
+			properties.parWidth = video_body-&gt;getPARWidth();
+			properties.parHeight = video_body-&gt;getPARHeight();
+		}
+		else
+		{
+			properties.width = 0;
+			properties.height = 0;
+			properties.parWidth = 0;
+			properties.parHeight = 0;
+		}
+
+		properties.structSize = sizeof(vidEncVideoProperties);
+
 		if (plugin-&gt;isConfigurable(plugin-&gt;encoderId))
-			if (plugin-&gt;configure(plugin-&gt;encoderId))
+			if (plugin-&gt;configure(plugin-&gt;encoderId, &amp;properties))
 			{
-				delete [] (char*)param-&gt;extraSettings;
+				int length = plugin-&gt;getOptions(plugin-&gt;encoderId, NULL, NULL, 0);
+				char *pluginOptions = new char[length + 1];
 
-				int length = plugin-&gt;getOptions(plugin-&gt;encoderId, NULL, 0);
-				char *options = new char[length + 1];
+				plugin-&gt;getOptions(plugin-&gt;encoderId, &amp;encodeOptions, pluginOptions, length);
+				pluginOptions[length] = 0;
 
-				plugin-&gt;getOptions(plugin-&gt;encoderId, options, length);
-				options[length] = 0;
-
-				param-&gt;extraSettings = options;
-				param-&gt;extraSettingsLen = length;
+				updateCompressionParameters(param, encodeOptions.encodeMode, encodeOptions.encodeModeParameter, pluginOptions, length);
 			}
 	}
 	else
@@ -470,58 +487,72 @@
 	Set mode param and extra data for the currently selected codec
 	The extradata is a free binary chunk (-&gt;memcpy of codec.specific part)
 ___________________________________________________________*/
-
-void
-setVideoEncoderSettings (COMPRESSION_MODE mode, uint32_t param,
-			 uint32_t extraConf, uint8_t * extraData)
+void setVideoEncoderSettings(COMPRESSION_MODE mode, uint32_t param, uint32_t extraConf, uint8_t* extraData)
 {
-  COMPRES_PARAMS *generic = NULL;
-  void *specific = NULL;
-  uint32_t specSize = 0;
-  COMPRES_PARAMS *zparam = &amp;AllVideoCodec[currentCodecIndex];
+	COMPRES_PARAMS *zparam = &amp;AllVideoCodec[currentCodecIndex];
 
-  zparam-&gt;mode = mode;
+	zparam-&gt;mode = mode;
 
-  switch (mode)
-    {
-    case COMPRESS_SAME:
-      aprintf (&quot;Same as input\n&quot;);
-      break;
-    case COMPRESS_CBR:
-      aprintf (&quot;CBR : %lu kbps\n&quot;, param);
-      zparam-&gt;bitrate = param;
-      break;
-    case COMPRESS_AQ:
-      aprintf (&quot;AQ : %lu q\n&quot;, param);
-      zparam-&gt;qz = param;
-      break;
-    case COMPRESS_CQ:
-      aprintf (&quot;CQ : %lu q\n&quot;, param);
-      zparam-&gt;qz = param;
-      break;
-    case COMPRESS_2PASS:
-      aprintf (&quot;2pass : %lu q\n&quot;, param);
-      zparam-&gt;finalsize = param;
-      break;
-    case COMPRESS_2PASS_BITRATE:
-      aprintf (&quot;2passbitrate : %lu q\n&quot;, param);
-      zparam-&gt;avg_bitrate = param;
-      break;
-    default:
-      ADM_assert (0);
+	switch (mode)
+	{
+		case COMPRESS_SAME:
+			aprintf (&quot;Same as input\n&quot;);
+			break;
+		case COMPRESS_CBR:
+			aprintf (&quot;CBR : %lu kbps\n&quot;, param);
+			zparam-&gt;bitrate = param;
+			break;
+		case COMPRESS_AQ:
+			aprintf (&quot;AQ : %lu q\n&quot;, param);
+			zparam-&gt;qz = param;
+			break;
+		case COMPRESS_CQ:
+			aprintf (&quot;CQ : %lu q\n&quot;, param);
+			zparam-&gt;qz = param;
+			break;
+		case COMPRESS_2PASS:
+			aprintf (&quot;2pass : %lu q\n&quot;, param);
+			zparam-&gt;finalsize = param;
+			break;
+		case COMPRESS_2PASS_BITRATE:
+			aprintf (&quot;2passbitrate : %lu q\n&quot;, param);
+			zparam-&gt;avg_bitrate = param;
+			break;
+		default:
+			ADM_assert(0);
+	}
 
-    }
+	if (zparam-&gt;extra_param)
+	{
+		ADM_vidEnc_plugin *plugin = getVideoEncoderPlugin(zparam-&gt;extra_param);
+		vidEncOptions options;
 
-  if (extraConf &amp;&amp; extraData &amp;&amp; zparam-&gt;extraSettingsLen)
-    {
-      if (zparam-&gt;extraSettingsLen != extraConf)
-		printf(&quot;\n*** ERROR : Extra data for codec config has a different size!!! *****\n&quot;);
-      else
+		options.structSize = sizeof(vidEncOptions);
+		options.encodeMode = getVideoEncodePluginMode(mode);
+		options.encodeModeParameter = param;
+
+		if (zparam-&gt;extraSettings)
+			delete [] (char*)zparam-&gt;extraSettings;
+
+		zparam-&gt;extraSettings = extraData;
+
+		if (extraData)
+			zparam-&gt;extraSettingsLen = strlen((char*)extraData);
+		else
+			zparam-&gt;extraSettingsLen = 0;
+
+		plugin-&gt;setOptions(plugin-&gt;encoderId, &amp;options, (char*)zparam-&gt;extraSettings);
+	}
+	else if (extraConf &amp;&amp; extraData &amp;&amp; zparam-&gt;extraSettingsLen)
 	{
-	  printf (&quot;\n using %u bytes of codec specific data...\n&quot;, extraConf);
-	  memcpy (zparam-&gt;extraSettings, extraData, extraConf);
+		if (zparam-&gt;extraSettingsLen != extraConf)
+			printf(&quot;\n*** ERROR : Extra data for codec config has a different size!!! *****\n&quot;);
+		else
+		{
+			printf (&quot;\n using %u bytes of codec specific data...\n&quot;, extraConf);
+			memcpy (zparam-&gt;extraSettings, extraData, extraConf);
+		}
 	}
-    }
 }
 
 Encoder *getVideoEncoder(uint32_t w, uint32_t h, uint32_t globalHeaderFlag)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -56,13 +56,19 @@
 
 typedef struct
 {
+	int structSize;
 	unsigned int width;
 	unsigned int height;
 	unsigned int parWidth;
 	unsigned int parHeight;
+} vidEncVideoProperties;
+
+typedef struct
+{
+	int structSize;
 	unsigned int encodeMode;
 	int encodeModeParameter;
-} vidEncProperties;
+} vidEncOptions;
 
 int vidEncGetEncoders(int uiType, int **encoderIds);
 const char* vidEncGetEncoderName(int encoderId);
@@ -74,14 +80,14 @@
 const char* vidEncGetEncoderGuid(int encoderId);
 
 int vidEncIsConfigurable(int encoderId);
-int vidEncConfigure(int encoderId);
-int vidEncGetOptions(int encoderId, char *options, int bufferSize);
-int vidEncSetOptions(int encoderId, char *options);
+int vidEncConfigure(int encoderId, vidEncVideoProperties *properties);
+int vidEncGetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+int vidEncSetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions);
 
 int vidEncGetPassCount(int encoderId);
 int vidEncGetLastPass(int encoderId);
 
-int vidEncOpen(int encoderId, vidEncProperties *properties);
+int vidEncOpen(int encoderId, vidEncVideoProperties *properties);
 int vidEncBeginPass(int encoderId);
 int vidEncEncodeFrame(int encoderId, vidEncEncodeParams *encodeParams);
 int vidEndFinishPass(int encoderId);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -38,6 +38,6 @@
 {
 	char *pluginDir = ADM_getPluginPath();
 
-	ADM_vidEnc_loadPlugins(ADM_VIDENC_UI_CLI, pluginDir);
+	loadVideoEncoderPlugins(ADM_VIDENC_UI_CLI, pluginDir);
 	delete [] pluginDir;
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -37,6 +37,6 @@
 {
 	char *pluginDir = ADM_getPluginPath();
 
-	ADM_vidEnc_loadPlugins(ADM_VIDENC_UI_CLI, pluginDir);
+	loadVideoEncoderPlugins(ADM_VIDENC_UI_CLI, pluginDir);
 	delete [] pluginDir;
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -65,6 +65,6 @@
 {
 	char *pluginDir = ADM_getPluginPath();
 
-	ADM_vidEnc_loadPlugins(ADM_VIDENC_UI_QT, pluginDir);
+	loadVideoEncoderPlugins(ADM_VIDENC_UI_QT, pluginDir);
 	delete [] pluginDir;
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -9,7 +9,7 @@
 #include &quot;ADM_vidEnc_plugin.h&quot;
 }
 
-typedef bool _showX264ConfigDialog(vidEncProperties *properties, x264Options *options);
+typedef bool _showX264ConfigDialog(vidEncVideoProperties *properties, vidEncOptions *encodeOptions, x264Options *options);
 
 class configGuiLoader : public ADM_LibWrapper
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -27,12 +27,12 @@
 {
 	void *encoders_getPointer(int uiType) { encoder.setUiType(uiType); return &encoders; } 
 	int x264Encoder_isConfigurable(void) { return encoder.isConfigurable(); }
-	int x264Encoder_configure(void) { return encoder.configure(); }
-	int x264Encoder_getOptions(char* options, int bufferSize) { return encoder.getOptions(options, bufferSize); };
-	int x264Encoder_setOptions(char* options) { return encoder.setOptions(options); };
+	int x264Encoder_configure(vidEncVideoProperties *properties) { return encoder.configure(properties); }
+	int x264Encoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize) { return encoder.getOptions(encodeOptions, pluginOptions, bufferSize); };
+	int x264Encoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions) { return encoder.setOptions(encodeOptions, pluginOptions); };
 	int x264Encoder_getPassCount(void) { return encoder.getPassCount(); }
 	int x264Encoder_getCurrentPass(void) { return encoder.getCurrentPass(); }
-	int x264Encoder_open(vidEncProperties *properties) { return encoder.open(properties); }
+	int x264Encoder_open(vidEncVideoProperties *properties) { return encoder.open(properties); }
 	int x264Encoder_beginPass(void) { return encoder.beginPass(); }
 	int x264Encoder_encodeFrame(vidEncEncodeParams *encodeParams) { return encoder.encodeFrame(encodeParams); }
 	int x264Encoder_finishPass(void) { return encoder.finishPass(); }
@@ -43,14 +43,15 @@
 {
 	_loader = NULL;
 	_handler = NULL;
-	_passCount = 2;
+	_passCount = 1;
 	_currentPass = 0;
 	_openPass = false;
 
-	x264_param_t *param = _options.getParameters();
+	_encodeOptions.structSize = sizeof(vidEncOptions);
+	_encodeOptions.encodeMode = ADM_VIDENC_MODE_AQP;
+	_encodeOptions.encodeModeParameter = 26;
 
-	memcpy(&amp;_param, param, sizeof(x264_param_t));
-	delete param;
+	updateParameters();
 }
 
 x264Encoder::~x264Encoder(void)
@@ -71,7 +72,7 @@
 	return (_uiType == ADM_VIDENC_UI_GTK || _uiType == ADM_VIDENC_UI_QT);
 }
 
-int x264Encoder::configure(void)
+int x264Encoder::configure(vidEncVideoProperties *properties)
 {
 	if (_loader == NULL)
 	{
@@ -99,18 +100,21 @@
 	}
 
 	if (_loader-&gt;isAvailable())
-		return _loader-&gt;showX264ConfigDialog(&amp;_properties, &amp;_options);
+		return _loader-&gt;showX264ConfigDialog(properties, &amp;_encodeOptions, &amp;_options);
 	else
 		return 0;
 }
 
-int x264Encoder::getOptions(char *options, int bufferSize)
+int x264Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
 	char* xml = _options.toXml();
 	int xmlLength = strlen(xml);
-	
+
 	if (bufferSize &gt;= xmlLength)
-		memcpy(options, xml, xmlLength);
+	{
+		memcpy(pluginOptions, xml, xmlLength);
+		memcpy(encodeOptions, &amp;_encodeOptions, sizeof(vidEncOptions));
+	}
 	else if (bufferSize != 0)
 		xmlLength = 0;
 
@@ -119,11 +123,51 @@
 	return xmlLength;
 }
 
-int x264Encoder::setOptions(char *options)
+int x264Encoder::setOptions(vidEncOptions *encodeOptions, char *pluginOptions)
 {
-	return _options.fromXml(options);
+	if (_options.fromXml(pluginOptions))
+	{
+		memcpy(&amp;_encodeOptions, encodeOptions, sizeof(vidEncOptions));
+		updateParameters();
+
+		return 1;
+	}
+	else
+		return 0;
 }
 
+void x264Encoder::updateParameters(void)
+{
+	x264_param_t *param = _options.getParameters();
+
+	memcpy(&amp;_param, param, sizeof(x264_param_t));
+	delete param;
+
+	switch (_encodeOptions.encodeMode)
+	{
+		case ADM_VIDENC_MODE_CBR:
+			_param.rc.i_rc_method = X264_RC_ABR;
+			_param.rc.i_bitrate = _encodeOptions.encodeModeParameter;
+			break;
+		case ADM_VIDENC_MODE_CQP:
+			_param.rc.i_rc_method = X264_RC_CQP;
+			_param.rc.i_qp_constant = _encodeOptions.encodeModeParameter;
+			break;
+		case ADM_VIDENC_MODE_AQP:
+			_param.rc.i_rc_method = X264_RC_CRF;
+			_param.rc.f_rf_constant = _encodeOptions.encodeModeParameter;
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			_param.rc.i_rc_method = X264_RC_ABR;
+			_param.rc.i_bitrate = _encodeOptions.encodeModeParameter;
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			_param.rc.i_rc_method = X264_RC_ABR;
+			_param.rc.i_bitrate = _encodeOptions.encodeModeParameter;
+			break;
+	}
+}
+
 int x264Encoder::getCurrentPass(void)
 {
 	return _currentPass;
@@ -134,13 +178,11 @@
 	return _passCount;
 }
 
-int x264Encoder::open(vidEncProperties *properties)
+int x264Encoder::open(vidEncVideoProperties *properties)
 {
 	if (_handler)
 		return ADM_VIDENC_ERR_ALREADY_OPEN;
 
-	memcpy(&amp;_properties, properties, sizeof(vidEncProperties));
-
 	_param.i_width = _width = properties-&gt;width;
 	_param.i_height = _height = properties-&gt;height;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -39,7 +39,7 @@
 
 		configGuiLoader *_loader;
 		x264Options _options;
-		vidEncProperties _properties;
+		vidEncOptions _encodeOptions;
 
 		x264_t *_handler;
 		x264_param_t _param;
@@ -58,18 +58,19 @@
 
 		void printParam(x264_param_t* x264Param);
 		void printCqm(const uint8_t cqm[], int size);
+		void updateParameters(void);
 
 	public:
 		x264Encoder(void);
 		~x264Encoder(void);
 		void setUiType(int uiType);
 		int isConfigurable(void);
-		int configure(void);
-		int getOptions(char *options, int bufferSize);
-		int setOptions(char *options);
+		int configure(vidEncVideoProperties *properties);
+		int getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+		int setOptions(vidEncOptions *encodeOptions, char *pluginOptions);
 		int getCurrentPass(void);
 		int getPassCount(void);
-		int open(vidEncProperties *properties);
+		int open(vidEncVideoProperties *properties);
 		int beginPass(void);
 		int getExtraHeaderData(uint8_t **data);
 		int encodeFrame(vidEncEncodeParams *encodeParams);
@@ -79,12 +80,12 @@
 #else
 	void *encoders_getPointer(int uiType);
 	int x264Encoder_isConfigurable(void);
-	int x264Encoder_configure(void);
-	int x264Encoder_getOptions(char *options, int bufferSize);
-	int x264Encoder_setOptions(char *options);
+	int x264Encoder_configure(vidEncVideoProperties *properties);
+	int x264Encoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+	int x264Encoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions);
 	int x264Encoder_getPassCount(void);
 	int x264Encoder_getCurrentPass(void);
-	int x264Encoder_open(vidEncProperties *properties);
+	int x264Encoder_open(vidEncVideoProperties *properties);
 	void x264Encoder_close(void);
 	int x264Encoder_encodeFrame(vidEncEncodeParams *encodeParams);
 #endif	// __cplusplus

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2008-04-26 19:14:38 UTC (rev 3986)
@@ -74,19 +74,19 @@
 	return x264Encoder_isConfigurable();
 }
 
-int vidEncConfigure(int encoderId)
+int vidEncConfigure(int encoderId, vidEncVideoProperties *properties)
 {
-	return x264Encoder_configure();
+	return x264Encoder_configure(properties);
 }
 
-int vidEncGetOptions(int encoderId, char *options, int bufferSize)
+int vidEncGetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
-	return x264Encoder_getOptions(options, bufferSize);
+	return x264Encoder_getOptions(encodeOptions, pluginOptions, bufferSize);
 }
 
-int vidEncSetOptions(int encoderId, char *options)
+int vidEncSetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions)
 {
-	return x264Encoder_setOptions(options);
+	return x264Encoder_setOptions(encodeOptions, pluginOptions);
 }
 
 int vidEncGetPassCount(int encoderId)
@@ -99,7 +99,7 @@
 	return x264Encoder_getCurrentPass();
 }
 
-int vidEncOpen(int encoderId, vidEncProperties *properties)
+int vidEncOpen(int encoderId, vidEncVideoProperties *properties)
 {
 	return x264Encoder_open(properties);
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -28,7 +28,6 @@
 	_param.rc.psz_rc_eq = strdup(_param.rc.psz_rc_eq);
 
 	_sarAsInput = false;
-	_param.rc.i_rc_method = X264_RC_CQP;
 }
 
 x264Options::~x264Options(void)
@@ -717,50 +716,6 @@
 	_param.analyse.b_ssim = computeSsim;
 }
 
-unsigned int x264Options::getRateControlMethod(void)
-{
-	return _param.rc.i_rc_method;
-}
-
-unsigned int x264Options::getBitrate(void)
-{
-	return _param.rc.i_bitrate;
-}
-
-void x264Options::setBitrate(unsigned int bitrate)
-{
-	_param.rc.i_rc_method = X264_RC_ABR;
-	_param.rc.i_bitrate = bitrate;
-}
-
-unsigned int x264Options::getQuantiser(void)
-{
-	return _param.rc.i_qp_constant;
-}
-
-void x264Options::setQuantiser(unsigned int quantiser)
-{
-	if (quantiser &lt;= 51)
-	{
-		_param.rc.i_rc_method = X264_RC_CQP;
-		_param.rc.i_qp_constant = quantiser;
-	}
-}
-
-unsigned int x264Options::getVbrQuantiser(void)
-{
-	return (unsigned int)_param.rc.f_rf_constant;
-}
-
-void x264Options::setVbrQuantiser(unsigned vbrQuantiser)
-{
-	if (vbrQuantiser &lt;= 51)
-	{
-		_param.rc.i_rc_method = X264_RC_CRF;
-		_param.rc.f_rf_constant = vbrQuantiser;
-	}
-}
-
 unsigned int x264Options::getQuantiserMinimum(void)
 {
 	return _param.rc.i_qp_min;
@@ -1283,21 +1238,6 @@
 		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;computeSsim&quot;, boolean2String(xmlBuffer, bufferSize, getComputeSsim()));
 
 		xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;rateControl&quot;, NULL);
-		xmlNodeChild2 = xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;method&quot;, NULL);
-
-		switch (getRateControlMethod())
-		{
-			case X264_RC_CQP:
-				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;quantiser&quot;, number2String(xmlBuffer, bufferSize, getQuantiser()));
-				break;
-			case X264_RC_CRF:
-				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;vbrQuantiser&quot;, number2String(xmlBuffer, bufferSize, getVbrQuantiser()));
-				break;
-			case X264_RC_ABR:
-				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;bitrate&quot;, number2String(xmlBuffer, bufferSize, getBitrate()));
-				break;
-		}
-
 		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMinimum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMinimum()));
 		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMaximum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMaximum()));
 		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserStep&quot;, number2String(xmlBuffer, bufferSize, getQuantiserStep()));
@@ -1778,21 +1718,7 @@
 		{
 			char *content = (char*)xmlNodeGetContent(xmlChild);
 
-			if (strcmp((char*)xmlChild-&gt;name, &quot;method&quot;) == 0)
-			{
-				xmlNode *xmlMethod = node-&gt;children;
-				char *methodContent = (char*)xmlNodeGetContent(xmlChild);
-
-				if (strcmp((char*)xmlMethod-&gt;name, &quot;quantiser&quot;) == 0)
-					setQuantiser(atoi(methodContent));
-				else if (strcmp((char*)xmlMethod-&gt;name, &quot;vbrQuantiser&quot;) == 0)
-					setVbrQuantiser(atoi(methodContent));
-				else if (strcmp((char*)xmlMethod-&gt;name, &quot;bitrate&quot;) == 0)
-					setBitrate(atoi(methodContent));
-
-				xmlFree(methodContent);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMinimum&quot;) == 0)
+			if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMinimum&quot;) == 0)
 				setQuantiserMinimum(atoi(content));
 			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMaximum&quot;) == 0)
 				setQuantiserMaximum(atoi(content));

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -229,17 +229,6 @@
 	bool getComputeSsim(void);
 	void setComputeSsim(bool computeSsim);
 
-	unsigned int getRateControlMethod(void);
-
-	unsigned int getBitrate(void);
-	void setBitrate(unsigned int bitrate);
-
-	unsigned int getQuantiser(void);
-	void setQuantiser(unsigned int quantiser);
-
-	unsigned int getVbrQuantiser(void);
-	void setVbrQuantiser(unsigned int vbrQuantiser);
-
 	unsigned int getQuantiserMinimum(void);
 	void setQuantiserMinimum(unsigned int quantiserMinimum);
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2008-04-26 19:14:38 UTC (rev 3986)
@@ -25,7 +25,7 @@
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;DIA_fileSel.h&quot;
 
-x264ConfigDialog::x264ConfigDialog(vidEncProperties *properties, x264Options *options)
+x264ConfigDialog::x264ConfigDialog(vidEncVideoProperties *properties, vidEncOptions *encodeOptions, x264Options *options)
 {
 	static const int _predefinedARs[aspectRatioCount][2] = {{16, 15}, {64, 45}, {8, 9}, {32, 27}};
 
@@ -75,7 +75,7 @@
 	connect(ui.zoneEditButton, SIGNAL(pressed()), this, SLOT(zoneEditButton_pressed()));
 	connect(ui.frameTypeFileButton, SIGNAL(pressed()), this, SLOT(frameTypeFileButton_pressed()));	
 
-	loadSettings(properties, options);
+	loadSettings(encodeOptions, options);
 }
 
 // General tab
@@ -245,30 +245,30 @@
 	return valueIndex;
 }
 
-void x264ConfigDialog::loadSettings(vidEncProperties *properties, x264Options *options)
+void x264ConfigDialog::loadSettings(vidEncOptions *encodeOptions, x264Options *options)
 {
 	// General tab
-	switch (properties-&gt;encodeMode)
+	switch (encodeOptions-&gt;encodeMode)
 	{
 		case ADM_VIDENC_MODE_CBR:	// Constant Bitrate (Single Pass)
 			ui.encodingModeComboBox-&gt;setCurrentIndex(0);
-			ui.targetRateControlSpinBox-&gt;setValue(properties-&gt;encodeModeParameter);
+			ui.targetRateControlSpinBox-&gt;setValue(encodeOptions-&gt;encodeModeParameter);
 			break;
 		case ADM_VIDENC_MODE_CQP:	// Constant Quality (Single Pass)
 			ui.encodingModeComboBox-&gt;setCurrentIndex(1);
-			ui.targetRateControlSpinBox-&gt;setValue(properties-&gt;encodeModeParameter);
+			ui.quantiserSpinBox-&gt;setValue(encodeOptions-&gt;encodeModeParameter);
 			break;
 		case ADM_VIDENC_MODE_AQP:	// Average Quantizer (Single Pass)
 			ui.encodingModeComboBox-&gt;setCurrentIndex(2);
-			ui.targetRateControlSpinBox-&gt;setValue(properties-&gt;encodeModeParameter);
+			ui.quantiserSpinBox-&gt;setValue(encodeOptions-&gt;encodeModeParameter);
 			break;
 		case ADM_VIDENC_MODE_2PASS_SIZE:	// Video Size (Two Pass)
 			ui.encodingModeComboBox-&gt;setCurrentIndex(3);
-			ui.targetRateControlSpinBox-&gt;setValue(properties-&gt;encodeModeParameter);
+			ui.targetRateControlSpinBox-&gt;setValue(encodeOptions-&gt;encodeModeParameter);
 			break;
 		case ADM_VIDENC_MODE_2PASS_ABR:	// Average Bitrate (Two Pass)
 			ui.encodingModeComboBox-&gt;setCurrentIndex(4);
-			ui.targetRateControlSpinBox-&gt;setValue(properties-&gt;encodeModeParameter);
+			ui.targetRateControlSpinBox-&gt;setValue(encodeOptions-&gt;encodeModeParameter);
 			break;
 	}
 
@@ -426,30 +426,30 @@
 	ui.fullRangeSamplesCheckBox-&gt;setChecked(options-&gt;getFullRangeSamples());
 }
 
-void x264ConfigDialog::saveSettings(vidEncProperties *properties, x264Options *options)
+void x264ConfigDialog::saveSettings(vidEncOptions *encodeOptions, x264Options *options)
 {
 	// General tab
 	switch (ui.encodingModeComboBox-&gt;currentIndex())
 	{
 		case 0:	// Constant Bitrate (Single Pass)
-			properties-&gt;encodeMode = ADM_VIDENC_MODE_CBR;
-			properties-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
+			encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CBR;
+			encodeOptions-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
 			break;
 		case 1: // Constant Quality (Single Pass)
-			properties-&gt;encodeMode = ADM_VIDENC_MODE_CQP;
-			properties-&gt;encodeModeParameter = ui.quantiserSpinBox-&gt;value();
+			encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CQP;
+			encodeOptions-&gt;encodeModeParameter = ui.quantiserSpinBox-&gt;value();
 			break;
 		case 2: // Average Quantizer (Single Pass)
-			properties-&gt;encodeMode = ADM_VIDENC_MODE_AQP;
-			properties-&gt;encodeModeParameter = ui.quantiserSpinBox-&gt;value();
+			encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_AQP;
+			encodeOptions-&gt;encodeModeParameter = ui.quantiserSpinBox-&gt;value();
 			break;
 		case 3: // Video Size (Two Pass)
-			properties-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
-			properties-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
+			encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+			encodeOptions-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
 			break;
 		case 4: // Average Bitrate (Two Pass)
-			properties-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
-			properties-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
+			encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			encodeOptions-&gt;encodeModeParameter = ui.targetRateControlSpinBox-&gt;value();
 			break;
 	}
 
@@ -588,13 +588,13 @@
 
 extern &quot;C&quot;
 {
-	int showX264ConfigDialog(vidEncProperties *properties, x264Options *options)
+	int showX264ConfigDialog(vidEncVideoProperties *properties, vidEncOptions *encodeOptions, x264Options *options)
 	{
-		x264ConfigDialog dialog(properties, options);
+		x264ConfigDialog dialog(properties, encodeOptions, options);
 
 		if (dialog.exec() == QDialog::Accepted)
 		{
-			dialog.saveSettings(properties, options);
+			dialog.saveSettings(encodeOptions, options);
 
 			return 1;
 		}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2008-04-26 19:14:38 UTC (rev 3986)
@@ -39,12 +39,12 @@
 	uint8_t inter4x4Luma[16], interChroma[16];
 	uint8_t intra8x8Luma[64], inter8x8Luma[64];
 
-	void loadSettings(vidEncProperties *properties, x264Options *options);
+	void loadSettings(vidEncOptions *encodeOptions, x264Options *options);
 	int getValueIndexInArray(uint8_t value, const uint8_t valueArray[], int elementCount);
 
 public:
-	x264ConfigDialog(vidEncProperties *properties, x264Options *options);
-	void saveSettings(vidEncProperties *properties, x264Options *options);
+	x264ConfigDialog(vidEncVideoProperties *properties, vidEncOptions *encodeOptions, x264Options *options);
+	void saveSettings(vidEncOptions *encodeOptions, x264Options *options);
 
 private slots:
 	// General tab

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2008-04-25 14:10:11 UTC (rev 3985)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2008-04-26 19:14:38 UTC (rev 3986)
@@ -348,15 +348,6 @@
 				&lt;xs:element name=&quot;rateControl&quot;&gt;
 					&lt;xs:complexType&gt;
 						&lt;xs:sequence&gt;
-							&lt;xs:element name=&quot;method&quot;&gt;
-								&lt;xs:complexType&gt;
-									&lt;xs:choice&gt;
-										&lt;xs:element name=&quot;bitrate&quot; type=&quot;uint&quot;/&gt;
-										&lt;xs:element name=&quot;quantiser&quot; type=&quot;quantiser&quot;/&gt;
-										&lt;xs:element name=&quot;vbrQuantiser&quot; type=&quot;quantiser&quot;/&gt;
-									&lt;/xs:choice&gt;
-								&lt;/xs:complexType&gt;
-							&lt;/xs:element&gt;
 							&lt;xs:element name=&quot;quantiserMinimum&quot;&gt;
 								&lt;xs:simpleType&gt;
 									&lt;xs:restriction base=&quot;xs:integer&quot;&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001245.html">[Avidemux-svn-commit] r3985 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_encoder	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
</A></li>
	<LI>Next message: <A HREF="001247.html">[Avidemux-svn-commit] r3987 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_audiofilter avidemux/ADM_encoder	avidemux/ADM_outputs/oplug_avi avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpeg avidemux/ADM_outputs/oplug_mpegFF	avidemux/ADM_outputs/oplug_ogm	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/winInstaller po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1246">[ date ]</a>
              <a href="thread.html#1246">[ thread ]</a>
              <a href="subject.html#1246">[ subject ]</a>
              <a href="author.html#1246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
