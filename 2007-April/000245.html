<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2927 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2927%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video&In-Reply-To=%3C200704121539.l3CFd9D7028673%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000244.html">
   <LINK REL="Next"  HREF="000246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2927 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2927%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video&In-Reply-To=%3C200704121539.l3CFd9D7028673%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2927 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video">mean at mail.berlios.de
       </A><BR>
    <I>Thu Apr 12 17:39:09 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000244.html">[Avidemux-svn-commit] r2926 - in	branches/avidemux_2.4_branch/avidemux: ADM_outputs/oplug_avi	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000246.html">[Avidemux-svn-commit] r2928 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#245">[ date ]</a>
              <a href="thread.html#245">[ thread ]</a>
              <a href="subject.html#245">[ subject ]</a>
              <a href="author.html#245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-04-12 17:39:08 +0200 (Thu, 12 Apr 2007)
New Revision: 2927

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
updated dialogFactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -1,144 +0,0 @@
-//
-
-# include &lt;config.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-#include &quot;config.h&quot;
-
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-
-static GtkWidget        *create_dialog1 (void);
-
-
-#define SPIN_GET(x,y) {*y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-                                printf(#x&quot;:%d\n&quot;,*y);}
-
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)*y) ; \
-                                printf(#x&quot;:%d\n&quot;,*y);}
-static GtkWidget *create_dialog1 (void);
-uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss);
-uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss)
-{
-GtkWidget *dialog;
-uint8_t ret;
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-        ret=0;
-
-        SPIN_SET(spinbuttonH,hh);
-        SPIN_SET(spinbuttonM,mm);
-        SPIN_SET(spinbuttonS,ss);
-        if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-        {
-                SPIN_GET(spinbuttonH,hh);
-                SPIN_GET(spinbuttonM,mm);
-                SPIN_GET(spinbuttonS,ss);
-                ret=1;
-        }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        return ret;
-
-}
-
-GtkWidget *create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *hbox1;
-  GtkObject *spinbuttonH_adj;
-  GtkWidget *spinbuttonH;
-  GtkWidget *label1;
-  GtkObject *spinbuttonM_adj;
-  GtkWidget *spinbuttonM;
-  GtkWidget *label2;
-  GtkObject *spinbuttonS_adj;
-  GtkWidget *spinbuttonS;
-  GtkWidget *label3;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;Go to time&quot;));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), hbox1, TRUE, TRUE, 0);
-
-  spinbuttonH_adj = gtk_adjustment_new (0, 0, 10, 1, 10, 10);
-  spinbuttonH = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonH_adj), 1, 0);
-  gtk_widget_show (spinbuttonH);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonH, TRUE, TRUE, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonH), TRUE);
-
-  label1 = gtk_label_new (_(&quot;h&quot;));
-  gtk_widget_show (label1);
-  gtk_box_pack_start (GTK_BOX (hbox1), label1, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  spinbuttonM_adj = gtk_adjustment_new (0, 0, 59, 1, 10, 10);
-  spinbuttonM = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonM_adj), 1, 0);
-  gtk_widget_show (spinbuttonM);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonM, TRUE, TRUE, 0);
-
-  label2 = gtk_label_new (_(&quot;mn&quot;));
-  gtk_widget_show (label2);
-  gtk_box_pack_start (GTK_BOX (hbox1), label2, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-
-  spinbuttonS_adj = gtk_adjustment_new (0, 0, 59, 1, 10, 10);
-  spinbuttonS = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonS_adj), 1, 0);
-  gtk_widget_show (spinbuttonS);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonS, TRUE, TRUE, 0);
-
-  label3 = gtk_label_new (_(&quot;s&quot;));
-  gtk_widget_show (label3);
-  gtk_box_pack_start (GTK_BOX (hbox1), label3, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, &quot;hbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonH, &quot;spinbuttonH&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonM, &quot;spinbuttonM&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonS, &quot;spinbuttonS&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-
-  gtk_widget_grab_default (okbutton1);
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
@@ -26,7 +26,6 @@
         DIA_preview.cpp \
         DIA_contrast.cpp \
         DIA_srt.cpp \
-        DIA_rotate.cpp \
 	DIA_coloryuv.cpp \
 	DIA_quota.cpp \
 	DIA_animated.cpp \
@@ -39,7 +38,7 @@
 DIA_mcdeint.cpp     DIA_resize.cpp \
 DIA_cnr2.cpp          DIA_mjpeg.cpp       \
 DIA_color.cpp         DIA_eq2.cpp          \
-DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp    DIA_rotate.cpp \
+DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp     \
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
 DIA_about.cpp        DIA_tdeint.cpp \
 DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp   DIA_v2v.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -41,6 +41,12 @@
 
 diaElemFileRead::~diaElemFileRead()
 {
+GtkWidget **wid=(GtkWidget **)myWidget;
+        if(wid)
+        {
+            delete [] wid;
+            myWidget=NULL;
+        }
   
 }
 void diaElemFileRead::setMe(void *dialog, void *opaque,uint32_t line)
@@ -96,27 +102,29 @@
   g_signal_connect(GTK_OBJECT(button), &quot;clicked&quot;,
                     GTK_SIGNAL_FUNC(fileRead),  this);
 
+  GtkWidget **w=new GtkWidget *[2];
+  w[0]=entry;
+  w[1]=button;
+  myWidget=(void *)w;
   
-  myWidget=(void *)entry;
-  
 }
 void diaElemFileRead::getMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
+  GtkWidget **widget=(GtkWidget **)myWidget;
   char **name=(char **)param;
   if(*name) delete [] *name;
   *name=NULL;
-  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (myWidget)));
+  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
 }
 
 void diaElemFileRead::changeFile(void)
 {
 #define MAX_SEL 200
   char buffer[MAX_SEL+1];
-  
-  GtkWidget *widget=(GtkWidget *)myWidget;
+  GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=(GtkWidget *)wid[0];
   const char *txt;
-  txt =gtk_entry_get_text (GTK_ENTRY (myWidget));
+  txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
   if(FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt))
   {
@@ -124,14 +132,16 @@
     if(*name) delete [] *name;
     *name=NULL;
     *name =ADM_strdup(buffer);
-     gtk_entry_set_text (GTK_ENTRY (myWidget), *name);
+     gtk_entry_set_text (GTK_ENTRY (widget), *name);
   }
   
 }
 
 void   diaElemFileRead::enable(uint32_t onoff)
 {
-     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+GtkWidget **wid=(GtkWidget **)myWidget;
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[0]),onoff);  
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
 }
 
 void fileRead(void *w,void *p)
@@ -153,7 +163,12 @@
 
 diaElemDirSelect::~diaElemDirSelect()
 {
-  
+  GtkWidget **wid=(GtkWidget **)myWidget;
+        if(wid)
+        {
+            delete [] wid;
+            myWidget=NULL;
+        }
 }
 void diaElemDirSelect::setMe(void *dialog, void *opaque,uint32_t line)
 {
@@ -209,26 +224,32 @@
                     GTK_SIGNAL_FUNC(dirSel),  this);
 
   
-  myWidget=(void *)entry;
+   GtkWidget **w=new GtkWidget *[2];
+  w[0]=entry;
+  w[1]=button;
+  myWidget=(void *)w;
   
 }
 void diaElemDirSelect::getMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
+GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=wid[0];
   char **name=(char **)param;
   if(*name) delete [] *name;
   *name=NULL;
-  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (myWidget)));
+  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget)));
 }
 
 void diaElemDirSelect::changeFile(void)
 {
 #define MAX_SEL 200
   char buffer[MAX_SEL+1];
+  GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=wid[0];
+
   
-  GtkWidget *widget=(GtkWidget *)myWidget;
   const char *txt;
-  txt =gtk_entry_get_text (GTK_ENTRY (myWidget));
+  txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
   if(FileSel_SelectDir(paramTitle,buffer,MAX_SEL,txt))
   {
@@ -236,13 +257,16 @@
     if(*name) delete [] *name;
     *name=NULL;
     *name =ADM_strdup(buffer);
-     gtk_entry_set_text (GTK_ENTRY (myWidget), *name);
+     gtk_entry_set_text (GTK_ENTRY (widget), *name);
   }
   
 }
 void   diaElemDirSelect::enable(uint32_t onoff)
 {
-     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+    GtkWidget **wid=(GtkWidget **)myWidget;
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[0]),onoff);  
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
+
 }
 
 void dirSel(void *w,void *p)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
@@ -3,7 +3,7 @@
 libADM_CommonUI_a_SOURCES = GUI_sdlRender.cpp  GUI_xvRender.cpp  \
 DIA_resizeWiz.cpp DIA_builtin.cpp DIA_postproc.cpp DIA_enter.cpp \
 DIA_audioconfig.cpp GUI_render.cpp DIA_SVCD.cpp DIA_DVDff.cpp \
-DIA_bitrateHisto.cpp DIA_prefs.cpp
+DIA_bitrateHisto.cpp DIA_prefs.cpp DIA_gototime.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -25,23 +25,47 @@
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidRotate.h&quot;
+//#include &quot;ADM_video/ADM_vidRotate.h&quot;
 #include &quot;ADM_filter/video_filters.h&quot;
 #include &lt;ADM_assert.h&gt;
+        
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
 
+typedef struct ROTATE_PARAM
+{
+  uint32_t width;
+  uint32_t height;
+  uint32_t angle;
+}ROTATE_PARAM;
+
+class  ADMVideoRotate:public AVDMGenericVideoStream
+{
+
+ protected:
+  virtual char                  *printConf(void);
+  ROTATE_PARAM                  *_param;
+
+ public:
+                  ADMVideoRotate(AVDMGenericVideoStream *in, CONFcouple *setup);
+  virtual         ~ADMVideoRotate();
+  virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
+  virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
+  virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
+ }     ;
+
 static FILTER_PARAM rotpParam={3,{&quot;width&quot;,&quot;height&quot;,&quot;angle&quot;}};
 
 
 SCRIPT_CREATE(rotate_script,ADMVideoRotate,rotpParam);
 BUILD_CREATE(rotate_create,ADMVideoRotate);
 
-uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param);
+static void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle);
 
 char *ADMVideoRotate::printConf( void )
 {
   static char buf[50];
  	
-  sprintf((char *)buf,&quot; Rotate %3.2f degrees&quot;, _param-&gt;angle);
+  sprintf((char *)buf,&quot; Rotate %u degrees&quot;, _param-&gt;angle);
   return buf;
 }
 
@@ -69,7 +93,7 @@
   {
     _param = NEW( ROTATE_PARAM);
     printf(&quot;New Angle 0.0\n&quot;);
-    _param-&gt;angle = 0.0;
+    _param-&gt;angle = 0;
     _param-&gt;width = _info.width;
     _param-&gt;height = _info.height;
   }
@@ -124,117 +148,140 @@
   return 1;
 }
 
-void do_rotate(ADMImage *source,ADMImage *target,float angle)
-    //uint8_t *out, uint32_t *out_w, uint32_t *out_h)
+void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle)
 {
-  uint8_t *in;
-  uint32_t in_w,in_h;
+uint8_t *in;
+uint32_t in_w,in_h;
 
-  in=source-&gt;data;
-  in_w=source-&gt;_width;
-  in_h=source-&gt;_height;
+in=source-&gt;data;
+in_w=source-&gt;_width;
+in_h=source-&gt;_height;
 
-  uint32_t x, y;
-  uint32_t u_offset = (in_w * in_h);
-  uint32_t v_offset = u_offset + (in_w/2 * in_h/2);
-  uint32_t in_sub_w = in_w/2;
-  uint32_t in_sub_h = in_h/2;
-  uint32_t out_sub_w, out_sub_h;
-  
-  uint8_t *out=target-&gt;data;
-  uint32_t *out_w=&amp;(target-&gt;_width);
-  uint32_t *out_h=&amp;(target-&gt;_height);
-  
-  ADM_assert(in_w*in_h==(*out_w)*(*out_h));
-  
-  // In general, for 0 &lt;= i &lt; width and 0 &lt;= j &lt; height, the pixel (x + i, y + j) is colored with red value 
-  // red value   rgb_buf[(j * rowstride) + (i * 3) + 0], 
-  // green value rgb_buf[(j * rowstride) + (i * 3) + 1], 
-  // blue value  rgb_buf[(j * rowstride) + (i * 3) + 2].
+uint32_t x, y;
+uint32_t u_offset = (in_w * in_h);
+uint32_t v_offset = u_offset + (in_w/2 * in_h/2);
+uint32_t in_sub_w = in_w/2;
+uint32_t in_sub_h = in_h/2;
+uint32_t out_sub_w, out_sub_h;
 
-  if((angle &gt;= 0.0) &amp;&amp; (angle &lt; 90.0))
-  {
-    *out_w = in_w;
-    *out_h = in_h;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
+uint8_t *out=target-&gt;data;
+uint32_t *out_w=&amp;(target-&gt;_width);
+uint32_t *out_h=&amp;(target-&gt;_height);
 
-    for(x = 0; x &lt; *out_w; x++)
-      for(y = 0; y &lt; *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * y) + x);
+ADM_assert(in_w*in_h==(*out_w)*(*out_h));
 
-    for(x = 0; x &lt; out_sub_w; x++)
-      for(y = 0; y &lt; out_sub_h; y++)
-       {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * y) + x);
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * y) + x);
-       }
-  }
-  else if((angle &gt;= 90.0) &amp;&amp; (angle &lt; 180.0))
-  {
-    *out_w = in_h;
-    *out_h = in_w;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
+// In general, for 0 &lt;= i &lt; width and 0 &lt;= j &lt; height, the pixel (x + i, y + j) is colored with red value 
+// red value   rgb_buf[(j * rowstride) + (i * 3) + 0], 
+// green value rgb_buf[(j * rowstride) + (i * 3) + 1], 
+// blue value  rgb_buf[(j * rowstride) + (i * 3) + 2].
 
-    for(x = 0; x &lt; *out_w; x++)
-      for(y = 0; y &lt; *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-x-1)) + y);
-
-    for(x = 0; x &lt; out_sub_w; x++)
-      for(y = 0; y &lt; out_sub_h; y++)
-       {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-       }
-  }
-  else if((angle &gt;= 180.0) &amp;&amp; (angle &lt; 270.0))
-  {
-    *out_w = in_w;
-    *out_h = in_h;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
-
-    for(x = 0; x &lt; *out_w; x++)
-      for(y = 0; y &lt; *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-y-1)) + in_w-x-1);
-
-
-    for(x = 0; x &lt; out_sub_w; x++)
-      for(y = 0; y &lt; out_sub_h; y++)
-         {
-           *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-           *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-         }
-  }
-  else if((angle &gt;= 270.0) &amp;&amp; (angle &lt; 360.0))
-  {
-    *out_w = in_h;
-    *out_h = in_w;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
-
-    for(x = 0; x &lt; *out_w; x++)
-      for(y = 0; y &lt; *out_h; y++)
-        *(out + (*out_w * y) + x) = *(in + (in_w * x) + (in_w-y-1));
-
-    for(x = 0; x &lt; out_sub_w; x++)
-      for(y = 0; y &lt; out_sub_h; y++)
-      {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * x) + (in_sub_w-y-1));
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * x) + (in_sub_w-y-1));
-      }
-  }
+        switch(angle)
+        {
+        case 0:
+                *out_w = in_w;
+                *out_h = in_h;
+                out_sub_w = *out_w/2;
+                out_sub_h = *out_h/2;
+            
+                for(x = 0; x &lt; *out_w; x++)
+                for(y = 0; y &lt; *out_h; y++)
+                    *(out + (*out_w * y) + x) = *(in + (in_w * y) + x);
+            
+                for(x = 0; x &lt; out_sub_w; x++)
+                for(y = 0; y &lt; out_sub_h; y++)
+                {
+                    *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * y) + x);
+                    *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * y) + x);
+                }
+                break;
+        case 90:
+        {
+            *out_w = in_h;
+            *out_h = in_w;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x &lt; *out_w; x++)
+            for(y = 0; y &lt; *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-x-1)) + y);
+        
+            for(x = 0; x &lt; out_sub_w; x++)
+            for(y = 0; y &lt; out_sub_h; y++)
+            {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-x-1)) + y);
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-x-1)) + y);
+            }
+        }
+        break;
+        case 180:
+        {
+            *out_w = in_w;
+            *out_h = in_h;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x &lt; *out_w; x++)
+            for(y = 0; y &lt; *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-y-1)) + in_w-x-1);
+        
+        
+            for(x = 0; x &lt; out_sub_w; x++)
+            for(y = 0; y &lt; out_sub_h; y++)
+                {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
+                }
+        }
+            break;
+        case 270:
+        {
+            *out_w = in_h;
+            *out_h = in_w;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x &lt; *out_w; x++)
+            for(y = 0; y &lt; *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * x) + (in_w-y-1));
+        
+            for(x = 0; x &lt; out_sub_w; x++)
+            for(y = 0; y &lt; out_sub_h; y++)
+            {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * x) + (in_sub_w-y-1));
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * x) + (in_sub_w-y-1));
+            }
+        }
+        break;
+        default:
+            ADM_assert(0);
+        }
 }
 uint8_t ADMVideoRotate::configure( AVDMGenericVideoStream *instream)
 {
   uint8_t r;
-  r= DIA_rotate(instream,_param);
-  if(r)
+  
+  diaMenuEntry rotateValues[]={
+      {0,_(&quot;None&quot;),_(&quot;None&quot;)},
+      {90,_(&quot;90 degrees&quot;),_(&quot;90&#176;&quot;)},
+      {180,_(&quot;180 degrees&quot;),_(&quot;180&#176;&quot;)},
+      {270,_(&quot;270 degrees&quot;),_(&quot;270&#176;&quot;)}
+  };
+  diaElemMenu     rotate(&amp;(_param-&gt;angle),_(&quot;Angle&quot;),4,rotateValues,NULL);
+  diaElem *allWidgets[]={&amp;rotate};
+  if( !diaFactoryRun(_(&quot;Rotate Params&quot;),1,allWidgets)) return 0;
+  
+  uint32_t w,h;
+  w=_in-&gt;getInfo()-&gt;width;
+  h=_in-&gt;getInfo()-&gt;height;
+  if((_param-&gt;angle%180)==90)
   {
-    _info.width=_param-&gt;width;
-    _info.height=_param-&gt;height;
+    _info.width=_param-&gt;width=h;
+    _info.height=_param-&gt;height=w;
+  }else
+  {
+      _info.width=_param-&gt;width=w;
+      _info.height=_param-&gt;height=h;
   }
-  return r;
+  return 1;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -1407,6 +1407,7 @@
 AudioSource currentAudioSource=AudioAvi;
 AudioSource secondAudioSource=AudioNone;
 char *currentAudioName=NULL;
+char *secondAudioName=NULL;
 //_____________________________________________________________
 //
 //              Load MP3 and identify wavfmt infos to fill avi header
@@ -1986,7 +1987,7 @@
         uint32_t old,nw;        
         uint8_t r=0;
         uint32_t oldtrack,newtrack;
-        char *newtrackname=NULL;
+        char *newtrackname=ADM_strdup(currentAudioName);
 
         if(!video_body-&gt;getAudioStreamsInfo(0,&amp;nb, &amp;infos))
         {
@@ -2075,33 +2076,48 @@
         return;
 
 }
+/**
+        \fn A_externalAudioTrack
+        \brief Select external audio track (for 2nd track)
+*/
 void A_externalAudioTrack( void )
 {
-        uint32_t nb=0,*infos=NULL;
-        AudioSource old,nw;        
-        uint8_t r=0;
+        uint32_t old,nw;
         uint32_t oldtrack,newtrack;
+        char  *newtrackname=ADM_strdup(secondAudioName);
 
-//secondaudiostream
+   diaMenuEntry sourcesStream[]={
+            {AudioNone,_(&quot;None&quot;),_(&quot;No audio&quot;)},
+            {AudioAC3,_(&quot;External AC3&quot;),_(&quot;Take audio from external AC3 file&quot;)},
+            {AudioMP3,_(&quot;External MP3&quot;),_(&quot;Take audio from external MP3 file&quot;)},
+            {AudioWav,_(&quot;External Wav&quot;),_(&quot;Take audio from external WAV file&quot;)}
+        };
+        
+        old=nw=secondAudioSource;
 
+        diaElemMenu     sourceMenu(&amp;nw,_(&quot;Audio source&quot;),4,sourcesStream,NULL);
+        diaElemFileRead sourceName(&amp;newtrackname,_(&quot;Filename&quot;));
+        diaElem *allWidgets[]={&amp;sourceMenu,&amp;sourceName};
 
-        nw=secondAudioSource;
-        r=DIA_audioTrack(&amp;nw, NULL,0, NULL);
-        if(!r) return;
+  /* Link..*/
+        
+         sourceMenu.link(&amp;(sourcesStream[2]),1,&amp;sourceName);
+         sourceMenu.link(&amp;(sourcesStream[3]),1,&amp;sourceName);
+         sourceMenu.link(&amp;(sourcesStream[1]),1,&amp;sourceName);
 
+         if( !diaFactoryRun(_(&quot;Select 2nd audio Track&quot;),2,allWidgets)) return;
+       
         if(secondAudioSource!=AudioNone)
         {
                  delete secondaudiostream;
                  secondAudioSource=AudioNone;
                  secondaudiostream=NULL;
+                 if(secondAudioName) ADM_dealloc(secondAudioName);
+                 secondAudioName=NULL;
         }
-        char               *name=NULL;
-        if(nw==AudioMP3|| nw==AudioAC3 || nw==AudioWav)
-        {
-          GUI_FileSelRead(_(&quot;Select 2nd track&quot;),&amp;name);
-        }
-        A_setSecondAudioTrack(nw,name);
-        if(name) ADM_dealloc(name);
+       secondAudioSource=(AudioSource)nw;
+        A_setSecondAudioTrack(secondAudioSource,newtrackname);
+        if(newtrackname) ADM_dealloc(newtrackname);
 }
 
 uint8_t A_setSecondAudioTrack(const AudioSource nw,char *name)
@@ -2124,6 +2140,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioMP3;
+                                secondAudioName=ADM_strdup(name);
                                 printf (&quot;\n MP3 loaded\n&quot;);
                                 GUI_Info_HIG(ADM_LOG_INFO,_(&quot;Second track loaded&quot;), NULL);
                                 return 1;
@@ -2145,6 +2162,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioAC3;
+                                secondAudioName=ADM_strdup(name);
                                 printf (&quot;\n AC3 loaded\n&quot;);
                                 GUI_Info_HIG(ADM_LOG_INFO,_(&quot;Second track loaded&quot;), NULL);
                                 return 1;
@@ -2166,6 +2184,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioAC3;
+                                secondAudioName=ADM_strdup(name);
                                 printf (&quot;\n AC3 loaded\n&quot;);
                                 GUI_Info_HIG(ADM_LOG_INFO,_(&quot;Second track loaded&quot;), NULL);
                                 return 1;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000244.html">[Avidemux-svn-commit] r2926 - in	branches/avidemux_2.4_branch/avidemux: ADM_outputs/oplug_avi	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000246.html">[Avidemux-svn-commit] r2928 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#245">[ date ]</a>
              <a href="thread.html#245">[ thread ]</a>
              <a href="subject.html#245">[ subject ]</a>
              <a href="author.html#245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
