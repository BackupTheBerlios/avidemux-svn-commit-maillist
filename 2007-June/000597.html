<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3320 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3320%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200706291554.l5TFs7Qq008161%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000596.html">
   <LINK REL="Next"  HREF="000598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3320 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3320%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200706291554.l5TFs7Qq008161%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3320 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Fri Jun 29 17:54:07 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000596.html">[Avidemux-svn-commit] r3319 - branches/avidemux_2.4_branch/po
</A></li>
        <LI>Next message: <A HREF="000598.html">[Avidemux-svn-commit] r3321 -	branches/avidemux_2.4_branch/avidemux/winInstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#597">[ date ]</a>
              <a href="thread.html#597">[ thread ]</a>
              <a href="subject.html#597">[ subject ]</a>
              <a href="author.html#597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-06-29 17:54:05 +0200 (Fri, 29 Jun 2007)
New Revision: 3320

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift_param.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift_param.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
move chromashift to videoFilter folder

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -35,7 +35,7 @@
 #include &quot;ADM_colorspace/ADM_rgb.h&quot;
 #include &quot;ADM_assert.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
-#include &quot;ADM_video/ADM_vidChromaShift_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;DIA_flyChromaShift.h&quot;
 
 static int lock=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -46,7 +46,7 @@
 #include &quot;ADM_video/ADM_vidHue.h&quot;
 #include &quot;ADM_video/ADM_vobsubinfo.h&quot;
 #include &quot;ADM_video/ADM_vidVobSub.h&quot;
-#include &quot;ADM_video/ADM_vidChromaShift_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
 #include &quot;ADM_video/ADM_vidEq2.h&quot;
 #include &quot;ADM_video/ADM_vidContrast.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -46,7 +46,7 @@
 #include &quot;ADM_video/ADM_vidHue.h&quot;
 #include &quot;ADM_video/ADM_vobsubinfo.h&quot;
 #include &quot;ADM_video/ADM_vidVobSub.h&quot;
-#include &quot;ADM_video/ADM_vidChromaShift_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
 #include &quot;ADM_video/ADM_vidEq2.h&quot;
 #include &quot;ADM_video/ADM_vidContrast.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -37,7 +37,7 @@
 #include &quot;ADM_assert.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
-#include &quot;ADM_video/ADM_vidChromaShift_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;DIA_flyChromaShift.h&quot;
 class Ui_chromaShiftWindow : public QDialog
  {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -23,8 +23,8 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidChromaShift.h&quot;
-#include &quot;ADM_video/ADM_vidChromaShift_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyChromaShift.h&quot;
 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -1,255 +0,0 @@
-/***************************************************************************
-                          ADM_vidChromaShift.cpp  -  description
-                             -------------------
-	Try to remove the blue-to-theleft &amp; red to the right effect by shifting chroma
-
-    begin                : Sun Aug 14 2003
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidChromaShift.h&quot;
-
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM cshiftParam={2,{&quot;u&quot;,&quot;v&quot;}};
-
-
-SCRIPT_CREATE(chromashift_script,ADMVideoChromaShift,cshiftParam);
-BUILD_CREATE(create_chromashift,ADMVideoChromaShift);
-
-char *ADMVideoChromaShift::printConf( void )
-{
- 	static char buf[50];
-
- 	snprintf((char *)buf,50,&quot; Chroma shift U:%d  V:%d&quot;,
-            _param-&gt;u,_param-&gt;v);
-        return buf;
-}
-
-ADMVideoChromaShift::ADMVideoChromaShift(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
- 	_in=in;		
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  		
-	 _param=NEW(CHROMASHIFT_PARAM);
-		if(couples)
-		{
-				GET(u);
-				GET(v);
-		}
-			else
-		{	// default parameter
-				_param-&gt;u=0;
-				_param-&gt;v=0;
-		}
-
-	_uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
-	ADM_assert(_uncompressed);
-	_info.encoding=1;
-}
-
-
-uint8_t	ADMVideoChromaShift::getCoupledConf( CONFcouple **couples)
-{
-
-		ADM_assert(_param);
-		*couples=new CONFcouple(2);
-		CSET(u);
-		CSET(v);
-		return 1;
-
-}
-
-ADMVideoChromaShift::~ADMVideoChromaShift()
-{
-	if(_uncompressed)
- 		delete _uncompressed;
-	_uncompressed=NULL;
-	DELETE(_param);
-
-}
-uint8_t ADMVideoChromaShift::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-
-		if(frame&gt;= _info.nb_frames) return 0;
-		ADM_assert(_param);									
-								
-		// read uncompressed frame
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-
-		// copy luma as it is left untouched
-		uint32_t w=_info.width;
-		uint32_t h=_info.height;
-//		uint8_t *in,*out;
-		uint32_t page;
-
-		page=(w*h);
-
-		memcpy(YPLANE(data),YPLANE(_uncompressed),page);
-
-		if(!_param-&gt;u)
-			{
-				memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
-			}
-		else
-			{
-				shift(UPLANE(data),UPLANE(_uncompressed),w&gt;&gt;1,h&gt;&gt;1,_param-&gt;u);
-			}
-		if(!_param-&gt;v)
-			{
-				memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
-			}
-		else
-			{
-				shift(VPLANE(data),VPLANE(_uncompressed),w&gt;&gt;1,h&gt;&gt;1,_param-&gt;v);
-			}
-		if(_param-&gt;u)
-			fixup(YPLANE(data),w,h,_param-&gt;u*2);
-		if(_param-&gt;v)
-			fixup(YPLANE(data),w,h,_param-&gt;v*2);
-		  data-&gt;copyInfo(_uncompressed);
-      return 1;
-}
-/*
-	Black out the area were we don't have a valid chroma color
-
-*/
-uint8_t ADMVideoChromaShift::fixup(uint8_t *target,uint32_t width, uint32_t height,int32_t val)
-{
-uint32_t line,page;
-uint8_t *zero;
-uint8_t *zerochroma;
-/*
-	If val is &gt;0
-		Source  ++++++++
-		Target   __++++++
-*/
-	page=(width*height)&gt;&gt;2;
-	if(val&gt;0)
-		{
-			line=val;
-			zero=target;
-			zerochroma=target+width*height;
-			for(uint32_t h=height;h&gt;0;h--)
-			{
-				memset(zero,0,val);
-				zero+=width;
-			}
-			val&gt;&gt;=1;
-			for(uint32_t h=height&gt;&gt;1;h&gt;0;h--)
-			{
-				memset(zerochroma,128,val);
-				memset(zerochroma+page,128,val);
-				zerochroma+=width&gt;&gt;1;
-			}
-		}
-/*
-	if val is &lt;0
-		Source ++++++
-		Target  ++++__
-
-*/
-
-		else
-		{
-			val=-val;
-
-			zero=target+width-val;
-			zerochroma=target+width*height;
-			zerochroma+=(width-val)/2;
-
-			for(uint32_t h=height;h&gt;0;h--)
-			{
-				memset(zero,0,val);
-				zero+=width;
-			}
-
-			val&gt;&gt;=1;
-			for(uint32_t h=height&gt;&gt;1;h&gt;0;h--)
-			{
-				memset(zerochroma,128,val);
-				memset(zerochroma+page,128,val);
-				zerochroma+=width&gt;&gt;1;
-			}
-		}
-}
-uint8_t ADMVideoChromaShift::shift(uint8_t *target,uint8_t *source, uint32_t width, uint32_t height,int32_t val)
-{
-uint32_t line;
-
-/*
-	If val is &gt;0
-		Source  ++++++++
-		Target   __++++++
-*/
-	if(val&gt;0)
-		{
-			line=width-val;
-			target+=val;
-			for(uint32_t h=height;h&gt;0;h--)
-			{
-			memcpy(target,source,line);
-			target+=width;
-			source+=width;
-			}
-		}
-/*
-	if val is &lt;0
-		Source ++++++
-		Target  ++++__
-
-*/
-
-		else
-		{
-			val=-val;
-			line=width-val;
-			source+=val;
-
-			for(uint32_t h=height;h&gt;0;h--)
-			{
-			memcpy(target,source,line);
-			target+=width;
-			source+=width;
-			}
-		}
-	return 1;
-}
-uint8_t DIA_getChromaShift( AVDMGenericVideoStream *instream,CHROMASHIFT_PARAM    *param );
-uint8_t ADMVideoChromaShift::configure( AVDMGenericVideoStream *instream)
-
-{
-    return DIA_getChromaShift(instream,_param);
-
-}
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.h	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.h	2007-06-29 15:54:05 UTC (rev 3320)
@@ -1,50 +0,0 @@
-/***************************************************************************
-                          ADM_vidChromaShift.h  -  description
-                             -------------------
-
-	Shift chroma to the left or to the right
-
-    begin                : Wed Aug 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef CHROMASHIFT_
-#define CHROMASHIFT_
-
-#include &quot;ADM_vidChromaShift_param.h&quot;
- class  ADMVideoChromaShift:public AVDMGenericVideoStream
- {
-
- protected:
-
-
-            virtual 	char               *printConf(void);
-                        CHROMASHIFT_PARAM *_param;
-
- public:
-                        ADMVideoChromaShift(  AVDMGenericVideoStream *in,CONFcouple *setup);
-      virtual           ~ADMVideoChromaShift();
-      virtual uint8_t   getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                                              ADMImage *data,uint32_t *flags);
-      virtual uint8_t   configure( AVDMGenericVideoStream *instream);
-      virtual uint8_t   getCoupledConf( CONFcouple **couples);
-
-      static	uint8_t shift(uint8_t *target,uint8_t *source,
-                                                      uint32_t width, uint32_t height,
-                                                      int32_t val);
-      static uint8_t    fixup(uint8_t *target,uint32_t width, uint32_t height,int32_t val);
-
- }     ;
-
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift_param.h	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift_param.h	2007-06-29 15:54:05 UTC (rev 3320)
@@ -1,30 +0,0 @@
-/***************************************************************************
-                          ADM_vidChromaShift.h  -  description
-                             -------------------
-
-	Shift chroma to the left or to the right
-
-    begin                : Wed Aug 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef CHROMASHIFT_PARAM_
-#define CHROMASHIFT_PARAM_
-
-typedef struct CHROMASHIFT_PARAM
-{
-      int32_t u;
-      int32_t v;
-}CHROMASHIFT_PARAM;
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-06-29 15:54:05 UTC (rev 3320)
@@ -23,7 +23,6 @@
 ADM_vidMPdelogo.cpp      
 ADM_vidSRT.cpp        
 ADM_vobsubinfo.cpp
-ADM_vidChromaShift.cpp  
 ADM_vidEq2.cpp             
 ADM_vidSRTload.cpp
 ADM_vidClean.cpp        

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-06-29 15:54:05 UTC (rev 3320)
@@ -20,7 +20,6 @@
  ADM_vidFieldUtil.h \
  ADM_confCouples.cpp \
  ADM_confCouple.h ADM_vidCommonFilter.h \
-	ADM_vidChromaShift.h ADM_vidChromaShift.cpp \
  ADM_interlaced.cpp \
 	ADM_interlaced.h \
  ADM_vidRaw.cpp \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift.cpp (from rev 3306, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.cpp	2007-06-25 15:09:17 UTC (rev 3306)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift.cpp	2007-06-29 15:54:05 UTC (rev 3320)
@@ -0,0 +1,255 @@
+/***************************************************************************
+                          ADM_vidChromaShift.cpp  -  description
+                             -------------------
+	Try to remove the blue-to-theleft &amp; red to the right effect by shifting chroma
+
+    begin                : Sun Aug 14 2003
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_vidChromaShift.h&quot;
+
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+static FILTER_PARAM cshiftParam={2,{&quot;u&quot;,&quot;v&quot;}};
+
+
+SCRIPT_CREATE(chromashift_script,ADMVideoChromaShift,cshiftParam);
+BUILD_CREATE(create_chromashift,ADMVideoChromaShift);
+
+char *ADMVideoChromaShift::printConf( void )
+{
+ 	static char buf[50];
+
+ 	snprintf((char *)buf,50,&quot; Chroma shift U:%d  V:%d&quot;,
+            _param-&gt;u,_param-&gt;v);
+        return buf;
+}
+
+ADMVideoChromaShift::ADMVideoChromaShift(  AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+
+ 	_in=in;		
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  		
+	 _param=NEW(CHROMASHIFT_PARAM);
+		if(couples)
+		{
+				GET(u);
+				GET(v);
+		}
+			else
+		{	// default parameter
+				_param-&gt;u=0;
+				_param-&gt;v=0;
+		}
+
+	_uncompressed=new ADMImage(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height);
+	ADM_assert(_uncompressed);
+	_info.encoding=1;
+}
+
+
+uint8_t	ADMVideoChromaShift::getCoupledConf( CONFcouple **couples)
+{
+
+		ADM_assert(_param);
+		*couples=new CONFcouple(2);
+		CSET(u);
+		CSET(v);
+		return 1;
+
+}
+
+ADMVideoChromaShift::~ADMVideoChromaShift()
+{
+	if(_uncompressed)
+ 		delete _uncompressed;
+	_uncompressed=NULL;
+	DELETE(_param);
+
+}
+uint8_t ADMVideoChromaShift::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+
+		if(frame&gt;= _info.nb_frames) return 0;
+		ADM_assert(_param);									
+								
+		// read uncompressed frame
+       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
+
+		// copy luma as it is left untouched
+		uint32_t w=_info.width;
+		uint32_t h=_info.height;
+//		uint8_t *in,*out;
+		uint32_t page;
+
+		page=(w*h);
+
+		memcpy(YPLANE(data),YPLANE(_uncompressed),page);
+
+		if(!_param-&gt;u)
+			{
+				memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
+			}
+		else
+			{
+				shift(UPLANE(data),UPLANE(_uncompressed),w&gt;&gt;1,h&gt;&gt;1,_param-&gt;u);
+			}
+		if(!_param-&gt;v)
+			{
+				memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
+			}
+		else
+			{
+				shift(VPLANE(data),VPLANE(_uncompressed),w&gt;&gt;1,h&gt;&gt;1,_param-&gt;v);
+			}
+		if(_param-&gt;u)
+			fixup(YPLANE(data),w,h,_param-&gt;u*2);
+		if(_param-&gt;v)
+			fixup(YPLANE(data),w,h,_param-&gt;v*2);
+		  data-&gt;copyInfo(_uncompressed);
+      return 1;
+}
+/*
+	Black out the area were we don't have a valid chroma color
+
+*/
+uint8_t ADMVideoChromaShift::fixup(uint8_t *target,uint32_t width, uint32_t height,int32_t val)
+{
+uint32_t line,page;
+uint8_t *zero;
+uint8_t *zerochroma;
+/*
+	If val is &gt;0
+		Source  ++++++++
+		Target   __++++++
+*/
+	page=(width*height)&gt;&gt;2;
+	if(val&gt;0)
+		{
+			line=val;
+			zero=target;
+			zerochroma=target+width*height;
+			for(uint32_t h=height;h&gt;0;h--)
+			{
+				memset(zero,0,val);
+				zero+=width;
+			}
+			val&gt;&gt;=1;
+			for(uint32_t h=height&gt;&gt;1;h&gt;0;h--)
+			{
+				memset(zerochroma,128,val);
+				memset(zerochroma+page,128,val);
+				zerochroma+=width&gt;&gt;1;
+			}
+		}
+/*
+	if val is &lt;0
+		Source ++++++
+		Target  ++++__
+
+*/
+
+		else
+		{
+			val=-val;
+
+			zero=target+width-val;
+			zerochroma=target+width*height;
+			zerochroma+=(width-val)/2;
+
+			for(uint32_t h=height;h&gt;0;h--)
+			{
+				memset(zero,0,val);
+				zero+=width;
+			}
+
+			val&gt;&gt;=1;
+			for(uint32_t h=height&gt;&gt;1;h&gt;0;h--)
+			{
+				memset(zerochroma,128,val);
+				memset(zerochroma+page,128,val);
+				zerochroma+=width&gt;&gt;1;
+			}
+		}
+}
+uint8_t ADMVideoChromaShift::shift(uint8_t *target,uint8_t *source, uint32_t width, uint32_t height,int32_t val)
+{
+uint32_t line;
+
+/*
+	If val is &gt;0
+		Source  ++++++++
+		Target   __++++++
+*/
+	if(val&gt;0)
+		{
+			line=width-val;
+			target+=val;
+			for(uint32_t h=height;h&gt;0;h--)
+			{
+			memcpy(target,source,line);
+			target+=width;
+			source+=width;
+			}
+		}
+/*
+	if val is &lt;0
+		Source ++++++
+		Target  ++++__
+
+*/
+
+		else
+		{
+			val=-val;
+			line=width-val;
+			source+=val;
+
+			for(uint32_t h=height;h&gt;0;h--)
+			{
+			memcpy(target,source,line);
+			target+=width;
+			source+=width;
+			}
+		}
+	return 1;
+}
+uint8_t DIA_getChromaShift( AVDMGenericVideoStream *instream,CHROMASHIFT_PARAM    *param );
+uint8_t ADMVideoChromaShift::configure( AVDMGenericVideoStream *instream)
+
+{
+    return DIA_getChromaShift(instream,_param);
+
+}
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift.h (from rev 3306, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidChromaShift_param.h (from rev 3306, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidChromaShift_param.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-06-29 15:54:05 UTC (rev 3320)
@@ -21,5 +21,6 @@
 ADM_vidMPLResize.cpp  
 ADM_vidResize25.cpp
 ADM_vidTdeint.cpp
+ADM_vidChromaShift.cpp  
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-06-29 15:53:25 UTC (rev 3319)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-06-29 15:54:05 UTC (rev 3320)
@@ -36,6 +36,7 @@
  ADM_vidFlipV.cpp \
  ADM_vidLuma.cpp \
  ADM_vidLargeMedian.cpp \
+ ADM_vidChromaShift.cpp  
  ADM_vidChroma.cpp \
  ADM_vidMosaic.cpp \
  ADM_vidBlendRemoval.cpp  \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000596.html">[Avidemux-svn-commit] r3319 - branches/avidemux_2.4_branch/po
</A></li>
	<LI>Next message: <A HREF="000598.html">[Avidemux-svn-commit] r3321 -	branches/avidemux_2.4_branch/avidemux/winInstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#597">[ date ]</a>
              <a href="thread.html#597">[ thread ]</a>
              <a href="subject.html#597">[ subject ]</a>
              <a href="author.html#597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
