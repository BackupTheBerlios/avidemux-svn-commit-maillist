<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4918 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_codecs avidemux/gtk	avidemux_core cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4918%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_codecs%20avidemux/gtk%0A%09avidemux_core%20cmake&In-Reply-To=%3C200906142005.n5EK59K7030125%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002133.html">
   <LINK REL="Next"  HREF="002135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4918 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_codecs avidemux/gtk	avidemux_core cmake</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4918%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_codecs%20avidemux/gtk%0A%09avidemux_core%20cmake&In-Reply-To=%3C200906142005.n5EK59K7030125%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4918 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_codecs avidemux/gtk	avidemux_core cmake">mean at mail.berlios.de
       </A><BR>
    <I>Sun Jun 14 22:05:09 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002133.html">[Avidemux-svn-commit] r4917 - branches/avidemux_2.6_branch_mean
</A></li>
        <LI>Next message: <A HREF="002135.html">[Avidemux-svn-commit] r4919 -	branches/avidemux_2.6_branch_mean/avidemux/common
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2134">[ date ]</a>
              <a href="thread.html#2134">[ thread ]</a>
              <a href="subject.html#2134">[ subject ]</a>
              <a href="author.html#2134">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-06-14 22:05:07 +0200 (Sun, 14 Jun 2009)
New Revision: 4918

Added:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpegConfig.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4param.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_autodrive.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_blackframes.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_misc.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[Gtk] Build .o files (no static libs)

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,966 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpeg.cpp  -  description
-                             -------------------
-
-	Encoder for ffmpeg
-	Reverse enginereed from mplayer &amp; transcode
-
-
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-
-
-#define __STDC_CONSTANT_MACROS // Lavcodec crap
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_lavcodec.h&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-
-#include &quot;prefs.h&quot;
-
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
-//#define TEST_NOB 1
-
-extern int ADM_cpu_num_processors(void);
-static char LogName[500];
-
-#define WRAP_Open(x) \
-{\
-AVCodec *codec=avcodec_find_encoder(x);\
-if(!codec) {GUI_Error_HIG(&quot;Codec&quot;,QT_TR_NOOP(&quot;Internal error opening codec&quot;#x));ADM_assert(0);} \
-  res=avcodec_open(_context, codec); \
-  if(res&lt;0) {GUI_Error_HIG(&quot;Codec&quot;,QT_TR_NOOP(&quot;Internal error with context for  codec&quot;#x&quot;.\n Did you use too low / too high target for 2 pass ?&quot;));return 0;} \
-}
-/*****************************************/
-uint8_t ffmpegEncoder::stopEncoder(void)
-{
-    printf(&quot;[lavc] stopEncoder (%x)\n&quot;,_context);
-    if (_context)
-    {
-        avcodec_close (_context);
-        ADM_dealloc (_context);
-        _context = NULL;
-    }
-    return 1;
-}
-/*****************************************/
-ffmpegEncoderCQ::~ffmpegEncoderCQ ()
-  {
-    printf(&quot;[LAVCODEC]Deleting ffmpegCQencoder\n&quot;);
-    //stopEncoder ();
-    if (_statfile)
-      {
-        fflush(_statfile);
-	fclose (_statfile);
-      }
-  }
-/*****************************************/
-void ffmpegEncoder::postAmble (ADMBitstream * out, uint32_t sz)
-{
-//  out-&gt;ptsFrame = _context-&gt;coded_frame-&gt;display_picture_number; //real_pict_num;;
- //printf(&quot;Out : %u\n&quot;,out-&gt;ptsFrame);
-  out-&gt;len = (uint32_t) sz;
-  out-&gt;flags = frameType ();;
-  if(!_context-&gt;coded_frame-&gt;quality)
-      out-&gt;out_quantizer=(int) floor (_frame.quality / (float) FF_QP2LAMBDA);
-  else
-      out-&gt;out_quantizer =(int) floor (_context-&gt;coded_frame-&gt;quality / (float) FF_QP2LAMBDA);
-
-}
-//static myENC_RESULT res;
-/*****************************************/
-ffmpegEncoder::ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id,PixelFormat format):encoder (width,
-	 height)
-{
-  printf (&quot;[LAVCODEC]Build: %d, colorspace :%x\n&quot;, LIBAVCODEC_BUILD,format);
-  _targetColorSpace=format;//PIX_FMT_YUV420P
-  _id = id;
-  _swap = 0;
-  _context = NULL;
-  _settingsPresence = 0;
-
-  _context = avcodec_alloc_context ();
-
-  ADM_assert (_context);
-  memset (&amp;_frame, 0, sizeof (_frame));
-  _frame.pts = AV_NOPTS_VALUE;
-  _context-&gt;width = _w;
-  _context-&gt;height = _h;
-
-  _isMT = 0;
-  encodePreamble(NULL);
-
-};
-/*****************************************/
-uint8_t   ffmpegEncoder::encode(ADMImage *in,ADMBitstream *out)
-{
-    int32_t sz = 0;
-    ADM_assert(out-&gt;bufferSize);
-    encodePreamble (in-&gt;data);
-    if ((sz = avcodec_encode_video (_context, out-&gt;data, out-&gt;bufferSize, &amp;_frame)) &lt; 0)
-        return 0;
-    postAmble(out,sz);
-    return 1;
-}
-/*****************************************/
-ffmpegEncoder::~ffmpegEncoder ()
-{
-  printf (&quot;[lavc] encoder destroying..\n&quot;);
-  if (_isMT &amp;&amp; _context)
-    {
-      printf (&quot;[lavc] killing threads\n&quot;);
-      avcodec_thread_free (_context);
-      _isMT = 0;
-    }
-  stopEncoder ();
-}
-
-/*
-   	Initialize codec in Q mode
-
-*/
-
-uint8_t
-ffmpegEncoder::encodePreamble (uint8_t * in)
-{
-  _frame.key_frame = 0;
-  _frame.pict_type = 0;
-
-  switch(_targetColorSpace)
-  {
-    case PIX_FMT_YUV420P:
-        _frame.linesize[0] = _w;
-        _frame.linesize[1] = _w &gt;&gt; 1;
-        _frame.linesize[2] = _w &gt;&gt; 1;
-        _frame.data[0] = in;
-        _frame.data[2] = in + _w * _h;
-        _frame.data[1] = in + _w * _h + ((_w * _h) &gt;&gt; 2);
-        break;
- case PIX_FMT_YUV422P:
-        _frame.linesize[0] = _w;
-        _frame.linesize[1] = _w &gt;&gt; 1;
-        _frame.linesize[2] = _w &gt;&gt; 1;
-        _frame.data[0] = in;
-        _frame.data[2] = in + _w * _h;
-        _frame.data[1] = in + _w * _h + ((_w * _h) &gt;&gt; 1);
-
-        break;
-    default:
-      ADM_assert(0);
-  }
-  return 1;
-}
-
-uint32_t
-ffmpegEncoder::frameType (void)
-{
-  int k, t;
-
-  k = _context-&gt;coded_frame-&gt;key_frame;
-  t = _context-&gt;coded_frame-&gt;pict_type;
-
-  //printf(&quot; Kf: %d type :%d \n&quot;,k,t);
-  if (k == 1)
-    return AVI_KEY_FRAME;
-  if (t == FF_B_TYPE)
-    return AVI_B_FRAME;
-  //if(t==FF_I_TYPE) return AVI_KEY_FRAME;
-  return 0;
-
-}
-
-/*
-	This is called for mpeg1/2 initContext
-	Set some specific stuff.
-
-*/
-uint8_t
-ffmpegEncoder::gopMpeg1 (void)
-{
-  // small gop, 2 b frames allowed
-  // min bitrate 500 max bitrate 2200
-  int rate;
-
-  rate = _context-&gt;time_base.den;
-  rate = rate * 1000;
-  rate /= _context-&gt;time_base.num;
-
-  _context-&gt;me_range = 255;	// Fix motion vector for picky players (pioneer)
-
-  if (_id == FF_MPEG2)
-    {
-      if (FRAME_FILM == identMovieType (rate))
-	{
-	  printf (&quot;[LAVCODEC]Pulldown activated...\n&quot;);
-	  _context-&gt;flags2 |= CODEC_FLAG2_32_PULLDOWN;
-	}
-    }
-#ifdef  TEST_NOB		// disable B frames
-  _context-&gt;max_b_frames = 0;
-#else
-  _context-&gt;max_b_frames = 2;
-#endif
-  printf (&quot;[LAVCODEC]Using 2 b frames\n&quot;);
-  if (_id == FF_MPEG2)
-    {
-      _context-&gt;mpeg_quant = 1;	//1; // Should be mpeg quant
-    }
-  else
-    {
-      _context-&gt;mpeg_quant = 0;	//1; // Should be mpeg quant
-    }
-  if (_settingsPresence)
-    {
-      if (_settings.widescreen)
-	{
-          printf(&quot;[LAVCODEC]WideScreen\n&quot;);
-	  _context-&gt;sample_aspect_ratio.num = 16;
-	  _context-&gt;sample_aspect_ratio.den = 9;
-	}
-      else
-	{
-	  _context-&gt;sample_aspect_ratio.num = 4;
-	  _context-&gt;sample_aspect_ratio.den = 3;
-	}
-
-      _context-&gt;rc_max_rate_header = _settings.maxBitrate * 1000;//1800*1000;// 2400 max, 700 min
-      _context-&gt;rc_buffer_size_header = _settings.bufferSize * 8 * 1024;
-      // If we don't have a maxrate, don't set buffer_size
-      if (1 &amp;&amp; !_settings.override_ratecontrol)	// FIXME
-
-	{
-	  _context-&gt;rc_buffer_size = _context-&gt;rc_buffer_size_header;
-	  _context-&gt;rc_max_rate = _context-&gt;rc_max_rate_header;
-	}
-      else
-	{
-	  _context-&gt;rc_buffer_size = 0;	// for xvid, no VBV so no ratecontrol
-	  _context-&gt;rc_max_rate = 0;
-	}
-      _context-&gt;gop_size = _settings.gop_size;
-
-    }
-  else
-    {
-      _context-&gt;rc_buffer_size = 200 * 8 * 1024;	// 40 for VCD  &amp; 200 for SVCD
-      _context-&gt;gop_size = _settings.gop_size;
-
-    }
-  _context-&gt;rc_buffer_aggressivity = 1.0;
-  _context-&gt;rc_initial_cplx = 3;
-  _context-&gt;qmin = 2;
-  _context-&gt;qmax = 31;
-
-  _context-&gt;scenechange_threshold = 0xfffffff;	// Don't insert I frame out of order
-
-  _frame.interlaced_frame = _settings.interlaced;
-  if (_settings.interlaced)
-    _frame.top_field_first = !_settings.bff;
-
-#if defined(CODEC_FLAG_INTERLACED_DCT)
-  _context-&gt;flags |= _settings.interlaced ? CODEC_FLAG_INTERLACED_DCT : 0;
-#endif
-#if defined(CODEC_FLAG_INTERLACED_ME)
-  _context-&gt;flags |= _settings.interlaced ? CODEC_FLAG_INTERLACED_ME : 0;
-#endif
-
-  //
-  //_context-&gt;dsp_mask= FF_MM_FORCE;
-  printf (&quot;[LAVCODEC]Mpeg12 settings:\n____________\n&quot;);
-  printf (&quot;[LAVCODEC]FF Max rate   (header) : %&quot;LU&quot; kbps\n&quot;,
-	  (_context-&gt;rc_max_rate_header) / 1000);
-  printf (&quot;[LAVCODEC]FF Buffer Size(header) : %&quot;LU&quot; bits / %&quot;LU&quot; kB\n&quot;,
-	  (_context-&gt;rc_buffer_size_header),
-	  _context-&gt;rc_buffer_size_header / (8 * 1024));
-  printf (&quot;[LAVCODEC]FF Max rate   (rc) : %&quot;LU&quot; kbps\n&quot;, (_context-&gt;rc_max_rate) / 1000);
-  printf (&quot;[LAVCODEC]FF Buffer Size(rc) : %&quot;LU&quot; bits / %&quot;LU&quot; kB\n&quot;,
-	  (_context-&gt;rc_buffer_size), _context-&gt;rc_buffer_size / (8 * 1024));
-
-  printf (&quot;[LAVCODEC]FF GOP Size    : %&quot;LU&quot;\n&quot;, _context-&gt;gop_size);
-  printf (&quot;[LAVCODEC]FF Bitrate    : %&quot;LU&quot; (kb/s)\n&quot;, _context-&gt;bit_rate/1000);
-
-  return 1;
-}
-
-uint8_t
-ffmpegEncoder::initContext (void)
-{
-  int res = 0;
-
-  // set a gop size close to what's requested for most
-  // player compatiblity
-  if (_id == FF_MPEG1 || _id == FF_MPEG2)
-    gopMpeg1 ();
-  // if (_id == FF_HUFF || _id == FF_FFV1)
-  _context-&gt;strict_std_compliance = -1;
-  if (_id == FF_HUFF || _id == FF_FFV1 ||_id == FF_FFHUFF )
-    _context-&gt;strict_std_compliance = -2;
-
-  switch (_id)
-    {
-    case FF_MPEG4:
-      encoderMT ();
-      WRAP_Open (CODEC_ID_MPEG4);
-      break;
-    case FF_MSMP4V3:
-      WRAP_Open (CODEC_ID_MSMPEG4V3);
-      break;
-    case FF_MPEG1:
-      encoderMT ();
-      WRAP_Open (CODEC_ID_MPEG1VIDEO);
-      break;
-    case FF_MPEG2:
-      encoderMT ();
-      WRAP_Open (CODEC_ID_MPEG2VIDEO);
-      break;
-    case FF_H263:
-      WRAP_Open (CODEC_ID_H263);
-      break;
-    case FF_H263P:
-      WRAP_Open (CODEC_ID_H263P);
-      break;
-    case FF_FLV1:
-      WRAP_Open (CODEC_ID_FLV1);
-      break;
-    case FF_HUFF:
-      WRAP_Open (CODEC_ID_HUFFYUV);
-      break;
-    case FF_FFV1:
-      WRAP_Open (CODEC_ID_FFV1);
-      break;
-    case FF_MJPEG:
-      WRAP_Open (CODEC_ID_MJPEG);
-      break;
-    case FF_FFHUFF:
-      WRAP_Open (CODEC_ID_FFVHUFF);
-      break;
-    case FF_SNOW:
-      WRAP_Open (CODEC_ID_SNOW);
-      break;
-
-    case FF_DV:
-      if(_context-&gt;width!=720 || _context-&gt;height!=576)
-            return 0; // should be caught by upper layers before going here...
-      WRAP_Open (CODEC_ID_DVVIDEO);
-      break;
-
-    default:
-      ADM_assert (0);
-    }
-
-  if (res &lt; 0)
-    {
-      printf (&quot;[lavc] Problem opening codec\n&quot;);
-      return 0;
-    }
-  return 1;
-
-}
-
-void ffmpegEncoder::encoderMT (void)
-{
-  uint32_t threads = 0;
-
-  prefs-&gt;get(FEATURE_THREADING_LAVC, &amp;threads);
-
-  if (threads == 0)
-	  threads = ADM_cpu_num_processors();
-
-  if (threads == 1)
-	  threads = 0;
-
-  if (threads)
-  {
-      printf (&quot;[lavc] Enabling MT encoder with %u threads\n&quot;, threads);
-
-      if (avcodec_thread_init (_context, threads) == -1)
-	      printf (&quot;[lavc] Failed!!\n&quot;);
-	  else
-          _isMT = 1;
-  }
-}
-
-/*
-		Set user selected matrices.
-
-*/
-uint8_t
-ffmpegEncoder::setCustomMatrices (uint16_t * intra, uint16_t * inter)
-{
-  _context-&gt;intra_matrix = intra;
-  _context-&gt;inter_matrix = inter;
-  return 1;
-}
-
-uint8_t
-ffmpegEncoder::setGopSize (uint32_t size)
-{
-
-  _context-&gt;gop_size = size;
-  printf (&quot;[LAVCODEC]Gop size is now %d\n&quot;, _context-&gt;gop_size);
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoder::setLogFile (const char *name)
-{
-  strcpy (LogName, name);
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoder::setConfig (FFcodecSetting * set)
-{
-  memcpy (&amp;_settings, set, sizeof (_settings));
-  _settingsPresence = 1;
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoderCQ::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  printf (&quot;[LAVCODEC] Using Q=%u\n&quot;,val);
-  mplayer_init ();
-  _qual = val;
-  _vbr = vbr;
-  _context-&gt;flags |= CODEC_FLAG_QSCALE;
-
-  if (_vbr)
-    {
-      _context-&gt;flags |= CODEC_FLAG_PASS1;
-      _statfile = NULL;
-
-    }
-  _context-&gt;time_base = (AVRational)  {  1000, fps1000};
-/*
-  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;
-*/
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-
-  return initContext ();
-}
-
-uint32_t ffmpegEncoder::getCodedFrame (void)
-{
-  return _last_coded_frame;
-}
-
-uint8_t ffmpegEncoderCQ::encode (ADMImage * in, ADMBitstream * out)
-{
-  int32_t    sz = 0;
-  uint32_t    f;
-  uint8_t    r=0;
-
-  _frame.quality = (int) floor (FF_QP2LAMBDA * _qual + 0.5);
-  r=ffmpegEncoder::encode(in,out);
-  out-&gt;out_quantizer=_qual;
-  if (_vbr)			// update for lavcodec internal
-    {
-      if (!_statfile)
-	{
-	  printf (&quot;[lavc] using %s as log file\n&quot;, LogName);
-	  _statfile = fopen (LogName, &quot;wb&quot;);
-	}
-
-      if (!_statfile)
-	{
-	  printf
-	    (&quot;[lavc] cannot open log file for writing! (%s)\n&quot;,
-	     LogName);
-	  return 0;
-	}
-      if (_context-&gt;stats_out)
-	fprintf (_statfile, &quot;%s&quot;, _context-&gt;stats_out);
-    }
-
-  return 1;
-
-}
-
-/*
-_____________________________________________
-*/
-/*
-   	Initialize codec in CBR mode
-
-*/
-
-uint8_t ffmpegEncoderCBR::init (uint32_t val, uint32_t fps1000)
-{
-//       mpeg4_encoder
-  //
-//              now init our stuff
-//
-  _br = val;
-  mplayer_init ();
-/*  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;*/
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-
-  if(_id==FF_MPEG2 || _id==FF_MPEG1)
-	  _context-&gt;bit_rate = _br;
-  else
-	  _context-&gt;bit_rate = _br*1000;
-
-  printf (&quot;[LAVCODEC] Using  bitrate in context :%&quot;LU&quot; kbps&quot;,_context-&gt;bit_rate/1000);
-
-  return initContext ();
-
-}
-
-
-//------------------------------------------------------------------------------
-//              VBR
-//------------------------------------------------------------------------------
-uint8_t ffmpegEncoderVBR::encode (ADMImage * in, ADMBitstream * out)
-{
-    uint16_t q;
-    uint8_t kf;
-
-    q=out-&gt;in_quantizer;
-    _frame.quality = (int) floor (FF_QP2LAMBDA * q + 0.5);
-    return ffmpegEncoder::encode(in,out);
-
-}
-/*
-   			val is the average bitrate wanted, else it is useless
-*/
-uint8_t
-ffmpegEncoderVBR::init (uint32_t val, uint32_t fps1000)
-{
-  uint32_t statSize;
-  FILE *_statfile;
-
-  printf (&quot;[lavc] initializing in VBR mode\n&quot;);
-  _qual = val;
-  mplayer_init ();
-
-//   _context-&gt;frame_rate_base = 1000;
-//   _context-&gt;frame_rate = fps1000;
-
-  _context-&gt;time_base = (AVRational)  {  1000, fps1000};
-
-  /* If internal 2 passes mode is selected ... */
-  _context-&gt;flags |= CODEC_FLAG_PASS2;
-
-  _statfile = fopen (LogName, &quot;rb&quot;);
-  if (!_statfile)
-    {
-      printf (&quot;internal file does not exists ?\n&quot;);
-      return 0;
-    }
-
-  fseek (_statfile, 0, SEEK_END);
-  statSize = ftello (_statfile);
-  fseek (_statfile, 0, SEEK_SET);
-  _context-&gt;stats_in = (char *) ADM_alloc (statSize + 1);
-  _context-&gt;stats_in[statSize] = 0;
-  fread (_context-&gt;stats_in, statSize, 1, _statfile);
-  fclose(_statfile);
-
-  _context-&gt;bit_rate = val;	// bitrate
-
-  return initContext ();
-
-}
-
-ffmpegEncoderVBR::~ffmpegEncoderVBR ()
-{
-
-
-  ADM_dealloc (_context-&gt;stats_in);
-
-}
-
-//--------------------- FFmpeg VBR, external Qzation engine ------------------
-uint8_t
-ffmpegEncoderVBRExternal::encode (ADMImage * in, ADMBitstream * out)
-{
-    uint8_t r;
-    uint32_t q;
-  q=out-&gt;in_quantizer;
-  _frame.quality = (int) floor (FF_QP2LAMBDA * q + 0.5);
-  r= ffmpegEncoder::encode(in,out);
-  out-&gt;out_quantizer=q;
-  return r;
-}
-
-
-/**
-	This is used only for Mpeg1, so it is a bit tuned for it
-*/
-uint8_t
-ffmpegEncoderVBRExternal::init (uint32_t val, uint32_t fps1000)
-{
-
-  printf (&quot;[lavc] initializing in VBRExternal mode\n&quot;);
-  _qual = val;
-  mplayer_init ();
-
-/*  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;*/
-  _context-&gt;time_base = (AVRational) {  1000, fps1000};
-  _context-&gt;flags |= CODEC_FLAG_QSCALE;;
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;max_qdiff = 10;
-
-  // since this is used only for mpeg1 ...
-  // PAL ?
-  _context-&gt;bit_rate = 2500 * 1000 * 8;
-  _context-&gt;sample_aspect_ratio.num = 4;
-  _context-&gt;sample_aspect_ratio.den = 3;
-
-  return initContext ();;
-}
-
-ffmpegEncoderVBRExternal::~ffmpegEncoderVBRExternal ()
-{
-
-
-
-}
-
-//--------------------- FFmpeg VBR, external Qzation engine ------------------
-
-void
-ffmpegEncoder::mplayer_init (void)
-{
-  /*
-     default values : Copy/past from mplayer
-   */
-  _context-&gt;pix_fmt = _targetColorSpace;
-
-  if (!_settingsPresence)
-    {
-      printf (&quot;[lavc] using default encode settings \n&quot;);
-      _context-&gt;qmin = 2;
-      _context-&gt;qmax = 31;
-      _context-&gt;max_b_frames = 0;
-      _context-&gt;mpeg_quant = 0;
-      _context-&gt;me_method = ME_EPZS;
-      _context-&gt;flags = 0;
-      _context-&gt;max_qdiff = 3;
-      _context-&gt;luma_elim_threshold = 0;
-      _context-&gt;chroma_elim_threshold = 0;
-      _context-&gt;lumi_masking = 0.0;;
-      _context-&gt;dark_masking = 0.0;
-      _context-&gt;qcompress = 0.5;
-      _context-&gt;qblur = 0.5;
-      _context-&gt;gop_size = 250;
-    }
-  else
-    {
-      if (_id == FF_MPEG1 || _id == FF_MPEG2 || _id == FF_FLV1)
-	{
-	  _context-&gt;gop_size = _settings.gop_size;
-	}
-      else
-	{
-	  _context-&gt;gop_size = 250;
-	}
-#define SETX(x) _context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %d\n&quot;,_settings.x);
-#define SETX_COND(x) if(_settings.is_##x) {_context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %d\n&quot;,_settings.x);} else\
-		{ printf(#x&quot; is not activated\n&quot;);}
-      SETX (me_method);
-      SETX (qmin);
-      SETX (qmax);
-      SETX (max_b_frames);
-      SETX (mpeg_quant);
-      SETX (max_qdiff);
-      SETX_COND (luma_elim_threshold);
-      SETX_COND (chroma_elim_threshold);
-
-#undef SETX
-#undef SETX_COND
-
-#define SETX(x)  _context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %f\n&quot;,_settings.x);
-#define SETX_COND(x)  if(_settings.is_##x) {_context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %f\n&quot;,_settings.x);} else  \
-									{printf(&quot;[LAVCODEC]&quot;#x&quot; No activated\n&quot;);}
-      SETX_COND (lumi_masking);
-      SETX_COND (dark_masking);
-      SETX (qcompress);
-      SETX (qblur);
-      SETX_COND (temporal_cplx_masking);
-      SETX_COND (spatial_cplx_masking);
-
-#undef SETX
-#undef SETX_COND
-
-#define SETX(x) if(_settings.x){ _context-&gt;flags|=CODEC_FLAG##x;printf(&quot;[LAVCODEC]&quot;#x&quot; is set\n&quot;);}
-      SETX (_GMC);
-
-
-      switch (_settings.mb_eval)
-	{
-	case 0:
-	  _context-&gt;mb_decision = FF_MB_DECISION_SIMPLE;
-	  break;
-	case 1:
-	  _context-&gt;mb_decision = FF_MB_DECISION_BITS;
-	  break;
-	case 2:
-	  _context-&gt;mb_decision = FF_MB_DECISION_RD;
-	  break;
-	default:
-	  ADM_assert (0);
-
-
-	}
-      //SETX(_HQ);
-      SETX (_4MV);
-      SETX (_QPEL);
-      //SETX (_TRELLIS_QUANT);
-#warning FIXME TRELLIS
-      if(_settings._TRELLIS_QUANT)
-        { 
-            _context-&gt;trellis=1;printf(&quot;[LAVCODEC] trellisis set\n&quot;);
-        }
-      SETX (_NORMALIZE_AQP);
-
-      if (_settings.widescreen)
-	{
-	  _context-&gt;sample_aspect_ratio.num = 16;
-	  _context-&gt;sample_aspect_ratio.den = 9;
-	  printf (&quot;[LAVCODEC]16/9 aspect ratio is set.\n&quot;);
-
-	}
-#undef SETX
-    }
-  if ((_id == FF_H263) || (_id == FF_H263P))
-    _context-&gt;bit_rate_tolerance = 4000;
-  else
-    _context-&gt;bit_rate_tolerance = 8000000;
-
-
-  _context-&gt;b_quant_factor = 1.25;
-  _context-&gt;rc_strategy = 2;
-  _context-&gt;b_frame_strategy = 0;
-  _context-&gt;b_quant_offset = 1.25;
-  _context-&gt;rtp_payload_size = 0;
-  _context-&gt;strict_std_compliance = 0;
-  _context-&gt;i_quant_factor = 0.8;
-  _context-&gt;i_quant_offset = 0.0;
-  _context-&gt;rc_qsquish = 1.0;
-  _context-&gt;rc_qmod_amp = 0;
-  _context-&gt;rc_qmod_freq = 0;
-  _context-&gt;rc_eq = const_cast &lt; char *&gt;(&quot;tex^qComp&quot;);
-  _context-&gt;rc_max_rate = 000;
-  _context-&gt;rc_min_rate = 000;
-  _context-&gt;rc_buffer_size = 000;
-  _context-&gt;rc_buffer_aggressivity = 1.0;
-  _context-&gt;rc_initial_cplx = 0;
-  _context-&gt;dct_algo = 0;
-  _context-&gt;idct_algo = 0;
-  _context-&gt;p_masking = 0.0;
-
-  _context-&gt;bit_rate = 0;
-
-}
-
-uint8_t
-ffmpegEncoder::init (uint32_t val, uint32_t fps1000)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (fps1000);
-  return 0;
-}
-
-uint8_t
-ffmpegEncoder::init (uint32_t val, uint32_t fps1000, uint8_t sw)
-{
-  UNUSED_ARG (sw);
-  return init (val, fps1000);
-}
-
-//------------------------------
-uint8_t
-ffmpegEncoderHuff::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (vbr);
-  mplayer_init ();
-
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-//   _context-&gt;frame_rate_base = 1000;
-//   _context-&gt;frame_rate = fps1000;
-
-
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;gop_size = 250;
-
-  return initContext ();
-}
-//__________________________________
-/**
-
-*/
-
-ffmpegEncoderHuff::ffmpegEncoderHuff (uint32_t width, uint32_t height,FF_CODEC_ID id)
-  :   ffmpegEncoder (width,height, id,PIX_FMT_YUV422P)
-{
-  // Allocate our resampler &amp; intermediate
-  yuy2=new uint8_t[width*height*2];
-  // And Color converted
-    convert=new ADMColorspace(width,height, ADM_COLOR_YV12,ADM_COLOR_YUV422P);
-}
-/**
-
-*/
-
-ffmpegEncoderHuff::~ffmpegEncoderHuff()
-{
-  if(yuy2)
-  {
-    delete [] yuy2;
-    yuy2=NULL;
-  }
-  if(convert)
-  {
-   delete convert;
-    convert=NULL;
-  }
-  stopEncoder ();
-}
-/**
-
-*/
-  uint8_t   ffmpegEncoderHuff::encode(ADMImage *in,ADMBitstream *out)
-{
-    int32_t sz = 0;
-    ADM_assert(out-&gt;bufferSize);
-    encodePreamble(yuy2);
-    /* Convert */
-   convert-&gt;convert(in-&gt;data,yuy2);
-
-    /***/
-    if ((sz = avcodec_encode_video (_context, out-&gt;data, out-&gt;bufferSize, &amp;_frame)) &lt; 0)
-        return 0;
-    postAmble(out,sz);
-    return 1;
-}
-//------------------------------
-uint8_t
-  ffmpegEncoderFFHuff::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (vbr);
-  mplayer_init ();
-
-/*  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;*/
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;gop_size = 250;
-
-  return initContext ();
-}
-
-//_______________________________________
-uint8_t
-ffmpegEncoder::getExtraData (uint32_t * l, uint8_t ** d)
-{
-  *d = (uint8_t *) _context-&gt;extradata;
-  *l = _context-&gt;extradata_size;
-  printf (&quot;[LAVCODEC]We got some extra data: %&quot;LU&quot;\n&quot;, *l);
-  if (*l)
-    return 1;
-
-  else
-    return 0;
-}
-
-//----
-//------------------------------
-uint8_t
-ffmpegEncoderFFV1::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (vbr);
-  mplayer_init ();
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-//   _context-&gt;frame_rate_base = 1000;
-//   _context-&gt;frame_rate = fps1000;
-
-
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;gop_size = 250;
-  printf (&quot;[LAVCODEC]FFV1 codec initializing...\n&quot;);
-  return initContext ();
-}
-
-/*---
-*/
-uint8_t
-  ffmpegEncoderFFMjpeg::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (vbr);
-  mplayer_init ();
-
-  float f;
-
-  f = val;
-  f = 31. - (29. * f / 100.);
-
-  _qual = (uint32_t) floor (f);
-
-//   _context-&gt;frame_rate_base = 1000;
-//   _context-&gt;frame_rate = fps1000;
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-  _context-&gt;flags = CODEC_FLAG_QSCALE;
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;gop_size = 250;
-  printf (&quot;[LAVCODEC]FF Mjpeg codec initializing %d %% -&gt; q =%d...\n&quot;, val, _qual);
-  return initContext ();
-}
-
-
-
-uint8_t
-ffmpegEncoderFFMjpeg::encode (ADMImage * in, ADMBitstream * out)
-{
-  _frame.quality = (int) floor (FF_QP2LAMBDA * _qual + 0.5);
-  return ffmpegEncoder::encode(in,out);
-}
-

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpeg.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,226 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpeg.h  -  description
-                             -------------------
-                             
-                             
-	Mpeg4 ****encoder******** using ffmpeg
-	                             
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef __FFMPEG_ENC__
-#define   __FFMPEG_ENC__
-#include &quot;ADM_colorspace.h&quot;
-typedef enum
-{
-  FF_MSMP4V3 = 1,
-  FF_MPEG4 = 2,
-  FF_MPEG1 = 3,
-  FF_H263 = 4,
-  FF_H263P = 5,
-  FF_HUFF = 6,
-  FF_FFV1 = 7,
-  FF_MJPEG = 8,
-  FF_MPEG2 = 9,
-  FF_SNOW = 10,
-  FF_FFHUFF = 11,
-  FF_DV=12,
-  FF_FLV1=13,
-} FF_CODEC_ID;
-
-/*
-	Some of FFmpeg internal options as encoder
-	User tunable
-*/
-
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
-
-class ffmpegEncoder:public encoder
-{
-protected:
-  void postAmble (ADMBitstream * out, uint32_t sz);
-  uint8_t _init;
-  uint8_t _swap;
-  AVCodecContext *_context;
-  AVFrame _frame;
-  FF_CODEC_ID _id;
-  uint32_t _last_coded_frame;
-  uint8_t _settingsPresence;
-  uint8_t _isMT;
-  FFcodecSetting _settings;
-  void mplayer_init (void);
-  uint8_t initContext (void);
-  uint8_t gopMpeg1 (void);
-  uint32_t frameType (void);
-  uint8_t encodePreamble (uint8_t * in);
-  PixelFormat _targetColorSpace;
-
-public:
-    uint8_t setConfig (FFcodecSetting * set);
-  uint8_t setLogFile (const char *name);
-  void encoderMT (void);
-    ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id,PixelFormat format=PIX_FMT_YUV420P);
-   virtual ~ffmpegEncoder ();
-
-  virtual uint8_t stopEncoder (void);
-  
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t sw);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual uint8_t getExtraData (uint32_t * l, uint8_t ** d);
-  virtual uint8_t setCustomMatrices (uint16_t * intra, uint16_t * inter);
-  virtual uint8_t setGopSize (uint32_t size);	// !!! IT DOES NOT WORK, DONE TOO LATE!!!!
-  uint32_t getCodedFrame (void);
-};
-
-class ffmpegEncoderCQ:public ffmpegEncoder
-{
-protected:uint32_t _qual;
-  uint8_t _vbr;
-  FILE *_statfile;
-
-public:  ffmpegEncoderCQ (uint32_t width, uint32_t height,
-		     FF_CODEC_ID id):ffmpegEncoder (width, height, id)
-  {
-    _qual = 3;
-    _vbr = 0;
-    _statfile = NULL;
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderCQ ();
-  
-};
-
-
-class ffmpegEncoderCBR:public ffmpegEncoder
-{
-protected:uint32_t _br;
-public:ffmpegEncoderCBR (uint32_t width, uint32_t height,
-		    FF_CODEC_ID id):ffmpegEncoder (width, height, id)
-  {
-    _br = 1000;
-  };
-
-  virtual ~ ffmpegEncoderCBR ()
-  {
-    stopEncoder ();
-  }
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-
-
-};
-
-class ffmpegEncoderVBR:public ffmpegEncoderCQ
-{
-protected:
-    uint8_t _internal;
-
-public:  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-    ffmpegEncoderVBR (uint32_t width, uint32_t height,
-		      FF_CODEC_ID id):ffmpegEncoderCQ (width, height, id)
-  {
-    _internal = 1;
-  }
-  ffmpegEncoderVBR (uint32_t width, uint32_t height, uint8_t inter,
-		    FF_CODEC_ID id):ffmpegEncoderCQ (width, height, id)
-  {
-    _internal = inter;
-  }
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderVBR ();
-};
-
-
-class ffmpegEncoderVBRExternal:public ffmpegEncoderCQ
-{
-protected:
-public:
-        virtual uint8_t init (uint32_t val, uint32_t fps1000);
-                        ffmpegEncoderVBRExternal(uint32_t width,uint32_t height,FF_CODEC_ID id):
-                                ffmpegEncoderCQ (width, height,id)
-  {
-  }
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderVBRExternal ();
-};
-//*********************************************************
-class ffmpegEncoderHuff:public ffmpegEncoder
-{
-protected: 
-            uint8_t *yuy2;
-            ADMColorspace *convert;
-
-public:
-                ffmpegEncoderHuff (uint32_t width, uint32_t height,FF_CODEC_ID id);
-                        
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-          uint8_t encode(ADMImage *in,ADMBitstream *out);
-  virtual ~ ffmpegEncoderHuff ();
-};
-//*********************************************************
-class ffmpegEncoderFFHuff:public ffmpegEncoder
-{
-protected: 
-public:
-        ffmpegEncoderFFHuff (uint32_t width, uint32_t height,FF_CODEC_ID id):
-                                ffmpegEncoder (width,height, id)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-  virtual ~ ffmpegEncoderFFHuff ()
-  {
-    stopEncoder ();
-  }
-};
-
-
-class ffmpegEncoderFFV1:public ffmpegEncoder
-{
-protected: public:ffmpegEncoderFFV1 (uint32_t width, uint32_t height,FF_CODEC_ID id)
-    :ffmpegEncoder (width,height, id) {}
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-  virtual ~ ffmpegEncoderFFV1 ()
-  {
-    stopEncoder ();
-
-  }
-};
-class ffmpegEncoderFFMjpeg:public ffmpegEncoder
-{
-protected:uint32_t _qual;
-
-public:ffmpegEncoderFFMjpeg (uint32_t width, uint32_t height,FF_CODEC_ID id)
-    :ffmpegEncoder (width, height,id)
-  {
-    _qual = 4;
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderFFMjpeg ()
-  {
-    stopEncoder ();
-
-  }
-};
-
-
-
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpegConfig.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpegConfig.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_ffmpegConfig.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,79 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpegConfig -  description
-                             -------------------
-	Fine tuning for lavcodec encoder			     
-			     
-    begin                : 19-01-2003
-    copyright            : (C) 2003 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-
-   
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ADM_FFCONFIG
-#define ADM_FFCONFIG
-#include &quot;avcodec.h&quot;
-typedef struct FFcodecSetting
-{
-  Motion_Est_ID me_method;
-  uint32_t _GMC;
-  uint32_t _4MV;
-  uint32_t _QPEL;
-  uint32_t _TRELLIS_QUANT;
-  uint32_t qmin;			// 2-31
-  uint32_t qmax;			// 2-31
-  uint32_t max_qdiff;		// 1-31
-  uint32_t max_b_frames;		// 0-1
-  uint32_t mpeg_quant;		// 0-1
-  uint32_t is_luma_elim_threshold;
-  uint32_t luma_elim_threshold;	// -99--99
-  uint32_t is_chroma_elim_threshold;	// -99--99           
-  uint32_t chroma_elim_threshold;	// -99--99      
-
-  float lumi_masking;		// -1--1        
-  int32_t is_lumi_masking;		// -1--1
-  float dark_masking;		// -1--1        
-  int32_t is_dark_masking;		// -1--1
-  float qcompress;		// 0.0--1.0
-  float qblur;			// 0.0--1.0
-  uint32_t minBitrate;          // In kBits/s
-  uint32_t maxBitrate;          // In kBits/s
-  uint32_t user_matrix;		// 0 normal / 1 tmpgenc / 2 anime / 3 kvcd / 4 hr-tmpgenc
-  uint32_t gop_size;			// For mpeg1/2 , 12 is good
-  uint16_t *intra_matrix;
-  uint16_t *inter_matrix;
-  uint32_t interlaced;
-  uint32_t bff;			// WLA: bottom field first flag
-  uint32_t widescreen;          //0 4/3  1 16/9
-
-  // new stuff from jakub ui
-  uint32_t mb_eval;			// Replace hq 0..2
-  uint32_t vratetol;			// filesize tolerance in kb
-
-  uint32_t is_temporal_cplx_masking;	// temporal masking 0--1        
-  float temporal_cplx_masking;	// temporal masking 0--1
-
-  uint32_t is_spatial_cplx_masking;	// spatial masking 0--1
-  float spatial_cplx_masking;	// spatial masking 0--1
-  uint32_t _NORMALIZE_AQP;		// normalize adap quantiz
-
-  //
-  uint32_t use_xvid_ratecontrol;
-  uint32_t bufferSize;		// in KBYTES !!!!
-  uint32_t override_ratecontrol;
-  uint32_t dummy;
-
-} FFcodecSetting;
-
-
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,130 +0,0 @@
-#if 0
-/***************************************************************************
-                          ADM_mjpegEncode.cpp  -  description
-                             -------------------
-    begin                : Tue Jul 23 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &quot;ADM_assert.h&quot;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-#include &quot;avi_vars.h&quot;
-#include &quot;prototype.h&quot;
-#include &quot;config.h&quot;
-
-#ifdef USE_MJPEG
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_colorspace/colorspace.h&quot;
-
-
-extern &quot;C&quot;
-{
-#include &quot;mjpegtools/jpegutils.h&quot;
-}
-
-//#include &quot;ADM_codecs/ADM_divxEncode.h&quot;
-#include &quot;ADM_codecs/ADM_mjpegEncode.h&quot;
-
-//
-//      The given parameter is the compression ratio of jpeg
-//
-uint8_t
-mjpegEncoder::init (uint32_t val, uint32_t fps1000)
-{
-  UNUSED_ARG (fps1000);
-  _qual = val;
-  return 1;
-}
-uint8_t mjpegEncoder::init (uint32_t val, uint32_t fps1000, uint8_t s)
-{
-  UNUSED_ARG (fps1000);
-  _qual = val;
-  _swap = s;
-  return 1;
-}
-
-uint8_t mjpegEncoder::stopEncoder (void)
-{
-
-  return 1;
-}
- /*
-  * jpeg_data:       buffer with input / output jpeg
-  * len:             Length of jpeg buffer
-  * itype:           LAV_INTER_NONE: Not interlaced
-  *                  LAV_INTER_TOP_FIRST: Interlaced, top-field-first
-  *                  LAV_INTER_BOTTOM_FIRST: Interlaced, bottom-field-first
-  * ctype            Chroma format for decompression.
-  *                  Currently always 420 and hence ignored.
-  * raw0             buffer with input / output raw Y channel
-  * raw1             buffer with input / output raw U/Cb channel
-  * raw2             buffer with input / output raw V/Cr channel
-  * width            width of Y channel (width of U/V is width/2)
-  * height           height of Y channel (height of U/V is height/2)
-
-
-  int decode_jpeg_raw (unsigned char *jpeg_data, int len,
-  int itype, int ctype, int width, int height,
-  unsigned char *raw0, unsigned char *raw1,
-  unsigned char *raw2);
-
-  */
-
-uint8_t
-  mjpegEncoder::encode (uint8_t * in,
-			uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-  uint8_t *y, *u, *v;
-  uint32_t delta;
-  int l;
-
-  //
-  delta = _w * _h;
-  // separate planes
-  y = (uint8_t *) in;
-
-  if (!_swap)
-    {
-      u = y + delta;
-      v = u + (delta &gt;&gt; 2);
-    }
-  else
-    {
-      v = y + delta;
-      u = v + (delta &gt;&gt; 2);
-    }
-
-  l = encode_jpeg_raw ((unsigned char *) out, delta,	// insize /2 , should be enough as buffering
-		       _qual,	// int quality, ??
-		       0, 0,	// ctype /i type
-		       _w, _h, y, u, v);
-  //      printf(&quot;\n size: %d&quot;,l);
-  *len = l;
-  *flags = AVI_KEY_FRAME;
-
-  return 1;
-}
-
-uint8_t mjpegEncoder::getResult (void *ress)
-{				// for dual pass only
-  ADM_assert (0);
-  UNUSED_ARG (ress);
-
-}
-
-#endif
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_mjpegEncode.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,39 +0,0 @@
-/***************************************************************************
-                          ADM_mjpegEncode.h  -  description
-                             -------------------
-    begin                : Tue Jul 23 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef __MJPEG_ENC__
-#define   __MJPEG_ENC__
-
-class mjpegEncoder:public encoder
-{
-protected:uint8_t _qual;
-  uint8_t _swap;
-public:  mjpegEncoder (uint32_t width, uint32_t height):encoder (width,
-							    height)
-  {
-    _qual = 75;
-    _swap = 0;
-
-  };
-  uint8_t stopEncoder (void);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  uint8_t init (uint32_t val, uint32_t fps1000, uint8_t sw);
-  virtual uint8_t encode (uint8_t * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-
-};
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,493 +0,0 @@
-/***************************************************************************
-                          ADM_xvid.cpp  -  description
-                             -------------------
-
-	Use dlopen to open xvid and use it as a separate encoder
- 	Decoding is still done by divx
-
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-//#include &quot;ADM_gui/GUI_xvidparam.h&quot;
-
-#include &quot;ADM_assert.h&quot;
-
-//static myENC_RESULT xvid_res;
-
-
-#ifdef USE_XX_XVID
-#include &quot;ADM_codecs/ADM_xvid.h&quot;
-#include &quot;xvid.h&quot;
-
-void *dllHandle = NULL;
-
-// api v2.0
-/*
-typedef int(*XVID_PROTO) (void *handle, int opt,  void *param1, void *param2);
-
-XVID_PROTO xx_xvid_init=NULL;
-XVID_PROTO xx_xvid_encore=NULL;
-XVID_PROTO xx_xvid_decore=NULL;
-*/
-//
-static XVID_ENC_FRAME fr;
-static XVID_ENC_PARAM xparam;
-static XVID_ENC_STATS xstats;
-
-
-
-
-
-/*
-		Returns stat in Xvid Format 
-*/
-void *
-xvidEncoder::getXvidStat (void)
-{
-
-  return (void *) &xstats;
-
-}
-//____________________________________________
-//
-//  Initialize the compressor
-//
-uint8_t xvidEncoder::stopEncoder (void)
-{
-  int
-    ret;
-
-  ADM_assert (_init);
-
-  ret = xvid_encore (_handle, XVID_ENC_DESTROY, 0, 0);
-  _init = 0;
-  _handle = NULL;
-  if (ret == XVID_ERR_OK)
-    return 1;
-  return 0;
-}
-// Take from Xvid VFW code
-static int const
-  divx4_motion_presets[7] = {
-  0,
-  PMV_EARLYSTOP16,
-  PMV_EARLYSTOP16 | PMV_ADVANCEDDIAMOND16,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EARLYSTOP8 | PMV_HALFPELREFINE8,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EARLYSTOP8 | PMV_HALFPELREFINE8,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EXTSEARCH16 | PMV_EARLYSTOP8 |
-    PMV_HALFPELREFINE8
-};
-
-
-/* Divx4 quality to general encoder flag presets */
-static int const
-  divx4_general_presets[7] = {
-  0,
-  0,
-  0,
-  0 | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL
-};
-
-
-
-void
-xvidEncoder::checkFlags (xvidEncParam * extend)
-{
-
-  if (!extend)
-    {
-      // default : HPel &amp; H263Quant
-      encode_flags = 0;
-      encode_flags |= XVID_HALFPEL;
-      encode_flags |= XVID_H263QUANT;
-      motion_flags = divx4_motion_presets[4];
-      return;
-    }
-  //
-  encode_flags = 0;
-  encode_flags |= extend-&gt;quantizer;
-  encode_flags |= divx4_general_presets[extend-&gt;gui_option];
-  motion_flags = divx4_motion_presets[extend-&gt;gui_option];
-  if (extend-&gt;interlaced)
-    encode_flags |= XVID_INTERLACING;
-}
-
-void
-xvidEncoder::dumpConf (void)
-{
-
-#define CHK(x) if( encode_flags &amp; XVID_##x) printf(&quot;\n&quot;#x&quot; is set&quot;);
-
-  CHK (CUSTOM_QMATRIX);
-  CHK (H263QUANT);
-  CHK (MPEGQUANT);
-  CHK (HALFPEL);
-  CHK (ADAPTIVEQUANT);
-  CHK (LUMIMASKING);
-//CHK(LATEINTRA                   );
-
-  CHK (INTERLACING);
-  CHK (TOPFIELDFIRST);
-  CHK (ALTERNATESCAN);
-  CHK (HINTEDME_GET);
-  CHK (HINTEDME_SET);
-  CHK (INTER4V);
-  CHK (ME_ZERO);
-  CHK (ME_LOGARITHMIC);
-  CHK (ME_FULLSEARCH);
-  CHK (ME_PMVFAST);
-  CHK (ME_EPZS);
-
-#undef CHK
-#define CHK(x) if( motion_flags &amp; PMV_##x) printf(&quot;\n&quot;#x&quot; is set&quot;);
-  CHK (EARLYSTOP16);
-  CHK (ADVANCEDDIAMOND16);
-  CHK (HALFPELREFINE16);
-  CHK (EARLYSTOP8);
-  CHK (HALFPELREFINE8);
-  CHK (EXTSEARCH16);
-
-  printf (&quot;Max key interval : %d\n&quot;, xparam.max_key_interval);
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CBR
-// *************************************************
-// *************************************************
-uint8_t xvidEncoderCBR::init (uint32_t br, uint32_t fps1000)
-{
-  UNUSED_ARG (fps1000);
-  return initExtented (br, NULL);
-}
-uint8_t xvidEncoderCBR::init (uint32_t br, uint32_t fps1000, uint32_t extra)
-{
-  UNUSED_ARG (fps1000);
-  UNUSED_ARG (extra);
-  return initExtented (br, NULL);
-}
-
-uint8_t xvidEncoderCBR::initExtented (uint32_t br, xvidEncParam * extend)
-{
-  XVID_INIT_PARAM
-    xinit;
-  int
-    xerr;
-  encode_flags = 0;
-  checkFlags (extend);
-
-
-  memset (&amp;xinit, 0, sizeof (xinit));
-  memset (&amp;fr, 0, sizeof (fr));
-  //---
-  _br = br;
-  printf (&quot; Xvid : Compressing %lu x %lu video in CBR %lu\n&quot;, _w, _h, _br);
-  ADM_assert (0 == _init);
-
-  xinit.cpu_flags = XVID_CPU_MMX;
-  xvid_init (NULL, 0, &amp;xinit, NULL);
-
-  xparam.width = _w;
-  xparam.height = _h;
-  xparam.fincr = 1;
-  xparam.fbase = 25;
-
-  xparam.rc_bitrate = _br;
-  xparam.rc_reaction_delay_factor = 16;
-  xparam.rc_averaging_period = 100;
-  xparam.rc_buffer = 100;
-
-  xparam.min_quantizer = 2;
-  xparam.max_quantizer = 31;
-  xparam.max_key_interval = extend-&gt;max_key_interval;
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xparam, NULL);
-  if (XVID_ERR_OK != xerr)
-    {
-      printf (&quot;\n Error initializing xvid !!!&quot;);
-      return 0;
-    }
-
-  _handle = xparam.handle;
-  dumpConf ();
-  return 1;
-}
-
-
-//
-//      Encode a single frame
-//
-uint8_t
-  xvidEncoderCBR::encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  // general features
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in-&gt;data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in &lt;xvid.h&gt;
-
-  xframe.intra = -1;		// let the codec decide between I-frame (1) and P-frame (0)
-  xframe.quant = 0;
-//        xframe.quant = QUANTI;        // is quant != 0, use a fixed quant (and ignore bitrate)
-
-
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &amp;xframe, &amp;xstats);
-
-/*	        enc_result-&gt;is_key_frame = xframe.intra;
-	        enc_result-&gt;quantizer = xframe.quant;
-	        enc_result-&gt;total_bits = xframe.length * 8;
-	        enc_result-&gt;motion_bits = xstats.hlength * 8;
-	        enc_result-&gt;texture_bits = enc_result-&gt;total_bits - enc_result-&gt;motion_bits;
-*/
-
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.out_quantizer = xstats.quant;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-/*  This is statictical data, e.g. for 2-pass.
-    If you are not interested in any of this, you can use NULL instead of &amp;xstats
-*/
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-
-uint8_t xvidEncoderCQ::init (uint32_t q, uint32_t fps1000)
-{
-  UNUSED_ARG (fps1000);
-  return initExtented (q, NULL);
-}
-uint8_t xvidEncoderCQ::init (uint32_t q, uint32_t fps1000, uint32_t extra)
-{
-  UNUSED_ARG (fps1000);
-  UNUSED_ARG (extra);
-  return initExtented (q, NULL);
-}
-
-uint8_t xvidEncoderCQ::initExtented (uint32_t q, xvidEncParam * extend)
-{
-  XVID_INIT_PARAM
-    xinit;
-  int
-    xerr;
-
-  checkFlags (extend);
-  memset (&amp;xinit, 0, sizeof (xinit));
-  memset (&amp;fr, 0, sizeof (fr));
-  //xinit.cpu_flags=XVID_CPU_FORCE;
-  xinit.cpu_flags = XVID_CPU_MMX;
-  //---
-  _q = q;
-  printf (&quot; Xvid : Compressing %lu x %lu video in CQ %lu\n&quot;, _w, _h, _q);
-  ADM_assert (0 == _init);
-
-
-  xvid_init (NULL, 0, &amp;xinit, NULL);
-
-  xparam.width = _w;
-  xparam.height = _h;
-  xparam.fincr = 1;
-  xparam.fbase = 25;
-
-  xparam.rc_bitrate = 1000;
-  xparam.rc_reaction_delay_factor = 16;
-  xparam.rc_averaging_period = 100;
-  xparam.rc_buffer = 100;
-
-
-  xparam.min_quantizer = _q;
-  xparam.max_quantizer = _q;
-  xparam.max_key_interval = extend-&gt;max_key_interval;
-
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xparam, NULL);
-  if (XVID_ERR_OK != xerr)
-    {
-      printf (&quot;\n Error initializing xvid !!!&quot;);
-      return 0;
-    }
-  _handle = xparam.handle;
-  dumpConf ();
-  return 1;
-}
-
-//
-
-uint8_t
-  xvidEncoderCQ::encode (ADMImage * in,
-			 uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  memset (&amp;xframe, 0, sizeof (xframe));
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in-&gt;data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in &lt;xvid.h&gt;
-
-  xframe.intra = -1;		// let the codec decide between I-frame (1) and P-frame (0)
-  xframe.quant = _q;
-//        xframe.quant = QUANTI;        // is quant != 0, use a fixed quant (and ignore bitrate)
-
-
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &amp;xframe, &amp;xstats);
-
-/*	        enc_result-&gt;is_key_frame = xframe.intra;
-	        enc_result-&gt;quantizer = xframe.quant;
-	        enc_result-&gt;total_bits = xframe.length * 8;
-	        enc_result-&gt;motion_bits = xstats.hlength * 8;
-	        enc_result-&gt;texture_bits = enc_result-&gt;total_bits - enc_result-&gt;motion_bits;
-*/
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-  xvid_res.out_quantizer = xstats.quant;
-/*  This is statictical data, e.g. for 2-pass.
-    If you are not interested in any of this, you can use NULL instead of &amp;xstats
-*/
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-
-}
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-
-uint8_t
-  xvidEncoderVBR::encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-  uint16_t q;
-  uint8_t kf;
-
-  q = (*flags) &gt;&gt; 8;
-  kf = (*flags) &amp; 1;
-  return encodeVBR (in, out, len, flags, q, kf);
-
-
-}
-uint8_t
-  xvidEncoderVBR::encodeVBR (ADMImage * in,
-			     uint8_t * out,
-			     uint32_t * len,
-			     uint32_t * flags, uint16_t nq, uint8_t forcekey)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  memset (&amp;xframe, 0, sizeof (xframe));
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in-&gt;data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in &lt;xvid.h&gt;
-
-  if (forcekey)
-    xframe.intra = 1;		// let the codec decide between I-frame (1) and P-frame (0)
-  else
-    xframe.intra = 0;		// let the codec decide between I-frame (1) and P-frame (0)
-
-  xframe.quant = nq;
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &amp;xframe, &amp;xstats);
-
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.out_quantizer = xstats.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-
-}
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,102 +0,0 @@
-/***************************************************************************
-                          ADM_xvid.h.h  -  description
-                             -------------------
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifdef USE_XX_XVID
-
-
-
-#include &quot;ADM_gui/GUI_xvidparam.h&quot;
-
-class xvidEncoder
-{
-protected:uint32_t _w, _h;
-  uint8_t _init;
-  void *_handle;
-  uint32_t encode_flags;
-  uint32_t motion_flags;
-
-  void dumpConf (void);
-  void checkFlags (xvidEncParam * extend = NULL);
-
-public:void *getXvidStat (void);
-    xvidEncoder (uint32_t width, uint32_t height)
-    // : divxEncoder(width,height)
-  {
-    _w = width;
-    _h = height;
-    _init = 0;
-  };
-  uint8_t stopEncoder (void);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000) = 0;
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra) = 0;
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL) =
-    0;
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out,
-			  uint32_t * len, uint32_t * flags) = 0;
-
-
-};
-class xvidEncoderCBR:public xvidEncoder
-{
-protected:uint32_t _br;
-public:xvidEncoderCBR (uint32_t width, uint32_t height):xvidEncoder (width,
-								height)
-  {
-  };
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra);
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-};
-class xvidEncoderCQ:public xvidEncoder
-{
-protected:uint32_t _q;
-
-
-public:xvidEncoderCQ (uint32_t width, uint32_t height):xvidEncoder (width,
-							       height)
-  {
-
-  };
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra);
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-};
-class xvidEncoderVBR:public xvidEncoderCQ
-{
-protected: public:xvidEncoderVBR (uint32_t width,
-		  uint32_t height):xvidEncoderCQ (width,
-						  height)
-  {
-
-  };
-
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-  uint8_t encodeVBR (ADMImage * in,
-		     uint8_t * out,
-		     uint32_t * len,
-		     uint32_t * flags, uint16_t nq, uint8_t forcekey);
-
-};
-
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,762 +0,0 @@
-/***************************************************************************
-                          ADM_xvid4.cpp  -  description
-                             -------------------
-
-	Xvid4 api
-
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#ifdef USE_XVID_4
-
-#include &quot;ADM_codecs/ADM_xvid4param.h&quot;
-#include &quot;ADM_codecs/ADM_xvid4.h&quot;
-#include &quot;xvid.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;prefs.h&quot;
-
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-extern ADM_Composer *video_body;
-
-static const int motion_presets[] = {
-  0,
-  0,
-  0,
-  0,
-  XVID_ME_HALFPELREFINE16,
-  XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,
-  XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 |
-    XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
-};
-
-#define ME_ELEMENTS (sizeof(motion_presets)/sizeof(motion_presets[0]))
-
-
-#define VOP_ELEMENTS (sizeof(vop_presets)/sizeof(vop_presets[0]))
-
-
-static xvid_gbl_init_t xvid_gbl_init2;
-static xvid_enc_create_t xvid_enc_create;
-static xvid_plugin_single_t single;
-static xvid_plugin_2pass1_t pass1;
-static xvid_plugin_2pass2_t pass2;
-static xvid_enc_plugin_t plugins[7];
-static xvid_enc_frame_t xvid_enc_frame;
-static xvid_enc_stats_t xvid_enc_stats;
-static xvid_gbl_info_t xvid_gbl_info;
-static uint32_t xvid_framenum;
-#define MMSET(x) memset(&amp;x,0,sizeof(x))
-
-/******/
-static int
-adm_hook (void *handle, int opt, void *param1, void *param2)
-{
-  xvid_plg_data_t *data = (xvid_plg_data_t *) param1;
-  // printf(&quot;Pass %d value %d\n&quot;,opt,data-&gt;frame_num);
-  if (opt == XVID_PLG_FRAME)
-    {
-
-      xvid_framenum = data-&gt;frame_num;
-      //printf(&quot;Before called with %u\n&quot;,xvid_framenum);
-    }
-
-
-  return 0;
-}
-uint8_t xvid4Encoder::encode(ADMImage * in,ADMBitstream * out)
-{
-    int  ret=0;
-    /* Encode the frame */
-    xvid_enc_frame.bitstream = out-&gt;data;
-    preAmble (in-&gt;data);
-    ret = xvid_encore (_handle, XVID_ENC_ENCODE, &amp;xvid_enc_frame,
-                       &amp;xvid_enc_stats);
-    if (ret &lt; 0)
-    {
-        printf (&quot;[xvid] Error calling xvid4 %d\n&quot;, ret);
-        return 0;
-
-    }
-    postAmble (out);
-
-    out-&gt;len = ret;
-    if (!ret)
-        printf (&quot;[xvid] Skipped\n&quot;);
-    return 1;
-
-}
-
-
-void xvid4_init (void);
-/*
-	System wide init, do it once for all
-*/
-void
-xvid4_init (void)
-{
-  MMSET (xvid_gbl_init2);
-  MMSET (xvid_gbl_info);
-
-  printf (&quot;[xvid] Initializing global Xvid 4\n&quot;);
-  xvid_gbl_init2.version = XVID_VERSION;
-  xvid_global (NULL, XVID_GBL_INIT, &amp;xvid_gbl_init2, NULL);
-  xvid_gbl_info.version = XVID_VERSION;
-  xvid_global (NULL, XVID_GBL_INFO, &amp;xvid_gbl_info, NULL);
-
-  if (xvid_gbl_info.build)
-      printf (&quot;[xvid] Build: %s\n&quot;, xvid_gbl_info.build);
-
-  printf (&quot;[xvid] SIMD supported: (%x)\n&quot;, xvid_gbl_info.cpu_flags);
-#define CPUF(x) if(xvid_gbl_info.cpu_flags  &amp; XVID_CPU_##x) printf(&quot;\t\t&quot;#x&quot;\n&quot;);
-#ifdef ADM_CPU_X86
-  CPUF (MMX);
-  CPUF (MMXEXT);
-  CPUF (SSE);
-  CPUF (SSE2);
-  CPUF (3DNOW);
-  CPUF (3DNOWEXT);
-#endif
-#ifdef ADM_CPU_ALTIVEC
-  CPUF (ALTIVEC);
-#endif
-
-}
-xvid4Encoder::~xvid4Encoder ()
-{
-  stopEncoder ();
-}
-//--------------------------------------------------
-
-uint8_t
-  xvid4Encoder::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
-{
-  return 0;
-}
-
-
-void
-xvid4Encoder::createUpdate (void)
-{
-  uint32_t threads = 0;
-
-  prefs-&gt;get(FEATURE_THREADING_XVID, &amp;threads);
-
-  if (threads == 0)
-	  xvid_enc_create.num_threads = xvid_gbl_info.num_threads;
-  else if (threads &gt; 1)
-	  xvid_enc_create.num_threads = threads;
-  else
-      xvid_enc_create.num_threads = 0;
-
-  if (xvid_enc_create.num_threads)
-      printf (&quot;[xvid] using %u threads\n&quot;, xvid_enc_create.num_threads);
-
-  xvid_enc_create.max_bframes = _param.bframes;
-  xvid_enc_create.max_key_interval = _param.max_key_interval;
-  xvid_enc_create.bquant_ratio = _param.bquant_ratio;
-  xvid_enc_create.bquant_offset = _param.bquant_offset;
-
-  if (_param.packed)
-    xvid_enc_create.global |=XVID_GLOBAL_PACKED;
-
-  if (_param.closed_gop)
-    xvid_enc_create.global |=XVID_GLOBAL_CLOSED_GOP;
-
-  for (uint32_t i = 0; i &lt; 3; i++)
-    {
-      xvid_enc_create.min_quant[i] = _param.qmin[i];
-      xvid_enc_create.max_quant[i] = _param.qmax[i];
-    }
-
-  preAmble (NULL);
-#define C_VOP(x) if(xvid_enc_frame.vop_flags&amp; XVID_VOP_##x) printf(&quot;[xvid] Vop: &quot;#x&quot; is set\n&quot;);
-#define C_VOL(x) if(xvid_enc_frame.vol_flags&amp; XVID_VOL_##x) printf(&quot;[xvid] Vol: &quot;#x&quot; is set\n&quot;);
-#define C_ME(x) if(xvid_enc_frame.motion&amp; XVID_ME_##x) printf(&quot;[xvid] ME: &quot;#x&quot; is set\n&quot;);
-
-  C_VOP (DEBUG);
-  C_VOP (CHROMAOPT);
-  C_VOP (HALFPEL);
-  C_VOP (INTER4V);
-  C_VOP (TRELLISQUANT);
-  C_VOP (CHROMAOPT);
-  C_VOP (CARTOON);
-  C_VOP (GREYSCALE);
-  C_VOP (HQACPRED);
-  C_VOP (MODEDECISION_RD);
-
-  C_VOL (MPEGQUANT);
-  C_VOL (EXTRASTATS);
-  C_VOL (GMC);
-  C_VOL (QUARTERPEL);
-  C_VOL (INTERLACING);
-
-  C_ME (ADVANCEDDIAMOND16);
-  C_ME (ADVANCEDDIAMOND8);
-
-  C_ME (USESQUARES16);
-  C_ME (USESQUARES8);
-
-  C_ME (HALFPELREFINE16);
-  C_ME (HALFPELREFINE8);
-
-  // Turbo Mode
-  C_ME (FASTREFINE16);
-  C_ME (FASTREFINE8);
-  C_ME (SKIP_DELTASEARCH);
-  C_ME (FAST_MODEINTERPOLATE);
-  C_ME (BFRAME_EARLYSTOP);
-
-  C_ME (GME_REFINE);
-  C_ME (QUARTERPELREFINE8);
-  C_ME (QUARTERPELREFINE16);
-  C_ME (EXTSEARCH16);
-  C_ME (EXTSEARCH8);
-  C_ME (CHROMA_BVOP);
-  C_ME (CHROMA_PVOP);
-  MMSET (xvid_enc_frame);
-
-
-}
-
-void
-xvid4Encoder::dump (void)
-{
-  printf (&quot;[xvid] Configuration:\n&quot;);
-  if (_param.mpegQuantizer)
-    printf (&quot;\t\tMPEGQUANT\n&quot;);
-  if (_param.interlaced)
-    printf (&quot;\t\tINTERLACED\n&quot;);
-
-
-#define ST(x,y) \
-	if(_param.x) printf(&quot;\t\t&quot;#y&quot;\n&quot;);
-
-
-  ST (inter4mv, INTER4V);
-  ST (trellis, TRELLISQUANT);
-  ST (cartoon, CARTOON);
-  ST (greyscale, GREYSCALE);
-#undef ST
-
-}
-//____________________________________________
-//
-//  Initialize the compressor
-//
-uint8_t
-xvid4Encoder::stopEncoder (void)
-{
-  if (_handle)
-    {
-      xvid_encore (_handle, XVID_ENC_DESTROY, NULL, NULL);
-      printf (&quot;[xvid] Destroying\n&quot;);
-      _handle = NULL;
-    }
-  return 1;
-}
-uint8_t
-xvid4Encoder::preAmble (uint8_t * in)
-{
-/* Version for the frame and the stats */
-  //MMSET (xvid_enc_frame);
-  MMSET (xvid_enc_stats);
-
-  xvid_enc_frame.version = XVID_VERSION;
-  xvid_enc_stats.version = XVID_VERSION;
-
-  /* Bind output buffer */
-
-  xvid_enc_frame.length = 0;
-  if (_param.mpegQuantizer || _param.useCustomIntra || _param.useCustomInter)
-    xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
-  if (_param.interlaced)
-    xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
-
-
-#define SVOP(x,y) if(_param.x) xvid_enc_frame.vop_flags|=XVID_VOP_##y
-
-
-  xvid_enc_frame.motion = motion_presets[_param.guiLevel];
-
-  SVOP (inter4mv, INTER4V);
-  SVOP (trellis, TRELLISQUANT);
-  SVOP (hqac, HQACPRED);
-#if  XVID_API==XVID_MAKE_API(4, 1)
-  SVOP (bvhq, RD_BVOP);
-#endif
-
-  SVOP (greyscale, GREYSCALE);
-  SVOP (cartoon, CARTOON);
-  SVOP (chroma_opt, CHROMAOPT);
-  //SVOP(  1      ,HALFPEL);
-  xvid_enc_frame.vop_flags |= XVID_VOP_HALFPEL;
-  // ME
-  if (_param.chroma_me)
-    {
-      xvid_enc_frame.motion |= XVID_ME_CHROMA_BVOP;
-      xvid_enc_frame.motion |= XVID_ME_CHROMA_PVOP;
-    }
-  if (_param.cartoon)
-    {
-      xvid_enc_frame.motion |= XVID_ME_DETECT_STATIC_MOTION;
-    }
-  //printf(&quot;Vhq mode : %d\n&quot;,_param.vhqmode);
-#define VHME(x) xvid_enc_frame.motion|=	XVID_ME_##x
-  switch (_param.vhqmode)
-    {
-    case 4:
-      VHME (EXTSEARCH_RD);
-    case 3:
-      VHME (HALFPELREFINE8_RD);
-      VHME (QUARTERPELREFINE8_RD);
-      VHME (CHECKPREDICTION_RD);
-
-    case 2:
-      VHME (HALFPELREFINE16_RD);
-      VHME (QUARTERPELREFINE16_RD);
-    case 1:
-      SVOP (vhqmode, MODEDECISION_RD);
-    case 0:
-      break;
-    default:
-      ADM_assert (0);
-    }
-  if (_param.qpel)
-    {
-      xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
-
-      xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
-      xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
-    }
-
-  if (_param.gmc)
-    {
-      xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
-      xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
-    }
-
-  if (_param.turbo)
-    {
-      xvid_enc_frame.motion |= XVID_ME_FASTREFINE16;
-      xvid_enc_frame.motion |= XVID_ME_FASTREFINE8;
-      xvid_enc_frame.motion |= XVID_ME_SKIP_DELTASEARCH;
-      xvid_enc_frame.motion |= XVID_ME_FAST_MODEINTERPOLATE;
-      xvid_enc_frame.motion |= XVID_ME_BFRAME_EARLYSTOP;
-    }
-
-  xvid_enc_frame.bframe_threshold = _param.bframe_threshold;
-
-  xvid_enc_frame.input.csp = XVID_CSP_YV12;
-  xvid_enc_frame.input.stride[0] = _w;
-  xvid_enc_frame.input.stride[1] = _w &gt;&gt; 1;
-  xvid_enc_frame.input.stride[2] = _w &gt;&gt; 1;
-  xvid_enc_frame.type = XVID_TYPE_AUTO;
-
-
-  /* Set up motion estimation flags */
-  xvid_enc_frame.input.plane[0] = in;
-  xvid_enc_frame.input.plane[1] = in + (_w * _h);
-  xvid_enc_frame.input.plane[2] = in + ((_w * _h * 5) &gt;&gt; 2);
-
-  xvid_enc_frame.par_width = _param.par_width;
-  xvid_enc_frame.par_height = _param.par_height;
-  //printf(&quot;Using AR : %u x %u\n&quot;,xvid_enc_frame.par_width,xvid_enc_frame.par_height );
-  if (xvid_enc_frame.par_width != xvid_enc_frame.par_height)
-      xvid_enc_frame.par = XVID_PAR_EXT;
-  else
-      xvid_enc_frame.par = XVID_PAR_11_VGA;
-
-  /* Custome matrices */
-  if(_param.useCustomIntra)
-  {
-  if(!xvid_enc_frame.quant_intra_matrix)
-      printf(&quot;[xvid] Using custom intra matrix\n&quot;);
-      xvid_enc_frame.quant_intra_matrix=_param.intraMatrix;
-  }
-  if(_param.useCustomInter)
-  {
-    if(!xvid_enc_frame.quant_inter_matrix)
-      printf(&quot;[xvid] Using custom inter matrix\n&quot;);
-     xvid_enc_frame.quant_inter_matrix=_param.interMatrix;
-  }
-  return 1;
-}
-
-uint8_t
-xvid4Encoder::postAmble (ADMBitstream * out)
-{
-  out-&gt;flags = 0;
-  if (xvid_enc_frame.out_flags &amp; XVID_KEYFRAME)
-    {
-      out-&gt;flags = AVI_KEY_FRAME;
-    }
-  else if (xvid_enc_stats.type == XVID_TYPE_BVOP)
-    {
-      out-&gt;flags = AVI_B_FRAME;
-
-    }
-  out-&gt;out_quantizer = xvid_enc_stats.quant;
-  out-&gt;ptsFrame= xvid_framenum;
-  return 1;
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderCQ::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
-{
-  int xerr;
-  printf (&quot;[xvid] CQ mode = %lu (%d x %d)\n&quot;, q, _w, _h);
-  _q = q;
-  _fps1000 = fps1000;
-  memcpy (&amp;_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-  MMSET (single);
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-
-  single.version = XVID_VERSION;
-  single.bitrate = 1500;
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
-  if (xerr &lt; 0)
-    {
-      printf (&quot;[xvid] init error: %d\n&quot;, xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf (&quot;[xvid] CQ init Ok\n&quot;);
-
-  return 1;
-}
-
-
-uint8_t
-xvid4EncoderCQ::encode (ADMImage * in, ADMBitstream * out)
-{
-  int ret;
-
-  xvid_enc_frame.quant = _q;
-  return xvid4Encoder::encode(in,out);
-
-}
-// *************************************************
-// *************************************************
-//              CQ but Q is controlled externally
-// *************************************************
-// *************************************************
-
-uint8_t
-  xvid4EncoderVBRExternal::init (uint32_t q, uint32_t fps1000,
-				 xvid4EncParam * param)
-{
-  int xerr;
-  printf (&quot;[xvid] CQ mode = %lu (%d x %d)\n&quot;, q, _w, _h);
-  _q = q;
-  _fps1000 = fps1000;
-  memcpy (&amp;_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-  MMSET (single);
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  single.version = XVID_VERSION;
-  single.bitrate = 1500;
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
-  if (xerr &lt; 0)
-    {
-      printf (&quot;[xvid] init error: %d\n&quot;, xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf (&quot;[xvid] CQ init Ok\n&quot;);
-
-  return 1;
-}
-
-
-
-
-uint8_t
-  xvid4EncoderVBRExternal::encode (ADMImage * in,
-				      ADMBitstream * out)
-{
-  xvid_enc_frame.quant = out-&gt;in_quantizer;
-  if (out-&gt;flags &amp; AVI_KEY_FRAME)
-    {
-      xvid_enc_frame.type = XVID_TYPE_IVOP;
-    }
-  else if (out-&gt;flags &amp; AVI_B_FRAME)
-    {
-      xvid_enc_frame.type = XVID_TYPE_BVOP;
-    }
-  else
-    {				//P
-      xvid_enc_frame.type = XVID_TYPE_PVOP;
-    }
-    return xvid4Encoder::encode(in,out);
-}
-// *************************************************
-// *************************************************
-//              CBR
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderCBR::init (uint32_t br, uint32_t fps1000, xvid4EncParam * param)
-{
-  int xerr;
-  printf (&quot;[xvid] CBR mode = %lu kbps\n&quot;, br);
-  _bitrate = br;
-  _fps1000 = fps1000;
-  memcpy (&amp;_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (single);
-  MMSET (xvid_enc_create);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  single.version = XVID_VERSION;
-  single.bitrate = _bitrate * 1000;	// Kb-&gt;bit
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
-  if (xerr &lt; 0)
-    {
-      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf (&quot;[xvid] CBR init Ok\n&quot;);
-
-  return 1;
-}
-
-
-uint8_t
-xvid4EncoderCBR::encode (ADMImage * in, ADMBitstream * out)
-{
-  xvid_enc_frame.quant = 0;
-  return xvid4Encoder::encode(in,out);
-}
-// *************************************************
-// *************************************************
-//              Pass1
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderPass1::init (uint32_t br, uint32_t fps1000,
-			   xvid4EncParam * param)
-{
-  int xerr;
-  printf (&quot;[xvid] Pass 1 of 2 (log: %s)\n&quot;,
-	  (char *) param-&gt;logName);
-
-  _fps1000 = fps1000;
-  memcpy (&amp;_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  MMSET (pass1);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-
-  plugins[0].func = xvid_plugin_2pass1;
-  plugins[0].param = &amp;pass1;
-
-
-  pass1.version = XVID_VERSION;
-  pass1.filename = (char *) _param.logName;
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 1;
-
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  // Force Qz=2 !
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
-  if (xerr &lt; 0)
-    {
-      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf (&quot;[xvid] Pass 1 init Ok\n&quot;);
-
-  return 1;
-}
-
-
-
-// *************************************************
-// *************************************************
-//              Pass2
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderPass2::init (uint32_t br, uint32_t fps1000,
-			   xvid4EncParam * param)
-{
-  int xerr;
-  printf
-    (&quot;[xvid] Pass 2 of 2, average bitrate = %lu\n&quot;,
-     br);
-  _bitrate = br;
-  _fps1000 = fps1000;
-  memcpy (&amp;_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  MMSET (pass2);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-
-  plugins[0].func = xvid_plugin_2pass2;
-  plugins[0].param = &amp;pass2;
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  pass2.version = XVID_VERSION;
-  pass2.filename = (char *) _param.logName;
-
-  pass2.bitrate = br;		// Average bitrate
-#define CPY(x) pass2.x=_param.x;printf(&quot;[xvid] &quot;#x&quot;=%d\n&quot;,pass2.x);
-
-  CPY (keyframe_boost);
-  CPY (curve_compression_high);
-  CPY (curve_compression_low);
-  CPY (overflow_control_strength);
-  CPY (max_overflow_improvement);
-  CPY (max_overflow_degradation);
-  CPY (kfreduction);
-  CPY (kfthreshold);
-
-  CPY (container_frame_overhead);
-
-
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
-  if (xerr &lt; 0)
-    {
-      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf (&quot;[xvid] Init Ok\n&quot;);
-
-  return 1;
-}
-
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,133 +0,0 @@
-/***************************************************************************
-                          ADM_xvid4.h.h  -  description
-			  	DevAPI4 xvid encoder
-                             -------------------
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifdef USE_XVID_4
-
-
-
-#include &quot;ADM_codecs/ADM_xvid4param.h&quot;
-
-class xvid4Encoder:public encoder
-{
-protected:uint8_t _init;
-  void *_handle;
-  uint32_t encode_flags;
-  uint32_t motion_flags;
-  uint32_t _fps1000;
-  xvid4EncParam _param;
-  void dumpConf (void);
-  void checkFlags (xvid4EncParam * extend = NULL);
-  void createUpdate (void);
-
-  uint8_t preAmble (uint8_t * in);
-  uint8_t postAmble (ADMBitstream * out);
-  void dump (void);
-
-public:  xvid4Encoder (uint32_t width, uint32_t height):encoder (width,
-							    height)
-  {
-    _init = 0;
-    _handle = NULL;
-  };
-  ~xvid4Encoder ();
-  void *getXvidStat (void);
-  uint8_t stopEncoder (void);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-
-  uint8_t init (uint32_t a, uint32_t b)
-  {
-    return 0;
-  }				// not used
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out) ;
-};
-
-class xvid4EncoderCQ:public xvid4Encoder
-{
-protected:uint32_t _q;
-
-public:xvid4EncoderCQ (uint32_t width, uint32_t height):xvid4Encoder (width,
-								 height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-};
-class xvid4EncoderVBRExternal:public xvid4Encoder
-{
-protected:uint32_t _q;
-
-public:xvid4EncoderVBRExternal (uint32_t width,
-			   uint32_t height):xvid4Encoder (width,
-							  height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  
-};
-class xvid4EncoderCBR:public xvid4Encoder
-{
-protected:uint32_t _bitrate;	// In kBits!         
-
-public:xvid4EncoderCBR (uint32_t width,
-		   uint32_t height):xvid4Encoder (width, height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-};
-class xvid4EncoderPass1:public xvid4Encoder
-{
-protected: public:xvid4EncoderPass1 (uint32_t width,
-		     uint32_t height):xvid4Encoder (width,
-						    height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  
-};
-class xvid4EncoderPass2:public xvid4Encoder
-{
-protected:uint32_t _bitrate;
-
-public:xvid4EncoderPass2 (uint32_t width,
-		     uint32_t height):xvid4Encoder (width, height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  
-};
-
-
-#endif

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4param.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4param.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/ADM_xvid4param.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,80 +0,0 @@
-/***************************************************************************
-                          GUI_xvidparam.h  -  description
-                             -------------------
-    begin                : Sun Nov 17 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef XVID4ENCPARAM__
-#define XVID4ENCPARAM__
-
-typedef struct xvid4EncParam
-{
-
-  uint32_t guiLevel;			// equivalent to divx level : Fast/medium/insane
-
-  uint32_t min_key_interval;
-  uint32_t max_key_interval;
-  uint32_t bframes;
-
-  uint32_t mpegQuantizer;		// 0 h263/ 1 Mpeg quantizer
-  uint32_t interlaced;
-  uint32_t inter4mv;
-  uint32_t trellis;
-  uint32_t cartoon;
-  uint32_t greyscale;
-
-  uint32_t qpel;
-  uint32_t gmc;
-  uint32_t bvhq;
-  uint32_t hqac;
-
-  uint32_t   chroma_opt;
-  uint32_t qmin[3];			// IPB
-  uint32_t qmax[3];			// IPB
-
-  uint32_t par_as_input;
-  uint32_t par_width;
-  uint32_t par_height;
-
-
-  // This if for 2 pass   
-  uint32_t keyframe_boost;
-  uint32_t curve_compression_high;
-  uint32_t curve_compression_low;
-  uint32_t overflow_control_strength;
-  uint32_t max_overflow_improvement;
-  uint32_t max_overflow_degradation;
-  uint32_t kfreduction;
-  uint32_t kfthreshold;
-
-  int container_frame_overhead;
-  //
-  uint32_t bquant_ratio;
-  uint32_t bquant_offset;
-  uint32_t vhqmode;
-  uint32_t chroma_me;
-  uint32_t turbo;
-  uint32_t packed;
-  uint32_t closed_gop;
-  uint32_t bframe_threshold;
-  uint32_t useCustomIntra;
-  uint32_t useCustomInter;
-  uint8_t  intraMatrix[64];
-  uint8_t  interMatrix[64];
-  char logName[200];
-} xvid4EncParam;
-
-
-
-#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/CMakeLists.txt	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_codecs/CMakeLists.txt	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,7 +1,12 @@
 SET(ADM_codecs_SRCS 
-	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_png.cpp    ADM_theora_dec.cpp   ADM_xvid.cpp
-	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp
-        ADM_ffmpeg_vdpau.cpp
+ADM_codecs.cpp
+ADM_png.cpp
+ADM_theora_dec.cpp
+ADM_ffmp43.cpp
+ADM_mjpeg.cpp
+ADM_rgb16.cpp
+ADM_uyvy.cpp
+ADM_ffmpeg_vdpau.cpp
 )
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
@@ -10,8 +15,4 @@
 	 ADD_SOURCE_CFLAGS(ADM_png.cpp ${PNG_CFLAGS})
 ENDIF (USE_PNG)
 
-IF (USE_XVID_4)
-	ADD_SOURCE_CFLAGS(ADM_xvid4.cpp -I${XVID_INCLUDE_DIR})
-ENDIF (USE_XVID_4)
-
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -39,13 +39,13 @@
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
-#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
+#include &quot;ADM_render/GUI_render.h&quot;
 
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#include &quot;ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_PREVIEW
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_debug.h&quot;
+#include &quot;ADM_ffmpeg/libswscale/ADM_mp.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;ADM_preview.h&quot;
 #define MAX(a,b) ( (a)&gt;(b) ? (a) : (b) )
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2009-06-14 20:05:07 UTC (rev 4918)
@@ -5,7 +5,7 @@
 */
 #ifndef ADM_PREVIEW_H
 #define ADM_PREVIEW_H
-#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
+#include &quot;ADM_render/GUI_render.h&quot;
 typedef enum 
 {
     ADM_PREVIEW_NONE, 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -35,20 +35,20 @@
 
 #include &quot;audioeng_buildfilters.h&quot;
 #include &quot;prefs.h&quot;
-#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_render/GUI_render.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 
 #include &quot;audio_out.h&quot;
 
-#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_busy.h&quot;
+#include &quot;ADM_commonUI/DIA_busy.h&quot;
 #include &quot;DIA_working.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;DIA_enter.h&quot;
 
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
+
+#include &quot;ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;
 #include &quot;ADM_coreVideoEncoder.h&quot;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_autodrive.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_autodrive.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_autodrive.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -23,7 +23,7 @@
 #include &lt;math.h&gt;
 
 #include &quot;avi_vars.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;ADM_assert.h&quot;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_blackframes.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_blackframes.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_blackframes.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -32,14 +32,14 @@
 #include &quot;gui_action.hxx&quot;
 #include &quot;gtkgui.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
+#include &quot;ADM_render/GUI_render.h&quot;
 #include &quot;DIA_working.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_busy.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_commonUI/DIA_busy.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
+#include &quot;ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_misc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_misc.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_misc.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -9,7 +9,7 @@
 #include &quot;ADM_colorspace.h&quot;
 #include &quot;ADM_bitstream.h&quot;
 #include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
+//#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
 /**
     \fn saveAsBmp
     \brief save current image into filename, into bmp format
@@ -110,6 +110,7 @@
 */
 uint8_t  ADMImage::saveAsJpg(const char *filename)
 {
+    #if 0
  ffmpegEncoderFFMjpeg *codec=NULL;
   FILE *fd;
   uint8_t *buffer=NULL;
@@ -141,4 +142,7 @@
         fclose(fd);
         delete [] buffer;
         return 1;
+        #endif
+#warning save as jpeg disabled
+        return false;
 }
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_navigate.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -27,11 +27,11 @@
 #include &quot;gtkgui.h&quot;
 
 #include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_busy.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_commonUI/DIA_busy.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;DIA_enter.h&quot;
 
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
+#include &quot;ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;
 
 extern void UI_purge(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -24,7 +24,7 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
 #include &quot;gtkgui.h&quot;
-#include &quot;ADM_userInterfaces/ADM_render/GUI_render.h&quot;
+#include &quot;ADM_render/GUI_render.h&quot;
 #include &quot;avidemutils.h&quot;
 #include &quot;ADM_preview.h&quot;
 #include &quot;audiofilter.h&quot;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -24,10 +24,10 @@
 #include &quot;gtkgui.h&quot;
 
 #include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;DIA_enter.h&quot;
 
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
+#include &quot;ADM_vidMisc.h&quot;
 #include &quot;DIA_fileSel.h&quot;
 #include &quot;DIA_working.h&quot;
 // Local prototypes

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -33,9 +33,9 @@
 
 
 #include &quot;DIA_fileSel.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/GUI_ui.h&quot;
+#include &quot;ADM_commonUI/GUI_ui.h&quot;
 #include &quot;ADM_muxer.h&quot;
-#include &quot;ADM_videoCopy.h&quot;
+#include &quot;ADM_muxerGate/include/ADM_videoCopy.h&quot;
 #include &quot;ADM_filterChain.h&quot;
 
 ADM_muxer               *ADM_MuxerSpawnFromIndex(int index);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2009-06-14 20:05:07 UTC (rev 4918)
@@ -52,7 +52,7 @@
 	#include &quot;SDL.h&quot;
 }
 
-#include &quot;ADM_userInterfaces/ADM_render/GUI_sdlRender.h&quot;
+#include &quot;ADM_render/GUI_sdlRender.h&quot;
 #endif
 
 
@@ -127,12 +127,12 @@
 
     printf(&quot;*************************\n&quot;);
     printf(&quot;  Avidemux v&quot; VERSION);
-
+#if 0
   	if(ADM_SUBVERSION)
 	{
 		printf(&quot; (r%04u)&quot;, ADM_SUBVERSION);
 	}
-
+#endif
     printf(&quot;\n*************************\n&quot;);
     printf(&quot; <A HREF="http://www.avidemux.org\n">http://www.avidemux.org\n</A>&quot;);
     printf(&quot; Code      : Mean, JSC, Gruntster \n&quot;);

Added: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2009-06-14 20:05:07 UTC (rev 4918)
@@ -0,0 +1,169 @@
+MESSAGE(&quot;#########################################&quot;)
+MESSAGE(&quot;Configure for avidemux Gtk Started&quot;)
+MESSAGE(&quot;#########################################&quot;)
+MESSAGE(&quot;&quot;)
+PROJECT(Avidemux_gtk)
+
+CMAKE_MINIMUM_REQUIRED(VERSION 2.4.7 FATAL_ERROR)
+
+if (COMMAND cmake_policy)
+	cmake_policy(VERSION 2.4)
+	cmake_policy(SET CMP0003 NEW)
+endif (COMMAND cmake_policy)
+########################################
+# Definitions and Includes
+########################################
+ADD_DEFINITIONS(-D_FILE_OFFSET_BITS=64 -D_LARGE_FILES)
+ADD_DEFINITIONS(-DHAVE_CONFIG_H)
+########################################
+# Where is the config.h dir
+########################################
+IF (NOT AVIDEMUX_CORE_BUILD_DIR)
+	MESSAGE(FATAL_ERROR &quot;Please add -DAVIDEMUX_CORECONFIG_DIR=path_to_avidemux_core_build_dir&quot;)
+ELSE (NOT AVIDEMUX_CORE_BUILD_DIR)
+	SET(AVIDEMUX_CORE_BUILD_DIR &quot;${AVIDEMUX_CORE_BUILD_DIR}&quot; CACHE STRING &quot;&quot;)
+ENDIF (NOT AVIDEMUX_CORE_BUILD_DIR)
+#
+# Access to our cmake lib
+#
+SET(AVIDEMUX_TOP_SOURCE_DIR ${CMAKE_SOURCE_DIR}/../..)
+SET(CMAKE_MODULE_PATH &quot;${AVIDEMUX_TOP_SOURCE_DIR}/cmake&quot; &quot;${CMAKE_MODULE_PATH}&quot;)
+MESSAGE(STATUS &quot;Avidemux cmake scripts are in ${CMAKE_MODULE_PATH}&quot;)
+#
+#
+#
+
+IF (ADM_DEBUG)
+	ADD_DEFINITIONS(-DADM_DEBUG)
+ENDIF (ADM_DEBUG)
+###########################################
+# Check Gtk &amp; friends
+###########################################
+include(admConfigHelper)
+INCLUDE(admCheckRequiredLibs)
+include(admCheckMiscLibs)
+include(admCheckGtk)
+include(admCheckGlade)
+#
+checkGtk()
+checkGlade()
+########################################
+# Add include dirs
+########################################
+include(admCoreIncludes)
+
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ADM_muxerGate/include/&quot;)
+
+IF (GETTEXT_FOUND)
+	INCLUDE_DIRECTORIES(${GETTEXT_INCLUDE_DIR})
+ENDIF (GETTEXT_FOUND)
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/&quot;)
+INCLUDE_DIRECTORIES(&quot;${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_audioFilter_old&quot;)
+##########################################
+# Config
+##########################################
+
+SET(CONFIG_HEADER_TYPE ADM_BUILD_GTK)
+CONFIGURE_FILE(&quot;${AVIDEMUX_TOP_SOURCE_DIR}/cmake/config.h.cmake&quot; &quot;${CMAKE_BINARY_DIR}/config/gtk/config.h&quot;)
+MESSAGE(STATUS &quot;GTK config.h generated&quot;)
+
+INCLUDE_DIRECTORIES(&quot;${CMAKE_BINARY_DIR}/config/gtk/&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_CORE_BUILD_DIR}/config&quot;)
+########################################
+# Add subdirectories 
+########################################
+ADD_SUBDIRECTORY(../common ./common)
+ADD_SUBDIRECTORY(ADM_UIs)
+ADD_SUBDIRECTORY(ADM_userInterfaces)
+#
+# Add main source
+#
+SET(ADM_EXE_SRCS 
+../common/ADM_preview.cpp  
+../common/gtk_gui.cpp  
+../common/gui_autodrive.cpp  
+../common/GUI_jobs.cpp  
+../common/gui_navigate.cpp  
+../common/gui_play.cpp  
+../common/gui_save.cpp  
+../common/gui_savenew.cpp  
+../common/gui_misc.cpp
+../common/main.cpp  
+../common/gui_action.cpp
+../common/gui_blackframes.cpp
+../common/ADM_imageLoader.cpp  
+../common/ADM_gettext.cpp
+)
+# Executable
+ADD_EXECUTABLE(avidemux2_gtk ${ADM_EXE_SRCS})
+ADD_TARGET_CFLAGS(avidemux2_gtk &quot;-I${CMAKE_BINARY_DIR}/config/gtk&quot;)
+
+SDLify(../common/main.cpp)
+ADD_SOURCE_CFLAGS(../common/main.cpp &quot;-DADM_SUBVERSION=${ADM_SUBVERSION}&quot;)
+###########################################
+# Construct ADM_libraries
+###########################################
+
+IF (ADM_DEBUG AND FIND_LEAKS)
+	ADD_ADMLIB_ALL_TARGETS(ADM_nvwa)
+ENDIF (ADM_DEBUG AND FIND_LEAKS)
+
+
+###########################################
+# External libs
+###########################################
+# gettext
+IF (GETTEXT_FOUND)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ${GETTEXT_LIBRARY_DIR})
+ENDIF (GETTEXT_FOUND)
+
+# pthreads
+IF (UNIX AND PTHREAD_FOUND)
+        TARGET_LINK_LIBRARIES(avidemux2_gtk ${PTHREAD_LIBRARIES})
+ENDIF (UNIX AND PTHREAD_FOUND)
+
+# PNG
+IF (USE_PNG)
+        TARGET_LINK_LIBRARIES(avidemux2_gtk ${PNG_LIBRARIES})
+	
+ENDIF (USE_PNG)
+
+
+# XVideo
+IF (USE_XV)
+        TARGET_LINK_LIBRARIES(avidemux2_gtk ${XVIDEO_LIBRARY_DIR})
+ENDIF (USE_XV)
+
+# SDL
+IF (USE_SDL)
+        TARGET_LINK_LIBRARIES(avidemux2_gtk ${SDL_LIBRARY})
+ENDIF (USE_SDL)
+
+###########################################
+# UI Specific
+###########################################
+ADD_TARGET_LDFLAGS(avidemux2_gtk ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
+
+
+###########################################
+# OS Specific
+###########################################
+IF (WIN32)
+	ADD_LIB_ALL_TARGETS(ADM_osSupport)
+
+	IF (MINGW)
+		ADD_LIB_ALL_TARGETS(-mno-cygwin)
+	ENDIF (MINGW)
+
+	ADD_LIB_ALL_TARGETS(winmm)
+
+	ADD_TARGET_LDFLAGS(avidemux2_cli &quot;-Wl,-subsystem,console&quot;)
+
+        ADD_TARGET_LDFLAGS(avidemux2_gtk &quot;-mwindows&quot;)
+
+ENDIF (WIN32)
+
+###########################################
+# Install
+###########################################
+#INSTALL(TARGETS avidemux2_gtk RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2009-06-14 20:05:07 UTC (rev 4918)
@@ -10,16 +10,19 @@
 	cmake_policy(SET CMP0003 NEW)
 endif (COMMAND cmake_policy)
 
-SET(CMAKE_MODULE_PATH &quot;${CMAKE_SOURCE_DIR}/../cmake&quot; &quot;${CMAKE_MODULE_PATH}&quot;)
 
 IF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES &quot;^${CMAKE_CXX_COMPILER_WORKS}$&quot;)
 	SET(FRESH_BUILD 1)
 ENDIF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES &quot;^${CMAKE_CXX_COMPILER_WORKS}$&quot;)
 
 # need for shared cmake script between avidemux &amp; plugins
-SET(AVIDEMUX_TOP_SOURCE_DIR ${CMAKE_SOURCE_DIR}/..)
 SET(AVIDEMUX_SOURCE_DIR ${CMAKE_SOURCE_DIR})
-MESSAGE(STATUS &quot;Source dir is ${AVIDEMUX_TOP_SOURCE_DIR}&quot;)
+SET(AVIDEMUX_TOP_SOURCE_DIR ${CMAKE_SOURCE_DIR}/..)
+SET(AVIDEMUX_CORE_BUILD_DIR ${CMAKE_BINARY_DIR})
+#
+SET(CMAKE_MODULE_PATH &quot;${AVIDEMUX_TOP_SOURCE_DIR}/cmake&quot; &quot;${CMAKE_MODULE_PATH}&quot;)
+#
+MESSAGE(STATUS &quot;Top Source dir is ${AVIDEMUX_TOP_SOURCE_DIR}&quot;)
 MESSAGE(&quot;&quot;)
 
 PROJECT(Avidemux_core)
@@ -175,24 +178,7 @@
 ########################################
 # Add include dirs
 ########################################
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_core/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_ffmpeg)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreAudioFilter/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreAudioParser/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreAudio/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreAudioDevice/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreAudioEncoder/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreDemuxer/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreDemuxerMpeg/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreImage/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreMuxer/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreUI/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreUtils/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreVideoEncoder/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_coreVideoFilter/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_SOURCE_DIR}/ADM_ffmpeg)
-INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/config)
+include(admCoreIncludes)
 ########################################
 # Directories to build
 ########################################

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-06-14 20:05:05 UTC (rev 4917)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-06-14 20:05:07 UTC (rev 4918)
@@ -1,7 +1,7 @@
 #ifndef ADM_CONFIG_H
 #define ADM_CONFIG_H
 
-#include &quot;../ADM_coreConfig.h&quot;
+#include &quot;ADM_coreConfig.h&quot;
 
 #define ADM_BUILD_CLI 1
 #define ADM_BUILD_GTK 2


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002133.html">[Avidemux-svn-commit] r4917 - branches/avidemux_2.6_branch_mean
</A></li>
	<LI>Next message: <A HREF="002135.html">[Avidemux-svn-commit] r4919 -	branches/avidemux_2.6_branch_mean/avidemux/common
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2134">[ date ]</a>
              <a href="thread.html#2134">[ thread ]</a>
              <a href="subject.html#2134">[ subject ]</a>
              <a href="author.html#2134">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
