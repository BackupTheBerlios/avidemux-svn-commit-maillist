<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4973 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/gtk/ADM_UIs/src	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src	avidemux_core/ADM_coreImage/include	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4973%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/gtk/ADM_UIs/include%20avidemux/gtk/ADM_UIs/src%0A%09avidemux/qt4/ADM_UIs/include%20avidemux/qt4/ADM_UIs/src%0A%09avidemux_core/ADM_coreImage/include%0A%09avidemux_core/ADM_coreUI/include%20avidemux_core/ADM_coreUI/src&In-Reply-To=%3C200906281747.n5SHltMK018091%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002187.html">
   <LINK REL="Next"  HREF="002189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4973 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/gtk/ADM_UIs/src	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src	avidemux_core/ADM_coreImage/include	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4973%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/gtk/ADM_UIs/include%20avidemux/gtk/ADM_UIs/src%0A%09avidemux/qt4/ADM_UIs/include%20avidemux/qt4/ADM_UIs/src%0A%09avidemux_core/ADM_coreImage/include%0A%09avidemux_core/ADM_coreUI/include%20avidemux_core/ADM_coreUI/src&In-Reply-To=%3C200906281747.n5SHltMK018091%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4973 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/gtk/ADM_UIs/src	avidemux/qt4/ADM_UIs/include avidemux/qt4/ADM_UIs/src	avidemux_core/ADM_coreImage/include	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src">mean at mail.berlios.de
       </A><BR>
    <I>Sun Jun 28 19:47:55 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002187.html">[Avidemux-svn-commit] r4972 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4
</A></li>
        <LI>Next message: <A HREF="002189.html">[Avidemux-svn-commit] r4974 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2188">[ date ]</a>
              <a href="thread.html#2188">[ thread ]</a>
              <a href="subject.html#2188">[ subject ]</a>
              <a href="author.html#2188">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-06-28 19:47:53 +0200 (Sun, 28 Jun 2009)
New Revision: 4973

Added:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_dialogFactoryQt4.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_toolkitQt.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_aspectRatio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/toolkit.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_dialogFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_filesel.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bar.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bitrate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_button.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_float.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_frame.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_hex.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_integer.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_matrix.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_menu.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_readOnlyText.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_slider.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_threadCount.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_toggle.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/toolkit_dialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4_template.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_bar.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_float.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_frame.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_hex.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_integer.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_matrix.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_readOnlyText.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_button.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_dialogFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/DIA_flyDialog.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factoryStubs.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_factory.cpp
Log:
[UI/All] Merge change from 2.5 concerning dialogFactory (GTK/QT4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -37,7 +37,6 @@
   virtual uint32_t sliderGet(void);
   virtual uint8_t  sliderSet(uint32_t value);
   virtual void    postInit(uint8_t reInit);
-  virtual uint8_t    sliderChanged(void) {return 0;};
-  };
+};
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/CMakeLists.txt	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/CMakeLists.txt	2009-06-28 17:47:53 UTC (rev 4973)
@@ -28,5 +28,4 @@
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
 TARGET_LINK_LIBRARIES(${ADM_LIB} ${GTK_LDFLAGS} ADM_core ADM_coreUI ADM_render_gtk)
 ADD_TARGET_CFLAGS(${ADM_LIB} ${GTK_CFLAGS})
-ADD_SOURCE_CFLAGS(DIA_flyDialogGtk.cpp &quot; -DADM_UI_TYPE_BUILD=2&quot;)
-ADM_INSTALL_LIB( ${ADM_LIB})
+ADM_INSTALL_LIB( ${ADM_LIB} )

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_dialogFactory.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_dialogFactory.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -308,7 +308,7 @@
 extern void 	gtkDeleteButton(diaElem *e);
 extern diaElem  *gtkCreateBar(uint32_t percent,const char *toggleTitle);
 extern void     gtkDeleteBar(diaElem *e);
-extern diaElem  *gtkCreateFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip);
+extern diaElem  *gtkCreateFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip, int decimals);
 extern void     gtkDeleteFloat(diaElem *e);
 extern CREATE_INTEGER_T  gtkCreateInteger;
 extern CREATE_UINTEGER_T gtkCreateUInteger;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_filesel.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_filesel.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -33,6 +33,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 class diaElemDirSelect : public diaElemDirSelectBase
 {
@@ -46,6 +47,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 static void fileRead(void *w,void *p);
 static void dirSel(void *w,void *p);
@@ -206,6 +208,8 @@
      gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
 }
 
+int diaElemFile::getRequiredLayout(void) { return 0; }
+
 void fileRead(void *w,void *p)
 {
   diaElemFile *me=(diaElemFile *)p;
@@ -335,6 +339,8 @@
 
 }
 
+int diaElemDirSelect::getRequiredLayout(void) { return 0; }
+
 void dirSel(void *w,void *p)
 {
   diaElemDirSelect *me=(diaElemDirSelect *)p;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -38,7 +38,7 @@
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod):
                                 ADM_flyDialog(width,height,in,canvas,slider,yuv,resizeMethod)
   {
-  
+		EndConstructor();
   }
 void ADM_flyDialogGtk::postInit(uint8_t reInit)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bar.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bar.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bar.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -27,6 +27,7 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 diaElemBar::diaElemBar(uint32_t percent,const char *toggleTitle)
@@ -73,6 +74,8 @@
 {
   
 }
+
+int diaElemBar::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bitrate.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_bitrate.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -29,6 +29,7 @@
   void setMaxQz(uint32_t qz);
   void setMinQz(uint32_t qz);
   void updateMe(void);
+  int getRequiredLayout(void);
 };
 
 static void cb_mod(void *w,void *p);
@@ -257,6 +258,9 @@
   }
   memcpy(param,&amp;copy,sizeof(copy));
 }
+
+int diaElemBitrate::getRequiredLayout(void) { return 0; }
+
 void diaElemBitrate::updateMe(void)
 {
   // Read current value

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_button.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_button.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_button.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -31,6 +31,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
@@ -74,6 +75,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
 
+int diaElemButton::getRequiredLayout(void) { return 0; }
+
 void cb_button (GtkWidget *widget,gpointer callback_data)
 {
   diaElemButton *button=(diaElemButton *)callback_data;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_float.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_float.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_float.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -22,19 +22,22 @@
 
 class diaElemFloat : public diaElem
 {
+protected:
+	int decimals;
 
 public:
   ELEM_TYPE_FLOAT min,max;
   diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, 
-               ELEM_TYPE_FLOAT max,const char *tip=NULL);
+               ELEM_TYPE_FLOAT max,const char *tip=NULL, int decimals = 2);
   virtual ~diaElemFloat() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, 
-                            ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip)
+                            ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip, int decimals)
   : diaElem(ELEM_FLOAT)
 {
   param=(void *)intValue;
@@ -42,6 +45,7 @@
   this-&gt;min=min;
   this-&gt;max=max;
   this-&gt;tip=tip;
+  this-&gt;decimals = decimals;
 }
 
 diaElemFloat::~diaElemFloat()
@@ -98,13 +102,15 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemFloat::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 
 diaElem  *gtkCreateFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min,
-        ELEM_TYPE_FLOAT max,const char *tip)
+        ELEM_TYPE_FLOAT max,const char *tip, int decimals)
 {
-	return new  ADM_GtkFactory::diaElemFloat(intValue,toggleTitle,min,max,tip);
+	return new  ADM_GtkFactory::diaElemFloat(intValue,toggleTitle,min,max,tip, decimals);
 }
 void gtkDeleteFloat(diaElem *e)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_frame.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_frame.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -29,6 +29,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
   : diaElemFrameBase()
@@ -115,6 +116,8 @@
    GtkWidget *widget=(GtkWidget *)myWidget;
    gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemFrame::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -128,4 +131,3 @@
 	delete a;
 }
 //EOF
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_hex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_hex.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_hex.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -29,6 +29,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 
 #define HEX_NB_LINE   8
@@ -226,6 +227,8 @@
 
 };
 
+int diaElemHex::getRequiredLayout(void) { return 0; }
+
 } // End of namespace
 //****************************Hoook*****************
 
@@ -239,6 +242,3 @@
 	delete a;
 }
 //EOF
-
-
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_integer.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_integer.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -30,6 +30,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -42,6 +43,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 
@@ -114,6 +116,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 
+int diaElemInteger::getRequiredLayout(void) { return 0; }
+
 //**********************************************************************************
 
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
@@ -186,6 +190,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 
+int diaElemUInteger::getRequiredLayout(void) { return 0; }
+
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_matrix.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_matrix.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_matrix.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -28,6 +28,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
@@ -128,6 +129,8 @@
 			  gtk_widget_set_sensitive( GTK_WIDGET(arrayWidget[index++]),onoff);
 		  }
 }
+
+int diaElemMatrix::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_menu.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_menu.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -37,6 +37,7 @@
   virtual void      updateMe(void);
   virtual void      enable(uint32_t onoff) ;
   virtual void      finalize(void);
+  int getRequiredLayout(void);
 };
 //**********************
 class diaElemMenu : public diaElemMenuBase
@@ -56,7 +57,8 @@
   virtual uint8_t   link(diaMenuEntry *entry,uint32_t onoff,diaElem *w);
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
-  void      finalize(void);;
+  void      finalize(void);
+  int getRequiredLayout(void);
 };
 //**********************
 diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -116,6 +118,9 @@
 {
   dyna-&gt;finalize();
 }
+
+int diaElemMenu::getRequiredLayout(void) { return 0; }
+
 //*******************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
@@ -249,6 +254,9 @@
 {
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
+
+int diaElemMenuDynamic::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu(void *w,void *p)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -29,6 +29,7 @@
   virtual ~diaElemNotch() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) {};
+  int getRequiredLayout(void);
 };
 
 
@@ -71,7 +72,8 @@
                     (GtkAttachOptions) (0), 0, 0);
   
 }
-//****************************************************
+
+int diaElemNotch::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_readOnlyText.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_readOnlyText.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -27,7 +27,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 
 class diaElemText : public diaElem
@@ -40,6 +40,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 
@@ -90,6 +91,9 @@
  
   
 }
+
+int diaElemReadOnlyText::getRequiredLayout(void) { return 0; }
+
 /***************************************************************/
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_ROTEXT)
@@ -148,6 +152,8 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemText::getRequiredLayout(void) { return 0; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_slider.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_slider.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_slider.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -32,6 +32,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 class diaElemSlider : public diaElemSliderBase
@@ -46,8 +47,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  
-  
+  int getRequiredLayout(void);
 };
 
 //****************************************************
@@ -137,6 +137,9 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemSlider::getRequiredLayout(void) { return 0; }
+
 //********************** USLIDER***********
 
 
@@ -224,6 +227,9 @@
   GtkWidget *widget=(GtkWidget *)myWidget;
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
+
+int diaElemUSlider::getRequiredLayout(void) { return 0; }
+
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_threadCount.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_threadCount.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_threadCount.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -29,6 +29,7 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 static void customToggled(void *widget, void *userData);
@@ -99,7 +100,7 @@
 	gtk_widget_show (radiobutton3);
 	gtk_box_pack_start (GTK_BOX (hbox2), radiobutton3, TRUE, TRUE, 0);
 
-	spinbutton1_adj = gtk_adjustment_new (2, 2, 32, 1, 10, 10);
+	spinbutton1_adj = gtk_adjustment_new (2, 2, 32, 1, 10, 0);
 	spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
 	gtk_widget_show (spinbutton1);
 	gtk_box_pack_start (GTK_BOX (hbox2), spinbutton1, TRUE, TRUE, 0);
@@ -137,6 +138,8 @@
 	}
 }
 
+int diaElemThreadCount::getRequiredLayout(void) { return 0; }
+
 void customToggled(void *widget, void *userData)
 {
 	diaElemThreadCount *elem = (diaElemThreadCount*)userData;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_toggle.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_toggle.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -30,6 +30,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 
 class diaElemToggleUint : public diaElem
@@ -48,6 +49,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 class diaElemToggleInt : public diaElem
 {
@@ -65,6 +67,7 @@
   void      finalize(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 static void cb_menu(void *w,void *p);
@@ -156,6 +159,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
 }
 
+int diaElemToggle::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu(void *w,void *p)
 {
@@ -251,6 +256,8 @@
   gtk_widget_set_sensitive(GTK_WIDGET(wuint),onoff);
 }
 
+int diaElemToggleUint::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu2(void *w,void *p)
 {
@@ -321,6 +328,8 @@
   if(*emb&gt;_max) *emb=_max;
 }
 
+int diaElemToggleInt::getRequiredLayout(void) { return 0; }
+
 //** C callback **
 void cb_menu3(void *w,void *p)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/toolkit_dialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/toolkit_dialog.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/toolkit_dialog.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -47,15 +47,11 @@
         // old one is no longer modal
         if(widgetCount)
         {
-#ifndef __WIN32                
                 gtk_window_set_modal(GTK_WINDOW(widgetStack[widgetCount-1]), 0);
-#endif
                 gtk_window_set_transient_for (GTK_WINDOW(newdialog),GTK_WINDOW(widgetStack[widgetCount-1]));
+				gtk_window_set_modal(GTK_WINDOW(widgetStack[widgetCount]), 1);
         }
-        gtk_window_set_modal(GTK_WINDOW(widgetStack[widgetCount]), 1);
-#ifdef __WIN32
-        gtk_window_set_icon(GTK_WINDOW(widgetStack[widgetCount]), gtk_window_get_icon (GTK_WINDOW(widgetStack[0])));
-#endif
+
         widgetCount++;
 }
 void gtk_unregister_dialog(GtkWidget *newdialog)
@@ -63,15 +59,11 @@
 	ADM_assert(widgetCount);
 	ADM_assert(widgetStack[widgetCount-1]==newdialog);
 	widgetCount--;
-	if(widgetCount)
+	if(widgetCount &gt; 1)
 	{
 		// Reset the old one modal
 		gtk_window_set_modal(GTK_WINDOW(widgetStack[widgetCount-1]), 1);
-#ifdef __WIN32
-		gtk_window_present(GTK_WINDOW(widgetStack[widgetCount-1]));
-#endif
 	}
-
 }
 void		gtk_transient(GtkWidget *widget)
 {

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_dialogFactoryQt4.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_dialogFactoryQt4.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_dialogFactoryQt4.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,2 @@
+#define FAC_QT_GRIDLAYOUT 1
+#define FAC_QT_VBOXLAYOUT 2
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_toolkitQt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_toolkitQt.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/ADM_toolkitQt.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,8 @@
+#ifndef QT_TOOLKIT_H
+#define QT_TOOLKIT_H
+#include &lt;QtGui/QWidget&gt;
+
+void qtRegisterDialog(QWidget *dialog);
+void qtUnregisterDialog(QWidget *dialog);
+QWidget* qtLastRegisteredDialog();
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -19,6 +19,19 @@
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
+
+class FlyDialogEventFilter : public QObject
+{
+	ADM_flyDialog *flyDialog;
+	bool recomputed;
+
+public:
+	FlyDialogEventFilter(ADM_flyDialog *flyDialog);
+
+protected:
+	bool eventFilter(QObject *obj, QEvent *event);
+};
+
 class ADM_flyDialogQt4 : public ADM_flyDialog
 {
 public:
@@ -32,8 +45,6 @@
   virtual uint32_t sliderGet(void);
   virtual uint8_t  sliderSet(uint32_t value);
   virtual void    postInit(uint8_t reInit);
-  virtual uint8_t    sliderChanged(void){return 0;};
-            
 };
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4_template.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4_template.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4_template.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -46,7 +46,7 @@
  public:
      FLY_NAME *myCrop;
      ADM_QCanvas *canvas;
-     WINDOW_NAME(PARAM_NAME *param,AVDMGenericVideoStream *in);
+     WINDOW_NAME(QWidget *parent, PARAM_NAME *param,AVDMGenericVideoStream *in);
      ~WINDOW_NAME();
      DIALOG_NAME ui;
  public slots:
@@ -88,12 +88,17 @@
 {
         uint8_t ret=0;
         
-        WINDOW_NAME dialog(param,in);        
+        WINDOW_NAME dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt	2009-06-28 17:47:53 UTC (rev 4973)
@@ -2,17 +2,17 @@
 
 QT4_WRAP_CPP(${ADM_LIB}_source
 	T_bitrate.h  T_button.h  T_dialogFactory.h  T_filesel.h  T_menu.h  T_slider.h
-	T_threadCount.h  T_toggle.h)
+	T_threadCount.h  T_toggle.h  T_notch.h)
 
 SET(${ADM_LIB}_T
 	T_bitrate.cpp  T_button.cpp  T_dialogFactory.cpp  T_filesel.cpp  T_menu.cpp
-	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp
-        T_flyDialogQt4.cpp T_QCanvas.cpp
+	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp  T_notch.cpp
+    T_flyDialogQt4.cpp T_QCanvas.cpp
 )
 
 SET(${ADM_LIB}_SRCS
-	FAC_bar.cpp    FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp
-	FAC_float.cpp  FAC_hex.cpp    FAC_readOnlyText.cpp
+	FAC_bar.cpp    FAC_frame.cpp  FAC_integer.cpp  FAC_aspectRatio.cpp
+	FAC_float.cpp  FAC_hex.cpp    FAC_readOnlyText.cpp  toolkit.cpp
 	FAC_matrix.cpp  DIA_none.cpp  ${${ADM_LIB}_source}  ${${ADM_LIB}_T})
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
@@ -20,4 +20,4 @@
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
 TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core ADM_coreUI ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} ADM_render_qt4)
 #INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)
-ADM_INSTALL_LIB( ${ADM_LIB})
+ADM_INSTALL_LIB( ${ADM_LIB} )

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_aspectRatio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_aspectRatio.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_aspectRatio.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,123 @@
+/***************************************************************************
+  FAC_aspectRatio.cpp
+  Handle dialog factory element : Aspect Ratio
+  (C) 2008 Gruntster
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;QtGui/QDialog&gt;
+#include &lt;QtGui/QSpinBox&gt;
+#include &lt;QtGui/QGridLayout&gt;
+#include &lt;QtGui/QLabel&gt;
+
+#include &quot;ADM_default.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
+
+extern const char *shortkey(const char *);
+
+namespace ADM_qt4Factory
+{
+class diaElemAspectRatio : public diaElem
+{
+public:
+	uint32_t *den;
+	void *denControl, *label;
+
+	diaElemAspectRatio(uint32_t *num, uint32_t *den, const char *title, const char *tip = NULL);
+	virtual ~diaElemAspectRatio();
+	void setMe(void *dialog, void *opaque, uint32_t line);
+	void getMe(void);
+	void enable(uint32_t onoff);
+	int getRequiredLayout(void);
+};
+
+diaElemAspectRatio::diaElemAspectRatio(uint32_t *num, uint32_t *den, const char *title, const char *tip) : diaElem(ELEM_ASPECT_RATIO)
+{
+	param = (void *)num;
+	this-&gt;den = den;
+	paramTitle = shortkey(title);
+	this-&gt;tip = tip;
+}
+
+diaElemAspectRatio::~diaElemAspectRatio()
+{
+	if(paramTitle)
+		delete paramTitle;
+}
+
+void diaElemAspectRatio::setMe(void *dialog, void *opaque, uint32_t line)
+{
+	QLabel *text = new QLabel(QString::fromUtf8(paramTitle));
+	QSpinBox *numBox = new QSpinBox();
+	QLabel *label = new QLabel(&quot;:&quot;);
+	QSpinBox *denBox = new QSpinBox();
+	QGridLayout *layout = (QGridLayout*) opaque;
+	QHBoxLayout *hboxLayout = new QHBoxLayout();
+
+	myWidget = (void*)numBox;
+	this-&gt;label = (void*)label;
+	this-&gt;denControl = (void*)denBox;
+
+	text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
+	text-&gt;setBuddy(numBox);
+
+	numBox-&gt;setMinimum(1);
+	numBox-&gt;setMaximum(255);
+
+	denBox-&gt;setMinimum(1);
+	denBox-&gt;setMaximum(255);
+
+	numBox-&gt;setValue(*(uint32_t*)param);
+	denBox-&gt;setValue(*(uint32_t*)den);
+
+	QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+	hboxLayout-&gt;addWidget(numBox);
+	hboxLayout-&gt;addWidget(label);
+	hboxLayout-&gt;addWidget(denBox);
+	hboxLayout-&gt;addItem(spacer);
+
+	layout-&gt;addWidget(text,line,0);
+	layout-&gt;addLayout(hboxLayout,line,1);
+}
+
+void diaElemAspectRatio::getMe(void)
+{
+	*(uint32_t*)param = ((QSpinBox*)myWidget)-&gt;value();
+	*(uint32_t*)den = ((QSpinBox*)denControl)-&gt;value();
+}
+
+void diaElemAspectRatio::enable(uint32_t onoff) 
+{
+	QSpinBox *numBox = (QSpinBox*)myWidget;
+	QSpinBox *denBox = (QSpinBox*)denControl;
+	QLabel *label = (QLabel*)this-&gt;label;
+
+	numBox-&gt;setEnabled(onoff);
+	denBox-&gt;setEnabled(onoff);
+	label-&gt;setEnabled(onoff);
+}
+
+int diaElemAspectRatio::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+} // End of namespace
+//****************************Hoook*****************
+
+diaElem  *qt4CreateAspectRatio(uint32_t *num, uint32_t *den, const char *title, const char *tip)
+{
+	return new ADM_qt4Factory::diaElemAspectRatio(num, den, title, tip);
+}
+
+void qt4DestroyAspectRatio(diaElem *e)
+{
+	ADM_qt4Factory::diaElemAspectRatio *a = (ADM_qt4Factory::diaElemAspectRatio *)e;
+	delete a;
+}

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_bar.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_bar.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_bar.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -35,6 +36,7 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -69,6 +71,8 @@
 void diaElemBar::getMe(void)
 {
 }
+
+int diaElemBar::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // nameapsce
 
 diaElem  *qt4CreateBar(uint32_t percent,const char *toggleTitle)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_float.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_float.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_float.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -29,20 +30,23 @@
 
 class diaElemFloat : public diaElem
 {
+protected:
+	int decimals;
 
 public:
   ELEM_TYPE_FLOAT min,max;
   diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, 
-               ELEM_TYPE_FLOAT max,const char *tip=NULL);
+               ELEM_TYPE_FLOAT max,const char *tip=NULL, int decimals = 2);
   virtual ~diaElemFloat() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
 //********************************************************************
-diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip)
+diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, ELEM_TYPE_FLOAT max,const char *tip, int decimals)
   : diaElem(ELEM_TOGGLE)
 {
   param=(void *)intValue;
@@ -50,6 +54,7 @@
   this-&gt;min=min;
   this-&gt;max=max;
   this-&gt;tip=tip;
+  this-&gt;decimals = decimals;
  }
 
 diaElemFloat::~diaElemFloat()
@@ -61,18 +66,25 @@
 {
   QDoubleSpinBox *box=new QDoubleSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
+ box-&gt;setDecimals(decimals);
+ box-&gt;setSingleStep(0.1);
  box-&gt;setValue(*(ELEM_TYPE_FLOAT *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
+ layout-&gt;addLayout(hboxLayout,line,1);
  
 }
 void diaElemFloat::getMe(void)
@@ -94,13 +106,15 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemFloat::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
 diaElem  *qt4CreateFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min,
-        ELEM_TYPE_FLOAT max,const char *tip)
+        ELEM_TYPE_FLOAT max,const char *tip, int decimals)
 {
-	return new  ADM_qt4Factory::diaElemFloat(intValue,toggleTitle,min,max,tip);
+	return new  ADM_qt4Factory::diaElemFloat(intValue,toggleTitle,min,max,tip, decimals);
 }
 void qt4DestroyFloat(diaElem *e)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_frame.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_frame.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -1,6 +1,6 @@
 /***************************************************************************
-  FAC_toggle.cpp
-  Handle dialog factory element : Toggle
+  FAC_frame.cpp
+  Handle dialog factory element : Frame
   (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
 ***************************************************************************/
 
@@ -16,9 +16,11 @@
 
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QLabel&gt;
+#include &lt;QtGui/QGroupBox&gt;
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -37,6 +39,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
@@ -62,30 +65,47 @@
   if(paramTitle)
     delete paramTitle;
 }
+
 void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
 {
-  
-   QGridLayout *layout=(QGridLayout*) opaque;  
-   QGridLayout *layout2;
-   
-   layout2=new QGridLayout((QWidget *)dialog);
-   myWidget=(void *)layout2; 
+	QVBoxLayout *layout = (QVBoxLayout*)opaque;
+	QGroupBox *groupBox = new QGroupBox(QString::fromUtf8(paramTitle));
+	QVBoxLayout *vboxlayout = new QVBoxLayout(groupBox);
+	QLayout *layout2 = NULL;
+	int currentLayout = 0;
+	int v;
 
-    QLabel *text=new QLabel( (QWidget *)dialog);
-    QString string = QString::fromUtf8(paramTitle);
-    
-    string=&quot;&lt;b&gt;&quot;+string+&quot;&lt;/b&gt;&quot;;
-    text-&gt;setText(string);
- layout-&gt;addWidget(text,line,0);
- layout-&gt;addLayout(layout2,line+1,0);
- int  v=0;
-  for(int i=0;i&lt;nbElems;i++)
-  {
-    elems[i]-&gt;setMe(dialog,layout2,v); 
-    v+=elems[i]-&gt;getSize();
-  }
-  myWidget=(void *)layout2;
+	for (int i = 0; i &lt; nbElems; i++)
+	{
+		if (elems[i]-&gt;getRequiredLayout() != currentLayout)
+		{
+			if (layout2)
+				vboxlayout-&gt;addLayout(layout2);
+
+			switch (elems[i]-&gt;getRequiredLayout())
+			{
+				case FAC_QT_GRIDLAYOUT:
+					layout2 = new QGridLayout();
+					break;
+				case FAC_QT_VBOXLAYOUT:
+					layout2 = new QVBoxLayout();
+					break;
+			}
+
+			currentLayout = elems[i]-&gt;getRequiredLayout();
+			v = 0;
+		}
+
+		elems[i]-&gt;setMe(groupBox, layout2, v); 
+		v += elems[i]-&gt;getSize();
+	}
+
+	if (layout2)
+		vboxlayout-&gt;addLayout(layout2);
+
+	layout-&gt;addWidget(groupBox);
 }
+
 //*****************************
 void diaElemFrame::getMe(void)
 {
@@ -105,6 +125,8 @@
 {
   
 }
+
+int diaElemFrame::getRequiredLayout(void) { return FAC_QT_VBOXLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_hex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_hex.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_hex.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -16,6 +16,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 namespace ADM_qt4Factory
 {
@@ -31,6 +32,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 extern const char *shortkey(const char *);
   diaElemHex::diaElemHex(const char *toggleTitle, uint32_t dataSize,uint8_t *data) :diaElem(ELEM_HEXDUMP){};
@@ -38,6 +40,7 @@
   void diaElemHex::setMe(void *dialog, void *opaque,uint32_t line) {};
   void diaElemHex::getMe(void) {} ;
   void diaElemHex::finalize(void) {};
+  int diaElemHex::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 //******************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_integer.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_integer.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -48,7 +50,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
-  
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -71,19 +73,24 @@
 {
   QSpinBox *box=new QSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
  box-&gt;setValue(*(int32_t *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+ text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
- 
+ layout-&gt;addLayout(hboxLayout,line,1);
 }
 void diaElemInteger::getMe(void)
 {
@@ -104,6 +111,9 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemInteger::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -125,18 +135,24 @@
 {
   QSpinBox *box=new QSpinBox((QWidget *)dialog);
   QGridLayout *layout=(QGridLayout*) opaque;
+  QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
    
  box-&gt;setMinimum(min);
  box-&gt;setMaximum(max);
  box-&gt;setValue(*(uint32_t *)param);
  
- box-&gt;show();
- 
  QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+ text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
  text-&gt;setBuddy(box);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(box);
+ hboxLayout-&gt;addItem(spacer);
+
  layout-&gt;addWidget(text,line,0);
- layout-&gt;addWidget(box,line,1);
+ layout-&gt;addLayout(hboxLayout,line,1);
 }
 void diaElemUInteger::getMe(void)
 {
@@ -158,6 +174,9 @@
   else
     box-&gt;setDisabled(1);
 }
+
+int diaElemUInteger::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //********************************************
 //****************************************************
 } // End of namespace

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_matrix.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_matrix.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_matrix.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 
@@ -118,6 +120,8 @@
 				  
 			  }
 }
+
+int diaElemMatrix::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 }
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_readOnlyText.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/FAC_readOnlyText.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -35,7 +36,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 
 class diaElemText : public diaElem
@@ -48,6 +49,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 //********************************************************************
@@ -84,6 +86,9 @@
 
  
 }
+
+int diaElemReadOnlyText::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //*********************************
 
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
@@ -133,6 +138,8 @@
   else
     lineEdit-&gt;setDisabled(TRUE);
 }
+
+int diaElemText::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -156,5 +163,3 @@
 	delete a;
 }
 //EOF
-
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -16,6 +16,7 @@
 #include &quot;T_bitrate.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -30,16 +31,16 @@
   void getMe(void);
   void setMaxQz(uint32_t qz);
   void setMinQz(uint32_t qz);
-  
+  int getRequiredLayout(void);
   void updateMe(void);
 };
 
-ADM_Qbitrate::ADM_Qbitrate(QWidget *z,COMPRES_PARAMS *p,uint32_t minQ, uint32_t mq,QGridLayout *layout,int line) : QWidget(z) 
+ADM_Qbitrate::ADM_Qbitrate(COMPRES_PARAMS *p,uint32_t minQ, uint32_t mq,QGridLayout *layout,int line)
 {
 	compress=p;
-	combo=new QComboBox(z);
+	combo=new QComboBox();
 
-	_minQ = minQ;
+	_minQ=minQ;
 	maxQ=mq;
 	int index=0,set=-1;
 #define add(x,z,y) if(compress-&gt;capabilities &amp; ADM_ENC_CAP_##x) {combo-&gt;addItem(QString::fromUtf8(y));\
@@ -47,37 +48,45 @@
 	index++;}
 
 	add(CBR,CBR,QT_TR_NOOP(&quot;Constant Bitrate&quot;));
-	add(CQ,CQ,QT_TR_NOOP(&quot;Constant Quality&quot;));
-	add(SAME,SAME,QT_TR_NOOP(&quot;Same Quantizer as Input&quot;));
-	add(AQ,AQ,QT_TR_NOOP(&quot;Average Quantizer&quot;));
+	add(CQ,CQ,QT_TR_NOOP(&quot;Constant Quantiser&quot;));
+	add(SAME,SAME,QT_TR_NOOP(&quot;Same Quantiser as Input&quot;));
+	add(AQ,AQ,QT_TR_NOOP(&quot;Constant Rate Factor&quot;));
 	add(2PASS,2PASS,QT_TR_NOOP(&quot;Two Pass - Video Size&quot;));
 	add(2PASS_BR,2PASS_BITRATE,QT_TR_NOOP(&quot;Two Pass - Average Bitrate&quot;));
 
-	combo-&gt;show();
-
-	text1=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Encoding mode&quot;)),z);
+	text1=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Encoding mode&quot;)));
 	text1-&gt;setBuddy(combo);
-	text1-&gt;show();
 
-	box=new QSpinBox(z);
-	box-&gt;show();
+	box=new QSpinBox();
 
-	text2=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Bitrate&quot;)),z);
+	text2=new QLabel( QString::fromUtf8(QT_TR_NOOP(&quot;Bitrate&quot;)));
 	text2-&gt;setBuddy(combo);
 
+	QHBoxLayout *hboxLayout = new QHBoxLayout();
+	QHBoxLayout *hboxLayout2 = new QHBoxLayout();
+	QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+	QSpacerItem *spacer2 = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+	hboxLayout-&gt;addWidget(combo);
+	hboxLayout-&gt;addItem(spacer);
+
 	layout-&gt;addWidget(text1,line,0);
-	layout-&gt;addWidget(combo,line,1);
+	layout-&gt;addItem(hboxLayout,line,1);
 
+	hboxLayout2-&gt;addWidget(box);
+	hboxLayout2-&gt;addItem(spacer2);
+
 	layout-&gt;addWidget(text2,line+1,0);
-	layout-&gt;addWidget(box,line+1,1);
+	layout-&gt;addItem(hboxLayout2,line+1,1);
 
 	if(set!=-1) 
 	{
 		combo-&gt;setCurrentIndex(set);
 		comboChanged(set);
 	}
+	connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
 
-	QObject::connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
+
 }
 
 /**
@@ -120,7 +129,7 @@
     case COMPRESS_2PASS: Mx(COMPRESS_2PASS);Vx(finalsize);break;
     case COMPRESS_2PASS_BITRATE: Mx(COMPRESS_2PASS_BITRATE);Vx(avg_bitrate);break;
     case COMPRESS_SAME: Mx(COMPRESS_SAME);break;
-    case COMPRESS_AQ: Mx(COMPRESS_AQ);break;
+    case COMPRESS_AQ: Mx(COMPRESS_AQ);Vx(qz);break;
     default :
           ADM_assert(0);
   }
@@ -201,22 +210,13 @@
   maxQ=qz; 
 }
 
-diaElemBitrate::~diaElemBitrate()
-{
-  ADM_assert(myWidget);
-#if 0 // Automatically deleted as it is a child of main dialog
-  ADM_Qbitrate *z=(ADM_Qbitrate *)myWidget;
-  
-  if(z) delete z;
+diaElemBitrate::~diaElemBitrate() {};
 
-  myWidget=NULL;
-#endif
-}
 void diaElemBitrate::setMe(void *dialog, void *opaque,uint32_t line)
 {
   QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qbitrate *b=new ADM_Qbitrate( (QWidget *)dialog,(COMPRES_PARAMS *)&amp;copy,minQ,maxQ,layout,line);
+  ADM_Qbitrate *b=new ADM_Qbitrate((COMPRES_PARAMS *)&amp;copy,minQ,maxQ,layout,line);
   myWidget=(void *)b;
   
 }
@@ -226,6 +226,7 @@
   memcpy(param,&amp;copy,sizeof(copy));
 }
 
+int diaElemBitrate::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_bitrate.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -26,7 +26,7 @@
 		COMPRES_PARAMS  *compress;
 		uint32_t        maxQ, _minQ;
 
-		ADM_Qbitrate(QWidget *z, COMPRES_PARAMS *p, uint32_t minQ, uint32_t mq, QGridLayout *layout, int line);
+		ADM_Qbitrate(COMPRES_PARAMS *p, uint32_t minQ, uint32_t mq, QGridLayout *layout, int line);
 		virtual ~ADM_Qbitrate();
 		void readBack(void);
 	};

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_button.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_button.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_button.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -15,6 +15,7 @@
 
 #include &quot;T_button.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 namespace ADM_Qt4Factory
@@ -30,6 +31,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 ADM_Qbutton::ADM_Qbutton(QWidget *z,QGridLayout *layout,const char *blah,int line,ADM_FAC_CALLBACK *cb, void *cookie) : QWidget(z) 
@@ -86,6 +88,8 @@
 
 }
 
+int diaElemButton::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 }; // End of namespace
 //****************************Hoook*****************
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_dialogFactory.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_dialogFactory.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -22,15 +22,11 @@
 #include &quot;DIA_factory.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;DIA_coreUI_internal.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 static void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab);
-factoryWindow::factoryWindow()     : QDialog()
- {
-//     ui.setupUi(this);
-     //connect( (ui.pushButton),SIGNAL(pressed()),this,SLOT(buttonPressed()));
- }
 
-
 /**
     \fn qt4DiaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
     \brief  Run a dialog made of nb elems, each elem being described in the **elems
@@ -39,7 +35,8 @@
 
 uint8_t qt4DiaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
 {
-  factoryWindow dialog;
+  QDialog dialog(qtLastRegisteredDialog());
+  qtRegisterDialog(&amp;dialog);
   
   ADM_assert(title);
   ADM_assert(nb);
@@ -47,38 +44,61 @@
   
   dialog.setWindowTitle(QString::fromUtf8(title));
   
-  QGridLayout layout(&amp;dialog);
-  
-  /* First compute the size of our window */
-  int vsize=0;
-  for(int i=0;i&lt;nb;i++)
-  {
-    ADM_assert(elems[i]);
-     vsize+=elems[i]-&gt;getSize(); 
-  }
+  QSpacerItem *spacer = new QSpacerItem(20, 16, QSizePolicy::Minimum, QSizePolicy::Fixed);
+  QDialogButtonBox *buttonBox = new QDialogButtonBox();
+  QVBoxLayout *vboxLayout = new QVBoxLayout();
+  QLayout *layout = NULL;
+  int currentLayout = 0;
 
  int  v=0;
-  for(int i=0;i&lt;nb;i++)
-  {
-    ADM_assert(elems[i]);
-     elems[i]-&gt;setMe( (void *)&amp;dialog,&amp;layout,v); 
-     v+=elems[i]-&gt;getSize();
-    
-  }
+
+ for(int i=0;i&lt;nb;i++)
+ {
+	 ADM_assert(elems[i]);
+
+	 if (elems[i]-&gt;getRequiredLayout() != currentLayout)
+	 {
+		 if (layout)
+			 vboxLayout-&gt;addLayout(layout);
+
+		 switch (elems[i]-&gt;getRequiredLayout())
+		 {
+			 case FAC_QT_GRIDLAYOUT:
+				 layout = new QGridLayout();
+				 break;
+			 case FAC_QT_VBOXLAYOUT:
+				 layout = new QVBoxLayout();
+				 break;
+		 }
+
+		 currentLayout = elems[i]-&gt;getRequiredLayout();
+		 v = 0;
+	 }
+
+	 elems[i]-&gt;setMe( (void *)&amp;dialog,layout,v);
+	 v+=elems[i]-&gt;getSize();
+ }
+
    for(int i=0;i&lt;nb;i++)
   {
     ADM_assert(elems[i]);
      elems[i]-&gt;finalize(); 
   }
+
   // Add buttons
-   QDialogButtonBox buttonBox((QWidget *)&amp;dialog);
-    buttonBox.setStandardButtons(QDialogButtonBox::Ok
-                            | QDialogButtonBox::Cancel);
-     QObject::connect(&amp;buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
-     QObject::connect(&amp;buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
-     layout.addWidget(&amp;buttonBox,vsize,0);
-  // run
-  dialog.setLayout(&amp;layout);
+   buttonBox-&gt;setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
+
+   QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
+   QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
+
+   if (layout)
+	   vboxLayout-&gt;addLayout(layout);
+
+   vboxLayout-&gt;addItem(spacer);
+   vboxLayout-&gt;addWidget(buttonBox);
+
+   dialog.setLayout(vboxLayout);
+
   if(dialog.exec()==QDialog::Accepted)
   {
      for(int i=0;i&lt;nb;i++)
@@ -87,8 +107,14 @@
         elems[i]-&gt;getMe(); 
     
       }
+
+	 qtUnregisterDialog(&amp;dialog);
+
     return 1;
   }
+
+  qtUnregisterDialog(&amp;dialog);
+
   return 0;
   
 }
@@ -98,48 +124,58 @@
 */
 const char *shortkey(const char *in)
 {
- char *t=ADM_strdup(in);
- for(int i=0;i&lt;strlen(t);i++)
- {
-    if(t[i]=='_') t[i]='&amp;'; 
- }
-  return t;
+	QString escaped = QString::fromUtf8(in);
+
+	escaped.replace(&quot;&amp;&quot;, &quot;&amp;&amp;&quot;);
+	escaped.replace(&quot;_&quot;, &quot;&amp;&quot;);
+
+	return ADM_strdup(escaped.toUtf8().constData());
 }
+
 /**
  * 	\fn qt4DiaFactoryRunTabs
  */
 uint8_t qt4DiaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs)
 {
-    factoryWindow dialog;
+    QDialog dialog(qtLastRegisteredDialog());
+
+	qtRegisterDialog(&amp;dialog);
   
   ADM_assert(title);
   ADM_assert(nb);
   ADM_assert(tabs);
   
   dialog.setWindowTitle(QString::fromUtf8(title));
-  
-  QGridLayout layout(&amp;dialog);
 
-  // Add tabs
-  QTabWidget wtabs((QWidget *)&amp;dialog);
-  // Add buttons
-   QDialogButtonBox buttonBox((QWidget *)&amp;dialog);
-    buttonBox.setStandardButtons(QDialogButtonBox::Ok
-                            | QDialogButtonBox::Cancel);
-     QObject::connect(&amp;buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
-     QObject::connect(&amp;buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
-     
+  QVBoxLayout *vboxLayout = new QVBoxLayout();
+  QGridLayout *layout = new QGridLayout();
+  QSpacerItem *spacer = new QSpacerItem(20, 16, QSizePolicy::Minimum, QSizePolicy::Fixed);
+  QTabWidget *wtabs = new QTabWidget();
+  QDialogButtonBox *buttonBox = new QDialogButtonBox();
+
+    buttonBox-&gt;setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
+
+     QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
+     QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
+
      for(int i=0;i&lt;nb;i++)
      {
         ADM_assert(tabs[i]);
-        insertTab(i,tabs[i],&amp;wtabs); 
-    
+        insertTab(i,tabs[i],wtabs);
       }
-     
-     layout.addWidget(&amp;wtabs,0,0);
-     layout.addWidget(&amp;buttonBox,1,0);
-  // run
-  dialog.setLayout(&amp;layout);
+
+	 vboxLayout-&gt;addLayout(layout);
+     vboxLayout-&gt;addWidget(wtabs,0,0);
+	 vboxLayout-&gt;addItem(spacer);
+     vboxLayout-&gt;addWidget(buttonBox,1,0);
+
+	 dialog.setLayout(vboxLayout);
+
+	 // Expand to see all tabs but still allow the window to be resized smaller
+	 wtabs-&gt;setUsesScrollButtons(false);
+	 dialog.adjustSize();
+	 wtabs-&gt;setUsesScrollButtons(true);
+
   if(dialog.exec()==QDialog::Accepted)
   {
       // Read tabs
@@ -153,8 +189,13 @@
         }
     
       }
+	   qtUnregisterDialog(&amp;dialog);
+
       return 1;
   }
+
+  qtUnregisterDialog(&amp;dialog);
+
   return 0;
   
 }
@@ -162,9 +203,11 @@
 void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab)
 {
 
-  QWidget *wid=new QWidget;
-  QGridLayout *layout=new QGridLayout(wid);
+  QWidget *wid=new QWidget;  
   QSpacerItem *spacerItem = new QSpacerItem(20, 40, QSizePolicy::Minimum, QSizePolicy::Expanding);
+  int currentLayout = 0;
+  QVBoxLayout *vboxLayout = new QVBoxLayout(wid);
+  QLayout *layout = NULL;
   
   /* First compute the size of our window */
   int vsize=0;
@@ -174,14 +217,34 @@
      vsize+=tab-&gt;dias[i]-&gt;getSize(); 
   }
 
- int  v=0;
-  for(int i=0;i&lt;tab-&gt;nbElems;i++)
-  {
-     ADM_assert(tab-&gt;dias[i]);
-     tab-&gt;dias[i]-&gt;setMe( wid,layout,v); 
-     v+=tab-&gt;dias[i]-&gt;getSize();
-    
-  }
+	int  v=0;
+
+	for(int i=0;i&lt;tab-&gt;nbElems;i++)
+	{
+		ADM_assert(tab-&gt;dias[i]);
+
+		if (tab-&gt;dias[i]-&gt;getRequiredLayout() != currentLayout)
+		{
+			if (layout)
+				vboxLayout-&gt;addLayout(layout);
+
+			switch (tab-&gt;dias[i]-&gt;getRequiredLayout())
+			{
+				case FAC_QT_GRIDLAYOUT:
+					layout = new QGridLayout();
+					break;
+				case FAC_QT_VBOXLAYOUT:
+					layout = new QVBoxLayout();
+					break;
+			}
+
+			currentLayout = tab-&gt;dias[i]-&gt;getRequiredLayout();
+			v = 0;
+		}
+
+		tab-&gt;dias[i]-&gt;setMe( wid,layout,v); 
+		v+=tab-&gt;dias[i]-&gt;getSize();
+	}
   
   wtab-&gt;addTab(wid,QString::fromUtf8(tab-&gt;title));
   for(int i=0;i&lt;tab-&gt;nbElems;i++)
@@ -189,7 +252,10 @@
     tab-&gt;dias[i]-&gt;finalize(); 
   }
 
-  layout-&gt;addItem(spacerItem, v, 0);
+  if (layout)
+	  vboxLayout-&gt;addLayout(layout);
+
+  vboxLayout-&gt;addItem(spacerItem);
 }
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -18,6 +18,7 @@
 //#include &quot;prefs.h&quot;
 #include &quot;DIA_factory.h&quot;
 #include &quot;DIA_fileSel.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 void GUI_FileSelRead(const char *label, char * * name);
@@ -40,6 +41,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 class diaElemDirSelect : public diaElemDirSelectBase
 {
@@ -53,6 +55,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 void ADM_Qfilesel::buttonPressed(QAbstractButton *s)
@@ -106,18 +109,14 @@
 	}
 }
 
-ADM_Qfilesel::ADM_Qfilesel(QWidget *z,const char *title,const char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc) : 
-	QWidget(z), defaultSuffix (defaultSuffix), selectDesc (selectDesc)
+ADM_Qfilesel::ADM_Qfilesel(const char *title,const char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc) : 
+	defaultSuffix (defaultSuffix), selectDesc (selectDesc)
 {          
 	fileMode=mode;
-	edit=new QLineEdit(QString::fromUtf8(entry),z);
+	edit=new QLineEdit(QString::fromUtf8(entry));
+	button=new QDialogButtonBox(QDialogButtonBox::Open,Qt::Horizontal);
+	text=new QLabel(QString::fromUtf8(title));
 
-	edit-&gt;show();
-
-	button=new QDialogButtonBox(QDialogButtonBox::Open,Qt::Horizontal,z);
-	button-&gt;show();
-
-	text=new QLabel(QString::fromUtf8(title),z);
 	text-&gt;setBuddy(edit);
 	layout-&gt;addWidget(text,line,0);
 	layout-&gt;addWidget(edit,line,1);
@@ -163,9 +162,9 @@
  QGridLayout *layout=(QGridLayout*) opaque;
  ADM_Qfilesel *fs;
   if(_write)
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
+      fs=new ADM_Qfilesel(paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_WRITE, defaultSuffix, tip);
   else
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_READ, 0, tip);
+      fs=new ADM_Qfilesel(paramTitle, *(const char**)param, layout, line,ADM_FILEMODE_READ, 0, tip);
   myWidget=(void *)fs; 
 }
 
@@ -181,10 +180,18 @@
 
 void diaElemFile::enable(uint32_t onoff)
 {
-  ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
-  fs-&gt;setEnabled(onoff);
+	ADM_Qfilesel *fs = (ADM_Qfilesel*)myWidget;
+
+	ADM_assert(fs);
+
+	fs-&gt;text-&gt;setEnabled(onoff);
+	fs-&gt;edit-&gt;setEnabled(onoff);
+	fs-&gt;button-&gt;setEnabled(onoff);
 }
 void diaElemFile::changeFile(void) {}
+
+int diaElemFile::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //****************************
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *selectDirDesc) :
 	diaElemDirSelectBase()
@@ -208,7 +215,7 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog, paramTitle, *(char **)param, layout, line, ADM_FILEMODE_DIR, 0, tip);
+  ADM_Qfilesel *fs=new ADM_Qfilesel(paramTitle, *(char **)param, layout, line, ADM_FILEMODE_DIR, 0, tip);
   myWidget=(void *)fs; 
 }
 
@@ -222,9 +229,20 @@
   *n=ADM_strdup(s.toUtf8().constData());
 }
 
-void diaElemDirSelect::enable(uint32_t onoff) {}
-  
+void diaElemDirSelect::enable(uint32_t onoff)
+{
+	ADM_Qfilesel *fs = (ADM_Qfilesel*)myWidget;
+
+	ADM_assert(fs);
+
+	fs-&gt;text-&gt;setEnabled(onoff);
+	fs-&gt;edit-&gt;setEnabled(onoff);
+	fs-&gt;button-&gt;setEnabled(onoff);
+}
+
 void diaElemDirSelect::changeFile(void) {}
+
+int diaElemDirSelect::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 } // End of namespace
 //****************************Hoook*****************
 
@@ -249,5 +267,3 @@
 	delete a;
 }
 //EOF
-
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_filesel.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -32,7 +32,7 @@
 		const char *defaultSuffix;
 		const char *selectDesc;
 
-		ADM_Qfilesel(QWidget *z, const char *title, const char *entry, QGridLayout *layout, int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc);
+		ADM_Qfilesel(const char *title, const char *entry, QGridLayout *layout, int line, ADM_fileMode mode, const char * defaultSuffix, const char* selectDesc);
 		~ADM_Qfilesel();
 	};
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -13,6 +13,8 @@
 ***************************************************************************///
 
 
+#include &lt;QtCore/QEvent&gt;
+#include &lt;QtCore/QCoreApplication&gt;
 #include &lt;QtGui/QGraphicsView&gt;
 #include &lt;QtGui/QSlider&gt;
 
@@ -21,6 +23,33 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
+
+extern float UI_calcZoomToFitScreen(QWidget* window, QWidget* canvas, uint32_t imageWidth, uint32_t imageHeight);
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w, uint32_t *h);
+
+FlyDialogEventFilter::FlyDialogEventFilter(ADM_flyDialog *flyDialog)
+{
+	recomputed = false;
+	this-&gt;flyDialog = flyDialog;
+}
+
+bool FlyDialogEventFilter::eventFilter(QObject *obj, QEvent *event)
+{
+	if (event-&gt;type() == QEvent::Show &amp;&amp; !recomputed)
+	{
+		recomputed = true;
+		QWidget* parent = (QWidget*)obj;
+		uint32_t screenWidth, screenHeight;
+
+		UI_getPhysicalScreenSize(parent, &amp;screenWidth, &amp;screenHeight);
+		flyDialog-&gt;recomputeSize();
+		QCoreApplication::processEvents();
+		parent-&gt;move((((int)screenWidth) - parent-&gt;frameSize().width()) / 2, (((int)screenHeight) - parent-&gt;frameSize().height()) / 2);
+	}
+
+	return QObject::eventFilter(obj, event);
+}
+
   ADM_flyDialogQt4::ADM_flyDialogQt4(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod):
                                 ADM_flyDialog(width,height,in,canvas,slider,yuv,resizeMethod) 
@@ -32,14 +61,26 @@
 {
 	QWidget *graphicsView = ((ADM_QCanvas*)_canvas)-&gt;parentWidget();
 	QSlider  *slider=(QSlider *)_slider;
-	
-	graphicsView-&gt;setMinimumSize(_w, _h);
-	graphicsView-&gt;resize(_w, _h);
-	uint32_t nbFrames=_in-&gt;getInfo()-&gt;nb_frames; 
-	slider-&gt;setMaximum(nbFrames);
+
+	if (!reInit)
+	{
+		FlyDialogEventFilter *eventFilter = new FlyDialogEventFilter(this);
+
+		if (slider)
+			slider-&gt;setMaximum(_in-&gt;getInfo()-&gt;nb_frames);
+
+		graphicsView-&gt;parentWidget()-&gt;installEventFilter(eventFilter);
+	}
+
+	((ADM_QCanvas*)_canvas)-&gt;changeSize(_zoomW, _zoomH);
+	graphicsView-&gt;setMinimumSize(_zoomW, _zoomH);
+	graphicsView-&gt;resize(_zoomW, _zoomH);
 }
 
-float ADM_flyDialogQt4::calcZoomFactor(void) {return 1;}
+float ADM_flyDialogQt4::calcZoomFactor(void)
+{
+	return UI_calcZoomToFitScreen(((ADM_QCanvas*)_canvas)-&gt;parentWidget()-&gt;parentWidget(), ((ADM_QCanvas*)_canvas)-&gt;parentWidget(), _w, _h);
+}
 
 uint8_t  ADM_flyDialogQt4::display(void)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -15,6 +15,7 @@
 
 #include &quot;T_menu.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QLabel&gt;
@@ -40,11 +41,12 @@
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
   void      finalize(void);;
+  int getRequiredLayout(void);
 };
 
 /**/
 
-ADM_QComboBox::ADM_QComboBox(QWidget *root,diaElemMenuDynamic *menu) : QComboBox(root)
+ADM_QComboBox::ADM_QComboBox(diaElemMenuDynamic *menu)
 {
 	_menu=menu;
 }
@@ -117,6 +119,9 @@
 {
   dyna-&gt;finalize();
 }
+
+int diaElemMenu::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //*********************************
 //* DYNAMIC                       *
 //*********************************
@@ -140,11 +145,15 @@
 }
 void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
 {
-  ADM_QComboBox *combo=new ADM_QComboBox( (QWidget *)dialog,this);
+  ADM_QComboBox *combo=new ADM_QComboBox(this);
+
   QGridLayout *layout=(QGridLayout*) opaque;
      myWidget=(void *)combo; 
 
-	 QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle),(QWidget *)dialog);
+	 QLabel *text=new QLabel( QString::fromUtf8(this-&gt;paramTitle));
+	 text-&gt;setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
+
+	 QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
   
   // Fill in combobox
   int mem=0;
@@ -158,6 +167,7 @@
    text-&gt;setBuddy(combo);
    layout-&gt;addWidget(text,line,0);
    layout-&gt;addWidget(combo,line,1);
+   layout-&gt;addItem(spacer,line,2);
    
    combo-&gt;connectMe();
 }
@@ -236,7 +246,8 @@
 {
   finalize();
 }
-//********************
+
+int diaElemMenuDynamic::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 }; // End of namespace
 
 diaElem  *qt4CreateMenu(uint32_t *intValue,const char *itle, uint32_t nb,         const diaMenuEntry *menu,const char *tip)
@@ -260,5 +271,3 @@
 }
 
 //EOF
-
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_menu.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -1,13 +1,13 @@
-#ifndef T_menu_h
-#define T_menu_h
-
-#include &lt;QtGui/QComboBox&gt;
-
-#include &quot;ADM_inttype.h&quot;
-#include &quot;DIA_factory.h&quot;
-
+#ifndef T_menu_h
+#define T_menu_h
+
+#include &lt;QtGui/QComboBox&gt;
+
+#include &quot;ADM_inttype.h&quot;
+#include &quot;DIA_factory.h&quot;
+
 namespace ADM_qt4Factory
-{
+{
 	class diaElemMenuDynamic : public diaElemMenuDynamicBase
 	{
 	public:
@@ -20,8 +20,9 @@
 		virtual void      updateMe(void);
 		virtual void      enable(uint32_t onoff) ;
 		virtual void      finalize(void);
-	};
-
+		int getRequiredLayout(void);
+	};
+
 	class ADM_QComboBox : public QComboBox
 	{
 		Q_OBJECT
@@ -33,8 +34,8 @@
 		diaElemMenuDynamic *_menu;
 
 	public:
-		ADM_QComboBox(QWidget *root,diaElemMenuDynamic *menu);
+		ADM_QComboBox(diaElemMenuDynamic *menu);
 		void connectMe(void);
-	};
-}
-#endif	// T_menu_h
+	};
+}
+#endif	// T_menu_h

Copied: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.cpp (from rev 4972, branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/FAC_notch.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,89 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;T_notch.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
+
+extern const char *shortkey(const char *);
+
+namespace ADM_qt4Factory
+{
+
+QCheckBoxReadOnly::QCheckBoxReadOnly(QCheckBox *box, bool state)
+{
+	this-&gt;box = box;
+	this-&gt;state = state;
+}
+
+void QCheckBoxReadOnly::stateChanged(int state)
+{
+	box-&gt;setCheckState(this-&gt;state ? Qt::Checked : Qt::Unchecked);
+}
+
+class diaElemNotch : public diaElem
+{
+  uint32_t yesno;
+public:
+  
+  diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip=NULL);
+  virtual ~diaElemNotch() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void) {};
+  int getRequiredLayout(void);
+};
+
+diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
+  : diaElem(ELEM_NOTCH)
+{
+  yesno=yes;
+  paramTitle=toggleTitle;
+  this-&gt;tip=tip;
+}
+
+diaElemNotch::~diaElemNotch()
+{
+  
+}
+void diaElemNotch::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  QCheckBox *box=new QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog);
+  QCheckBoxReadOnly *readOnlyReceiver = new QCheckBoxReadOnly(box, yesno);
+ QGridLayout *layout=(QGridLayout*) opaque;
+ myWidget=(void *)box; 
+ if( yesno)
+ {
+    box-&gt;setCheckState(Qt::Checked); 
+ }
+
+ QObject::connect(box, SIGNAL(stateChanged(int)), readOnlyReceiver, SLOT(stateChanged(int)));
+ layout-&gt;addWidget(box,line,0);
+}
+
+int diaElemNotch::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+} // End of namespace
+//****************************Hoook*****************
+
+diaElem  *qt4CreateNotch(uint32_t yes,const char *toggleTitle, const char *tip)
+{
+	return new  ADM_qt4Factory::diaElemNotch(yes,toggleTitle, tip);
+}
+void qt4DestroyNotch(diaElem *e)
+{
+	ADM_qt4Factory::diaElemNotch *a=(ADM_qt4Factory::diaElemNotch *)e;
+	delete a;
+}
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_notch.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,26 @@
+#ifndef T_NOTCH_H
+#define T_NOTCH_H
+
+#include &lt;QtGui/QGridLayout&gt;
+#include &lt;QtGui/QCheckBox&gt;
+
+#include &quot;DIA_factory.h&quot;
+
+namespace ADM_qt4Factory
+{
+	class QCheckBoxReadOnly : public QObject
+	{
+		Q_OBJECT
+
+	private:
+		QCheckBox *box;
+		bool state;
+
+	public:
+		QCheckBoxReadOnly(QCheckBox *box, bool state);
+
+		public slots:
+			void stateChanged(int state);
+	};
+}
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -16,6 +16,7 @@
 #include &quot;T_slider.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QHBoxLayout&gt;
@@ -35,6 +36,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
   
 };
 class diaElemSlider : public diaElemSliderBase
@@ -49,8 +51,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  
-  
+  int getRequiredLayout(void);
 };
 
 int SpinSlider::value()
@@ -149,6 +150,8 @@
     box-&gt;setDisabled(1);
 }
 
+int diaElemUSlider::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 diaElemSlider::diaElemSlider(int32_t *value,const char *toggleTitle, int32_t min,int32_t max,int32_t incr,const char *tip)
   : diaElemSliderBase()
 {
@@ -204,6 +207,7 @@
     box-&gt;setDisabled(1);
 }
 
+int diaElemSlider::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
 //****************************************************
 } // End of namespace
 //****************************Hoook*****************

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_slider.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -1,12 +1,12 @@
-#ifndef T_slider_h
-#define T_slider_h
-
-#include &lt;QtGui/QSlider&gt;
-#include &lt;QtGui/QSpinBox&gt;
-#include &lt;QtGui/QWidget&gt;
-
+#ifndef T_slider_h
+#define T_slider_h
+
+#include &lt;QtGui/QSlider&gt;
+#include &lt;QtGui/QSpinBox&gt;
+#include &lt;QtGui/QWidget&gt;
+
 namespace ADM_qt4Factory
-{
+{
 	class SpinSlider : public QWidget
 	{
 		Q_OBJECT
@@ -26,6 +26,6 @@
 	private:
 		QSlider * slider;
 		QSpinBox * spinner;
-	};
-}
-#endif	// T_slider_h
+	};
+}
+#endif	// T_slider_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -16,6 +16,7 @@
 #include &quot;T_threadCount.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char* shortkey(const char*);
 
@@ -31,6 +32,7 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 void ADM_QthreadCount::radioGroupChanged(QAbstractButton *s)
@@ -55,11 +57,14 @@
 	text = new QLabel(QString::fromUtf8(title), widget);
 	text-&gt;setBuddy(radiobutton1);
 
+	QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
 	layout-&gt;addWidget(text, line, 0);
 	layout-&gt;addWidget(radiobutton1, line, 1);
 	layout-&gt;addWidget(radiobutton2, line, 2);
 	layout-&gt;addWidget(radiobutton3, line, 3);
 	layout-&gt;addWidget(spinBox, line, 4);
+	layout-&gt;addItem(spacer,line,5);
 
 	QObject::connect(buttonGroup, SIGNAL(buttonClicked(QAbstractButton*)), this, SLOT(radioGroupChanged(QAbstractButton*)));
 
@@ -130,6 +135,9 @@
 	else
 		*val = (threadCount-&gt;spinBox)-&gt;value();
 }
+
+int diaElemThreadCount::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //**********************
 } // End of namesapce
 //**********************

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_threadCount.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -1,12 +1,12 @@
 #ifndef T_threadCount_h
 #define T_threadCount_h
-
 #include &lt;QtGui/QButtonGroup&gt;
 #include &lt;QtGui/QGridLayout&gt;
 #include &lt;QtGui/QLabel&gt;
 #include &lt;QtGui/QRadioButton&gt;
 #include &lt;QtGui/QSpinBox&gt;
 #include &lt;QtGui/QWidget&gt;
+#include &quot;ADM_default.h&quot;
 
 namespace ADM_qt4Factory
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -19,6 +19,7 @@
 #include &quot;T_toggle.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;DIA_factory.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
 
 extern const char *shortkey(const char *);
 
@@ -36,6 +37,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 
 class diaElemToggleUint : public diaElem
@@ -54,6 +56,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 class diaElemToggleInt : public diaElem
 {
@@ -71,6 +74,7 @@
   void      finalize(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 void ADM_QCheckBox::changed(int i)
@@ -120,14 +124,14 @@
 void diaElemToggle::setMe(void *dialog, void *opaque,uint32_t l)
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE);
- QGridLayout *layout=(QGridLayout*) opaque;
+ QVBoxLayout *layout=(QVBoxLayout*) opaque;
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,l,0);
+
+ layout-&gt;addWidget(box);
  box-&gt;connectMe();
 }
 void diaElemToggle::getMe(void)
@@ -192,6 +196,9 @@
     nbLink++;
     return 1;
 }
+
+int diaElemToggle::getRequiredLayout(void) { return FAC_QT_VBOXLAYOUT; }
+
 //******************************************************
 // An UInt and a toggle linked...
 //******************************************************
@@ -217,13 +224,13 @@
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE_UINT);
  QGridLayout *layout=(QGridLayout*) opaque;
+ QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,line,0);
+
  // Now add spin
  QSpinBox *spin=new QSpinBox((QWidget *)dialog);
  widgetUint=(void *)spin; 
@@ -231,8 +238,14 @@
  spin-&gt;setMinimum(_min);
  spin-&gt;setMaximum(_max);
  spin-&gt;setValue(*(uint32_t *)emb);
- spin-&gt;show();
- layout-&gt;addWidget(spin,line,1);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(spin);
+ hboxLayout-&gt;addItem(spacer);
+
+ layout-&gt;addWidget(box,line,0);
+ layout-&gt;addLayout(hboxLayout,line,1);
  box-&gt;connectMe();
 }
 
@@ -290,6 +303,8 @@
   }
 }
 
+int diaElemToggleUint::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 //******************************************************
 // An Int and a toggle linked...
 //******************************************************
@@ -315,13 +330,13 @@
 {
  ADM_QCheckBox *box=new ADM_QCheckBox(QString::fromUtf8(paramTitle),(QWidget *)dialog,this,TT_TOGGLE_INT);
  QGridLayout *layout=(QGridLayout*) opaque;
+ QHBoxLayout *hboxLayout = new QHBoxLayout();
  myWidget=(void *)box; 
  if( *(uint32_t *)param)
  {
     box-&gt;setCheckState(Qt::Checked); 
  }
- box-&gt;show();
- layout-&gt;addWidget(box,line,0);
+
  // Now add spin
  QSpinBox *spin=new QSpinBox((QWidget *)dialog);
  widgetUint=(void *)spin; 
@@ -329,8 +344,14 @@
  spin-&gt;setMinimum(_min);
  spin-&gt;setMaximum(_max);
  spin-&gt;setValue(*emb);
- spin-&gt;show();
- layout-&gt;addWidget(spin,line,1);
+
+ QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+ hboxLayout-&gt;addWidget(spin);
+ hboxLayout-&gt;addItem(spacer);
+
+ layout-&gt;addWidget(box,line,0);
+ layout-&gt;addLayout(hboxLayout,line,1);
  box-&gt;connectMe();
 }
 
@@ -352,6 +373,8 @@
  *emb=u;
 }
 
+int diaElemToggleInt::getRequiredLayout(void) { return FAC_QT_GRIDLAYOUT; }
+
 void   diaElemToggleInt::finalize(void)
 {
   updateMe();

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_toggle.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -1,18 +1,18 @@
-#ifndef T_toggle_h
-#define T_toggle_h
-
-#include &lt;QtGui/QCheckBox&gt;
-#include &lt;QtGui/QWidget&gt;
-
+#ifndef T_toggle_h
+#define T_toggle_h
+
+#include &lt;QtGui/QCheckBox&gt;
+#include &lt;QtGui/QWidget&gt;
+
 namespace ADM_qt4Factory
-{
+{
 	typedef enum
 	{
 		TT_TOGGLE,
 		TT_TOGGLE_UINT,
 		TT_TOGGLE_INT
-	} TOG_TYPE;
-
+	} TOG_TYPE;
+
 	class ADM_QCheckBox : public QCheckBox
 	{
 		Q_OBJECT
@@ -27,6 +27,6 @@
 	public:
 		ADM_QCheckBox(const QString &amp; str, QWidget *root, void *toggle, TOG_TYPE type);
 		void connectMe(void);
-	};
-}
-#endif	// T_toggle_h
+	};
+}
+#endif	// T_toggle_h

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/toolkit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/toolkit.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/toolkit.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -0,0 +1,73 @@
+#include &lt;QtCore/QStack&gt;
+#include &lt;QtGui/QApplication&gt;
+#include &lt;QtGui/QDesktopWidget&gt;
+
+#include &quot;ADM_toolkitQt.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+static QStack&lt;QWidget*&gt; widgetStack;
+
+void qtRegisterDialog(QWidget *dialog)
+{
+	if (widgetStack.count())
+		dialog-&gt;setParent(widgetStack.top(), Qt::Dialog);
+
+	widgetStack.push(dialog);
+}
+
+void qtUnregisterDialog(QWidget *dialog)
+{
+	ADM_assert(widgetStack.top() == dialog);
+	widgetStack.pop();
+}
+
+QWidget* qtLastRegisteredDialog()
+{
+	if (widgetStack.count())
+		return widgetStack.top();
+	else
+		return NULL;
+}
+
+uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h)
+{
+	QRect qrect = QApplication::desktop()-&gt;availableGeometry();
+
+	*w = (uint32_t)qrect.width();
+	*h = (uint32_t)qrect.height();
+}
+
+// Calculate the zoom ratio required to fit the whole image on the screen.
+float UI_calcZoomToFitScreen(QWidget* window, QWidget* canvas, uint32_t imageWidth, uint32_t imageHeight)
+{
+	int windowWidth, windowHeight;
+	int drawingWidth, drawingHeight;
+	uint32_t screenWidth, screenHeight;
+
+	windowWidth = window-&gt;frameSize().width();
+	windowHeight = window-&gt;frameSize().height();
+
+	drawingWidth = canvas-&gt;frameSize().width();
+	drawingHeight = canvas-&gt;frameSize().height();
+
+	UI_getPhysicalScreenSize(window, &amp;screenWidth, &amp;screenHeight);
+
+	// Take drawing area out of the equation, how much extra do we need for additional controls?
+	windowWidth -= drawingWidth;
+	windowHeight -= drawingHeight;
+
+	// This is the true amount of screen real estate we can work with
+	screenWidth -= windowWidth;
+	screenHeight -= windowHeight;
+
+	// Calculate zoom ratio
+	if (imageWidth &gt; screenWidth || imageHeight &gt; screenHeight)
+	{
+		float widthRatio = (float)screenWidth / (float)imageWidth;
+		float heightRatio = (float)screenHeight / (float)imageHeight;
+
+		return (widthRatio &lt; heightRatio ? widthRatio : heightRatio);
+	}
+	else
+		return 1;
+}

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/DIA_flyDialog.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/DIA_flyDialog.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -122,10 +122,9 @@
   virtual uint32_t sliderGet(void)=0;
   virtual uint8_t  sliderSet(uint32_t value) =0;
   virtual void    postInit(uint8_t reInit)=0;
-  virtual uint8_t    sliderChanged(void)=0;
-  
-  
-};          
+  virtual uint8_t sliderChanged(void);
+};
+
 #ifdef ADM_UI_TYPE_BUILD
 #if ADM_UI_TYPE_BUILD == ADM_UI_QT4
   #include &quot;DIA_flyDialogQt4.h&quot;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factory.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factory.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -48,6 +48,7 @@
   ELEM_THREAD_COUNT,
   ELEM_MATRIX,
   ELEM_COUNT,
+  ELEM_ASPECT_RATIO,
   ELEM_MAX=ELEM_COUNT-1
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
@@ -79,6 +80,7 @@
           
   virtual void enable(uint32_t onoff) {}
   virtual void finalize(void) {} // in case some widget needs some stuff just before using them
+  virtual int getRequiredLayout(void)=0;
 };
 /*********************************************/
 #define MENU_MAX_lINK 10
@@ -106,6 +108,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
@@ -122,6 +125,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /************************************/
 class diaElemSliderBase : public diaElem
@@ -148,6 +152,7 @@
   void      getMe(void);
   void      enable(uint32_t onoff) ;
   uint8_t   setDigits(uint32_t digits) ;
+  int getRequiredLayout(void);
 };
 class diaElemSlider : public diaElemSliderBase
 {
@@ -162,7 +167,7 @@
   void      getMe(void);
   void      enable(uint32_t onoff) ;
   uint8_t   setDigits(uint32_t digits) ;
-  
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *CREATE_TOGGLE(uint32_t *toggleValue,const char *toggleTitle, const char *tip);
@@ -191,6 +196,7 @@
   void      finalize(void);
   void      updateMe();
   uint8_t   link(uint32_t onoff,diaElem *w);
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *CREATE_TOGGLE_UINT(uint32_t *toggleValue,const char *toggleTitle, uint32_t *uintval, 
@@ -211,6 +217,7 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
   void      updateMe();
+  int getRequiredLayout(void);
 };
 typedef diaElem *CREATE_TOGGLE_INT(uint32_t *toggleValue,const char *toggleTitle, int32_t *intval, 
 									const char *name,int32_t min,int32_t max,const char *tip=NULL);
@@ -228,6 +235,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      finalize(void);
+  int getRequiredLayout(void);
   void      updateMe();
   void      enable(uint32_t onoff) ;
 };
@@ -244,6 +252,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -256,7 +265,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
-  
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem  *(CREATE_BAR_T)(uint32_t percent,const char *toggleTitle);
@@ -271,22 +280,26 @@
   virtual ~diaElemBar() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
 typedef diaElem  *(CREATE_FLOAT_T)(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min,
-        ELEM_TYPE_FLOAT max,const char *tip);
+        ELEM_TYPE_FLOAT max,const char *tip, int decimals);
 class diaElemFloat : public diaElem
 {
+protected:
+	int decimals;
 
 public:
   ELEM_TYPE_FLOAT min,max;
   diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min, 
-               ELEM_TYPE_FLOAT max,const char *tip=NULL);
+               ELEM_TYPE_FLOAT max,const char *tip=NULL, int decimals = 2);
   virtual ~diaElemFloat() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void      enable(uint32_t onoff) ;
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef struct diaMenuEntry
@@ -357,6 +370,7 @@
   virtual void      updateMe(void);
   virtual void      enable(uint32_t onoff) ;
   virtual void      finalize(void);
+  int getRequiredLayout(void);
 };
 
 class diaElemMenuBase : public diaElem
@@ -387,6 +401,7 @@
   virtual void      updateMe(void);
   void      enable(uint32_t onoff) ;
   void      finalize(void);;
+  int getRequiredLayout(void);
 };
 
 /*************************************************/
@@ -417,6 +432,7 @@
   void setMinQz(uint32_t qz);
   
   void updateMe(void);
+  int getRequiredLayout(void);
 };
 #endif
 /*************************************************/
@@ -449,6 +465,7 @@
   
   void   changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem *CREATE_DIR_T(char **filename,const char *toggleTitle,const char *tip);
@@ -473,6 +490,7 @@
   
   void changeFile(void);
   void   enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 /*************************************************/
 /* The text MUST be copied internally ! */
@@ -486,7 +504,7 @@
   virtual ~diaElemReadOnlyText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
+  int getRequiredLayout(void);
 };
 /*************************************************/
 typedef diaElem *(CREATE_TEXT_T )(char **readOnly,const char *toggleTitle, const char *tip);
@@ -501,6 +519,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
   void enable(uint32_t onoff);
+  int getRequiredLayout(void);
 };
 
 /*********************************************/
@@ -514,6 +533,7 @@
   virtual ~diaElemNotch() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
+  int getRequiredLayout(void);
 };
 /*********************************************/
 typedef diaElem *(CREATE_TAB_T )(const char *toggleTitle, uint32_t nb, diaElem **content);
@@ -562,6 +582,7 @@
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
   void finalize(void);
+  int getRequiredLayout(void);
 };
 /**********************************************/
 typedef diaElem *(CREATE_HEX_T )(const char *toggleTitle, uint32_t dataSize,uint8_t *data);
@@ -577,6 +598,7 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void) ;
   void finalize(void);
+  int getRequiredLayout(void);
 };
 /**********************************************/
 typedef diaElem *(CREATE_THREADCOUNT_T)(uint32_t *value, const char *title, const char *tip = NULL);
@@ -589,7 +611,24 @@
   virtual ~diaElemThreadCount() ;
   void setMe(void *dialog, void *opaque, uint32_t line);
   void getMe(void);
+  int getRequiredLayout(void);
 };
+/**********************************************/
+typedef diaElem *(CREATE_ASPECTRATIO_T)(uint32_t *value, const char *title, const char *tip = NULL);
+class diaElemAspectRatio : public diaElem
+{
+public:
+	uint32_t *den;
+	void *denControl, *label;
+
+	diaElemAspectRatio(uint32_t *num, uint32_t *den, const char *title, const char *tip = NULL);
+	virtual ~diaElemAspectRatio();
+	void setMe(void *dialog, void *opaque, uint32_t line);
+	void getMe(void);
+	void enable(uint32_t onoff);
+	int getRequiredLayout(void);
+};
+
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 uint8_t diaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factoryStubs.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factoryStubs.h	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_factoryStubs.h	2009-06-28 17:47:53 UTC (rev 4973)
@@ -27,6 +27,10 @@
 	{ \
 	ADM_assert(internalPointer); \
 	internalPointer-&gt;getMe(); \
+	} \
+int      aClass::getRequiredLayout(void)\
+	{ \
+	ADM_assert(internalPointer); \
+	return internalPointer-&gt;getRequiredLayout(); \
 	} 
-
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_factory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_factory.cpp	2009-06-28 17:47:51 UTC (rev 4972)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_factory.cpp	2009-06-28 17:47:53 UTC (rev 4973)
@@ -93,10 +93,10 @@
 
 // ****************** Buttons ********************
 diaElemFloat ::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, ELEM_TYPE_FLOAT min,
-        ELEM_TYPE_FLOAT max,const char *tip) :diaElem(ELEM_FLOAT)
+        ELEM_TYPE_FLOAT max,const char *tip, int decimals) :diaElem(ELEM_FLOAT)
 {
 	ADM_assert(Factory); 
-	internalPointer=Factory-&gt;CreateFloat(intValue,toggleTitle, min,max,tip);
+	internalPointer=Factory-&gt;CreateFloat(intValue,toggleTitle, min,max,tip, decimals);
 }
 diaElemFloat ::~diaElemFloat()
 {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002187.html">[Avidemux-svn-commit] r4972 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4
</A></li>
	<LI>Next message: <A HREF="002189.html">[Avidemux-svn-commit] r4974 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2188">[ date ]</a>
              <a href="thread.html#2188">[ thread ]</a>
              <a href="subject.html#2188">[ subject ]</a>
              <a href="author.html#2188">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
