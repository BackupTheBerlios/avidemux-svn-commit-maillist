<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r7699 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries cmake cmake/patches
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7699%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_libraries%20cmake%20cmake/patches&In-Reply-To=%3C20111215110912.62371481347%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004842.html">
   <LINK REL="Next"  HREF="004844.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r7699 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries cmake cmake/patches</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7699%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%0A%09avidemux/ADM_libraries%20cmake%20cmake/patches&In-Reply-To=%3C20111215110912.62371481347%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r7699 - in	branches/avidemux_2.5_branch_gruntster:	avidemux/ADM_libraries cmake cmake/patches">gruntster at mail.berlios.de
       </A><BR>
    <I>Thu Dec 15 12:09:12 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004842.html">[Avidemux-svn-commit] r7698 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4 avidemux/qt4/ADM_jobs/src avidemux_core/ADM_core/src	avidemux_plugins/ADM_videoFilters/Srt cmake
</A></li>
        <LI>Next message: <A HREF="004844.html">[Avidemux-svn-commit] r7700 -	branches/avidemux_2.5_branch_gruntster/cmake/patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4843">[ date ]</a>
              <a href="thread.html#4843">[ thread ]</a>
              <a href="subject.html#4843">[ subject ]</a>
              <a href="author.html#4843">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2011-12-15 12:09:11 +0100 (Thu, 15 Dec 2011)
New Revision: 7699

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.9.tar.bz2
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
Log:
[ffmpeg] upgrade ffmpeg to 0.9

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2
===================================================================
(Binary files differ)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.9.tar.bz2 (from rev 7694, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2)
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 0.8.7)
+set(FFMPEG_VERSION 0.9)
 set(FFMPEG_SOURCE_ARCHIVE &quot;ffmpeg-${FFMPEG_VERSION}.tar.bz2&quot;)
 set(FFMPEG_SOURCE_ARCHIVE_DIR &quot;ffmpeg-${FFMPEG_VERSION}&quot;)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-15 11:09:11 UTC (rev 7699)
@@ -2,7 +2,7 @@
 
 export curDir=$PWD
 export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
-export origFfmpegPath=../ffmpeg-0.8.7
+export origFfmpegPath=../ffmpeg-0.9
 
 function updatePatch {
 	#cd $ffmpegPath
@@ -30,11 +30,11 @@
 updatePatch libavcodec h263dec.c
 updatePatch libavcodec h264.c
 updatePatch libavcodec h264_parser.c
+updatePatch libavcodec libavcodec.v
 updatePatch libavcodec mpeg12.c
 updatePatch libavcodec mpeg12enc.c
 updatePatch libavcodec mpegvideo.c
 updatePatch libavcodec mpegvideo_enc.c
-updatePatch libavcodec utils.c
 updatePatch libavcodec vc1dec.c
 updatePatch libavformat isom.c
 updatePatch libavformat matroskaenc.c

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +1,15 @@
---- ../ffmpeg-0.8.7/libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
-+++ libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
-@@ -620,6 +620,8 @@
- #define CODEC_FLAG2_PSY           0x00080000 ///&lt; Use psycho visual optimizations.
- #define CODEC_FLAG2_SSIM          0x00100000 ///&lt; Compute SSIM during encoding, error[] values are undefined.
- #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///&lt; Use periodic insertion of intra blocks instead of keyframes.
+--- ../ffmpeg-0.9/libavcodec/avcodec.h	2011-12-14 15:00:28 +0000
++++ libavcodec/avcodec.h	2011-12-14 15:00:28 +0000
+@@ -690,6 +690,8 @@
+ #define CODEC_FLAG2_INTRA_VLC     0x00000800 ///&lt; Use MPEG-2 intra VLC table.
+ #define CODEC_FLAG2_DROP_FRAME_TIMECODE 0x00002000 ///&lt; timecode is in drop frame format.
+ #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///&lt; Use MPEG-2 nonlinear quantizer.
 +//MEANX: NEVER EVER USE CLOSED GOP ?
 +#define CODEC_FLAG2_32_PULLDOWN   0x80000000
- 
- /* Unsupported options :
-  *              Syntax Arithmetic coding (SAC)
-@@ -1595,6 +1597,7 @@
+ #endif
+ #if FF_API_MJPEG_GLOBAL_OPTS
+ #define CODEC_FLAG_EXTERN_HUFF     0x1000   ///&lt; Use external Huffman table (for MJPEG).
+@@ -1806,6 +1808,7 @@
       * - decoding: unused
       */
      int rc_max_rate;
@@ -17,7 +17,7 @@
  
      /**
       * minimum bitrate
-@@ -1609,6 +1612,8 @@
+@@ -1820,6 +1823,8 @@
       * - decoding: unused
       */
      int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/ffv1.c	2011-06-23 20:23:53 +0100
-+++ libavcodec/ffv1.c	2011-06-23 20:23:53 +0100
-@@ -1783,6 +1783,8 @@
+--- ../ffmpeg-0.9/libavcodec/ffv1.c	2011-12-14 15:00:28 +0000
++++ libavcodec/ffv1.c	2011-12-14 15:00:28 +0000
+@@ -1724,6 +1724,8 @@
          clear_state(f);
      }else{
          p-&gt;key_frame= 0;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.6/libavcodec/h263dec.c	2011-11-16 20:43:49 +0000
-+++ libavcodec/h263dec.c	2011-11-16 20:43:49 +0000
-@@ -115,6 +115,25 @@
+--- ../ffmpeg-0.9/libavcodec/h263dec.c	2011-12-14 15:00:28 +0000
++++ libavcodec/h263dec.c	2011-12-14 15:00:28 +0000
+@@ -117,6 +117,25 @@
  
      return 0;
  }
@@ -26,27 +26,27 @@
  
  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
  {
-@@ -431,6 +450,12 @@
+@@ -433,6 +452,12 @@
      } else {
          ret = h263_decode_picture_header(s);
      }
 +	//MEANX we need to do it here also for quicktime file / ctts atom 
 +        // we need the correct frame type, and qt file may contain 
 +        // vop not coded frame.
-+        pict-&gt;pict_type=s-&gt;current_picture.pict_type= s-&gt;pict_type;
-+        pict-&gt;key_frame=s-&gt;current_picture.key_frame= s-&gt;pict_type == FF_I_TYPE;
++        pict-&gt;pict_type=s-&gt;current_picture.f.pict_type= s-&gt;pict_type;
++        pict-&gt;key_frame=s-&gt;current_picture.f.key_frame= s-&gt;pict_type == FF_I_TYPE;
 +        //MEANX
  
      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
  
-@@ -715,6 +740,12 @@
+@@ -717,6 +742,12 @@
  
- assert(s-&gt;current_picture.pict_type == s-&gt;current_picture_ptr-&gt;pict_type);
- assert(s-&gt;current_picture.pict_type == s-&gt;pict_type);
+     assert(s-&gt;current_picture.f.pict_type == s-&gt;current_picture_ptr-&gt;f.pict_type);
+     assert(s-&gt;current_picture.f.pict_type == s-&gt;pict_type);
 +
 +/* MEANX */
 +    if(s-&gt;current_picture_ptr)
-+        s-&gt;current_picture_ptr-&gt;opaque=pict-&gt;opaque;
++        s-&gt;current_picture_ptr-&gt;f.opaque=pict-&gt;opaque;
 +/* MEANX */
 +
      if (s-&gt;pict_type == AV_PICTURE_TYPE_B || s-&gt;low_delay) {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,7 +1,7 @@
---- ../ffmpeg-0.8.6/libavcodec/h264.c	2011-11-13 16:42:34 +0000
-+++ libavcodec/h264.c	2011-11-13 16:42:33 +0000
-@@ -4250,6 +4250,20 @@
-     { FF_PROFILE_UNKNOWN },
+--- ../ffmpeg-0.9/libavcodec/h264.c	2011-12-14 15:00:28 +0000
++++ libavcodec/h264.c	2011-12-14 15:00:28 +0000
+@@ -4276,6 +4276,20 @@
+     LIBAVUTIL_VERSION_INT,
  };
  
 +/* MEANX */
@@ -19,5 +19,5 @@
 +/* MeanX */
 +
  AVCodec ff_h264_decoder = {
-     &quot;h264&quot;,
-     AVMEDIA_TYPE_VIDEO,
+     .name           = &quot;h264&quot;,
+     .type           = AVMEDIA_TYPE_VIDEO,

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -0,0 +1,11 @@
+--- ../ffmpeg-0.9/libavcodec/libavcodec.v	2011-12-14 15:00:29 +0000
++++ libavcodec/libavcodec.v	2011-12-14 15:00:28 +0000
+@@ -25,5 +25,8 @@
+                 ff_mmxext_idct;
+                 ff_idct_xvid*;
+                 ff_jpeg_fdct*;
++                ff_h264_info;
++				ff_golomb_vlc_len;
++				ff_ue_golomb_vlc_code;
+         local:  *;
+ };

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,14 +1,14 @@
---- ../ffmpeg-0.8/libavcodec/mpeg12.c	2011-06-23 20:23:54 +0100
-+++ libavcodec/mpeg12.c	2011-06-23 20:23:54 +0100
-@@ -1998,6 +1998,11 @@
+--- ../ffmpeg-0.9/libavcodec/mpeg12.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpeg12.c	2011-12-14 15:00:29 +0000
+@@ -1946,6 +1946,11 @@
          ff_er_frame_end(s);
  
          MPV_frame_end(s);
 +/* MEANX */
 +  if(s-&gt;current_picture_ptr)
-+      s-&gt;current_picture_ptr-&gt;opaque=pict-&gt;opaque;
++      s-&gt;current_picture_ptr-&gt;f.opaque=pict-&gt;opaque;
 +/* MEANX */
 +
  
          if (s-&gt;pict_type == AV_PICTURE_TYPE_B || s-&gt;low_delay) {
-             *pict= *(AVFrame*)s-&gt;current_picture_ptr;
+             *pict = *(AVFrame*)s-&gt;current_picture_ptr;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/mpeg12enc.c	2011-06-23 20:23:54 +0100
-+++ libavcodec/mpeg12enc.c	2011-06-23 20:23:54 +0100
-@@ -127,10 +127,19 @@
+--- ../ffmpeg-0.9/libavcodec/mpeg12enc.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpeg12enc.c	2011-12-14 15:00:29 +0000
+@@ -122,10 +122,19 @@
              s-&gt;frame_rate_index= i;
          }
      }
@@ -20,7 +20,7 @@
  }
  
  static av_cold int encode_init(AVCodecContext *avctx)
-@@ -209,6 +218,7 @@
+@@ -220,6 +229,7 @@
              put_sbits(&amp;s-&gt;pb, 12, s-&gt;width );
              put_sbits(&amp;s-&gt;pb, 12, s-&gt;height);
  
@@ -28,7 +28,7 @@
              for(i=1; i&lt;15; i++){
                  float error= aspect_ratio;
                  if(s-&gt;codec_id == CODEC_ID_MPEG1VIDEO || i &lt;=1)
-@@ -223,20 +233,44 @@
+@@ -234,20 +244,44 @@
                      s-&gt;aspect_ratio_info= i;
                  }
              }
@@ -79,7 +79,7 @@
              else
                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                  vbv_buffer_size = (( 20 * s-&gt;bit_rate) / (1151929 / 2)) * 8 * 1024;
-@@ -269,8 +303,17 @@
+@@ -280,8 +314,17 @@
  
                  put_bits(&amp;s-&gt;pb, 3, s-&gt;avctx-&gt;profile); //profile
                  put_bits(&amp;s-&gt;pb, 4, s-&gt;avctx-&gt;level); //level
@@ -98,7 +98,7 @@
                  put_bits(&amp;s-&gt;pb, 2, s-&gt;chroma_format);
                  put_bits(&amp;s-&gt;pb, 2, s-&gt;width &gt;&gt;12);
                  put_bits(&amp;s-&gt;pb, 2, s-&gt;height&gt;&gt;12);
-@@ -339,6 +382,8 @@
+@@ -346,6 +389,8 @@
  
  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
  {
@@ -107,7 +107,7 @@
      mpeg1_encode_sequence_header(s);
  
      /* mpeg1 picture header */
-@@ -375,6 +420,49 @@
+@@ -382,6 +427,49 @@
  
      s-&gt;frame_pred_frame_dct = 1;
      if(s-&gt;codec_id == CODEC_ID_MPEG2VIDEO){
@@ -144,7 +144,7 @@
 +                        tff=0; /* no repeat */
 +                } else 
 +                {
-+                        tff= s-&gt;current_picture_ptr-&gt;top_field_first;
++                        tff= s-&gt;current_picture_ptr-&gt;f.top_field_first;
 +                }
 +                rff=s-&gt;repeat_first_field;
 +        
@@ -157,24 +157,24 @@
          put_header(s, EXT_START_CODE);
          put_bits(&amp;s-&gt;pb, 4, 8); //pic ext
          if (s-&gt;pict_type == AV_PICTURE_TYPE_P || s-&gt;pict_type == AV_PICTURE_TYPE_B) {
-@@ -393,11 +481,16 @@
+@@ -400,11 +488,16 @@
  
          assert(s-&gt;picture_structure == PICT_FRAME);
          put_bits(&amp;s-&gt;pb, 2, s-&gt;picture_structure);
++
 +#if 0 //MEANX
-+
          if (s-&gt;progressive_sequence) {
              put_bits(&amp;s-&gt;pb, 1, 0); /* no repeat */
          } else {
-             put_bits(&amp;s-&gt;pb, 1, s-&gt;current_picture_ptr-&gt;top_field_first);
+             put_bits(&amp;s-&gt;pb, 1, s-&gt;current_picture_ptr-&gt;f.top_field_first);
          }
 +#endif
-+         put_bits(&amp;s-&gt;pb, 1, tff);  //MEANX PULLDOWN
++        put_bits(&amp;s-&gt;pb, 1, tff);  //MEANX PULLDOWN
 +
          /* XXX: optimize the generation of this flag with entropy
             measures */
          s-&gt;frame_pred_frame_dct = s-&gt;progressive_sequence;
-@@ -407,7 +500,10 @@
+@@ -414,7 +507,10 @@
          put_bits(&amp;s-&gt;pb, 1, s-&gt;q_scale_type);
          put_bits(&amp;s-&gt;pb, 1, s-&gt;intra_vlc_format);
          put_bits(&amp;s-&gt;pb, 1, s-&gt;alternate_scan);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +1,24 @@
---- ../ffmpeg-0.8.4/libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
-+++ libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
-@@ -737,7 +737,11 @@
-     FF_ALLOCZ_OR_GOTO(s-&gt;avctx, s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
+--- ../ffmpeg-0.9/libavcodec/mpegvideo.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpegvideo.c	2011-12-14 15:00:29 +0000
+@@ -840,15 +840,18 @@
+         FF_ALLOCZ_OR_GOTO(s-&gt;avctx, s-&gt;prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
  
-     s-&gt;parse_context.state= -1;
--    if((s-&gt;avctx-&gt;debug&amp;(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s-&gt;avctx-&gt;debug_mv)){
-+ //MEANX: Allocate them always, as they may be free when we decode 1st image
+         s-&gt;parse_context.state = -1;
+-        if ((s-&gt;avctx-&gt;debug &amp; (FF_DEBUG_VIS_QP | FF_DEBUG_VIS_MB_TYPE)) ||
+-            s-&gt;avctx-&gt;debug_mv) {
 +
-+    // MEANXif((s-&gt;avctx-&gt;debug&amp;(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s-&gt;avctx-&gt;debug_mv)){
-+if(1){ // MEANX
++        //MEANX: Allocate them always, as they may be free when we decode 1st image
 +
-        s-&gt;visualization_buffer[0] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
-        s-&gt;visualization_buffer[1] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
-        s-&gt;visualization_buffer[2] = av_malloc((s-&gt;mb_width*16 + 2*EDGE_WIDTH) * s-&gt;mb_height*16 + 2*EDGE_WIDTH);
++        //if ((s-&gt;avctx-&gt;debug &amp; (FF_DEBUG_VIS_QP | FF_DEBUG_VIS_MB_TYPE)) ||
++        //  s-&gt;avctx-&gt;debug_mv) {
+             s-&gt;visualization_buffer[0] = av_malloc((s-&gt;mb_width * 16 +
+                         2 * EDGE_WIDTH) * s-&gt;mb_height * 16 + 2 * EDGE_WIDTH);
+             s-&gt;visualization_buffer[1] = av_malloc((s-&gt;mb_width * 16 +
+                         2 * EDGE_WIDTH) * s-&gt;mb_height * 16 + 2 * EDGE_WIDTH);
+             s-&gt;visualization_buffer[2] = av_malloc((s-&gt;mb_width * 16 +
+                         2 * EDGE_WIDTH) * s-&gt;mb_height * 16 + 2 * EDGE_WIDTH);
+-        }
++        //}
+ 
+         s-&gt;context_initialized = 1;
+         s-&gt;thread_context[0]   = s;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.5/libavcodec/mpegvideo_enc.c	2011-10-11 22:27:47 +0100
-+++ libavcodec/mpegvideo_enc.c	2011-10-11 22:27:47 +0100
-@@ -376,12 +376,14 @@
+--- ../ffmpeg-0.9/libavcodec/mpegvideo_enc.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpegvideo_enc.c	2011-12-14 15:00:29 +0000
+@@ -386,12 +386,14 @@
  
          av_log(avctx, AV_LOG_INFO, &quot;Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n&quot;);
      }
@@ -15,7 +15,7 @@
  
      if(s-&gt;obmc &amp;&amp; s-&gt;avctx-&gt;mb_decision != FF_MB_DECISION_SIMPLE){
          av_log(avctx, AV_LOG_ERROR, &quot;OBMC is only supported with simple mb decision\n&quot;);
-@@ -423,10 +425,12 @@
+@@ -437,10 +439,12 @@
          return -1;
      }
  

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +0,0 @@
---- ../ffmpeg-0.8.7/libavcodec/utils.c	2011-12-01 17:17:55 +0000
-+++ libavcodec/utils.c	2011-12-01 17:17:55 +0000
-@@ -814,10 +814,12 @@
- 
-     if((avctx-&gt;codec-&gt;capabilities &amp; CODEC_CAP_DELAY) || avpkt-&gt;size){
-         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-+#if 0 // MEANX : Silence
-         if(*frame_size_ptr &lt; AVCODEC_MAX_AUDIO_FRAME_SIZE){
-             av_log(avctx, AV_LOG_ERROR, &quot;buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n&quot;);
-             return -1;
-         }
-+#endif
-         if(*frame_size_ptr &lt; FF_MIN_BUFFER_SIZE ||
-         *frame_size_ptr &lt; avctx-&gt;channels * avctx-&gt;frame_size * sizeof(int16_t)){
-             av_log(avctx, AV_LOG_ERROR, &quot;buffer %d too small\n&quot;, *frame_size_ptr);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,8 +1,8 @@
---- ../ffmpeg-0.8/libavcodec/vc1dec.c	2011-06-23 20:23:55 +0100
-+++ libavcodec/vc1dec.c	2011-06-23 20:23:55 +0100
-@@ -3587,6 +3587,11 @@
-         int mby_start;
-     } *slices = NULL;
+--- ../ffmpeg-0.9/libavcodec/vc1dec.c	2011-12-14 15:00:29 +0000
++++ libavcodec/vc1dec.c	2011-12-14 15:00:29 +0000
+@@ -5437,6 +5437,11 @@
+     if(s-&gt;flags &amp; CODEC_FLAG_LOW_DELAY)
+         s-&gt;low_delay = 1;
  
 +	/** MEANX **/
 +	if(s-&gt;flags &amp; CODEC_FLAG_LOW_DELAY)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,14 +1,15 @@
---- ../ffmpeg-0.8.4/libavformat/isom.c	2011-09-22 20:39:59 +0100
-+++ libavformat/isom.c	2011-09-22 20:39:59 +0100
-@@ -239,7 +239,10 @@
-     { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
-     { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
- 
--    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at <A HREF="http://www.3ivx.com/showcase.html">http://www.3ivx.com/showcase.html</A> use this tag */
-+    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at <A HREF="http://www.3ivx.com/showcase.html">http://www.3ivx.com/showcase.html</A> use this tag */
-+     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
-+     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
-+    // /MEANX
-     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
- 
- /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at <A HREF="http://heroinewarrior.com/xmovie.php3">http://heroinewarrior.com/xmovie.php3</A> use this tag */
+--- ../ffmpeg-0.9/libavformat/isom.c	2011-12-14 15:00:29 +0000
++++ libavformat/isom.c	2011-12-14 15:00:29 +0000
+@@ -241,7 +241,11 @@
+     { CODEC_ID_MACE6,           MKTAG('M', 'A', 'C', '6') },
+     { CODEC_ID_MP1,             MKTAG('.', 'm', 'p', '1') },
+     { CODEC_ID_MP2,             MKTAG('.', 'm', 'p', '2') },
+-    { CODEC_ID_MP3,             MKTAG('.', 'm', 'p', '3') },
++//MEANX
++  //{ CODEC_ID_MP3,             MKTAG('.', 'm', 'p', '3') },
++    { CODEC_ID_MP3,             MKTAG('m', 'p', '4', 'a') },
++    { CODEC_ID_MP2,             MKTAG('m', 'p', '4', 'a') },
++// /MEANX
+     { CODEC_ID_MP3,             0x6D730055                },
+     { CODEC_ID_NELLYMOSER,      MKTAG('n', 'm', 'o', 's') }, /* Flash Media Server */
+     { CODEC_ID_PCM_ALAW,        MKTAG('a', 'l', 'a', 'w') },

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavformat/matroskaenc.c	2011-06-23 20:23:55 +0100
-+++ libavformat/matroskaenc.c	2011-06-23 20:23:55 +0100
-@@ -409,6 +409,7 @@
+--- ../ffmpeg-0.9/libavformat/matroskaenc.c	2011-12-14 15:00:29 +0000
++++ libavformat/matroskaenc.c	2011-12-14 15:00:29 +0000
+@@ -418,6 +418,7 @@
  
  static int put_xiph_codecpriv(AVFormatContext *s, AVIOContext *pb, AVCodecContext *codec)
  {
@@ -8,7 +8,7 @@
      uint8_t *header_start[3];
      int header_len[3];
      int first_header_size;
-@@ -433,6 +434,28 @@
+@@ -442,6 +443,28 @@
          avio_write(pb, header_start[j], header_len[j]);
  
      return 0;
@@ -37,7 +37,7 @@
  }
  
  static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
-@@ -537,6 +560,24 @@
+@@ -552,6 +575,24 @@
          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
  

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,7 +1,7 @@
---- libavutil/avutil.h.old	2010-12-20 13:49:31 +0000
-+++ libavutil/avutil.h	2010-12-20 13:49:31 +0000
-@@ -26,6 +26,13 @@
-  * external API header
+--- ../ffmpeg-0.9/libavutil/avutil.h	2011-12-14 15:00:29 +0000
++++ libavutil/avutil.h	2011-12-14 15:00:29 +0000
+@@ -107,6 +107,13 @@
+  * @}
   */
  
 +/* MEANX
@@ -12,5 +12,5 @@
 +
 +
  
- #define AV_STRINGIFY(s)         AV_TOSTRING(s)
- #define AV_TOSTRING(s) #s
+ /**
+  * @defgroup preproc_misc Preprocessor String Macros


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004842.html">[Avidemux-svn-commit] r7698 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4 avidemux/qt4/ADM_jobs/src avidemux_core/ADM_core/src	avidemux_plugins/ADM_videoFilters/Srt cmake
</A></li>
	<LI>Next message: <A HREF="004844.html">[Avidemux-svn-commit] r7700 -	branches/avidemux_2.5_branch_gruntster/cmake/patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4843">[ date ]</a>
              <a href="thread.html#4843">[ thread ]</a>
              <a href="subject.html#4843">[ subject ]</a>
              <a href="author.html#4843">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
