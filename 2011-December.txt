From mean at mail.berlios.de  Thu Dec  1 07:20:37 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  1 Dec 2011 07:20:37 +0100
Subject: [Avidemux-svn-commit] r7679 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder
Message-ID: <20111201062038.BAA6C481521@sheep.berlios.de>

Author: mean
Date: 2011-12-01 07:20:37 +0100 (Thu, 01 Dec 2011)
New Revision: 7679

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
Log:
[plugin] add 1 to the string size to make sure it does not overflow

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2011-11-30 20:01:19 UTC (rev 7678)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2011-12-01 06:20:37 UTC (rev 7679)
@@ -189,8 +189,8 @@
 {
 	int firstLen = strlen(plugin1->getEncoderType(plugin1->encoderId)) + strlen(plugin1->getEncoderName(plugin1->encoderId));
 	int secondLen = strlen(plugin2->getEncoderType(plugin2->encoderId)) + strlen(plugin2->getEncoderName(plugin2->encoderId));
-	char first[firstLen];
-	char second[secondLen];
+	char first[firstLen+1];
+	char second[secondLen+1];
 	int i = 0;
 
 	strcpy(first, plugin1->getEncoderType(plugin1->encoderId));



From mean at mail.berlios.de  Thu Dec  1 07:20:38 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  1 Dec 2011 07:20:38 +0100
Subject: [Avidemux-svn-commit] r7680 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters:
	FluxSmooth ResampleFps
Message-ID: <20111201062039.30460480C9F@sheep.berlios.de>

Author: mean
Date: 2011-12-01 07:20:38 +0100 (Thu, 01 Dec 2011)
New Revision: 7680

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt
Log:
[MacOsX] Fix compilation flag (fluxSmooth/ResampleFps) for MacOsX, patch by nobbles

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt	2011-12-01 06:20:37 UTC (rev 7679)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt	2011-12-01 06:20:38 UTC (rev 7680)
@@ -6,7 +6,10 @@
 ADD_LIBRARY(ADM_vf_FluxSmooth SHARED ${ADM_vf_FluxSmooth_SRCS})
 
 IF (APPLE)
-	TARGET_LINK_LIBRARIES(ADM_vf_FluxSmooth -Wl,-read_only_relocs,suppress)
+         ADD_SOURCE_CFLAGS("ADM_vidFlux.cpp" "-O0")
+         IF (NOT ADM_CPU_X86_64)
+	        TARGET_LINK_LIBRARIES(ADM_vf_FluxSmooth -Wl,-read_only_relocs,suppress)
+         ENDIF (NOT ADM_CPU_X86_64)
 ENDIF (APPLE)
 
 INIT_VIDEOFILTER_PLUGIN(ADM_vf_FluxSmooth)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt	2011-12-01 06:20:37 UTC (rev 7679)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt	2011-12-01 06:20:38 UTC (rev 7680)
@@ -6,7 +6,10 @@
 ADD_LIBRARY(ADM_vf_resampleFps SHARED ${ADM_vf_resampleFps_SRCS})
 
 IF (APPLE)
-	TARGET_LINK_LIBRARIES(ADM_vf_resampleFps -Wl,-read_only_relocs,suppress)
+        ADD_SOURCE_CFLAGS("ADM_vidResampleFPS.cpp" "-O0")
+        IF (NOT ADM_CPU_X86_64)
+	        TARGET_LINK_LIBRARIES(ADM_vf_resampleFps -Wl,-read_only_relocs,suppress)
+        ENDIF (NOT ADM_CPU_X86_64)
 ENDIF (APPLE)
 
 INIT_VIDEOFILTER_PLUGIN(ADM_vf_resampleFps)



From mean at mail.berlios.de  Thu Dec  1 07:30:47 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  1 Dec 2011 07:30:47 +0100
Subject: [Avidemux-svn-commit] r7681 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs: include src
Message-ID: <20111201063048.0B3C9481521@sheep.berlios.de>

Author: mean
Date: 2011-12-01 07:30:47 +0100 (Thu, 01 Dec 2011)
New Revision: 7681

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
Log:
[openGl] Proper include of GLU.h, thanks nibbles

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-12-01 06:20:38 UTC (rev 7680)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-12-01 06:30:47 UTC (rev 7681)
@@ -17,10 +17,12 @@
 #define GL_GLEXT_PROTOTYPES
 #ifdef __APPLE__
 #	include <OpenGL/gl.h>
+#       include <OpenGL/glu.h>
 #	include <OpenGL/glext.h>
 #	define GL_TEXTURE_RECTANGLE_NV GL_TEXTURE_RECTANGLE_EXT
 #else
 #	include <GL/gl.h>
+#       include <GL/glu.h>
 #	include <GL/glext.h>
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-12-01 06:20:38 UTC (rev 7680)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-12-01 06:30:47 UTC (rev 7681)
@@ -7,7 +7,6 @@
 #include "T_openGLFilter.h"
 #include "ADM_default.h"
 #include "DIA_coreToolkit.h"
-#include <GL/glu.h>
 static QGLWidget *thisWidget=NULL;
 /**
 



From mean at mail.berlios.de  Thu Dec  1 07:30:48 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu,  1 Dec 2011 07:30:48 +0100
Subject: [Avidemux-svn-commit] r7682 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20111201063048.E319D481521@sheep.berlios.de>

Author: mean
Date: 2011-12-01 07:30:48 +0100 (Thu, 01 Dec 2011)
New Revision: 7682

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
Log:
[openGL] Fix MacOsX

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-12-01 06:30:47 UTC (rev 7681)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.cpp	2011-12-01 06:30:48 UTC (rev 7682)
@@ -16,6 +16,7 @@
 
 #ifdef __APPLE__
 #	include <OpenGL/gl.h>
+#	include <OpenGL/glu.h>
 #	include <OpenGL/glext.h>
 #	define GL_TEXTURE_RECTANGLE_NV GL_TEXTURE_RECTANGLE_EXT
 #else



From gruntster at mail.berlios.de  Fri Dec  2 19:28:43 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri,  2 Dec 2011 19:28:43 +0100
Subject: [Avidemux-svn-commit] r7683 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_libraries cmake cmake/patches
Message-ID: <20111202182843.9395C481450@sheep.berlios.de>

Author: gruntster
Date: 2011-12-02 19:28:43 +0100 (Fri, 02 Dec 2011)
New Revision: 7683

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.6.tar.bz2
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
Log:
[ffmpeg] upgrade ffmpeg to 0.8.7

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.6.tar.bz2
===================================================================
(Binary files differ)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2 (from rev 7682, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.6.tar.bz2)
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-01 06:30:48 UTC (rev 7682)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-02 18:28:43 UTC (rev 7683)
@@ -1,6 +1,6 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 0.8.6)
+set(FFMPEG_VERSION 0.8.7)
 set(FFMPEG_SOURCE_ARCHIVE "ffmpeg-${FFMPEG_VERSION}.tar.bz2")
 set(FFMPEG_SOURCE_ARCHIVE_DIR "ffmpeg-${FFMPEG_VERSION}")
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-01 06:30:48 UTC (rev 7682)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-02 18:28:43 UTC (rev 7683)
@@ -2,7 +2,7 @@
 
 export curDir=$PWD
 export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
-export origFfmpegPath=../ffmpeg-0.8.6
+export origFfmpegPath=../ffmpeg-0.8.7
 
 function updatePatch {
 	#cd $ffmpegPath

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-01 06:30:48 UTC (rev 7682)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-02 18:28:43 UTC (rev 7683)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/avcodec.h	2011-06-23 20:23:53 +0100
-+++ libavcodec/avcodec.h	2011-06-23 20:23:53 +0100
-@@ -619,6 +619,8 @@
+--- ../ffmpeg-0.8.7/libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
++++ libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
+@@ -620,6 +620,8 @@
  #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
  #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
  #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
@@ -9,7 +9,7 @@
  
  /* Unsupported options :
   *              Syntax Arithmetic coding (SAC)
-@@ -1594,6 +1596,7 @@
+@@ -1595,6 +1597,7 @@
       * - decoding: unused
       */
      int rc_max_rate;
@@ -17,7 +17,7 @@
  
      /**
       * minimum bitrate
-@@ -1608,6 +1611,8 @@
+@@ -1609,6 +1612,8 @@
       * - decoding: unused
       */
      int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-01 06:30:48 UTC (rev 7682)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-02 18:28:43 UTC (rev 7683)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.5/libavcodec/utils.c	2011-10-11 22:27:47 +0100
-+++ libavcodec/utils.c	2011-10-11 22:27:47 +0100
-@@ -792,10 +792,12 @@
+--- ../ffmpeg-0.8.7/libavcodec/utils.c	2011-12-01 17:17:55 +0000
++++ libavcodec/utils.c	2011-12-01 17:17:55 +0000
+@@ -814,10 +814,12 @@
  
      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough



From gruntster at mail.berlios.de  Fri Dec  2 20:16:51 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri,  2 Dec 2011 20:16:51 +0100
Subject: [Avidemux-svn-commit] r7684 - in branches:
	avidemux_2.5_branch_gruntster/cmake avidemux_2.6_branch_mean/cmake
Message-ID: <20111202191651.4C9564815BF@sheep.berlios.de>

Author: gruntster
Date: 2011-12-02 20:16:50 +0100 (Fri, 02 Dec 2011)
New Revision: 7684

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/ADM_coreConfig.h.cmake
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
Log:
[mingw] remove ftello and fseeko constants since they've been defined in mingw-w64 for over 9 months now and cause conflict

Modified: branches/avidemux_2.5_branch_gruntster/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/ADM_coreConfig.h.cmake	2011-12-02 18:28:43 UTC (rev 7683)
+++ branches/avidemux_2.5_branch_gruntster/cmake/ADM_coreConfig.h.cmake	2011-12-02 19:16:50 UTC (rev 7684)
@@ -31,8 +31,6 @@
 #ifdef __MINGW32__
 #define rindex strrchr
 #define index strchr
-#define ftello ftello64
-#define fseeko fseeko64
 #endif
 
 #endif
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-02 18:28:43 UTC (rev 7683)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-02 19:16:50 UTC (rev 7684)
@@ -37,8 +37,6 @@
 #ifdef __MINGW32__
 #define rindex strrchr
 #define index strchr
-#define ftello ftello64
-#define fseeko fseeko64
 #endif
 
 #endif



From gruntster at mail.berlios.de  Fri Dec  2 20:33:33 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri,  2 Dec 2011 20:33:33 +0100
Subject: [Avidemux-svn-commit] r7685 - in branches:
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis
	avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux
	avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig
	avidemux_2.6_branch_mean/foreignBuilds/mswin/lame
	avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis
	avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx
Message-ID: <20111202193334.146064815BF@sheep.berlios.de>

Author: gruntster
Date: 2011-12-02 20:33:33 +0100 (Fri, 02 Dec 2011)
New Revision: 7685

Removed:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch
Log:
[mswin] update build scripts to work with latest binutils

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -21,7 +21,7 @@
 set SDLDIR=%usrLocalDir%
 set CFLAGS=%CFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
 set CXXFLAGS=%CXXFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
-set LDFLAGS=%LDFLAGS% -s -shared-libgcc -shared-libstdc++ -L%CMAKE_LIBRARY_PATH%
+set LDFLAGS=%LDFLAGS% -shared-libgcc -shared-libstdc++ -L%CMAKE_LIBRARY_PATH%
 set RC=windres -F pe-i386
 set admBuildDir=%devDir%\avidemux_2.5_build%BuildBits%
 set admSdkBuildDir=%devDir%\avidemux_2.5_build%BuildBits%_sdk

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,5 +1,12 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="7664" date="2011-11-16" />
+  <buildentry revision="7662" date="2011-11-13" />
+  <buildentry revision="7257 [2.5.5 Final]" date="2011-11-06" />
+  <buildentry revision="7643" date="2011-11-01">
+    <comment>Updated LAME to version 3.99.</comment>
+    <comment>Updated x264 to r2106.</comment>
+  </buildentry>
   <buildentry revision="7609" date="2011-10-12" />
   <buildentry revision="7573" date="2011-09-22">
     <comment>Updated x264 to r2085.</comment>

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -51,12 +51,6 @@
 echo Configuring
 sh ./configure --prefix="%usrLocalDir%" --disable-static
 
-if "%BuildBits%" == "64" (
-	echo.
-	echo Patching
-	patch -p0 -i "%curDir%\libtool.patch"
-)
-
 if errorlevel 1 goto end
 echo.
 pause

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,11 +0,0 @@
---- libtool.orig	2010-11-27 22:40:35 +0000
-+++ libtool	2010-11-27 22:52:21 +0000
-@@ -117,7 +117,7 @@
- reload_cmds="\$LD\$reload_flag -o \$output\$reload_objs"
- 
- # Method to check whether dependent libraries are shared objects.
--deplibs_check_method="file_magic file format pei*-i386(.*architecture: i386)?"
-+deplibs_check_method="file_magic file format pei*-x86-64(.*architecture: i386)?"
- 
- # Command to use when deplibs_check_method == "file_magic".
- file_magic_cmd="\$OBJDUMP -f"

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -54,7 +54,7 @@
 
 echo.
 echo Configuring
-set CFLAGS=%CFLAGS% -O2
+set CFLAGS=%CFLAGS% -O3
 
 if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%" --disable-static --enable-nasm
 if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --disable-static

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -52,10 +52,6 @@
 
 sh ./configure --prefix="%usrLocalDir%" --disable-static --disable-examples --disable-docs
 
-echo.
-echo Patching
-patch -p0 -i "%curDir%\libtool.patch"
-
 if errorlevel 1 goto end
 echo.
 pause

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,24 +0,0 @@
---- libtool.orig	2010-11-27 19:32:53 +0000
-+++ libtool	2010-11-27 19:33:08 +0000
-@@ -6446,8 +6446,8 @@
- 		esac
- 		else
- 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
--		  test -z "$libdir" && \
--		    func_fatal_error "\`$deplib' is not a valid libtool archive"
-+		  #test -z "$libdir" && \
-+		    #func_fatal_error "\`$deplib' is not a valid libtool archive"
- 		  test "$absdir" != "$libdir" && \
- 		    func_warning "\`$deplib' seems to be moved"
- 
-@@ -8570,8 +8570,8 @@
- 		func_basename "$deplib"
- 		name="$func_basename_result"
- 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
--		test -z "$libdir" && \
--		  func_fatal_error "\`$deplib' is not a valid libtool archive"
-+		#test -z "$libdir" && \
-+		  #func_fatal_error "\`$deplib' is not a valid libtool archive"
- 		newdependency_libs="$newdependency_libs $libdir/$name"
- 		;;
- 	      *) newdependency_libs="$newdependency_libs $deplib" ;;

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,5 +1,11 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="7660" date="2011-11-17" />
+  <buildentry revision="7652" date="2011-11-06" />
+  <buildentry revision="7643" date="2011-11-01">
+    <comment>Updated LAME to version 3.99.</comment>
+    <comment>Updated x264 to r2106.</comment>
+  </buildentry>
   <buildentry revision="7604" date="2011-10-11" />
   <buildentry revision="7590" date="2011-09-28" />
   <buildentry revision="7573" date="2011-09-22">

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -51,12 +51,6 @@
 echo Configuring
 sh ./configure --prefix="%usrLocalDir%" --disable-static
 
-if "%BuildBits%" == "64" (
-	echo.
-	echo Patching
-	patch -p0 -i "%curDir%\libtool.patch"
-)
-
 if errorlevel 1 goto end
 echo.
 pause

Deleted: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,11 +0,0 @@
---- libtool.orig	2010-11-27 22:40:35 +0000
-+++ libtool	2010-11-27 22:52:21 +0000
-@@ -117,7 +117,7 @@
- reload_cmds="\$LD\$reload_flag -o \$output\$reload_objs"
- 
- # Method to check whether dependent libraries are shared objects.
--deplibs_check_method="file_magic file format pei*-i386(.*architecture: i386)?"
-+deplibs_check_method="file_magic file format pei*-x86-64(.*architecture: i386)?"
- 
- # Command to use when deplibs_check_method == "file_magic".
- file_magic_cmd="\$OBJDUMP -f"

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -54,7 +54,7 @@
 
 echo.
 echo Configuring
-set CFLAGS=%CFLAGS% -O2
+set CFLAGS=%CFLAGS% -O3
 
 if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%" --disable-static --enable-nasm
 if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --disable-static

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat	2011-12-02 19:33:33 UTC (rev 7685)
@@ -52,10 +52,6 @@
 
 sh ./configure --prefix="%usrLocalDir%" --disable-static --disable-examples --disable-docs
 
-echo.
-echo Patching
-patch -p0 -i "%curDir%\libtool.patch"
-
 if errorlevel 1 goto end
 echo.
 pause

Deleted: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,24 +0,0 @@
---- libtool.orig	2010-11-27 19:32:53 +0000
-+++ libtool	2010-11-27 19:33:08 +0000
-@@ -6446,8 +6446,8 @@
- 		esac
- 		else
- 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
--		  test -z "$libdir" && \
--		    func_fatal_error "\`$deplib' is not a valid libtool archive"
-+		  #test -z "$libdir" && \
-+		    #func_fatal_error "\`$deplib' is not a valid libtool archive"
- 		  test "$absdir" != "$libdir" && \
- 		    func_warning "\`$deplib' seems to be moved"
- 
-@@ -8570,8 +8570,8 @@
- 		func_basename "$deplib"
- 		name="$func_basename_result"
- 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
--		test -z "$libdir" && \
--		  func_fatal_error "\`$deplib' is not a valid libtool archive"
-+		#test -z "$libdir" && \
-+		  #func_fatal_error "\`$deplib' is not a valid libtool archive"
- 		newdependency_libs="$newdependency_libs $libdir/$name"
- 		;;
- 	      *) newdependency_libs="$newdependency_libs $deplib" ;;

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch	2011-12-02 19:16:50 UTC (rev 7684)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch	2011-12-02 19:33:33 UTC (rev 7685)
@@ -1,6 +1,6 @@
---- build/make/configure.sh.orig	2010-10-28 14:14:14 +0100
-+++ build/make/configure.sh	2010-11-27 11:45:42 +0000
-@@ -877,8 +877,12 @@
+--- build/make/configure.sh.old	2011-05-08 01:11:53 +0100
++++ build/make/configure.sh	2011-05-08 01:16:09 +0100
+@@ -900,8 +900,12 @@
          [ "${AS##*/}" = nasm ] && add_asflags -Ox
          AS_SFX=.asm
          case  ${tgt_os} in
@@ -8,10 +8,10 @@
 -                add_asflags -f win${bits}
 +            win32)
 +                add_asflags -f win32
-+                enabled debug && add_asflags -g dwarf2
++                enabled debug && add_asflags -g cv8
 +            ;;
-+			win64)
++            win64)
 +                add_asflags -f x64
-                 enabled debug && add_asflags -g dwarf2
+                 enabled debug && add_asflags -g cv8
              ;;
              linux*|solaris*)



From mean at mail.berlios.de  Sat Dec  3 09:21:37 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Dec 2011 09:21:37 +0100
Subject: [Avidemux-svn-commit] r7686 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20111203082137.42AB0482569@sheep.berlios.de>

Author: mean
Date: 2011-12-03 09:21:36 +0100 (Sat, 03 Dec 2011)
New Revision: 7686

Modified:
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
Log:
[build] merge ftello stuff

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-02 19:33:33 UTC (rev 7685)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-03 08:21:36 UTC (rev 7686)
@@ -37,6 +37,10 @@
 #ifdef __MINGW32__
 #define rindex strrchr
 #define index strchr
+#ifdef CROSS_COMPILE
+        #define ftello ftello64 // not defined on every mingw64_w32 version (e.g. set 2011-11-03 does not have it)
+        #define fseeko fseeko64
+#endif // CROSS_COMPILE
 #endif
 
 #endif



From mean at mail.berlios.de  Sat Dec  3 09:41:44 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Dec 2011 09:41:44 +0100
Subject: [Avidemux-svn-commit] r7687 - in branches/avidemux_2.6_branch_mean:
	avidemux_core/ADM_smjs cmake
Message-ID: <20111203084144.B8843482569@sheep.berlios.de>

Author: mean
Date: 2011-12-03 09:41:44 +0100 (Sat, 03 Dec 2011)
New Revision: 7687

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c
   branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
Log:
[build] Add -DCROSS_COMPILE, see ftello/seeko stuff

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c	2011-12-03 08:21:36 UTC (rev 7686)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c	2011-12-03 08:41:44 UTC (rev 7687)
@@ -43,7 +43,7 @@
  */
 #include <stdio.h>
 #include <stdlib.h>
-
+#undef CROSS_COMPILE // MEANX
 #ifdef CROSS_COMPILE
 #include <prtypes.h>
 #define INT64 PRInt64

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-12-03 08:21:36 UTC (rev 7686)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-12-03 08:41:44 UTC (rev 7687)
@@ -1,3 +1,10 @@
+#
+#
+#
+IF(CROSS)
+        ADD_DEFINITIONS("-DCROSS_COMPILE")
+ENDIF(CROSS)
+
 ########################################
 # pkg-config
 ########################################



From mean at mail.berlios.de  Sat Dec  3 12:27:32 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  3 Dec 2011 12:27:32 +0100
Subject: [Avidemux-svn-commit] r7688 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs
Message-ID: <20111203112732.69075482569@sheep.berlios.de>

Author: mean
Date: 2011-12-03 12:27:31 +0100 (Sat, 03 Dec 2011)
New Revision: 7688

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jstypes.h
Log:
[smjs] smjs is also using CROSS_COMPILE

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c	2011-12-03 08:41:44 UTC (rev 7687)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jscpucfg.c	2011-12-03 11:27:31 UTC (rev 7688)
@@ -43,8 +43,7 @@
  */
 #include <stdio.h>
 #include <stdlib.h>
-#undef CROSS_COMPILE // MEANX
-#ifdef CROSS_COMPILE
+#ifdef CROSS_COMPILE_x
 #include <prtypes.h>
 #define INT64 PRInt64
 #else
@@ -182,7 +181,7 @@
 
     printf("/* AUTOMATICALLY GENERATED - DO NOT EDIT */\n\n");
 
-#ifdef CROSS_COMPILE
+#ifdef CROSS_COMPILE_x
 #if defined(IS_LITTLE_ENDIAN)
     printf("#define IS_LITTLE_ENDIAN 1\n");
     printf("#undef  IS_BIG_ENDIAN\n\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jstypes.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jstypes.h	2011-12-03 08:41:44 UTC (rev 7687)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_smjs/jstypes.h	2011-12-03 11:27:31 UTC (rev 7688)
@@ -239,9 +239,10 @@
 #define JS_MIN(x,y)     ((x)<(y)?(x):(y))
 #define JS_MAX(x,y)     ((x)>(y)?(x):(y))
 
-#if (defined(XP_WIN) && !defined(CROSS_COMPILE)) || defined (WINCE)
+//#if (defined(XP_WIN) && !defined(CROSS_COMPILE)) || defined (WINCE) // MEANX
+#if defined(XP_WIN)  || defined (WINCE)
 #    include "jscpucfg.h"        /* Use standard Mac or Windows configuration */
-#elif defined(XP_UNIX) || defined(XP_BEOS) || defined(XP_OS2) || defined(CROSS_COMPILE)
+#elif defined(XP_UNIX) || defined(XP_BEOS) || defined(XP_OS2) // MEANX || defined(CROSS_COMPILE)
 #    include "jsautocfg.h"       /* Use auto-detected configuration */
 #    include "jsosdep.h"         /* ...and platform-specific flags */
 #else



From gruntster at mail.berlios.de  Sun Dec  4 14:48:20 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun,  4 Dec 2011 14:48:20 +0100
Subject: [Avidemux-svn-commit] r7689 - in branches:
	avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
	avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <20111204134820.ED89948256E@sheep.berlios.de>

Author: gruntster
Date: 2011-12-04 14:48:20 +0100 (Sun, 04 Dec 2011)
New Revision: 7689

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_qtGlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
Log:
[opengl] realign the runtime stack of paint function so it operates on 32-bit

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_qtGlRender.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_qtGlRender.h	2011-12-03 11:27:31 UTC (rev 7688)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_qtGlRender.h	2011-12-04 13:48:20 UTC (rev 7689)
@@ -38,7 +38,7 @@
 
 protected:
 	void initializeGL();
-	void paintGL();
+	void paintGL() __attribute__((force_align_arg_pointer));
 
 public:
 	QtGlAccelWidget(QWidget *parent, int widgetWidth, int widgetHeight);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-12-03 11:27:31 UTC (rev 7688)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_qtGlRender.h	2011-12-04 13:48:20 UTC (rev 7689)
@@ -19,19 +19,19 @@
 #include "GUI_render.h"
 #include "GUI_accelRender.h"
 #include "ADM_colorspace.h"
-/**
-    \class QtGlAccelWidget
+/**
+    \class QtGlAccelWidget
 */
 class QtGlAccelWidget : public QGLWidget
 {
 private:
-	int             imageWidth, imageHeight;
+	int             imageWidth, imageHeight;
     int             displayWidth,displayHeight;
-	bool            firstRun;
+	bool            firstRun;
     
 
 	QGLShaderProgram *glProgram;
-	GLsizei textureRealWidths[3];
+	GLsizei textureRealWidths[3];
     GLsizei textureStrides[3];
 	GLsizei textureHeights[3];
 	uint8_t *textureOffsets[3];
@@ -39,34 +39,34 @@
 
 protected:
 	void initializeGL();
-	void paintGL();
+	void paintGL() __attribute__((force_align_arg_pointer));
     void updateTexture(void);
 
 public:
-	QtGlAccelWidget(QWidget *parent, int imagew, int imageh);
+	QtGlAccelWidget(QWidget *parent, int imagew, int imageh);
     ~QtGlAccelWidget();
-	bool setImage(ADMImage *pic);
+	bool setImage(ADMImage *pic);
     bool setDisplaySize(int width,int height);
 };
 
-/**
-    \fn class QtGlRender
-*/
-class QtGlRender: public VideoRenderBase
-{
-      protected:
-                            
-                            GUI_WindowInfo  info;
-                            QtGlAccelWidget *glWidget;
-      public:
-                             QtGlRender( void ) ;
-              virtual        ~QtGlRender();
-              virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
-              virtual	bool stop(void);				
-              virtual   bool displayImage(ADMImage *pic);
-              virtual   bool changeZoom(renderZoom newzoom);
-              virtual   bool refresh(void);
-              virtual   bool usingUIRedraw(void) {return false;}; // We can! redraw by ourself
-};
+/**
+    \fn class QtGlRender
+*/
+class QtGlRender: public VideoRenderBase
+{
+      protected:
+                            
+                            GUI_WindowInfo  info;
+                            QtGlAccelWidget *glWidget;
+      public:
+                             QtGlRender( void ) ;
+              virtual        ~QtGlRender();
+              virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
+              virtual	bool stop(void);				
+              virtual   bool displayImage(ADMImage *pic);
+              virtual   bool changeZoom(renderZoom newzoom);
+              virtual   bool refresh(void);
+              virtual   bool usingUIRedraw(void) {return false;}; // We can! redraw by ourself
+};
 
 #endif



From mean at mail.berlios.de  Mon Dec  5 07:56:38 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon,  5 Dec 2011 07:56:38 +0100
Subject: [Avidemux-svn-commit] r7690 - in branches/avidemux_2.6_branch_mean:
	avidemux_core cmake cmake_compile_check
Message-ID: <20111205065638.BD9B3481219@sheep.berlios.de>

Author: mean
Date: 2011-12-05 07:56:38 +0100 (Mon, 05 Dec 2011)
New Revision: 7690

Added:
   branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake
   branches/avidemux_2.6_branch_mean/cmake_compile_check/ftello.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
Log:
[core] Check if ftello is present (win32), use ftello64 if not

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-12-04 13:48:20 UTC (rev 7689)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-12-05 06:56:38 UTC (rev 7690)
@@ -21,6 +21,7 @@
 
 ADD_DEFINITIONS(-D_FILE_OFFSET_BITS=64 -D_LARGE_FILES)
 include(admMainChecks)
+include(admCheckFtello)
 include(admAsNeeded)
 ########################################
 # VDPAU
@@ -36,8 +37,12 @@
 	INCLUDE(adm_log)
 	MESSAGE("")
 ENDIF (VERBOSE)
-
 ########################################
+# Checking if we should use ftello
+# or ftello64 (win32)
+########################################
+checkFtello()
+########################################
 # Generate config.h
 ########################################
 CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/ADM_coreConfig.h.cmake" "${CMAKE_BINARY_DIR}/config/ADM_coreConfig.h")

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-04 13:48:20 UTC (rev 7689)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2011-12-05 06:56:38 UTC (rev 7690)
@@ -37,10 +37,10 @@
 #ifdef __MINGW32__
 #define rindex strrchr
 #define index strchr
-#ifdef CROSS_COMPILE
+#if !${USE_FTELLO}
         #define ftello ftello64 // not defined on every mingw64_w32 version (e.g. set 2011-11-03 does not have it)
         #define fseeko fseeko64
-#endif // CROSS_COMPILE
+#endif // FTELLO
 #endif
 
 #endif

Added: branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake	2011-12-05 06:56:38 UTC (rev 7690)
@@ -0,0 +1,21 @@
+MACRO(checkFtello)
+	IF (NOT FTELLO_CHECKED)
+		OPTION(FTELLO "" ON)
+
+		MESSAGE(STATUS "Checking for ftello ")
+		MESSAGE(STATUS "********************")
+
+		IF (FTELLO)
+                        ADM_COMPILE(ftello.cpp "" "" "" GOT_FTELLO outputWithoutLibintl)
+
+                        IF (GOT_FTELLO)
+                                SET(USE_FTELLO 1)
+                                MESSAGE(STATUS "ftello present")
+                        ENDIF (GOT_FTELLO)
+		ELSE (FTELLO)
+			MESSAGE("${MSG_DISABLE_OPTION}")
+		ENDIF (FTELLO)
+		SET(FTELLO_CHECKED 1)
+		MESSAGE("")
+	ENDIF (NOT FTELLO_CHECKED)
+ENDMACRO(checkFtello)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-12-04 13:48:20 UTC (rev 7689)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2011-12-05 06:56:38 UTC (rev 7690)
@@ -1,10 +1,6 @@
 #
 #
 #
-IF(CROSS)
-        ADD_DEFINITIONS("-DCROSS_COMPILE")
-ENDIF(CROSS)
-
 ########################################
 # pkg-config
 ########################################

Added: branches/avidemux_2.6_branch_mean/cmake_compile_check/ftello.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake_compile_check/ftello.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake_compile_check/ftello.cpp	2011-12-05 06:56:38 UTC (rev 7690)
@@ -0,0 +1,10 @@
+#include <stdint.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+int main(int argc, char **argv)
+{
+        FILE *handle=NULL;
+        uint64_t offset=ftello(handle);
+        return 0;
+}



From mean at mail.berlios.de  Mon Dec  5 08:03:41 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon,  5 Dec 2011 08:03:41 +0100
Subject: [Avidemux-svn-commit] r7691 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20111205070341.579CC481219@sheep.berlios.de>

Author: mean
Date: 2011-12-05 08:03:40 +0100 (Mon, 05 Dec 2011)
New Revision: 7691

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake
Log:
[core] fix ftello define

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake	2011-12-05 06:56:38 UTC (rev 7690)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckFtello.cmake	2011-12-05 07:03:40 UTC (rev 7691)
@@ -11,6 +11,9 @@
                         IF (GOT_FTELLO)
                                 SET(USE_FTELLO 1)
                                 MESSAGE(STATUS "ftello present")
+                        ELSE (GOT_FTELLO)
+                                SET(USE_FTELLO 0)
+                                MESSAGE(STATUS "ftello NOT present")
                         ENDIF (GOT_FTELLO)
 		ELSE (FTELLO)
 			MESSAGE("${MSG_DISABLE_OPTION}")



From gruntster at mail.berlios.de  Mon Dec  5 22:11:16 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon,  5 Dec 2011 22:11:16 +0100
Subject: [Avidemux-svn-commit] r7692 - in branches:
	avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter
	avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/include
Message-ID: <20111205211116.A98B8481219@sheep.berlios.de>

Author: gruntster
Date: 2011-12-05 22:11:16 +0100 (Mon, 05 Dec 2011)
New Revision: 7692

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audio_encoderWrapper.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/include/audiofilter_access.h
Log:
[audioencoder] stack isn't aligned properly on x86 systems supporting SSE2 when -ftree-vectorize (i.e. -O3) is used.  This fix aligns the stack of the audio encoder.  It should perform better than compiling everything with -mstackrealign.  Hopefully crashes on Windows XP 32-bit should now be resolved properly.

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audio_encoderWrapper.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audio_encoderWrapper.h	2011-12-05 07:03:40 UTC (rev 7691)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audio_encoderWrapper.h	2011-12-05 21:11:16 UTC (rev 7692)
@@ -14,13 +14,13 @@
 public:
                             ADM_audioEncoderWrapper( AUDMEncoder *coder);
         virtual             ~ADM_audioEncoderWrapper();
-        virtual	uint8_t		getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+        virtual	uint8_t		getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples) __attribute__((force_align_arg_pointer));
 		virtual uint8_t     packetPerFrame( void);
 
         virtual uint8_t		goTo(uint32_t offset) {ADM_assert(0);return 0;} // Not supposed to seek..
         virtual uint32_t	read(uint32_t size,uint8_t *ptr);
         virtual uint8_t		extraData(uint32_t *l,uint8_t **d);
-        virtual uint8_t  	isVBR(void ) ;
+        virtual uint8_t  	isVBR(void );
 };
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/include/audiofilter_access.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/include/audiofilter_access.h	2011-12-05 07:03:40 UTC (rev 7691)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/include/audiofilter_access.h	2011-12-05 21:11:16 UTC (rev 7692)
@@ -49,7 +49,7 @@
                                     /// Grab extra data
                 virtual bool      getExtraData(uint32_t *l, uint8_t **d);
 
-                virtual bool    getPacket(uint8_t *buffer, uint32_t *size, uint32_t maxSize,uint64_t *dts);
+                virtual bool    getPacket(uint8_t *buffer, uint32_t *size, uint32_t maxSize,uint64_t *dts) __attribute__((force_align_arg_pointer));
                 virtual bool    isCBR(void);
 };
 



From gruntster at mail.berlios.de  Mon Dec  5 22:47:16 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon,  5 Dec 2011 22:47:16 +0100
Subject: [Avidemux-svn-commit] r7693 - in branches:
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig
	avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js
	avidemux_2.6_branch_mean/foreignBuilds/mswin
	avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux
	avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig
	avidemux_2.6_branch_mean/foreignBuilds/mswin/js
Message-ID: <20111205214716.C37F9481219@sheep.berlios.de>

Author: gruntster
Date: 2011-12-05 22:47:16 +0100 (Mon, 05 Dec 2011)
New Revision: 7693

Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat
Log:
[mswin] update build scripts to make life a bit easier

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -59,6 +59,7 @@
 if errorlevel 1 goto end
 
 del "%usrLocalDir%\etc\fonts\fonts.conf.bak"
+strip "%usrLocalDir%\bin\libfontconfig-1.dll"
 copy "%usrLocalDir%\bin\libfontconfig-1.dll" "%admBuildDir%"
 xcopy /s/y "%usrLocalDir%\etc\fonts\*.*" "%admBuildDir%\etc\fonts\"
 

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -66,6 +66,7 @@
 if errorlevel 1 goto end
 echo.
 
+strip "WINNT6.1_OPT.OBJ\libjs.dll"
 copy "WINNT6.1_OPT.OBJ\libjs.dll" "%usrLocalDir%\bin"
 copy "%usrLocalDir%\bin\libjs.dll" "%admBuildDir%"
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -31,9 +31,6 @@
 	set LDFLAGS=%LDFLAGS% -m32
 )
 
-if "%DebugFlags%" == "" set LDFLAGS=%LDFLAGS% -s
-
-
 if exist "%qtDir%" (
 	for /f %%d in ('dir /b /ad /on %qtDir%') do set qtVer=%%d
 ) else (

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -2,7 +2,7 @@
 
 rem ## Core ##
 cd "%sourceDir%\%buildCoreFolder%"
-cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DBASH_DIR="%msysDir%\bin" %DebugFlags% ../../avidemux_core
+cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DBASH_DIR="%msysDir%\bin" %DebugFlags% -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" ../../avidemux_core
 
 if errorlevel 1 goto error
 if "%BuildGenerator%" == "CodeBlocks - MinGW Makefiles" copy "%curDir%\Tools\avidemux.layout" admCore.layout
@@ -13,7 +13,7 @@
 
 rem ## Qt4 ##
 cd "%sourceDir%\%buildQtFolder%"
-cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% ../../avidemux/qt4
+cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" ../../avidemux/qt4
 
 if errorlevel 1 goto error
 if "%BuildGenerator%" == "CodeBlocks - MinGW Makefiles" (
@@ -21,31 +21,22 @@
 	patch -p0 -i "%curDir%\Tools\Avidemux_qt4.cbp.patch"	)
 pause
 
-mingw32-make install
-if errorlevel 1 goto error
-
 rem ## CLI ##
 cd "%sourceDir%\%buildCliFolder%"
-cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% ../../avidemux/cli
+cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" ../../avidemux/cli
 
 if errorlevel 1 goto error
 if "%BuildGenerator%" == "CodeBlocks - MinGW Makefiles" copy "%curDir%\Tools\avidemux.layout" Avidemux_cli.layout
 pause
 
-mingw32-make install
-if errorlevel 1 goto error
-
 rem ## GTK ##
-cd "%sourceDir%\%buildGtkFolder%"
-rem cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% ../../avidemux/gtk
+rem cd "%sourceDir%\%buildGtkFolder%"
+rem cmake -G"%BuildGenerator%" -DCMAKE_INSTALL_PREFIX="%buildDir%" %DebugFlags% -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" ../../avidemux/gtk
 
-if errorlevel 1 goto error
+rem if errorlevel 1 goto error
 rem if "%BuildGenerator%" == "CodeBlocks - MinGW Makefiles" copy "%curDir%\Tools\avidemux.layout" Avidemux_gtk.layout
 rem pause
 
-rem mingw32-make install
-if errorlevel 1 goto error
-
 rem ## Plugins ##
 set msysSourceDir=%sourceDir:\=/%
 cd "%sourceDir%\%buildPluginFolder%"
@@ -55,6 +46,23 @@
 if "%BuildGenerator%" == "CodeBlocks - MinGW Makefiles" copy "%curDir%\Tools\avidemux.layout" "%sourceDir%\%buildPluginFolder%\AdmPlugins.layout"
 pause
 
+rem ## Qt4 ##
+cd "%sourceDir%\%buildQtFolder%"
+mingw32-make install
+if errorlevel 1 goto error
+
+rem ## CLI ##
+cd "%sourceDir%\%buildCliFolder%"
+mingw32-make install
+if errorlevel 1 goto error
+
+rem ## GTK ##
+rem cd "%sourceDir%\%buildGtkFolder%"
+rem mingw32-make install
+rem if errorlevel 1 goto error
+
+rem ## Plugins ##
+cd "%sourceDir%\%buildPluginFolder%"
 rmdir /s /q "%buildDir%\plugins" 2> NUL
 mingw32-make install
 if errorlevel 1 goto error

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -59,6 +59,7 @@
 if errorlevel 1 goto end
 
 del "%usrLocalDir%\etc\fonts\fonts.conf.bak"
+strip "%usrLocalDir%\bin\libfontconfig-1.dll"
 copy "%usrLocalDir%\bin\libfontconfig-1.dll" "%admBuildDir%"
 xcopy /s/y "%usrLocalDir%\etc\fonts\*.*" "%admBuildDir%\etc\fonts\"
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat	2011-12-05 21:11:16 UTC (rev 7692)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat	2011-12-05 21:47:16 UTC (rev 7693)
@@ -66,6 +66,7 @@
 if errorlevel 1 goto end
 echo.
 
+strip "WINNT6.1_OPT.OBJ\libjs.dll"
 copy "WINNT6.1_OPT.OBJ\libjs.dll" "%usrLocalDir%\bin"
 copy "%usrLocalDir%\bin\libjs.dll" "%admBuildDir%"
 



From gruntster at mail.berlios.de  Mon Dec  5 22:49:51 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon,  5 Dec 2011 22:49:51 +0100
Subject: [Avidemux-svn-commit] r7694 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <20111205214951.3FF2E481219@sheep.berlios.de>

Author: gruntster
Date: 2011-12-05 22:49:50 +0100 (Mon, 05 Dec 2011)
New Revision: 7694

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
Log:
[mswin] add library dependency to support r7605 properly

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2011-12-05 21:47:16 UTC (rev 7693)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
@@ -24,3 +24,4 @@
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/../ADM_gui")
 INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/avidemux/ADM_UIs/ADM_QT4/include")
 ADD_ADM_LIB_QT4_TARGET(${ADM_LIB} ${${ADM_LIB}_SRCS})
+add_dependencies(${ADM_LIB}_qt4 ADM_guiQt4_qt4)



From gruntster at mail.berlios.de  Sun Dec 11 16:42:34 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Dec 2011 16:42:34 +0100
Subject: [Avidemux-svn-commit] r7695 - in branches/avidemux_2.6_branch_mean:
	avidemux avidemux/cli avidemux/gtk avidemux/qt4 avidemux_core
	avidemux_plugins avidemux_plugins/ADM_audioDecoders
	avidemux_plugins/ADM_audioDevices
	avidemux_plugins/ADM_audioEncoders cmake
Message-ID: <20111211154234.67F64482844@sheep.berlios.de>

Author: gruntster
Date: 2011-12-11 16:42:33 +0100 (Sun, 11 Dec 2011)
New Revision: 7695

Removed:
   branches/avidemux_2.6_branch_mean/cmake/admCheckAmrnb.cmake
   branches/avidemux_2.6_branch_mean/cmake/admPluginConfigSummary.cmake
   branches/avidemux_2.6_branch_mean/cmake/admSummary.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckFaad.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckFontConfig.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckFreeType.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckGettext.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckOpencore.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckVorbisDec.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckVpx.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckX264.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCheckXvid.cmake
   branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
   branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
Log:
[cmake] dynamically build summary of optional libraries and present it at end of configuration rather than interspersed and hard-coded

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -118,7 +118,6 @@
 endif (WIN32 OR APPLE)
 
 IF (WIN32)
-	target_link_libraries(ADM_osSupport)
 	target_link_libraries(avidemux3_cli winmm -mwindows -Wl,-subsystem,console -Wl,--export-all-symbols)
 ENDIF (WIN32)
 
@@ -127,9 +126,10 @@
 ###########################################
 ADM_LINK_THREAD(avidemux3_cli)
 ADM_INSTALL_BIN(avidemux3_cli)
-INSTALL(FILES ${CMAKE_BINARY_DIR}/config/cli/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/cli") 
-#
-# Packaging
-#
+
+DISPLAY_SUMMARY_LIST()
+
 include(admPackager)
 admPackager(cliPackage)
+INSTALL(FILES ${CMAKE_BINARY_DIR}/config/cli/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/cli") 
+MESSAGE("")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -7,12 +7,15 @@
 
 SET(CMAKE_MODULE_PATH "${AVIDEMUX_TOP_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")
 
-IF (WIN32)
-	SET(ADM_PLUGIN_DIR "plugins")
-ELSE (WIN32)
-	SET(ADM_PLUGIN_DIR "ADM_plugins6")
+IF (WIN32)
+	SET(ADM_PLUGIN_DIR "plugins")
+ELSE (WIN32)
+	SET(ADM_PLUGIN_DIR "ADM_plugins6")
 ENDIF (WIN32)
 
+include(admConfigSummary)
+INITIALISE_SUMMARY_LISTS()
+
 ########################################
 # Shared cmake part
 ########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -132,7 +132,6 @@
 endif (WIN32 OR APPLE)
 
 IF (WIN32)
-	target_link_libraries(ADM_osSupport)
 	target_link_libraries(avidemux3_gtk winmm -mwindows -Wl,--export-all-symbols)
 ENDIF (WIN32)
 
@@ -141,9 +140,10 @@
 ###########################################
 ADM_LINK_THREAD(avidemux3_gtk)
 ADM_INSTALL_BIN(avidemux3_gtk)
-INSTALL(FILES ${CMAKE_BINARY_DIR}/config/gtk/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/gtk") 
-#
-# Packaging
-#
+
+DISPLAY_SUMMARY_LIST()
+
 include(admPackager)
 admPackager(gtkPackage)
+INSTALL(FILES ${CMAKE_BINARY_DIR}/config/gtk/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/gtk") 
+MESSAGE("")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -192,10 +192,10 @@
 ###########################################
 ADM_LINK_THREAD(avidemux3_qt4)
 ADM_INSTALL_BIN(avidemux3_qt4)
-INSTALL(FILES ${CMAKE_BINARY_DIR}/config/qt4/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/qt4") 
-#
-# Packaging
-#
+
+DISPLAY_SUMMARY_LIST()
+
 include(admPackager)
 admPackager(qt4Package)
-include(admConfigSummary)
+INSTALL(FILES ${CMAKE_BINARY_DIR}/config/qt4/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/qt4") 
+MESSAGE("")

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -20,9 +20,14 @@
 ENDIF (WIN32)
 
 ADD_DEFINITIONS(-D_FILE_OFFSET_BITS=64 -D_LARGE_FILES)
+
+include(admConfigSummary)
+INITIALISE_SUMMARY_LISTS()
+
 include(admMainChecks)
 include(admCheckFtello)
 include(admAsNeeded)
+
 ########################################
 # VDPAU
 ########################################
@@ -98,10 +103,8 @@
 ########################################
 # Config Summary
 ########################################
-INCLUDE(admConfigSummary)
-#
-# Packaging
-#
+DISPLAY_SUMMARY_LIST()
+
 include(admPackager)
 admPackager(corePackage)
 INSTALL(FILES ${CMAKE_BINARY_DIR}/config/ADM_coreConfig.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6") 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,22 +1,12 @@
-include(admSummary)
 ADD_SUBDIRECTORY(ADM_ad_ac3)
 ADD_SUBDIRECTORY(ADM_ad_faad)
 ADD_SUBDIRECTORY(ADM_ad_mad)
 ADD_SUBDIRECTORY(ADM_ad_vorbis)
 ADD_SUBDIRECTORY(ADM_ad_dca)
-ADD_SUBDIRECTORY(ADM_ad_amrnb)
+#ADD_SUBDIRECTORY(ADM_ad_amrnb)
 ADD_SUBDIRECTORY(ADM_ad_lav)
 ADD_SUBDIRECTORY(ADM_ad_ulaw)
 ADD_SUBDIRECTORY(ADM_ad_ms_adpcm)
 ADD_SUBDIRECTORY(ADM_ad_ima_adpcm)
 ADD_SUBDIRECTORY(ADM_ad_opencore_amrwb)
-ADD_SUBDIRECTORY(ADM_ad_opencore_amrnb)
-MESSAGE(STATUS "***  Audio Decoder ***")
-ADM_DISPLAY("FAAD      " "${USE_FAAD}")
-ADM_DISPLAY("Vorbis    " "${USE_LIBVORBIS}")
-ADM_DISPLAY("FAAC      " "${USE_FAAC}")
-ADM_DISPLAY("OpenAMR-NB" "${OPENCORE_AMRNB_FOUND}")
-ADM_DISPLAY("DCA       " "${LIBDCA_FOUND}")
-MESSAGE(STATUS "***  /Audio Decoder  ***")
-
-
+ADD_SUBDIRECTORY(ADM_ad_opencore_amrnb)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,5 +1,5 @@
 include(admCheckAudioDeviceLibs)
-include(admSummary)
+
 if(USE_ALSA)
 ADD_SUBDIRECTORY(Alsa)
 endif(USE_ALSA)
@@ -31,17 +31,3 @@
 if(WIN32)
 ADD_SUBDIRECTORY(Win32)
 endif(WIN32)
-
-MESSAGE("***  Audio Devices ***")
-ADM_DISPLAY("SDL      " "${USE_SDL}")
-ADM_DISPLAY("Pulse    " "${USE_PULSE_SIMPLE}")
-ADM_DISPLAY("ESD      " "${USE_ESD}")
-ADM_DISPLAY("OSS      " "${USE_OSS}")
-ADM_DISPLAY("Alsa     " "${USE_ALSA}")
-ADM_DISPLAY("Jack     " "${USE_JACK}")
-if(WIN32)
-ADM_DISPLAY("Win32    " "1")
-endif(WIN32)
-MESSAGE("***  /Audio Devices  ***")
-
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,4 +1,3 @@
-#######################################
 include (admCheckAudioEncoderLibs)
 ADD_SUBDIRECTORY(twolame)
 ADD_SUBDIRECTORY(pcm)
@@ -19,12 +18,5 @@
 if(USE_FAAC)
 ADD_SUBDIRECTORY(faac)
 endif(USE_FAAC)
-MESSAGE("***  Audio Encoder ***")
-ADM_DISPLAY("Aften     " "${USE_AFTEN}")
-ADM_DISPLAY("LAME      " "${USE_LAME}")
-ADM_DISPLAY("FAAC      " "${USE_FAAC}")
-ADM_DISPLAY("Vorbis    " "${USE_VORBIS}")
-MESSAGE("***  /Audio Encoder  ***")
 
 
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
@@ -82,9 +82,8 @@
     SET(DO_CLI    1)
 endif(PLUGIN_UI MATCHES "CLI")
 
-
-
 MESSAGE(STATUS "Plugin UI : ${PLUGIN_UI}")
+MESSAGE("")
 
 ########################################
 # Check for UI libraries
@@ -104,11 +103,11 @@
     ENDIF(${ADM_INC} MATCHES "NOTFOUND")
 ENDMACRO(CHECK_ADM_CONFIG_H flavor result)
 
+APPEND_SUMMARY_LIST("User Interface" "Common" "${DO_COMMON}")
+
 #*****
 # GTK
 #*****
-MESSAGE(STATUS "Checking flavors to build (gtk/qt4/...)")
-MESSAGE(STATUS "***************************************")
 if(DO_GTK)
     INCLUDE(admCheckGtk)
     INCLUDE(admCheckGettext)
@@ -118,15 +117,19 @@
         MESSAGE(STATUS "Gtk and gthread found, good")
         CHECK_ADM_CONFIG_H(gtk ADM_INC)
         IF(NOT ADM_INC)
-            MESSAGE(ERROR " GTK UI requested, but cannot find header file for avidemux/gtk...disabling it")
+            MESSAGE("ERROR GTK UI requested, but cannot find header file for avidemux/gtk...disabling it")
+			MESSAGE("")
             SET(DO_GTK 0)
         ENDIF(NOT ADM_INC)
     else (GTK_FOUND AND GTHREAD_FOUND)
-        MESSAGE(ERROR " GTK UI requested, but gtk/gthread libraries not found... disabling it")
+        MESSAGE("ERROR GTK UI requested, but gtk/gthread libraries not found... disabling it")
+		MESSAGE("")
         SET(DO_GTK 0)
     endif (GTK_FOUND AND GTHREAD_FOUND)
 endif(DO_GTK)
 
+APPEND_SUMMARY_LIST("User Interface" "GTK+" "${DO_GTK}")
+
 #*****
 # QT4
 #*****
@@ -135,30 +138,43 @@
     checkQt4()
     IF (NOT QT4_FOUND)
         SET(DO_QT4 0)
-        MESSAGE(ERROR " QT4 UI requested, but qt4 libraries not found... disabling it")
+        MESSAGE("ERROR QT4 UI requested, but qt4 libraries not found... disabling it")
+		MESSAGE("")
     ELSE (NOT QT4_FOUND)
-        MESSAGE(STATUS " QT4 libraries found, good")
+        MESSAGE(STATUS "QT4 libraries found, good")
         CHECK_ADM_CONFIG_H(qt4 ADM_INC)
-        MESSAGE(STATUS " Checking for Qt4 OpenGL support ")
+		MESSAGE("")
+
         INCLUDE(admCheckOpenGl)
         IF(NOT ADM_INC)
-            MESSAGE(ERROR " QT4 UI requested, but cannot find header file for avidemux/qt4...disabling it")
+            MESSAGE("ERROR QT4 UI requested, but cannot find header file for avidemux/qt4...disabling it")
+			MESSAGE("")
             SET(DO_QT4 0)
         ENDIF(NOT ADM_INC)
     ENDIF (NOT QT4_FOUND)
 endif(DO_QT4)
 
+APPEND_SUMMARY_LIST("User Interface" "Qt 4" "${DO_QT4}")
+
 #*****
 # CLI
 #*****
 if(DO_CLI)
+		MESSAGE(STATUS "Checking for CLI")
+		MESSAGE(STATUS "****************")
+
         CHECK_ADM_CONFIG_H(cli ADM_INC)
+
         IF(NOT ADM_INC)
-            MESSAGE(ERROR " CLI UI requested, but cannot find header file for avidemux/cli...disabling it")
+            MESSAGE("ERROR CLI UI requested, but cannot find header file for avidemux/cli...disabling it")
             SET(DO_CLI 0)
         ENDIF(NOT ADM_INC)
+
+		MESSAGE("")
 endif(DO_CLI)
 
+APPEND_SUMMARY_LIST("User Interface" "CLI" "${DO_CLI}")
+
 ########################################
 # Actual work to do..
 ########################################
@@ -183,10 +199,8 @@
 ########################################
 # Config Summary
 ########################################
-INCLUDE(admPluginConfigSummary)
-MESSAGE("")
-#
-# Packaging
-#
+DISPLAY_SUMMARY_LIST()
+
 include(admPackager)
 admPackager(pluginsPackage)
+MESSAGE("")
\ No newline at end of file

Deleted: branches/avidemux_2.6_branch_mean/cmake/admCheckAmrnb.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckAmrnb.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckAmrnb.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,20 +0,0 @@
-MACRO(checkAmrnb)
-	IF (NOT AMRNB_CHECKED)
-		OPTION(AMRNB "" ON)
-
-		MESSAGE(STATUS "Checking for amrnb")
-		MESSAGE(STATUS "******************")
-
-		IF (AMRNB)
-			FIND_HEADER_AND_LIB(AMRNB amrnb/interf_dec.h amrnb GP3Decoder_Interface_Decode)
-			PRINT_LIBRARY_INFO("amrnb" AMRNB_FOUND "${AMRNB_INCLUDE_DIR}" "${AMRNB_LIBRARY_DIR}")
-		ELSE (AMRNB)
-			MESSAGE("${MSG_DISABLE_OPTION}")
-		ENDIF (AMRNB)
-
-		SET(ENV{ADM_HAVE_AMRNB} ${AMRNB_FOUND})
-		SET(AMRNB_CHECKED 1)
-
-		MESSAGE("")
-	ENDIF (NOT AMRNB_CHECKED)
-ENDMACRO(checkAmrnb)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckAudioDeviceLibs.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckAudioDeviceLibs.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -23,6 +23,7 @@
 	ENDIF (ALSA)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "ALSA" "${USE_ALSA}")
 ELSE (UNIX AND NOT APPLE)
 	SET(ALSA_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)
@@ -48,6 +49,7 @@
 	ENDIF (ARTS)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "aRts" "${USE_ARTS}")
 ELSE (UNIX)
 	SET(ARTS_CAPABLE FALSE)
 ENDIF (UNIX)
@@ -73,6 +75,7 @@
 	ENDIF (ESD)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "ESD" "${USE_ESD}")
 ELSE (UNIX)
 	SET(ESD_CAPABLE FALSE)
 ENDIF (UNIX)
@@ -98,6 +101,7 @@
 	ENDIF (JACK)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "JACK" "${USE_JACK}")
 ELSE (UNIX)
 	SET(JACK_CAPABLE FALSE)
 ENDIF (UNIX)
@@ -117,6 +121,7 @@
 	ENDIF (SRC_FOUND)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "SRC" "${USE_SRC}")
 ENDIF (JACK_FOUND)
 
 ########################################
@@ -140,9 +145,11 @@
 	ENDIF (OSS)
 
 	MESSAGE("")
+	APPEND_SUMMARY_LIST("Audio Device" "OSS" "${USE_OSS}")
 ELSE (UNIX AND NOT APPLE)
 	SET(OSS_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)
+
 ########################################
 # PulseAudioSimple
 ########################################
@@ -190,6 +197,7 @@
 
         MARK_AS_ADVANCED(PULSEAUDIOSIMPLE_INCLUDE_DIR PULSEAUDIOSIMPLE_LIBRARIES)
 
+		APPEND_SUMMARY_LIST("Audio Device" "PulseAudio" "${USE_PULSE_SIMPLE}")
 ELSE (UNIX AND NOT APPLE)
 	SET(PULSEAUDIOSIMPLE_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -42,12 +42,12 @@
 			                SET(USE_AFTEN 0)
                         ENDIF( AFTEN_TEST_COMPILE_RESULT )
                 ENDIF(CROSS)
-
 	ENDIF (AFTEN_FOUND)
 ELSE (AFTEN)
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (AFTEN)
 
+APPEND_SUMMARY_LIST("Audio Encoder" "Aften" "${USE_AFTEN}")
 MESSAGE("")
 
 ########################################
@@ -73,6 +73,7 @@
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (LAME)
 
+APPEND_SUMMARY_LIST("Audio Encoder" "LAME" "${USE_LAME}")
 MESSAGE("")
 
 
@@ -95,6 +96,7 @@
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (FAAC)
 
+APPEND_SUMMARY_LIST("Audio Encoder" "FAAC" "${USE_FAAC}")
 MESSAGE("")
 
 ########################################
@@ -120,4 +122,5 @@
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (VORBIS)
 
+APPEND_SUMMARY_LIST("Audio Encoder" "Vorbis" "${USE_VORBIS}")
 MESSAGE ("")

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -36,9 +36,10 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (LIBDCA)
 
-		SET(ENV{ADM_HAVE_LIBDCA} ${LIBDCA_FOUND})
 		SET(LIBDCA_CHECKED 1)
 
 		MESSAGE("")
 	ENDIF (NOT LIBDCA_CHECKED)
+
+	APPEND_SUMMARY_LIST("Audio Decoder" "libdca" "${LIBDCA_FOUND}")
 ENDMACRO(checkDca)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckFaad.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckFaad.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckFaad.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -39,9 +39,10 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (FAAD)
 
-		SET(ENV{ADM_HAVE_FAAD} ${FAAD_FOUND})
 		SET(FAAD_CHECKED 1)
 
 		MESSAGE("")
 	ENDIF (NOT FAAD_CHECKED)
+
+	APPEND_SUMMARY_LIST("Audio Decoder" "FAAD" "${FAAD_FOUND}")
 ENDMACRO(checkFaad)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckFontConfig.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckFontConfig.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckFontConfig.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -16,9 +16,10 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (FONTCONFIG)
 
-		SET(ENV{ADM_HAVE_FONTCONFIG} ${FONTCONFIG_FOUND})
 		SET(FONTCONFIG_CHECKED 1)
 
 		MESSAGE("")
 	ENDIF (NOT FONTCONFIG_CHECKED)
+
+	APPEND_SUMMARY_LIST("Miscellaneous" "FontConfig" "${FONTCONFIG_FOUND}")
 ENDMACRO(checkFontConfig)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckFreeType.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckFreeType.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckFreeType.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -18,6 +18,8 @@
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (FREETYPE2)
 
+APPEND_SUMMARY_LIST("Miscellaneous" "FreeType2" "${FREETYPE2_FOUND}")
+
 MESSAGE("")
 
 ########################################

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckGettext.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckGettext.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckGettext.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -45,7 +45,8 @@
 		ENDIF (GETTEXT)
 
 		SET(GETTEXT_CHECKED 1)
-
 		MESSAGE("")
 	ENDIF (NOT GETTEXT_CHECKED)
+
+	APPEND_SUMMARY_LIST("Miscellaneous" "gettext" "${HAVE_GETTEXT}")
 ENDMACRO(checkGettext)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -32,6 +32,8 @@
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (SDL)
 
+APPEND_SUMMARY_LIST("Miscellaneous" "SDL" "${USE_SDL}")
+
 MESSAGE("")
 
 ########################################
@@ -53,6 +55,8 @@
 
 		MESSAGE("")
 	ENDIF (XVIDEO)
+
+	APPEND_SUMMARY_LIST("Miscellaneous" "XVideo" "${XVIDEO_FOUND}")
 ELSE (UNIX AND NOT APPLE)
 	SET(XVIDEO_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckOpenGl.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -38,6 +38,8 @@
        MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (OPENGL)
 
+APPEND_SUMMARY_LIST("Miscellaneous" "OpenGL" "${USE_OPENGL}")
+
 MESSAGE("")
 
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckOpencore.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckOpencore.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckOpencore.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -12,11 +12,12 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (OPENCORE_AMRNB)
 
-		SET(ENV{ADM_HAVE_OPENCORE_AMRNB} ${OPENCORE_AMRNB_FOUND})
 		MESSAGE("")
 
 		SET(OPENCORE_AMRNB_CHECKED 1)
 	ENDIF (NOT OPENCORE_AMRNB_CHECKED)
+
+	APPEND_SUMMARY_LIST("Audio Decoder" "opencore-amrnb" "${OPENCORE_AMRNB_FOUND}")
 ENDMACRO(checkOpencoreAmrnb)
 
 MACRO(checkOpencoreAmrwb)
@@ -38,4 +39,6 @@
 		
 		SET(OPENCORE_AMRWB_CHECKED 1)
 	ENDIF (NOT OPENCORE_AMRWB_CHECKED)
+
+	APPEND_SUMMARY_LIST("Audio Decoder" "opencore-amrwb" "${OPENCORE_AMRWB_FOUND}")
 ENDMACRO(checkOpencoreAmrwb)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -4,37 +4,40 @@
 # as it is including its own dynlinker
 ########################################
 MACRO(checkVDPAU)
-	IF (NOT VDPAU_CHECKED)
-		OPTION(VDPAU "" ON)
+	if (UNIX)
+		IF (NOT VDPAU_CHECKED)
+			OPTION(VDPAU "" ON)
 
-		MESSAGE(STATUS "Checking for VDPAU")
-		MESSAGE(STATUS "*******************")
+			MESSAGE(STATUS "Checking for VDPAU")
+			MESSAGE(STATUS "*******************")
 
-		IF (VDPAU)
+			IF (VDPAU)
 		
-			FIND_HEADER_AND_LIB(VDPAU vdpau/vdpau.h )
+				FIND_HEADER_AND_LIB(VDPAU vdpau/vdpau.h )
 		
-			IF (VDPAU_FOUND)
-                                # CHECK That it has 
-                                ADM_COMPILE(check_vdpau.cpp "" "${VDPAU_INCLUDE_DIR}" "${VDPAU_LIBRARY_DIR}" VDPAU_COMPILE VDPAU_OUTPUT)
-                                IF(VDPAU_COMPILE)
-				        SET(VDPAU_FOUND 1)
-				        SET(USE_VDPAU 1)
-				        SET(VDPAU_INCLUDE_DIR "${VDPAU_INCLUDE_DIR}")
-				        SET(VDPAU_LIBRARY_DIR "${VDPAU_LIBRARY_DIR}")
-                                ELSE(VDPAU_COMPILE)
-                                        MESSAGE(STATUS "The vdpau found does not compile, probably too old ${VDPAU_OUTPUT}.")
-                                ENDIF(VDPAU_COMPILE)
+				IF (VDPAU_FOUND)
+									# CHECK That it has 
+									ADM_COMPILE(check_vdpau.cpp "" "${VDPAU_INCLUDE_DIR}" "${VDPAU_LIBRARY_DIR}" VDPAU_COMPILE VDPAU_OUTPUT)
+									IF(VDPAU_COMPILE)
+							SET(VDPAU_FOUND 1)
+							SET(USE_VDPAU 1)
+							SET(VDPAU_INCLUDE_DIR "${VDPAU_INCLUDE_DIR}")
+							SET(VDPAU_LIBRARY_DIR "${VDPAU_LIBRARY_DIR}")
+									ELSE(VDPAU_COMPILE)
+											MESSAGE(STATUS "The vdpau found does not compile, probably too old ${VDPAU_OUTPUT}.")
+									ENDIF(VDPAU_COMPILE)
                                 
-			ENDIF (VDPAU_FOUND)
+				ENDIF (VDPAU_FOUND)
 
-			PRINT_LIBRARY_INFO("VDPAU" VDPAU_FOUND "${VDPAU_INCLUDE_DIR}" "${VDPAU_LIBRARY_DIR}")
-		ELSE (VDPAU)
-			MESSAGE("${MSG_DISABLE_OPTION}")
-		ENDIF (VDPAU)
+				PRINT_LIBRARY_INFO("VDPAU" VDPAU_FOUND "${VDPAU_INCLUDE_DIR}" "${VDPAU_LIBRARY_DIR}")
+			ELSE (VDPAU)
+				MESSAGE("${MSG_DISABLE_OPTION}")
+			ENDIF (VDPAU)
 
-		SET(VDPAU_CHECKED 1)
+			SET(VDPAU_CHECKED 1)
+			MESSAGE("")
+		ENDIF (NOT VDPAU_CHECKED)
 
-		MESSAGE("")
-	ENDIF (NOT VDPAU_CHECKED)
+		APPEND_SUMMARY_LIST("Miscellaneous" "VDPAU" "${VDPAU_FOUND}")
+	endif (UNIX)
 ENDMACRO(checkVDPAU)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckVorbisDec.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckVorbisDec.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckVorbisDec.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -32,4 +32,6 @@
 
 		MESSAGE("")
 	ENDIF (NOT LIBVORBIS_CHECKED)
+
+	APPEND_SUMMARY_LIST("Audio Decoder" "Vorbis" "${LIBVORBIS_FOUND}")
 ENDMACRO(checkvorbis)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckVpx.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckVpx.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckVpx.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -15,4 +15,6 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (VPXDEC)
 		MESSAGE("")
+
+		APPEND_SUMMARY_LIST("Audio Decoder" "libvpx" "${VPX_FOUND}")
 ENDMACRO(checkVpxDec)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckX264.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckX264.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckX264.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -31,9 +31,10 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (X264)
 
-		SET(ENV{ADM_HAVE_X264} ${X264_FOUND})
 		SET(X264_CHECKED 1)
 
 		MESSAGE("")
 	ENDIF (NOT X264_CHECKED)
+
+	APPEND_SUMMARY_LIST("Video Encoder" "x264" "${_X264_FOUND}")
 ENDMACRO(checkX264)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckXvid.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckXvid.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckXvid.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -14,4 +14,6 @@
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (XVID)
 		MESSAGE("")
+
+		APPEND_SUMMARY_LIST("Video Encoder" "Xvid" "${XVID_FOUND}")
 ENDMACRO(checkXvid)

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,38 +1,86 @@
-# ARGV2 - capable flag
-MACRO(ADM_DISPLAY _name)
-	SET(PROCEED 1)
+macro(INITIALISE_SUMMARY_LISTS)
+	foreach(componentType ${SUMMARY_LIST})
+		GET_SUMMARY_LIST_NAME(listName ${componentType})
+		unset(${listName} CACHE)
+	endforeach(componentType)
 
-	IF (NOT ${ARGV2})
-		SET(PROCEED 0)
-	ENDIF (NOT ${ARGV2})
+	set(SUMMARY_LIST "" CACHE INTERNAL "")
+endmacro(INITIALISE_SUMMARY_LISTS)
 
-	IF (${PROCEED})
-		IF (${ARGV1})
-			SET(s "Yes")
-		ELSE (${ARGV1})
-			SET(s "No")
-		ENDIF (${ARGV1})
+macro(GET_SUMMARY_LIST_NAME outVariable componentType)
+	string(REPLACE " " "_" safeComponentType "${componentType}")
+	set(${outVariable} "SUMMARY_${safeComponentType}")
+endmacro(GET_SUMMARY_LIST_NAME)
 
-		MESSAGE("   ${_name}  ${s}")
-	ENDIF (${PROCEED})
-ENDMACRO(ADM_DISPLAY)
+macro(APPEND_SUMMARY_LIST componentType componentName componentFound)
+	GET_SUMMARY_LIST_NAME(listName ${componentType})
 
-MESSAGE("*********************")
-MESSAGE("***    SUMMARY    ***")
-MESSAGE("*********************")
+	if (${listName})
+		set(${listName} ${${listName}} "${componentName}=${componentFound}" CACHE INTERNAL "")
+	else (${listName})
+		if (SUMMARY_LIST)
+			set(SUMMARY_LIST ${componentType} ${SUMMARY_LIST} CACHE INTERNAL "")
+		else (SUMMARY_LIST)
+			set(SUMMARY_LIST ${componentType} CACHE INTERNAL "")
+		endif (SUMMARY_LIST)
 
-MESSAGE("*** Miscellaneous ***")
-ADM_DISPLAY("gettext   " "${HAVE_GETTEXT}")
-ADM_DISPLAY("SDL       " "${USE_SDL}")
-ADM_DISPLAY("XVideo    " "${USE_XV}" "${XVIDEO_CAPABLE}")
-ADM_DISPLAY("VDPAU     " "${USE_VDPAU}" )
+		set(${listName} "${componentName}=${componentFound}" CACHE INTERNAL "")
+	endif (${listName})
+endmacro(APPEND_SUMMARY_LIST)
 
-MESSAGE("*********************")
+function(padString outVariable length padCharacter value)
+    string(LENGTH "${value}" valueLength)
+    math(EXPR padLength "${length} - ${valueLength} - 1")
+    set(paddedValue ${value})
 
-IF (CMAKE_BUILD_TYPE STREQUAL "Debug")
-	MESSAGE("***  Debug Build  ***")
-ELSE (CMAKE_BUILD_TYPE STREQUAL "Debug")
-	MESSAGE("*** Release Build ***")
-ENDIF(CMAKE_BUILD_TYPE STREQUAL "Debug")
+    if (padLength GREATER -1)
+        foreach(dummy RANGE ${padLength})
+            set(paddedValue "${paddedValue}${padCharacter}")
+        endforeach(dummy)
+    endif (padLength GREATER -1)
 
-MESSAGE("*********************")
+    set(${outVariable} "${paddedValue}" PARENT_SCOPE)
+endfunction(padString)
+
+macro(DISPLAY_SUMMARY_LIST)
+	message("")
+	message("**************************")
+	message("***  Optional Library  ***")
+	message("***      Summary       ***")
+	message("**************************")
+
+	foreach(componentType ${SUMMARY_LIST})
+		GET_SUMMARY_LIST_NAME(listName ${componentType})
+
+		padString(componentType 18 " " "${componentType}")
+		message("*** ${componentType} ***")
+
+		foreach(component ${${listName}})
+			string(FIND "${component}" = valuePosition)
+
+			string(SUBSTRING "${component}" 0 ${valuePosition} componentName)
+			math(EXPR valuePosition "${valuePosition} + 1")
+			string(SUBSTRING "${component}" ${valuePosition} -1 componentFound)
+
+			if (${componentFound})
+				set(componentSummary "Yes")
+			else (${componentFound})
+				set(componentSummary "No")
+			endif (${componentFound})
+
+			padString(componentName 14 " " "${componentName}")
+			message("    ${componentName} ${componentSummary}")
+		endforeach(component)
+	endforeach(componentType)
+
+	message("**************************")
+
+	if (CMAKE_BUILD_TYPE STREQUAL "Debug")
+		message("***    Debug Build     ***")
+	else (CMAKE_BUILD_TYPE STREQUAL "Debug")
+		message("***   Release Build    ***")
+	endif(CMAKE_BUILD_TYPE STREQUAL "Debug")
+
+	message("**************************")
+	message("")
+endmacro(DISPLAY_SUMMARY_LIST)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -3,7 +3,6 @@
 SET(CMAKE_C_FLAGS $ENV{CFLAGS})
 SET(CMAKE_CXX_FLAGS $ENV{CXXFLAGS})
 SET(CMAKE_LD_FLAGS $ENV{LDFLAGS})
-cmake_policy(SET CMP0004 OLD)
 
 IF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES "^${CMAKE_CXX_COMPILER_WORKS}$")
 	SET(FRESH_BUILD 1)

Deleted: branches/avidemux_2.6_branch_mean/cmake/admPluginConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admPluginConfigSummary.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admPluginConfigSummary.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,23 +0,0 @@
-# ARGV2 - capable flag
-include(admSummary)
-
-
-MESSAGE("*** Miscellaneous ***")
-ADM_DISPLAY("FontConfig" "$ENV{ADM_HAVE_FONTCONFIG}")
-ADM_DISPLAY("FreeType2 " "${FREETYPE2_FOUND}")
-ADM_DISPLAY("gettext   " "${HAVE_GETTEXT}")
-
-MESSAGE("*********************")
-
-IF (CMAKE_BUILD_TYPE STREQUAL "Debug")
-	MESSAGE("***  Debug Build  ***")
-ELSE (CMAKE_BUILD_TYPE STREQUAL "Debug")
-	MESSAGE("*** Release Build ***")
-ENDIF(CMAKE_BUILD_TYPE STREQUAL "Debug")
-MESSAGE("******** UI *************")
-ADM_DISPLAY("Common    " "${DO_COMMON}")
-ADM_DISPLAY("Gtk       " "${DO_GTK}")
-ADM_DISPLAY("Qt4       " "${DO_QT4}")
-ADM_DISPLAY("Cli       " "${DO_CLI}")
-
-MESSAGE("*********************")

Deleted: branches/avidemux_2.6_branch_mean/cmake/admSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admSummary.cmake	2011-12-05 21:49:50 UTC (rev 7694)
+++ branches/avidemux_2.6_branch_mean/cmake/admSummary.cmake	2011-12-11 15:42:33 UTC (rev 7695)
@@ -1,19 +0,0 @@
-# ARGV2 - capable flag
-MACRO(ADM_DISPLAY _name)
-	SET(PROCEED 1)
-
-	IF (NOT ${ARGV2})
-		SET(PROCEED 0)
-	ENDIF (NOT ${ARGV2})
-
-	IF (${PROCEED})
-		IF (${ARGV1})
-			SET(s "Yes")
-		ELSE (${ARGV1})
-			SET(s "No")
-		ENDIF (${ARGV1})
-
-		MESSAGE("   ${_name}  ${s}")
-	ENDIF (${PROCEED})
-ENDMACRO(ADM_DISPLAY)
-



From mean at mail.berlios.de  Mon Dec 12 08:32:35 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Dec 2011 08:32:35 +0100
Subject: [Avidemux-svn-commit] r7696 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D
Message-ID: <20111212073235.84E534825AD@sheep.berlios.de>

Author: mean
Date: 2011-12-12 08:32:34 +0100 (Mon, 12 Dec 2011)
New Revision: 7696

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_json.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
Log:
[filter] Update mplayerHQD3D with the one from ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp	2011-12-11 15:42:33 UTC (rev 7695)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp	2011-12-12 07:32:34 UTC (rev 7696)
@@ -6,6 +6,10 @@
 Copyright (C) 2003
 Daniel Moreno <comac at comac.darktech.org>
 	& A'rpi
+Resynced with ffmpeg lavfilter
+ * Copyright (c) 2003 Daniel Moreno <comac AT comac DOT darktech DOT org>
+ * Copyright (c) 2010 Baptiste Coudurier
+
  ***************************************************************************/
 
 /***************************************************************************
@@ -16,7 +20,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#if 0
 #include <math.h>
 #include "ADM_default.h"
 #include "ADM_coreVideoFilterInternal.h"
@@ -24,18 +27,172 @@
 #include "DIA_factory.h"
 
 #include "ADM_vidMPLD3D.h"
-#include "denoise3d_desc.cpp"
+#include "denoise3dHQ_desc.cpp"
 
 #include "DIA_factory.h"
 #define aprintf(...) {}
+// -- ffmpeg start
+#define av_malloc ADM_alloc
+#define av_free   ADM_dezalloc
+#define FFABS(a) ((a) >= 0 ? (a) : (-(a)))
 
-static inline unsigned int LowPassMul(unsigned int PrevMul, unsigned int CurrMul, int* Coef){
-//    int dMul= (PrevMul&0xFFFFFF)-(CurrMul&0xFFFFFF);
+static inline unsigned int LowPassMul(unsigned int PrevMul, unsigned int CurrMul, int *Coef)
+{
+    //    int dMul= (PrevMul&0xFFFFFF)-(CurrMul&0xFFFFFF);
     int dMul= PrevMul-CurrMul;
-    int d=((dMul+0x10007FF)/(65536/16));
+    unsigned int d=((dMul+0x10007FF)>>12);
     return CurrMul + Coef[d];
 }
 
+static void deNoiseTemporal(unsigned char *FrameSrc,
+                            unsigned char *FrameDest,
+                            unsigned short *FrameAnt,
+                            int W, int H, int sStride, int dStride,
+                            int *Temporal)
+{
+    long X, Y;
+    unsigned int PixelDst;
+
+    for (Y = 0; Y < H; Y++) {
+        for (X = 0; X < W; X++) {
+            PixelDst = LowPassMul(FrameAnt[X]<<8, FrameSrc[X]<<16, Temporal);
+            FrameAnt[X] = ((PixelDst+0x1000007F)>>8);
+            FrameDest[X]= ((PixelDst+0x10007FFF)>>16);
+        }
+        FrameSrc  += sStride;
+        FrameDest += dStride;
+        FrameAnt += W;
+    }
+}
+
+static void deNoiseSpacial(unsigned char *Frame,
+                           unsigned char *FrameDest,
+                           unsigned int *LineAnt,
+                           int W, int H, int sStride, int dStride,
+                           int *Horizontal, int *Vertical)
+{
+    long X, Y;
+    long sLineOffs = 0, dLineOffs = 0;
+    unsigned int PixelAnt;
+    unsigned int PixelDst;
+
+    /* First pixel has no left nor top neighbor. */
+    PixelDst = LineAnt[0] = PixelAnt = Frame[0]<<16;
+    FrameDest[0]= ((PixelDst+0x10007FFF)>>16);
+
+    /* First line has no top neighbor, only left. */
+    for (X = 1; X < W; X++) {
+        PixelDst = LineAnt[X] = LowPassMul(PixelAnt, Frame[X]<<16, Horizontal);
+        FrameDest[X]= ((PixelDst+0x10007FFF)>>16);
+    }
+
+    for (Y = 1; Y < H; Y++) {
+        unsigned int PixelAnt;
+        sLineOffs += sStride, dLineOffs += dStride;
+        /* First pixel on each line doesn't have previous pixel */
+        PixelAnt = Frame[sLineOffs]<<16;
+        PixelDst = LineAnt[0] = LowPassMul(LineAnt[0], PixelAnt, Vertical);
+        FrameDest[dLineOffs]= ((PixelDst+0x10007FFF)>>16);
+
+        for (X = 1; X < W; X++) {
+            unsigned int PixelDst;
+            /* The rest are normal */
+            PixelAnt = LowPassMul(PixelAnt, Frame[sLineOffs+X]<<16, Horizontal);
+            PixelDst = LineAnt[X] = LowPassMul(LineAnt[X], PixelAnt, Vertical);
+            FrameDest[dLineOffs+X]= ((PixelDst+0x10007FFF)>>16);
+        }
+    }
+}
+
+static void deNoise(unsigned char *Frame,
+                    unsigned char *FrameDest,
+                    unsigned int *LineAnt,
+                    unsigned short **FrameAntPtr,
+                    int W, int H, int sStride, int dStride,
+                    int *Horizontal, int *Vertical, int *Temporal)
+{
+    long X, Y;
+    long sLineOffs = 0, dLineOffs = 0;
+    unsigned int PixelAnt;
+    unsigned int PixelDst;
+    unsigned short* FrameAnt=(*FrameAntPtr);
+
+    if (!FrameAnt) {
+        (*FrameAntPtr) = FrameAnt = (unsigned short *)av_malloc(W*H*sizeof(unsigned short));
+        for (Y = 0; Y < H; Y++) {
+            unsigned short* dst=&FrameAnt[Y*W];
+            unsigned char* src=Frame+Y*sStride;
+            for (X = 0; X < W; X++) dst[X]=src[X]<<8;
+        }
+    }
+
+    if (!Horizontal[0] && !Vertical[0]) {
+        deNoiseTemporal(Frame, FrameDest, FrameAnt,
+                        W, H, sStride, dStride, Temporal);
+        return;
+    }
+    if (!Temporal[0]) {
+        deNoiseSpacial(Frame, FrameDest, LineAnt,
+                       W, H, sStride, dStride, Horizontal, Vertical);
+        return;
+    }
+
+    /* First pixel has no left nor top neighbor. Only previous frame */
+    LineAnt[0] = PixelAnt = Frame[0]<<16;
+    PixelDst = LowPassMul(FrameAnt[0]<<8, PixelAnt, Temporal);
+    FrameAnt[0] = ((PixelDst+0x1000007F)>>8);
+    FrameDest[0]= ((PixelDst+0x10007FFF)>>16);
+
+    /* First line has no top neighbor. Only left one for each pixel and
+     * last frame */
+    for (X = 1; X < W; X++) {
+        LineAnt[X] = PixelAnt = LowPassMul(PixelAnt, Frame[X]<<16, Horizontal);
+        PixelDst = LowPassMul(FrameAnt[X]<<8, PixelAnt, Temporal);
+        FrameAnt[X] = ((PixelDst+0x1000007F)>>8);
+        FrameDest[X]= ((PixelDst+0x10007FFF)>>16);
+    }
+
+    for (Y = 1; Y < H; Y++) {
+        unsigned int PixelAnt;
+        unsigned short* LinePrev=&FrameAnt[Y*W];
+        sLineOffs += sStride, dLineOffs += dStride;
+        /* First pixel on each line doesn't have previous pixel */
+        PixelAnt = Frame[sLineOffs]<<16;
+        LineAnt[0] = LowPassMul(LineAnt[0], PixelAnt, Vertical);
+        PixelDst = LowPassMul(LinePrev[0]<<8, LineAnt[0], Temporal);
+        LinePrev[0] = ((PixelDst+0x1000007F)>>8);
+        FrameDest[dLineOffs]= ((PixelDst+0x10007FFF)>>16);
+
+        for (X = 1; X < W; X++) {
+            unsigned int PixelDst;
+            /* The rest are normal */
+            PixelAnt = LowPassMul(PixelAnt, Frame[sLineOffs+X]<<16, Horizontal);
+            LineAnt[X] = LowPassMul(LineAnt[X], PixelAnt, Vertical);
+            PixelDst = LowPassMul(LinePrev[X]<<8, LineAnt[X], Temporal);
+            LinePrev[X] = ((PixelDst+0x1000007F)>>8);
+            FrameDest[dLineOffs+X]= ((PixelDst+0x10007FFF)>>16);
+        }
+    }
+}
+
+static void PrecalcCoefs(int *Ct, double Dist25)
+{
+    int i;
+    double Gamma, Simil, C;
+
+    Gamma = log(0.25) / log(1.0 - Dist25/255.0 - 0.00001);
+
+    for (i = -255*16; i <= 255*16; i++) {
+        Simil = 1.0 - FFABS(i) / (16*255.0);
+        C = pow(Simil, Gamma) * 65536.0 * i / 16.0;
+        Ct[16*256+i] = lrint(C);
+    }
+
+    Ct[0] = !!Dist25;
+}
+
+
+//--------
 DECLARE_VIDEO_FILTER(   ADMVideoMPD3D,   // Class
                         1,0,0,              // Version
                         ADM_UI_ALL,         // UI
@@ -54,8 +211,8 @@
 const char 	*ADMVideoMPD3D::getConfiguration(void)
  {
       static char str[1024];
-	  snprintf(str,1023," MPlayer Denoise 3D (%2.1f - %2.1f - %2.1f)'",
-						param.luma,param.chroma,param.temporal);
+	  snprintf(str,1023," MPlayer Denoise 3D (Sp : %2.1f - %2.1f, Tmp:%2.1f - %2.1f)'",
+						param.luma_spatial,param.chroma_spatial,param.luma_temporal,param.chroma_temporal);
       return str;
         
 }
@@ -66,27 +223,30 @@
 {
 
         
-        ELEM_TYPE_FLOAT fluma,fchroma,ftemporal;
+        ELEM_TYPE_FLOAT fluma_spatial,fchroma_spatial,fluma_temporal,fchroma_temporal;
 #define PX(x) &x
 #define OOP(x,y) f##x=(ELEM_TYPE_FLOAT )param.x;
         
-        OOP(luma,Luma);
-        OOP(chroma,Chroma);
-        OOP(temporal,Temporal);
+        OOP(luma_spatial,Luma);
+        OOP(chroma_spatial,Chroma);
+        OOP(luma_temporal,LumaTemporal);
+        OOP(chroma_temporal,ChromaTemporal);
         
-        diaElemFloat   luma(PX(fluma),QT_TR_NOOP("_Spatial luma strength:"),0.,100.);
-        diaElemFloat   chroma(PX(fchroma),QT_TR_NOOP("S_patial chroma strength:"),0.,100.);
-        diaElemFloat   temporal(PX(ftemporal),QT_TR_NOOP("_Temporal strength:"),0.,100.);
+        diaElemFloat   luma(PX(fluma_spatial),QT_TR_NOOP("_Spatial luma strength:"),0.1,100.);
+        diaElemFloat   chroma(PX(fchroma_spatial),QT_TR_NOOP("S_patial chroma strength:"),0.,100.);
+        diaElemFloat   lumaTemporal(PX(fluma_temporal),QT_TR_NOOP("Luma _Temporal strength:"),0.,100.);
+        diaElemFloat   chromaTemporal(PX(fchroma_temporal),QT_TR_NOOP("Luma _Temporal strength:"),0.,100.);
     
-        diaElem *elems[3]={&luma,&chroma,&temporal};
+        diaElem *elems[4]={&luma,&chroma,&lumaTemporal,&chromaTemporal};
   
-        if(  diaFactoryRun(QT_TR_NOOP("MPlayer denoise3d"),3,elems))
+        if(  diaFactoryRun(QT_TR_NOOP("MPlayer denoise3d"),4,elems))
         {
 #undef OOP
 #define OOP(x,y) param.x=(float) f##x
-                OOP(luma,Luma);
-                OOP(chroma,Chroma);
-                OOP(temporal,Temporal);
+                OOP(luma_spatial,Luma);
+                OOP(chroma_spatial,Chroma);
+                OOP(luma_temporal,LumaTemporal);
+                OOP(chroma_temporal,ChromaTemporal);
           
                 setup();
                 return 1;
@@ -98,92 +258,42 @@
 */
 ADMVideoMPD3D::~ADMVideoMPD3D()
 {
-	delete [] Line;
-	Line=NULL;
-}
-
-
-/**
-        \fn deNoise
-*/
-void ADMVideoMPD3D::deNoise(unsigned char *Frame,        // mpi->planes[x]
-                    unsigned char *FrameDest,    // dmpi->planes[x]
-                   uint32_t 		 *LineAnt,      // vf->priv->Line (width bytes)
-		    unsigned short 	*FrameAntPtr,
-                    int W, int H, int sStride, int dStride,
-                    int *Horizontal, int *Vertical, int *Temporal)
-{
-    int X, Y;
-    int sLineOffs = 0, dLineOffs = 0;
-    unsigned int PixelAnt;
-    int PixelDst;
-    unsigned short* FrameAnt=(FrameAntPtr);
-    
-
-    /* First pixel has no left nor top neightbour. Only previous frame */
-    LineAnt[0] = PixelAnt = Frame[0]<<16;
-    PixelDst = LowPassMul(FrameAnt[0]<<8, PixelAnt, Temporal);
-    FrameAnt[0] = ((PixelDst+0x1000007F)/256);
-    FrameDest[0]= ((PixelDst+0x10007FFF)/65536);
-
-    /* Fist line has no top neightbour. Only left one for each pixel and
-     * last frame */
-    for (X = 1; X < W; X++){
-        LineAnt[X] = PixelAnt = LowPassMul(PixelAnt, Frame[X]<<16, Horizontal);
-        PixelDst = LowPassMul(FrameAnt[X]<<8, PixelAnt, Temporal);
-	FrameAnt[X] = ((PixelDst+0x1000007F)/256);
-	FrameDest[X]= ((PixelDst+0x10007FFF)/65536);
+    if(context.Line) av_free(context.Line);
+    context.Line=NULL;
+    for(int i=0;i<3;i++)
+    {
+        unsigned short *t=context.Frame[i];
+        context.Frame[i]=NULL;
+        if(t) av_free(t);
     }
-
-    for (Y = 1; Y < H; Y++){
-	unsigned int PixelAnt;
-	unsigned short* LinePrev=&FrameAnt[Y*W];
-	sLineOffs += sStride, dLineOffs += dStride;
-        /* First pixel on each line doesn't have previous pixel */
-        PixelAnt = Frame[sLineOffs]<<16;
-        LineAnt[0] = LowPassMul(LineAnt[0], PixelAnt, Vertical);
-	PixelDst = LowPassMul(LinePrev[0]<<8, LineAnt[0], Temporal);
-	LinePrev[0] = ((PixelDst+0x1000007F)/256);
-	FrameDest[dLineOffs]= ((PixelDst+0x10007FFF)/65536);
-
-        for (X = 1; X < W; X++){
-	    int PixelDst;
-            /* The rest are normal */
-            PixelAnt = LowPassMul(PixelAnt, Frame[sLineOffs+X]<<16, Horizontal);
-            LineAnt[X] = LowPassMul(LineAnt[X], PixelAnt, Vertical);
-	    PixelDst = LowPassMul(LinePrev[X]<<8, LineAnt[X], Temporal);
-	    LinePrev[X] = ((PixelDst+0x1000007F)/256);
-	    FrameDest[dLineOffs+X]= ((PixelDst+0x10007FFF)/65536);
-        }
-    }
 }
 
 
-
 /**
     \fn setup
 */
 uint8_t  ADMVideoMPD3D::setup(void)
 {
- double LumSpac, LumTmp, ChromSpac, ChromTmp;
+    double LumSpac, LumTmp, ChromSpac, ChromTmp;
+    double Param1, Param2, Param3, Param4;
 
-        LumSpac = param.luma;
-        LumTmp = param.temporal;
+    Param1=param.luma_spatial;
+    Param2=param.chroma_spatial;
+    Param3=param.luma_temporal;
+    Param4=param.chroma_temporal;
 
-        ChromSpac = param.chroma;
-        ChromTmp = LumTmp * ChromSpac / LumSpac;
+    if(Param1<0.1) Param1=0.1;
+    LumSpac   = Param1;
+    ChromSpac = Param2 * Param1 / Param1;
+    LumTmp    = Param3 * Param1 / Param1;
+    ChromTmp  = LumTmp * ChromSpac / LumSpac;
+    
+    PrecalcCoefs(context.Coefs[0], LumSpac);
+    PrecalcCoefs(context.Coefs[1], LumTmp);
+    PrecalcCoefs(context.Coefs[2], ChromSpac);
+    PrecalcCoefs(context.Coefs[3], ChromTmp);
 
-        PrecalcCoefs((int *)Coefs[0], LumSpac);
-        PrecalcCoefs((int *)Coefs[1], LumTmp);
-        PrecalcCoefs((int *)Coefs[2], ChromSpac);
-        PrecalcCoefs((int *)Coefs[3], ChromTmp);
-
-        aprintf("\n Param : %lf %lf %lf \n",
-            param.luma,
-            param.chroma,
-            param.temporal);
-
-       return 1;
+   return 1;
 }
 /**
     \fn ctor
@@ -192,15 +302,18 @@
         : ADM_coreVideoFilter(in,couples)
 {
 uint32_t page;
+  memset(&context,0,sizeof(context));
   vidCache=new VideoCache(3,in);
-  Line=new uint8_t [in->getInfo()->width];
+  context.Line=new unsigned int [in->getInfo()->width];
   page=info.width*info.height;
   
-  if(!couples || !ADM_paramLoad(couples,denoise3d_param,&param))
-  {  			
-			param.luma=PARAM1_DEFAULT;
-			param.chroma=PARAM2_DEFAULT;
-			param.temporal=PARAM3_DEFAULT;
+  if(!couples || !ADM_paramLoad(couples,denoise3dhq_param,&param))
+  {  		
+            param.mode=4;	
+			param.luma_spatial=PARAM1_DEFAULT;
+			param.chroma_spatial=PARAM2_DEFAULT;
+			param.luma_temporal=PARAM3_DEFAULT;
+            param.chroma_temporal=PARAM3_DEFAULT*PARAM2_DEFAULT/PARAM1_DEFAULT; //   ChromTmp  = LumTmp * ChromSpac / LumSpac;
   }
   setup();
 
@@ -211,7 +324,7 @@
 */
 bool	ADMVideoMPD3D::getCoupledConf( CONFcouple **couples)
 {
-    return ADM_paramSave(couples, denoise3d_param,&param);
+    return ADM_paramSave(couples, denoise3dhq_param,&param);
 	
 }
 /**
@@ -225,84 +338,77 @@
 	int H  = info.height;
 	uint32_t dlen,dflags;
 
-    ADMImage *src, *dst, * prev, *next;
+    ADMImage *src, *dst;
     
         *fn=nextFrame;
         uint32_t n = nextFrame;
-printf("MP3d: next frame= %d\n",(int)n);
+        printf("MP3d: next frame= %d\n",(int)n);
         src = vidCache->getImage(n);
         if(!src) return false;
-        // If possible get previous image...
-        if (n>0)
-                prev =  vidCache->getImage( n-1); // get previous frame
-        else
-                prev=src;
         
-		uint8_t *c,*d,*p;
+		uint8_t *c,*d;
 
 		d=YPLANE(image);
 		c=YPLANE(src);
-		p=YPLANE(prev);
-//
 
-        deNoise(c,p, d,
-                Line,ant, W, H,
-                W,W,
-               	Coefs[0] ,
-                Coefs[0] ,
-                Coefs[1] );
+        deNoise(c,d,
+                context.Line,
+                &context.Frame[0],
+                W,H,
+                image->GetPitch(PLANAR_Y),
+                src->GetPitch(PLANAR_Y),
+                context.Coefs[0],
+                context.Coefs[0],
+                context.Coefs[1]);
+
 	
 		d=UPLANE(image);
 		c=UPLANE(src);
-		p=UPLANE(prev);
 
-        deNoise(c,p, d,
-                Line,ant, cw, ch,
-                cw,cw,
-               	Coefs[2] ,
-                Coefs[2] ,
-                Coefs[3] );
+       deNoise(c,d,
+                context.Line,
+                &context.Frame[1],
+                cw,ch,
+                image->GetPitch(PLANAR_U),
+                src->GetPitch(PLANAR_U),
+                context.Coefs[2],
+                context.Coefs[2],
+                context.Coefs[3]);
 
         d=VPLANE(image);
         c=VPLANE(src);
-        p=VPLANE(prev);
 
-        deNoise(c,p, d,
-                    Line,ant, cw, ch,
-                    cw,cw,
-                    Coefs[2] ,
-                    Coefs[2] ,
-                    Coefs[3] );
+         deNoise(c,d,
+                context.Line,
+                &context.Frame[1],
+                cw,ch,
+                image->GetPitch(PLANAR_V),
+                src->GetPitch(PLANAR_V),
+                context.Coefs[2],
+                context.Coefs[2],
+                context.Coefs[3]);
 
 
 	nextFrame++;
 	image->copyInfo(src);
-        vidCache->unlockAll();
+    vidCache->unlockAll();
 	return 1;
 }
-
-#define ABS(A) ( (A) > 0 ? (A) : -(A) )
 /**
-    \fn PrecalcCoefs
+    \fn goToTime
+    \brief flush acc if seeking
 */
-
-void ADMVideoMPD3D::PrecalcCoefs(int *Ct, double Dist25)
+bool         ADMVideoMPD3D::goToTime(uint64_t usSeek)
 {
-    int i;
-    double Gamma, Simil, C;
-
-    Gamma = log(0.25) / log(1.0 - Dist25/255.0 - 0.00001);
-
-    for (i = -256*16; i < 256*16; i++)
+    for(int i=0;i<3;i++)
     {
-        Simil = 1.0 - ABS(i) / (16*255.0);
-	C=4096.*(double)i;
-        C *= pow(Simil, Gamma) ;
-       Ct[16*256+i] = (int)((C<0) ? (C-0.5) : (C+0.5));
+        unsigned short *t=context.Frame[i];
+        context.Frame[i]=NULL;
+        if(t) av_free(t);
     }
-
+    // Flush 
+    return ADM_coreVideoFilter::goToTime(usSeek);
 }
-#endif
 // EOF
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h	2011-12-11 15:42:33 UTC (rev 7695)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h	2011-12-12 07:32:34 UTC (rev 7696)
@@ -21,28 +21,30 @@
 #ifndef __D3DLOW__
 #define __D3DLOW__
 
-#include "denoise3d.h"
+#include "denoise3dHQ.h"
+typedef struct {
+    int Coefs[4][512*16];
+    unsigned int *Line;
+    unsigned short *Frame[3];
+    int hsub, vsub;
+} HQDN3DContext;
 
+#define PARAM1_DEFAULT 4.0
+#define PARAM2_DEFAULT 3.0
+#define PARAM3_DEFAULT 6.0
+
 /**
     \class ADMVideoMPD3Dlow
 */
 class ADMVideoMPD3D : public  ADM_coreVideoFilter
 {
 protected:
-                ADMImage        *original;
-                denoise3d       param;
-                uint32_t        last;
-                uint32_t         *Line;
-                int				Coefs[4][512*16];
-                void 	    PrecalcCoefs(int *Ct, double Dist25);
-				uint8_t  	setup(void);
-				void 	    deNoise(unsigned char *Frame,        // mpi->planes[x]
-                    						unsigned char *FramePrev,    // pmpi->planes[x]
-                    						unsigned char *FrameDest,    // dmpi->planes[x]
-                    						uint32_t char *LineAnt,      // vf->priv->Line (width bytes)
-                    						int W, int H, int sStride, int pStride, int dStride,
-                    						int *Horizontal, int *Vertical, int *Temporal);
-
+                ADMImage                        *original;
+                denoise3dhq                     param;
+                HQDN3DContext                   context;
+                uint32_t                        last;
+                uint8_t  	                setup(void);
+			
                     
 public:
                     ADMVideoMPD3D(ADM_coreVideoFilter *previous,CONFcouple *conf);
@@ -52,6 +54,7 @@
         virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);           /// Return the next image
         virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
         virtual bool         configure(void) ;                        /// Start graphical user interface
+        virtual bool         goToTime(uint64_t usSeek);  
 };
 
 			

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-12-11 15:42:33 UTC (rev 7695)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-12-12 07:32:34 UTC (rev 7696)
@@ -1,10 +1,10 @@
 INCLUDE(vf_plugin)
 
 
-#SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
-#ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
-#INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
-#INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
+SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
+ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
+INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
+INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
 
 SET(ADM_vf_denoise3d_SRCS ADM_vidMPLD3Dlow.cpp)
 ADD_VIDEO_FILTER(ADM_vf_denoise3d SHARED ${ADM_vf_denoise3d_SRCS})

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.conf	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.conf	2011-12-12 07:32:34 UTC (rev 7696)
@@ -0,0 +1,7 @@
+denoise3dhq{
+uint32_t:mode;   // 1,2,3,4
+float:luma_spatial; // Luma_spatial param1
+float:chroma_spatial; // Chroma spatial param2
+float:luma_temporal; // luma temporal Temporal param3
+float:chroma_temporal; // luma temporal Temporal param3
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ.h	2011-12-12 07:32:34 UTC (rev 7696)
@@ -0,0 +1,11 @@
+// automatically generated by admSerialization.py do not edit
+#ifndef ADM_denoise3dhq_CONF_H
+#define ADM_denoise3dhq_CONF_H
+typedef struct {
+uint32_t mode;
+float luma_spatial;
+float chroma_spatial;
+float luma_temporal;
+float chroma_temporal;
+}denoise3dhq;
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_desc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_desc.cpp	2011-12-12 07:32:34 UTC (rev 7696)
@@ -0,0 +1,9 @@
+// automatically generated by admSerialization.py, do not edit!
+extern const ADM_paramList denoise3dhq_param[]={
+ {"mode",offsetof(denoise3dhq,mode),"uint32_t",ADM_param_uint32_t},
+ {"luma_spatial",offsetof(denoise3dhq,luma_spatial),"float",ADM_param_float},
+ {"chroma_spatial",offsetof(denoise3dhq,chroma_spatial),"float",ADM_param_float},
+ {"luma_temporal",offsetof(denoise3dhq,luma_temporal),"float",ADM_param_float},
+ {"chroma_temporal",offsetof(denoise3dhq,chroma_temporal),"float",ADM_param_float},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_json.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3dHQ_json.cpp	2011-12-12 07:32:34 UTC (rev 7696)
@@ -0,0 +1,22 @@
+// automatically generated by admSerialization.py, do not edit!
+#include "ADM_default.h"
+#include "ADM_paramList.h"
+#include "ADM_coreJson.h"
+#include "denoise3dHQ.h"
+bool  denoise3dhq_jserialize(const char *file, const denoise3dhq *key){
+admJson json;
+json.addUint32("mode",key->mode);
+json.addFloat("luma_spatial",key->luma_spatial);
+json.addFloat("chroma_spatial",key->chroma_spatial);
+json.addFloat("luma_temporal",key->luma_temporal);
+json.addFloat("chroma_temporal",key->chroma_temporal);
+return json.dumpToFile(file);
+};
+bool  denoise3dhq_jdeserialize(const char *file, const ADM_paramList *tmpl,denoise3dhq *key){
+admJsonToCouple json;
+CONFcouple *c=json.readFromFile(file);
+if(!c) {ADM_error("Cannot read json file");return false;}
+bool r= ADM_paramLoadPartial(c,tmpl,key);
+delete c;
+return r;
+};



From mean at mail.berlios.de  Mon Dec 12 08:32:36 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Mon, 12 Dec 2011 08:32:36 +0100
Subject: [Avidemux-svn-commit] r7697 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20111212073236.7138E4825AD@sheep.berlios.de>

Author: mean
Date: 2011-12-12 08:32:36 +0100 (Mon, 12 Dec 2011)
New Revision: 7697

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
Log:
[build] Dont use string(FIND as it is available only with cmake 2.8

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2011-12-12 07:32:34 UTC (rev 7696)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2011-12-12 07:32:36 UTC (rev 7697)
@@ -42,6 +42,25 @@
     set(${outVariable} "${paddedValue}" PARENT_SCOPE)
 endfunction(padString)
 
+macro(COMPONENT_YESNO incoming componentName outgoing)
+        set(tmp ${incoming})
+        string(REGEX REPLACE "=.*$" "" tmp2 ${tmp} )
+        string(COMPARE EQUAL ${tmp} ${tmp2} match)
+        if(${match})
+                set(${componentName} ${incoming})
+                set(${outgoing}      "No")
+        else(${match})
+                set(${componentName} "${tmp2}")
+                string(REGEX REPLACE "^.*=" "" tmp3 ${tmp})
+                string(COMPARE EQUAL "${tmp3}" "1" match)
+                if(${match})
+                        set(${outgoing}      "Yes")
+                else(${match})
+                        set(${outgoing}      "No")
+                endif(${match})
+        endif(${match})
+endmacro(COMPONENT_YESNO incoming componentName outgoing)
+
 macro(DISPLAY_SUMMARY_LIST)
 	message("")
 	message("**************************")
@@ -56,18 +75,7 @@
 		message("*** ${componentType} ***")
 
 		foreach(component ${${listName}})
-			string(FIND "${component}" = valuePosition)
-
-			string(SUBSTRING "${component}" 0 ${valuePosition} componentName)
-			math(EXPR valuePosition "${valuePosition} + 1")
-			string(SUBSTRING "${component}" ${valuePosition} -1 componentFound)
-
-			if (${componentFound})
-				set(componentSummary "Yes")
-			else (${componentFound})
-				set(componentSummary "No")
-			endif (${componentFound})
-
+                        COMPONENT_YESNO( ${component} componentName componentSummary) 
 			padString(componentName 14 " " "${componentName}")
 			message("    ${componentName} ${componentSummary}")
 		endforeach(component)
@@ -83,4 +91,4 @@
 
 	message("**************************")
 	message("")
-endmacro(DISPLAY_SUMMARY_LIST)
\ No newline at end of file
+endmacro(DISPLAY_SUMMARY_LIST)



From gruntster at mail.berlios.de  Tue Dec 13 10:07:01 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Dec 2011 10:07:01 +0100
Subject: [Avidemux-svn-commit] r7698 - in branches/avidemux_2.6_branch_mean:
	avidemux/qt4 avidemux/qt4/ADM_jobs/src avidemux_core/ADM_core/src
	avidemux_plugins/ADM_videoFilters/Srt cmake
Message-ID: <20111213090701.94872481546@sheep.berlios.de>

Author: gruntster
Date: 2011-12-13 10:07:01 +0100 (Tue, 13 Dec 2011)
New Revision: 7698

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admConfigHelper.cmake
Log:
[cmake] remove bespoke ADD_TARGET_LDFLAGS since it doesn't enforce the CMP0004 policy and target_link_libraries can now be used safely instead

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-12-12 07:32:36 UTC (rev 7697)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2011-12-13 09:07:01 UTC (rev 7698)
@@ -72,10 +72,10 @@
 ENDIF (WIN32)
 
 IF (APPLE)
-	ADD_TARGET_LDFLAGS(avidemux3_jobs "-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon")
+	target_link_libraries(avidemux3_jobs "-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon")
 
 	# for Leopard but it doesn't hurt Tiger
-	ADD_TARGET_LDFLAGS(avidemux3_jobs "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib")
+	target_link_libraries(avidemux3_jobs "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib")
 ENDIF (APPLE)
 TARGET_LINK_LIBRARIES(avidemux3_jobs ADM_coreJobs)
 TARGET_LINK_LIBRARIES(avidemux3_jobs ADM_coreUtils6)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-12-12 07:32:36 UTC (rev 7697)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2011-12-13 09:07:01 UTC (rev 7698)
@@ -169,10 +169,10 @@
 		TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_libsdl)
 	ENDIF(USE_SDL)
 
-	ADD_TARGET_LDFLAGS(avidemux3_qt4 "-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon")
+	target_link_libraries(avidemux3_qt4 "-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon")
 
 	# for Leopard but it doesn't hurt Tiger
-	ADD_TARGET_LDFLAGS(avidemux3_qt4 "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib")
+	target_link_libraries(avidemux3_qt4 "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib")
 ENDIF (APPLE)
 #
 # Needed for cross compiling

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2011-12-12 07:32:36 UTC (rev 7697)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2011-12-13 09:07:01 UTC (rev 7698)
@@ -1,39 +1,39 @@
-SET(ADM_core_SRCS 
-	ADM_cpuCap.cpp  ADM_memsupport.cpp  ADM_threads.cpp  ADM_win32.cpp
-	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp
-        ADM_debug.cpp 
-        ADM_queue.cpp
-        ADM_benchmark.cpp
-)
-
-IF (MINGW)
-	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_mswin.cpp)
-ELSEIF (APPLE)
-	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_apple.cpp)
-ELSE (MINGW)
-	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_unix.cpp)
-ENDIF (MINGW)
-
-IF (NOT APPLE)
-	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_memcpy.cpp)
-ENDIF (NOT APPLE)
-
-ADM_ADD_SHARED_LIBRARY(ADM_core6 ${ADM_core_SRCS})
-ADD_TARGET_DEFINITIONS(ADM_core6 ADM_DEBUG FIND_LEAKS)
-
-IF (MINGW)
-	TARGET_LINK_LIBRARIES(ADM_core6 "${PTHREAD_LIBRARIES}" imagehlp ws2_32)
-	ADD_TARGET_CFLAGS(ADM_core6 "-I${PTHREAD_INCLUDE_DIR}")
-ELSEIF (APPLE)
-	ADD_TARGET_LDFLAGS(ADM_core6 "-framework Carbon")
-ENDIF (MINGW)
-
-if (HAVE_EXECINFO)
-	include_directories("${LIBEXECINFO_INCLUDE_DIR}")
-	target_link_libraries(ADM_core6 "${LIBEXECINFO_LIBRARY_DIR}")
-endif (HAVE_EXECINFO)
-
-REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)
-
-ADM_LINK_THREAD(ADM_core6)
-ADM_INSTALL_LIB(ADM_core6)
+SET(ADM_core_SRCS 
+	ADM_cpuCap.cpp  ADM_memsupport.cpp  ADM_threads.cpp  ADM_win32.cpp
+	ADM_memory.cpp  ADM_misc.cpp  TLK_clock.cpp  ADM_fileio.cpp ADM_dynamicLoading.cpp
+        ADM_debug.cpp 
+        ADM_queue.cpp
+        ADM_benchmark.cpp
+)
+
+IF (MINGW)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_mswin.cpp)
+ELSEIF (APPLE)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_apple.cpp)
+ELSE (MINGW)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_crashdump_unix.cpp)
+ENDIF (MINGW)
+
+IF (NOT APPLE)
+	SET(ADM_core_SRCS ${ADM_core_SRCS} ADM_memcpy.cpp)
+ENDIF (NOT APPLE)
+
+ADM_ADD_SHARED_LIBRARY(ADM_core6 ${ADM_core_SRCS})
+ADD_TARGET_DEFINITIONS(ADM_core6 ADM_DEBUG FIND_LEAKS)
+
+IF (MINGW)
+	TARGET_LINK_LIBRARIES(ADM_core6 "${PTHREAD_LIBRARIES}" imagehlp ws2_32)
+	ADD_TARGET_CFLAGS(ADM_core6 "-I${PTHREAD_INCLUDE_DIR}")
+ELSEIF (APPLE)
+	target_link_libraries(ADM_core6 "-framework Carbon")
+ENDIF (MINGW)
+
+if (HAVE_EXECINFO)
+	include_directories("${LIBEXECINFO_INCLUDE_DIR}")
+	target_link_libraries(ADM_core6 "${LIBEXECINFO_LIBRARY_DIR}")
+endif (HAVE_EXECINFO)
+
+REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)
+
+ADM_LINK_THREAD(ADM_core6)
+ADM_INSTALL_LIB(ADM_core6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/CMakeLists.txt	2011-12-12 07:32:36 UTC (rev 7697)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/CMakeLists.txt	2011-12-13 09:07:01 UTC (rev 7698)
@@ -1,38 +1,38 @@
-INCLUDE(admCheckFreeType)
-checkFreeType()
-
-IF(USE_FREETYPE)
-	INCLUDE(vf_plugin)
-
-	SET(srtCommon_SRCS 
-	  ADM_vidFont.cpp  ADM_vidSRT.cpp  ADM_vidSRTload.cpp  ADM_vidSRTRender.cpp  DIA_srt.cpp DIA_flySrtPos.cpp
-	)
-
-	INCLUDE(vf_plugin_gtk)
-	INCLUDE(vf_plugin_qt4)
-
-	SET(srtGtk_SRCS gtk/DIA_srt.cpp)
-	SET(srtQT_SRCS  qt4/Q_srt.cpp)
-	SET(srtQT_HEADERS  qt4/Q_srt.h)
-	SET(srtQT_UI    qt4/srt)
-
-	INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_sub_qt4 
-					${srtQT_SRCS} ${srtQT_HEADERS} ${srtQT_UI} ${srtCommon_SRCS})
-	INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_sub_gtk 
-					${srtGtk_SRCS} ${srtCommon_SRCS})
-
-	ADD_DEFINITIONS(${LIBICONV_DEFINITIONS})
-	ADD_SOURCE_CFLAGS(DIA_srt.cpp           "${FREETYPE2_CFLAGS}" )
-	ADD_SOURCE_CFLAGS(ADM_vidSRT.cpp        "${FREETYPE2_CFLAGS}" )
-	ADD_SOURCE_CFLAGS(ADM_vidFont.cpp       "${FREETYPE2_CFLAGS}" )
-	ADD_SOURCE_CFLAGS(ADM_vidSRTload.cpp    "${FREETYPE2_CFLAGS}   -I${LIBICONV_INCLUDE_DIR} ")
-	ADD_SOURCE_CFLAGS(ADM_vidSRTRender.cpp  "${FREETYPE2_CFLAGS}" )
-	
-	IF (GTK_FOUND AND GTHREAD_FOUND)
-		ADD_TARGET_LDFLAGS(ADM_vf_sub_gtk "${FREETYPE2_LDFLAGS} ${LIBICONV_LIBRARY_DIR}")
-	ENDIF (GTK_FOUND AND GTHREAD_FOUND)
-
-	IF (QT4_FOUND)
-		ADD_TARGET_LDFLAGS(ADM_vf_sub_qt4 "${FREETYPE2_LDFLAGS} ${LIBICONV_LIBRARY_DIR}")
-	ENDIF (QT4_FOUND)
+INCLUDE(admCheckFreeType)
+checkFreeType()
+
+IF(USE_FREETYPE)
+	INCLUDE(vf_plugin)
+
+	SET(srtCommon_SRCS 
+	  ADM_vidFont.cpp  ADM_vidSRT.cpp  ADM_vidSRTload.cpp  ADM_vidSRTRender.cpp  DIA_srt.cpp DIA_flySrtPos.cpp
+	)
+
+	INCLUDE(vf_plugin_gtk)
+	INCLUDE(vf_plugin_qt4)
+
+	SET(srtGtk_SRCS gtk/DIA_srt.cpp)
+	SET(srtQT_SRCS  qt4/Q_srt.cpp)
+	SET(srtQT_HEADERS  qt4/Q_srt.h)
+	SET(srtQT_UI    qt4/srt)
+
+	INIT_VIDEOFILTER_PLUGIN_QT4(ADM_vf_sub_qt4 
+					${srtQT_SRCS} ${srtQT_HEADERS} ${srtQT_UI} ${srtCommon_SRCS})
+	INIT_VIDEOFILTER_PLUGIN_GTK(  ADM_vf_sub_gtk 
+					${srtGtk_SRCS} ${srtCommon_SRCS})
+
+	ADD_DEFINITIONS(${LIBICONV_DEFINITIONS})
+	ADD_SOURCE_CFLAGS(DIA_srt.cpp           "${FREETYPE2_CFLAGS}" )
+	ADD_SOURCE_CFLAGS(ADM_vidSRT.cpp        "${FREETYPE2_CFLAGS}" )
+	ADD_SOURCE_CFLAGS(ADM_vidFont.cpp       "${FREETYPE2_CFLAGS}" )
+	ADD_SOURCE_CFLAGS(ADM_vidSRTload.cpp    "${FREETYPE2_CFLAGS}   -I${LIBICONV_INCLUDE_DIR} ")
+	ADD_SOURCE_CFLAGS(ADM_vidSRTRender.cpp  "${FREETYPE2_CFLAGS}" )
+	
+	IF (GTK_FOUND AND GTHREAD_FOUND)
+		target_link_libraries(ADM_vf_sub_gtk "${FREETYPE2_LDFLAGS} ${LIBICONV_LIBRARY_DIR}")
+	ENDIF (GTK_FOUND AND GTHREAD_FOUND)
+
+	IF (QT4_FOUND)
+		target_link_libraries(ADM_vf_sub_qt4 "${FREETYPE2_LDFLAGS} ${LIBICONV_LIBRARY_DIR}")
+	ENDIF (QT4_FOUND)
 ENDIF(USE_FREETYPE)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigHelper.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigHelper.cmake	2011-12-12 07:32:36 UTC (rev 7697)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigHelper.cmake	2011-12-13 09:07:01 UTC (rev 7698)
@@ -181,13 +181,3 @@
 		SET_TARGET_PROPERTIES(${_target} PROPERTIES COMPILE_FLAGS "${_flags}")
 	ENDIF (newflag)
 ENDMACRO (ADD_TARGET_DEFINITIONS)
-
-MACRO (ADD_TARGET_LDFLAGS _target)
-	SET(_flags)
-	APPEND_FLAGS(_flags ${ARGN})
-
-	TARGET_LINK_LIBRARIES(${_target} ${_flags})
-ENDMACRO (ADD_TARGET_LDFLAGS)
-
-#
-



From gruntster at mail.berlios.de  Thu Dec 15 12:09:12 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Dec 2011 12:09:12 +0100
Subject: [Avidemux-svn-commit] r7699 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_libraries cmake cmake/patches
Message-ID: <20111215110912.62371481347@sheep.berlios.de>

Author: gruntster
Date: 2011-12-15 12:09:11 +0100 (Thu, 15 Dec 2011)
New Revision: 7699

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.9.tar.bz2
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
Log:
[ffmpeg] upgrade ffmpeg to 0.9

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2
===================================================================
(Binary files differ)

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.9.tar.bz2 (from rev 7694, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ffmpeg-0.8.7.tar.bz2)
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 0.8.7)
+set(FFMPEG_VERSION 0.9)
 set(FFMPEG_SOURCE_ARCHIVE "ffmpeg-${FFMPEG_VERSION}.tar.bz2")
 set(FFMPEG_SOURCE_ARCHIVE_DIR "ffmpeg-${FFMPEG_VERSION}")
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2011-12-15 11:09:11 UTC (rev 7699)
@@ -2,7 +2,7 @@
 
 export curDir=$PWD
 export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
-export origFfmpegPath=../ffmpeg-0.8.7
+export origFfmpegPath=../ffmpeg-0.9
 
 function updatePatch {
 	#cd $ffmpegPath
@@ -30,11 +30,11 @@
 updatePatch libavcodec h263dec.c
 updatePatch libavcodec h264.c
 updatePatch libavcodec h264_parser.c
+updatePatch libavcodec libavcodec.v
 updatePatch libavcodec mpeg12.c
 updatePatch libavcodec mpeg12enc.c
 updatePatch libavcodec mpegvideo.c
 updatePatch libavcodec mpegvideo_enc.c
-updatePatch libavcodec utils.c
 updatePatch libavcodec vc1dec.c
 updatePatch libavformat isom.c
 updatePatch libavformat matroskaenc.c

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +1,15 @@
---- ../ffmpeg-0.8.7/libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
-+++ libavcodec/avcodec.h	2011-12-01 17:17:54 +0000
-@@ -620,6 +620,8 @@
- #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
- #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
- #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
+--- ../ffmpeg-0.9/libavcodec/avcodec.h	2011-12-14 15:00:28 +0000
++++ libavcodec/avcodec.h	2011-12-14 15:00:28 +0000
+@@ -690,6 +690,8 @@
+ #define CODEC_FLAG2_INTRA_VLC     0x00000800 ///< Use MPEG-2 intra VLC table.
+ #define CODEC_FLAG2_DROP_FRAME_TIMECODE 0x00002000 ///< timecode is in drop frame format.
+ #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
 +//MEANX: NEVER EVER USE CLOSED GOP ?
 +#define CODEC_FLAG2_32_PULLDOWN   0x80000000
- 
- /* Unsupported options :
-  *              Syntax Arithmetic coding (SAC)
-@@ -1595,6 +1597,7 @@
+ #endif
+ #if FF_API_MJPEG_GLOBAL_OPTS
+ #define CODEC_FLAG_EXTERN_HUFF     0x1000   ///< Use external Huffman table (for MJPEG).
+@@ -1806,6 +1808,7 @@
       * - decoding: unused
       */
      int rc_max_rate;
@@ -17,7 +17,7 @@
  
      /**
       * minimum bitrate
-@@ -1609,6 +1612,8 @@
+@@ -1820,6 +1823,8 @@
       * - decoding: unused
       */
      int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/ffv1.c	2011-06-23 20:23:53 +0100
-+++ libavcodec/ffv1.c	2011-06-23 20:23:53 +0100
-@@ -1783,6 +1783,8 @@
+--- ../ffmpeg-0.9/libavcodec/ffv1.c	2011-12-14 15:00:28 +0000
++++ libavcodec/ffv1.c	2011-12-14 15:00:28 +0000
+@@ -1724,6 +1724,8 @@
          clear_state(f);
      }else{
          p->key_frame= 0;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.6/libavcodec/h263dec.c	2011-11-16 20:43:49 +0000
-+++ libavcodec/h263dec.c	2011-11-16 20:43:49 +0000
-@@ -115,6 +115,25 @@
+--- ../ffmpeg-0.9/libavcodec/h263dec.c	2011-12-14 15:00:28 +0000
++++ libavcodec/h263dec.c	2011-12-14 15:00:28 +0000
+@@ -117,6 +117,25 @@
  
      return 0;
  }
@@ -26,27 +26,27 @@
  
  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
  {
-@@ -431,6 +450,12 @@
+@@ -433,6 +452,12 @@
      } else {
          ret = h263_decode_picture_header(s);
      }
 +	//MEANX we need to do it here also for quicktime file / ctts atom 
 +        // we need the correct frame type, and qt file may contain 
 +        // vop not coded frame.
-+        pict->pict_type=s->current_picture.pict_type= s->pict_type;
-+        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
++        pict->pict_type=s->current_picture.f.pict_type= s->pict_type;
++        pict->key_frame=s->current_picture.f.key_frame= s->pict_type == FF_I_TYPE;
 +        //MEANX
  
      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
  
-@@ -715,6 +740,12 @@
+@@ -717,6 +742,12 @@
  
- assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
- assert(s->current_picture.pict_type == s->pict_type);
+     assert(s->current_picture.f.pict_type == s->current_picture_ptr->f.pict_type);
+     assert(s->current_picture.f.pict_type == s->pict_type);
 +
 +/* MEANX */
 +    if(s->current_picture_ptr)
-+        s->current_picture_ptr->opaque=pict->opaque;
++        s->current_picture_ptr->f.opaque=pict->opaque;
 +/* MEANX */
 +
      if (s->pict_type == AV_PICTURE_TYPE_B || s->low_delay) {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,7 +1,7 @@
---- ../ffmpeg-0.8.6/libavcodec/h264.c	2011-11-13 16:42:34 +0000
-+++ libavcodec/h264.c	2011-11-13 16:42:33 +0000
-@@ -4250,6 +4250,20 @@
-     { FF_PROFILE_UNKNOWN },
+--- ../ffmpeg-0.9/libavcodec/h264.c	2011-12-14 15:00:28 +0000
++++ libavcodec/h264.c	2011-12-14 15:00:28 +0000
+@@ -4276,6 +4276,20 @@
+     LIBAVUTIL_VERSION_INT,
  };
  
 +/* MEANX */
@@ -19,5 +19,5 @@
 +/* MeanX */
 +
  AVCodec ff_h264_decoder = {
-     "h264",
-     AVMEDIA_TYPE_VIDEO,
+     .name           = "h264",
+     .type           = AVMEDIA_TYPE_VIDEO,

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_libavcodec.v.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -0,0 +1,11 @@
+--- ../ffmpeg-0.9/libavcodec/libavcodec.v	2011-12-14 15:00:29 +0000
++++ libavcodec/libavcodec.v	2011-12-14 15:00:28 +0000
+@@ -25,5 +25,8 @@
+                 ff_mmxext_idct;
+                 ff_idct_xvid*;
+                 ff_jpeg_fdct*;
++                ff_h264_info;
++				ff_golomb_vlc_len;
++				ff_ue_golomb_vlc_code;
+         local:  *;
+ };

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,14 +1,14 @@
---- ../ffmpeg-0.8/libavcodec/mpeg12.c	2011-06-23 20:23:54 +0100
-+++ libavcodec/mpeg12.c	2011-06-23 20:23:54 +0100
-@@ -1998,6 +1998,11 @@
+--- ../ffmpeg-0.9/libavcodec/mpeg12.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpeg12.c	2011-12-14 15:00:29 +0000
+@@ -1946,6 +1946,11 @@
          ff_er_frame_end(s);
  
          MPV_frame_end(s);
 +/* MEANX */
 +  if(s->current_picture_ptr)
-+      s->current_picture_ptr->opaque=pict->opaque;
++      s->current_picture_ptr->f.opaque=pict->opaque;
 +/* MEANX */
 +
  
          if (s->pict_type == AV_PICTURE_TYPE_B || s->low_delay) {
-             *pict= *(AVFrame*)s->current_picture_ptr;
+             *pict = *(AVFrame*)s->current_picture_ptr;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavcodec/mpeg12enc.c	2011-06-23 20:23:54 +0100
-+++ libavcodec/mpeg12enc.c	2011-06-23 20:23:54 +0100
-@@ -127,10 +127,19 @@
+--- ../ffmpeg-0.9/libavcodec/mpeg12enc.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpeg12enc.c	2011-12-14 15:00:29 +0000
+@@ -122,10 +122,19 @@
              s->frame_rate_index= i;
          }
      }
@@ -20,7 +20,7 @@
  }
  
  static av_cold int encode_init(AVCodecContext *avctx)
-@@ -209,6 +218,7 @@
+@@ -220,6 +229,7 @@
              put_sbits(&s->pb, 12, s->width );
              put_sbits(&s->pb, 12, s->height);
  
@@ -28,7 +28,7 @@
              for(i=1; i<15; i++){
                  float error= aspect_ratio;
                  if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
-@@ -223,20 +233,44 @@
+@@ -234,20 +244,44 @@
                      s->aspect_ratio_info= i;
                  }
              }
@@ -79,7 +79,7 @@
              else
                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
-@@ -269,8 +303,17 @@
+@@ -280,8 +314,17 @@
  
                  put_bits(&s->pb, 3, s->avctx->profile); //profile
                  put_bits(&s->pb, 4, s->avctx->level); //level
@@ -98,7 +98,7 @@
                  put_bits(&s->pb, 2, s->chroma_format);
                  put_bits(&s->pb, 2, s->width >>12);
                  put_bits(&s->pb, 2, s->height>>12);
-@@ -339,6 +382,8 @@
+@@ -346,6 +389,8 @@
  
  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
  {
@@ -107,7 +107,7 @@
      mpeg1_encode_sequence_header(s);
  
      /* mpeg1 picture header */
-@@ -375,6 +420,49 @@
+@@ -382,6 +427,49 @@
  
      s->frame_pred_frame_dct = 1;
      if(s->codec_id == CODEC_ID_MPEG2VIDEO){
@@ -144,7 +144,7 @@
 +                        tff=0; /* no repeat */
 +                } else 
 +                {
-+                        tff= s->current_picture_ptr->top_field_first;
++                        tff= s->current_picture_ptr->f.top_field_first;
 +                }
 +                rff=s->repeat_first_field;
 +        
@@ -157,24 +157,24 @@
          put_header(s, EXT_START_CODE);
          put_bits(&s->pb, 4, 8); //pic ext
          if (s->pict_type == AV_PICTURE_TYPE_P || s->pict_type == AV_PICTURE_TYPE_B) {
-@@ -393,11 +481,16 @@
+@@ -400,11 +488,16 @@
  
          assert(s->picture_structure == PICT_FRAME);
          put_bits(&s->pb, 2, s->picture_structure);
++
 +#if 0 //MEANX
-+
          if (s->progressive_sequence) {
              put_bits(&s->pb, 1, 0); /* no repeat */
          } else {
-             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
+             put_bits(&s->pb, 1, s->current_picture_ptr->f.top_field_first);
          }
 +#endif
-+         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
++        put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
 +
          /* XXX: optimize the generation of this flag with entropy
             measures */
          s->frame_pred_frame_dct = s->progressive_sequence;
-@@ -407,7 +500,10 @@
+@@ -414,7 +507,10 @@
          put_bits(&s->pb, 1, s->q_scale_type);
          put_bits(&s->pb, 1, s->intra_vlc_format);
          put_bits(&s->pb, 1, s->alternate_scan);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +1,24 @@
---- ../ffmpeg-0.8.4/libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
-+++ libavcodec/mpegvideo.c	2011-09-22 20:39:59 +0100
-@@ -737,7 +737,11 @@
-     FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
+--- ../ffmpeg-0.9/libavcodec/mpegvideo.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpegvideo.c	2011-12-14 15:00:29 +0000
+@@ -840,15 +840,18 @@
+         FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
  
-     s->parse_context.state= -1;
--    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-+ //MEANX: Allocate them always, as they may be free when we decode 1st image
+         s->parse_context.state = -1;
+-        if ((s->avctx->debug & (FF_DEBUG_VIS_QP | FF_DEBUG_VIS_MB_TYPE)) ||
+-            s->avctx->debug_mv) {
 +
-+    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-+if(1){ // MEANX
++        //MEANX: Allocate them always, as they may be free when we decode 1st image
 +
-        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
++        //if ((s->avctx->debug & (FF_DEBUG_VIS_QP | FF_DEBUG_VIS_MB_TYPE)) ||
++        //  s->avctx->debug_mv) {
+             s->visualization_buffer[0] = av_malloc((s->mb_width * 16 +
+                         2 * EDGE_WIDTH) * s->mb_height * 16 + 2 * EDGE_WIDTH);
+             s->visualization_buffer[1] = av_malloc((s->mb_width * 16 +
+                         2 * EDGE_WIDTH) * s->mb_height * 16 + 2 * EDGE_WIDTH);
+             s->visualization_buffer[2] = av_malloc((s->mb_width * 16 +
+                         2 * EDGE_WIDTH) * s->mb_height * 16 + 2 * EDGE_WIDTH);
+-        }
++        //}
+ 
+         s->context_initialized = 1;
+         s->thread_context[0]   = s;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8.5/libavcodec/mpegvideo_enc.c	2011-10-11 22:27:47 +0100
-+++ libavcodec/mpegvideo_enc.c	2011-10-11 22:27:47 +0100
-@@ -376,12 +376,14 @@
+--- ../ffmpeg-0.9/libavcodec/mpegvideo_enc.c	2011-12-14 15:00:29 +0000
++++ libavcodec/mpegvideo_enc.c	2011-12-14 15:00:29 +0000
+@@ -386,12 +386,14 @@
  
          av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
      }
@@ -15,7 +15,7 @@
  
      if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
          av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
-@@ -423,10 +425,12 @@
+@@ -437,10 +439,12 @@
          return -1;
      }
  

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,15 +0,0 @@
---- ../ffmpeg-0.8.7/libavcodec/utils.c	2011-12-01 17:17:55 +0000
-+++ libavcodec/utils.c	2011-12-01 17:17:55 +0000
-@@ -814,10 +814,12 @@
- 
-     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
-         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-+#if 0 // MEANX : Silence
-         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
-             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
-             return -1;
-         }
-+#endif
-         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
-         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
-             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,8 +1,8 @@
---- ../ffmpeg-0.8/libavcodec/vc1dec.c	2011-06-23 20:23:55 +0100
-+++ libavcodec/vc1dec.c	2011-06-23 20:23:55 +0100
-@@ -3587,6 +3587,11 @@
-         int mby_start;
-     } *slices = NULL;
+--- ../ffmpeg-0.9/libavcodec/vc1dec.c	2011-12-14 15:00:29 +0000
++++ libavcodec/vc1dec.c	2011-12-14 15:00:29 +0000
+@@ -5437,6 +5437,11 @@
+     if(s->flags & CODEC_FLAG_LOW_DELAY)
+         s->low_delay = 1;
  
 +	/** MEANX **/
 +	if(s->flags & CODEC_FLAG_LOW_DELAY)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,14 +1,15 @@
---- ../ffmpeg-0.8.4/libavformat/isom.c	2011-09-22 20:39:59 +0100
-+++ libavformat/isom.c	2011-09-22 20:39:59 +0100
-@@ -239,7 +239,10 @@
-     { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
-     { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
- 
--    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
-+    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
-+     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
-+     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
-+    // /MEANX
-     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
- 
- /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
+--- ../ffmpeg-0.9/libavformat/isom.c	2011-12-14 15:00:29 +0000
++++ libavformat/isom.c	2011-12-14 15:00:29 +0000
+@@ -241,7 +241,11 @@
+     { CODEC_ID_MACE6,           MKTAG('M', 'A', 'C', '6') },
+     { CODEC_ID_MP1,             MKTAG('.', 'm', 'p', '1') },
+     { CODEC_ID_MP2,             MKTAG('.', 'm', 'p', '2') },
+-    { CODEC_ID_MP3,             MKTAG('.', 'm', 'p', '3') },
++//MEANX
++  //{ CODEC_ID_MP3,             MKTAG('.', 'm', 'p', '3') },
++    { CODEC_ID_MP3,             MKTAG('m', 'p', '4', 'a') },
++    { CODEC_ID_MP2,             MKTAG('m', 'p', '4', 'a') },
++// /MEANX
+     { CODEC_ID_MP3,             0x6D730055                },
+     { CODEC_ID_NELLYMOSER,      MKTAG('n', 'm', 'o', 's') }, /* Flash Media Server */
+     { CODEC_ID_PCM_ALAW,        MKTAG('a', 'l', 'a', 'w') },

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,6 +1,6 @@
---- ../ffmpeg-0.8/libavformat/matroskaenc.c	2011-06-23 20:23:55 +0100
-+++ libavformat/matroskaenc.c	2011-06-23 20:23:55 +0100
-@@ -409,6 +409,7 @@
+--- ../ffmpeg-0.9/libavformat/matroskaenc.c	2011-12-14 15:00:29 +0000
++++ libavformat/matroskaenc.c	2011-12-14 15:00:29 +0000
+@@ -418,6 +418,7 @@
  
  static int put_xiph_codecpriv(AVFormatContext *s, AVIOContext *pb, AVCodecContext *codec)
  {
@@ -8,7 +8,7 @@
      uint8_t *header_start[3];
      int header_len[3];
      int first_header_size;
-@@ -433,6 +434,28 @@
+@@ -442,6 +443,28 @@
          avio_write(pb, header_start[j], header_len[j]);
  
      return 0;
@@ -37,7 +37,7 @@
  }
  
  static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
-@@ -537,6 +560,24 @@
+@@ -552,6 +575,24 @@
          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
  

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2011-12-13 09:07:01 UTC (rev 7698)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2011-12-15 11:09:11 UTC (rev 7699)
@@ -1,7 +1,7 @@
---- libavutil/avutil.h.old	2010-12-20 13:49:31 +0000
-+++ libavutil/avutil.h	2010-12-20 13:49:31 +0000
-@@ -26,6 +26,13 @@
-  * external API header
+--- ../ffmpeg-0.9/libavutil/avutil.h	2011-12-14 15:00:29 +0000
++++ libavutil/avutil.h	2011-12-14 15:00:29 +0000
+@@ -107,6 +107,13 @@
+  * @}
   */
  
 +/* MEANX
@@ -12,5 +12,5 @@
 +
 +
  
- #define AV_STRINGIFY(s)         AV_TOSTRING(s)
- #define AV_TOSTRING(s) #s
+ /**
+  * @defgroup preproc_misc Preprocessor String Macros



From mean at mail.berlios.de  Sat Dec 17 10:36:37 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 17 Dec 2011 10:36:37 +0100
Subject: [Avidemux-svn-commit] r7700 -
	branches/avidemux_2.5_branch_gruntster/cmake/patches
Message-ID: <20111217093637.7A3324829D2@sheep.berlios.de>

Author: mean
Date: 2011-12-17 10:36:36 +0100 (Sat, 17 Dec 2011)
New Revision: 7700

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff
Log:
[build] fix common.mak.diff with newer ffmpeg

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff	2011-12-15 11:09:11 UTC (rev 7699)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff	2011-12-17 09:36:36 UTC (rev 7700)
@@ -1,11 +1,11 @@
---- common.mak.orig	2011-06-21 21:29:25.000000000 +0200
-+++ common.mak	2011-07-23 08:46:48.027417188 +0200
-@@ -61,7 +61,7 @@
+--- common.mak.orig	2011-12-11 21:27:17.000000000 +0100
++++ common.mak	2011-12-17 10:24:21.135638772 +0100
+@@ -79,7 +79,7 @@
  FFLIBS    := $(FFLIBS-yes) $(FFLIBS)
  TESTPROGS += $(TESTPROGS-yes)
  
--FFEXTRALIBS := $(addprefix -l,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
-+FFEXTRALIBS := $(addprefix -lADM5,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
- FFLDFLAGS   := $(addprefix -Llib,$(ALLFFLIBS)) $(LDFLAGS)
+-FFEXTRALIBS := $(FFLIBS:%=-l%$(BUILDSUF)) $(EXTRALIBS)
++FFEXTRALIBS := $(FFLIBS:%=-lADM5%$(BUILDSUF)) $(EXTRALIBS)
  
- EXAMPLES  := $(addprefix $(SUBDIR),$(addsuffix -example$(EXESUF),$(EXAMPLES)))
+ EXAMPLES  := $(EXAMPLES:%=$(SUBDIR)%-example$(EXESUF))
+ OBJS      := $(sort $(OBJS:%=$(SUBDIR)%))



From gruntster at mail.berlios.de  Sun Dec 18 20:37:21 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 18 Dec 2011 20:37:21 +0100
Subject: [Avidemux-svn-commit] r7703 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src
Message-ID: <20111218193722.0E4F04828FC@sheep.berlios.de>

Author: gruntster
Date: 2011-12-18 20:37:21 +0100 (Sun, 18 Dec 2011)
New Revision: 7703

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
Log:
[apple] use a more elegant workaround for buggy llvm-link rather than disabling optimisations

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp	2011-12-17 15:13:06 UTC (rev 7702)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp	2011-12-18 19:37:21 UTC (rev 7703)
@@ -309,7 +309,7 @@
         return df;
 }
 #ifdef ADM_CPU_X86
-static uint64_t FUNNY_MANGLE(noise64);
+static uint64_t __attribute__((used)) FUNNY_MANGLE(noise64);
 static uint32_t computeDiffMMX(uint8_t  *s1,uint8_t *s2,uint32_t noise,uint32_t l)
 {
 uint32_t df=0;
@@ -596,9 +596,8 @@
 #ifdef ADM_CPU_X86
 static inline void yuv444_MMX(uint8_t *src,uint8_t *dst,int w,int h,int s)
 {
-static uint64_t FUNNY_MANGLE(mask);
-    mask=0x00ff000000ff0000LL;
-  //mask=0x0000ff000000ff00LL;
+static uint64_t __attribute__((used)) FUNNY_MANGLE(mask) = 0x00ff000000ff0000LL;
+
     __asm__(" movq "Mangle(mask)", %%mm7\n" ::);
     __asm__(" pxor %%mm6,%%mm6\n" ::);
     

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2011-12-17 15:13:06 UTC (rev 7702)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2011-12-18 19:37:21 UTC (rev 7703)
@@ -22,7 +22,6 @@
 ADM_ADD_SHARED_LIBRARY(ADM_coreImage6 ${ADM_coreImage_SRCS})
 ADD_SOURCE_CFLAGS(DIA_flyDialog.cpp " -DADM_UI_TYPE_BUILD=99")
 IF (APPLE)
-    SET_SOURCE_FILES_PROPERTIES("ADM_imageUtils.cpp" PROPERTIES COMPILE_FLAGS -O0)
     IF (NOT ADM_CPU_X86_64)
         TARGET_LINK_LIBRARIES(ADM_coreImage6 -Wl,-read_only_relocs,suppress)
     ENDIF (NOT ADM_CPU_X86_64)



From gruntster at mail.berlios.de  Mon Dec 19 23:03:52 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 19 Dec 2011 23:03:52 +0100
Subject: [Avidemux-svn-commit] r7704 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4:
	ADM_UIs/include ADM_UIs/src ADM_jobs/src ADM_userInterfaces
	ADM_userInterfaces/ADM_gui
Message-ID: <20111219220353.35CE848290B@sheep.berlios.de>

Author: gruntster
Date: 2011-12-19 23:03:52 +0100 (Mon, 19 Dec 2011)
New Revision: 7704

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
Log:
[apple] compilation fixes

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-12-18 19:37:21 UTC (rev 7703)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/T_openGL.h	2011-12-19 22:03:52 UTC (rev 7704)
@@ -14,16 +14,25 @@
  ***************************************************************************/
 #ifndef T_OPENGL_H
 #define T_OPENGL_H
-#define GL_GLEXT_PROTOTYPES
-#ifdef __APPLE__
-#	include <OpenGL/gl.h>
-#       include <OpenGL/glu.h>
-#	include <OpenGL/glext.h>
-#	define GL_TEXTURE_RECTANGLE_NV GL_TEXTURE_RECTANGLE_EXT
-#else
-#	include <GL/gl.h>
+#define GL_GLEXT_PROTOTYPES
+#ifdef __APPLE__
+#	include <OpenGL/gl.h>
+#   include <OpenGL/glu.h>
+#	include <OpenGL/glext.h>
+
+#	define GL_TEXTURE_RECTANGLE_NV GL_TEXTURE_RECTANGLE_EXT
+
+typedef void (* PFNGLACTIVETEXTUREPROC) (GLenum texture);
+typedef void (* PFNGLBINDBUFFERPROC) (GLenum target, GLuint buffer);
+typedef void (* PFNGLDELETEBUFFERSPROC) (GLsizei n, const GLuint *buffers);
+typedef void (* PFNGLGENBUFFERSPROC) (GLsizei n, GLuint *buffers);
+typedef GLvoid* (* PFNGLMAPBUFFERPROC) (GLenum target, GLenum access);
+typedef GLboolean (* PFNGLUNMAPBUFFERPROC) (GLenum target);
+typedef void (* PFNGLBUFFERDATAARBPROC) (GLenum target, GLsizeiptrARB size, const GLvoid *data, GLenum usage);
+#else
+#	include <GL/gl.h>
 #       include <GL/glu.h>
-#	include <GL/glext.h>
+#	include <GL/glext.h>
 #endif
 
 #include <QtOpenGL/QtOpenGL>

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-12-18 19:37:21 UTC (rev 7703)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_openGL.cpp	2011-12-19 22:03:52 UTC (rev 7704)
@@ -282,9 +282,8 @@
 #ifdef ADM_CPU_X86
 static inline void glYUV444_MMXInit(void)
 {
-   static uint64_t FUNNY_MANGLE(mask);
-    mask=0x00ff000000ff0000LL;
-  //mask=0x0000ff000000ff00LL;
+   static uint64_t __attribute__((used)) FUNNY_MANGLE(mask) = 0x00ff000000ff0000LL;
+
     __asm__(" movq "Mangle(mask)", %%mm7\n" ::);
 }
 static inline void glYUV444_MMX(const uint8_t *src, uint8_t *dst, const int width)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp	2011-12-18 19:37:21 UTC (rev 7703)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobs.cpp	2011-12-19 22:03:52 UTC (rev 7704)
@@ -122,8 +122,9 @@
 
 	// Start counting memory
 	ADM_memStatInit();
+#ifndef __APPLE__
     ADM_InitMemcpy();
-
+#endif
 	atexit(onexit);
 
 #ifdef __MINGW32__

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2011-12-18 19:37:21 UTC (rev 7703)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2011-12-19 22:03:52 UTC (rev 7704)
@@ -194,8 +194,13 @@
 #if defined(__WIN32)
 	xinfo->display=videoWindow->winId();
 #elif defined(__APPLE__)
-	xinfo->display = HIViewGetWindow(HIViewRef(widget->winId()));
-	xinfo->window = 0;
+	#if defined(ADM_CPU_X86_64)
+		xinfo->display = (void*)videoWindow->winId();
+		xinfo->window = 0;
+	#else
+		xinfo->display = HIViewGetWindow(HIViewRef(widget->winId()));
+		xinfo->window = 0;
+	#endif
 #else
     const QX11Info &info=videoWindow->x11Info();
     xinfo->display=info.display();

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-12-18 19:37:21 UTC (rev 7703)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-12-19 22:03:52 UTC (rev 7704)
@@ -136,7 +136,7 @@
 {
 	*handle = (intptr_t)QuiMainWindows;
 
-#if defined(__APPLE__)
+#if defined(__APPLE__) && !defined(ADM_CPU_X86_64)
 	*nativeHandle = (intptr_t)HIViewGetWindow(HIViewRef(QuiMainWindows->winId()));
 #else
 	*nativeHandle = (intptr_t)QuiMainWindows->winId();



From mean at mail.berlios.de  Wed Dec 21 10:30:08 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 21 Dec 2011 10:30:08 +0100
Subject: [Avidemux-svn-commit] r7705 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20111221093009.410E6481510@sheep.berlios.de>

Author: mean
Date: 2011-12-21 10:30:08 +0100 (Wed, 21 Dec 2011)
New Revision: 7705

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPtsDts.cpp
Log:
[editor] Be more tolerant regarding avc pts/dts scheme

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPtsDts.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPtsDts.cpp	2011-12-19 22:03:52 UTC (rev 7704)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPtsDts.cpp	2011-12-21 09:30:08 UTC (rev 7705)
@@ -316,9 +316,10 @@
     int n=listOfMissingPts.size();
     if(n)
     {
-        if(n>nbFrames/100)
+        if(n>nbFrames/20)
         {
-            ADM_warning("There is more than 1% unavailable PTS, wont even try...\n");
+            ADM_warning("There is more than 5%% unavailable PTS, wont even try (%d/%d)...\n",
+                            n,nbFrames);
             goto theEnd;
         }
         for(int i=0;i<n;i++)



From mean at mail.berlios.de  Wed Dec 21 10:30:11 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 21 Dec 2011 10:30:11 +0100
Subject: [Avidemux-svn-commit] r7706 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <20111221093011.EAAFA481510@sheep.berlios.de>

Author: mean
Date: 2011-12-21 10:30:11 +0100 (Wed, 21 Dec 2011)
New Revision: 7706

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPcm.cpp
Log:
[editor] audio : proper display of debug info

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPcm.cpp	2011-12-21 09:30:08 UTC (rev 7705)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edAudioPcm.cpp	2011-12-21 09:30:11 UTC (rev 7706)
@@ -174,7 +174,8 @@
     *samples=(decodedSample);
     *odts=lastDts;
     advanceDtsByCustomSample(decodedSample,outFrequency);
-    vprintf("[Composer::getPCMPacket] Adding %u decodedSample, dts is not %lu\n",fillerSample,lastDts);
+    vprintf("[Composer::getPCMPacket] Adding %u decoded, Adding %u filler sample, dts is now %lu\n",
+                                        decodedSample,fillerSample,lastDts);
     ADM_assert(sizeMax>=(fillerSample+decodedSample)*trk->wavheader.channels);
     return true;
 }



From mean at mail.berlios.de  Wed Dec 21 10:30:13 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 21 Dec 2011 10:30:13 +0100
Subject: [Avidemux-svn-commit] r7707 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:
	. asharp asharp/gtk asharp/qt4
Message-ID: <20111221093013.AD393481510@sheep.berlios.de>

Author: mean
Date: 2011-12-21 10:30:13 +0100 (Wed, 21 Dec 2011)
New Revision: 7707

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_json.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/asharp.ui
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
Log:
[asharp] Skeleton for asharp working with avidemux 2.6

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2011-12-21 09:30:11 UTC (rev 7706)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2011-12-21 09:30:13 UTC (rev 7707)
@@ -1,4 +1,5 @@
 ADD_SUBDIRECTORY(addBorder)
+ADD_SUBDIRECTORY(asharp)
 ADD_SUBDIRECTORY(ass)
 ADD_SUBDIRECTORY(blackenBorder)
 ADD_SUBDIRECTORY(changeFps)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,283 @@
+/**/
+/***************************************************************************
+                          ADM_vidASharp  -  description
+                             -------------------   
+    Port of avisynth one
+
+ ***************************************************************************/
+/*
+        
+        Copyright (C) 2003 Donald A. Graft
+        Copyright (C) 2002 Marc Fauconneau
+        This program is free software; you can redistribute it and/or modify
+        it under the terms of the GNU General Public License as published by
+        the Free Software Foundation.
+
+        This program is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+        GNU General Public License for more details.
+
+        You should have received a copy of the GNU General Public License
+        along with this program; if not, write to the Free Software
+        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+*/
+
+#include "DIA_flyDialog.h"
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "DIA_factory.h"
+#include "asharp.h"
+#include "asharp_desc.cpp"
+#define uc uint8_t
+/**
+    \class ASharp
+*/
+class ASharp : public ADM_coreVideoFilter
+{
+private:
+        
+        ADMImage        *original;
+        asharp          _param;
+        int32_t         T,D,B,B2;
+        
+public:    
+                        ASharp(ADM_coreVideoFilter *in,CONFcouple *couples)   ;
+                        ~ASharp();
+
+               void         update(void); 
+       virtual const char   *getConfiguration(void);          /// Return  current configuration as a human readable string
+       virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);    /// Return the next image
+	   virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+       virtual bool         configure(void) ;                 /// Start graphical user interface        
+};
+
+
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   ASharp,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_TYPE_BUILD,         // UI
+                        VF_SHARPNESS,            // Category
+                        "asharp",            // internal name (must be uniq!)
+                        "asharp",            // Display name
+                        QT_TR_NOOP("Adaptative sharpener by MarcFD.") // Description
+                    );
+
+void asharp_run_c(      uc* planeptr, int pitch,
+                                        int height, int width, 
+                                        int     T,int D, int B, int B2, bool bf );
+/**
+    \fn ASharp 
+    \brief ctor
+*/
+ASharp::ASharp(ADM_coreVideoFilter *in,CONFcouple *couples) : ADM_coreVideoFilter(in,couples)
+{
+        if(!couples || !ADM_paramLoad(couples,asharp_param,&_param))
+		{
+            // Default value
+            _param.t=2;
+            _param.d=4;
+            _param.b=-1;
+            _param.bf=false;
+        }
+        update();
+        original=new ADMImageDefault(info.width,info.height);
+}
+/**
+    \fn dtor 
+    \brief recompute parameters
+*/
+
+ASharp::~ASharp(void)
+{
+        if(original) delete original;     
+        original=NULL;
+}
+/**
+    \fn update 
+    \brief recompute parameters
+*/
+
+void ASharp::update( void)
+{
+                // parameters floating point to fixed point convertion
+                T = (int)(_param.t*(4<<7));
+                D = (int)(_param.d*(4<<7));
+                B = (int)(256-_param.b*64);
+                B2= (int)(256-_param.b*48);
+
+                // clipping (recommended for SIMD code)
+
+                if (T<-(4<<7)) T = -(4<<7); // yes, negatives values are accepted
+                if (D<0) D = 0;
+                if (B<0) B = 0;
+                if (B2<0) B2 = 0;
+
+                if (T>(32*(4<<7))) T = (32*(4<<7));
+                if (D>(16*(4<<7))) D = (16*(4<<7));
+                if (B>256) B = 256;
+                if (B2>256) B2 = 256;
+
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         ASharp::getCoupledConf(CONFcouple **couples)
+{
+    return ADM_paramSave(couples, asharp_param,&_param);
+}
+
+extern uint8_t DIA_getASharp(asharp *param, ADM_coreVideoFilter *in);
+
+/**
+    \fn configure
+*/
+bool ASharp::configure(void)
+{
+uint8_t r=0;
+#if 0
+        if( DIA_getASharp(&_param, previousFilter))
+        {
+                r=1;
+        }
+        update();
+        return r;
+#else
+    return true;
+#endif
+}
+/**
+    \fn getConfiguration
+*/
+const char   *ASharp::getConfiguration(void)   
+{
+    static char s[256];
+    snprintf(s,255,"Asharp by MarcFd");
+    return s;
+        
+}
+/**
+    \fn getNextFrame
+*/
+ bool         ASharp::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+ADMImage *src;
+ADMImage *dst;
+        dst=image;
+        src=original;
+
+        if(!previousFilter->getNextFrame(fn,src)) return false;
+
+        dst->duplicate(src);
+        asharp_run_c(     dst->GetWritePtr(PLANAR_Y),
+                        dst->GetPitch(PLANAR_Y), 
+                        info.height,
+                        info.width,
+                        T,
+                        D,
+                        B,
+                        B2,
+                        _param.bf);
+        return 1;
+}
+
+/**
+    \fn asharp_run_c
+*/
+void asharp_run_c(      uc* planeptr, int pitch,
+                                        int height, int width, 
+                                        int     T,int D, int B, int B2, bool bf )
+        {
+                uc* lineptr = new uc[width];
+                int p = pitch;
+                int y,x;
+                uc* cfp = planeptr+pitch;
+                uc* lp = lineptr;
+                memcpy(lp,planeptr,width);
+                for (y=1;y<height-1;y++) {
+                        int last = cfp[0];
+                        for (x=0;x<width-1;x++) {
+
+                                int avg = 0;
+                                int dev = 0;
+                                int T2;
+                                int diff;
+                                int tmp;
+
+                                avg += lp[x-1];
+                                avg += lp[x  ];
+                                avg += lp[x+1];
+                                avg += last;
+                                avg += cfp[x    ];
+                                avg += cfp[x  +1];
+                                avg += cfp[x+p-1];
+                                avg += cfp[x+p  ];
+                                avg += cfp[x+p+1];
+
+                                avg *= (65535/9);
+                                avg >>= 16;
+
+                                #define CHECK(A) \
+                                if (abs(A-cfp[x])>dev) dev = abs(A-cfp[x]);
+                                
+                                if (bf) {
+
+                                if (y%8>0) {
+                                        if (x%8>0) CHECK(lp[x-1])
+                                        CHECK(lp[x  ])
+                                        if (x%8<7) CHECK(lp[x+1])
+                                }
+                                if (x%8>0) CHECK(last)
+                                if (x%8<7) CHECK(cfp[x  +1])
+                                if (y%8<7) {
+                                        if (x%8>0) CHECK(cfp[x+p-1])
+                                        CHECK(cfp[x+p  ])
+                                        if (x%8<7) CHECK(cfp[x+p+1])
+                                }
+
+                                } else {
+                                        CHECK(lp[x-p-1])
+                                        CHECK(lp[x-p  ])
+                                        CHECK(lp[x-p+1])
+                                        CHECK(last)
+                                        CHECK(cfp[x  +1])
+                                        CHECK(cfp[x+p-1])
+                                        CHECK(cfp[x+p  ])
+                                        CHECK(cfp[x+p+1])
+                                }
+
+                                T2 = T;
+                                diff = cfp[x]-avg;
+                                int D2 = D;
+
+                                if (x%8==6) D2=(D2*B2)>>8;
+                                if (x%8==7) D2=(D2*B)>>8;
+                                if (x%8==0) D2=(D2*B)>>8;
+                                if (x%8==1) D2=(D2*B2)>>8;
+                                if (y%8==6) D2=(D2*B2)>>8;
+                                if (y%8==7) D2=(D2*B)>>8;
+                                if (y%8==0) D2=(D2*B)>>8;
+                                if (y%8==1) D2=(D2*B2)>>8;
+
+                                int Da = -32+(D>>7);
+                                if (D>0) T2 = ((((dev<<7)*D2)>>16)+Da)<<4;
+
+                                if (T2>T) T2=T;
+                                if (T2<-32) T2=-32;
+
+                                tmp = (((diff<<7)*T2)>>16)+cfp[x];
+
+                                if (tmp < 0) tmp = 0;
+                                if (tmp > 255) tmp = 255;
+                                lp[x-1] = last;
+                                last = cfp[x];
+                                cfp[x] = tmp;
+                        }
+                        lp[x] = cfp[x];
+                        cfp += pitch;
+                }
+        delete[] lineptr;
+} 
+//**********************************

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/CMakeLists.txt	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,26 @@
+INCLUDE(vf_plugin)
+
+
+SET(asharpCommon_SRCS 
+ADM_vidAsharp.cpp  DIA_flyAsharp.cpp
+)
+# ---------- QT4 Version ----------------
+INCLUDE(vf_plugin_qt4)
+SET(asharpQT_SRCS  qt4/Q_asharp.cpp)
+SET(asharpQT_HEADERS  qt4/Q_asharp.h)
+SET(asharpQT_UI    qt4/asharp)
+INIT_VIDEO_FILTER_QT4(ADM_vf_asharpQt4 ${asharpQT_SRCS} ${asharpQT_HEADERS} ${asharpQT_UI} ${asharpCommon_SRCS})
+# /QT4
+
+
+#------------- Gtk Version ---------------
+INCLUDE(vf_plugin_gtk)
+SET(asharpGtk_SRCS gtk/DIA_asharp.cpp)
+INIT_VIDEO_FILTER_GTK(ADM_vf_asharpGtk ${asharpGtk_SRCS} ${asharpCommon_SRCS})
+
+#------------ Cli Version ----------------
+#INCLUDE(vf_plugin_cli)
+#SET(CropCli_SRCS cli/DIA_crop.cpp)
+#INIT_VIDEO_FILTER_CLI(  ADM_vf_CropCli ${CropCli_SRCS} ${CropCommon_SRCS})
+#%%%%%%%%%%%%%%%%%%
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,101 @@
+/**/
+/***************************************************************************
+                          DIA_Asharp
+                             -------------------
+
+                           Ui for Asharp
+
+    begin                : 08 Apr 2005
+    copyright            : (C) 2004/5 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "DIA_flyDialog.h"
+#include "ADM_default.h"
+#include "ADM_image.h"
+
+
+#include "asharp.h"
+#include "DIA_flyAsharp.h"
+
+
+/************* COMMON PART *********************/
+/**
+    \fn update
+*/
+uint8_t  flyASharp::update(void)
+{
+    download();
+    process();
+//	copyYuvFinalToRgb();
+//    display();
+    return 1;
+}
+/**
+    \fn process
+*/
+uint8_t flyASharp::process(void)
+{
+#if 0
+uint8_t *src,*dst;
+uint32_t stride;
+int32_t T,D,B,B2;
+uint32_t ww,hh;
+
+
+                ww=_w;
+                hh=_h;
+                // parameters floating point to fixed point convertion
+                T = (int)(param.t*(4<<7));
+                D = (int)(param.d*(4<<7));
+                B = (int)(256-param.b*64);
+                B2= (int)(256-param.b*48);
+
+                // clipping (recommended for SIMD code)
+
+                if (T<-(4<<7)) T = -(4<<7); // yes, negatives values are accepted
+                if (D<0) D = 0;
+                if (B<0) B = 0;
+                if (B2<0) B2 = 0;
+
+                if (T>(32*(4<<7))) T = (32*(4<<7));
+                if (D>(16*(4<<7))) D = (16*(4<<7));
+                if (B>256) B = 256;
+                if (B2>256) B2 = 256;
+
+
+                memcpy(YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),ww*hh);
+                memcpy(UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),ww*hh/4);
+                memcpy(VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),ww*hh/4);
+                asharp_run_c(     _yuvBufferOut->GetWritePtr(PLANAR_Y),
+                        _yuvBufferOut->GetPitch(PLANAR_Y), 
+                        hh,
+                        ww,
+                        T,
+                        D,
+                        B,
+                        B2,
+                        param.bf);
+    
+    // Copy back half source to display
+    dst=_yuvBufferOut->data;
+    src=_yuvBuffer->data;
+    stride=ww;
+    for(uint32_t y=0;y<hh;y++)   // We do both u & v!
+    {
+        memcpy(dst,src,stride>>1);
+        dst+=stride;
+        src+=stride;
+    }
+#endif
+    return 1;
+}
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,29 @@
+
+
+#ifndef FLY_ASHARP_H
+#define FLY_ASHARP_H
+/**
+    \class flyASharp
+*/
+#include "asharp.h"
+#define uc uint8_t
+class flyASharp : public FLY_DIALOG_TYPE
+{
+  
+  public:
+   asharp     param;
+  public:
+   uint8_t    process(void);
+   uint8_t    download(void);
+   uint8_t    upload(void);
+   uint8_t    update(void);
+   flyASharp (uint32_t width,uint32_t height,ADM_coreVideoFilter *in,
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,1,RESIZE_AUTO) {};
+};
+
+void asharp_run_c(      uc* planeptr, int pitch,
+                                        int height, int width, 
+                                        int     T,int D, int B, int B2, bool bf );
+
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.conf	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.conf	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,6 @@
+asharp{
+float:t // Threshold 0:nothing max : 5 ?
+float:d // Strength : 0 means nothing, >0  adaptative t is maximum
+float:b // Block adaptative sharpening -1 disabled
+bool:bf;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp.h	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,10 @@
+// automatically generated by admSerialization.py do not edit
+#ifndef ADM_asharp_CONF_H
+#define ADM_asharp_CONF_H
+typedef struct {
+float t;
+float d;
+float b;
+bool bf;
+}asharp;
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_desc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_desc.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,8 @@
+// automatically generated by admSerialization.py, do not edit!
+extern const ADM_paramList asharp_param[]={
+ {"t",offsetof(asharp,t),"float",ADM_param_float},
+ {"d",offsetof(asharp,d),"float",ADM_param_float},
+ {"b",offsetof(asharp,b),"float",ADM_param_float},
+ {"bf",offsetof(asharp,bf),"bool",ADM_param_bool},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_json.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/asharp_json.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,21 @@
+// automatically generated by admSerialization.py, do not edit!
+#include "ADM_default.h"
+#include "ADM_paramList.h"
+#include "ADM_coreJson.h"
+#include "asharp.h"
+bool  asharp_jserialize(const char *file, const asharp *key){
+admJson json;
+json.addFloat("t",key->t);
+json.addFloat("d",key->d);
+json.addFloat("b",key->b);
+json.addBool("bf",key->bf);
+return json.dumpToFile(file);
+};
+bool  asharp_jdeserialize(const char *file, const ADM_paramList *tmpl,asharp *key){
+admJsonToCouple json;
+CONFcouple *c=json.readFromFile(file);
+if(!c) {ADM_error("Cannot read json file");return false;}
+bool r= ADM_paramLoadPartial(c,tmpl,key);
+delete c;
+return r;
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,295 @@
+/**/
+/***************************************************************************
+                          DIA_hue
+                             -------------------
+
+                           Ui for hue & sat
+
+    begin                : 08 Apr 2005
+    copyright            : (C) 2004/5 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+
+#include "ADM_toolkitGtk.h"
+
+
+#include "ADM_image.h"
+#include "ADM_videoFilter.h"
+#include "ADM_vidASharp_param.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyAsharp.h"
+
+
+uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
+
+static GtkWidget        *create_dialog1 (void);
+static gboolean         draw (void );
+static void             upload(void);
+static void             download(void);
+static void             frame_changed( void );
+static void             hue_changed( void);
+
+static int lock=0;
+static GtkWidget *dialog=NULL;
+static flyASharp *myCrop=NULL;
+
+//
+//      Video is in YV12 Colorspace
+//
+//
+uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in)
+{
+      uint32_t width,height;
+      uint8_t ret=0;
+        // Allocate space for green-ised video
+        width=in->getInfo()->width;
+        height=in->getInfo()->height;
+
+        dialog=create_dialog1();
+		gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
+									GTK_RESPONSE_OK,
+									GTK_RESPONSE_CANCEL,
+									-1);
+        gtk_register_dialog(dialog);
+        gtk_window_set_title (GTK_WINDOW (dialog), QT_TR_NOOP("ASHARP"));
+        gtk_widget_show(dialog);
+
+        gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), "expose_event",
+            GTK_SIGNAL_FUNC(draw),
+            NULL);
+//
+        gtk_signal_connect(GTK_OBJECT(WID(hscale1)), "value_changed",GTK_SIGNAL_FUNC(frame_changed),   NULL);
+        gtk_signal_connect(GTK_OBJECT(WID(spinbuttonT)), "value_changed",GTK_SIGNAL_FUNC(hue_changed),   NULL);
+        gtk_signal_connect(GTK_OBJECT(WID(spinbuttonD)), "value_changed",GTK_SIGNAL_FUNC(hue_changed),   NULL);
+        gtk_signal_connect(GTK_OBJECT(WID(spinbuttonB)), "value_changed",GTK_SIGNAL_FUNC(hue_changed),   NULL);
+        gtk_widget_show(dialog);
+
+          
+        myCrop=new flyASharp( width, height,in,WID(drawingarea1),WID(hscale1));
+        memcpy(&(myCrop->param),param,sizeof(ASHARP_PARAM));
+        myCrop->upload();
+        myCrop->sliderChanged();
+        ret=0;
+        int response;
+        response=gtk_dialog_run(GTK_DIALOG(dialog));
+
+        if(response==GTK_RESPONSE_OK)
+        {
+            myCrop->download();
+            memcpy(param,&(myCrop->param),sizeof(ASHARP_PARAM));
+            ret=1;
+        }
+        gtk_unregister_dialog(dialog);
+        gtk_widget_destroy(dialog);
+        delete myCrop;
+        return ret;
+}
+void hue_changed( void)
+{
+  if(lock) return;
+  
+   myCrop->update();
+  
+}
+void frame_changed( void )
+{
+  myCrop->sliderChanged();
+}
+gboolean draw (void)
+{
+    myCrop->display();
+}
+//
+#define SPIN_GET(x,y) {param.x= gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(y))) ;}
+#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(y)),(gfloat)param.x) ;}
+
+#define CHECK_GET(x,y) {param.x=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(y)));}
+#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(y)),param.x);}
+
+void upload( void)
+{
+    myCrop->upload();
+}
+void download (void)
+{
+     myCrop->download();
+}
+/**************************************/
+uint8_t flyASharp::upload(void)
+{
+    lock++;
+        SPIN_SET(t,spinbuttonT);
+        SPIN_SET(d,spinbuttonD);
+        SPIN_SET(b,spinbuttonB);
+
+        CHECK_SET(bf,checkbuttonBF);
+    lock--;
+        return 1;
+}
+uint8_t flyASharp::download (void)
+{
+    
+        SPIN_GET(t,spinbuttonT);
+        SPIN_GET(d,spinbuttonD);
+        SPIN_GET(b,spinbuttonB);
+
+        CHECK_GET(bf,checkbuttonBF);
+        return 1;
+}
+
+/**************************************************/
+GtkWidget*
+create_dialog1 (void)
+{
+  GtkWidget *dialog1;
+  GtkWidget *dialog_vbox1;
+  GtkWidget *vbox1;
+  GtkWidget *table1;
+  GtkWidget *label1;
+  GtkWidget *label2;
+  GtkWidget *label3;
+  GtkWidget *label4;
+  GtkObject *spinbuttonT_adj;
+  GtkWidget *spinbuttonT;
+  GtkObject *spinbuttonD_adj;
+  GtkWidget *spinbuttonD;
+  GtkObject *spinbuttonB_adj;
+  GtkWidget *spinbuttonB;
+  GtkWidget *checkbuttonBF;
+  GtkWidget *hscale1;
+  GtkWidget *drawingarea1;
+  GtkWidget *dialog_action_area1;
+  GtkWidget *cancelbutton1;
+  GtkWidget *okbutton1;
+
+  dialog1 = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("ASharp by MarcFD"));
+
+  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
+  gtk_widget_show (dialog_vbox1);
+
+  vbox1 = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (vbox1);
+  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
+
+  table1 = gtk_table_new (4, 2, FALSE);
+  gtk_widget_show (table1);
+  gtk_box_pack_start (GTK_BOX (vbox1), table1, TRUE, TRUE, 0);
+
+  label1 = gtk_label_new (QT_TR_NOOP("Threshold :"));
+  gtk_widget_show (label1);
+  gtk_table_attach (GTK_TABLE (table1), label1, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
+  gtk_misc_set_alignment (GTK_MISC (label1), 0, 0.5);
+
+  label2 = gtk_label_new (QT_TR_NOOP("Strength :"));
+  gtk_widget_show (label2);
+  gtk_table_attach (GTK_TABLE (table1), label2, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
+  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
+
+  label3 = gtk_label_new (QT_TR_NOOP("Block Adaptative :"));
+  gtk_widget_show (label3);
+  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
+  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
+
+  label4 = gtk_label_new (QT_TR_NOOP("Unknown flag :"));
+  gtk_widget_show (label4);
+  gtk_table_attach (GTK_TABLE (table1), label4, 0, 1, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_label_set_justify (GTK_LABEL (label4), GTK_JUSTIFY_LEFT);
+  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
+
+  spinbuttonT_adj = gtk_adjustment_new (1, -1, 100, 0.5, 0.1, 0.1);
+  spinbuttonT = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonT_adj), 1, 1);
+  gtk_widget_show (spinbuttonT);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonT, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonT), TRUE);
+
+  spinbuttonD_adj = gtk_adjustment_new (1, -1, 100, 0.5, 0.1, 0.1);
+  spinbuttonD = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonD_adj), 1, 1);
+  gtk_widget_show (spinbuttonD);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonD, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonD), TRUE);
+
+  spinbuttonB_adj = gtk_adjustment_new (1, -1, 100, 0.5, 0.1, 0.1);
+  spinbuttonB = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonB_adj), 1, 1);
+  gtk_widget_show (spinbuttonB);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonB, 1, 2, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonB), TRUE);
+
+  checkbuttonBF = gtk_check_button_new_with_mnemonic (QT_TR_NOOP(" "));
+  gtk_widget_show (checkbuttonBF);
+  gtk_table_attach (GTK_TABLE (table1), checkbuttonBF, 1, 2, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  hscale1 = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 100, 1, 1, 1)));
+  gtk_widget_show (hscale1);
+  gtk_box_pack_start (GTK_BOX (vbox1), hscale1, TRUE, TRUE, 0);
+
+  drawingarea1 = gtk_drawing_area_new ();
+  gtk_widget_show (drawingarea1);
+  gtk_box_pack_start (GTK_BOX (vbox1), drawingarea1, TRUE, TRUE, 0);
+
+  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
+  gtk_widget_show (dialog_action_area1);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
+
+  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
+  gtk_widget_show (cancelbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
+
+  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
+  gtk_widget_show (okbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
+  GLADE_HOOKUP_OBJECT (dialog1, vbox1, "vbox1");
+  GLADE_HOOKUP_OBJECT (dialog1, table1, "table1");
+  GLADE_HOOKUP_OBJECT (dialog1, label1, "label1");
+  GLADE_HOOKUP_OBJECT (dialog1, label2, "label2");
+  GLADE_HOOKUP_OBJECT (dialog1, label3, "label3");
+  GLADE_HOOKUP_OBJECT (dialog1, label4, "label4");
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonT, "spinbuttonT");
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonD, "spinbuttonD");
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonB, "spinbuttonB");
+  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonBF, "checkbuttonBF");
+  GLADE_HOOKUP_OBJECT (dialog1, hscale1, "hscale1");
+  GLADE_HOOKUP_OBJECT (dialog1, drawingarea1, "drawingarea1");
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
+  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
+  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
+
+  return dialog1;
+}
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,130 @@
+/***************************************************************************
+                          DIA_crop.cpp  -  description
+                             -------------------
+
+			    GUI for cropping including autocrop
+			    +Revisted the Gtk2 way
+			     +Autocrop now in RGB space (more accurate)
+
+    begin                : Fri May 3 2002
+    copyright            : (C) 2002/2007 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "Q_asharp.h"
+#include "ADM_toolkitQt.h"
+
+//
+//	Video is in YV12 Colorspace
+//
+//
+  Ui_asharpWindow::Ui_asharpWindow(QWidget *parent,  asharp *param, ADM_coreVideoFilter *in) : QDialog(parent)
+  {
+    uint32_t width,height;
+        ui.setupUi(this);
+        lock=0;
+        // Allocate space for green-ised video
+        width=in->getInfo()->width;
+        height=in->getInfo()->height;
+
+        canvas=new ADM_QCanvas(ui.graphicsView,width,height);
+        
+        myCrop=new flyASharp( width, height,in,canvas,ui.horizontalSlider);
+        memcpy(&(myCrop->param),param,sizeof(asharp));
+        myCrop->_cookie=&ui;
+        myCrop->upload();
+        myCrop->sliderChanged();
+
+
+        connect( ui.horizontalSlider,SIGNAL(valueChanged(int)),this,SLOT(sliderUpdate(int)));
+#define SPINNER(x) connect( ui.doubleSpinBox##x,SIGNAL(valueChanged(int)),this,SLOT(valueChanged(int))); 
+          SPINNER(Treshold);
+          SPINNER(Strength);
+          SPINNER(Block);
+          connect( ui.checkBox,SIGNAL(stateChanged(int)),this,SLOT(valueChanged(int))); 
+
+  }
+  void Ui_asharpWindow::sliderUpdate(int foo)
+  {
+    myCrop->sliderChanged();
+  }
+  void Ui_asharpWindow::gather(asharp *param)
+  {
+    
+        myCrop->download();
+        memcpy(param,&(myCrop->param),sizeof(asharp));
+  }
+Ui_asharpWindow::~Ui_asharpWindow()
+{
+  if(myCrop) delete myCrop;
+  myCrop=NULL; 
+  if(canvas) delete canvas;
+  canvas=NULL;
+}
+void Ui_asharpWindow::valueChanged( int f )
+{
+  if(lock) return;
+  lock++;
+  myCrop->update();
+  lock--;
+}
+
+#define MYSPIN(x) w->doubleSpinBox##x
+//************************
+uint8_t flyASharp::upload(void)
+{
+      Ui_asharpDialog *w=(Ui_asharpDialog *)_cookie;
+
+        MYSPIN(Treshold)->setValue(param.t);
+        MYSPIN(Strength)->setValue(param.d);
+        MYSPIN(Block)->setValue(param.b);
+        
+        //w->bf->w->checkBox->isChecked();
+        w->checkBox->setChecked(param.bf);
+
+        return 1;
+}
+uint8_t flyASharp::download(void)
+{
+       Ui_asharpDialog *w=(Ui_asharpDialog *)_cookie;
+       param.t= MYSPIN(Treshold)->value();
+       param.d= MYSPIN(Strength)->value();
+       param.b= MYSPIN(Block)->value();
+       
+       //w->spinBoxBottom->setValue(bottom);
+       param.bf=w->checkBox->isChecked();
+}
+
+/**
+      \fn     DIA_getCropParams
+      \brief  Handle crop dialog
+*/
+uint8_t DIA_getASharp(asharp *param, ADM_coreVideoFilter *in)
+{
+        uint8_t ret=0;
+        
+        Ui_asharpWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&dialog);
+
+        if(dialog.exec()==QDialog::Accepted)
+        {
+            dialog.gather(param); 
+            ret=1;
+        }
+
+		qtUnregisterDialog(&dialog);
+        return ret;
+}
+//____________________________________
+// EOF
+
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/Q_asharp.h	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,31 @@
+#ifndef Q_asharp_h
+#define Q_asharp_h
+
+#include "ui_asharp.h"
+#include "DIA_flyDialog.h"
+#include "ADM_image.h"
+#include "DIA_flyDialogQt4.h"
+#include "DIA_flyAsharp.h"
+
+class Ui_asharpWindow : public QDialog
+{
+	Q_OBJECT
+
+protected: 
+	int lock;
+
+public:
+	flyASharp *myCrop;
+	ADM_QCanvas *canvas;
+	Ui_asharpWindow(QWidget *parent, asharp *param, ADM_coreVideoFilter *in);
+	~Ui_asharpWindow();
+	Ui_asharpDialog ui;
+
+public slots:
+	void gather(asharp *param);
+
+private slots:
+	void sliderUpdate(int foo);
+	void valueChanged(int foo);
+};
+#endif	// Q_asharp_h

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/asharp.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/asharp.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/qt4/asharp.ui	2011-12-21 09:30:13 UTC (rev 7707)
@@ -0,0 +1,180 @@
+<ui version="4.0" >
+ <class>asharpDialog</class>
+ <widget class="QDialog" name="asharpDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>481</width>
+    <height>454</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>ASharp</string>
+  </property>
+  <layout class="QGridLayout" >
+   <property name="leftMargin" >
+    <number>9</number>
+   </property>
+   <property name="topMargin" >
+    <number>9</number>
+   </property>
+   <property name="rightMargin" >
+    <number>9</number>
+   </property>
+   <property name="bottomMargin" >
+    <number>9</number>
+   </property>
+   <property name="horizontalSpacing" >
+    <number>6</number>
+   </property>
+   <property name="verticalSpacing" >
+    <number>6</number>
+   </property>
+   <item row="3" column="3" >
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>40</width>
+       <height>20</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item row="2" column="3" >
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>40</width>
+       <height>20</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item row="1" column="3" >
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>40</width>
+       <height>20</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item row="0" column="3" >
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>40</width>
+       <height>20</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item row="4" column="0" colspan="4" >
+    <widget class="QSlider" name="horizontalSlider" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+    </widget>
+   </item>
+   <item row="6" column="1" colspan="3" >
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+   <item row="5" column="0" colspan="4" >
+    <widget class="QGraphicsView" name="graphicsView" />
+   </item>
+   <item row="1" column="0" >
+    <widget class="QLabel" name="label_2" >
+     <property name="text" >
+      <string>Strength</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="0" >
+    <widget class="QLabel" name="label" >
+     <property name="text" >
+      <string>Threshold</string>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="0" colspan="2" >
+    <widget class="QLabel" name="label_3" >
+     <property name="text" >
+      <string>Block Adaptative</string>
+     </property>
+    </widget>
+   </item>
+   <item row="3" column="0" colspan="3" >
+    <widget class="QCheckBox" name="checkBox" >
+     <property name="text" >
+      <string>Unknown flag</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="2" >
+    <widget class="QDoubleSpinBox" name="doubleSpinBoxTreshold" />
+   </item>
+   <item row="1" column="2" >
+    <widget class="QDoubleSpinBox" name="doubleSpinBoxStrength" />
+   </item>
+   <item row="2" column="2" >
+    <widget class="QDoubleSpinBox" name="doubleSpinBoxBlock" />
+   </item>
+  </layout>
+ </widget>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>accepted()</signal>
+   <receiver>asharpDialog</receiver>
+   <slot>accept()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>248</x>
+     <y>254</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>157</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>asharpDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From mean at mail.berlios.de  Wed Dec 21 10:30:15 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 21 Dec 2011 10:30:15 +0100
Subject: [Avidemux-svn-commit] r7708 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp
Message-ID: <20111221093015.25896481510@sheep.berlios.de>

Author: mean
Date: 2011-12-21 10:30:14 +0100 (Wed, 21 Dec 2011)
New Revision: 7708

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h
Log:
[asharp] Better dialog

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/ADM_vidAsharp.cpp	2011-12-21 09:30:14 UTC (rev 7708)
@@ -37,7 +37,7 @@
 {
 private:
         
-        ADMImage        *original;
+        
         asharp          _param;
         int32_t         T,D,B,B2;
         
@@ -82,7 +82,7 @@
             _param.bf=false;
         }
         update();
-        original=new ADMImageDefault(info.width,info.height);
+        
 }
 /**
     \fn dtor 
@@ -91,8 +91,7 @@
 
 ASharp::~ASharp(void)
 {
-        if(original) delete original;     
-        original=NULL;
+        
 }
 /**
     \fn update 
@@ -137,7 +136,7 @@
 bool ASharp::configure(void)
 {
 uint8_t r=0;
-#if 0
+#if 1
         if( DIA_getASharp(&_param, previousFilter))
         {
                 r=1;
@@ -163,15 +162,13 @@
 */
  bool         ASharp::getNextFrame(uint32_t *fn,ADMImage *image)
 {
-ADMImage *src;
 ADMImage *dst;
+
         dst=image;
-        src=original;
+        
+        if(!previousFilter->getNextFrame(fn,dst)) return false;
 
-        if(!previousFilter->getNextFrame(fn,src)) return false;
-
-        dst->duplicate(src);
-        asharp_run_c(     dst->GetWritePtr(PLANAR_Y),
+        asharp_run_c(   dst->GetWritePtr(PLANAR_Y),
                         dst->GetPitch(PLANAR_Y), 
                         info.height,
                         info.width,

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp	2011-12-21 09:30:13 UTC (rev 7707)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.cpp	2011-12-21 09:30:14 UTC (rev 7708)
@@ -33,8 +33,8 @@
 */
 uint8_t  flyASharp::update(void)
 {
-    download();
-    process();
+//    download();
+//    process();
 //	copyYuvFinalToRgb();
 //    display();
     return 1;
@@ -42,17 +42,17 @@
 /**
     \fn process
 */
-uint8_t flyASharp::process(void)
+uint8_t    flyASharp::processYuv(ADMImage* in, ADMImage *out)
 {
-#if 0
+
 uint8_t *src,*dst;
-uint32_t stride;
+uint32_t sstride,dstride;
 int32_t T,D,B,B2;
 uint32_t ww,hh;
 
 
-                ww=_w;
-                hh=_h;
+                ww=in->GetWidth(PLANAR_Y);
+                hh=in->GetHeight(PLANAR_Y);
                 // parameters floating point to fixed point convertion
                 T = (int)(param.t*(4<<7));
                 D = (int)(param.d*(4<<7));
@@ -71,12 +71,10 @@
                 if (B>256) B = 256;
                 if (B2>256) B2 = 256;
 
-
-                memcpy(YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),ww*hh);
-                memcpy(UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),ww*hh/4);
-                memcpy(VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),ww*hh/4);
-                asharp_run_c(     _yuvBufferOut->GetWritePtr(PLANAR_Y),
-                        _yuvBufferOut->GetPitch(PLANAR_Y), 
+                out->duplicateFull(in);
+                asharp_run_c(     
+                        out->GetWritePtr(PLANAR_Y),
+                        out->GetPitch(PLANAR_Y), 
                         hh,
                         ww,
                         T,
@@ -86,16 +84,26 @@
                         param.bf);
     
     // Copy back half source to display
-    dst=_yuvBufferOut->data;
-    src=_yuvBuffer->data;
-    stride=ww;
+    dst=out->GetWritePtr(PLANAR_Y);
+    src=in->GetReadPtr(PLANAR_Y);
+    sstride=in->GetPitch(PLANAR_Y);
+    dstride=out->GetPitch(PLANAR_Y);
     for(uint32_t y=0;y<hh;y++)   // We do both u & v!
     {
-        memcpy(dst,src,stride>>1);
-        dst+=stride;
-        src+=stride;
+        memcpy(dst,src,ww/2);
+        dst+=dstride;
+        src+=sstride;
     }
-#endif
+    // add separator
+    dst=out->GetWritePtr(PLANAR_Y)+ww/2;
+    for(int j=0;j<hh/2;j++)
+    {
+        dst[0]=0;
+        dst[dstride]=0xff;
+        dst+=dstride*2;
+    }
+    out->printString(1,1,"Original");
+    out->printString(ww/20+1,1,"Processed");
     return 1;
 }
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h	2011-12-21 09:30:13 UTC (rev 7707)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/DIA_flyAsharp.h	2011-12-21 09:30:14 UTC (rev 7708)
@@ -13,7 +13,8 @@
   public:
    asharp     param;
   public:
-   uint8_t    process(void);
+    uint8_t    processYuv(ADMImage* in, ADMImage *out);
+
    uint8_t    download(void);
    uint8_t    upload(void);
    uint8_t    update(void);



From mean at mail.berlios.de  Tue Dec 27 18:41:20 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 27 Dec 2011 18:41:20 +0100
Subject: [Avidemux-svn-commit] r7709 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec
Message-ID: <20111227174120.CE1884812FC@sheep.berlios.de>

Author: mean
Date: 2011-12-27 18:41:20 +0100 (Tue, 27 Dec 2011)
New Revision: 7709

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
Log:
[lav audio encoder] Proper display name

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2011-12-21 09:30:14 UTC (rev 7708)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2011-12-27 17:41:20 UTC (rev 7709)
@@ -5,15 +5,15 @@
 	SET(ADM_ae_lav_${_ext}_SRCS audioencoder_lavcodec.cpp)
 
 	ADD_AUDIO_ENCODER(ADM_ae_lav_${_ext} ${ADM_ae_lav_${_ext}_SRCS})
-	ADD_TARGET_CFLAGS(ADM_ae_lav_${_ext} "-DADM_AE_SET=${_ext}")
+	ADD_TARGET_CFLAGS(ADM_ae_lav_${_ext} "-include ADM_lav_${_ext}.h")
 	TARGET_LINK_LIBRARIES(ADM_ae_lav_${_ext}  ADM_libavcodec ADM_libavutil)
 
 	INIT_AUDIO_ENCODER(ADM_ae_lav_${_ext})
 	INSTALL_AUDIOENCODER(ADM_ae_lav_${_ext})
 
 ENDMACRO(DEFINE_LAV _ext)
+#====
 
 	DEFINE_LAV(mp2)
 	DEFINE_LAV(ac3)
 	DEFINE_LAV(aac)
-#====

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2011-12-21 09:30:14 UTC (rev 7708)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2011-12-27 17:41:20 UTC (rev 7709)
@@ -27,14 +27,6 @@
 #include "DIA_coreToolkit.h"
 #include "audioencoder.h"
 #include "audioencoderInternal.h"
-
-#if ADM_AE_SET == mp2
-#include "ADM_lav_mp2.h"
-#elif ADM_AE_SET == ac3
-#include "ADM_lav_ac3.h"
-#elif ADM_AE_SET == aac
-#include "ADM_lav_aac.h"
-#endif
 
 #include "audioencoder_lavcodec.h"
 



From mean at mail.berlios.de  Tue Dec 27 18:41:21 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 27 Dec 2011 18:41:21 +0100
Subject: [Avidemux-svn-commit] r7710 - in branches/avidemux_2.6_branch_mean:
	avidemux_plugins/ADM_audioEncoders
	avidemux_plugins/ADM_audioEncoders/dcaenc cmake
Message-ID: <20111227174122.0F7094812FC@sheep.berlios.de>

Author: mean
Date: 2011-12-27 18:41:21 +0100 (Tue, 27 Dec 2011)
New Revision: 7710

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_json.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake
Log:
[dtsenc] skeleton for dtsenc audio encoder (not working)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt	2011-12-27 17:41:20 UTC (rev 7709)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/CMakeLists.txt	2011-12-27 17:41:21 UTC (rev 7710)
@@ -19,4 +19,7 @@
 ADD_SUBDIRECTORY(faac)
 endif(USE_FAAC)
 
+if(USE_DCAENC)
+ADD_SUBDIRECTORY(dcaenc)
+endif(USE_DCAENC)
 

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/CMakeLists.txt	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,12 @@
+	INCLUDE(ae_plugin)
+
+	SET(ADM_ae_dcaenc_SRCS audioencoder_dcaenc.cpp )
+
+	ADD_AUDIO_ENCODER(ADM_ae_dcaenc ${ADM_ae_dcaenc_SRCS})
+
+	TARGET_LINK_LIBRARIES(ADM_ae_dcaenc ${DCAENC_LIBRARY_DIR})
+
+	ADD_TARGET_CFLAGS(ADM_ae_dcaenc "-I${DCAENC_INCLUDE_DIR}")
+
+	INIT_AUDIO_ENCODER(ADM_ae_dcaenc)
+	INSTALL_AUDIOENCODER(ADM_ae_dcaenc)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.cpp	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,250 @@
+/***************************************************************************
+        \file audioencoder_dcaenc.cpp
+        \brief Avidemux audio encoder plugin, front end for dcaenc
+    copyright            : (C) 2011/2012 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "ADM_default.h"
+#include "DIA_factory.h"
+#include "DIA_coreToolkit.h"
+#include "audioencoder.h"
+#include "audioencoderInternal.h"
+
+extern "C"
+{
+#include <dcaenc.h>
+}
+#include "audioencoder_dcaenc.h"
+#include "dcaencoder.h"
+static dcaencoder config={300};
+static uint32_t dcaencBitrate=300;
+
+#define BLOCK_SIZE 1024
+
+extern "C"
+{
+static bool configure (void);
+static bool setOption(const char *paramName, uint32_t value);
+};
+/********************* Declare Plugin *****************************************************/
+ADM_DECLARE_AUDIO_ENCODER_PREAMBLE(AUDMEncoder_DcaEnc);
+
+static ADM_audioEncoder encoderDesc = {
+  ADM_AUDIO_ENCODER_API_VERSION,
+  create,			// Defined by macro automatically
+  destroy,			// Defined by macro automatically
+  configure,		//** put your own function here**
+  "DcaEnc",
+  "DTS (dcaenc)",
+  "DCA encoder plugin Mean 2009",
+  6,                    // Max channels
+  1,0,0,                // Version
+  WAV_DTS,              // WavTag
+  200,                  // Priority
+  getConfigurationData,  // Defined by macro automatically
+  setConfigurationData,  // Defined by macro automatically
+
+  getBitrate,           // Defined by macro automatically
+  setBitrate,            // Defined by macro automatically
+
+  setOption,         //** put your own function here**
+
+  NULL
+};
+ADM_DECLARE_AUDIO_ENCODER_CONFIG(NULL,NULL,dcaencBitrate);
+
+/******************* / Declare plugin*******************************************************/
+#define MYFLAGS (lame_global_flags *)lameFlags
+/**
+    \fn AUDMEncoder_DcaEnc Constructor
+    \brief
+*/
+AUDMEncoder_DcaEnc::AUDMEncoder_DcaEnc (AUDMAudioFilter * instream,bool globalHeader):ADM_AudioEncoder  (instream)
+{
+  ADM_info ("[dcaenc] Creating lame\n");
+  context = NULL;
+  wavheader.encoding = WAV_DTS;
+};
+
+/**
+    \fn AUDMEncoder_DcaEnc
+    \brief Destructor
+*/
+
+AUDMEncoder_DcaEnc::~AUDMEncoder_DcaEnc ()
+{
+
+  ADM_info ("[dcaenc] Deleting ...\n");
+  if (context)
+    {
+        dcaenc_destroy(context,NULL);
+    }
+  context = NULL;
+};
+
+
+/**
+    \fn initialize
+dcaenc    @return 1 on success, 0 on error
+*/
+
+bool AUDMEncoder_DcaEnc::initialize (void)
+{
+  int chan_config=0;
+  switch(wavheader.channels)
+  {
+    case 1: chan_config=DCAENC_CHANNELS_MONO;break;
+    case 2: chan_config=DCAENC_CHANNELS_STEREO;break;
+    default:
+         ADM_warning("Unsupported channel configuration \n");
+         break;
+  }
+  context=dcaenc_create(wavheader.frequency,chan_config,config.bitrate*1000,DCAENC_FLAG_BIGENDIAN
+                            );
+
+  if(!context)
+  {
+      ADM_warning("Cannot create dcaenc context   \n");
+      return false;
+  }
+  inputSize=dcaenc_input_size(context);
+  outputSize=dcaenc_output_size(context);
+  ADM_info("Converting %d samples to %d bytes\n",inputSize,outputSize);
+  return true;
+}
+/**
+    \fn isVBR
+    @return 1 if the stream is vbr, 0 is cbr
+
+*/
+bool AUDMEncoder_DcaEnc::isVBR (void)
+{
+    return false;
+
+}
+/**
+    \fn dither32
+    \brief convert float to signed int32, format wanted by dcaenc
+*/
+static void dither32(float *s,int nb,int channels)
+{
+    float shift=(1LL<<32)-1;
+    for(int i=0;i<nb;i++)
+    {
+        float f=s[i];
+        f*=shift;
+        s[i]=(int32_t )f;
+    }
+}
+/**
+    \fn send
+    \brief Encode a block
+*/
+int AUDMEncoder_DcaEnc::send(uint32_t nbSample, uint8_t *dest)
+{
+
+  int nbout;
+  dither32 (&(tmpbuffer[tmphead]), nbSample, wavheader.channels);
+  ADM_assert (tmptail >= tmphead);
+  int32_t *sample32=(int32_t *)& (tmpbuffer[tmphead]);
+  int r=dcaenc_convert_s32(context,sample32,dest);
+  if(r<0)
+  {
+    ADM_warning("Error while converting (%d)\n",r);
+    return 0;
+  }
+  return outputSize;
+}
+/**
+    \fn encode
+    \brief Get an encoded dca packet
+    @param dest [in] Where to write datas
+    @param len  [out] Length of encoded datas in bytes
+    @param samples [out] Number of samples
+    @return true on success, false on error
+
+*/
+bool AUDMEncoder_DcaEnc::encode(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+
+  int32_t nbout;
+  int neededSamples=inputSize*wavheader.channels;
+  *samples = inputSize;	//FIXME
+  *len = 0;
+  if(AudioEncoderStopped==_state)
+        return false;
+
+    refillBuffer (neededSamples);
+    if(AudioEncoderNoInput==_state)
+    {
+        int left=tmptail-tmphead;
+        if (left < neededSamples)
+        {
+            if(left)
+            {
+                nbout=send(left,dest);
+                tmphead=tmptail;
+                ADM_info("[dcaenc]Sending last packet\n");
+                goto cont;
+            }
+              // Flush
+              _state=AudioEncoderStopped;
+              // flush pad with 0n todo
+              if(nbout<0)
+              {
+                    ADM_warning("Error while flushing dcaenc\n");
+                    return false;
+              }
+
+              *len=nbout;
+              *samples=inputSize;
+              ADM_info("[dcaenc] Flushing, last block is %d bytes\n",nbout);
+              return true;
+    }
+  }
+  nbout=send(neededSamples,dest);
+  tmphead += neededSamples;
+cont:
+  if (nbout < 0)
+    {
+      printf ("[dcaenc] Error !!! : %"LD"\n", nbout);
+      return false;
+    }
+  *len = nbout;
+  if (!*len)
+    *samples =0;
+  else
+    *samples=inputSize;
+  return true;
+}
+/**
+      \fn configure
+      \brief Dialog to set lame settings
+      @return 1 on success, 0 on failure
+
+*/
+#define QT_TR_NOOP(x) x
+
+bool configure (void)
+{
+  return true;
+}
+/**
+     \fn setOption
+     \brief Allow giving codec specific options as string+value
+*/
+bool setOption(const char *paramName, uint32_t value)
+{
+    return true;
+}
+// EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/audioencoder_dcaenc.h	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,41 @@
+
+/***************************************************************************
+    \file audioencoder_dcaenc.h
+    copyright            : (C) 2011/2012 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef AUDMaudioDCAENC_H
+#define AUDMaudioDCAENC_H
+ /**
+        \class AUDMEncoder_DcaEnc
+        \brief Front end for libDcaEnc
+*/
+class AUDMEncoder_DcaEnc : public ADM_AudioEncoder
+{
+  protected:
+    dcaenc_context    context;
+
+    int                 inputSize;
+    int                 outputSize;
+
+                      int send(uint32_t nbSample, uint8_t *dest);
+  public:
+    virtual             ~AUDMEncoder_DcaEnc();
+                        AUDMEncoder_DcaEnc(AUDMAudioFilter *instream,bool globalHeader);
+            bool	    isVBR(void );
+
+   virtual bool         encode(uint8_t *dest, uint32_t *len, uint32_t *samples);
+   virtual bool         initialize(void);
+           bool         provideAccurateSample(void) {return false;}
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.conf	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.conf	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,3 @@
+dcaencoder{
+uint32_t:bitrate
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder.h	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,7 @@
+// automatically generated by admSerialization.py do not edit
+#ifndef ADM_dcaencoder_CONF_H
+#define ADM_dcaencoder_CONF_H
+typedef struct {
+uint32_t bitrate;
+}dcaencoder;
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_desc.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_desc.cpp	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,5 @@
+// automatically generated by admSerialization.py, do not edit!
+extern const ADM_paramList dcaencoder_param[]={
+ {"bitrate",offsetof(dcaencoder,bitrate),"uint32_t",ADM_param_uint32_t},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_json.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_json.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/dcaenc/dcaencoder_json.cpp	2011-12-27 17:41:21 UTC (rev 7710)
@@ -0,0 +1,18 @@
+// automatically generated by admSerialization.py, do not edit!
+#include "ADM_default.h"
+#include "ADM_paramList.h"
+#include "ADM_coreJson.h"
+#include "dcaencoder.h"
+bool  dcaencoder_jserialize(const char *file, const dcaencoder *key){
+admJson json;
+json.addUint32("bitrate",key->bitrate);
+return json.dumpToFile(file);
+};
+bool  dcaencoder_jdeserialize(const char *file, const ADM_paramList *tmpl,dcaencoder *key){
+admJsonToCouple json;
+CONFcouple *c=json.readFromFile(file);
+if(!c) {ADM_error("Cannot read json file");return false;}
+bool r= ADM_paramLoadPartial(c,tmpl,key);
+delete c;
+return r;
+};

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake	2011-12-27 17:41:20 UTC (rev 7709)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckAudioEncoderLibs.cmake	2011-12-27 17:41:21 UTC (rev 7710)
@@ -76,7 +76,35 @@
 APPEND_SUMMARY_LIST("Audio Encoder" "LAME" "${USE_LAME}")
 MESSAGE("")
 
+########################################
+# DCAENC
+########################################
+OPTION(DCAENC "" ON)
 
+MESSAGE(STATUS "Checking for DCAENC")
+MESSAGE(STATUS "*******************")
+
+IF (DCAENC)
+	IF (UNIX)
+		SET(DCAENC_REQUIRED_FLAGS "-lm")
+	ENDIF (UNIX)
+
+	FIND_HEADER_AND_LIB(DCAENC dcaenc.h  dcaenc dcaenc_create ${DCAENC_REQUIRED_FLAGS})
+	PRINT_LIBRARY_INFO("DCAENC" DCAENC_FOUND "${DCAENC_INCLUDE_DIR}" "${DCAENC_LIBRARY_DIR}")
+
+	IF (DCAENC_FOUND)
+		SET(USE_DCAENC 1)
+	ENDIF (DCAENC_FOUND)
+ELSE (DCAENC)
+	MESSAGE("${MSG_DISABLE_OPTION}")
+ENDIF (DCAENC)
+
+APPEND_SUMMARY_LIST("Audio Encoder" "DCAENC" "${USE_DCAENC}")
+MESSAGE("")
+
+
+
+
 ########################################
 # FAAC
 ########################################



From mean at mail.berlios.de  Wed Dec 28 07:46:33 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 28 Dec 2011 07:46:33 +0100
Subject: [Avidemux-svn-commit] r7711 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk
Message-ID: <20111228064633.C7DC1481339@sheep.berlios.de>

Author: mean
Date: 2011-12-28 07:46:33 +0100 (Wed, 28 Dec 2011)
New Revision: 7711

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp
Log:
[asharp/gtk] Disable UI so that it compiles

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp	2011-12-27 17:41:21 UTC (rev 7710)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/asharp/gtk/DIA_asharp.cpp	2011-12-28 06:46:33 UTC (rev 7711)
@@ -18,20 +18,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
-
-
 #include "ADM_toolkitGtk.h"
-
-
 #include "ADM_image.h"
-#include "ADM_videoFilter.h"
-#include "ADM_vidASharp_param.h"
+#include "ADM_coreVideoFilterInternal.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyAsharp.h"
 
 
-uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
+uint8_t DIA_getASharp(asharp *param, ADM_coreVideoFilter *in);
 
 static GtkWidget        *create_dialog1 (void);
 static gboolean         draw (void );
@@ -48,7 +42,8 @@
 //      Video is in YV12 Colorspace
 //
 //
-uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in)
+#if 0
+uint8_t DIA_getASharp(asharp *param, ADM_coreVideoFilter *in)
 {
       uint32_t width,height;
       uint8_t ret=0;
@@ -292,4 +287,9 @@
 
   return dialog1;
 }
-
+#endif
+uint8_t DIA_getASharp(asharp *param, ADM_coreVideoFilter *in)
+{
+    return 1;
+}
+// EOF
\ No newline at end of file



From gruntster at mail.berlios.de  Wed Dec 28 10:44:42 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 28 Dec 2011 10:44:42 +0100
Subject: [Avidemux-svn-commit] r7712 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_core/include avidemux/ADM_coreImage/src
	plugins/ADM_videoFilters/FluxSmooth
	plugins/ADM_videoFilters/ResampleFps
Message-ID: <20111228094442.8C37F481339@sheep.berlios.de>

Author: gruntster
Date: 2011-12-28 10:44:42 +0100 (Wed, 28 Dec 2011)
New Revision: 7712

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt
Log:
[apple] use a more elegant workaround for compilation errors rather than disabling optimisations

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h	2011-12-28 06:46:33 UTC (rev 7711)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h	2011-12-28 09:44:42 UTC (rev 7712)
@@ -25,7 +25,7 @@
 #        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    else
 #        define MANGLE(a) "_" #a
-#        define FUNNY_MANGLE(x) x asm(MANGLE(x))
+#        define FUNNY_MANGLE(x) __attribute__((used)) x asm(MANGLE(x))
 #        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    endif
 #else
@@ -35,7 +35,7 @@
 #        define FUNNY_MANGLE_ARRAY(x, y)  x[y] asm(#x)
 #    else
 #        define MANGLE(a) #a
-#        define FUNNY_MANGLE(x) x asm(MANGLE(x))
+#        define FUNNY_MANGLE(x) __attribute__((used)) x asm(MANGLE(x))
 #        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    endif
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/CMakeLists.txt	2011-12-28 06:46:33 UTC (rev 7711)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/CMakeLists.txt	2011-12-28 09:44:42 UTC (rev 7712)
@@ -1,38 +1,31 @@
-SET(ADM_coreImage_SRCS 
-	ADM_confCouple.cpp  
-        ADM_videoFilter.cpp  
-        ADM_videoFilterCache.cpp
-        ADM_image.cpp  
-        ADM_imageUtils.cpp
-        ADM_imageResizer.cpp
-        yuv.cpp
-        rgb2yuv.cpp
-        ADM_colorspace.cpp
-        ADM_rgb.cpp
-        ADM_pp.cpp
-        ADM_print.cpp
-        ADM_vidFieldUtil.cpp
-        ADM_vidFields.cpp
-        ADM_vidFieldASM.cpp
-        ADM_vidFieldBlend.cpp
-        ADM_interlaceUtil.cpp
-        DIA_flyDialog.cpp
-)
-
-ADD_LIBRARY(ADM_coreImage SHARED ${ADM_coreImage_SRCS})
-ADD_SOURCE_CFLAGS(DIA_flyDialog.cpp " -DADM_UI_TYPE_BUILD=99")
-
-IF (APPLE)
-    SET_SOURCE_FILES_PROPERTIES("ADM_imageUtils.cpp" PROPERTIES COMPILE_FLAGS -O0)
-    SET_SOURCE_FILES_PROPERTIES("ADM_vidFieldASM.cpp" PROPERTIES COMPILE_FLAGS -O0)
-    SET_SOURCE_FILES_PROPERTIES("ADM_vidFieldBlend.cpp" PROPERTIES COMPILE_FLAGS -O0)
-
-    IF (NOT ADM_CPU_X86_64)
-        TARGET_LINK_LIBRARIES(ADM_coreImage -Wl,-read_only_relocs,suppress)
-    ENDIF (NOT ADM_CPU_X86_64)
-
-ENDIF (APPLE)
-
-TARGET_LINK_LIBRARIES(ADM_coreImage ADM_core ADM_coreUI ADM_libswscale ADM_libpostproc)
-add_dependencies(ADM_coreImage ffmpeg)
-INSTALL(TARGETS ADM_coreImage RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib${LIB_SUFFIX}  ARCHIVE DESTINATION lib${LIB_SUFFIX})
+SET(ADM_coreImage_SRCS 
+	ADM_confCouple.cpp  
+        ADM_videoFilter.cpp  
+        ADM_videoFilterCache.cpp
+        ADM_image.cpp  
+        ADM_imageUtils.cpp
+        ADM_imageResizer.cpp
+        yuv.cpp
+        rgb2yuv.cpp
+        ADM_colorspace.cpp
+        ADM_rgb.cpp
+        ADM_pp.cpp
+        ADM_print.cpp
+        ADM_vidFieldUtil.cpp
+        ADM_vidFields.cpp
+        ADM_vidFieldASM.cpp
+        ADM_vidFieldBlend.cpp
+        ADM_interlaceUtil.cpp
+        DIA_flyDialog.cpp
+)
+
+ADD_LIBRARY(ADM_coreImage SHARED ${ADM_coreImage_SRCS})
+ADD_SOURCE_CFLAGS(DIA_flyDialog.cpp " -DADM_UI_TYPE_BUILD=99")
+
+IF (APPLE AND NOT ADM_CPU_X86_64)
+    TARGET_LINK_LIBRARIES(ADM_coreImage -Wl,-read_only_relocs,suppress)
+ENDIF (APPLE AND NOT ADM_CPU_X86_64)
+
+TARGET_LINK_LIBRARIES(ADM_coreImage ADM_core ADM_coreUI ADM_libswscale ADM_libpostproc)
+add_dependencies(ADM_coreImage ffmpeg)
+INSTALL(TARGETS ADM_coreImage RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib${LIB_SUFFIX}  ARCHIVE DESTINATION lib${LIB_SUFFIX})

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt	2011-12-28 06:46:33 UTC (rev 7711)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/FluxSmooth/CMakeLists.txt	2011-12-28 09:44:42 UTC (rev 7712)
@@ -1,16 +1,13 @@
-INCLUDE(vf_plugin)
-
-
-SET(ADM_vf_FluxSmooth_SRCS ADM_vidFlux.cpp)
-
-ADD_LIBRARY(ADM_vf_FluxSmooth SHARED ${ADM_vf_FluxSmooth_SRCS})
-
-IF (APPLE)
-         ADD_SOURCE_CFLAGS("ADM_vidFlux.cpp" "-O0")
-         IF (NOT ADM_CPU_X86_64)
-	        TARGET_LINK_LIBRARIES(ADM_vf_FluxSmooth -Wl,-read_only_relocs,suppress)
-         ENDIF (NOT ADM_CPU_X86_64)
-ENDIF (APPLE)
-
-INIT_VIDEOFILTER_PLUGIN(ADM_vf_FluxSmooth)
-INSTALL_VIDEOFILTER(ADM_vf_FluxSmooth)
+INCLUDE(vf_plugin)
+
+
+SET(ADM_vf_FluxSmooth_SRCS ADM_vidFlux.cpp)
+
+ADD_LIBRARY(ADM_vf_FluxSmooth SHARED ${ADM_vf_FluxSmooth_SRCS})
+
+IF (APPLE AND NOT ADM_CPU_X86_64)
+	TARGET_LINK_LIBRARIES(ADM_vf_FluxSmooth -Wl,-read_only_relocs,suppress)
+ENDIF (APPLE AND NOT ADM_CPU_X86_64)
+
+INIT_VIDEOFILTER_PLUGIN(ADM_vf_FluxSmooth)
+INSTALL_VIDEOFILTER(ADM_vf_FluxSmooth)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt	2011-12-28 06:46:33 UTC (rev 7711)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ResampleFps/CMakeLists.txt	2011-12-28 09:44:42 UTC (rev 7712)
@@ -1,16 +1,13 @@
-INCLUDE(vf_plugin)
-
-
-SET(ADM_vf_resampleFps_SRCS ADM_vidResampleFPS.cpp)
-
-ADD_LIBRARY(ADM_vf_resampleFps SHARED ${ADM_vf_resampleFps_SRCS})
-
-IF (APPLE)
-        ADD_SOURCE_CFLAGS("ADM_vidResampleFPS.cpp" "-O0")
-        IF (NOT ADM_CPU_X86_64)
-	        TARGET_LINK_LIBRARIES(ADM_vf_resampleFps -Wl,-read_only_relocs,suppress)
-        ENDIF (NOT ADM_CPU_X86_64)
-ENDIF (APPLE)
-
-INIT_VIDEOFILTER_PLUGIN(ADM_vf_resampleFps)
-INSTALL_VIDEOFILTER(ADM_vf_resampleFps)
+INCLUDE(vf_plugin)
+
+
+SET(ADM_vf_resampleFps_SRCS ADM_vidResampleFPS.cpp)
+
+ADD_LIBRARY(ADM_vf_resampleFps SHARED ${ADM_vf_resampleFps_SRCS})
+
+IF (APPLE AND NOT ADM_CPU_X86_64)
+	TARGET_LINK_LIBRARIES(ADM_vf_resampleFps -Wl,-read_only_relocs,suppress)
+ENDIF (APPLE AND NOT ADM_CPU_X86_64)
+
+INIT_VIDEOFILTER_PLUGIN(ADM_vf_resampleFps)
+INSTALL_VIDEOFILTER(ADM_vf_resampleFps)



From gruntster at mail.berlios.de  Wed Dec 28 15:51:50 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 28 Dec 2011 15:51:50 +0100
Subject: [Avidemux-svn-commit] r7713 - in
	branches/avidemux_2.5_branch_gruntster: cmake
	plugins/ADM_audioEncoders/lavcodec
Message-ID: <20111228145150.6EC09481358@sheep.berlios.de>

Author: gruntster
Date: 2011-12-28 15:51:49 +0100 (Wed, 28 Dec 2011)
New Revision: 7713

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
Log:
[ac3] ffmpeg ac3 encoding is broken because the default encoder expects floats.  Explicitly use 16-bit encoder instead since that's what we're feeding it.

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-28 09:44:42 UTC (rev 7712)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2011-12-28 14:51:49 UTC (rev 7713)
@@ -14,7 +14,7 @@
 set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flac  flv  fraps  h263  h264  huffyuv
 					 mjpeg  mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow  svq3
 					 theora  tscc  vc1  vp3  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
-set(FFMPEG_ENCODERS  ac3  ac3_fixed  ac3_float  dvvideo  ffv1  ffvhuff  flv  h263  huffyuv  mjpeg  mp2  mpeg1video  mpeg2video  mpeg4  snow)
+set(FFMPEG_ENCODERS  ac3_fixed  dvvideo  ffv1  ffvhuff  flv  h263  huffyuv  mjpeg  mp2  mpeg1video  mpeg2video  mpeg4  snow)
 set(FFMPEG_MUXERS  flv  matroska  mpeg1vcd  mpeg2dvd  mpeg2svcd  mpegts  mov  mp4  psp)
 set(FFMPEG_PARSERS  ac3  h263  h264  mpeg4video)
 set(FFMPEG_PROTOCOLS  file)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2011-12-28 09:44:42 UTC (rev 7712)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2011-12-28 14:51:49 UTC (rev 7713)
@@ -152,7 +152,13 @@
 
   
   codecID=makeName(CODEC_ID);
+
+#ifdef ADM_LAV_AC3
+  codec = avcodec_find_encoder_by_name("ac3_fixed");
+#else
   codec = avcodec_find_encoder(codecID);
+#endif
+
   ADM_assert(codec);
   
   ret = avcodec_open(CONTEXT, codec);



From gruntster at mail.berlios.de  Thu Dec 29 01:32:37 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 29 Dec 2011 01:32:37 +0100
Subject: [Avidemux-svn-commit] r7714 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include
Message-ID: <20111229003237.940A3480C44@sheep.berlios.de>

Author: gruntster
Date: 2011-12-29 01:32:37 +0100 (Thu, 29 Dec 2011)
New Revision: 7714

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h
Log:
[apple] fix r7712

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h	2011-12-28 14:51:49 UTC (rev 7713)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/include/ADM_mangle.h	2011-12-29 00:32:37 UTC (rev 7714)
@@ -31,11 +31,11 @@
 #else
 #    if defined(ADM_CPU_X86_64) && defined(PIC)
 #        define MANGLE(a) #a"(%%rip)"
-#        define FUNNY_MANGLE(x) x asm(#x)
-#        define FUNNY_MANGLE_ARRAY(x, y)  x[y] asm(#x)
+#        define FUNNY_MANGLE(x) __attribute__((used)) x asm(#x)
+#        define FUNNY_MANGLE_ARRAY(x, y) __attribute__((used)) x[y] asm(#x)
 #    else
 #        define MANGLE(a) #a
-#        define FUNNY_MANGLE(x) __attribute__((used)) x asm(MANGLE(x))
+#        define FUNNY_MANGLE(x) x asm(MANGLE(x))
 #        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    endif
 #endif



From mean at mail.berlios.de  Thu Dec 29 07:57:32 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 29 Dec 2011 07:57:32 +0100
Subject: [Avidemux-svn-commit] r7715 - tags
Message-ID: <20111229065732.DD7E7481368@sheep.berlios.de>

Author: mean
Date: 2011-12-29 07:57:32 +0100 (Thu, 29 Dec 2011)
New Revision: 7715

Added:
   tags/avidemux_2.5.6/
Log:
tag 2.5.6





From mean at mail.berlios.de  Thu Dec 29 08:07:31 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 29 Dec 2011 08:07:31 +0100
Subject: [Avidemux-svn-commit] r7716 - tags/avidemux_2.5.6
Message-ID: <20111229070731.9DE52481368@sheep.berlios.de>

Author: mean
Date: 2011-12-29 08:07:31 +0100 (Thu, 29 Dec 2011)
New Revision: 7716

Modified:
   tags/avidemux_2.5.6/CMakeLists.txt
Log:
[2.5.6] set version to 2.5.6r0

Modified: tags/avidemux_2.5.6/CMakeLists.txt
===================================================================
--- tags/avidemux_2.5.6/CMakeLists.txt	2011-12-29 06:57:32 UTC (rev 7715)
+++ tags/avidemux_2.5.6/CMakeLists.txt	2011-12-29 07:07:31 UTC (rev 7716)
@@ -97,7 +97,7 @@
 ########################################
 # Standard Avidemux defines
 ########################################
-SET(VERSION 2.5.5)
+SET(VERSION 2.5.6)
 
 # Define internal flags for GTK+ and Qt4 builds.  These are turned off
 # if a showstopper is found.  CLI is automatically assumed as possible
@@ -118,18 +118,7 @@
 OPTION(SVN "" ON)
 SET(ADM_SUBVERSION 0)
 
-IF (SVN)
-	MESSAGE(STATUS "Checking for SCM Revision")
-	MESSAGE(STATUS "*************************")
 
-	SET(Subversion_FIND_REQUIRED OFF)
-	include(admGetRevision)
-	admGetRevision(${PROJECT_SOURCE_DIR} ADM_SUBVERSION)
-	MESSAGE(STATUS "  revision: ${ADM_SUBVERSION}")
-
-	MESSAGE("")
-ENDIF (SVN)
-
 ########################################
 # Check for libraries
 ########################################



From mean at mail.berlios.de  Thu Dec 29 10:10:39 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 29 Dec 2011 10:10:39 +0100
Subject: [Avidemux-svn-commit] r7717 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux_core/ADM_coreMuxer/include
	avidemux_core/ADM_coreMuxer/src avidemux_plugins/ADM_muxers/muxerAvi
	avidemux_plugins/ADM_muxers/muxerDummy
	avidemux_plugins/ADM_muxers/muxerFlv
	avidemux_plugins/ADM_muxers/muxerMkv
	avidemux_plugins/ADM_muxers/muxerMp4
	avidemux_plugins/ADM_muxers/muxerMp4v2
	avidemux_plugins/ADM_muxers/muxerRaw
	avidemux_plugins/ADM_muxers/muxerffPS
	avidemux_plugins/ADM_muxers/muxerffTS
Message-ID: <20111229091039.CA0A5481368@sheep.berlios.de>

Author: mean
Date: 2011-12-29 10:10:39 +0100 (Thu, 29 Dec 2011)
New Revision: 7717

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerInternal.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerProto.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerAvi/muxerAviPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/ADM_dummyPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp
Log:
[muxer] Add a default extension, automatically appended if no . is found. Else that troubles windows user

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -43,7 +43,8 @@
 /*
 
 */
-ADM_muxer               *ADM_MuxerSpawnFromIndex(int index);
+//ADM_muxer               *ADM_MuxerSpawnFromIndex(int index);
+#include "ADM_muxerProto.h"
 extern ADM_audioStream  *audioCreateEncodingStream(bool globalHeader,uint64_t startTime,int32_t shift);
 extern ADM_audioStream  *audioCreateCopyStream(uint64_t startTime,int32_t shift,ADM_audioStream *input);
 
@@ -55,8 +56,8 @@
 class admSaver
 {
 protected:
-        const char           *fileName;
-        char                 *logFileName;
+        std::string          fileName;
+        std::string          logFileName;
         ADM_muxer            *muxer;
         ADM_videoFilterChain *chain;
         ADM_audioStream      *audio;
@@ -78,10 +79,9 @@
 */
  admSaver::admSaver(const char *out)
 {
-        fileName=out;
-        logFileName=new char[strlen(out)+10];
-        strcpy(logFileName,out);
-        strcat(logFileName,".stats");
+        fileName=std::string(out);
+        logFileName=fileName;
+        logFileName+=std::string(".stats");
         muxer=NULL;
         chain=NULL;
         audio=NULL;
@@ -101,9 +101,7 @@
  if(muxer)
         delete muxer;
  muxer=NULL;
- if(logFileName)
-        delete [] logFileName;
- logFileName=NULL;
+ logFileName="";
  if ( astreams[0])
         delete astreams[0];
  astreams[0]=NULL;
@@ -151,8 +149,8 @@
 
 
                 if(videoDuration<5000) videoDuration=5000;
-                printf("[Save] Performing Pass one,using %s as log file\n",logFileName);
-                pass1->setPassAndLogFile(1,logFileName);
+                printf("[Save] Performing Pass one,using %s as log file\n",logFileName.c_str());
+                pass1->setPassAndLogFile(1,logFileName.c_str());
                 if(false==pass1->setup())
                 {
                     printf("[Save] setup failed for pass1 encoder\n");
@@ -205,7 +203,7 @@
                     printf("[Save] Cannot create encoder for pass 2\n");
                     return NULL;
                 }
-                pass2->setPassAndLogFile(2,logFileName);
+                pass2->setPassAndLogFile(2,logFileName.c_str());
 #if 0
                 buffer=new uint8_t[BUFFER_SIZE];
                 pass2->setup();
@@ -241,6 +239,8 @@
     ADM_info("Audio starting time %s\n",ADM_us2plain(startAudioTime));
     ADM_info("[A_Save] Saving..\n");
     ADM_audioStream *astreams[1]={NULL};
+    const char *defaultExtension=ADM_MuxerGetDefaultExtension(muxerIndex);
+    ADM_info("Muxer default extension %s\n",defaultExtension);
     if(!videoEncoderIndex) 
     {
         if(false==video_body-> checkCutsAreOnIntra())
@@ -259,7 +259,7 @@
         GUI_Error_HIG("Muxer","Cannot instantiante muxer");
         return 0;
     }
-
+    
     // Audio Stream ?
     ADM_audioStream *audio=NULL;
     int nbAStream=1;
@@ -376,8 +376,19 @@
             }
         }
     }
-    if(!muxer->open(fileName,video,nbAStream,astreams))
+    // Check if we need to add an extension....
+    if(defaultExtension)
     {
+        if(!strstr(fileName.c_str(),"."))
+        {
+            
+            fileName=fileName+std::string(".")+std::string(defaultExtension);
+            ADM_info("Adding extension, filename is now %s\n",fileName.c_str());
+        }
+
+    }
+    if(!muxer->open(fileName.c_str(),video,nbAStream,astreams))
+    {
         GUI_Error_HIG("Muxer","Cannot open ");
     }else
     {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerInternal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerInternal.h	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerInternal.h	2011-12-29 09:10:39 UTC (rev 7717)
@@ -16,7 +16,7 @@
 #ifndef  ADM_muxerInternal_H
 #define  ADM_muxerInternal_H
 
-#define ADM_MUXER_API_VERSION 6
+#define ADM_MUXER_API_VERSION 7
 #include <stddef.h>
 #include "ADM_dynamicLoading.h"
 #include "ADM_muxer.h"
@@ -31,6 +31,7 @@
         const char    *name;
         const char    *displayName;
         const char    *descriptor;
+        const char    *defaultExtension;
         uint32_t      apiVersion;
         bool  (*configure)(void);
         bool  (*getConfiguration)(CONFcouple **conf);
@@ -42,10 +43,11 @@
         uint32_t     (*getApiVersion)();
         const char  *(*getMuxerName)();
         const char  *(*getDisplayName)();
+        const char  *(*getDefaultExtension)();
         
 
 
-			initialised = (loadLibrary(file) && getSymbols(7+3,
+			initialised = (loadLibrary(file) && getSymbols(7+4,
 				&createmuxer, "create",
 				&deletemuxer, "destroy",
 				&getMuxerName, "getName",
@@ -55,7 +57,8 @@
 				&getDescriptor,  "getDescriptor",
                 &configure,"configure",
                 &setConfiguration,"setConfiguration",
-                &getConfiguration,"getConfiguration"
+                &getConfiguration,"getConfiguration",
+                &getDefaultExtension,"getDefaultExtension"
                 ));
                 if(initialised)
                 {
@@ -63,6 +66,7 @@
                     displayName=getDisplayName();
                     apiVersion=getApiVersion();
                     descriptor=getDescriptor();
+                    defaultExtension=getDefaultExtension();
                     printf("[Muxer]Name :%s ApiVersion :%d Description :%s\n",name,apiVersion,descriptor);
                 }else
                 {
@@ -71,7 +75,7 @@
         }
 };
 
-#define ADM_MUXER_BEGIN( Class,maj,mn,pat,name,desc,displayName,configureFunc,confTemplate,confVar) \
+#define ADM_MUXER_BEGIN( Ext,Class,maj,mn,pat,name,desc,displayName,configureFunc,confTemplate,confVar) \
 extern "C" {\
 ADM_muxer   *create(void){ return new Class; } \
 void         destroy(ADM_muxer *h){ Class *z=(Class *)h;delete z;} \
@@ -80,6 +84,7 @@
 const char  *getName(void) {return name;} \
 const char  *getDescriptor(void) {return desc;} \
 const char  *getDisplayName(void) { return displayName;} \
+const char  *getDefaultExtension(void) { return Ext;} \
 bool        getConfiguration(CONFcouple **conf) \
 {\
          if(confTemplate==NULL) {*conf=NULL;return true;} \

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerProto.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerProto.h	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxerProto.h	2011-12-29 09:10:39 UTC (rev 7717)
@@ -26,7 +26,7 @@
 int         ADM_MuxerIndexFromName(const char *name);
 ADM_muxer   *ADM_MuxerSpawn(const char *name);
 ADM_muxer   *ADM_MuxerSpawnFromIndex(int index);
+const char  *ADM_MuxerGetDefaultExtension(int i);
 
 
-
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -49,6 +49,15 @@
 {
     ADM_assert(i<ListOfMuxers.size());
     return ListOfMuxers[i]->displayName;
+}
+/**
+    \fn ADM_MuxerGetDefaultExtension
+    \brief returns the default extension (i.e. mkv, avi) from index
+*/
+const char *ADM_MuxerGetDefaultExtension(int i)
+{
+    ADM_assert(i<ListOfMuxers.size());
+    return ListOfMuxers[i]->defaultExtension;
 }
 /**
     \fn ADM_mx_getName

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerAvi/muxerAviPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerAvi/muxerAviPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerAvi/muxerAviPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -20,7 +20,7 @@
 #include "fourcc.h"
  extern "C" bool AviConfigure(void);
 
-ADM_MUXER_BEGIN( muxerAvi,
+ADM_MUXER_BEGIN( "avi",muxerAvi,
                     1,0,0,
                     "AVI",    // Internal name
                     "AVI muxer plugin (c) Mean 2008",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/ADM_dummyPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/ADM_dummyPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/ADM_dummyPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -21,7 +21,7 @@
 
 extern "C" bool confDummy(void ){return true;}
 
-ADM_MUXER_BEGIN( muxerDummy,
+ADM_MUXER_BEGIN( "dummy",muxerDummy,
                     1,0,0,
                     "dummy",    // Internal name
                     "dummy2 muxer plugin (c) Mean 2008",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -21,7 +21,7 @@
 #include "fourcc.h"
  bool flvConfigure(void);
 
-ADM_MUXER_BEGIN( muxerFlv,
+ADM_MUXER_BEGIN( "flv",muxerFlv,
                     1,0,0,
                     "FLV",    // Internal name
                     "FLV muxer plugin (c) Mean 2008",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -21,7 +21,7 @@
 #include "fourcc.h"
  bool mkvConfigure(void);
 
-ADM_MUXER_BEGIN( muxerMkv,
+ADM_MUXER_BEGIN( "mkv",muxerMkv,
                     1,0,0,
                     "MKV",    // Internal name
                     "Matroska muxer plugin (c) Mean 2009",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -22,7 +22,7 @@
 #include "mp4_muxer_desc.cpp"
  bool mp4Configure(void);
 
-ADM_MUXER_BEGIN( muxerMP4,
+ADM_MUXER_BEGIN( "mp4",muxerMP4,
                     1,0,0,
                     "MP4",    // Internal name
                     "MP4 muxer plugin (c) Mean 2009",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Plugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/muxerMp4v2Plugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -20,7 +20,7 @@
 #include "mp4v2_muxer_desc.cpp"
 extern bool mp4v2Configure(void);
 extern mp4v2_muxer muxerConfig;
-ADM_MUXER_BEGIN( muxerMp4v2,
+ADM_MUXER_BEGIN( "mp4",muxerMp4v2,
                     1,0,0,
                     "MP4V2",    // Internal name
                     "MP4V2 muxer plugin (c) Mean 2011",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -20,7 +20,7 @@
 #include "fourcc.h"
 static bool rawConfigure(void) {return true;};
 
-ADM_MUXER_BEGIN( muxerRaw,
+ADM_MUXER_BEGIN( "raw",muxerRaw,
                     1,0,0,
                     "RAW",    // Internal name
                     "RAW muxer plugin (c) Mean 2008",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -21,7 +21,7 @@
 #include "fourcc.h"
  bool ffPSConfigure(void);
 
-ADM_MUXER_BEGIN( muxerffPS,
+ADM_MUXER_BEGIN( "mpg",muxerffPS,
                     1,0,0,
                     "ffPS",    // Internal name
                     "ffMpeg PS muxer plugin (c) Mean 2009",

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp	2011-12-29 07:07:31 UTC (rev 7716)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp	2011-12-29 09:10:39 UTC (rev 7717)
@@ -21,7 +21,7 @@
 #include "fourcc.h"
  bool ffTSConfigure(void);
 
-ADM_MUXER_BEGIN( muxerffTS,
+ADM_MUXER_BEGIN( "ts",muxerffTS,
                     1,0,1,
                     "ffTS",    // Internal name
                     "ffMpeg TS muxer plugin (c) Mean 2009",



From gruntster at mail.berlios.de  Fri Dec 30 18:57:01 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 30 Dec 2011 18:57:01 +0100
Subject: [Avidemux-svn-commit] r7718 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20111230175702.345824813AF@sheep.berlios.de>

Author: gruntster
Date: 2011-12-30 18:57:01 +0100 (Fri, 30 Dec 2011)
New Revision: 7718

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
Log:
[mswin] output CRLFs to log file rather than LFs

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-12-29 09:10:39 UTC (rev 7717)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2011-12-30 17:57:01 UTC (rev 7718)
@@ -1,4 +1,5 @@
 #ifdef __WIN32
+#include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <windows.h>
@@ -445,9 +446,12 @@
 	}
 
 	// Line buffering
-	setvbuf(stdout, NULL, _IONBF, BUFSIZ); 
+	setvbuf(stdout, NULL, _IONBF, BUFSIZ);
 	setvbuf(stderr, NULL, _IONBF, BUFSIZ);
 
+	_setmode(_fileno(stdout), _O_TEXT);
+	_setmode(_fileno(stderr), _O_TEXT);
+
 	delete[] logPath;
 }
 



From gruntster at mail.berlios.de  Fri Dec 30 19:08:54 2011
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 30 Dec 2011 19:08:54 +0100
Subject: [Avidemux-svn-commit] r7719 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	cli/ADM_userInterfaces common common/ADM_commonUI
	gtk/ADM_userInterfaces qt4/ADM_userInterfaces
Message-ID: <20111230180854.8770D4813AD@sheep.berlios.de>

Author: gruntster
Date: 2011-12-30 19:08:54 +0100 (Fri, 30 Dec 2011)
New Revision: 7719

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/myOwnMenu.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
Log:
[mswin] menu options for opening app log and app folder to help with support

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ui_support.cpp	2011-12-30 18:08:54 UTC (rev 7719)
@@ -48,3 +48,6 @@
 	*handle = 0;
 	*nativeHandle = 0;
 }
+
+void GUI_OpenApplicationLog() { }
+void GUI_OpenApplicationDataFolder() { }
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/myOwnMenu.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/myOwnMenu.h	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/myOwnMenu.h	2011-12-30 18:08:54 UTC (rev 7719)
@@ -81,6 +81,13 @@
 MenuEntry myMenuHelp[]= {
             {MENU_ACTION,"Build Option",    NULL,ACT_BUILT_IN           ,NULL,NULL},
             {MENU_ACTION,"Plugins",         NULL,ACT_PLUGIN_INFO        ,NULL,NULL},
+#ifdef __WIN32
+			{MENU_SEPARATOR,NULL,NULL,ACT_DUMMY             ,NULL,NULL},
+			{MENU_SUBMENU, "&Advanced", NULL, ACT_DUMMY, NULL, NULL},
+			{MENU_SUBACTION, "Open Application &Log", NULL, ACT_OPEN_APP_LOG, NULL, NULL},
+			{MENU_SUBACTION, "Open Application Data &Folder", NULL, ACT_OPEN_APP_FOLDER, NULL, NULL},
+#endif
+			{MENU_SEPARATOR,NULL,NULL,ACT_DUMMY             ,NULL,NULL},
             {MENU_ACTION,"About ",          NULL,ACT_ABOUT              ,NULL,NULL},
         };
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2011-12-30 18:08:54 UTC (rev 7719)
@@ -108,3 +108,5 @@
 ACT(JOG)
 ACT(JS_SHELL)
 ACT(PY_SHELL)
+ACT(OPEN_APP_LOG)
+ACT(OPEN_APP_FOLDER)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_main.cpp	2011-12-30 18:08:54 UTC (rev 7719)
@@ -75,9 +75,9 @@
 static void cleanUp (void);
 void        updateLoaded (void);
 
+extern void GUI_OpenApplicationLog();
+extern void GUI_OpenApplicationDataFolder();
 
-
-
 extern bool ADM_mux_configure(int index);
 void brokenAct(void);
 //
@@ -201,6 +201,13 @@
             GUI_FileSelRead (QT_TR_NOOP("Select ECMAScript to Run"),(SELFILE_CB *) A_parseECMAScript);
     		return;
 
+	case ACT_OPEN_APP_LOG:
+		GUI_OpenApplicationLog();
+		break;
+	case ACT_OPEN_APP_FOLDER:
+		GUI_OpenApplicationDataFolder();
+		break;
+
     case ACT_ABOUT :
     		 DIA_about( );
 		 return;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ui_support.cpp	2011-12-30 18:08:54 UTC (rev 7719)
@@ -66,3 +66,6 @@
 	*nativeHandle = (long int)gtk_widget_get_window(guiRootWindow);
 #endif
 }
+
+void GUI_OpenApplicationLog() { }
+void GUI_OpenApplicationDataFolder() { }
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-12-30 17:57:01 UTC (rev 7718)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2011-12-30 18:08:54 UTC (rev 7719)
@@ -2,7 +2,9 @@
 #include <QtCore/QMap>
 #include <QtCore/QLocale>
 #include <QtCore/QTranslator>
+#include <QtCore/QUrl>
 #include <QtGui/QApplication>
+#include <QtGui/QDesktopServices>
 #include <QtGui/QWidget>
 
 #ifdef __APPLE__
@@ -169,3 +171,13 @@
 
 	return "Qt";
 }
+
+void GUI_OpenApplicationLog()
+{
+	QDesktopServices::openUrl(QUrl::fromLocalFile(QString(ADM_getBaseDir()) + "admlog.txt"));
+}
+
+void GUI_OpenApplicationDataFolder()
+{
+	QDesktopServices::openUrl(QUrl::fromLocalFile(QString(ADM_getBaseDir())));
+}
\ No newline at end of file



From mean at mail.berlios.de  Sat Dec 31 16:00:34 2011
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 31 Dec 2011 16:00:34 +0100
Subject: [Avidemux-svn-commit] r7720 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser:
	include src
Message-ID: <20111231150034.441164813AD@sheep.berlios.de>

Author: mean
Date: 2011-12-31 16:00:33 +0100 (Sat, 31 Dec 2011)
New Revision: 7720

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/include/ADM_aacadts.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp
Log:
[ADTS] Dont use lav* to parse adts frames. Add support for non aligned ADTS frames (freebox)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/include/ADM_aacadts.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/include/ADM_aacadts.h	2011-12-30 18:08:54 UTC (rev 7719)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/include/ADM_aacadts.h	2011-12-31 15:00:33 UTC (rev 7720)
@@ -17,11 +17,14 @@
 /**
     \class ADM_adts2aac
 */
+#define ADTS_BUFFER_SIZE 16000
 class ADM_adts2aac
 {
 private:
-		void * cookie;
-        void * codec;
+        bool    hasExtra;
+        uint8_t extra[2];
+        uint8_t buffer[ADTS_BUFFER_SIZE*2];
+        int     head,tail;
 		
 public:
 		bool getExtraData(uint32_t *len,uint8_t **data);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp	2011-12-30 18:08:54 UTC (rev 7719)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_aacadts.cpp	2011-12-31 15:00:33 UTC (rev 7720)
@@ -14,13 +14,14 @@
 
 #include <math.h>
 #include "ADM_default.h"
-extern "C" {
-#include "libavcodec/avcodec.h"
-}
 #include "ADM_aacadts.h"
-#define COOKIE   ((AVBitStreamFilterContext *)cookie)
-#define CONTEXT  ((AVCodecContext *)codec)
 
+#if 0
+    #define aprintf printf
+#else
+    #define aprintf(...) {}
+#endif
+
 static const int aacChannels[16]=
 {
 0, //0: Defined in AOT Specifc Config
@@ -48,9 +49,13 @@
 */
 bool ADM_adts2aac::getExtraData(uint32_t *len,uint8_t **data)
 {
-    *data=CONTEXT->extradata;
-    *len=CONTEXT->extradata_size;
-    return true;
+    if(hasExtra)
+    {
+        *data=extra;
+        *len=2;
+        return true;
+    }
+    return false;
 }
 /**
     \fn getFrequency
@@ -58,12 +63,12 @@
 */
 int ADM_adts2aac::getFrequency(void)
 {
-    if(!(CONTEXT->extradata))
+    if(!hasExtra)
     {
             ADM_error("No extradata in aac! using default of 48 kHz");
             return 48000;
     }
-    uint8_t *p=CONTEXT->extradata ;
+    uint8_t *p=extra;
     int dex=((p[0]&7)<<1)+(p[1]>>7);
     return aacSampleRate[dex];
 }
@@ -73,12 +78,12 @@
 */
 int ADM_adts2aac::getChannels(void)
 {
-    if(!(CONTEXT->extradata))
+    if(!hasExtra)
     {
             ADM_error("No extradata in aac! using default of 2 channels");
             return 2;
     }
-    uint8_t *p=CONTEXT->extradata ;
+    uint8_t *p=extra;
     int dex=((p[1]>>3)&0xf);
     return aacChannels[dex];
 }
@@ -90,16 +95,130 @@
 
 bool ADM_adts2aac::convert(int incomingLen,uint8_t *inData,int *outLen,uint8_t *out)
 {
+    bool r=false;
+    // Step 1 : append to our buffer...
+    *outLen=0;
+    if(head==tail)
+    {
+        head=tail=0;
+    }
+    if(tail>ADTS_BUFFER_SIZE)
+    {
+        int size=head-tail;
+        memmove(buffer,buffer+tail,size);
+        head=size;
+        tail=0;
+    }
+    if(head+incomingLen>ADTS_BUFFER_SIZE*2)
+    {
+        ADM_error("Head=%d tail=%d bufferSize=%d\n",head,tail,ADTS_BUFFER_SIZE*2);
+        ADM_error("Adts buffer overflow\n");
+        ADM_assert(0);
+    }
+    memcpy(buffer+head,inData,incomingLen);
+    head+=incomingLen;
+    // ok , done
+    aprintf("********** LOOP *******\n");
+again:
+    aprintf("*** head=%d tail=%d size=%d***\n",head,tail,head-tail);
+    if(tail+7>head) // we neeed at least 7 bytes...
+    {
+        aprintf("Adts: Not enough data \n");
+        return r;
+    }
+    // now search for sync....
+    bool found=false;
+    uint8_t *p=NULL;
+    int packetLen=0;
+    int nbFrames=0;
+    bool crc=false;
+    int match;
+    for( p=(buffer+tail);p<(buffer+head-2);p++)
+    {
+        if(p[0]==0xff && p[1]&0xf0==0xf0)
+        {
+            match=p-buffer; // offset of syncword
+            packetLen=((p[3]&0x3)<<11)+(p[4]<<3)+(p[5]>>5);
+            nbFrames=1+(p[6]&3);
+            if(!p[1]&1)
+            {
+                crc=true;
+            }
+            aprintf("Packet len=%d, nbframes=%d\n",packetLen,nbFrames);
+            aprintf("Found sync at offset %d, buffer size=%d\n",(int)(p-buffer),(int)(head-tail));
+            aprintf("Dropping %d bytes\n",(int)(p-buffer-tail));
+            if(match==tail && match+packetLen==head)
+            {
+                aprintf("Perfect match\n");
+                found=true;
+                break;
+            }
+            if(match+packetLen+2>head && match+packetLen!=head)
+            {
+                aprintf("** not enough data **\n");
+                return r;
+            }
+            // do we have sync at the end ?
+            if(p[packetLen]!=0xff)
+            {
+                aprintf("no ff marker at the end\n");
+                continue;
+            }
+            aprintf("End marker found\n");
+            found=true;
+            break;
+        }
+    }
+    if(found==false)
+    {
+        aprintf("No sync\n");
+        tail=head-1;
+        return r;
+    }
+    if(!hasExtra)
+    { // build codec specific info, thanks vlc  
+        int i_profile=p[3]>>6;
+        int i_sample_rate_idx=(p[3]>>2)&0x0f;
+        int pi_channels=(p[3]>>7)+((p[4]>>6)<<2);
+      extra[0] =   (i_profile + 1) << 3 | (i_sample_rate_idx >> 1);
+      extra[1] =   ((i_sample_rate_idx & 0x01) << 7) | (pi_channels <<3);
+      hasExtra=true;
+    }
+    // size ?
     uint8_t *o;
-    *outLen=0;
-    av_bitstream_filter_filter(COOKIE,CONTEXT,NULL,
-                            &o,outLen,inData,incomingLen,0);
-    if(!*outLen)
-        return false;
+    int produced=0;
+    // filter!
+    //-------
+
+        if(crc) 
+            {
+                o=p+9;
+                produced=packetLen-9;
+            }else
+            {
+                o=p+7;
+                produced=packetLen-7;
+            }
+    //
+    //---------
+    if(!produced)
+    {
+        tail=match+1;
+        printf("No data produced\n");
+        goto again;
+    }
+    aprintf("Found adts packet of size %d, extradataLen=%d\n",produced,2);
     if(out)
-        memcpy(out,o,*outLen);
+    {
+        memcpy(out,o,produced);
+        out+=produced;
+        *outLen+=produced;
+    }
+    r=true; // we have found something
     //printf("In : %d out %d\n",incomingLen,*outLen);
-    return true;
+    tail=match+packetLen; // ~ skip 
+    ADM_assert(tail<=head);
+    goto again;
 }
 /**
     \fn ctor
@@ -107,22 +226,9 @@
 
 ADM_adts2aac::ADM_adts2aac(void)
 {
-    AVBitStreamFilterContext *bsfc= av_bitstream_filter_init("aac_adtstoasc");
-    if (!bsfc) 
-    {
-        ADM_error("Cannot get adts filter...\n");
-        ADM_assert(0);
-    }
-    cookie=(void *)bsfc;
-    //****
-    AVCodecContext *context = avcodec_alloc_context ();
-    AVCodec *dec=avcodec_find_decoder(CODEC_ID_AAC);
-    if (avcodec_open(context, dec) < 0)
-    {
-        ADM_error("Cannot get aac codec...\n");
-        ADM_assert(0);
-    }
-    codec=(void *)context;
+    hasExtra=false;
+    extra[0]=extra[1]=0;
+    head=tail=0;
 }
 /**
     \fn dtor
@@ -130,17 +236,7 @@
 
 ADM_adts2aac::~ADM_adts2aac()
 {
-    if(cookie)
-    {
-        av_bitstream_filter_close(COOKIE);  
-        cookie=NULL;
-    }
-    if(codec)
-    {
-        avcodec_close(CONTEXT);
-        av_free(CONTEXT);
-        codec=NULL;
-    }
+   
 }
 
 //EOF
\ No newline at end of file



