From gruntster at mail.berlios.de  Thu Jan  1 17:45:15 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 1 Jan 2009 17:45:15 +0100
Subject: [Avidemux-svn-commit] r4509 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <200901011645.n01GjFkY020396@sheep.berlios.de>

Author: gruntster
Date: 2009-01-01 17:45:10 +0100 (Thu, 01 Jan 2009)
New Revision: 4509

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake
Log:
[cmake] check for zlib

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake	2009-01-01 14:23:23 UTC (rev 4508)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckRequiredLibs.cmake	2009-01-01 16:45:10 UTC (rev 4509)
@@ -40,4 +40,15 @@
 FIND_PACKAGE(Threads)
 PRINT_LIBRARY_INFO("pthreads" PTHREAD_FOUND "${PTHREAD_INCLUDE_DIR}" "${PTHREAD_LIBRARIES}" FATAL_ERROR)
 
+MESSAGE("")
+
+########################################
+# zlib
+########################################
+MESSAGE(STATUS "Checking for zlib")
+MESSAGE(STATUS "*****************")
+
+FIND_PACKAGE(ZLIB)
+PRINT_LIBRARY_INFO("zlib" ZLIB_FOUND "${ZLIB_INCLUDE_DIR}" "${ZLIB_LIBRARY}" FATAL_ERROR)
+
 MESSAGE("")
\ No newline at end of file



From gruntster at mail.berlios.de  Thu Jan  1 18:28:35 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 1 Jan 2009 18:28:35 +0100
Subject: [Avidemux-svn-commit] r4510 - in
	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_editor
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
Message-ID: <200901011728.n01HSZPH024308@sheep.berlios.de>

Author: gruntster
Date: 2009-01-01 18:28:26 +0100 (Thu, 01 Jan 2009)
New Revision: 4510

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_outputfmt.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/about.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/encoding.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
Log:
[Merge] integrate changes from 2.4 branch (r4486)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_outputfmt.h	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_editor/ADM_outputfmt.h	2009-01-01 17:28:26 UTC (rev 4510)
@@ -22,8 +22,8 @@
 	ADM_TS,
 	ADM_ES,
 	ADM_MP4,
+	ADM_PSP,
 	ADM_OGM,
-	ADM_PSP,
 	ADM_FLV,
         ADM_MATROSKA,
 	ADM_DUMMY,
@@ -48,8 +48,8 @@
   {ADM_TS,QT_TR_NOOP("MPEG-TS (A+V)")},
   {ADM_ES,QT_TR_NOOP("MPEG video")},
   {ADM_MP4,QT_TR_NOOP("MP4")},
+  {ADM_PSP,QT_TR_NOOP("MP4 (PSP)")},
   {ADM_OGM,QT_TR_NOOP("OGM")},
-  {ADM_PSP,QT_TR_NOOP("PSP")},
   {ADM_FLV,QT_TR_NOOP("FLV")},
   {ADM_MATROSKA,QT_TR_NOOP("MKV")},
   {ADM_DUMMY,QT_TR_NOOP("DUMMY")}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/about.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/about.ui	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/about.ui	2009-01-01 17:28:26 UTC (rev 4510)
@@ -76,13 +76,9 @@
       <widget class="QLabel" name="versionLabel" >
        <property name="font" >
         <font>
-         <family>MS Shell Dlg 2</family>
          <pointsize>18</pointsize>
          <weight>75</weight>
-         <italic>false</italic>
          <bold>true</bold>
-         <underline>false</underline>
-         <strikeout>false</strikeout>
         </font>
        </property>
        <property name="text" >
@@ -97,13 +93,7 @@
       <widget class="QLabel" name="label_2" >
        <property name="font" >
         <font>
-         <family>MS Shell Dlg 2</family>
          <pointsize>10</pointsize>
-         <weight>50</weight>
-         <italic>false</italic>
-         <bold>false</bold>
-         <underline>false</underline>
-         <strikeout>false</strikeout>
         </font>
        </property>
        <property name="text" >
@@ -128,13 +118,7 @@
       <widget class="QLabel" name="label_4" >
        <property name="font" >
         <font>
-         <family>MS Shell Dlg 2</family>
          <pointsize>10</pointsize>
-         <weight>50</weight>
-         <italic>false</italic>
-         <bold>false</bold>
-         <underline>false</underline>
-         <strikeout>false</strikeout>
         </font>
        </property>
        <property name="text" >

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/encoding.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/encoding.ui	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/encoding.ui	2009-01-01 17:28:26 UTC (rev 4510)
@@ -150,11 +150,14 @@
           </item>
           <item row="3" column="0" >
            <widget class="QLabel" name="label_8" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Container:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Container:</string>
             </property>
            </widget>
           </item>
@@ -167,11 +170,14 @@
           </item>
           <item row="2" column="0" >
            <widget class="QLabel" name="label_6" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Audio Codec:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Audio Codec:</string>
             </property>
            </widget>
           </item>
@@ -237,31 +243,40 @@
           </item>
           <item row="0" column="0" >
            <widget class="QLabel" name="label_24" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Elapsed:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Elapsed:</string>
             </property>
            </widget>
           </item>
           <item row="1" column="0" >
            <widget class="QLabel" name="label_26" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Time Remaining:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Time Remaining:</string>
             </property>
            </widget>
           </item>
           <item row="2" column="0" >
            <widget class="QLabel" name="label_28" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Frames/sec:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Frames/sec:</string>
             </property>
            </widget>
           </item>
@@ -313,11 +328,14 @@
           </item>
           <item row="2" column="0" >
            <widget class="QLabel" name="label_22" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Total Size:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Total Size:</string>
             </property>
            </widget>
           </item>
@@ -330,11 +348,14 @@
           </item>
           <item row="1" column="0" >
            <widget class="QLabel" name="label_20" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Audio Size:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Audio Size:</string>
             </property>
            </widget>
           </item>
@@ -350,11 +371,14 @@
           </item>
           <item row="0" column="0" >
            <widget class="QLabel" name="label_18" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Video Size:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Video Size:</string>
             </property>
            </widget>
           </item>
@@ -399,21 +423,27 @@
           </property>
           <item row="0" column="0" >
            <widget class="QLabel" name="label_10" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Processed Frames:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Processed Frames:</string>
             </property>
            </widget>
           </item>
           <item row="1" column="0" >
            <widget class="QLabel" name="label_12" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Total Frames:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Total Frames:</string>
             </property>
            </widget>
           </item>
@@ -436,11 +466,14 @@
           </item>
           <item row="3" column="0" >
            <widget class="QLabel" name="label_16" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Average Bitrate:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Average Bitrate:</string>
             </property>
            </widget>
           </item>
@@ -453,11 +486,14 @@
           </item>
           <item row="2" column="0" >
            <widget class="QLabel" name="label_14" >
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
-             <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;style type="text/css">
-p, li { white-space: pre-wrap; }
-&lt;/style>&lt;/head>&lt;body style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal; text-decoration:none;">
-&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;span style=" font-size:8pt; font-weight:600;">Quantiser:&lt;/span>&lt;/p>&lt;/body>&lt;/html></string>
+             <string>Quantiser:</string>
             </property>
            </widget>
           </item>

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui	2009-01-01 17:28:26 UTC (rev 4510)
@@ -66,13 +66,8 @@
         <widget class="QLabel" name="label_2" >
          <property name="font" >
           <font>
-           <family>MS Shell Dlg 2</family>
-           <pointsize>8</pointsize>
            <weight>75</weight>
-           <italic>false</italic>
            <bold>true</bold>
-           <underline>false</underline>
-           <strikeout>false</strikeout>
           </font>
          </property>
          <property name="text" >
@@ -90,13 +85,8 @@
          </property>
          <property name="font" >
           <font>
-           <family>MS Shell Dlg 2</family>
-           <pointsize>8</pointsize>
            <weight>75</weight>
-           <italic>false</italic>
            <bold>true</bold>
-           <underline>false</underline>
-           <strikeout>false</strikeout>
           </font>
          </property>
          <property name="text" >

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2009-01-01 17:28:26 UTC (rev 4510)
@@ -1,11 +1,11 @@
 SET(ADM_LIB ADM_guiQt4)
 
 QT4_WRAP_UI(${ADM_LIB}_header  gui2.ui  preview.ui)
-QT4_WRAP_CPP(${ADM_LIB}_source  Q_gui2.h  T_preview.h  ADM_qtray.h  Q_preview.h)
+QT4_WRAP_CPP(${ADM_LIB}_source  Q_gui2.h  T_preview.h  ADM_qtray.h  Q_preview.h  T_thumbSlider.h)
 QT4_ADD_RESOURCES(${ADM_LIB}_resource  avidemux.qrc)
 
 SET(${ADM_LIB}_SRCS
-	Q_gui2.cpp  T_preview.cpp  file_qt4.cpp  gui_none.cpp  ADM_qslider.cpp  ADM_qtray.cpp  Q_preview.cpp
+	Q_gui2.cpp  T_preview.cpp  file_qt4.cpp  gui_none.cpp  ADM_qslider.cpp  ADM_qtray.cpp  Q_preview.cpp  T_thumbSlider.cpp
 	${${ADM_LIB}_header}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource})
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR}  ${CMAKE_CURRENT_SOURCE_DIR})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-01-01 17:28:26 UTC (rev 4510)
@@ -32,6 +32,7 @@
 #include "gtkgui.h"
 
 #include "ADM_userInterfaces/ADM_render/GUI_renderInternal.h"
+
 extern int global_argc;
 extern char **global_argv;
 
@@ -257,6 +258,11 @@
 	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
 	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
 
+	// Thumb slider
+	ui.sliderPlaceHolder->installEventFilter(this);
+	thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+	connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
 	// Volume slider
 	QSlider *volSlider=ui.horizontalSlider_2;
 	volSlider->setMinimum(0);
@@ -431,6 +437,16 @@
 				if (!UI_readCurTime(hh, mm, ss, ms))
 					UI_updateTimeCount(currentFrame, currentFps);
 			}
+
+			break;
+		case QEvent::Resize:
+			if (watched == ui.sliderPlaceHolder)
+			{
+				thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
+				thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
+			}
+
+			break;
 	}
 
 	return QObject::eventFilter(watched, event);
@@ -550,6 +566,7 @@
 
 MainWindow::~MainWindow()
 {
+	delete thumbSlider;
 	clearCustomMenu();
 	renderDestroy();
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h	2009-01-01 17:28:26 UTC (rev 4510)
@@ -5,6 +5,7 @@
 #include <QtGui/QWidget>
 
 #include "ADM_qslider.h"
+#include "T_thumbSlider.h"
 #include "ui_gui2.h"
 
 class MainWindow : public QMainWindow
@@ -38,6 +39,8 @@
 	void currentTimeChanged(void);
 
 protected:
+	ThumbSlider *thumbSlider;
+
 	void clearCustomMenu(void);
 	bool eventFilter(QObject* watched, QEvent* event);
 	void mousePressEvent(QMouseEvent* event);

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.cpp (from rev 4486, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.cpp	2008-10-18 02:24:12 UTC (rev 4486)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.cpp	2009-01-01 17:28:26 UTC (rev 4510)
@@ -0,0 +1,223 @@
+#include "T_thumbSlider.h"
+
+#include <QtGui/QStyle>
+
+ThumbSlider::ThumbSlider(QWidget *parent) : QAbstractSlider(parent)
+{
+	setMaximum(100);
+	setMinimum(-100);
+	setValue(0);
+
+	count = lock = 0;
+}
+
+void ThumbSlider::timerEvent(QTimerEvent *event)
+{
+	static const int jogScale[10] = {20, 15, 11, 8, 6, 5, 4, 3, 2, 0};
+	int r = abs(value()) / 10;
+
+	if (!r)
+		return;
+
+	if (count)
+		count--;
+
+	if (count)
+		return;
+
+	count = (r > 9 ? jogScale[9] : jogScale[r]);
+
+	if (lock)
+		return;
+
+	lock++;
+
+	emit valueEmitted(value());
+
+	lock--;
+}
+
+void ThumbSlider::paintEvent(QPaintEvent *event)
+{
+	QPainter painter;
+
+	painter.begin(this);
+	painter.setClipRect(event->rect());
+	painter.setPen(Qt::NoPen);
+
+	drawBackground(&painter);
+	drawLines(&painter);
+	drawBorders(&painter);
+	drawEdges(&painter);
+}
+
+void ThumbSlider::mousePressEvent(QMouseEvent *event)
+{
+	if (event->buttons() && Qt::LeftButton)
+	{
+		int value = QStyle::sliderValueFromPosition(minimum(), maximum(), event->x(), width(), false);
+
+		setSliderPosition(value);
+		timerId = startTimer(20);
+		triggerAction(SliderMove);
+	}
+}
+
+void ThumbSlider::mouseMoveEvent(QMouseEvent *event)
+{
+	if (event->buttons() && Qt::LeftButton)
+	{
+		int value = QStyle::sliderValueFromPosition(minimum(), maximum(), event->x(), width(), false);
+
+		setSliderPosition(value);
+		triggerAction(SliderMove);
+	}
+}
+
+void ThumbSlider::mouseReleaseEvent(QMouseEvent *event)
+{
+	killTimer(timerId);
+	setValue(0);
+	count = 0;
+
+	triggerAction(SliderNoAction);
+}
+
+void ThumbSlider::drawBackground(QPainter *painter)
+{
+	int middle = width() / 2;
+	QLinearGradient base1 = QLinearGradient(0, 1, middle - 5, 1);
+	QLinearGradient base2 = QLinearGradient(width() - 1, 1, middle + 5, 1);
+	QColor color1, color2;
+
+	color1.setRgbF(0.33, 0.33, 0.33);
+	color2.setRgbF(0.88, 0.88, 0.88);
+
+	base1.setColorAt(0, color1);
+	base1.setColorAt(1, color2);
+	base2.setColorAt(0, color1);
+	base2.setColorAt(1, color2);
+
+	painter->setBrush(base1);
+	painter->drawRect(1, 0, middle - 1, height() - 1);
+
+	painter->setBrush(base2);
+	painter->drawRect(middle, 0, middle - 1, height() - 1);
+
+	painter->setBrush(Qt::NoBrush);
+}
+
+void ThumbSlider::drawLines(QPainter *painter)
+{
+	float offset = (float)width() / 6.0;
+	int pos = QStyle::sliderPositionFromValue(minimum(), maximum(), value(), width(), false);
+	int middle = width() / 2;
+	int start = pos - (width() / 2);
+	float colourF;
+	QPen pen;
+	QColor color;
+
+	pen.setCapStyle(Qt::FlatCap);
+
+	for (int i = 0; i < 6; i++)
+	{
+		if (start > width())
+			start -= width();
+		else if (start < 0)
+			start = width() + start;
+
+		if (start <= middle)
+			colourF = (float)start / (float)middle * 0.85;
+		else
+			colourF = ((float)(width() - start)) / (float)middle * 0.85;
+
+		if (i == 3)
+		{
+			color.setRgbF(colourF, 0, 0);
+			pen.setWidth(2);
+		}
+		else
+		{
+			color.setRgbF(colourF, colourF, colourF);
+			pen.setWidth(1);
+		}
+
+		pen.setColor(color);
+		painter->setPen(pen);
+		painter->drawLine(start, 2, start, height() - 2);
+
+		start += offset;
+	}
+
+	painter->setPen(Qt::NoPen);
+}
+
+void ThumbSlider::drawBorders(QPainter *painter)
+{
+	int middle = width() / 2;
+	QColor color;
+
+	color.setRgbF(0.53, 0.53, 0.53);
+
+	painter->setPen(QPen(QBrush(color), 1, Qt::SolidLine, Qt::FlatCap));
+	painter->drawLine(1, 0, width() - 1, 0);
+	painter->drawLine(1, height() - 1, width() - 1, height() - 1);
+	painter->drawLine(0, 1, 0, height() - 1);
+	painter->drawLine(width() - 1, 1, width() - 1, height() - 1);
+
+	QLinearGradient grad1 = QLinearGradient(0, 1, middle - 6, 1);
+	QLinearGradient grad2 = QLinearGradient(width() - 1, 1, middle + 6, 1);
+	QLinearGradient grad3 = QLinearGradient(0, height() - 2, middle - 6, height() - 2);
+	QLinearGradient grad4 = QLinearGradient(width() - 1, height() - 2, middle + 6, height() - 2);
+	QColor color1, color2;
+
+	color1.setRgbF(0.00, 0.00, 0.00);
+	color2.setRgbF(0.98, 0.98, 0.98);
+
+	grad1.setColorAt(0, color1);
+	grad1.setColorAt(1, color2);
+
+	grad2.setColorAt(0, color1);
+	grad2.setColorAt(1, color2);
+
+	grad3.setColorAt(1, color2);
+	grad3.setColorAt(0, color1);
+
+	grad4.setColorAt(1, color2);
+	grad4.setColorAt(0, color1);
+
+	painter->setPen(QPen(grad1, 1, Qt::SolidLine, Qt::FlatCap));
+	painter->drawLine(1, 1, middle, 1);
+	painter->setPen(QPen(grad3, 1, Qt::SolidLine, Qt::FlatCap));
+	painter->drawLine(1, height() - 2, middle, height() - 2);
+	painter->setPen(QPen(grad2, 1, Qt::SolidLine, Qt::FlatCap));
+	painter->drawLine(middle, 1, width() - 1, 1);
+	painter->setPen(QPen(grad4, 1, Qt::SolidLine, Qt::FlatCap));
+	painter->drawLine(middle, height() - 2, width() - 1, height() - 2);
+
+	painter->setPen(Qt::NoPen);
+}
+
+void ThumbSlider::drawEdges(QPainter *painter)
+{
+	QLinearGradient grad1 = QLinearGradient(0, 2, 6, 2);
+	QLinearGradient grad2 = QLinearGradient(width() - 1, 2, width() - 6, 2);
+	QColor color1, color2;
+
+	color1.setRgbF(0.00, 0.00, 0.00);
+	color2.setRgbF(0.23, 0.23, 0.23);
+
+	grad1.setColorAt(0, color1);
+	grad1.setColorAt(1, color2);
+
+	grad2.setColorAt(0, color1);
+	grad2.setColorAt(1, color2);
+
+	painter->setBrush(grad1);
+	painter->drawRect(1, 2, 6, height() - 4);
+
+	painter->setBrush(grad2);
+	painter->drawRect(width() - 7, 2, 6, height() - 4);
+
+	painter->setBrush(Qt::NoBrush);
+}

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.h (from rev 4486, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.h	2008-10-18 02:24:12 UTC (rev 4486)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_thumbSlider.h	2009-01-01 17:28:26 UTC (rev 4510)
@@ -0,0 +1,35 @@
+#ifndef T_THUMBSLIDER_H
+#define T_THUMBSLIDER_H
+
+#include <QtGui/QPainter>
+#include <QtGui/QPaintEvent>
+#include <QtGui/QMouseEvent>
+#include <QtGui/QSlider>
+
+class ThumbSlider : public QAbstractSlider
+{
+	Q_OBJECT
+
+private:
+	int timerId, count, lock;
+
+	void drawBackground(QPainter *painter);
+	void drawLines(QPainter *painter);
+	void drawBorders(QPainter *painter);
+	void drawEdges(QPainter *painter);
+
+public:
+	ThumbSlider(QWidget *parent = 0);
+
+protected:
+	void timerEvent(QTimerEvent *event);
+	void paintEvent(QPaintEvent *event);
+	void mousePressEvent(QMouseEvent *event);
+	void mouseMoveEvent(QMouseEvent *event);
+	void mouseReleaseEvent(QMouseEvent *event);
+
+signals:
+	void valueEmitted(int value);
+};
+
+#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2009-01-01 17:28:26 UTC (rev 4510)
@@ -1,13 +1,13 @@
 <ui version="4.0" >
- <author>mean</author>
+ <author>gruntster</author>
  <class>MainWindow</class>
  <widget class="QMainWindow" name="MainWindow" >
   <property name="geometry" >
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>838</width>
-    <height>568</height>
+    <width>709</width>
+    <height>526</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -24,21 +24,6 @@
   </property>
   <widget class="QWidget" name="centralwidget" >
    <layout class="QVBoxLayout" >
-    <property name="spacing" >
-     <number>6</number>
-    </property>
-    <property name="leftMargin" >
-     <number>9</number>
-    </property>
-    <property name="topMargin" >
-     <number>9</number>
-    </property>
-    <property name="rightMargin" >
-     <number>9</number>
-    </property>
-    <property name="bottomMargin" >
-     <number>9</number>
-    </property>
     <item>
      <layout class="QHBoxLayout" >
       <property name="spacing" >
@@ -104,6 +89,12 @@
               <height>16777215</height>
              </size>
             </property>
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
              <string>&lt;b>Video&lt;/b></string>
             </property>
@@ -259,6 +250,12 @@
               <height>16777215</height>
              </size>
             </property>
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
              <string>&lt;b>Audio&lt;/b></string>
             </property>
@@ -415,12 +412,12 @@
                     <verstretch>0</verstretch>
                    </sizepolicy>
                   </property>
-                  <property name="maximum" >
-                   <number>99999</number>
-                  </property>
                   <property name="minimum" >
                    <number>-99999</number>
                   </property>
+                  <property name="maximum" >
+                   <number>99999</number>
+                  </property>
                  </widget>
                 </item>
                 <item>
@@ -463,6 +460,12 @@
               <verstretch>0</verstretch>
              </sizepolicy>
             </property>
+            <property name="font" >
+             <font>
+              <weight>75</weight>
+              <bold>true</bold>
+             </font>
+            </property>
             <property name="text" >
              <string>&lt;b>Format&lt;/b></string>
             </property>
@@ -618,56 +621,26 @@
      </layout>
     </item>
     <item>
-     <layout class="QHBoxLayout" >
-      <property name="spacing" >
-       <number>6</number>
+     <spacer>
+      <property name="orientation" >
+       <enum>Qt::Vertical</enum>
       </property>
-      <property name="leftMargin" >
-       <number>0</number>
+      <property name="sizeType" >
+       <enum>QSizePolicy::MinimumExpanding</enum>
       </property>
-      <property name="topMargin" >
-       <number>0</number>
+      <property name="sizeHint" >
+       <size>
+        <width>687</width>
+        <height>6</height>
+       </size>
       </property>
-      <property name="rightMargin" >
-       <number>0</number>
-      </property>
-      <property name="bottomMargin" >
-       <number>0</number>
-      </property>
+     </spacer>
+    </item>
+    <item>
+     <layout class="QHBoxLayout" >
       <item>
-       <layout class="QVBoxLayout" >
-        <property name="spacing" >
-         <number>6</number>
-        </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
-        <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType" >
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
+       <layout class="QGridLayout" >
+        <item row="0" column="0" >
          <widget class="ADM_QSlider" name="horizontalSlider" >
           <property name="sizePolicy" >
            <sizepolicy vsizetype="Fixed" hsizetype="Expanding" >
@@ -680,745 +653,612 @@
           </property>
          </widget>
         </item>
-        <item>
-         <layout class="QHBoxLayout" >
+        <item row="1" column="0" >
+         <layout class="QVBoxLayout" >
           <property name="spacing" >
-           <number>6</number>
-          </property>
-          <property name="leftMargin" >
            <number>0</number>
           </property>
-          <property name="topMargin" >
-           <number>0</number>
-          </property>
-          <property name="rightMargin" >
-           <number>0</number>
-          </property>
-          <property name="bottomMargin" >
-           <number>0</number>
-          </property>
           <item>
-           <widget class="QToolButton" name="toolButtonPlay" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_play.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonStop" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_stop.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/back.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/forward.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousIntraFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_rew.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextIntraFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_fwd.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerA" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markA.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerB" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markB.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousBlackFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/prev_black.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextBlackFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/next_black.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonFirstFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_start.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonLastFrame" >
-            <property name="text" >
-             <string>...</string>
-            </property>
-            <property name="icon" >
-             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_end.png</iconset>
-            </property>
-            <property name="iconSize" >
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise" >
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
            <spacer>
             <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Preferred</enum>
+            </property>
             <property name="sizeHint" >
              <size>
               <width>20</width>
-              <height>20</height>
+              <height>10</height>
              </size>
             </property>
            </spacer>
           </item>
-         </layout>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" >
-          <property name="spacing" >
-           <number>6</number>
-          </property>
-          <property name="leftMargin" >
-           <number>0</number>
-          </property>
-          <property name="topMargin" >
-           <number>0</number>
-          </property>
-          <property name="rightMargin" >
-           <number>0</number>
-          </property>
-          <property name="bottomMargin" >
-           <number>0</number>
-          </property>
           <item>
-           <widget class="QLabel" name="label" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="font" >
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
-            </property>
-            <property name="text" >
-             <string>Frame:</string>
-            </property>
-           </widget>
+           <layout class="QHBoxLayout" >
+            <item>
+             <widget class="QToolButton" name="toolButtonPlay" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_play.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonStop" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_stop.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/back.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/forward.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousIntraFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_rew.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextIntraFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_fwd.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonSetMarkerA" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markA.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonSetMarkerB" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markB.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousBlackFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/prev_black.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextBlackFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/next_black.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonFirstFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_start.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonLastFrame" >
+              <property name="text" >
+               <string>...</string>
+              </property>
+              <property name="icon" >
+               <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_end.png</iconset>
+              </property>
+              <property name="iconSize" >
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>85</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
           </item>
           <item>
-           <widget class="QLineEdit" name="lineEdit" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Fixed" hsizetype="Fixed" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="maximumSize" >
-             <size>
-              <width>54</width>
-              <height>16777215</height>
-             </size>
-            </property>
-            <property name="baseSize" >
-             <size>
-              <width>0</width>
-              <height>0</height>
-             </size>
-            </property>
-            <property name="text" >
-             <string>0</string>
-            </property>
-            <property name="maxLength" >
-             <number>8</number>
-            </property>
-            <property name="echoMode" >
-             <enum>QLineEdit::Normal</enum>
-            </property>
-            <property name="cursorPosition" >
-             <number>1</number>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_2" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text" >
-             <string>/ 0</string>
-            </property>
-           </widget>
-          </item>
-          <item>
            <spacer>
             <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
             <property name="sizeType" >
-             <enum>QSizePolicy::Fixed</enum>
+             <enum>QSizePolicy::Preferred</enum>
             </property>
             <property name="sizeHint" >
              <size>
               <width>20</width>
-              <height>20</height>
+              <height>10</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <widget class="QLabel" name="label_6" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
+           <layout class="QHBoxLayout" >
+            <property name="spacing" >
+             <number>6</number>
             </property>
-            <property name="font" >
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
+            <property name="leftMargin" >
+             <number>0</number>
             </property>
-            <property name="text" >
-             <string>Time:</string>
+            <property name="topMargin" >
+             <number>0</number>
             </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLineEdit" name="lineEdit_2" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Fixed" hsizetype="Fixed" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
+            <property name="rightMargin" >
+             <number>0</number>
             </property>
-            <property name="maximumSize" >
-             <size>
-              <width>84</width>
-              <height>16777215</height>
-             </size>
+            <property name="bottomMargin" >
+             <number>0</number>
             </property>
-            <property name="text" >
-             <string>00:00:00.000</string>
-            </property>
-            <property name="maxLength" >
-             <number>12</number>
-            </property>
-           </widget>
+            <item>
+             <widget class="QLabel" name="label" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="font" >
+               <font>
+                <weight>75</weight>
+                <bold>true</bold>
+               </font>
+              </property>
+              <property name="text" >
+               <string>Frame:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLineEdit" name="lineEdit" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Fixed" hsizetype="Fixed" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="maximumSize" >
+               <size>
+                <width>54</width>
+                <height>16777215</height>
+               </size>
+              </property>
+              <property name="baseSize" >
+               <size>
+                <width>0</width>
+                <height>0</height>
+               </size>
+              </property>
+              <property name="text" >
+               <string>0</string>
+              </property>
+              <property name="maxLength" >
+               <number>8</number>
+              </property>
+              <property name="echoMode" >
+               <enum>QLineEdit::Normal</enum>
+              </property>
+              <property name="cursorPosition" >
+               <number>1</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_2" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text" >
+               <string>/ 0</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>20</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_6" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="font" >
+               <font>
+                <weight>75</weight>
+                <bold>true</bold>
+               </font>
+              </property>
+              <property name="text" >
+               <string>Time:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLineEdit" name="lineEdit_2" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Fixed" hsizetype="Fixed" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="maximumSize" >
+               <size>
+                <width>84</width>
+                <height>16777215</height>
+               </size>
+              </property>
+              <property name="text" >
+               <string>00:00:00.000</string>
+              </property>
+              <property name="maxLength" >
+               <number>12</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_7" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text" >
+               <string>/ 00:00:00.000</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>20</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_14" >
+              <property name="font" >
+               <font>
+                <weight>75</weight>
+                <bold>true</bold>
+               </font>
+              </property>
+              <property name="text" >
+               <string>Frame Type:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_8" >
+              <property name="sizePolicy" >
+               <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text" >
+               <string>?</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>60</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
           </item>
+         </layout>
+        </item>
+        <item row="1" column="1" >
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" >
+           <size>
+            <width>16</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item row="1" column="2" >
+         <layout class="QVBoxLayout" >
           <item>
-           <widget class="QLabel" name="label_7" >
+           <widget class="QLabel" name="label_10" >
             <property name="sizePolicy" >
-             <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+             <sizepolicy vsizetype="Minimum" hsizetype="Preferred" >
               <horstretch>0</horstretch>
               <verstretch>0</verstretch>
              </sizepolicy>
             </property>
-            <property name="text" >
-             <string>/ 00:00:00.000</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType" >
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" >
-             <size>
-              <width>20</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_14" >
             <property name="font" >
              <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
               <weight>75</weight>
-              <italic>false</italic>
               <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
              </font>
             </property>
             <property name="text" >
-             <string>Frame Type:</string>
+             <string>Selection</string>
             </property>
            </widget>
           </item>
           <item>
-           <widget class="QLabel" name="label_8" >
-            <property name="sizePolicy" >
-             <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text" >
-             <string>?</string>
-            </property>
-           </widget>
+           <layout class="QGridLayout" >
+            <item row="0" column="1" >
+             <widget class="QLabel" name="label_12" >
+              <property name="text" >
+               <string>A:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="0" column="2" >
+             <widget class="QPushButton" name="pushButtonJumpToMarkerA" >
+              <property name="text" >
+               <string>000000</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="1" >
+             <widget class="QLabel" name="label_11" >
+              <property name="text" >
+               <string>B:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="2" >
+             <widget class="QPushButton" name="pushButtonJumpToMarkerB" >
+              <property name="text" >
+               <string>000000</string>
+              </property>
+             </widget>
+            </item>
+            <item row="0" column="0" >
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>10</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
           </item>
-          <item>
-           <spacer>
-            <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeHint" >
-             <size>
-              <width>60</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
          </layout>
         </item>
-       </layout>
-      </item>
-      <item>
-       <spacer>
-        <property name="orientation" >
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeType" >
-         <enum>QSizePolicy::Fixed</enum>
-        </property>
-        <property name="sizeHint" >
-         <size>
-          <width>14</width>
-          <height>95</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout" >
-        <property name="spacing" >
-         <number>6</number>
-        </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
-        <item>
+        <item row="0" column="3" >
          <spacer>
           <property name="orientation" >
-           <enum>Qt::Vertical</enum>
+           <enum>Qt::Horizontal</enum>
           </property>
           <property name="sizeType" >
-           <enum>QSizePolicy::Expanding</enum>
+           <enum>QSizePolicy::Fixed</enum>
           </property>
           <property name="sizeHint" >
            <size>
-            <width>0</width>
-            <height>0</height>
+            <width>16</width>
+            <height>20</height>
            </size>
           </property>
          </spacer>
         </item>
-        <item>
-         <widget class="QGroupBox" name="groupBox" >
-          <property name="sizePolicy" >
-           <sizepolicy vsizetype="Minimum" hsizetype="Minimum" >
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize" >
-           <size>
-            <width>116</width>
-            <height>80</height>
-           </size>
-          </property>
-          <property name="font" >
-           <font>
-            <family>MS Shell Dlg 2</family>
-            <pointsize>8</pointsize>
-            <weight>75</weight>
-            <italic>false</italic>
-            <bold>true</bold>
-            <underline>false</underline>
-            <strikeout>false</strikeout>
-           </font>
-          </property>
-          <property name="title" >
-           <string>Selection</string>
-          </property>
-          <property name="alignment" >
-           <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
-          </property>
-          <widget class="QLabel" name="label_11" >
-           <property name="geometry" >
-            <rect>
-             <x>10</x>
-             <y>50</y>
-             <width>16</width>
-             <height>23</height>
-            </rect>
-           </property>
-           <property name="font" >
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="text" >
-            <string> B:</string>
-           </property>
-          </widget>
-          <widget class="QLabel" name="label_12" >
-           <property name="geometry" >
-            <rect>
-             <x>10</x>
-             <y>20</y>
-             <width>16</width>
-             <height>23</height>
-            </rect>
-           </property>
-           <property name="font" >
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="text" >
-            <string> A:</string>
-           </property>
-          </widget>
-          <widget class="QPushButton" name="pushButtonJumpToMarkerA" >
-           <property name="geometry" >
-            <rect>
-             <x>30</x>
-             <y>20</y>
-             <width>75</width>
-             <height>23</height>
-            </rect>
-           </property>
-           <property name="sizePolicy" >
-            <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="font" >
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="text" >
-            <string>000000</string>
-           </property>
-          </widget>
-          <widget class="QPushButton" name="pushButtonJumpToMarkerB" >
-           <property name="geometry" >
-            <rect>
-             <x>30</x>
-             <y>50</y>
-             <width>75</width>
-             <height>23</height>
-            </rect>
-           </property>
-           <property name="sizePolicy" >
-            <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="font" >
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="layoutDirection" >
-            <enum>Qt::LeftToRight</enum>
-           </property>
-           <property name="text" >
-            <string>000000</string>
-           </property>
-          </widget>
-         </widget>
+        <item row="0" column="2" >
+         <widget class="QWidget" native="1" name="sliderPlaceHolder" />
         </item>
        </layout>
       </item>
       <item>
-       <spacer>
-        <property name="orientation" >
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeType" >
-         <enum>QSizePolicy::Fixed</enum>
-        </property>
-        <property name="sizeHint" >
-         <size>
-          <width>14</width>
-          <height>95</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
        <layout class="QVBoxLayout" >
-        <property name="spacing" >
-         <number>4</number>
-        </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
         <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType" >
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
          <widget class="QToolButton" name="toolButtonAudioToggle" >
-          <property name="enabled" >
-           <bool>true</bool>
-          </property>
-          <property name="text" >
-           <string>...</string>
-          </property>
           <property name="icon" >
            <iconset resource="avidemux.qrc" >:/new/prefix1/pics/arts.png</iconset>
           </property>
@@ -1433,17 +1273,11 @@
         <item>
          <widget class="QSlider" name="horizontalSlider_2" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Minimum" hsizetype="Preferred" >
+           <sizepolicy vsizetype="Ignored" hsizetype="Fixed" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
           </property>
-          <property name="maximumSize" >
-           <size>
-            <width>16777215</width>
-            <height>64</height>
-           </size>
-          </property>
           <property name="maximum" >
            <number>100</number>
           </property>
@@ -1466,7 +1300,7 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>838</width>
+     <width>709</width>
      <height>22</height>
     </rect>
    </property>
@@ -2320,33 +2154,33 @@
   </action>
   <action name="actionVCD" >
    <property name="text" >
-    <string>&amp;VCD</string>
+    <string>&amp;Video CD...</string>
    </property>
   </action>
   <action name="actionSVCD" >
    <property name="text" >
-    <string>&amp;SVCD</string>
+    <string>&amp;Super Video CD...</string>
    </property>
   </action>
   <action name="actionDVD" >
    <property name="text" >
-    <string>&amp;DVD</string>
+    <string>&amp;DVD...</string>
    </property>
   </action>
   <action name="actionPSP" >
    <property name="text" >
-    <string>&amp;PSP</string>
+    <string>&amp;PlayStation Portable...</string>
    </property>
   </action>
   <action name="actionPSP_H264" >
    <property name="text" >
-    <string>PSP (&amp;H.264)</string>
+    <string>PlayStation Portable (&amp;H.264)...</string>
    </property>
    <property name="iconText" >
-    <string>PSP (H.264)</string>
+    <string>PlayStation Portable (H.264)</string>
    </property>
    <property name="toolTip" >
-    <string>PSP (H.264)</string>
+    <string>PlayStation Portable (H.264)</string>
    </property>
   </action>
   <action name="actionAdd_to_joblist" >
@@ -2502,12 +2336,12 @@
   </action>
   <action name="actionFLV" >
    <property name="text" >
-    <string>FLV</string>
+    <string>&amp;Flash Video</string>
    </property>
   </action>
   <action name="actionIPOD" >
    <property name="text" >
-    <string>IPOD (mpeg4)</string>
+    <string>&amp;iPod (MPEG-4 ASP)...</string>
    </property>
   </action>
   <action name="actionClose" >

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2009-01-01 16:45:10 UTC (rev 4509)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2009-01-01 17:28:26 UTC (rev 4510)
@@ -33,10 +33,10 @@
                              ONELINE(SVCD,QT_TR_NOOP("SVCD")),
                              ONELINE(DVD,QT_TR_NOOP("DVD")),
                              ONELINE(DVD_HD1,QT_TR_NOOP("DVD half D1")),
-                             ONELINE(PSP,QT_TR_NOOP("PSP 480*272")),
-                             ONELINE(PSP_FULLRES,QT_TR_NOOP("PSP full res (720*480")),
-                             ONELINE(IPOD,"IPOD 320*240"),
-                             ONELINE(IPOD640,"IPOD 640*480"),
+                             ONELINE(PSP,QT_TR_NOOP("PSP (480 * 272)")),
+                             ONELINE(PSP_FULLRES,QT_TR_NOOP("PSP full res. (720 * 480)")),
+                             ONELINE(IPOD,"iPod (320 * 240)"),
+                             ONELINE(IPOD640,"iPod (640 * 480)"),
                           };
              diaMenuEntry menuFAspect[3]={
                {RESWIZ_AR_1_1,QT_TR_NOOP("1:1"),NULL},



From gruntster at mail.berlios.de  Thu Jan  1 19:03:56 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 1 Jan 2009 19:03:56 +0100
Subject: [Avidemux-svn-commit] r4513 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src
Message-ID: <200901011803.n01I3u48031549@sheep.berlios.de>

Author: gruntster
Date: 2009-01-01 19:03:50 +0100 (Thu, 01 Jan 2009)
New Revision: 4513

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp
Log:
[Merge] missed merge

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp	2009-01-01 17:56:19 UTC (rev 4512)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_threadCount.cpp	2009-01-01 18:03:50 UTC (rev 4513)
@@ -57,11 +57,14 @@
 	text = new QLabel(QString::fromUtf8(title), widget);
 	text->setBuddy(radiobutton1);
 
+	QSpacerItem *spacer = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
 	layout->addWidget(text, line, 0);
 	layout->addWidget(radiobutton1, line, 1);
 	layout->addWidget(radiobutton2, line, 2);
 	layout->addWidget(radiobutton3, line, 3);
 	layout->addWidget(spinBox, line, 4);
+	layout->addItem(spacer,line,5);
 
 	QObject::connect(buttonGroup, SIGNAL(buttonClicked(QAbstractButton*)), this, SLOT(radioGroupChanged(QAbstractButton*)));
 



From gruntster at mail.berlios.de  Sat Jan  3 19:36:42 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 19:36:42 +0100
Subject: [Avidemux-svn-commit] r4514 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:
	gtk qt4
Message-ID: <200901031836.n03IagYG025575@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 19:36:34 +0100 (Sat, 03 Jan 2009)
New Revision: 4514

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
Log:
[x264] cosmetics

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/CMakeLists.txt	2009-01-01 18:03:50 UTC (rev 4513)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/CMakeLists.txt	2009-01-03 18:36:34 UTC (rev 4514)
@@ -22,6 +22,6 @@
 		TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ${GETTEXT_LIBRARY_DIR})
 	ENDIF(GETTEXT_FOUND)
 
-	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_x264_Gtk)
-	INSTALL(TARGETS ADM_vidEnc_x264_Gtk DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
+	INIT_VIDEO_ENCODER_PLUGIN(${GTK_PLUGIN_NAME})
+	INSTALL(TARGETS ${GTK_PLUGIN_NAME} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
 ENDIF (GTK_FOUND AND GTHREAD_FOUND)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt	2009-01-01 18:03:50 UTC (rev 4513)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/CMakeLists.txt	2009-01-03 18:36:34 UTC (rev 4514)
@@ -15,6 +15,6 @@
 	ADD_LIBRARY(${QT_PLUGIN_NAME} SHARED ${ADM_vidEnc_x264_Qt_SRCS})
 	TARGET_LINK_LIBRARIES(${QT_PLUGIN_NAME} ADM_vidEnc_x264 ADM_core ADM_coreUI ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY})
 
-	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_x264_Qt)
-	INSTALL(TARGETS ADM_vidEnc_x264_Qt DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
+	INIT_VIDEO_ENCODER_PLUGIN(${QT_PLUGIN_NAME})
+	INSTALL(TARGETS ${QT_PLUGIN_NAME} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
 ENDIF (QT4_FOUND)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2009-01-01 18:03:50 UTC (rev 4513)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2009-01-03 18:36:34 UTC (rev 4514)
@@ -2141,7 +2141,7 @@
             <item>
              <widget class="QCheckBox" name="fastPSkipCheckBox" >
               <property name="text" >
-               <string>Fast skip detection on P-frames</string>
+               <string>Fast Skip Detection on P-frames</string>
               </property>
              </widget>
             </item>



From gruntster at mail.berlios.de  Sat Jan  3 19:38:40 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 19:38:40 +0100
Subject: [Avidemux-svn-commit] r4515 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. gtk qt4
Message-ID: <200901031838.n03Ice4W028765@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 19:38:28 +0100 (Sat, 03 Jan 2009)
New Revision: 4515

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
Log:
[xvid] new options window for Qt

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-01-03 18:38:28 UTC (rev 4515)
@@ -4,10 +4,10 @@
 checkXvid()
 
 IF (XVID_FOUND)
-	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})
+	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${XVID_INCLUDE_DIR})
 
-	SET(QT_PLUGIN_NAME "ADM_vidEnc_xvid_Qt")
-	SET(GTK_PLUGIN_NAME "ADM_vidEnc_xvid_Gtk")
+	SET(QT_PLUGIN_NAME "ADM_vidEnc_Xvid_Qt")
+	SET(GTK_PLUGIN_NAME "ADM_vidEnc_Xvid_Gtk")
 	SET(PLUGIN_SUBDIR "xvid")
 	SET(ADM_vidEnc_xvid_SRCS interface.c  encoder.cpp  options.cpp  configGuiLoader.cpp)
 
@@ -16,7 +16,7 @@
 	ADD_SUBDIRECTORY(gtk)
 	ADD_SUBDIRECTORY(qt4)
 	ADD_LIBRARY(ADM_vidEnc_xvid SHARED ${ADM_vidEnc_xvid_SRCS})
-	TARGET_LINK_LIBRARIES(ADM_vidEnc_xvid ADM_core)
+	TARGET_LINK_LIBRARIES(ADM_vidEnc_xvid ADM_core ${XVID_LIBRARY_DIR})
 
 	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_xvid)
 	INSTALL_VIDEO_ENCODER(ADM_vidEnc_xvid)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h	2009-01-03 18:38:28 UTC (rev 4515)
@@ -9,7 +9,7 @@
 #include "ADM_vidEnc_plugin.h"
 }
 
-typedef bool _showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, xvidOptions *options);
+typedef bool _showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options);
 
 class configGuiLoader : public ADM_LibWrapper
 {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-03 18:38:28 UTC (rev 4515)
@@ -31,7 +31,7 @@
 		int _uiType;
 
 		configGuiLoader *_loader;
-		xvidOptions _options;
+		XvidOptions _options;
 		vidEncOptions _encodeOptions;
 
 		int _currentPass, _passCount;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-03 18:38:28 UTC (rev 4515)
@@ -22,6 +22,6 @@
 		TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ${GETTEXT_LIBRARY_DIR})
 	ENDIF(GETTEXT_FOUND)
 
-	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_xvid_Gtk)
-	INSTALL(TARGETS ADM_vidEnc_xvid_Gtk DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
+	INIT_VIDEO_ENCODER_PLUGIN(${GTK_PLUGIN_NAME})
+	INSTALL(TARGETS ${GTK_PLUGIN_NAME} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
 ENDIF (GTK_FOUND AND GTHREAD_FOUND)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-03 18:38:28 UTC (rev 4515)
@@ -61,7 +61,7 @@
     XVID4_RESPONSE_LAST,
 }XVID4_CODE;
 
-extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, xvidOptions *options)
+extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options)
 {
 	int b;
 	int ret=0;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-03 18:38:28 UTC (rev 4515)
@@ -1,5 +1,5 @@
  /***************************************************************************
-                               xvidOptions.cpp
+                               XvidOptions.cpp
 
 	These settings are intended for scripting and can contain a Preset 
 	Configuration block.  If this block exists then "internal" settings are
@@ -21,14 +21,346 @@
  *                                                                         *
  ***************************************************************************/
 
+#include <string.h>
 #include "options.h"
 
-xvidOptions::xvidOptions(void)
+XvidOptions::XvidOptions(void)
 {
+	memset(&xvid_enc_create, 0, sizeof(xvid_enc_create_t));
+	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
 
+	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL;
+
+	setMaxKeyInterval(240);
+	setMinQuantiser(2, 2, 2);
+	setMaxQuantiser(31, 31, 31);
+	setPar(1, 1);
 }
 
-xvidOptions::~xvidOptions(void)
+XvidOptions::~XvidOptions(void)
 {
 
 }
+
+MotionEstimationMode XvidOptions::getMotionEstimation(void)
+{
+	if (xvid_enc_frame.motion & ME_HIGH == ME_HIGH)
+		return ME_HIGH;
+	else if (xvid_enc_frame.motion & ME_MEDIUM == ME_MEDIUM)
+		return ME_MEDIUM;
+	else if (xvid_enc_frame.motion & ME_LOW == ME_LOW)
+		return ME_LOW;
+	else
+		return ME_NONE;
+}
+
+void XvidOptions::setMotionEstimation(MotionEstimationMode motionEstimation)
+{
+	if (motionEstimation == ME_NONE || motionEstimation == ME_LOW || motionEstimation == ME_MEDIUM || motionEstimation == ME_HIGH)
+	{
+		xvid_enc_frame.motion &= ~ME_NONE;
+		xvid_enc_frame.motion &= ~ME_LOW;
+		xvid_enc_frame.motion &= ~ME_MEDIUM;
+		xvid_enc_frame.motion &= ~ME_HIGH;
+		xvid_enc_frame.motion |= motionEstimation;
+	}
+}
+
+unsigned int XvidOptions::getMaxKeyInterval(void)
+{
+	return xvid_enc_create.max_key_interval;
+}
+
+void XvidOptions::setMaxKeyInterval(unsigned int maxKeyInterval)
+{
+	if (maxKeyInterval > 0 && maxKeyInterval <= 900)
+		xvid_enc_create.max_key_interval = maxKeyInterval;
+}
+
+unsigned int XvidOptions::getMaxBFrames(void)
+{
+	return xvid_enc_create.max_bframes;
+}
+
+void XvidOptions::setMaxBFrames(unsigned int maxBFrames)
+{
+	if (maxBFrames <= 3)
+		xvid_enc_create.max_bframes = maxBFrames;
+}
+
+bool XvidOptions::getMpegQuantisation(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
+}
+
+void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
+{
+	if (mpegQuantisation)
+		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
+	else
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
+}
+
+bool XvidOptions::getInterlaced(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_INTERLACING;
+}
+
+void XvidOptions::setInterlaced(bool interlaced)
+{
+	if (interlaced)
+		xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
+	else
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_INTERLACING;
+}
+
+bool XvidOptions::getInterMotionVector(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_INTER4V;
+}
+
+void XvidOptions::setInterMotionVector(bool interMotionVector)
+{
+	if (interMotionVector)
+	{
+		xvid_enc_frame.vop_flags |= XVID_VOP_INTER4V;
+
+		if (getQpel())
+			setQpel(true);
+	}
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_INTER4V;
+}
+
+bool XvidOptions::getTrellis(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
+}
+
+void XvidOptions::setTrellis(bool trellis)
+{
+	if (trellis)
+		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
+}
+
+bool XvidOptions::getCartoon(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_CARTOON;
+}
+
+void XvidOptions::setCartoon(bool cartoon)
+{
+	if (cartoon)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_CARTOON;
+}
+
+bool XvidOptions::getGreyscale(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_GREYSCALE;
+}
+
+void XvidOptions::setGreyscale(bool greyscale)
+{
+	if (greyscale)
+		xvid_enc_frame.vop_flags |= XVID_VOP_GREYSCALE;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_GREYSCALE;
+}
+
+bool XvidOptions::getQpel(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_QUARTERPEL;
+}
+
+void XvidOptions::setQpel(bool qpel)
+{
+	if (qpel)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
+
+		if (getInterMotionVector())
+			xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE16;
+		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE8;
+	}
+}
+
+bool XvidOptions::getGmc(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_GMC;
+}
+
+void XvidOptions::setGmc(bool gmc)
+{
+	if (gmc)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
+		xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_GMC;
+		xvid_enc_frame.motion &= ~XVID_ME_GME_REFINE;
+	}
+}
+
+bool XvidOptions::getBvhq(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_RD_BVOP;
+}
+
+void XvidOptions::setBvhq(bool bvhq)
+{
+	if (bvhq)
+		xvid_enc_frame.vop_flags |= XVID_VOP_RD_BVOP;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_RD_BVOP;
+}
+
+bool XvidOptions::getAcPrediction(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_HQACPRED;
+}
+
+void XvidOptions::setAcPrediction(bool acPrediction)
+{
+	if (acPrediction)
+		xvid_enc_frame.vop_flags |= XVID_VOP_HQACPRED;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_HQACPRED;
+}
+
+bool XvidOptions::getChromaOptimisation(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_CHROMAOPT;
+}
+
+void XvidOptions::setChromaOptimisation(bool chromaOptimisation)
+{
+	if (chromaOptimisation)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CHROMAOPT;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_CHROMAOPT;
+}
+
+void XvidOptions::getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
+{
+	*i = xvid_enc_create.min_quant[0];
+	*p = xvid_enc_create.min_quant[1];
+	*b = xvid_enc_create.min_quant[2];
+}
+
+void XvidOptions::setMinQuantiser(unsigned int i, unsigned int p, unsigned int b)
+{
+	if (i > 0 && i <= 51)
+		xvid_enc_create.min_quant[0] = i;
+
+	if (p > 0 && p <= 51)
+		xvid_enc_create.min_quant[1] = p;
+
+	if (b > 0 && b <= 51)
+		xvid_enc_create.min_quant[2] = b;
+}
+
+void XvidOptions::getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
+{
+	*i = xvid_enc_create.max_quant[0];
+	*p = xvid_enc_create.max_quant[1];
+	*b = xvid_enc_create.max_quant[2];
+}
+
+void XvidOptions::setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b)
+{
+	if (i > 0 && i <= 51)
+		xvid_enc_create.max_quant[0] = i;
+
+	if (p > 0 && p <= 51)
+		xvid_enc_create.max_quant[1] = p;
+
+	if (b > 0 && b <= 51)
+		xvid_enc_create.max_quant[2] = b;
+}
+
+void XvidOptions::getPar(unsigned int *width, unsigned int *height)
+{
+	*width = xvid_enc_frame.par_width;
+	*height = xvid_enc_frame.par_height;
+}
+
+void XvidOptions::setPar(unsigned int width, unsigned int height)
+{
+	if (width > 0)
+		xvid_enc_frame.par_width = width;
+
+	if (height > 0)
+		xvid_enc_frame.par_height = height;
+
+	  if (xvid_enc_frame.par_width != xvid_enc_frame.par_height)
+		  xvid_enc_frame.par = XVID_PAR_EXT;
+	  else
+		  xvid_enc_frame.par = XVID_PAR_11_VGA;
+}
+
+RateDistortionMode XvidOptions::getRateDistortion(RateDistortionMode rateDistortion)
+{
+	if (xvid_enc_frame.motion & RD_SQUARE == RD_SQUARE)
+		return RD_SQUARE;
+	else if (xvid_enc_frame.motion & RD_HPEL_QPEL_8 == RD_HPEL_QPEL_8)
+		return RD_HPEL_QPEL_8;
+	else if (xvid_enc_frame.motion & RD_HPEL_QPEL_16 == RD_HPEL_QPEL_16)
+		return RD_HPEL_QPEL_16;
+	else if (xvid_enc_frame.motion & RD_DCT_ME == RD_DCT_ME)
+		return RD_DCT_ME;
+	else
+		return RD_NONE;
+}
+
+void XvidOptions::setRateDistortion(RateDistortionMode rateDistortion)
+{
+	if (rateDistortion == RD_NONE || rateDistortion == RD_DCT_ME || rateDistortion == RD_HPEL_QPEL_16 || 
+		rateDistortion == RD_HPEL_QPEL_8 || rateDistortion == RD_SQUARE)
+	{
+		xvid_enc_frame.motion &= ~RD_NONE;
+		xvid_enc_frame.motion &= ~RD_DCT_ME;
+		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_16;
+		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_8;
+		xvid_enc_frame.motion &= ~RD_SQUARE;
+		xvid_enc_frame.motion |= rateDistortion;
+	}
+}
+
+bool XvidOptions::getPacked(void)
+{
+	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
+}
+
+void XvidOptions::setPacked(bool packed)
+{
+	if (packed)
+		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
+	else
+		xvid_enc_create.global &= ~XVID_GLOBAL_PACKED;
+}
+
+bool XvidOptions::getClosedGop(void)
+{
+	return xvid_enc_create.global & XVID_GLOBAL_CLOSED_GOP;
+}
+
+void XvidOptions::setClosedGop(bool closedGop)
+{
+	if (closedGop)
+		xvid_enc_create.global |= XVID_GLOBAL_CLOSED_GOP;
+	else
+		xvid_enc_create.global &= ~XVID_GLOBAL_CLOSED_GOP;
+}
+

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-03 18:38:28 UTC (rev 4515)
@@ -1,5 +1,5 @@
 /***************************************************************************
-                                xvidOptions.h
+                                XvidOptions.h
 
     begin                : Fri Jun 13 2008
     copyright            : (C) 2008 by gruntster
@@ -17,11 +17,94 @@
 #ifndef options_h
 #define options_h
 
-class xvidOptions
+#include "xvid.h"
+
+enum MotionEstimationMode
 {
+	ME_NONE = 0,
+	ME_LOW = XVID_ME_HALFPELREFINE16,	
+	ME_MEDIUM = XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,	
+	ME_HIGH = XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 | XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
+};
+
+enum RateDistortionMode
+{
+	RD_NONE = 0,
+	RD_DCT_ME = XVID_VOP_MODEDECISION_RD,
+	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
+	RD_HPEL_QPEL_8 = RD_HPEL_QPEL_16 | XVID_ME_HALFPELREFINE8_RD | XVID_ME_QUARTERPELREFINE8_RD | XVID_ME_CHECKPREDICTION_RD,
+	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
+};
+
+class XvidOptions
+{
+protected:
+	xvid_enc_create_t xvid_enc_create;
+	xvid_enc_frame_t xvid_enc_frame;
+
 public:
-	xvidOptions(void);
-	~xvidOptions(void);
+	XvidOptions(void);
+	~XvidOptions(void);
+
+	MotionEstimationMode getMotionEstimation(void);
+	void setMotionEstimation(MotionEstimationMode motionEstimation);
+
+	unsigned int getMaxKeyInterval(void);
+	void setMaxKeyInterval(unsigned int maxKeyInterval);
+
+	unsigned int getMaxBFrames(void);
+	void setMaxBFrames(unsigned int maxBFrames);
+
+	bool getMpegQuantisation(void);
+	void setMpegQuantisation(bool mpegQuantisation);
+
+	bool getInterlaced(void);
+	void setInterlaced(bool interlaced);
+
+	bool getInterMotionVector(void);
+	void setInterMotionVector(bool interMotionVector);
+
+	bool getTrellis(void);
+	void setTrellis(bool trellis);
+
+	bool getCartoon(void);
+	void setCartoon(bool cartoon);
+
+	bool getGreyscale(void);
+	void setGreyscale(bool greyscale);
+
+	bool getQpel(void);
+	void setQpel(bool qpel);
+
+	bool getGmc(void);
+	void setGmc(bool gmc);
+
+	bool getBvhq(void);
+	void setBvhq(bool bvhq);
+
+	bool getAcPrediction(void);
+	void setAcPrediction(bool acPrediction);
+
+	bool getChromaOptimisation(void);
+	void setChromaOptimisation(bool chromaOptimisation);
+
+	void getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
+	void setMinQuantiser(unsigned int i, unsigned int p, unsigned int b);
+
+	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
+	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
+
+	void getPar(unsigned int *width, unsigned int *height);
+	void setPar(unsigned int width, unsigned int height);
+
+	RateDistortionMode getRateDistortion(RateDistortionMode rateDistortion);
+	void setRateDistortion(RateDistortionMode rateDistortion);
+
+	bool getPacked(void);
+	void setPacked(bool packed);
+
+	bool getClosedGop(void);
+	void setClosedGop(bool closedGop);
 };
 
 #endif	// options_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt	2009-01-03 18:38:28 UTC (rev 4515)
@@ -4,12 +4,17 @@
 checkQt4()
 
 IF (QT4_FOUND)
-	SET(ADM_vidEnc_xvid_Qt_SRCS xvidConfigDialog.cpp)
+	QT4_WRAP_UI(xvidQt_headers
+		xvidConfigDialog.ui)
+	QT4_WRAP_CPP(xvidQt_source
+		xvidConfigDialog.h)
+	SET(ADM_vidEnc_xvid_Qt_SRCS
+		${xvidQt_headers} ${xvidQt_source} xvidConfigDialog.cpp)
 
-	INCLUDE_DIRECTORIES(${QT_INCLUDE_DIR} ${AVIDEMUX_SOURCE_DIR}/avidemux)
+	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
 	ADD_LIBRARY(${QT_PLUGIN_NAME} SHARED ${ADM_vidEnc_xvid_Qt_SRCS})
 	TARGET_LINK_LIBRARIES(${QT_PLUGIN_NAME} ADM_vidEnc_xvid ADM_coreUI ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY})
 
-	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_xvid_Qt)
-	INSTALL(TARGETS ADM_vidEnc_xvid_Qt DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
+	INIT_VIDEO_ENCODER_PLUGIN(${QT_PLUGIN_NAME})
+	INSTALL(TARGETS ${QT_PLUGIN_NAME} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
 ENDIF (QT4_FOUND)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-03 18:38:28 UTC (rev 4515)
@@ -15,127 +15,25 @@
  *   the Free Software Foundation; either version 2 of the License, or     *
  *   (at your option) any later version.                                   *
  *                                                                         *
- ***************************************************************************/
-#include <QtCore/QtGlobal>
-
-#include "ADM_inttype.h"
-#include "DIA_factory.h"
-
-#include "../options.h"
-
-#include "xvidConfigDialog.h"
-
-extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, xvidOptions *options)
-{
-	int b;
-	int ret=0;
-	int code;
-	uint32_t dummy;
-//	xvid4EncParam localParam;
-//	ADM_assert(incoming->extraSettingsLen==sizeof(localParam));
-//	memcpy(&localParam,incoming->extraSettings,sizeof(localParam));
-#define PX(x) &dummy
-	// Our tabs
-	/* Tab 1 main */
-	//diaElemBitrate bitrate(NULL,NULL);
-#define MKTOGGLE(y,x)           diaElemToggle  t_##x(PX(x),y)
-	MKTOGGLE(QT_TR_NOOP("_Interlaced"),	    interlaced);
-	MKTOGGLE(QT_TR_NOOP("Ca_rtoon mode"),      cartoon);
-	MKTOGGLE(QT_TR_NOOP("_Greyscale"),         greyscale);
-	MKTOGGLE(QT_TR_NOOP("Turbo mode"),      turbo);
-	MKTOGGLE(QT_TR_NOOP("C_hroma optimizer"),         chroma_opt);
-	//diaElem *main[]={&bitrate,&t_interlaced,&t_cartoon,&t_greyscale,&t_turbo,&t_chroma_opt};
-	diaElem *main[]={&t_interlaced,&t_cartoon,&t_greyscale,&t_turbo,&t_chroma_opt};
-	diaElemTabs tabMain(QT_TR_NOOP("Main"),5,main);
-	/* Tab 2 motion */
-	diaMenuEntry motionMenu[] = {
-		{0,       QT_TR_NOOP("None"),NULL}
-		,{1,      QT_TR_NOOP("Very Low"),NULL}
-		,{2,      QT_TR_NOOP("Low"),NULL}
-		,{3,      QT_TR_NOOP("Medium"),NULL}
-		,{4,      QT_TR_NOOP("High"),NULL}
-		,{5,      QT_TR_NOOP("Very High"),NULL}
-		,{6,      QT_TR_NOOP("Ultra High"),NULL}};
-
-	diaElemMenu motion(PX(guiLevel),QT_TR_NOOP("Motion Search Precision"),7,motionMenu);
-
-	diaMenuEntry vhqMenu[] = {
-		{0,       QT_TR_NOOP("Off"),NULL}
-		,{1,      QT_TR_NOOP("Mode Decision"),NULL}
-		,{2,      QT_TR_NOOP("Limited Search"),NULL}
-		,{3,      QT_TR_NOOP("Medium Search"),NULL}
-		,{4,      QT_TR_NOOP("Wide Search"),NULL} };
-
-	diaElemMenu vhq(PX(vhqmode),QT_TR_NOOP("VHQ Mode"),5,vhqMenu);
-
-	/* Tab2-ASP */
-	diaElemUInteger  bframe(PX(bframes),QT_TR_NOOP("Max B Frames"),0,3);
-	diaElemToggle    qpel(PX(qpel),QT_TR_NOOP("Quarter Pixel"));
-	diaElemToggle    gmc(PX(gmc),QT_TR_NOOP("GMC"));
-	diaElemToggle    bvhq(PX(bvhq),QT_TR_NOOP("BVHQ"));
-	diaElemFrame  frameASP(QT_TR_NOOP("Advanced Simple Profile"));
-	frameASP.swallow(&bframe);
-	frameASP.swallow(&qpel);
-	frameASP.swallow(&gmc);
-	frameASP.swallow(&bvhq);
-
-	/* Tab 2 motion extra */
-	diaElemToggle    inter4mv(PX(inter4mv),QT_TR_NOOP("4MV"));
-	diaElemToggle    chroma_me(PX(chroma_me),QT_TR_NOOP("Chroma ME"));
-	diaElemToggle    hqac(PX(chroma_me),QT_TR_NOOP("HQ AC"));
-	diaElemFrame  frameMore(QT_TR_NOOP("More Search"));
-	frameMore.swallow(&inter4mv);
-	frameMore.swallow(&chroma_me);
-	frameMore.swallow(&hqac);
-	/* Tab 2 gop size */
-	diaElemUInteger  min_key_interval(PX(min_key_interval),QT_TR_NOOP("Min Gop Size"),1,900);
-	diaElemUInteger  max_key_interval(PX(max_key_interval),QT_TR_NOOP("Max Gop Size"),1,900);
-	diaElemFrame  frameGop(QT_TR_NOOP("GOP Size"));
-	frameGop.swallow(&min_key_interval);
-	frameGop.swallow(&max_key_interval);
-
-	diaElem *motions[]={&motion,&vhq,&frameMore,&frameGop,&frameASP};
-	diaElemTabs tabMotion(QT_TR_NOOP("Motion"),5,motions);
-
-	/* Tab 3 Qz*/
-	diaMenuEntry qzMenu[] = {
-		{0,       QT_TR_NOOP("H263"),NULL}
-		,{1,      QT_TR_NOOP("Mpeg"),NULL}}                            ;
-	diaElemMenu h263(PX(mpegQuantizer),QT_TR_NOOP("Quantization Matrix"),2,qzMenu);
-	diaElemToggle    trellis(PX(trellis),QT_TR_NOOP("Trellis Quantization"));
-
-	diaElem *qz[]={&h263,&trellis};
-	diaElemTabs tabQz(QT_TR_NOOP("Quantization"),2,qz);
-
-		/* Tab 4 : 2nd pass */
-#define MKENTRY(y,x) diaElemUInteger x(PX(x),y,0,100); frameOne.swallow(&x);
-	diaElemFrame  frameOne(QT_TR_NOOP("Two Pass Tuning")); 
-
-	MKENTRY(QT_TR_NOOP("Key Frame Boost(%)"), keyframe_boost);
-
-	MKENTRY(QT_TR_NOOP("I-frames closer than..."), kfthreshold);
-	MKENTRY(QT_TR_NOOP(".. are reduced by(%)"), kfreduction);
-	MKENTRY(QT_TR_NOOP("Max Overflow Improvement(%)"), max_overflow_improvement);
-	MKENTRY(QT_TR_NOOP("Max Overglow Degradation(%)"), max_overflow_degradation);
-
-#undef MKENTRY
-#define MKENTRY(y,x) diaElemUInteger  x(PX(x),y,0,100);frameTwo.swallow(&x);
-	diaElemFrame  frameTwo(QT_TR_NOOP("Curve Compression"));
-
-	MKENTRY(QT_TR_NOOP("High Bitrate Scenes (%)"), curve_compression_high);
-	MKENTRY(QT_TR_NOOP("Low Bitrate Scenes (%)"), curve_compression_low);
-	MKENTRY(QT_TR_NOOP("Overflow Control Strength"), overflow_control_strength);
-
-	diaElem *twopass[]={&frameOne,&frameTwo};
-	diaElemTabs tabPass(QT_TR_NOOP("Two Pass"),2,twopass);
-
-	/* End of tabs */
-	diaElemTabs *tabs[4]={&tabMain,&tabMotion,&tabQz,&tabPass};
-	if( diaFactoryRunTabs(QT_TR_NOOP("Xvid4 Configuration"),4,tabs))
-	{
-		//memcpy(incoming->extraSettings,&localParam,sizeof(localParam));
-		return 1;
-	}
-
-	return 0;
-}
+***************************************************************************/
+#include "xvidConfigDialog.h"
+
+XvidConfigDialog::XvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options) :
+	QDialog((QWidget*)configParameters->parent, Qt::Dialog)
+{
+	ui.setupUi(this);
+}
+
+extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options)
+{
+	XvidConfigDialog dialog(configParameters, properties, encodeOptions, options);
+
+	if (dialog.exec() == QDialog::Accepted)
+	{
+		//dialog.saveSettings(encodeOptions, options);
+
+		return 1;
+	}
+
+	return 0;	
+}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-03 18:38:28 UTC (rev 4515)
@@ -1,9 +1,22 @@
-#ifndef xvidConfigDialog_h
-#define xvidConfigDialog_h
+#ifndef XvidConfigDialog_h
+#define XvidConfigDialog_h
 
+#include "ui_xvidConfigDialog.h"
+#include "../options.h"
+
 extern "C"
 {
 #include "ADM_vidEnc_plugin.h"
 }
 
-#endif	// xvidConfigDialog_h
+class XvidConfigDialog : public QDialog
+{
+	Q_OBJECT
+
+private:
+	Ui_XvidConfigDialog ui;
+
+public:
+	XvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options);
+};
+#endif	// XvidConfigDialog_h

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-03 18:36:34 UTC (rev 4514)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-03 18:38:28 UTC (rev 4515)
@@ -0,0 +1,2731 @@
+<ui version="4.0" >
+ <author>(C) 2008 by gruntster</author>
+ <class>XvidConfigDialog</class>
+ <widget class="QDialog" name="XvidConfigDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>500</width>
+    <height>570</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Xvid Configuraton</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeType" >
+        <enum>QSizePolicy::Expanding</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QLabel" name="label_3" >
+       <property name="text" >
+        <string>Configuration:</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QComboBox" name="configurationComboBox" >
+       <property name="minimumSize" >
+        <size>
+         <width>200</width>
+         <height>0</height>
+        </size>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="saveAsButton" >
+       <property name="text" >
+        <string>Save As</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="deleteButton" >
+       <property name="text" >
+        <string>Delete</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Fixed</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>491</width>
+       <height>16</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <widget class="QTabWidget" name="tabWidget" >
+     <property name="currentIndex" >
+      <number>0</number>
+     </property>
+     <widget class="QWidget" name="tab_1" >
+      <attribute name="title" >
+       <string>General</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox_2" >
+         <property name="title" >
+          <string>Rate Control</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QGridLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item row="1" column="0" >
+             <widget class="QLabel" name="targetRateControlLabel1" >
+              <property name="font" >
+               <font>
+                <family>MS Shell Dlg 2</family>
+                <pointsize>8</pointsize>
+                <weight>50</weight>
+                <italic>false</italic>
+                <bold>false</bold>
+                <underline>false</underline>
+                <strikeout>false</strikeout>
+               </font>
+              </property>
+              <property name="text" >
+               <string>Target Video Size:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="0" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="encodingModeComboBox" >
+                <property name="font" >
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="currentIndex" >
+                 <number>2</number>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>Constant Bitrate (Single Pass)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Constant Quantiser (Single Pass)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Video Size (Two Pass)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Average Bitrate (Two Pass)</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="0" column="0" >
+             <widget class="QLabel" name="label" >
+              <property name="font" >
+               <font>
+                <family>MS Shell Dlg 2</family>
+                <pointsize>8</pointsize>
+                <weight>50</weight>
+                <italic>false</italic>
+                <bold>false</bold>
+                <underline>false</underline>
+                <strikeout>false</strikeout>
+               </font>
+              </property>
+              <property name="text" >
+               <string>Encoding Mode:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="targetRateControlSpinBox" >
+                <property name="font" >
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="prefix" >
+                 <string/>
+                </property>
+                <property name="maximum" >
+                 <number>999999999</number>
+                </property>
+                <property name="value" >
+                 <number>700</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QLabel" name="targetRateControlLabel2" >
+                <property name="font" >
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="text" >
+                 <string>MB</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>183</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Vertical</enum>
+            </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>4</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>12</number>
+              </property>
+              <item>
+               <layout class="QVBoxLayout" >
+                <property name="margin" >
+                 <number>0</number>
+                </property>
+                <property name="spacing" >
+                 <number>0</number>
+                </property>
+                <item>
+                 <layout class="QHBoxLayout" >
+                  <property name="margin" >
+                   <number>0</number>
+                  </property>
+                  <property name="spacing" >
+                   <number>0</number>
+                  </property>
+                  <item>
+                   <widget class="QLabel" name="quantiserLabel1" >
+                    <property name="enabled" >
+                     <bool>false</bool>
+                    </property>
+                    <property name="text" >
+                     <string>0 (High Quality)</string>
+                    </property>
+                   </widget>
+                  </item>
+                  <item>
+                   <spacer>
+                    <property name="orientation" >
+                     <enum>Qt::Horizontal</enum>
+                    </property>
+                    <property name="sizeHint" >
+                     <size>
+                      <width>40</width>
+                      <height>20</height>
+                     </size>
+                    </property>
+                   </spacer>
+                  </item>
+                  <item>
+                   <widget class="QLabel" name="quantiserLabel2" >
+                    <property name="enabled" >
+                     <bool>false</bool>
+                    </property>
+                    <property name="text" >
+                     <string>Quantiser</string>
+                    </property>
+                   </widget>
+                  </item>
+                  <item>
+                   <spacer>
+                    <property name="orientation" >
+                     <enum>Qt::Horizontal</enum>
+                    </property>
+                    <property name="sizeHint" >
+                     <size>
+                      <width>40</width>
+                      <height>20</height>
+                     </size>
+                    </property>
+                   </spacer>
+                  </item>
+                  <item>
+                   <widget class="QLabel" name="quantiserLabel3" >
+                    <property name="enabled" >
+                     <bool>false</bool>
+                    </property>
+                    <property name="text" >
+                     <string>51 (Low Quality)</string>
+                    </property>
+                   </widget>
+                  </item>
+                 </layout>
+                </item>
+                <item>
+                 <widget class="QSlider" name="quantiserSlider" >
+                  <property name="enabled" >
+                   <bool>false</bool>
+                  </property>
+                  <property name="minimumSize" >
+                   <size>
+                    <width>375</width>
+                    <height>0</height>
+                   </size>
+                  </property>
+                  <property name="maximum" >
+                   <number>51</number>
+                  </property>
+                  <property name="pageStep" >
+                   <number>5</number>
+                  </property>
+                  <property name="value" >
+                   <number>26</number>
+                  </property>
+                  <property name="orientation" >
+                   <enum>Qt::Horizontal</enum>
+                  </property>
+                  <property name="tickPosition" >
+                   <enum>QSlider::TicksBelow</enum>
+                  </property>
+                 </widget>
+                </item>
+               </layout>
+              </item>
+              <item>
+               <widget class="QSpinBox" name="quantiserSpinBox" >
+                <property name="enabled" >
+                 <bool>false</bool>
+                </property>
+                <property name="maximum" >
+                 <number>51</number>
+                </property>
+                <property name="value" >
+                 <number>26</number>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_15" >
+         <property name="title" >
+          <string>Pixel Aspect Ratio</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QGridLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item row="0" column="0" >
+             <widget class="QRadioButton" name="sarCustomRadioButton" >
+              <property name="text" >
+               <string>Custom:</string>
+              </property>
+              <property name="checked" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item row="2" column="0" >
+             <widget class="QRadioButton" name="sarAsInputRadioButton" >
+              <property name="text" >
+               <string>As Input</string>
+              </property>
+             </widget>
+            </item>
+            <item row="2" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QLabel" name="sarAsInputLabel" >
+                <property name="enabled" >
+                 <bool>false</bool>
+                </property>
+                <property name="text" >
+                 <string/>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="0" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="sarCustomSpinBox1" >
+                <property name="maximum" >
+                 <number>9999</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>1</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QLabel" name="sarCustomLabel" >
+                <property name="text" >
+                 <string>:</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QSpinBox" name="sarCustomSpinBox2" >
+                <property name="maximum" >
+                 <number>9999</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>1</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="1" column="0" >
+             <widget class="QRadioButton" name="sarPredefinedRadioButton" >
+              <property name="text" >
+               <string>Predefined Aspect Ratio:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="sarPredefinedComboBox" >
+                <property name="enabled" >
+                 <bool>false</bool>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>16:15 (PAL 4:3)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>64:45 (PAL 16:9)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>8:9 (NTSC 4:3)</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>32:27 (NTSC 16:9)</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_17" >
+         <property name="title" >
+          <string>Multithreading</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QRadioButton" name="threadDisableRadioButton" >
+              <property name="text" >
+               <string>Disable</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QRadioButton" name="threadAutoDetectRadioButton" >
+              <property name="text" >
+               <string>Auto-detect</string>
+              </property>
+              <property name="checked" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QRadioButton" name="threadCustomRadioButton" >
+                <property name="text" >
+                 <string>Custom:</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QSpinBox" name="threadCustomSpinBox" >
+                <property name="enabled" >
+                 <bool>false</bool>
+                </property>
+                <property name="maximum" >
+                 <number>32</number>
+                </property>
+                <property name="minimum" >
+                 <number>2</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>436</width>
+           <height>111</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_2" >
+      <attribute name="title" >
+       <string>Motion</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox_11" >
+         <property name="title" >
+          <string>Motion Estimation</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QCheckBox" name="meCheckBox" >
+              <property name="text" >
+               <string>Motion Estimation:</string>
+              </property>
+              <property name="checked" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="motionPrecisionComboBox" >
+                <property name="currentIndex" >
+                 <number>0</number>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>Low</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Medium</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>High</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QCheckBox" name="rdoCheckBox" >
+              <property name="text" >
+               <string>Rate Distortion Optimisation:</string>
+              </property>
+              <property name="checked" >
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="rdoComboBox" >
+                <property name="currentIndex" >
+                 <number>0</number>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>No Search / DCT</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Limited Search</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Medium Search</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Wide Search</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="rdoBframeCheckBox" >
+            <property name="text" >
+             <string>Rate Distortion Optimisation for B-frames</string>
+            </property>
+            <property name="checked" >
+             <bool>false</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="chromaMeCheckBox" >
+            <property name="text" >
+             <string>Chroma Motion Estimation</string>
+            </property>
+            <property name="checked" >
+             <bool>false</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="checkBox_2" >
+            <property name="text" >
+             <string>Quarter Pixel Motion Estimation</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="gmcCheckBox" >
+            <property name="text" >
+             <string>Global Motion Compensation</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="turboCheckBox" >
+            <property name="text" >
+             <string>Turbo Mode</string>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>436</width>
+           <height>2</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_4" >
+      <attribute name="title" >
+       <string>Frame</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox_6" >
+         <property name="title" >
+          <string>Frame Encoding</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <widget class="QCheckBox" name="greyscaleCheckBox" >
+            <property name="text" >
+             <string>Greyscale</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QCheckBox" name="interlacedCheckBox" >
+              <property name="text" >
+               <string>Interlaced:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="interlacedComboBox" >
+                <property name="enabled" >
+                 <bool>false</bool>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>Bottom Field First</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>Top Field First</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeType" >
+                 <enum>QSizePolicy::MinimumExpanding</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>10</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <layout class="QGridLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item row="1" column="0" >
+             <widget class="QLabel" name="label_8" >
+              <property name="text" >
+               <string>Maximum I-frame Interval:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="maxIframeIntervalSpinBox" />
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="0" column="0" >
+             <widget class="QLabel" name="label_4" >
+              <property name="text" >
+               <string>Frame Drop Ratio:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="0" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="frameDropSpinBox" />
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_9" >
+         <property name="title" >
+          <string>B-frames</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QLabel" name="label_31" >
+              <property name="text" >
+               <string>Maximum Consecutive B-frames:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="maxBFramesSpinBox" >
+                <property name="maximum" >
+                 <number>16</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeType" >
+                 <enum>QSizePolicy::MinimumExpanding</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>10</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="packedCheckBox" >
+            <property name="text" >
+             <string>Packed Bitstream</string>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>20</width>
+           <height>40</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_6" >
+      <attribute name="title" >
+       <string>Quantiser</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox_4" >
+         <property name="title" >
+          <string>Quantiser Control</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="7" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QDoubleSpinBox" name="quantBoffsetSpinBox" >
+              <property name="decimals" >
+               <number>2</number>
+              </property>
+              <property name="maximum" >
+               <double>31.000000000000000</double>
+              </property>
+              <property name="value" >
+               <double>1.000000000000000</double>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="6" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QDoubleSpinBox" name="quantBratioSpinBox" >
+              <property name="decimals" >
+               <number>2</number>
+              </property>
+              <property name="maximum" >
+               <double>31.000000000000000</double>
+              </property>
+              <property name="value" >
+               <double>1.500000000000000</double>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="7" column="0" >
+           <widget class="QLabel" name="label_23" >
+            <property name="text" >
+             <string>B-frame Quantiser Offset:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="6" column="0" >
+           <widget class="QLabel" name="label_20" >
+            <property name="text" >
+             <string>B-frame Quantiser Ratio:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="4" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantBminSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>2</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantImaxSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>31</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_15" >
+            <property name="text" >
+             <string>Minimum I-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="3" column="0" >
+           <widget class="QLabel" name="label_5" >
+            <property name="text" >
+             <string>Maximum P-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="5" column="0" >
+           <widget class="QLabel" name="label_7" >
+            <property name="text" >
+             <string>Maximum B-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="0" >
+           <widget class="QLabel" name="label_17" >
+            <property name="text" >
+             <string>Minimum P-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="4" column="0" >
+           <widget class="QLabel" name="label_6" >
+            <property name="text" >
+             <string>Minimum B-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_16" >
+            <property name="text" >
+             <string>Maximum I-frame Quantiser:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="3" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantPmaxSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>31</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="5" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantBmaxSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>31</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantIminSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>2</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>47</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="2" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="quantPminSpinBox" >
+              <property name="maximum" >
+               <number>31</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>2</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_3" >
+         <property name="title" >
+          <string>Quantiser Options</string>
+         </property>
+         <layout class="QVBoxLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QLabel" name="label_2" >
+              <property name="text" >
+               <string>Quantisation Type:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QComboBox" name="comboBox" >
+                <item>
+                 <property name="text" >
+                  <string>H.263</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text" >
+                  <string>MPEG</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="trellisCheckBox" >
+            <property name="text" >
+             <string>Trellis Quantisation</string>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>20</width>
+           <height>40</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_3" >
+      <attribute name="title" >
+       <string>Single Pass</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox" >
+         <property name="title" >
+          <string>Single Pass</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="2" column="0" >
+           <widget class="QLabel" name="label_11" >
+            <property name="text" >
+             <string>Smoother:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_10" >
+            <property name="text" >
+             <string>Averaging Quantiser Period:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_9" >
+            <property name="text" >
+             <string>Reaction Delay Factor:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_3" >
+              <property name="maximum" >
+               <number>2147483647</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_2" >
+              <property name="maximum" >
+               <number>2147483647</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox" >
+              <property name="maximum" >
+               <number>100</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>20</width>
+           <height>40</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab" >
+      <attribute name="title" >
+       <string>Two Pass</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <widget class="QGroupBox" name="groupBox_7" >
+         <property name="title" >
+          <string>I-frames</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_12" >
+            <property name="text" >
+             <string>I-frame Boost:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_5" >
+              <property name="maximum" >
+               <number>100</number>
+              </property>
+              <property name="value" >
+               <number>20</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_27" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_4" >
+              <property name="maximum" >
+               <number>1000</number>
+              </property>
+              <property name="value" >
+               <number>10</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_26" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="2" column="0" >
+           <widget class="QLabel" name="label_14" >
+            <property name="text" >
+             <string>I-frame Bitrate Reduction Threshold:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_13" >
+            <property name="text" >
+             <string>Maximum I-frame Bitrate Reduction:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_6" >
+              <property name="maximum" >
+               <number>2147483647</number>
+              </property>
+              <property name="value" >
+               <number>1</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_28" >
+              <property name="text" >
+               <string>frame(s)</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_5" >
+         <property name="title" >
+          <string>Overflow Control</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_7" >
+              <property name="maximum" >
+               <number>100</number>
+              </property>
+              <property name="value" >
+               <number>5</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_29" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="2" column="0" >
+           <widget class="QLabel" name="label_21" >
+            <property name="text" >
+             <string>Maximum Overflow Degradation:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_9" >
+              <property name="maximum" >
+               <number>80</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>5</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_32" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_8" >
+              <property name="maximum" >
+               <number>80</number>
+              </property>
+              <property name="minimum" >
+               <number>1</number>
+              </property>
+              <property name="value" >
+               <number>5</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_30" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_19" >
+            <property name="text" >
+             <string>Maximum Overflow Improvement:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_18" >
+            <property name="text" >
+             <string>Overflow Control Strength:</string>
+            </property>
+           </widget>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_8" >
+         <property name="title" >
+          <string>Curve Compression</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_22" >
+            <property name="text" >
+             <string>Above Average Curve Compression:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_10" >
+              <property name="maximum" >
+               <number>100</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_25" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_24" >
+            <property name="text" >
+             <string>Below Average Curve Compression:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_11" >
+              <property name="maximum" >
+               <number>100</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_33" >
+              <property name="text" >
+               <string>%</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox_10" >
+         <property name="title" >
+          <string>Video Buffer Verifier</string>
+         </property>
+         <layout class="QGridLayout" >
+          <property name="margin" >
+           <number>9</number>
+          </property>
+          <property name="spacing" >
+           <number>6</number>
+          </property>
+          <item row="1" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_13" >
+              <property name="maximum" >
+               <number>9708400</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_38" >
+              <property name="text" >
+               <string>bit/s</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_12" >
+              <property name="maximum" >
+               <number>6291456</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_37" >
+              <property name="text" >
+               <string>bit(s)</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+          <item row="0" column="0" >
+           <widget class="QLabel" name="label_34" >
+            <property name="text" >
+             <string>VBV Buffer Size:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="0" >
+           <widget class="QLabel" name="label_35" >
+            <property name="text" >
+             <string>Maximum VBV Bitrate:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="0" >
+           <widget class="QLabel" name="label_36" >
+            <property name="text" >
+             <string>Peak Bitrate Over 1 Second:</string>
+            </property>
+           </widget>
+          </item>
+          <item row="2" column="1" >
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>6</number>
+            </property>
+            <item>
+             <widget class="QSpinBox" name="spinBox_14" >
+              <property name="maximum" >
+               <number>16000000</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_39" >
+              <property name="text" >
+               <string>bit/s</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation" >
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" >
+          <size>
+           <width>20</width>
+           <height>31</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+      </layout>
+     </widget>
+    </widget>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>131</width>
+         <height>31</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QPushButton" name="okButton" >
+       <property name="text" >
+        <string>OK</string>
+       </property>
+       <property name="default" >
+        <bool>true</bool>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="cancelButton" >
+       <property name="text" >
+        <string>Cancel</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>tabWidget</tabstop>
+  <tabstop>encodingModeComboBox</tabstop>
+  <tabstop>targetRateControlSpinBox</tabstop>
+  <tabstop>quantiserSlider</tabstop>
+  <tabstop>quantiserSpinBox</tabstop>
+  <tabstop>sarCustomRadioButton</tabstop>
+  <tabstop>sarCustomSpinBox1</tabstop>
+  <tabstop>sarCustomSpinBox2</tabstop>
+  <tabstop>sarPredefinedRadioButton</tabstop>
+  <tabstop>sarPredefinedComboBox</tabstop>
+  <tabstop>sarAsInputRadioButton</tabstop>
+  <tabstop>threadDisableRadioButton</tabstop>
+  <tabstop>threadAutoDetectRadioButton</tabstop>
+  <tabstop>threadCustomRadioButton</tabstop>
+  <tabstop>threadCustomSpinBox</tabstop>
+  <tabstop>meCheckBox</tabstop>
+  <tabstop>motionPrecisionComboBox</tabstop>
+  <tabstop>rdoCheckBox</tabstop>
+  <tabstop>rdoComboBox</tabstop>
+  <tabstop>rdoBframeCheckBox</tabstop>
+  <tabstop>chromaMeCheckBox</tabstop>
+  <tabstop>checkBox_2</tabstop>
+  <tabstop>gmcCheckBox</tabstop>
+  <tabstop>turboCheckBox</tabstop>
+  <tabstop>greyscaleCheckBox</tabstop>
+  <tabstop>interlacedCheckBox</tabstop>
+  <tabstop>interlacedComboBox</tabstop>
+  <tabstop>frameDropSpinBox</tabstop>
+  <tabstop>maxIframeIntervalSpinBox</tabstop>
+  <tabstop>maxBFramesSpinBox</tabstop>
+  <tabstop>packedCheckBox</tabstop>
+  <tabstop>quantIminSpinBox</tabstop>
+  <tabstop>quantImaxSpinBox</tabstop>
+  <tabstop>quantPminSpinBox</tabstop>
+  <tabstop>quantPmaxSpinBox</tabstop>
+  <tabstop>quantBminSpinBox</tabstop>
+  <tabstop>quantBmaxSpinBox</tabstop>
+  <tabstop>quantBratioSpinBox</tabstop>
+  <tabstop>quantBoffsetSpinBox</tabstop>
+  <tabstop>comboBox</tabstop>
+  <tabstop>trellisCheckBox</tabstop>
+  <tabstop>spinBox</tabstop>
+  <tabstop>spinBox_2</tabstop>
+  <tabstop>spinBox_3</tabstop>
+  <tabstop>spinBox_4</tabstop>
+  <tabstop>spinBox_5</tabstop>
+  <tabstop>spinBox_6</tabstop>
+  <tabstop>spinBox_7</tabstop>
+  <tabstop>spinBox_8</tabstop>
+  <tabstop>spinBox_9</tabstop>
+  <tabstop>spinBox_10</tabstop>
+  <tabstop>spinBox_11</tabstop>
+  <tabstop>spinBox_12</tabstop>
+  <tabstop>spinBox_13</tabstop>
+  <tabstop>spinBox_14</tabstop>
+  <tabstop>okButton</tabstop>
+  <tabstop>cancelButton</tabstop>
+  <tabstop>configurationComboBox</tabstop>
+  <tabstop>saveAsButton</tabstop>
+  <tabstop>deleteButton</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>okButton</sender>
+   <signal>clicked()</signal>
+   <receiver>XvidConfigDialog</receiver>
+   <slot>accept()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>354</x>
+     <y>635</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>246</x>
+     <y>344</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>cancelButton</sender>
+   <signal>clicked()</signal>
+   <receiver>XvidConfigDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>437</x>
+     <y>635</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>246</x>
+     <y>344</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>sarPredefinedRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>sarPredefinedComboBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>108</x>
+     <y>290</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>243</x>
+     <y>290</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>sarCustomRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>sarCustomSpinBox1</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>108</x>
+     <y>262</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>209</x>
+     <y>262</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>sarCustomRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>sarCustomSpinBox2</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>108</x>
+     <y>262</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>272</x>
+     <y>262</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>sarCustomRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>sarCustomLabel</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>108</x>
+     <y>262</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>240</x>
+     <y>262</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>sarAsInputRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>sarAsInputLabel</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>108</x>
+     <y>318</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>184</x>
+     <y>317</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>threadCustomRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>threadCustomSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>71</x>
+     <y>479</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>131</x>
+     <y>479</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>meCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>motionPrecisionComboBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>94</x>
+     <y>159</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>246</x>
+     <y>159</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>rdoCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>rdoComboBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>119</x>
+     <y>189</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>241</x>
+     <y>189</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>interlacedCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>interlacedComboBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>77</x>
+     <y>183</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>156</x>
+     <y>183</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From gruntster at mail.berlios.de  Sat Jan  3 21:57:45 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 21:57:45 +0100
Subject: [Avidemux-svn-commit] r4516 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901032057.n03KvjRJ028533@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 21:57:37 +0100 (Sat, 03 Jan 2009)
New Revision: 4516

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] beginnings of xml settings and hooking up Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-01-03 20:57:37 UTC (rev 4516)
@@ -4,20 +4,26 @@
 checkXvid()
 
 IF (XVID_FOUND)
-	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${XVID_INCLUDE_DIR})
+	checkLibxml2()
 
-	SET(QT_PLUGIN_NAME "ADM_vidEnc_Xvid_Qt")
-	SET(GTK_PLUGIN_NAME "ADM_vidEnc_Xvid_Gtk")
-	SET(PLUGIN_SUBDIR "xvid")
-	SET(ADM_vidEnc_xvid_SRCS interface.c  encoder.cpp  options.cpp  configGuiLoader.cpp)
+	IF (LIBXML2_FOUND)
+		INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${XVID_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR})
+		ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})
 
-	CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake" "${CMAKE_CURRENT_BINARY_DIR}/config.h")
+		SET(QT_PLUGIN_NAME "ADM_vidEnc_Xvid_Qt")
+		SET(GTK_PLUGIN_NAME "ADM_vidEnc_Xvid_Gtk")
+		SET(PLUGIN_SUBDIR "xvid")
+		SET(ADM_vidEnc_xvid_SRCS interface.c  encoder.cpp  options.cpp  configGuiLoader.cpp  presetOptions.cpp)
 
-	ADD_SUBDIRECTORY(gtk)
-	ADD_SUBDIRECTORY(qt4)
-	ADD_LIBRARY(ADM_vidEnc_xvid SHARED ${ADM_vidEnc_xvid_SRCS})
-	TARGET_LINK_LIBRARIES(ADM_vidEnc_xvid ADM_core ${XVID_LIBRARY_DIR})
+		CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake" "${CMAKE_CURRENT_BINARY_DIR}/config.h")
 
-	INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_xvid)
-	INSTALL_VIDEO_ENCODER(ADM_vidEnc_xvid)
+		ADD_SUBDIRECTORY(gtk)
+		ADD_SUBDIRECTORY(qt4)
+		ADD_LIBRARY(ADM_vidEnc_xvid SHARED ${ADM_vidEnc_xvid_SRCS})
+		TARGET_LINK_LIBRARIES(ADM_vidEnc_xvid ADM_core ${XVID_LIBRARY_DIR} ${LIBXML2_LIBRARIES})
+
+		INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_xvid)
+		INSTALL_VIDEO_ENCODER(ADM_vidEnc_xvid)
+		INSTALL(FILES XvidParam.xsd DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoEncoder/${PLUGIN_SUBDIR}")
+	ENDIF (LIBXML2_FOUND)
 ENDIF (XVID_FOUND)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-03 20:57:37 UTC (rev 4516)
@@ -0,0 +1,77 @@
+<?xml version="1.0" encoding="utf-8"?>
+<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified">
+  <xs:element name="XvidConfig">
+    <xs:complexType>
+      <xs:sequence>
+        <xs:element name="presetConfiguration" minOccurs="0">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="name" type="xs:string"/>
+              <xs:element name="type">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="default"/>
+                    <xs:enumeration value="user"/>
+                    <xs:enumeration value="system"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+        <xs:element name="encodeOptions" minOccurs="0">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="mode">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="CBR"/>
+                    <xs:enumeration value="CQP"/>
+                    <xs:enumeration value="AQP"/>
+                    <xs:enumeration value="2PASS SIZE"/>
+                    <xs:enumeration value="2PASS ABR"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="parameter" type="uint"/>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+        <xs:element name="XvidOptions">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="threads" type="uint"/>
+              <xs:element name="vui">
+                <xs:complexType>
+                  <xs:sequence>
+                    <xs:element name="sarAsInput" type="xs:boolean"/>
+                    <xs:element name="sarHeight" type="uint"/>
+                    <xs:element name="sarWidth" type="uint"/>
+                  </xs:sequence>
+                </xs:complexType>
+              </xs:element>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+      </xs:sequence>
+    </xs:complexType>
+  </xs:element>
+
+  <xs:simpleType name="uint">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="0"/>
+    </xs:restriction>
+  </xs:simpleType>
+  <xs:simpleType name="uint8">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="0"/>
+      <xs:maxInclusive value="255"/>
+    </xs:restriction>
+  </xs:simpleType>
+  <xs:simpleType name="quantiser">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="1"/>
+      <xs:maxInclusive value="31"/>
+    </xs:restriction>
+  </xs:simpleType>
+</xs:schema>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-03 20:57:37 UTC (rev 4516)
@@ -42,7 +42,15 @@
 
 xvidEncoder::xvidEncoder(void)
 {
+	_loader = NULL;
+	_opened = false;
 
+	_passCount = 1;
+	_currentPass = 0;
+
+	_encodeOptions.structSize = sizeof(vidEncOptions);
+	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
+	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
 }
 
 xvidEncoder::~xvidEncoder(void)
@@ -95,12 +103,39 @@
 
 int xvidEncoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
+	char* xml = _options.toXml();
+	int xmlLength = strlen(xml);
 
+	if (bufferSize >= xmlLength)
+	{
+		memcpy(pluginOptions, xml, xmlLength);
+		memcpy(encodeOptions, &_encodeOptions, sizeof(vidEncOptions));
+	}
+	else if (bufferSize != 0)
+		xmlLength = 0;
+
+	delete [] xml;
+
+	return xmlLength;
 }
 
 int xvidEncoder::setOptions(vidEncOptions *encodeOptions, char *pluginOptions)
 {
+	if (_opened)
+		return ADM_VIDENC_ERR_ALREADY_OPEN;
 
+	bool success = true;
+
+	if (pluginOptions)
+		success = _options.fromXml(pluginOptions);
+
+	if (encodeOptions && success)
+		memcpy(&_encodeOptions, encodeOptions, sizeof(vidEncOptions));
+
+	if (success)
+		return ADM_VIDENC_ERR_SUCCESS;
+	else
+		return ADM_VIDENC_ERR_FAILED;
 }
 
 int xvidEncoder::getCurrentPass(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-03 20:57:37 UTC (rev 4516)
@@ -35,6 +35,7 @@
 		vidEncOptions _encodeOptions;
 
 		int _currentPass, _passCount;
+		bool _opened;
 
 	public:
 		xvidEncoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-03 20:57:37 UTC (rev 4516)
@@ -21,11 +21,41 @@
  *                                                                         *
  ***************************************************************************/
 
+#include <stdlib.h>
 #include <string.h>
+#include <libxml/parser.h>
+#include <libxml/xmlschemas.h>
+
+#include "config.h"
+#include "ADM_inttype.h"
+#include "ADM_files.h"
 #include "options.h"
 
 XvidOptions::XvidOptions(void)
 {
+	_configurationName = NULL;
+
+	reset();
+}
+
+XvidOptions::~XvidOptions(void)
+{
+	cleanUp();
+}
+
+void XvidOptions::cleanUp(void)
+{
+	if (_configurationName)
+	{
+		free(_configurationName);
+		_configurationName = NULL;
+	}
+}
+
+void XvidOptions::reset(void)
+{
+	cleanUp();
+
 	memset(&xvid_enc_create, 0, sizeof(xvid_enc_create_t));
 	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
 
@@ -35,13 +65,79 @@
 	setMinQuantiser(2, 2, 2);
 	setMaxQuantiser(31, 31, 31);
 	setPar(1, 1);
+
+	_parAsInput = false;
+
+	setPresetConfiguration("<default>", CONFIG_DEFAULT);
 }
 
-XvidOptions::~XvidOptions(void)
+void XvidOptions::getPresetConfiguration(char** configurationName, ConfigType *configurationType)
 {
+	if (_configurationName)
+		*configurationName = strdup(_configurationName);
+	else
+		*configurationName = NULL;
 
+	*configurationType = _configurationType;
 }
 
+void XvidOptions::setPresetConfiguration(const char* configurationName, ConfigType configurationType)
+{
+	clearPresetConfiguration();
+
+	_configurationName = strdup(configurationName);
+	_configurationType = configurationType;
+}
+
+void XvidOptions::clearPresetConfiguration(void)
+{
+	if (_configurationName)
+		free(_configurationName);
+
+	_configurationName = strdup("<custom>");
+	_configurationType = CONFIG_CUSTOM;
+}
+
+unsigned int XvidOptions::getThreads(void)
+{
+	return xvid_enc_create.num_threads;
+}
+
+void XvidOptions::setThreads(unsigned int threads)
+{
+	xvid_enc_create.num_threads = threads;
+}
+
+bool XvidOptions::getParAsInput(void)
+{
+	return _parAsInput;
+}
+
+void XvidOptions::setParAsInput(bool parAsInput)
+{
+	_parAsInput = parAsInput;
+}
+
+void XvidOptions::getPar(unsigned int *width, unsigned int *height)
+{
+	*width = xvid_enc_frame.par_width;
+	*height = xvid_enc_frame.par_height;
+}
+
+void XvidOptions::setPar(unsigned int width, unsigned int height)
+{
+	if (width > 0)
+		xvid_enc_frame.par_width = width;
+
+	if (height > 0)
+		xvid_enc_frame.par_height = height;
+
+	  if (xvid_enc_frame.par_width == xvid_enc_frame.par_height)
+		  xvid_enc_frame.par = XVID_PAR_11_VGA;
+	  else
+		  xvid_enc_frame.par = XVID_PAR_EXT;
+}
+
 MotionEstimationMode XvidOptions::getMotionEstimation(void)
 {
 	if (xvid_enc_frame.motion & ME_HIGH == ME_HIGH)
@@ -63,6 +159,11 @@
 		xvid_enc_frame.motion &= ~ME_MEDIUM;
 		xvid_enc_frame.motion &= ~ME_HIGH;
 		xvid_enc_frame.motion |= motionEstimation;
+
+		if (motionEstimation == ME_NONE)
+			xvid_enc_frame.type = XVID_TYPE_IVOP;
+		else
+			xvid_enc_frame.type = XVID_TYPE_AUTO;
 	}
 }
 
@@ -290,26 +391,6 @@
 		xvid_enc_create.max_quant[2] = b;
 }
 
-void XvidOptions::getPar(unsigned int *width, unsigned int *height)
-{
-	*width = xvid_enc_frame.par_width;
-	*height = xvid_enc_frame.par_height;
-}
-
-void XvidOptions::setPar(unsigned int width, unsigned int height)
-{
-	if (width > 0)
-		xvid_enc_frame.par_width = width;
-
-	if (height > 0)
-		xvid_enc_frame.par_height = height;
-
-	  if (xvid_enc_frame.par_width != xvid_enc_frame.par_height)
-		  xvid_enc_frame.par = XVID_PAR_EXT;
-	  else
-		  xvid_enc_frame.par = XVID_PAR_11_VGA;
-}
-
 RateDistortionMode XvidOptions::getRateDistortion(RateDistortionMode rateDistortion)
 {
 	if (xvid_enc_frame.motion & RD_SQUARE == RD_SQUARE)
@@ -364,3 +445,273 @@
 		xvid_enc_create.global &= ~XVID_GLOBAL_CLOSED_GOP;
 }
 
+char* XvidOptions::toXml(void)
+{
+	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)"1.0");
+	xmlNodePtr xmlNodeRoot, xmlNodeChild;
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	char *xml = NULL;
+
+	while (true)
+	{
+		if (!xmlDoc)
+			break;
+
+		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)"XvidConfig", NULL)))
+			break;
+
+		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
+
+		if (_configurationType != CONFIG_CUSTOM)
+		{
+			xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"presetConfiguration", NULL);
+
+			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"name", (xmlChar*)_configurationName);
+
+			if (_configurationType == CONFIG_USER)
+				strcpy((char*)xmlBuffer, "user");
+			else if (_configurationType == CONFIG_SYSTEM)
+				strcpy((char*)xmlBuffer, "system");
+			else
+				strcpy((char*)xmlBuffer, "default");
+
+			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"type", xmlBuffer);
+		}
+
+		addXvidOptionsToXml(xmlNodeRoot);
+		xml = dumpXmlDocToMemory(xmlDoc);
+		xmlFreeDoc(xmlDoc);
+
+		break;
+	}
+
+	return xml;
+}
+
+char* XvidOptions::dumpXmlDocToMemory(xmlDocPtr xmlDoc)
+{
+	xmlChar *tempBuffer;
+	int tempBufferSize;
+	char *xml = NULL;
+
+	xmlDocDumpMemory(xmlDoc, &tempBuffer, &tempBufferSize);
+
+	// remove carriage returns (even though libxml was instructed not to format the XML)
+	xmlChar* bufferChar = tempBuffer;
+	int bufferCharIndex = 0;
+
+	while (*bufferChar != '\0')
+	{
+		if (*bufferChar == '\n')
+		{
+			memmove(bufferChar, bufferChar + 1, tempBufferSize - bufferCharIndex);
+			tempBufferSize--;
+		}
+		else if (*bufferChar == '\"')
+			*bufferChar = '\'';
+
+		bufferChar++;
+		bufferCharIndex++;
+	}
+
+	xml = new char[tempBufferSize + 1];
+	memcpy(xml, tempBuffer, tempBufferSize);
+	xml[tempBufferSize] = 0;
+
+	return xml;
+}
+
+void XvidOptions::addXvidOptionsToXml(xmlNodePtr xmlNodeRoot)
+{
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	xmlNodePtr xmlNodeChild, xmlNodeChild2;
+
+	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"XvidOptions", NULL);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"threads", number2String(xmlBuffer, bufferSize, getThreads()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"vui", NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"sarAsInput", boolean2String(xmlBuffer, bufferSize, getParAsInput()));
+
+	unsigned int width, height;
+
+	getPar(&width, &height);
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"sarHeight", number2String(xmlBuffer, bufferSize, height));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"sarWidth", number2String(xmlBuffer, bufferSize, width));
+}
+
+bool XvidOptions::validateXml(xmlDocPtr doc)
+{
+	const char *schemaFile = "XvidParam.xsd";
+	char *pluginDir = ADM_getPluginPath();
+	char schemaPath[strlen(pluginDir) + strlen(PLUGIN_SUBDIR) + 1 + strlen(schemaFile) + 1];
+	bool success = false;
+
+	strcpy(schemaPath, pluginDir);
+	strcat(schemaPath, PLUGIN_SUBDIR);
+	strcat(schemaPath, "/");
+	strcat(schemaPath, schemaFile);
+	delete [] pluginDir;
+
+	xmlSchemaParserCtxtPtr xmlSchemaParserCtxt = xmlSchemaNewParserCtxt(schemaPath);
+	xmlSchemaPtr xmlSchema = xmlSchemaParse(xmlSchemaParserCtxt);
+
+ 	xmlSchemaFreeParserCtxt(xmlSchemaParserCtxt);
+
+ 	xmlSchemaValidCtxtPtr xmlSchemaValidCtxt = xmlSchemaNewValidCtxt(xmlSchema);
+
+ 	if (xmlSchemaValidCtxt)
+	{
+ 		success = !xmlSchemaValidateDoc(xmlSchemaValidCtxt, doc);
+	 	xmlSchemaFree(xmlSchema);
+		xmlSchemaFreeValidCtxt(xmlSchemaValidCtxt);
+ 	}
+	else
+ 		xmlSchemaFree(xmlSchema);
+
+	return success;
+}
+
+int XvidOptions::fromXml(const char *xml)
+{
+	bool success = false;
+
+	clearPresetConfiguration();
+
+	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), "Xvid.xml", NULL, 0);
+
+	if (success = validateXml(doc))
+	{
+		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
+
+		for (xmlNode *xmlChild = xmlNodeRoot->children; xmlChild; xmlChild = xmlChild->next)
+		{
+			if (xmlChild->type == XML_ELEMENT_NODE)
+			{
+				char *content = (char*)xmlNodeGetContent(xmlChild);
+
+				if (strcmp((char*)xmlChild->name, "presetConfiguration") == 0)
+					parsePresetConfiguration(xmlChild);
+				else if (strcmp((char*)xmlChild->name, "XvidOptions") == 0)
+					parseXvidOptions(xmlChild);
+
+				xmlFree(content);
+			}
+		}
+	}
+
+	xmlFreeDoc(doc);
+
+	return success;
+}
+
+void XvidOptions::parsePresetConfiguration(xmlNode *node)
+{
+	char* name = NULL;
+	ConfigType type = CONFIG_CUSTOM;
+
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "name") == 0)
+				name = strdup((char*)content);
+			else if (strcmp((char*)xmlChild->name, "type") == 0)
+			{
+				if (strcmp(content, "user") == 0)
+					type = CONFIG_USER;
+				else if (strcmp(content, "system") == 0)
+					type = CONFIG_SYSTEM;
+				else
+					type = CONFIG_DEFAULT;
+			}
+
+			xmlFree(content);
+		}
+	}
+
+	setPresetConfiguration(name, type);
+	free(name);
+}
+
+void XvidOptions::parseXvidOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "threads") == 0)
+				setThreads(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "vui") == 0)
+				parseVuiOptions(xmlChild);
+
+			xmlFree(content);
+		}
+	}
+}
+
+void XvidOptions::parseVuiOptions(xmlNode *node)
+{
+	unsigned int width = 0, height = 0;
+
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "sarAsInput") == 0)
+				setParAsInput(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "sarHeight") == 0)
+				height = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "sarWidth") == 0)
+				width = atoi(content);
+
+			xmlFree(content);
+		}
+	}
+
+	setPar(width, height);
+}
+
+xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, int number)
+{
+	snprintf((char*)buffer, size, "%d", number);
+
+	return buffer;
+}
+
+xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, unsigned int number)
+{
+	snprintf((char*)buffer, size, "%d", number);
+
+	return buffer;
+}
+
+xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, float number)
+{
+	snprintf((char*)buffer, size, "%f", number);
+
+	return buffer;
+}
+
+xmlChar* XvidOptions::boolean2String(xmlChar *buffer, size_t size, bool boolean)
+{
+	if (boolean)
+		strcpy((char*)buffer, "true");
+	else
+		strcpy((char*)buffer, "false");
+
+	return buffer;
+}
+
+bool XvidOptions::string2Boolean(char *buffer)
+{
+	return (strcmp(buffer, "true") == 0);
+}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-03 20:57:37 UTC (rev 4516)
@@ -17,24 +17,41 @@
 #ifndef options_h
 #define options_h
 
+#include <libxml/tree.h>
 #include "xvid.h"
 
-enum MotionEstimationMode
+extern "C"
 {
+#include "ADM_vidEnc_plugin.h"
+}
+
+#define DEFAULT_ENCODE_MODE ADM_VIDENC_MODE_CQP
+#define DEFAULT_ENCODE_MODE_PARAMETER 4
+
+typedef enum
+{
+	CONFIG_CUSTOM,
+	CONFIG_DEFAULT,
+	CONFIG_USER,
+	CONFIG_SYSTEM
+} ConfigType;
+
+typedef enum
+{
 	ME_NONE = 0,
 	ME_LOW = XVID_ME_HALFPELREFINE16,	
 	ME_MEDIUM = XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,	
 	ME_HIGH = XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 | XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
-};
+} MotionEstimationMode;
 
-enum RateDistortionMode
+typedef enum
 {
 	RD_NONE = 0,
 	RD_DCT_ME = XVID_VOP_MODEDECISION_RD,
 	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
 	RD_HPEL_QPEL_8 = RD_HPEL_QPEL_16 | XVID_ME_HALFPELREFINE8_RD | XVID_ME_QUARTERPELREFINE8_RD | XVID_ME_CHECKPREDICTION_RD,
 	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
-};
+} RateDistortionMode;
 
 class XvidOptions
 {
@@ -42,10 +59,44 @@
 	xvid_enc_create_t xvid_enc_create;
 	xvid_enc_frame_t xvid_enc_frame;
 
+	char* _configurationName;
+	ConfigType _configurationType;
+
+	bool _parAsInput;
+
+	void cleanUp(void);
+	xmlChar* number2String(xmlChar *buffer, size_t size, int number);
+	xmlChar* number2String(xmlChar *buffer, size_t size, unsigned int number);
+	xmlChar* number2String(xmlChar *buffer, size_t size, float number);
+	xmlChar* boolean2String(xmlChar *buffer, size_t size, bool boolean);
+	bool string2Boolean(char *buffer);
+
+	void addXvidOptionsToXml(xmlNodePtr xmlNodeRoot);
+	char* dumpXmlDocToMemory(xmlDocPtr xmlDoc);
+	bool validateXml(xmlDocPtr doc);
+	void parsePresetConfiguration(xmlNode *node);
+	void parseXvidOptions(xmlNode *node);
+	void parseVuiOptions(xmlNode *node);
+
 public:
 	XvidOptions(void);
 	~XvidOptions(void);
 
+	void reset(void);
+
+	void getPresetConfiguration(char** configurationName, ConfigType *configurationType);
+	void setPresetConfiguration(const char* configurationName, ConfigType configurationType);
+	void clearPresetConfiguration(void);
+
+	unsigned int getThreads(void);
+	void setThreads(unsigned int threads);
+
+	bool getParAsInput(void);
+	void setParAsInput(bool parAsInput);
+
+	void getPar(unsigned int *width, unsigned int *height);
+	void setPar(unsigned int width, unsigned int height);
+
 	MotionEstimationMode getMotionEstimation(void);
 	void setMotionEstimation(MotionEstimationMode motionEstimation);
 
@@ -94,9 +145,6 @@
 	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
-	void getPar(unsigned int *width, unsigned int *height);
-	void setPar(unsigned int width, unsigned int height);
-
 	RateDistortionMode getRateDistortion(RateDistortionMode rateDistortion);
 	void setRateDistortion(RateDistortionMode rateDistortion);
 
@@ -105,6 +153,9 @@
 
 	bool getClosedGop(void);
 	void setClosedGop(bool closedGop);
+
+	virtual char* toXml(void);
+	virtual int fromXml(const char *xml);
 };
 
 #endif	// options_h

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-01-03 20:57:37 UTC (rev 4516)
@@ -0,0 +1,157 @@
+ /***************************************************************************
+                             presetOptions.cpp
+
+	These settings are intended for external configuration files and don't
+	contain a Preset Configuration block but may contain an Encode Options
+	block.
+
+    begin                : Fri May 23 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include <libxml/parser.h>
+#include "ADM_default.h"
+#include "presetOptions.h"
+
+XvidPresetOptions::XvidPresetOptions(void) : XvidOptions()
+{
+	setEncodeOptionsToDefaults();
+}
+
+vidEncOptions* XvidPresetOptions::getEncodeOptions(void)
+{
+	vidEncOptions *encodeOptions = new vidEncOptions;
+
+	memcpy(encodeOptions, &_encodeOptions, sizeof(vidEncOptions));
+
+	return encodeOptions;
+}
+
+void XvidPresetOptions::setEncodeOptions(vidEncOptions* encodeOptions)
+{
+	memcpy(&_encodeOptions, encodeOptions, sizeof(vidEncOptions));
+}
+
+char* XvidPresetOptions::toXml(void)
+{
+	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)"1.0");
+	xmlNodePtr xmlNodeRoot, xmlNodeChild;
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	char *xml = NULL;
+
+	while (true)
+	{
+		if (!xmlDoc)
+			break;
+
+		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)"XvidConfig", NULL)))
+			break;
+
+		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
+
+		xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"encodeOptions", NULL);
+
+		switch (_encodeOptions.encodeMode)
+		{
+			case ADM_VIDENC_MODE_CBR:
+				strcpy((char*)xmlBuffer, "CBR");
+				break;
+			case ADM_VIDENC_MODE_CQP:
+				strcpy((char*)xmlBuffer, "CQP");
+				break;
+			case ADM_VIDENC_MODE_2PASS_SIZE:
+				strcpy((char*)xmlBuffer, "2PASS SIZE");
+				break;
+			case ADM_VIDENC_MODE_2PASS_ABR:
+				strcpy((char*)xmlBuffer, "2PASS ABR");
+				break;
+		}
+
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"mode", xmlBuffer);
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"parameter", number2String(xmlBuffer, bufferSize, _encodeOptions.encodeModeParameter));
+
+		addXvidOptionsToXml(xmlNodeRoot);
+		xml = dumpXmlDocToMemory(xmlDoc);
+		xmlFreeDoc(xmlDoc);
+
+		break;
+	}
+
+	return xml;
+}
+
+int XvidPresetOptions::fromXml(const char *xml)
+{
+	bool success = false;
+
+	clearPresetConfiguration();
+	setEncodeOptionsToDefaults();
+
+	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), "Xvid.xml", NULL, 0);
+
+	if (success = validateXml(doc))
+	{
+		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
+
+		for (xmlNode *xmlChild = xmlNodeRoot->children; xmlChild; xmlChild = xmlChild->next)
+		{
+			if (xmlChild->type == XML_ELEMENT_NODE)
+			{
+				char *content = (char*)xmlNodeGetContent(xmlChild);
+
+				if (strcmp((char*)xmlChild->name, "encodeOptions") == 0)
+					parseEncodeOptions(xmlChild, &_encodeOptions);
+				else if (strcmp((char*)xmlChild->name, "XvidOptions") == 0)
+					parseXvidOptions(xmlChild);
+
+				xmlFree(content);
+			}
+		}
+	}
+
+	xmlFreeDoc(doc);
+
+	return success;
+}
+
+void XvidPresetOptions::parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions)
+{
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "mode") == 0)
+			{
+				if (strcmp(content, "CBR") == 0)
+					encodeOptions->encodeMode = ADM_VIDENC_MODE_CBR;
+				else if (strcmp(content, "CQP") == 0)
+					encodeOptions->encodeMode = ADM_VIDENC_MODE_CQP;
+				else if (strcmp(content, "2PASS SIZE") == 0)
+					encodeOptions->encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+				else if (strcmp(content, "2PASS ABR") == 0)
+					encodeOptions->encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			}
+			else if (strcmp((char*)xmlChild->name, "parameter") == 0)
+				encodeOptions->encodeModeParameter = atoi(content);
+
+			xmlFree(content);
+		}
+	}
+}
+
+void XvidPresetOptions::setEncodeOptionsToDefaults(void)
+{
+	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
+	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
+}

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h	2009-01-03 20:57:37 UTC (rev 4516)
@@ -0,0 +1,39 @@
+/***************************************************************************
+                              presetOptions.h
+
+    begin                : Fri May 23 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef presetOptions_h
+#define presetOptions_h
+
+#include "options.h"
+
+class XvidPresetOptions : public XvidOptions
+{
+private:
+	vidEncOptions _encodeOptions;
+
+	void parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions);
+	void setEncodeOptionsToDefaults(void);
+
+public:
+	XvidPresetOptions(void);
+
+	vidEncOptions* getEncodeOptions(void);
+	void setEncodeOptions(vidEncOptions* encodeOptions);
+	char* toXml(void);
+	int fromXml(const char *xml);
+};
+
+#endif	// presetOptions_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-03 20:57:37 UTC (rev 4516)
@@ -16,21 +16,488 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
 ***************************************************************************/
+#include <QtGui/QFileDialog>
+
+#include "../config.h"
+#include "../presetOptions.h"
 #include "xvidConfigDialog.h"
 
+#include "ADM_files.h"
+#include "DIA_coreToolkit.h"
+
+// Stay away from ADM_assert.h since it hacks memory functions.
+// Duplicating ADM_mkdir declaration here instead.
+extern "C" {
+	extern uint8_t ADM_mkdir(const char *name);
+}
+
 XvidConfigDialog::XvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options) :
 	QDialog((QWidget*)configParameters->parent, Qt::Dialog)
 {
+	disableGenericSlots = false;
+	static const int _predefinedARs[aspectRatioCount][2] = {{16, 15}, {64, 45}, {8, 9}, {32, 27}};
+
+	memcpy(predefinedARs, _predefinedARs, sizeof(predefinedARs));
+
 	ui.setupUi(this);
+
+	connect(ui.configurationComboBox, SIGNAL(currentIndexChanged(int)), this, SLOT(configurationComboBox_currentIndexChanged(int)));
+	connect(ui.saveAsButton, SIGNAL(pressed()), this, SLOT(saveAsButton_pressed()));
+	connect(ui.deleteButton, SIGNAL(pressed()), this, SLOT(deleteButton_pressed()));
+
+	// General tab
+	lastBitrate = 1500;
+	lastVideoSize = 700;
+
+	connect(ui.encodingModeComboBox, SIGNAL(currentIndexChanged(int)), this, SLOT(encodingModeComboBox_currentIndexChanged(int)));
+	connect(ui.quantiserSlider, SIGNAL(valueChanged(int)), this, SLOT(quantiserSlider_valueChanged(int)));
+	connect(ui.quantiserSpinBox, SIGNAL(valueChanged(int)), this, SLOT(quantiserSpinBox_valueChanged(int)));
+	connect(ui.targetRateControlSpinBox, SIGNAL(valueChanged(int)), this, SLOT(targetRateControlSpinBox_valueChanged(int)));
+
+	ui.sarAsInputLabel->setText(QString("%1:%2").arg(properties->parWidth).arg(properties->parHeight));
+
+	QWidgetList widgetList = QApplication::allWidgets();
+
+	for (int widgetIndex = 0; widgetIndex < widgetList.size(); widgetIndex++)
+	{
+		QWidget *widget = widgetList.at(widgetIndex);
+
+		if (widget->parentWidget() != NULL && widget->parentWidget()->parentWidget() != NULL && 
+			widget->parentWidget()->parentWidget()->parentWidget() != NULL &&
+			widget->parentWidget()->parentWidget()->parentWidget()->parentWidget() == ui.tabWidget)
+		{
+			if (widget->inherits("QComboBox"))
+				connect(widget, SIGNAL(currentIndexChanged(int)), this, SLOT(generic_currentIndexChanged(int)));
+			else if (widget->inherits("QSpinBox"))
+				connect(widget, SIGNAL(valueChanged(int)), this, SLOT(generic_valueChanged(int)));
+			else if (widget->inherits("QAbstractButton"))
+				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
+			else if (widget->inherits("QLineEdit"))
+				connect(widget, SIGNAL(textEdited(QString)), this, SLOT(generic_textEdited(QString)));
+		}
+	}
+
+	fillConfigurationComboBox();
+
+	if (!loadPresetSettings(encodeOptions, options))
+		loadSettings(encodeOptions, options);
 }
 
+void XvidConfigDialog::fillConfigurationComboBox(void)
+{
+	bool origDisableGenericSlots = disableGenericSlots;
+	QMap<QString, int> configs;
+	QStringList filter("*.xml");
+	QStringList list = QDir(getUserConfigDirectory()).entryList(filter, QDir::Files | QDir::Readable);
+
+	disableGenericSlots = true;
+
+	for (int item = 0; item < list.size(); item++)
+		configs.insert(QFileInfo(list[item]).baseName(), CONFIG_USER);
+
+	list = QDir(getSystemConfigDirectory()).entryList(filter, QDir::Files | QDir::Readable);
+
+	for (int item = 0; item < list.size(); item++)
+		configs.insert(QFileInfo(list[item]).baseName(), CONFIG_SYSTEM);
+
+	ui.configurationComboBox->clear();
+	ui.configurationComboBox->addItem(QT_TR_NOOP("<default>"), CONFIG_DEFAULT);
+	ui.configurationComboBox->addItem(QT_TR_NOOP("<custom>"), CONFIG_CUSTOM);
+
+	QMap<QString, int>::const_iterator mapIterator = configs.constBegin();
+
+	while (mapIterator != configs.constEnd())
+	{
+		ui.configurationComboBox->addItem(mapIterator.key(), mapIterator.value());
+		mapIterator++;
+	}
+
+	disableGenericSlots = origDisableGenericSlots;
+}
+
+bool XvidConfigDialog::selectConfiguration(QString *selectFile, ConfigType configurationType)
+{
+	bool success = false;
+	bool origDisableGenericSlots = disableGenericSlots;
+
+	disableGenericSlots = true;
+
+	if (configurationType == CONFIG_DEFAULT)
+	{
+		ui.configurationComboBox->setCurrentIndex(0);
+		success = true;
+	}
+	else
+	{
+		for (int index = 0; index < ui.configurationComboBox->count(); index++)
+		{
+			if (ui.configurationComboBox->itemText(index) == selectFile && ui.configurationComboBox->itemData(index).toInt() == configurationType)
+			{
+				ui.configurationComboBox->setCurrentIndex(index);
+				success = true;
+				break;
+			}
+		}
+
+		if (!success)
+			ui.configurationComboBox->setCurrentIndex(1);
+	}
+
+	disableGenericSlots = origDisableGenericSlots;
+
+	return success;
+}
+
+void XvidConfigDialog::configurationComboBox_currentIndexChanged(int index)
+{
+	bool origDisableGenericSlots = disableGenericSlots;
+
+	disableGenericSlots = true;
+
+	if (index == 0)		// default
+	{
+		ui.deleteButton->setEnabled(false);
+
+		XvidPresetOptions defaultOptions;
+		vidEncOptions *defaultEncodeOptions = defaultOptions.getEncodeOptions();
+
+		loadSettings(defaultEncodeOptions, &defaultOptions);
+
+		delete defaultEncodeOptions;
+	}
+	else if (index == 1)	// custom
+		ui.deleteButton->setEnabled(false);
+	else
+	{
+		int configType = ui.configurationComboBox->itemData(index).toInt();
+		QString configFileName;
+
+		ui.deleteButton->setEnabled(configType == CONFIG_USER);
+
+		if (configType == CONFIG_SYSTEM)
+			configFileName = QFileInfo(getSystemConfigDirectory(), ui.configurationComboBox->itemText(index) + ".xml").filePath();
+		else	// CONFIG_USER
+			configFileName = QFileInfo(getUserConfigDirectory(), ui.configurationComboBox->itemText(index) + ".xml").filePath();
+
+		QFile configFile(configFileName);
+
+		if (configFile.exists())
+		{
+			configFile.open(QIODevice::ReadOnly | QIODevice::Text);
+
+			QByteArray fileContents = configFile.readAll();
+			XvidPresetOptions options;
+			vidEncOptions *encodeOptions;
+
+			configFile.close();
+			options.fromXml(fileContents.constData());
+			encodeOptions = options.getEncodeOptions();
+
+			loadSettings(encodeOptions, &options);
+
+			delete encodeOptions;
+		}
+		else
+			ui.configurationComboBox->setCurrentIndex(0);
+	}
+
+	disableGenericSlots = origDisableGenericSlots;
+}
+
+void XvidConfigDialog::saveAsButton_pressed(void)
+{
+	char *configDirectory = ADM_getHomeRelativePath("xvid");
+
+	ADM_mkdir(configDirectory);
+
+	QString configFileName = QFileDialog::getSaveFileName(this, QT_TR_NOOP("Save As"), configDirectory, QT_TR_NOOP("Xvid Configuration File (*.xml)"));
+
+	if (!configFileName.isNull())
+	{
+		QFile configFile(configFileName);
+		vidEncOptions encodeOptions;
+		XvidPresetOptions presetOptions;
+
+		configFile.open(QIODevice::WriteOnly | QIODevice::Truncate | QIODevice::Text);
+		saveSettings(&encodeOptions, &presetOptions);
+		presetOptions.setEncodeOptions(&encodeOptions);
+
+		char* xml = presetOptions.toXml();
+
+		configFile.write(xml, strlen(xml));
+		configFile.close();
+
+		delete [] xml;
+
+		fillConfigurationComboBox();
+		selectConfiguration(&QFileInfo(configFileName).baseName(), CONFIG_USER);
+	}
+
+	delete [] configDirectory;
+}
+
+void XvidConfigDialog::deleteButton_pressed(void)
+{
+	QString configFileName = QFileInfo(getUserConfigDirectory(), ui.configurationComboBox->currentText() + ".xml").filePath();
+	QFile configFile(configFileName);
+
+	if (GUI_Question(QT_TR_NOOP("Are you sure you wish to delete the selected configuration?")) && configFile.exists())
+	{
+		disableGenericSlots = true;
+		configFile.remove();
+		ui.configurationComboBox->removeItem(ui.configurationComboBox->currentIndex());
+		disableGenericSlots = false;
+		ui.configurationComboBox->setCurrentIndex(0);	// default
+	}
+}
+
+// General tab
+void XvidConfigDialog::encodingModeComboBox_currentIndexChanged(int index)
+{
+	bool enable = false;
+
+	switch (index)
+	{
+		case 0:
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Bitrate:"));
+			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
+			ui.targetRateControlSpinBox->setValue(lastBitrate);
+			break;
+		case 1: // Constant Quality - 1 pass
+			ui.quantiserLabel2->setText(QT_TR_NOOP("Quantiser:"));
+			enable = true;
+			break;
+		case 2: // Video Size - 2 pass
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Video Size:"));
+			ui.targetRateControlLabel2->setText(QT_TR_NOOP("MB"));
+			ui.targetRateControlSpinBox->setValue(lastVideoSize);
+			break;
+		case 3: // Average Bitrate - 2 pass
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Average Bitrate:"));
+			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
+			ui.targetRateControlSpinBox->setValue(lastBitrate);
+			break;
+	}
+
+	ui.quantiserLabel1->setEnabled(enable);
+	ui.quantiserLabel2->setEnabled(enable);
+	ui.quantiserLabel3->setEnabled(enable);
+	ui.quantiserSlider->setEnabled(enable);
+	ui.quantiserSpinBox->setEnabled(enable);
+
+	ui.targetRateControlLabel1->setEnabled(!enable);
+	ui.targetRateControlLabel2->setEnabled(!enable);
+	ui.targetRateControlSpinBox->setEnabled(!enable);
+}
+
+void XvidConfigDialog::quantiserSlider_valueChanged(int value)
+{
+	ui.quantiserSpinBox->setValue(value);
+}
+
+void XvidConfigDialog::quantiserSpinBox_valueChanged(int value)
+{
+	ui.quantiserSlider->setValue(value);
+}
+
+void XvidConfigDialog::targetRateControlSpinBox_valueChanged(int value)
+{
+	if (ui.encodingModeComboBox->currentIndex() == 2)	// Video Size - 2 pass
+		lastVideoSize = value;
+	else
+		lastBitrate = value;
+}
+
+void XvidConfigDialog::generic_currentIndexChanged(int index)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
+void XvidConfigDialog::generic_valueChanged(int value)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
+void XvidConfigDialog::generic_pressed(void)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
+void XvidConfigDialog::generic_textEdited(QString text)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
+bool XvidConfigDialog::loadPresetSettings(vidEncOptions *encodeOptions, XvidOptions *options)
+{
+	bool origDisableGenericSlots = disableGenericSlots;
+	char *configurationName;
+	ConfigType configurationType;
+
+	disableGenericSlots = true;
+	options->getPresetConfiguration(&configurationName, &configurationType);		
+
+	bool foundConfig = selectConfiguration(&QString(configurationName), configurationType);
+
+	if (!foundConfig)
+		printf("Configuration %s (type %d) could not be found.  Using snapshot.\n", configurationName, configurationType);
+
+	if (configurationName)
+		free(configurationName);
+
+	disableGenericSlots = origDisableGenericSlots;
+
+	return (foundConfig && configurationType != CONFIG_CUSTOM);
+}
+
+void XvidConfigDialog::loadSettings(vidEncOptions *encodeOptions, XvidOptions *options)
+{
+	bool origDisableGenericSlots = disableGenericSlots;
+
+	disableGenericSlots = true;
+
+	// General tab
+	switch (encodeOptions->encodeMode)
+	{
+		case ADM_VIDENC_MODE_CBR:	// Constant Bitrate (Single Pass)
+			ui.encodingModeComboBox->setCurrentIndex(0);
+			ui.targetRateControlSpinBox->setValue(encodeOptions->encodeModeParameter);
+			break;
+		case ADM_VIDENC_MODE_CQP:	// Constant Quality (Single Pass)
+			ui.encodingModeComboBox->setCurrentIndex(1);
+			ui.quantiserSpinBox->setValue(encodeOptions->encodeModeParameter);
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:	// Video Size (Two Pass)
+			ui.encodingModeComboBox->setCurrentIndex(2);
+			ui.targetRateControlSpinBox->setValue(encodeOptions->encodeModeParameter);
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:	// Average Bitrate (Two Pass)
+			ui.encodingModeComboBox->setCurrentIndex(3);
+			ui.targetRateControlSpinBox->setValue(encodeOptions->encodeModeParameter);
+			break;
+	}
+
+	if (options->getParAsInput())
+		ui.sarAsInputRadioButton->setChecked(true);
+	else
+	{
+		bool predefined = false;
+		unsigned int width, height;
+
+		options->getPar(&width, &height);
+
+		for (int ratioIndex = 0; ratioIndex < aspectRatioCount; ratioIndex++)
+		{
+			if (width == predefinedARs[ratioIndex][0] && height == predefinedARs[ratioIndex][1])
+			{
+				ui.sarPredefinedRadioButton->setChecked(true);
+				ui.sarPredefinedComboBox->setCurrentIndex(ratioIndex);
+				predefined = true;
+				break;
+			}
+		}
+
+		if (!predefined)
+		{
+			ui.sarCustomRadioButton->setChecked(true);
+			ui.sarCustomSpinBox1->setValue(width);
+			ui.sarCustomSpinBox2->setValue(height);
+		}
+	}
+
+	switch (options->getThreads())
+	{
+		case 0:
+			ui.threadAutoDetectRadioButton->setChecked(true);
+			break;
+		case 1:
+			ui.threadDisableRadioButton->setChecked(true);
+			break;
+		default:
+			ui.threadCustomRadioButton->setChecked(true);
+			ui.threadCustomSpinBox->setValue(options->getThreads());
+	}
+
+	disableGenericSlots = origDisableGenericSlots;
+}
+
+void XvidConfigDialog::saveSettings(vidEncOptions *encodeOptions, XvidOptions *options)
+{
+	encodeOptions->structSize = sizeof(vidEncOptions);
+
+	// General tab
+	switch (ui.encodingModeComboBox->currentIndex())
+	{
+		case 0:	// Constant Bitrate (Single Pass)
+			encodeOptions->encodeMode = ADM_VIDENC_MODE_CBR;
+			encodeOptions->encodeModeParameter = ui.targetRateControlSpinBox->value();
+			break;
+		case 1: // Constant Quality (Single Pass)
+			encodeOptions->encodeMode = ADM_VIDENC_MODE_CQP;
+			encodeOptions->encodeModeParameter = ui.quantiserSpinBox->value();
+			break;
+		case 2: // Video Size (Two Pass)
+			encodeOptions->encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+			encodeOptions->encodeModeParameter = ui.targetRateControlSpinBox->value();
+			break;
+		case 3: // Average Bitrate (Two Pass)
+			encodeOptions->encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			encodeOptions->encodeModeParameter = ui.targetRateControlSpinBox->value();
+			break;
+	}
+
+	ConfigType configurationType = (ConfigType)ui.configurationComboBox->itemData(ui.configurationComboBox->currentIndex()).toInt();
+
+	options->setPresetConfiguration(ui.configurationComboBox->currentText().toUtf8().constData(), configurationType);
+	options->setParAsInput(ui.sarAsInputRadioButton->isChecked());
+
+	if (ui.sarCustomRadioButton->isChecked())
+		options->setPar(ui.sarCustomSpinBox1->value(), ui.sarCustomSpinBox2->value());
+	else if (ui.sarPredefinedRadioButton->isChecked())
+		options->setPar(predefinedARs[ui.sarPredefinedComboBox->currentIndex()][0], predefinedARs[ui.sarPredefinedComboBox->currentIndex()][1]);
+	else
+		// clear variables
+		options->setPar(1, 1);
+
+	if (ui.threadAutoDetectRadioButton->isChecked())
+		options->setThreads(0);
+	else if (ui.threadDisableRadioButton->isChecked())
+		options->setThreads(1);
+	else
+		options->setThreads(ui.threadCustomSpinBox->value());
+}
+
+QString XvidConfigDialog::getUserConfigDirectory(void)
+{
+	char *userConfigDirectory = ADM_getHomeRelativePath("xvid");
+	QString qstring = QString(userConfigDirectory);
+
+	delete [] userConfigDirectory;
+
+	return qstring;
+}
+
+QString XvidConfigDialog::getSystemConfigDirectory(void)
+{
+	char* pluginPath = ADM_getPluginPath();
+	QString qstring = QString(pluginPath).append("/").append(PLUGIN_SUBDIR);
+
+	delete [] pluginPath;
+
+	return qstring;
+}
+
 extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options)
 {
 	XvidConfigDialog dialog(configParameters, properties, encodeOptions, options);
 
 	if (dialog.exec() == QDialog::Accepted)
 	{
-		//dialog.saveSettings(encodeOptions, options);
+		dialog.saveSettings(encodeOptions, options);
 
 		return 1;
 	}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-03 20:57:37 UTC (rev 4516)
@@ -15,8 +15,38 @@
 
 private:
 	Ui_XvidConfigDialog ui;
+	bool disableGenericSlots;
 
+	static const int aspectRatioCount = 4;
+	int predefinedARs[aspectRatioCount][2];
+
+	int lastBitrate, lastVideoSize;
+
+	void fillConfigurationComboBox(void);
+	bool selectConfiguration(QString *selectFile, ConfigType configurationType);
+	bool loadPresetSettings(vidEncOptions *encodeOptions, XvidOptions *options);
+	void loadSettings(vidEncOptions *encodeOptions, XvidOptions *options);
+	QString getUserConfigDirectory(void);
+	QString getSystemConfigDirectory(void);
+
 public:
 	XvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options);
+	void saveSettings(vidEncOptions *encodeOptions, XvidOptions *options);
+
+private slots:
+	void generic_currentIndexChanged(int index);
+	void generic_valueChanged(int value);
+	void generic_pressed(void);
+	void generic_textEdited(QString text);
+
+	void configurationComboBox_currentIndexChanged(int index);
+	void saveAsButton_pressed(void);
+	void deleteButton_pressed(void);
+
+	// General tab
+	void encodingModeComboBox_currentIndexChanged(int index);
+	void quantiserSlider_valueChanged(int value);
+	void quantiserSpinBox_valueChanged(int value);
+	void targetRateControlSpinBox_valueChanged(int value);
 };
 #endif	// XvidConfigDialog_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-03 18:38:28 UTC (rev 4515)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-03 20:57:37 UTC (rev 4516)
@@ -360,7 +360,7 @@
                      <bool>false</bool>
                     </property>
                     <property name="text" >
-                     <string>0 (High Quality)</string>
+                     <string>1 (High Quality)</string>
                     </property>
                    </widget>
                   </item>
@@ -406,7 +406,7 @@
                      <bool>false</bool>
                     </property>
                     <property name="text" >
-                     <string>51 (Low Quality)</string>
+                     <string>31 (Low Quality)</string>
                     </property>
                    </widget>
                   </item>
@@ -424,14 +424,17 @@
                    </size>
                   </property>
                   <property name="maximum" >
-                   <number>51</number>
+                   <number>31</number>
                   </property>
                   <property name="pageStep" >
                    <number>5</number>
                   </property>
                   <property name="value" >
-                   <number>26</number>
+                   <number>4</number>
                   </property>
+                  <property name="sliderPosition" >
+                   <number>4</number>
+                  </property>
                   <property name="orientation" >
                    <enum>Qt::Horizontal</enum>
                   </property>
@@ -448,10 +451,13 @@
                  <bool>false</bool>
                 </property>
                 <property name="maximum" >
-                 <number>51</number>
+                 <number>31</number>
                 </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
                 <property name="value" >
-                 <number>26</number>
+                 <number>4</number>
                 </property>
                </widget>
               </item>



From gruntster at mail.berlios.de  Sat Jan  3 22:05:06 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 22:05:06 +0100
Subject: [Avidemux-svn-commit] r4517 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200901032105.n03L56lQ029705@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 22:05:01 +0100 (Sat, 03 Jan 2009)
New Revision: 4517

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h
Log:
[Merge] missed merge

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-01-03 20:57:37 UTC (rev 4516)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-01-03 21:05:01 UTC (rev 4517)
@@ -150,6 +150,14 @@
 	SliderIsShifted = 0;
 }
 
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+	if (value > 0)
+		nextIntraFrame();
+	else
+		previousIntraFrame();
+}
+
 void MainWindow::volumeChange( int u )
 {
 #ifdef HAVE_AUDIO

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h	2009-01-03 20:57:37 UTC (rev 4516)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.h	2009-01-03 21:05:01 UTC (rev 4517)
@@ -29,6 +29,7 @@
 	void sliderValueChanged(int u);
 	void sliderMoved(int value);
 	void sliderReleased(void);
+	void thumbSlider_valueEmitted(int value);
 	void volumeChange( int u );
 	void audioToggled(bool checked);
 	void previewModeChanged(QAction *action);



From gruntster at mail.berlios.de  Sat Jan  3 22:05:51 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 22:05:51 +0100
Subject: [Avidemux-svn-commit] r4518 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
Message-ID: <200901032105.n03L5pqt029793@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 22:05:46 +0100 (Sat, 03 Jan 2009)
New Revision: 4518

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
Log:
[x264] cosmetics

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-03 21:05:01 UTC (rev 4517)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-03 21:05:46 UTC (rev 4518)
@@ -348,25 +348,25 @@
 	switch (index)
 	{
 		case 0:
-			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Bitrate"));
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Bitrate:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
 			ui.targetRateControlSpinBox->setValue(lastBitrate);
 			break;
 		case 1: // Constant Quality - 1 pass
-			ui.quantiserLabel2->setText(QT_TR_NOOP("Quantiser"));
+			ui.quantiserLabel2->setText(QT_TR_NOOP("Quantiser:"));
 			enable = true;
 			break;
 		case 2: // Average Quantiser - 1 pass
-			ui.quantiserLabel2->setText(QT_TR_NOOP("Quality"));
+			ui.quantiserLabel2->setText(QT_TR_NOOP("Quality:"));
 			enable = true;
 			break;
 		case 3: // Video Size - 2 pass
-			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Video Size"));
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Video Size:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("MB"));
 			ui.targetRateControlSpinBox->setValue(lastVideoSize);
 			break;
 		case 4: // Average Bitrate - 2 pass
-			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Average Bitrate"));
+			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Average Bitrate:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
 			ui.targetRateControlSpinBox->setValue(lastBitrate);
 			break;



From gruntster at mail.berlios.de  Sat Jan  3 22:10:03 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 3 Jan 2009 22:10:03 +0100
Subject: [Avidemux-svn-commit] r4519 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200901032110.n03LA3NL030139@sheep.berlios.de>

Author: gruntster
Date: 2009-01-03 22:09:58 +0100 (Sat, 03 Jan 2009)
New Revision: 4519

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
Log:
[x264] use the same settings for 1st pass as 2nd pass

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2009-01-03 21:05:46 UTC (rev 4518)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2009-01-03 21:09:58 UTC (rev 4519)
@@ -436,24 +436,12 @@
   x264_param_default (&param);
   memcpy(&admParam,zparam,sizeof(admParam));
 
-  // in case of pass 1 we switch off some options
-  // As mplayer does it
-  admParam.PartitionDecision = 1;
-  admParam.Method = X264_ME_DIA;
-  
-  admParam._8x8 = 0;
-  admParam._8x8P = 0;
-  admParam._8x8B = 0;
-  admParam._8x8I = 0;
-  admParam._4x4I = 0;
-  admParam.Weighted = 0;
-  admParam.Trellis = 0;
-  
-//  param.rc.i_rc_buffer_size=-1;
 #if X264_BUILD >=48
-  param.rc.i_rc_method=X264_RC_CQP;
+  param.rc.i_rc_method=X264_RC_ABR;
+#else
+  param.rc.b_cbr = 1;
 #endif
-  param.rc.i_qp_constant = 2;
+  param.rc.i_bitrate = val;
 
   param.rc.b_stat_write = 1;
   param.rc.b_stat_read = 0;



From gruntster at mail.berlios.de  Sun Jan  4 13:41:27 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 4 Jan 2009 13:41:27 +0100
Subject: [Avidemux-svn-commit] r4520 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901041241.n04CfREx016130@sheep.berlios.de>

Author: gruntster
Date: 2009-01-04 13:41:20 +0100 (Sun, 04 Jan 2009)
New Revision: 4520

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] hook up Motion tab for Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-03 21:09:58 UTC (rev 4519)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 12:41:20 UTC (rev 4520)
@@ -50,6 +50,32 @@
                   </xs:sequence>
                 </xs:complexType>
               </xs:element>
+              <xs:element name="motionEstimation">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="none"/>
+                    <xs:enumeration value="low"/>
+                    <xs:enumeration value="medium"/>
+                    <xs:enumeration value="high"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="rdo">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="none"/>
+                    <xs:enumeration value="dct"/>
+                    <xs:enumeration value="hpelQpel16"/>
+                    <xs:enumeration value="hpelQpel8"/>
+                    <xs:enumeration value="square"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="bFrameRdo" type="xs:boolean"/>
+              <xs:element name="chromaMotionEstimation" type="xs:boolean"/>
+              <xs:element name="qPel" type="xs:boolean"/>
+              <xs:element name="gmc" type="xs:boolean"/>
+              <xs:element name="turboMode" type="xs:boolean"/>
             </xs:sequence>
           </xs:complexType>
         </xs:element>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-03 21:09:58 UTC (rev 4519)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 12:41:20 UTC (rev 4520)
@@ -61,10 +61,12 @@
 
 	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL;
 
+	setPar(1, 1);
+	setMotionEstimation(ME_LOW);
+	setRateDistortion(RD_DCT_ME);
 	setMaxKeyInterval(240);
 	setMinQuantiser(2, 2, 2);
 	setMaxQuantiser(31, 31, 31);
-	setPar(1, 1);
 
 	_parAsInput = false;
 
@@ -140,14 +142,16 @@
 
 MotionEstimationMode XvidOptions::getMotionEstimation(void)
 {
-	if (xvid_enc_frame.motion & ME_HIGH == ME_HIGH)
-		return ME_HIGH;
-	else if (xvid_enc_frame.motion & ME_MEDIUM == ME_MEDIUM)
-		return ME_MEDIUM;
-	else if (xvid_enc_frame.motion & ME_LOW == ME_LOW)
-		return ME_LOW;
-	else
-		return ME_NONE;
+	MotionEstimationMode motionEstimation = ME_NONE;
+
+	if ((xvid_enc_frame.motion & ME_HIGH) == ME_HIGH)
+		motionEstimation = ME_HIGH;
+	else if ((xvid_enc_frame.motion & ME_MEDIUM) == ME_MEDIUM)
+		motionEstimation = ME_MEDIUM;
+	else if ((xvid_enc_frame.motion & ME_LOW) == ME_LOW)
+		motionEstimation = ME_LOW;
+
+	return motionEstimation;
 }
 
 void XvidOptions::setMotionEstimation(MotionEstimationMode motionEstimation)
@@ -167,6 +171,128 @@
 	}
 }
 
+RateDistortionMode XvidOptions::getRateDistortion(void)
+{
+	RateDistortionMode rateDistortion = RD_NONE;
+
+	if ((xvid_enc_frame.motion & RD_SQUARE) == RD_SQUARE)
+		rateDistortion = RD_SQUARE;
+	else if ((xvid_enc_frame.motion & RD_HPEL_QPEL_8) == RD_HPEL_QPEL_8)
+		rateDistortion = RD_HPEL_QPEL_8;
+	else if ((xvid_enc_frame.motion & RD_HPEL_QPEL_16) == RD_HPEL_QPEL_16)
+		rateDistortion = RD_HPEL_QPEL_16;
+	else if ((xvid_enc_frame.vop_flags & XVID_VOP_MODEDECISION_RD) == XVID_VOP_MODEDECISION_RD)
+		rateDistortion = RD_DCT_ME;
+
+	return rateDistortion;
+}
+
+void XvidOptions::setRateDistortion(RateDistortionMode rateDistortion)
+{
+	if (rateDistortion == RD_NONE || rateDistortion == RD_DCT_ME || rateDistortion == RD_HPEL_QPEL_16 || 
+		rateDistortion == RD_HPEL_QPEL_8 || rateDistortion == RD_SQUARE)
+	{
+		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_16;
+		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_8;
+		xvid_enc_frame.motion &= ~RD_SQUARE;
+
+		if (rateDistortion == RD_NONE)
+			xvid_enc_frame.vop_flags &= ~XVID_VOP_MODEDECISION_RD;
+		else
+		{
+			if (rateDistortion != RD_DCT_ME)
+				xvid_enc_frame.motion |= rateDistortion;
+
+			xvid_enc_frame.vop_flags |= XVID_VOP_MODEDECISION_RD;
+		}
+	}
+}
+
+bool XvidOptions::getBframeRdo(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_RD_BVOP;
+}
+
+void XvidOptions::setBframeRdo(bool bFrameRdo)
+{
+	if (bFrameRdo)
+		xvid_enc_frame.vop_flags |= XVID_VOP_RD_BVOP;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_RD_BVOP;
+}
+
+bool XvidOptions::getChromaMotionEstimation(void)
+{
+	return xvid_enc_frame.motion & CHROMA_ME;
+}
+
+void XvidOptions::setChromaMotionEstimation(bool chromaMotionEstimation)
+{
+	if (chromaMotionEstimation)
+		xvid_enc_frame.motion |= CHROMA_ME;
+	else
+		xvid_enc_frame.motion &= ~CHROMA_ME;
+}
+
+bool XvidOptions::getQpel(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_QUARTERPEL;
+}
+
+void XvidOptions::setQpel(bool qpel)
+{
+	if (qpel)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
+
+		if (getInterMotionVector())
+			xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE16;
+		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE8;
+	}
+}
+
+bool XvidOptions::getGmc(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_GMC;
+}
+
+void XvidOptions::setGmc(bool gmc)
+{
+	if (gmc)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
+		xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_GMC;
+		xvid_enc_frame.motion &= ~XVID_ME_GME_REFINE;
+	}
+}
+
+bool XvidOptions::getTurboMode(void)
+{
+	return xvid_enc_frame.motion & TURBO_MODE;
+}
+
+void XvidOptions::setTurboMode(bool turboMode)
+{
+	if (turboMode)
+	{
+		xvid_enc_frame.motion |= TURBO_MODE;
+	}
+	else
+	{
+		xvid_enc_frame.motion &= ~TURBO_MODE;
+	}
+}
+
 unsigned int XvidOptions::getMaxKeyInterval(void)
 {
 	return xvid_enc_create.max_key_interval;
@@ -272,61 +398,6 @@
 		xvid_enc_frame.vop_flags &= ~XVID_VOP_GREYSCALE;
 }
 
-bool XvidOptions::getQpel(void)
-{
-	return xvid_enc_frame.vol_flags & XVID_VOL_QUARTERPEL;
-}
-
-void XvidOptions::setQpel(bool qpel)
-{
-	if (qpel)
-	{
-		xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
-		xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
-
-		if (getInterMotionVector())
-			xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
-	}
-	else
-	{
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_QUARTERPEL;
-		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE16;
-		xvid_enc_frame.motion &= ~XVID_ME_QUARTERPELREFINE8;
-	}
-}
-
-bool XvidOptions::getGmc(void)
-{
-	return xvid_enc_frame.vol_flags & XVID_VOL_GMC;
-}
-
-void XvidOptions::setGmc(bool gmc)
-{
-	if (gmc)
-	{
-		xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
-		xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
-	}
-	else
-	{
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_GMC;
-		xvid_enc_frame.motion &= ~XVID_ME_GME_REFINE;
-	}
-}
-
-bool XvidOptions::getBvhq(void)
-{
-	return xvid_enc_frame.vop_flags & XVID_VOP_RD_BVOP;
-}
-
-void XvidOptions::setBvhq(bool bvhq)
-{
-	if (bvhq)
-		xvid_enc_frame.vop_flags |= XVID_VOP_RD_BVOP;
-	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_RD_BVOP;
-}
-
 bool XvidOptions::getAcPrediction(void)
 {
 	return xvid_enc_frame.vop_flags & XVID_VOP_HQACPRED;
@@ -391,34 +462,6 @@
 		xvid_enc_create.max_quant[2] = b;
 }
 
-RateDistortionMode XvidOptions::getRateDistortion(RateDistortionMode rateDistortion)
-{
-	if (xvid_enc_frame.motion & RD_SQUARE == RD_SQUARE)
-		return RD_SQUARE;
-	else if (xvid_enc_frame.motion & RD_HPEL_QPEL_8 == RD_HPEL_QPEL_8)
-		return RD_HPEL_QPEL_8;
-	else if (xvid_enc_frame.motion & RD_HPEL_QPEL_16 == RD_HPEL_QPEL_16)
-		return RD_HPEL_QPEL_16;
-	else if (xvid_enc_frame.motion & RD_DCT_ME == RD_DCT_ME)
-		return RD_DCT_ME;
-	else
-		return RD_NONE;
-}
-
-void XvidOptions::setRateDistortion(RateDistortionMode rateDistortion)
-{
-	if (rateDistortion == RD_NONE || rateDistortion == RD_DCT_ME || rateDistortion == RD_HPEL_QPEL_16 || 
-		rateDistortion == RD_HPEL_QPEL_8 || rateDistortion == RD_SQUARE)
-	{
-		xvid_enc_frame.motion &= ~RD_NONE;
-		xvid_enc_frame.motion &= ~RD_DCT_ME;
-		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_16;
-		xvid_enc_frame.motion &= ~RD_HPEL_QPEL_8;
-		xvid_enc_frame.motion &= ~RD_SQUARE;
-		xvid_enc_frame.motion |= rateDistortion;
-	}
-}
-
 bool XvidOptions::getPacked(void)
 {
 	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
@@ -540,6 +583,51 @@
 
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"sarHeight", number2String(xmlBuffer, bufferSize, height));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"sarWidth", number2String(xmlBuffer, bufferSize, width));
+
+	switch (getMotionEstimation())
+	{
+		case ME_LOW:
+			strcpy((char*)xmlBuffer, "low");
+			break;
+		case ME_MEDIUM:
+			strcpy((char*)xmlBuffer, "medium");
+			break;
+		case ME_HIGH:
+			strcpy((char*)xmlBuffer, "high");
+			break;
+		default:
+			strcpy((char*)xmlBuffer, "none");
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"motionEstimation", xmlBuffer);
+
+	switch (getRateDistortion())
+	{
+		case RD_DCT_ME:
+			strcpy((char*)xmlBuffer, "dct");
+			break;
+		case RD_HPEL_QPEL_16:
+			strcpy((char*)xmlBuffer, "hpelQpel16");
+			break;
+		case RD_HPEL_QPEL_8:
+			strcpy((char*)xmlBuffer, "hpelQpel8");
+			break;
+		case RD_SQUARE:
+			strcpy((char*)xmlBuffer, "square");
+			break;
+		default:
+			strcpy((char*)xmlBuffer, "none");
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"rdo", xmlBuffer);
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"bFrameRdo", boolean2String(xmlBuffer, bufferSize, getBframeRdo()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"chromaMotionEstimation", boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"qPel", boolean2String(xmlBuffer, bufferSize, getQpel()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"gmc", boolean2String(xmlBuffer, bufferSize, getGmc()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"turboMode", boolean2String(xmlBuffer, bufferSize, getTurboMode()));
 }
 
 bool XvidOptions::validateXml(xmlDocPtr doc)
@@ -650,7 +738,45 @@
 				setThreads(atoi(content));
 			else if (strcmp((char*)xmlChild->name, "vui") == 0)
 				parseVuiOptions(xmlChild);
+			else if (strcmp((char*)xmlChild->name, "motionEstimation") == 0)
+			{
+				MotionEstimationMode motionEstimation = ME_NONE;
 
+				if (strcmp(content, "low") == 0)
+					motionEstimation = ME_LOW;
+				else if (strcmp(content, "medium") == 0)
+					motionEstimation = ME_MEDIUM;
+				else if (strcmp(content, "high") == 0)
+					motionEstimation = ME_HIGH;
+
+				setMotionEstimation(motionEstimation);
+			}
+			else if (strcmp((char*)xmlChild->name, "rdo") == 0)
+			{
+				RateDistortionMode rateDistortion = RD_NONE;
+
+				if (strcmp(content, "dct") == 0)
+					rateDistortion = RD_DCT_ME;
+				else if (strcmp(content, "hpelQpel16") == 0)
+					rateDistortion = RD_HPEL_QPEL_16;
+				else if (strcmp(content, "hpelQpel8") == 0)
+					rateDistortion = RD_HPEL_QPEL_8;
+				else if (strcmp(content, "square") == 0)
+					rateDistortion = RD_SQUARE;
+
+				setRateDistortion(rateDistortion);
+			}
+			else if (strcmp((char*)xmlChild->name, "bFrameRdo") == 0)
+				setBframeRdo(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "chromaMotionEstimation") == 0)
+				setChromaMotionEstimation(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "qPel") == 0)
+				setQpel(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "gmc") == 0)
+				setGmc(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "turboMode") == 0)
+				setTurboMode(string2Boolean(content));
+
 			xmlFree(content);
 		}
 	}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-03 21:09:58 UTC (rev 4519)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 12:41:20 UTC (rev 4520)
@@ -25,8 +25,10 @@
 #include "ADM_vidEnc_plugin.h"
 }
 
-#define DEFAULT_ENCODE_MODE ADM_VIDENC_MODE_CQP
-#define DEFAULT_ENCODE_MODE_PARAMETER 4
+#define DEFAULT_ENCODE_MODE	(ADM_VIDENC_MODE_CQP)
+#define DEFAULT_ENCODE_MODE_PARAMETER (4)
+#define TURBO_MODE (XVID_ME_FASTREFINE16 | XVID_ME_FASTREFINE8 | XVID_ME_SKIP_DELTASEARCH | XVID_ME_FAST_MODEINTERPOLATE | XVID_ME_BFRAME_EARLYSTOP)
+#define CHROMA_ME (XVID_ME_CHROMA_PVOP | XVID_ME_CHROMA_BVOP)
 
 typedef enum
 {
@@ -46,8 +48,8 @@
 
 typedef enum
 {
-	RD_NONE = 0,
-	RD_DCT_ME = XVID_VOP_MODEDECISION_RD,
+	RD_NONE = -1,
+	RD_DCT_ME = 0,
 	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
 	RD_HPEL_QPEL_8 = RD_HPEL_QPEL_16 | XVID_ME_HALFPELREFINE8_RD | XVID_ME_QUARTERPELREFINE8_RD | XVID_ME_CHECKPREDICTION_RD,
 	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
@@ -100,6 +102,24 @@
 	MotionEstimationMode getMotionEstimation(void);
 	void setMotionEstimation(MotionEstimationMode motionEstimation);
 
+	RateDistortionMode getRateDistortion(void);
+	void setRateDistortion(RateDistortionMode rateDistortion);
+
+	bool getBframeRdo(void);
+	void setBframeRdo(bool bFrameRdo);
+
+	bool getChromaMotionEstimation(void);
+	void setChromaMotionEstimation(bool chromaMotionEstimation);
+
+	bool getQpel(void);
+	void setQpel(bool qpel);
+
+	bool getGmc(void);
+	void setGmc(bool gmc);
+
+	bool getTurboMode(void);
+	void setTurboMode(bool turboMode);
+
 	unsigned int getMaxKeyInterval(void);
 	void setMaxKeyInterval(unsigned int maxKeyInterval);
 
@@ -124,15 +144,6 @@
 	bool getGreyscale(void);
 	void setGreyscale(bool greyscale);
 
-	bool getQpel(void);
-	void setQpel(bool qpel);
-
-	bool getGmc(void);
-	void setGmc(bool gmc);
-
-	bool getBvhq(void);
-	void setBvhq(bool bvhq);
-
 	bool getAcPrediction(void);
 	void setAcPrediction(bool acPrediction);
 
@@ -145,9 +156,6 @@
 	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
-	RateDistortionMode getRateDistortion(RateDistortionMode rateDistortion);
-	void setRateDistortion(RateDistortionMode rateDistortion);
-
 	bool getPacked(void);
 	void setPacked(bool packed);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-03 21:09:58 UTC (rev 4519)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 12:41:20 UTC (rev 4520)
@@ -422,6 +422,46 @@
 			ui.threadCustomSpinBox->setValue(options->getThreads());
 	}
 
+	// Motion tab
+	ui.meCheckBox->setChecked((options->getMotionEstimation() != ME_NONE));
+
+	switch (options->getMotionEstimation())
+	{
+		case ME_LOW:
+			ui.meComboBox->setCurrentIndex(0);
+			break;
+		case ME_MEDIUM:
+			ui.meComboBox->setCurrentIndex(1);
+			break;
+		case ME_HIGH:
+			ui.meComboBox->setCurrentIndex(2);
+			break;
+	}
+
+	ui.rdoCheckBox->setChecked((options->getRateDistortion() != RD_NONE));
+
+	switch (options->getRateDistortion())
+	{
+		case RD_DCT_ME:
+			ui.rdoComboBox->setCurrentIndex(0);
+			break;
+		case RD_HPEL_QPEL_16:
+			ui.rdoComboBox->setCurrentIndex(1);
+			break;
+		case RD_HPEL_QPEL_8:
+			ui.rdoComboBox->setCurrentIndex(2);
+			break;
+		case RD_SQUARE:
+			ui.rdoComboBox->setCurrentIndex(3);
+			break;
+	}
+
+	ui.rdoBframeCheckBox->setChecked(options->getBframeRdo());
+	ui.chromaMeCheckBox->setChecked(options->getChromaMotionEstimation());
+	ui.qPelCheckBox->setChecked(options->getQpel());
+	ui.gmcCheckBox->setChecked(options->getGmc());
+	ui.turboCheckBox->setChecked(options->getTurboMode());
+
 	disableGenericSlots = origDisableGenericSlots;
 }
 
@@ -469,6 +509,52 @@
 		options->setThreads(1);
 	else
 		options->setThreads(ui.threadCustomSpinBox->value());
+
+	// Motion tab
+	if (ui.meCheckBox->isChecked())
+	{
+		switch (ui.meComboBox->currentIndex())
+		{
+			case 0:
+				options->setMotionEstimation(ME_LOW);
+				break;
+			case 1:
+				options->setMotionEstimation(ME_MEDIUM);
+				break;
+			case 2:
+				options->setMotionEstimation(ME_HIGH);
+				break;
+		}
+	}
+	else
+		options->setMotionEstimation(ME_NONE);
+
+	if (ui.rdoCheckBox->isChecked())
+	{
+		switch (ui.rdoComboBox->currentIndex())
+		{
+			case 0:
+				options->setRateDistortion(RD_DCT_ME);
+				break;
+			case 1:
+				options->setRateDistortion(RD_HPEL_QPEL_16);
+				break;
+			case 2:
+				options->setRateDistortion(RD_HPEL_QPEL_8);
+				break;
+			case 3:
+				options->setRateDistortion(RD_SQUARE);
+				break;
+		}
+	}
+	else
+		options->setRateDistortion(RD_NONE);
+
+	options->setBframeRdo(ui.rdoBframeCheckBox->isChecked());
+	options->setChromaMotionEstimation(ui.chromaMeCheckBox->isChecked());
+	options->setQpel(ui.qPelCheckBox->isChecked());
+	options->setGmc(ui.gmcCheckBox->isChecked());
+	options->setTurboMode(ui.turboCheckBox->isChecked());
 }
 
 QString XvidConfigDialog::getUserConfigDirectory(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-03 21:09:58 UTC (rev 4519)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 12:41:20 UTC (rev 4520)
@@ -7,7 +7,7 @@
     <x>0</x>
     <y>0</y>
     <width>500</width>
-    <height>570</height>
+    <height>565</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -819,7 +819,7 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QComboBox" name="motionPrecisionComboBox" >
+               <widget class="QComboBox" name="meComboBox" >
                 <property name="currentIndex" >
                  <number>0</number>
                 </property>
@@ -890,7 +890,7 @@
                 </property>
                 <item>
                  <property name="text" >
-                  <string>No Search / DCT</string>
+                  <string>No Search (DCT only)</string>
                  </property>
                 </item>
                 <item>
@@ -948,7 +948,7 @@
            </widget>
           </item>
           <item>
-           <widget class="QCheckBox" name="checkBox_2" >
+           <widget class="QCheckBox" name="qPelCheckBox" >
             <property name="text" >
              <string>Quarter Pixel Motion Estimation</string>
             </property>
@@ -1010,6 +1010,20 @@
            <number>6</number>
           </property>
           <item>
+           <widget class="QCheckBox" name="chromaOptimiserCheckBox" >
+            <property name="text" >
+             <string>Chroma Optimiser</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QCheckBox" name="fourMvCheckBox" >
+            <property name="text" >
+             <string>Four Motion Vectors per Macroblock</string>
+            </property>
+           </widget>
+          </item>
+          <item>
            <widget class="QCheckBox" name="greyscaleCheckBox" >
             <property name="text" >
              <string>Greyscale</string>
@@ -2510,14 +2524,16 @@
   <tabstop>threadCustomRadioButton</tabstop>
   <tabstop>threadCustomSpinBox</tabstop>
   <tabstop>meCheckBox</tabstop>
-  <tabstop>motionPrecisionComboBox</tabstop>
+  <tabstop>meComboBox</tabstop>
   <tabstop>rdoCheckBox</tabstop>
   <tabstop>rdoComboBox</tabstop>
   <tabstop>rdoBframeCheckBox</tabstop>
   <tabstop>chromaMeCheckBox</tabstop>
-  <tabstop>checkBox_2</tabstop>
+  <tabstop>qPelCheckBox</tabstop>
   <tabstop>gmcCheckBox</tabstop>
   <tabstop>turboCheckBox</tabstop>
+  <tabstop>chromaOptimiserCheckBox</tabstop>
+  <tabstop>fourMvCheckBox</tabstop>
   <tabstop>greyscaleCheckBox</tabstop>
   <tabstop>interlacedCheckBox</tabstop>
   <tabstop>interlacedComboBox</tabstop>
@@ -2688,7 +2704,7 @@
   <connection>
    <sender>meCheckBox</sender>
    <signal>toggled(bool)</signal>
-   <receiver>motionPrecisionComboBox</receiver>
+   <receiver>meComboBox</receiver>
    <slot>setEnabled(bool)</slot>
    <hints>
     <hint type="sourcelabel" >



From gruntster at mail.berlios.de  Sun Jan  4 15:05:16 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 4 Jan 2009 15:05:16 +0100
Subject: [Avidemux-svn-commit] r4521 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901041405.n04E5GTv026450@sheep.berlios.de>

Author: gruntster
Date: 2009-01-04 15:05:03 +0100 (Sun, 04 Jan 2009)
New Revision: 4521

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] hook up Frame tab for Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 12:41:20 UTC (rev 4520)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 14:05:03 UTC (rev 4521)
@@ -76,6 +76,36 @@
               <xs:element name="qPel" type="xs:boolean"/>
               <xs:element name="gmc" type="xs:boolean"/>
               <xs:element name="turboMode" type="xs:boolean"/>
+              <xs:element name="chromaOptimiser" type="xs:boolean"/>
+              <xs:element name="fourMv" type="xs:boolean"/>
+              <xs:element name="greyscale" type="xs:boolean"/>
+              <xs:element name="interlaced">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="none"/>
+                    <xs:enumeration value="bff"/>
+                    <xs:enumeration value="tff"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="frameDropRatio">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="0"/>
+                    <xs:maxInclusive value="100"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="maxIframeInterval" type="xs:integer"/>
+              <xs:element name="maxBframes">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="0"/>
+                    <xs:maxInclusive value="20"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="packed" type="xs:boolean"/>
             </xs:sequence>
           </xs:complexType>
         </xs:element>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 12:41:20 UTC (rev 4520)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 14:05:03 UTC (rev 4521)
@@ -59,12 +59,11 @@
 	memset(&xvid_enc_create, 0, sizeof(xvid_enc_create_t));
 	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
 
-	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL;
+	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
 
 	setPar(1, 1);
 	setMotionEstimation(ME_LOW);
 	setRateDistortion(RD_DCT_ME);
-	setMaxKeyInterval(240);
 	setMinQuantiser(2, 2, 2);
 	setMaxQuantiser(31, 31, 31);
 
@@ -293,135 +292,162 @@
 	}
 }
 
-unsigned int XvidOptions::getMaxKeyInterval(void)
+bool XvidOptions::getChromaOptimisation(void)
 {
-	return xvid_enc_create.max_key_interval;
+	return xvid_enc_frame.vop_flags & XVID_VOP_CHROMAOPT;
 }
 
-void XvidOptions::setMaxKeyInterval(unsigned int maxKeyInterval)
+void XvidOptions::setChromaOptimisation(bool chromaOptimisation)
 {
-	if (maxKeyInterval > 0 && maxKeyInterval <= 900)
-		xvid_enc_create.max_key_interval = maxKeyInterval;
+	if (chromaOptimisation)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CHROMAOPT;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_CHROMAOPT;
 }
 
-unsigned int XvidOptions::getMaxBFrames(void)
+bool XvidOptions::getInterMotionVector(void)
 {
-	return xvid_enc_create.max_bframes;
+	return xvid_enc_frame.vop_flags & XVID_VOP_INTER4V;
 }
 
-void XvidOptions::setMaxBFrames(unsigned int maxBFrames)
+void XvidOptions::setInterMotionVector(bool interMotionVector)
 {
-	if (maxBFrames <= 3)
-		xvid_enc_create.max_bframes = maxBFrames;
+	if (interMotionVector)
+	{
+		xvid_enc_frame.vop_flags |= XVID_VOP_INTER4V;
+
+		if (getQpel())
+			setQpel(true);
+	}
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_INTER4V;
 }
 
-bool XvidOptions::getMpegQuantisation(void)
+bool XvidOptions::getGreyscale(void)
 {
-	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
+	return xvid_enc_frame.vop_flags & XVID_VOP_GREYSCALE;
 }
 
-void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
+void XvidOptions::setGreyscale(bool greyscale)
 {
-	if (mpegQuantisation)
-		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
+	if (greyscale)
+		xvid_enc_frame.vop_flags |= XVID_VOP_GREYSCALE;
 	else
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_GREYSCALE;
 }
 
-bool XvidOptions::getInterlaced(void)
+InterlacedMode XvidOptions::getInterlaced(void)
 {
-	return xvid_enc_frame.vol_flags & XVID_VOL_INTERLACING;
+	InterlacedMode interlaced = INTERLACED_NONE;
+
+	if (xvid_enc_frame.vop_flags & XVID_VOP_TOPFIELDFIRST)
+		interlaced = INTERLACED_TFF;
+	else if (xvid_enc_frame.vol_flags & XVID_VOL_INTERLACING)
+		interlaced = INTERLACED_BFF;
+
+	return interlaced;
 }
 
-void XvidOptions::setInterlaced(bool interlaced)
+void XvidOptions::setInterlaced(InterlacedMode interlaced)
 {
-	if (interlaced)
+	if (interlaced == INTERLACED_NONE)
+	{
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_INTERLACING;
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_TOPFIELDFIRST;
+	}
+	else if (interlaced == INTERLACED_BFF || interlaced == INTERLACED_TFF)
+	{
 		xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
-	else
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_INTERLACING;
+
+		if (interlaced == INTERLACED_TFF)
+			xvid_enc_frame.vop_flags |= XVID_VOP_TOPFIELDFIRST;
+		else
+			xvid_enc_frame.vop_flags &= ~XVID_VOP_TOPFIELDFIRST;
+	}
 }
 
-bool XvidOptions::getInterMotionVector(void)
+unsigned int XvidOptions::getFrameDropRatio(void)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_INTER4V;
+	return xvid_enc_create.frame_drop_ratio;
 }
 
-void XvidOptions::setInterMotionVector(bool interMotionVector)
+void XvidOptions::setFrameDropRatio(unsigned int frameDropRatio)
 {
-	if (interMotionVector)
-	{
-		xvid_enc_frame.vop_flags |= XVID_VOP_INTER4V;
+	if (frameDropRatio <= 100)
+		xvid_enc_create.frame_drop_ratio = frameDropRatio;
+}
 
-		if (getQpel())
-			setQpel(true);
-	}
-	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_INTER4V;
+unsigned int XvidOptions::getMaxKeyInterval(void)
+{
+	return xvid_enc_create.max_key_interval;
 }
 
-bool XvidOptions::getTrellis(void)
+void XvidOptions::setMaxKeyInterval(unsigned int maxKeyInterval)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
+	xvid_enc_create.max_key_interval = maxKeyInterval;
 }
 
-void XvidOptions::setTrellis(bool trellis)
+unsigned int XvidOptions::getMaxBFrames(void)
 {
-	if (trellis)
-		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
-	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
+	return xvid_enc_create.max_bframes;
 }
 
-bool XvidOptions::getCartoon(void)
+void XvidOptions::setMaxBFrames(unsigned int maxBFrames)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_CARTOON;
+	if (maxBFrames <= 20)
+		xvid_enc_create.max_bframes = maxBFrames;
 }
 
-void XvidOptions::setCartoon(bool cartoon)
+bool XvidOptions::getPacked(void)
 {
-	if (cartoon)
-		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
+	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
+}
+
+void XvidOptions::setPacked(bool packed)
+{
+	if (packed)
+		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
 	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_CARTOON;
+		xvid_enc_create.global &= ~XVID_GLOBAL_PACKED;
 }
 
-bool XvidOptions::getGreyscale(void)
+bool XvidOptions::getMpegQuantisation(void)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_GREYSCALE;
+	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
 }
 
-void XvidOptions::setGreyscale(bool greyscale)
+void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
 {
-	if (greyscale)
-		xvid_enc_frame.vop_flags |= XVID_VOP_GREYSCALE;
+	if (mpegQuantisation)
+		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
 	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_GREYSCALE;
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
 }
 
-bool XvidOptions::getAcPrediction(void)
+bool XvidOptions::getTrellis(void)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_HQACPRED;
+	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
 }
 
-void XvidOptions::setAcPrediction(bool acPrediction)
+void XvidOptions::setTrellis(bool trellis)
 {
-	if (acPrediction)
-		xvid_enc_frame.vop_flags |= XVID_VOP_HQACPRED;
+	if (trellis)
+		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
 	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_HQACPRED;
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
 }
 
-bool XvidOptions::getChromaOptimisation(void)
+bool XvidOptions::getCartoon(void)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_CHROMAOPT;
+	return xvid_enc_frame.vop_flags & XVID_VOP_CARTOON;
 }
 
-void XvidOptions::setChromaOptimisation(bool chromaOptimisation)
+void XvidOptions::setCartoon(bool cartoon)
 {
-	if (chromaOptimisation)
-		xvid_enc_frame.vop_flags |= XVID_VOP_CHROMAOPT;
+	if (cartoon)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
 	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_CHROMAOPT;
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_CARTOON;
 }
 
 void XvidOptions::getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
@@ -462,19 +488,6 @@
 		xvid_enc_create.max_quant[2] = b;
 }
 
-bool XvidOptions::getPacked(void)
-{
-	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
-}
-
-void XvidOptions::setPacked(bool packed)
-{
-	if (packed)
-		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
-	else
-		xvid_enc_create.global &= ~XVID_GLOBAL_PACKED;
-}
-
 bool XvidOptions::getClosedGop(void)
 {
 	return xvid_enc_create.global & XVID_GLOBAL_CLOSED_GOP;
@@ -628,6 +641,28 @@
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"qPel", boolean2String(xmlBuffer, bufferSize, getQpel()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"gmc", boolean2String(xmlBuffer, bufferSize, getGmc()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"turboMode", boolean2String(xmlBuffer, bufferSize, getTurboMode()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"chromaOptimiser", boolean2String(xmlBuffer, bufferSize, getChromaOptimisation()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"fourMv", boolean2String(xmlBuffer, bufferSize, getInterMotionVector()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"greyscale", boolean2String(xmlBuffer, bufferSize, getGreyscale()));
+
+	switch (getInterlaced())
+	{
+		case INTERLACED_BFF:
+			strcpy((char*)xmlBuffer, "bff");
+			break;
+		case INTERLACED_TFF:
+			strcpy((char*)xmlBuffer, "tff");
+			break;
+		default:
+			strcpy((char*)xmlBuffer, "none");
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"interlaced", xmlBuffer);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"frameDropRatio", number2String(xmlBuffer, bufferSize, getFrameDropRatio()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxIframeInterval", number2String(xmlBuffer, bufferSize, getMaxKeyInterval()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxBframes", number2String(xmlBuffer, bufferSize, getMaxBFrames()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"packed", boolean2String(xmlBuffer, bufferSize, getPacked()));
 }
 
 bool XvidOptions::validateXml(xmlDocPtr doc)
@@ -776,7 +811,32 @@
 				setGmc(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "turboMode") == 0)
 				setTurboMode(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "chromaOptimiser") == 0)
+				setChromaOptimisation(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "fourMv") == 0)
+				setInterMotionVector(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "greyscale") == 0)
+				setGreyscale(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "interlaced") == 0)
+			{
+				InterlacedMode interlaced = INTERLACED_NONE;
 
+				if (strcmp(content, "bff") == 0)
+					interlaced = INTERLACED_BFF;
+				else if (strcmp(content, "tff") == 0)
+					interlaced = INTERLACED_TFF;
+
+				setInterlaced(interlaced);
+			}
+			else if (strcmp((char*)xmlChild->name, "frameDropRatio") == 0)
+				setFrameDropRatio(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxIframeInterval") == 0)
+				setMaxKeyInterval(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxBframes") == 0)
+				setMaxBFrames(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "packed") == 0)
+				setPacked(string2Boolean(content));
+
 			xmlFree(content);
 		}
 	}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 12:41:20 UTC (rev 4520)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 14:05:03 UTC (rev 4521)
@@ -48,6 +48,13 @@
 
 typedef enum
 {
+	INTERLACED_NONE,
+	INTERLACED_BFF,
+	INTERLACED_TFF
+} InterlacedMode;
+
+typedef enum
+{
 	RD_NONE = -1,
 	RD_DCT_ME = 0,
 	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
@@ -120,45 +127,45 @@
 	bool getTurboMode(void);
 	void setTurboMode(bool turboMode);
 
+	bool getChromaOptimisation(void);
+	void setChromaOptimisation(bool chromaOptimisation);
+
+	bool getInterMotionVector(void);
+	void setInterMotionVector(bool interMotionVector);
+
+	bool getGreyscale(void);
+	void setGreyscale(bool greyscale);
+
+	InterlacedMode getInterlaced(void);
+	void setInterlaced(InterlacedMode interlaced);
+
+	unsigned int getFrameDropRatio(void);
+	void setFrameDropRatio(unsigned int frameDropRatio);
+
 	unsigned int getMaxKeyInterval(void);
 	void setMaxKeyInterval(unsigned int maxKeyInterval);
 
 	unsigned int getMaxBFrames(void);
 	void setMaxBFrames(unsigned int maxBFrames);
 
+	bool getPacked(void);
+	void setPacked(bool packed);
+
 	bool getMpegQuantisation(void);
 	void setMpegQuantisation(bool mpegQuantisation);
 
-	bool getInterlaced(void);
-	void setInterlaced(bool interlaced);
-
-	bool getInterMotionVector(void);
-	void setInterMotionVector(bool interMotionVector);
-
 	bool getTrellis(void);
 	void setTrellis(bool trellis);
 
 	bool getCartoon(void);
 	void setCartoon(bool cartoon);
 
-	bool getGreyscale(void);
-	void setGreyscale(bool greyscale);
-
-	bool getAcPrediction(void);
-	void setAcPrediction(bool acPrediction);
-
-	bool getChromaOptimisation(void);
-	void setChromaOptimisation(bool chromaOptimisation);
-
 	void getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMinQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
 	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
-	bool getPacked(void);
-	void setPacked(bool packed);
-
 	bool getClosedGop(void);
 	void setClosedGop(bool closedGop);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 12:41:20 UTC (rev 4520)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 14:05:03 UTC (rev 4521)
@@ -462,6 +462,28 @@
 	ui.gmcCheckBox->setChecked(options->getGmc());
 	ui.turboCheckBox->setChecked(options->getTurboMode());
 
+	// Frame tab
+	ui.chromaOptimiserCheckBox->setChecked(options->getChromaOptimisation());
+	ui.fourMvCheckBox->setChecked(options->getInterMotionVector());
+	ui.greyscaleCheckBox->setChecked(options->getGreyscale());
+
+	ui.interlacedCheckBox->setChecked((options->getInterlaced() != INTERLACED_NONE));
+
+	switch (options->getInterlaced())
+	{
+		case INTERLACED_BFF:
+			ui.interlacedComboBox->setCurrentIndex(0);
+			break;
+		case INTERLACED_TFF:
+			ui.interlacedComboBox->setCurrentIndex(1);
+			break;
+	}
+
+	ui.frameDropSpinBox->setValue(options->getFrameDropRatio());
+	ui.maxIframeIntervalSpinBox->setValue(options->getMaxKeyInterval());
+	ui.maxBframesSpinBox->setValue(options->getMaxBFrames());
+	ui.packedCheckBox->setChecked(options->getPacked());
+
 	disableGenericSlots = origDisableGenericSlots;
 }
 
@@ -555,6 +577,31 @@
 	options->setQpel(ui.qPelCheckBox->isChecked());
 	options->setGmc(ui.gmcCheckBox->isChecked());
 	options->setTurboMode(ui.turboCheckBox->isChecked());
+
+	// Frame tab
+	options->setChromaOptimisation(ui.chromaOptimiserCheckBox->isChecked());
+	options->setInterMotionVector(ui.fourMvCheckBox->isChecked());
+	options->setGreyscale(ui.greyscaleCheckBox->isChecked());
+
+	if (ui.interlacedCheckBox->isChecked())
+	{
+		switch (ui.interlacedComboBox->currentIndex())
+		{
+			case 0:
+				options->setInterlaced(INTERLACED_BFF);
+				break;
+			case 1:
+				options->setInterlaced(INTERLACED_TFF);
+				break;
+		}
+	}
+	else
+		options->setInterlaced(INTERLACED_NONE);
+
+	options->setFrameDropRatio(ui.frameDropSpinBox->value());
+	options->setMaxKeyInterval(ui.maxIframeIntervalSpinBox->value());
+	options->setMaxBFrames(ui.maxBframesSpinBox->value());
+	options->setPacked(ui.packedCheckBox->isChecked());
 }
 
 QString XvidConfigDialog::getUserConfigDirectory(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 12:41:20 UTC (rev 4520)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 14:05:03 UTC (rev 4521)
@@ -1114,7 +1114,11 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QSpinBox" name="maxIframeIntervalSpinBox" />
+               <widget class="QSpinBox" name="maxIframeIntervalSpinBox" >
+                <property name="maximum" >
+                 <number>2147483647</number>
+                </property>
+               </widget>
               </item>
               <item>
                <spacer>
@@ -1147,7 +1151,11 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QSpinBox" name="frameDropSpinBox" />
+               <widget class="QSpinBox" name="frameDropSpinBox" >
+                <property name="maximum" >
+                 <number>100</number>
+                </property>
+               </widget>
               </item>
               <item>
                <spacer>
@@ -1205,9 +1213,9 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QSpinBox" name="maxBFramesSpinBox" >
+               <widget class="QSpinBox" name="maxBframesSpinBox" >
                 <property name="maximum" >
-                 <number>16</number>
+                 <number>20</number>
                 </property>
                </widget>
               </item>
@@ -2539,7 +2547,7 @@
   <tabstop>interlacedComboBox</tabstop>
   <tabstop>frameDropSpinBox</tabstop>
   <tabstop>maxIframeIntervalSpinBox</tabstop>
-  <tabstop>maxBFramesSpinBox</tabstop>
+  <tabstop>maxBframesSpinBox</tabstop>
   <tabstop>packedCheckBox</tabstop>
   <tabstop>quantIminSpinBox</tabstop>
   <tabstop>quantImaxSpinBox</tabstop>



From gruntster at mail.berlios.de  Sun Jan  4 18:54:41 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 4 Jan 2009 18:54:41 +0100
Subject: [Avidemux-svn-commit] r4522 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:
	ADM_vidEnc_x264/qt4 ADM_vidEnc_xvid ADM_vidEnc_xvid/qt4
Message-ID: <200901041754.n04Hsfm6013626@sheep.berlios.de>

Author: gruntster
Date: 2009-01-04 18:54:30 +0100 (Sun, 04 Jan 2009)
New Revision: 4522

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] hook up Quantiser tab for Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-04 17:54:30 UTC (rev 4522)
@@ -135,6 +135,8 @@
 				connect(widget, SIGNAL(currentIndexChanged(int)), this, SLOT(generic_currentIndexChanged(int)));
 			else if (widget->inherits("QSpinBox"))
 				connect(widget, SIGNAL(valueChanged(int)), this, SLOT(generic_valueChanged(int)));
+			else if (widget->inherits("QDoubleSpinBox"))
+				connect(widget, SIGNAL(valueChanged(double)), this, SLOT(generic_valueChanged(double)));
 			else if (widget->inherits("QAbstractButton"))
 				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
 			else if (widget->inherits("QLineEdit"))
@@ -225,6 +227,12 @@
 		ui.configurationComboBox->setCurrentIndex(1);
 }
 
+void x264ConfigDialog::generic_valueChanged(double value)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
 void x264ConfigDialog::generic_pressed(void)
 {
 	if (!disableGenericSlots)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2009-01-04 17:54:30 UTC (rev 4522)
@@ -59,6 +59,7 @@
 private slots:
 	void generic_currentIndexChanged(int index);
 	void generic_valueChanged(int value);
+	void generic_valueChanged(double value);
 	void generic_pressed(void);
 	void generic_textEdited(QString text);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 17:54:30 UTC (rev 4522)
@@ -78,6 +78,7 @@
               <xs:element name="turboMode" type="xs:boolean"/>
               <xs:element name="chromaOptimiser" type="xs:boolean"/>
               <xs:element name="fourMv" type="xs:boolean"/>
+              <xs:element name="cartoon" type="xs:boolean"/>
               <xs:element name="greyscale" type="xs:boolean"/>
               <xs:element name="interlaced">
                 <xs:simpleType>
@@ -96,7 +97,7 @@
                   </xs:restriction>
                 </xs:simpleType>
               </xs:element>
-              <xs:element name="maxIframeInterval" type="xs:integer"/>
+              <xs:element name="maxIframeInterval" type="uint"/>
               <xs:element name="maxBframes">
                 <xs:simpleType>
                   <xs:restriction base="xs:integer">
@@ -105,7 +106,47 @@
                   </xs:restriction>
                 </xs:simpleType>
               </xs:element>
+              <xs:element name="bFrameSensitivity">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="-255"/>
+                    <xs:maxInclusive value="255"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="closedGop" type="xs:boolean"/>
               <xs:element name="packed" type="xs:boolean"/>
+              <xs:element name="quantImin" type="quantiser"/>
+              <xs:element name="quantPmin" type="quantiser"/>
+              <xs:element name="quantBmin" type="quantiser"/>
+              <xs:element name="quantImax" type="quantiser"/>
+              <xs:element name="quantPmax" type="quantiser"/>
+              <xs:element name="quantBmax" type="quantiser"/>
+              <xs:element name="quantBratio">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="0"/>
+                    <xs:maxInclusive value="200"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="quantBoffset">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="0"/>
+                    <xs:maxInclusive value="200"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="quantType">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="h.263"/>
+                    <xs:enumeration value="mpeg"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="trellis" type="xs:boolean"/>
             </xs:sequence>
           </xs:complexType>
         </xs:element>
@@ -118,12 +159,6 @@
       <xs:minInclusive value="0"/>
     </xs:restriction>
   </xs:simpleType>
-  <xs:simpleType name="uint8">
-    <xs:restriction base="xs:integer">
-      <xs:minInclusive value="0"/>
-      <xs:maxInclusive value="255"/>
-    </xs:restriction>
-  </xs:simpleType>
   <xs:simpleType name="quantiser">
     <xs:restriction base="xs:integer">
       <xs:minInclusive value="1"/>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 17:54:30 UTC (rev 4522)
@@ -66,6 +66,8 @@
 	setRateDistortion(RD_DCT_ME);
 	setMinQuantiser(2, 2, 2);
 	setMaxQuantiser(31, 31, 31);
+	setBframeQuantiserRatio(150);
+	setBframeQuantiserOffset(100);
 
 	_parAsInput = false;
 
@@ -323,6 +325,19 @@
 		xvid_enc_frame.vop_flags &= ~XVID_VOP_INTER4V;
 }
 
+bool XvidOptions::getCartoon(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_CARTOON;
+}
+
+void XvidOptions::setCartoon(bool cartoon)
+{
+	if (cartoon)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_CARTOON;
+}
+
 bool XvidOptions::getGreyscale(void)
 {
 	return xvid_enc_frame.vop_flags & XVID_VOP_GREYSCALE;
@@ -387,69 +402,54 @@
 	xvid_enc_create.max_key_interval = maxKeyInterval;
 }
 
-unsigned int XvidOptions::getMaxBFrames(void)
+unsigned int XvidOptions::getMaxBframes(void)
 {
 	return xvid_enc_create.max_bframes;
 }
 
-void XvidOptions::setMaxBFrames(unsigned int maxBFrames)
+void XvidOptions::setMaxBframes(unsigned int maxBframes)
 {
-	if (maxBFrames <= 20)
-		xvid_enc_create.max_bframes = maxBFrames;
+	if (maxBframes <= 20)
+		xvid_enc_create.max_bframes = maxBframes;
 }
 
-bool XvidOptions::getPacked(void)
+int XvidOptions::getBframeSensitivity(void)
 {
-	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
+	return xvid_enc_frame.bframe_threshold;
 }
 
-void XvidOptions::setPacked(bool packed)
+void XvidOptions::setBframeSensitivity(int bFrameSensitivity)
 {
-	if (packed)
-		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
-	else
-		xvid_enc_create.global &= ~XVID_GLOBAL_PACKED;
+	if (bFrameSensitivity >= -255 && bFrameSensitivity <= 255)
+		xvid_enc_frame.bframe_threshold = bFrameSensitivity;
 }
 
-bool XvidOptions::getMpegQuantisation(void)
+bool XvidOptions::getClosedGop(void)
 {
-	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
+	return xvid_enc_create.global & XVID_GLOBAL_CLOSED_GOP;
 }
 
-void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
+void XvidOptions::setClosedGop(bool closedGop)
 {
-	if (mpegQuantisation)
-		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
+	if (closedGop)
+		xvid_enc_create.global |= XVID_GLOBAL_CLOSED_GOP;
 	else
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
+		xvid_enc_create.global &= ~XVID_GLOBAL_CLOSED_GOP;
 }
 
-bool XvidOptions::getTrellis(void)
+bool XvidOptions::getPacked(void)
 {
-	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
+	return xvid_enc_create.global & XVID_GLOBAL_PACKED;
 }
 
-void XvidOptions::setTrellis(bool trellis)
+void XvidOptions::setPacked(bool packed)
 {
-	if (trellis)
-		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
+	if (packed)
+		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
 	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
+		xvid_enc_create.global &= ~XVID_GLOBAL_PACKED;
 }
 
-bool XvidOptions::getCartoon(void)
-{
-	return xvid_enc_frame.vop_flags & XVID_VOP_CARTOON;
-}
-
-void XvidOptions::setCartoon(bool cartoon)
-{
-	if (cartoon)
-		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
-	else
-		xvid_enc_frame.vop_flags &= ~XVID_VOP_CARTOON;
-}
-
 void XvidOptions::getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
 {
 	*i = xvid_enc_create.min_quant[0];
@@ -459,13 +459,13 @@
 
 void XvidOptions::setMinQuantiser(unsigned int i, unsigned int p, unsigned int b)
 {
-	if (i > 0 && i <= 51)
+	if (i > 0 && i <= 31)
 		xvid_enc_create.min_quant[0] = i;
 
-	if (p > 0 && p <= 51)
+	if (p > 0 && p <= 31)
 		xvid_enc_create.min_quant[1] = p;
 
-	if (b > 0 && b <= 51)
+	if (b > 0 && b <= 31)
 		xvid_enc_create.min_quant[2] = b;
 }
 
@@ -478,29 +478,64 @@
 
 void XvidOptions::setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b)
 {
-	if (i > 0 && i <= 51)
+	if (i > 0 && i <= 31)
 		xvid_enc_create.max_quant[0] = i;
 
-	if (p > 0 && p <= 51)
+	if (p > 0 && p <= 31)
 		xvid_enc_create.max_quant[1] = p;
 
-	if (b > 0 && b <= 51)
+	if (b > 0 && b <= 31)
 		xvid_enc_create.max_quant[2] = b;
 }
 
-bool XvidOptions::getClosedGop(void)
+unsigned int XvidOptions::getBframeQuantiserRatio(void)
 {
-	return xvid_enc_create.global & XVID_GLOBAL_CLOSED_GOP;
+	return xvid_enc_create.bquant_ratio;
 }
 
-void XvidOptions::setClosedGop(bool closedGop)
+void XvidOptions::setBframeQuantiserRatio(unsigned int ratio)
 {
-	if (closedGop)
-		xvid_enc_create.global |= XVID_GLOBAL_CLOSED_GOP;
+	if (ratio <= 200)
+		xvid_enc_create.bquant_ratio = ratio;
+}
+
+unsigned int XvidOptions::getBframeQuantiserOffset(void)
+{
+	return xvid_enc_create.bquant_offset;
+}
+
+void XvidOptions::setBframeQuantiserOffset(unsigned int offset)
+{
+	if (offset <= 200)
+		xvid_enc_create.bquant_offset = offset;
+}
+
+bool XvidOptions::getMpegQuantisation(void)
+{
+	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
+}
+
+void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
+{
+	if (mpegQuantisation)
+		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
 	else
-		xvid_enc_create.global &= ~XVID_GLOBAL_CLOSED_GOP;
+		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
 }
 
+bool XvidOptions::getTrellis(void)
+{
+	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
+}
+
+void XvidOptions::setTrellis(bool trellis)
+{
+	if (trellis)
+		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
+	else
+		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
+}
+
 char* XvidOptions::toXml(void)
 {
 	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)"1.0");
@@ -643,6 +678,7 @@
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"turboMode", boolean2String(xmlBuffer, bufferSize, getTurboMode()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"chromaOptimiser", boolean2String(xmlBuffer, bufferSize, getChromaOptimisation()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"fourMv", boolean2String(xmlBuffer, bufferSize, getInterMotionVector()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"cartoon", boolean2String(xmlBuffer, bufferSize, getCartoon()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"greyscale", boolean2String(xmlBuffer, bufferSize, getGreyscale()));
 
 	switch (getInterlaced())
@@ -661,8 +697,33 @@
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"interlaced", xmlBuffer);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"frameDropRatio", number2String(xmlBuffer, bufferSize, getFrameDropRatio()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxIframeInterval", number2String(xmlBuffer, bufferSize, getMaxKeyInterval()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxBframes", number2String(xmlBuffer, bufferSize, getMaxBFrames()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxBframes", number2String(xmlBuffer, bufferSize, getMaxBframes()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"bFrameSensitivity", number2String(xmlBuffer, bufferSize, getBframeSensitivity()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"closedGop", boolean2String(xmlBuffer, bufferSize, getClosedGop()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"packed", boolean2String(xmlBuffer, bufferSize, getPacked()));
+
+	unsigned int minI, minP, minB;
+	unsigned int maxI, maxP, maxB;
+
+	getMinQuantiser(&minI, &minP, &minB);
+	getMaxQuantiser(&maxI, &maxP, &maxB);
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantImin", number2String(xmlBuffer, bufferSize, minI));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantPmin", number2String(xmlBuffer, bufferSize, minP));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBmin", number2String(xmlBuffer, bufferSize, minB));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantImax", number2String(xmlBuffer, bufferSize, maxI));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantPmax", number2String(xmlBuffer, bufferSize, maxP));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBmax", number2String(xmlBuffer, bufferSize, maxB));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBratio", number2String(xmlBuffer, bufferSize, getBframeQuantiserRatio()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBoffset", number2String(xmlBuffer, bufferSize, getBframeQuantiserOffset()));
+
+	if (getMpegQuantisation())
+		strcpy((char*)xmlBuffer, "mpeg");
+	else
+		strcpy((char*)xmlBuffer, "h.263");
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantType", xmlBuffer);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"trellis", boolean2String(xmlBuffer, bufferSize, getTrellis()));
 }
 
 bool XvidOptions::validateXml(xmlDocPtr doc)
@@ -763,6 +824,9 @@
 
 void XvidOptions::parseXvidOptions(xmlNode *node)
 {
+	int minI = -1, minP = -1, minB = -1;
+	int maxI = -1, maxP = -1, maxB = -1;
+
 	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
 	{
 		if (xmlChild->type == XML_ELEMENT_NODE)
@@ -815,6 +879,8 @@
 				setChromaOptimisation(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "fourMv") == 0)
 				setInterMotionVector(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "cartoon") == 0)
+				setCartoon(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "greyscale") == 0)
 				setGreyscale(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "interlaced") == 0)
@@ -833,13 +899,48 @@
 			else if (strcmp((char*)xmlChild->name, "maxIframeInterval") == 0)
 				setMaxKeyInterval(atoi(content));
 			else if (strcmp((char*)xmlChild->name, "maxBframes") == 0)
-				setMaxBFrames(atoi(content));
+				setMaxBframes(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "bFrameSensitivity") == 0)
+				setBframeSensitivity(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "closedGop") == 0)
+				setClosedGop(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "packed") == 0)
 				setPacked(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "quantImin") == 0)
+				minI = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantPmin") == 0)
+				minP = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantBmin") == 0)
+				minB = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantImax") == 0)
+				maxI = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantPmax") == 0)
+				maxP = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantBmax") == 0)
+				maxB = atoi(content);
+			else if (strcmp((char*)xmlChild->name, "quantBratio") == 0)
+				setBframeQuantiserRatio(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "quantBoffset") == 0)
+				setBframeQuantiserOffset(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "quantType") == 0)
+			{
+				if (strcmp(content, "mpeg") == 0)
+					setMpegQuantisation(true);
+				else
+					setMpegQuantisation(false);
+			}
+			else if (strcmp((char*)xmlChild->name, "trellis") == 0)
+				setTrellis(string2Boolean(content));
 
 			xmlFree(content);
 		}
 	}
+
+	if (minI != -1 && minP != -1 && minB != -1)
+		setMinQuantiser(minI, minP, minB);
+
+	if (maxI != -1 && maxP != -1 && maxB != -1)
+		setMaxQuantiser(maxI, maxP, maxB);
 }
 
 void XvidOptions::parseVuiOptions(xmlNode *node)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 17:54:30 UTC (rev 4522)
@@ -133,6 +133,9 @@
 	bool getInterMotionVector(void);
 	void setInterMotionVector(bool interMotionVector);
 
+	bool getCartoon(void);
+	void setCartoon(bool cartoon);
+
 	bool getGreyscale(void);
 	void setGreyscale(bool greyscale);
 
@@ -145,30 +148,36 @@
 	unsigned int getMaxKeyInterval(void);
 	void setMaxKeyInterval(unsigned int maxKeyInterval);
 
-	unsigned int getMaxBFrames(void);
-	void setMaxBFrames(unsigned int maxBFrames);
+	unsigned int getMaxBframes(void);
+	void setMaxBframes(unsigned int maxBFrames);
 
+	int getBframeSensitivity(void);
+	void setBframeSensitivity(int bFrameSensitivity);
+
+	bool getClosedGop(void);
+	void setClosedGop(bool closedGop);
+
 	bool getPacked(void);
 	void setPacked(bool packed);
 
-	bool getMpegQuantisation(void);
-	void setMpegQuantisation(bool mpegQuantisation);
-
-	bool getTrellis(void);
-	void setTrellis(bool trellis);
-
-	bool getCartoon(void);
-	void setCartoon(bool cartoon);
-
 	void getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMinQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
 	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
 	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
 
-	bool getClosedGop(void);
-	void setClosedGop(bool closedGop);
+	unsigned int getBframeQuantiserRatio(void);
+	void setBframeQuantiserRatio(unsigned int ratio);
 
+	unsigned int getBframeQuantiserOffset(void);
+	void setBframeQuantiserOffset(unsigned int offset);
+
+	bool getMpegQuantisation(void);
+	void setMpegQuantisation(bool mpegQuantisation);
+
+	bool getTrellis(void);
+	void setTrellis(bool trellis);
+
 	virtual char* toXml(void);
 	virtual int fromXml(const char *xml);
 };

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 17:54:30 UTC (rev 4522)
@@ -16,6 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
 ***************************************************************************/
+#include <math.h>
 #include <QtGui/QFileDialog>
 
 #include "../config.h"
@@ -70,6 +71,8 @@
 				connect(widget, SIGNAL(currentIndexChanged(int)), this, SLOT(generic_currentIndexChanged(int)));
 			else if (widget->inherits("QSpinBox"))
 				connect(widget, SIGNAL(valueChanged(int)), this, SLOT(generic_valueChanged(int)));
+			else if (widget->inherits("QDoubleSpinBox"))
+				connect(widget, SIGNAL(valueChanged(double)), this, SLOT(generic_valueChanged(double)));
 			else if (widget->inherits("QAbstractButton"))
 				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
 			else if (widget->inherits("QLineEdit"))
@@ -320,6 +323,12 @@
 		ui.configurationComboBox->setCurrentIndex(1);
 }
 
+void XvidConfigDialog::generic_valueChanged(double value)
+{
+	if (!disableGenericSlots)
+		ui.configurationComboBox->setCurrentIndex(1);
+}
+
 void XvidConfigDialog::generic_pressed(void)
 {
 	if (!disableGenericSlots)
@@ -465,6 +474,7 @@
 	// Frame tab
 	ui.chromaOptimiserCheckBox->setChecked(options->getChromaOptimisation());
 	ui.fourMvCheckBox->setChecked(options->getInterMotionVector());
+	ui.cartoonCheckBox->setChecked(options->getCartoon());
 	ui.greyscaleCheckBox->setChecked(options->getGreyscale());
 
 	ui.interlacedCheckBox->setChecked((options->getInterlaced() != INTERLACED_NONE));
@@ -481,9 +491,36 @@
 
 	ui.frameDropSpinBox->setValue(options->getFrameDropRatio());
 	ui.maxIframeIntervalSpinBox->setValue(options->getMaxKeyInterval());
-	ui.maxBframesSpinBox->setValue(options->getMaxBFrames());
+	ui.maxBframesSpinBox->setValue(options->getMaxBframes());
+	ui.bFrameSensitivitySpinBox->setValue(options->getBframeSensitivity());
+	ui.closedGopCheckBox->setChecked(options->getClosedGop());
 	ui.packedCheckBox->setChecked(options->getPacked());
 
+	// Quantiser tab
+	unsigned int minI, minP, minB;
+	unsigned int maxI, maxP, maxB;
+
+	options->getMinQuantiser(&minI, &minP, &minB);
+	options->getMaxQuantiser(&maxI, &maxP, &maxB);
+
+	ui.quantIminSpinBox->setValue(minI);
+	ui.quantPminSpinBox->setValue(minP);
+	ui.quantBminSpinBox->setValue(minB);
+
+	ui.quantImaxSpinBox->setValue(maxI);
+	ui.quantPmaxSpinBox->setValue(maxP);
+	ui.quantBmaxSpinBox->setValue(maxB);
+
+	ui.quantBratioSpinBox->setValue((float)options->getBframeQuantiserRatio() / 100);
+	ui.quantBoffsetSpinBox->setValue((float)options->getBframeQuantiserOffset() / 100);
+
+	if (options->getMpegQuantisation())
+		ui.quantTypeComboBox->setCurrentIndex(1);
+	else
+		ui.quantTypeComboBox->setCurrentIndex(0);
+
+	ui.trellisCheckBox->setChecked(options->getTrellis());
+
 	disableGenericSlots = origDisableGenericSlots;
 }
 
@@ -581,6 +618,7 @@
 	// Frame tab
 	options->setChromaOptimisation(ui.chromaOptimiserCheckBox->isChecked());
 	options->setInterMotionVector(ui.fourMvCheckBox->isChecked());
+	options->setCartoon(ui.cartoonCheckBox->isChecked());
 	options->setGreyscale(ui.greyscaleCheckBox->isChecked());
 
 	if (ui.interlacedCheckBox->isChecked())
@@ -600,8 +638,18 @@
 
 	options->setFrameDropRatio(ui.frameDropSpinBox->value());
 	options->setMaxKeyInterval(ui.maxIframeIntervalSpinBox->value());
-	options->setMaxBFrames(ui.maxBframesSpinBox->value());
+	options->setMaxBframes(ui.maxBframesSpinBox->value());
+	options->setBframeSensitivity(ui.bFrameSensitivitySpinBox->value());
+	options->setClosedGop(ui.closedGopCheckBox->isChecked());
 	options->setPacked(ui.packedCheckBox->isChecked());
+
+	// Quantiser tab
+	options->setMinQuantiser(ui.quantIminSpinBox->value(), ui.quantPminSpinBox->value(), ui.quantBminSpinBox->value());
+	options->setMaxQuantiser(ui.quantImaxSpinBox->value(), ui.quantPmaxSpinBox->value(), ui.quantBmaxSpinBox->value());
+	options->setBframeQuantiserRatio((unsigned int)floor(ui.quantBratioSpinBox->value() * 100 + .05));
+	options->setBframeQuantiserOffset((unsigned int)floor(ui.quantBoffsetSpinBox->value() * 100 + .05));
+	options->setMpegQuantisation(ui.quantTypeComboBox->currentIndex() == 1);
+	options->setTrellis(ui.trellisCheckBox->isChecked());
 }
 
 QString XvidConfigDialog::getUserConfigDirectory(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-04 17:54:30 UTC (rev 4522)
@@ -36,6 +36,7 @@
 private slots:
 	void generic_currentIndexChanged(int index);
 	void generic_valueChanged(int value);
+	void generic_valueChanged(double value);
 	void generic_pressed(void);
 	void generic_textEdited(QString text);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 14:05:03 UTC (rev 4521)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 17:54:30 UTC (rev 4522)
@@ -7,7 +7,7 @@
     <x>0</x>
     <y>0</y>
     <width>500</width>
-    <height>565</height>
+    <height>550</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -100,8 +100,8 @@
      </property>
      <property name="sizeHint" >
       <size>
-       <width>491</width>
-       <height>16</height>
+       <width>482</width>
+       <height>4</height>
       </size>
      </property>
     </spacer>
@@ -1024,6 +1024,13 @@
            </widget>
           </item>
           <item>
+           <widget class="QCheckBox" name="cartoonCheckBox" >
+            <property name="text" >
+             <string>Cartoon</string>
+            </property>
+           </widget>
+          </item>
+          <item>
            <widget class="QCheckBox" name="greyscaleCheckBox" >
             <property name="text" >
              <string>Greyscale</string>
@@ -1190,21 +1197,54 @@
            <number>6</number>
           </property>
           <item>
-           <layout class="QHBoxLayout" >
+           <layout class="QGridLayout" >
             <property name="margin" >
              <number>0</number>
             </property>
             <property name="spacing" >
              <number>6</number>
             </property>
-            <item>
-             <widget class="QLabel" name="label_31" >
+            <item row="1" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
+              <property name="spacing" >
+               <number>6</number>
+              </property>
+              <item>
+               <widget class="QSpinBox" name="bFrameSensitivitySpinBox" >
+                <property name="maximum" >
+                 <number>255</number>
+                </property>
+                <property name="minimum" >
+                 <number>-255</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="1" column="0" >
+             <widget class="QLabel" name="label_40" >
               <property name="text" >
-               <string>Maximum Consecutive B-frames:</string>
+               <string>B-frame Sensitivity:</string>
               </property>
              </widget>
             </item>
-            <item>
+            <item row="0" column="1" >
              <layout class="QHBoxLayout" >
               <property name="margin" >
                <number>0</number>
@@ -1237,9 +1277,23 @@
               </item>
              </layout>
             </item>
+            <item row="0" column="0" >
+             <widget class="QLabel" name="label_31" >
+              <property name="text" >
+               <string>Maximum Consecutive B-frames:</string>
+              </property>
+             </widget>
+            </item>
            </layout>
           </item>
           <item>
+           <widget class="QCheckBox" name="closedGopCheckBox" >
+            <property name="text" >
+             <string>Closed GOP</string>
+            </property>
+           </widget>
+          </item>
+          <item>
            <widget class="QCheckBox" name="packedCheckBox" >
             <property name="text" >
              <string>Packed Bitstream</string>
@@ -1301,8 +1355,11 @@
                <number>2</number>
               </property>
               <property name="maximum" >
-               <double>31.000000000000000</double>
+               <double>2.000000000000000</double>
               </property>
+              <property name="singleStep" >
+               <double>0.100000000000000</double>
+              </property>
               <property name="value" >
                <double>1.000000000000000</double>
               </property>
@@ -1337,8 +1394,11 @@
                <number>2</number>
               </property>
               <property name="maximum" >
-               <double>31.000000000000000</double>
+               <double>2.000000000000000</double>
               </property>
+              <property name="singleStep" >
+               <double>0.100000000000000</double>
+              </property>
               <property name="value" >
                <double>1.500000000000000</double>
               </property>
@@ -1670,7 +1730,7 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QComboBox" name="comboBox" >
+               <widget class="QComboBox" name="quantTypeComboBox" >
                 <item>
                  <property name="text" >
                   <string>H.263</string>
@@ -2542,12 +2602,15 @@
   <tabstop>turboCheckBox</tabstop>
   <tabstop>chromaOptimiserCheckBox</tabstop>
   <tabstop>fourMvCheckBox</tabstop>
+  <tabstop>cartoonCheckBox</tabstop>
   <tabstop>greyscaleCheckBox</tabstop>
   <tabstop>interlacedCheckBox</tabstop>
   <tabstop>interlacedComboBox</tabstop>
   <tabstop>frameDropSpinBox</tabstop>
   <tabstop>maxIframeIntervalSpinBox</tabstop>
   <tabstop>maxBframesSpinBox</tabstop>
+  <tabstop>bFrameSensitivitySpinBox</tabstop>
+   <tabstop>closedGopCheckBox</tabstop>
   <tabstop>packedCheckBox</tabstop>
   <tabstop>quantIminSpinBox</tabstop>
   <tabstop>quantImaxSpinBox</tabstop>
@@ -2557,7 +2620,7 @@
   <tabstop>quantBmaxSpinBox</tabstop>
   <tabstop>quantBratioSpinBox</tabstop>
   <tabstop>quantBoffsetSpinBox</tabstop>
-  <tabstop>comboBox</tabstop>
+  <tabstop>quantTypeComboBox</tabstop>
   <tabstop>trellisCheckBox</tabstop>
   <tabstop>spinBox</tabstop>
   <tabstop>spinBox_2</tabstop>



From gruntster at mail.berlios.de  Sun Jan  4 19:22:50 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 4 Jan 2009 19:22:50 +0100
Subject: [Avidemux-svn-commit] r4523 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901041822.n04IMojt013277@sheep.berlios.de>

Author: gruntster
Date: 2009-01-04 19:22:40 +0100 (Sun, 04 Jan 2009)
New Revision: 4523

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] hook up Single Pass tab for Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 17:54:30 UTC (rev 4522)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 18:22:40 UTC (rev 4523)
@@ -147,6 +147,22 @@
                 </xs:simpleType>
               </xs:element>
               <xs:element name="trellis" type="xs:boolean"/>
+              <xs:element name="singlePass">
+                <xs:complexType>
+                  <xs:sequence>
+                    <xs:element name="reactionDelayFactor">
+                      <xs:simpleType>
+                        <xs:restriction base="xs:integer">
+                          <xs:minInclusive value="0"/>
+                          <xs:maxInclusive value="100"/>
+                        </xs:restriction>
+                      </xs:simpleType>
+                    </xs:element>
+                    <xs:element name="averagingQuantiserPeriod" type="uint"/>
+                    <xs:element name="smoother" type="uint"/>
+                  </xs:sequence>
+                </xs:complexType>
+              </xs:element>
             </xs:sequence>
           </xs:complexType>
         </xs:element>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 17:54:30 UTC (rev 4522)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 18:22:40 UTC (rev 4523)
@@ -58,6 +58,7 @@
 
 	memset(&xvid_enc_create, 0, sizeof(xvid_enc_create_t));
 	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
+	memset(&xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));	
 
 	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
 
@@ -536,6 +537,37 @@
 		xvid_enc_frame.vop_flags &= ~XVID_VOP_TRELLISQUANT;
 }
 
+unsigned int XvidOptions::getReactionDelayFactor(void)
+{
+	return xvid_plugin_single.reaction_delay_factor;
+}
+
+void XvidOptions::setReactionDelayFactor(unsigned int delayFactor)
+{
+	if (delayFactor <= 100)
+		xvid_plugin_single.reaction_delay_factor = delayFactor;
+}
+
+unsigned int XvidOptions::getAveragingQuantiserPeriod(void)
+{
+	return xvid_plugin_single.averaging_period;
+}
+
+void XvidOptions::setAveragingQuantiserPeriod(unsigned int averagingPeriod)
+{
+		xvid_plugin_single.averaging_period = averagingPeriod;
+}
+
+unsigned int XvidOptions::getSmoother(void)
+{
+	return xvid_plugin_single.buffer;
+}
+
+void XvidOptions::setSmoother(unsigned int smoother)
+{
+		xvid_plugin_single.buffer = smoother;
+}
+
 char* XvidOptions::toXml(void)
 {
 	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)"1.0");
@@ -670,7 +702,6 @@
 	}
 
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"rdo", xmlBuffer);
-
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"bFrameRdo", boolean2String(xmlBuffer, bufferSize, getBframeRdo()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"chromaMotionEstimation", boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"qPel", boolean2String(xmlBuffer, bufferSize, getQpel()));
@@ -724,6 +755,11 @@
 
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantType", xmlBuffer);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"trellis", boolean2String(xmlBuffer, bufferSize, getTrellis()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"singlePass", NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"reactionDelayFactor", number2String(xmlBuffer, bufferSize, getReactionDelayFactor()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"averagingQuantiserPeriod", number2String(xmlBuffer, bufferSize, getAveragingQuantiserPeriod()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"smoother", number2String(xmlBuffer, bufferSize, getSmoother()));
 }
 
 bool XvidOptions::validateXml(xmlDocPtr doc)
@@ -931,6 +967,8 @@
 			}
 			else if (strcmp((char*)xmlChild->name, "trellis") == 0)
 				setTrellis(string2Boolean(content));
+			else if (strcmp((char*)xmlChild->name, "singlePass") == 0)
+				parseSinglePassOptions(xmlChild);
 
 			xmlFree(content);
 		}
@@ -967,6 +1005,26 @@
 	setPar(width, height);
 }
 
+void XvidOptions::parseSinglePassOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "reactionDelayFactor") == 0)
+				setReactionDelayFactor(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "averagingQuantiserPeriod") == 0)
+				setAveragingQuantiserPeriod(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "smoother") == 0)
+				setSmoother(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
 xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, int number)
 {
 	snprintf((char*)buffer, size, "%d", number);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 17:54:30 UTC (rev 4522)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 18:22:40 UTC (rev 4523)
@@ -67,6 +67,7 @@
 protected:
 	xvid_enc_create_t xvid_enc_create;
 	xvid_enc_frame_t xvid_enc_frame;
+	xvid_plugin_single_t xvid_plugin_single;
 
 	char* _configurationName;
 	ConfigType _configurationType;
@@ -86,6 +87,7 @@
 	void parsePresetConfiguration(xmlNode *node);
 	void parseXvidOptions(xmlNode *node);
 	void parseVuiOptions(xmlNode *node);
+	void parseSinglePassOptions(xmlNode *node);
 
 public:
 	XvidOptions(void);
@@ -178,6 +180,15 @@
 	bool getTrellis(void);
 	void setTrellis(bool trellis);
 
+	unsigned int getReactionDelayFactor(void);
+	void setReactionDelayFactor(unsigned int delayFactor);
+
+	unsigned int getAveragingQuantiserPeriod(void);
+	void setAveragingQuantiserPeriod(unsigned int averagingPeriod);
+
+	unsigned int getSmoother(void);
+	void setSmoother(unsigned int smoother);
+
 	virtual char* toXml(void);
 	virtual int fromXml(const char *xml);
 };

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 17:54:30 UTC (rev 4522)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 18:22:40 UTC (rev 4523)
@@ -261,21 +261,29 @@
 
 	switch (index)
 	{
-		case 0:
+		case 0: // Constant Bitrate - 1 pass
+			ui.singlePassTab->setEnabled(true);
+			ui.twoPassTab->setEnabled(false);
 			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Bitrate:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
 			ui.targetRateControlSpinBox->setValue(lastBitrate);
 			break;
-		case 1: // Constant Quality - 1 pass
+		case 1: // Constant Quantiser - 1 pass
+			ui.singlePassTab->setEnabled(true);
+			ui.twoPassTab->setEnabled(false);
 			ui.quantiserLabel2->setText(QT_TR_NOOP("Quantiser:"));
 			enable = true;
 			break;
 		case 2: // Video Size - 2 pass
+			ui.singlePassTab->setEnabled(false);
+			ui.twoPassTab->setEnabled(true);
 			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Target Video Size:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("MB"));
 			ui.targetRateControlSpinBox->setValue(lastVideoSize);
 			break;
 		case 3: // Average Bitrate - 2 pass
+			ui.singlePassTab->setEnabled(false);
+			ui.twoPassTab->setEnabled(true);
 			ui.targetRateControlLabel1->setText(QT_TR_NOOP("Average Bitrate:"));
 			ui.targetRateControlLabel2->setText(QT_TR_NOOP("kbit/s"));
 			ui.targetRateControlSpinBox->setValue(lastBitrate);
@@ -520,6 +528,9 @@
 		ui.quantTypeComboBox->setCurrentIndex(0);
 
 	ui.trellisCheckBox->setChecked(options->getTrellis());
+	ui.reactionDelaySpinBox->setValue(options->getReactionDelayFactor());
+	ui.averagingQuantiserSpinBox->setValue(options->getAveragingQuantiserPeriod());
+	ui.smootherSpinBox->setValue(options->getSmoother());
 
 	disableGenericSlots = origDisableGenericSlots;
 }
@@ -650,6 +661,11 @@
 	options->setBframeQuantiserOffset((unsigned int)floor(ui.quantBoffsetSpinBox->value() * 100 + .05));
 	options->setMpegQuantisation(ui.quantTypeComboBox->currentIndex() == 1);
 	options->setTrellis(ui.trellisCheckBox->isChecked());
+
+	// Single pass tab
+	options->setReactionDelayFactor(ui.reactionDelaySpinBox->value());
+	options->setAveragingQuantiserPeriod(ui.averagingQuantiserSpinBox->value());
+	options->setSmoother(ui.smootherSpinBox->value());
 }
 
 QString XvidConfigDialog::getUserConfigDirectory(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 17:54:30 UTC (rev 4522)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 18:22:40 UTC (rev 4523)
@@ -1785,7 +1785,7 @@
        </item>
       </layout>
      </widget>
-     <widget class="QWidget" name="tab_3" >
+     <widget class="QWidget" name="singlePassTab" >
       <attribute name="title" >
        <string>Single Pass</string>
       </attribute>
@@ -1838,7 +1838,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_3" >
+             <widget class="QSpinBox" name="smootherSpinBox" >
               <property name="maximum" >
                <number>2147483647</number>
               </property>
@@ -1868,7 +1868,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_2" >
+             <widget class="QSpinBox" name="averagingQuantiserSpinBox" >
               <property name="maximum" >
                <number>2147483647</number>
               </property>
@@ -1898,7 +1898,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox" >
+             <widget class="QSpinBox" name="reactionDelaySpinBox" >
               <property name="maximum" >
                <number>100</number>
               </property>
@@ -1937,7 +1937,7 @@
        </item>
       </layout>
      </widget>
-     <widget class="QWidget" name="tab" >
+     <widget class="QWidget" name="twoPassTab" >
       <attribute name="title" >
        <string>Two Pass</string>
       </attribute>
@@ -2610,7 +2610,7 @@
   <tabstop>maxIframeIntervalSpinBox</tabstop>
   <tabstop>maxBframesSpinBox</tabstop>
   <tabstop>bFrameSensitivitySpinBox</tabstop>
-   <tabstop>closedGopCheckBox</tabstop>
+  <tabstop>closedGopCheckBox</tabstop>
   <tabstop>packedCheckBox</tabstop>
   <tabstop>quantIminSpinBox</tabstop>
   <tabstop>quantImaxSpinBox</tabstop>
@@ -2622,9 +2622,9 @@
   <tabstop>quantBoffsetSpinBox</tabstop>
   <tabstop>quantTypeComboBox</tabstop>
   <tabstop>trellisCheckBox</tabstop>
-  <tabstop>spinBox</tabstop>
-  <tabstop>spinBox_2</tabstop>
-  <tabstop>spinBox_3</tabstop>
+  <tabstop>reactionDelaySpinBox</tabstop>
+  <tabstop>averagingQuantiserSpinBox</tabstop>
+  <tabstop>smootherSpinBox</tabstop>
   <tabstop>spinBox_4</tabstop>
   <tabstop>spinBox_5</tabstop>
   <tabstop>spinBox_6</tabstop>



From gruntster at mail.berlios.de  Sun Jan  4 23:43:04 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 4 Jan 2009 23:43:04 +0100
Subject: [Avidemux-svn-commit] r4524 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901042243.n04Mh4ix000841@sheep.berlios.de>

Author: gruntster
Date: 2009-01-04 23:42:57 +0100 (Sun, 04 Jan 2009)
New Revision: 4524

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] hook up Two Pass tab for Qt options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 18:22:40 UTC (rev 4523)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-04 22:42:57 UTC (rev 4524)
@@ -89,14 +89,7 @@
                   </xs:restriction>
                 </xs:simpleType>
               </xs:element>
-              <xs:element name="frameDropRatio">
-                <xs:simpleType>
-                  <xs:restriction base="xs:integer">
-                    <xs:minInclusive value="0"/>
-                    <xs:maxInclusive value="100"/>
-                  </xs:restriction>
-                </xs:simpleType>
-              </xs:element>
+              <xs:element name="frameDropRatio" type="percentage" />
               <xs:element name="maxIframeInterval" type="uint"/>
               <xs:element name="maxBframes">
                 <xs:simpleType>
@@ -150,16 +143,47 @@
               <xs:element name="singlePass">
                 <xs:complexType>
                   <xs:sequence>
-                    <xs:element name="reactionDelayFactor">
+                    <xs:element name="reactionDelayFactor" type="percentage" />
+                    <xs:element name="averagingQuantiserPeriod" type="uint"/>
+                    <xs:element name="smoother" type="uint"/>
+                  </xs:sequence>
+                </xs:complexType>
+              </xs:element>
+              <xs:element name="twoPass">
+                <xs:complexType>
+                  <xs:sequence>
+                    <xs:element name="keyFrameBoost" type="percentage" />
+                    <xs:element name="maxKeyFrameReduceBitrate" type="percentage" />
+                    <xs:element name="keyFrameBitrateThreshold" type="uint"/>
+                    <xs:element name="overflowControlStrength" type="percentage" />
+                    <xs:element name="maxOverflowImprovement" type="percentage" />
+                    <xs:element name="maxOverflowDegradation" type="percentage" />
+                    <xs:element name="aboveAverageCurveCompression" type="percentage" />
+                    <xs:element name="belowAverageCurveCompression" type="percentage" />
+                    <xs:element name="vbvBufferSize">
                       <xs:simpleType>
                         <xs:restriction base="xs:integer">
                           <xs:minInclusive value="0"/>
-                          <xs:maxInclusive value="100"/>
+                          <xs:maxInclusive value="6291456"/>
                         </xs:restriction>
                       </xs:simpleType>
                     </xs:element>
-                    <xs:element name="averagingQuantiserPeriod" type="uint"/>
-                    <xs:element name="smoother" type="uint"/>
+                    <xs:element name="maxVbvBitrate">
+                      <xs:simpleType>
+                        <xs:restriction base="xs:integer">
+                          <xs:minInclusive value="0"/>
+                          <xs:maxInclusive value="9708400"/>
+                        </xs:restriction>
+                      </xs:simpleType>
+                    </xs:element>
+                    <xs:element name="vbvPeakBitrate">
+                      <xs:simpleType>
+                        <xs:restriction base="xs:integer">
+                          <xs:minInclusive value="0"/>
+                          <xs:maxInclusive value="16000000"/>
+                        </xs:restriction>
+                      </xs:simpleType>
+                    </xs:element>
                   </xs:sequence>
                 </xs:complexType>
               </xs:element>
@@ -169,12 +193,17 @@
       </xs:sequence>
     </xs:complexType>
   </xs:element>
-
   <xs:simpleType name="uint">
     <xs:restriction base="xs:integer">
       <xs:minInclusive value="0"/>
     </xs:restriction>
   </xs:simpleType>
+  <xs:simpleType name="percentage">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="0"/>
+      <xs:maxInclusive value="100"/>
+    </xs:restriction>
+  </xs:simpleType>
   <xs:simpleType name="quantiser">
     <xs:restriction base="xs:integer">
       <xs:minInclusive value="1"/>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 18:22:40 UTC (rev 4523)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 22:42:57 UTC (rev 4524)
@@ -58,7 +58,8 @@
 
 	memset(&xvid_enc_create, 0, sizeof(xvid_enc_create_t));
 	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
-	memset(&xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));	
+	memset(&xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));
+	memset(&xvid_plugin_2pass2, 0, sizeof(xvid_plugin_2pass2_t));
 
 	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
 
@@ -69,6 +70,9 @@
 	setMaxQuantiser(31, 31, 31);
 	setBframeQuantiserRatio(150);
 	setBframeQuantiserOffset(100);
+	setOverflowControlStrength(5);
+	setMaxOverflowImprovement(5);
+	setMaxOverflowDegradation(5);
 
 	_parAsInput = false;
 
@@ -568,6 +572,129 @@
 		xvid_plugin_single.buffer = smoother;
 }
 
+unsigned int XvidOptions::getKeyFrameBoost(void)
+{
+	return xvid_plugin_2pass2.keyframe_boost;
+}
+
+void XvidOptions::setKeyFrameBoost(unsigned int keyFrameBoost)
+{
+	if (keyFrameBoost <= 100)
+		xvid_plugin_2pass2.keyframe_boost = keyFrameBoost;
+}
+
+unsigned int XvidOptions::getMaxKeyFrameReduceBitrate(void)
+{
+	return xvid_plugin_2pass2.kfreduction;
+}
+
+void XvidOptions::setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction)
+{
+	if (bitrateReduction <= 100)
+		xvid_plugin_2pass2.kfreduction = bitrateReduction;
+}
+
+unsigned int XvidOptions::getKeyFrameBitrateThreshold(void)
+{
+	return xvid_plugin_2pass2.kfthreshold;
+}
+
+void XvidOptions::setKeyFrameBitrateThreshold(unsigned int bitrateThreshold)
+{
+	xvid_plugin_2pass2.kfthreshold = bitrateThreshold;
+}
+
+unsigned int XvidOptions::getOverflowControlStrength(void)
+{
+	return xvid_plugin_2pass2.overflow_control_strength;
+}
+
+void XvidOptions::setOverflowControlStrength(unsigned int overflowControlStrength)
+{
+	if (overflowControlStrength <= 100)
+		xvid_plugin_2pass2.overflow_control_strength = overflowControlStrength;
+}
+
+unsigned int XvidOptions::getMaxOverflowImprovement(void)
+{
+	return xvid_plugin_2pass2.max_overflow_improvement;
+}
+
+void XvidOptions::setMaxOverflowImprovement(unsigned int overflowImprovement)
+{
+	if (overflowImprovement <= 100)
+		xvid_plugin_2pass2.max_overflow_improvement = overflowImprovement;
+}
+
+unsigned int XvidOptions::getMaxOverflowDegradation(void)
+{
+	return xvid_plugin_2pass2.max_overflow_degradation;
+}
+
+void XvidOptions::setMaxOverflowDegradation(unsigned int overflowDegradation)
+{
+	if (overflowDegradation <= 100)
+		xvid_plugin_2pass2.max_overflow_degradation = overflowDegradation;
+}
+
+unsigned int XvidOptions::getAboveAverageCurveCompression(void)
+{
+	return xvid_plugin_2pass2.curve_compression_high;
+}
+
+void XvidOptions::setAboveAverageCurveCompression(unsigned int curveCompression)
+{
+	if (curveCompression <= 100)
+		xvid_plugin_2pass2.curve_compression_high = curveCompression;
+}
+
+unsigned int XvidOptions::getBelowAverageCurveCompression(void)
+{
+	return xvid_plugin_2pass2.curve_compression_low;
+}
+
+void XvidOptions::setBelowAverageCurveCompression(unsigned int curveCompression)
+{
+	if (curveCompression <= 100)
+		xvid_plugin_2pass2.curve_compression_low = curveCompression;
+}
+
+unsigned int XvidOptions::getVbvBufferSize(void)
+{
+	return xvid_plugin_2pass2.vbv_size;
+}
+
+void XvidOptions::setVbvBufferSize(unsigned int bufferSize)
+{
+	if (bufferSize <= 6291456)
+	{
+		xvid_plugin_2pass2.vbv_size = bufferSize;
+		xvid_plugin_2pass2.vbv_initial = (bufferSize * 3) >> 2;
+	}
+}
+
+unsigned int XvidOptions::getMaxVbvBitrate(void)
+{
+	return xvid_plugin_2pass2.vbv_maxrate;
+}
+
+void XvidOptions::setMaxVbvBitrate(unsigned int bitrate)
+{
+	if (bitrate <= 9708400)
+		xvid_plugin_2pass2.vbv_maxrate = bitrate;
+}
+
+unsigned int XvidOptions::getVbvPeakBitrate(void)
+{
+	return xvid_plugin_2pass2.vbv_peakrate;
+}
+
+void XvidOptions::setVbvPeakBitrate(unsigned int peakBitrate)
+{
+	if (peakBitrate <= 16000000)
+		xvid_plugin_2pass2.vbv_peakrate = peakBitrate;
+}
+
 char* XvidOptions::toXml(void)
 {
 	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)"1.0");
@@ -760,6 +887,19 @@
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"reactionDelayFactor", number2String(xmlBuffer, bufferSize, getReactionDelayFactor()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"averagingQuantiserPeriod", number2String(xmlBuffer, bufferSize, getAveragingQuantiserPeriod()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"smoother", number2String(xmlBuffer, bufferSize, getSmoother()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"twoPass", NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"keyFrameBoost", number2String(xmlBuffer, bufferSize, getKeyFrameBoost()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"maxKeyFrameReduceBitrate", number2String(xmlBuffer, bufferSize, getMaxKeyFrameReduceBitrate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"keyFrameBitrateThreshold", number2String(xmlBuffer, bufferSize, getKeyFrameBitrateThreshold()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"overflowControlStrength", number2String(xmlBuffer, bufferSize, getOverflowControlStrength()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"maxOverflowImprovement", number2String(xmlBuffer, bufferSize, getMaxOverflowImprovement()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"maxOverflowDegradation", number2String(xmlBuffer, bufferSize, getMaxOverflowDegradation()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"aboveAverageCurveCompression", number2String(xmlBuffer, bufferSize, getAboveAverageCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"belowAverageCurveCompression", number2String(xmlBuffer, bufferSize, getBelowAverageCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"vbvBufferSize", number2String(xmlBuffer, bufferSize, getVbvBufferSize()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"maxVbvBitrate", number2String(xmlBuffer, bufferSize, getMaxVbvBitrate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"vbvPeakBitrate", number2String(xmlBuffer, bufferSize, getVbvPeakBitrate()));
 }
 
 bool XvidOptions::validateXml(xmlDocPtr doc)
@@ -969,6 +1109,8 @@
 				setTrellis(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "singlePass") == 0)
 				parseSinglePassOptions(xmlChild);
+			else if (strcmp((char*)xmlChild->name, "twoPass") == 0)
+				parseTwoPassOptions(xmlChild);
 
 			xmlFree(content);
 		}
@@ -1025,6 +1167,42 @@
 	}
 }
 
+void XvidOptions::parseTwoPassOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "keyFrameBoost") == 0)
+				setKeyFrameBoost(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxKeyFrameReduceBitrate") == 0)
+				setMaxKeyFrameReduceBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "keyFrameBitrateThreshold") == 0)
+				setKeyFrameBitrateThreshold(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "overflowControlStrength") == 0)
+				setOverflowControlStrength(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxOverflowImprovement") == 0)
+				setMaxOverflowImprovement(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxOverflowDegradation") == 0)
+				setMaxOverflowDegradation(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "aboveAverageCurveCompression") == 0)
+				setAboveAverageCurveCompression(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "belowAverageCurveCompression") == 0)
+				setBelowAverageCurveCompression(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "vbvBufferSize") == 0)
+				setVbvBufferSize(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "maxVbvBitrate") == 0)
+				setMaxVbvBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "vbvPeakBitrate") == 0)
+				setVbvPeakBitrate(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
 xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, int number)
 {
 	snprintf((char*)buffer, size, "%d", number);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 18:22:40 UTC (rev 4523)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 22:42:57 UTC (rev 4524)
@@ -68,6 +68,7 @@
 	xvid_enc_create_t xvid_enc_create;
 	xvid_enc_frame_t xvid_enc_frame;
 	xvid_plugin_single_t xvid_plugin_single;
+	xvid_plugin_2pass2_t xvid_plugin_2pass2;
 
 	char* _configurationName;
 	ConfigType _configurationType;
@@ -88,6 +89,7 @@
 	void parseXvidOptions(xmlNode *node);
 	void parseVuiOptions(xmlNode *node);
 	void parseSinglePassOptions(xmlNode *node);
+	void parseTwoPassOptions(xmlNode *node);
 
 public:
 	XvidOptions(void);
@@ -189,6 +191,39 @@
 	unsigned int getSmoother(void);
 	void setSmoother(unsigned int smoother);
 
+	unsigned int getKeyFrameBoost(void);
+	void setKeyFrameBoost(unsigned int keyFrameBoost);
+
+	unsigned int getMaxKeyFrameReduceBitrate(void);
+	void setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction);
+
+	unsigned int getKeyFrameBitrateThreshold(void);
+	void setKeyFrameBitrateThreshold(unsigned int bitrateThreshold);
+
+	unsigned int getOverflowControlStrength(void);
+	void setOverflowControlStrength(unsigned int overflowControlStrength);
+
+	unsigned int getMaxOverflowImprovement(void);
+	void setMaxOverflowImprovement(unsigned int overflowImprovement);
+
+	unsigned int getMaxOverflowDegradation(void);
+	void setMaxOverflowDegradation(unsigned int overflowDegradation);
+
+	unsigned int getAboveAverageCurveCompression(void);
+	void setAboveAverageCurveCompression(unsigned int curveCompression);
+
+	unsigned int getBelowAverageCurveCompression(void);
+	void setBelowAverageCurveCompression(unsigned int curveCompression);
+
+	unsigned int getVbvBufferSize(void);
+	void setVbvBufferSize(unsigned int bufferSize);
+
+	unsigned int getMaxVbvBitrate(void);
+	void setMaxVbvBitrate(unsigned int bitrate);
+
+	unsigned int getVbvPeakBitrate(void);
+	void setVbvPeakBitrate(unsigned int peakBitrate);
+
 	virtual char* toXml(void);
 	virtual int fromXml(const char *xml);
 };

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 18:22:40 UTC (rev 4523)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-04 22:42:57 UTC (rev 4524)
@@ -528,10 +528,25 @@
 		ui.quantTypeComboBox->setCurrentIndex(0);
 
 	ui.trellisCheckBox->setChecked(options->getTrellis());
+
+	// Single pass tab
 	ui.reactionDelaySpinBox->setValue(options->getReactionDelayFactor());
 	ui.averagingQuantiserSpinBox->setValue(options->getAveragingQuantiserPeriod());
 	ui.smootherSpinBox->setValue(options->getSmoother());
 
+	// Two pass tab
+	ui.keyFrameBoostSpinBox->setValue(options->getKeyFrameBoost());
+	ui.maxKeyFrameReduceBitrateSpinBox->setValue(options->getMaxKeyFrameReduceBitrate());
+	ui.keyFrameBitrateThresholdSpinBox->setValue(options->getKeyFrameBitrateThreshold());
+	ui.overflowStrengthSpinBox->setValue(options->getOverflowControlStrength());
+	ui.maxOverflowImprovmentSpinBox->setValue(options->getMaxOverflowImprovement());
+	ui.maxOverflowDegradationSpinBox->setValue(options->getMaxOverflowDegradation());
+	ui.aboveAvgCurveCompSpinBox->setValue(options->getAboveAverageCurveCompression());
+	ui.belowAvgCurveCompSpinBox->setValue(options->getBelowAverageCurveCompression());
+	ui.vbvBufferSizeSpinBox->setValue(options->getVbvBufferSize());
+	ui.maxVbvBitrateSpinBox->setValue(options->getMaxVbvBitrate());
+	ui.vbvPeakBitrateSpinBox->setValue(options->getVbvPeakBitrate());
+
 	disableGenericSlots = origDisableGenericSlots;
 }
 
@@ -666,6 +681,19 @@
 	options->setReactionDelayFactor(ui.reactionDelaySpinBox->value());
 	options->setAveragingQuantiserPeriod(ui.averagingQuantiserSpinBox->value());
 	options->setSmoother(ui.smootherSpinBox->value());
+
+	// Two pass tab
+	options->setKeyFrameBoost(ui.keyFrameBoostSpinBox->value());
+	options->setMaxKeyFrameReduceBitrate(ui.maxKeyFrameReduceBitrateSpinBox->value());
+	options->setKeyFrameBitrateThreshold(ui.keyFrameBitrateThresholdSpinBox->value());
+	options->setOverflowControlStrength(ui.overflowStrengthSpinBox->value());
+	options->setMaxOverflowImprovement(ui.maxOverflowImprovmentSpinBox->value());
+	options->setMaxOverflowDegradation(ui.maxOverflowDegradationSpinBox->value());
+	options->setAboveAverageCurveCompression(ui.aboveAvgCurveCompSpinBox->value());
+	options->setBelowAverageCurveCompression(ui.belowAvgCurveCompSpinBox->value());
+	options->setVbvBufferSize(ui.vbvBufferSizeSpinBox->value());
+	options->setMaxVbvBitrate(ui.maxVbvBitrateSpinBox->value());
+	options->setVbvPeakBitrate(ui.vbvPeakBitrateSpinBox->value());
 }
 
 QString XvidConfigDialog::getUserConfigDirectory(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 18:22:40 UTC (rev 4523)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-04 22:42:57 UTC (rev 4524)
@@ -1976,7 +1976,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_5" >
+             <widget class="QSpinBox" name="maxKeyFrameReduceBitrateSpinBox" >
               <property name="maximum" >
                <number>100</number>
               </property>
@@ -2016,9 +2016,9 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_4" >
+             <widget class="QSpinBox" name="keyFrameBoostSpinBox" >
               <property name="maximum" >
-               <number>1000</number>
+               <number>100</number>
               </property>
               <property name="value" >
                <number>10</number>
@@ -2070,7 +2070,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_6" >
+             <widget class="QSpinBox" name="keyFrameBitrateThresholdSpinBox" >
               <property name="maximum" >
                <number>2147483647</number>
               </property>
@@ -2125,7 +2125,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_7" >
+             <widget class="QSpinBox" name="overflowStrengthSpinBox" >
               <property name="maximum" >
                <number>100</number>
               </property>
@@ -2172,12 +2172,12 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_9" >
+             <widget class="QSpinBox" name="maxOverflowDegradationSpinBox" >
               <property name="maximum" >
-               <number>80</number>
+               <number>100</number>
               </property>
               <property name="minimum" >
-               <number>1</number>
+               <number>0</number>
               </property>
               <property name="value" >
                <number>5</number>
@@ -2215,12 +2215,12 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_8" >
+             <widget class="QSpinBox" name="maxOverflowImprovmentSpinBox" >
               <property name="maximum" >
-               <number>80</number>
+               <number>100</number>
               </property>
               <property name="minimum" >
-               <number>1</number>
+               <number>0</number>
               </property>
               <property name="value" >
                <number>5</number>
@@ -2294,7 +2294,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_10" >
+             <widget class="QSpinBox" name="aboveAvgCurveCompSpinBox" >
               <property name="maximum" >
                <number>100</number>
               </property>
@@ -2338,7 +2338,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_11" >
+             <widget class="QSpinBox" name="belowAvgCurveCompSpinBox" >
               <property name="maximum" >
                <number>100</number>
               </property>
@@ -2390,7 +2390,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_13" >
+             <widget class="QSpinBox" name="maxVbvBitrateSpinBox" >
               <property name="maximum" >
                <number>9708400</number>
               </property>
@@ -2427,7 +2427,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_12" >
+             <widget class="QSpinBox" name="vbvBufferSizeSpinBox" >
               <property name="maximum" >
                <number>6291456</number>
               </property>
@@ -2485,7 +2485,7 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QSpinBox" name="spinBox_14" >
+             <widget class="QSpinBox" name="vbvPeakBitrateSpinBox" >
               <property name="maximum" >
                <number>16000000</number>
               </property>
@@ -2625,17 +2625,17 @@
   <tabstop>reactionDelaySpinBox</tabstop>
   <tabstop>averagingQuantiserSpinBox</tabstop>
   <tabstop>smootherSpinBox</tabstop>
-  <tabstop>spinBox_4</tabstop>
-  <tabstop>spinBox_5</tabstop>
-  <tabstop>spinBox_6</tabstop>
-  <tabstop>spinBox_7</tabstop>
-  <tabstop>spinBox_8</tabstop>
-  <tabstop>spinBox_9</tabstop>
-  <tabstop>spinBox_10</tabstop>
-  <tabstop>spinBox_11</tabstop>
-  <tabstop>spinBox_12</tabstop>
-  <tabstop>spinBox_13</tabstop>
-  <tabstop>spinBox_14</tabstop>
+  <tabstop>keyFrameBoostSpinBox</tabstop>
+  <tabstop>maxKeyFrameReduceBitrateSpinBox</tabstop>
+  <tabstop>keyFrameBitrateThresholdSpinBox</tabstop>
+  <tabstop>overflowStrengthSpinBox</tabstop>
+  <tabstop>maxOverflowImprovmentSpinBox</tabstop>
+  <tabstop>maxOverflowDegradationSpinBox</tabstop>
+  <tabstop>aboveAvgCurveCompSpinBox</tabstop>
+  <tabstop>belowAvgCurveCompSpinBox</tabstop>
+  <tabstop>vbvBufferSizeSpinBox</tabstop>
+  <tabstop>maxVbvBitrateSpinBox</tabstop>
+  <tabstop>vbvPeakBitrateSpinBox</tabstop>
   <tabstop>okButton</tabstop>
   <tabstop>cancelButton</tabstop>
   <tabstop>configurationComboBox</tabstop>



From gruntster at mail.berlios.de  Wed Jan  7 11:01:53 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 7 Jan 2009 11:01:53 +0100
Subject: [Avidemux-svn-commit] r4525 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_encoder
	plugins/ADM_videoEncoder/ADM_vidEnc_xvid
Message-ID: <200901071001.n07A1r6x022903@sheep.berlios.de>

Author: gruntster
Date: 2009-01-07 11:01:43 +0100 (Wed, 07 Jan 2009)
New Revision: 4525

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
Log:
[xvid] mostly working encoder

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2009-01-07 10:01:43 UTC (rev 4525)
@@ -127,7 +127,7 @@
 
 const char* externalEncoder::getCodecName(void)
 {
-	return _plugin->getEncoderName(_plugin->encoderId);
+	return _plugin->getFourCC(_plugin->encoderId);
 }
 
 const char* externalEncoder::getDisplayName(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-07 10:01:43 UTC (rev 4525)
@@ -1,5 +1,5 @@
 /***************************************************************************
-                               xvidEncoder.cpp
+                               XvidEncoder.cpp
 
     begin                : Wed Jun 11 2008
     copyright            : (C) 2008 by gruntster
@@ -20,55 +20,102 @@
 #include "ADM_inttype.h"
 #include "ADM_files.h"
 #include "encoder.h"
+#include "options.h"
 
-static xvidEncoder encoder;
+int avidemuxHook(void *handle, int opt, void *param1, void *param2);
+static XvidEncoder encoder;
 static void* encoders = { &encoder };
 
 extern "C"
 {
 	void *encoders_getPointer(int uiType) { encoder.setUiType(uiType); return &encoders; } 
-	int xvidEncoder_isConfigurable(void) { return encoder.isConfigurable(); }
-	int xvidEncoder_configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties) { return encoder.configure(configParameters, properties); }
-	int xvidEncoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize) { return encoder.getOptions(encodeOptions, pluginOptions, bufferSize); };
-	int xvidEncoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions) { return encoder.setOptions(encodeOptions, pluginOptions); };
-	int xvidEncoder_getPassCount(void) { return encoder.getPassCount(); }
-	int xvidEncoder_getCurrentPass(void) { return encoder.getCurrentPass(); }
-	int xvidEncoder_open(vidEncVideoProperties *properties) { return encoder.open(properties); }
-	int xvidEncoder_beginPass(vidEncPassParameters *passParameters) { return encoder.beginPass(passParameters); }
-	int xvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams) { return encoder.encodeFrame(encodeParams); }
-	int xvidEncoder_finishPass(void) { return encoder.finishPass(); }
-	void xvidEncoder_close(void) { encoder.close(); }
+	int XvidEncoder_isConfigurable(void) { return encoder.isConfigurable(); }
+	int XvidEncoder_configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties) { return encoder.configure(configParameters, properties); }
+	int XvidEncoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize) { return encoder.getOptions(encodeOptions, pluginOptions, bufferSize); };
+	int XvidEncoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions) { return encoder.setOptions(encodeOptions, pluginOptions); };
+	int XvidEncoder_getPassCount(void) { return encoder.getPassCount(); }
+	int XvidEncoder_getCurrentPass(void) { return encoder.getCurrentPass(); }
+	int XvidEncoder_open(vidEncVideoProperties *properties) { return encoder.open(properties); }
+	int XvidEncoder_beginPass(vidEncPassParameters *passParameters) { return encoder.beginPass(passParameters); }
+	int XvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams) { return encoder.encodeFrame(encodeParams); }
+	int XvidEncoder_finishPass(void) { return encoder.finishPass(); }
+	void XvidEncoder_close(void) { encoder.close(); }
 }
 
-xvidEncoder::xvidEncoder(void)
+#ifdef __WIN32
+extern void convertPathToAnsi(const char *path, char **ansiPath);
+#endif
+
+XvidEncoder::XvidEncoder(void)
 {
 	_loader = NULL;
 	_opened = false;
 
 	_passCount = 1;
 	_currentPass = 0;
+	_openPass = false;
 
+	_logFileName = NULL;
+	_buffer = NULL;
+
 	_encodeOptions.structSize = sizeof(vidEncOptions);
 	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
 	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
+
+	xvid_gbl_init_t xvid_gbl_init;
+	xvid_gbl_info_t xvid_gbl_info;
+
+	memset(&xvid_gbl_init, 0, sizeof(xvid_gbl_init_t));
+	memset(&xvid_gbl_info, 0, sizeof(xvid_gbl_info_t));
+
+	printf ("[Xvid] Initialising Xvid\n");
+
+	xvid_gbl_init.version = XVID_VERSION;
+	xvid_gbl_info.version = XVID_VERSION;
+
+	xvid_global(NULL, XVID_GBL_INIT, &xvid_gbl_init, NULL);	
+	xvid_global(NULL, XVID_GBL_INFO, &xvid_gbl_info, NULL);
+
+	_processors = xvid_gbl_info.num_threads;
+
+	if (xvid_gbl_info.build)
+		printf ("[Xvid] Build: %s\n", xvid_gbl_info.build);
+
+	printf ("[Xvid] SIMD supported: (%x)\n", xvid_gbl_info.cpu_flags);
+
+#define PRINT_CPU_FLAG(x) if (xvid_gbl_info.cpu_flags & XVID_CPU_##x) printf("\t\t"#x"\n");
+
+	PRINT_CPU_FLAG(MMX);
+	PRINT_CPU_FLAG(MMXEXT);
+	PRINT_CPU_FLAG(SSE);
+	PRINT_CPU_FLAG(SSE2);
+	PRINT_CPU_FLAG(SSE3);
+	PRINT_CPU_FLAG(SSE41);
+	PRINT_CPU_FLAG(3DNOW);
+	PRINT_CPU_FLAG(3DNOWEXT);
+	PRINT_CPU_FLAG(ALTIVEC);
 }
 
-xvidEncoder::~xvidEncoder(void)
+XvidEncoder::~XvidEncoder(void)
 {
+	if (_logFileName)
+		delete [] _logFileName;
 
+	if (_buffer)
+		delete [] _buffer;
 }
 
-void xvidEncoder::setUiType(int uiType)
+void XvidEncoder::setUiType(int uiType)
 {
 	_uiType = uiType;
 }
 
-int xvidEncoder::isConfigurable(void)
+int XvidEncoder::isConfigurable(void)
 {
 	return (_uiType == ADM_UI_GTK || _uiType == ADM_UI_QT4);
 }
 
-int xvidEncoder::configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties)
+int XvidEncoder::configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties)
 {
 	if (_loader == NULL)
 	{
@@ -101,7 +148,7 @@
 		return 0;
 }
 
-int xvidEncoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
+int XvidEncoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
 	char* xml = _options.toXml();
 	int xmlLength = strlen(xml);
@@ -119,7 +166,7 @@
 	return xmlLength;
 }
 
-int xvidEncoder::setOptions(vidEncOptions *encodeOptions, char *pluginOptions)
+int XvidEncoder::setOptions(vidEncOptions *encodeOptions, char *pluginOptions)
 {
 	if (_opened)
 		return ADM_VIDENC_ERR_ALREADY_OPEN;
@@ -138,37 +185,318 @@
 		return ADM_VIDENC_ERR_FAILED;
 }
 
-int xvidEncoder::getCurrentPass(void)
+int XvidEncoder::getCurrentPass(void)
 {
 	return _currentPass;
 }
 
-int xvidEncoder::getPassCount(void)
+int XvidEncoder::getPassCount(void)
 {
 	return _passCount;
 }
 
-int xvidEncoder::open(vidEncVideoProperties *properties)
+int XvidEncoder::open(vidEncVideoProperties *properties)
 {
+	if (_opened)
+		return ADM_VIDENC_ERR_ALREADY_OPEN;
 
+	_opened = true;
+	_currentPass = 0;
+	_bufferSize = properties->width * properties->height * 3;
+	_buffer = new uint8_t[_bufferSize];
+
+	memcpy(&_properties, properties, sizeof(vidEncVideoProperties));
+	_properties.logFileName = NULL;
+
+	if (_logFileName)
+		delete [] _logFileName;
+
+#ifdef __WIN32
+	convertPathToAnsi(properties->logFileName, &_logFileName);
+#else
+	_logFileName = new char[strlen(properties->logFileName) + 1];
+	strcpy(_logFileName, properties->logFileName);
+#endif
+
+	if (_options.getParAsInput())
+		_options.setPar(_properties.parWidth, _properties.parHeight);
+
+	updateEncodeParameters(&_properties);
+
+	_xvid_enc_create.width = _properties.width;
+	_xvid_enc_create.height = _properties.height;
+	_xvid_enc_create.fincr = 1000;
+	_xvid_enc_create.fbase = _properties.fps1000;
+
+	if (_options.getThreads() == 0)
+		_xvid_enc_create.num_threads = _processors;
+
+	return ADM_VIDENC_ERR_SUCCESS;
 }
 
-int xvidEncoder::beginPass(vidEncPassParameters *passParameters)
+int XvidEncoder::beginPass(vidEncPassParameters *passParameters)
 {
+	if (!_opened)
+		return ADM_VIDENC_ERR_CLOSED;
 
+	if (_openPass)
+		return ADM_VIDENC_ERR_PASS_ALREADY_OPEN;
+
+	if (_currentPass == _passCount)
+		return ADM_VIDENC_ERR_PASS_COUNT_REACHED;
+
+	_openPass = true;
+	_currentPass++;
+	_currentFrame = 0;
+
+	printf("[Xvid] begin pass %d/%d\n", _currentPass, _passCount);
+
+	if (_passCount > 1)
+	{
+		if (_currentPass == 1)
+		{
+			_xvid_plugin_2pass1.filename = _logFileName;
+			_xvid_enc_plugin[0].func = xvid_plugin_2pass1;
+			_xvid_enc_plugin[0].param = &_xvid_plugin_2pass1;
+
+			printf("[Xvid] writing to %s\n", _logFileName);
+		}
+		else
+		{
+			_xvid_plugin_2pass2.filename = _logFileName;
+			_xvid_enc_plugin[0].func = xvid_plugin_2pass2;
+			_xvid_enc_plugin[0].param = &_xvid_plugin_2pass2;
+
+			printf("[Xvid] reading from %s\n", _logFileName);
+		}
+	}
+	else
+	{
+		_xvid_enc_plugin[0].func = xvid_plugin_single;
+		_xvid_enc_plugin[0].param = &_xvid_plugin_single;
+	}
+
+	_xvid_enc_plugin[1].func = avidemuxHook;
+	_xvid_enc_plugin[1].param = NULL;
+
+	_xvid_enc_create.plugins = _xvid_enc_plugin;
+	_xvid_enc_create.num_plugins = 2;
+
+	int err = xvid_encore(NULL, XVID_ENC_CREATE, &_xvid_enc_create, NULL);
+
+	if (err < 0)
+	{
+		printf ("[Xvid] Init error: %d\n", err);
+
+		return ADM_VIDENC_ERR_FAILED;
+	}
+
+	if (_currentPass == 1)
+	{
+		printEncCreate(&_xvid_enc_create);
+		printEncFrame(&_xvid_enc_frame);
+	}
+
+	return ADM_VIDENC_ERR_SUCCESS;
 }
 
-int xvidEncoder::encodeFrame(vidEncEncodeParameters *encodeParams)
+int XvidEncoder::encodeFrame(vidEncEncodeParameters *encodeParams)
 {
+	xvid_enc_stats_t xvid_enc_stats;
 
+	if (!_opened)
+		return ADM_VIDENC_ERR_CLOSED;
+
+	memset(&xvid_enc_stats, 0, sizeof(xvid_enc_stats_t));
+
+	xvid_enc_stats.version = XVID_VERSION;
+	_xvid_enc_frame.bitstream = _buffer;
+	_xvid_enc_frame.length = 0;
+	_xvid_enc_frame.input.csp = XVID_CSP_YV12;
+	_xvid_enc_frame.input.stride[0] = _xvid_enc_create.width;
+	_xvid_enc_frame.input.stride[1] = _xvid_enc_create.width >> 1;
+	_xvid_enc_frame.input.stride[2] = _xvid_enc_create.width >> 1;
+	_xvid_enc_frame.input.plane[0] = encodeParams->frameData;
+	_xvid_enc_frame.input.plane[1] = encodeParams->frameData + (_xvid_enc_create.width * _xvid_enc_create.height);
+	_xvid_enc_frame.input.plane[2] = encodeParams->frameData + ((_xvid_enc_create.width * _xvid_enc_create.height * 5) >> 2);
+
+	int size = xvid_encore(_xvid_enc_create.handle, XVID_ENC_ENCODE, &_xvid_enc_frame, &xvid_enc_stats);
+
+    if (size < 0)
+    {
+        printf("[Xvid] Error performing encode %d\n", size);
+        return ADM_VIDENC_ERR_FAILED;
+    }
+
+	encodeParams->encodedDataSize = size;
+
+	if (_xvid_enc_frame.out_flags & XVID_KEYFRAME)
+		encodeParams->frameType = ADM_VIDENC_FRAMETYPE_IDR;
+	else if (xvid_enc_stats.type == XVID_TYPE_BVOP)
+		encodeParams->frameType = ADM_VIDENC_FRAMETYPE_B;
+	else
+		encodeParams->frameType = ADM_VIDENC_FRAMETYPE_P;
+
+	encodeParams->quantiser = xvid_enc_stats.quant;
+	encodeParams->ptsFrame= _frameNumber;
+	encodeParams->encodedData = _buffer;
+
+	return ADM_VIDENC_ERR_SUCCESS;
 }
 
-int xvidEncoder::finishPass(void)
+int XvidEncoder::finishPass(void)
 {
+	if (!_opened)
+		return ADM_VIDENC_ERR_CLOSED;
 
+	if (_openPass)
+		_openPass = false;
 }
 
-void xvidEncoder::close(void)
+void XvidEncoder::close(void)
 {
+	if (_openPass)
+		finishPass();
 
+	_opened = false;
+
+	if (_xvid_enc_create.handle)
+	{
+		xvid_encore (_xvid_enc_create.handle, XVID_ENC_DESTROY, NULL, NULL);
+		_xvid_enc_create.handle = NULL;
+	}
+
+	if (_buffer)
+	{
+		delete [] _buffer;
+		_buffer = NULL;
+	}
 }
+
+void XvidEncoder::updateEncodeParameters(vidEncVideoProperties *properties)
+{
+	xvid_enc_create_t *tmp_xvid_enc_create;
+	xvid_enc_frame_t *tmp_xvid_enc_frame;
+	xvid_plugin_single_t *tmp_xvid_plugin_single;
+	xvid_plugin_2pass2_t *tmp_xvid_plugin_2pass2;
+
+	_options.getParameters(&tmp_xvid_enc_create, &tmp_xvid_enc_frame, &tmp_xvid_plugin_single, &tmp_xvid_plugin_2pass2);
+
+	memcpy(&_xvid_enc_create, tmp_xvid_enc_create, sizeof(xvid_enc_create_t));
+	memcpy(&_xvid_enc_frame, tmp_xvid_enc_frame, sizeof(xvid_enc_frame_t));
+	memcpy(&_xvid_plugin_single, tmp_xvid_plugin_single, sizeof(xvid_plugin_single_t));
+	memset(&_xvid_plugin_2pass1, 0, sizeof(xvid_plugin_2pass1_t));
+	memcpy(&_xvid_plugin_2pass2, tmp_xvid_plugin_2pass2, sizeof(xvid_plugin_2pass2_t));
+
+	_xvid_plugin_2pass1.version = XVID_VERSION;
+
+	delete tmp_xvid_enc_create;
+	delete tmp_xvid_enc_frame;
+	delete tmp_xvid_plugin_single;
+	delete tmp_xvid_plugin_2pass2;
+
+	switch (_encodeOptions.encodeMode)
+	{
+		case ADM_VIDENC_MODE_CBR:
+			_passCount = 1;
+			_xvid_plugin_single.bitrate = _encodeOptions.encodeModeParameter * 1000;
+
+			break;
+		case ADM_VIDENC_MODE_CQP:
+			_passCount = 1;
+			//_xvid_plugin_single.bitrate = 1500;
+
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			_passCount = 2;
+			_xvid_plugin_2pass2.bitrate = calculateBitrate(properties->fps1000, properties->frameCount, _encodeOptions.encodeModeParameter);
+
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			_passCount = 2;
+			_xvid_plugin_2pass2.bitrate = _encodeOptions.encodeModeParameter * 1000;
+
+			break;
+	}
+}
+
+unsigned int XvidEncoder::calculateBitrate(unsigned int fps1000, unsigned int frameCount, unsigned int sizeInMb)
+{
+	double db, ti;
+
+	db = sizeInMb;
+	db = db * 1024. * 1024. * 8.;
+	// now db is in bits
+
+	// compute duration
+	ti = frameCount;
+	ti *= 1000;
+	ti /= fps1000;	// nb sec
+	db = db / ti;
+
+	return (unsigned int)floor(db);
+}
+
+void XvidEncoder::setFrameNumber(int frameNumber)
+{
+	_frameNumber = frameNumber;
+}
+
+void XvidEncoder::printEncCreate(xvid_enc_create_t *xvid_enc_create)
+{
+	printf("[Xvid] # xvid_enc_create #\n");
+	printf("[Xvid] version = %d\n", xvid_enc_create->version);
+	printf("[Xvid] profile = %d\n", xvid_enc_create->profile);
+	printf("[Xvid] width = %d, height = %d\n", xvid_enc_create->width, xvid_enc_create->height);
+	printf("[Xvid] num_zones = %d\n", xvid_enc_create->num_zones);
+	printf("[Xvid] num_plugins = %d\n", xvid_enc_create->num_plugins);
+	printf("[Xvid] num_threads = %d\n", xvid_enc_create->num_threads);
+	printf("[Xvid] max_bframes = %d\n", xvid_enc_create->max_bframes);
+	printf("[Xvid] global = %d\n", xvid_enc_create->global);
+	printf("[Xvid] fincr = %d\n", xvid_enc_create->fincr);
+	printf("[Xvid] fbase = %d\n", xvid_enc_create->fbase);
+	printf("[Xvid] max_key_interval = %d\n", xvid_enc_create->max_key_interval);
+	printf("[Xvid] frame_drop_ratio = %d\n", xvid_enc_create->frame_drop_ratio);
+	printf("[Xvid] bquant_ratio = %d\n", xvid_enc_create->bquant_ratio);
+	printf("[Xvid] bquant_offset = %d\n", xvid_enc_create->bquant_offset);
+
+	printf("[Xvid] min_quant = ");
+	printArray(xvid_enc_create->min_quant, 3);
+
+	printf("\n[Xvid] max_quant = ");
+	printArray(xvid_enc_create->max_quant, 3);
+
+	printf("\n");
+}
+
+void XvidEncoder::printEncFrame(xvid_enc_frame_t *xvid_enc_frame)
+{
+	printf("[Xvid] # xvid_enc_frame #\n");
+	printf("[Xvid] version = %d\n", xvid_enc_frame->version);
+	printf("[Xvid] vol_flags = %d\n", xvid_enc_frame->vol_flags);
+	printf("[Xvid] par = %d\n", xvid_enc_frame->par);
+	printf("[Xvid] par_width = %d\n", xvid_enc_frame->par_width);
+	printf("[Xvid] par_height = %d\n", xvid_enc_frame->par_height);
+	printf("[Xvid] fincr = %d\n", xvid_enc_frame->fincr);
+	printf("[Xvid] vop_flags = %d\n", xvid_enc_frame->vop_flags);
+	printf("[Xvid] motion = %d\n", xvid_enc_frame->motion);
+	printf("[Xvid] type = %d\n", xvid_enc_frame->type);
+	printf("[Xvid] quant = %d\n", xvid_enc_frame->quant);
+	printf("[Xvid] bframe_threshold = %d\n", xvid_enc_frame->bframe_threshold);
+}
+
+void XvidEncoder::printArray(const int data[], int size)
+{
+	for (int index = 0; index < size; index++)
+		printf("%d ", data[index]);
+}
+
+int avidemuxHook(void *handle, int opt, void *param1, void *param2)
+{
+	xvid_plg_data_t *xvid_plg_data = (xvid_plg_data_t*)param1;
+
+	if (opt == XVID_PLG_FRAME)
+		encoder.setFrameNumber(xvid_plg_data->frame_num);
+
+	return 0;
+}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-07 10:01:43 UTC (rev 4525)
@@ -25,7 +25,7 @@
 	#include "ADM_vidEnc_plugin.h"
 	}
 
-	class xvidEncoder
+	class XvidEncoder
 	{
 	private:
 		int _uiType;
@@ -33,13 +33,35 @@
 		configGuiLoader *_loader;
 		XvidOptions _options;
 		vidEncOptions _encodeOptions;
+		vidEncVideoProperties _properties;
+		char *_logFileName;
+		int _frameNumber;
+		int _processors;
 
+		uint8_t *_buffer;
+		int _bufferSize;
+
+		xvid_enc_create_t _xvid_enc_create;
+		xvid_enc_frame_t _xvid_enc_frame;
+		xvid_plugin_single_t _xvid_plugin_single;
+		xvid_plugin_2pass1_t _xvid_plugin_2pass1;
+		xvid_plugin_2pass2_t _xvid_plugin_2pass2;
+		xvid_enc_plugin_t _xvid_enc_plugin[2];
+
+		unsigned int _currentFrame;
 		int _currentPass, _passCount;
-		bool _opened;
+		bool _opened, _openPass;
 
+		void updateEncodeParameters(vidEncVideoProperties *properties);
+		unsigned int calculateBitrate(unsigned int fps1000, unsigned int frameCount, unsigned int sizeInMb);
+
+		void printEncCreate(xvid_enc_create_t *xvid_enc_create);
+		void printEncFrame(xvid_enc_frame_t *xvid_enc_frame);
+		void printArray(const int data[], int size);
+
 	public:
-		xvidEncoder(void);
-		~xvidEncoder(void);
+		XvidEncoder(void);
+		~XvidEncoder(void);
 		void setUiType(int uiType);
 		int isConfigurable(void);
 		int configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties);
@@ -52,17 +74,18 @@
 		int encodeFrame(vidEncEncodeParameters *encodeParams);
 		int finishPass(void);
 		void close(void);
+		void setFrameNumber(int frameNumber);
 	};
 #else
 	void *encoders_getPointer(int uiType);
-	int xvidEncoder_isConfigurable(void);
-	int xvidEncoder_configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties);
-	int xvidEncoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
-	int xvidEncoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions);
-	int xvidEncoder_getPassCount(void);
-	int xvidEncoder_getCurrentPass(void);
-	int xvidEncoder_open(vidEncVideoProperties *properties);
-	void xvidEncoder_close(void);
-	int xvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams);
+	int XvidEncoder_isConfigurable(void);
+	int XvidEncoder_configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties);
+	int XvidEncoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+	int XvidEncoder_setOptions(vidEncOptions *encodeOptions, char *pluginOptions);
+	int XvidEncoder_getPassCount(void);
+	int XvidEncoder_getCurrentPass(void);
+	int XvidEncoder_open(vidEncVideoProperties *properties);
+	void XvidEncoder_close(void);
+	int XvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams);
 #endif	// __cplusplus
 #endif	// encoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-01-07 10:01:43 UTC (rev 4525)
@@ -49,7 +49,7 @@
 
 const char* vidEncGetFourCC(int encoderId)
 {
-	return "xvid";
+	return "XVID";
 }
 
 int vidEncGetEncoderApiVersion(int encoderId)
@@ -71,57 +71,57 @@
 
 int vidEncIsConfigurable(int encoderId)
 {
-	return xvidEncoder_isConfigurable();
+	return XvidEncoder_isConfigurable();
 }
 
 int vidEncConfigure(int encoderId, vidEncConfigParameters *configParameters, vidEncVideoProperties *properties)
 {
-	return xvidEncoder_configure(configParameters, properties);
+	return XvidEncoder_configure(configParameters, properties);
 }
 
 int vidEncGetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
-	return xvidEncoder_getOptions(encodeOptions, pluginOptions, bufferSize);
+	return XvidEncoder_getOptions(encodeOptions, pluginOptions, bufferSize);
 }
 
 int vidEncSetOptions(int encoderId, vidEncOptions *encodeOptions, char *pluginOptions)
 {
-	return xvidEncoder_setOptions(encodeOptions, pluginOptions);
+	return XvidEncoder_setOptions(encodeOptions, pluginOptions);
 }
 
 int vidEncGetPassCount(int encoderId)
 {
-	return xvidEncoder_getPassCount();
+	return XvidEncoder_getPassCount();
 }
 
 int vidEncGetCurrentPass(int encoderId)
 {
-	return xvidEncoder_getCurrentPass();
+	return XvidEncoder_getCurrentPass();
 }
 
 int vidEncOpen(int encoderId, vidEncVideoProperties *properties)
 {
-	return xvidEncoder_open(properties);
+	return XvidEncoder_open(properties);
 }
 
 int vidEncBeginPass(int encoderId, vidEncPassParameters *passParameters)
 {
-	return xvidEncoder_beginPass(passParameters);
+	return XvidEncoder_beginPass(passParameters);
 }
 
 int vidEncEncodeFrame(int encoderId, vidEncEncodeParameters *encodeParams)
 {
-	return xvidEncoder_encodeFrame(encodeParams);
+	return XvidEncoder_encodeFrame(encodeParams);
 }
 
 int vidEncFinishPass(int encoderId)
 {
-	return xvidEncoder_finishPass();
+	return XvidEncoder_finishPass();
 }
 
 int vidEncClose(int encoderId)
 {
-	xvidEncoder_close();
+	XvidEncoder_close();
 
 	return ADM_VIDENC_ERR_SUCCESS;
 }

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-07 10:01:43 UTC (rev 4525)
@@ -61,6 +61,11 @@
 	memset(&xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));
 	memset(&xvid_plugin_2pass2, 0, sizeof(xvid_plugin_2pass2_t));
 
+	xvid_enc_create.version = XVID_VERSION;
+	xvid_enc_frame.version = XVID_VERSION;
+	xvid_plugin_single.version = XVID_VERSION;
+	xvid_plugin_2pass2.version = XVID_VERSION;
+
 	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
 
 	setPar(1, 1);
@@ -79,6 +84,20 @@
 	setPresetConfiguration("<default>", CONFIG_DEFAULT);
 }
 
+void XvidOptions::getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
+	xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2)
+{
+	*xvid_enc_create = new xvid_enc_create_t;
+	*xvid_enc_frame = new xvid_enc_frame_t;
+	*xvid_plugin_single = new xvid_plugin_single_t;
+	*xvid_plugin_2pass2 = new xvid_plugin_2pass2_t;
+
+	memcpy(*xvid_enc_create, &this->xvid_enc_create, sizeof(xvid_enc_create_t));
+	memcpy(*xvid_enc_frame, &this->xvid_enc_frame, sizeof(xvid_enc_frame_t));
+	memcpy(*xvid_plugin_single, &this->xvid_plugin_single, sizeof(xvid_plugin_single_t));
+	memcpy(*xvid_plugin_2pass2, &this->xvid_plugin_2pass2, sizeof(xvid_plugin_2pass2_t));
+}
+
 void XvidOptions::getPresetConfiguration(char** configurationName, ConfigType *configurationType)
 {
 	if (_configurationName)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-07 10:01:43 UTC (rev 4525)
@@ -97,6 +97,9 @@
 
 	void reset(void);
 
+	void getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
+		xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2);
+
 	void getPresetConfiguration(char** configurationName, ConfigType *configurationType);
 	void setPresetConfiguration(const char* configurationName, ConfigType configurationType);
 	void clearPresetConfiguration(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-01-04 22:42:57 UTC (rev 4524)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-01-07 10:01:43 UTC (rev 4525)
@@ -18,7 +18,8 @@
  *                                                                         *
  ***************************************************************************/
 #include <libxml/parser.h>
-#include "ADM_default.h"
+#include <string.h>
+#include "ADM_inttype.h"
 #include "presetOptions.h"
 
 XvidPresetOptions::XvidPresetOptions(void) : XvidOptions()



From gruntster at mail.berlios.de  Wed Jan  7 20:10:48 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 7 Jan 2009 20:10:48 +0100
Subject: [Avidemux-svn-commit] r4526 - in
	branches/avidemux_2.4_branch/platforms/windows:
	build_scripts/avidemux_2.4 installer
Message-ID: <200901071910.n07JAmmt027175@sheep.berlios.de>

Author: gruntster
Date: 2009-01-07 20:10:42 +0100 (Wed, 07 Jan 2009)
New Revision: 4526

Modified:
   branches/avidemux_2.4_branch/platforms/windows/build_scripts/avidemux_2.4/Package Notes.xml
   branches/avidemux_2.4_branch/platforms/windows/installer/avidemux.nsi
Log:
[Win32] fix installer to create Qt4 shortcuts & update package notes

Modified: branches/avidemux_2.4_branch/platforms/windows/build_scripts/avidemux_2.4/Package Notes.xml
===================================================================
--- branches/avidemux_2.4_branch/platforms/windows/build_scripts/avidemux_2.4/Package Notes.xml	2009-01-07 10:01:43 UTC (rev 4525)
+++ branches/avidemux_2.4_branch/platforms/windows/build_scripts/avidemux_2.4/Package Notes.xml	2009-01-07 19:10:42 UTC (rev 4526)
@@ -1,5 +1,44 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="4508" date="2009-01-01">
+    <comment>Updated x264 to r1069.</comment>
+  </buildentry>
+  <buildentry revision="4502" date="2008-12-27">
+    <comment>Updated GTK+ to version 2.14.6-1.</comment>
+    <comment>Updated Libxml2 to version 2.7.2+.</comment>
+    <comment>Updated x264 to r1062 (patched).</comment>
+    <comment>Updated Xvid to 1.2.1.</comment>    
+  </buildentry>
+  <buildentry revision="4499" date="2008-12-03">
+    <comment>Packaged using NSIS 2.41.</comment>
+    <comment>Updated Avisynth Proxy GUI to version 2.06.</comment>
+    <comment>Updated GLib to version 2.18.3-1.</comment>
+    <comment>Updated GTK+ to version 2.14.5-1.</comment>
+    <comment>Updated Libxml2 to version 2.7.2.</comment>
+    <comment>Updated Pango to version 1.22.2-1.</comment>
+    <comment>Updated Qt to version 4.4.3.</comment>
+    <comment>Updated win_iconv to version 20080403.</comment>
+    <comment>Updated x264 to r1046 (patched).</comment>
+    <comment>Updated Xvid to 1.2.0.</comment>
+  </buildentry>
+  <buildentry revision="4494" date="2008-10-22">
+    <comment>Updated GTK+ to version 2.14.4-1.</comment>
+  </buildentry>
+  <buildentry revision="4486" date="2008-10-18">
+    <comment>Updated GLib to version 2.18.2-1.</comment>
+  </buildentry>
+  <buildentry revision="4473" date="2008-10-15">
+  </buildentry>
+  <buildentry revision="4458" date="2008-10-13">
+  </buildentry>
+  <buildentry revision="4454" date="2008-10-08">
+  </buildentry>
+  <buildentry revision="4445" date="2008-10-06">
+    <comment>Updated x264 to r999 (patched).</comment>
+  </buildentry>
+  <buildentry revision="4435" date="2008-10-02">
+    <comment>Updated x264 to r997 (patched).</comment>
+  </buildentry>
   <buildentry revision="4421" date="2008-09-30">
     <comment>Updated x264 to r995 (patched).</comment>
   </buildentry>
@@ -28,7 +67,7 @@
     <comment>Updated Pango to version 1.20.5-2.</comment>
     <comment>Updated Qt to version 4.4.2.</comment>
     <comment>Updated x264 to r979 (patched).</comment>
-  </buildentry>  
+  </buildentry>
   <buildentry revision="4346" date="2008-09-14">
     <comment>Reverted GTK+ back to original 2.14.1 (Avidemux has now been fixed).</comment>
     <comment>Updated x264 to r968 (patched).</comment>

Modified: branches/avidemux_2.4_branch/platforms/windows/installer/avidemux.nsi
===================================================================
--- branches/avidemux_2.4_branch/platforms/windows/installer/avidemux.nsi	2009-01-07 10:01:43 UTC (rev 4525)
+++ branches/avidemux_2.4_branch/platforms/windows/installer/avidemux.nsi	2009-01-07 19:10:42 UTC (rev 4526)
@@ -688,7 +688,8 @@
 FunctionEnd
 
 Function IsInstallOptionsRequired
-	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end resetOptions
+	!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} end checkQt4
+checkQt4:
 	!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} end resetOptions
 
 resetOptions:



From gruntster at mail.berlios.de  Fri Jan  9 17:24:01 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 9 Jan 2009 17:24:01 +0100
Subject: [Avidemux-svn-commit] r4527 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:
	. qt4
Message-ID: <200901091624.n09GO1fG021380@sheep.berlios.de>

Author: gruntster
Date: 2009-01-09 17:23:44 +0100 (Fri, 09 Jan 2009)
New Revision: 4527

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.ui
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[xvid] support custom matrix

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/XvidParam.xsd	2009-01-09 16:23:44 UTC (rev 4527)
@@ -136,9 +136,24 @@
                   <xs:restriction base="xs:string">
                     <xs:enumeration value="h.263"/>
                     <xs:enumeration value="mpeg"/>
+                    <xs:enumeration value="custom"/>
                   </xs:restriction>
                 </xs:simpleType>
               </xs:element>
+              <xs:element name="intraMatrix">
+                <xs:complexType>
+                  <xs:sequence>
+                    <xs:element name="value" type="uint8" minOccurs="64" maxOccurs="64"/>
+                  </xs:sequence>
+                </xs:complexType>
+              </xs:element>
+              <xs:element name="interMatrix">
+                <xs:complexType>
+                  <xs:sequence>
+                    <xs:element name="value" type="uint8" minOccurs="64" maxOccurs="64"/>
+                  </xs:sequence>
+                </xs:complexType>
+              </xs:element>
               <xs:element name="trellis" type="xs:boolean"/>
               <xs:element name="singlePass">
                 <xs:complexType>
@@ -198,6 +213,12 @@
       <xs:minInclusive value="0"/>
     </xs:restriction>
   </xs:simpleType>
+  <xs:simpleType name="uint8">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="0"/>
+      <xs:maxInclusive value="255"/>
+    </xs:restriction>
+  </xs:simpleType>
   <xs:simpleType name="percentage">
     <xs:restriction base="xs:integer">
       <xs:minInclusive value="0"/>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-09 16:23:44 UTC (rev 4527)
@@ -390,6 +390,22 @@
 
 	_xvid_plugin_2pass1.version = XVID_VERSION;
 
+	if (tmp_xvid_enc_frame->quant_intra_matrix)
+	{
+		memcpy(_intraMatrix, tmp_xvid_enc_frame->quant_intra_matrix, sizeof(unsigned char) * 64);
+		_xvid_enc_frame.quant_intra_matrix = _intraMatrix;
+
+		delete tmp_xvid_enc_frame->quant_intra_matrix;
+	}
+
+	if (tmp_xvid_enc_frame->quant_inter_matrix)
+	{
+		memcpy(_interMatrix, tmp_xvid_enc_frame->quant_inter_matrix, sizeof(unsigned char) * 64);
+		_xvid_enc_frame.quant_inter_matrix = _interMatrix;
+
+		delete tmp_xvid_enc_frame->quant_inter_matrix;
+	}
+
 	delete tmp_xvid_enc_create;
 	delete tmp_xvid_enc_frame;
 	delete tmp_xvid_plugin_single;
@@ -404,7 +420,7 @@
 			break;
 		case ADM_VIDENC_MODE_CQP:
 			_passCount = 1;
-			//_xvid_plugin_single.bitrate = 1500;
+			_xvid_enc_frame.quant = _encodeOptions.encodeModeParameter;
 
 			break;
 		case ADM_VIDENC_MODE_2PASS_SIZE:
@@ -474,7 +490,14 @@
 	printf("[Xvid] # xvid_enc_frame #\n");
 	printf("[Xvid] version = %d\n", xvid_enc_frame->version);
 	printf("[Xvid] vol_flags = %d\n", xvid_enc_frame->vol_flags);
-	printf("[Xvid] par = %d\n", xvid_enc_frame->par);
+
+	printf("[Xvid] quant_intra_matrix = ");
+	printArray(xvid_enc_frame->quant_intra_matrix, 64);
+
+	printf("\n[Xvid] quant_inter_matrix = ");
+	printArray(xvid_enc_frame->quant_inter_matrix, 64);
+
+	printf("\n[Xvid] par = %d\n", xvid_enc_frame->par);
 	printf("[Xvid] par_width = %d\n", xvid_enc_frame->par_width);
 	printf("[Xvid] par_height = %d\n", xvid_enc_frame->par_height);
 	printf("[Xvid] fincr = %d\n", xvid_enc_frame->fincr);
@@ -491,6 +514,12 @@
 		printf("%d ", data[index]);
 }
 
+void XvidEncoder::printArray(const unsigned char data[], int size)
+{
+	for (int index = 0; index < size; index++)
+		printf("%d ", data[index]);
+}
+
 int avidemuxHook(void *handle, int opt, void *param1, void *param2)
 {
 	xvid_plg_data_t *xvid_plg_data = (xvid_plg_data_t*)param1;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2009-01-09 16:23:44 UTC (rev 4527)
@@ -48,6 +48,9 @@
 		xvid_plugin_2pass2_t _xvid_plugin_2pass2;
 		xvid_enc_plugin_t _xvid_enc_plugin[2];
 
+		unsigned char _intraMatrix[64];
+		unsigned char _interMatrix[64];
+
 		unsigned int _currentFrame;
 		int _currentPass, _passCount;
 		bool _opened, _openPass;
@@ -58,6 +61,7 @@
 		void printEncCreate(xvid_enc_create_t *xvid_enc_create);
 		void printEncFrame(xvid_enc_frame_t *xvid_enc_frame);
 		void printArray(const int data[], int size);
+		void printArray(const unsigned char data[], int size);
 
 	public:
 		XvidEncoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-01-09 16:23:44 UTC (rev 4527)
@@ -60,6 +60,8 @@
 	memset(&xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
 	memset(&xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));
 	memset(&xvid_plugin_2pass2, 0, sizeof(xvid_plugin_2pass2_t));
+	memset(&_intraMatrix, 8, sizeof(unsigned char) * 64);
+	memset(&_interMatrix, 1, sizeof(unsigned char) * 64);
 
 	xvid_enc_create.version = XVID_VERSION;
 	xvid_enc_frame.version = XVID_VERSION;
@@ -96,6 +98,15 @@
 	memcpy(*xvid_enc_frame, &this->xvid_enc_frame, sizeof(xvid_enc_frame_t));
 	memcpy(*xvid_plugin_single, &this->xvid_plugin_single, sizeof(xvid_plugin_single_t));
 	memcpy(*xvid_plugin_2pass2, &this->xvid_plugin_2pass2, sizeof(xvid_plugin_2pass2_t));
+
+	if (getCqmPreset() == CQM_CUSTOM)
+	{
+		(*xvid_enc_frame)->quant_intra_matrix = new unsigned char[64];
+		(*xvid_enc_frame)->quant_inter_matrix = new unsigned char[64];
+
+		getIntraMatrix((*xvid_enc_frame)->quant_intra_matrix);
+		getInterMatrix((*xvid_enc_frame)->quant_inter_matrix);
+	}
 }
 
 void XvidOptions::getPresetConfiguration(char** configurationName, ConfigType *configurationType)
@@ -159,10 +170,10 @@
 	if (height > 0)
 		xvid_enc_frame.par_height = height;
 
-	  if (xvid_enc_frame.par_width == xvid_enc_frame.par_height)
-		  xvid_enc_frame.par = XVID_PAR_11_VGA;
-	  else
-		  xvid_enc_frame.par = XVID_PAR_EXT;
+	if (xvid_enc_frame.par_width == xvid_enc_frame.par_height)
+		xvid_enc_frame.par = XVID_PAR_11_VGA;
+	else
+		xvid_enc_frame.par = XVID_PAR_EXT;
 }
 
 MotionEstimationMode XvidOptions::getMotionEstimation(void)
@@ -309,13 +320,9 @@
 void XvidOptions::setTurboMode(bool turboMode)
 {
 	if (turboMode)
-	{
 		xvid_enc_frame.motion |= TURBO_MODE;
-	}
 	else
-	{
 		xvid_enc_frame.motion &= ~TURBO_MODE;
-	}
 }
 
 bool XvidOptions::getChromaOptimisation(void)
@@ -534,19 +541,49 @@
 		xvid_enc_create.bquant_offset = offset;
 }
 
-bool XvidOptions::getMpegQuantisation(void)
+CqmPresetMode XvidOptions::getCqmPreset(void)
 {
-	return xvid_enc_frame.vol_flags & XVID_VOL_MPEGQUANT;
+	return _cqmPreset;
 }
 
-void XvidOptions::setMpegQuantisation(bool mpegQuantisation)
+void XvidOptions::setCqmPreset(CqmPresetMode cqmPreset)
 {
-	if (mpegQuantisation)
-		xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
-	else
-		xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
+	if (cqmPreset == CQM_H263 || cqmPreset == CQM_MPEG || cqmPreset == CQM_CUSTOM)
+	{
+		_cqmPreset = cqmPreset;
+
+		switch (cqmPreset)
+		{
+			case CQM_MPEG:
+			case CQM_CUSTOM:
+				xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
+				break;
+			default:
+				xvid_enc_frame.vol_flags &= ~XVID_VOL_MPEGQUANT;
+		}
+	}
 }
 
+void XvidOptions::getIntraMatrix(unsigned char intra[64])
+{
+	memcpy(intra, _intraMatrix, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::setIntraMatrix(unsigned char intra[64])
+{
+	memcpy(_intraMatrix, intra, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::getInterMatrix(unsigned char inter[64])
+{
+	memcpy(inter, _interMatrix, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::setInterMatrix(unsigned char inter[64])
+{
+	memcpy(_interMatrix, inter, 64 * sizeof(unsigned char));
+}
+
 bool XvidOptions::getTrellis(void)
 {
 	return xvid_enc_frame.vop_flags & XVID_VOP_TRELLISQUANT;
@@ -578,7 +615,7 @@
 
 void XvidOptions::setAveragingQuantiserPeriod(unsigned int averagingPeriod)
 {
-		xvid_plugin_single.averaging_period = averagingPeriod;
+	xvid_plugin_single.averaging_period = averagingPeriod;
 }
 
 unsigned int XvidOptions::getSmoother(void)
@@ -588,7 +625,7 @@
 
 void XvidOptions::setSmoother(unsigned int smoother)
 {
-		xvid_plugin_single.buffer = smoother;
+	xvid_plugin_single.buffer = smoother;
 }
 
 unsigned int XvidOptions::getKeyFrameBoost(void)
@@ -894,12 +931,28 @@
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBratio", number2String(xmlBuffer, bufferSize, getBframeQuantiserRatio()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantBoffset", number2String(xmlBuffer, bufferSize, getBframeQuantiserOffset()));
 
-	if (getMpegQuantisation())
-		strcpy((char*)xmlBuffer, "mpeg");
-	else
-		strcpy((char*)xmlBuffer, "h.263");
+	switch (getCqmPreset())
+	{
+		case CQM_H263:
+			strcpy((char*)xmlBuffer, "h.263");
+		case CQM_MPEG:
+			strcpy((char*)xmlBuffer, "mpeg");
+		case CQM_CUSTOM:
+			strcpy((char*)xmlBuffer, "custom");
+	}
 
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"quantType", xmlBuffer);
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"intraMatrix", NULL);
+
+	for (int i = 0; i < 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"value", number2String(xmlBuffer, bufferSize, _intraMatrix[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"interMatrix", NULL);
+
+	for (int i = 0; i < 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"value", number2String(xmlBuffer, bufferSize, _interMatrix[i]));
+
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"trellis", boolean2String(xmlBuffer, bufferSize, getTrellis()));
 
 	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"singlePass", NULL);
@@ -1120,10 +1173,26 @@
 			else if (strcmp((char*)xmlChild->name, "quantType") == 0)
 			{
 				if (strcmp(content, "mpeg") == 0)
-					setMpegQuantisation(true);
+					setCqmPreset(CQM_MPEG);
+				else if (strcmp(content, "custom") == 0)
+					setCqmPreset(CQM_CUSTOM);
 				else
-					setMpegQuantisation(false);
+					setCqmPreset(CQM_H263);
 			}
+			else if (strcmp((char*)xmlChild->name, "intraMatrix") == 0)
+			{
+				unsigned char intraMatrix[64];
+
+				parseCqmOption(xmlChild, intraMatrix);
+				setIntraMatrix(intraMatrix);
+			}
+			else if (strcmp((char*)xmlChild->name, "interMatrix") == 0)
+			{
+				unsigned char interMatrix[64];
+
+				parseCqmOption(xmlChild, interMatrix);
+				setInterMatrix(interMatrix);
+			}
 			else if (strcmp((char*)xmlChild->name, "trellis") == 0)
 				setTrellis(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "singlePass") == 0)
@@ -1166,6 +1235,24 @@
 	setPar(width, height);
 }
 
+void XvidOptions::parseCqmOption(xmlNode *node, unsigned char matrix[])
+{
+	int index = 0;
+
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			matrix[index] = atoi(content);
+			index++;
+
+			xmlFree(content);
+		}
+	}
+}
+
 void XvidOptions::parseSinglePassOptions(xmlNode *node)
 {
 	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-01-09 16:23:44 UTC (rev 4527)
@@ -62,6 +62,13 @@
 	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
 } RateDistortionMode;
 
+typedef enum
+{
+	CQM_H263,
+	CQM_MPEG,
+	CQM_CUSTOM
+} CqmPresetMode;
+
 class XvidOptions
 {
 protected:
@@ -74,6 +81,8 @@
 	ConfigType _configurationType;
 
 	bool _parAsInput;
+	CqmPresetMode _cqmPreset;
+	unsigned char _intraMatrix[64], _interMatrix[64];
 
 	void cleanUp(void);
 	xmlChar* number2String(xmlChar *buffer, size_t size, int number);
@@ -88,6 +97,7 @@
 	void parsePresetConfiguration(xmlNode *node);
 	void parseXvidOptions(xmlNode *node);
 	void parseVuiOptions(xmlNode *node);
+	void parseCqmOption(xmlNode *node, unsigned char matrix[]);
 	void parseSinglePassOptions(xmlNode *node);
 	void parseTwoPassOptions(xmlNode *node);
 
@@ -179,9 +189,15 @@
 	unsigned int getBframeQuantiserOffset(void);
 	void setBframeQuantiserOffset(unsigned int offset);
 
-	bool getMpegQuantisation(void);
-	void setMpegQuantisation(bool mpegQuantisation);
+	CqmPresetMode getCqmPreset(void);
+	void setCqmPreset(CqmPresetMode cqmPreset);
 
+	void getIntraMatrix(unsigned char intra[64]);
+	void setIntraMatrix(unsigned char intra[64]);
+
+	void getInterMatrix(unsigned char inter[64]);
+	void setInterMatrix(unsigned char inter[64]);
+
 	bool getTrellis(void);
 	void setTrellis(bool trellis);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/CMakeLists.txt	2009-01-09 16:23:44 UTC (rev 4527)
@@ -5,11 +5,11 @@
 
 IF (QT4_FOUND)
 	QT4_WRAP_UI(xvidQt_headers
-		xvidConfigDialog.ui)
+		xvidConfigDialog.ui  xvidCustomMatrixDialog.ui)
 	QT4_WRAP_CPP(xvidQt_source
-		xvidConfigDialog.h)
+		xvidConfigDialog.h  xvidCustomMatrixDialog.h)
 	SET(ADM_vidEnc_xvid_Qt_SRCS
-		${xvidQt_headers} ${xvidQt_source} xvidConfigDialog.cpp)
+		${xvidQt_headers} ${xvidQt_source} xvidConfigDialog.cpp  xvidCustomMatrixDialog.cpp)
 
 	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
 	ADD_LIBRARY(${QT_PLUGIN_NAME} SHARED ${ADM_vidEnc_xvid_Qt_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-01-09 16:23:44 UTC (rev 4527)
@@ -22,6 +22,7 @@
 #include "../config.h"
 #include "../presetOptions.h"
 #include "xvidConfigDialog.h"
+#include "xvidCustomMatrixDialog.h"
 
 #include "ADM_files.h"
 #include "DIA_coreToolkit.h"
@@ -57,6 +58,9 @@
 
 	ui.sarAsInputLabel->setText(QString("%1:%2").arg(properties->parWidth).arg(properties->parHeight));
 
+	// Quantiser tab
+	connect(ui.matrixCustomEditButton, SIGNAL(pressed()), this, SLOT(matrixCustomEditButton_pressed()));
+
 	QWidgetList widgetList = QApplication::allWidgets();
 
 	for (int widgetIndex = 0; widgetIndex < widgetList.size(); widgetIndex++)
@@ -73,8 +77,10 @@
 				connect(widget, SIGNAL(valueChanged(int)), this, SLOT(generic_valueChanged(int)));
 			else if (widget->inherits("QDoubleSpinBox"))
 				connect(widget, SIGNAL(valueChanged(double)), this, SLOT(generic_valueChanged(double)));
-			else if (widget->inherits("QAbstractButton"))
+			else if (widget->inherits("QCheckBox"))
 				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
+			else if (widget->inherits("QRadioButton"))
+				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
 			else if (widget->inherits("QLineEdit"))
 				connect(widget, SIGNAL(textEdited(QString)), this, SLOT(generic_textEdited(QString)));
 		}
@@ -319,6 +325,17 @@
 		lastBitrate = value;
 }
 
+void XvidConfigDialog::matrixCustomEditButton_pressed()
+{
+	XvidCustomMatrixDialog dialog(this, intraMatrix, interMatrix);
+
+	if (dialog.exec() == QDialog::Accepted)
+	{
+		dialog.getMatrix(intraMatrix, interMatrix);
+		ui.configurationComboBox->setCurrentIndex(1);
+	}
+}
+
 void XvidConfigDialog::generic_currentIndexChanged(int index)
 {
 	if (!disableGenericSlots)
@@ -522,11 +539,22 @@
 	ui.quantBratioSpinBox->setValue((float)options->getBframeQuantiserRatio() / 100);
 	ui.quantBoffsetSpinBox->setValue((float)options->getBframeQuantiserOffset() / 100);
 
-	if (options->getMpegQuantisation())
-		ui.quantTypeComboBox->setCurrentIndex(1);
-	else
-		ui.quantTypeComboBox->setCurrentIndex(0);
+	switch (options->getCqmPreset())
+	{
+		case CQM_MPEG:
+			ui.matrixMpegRadioButton->setChecked(true);
+			break;
+		case CQM_CUSTOM:
+			ui.matrixCustomRadioButton->setChecked(true);
+			break;
+		default:
+			ui.matrixH263RadioButton->setChecked(true);
+			break;
+	}
 
+	options->getIntraMatrix(intraMatrix);
+	options->getInterMatrix(interMatrix);
+
 	ui.trellisCheckBox->setChecked(options->getTrellis());
 
 	// Single pass tab
@@ -674,7 +702,18 @@
 	options->setMaxQuantiser(ui.quantImaxSpinBox->value(), ui.quantPmaxSpinBox->value(), ui.quantBmaxSpinBox->value());
 	options->setBframeQuantiserRatio((unsigned int)floor(ui.quantBratioSpinBox->value() * 100 + .05));
 	options->setBframeQuantiserOffset((unsigned int)floor(ui.quantBoffsetSpinBox->value() * 100 + .05));
-	options->setMpegQuantisation(ui.quantTypeComboBox->currentIndex() == 1);
+
+	if (ui.matrixH263RadioButton->isChecked())
+		options->setCqmPreset(CQM_H263);
+	else if (ui.matrixMpegRadioButton->isChecked())
+		options->setCqmPreset(CQM_MPEG);
+	else if (ui.matrixCustomRadioButton->isChecked())
+	{
+		options->setCqmPreset(CQM_CUSTOM);
+		options->setIntraMatrix(intraMatrix);
+		options->setInterMatrix(interMatrix);
+	}
+
 	options->setTrellis(ui.trellisCheckBox->isChecked());
 
 	// Single pass tab

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-01-09 16:23:44 UTC (rev 4527)
@@ -21,6 +21,7 @@
 	int predefinedARs[aspectRatioCount][2];
 
 	int lastBitrate, lastVideoSize;
+	unsigned char intraMatrix[64], interMatrix[64];
 
 	void fillConfigurationComboBox(void);
 	bool selectConfiguration(QString *selectFile, ConfigType configurationType);
@@ -49,5 +50,8 @@
 	void quantiserSlider_valueChanged(int value);
 	void quantiserSpinBox_valueChanged(int value);
 	void targetRateControlSpinBox_valueChanged(int value);
+
+	// Quantiser tab
+	void matrixCustomEditButton_pressed();
 };
 #endif	// XvidConfigDialog_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2009-01-09 16:23:44 UTC (rev 4527)
@@ -1334,370 +1334,387 @@
          <property name="title" >
           <string>Quantiser Control</string>
          </property>
-         <layout class="QGridLayout" >
+         <layout class="QVBoxLayout" >
           <property name="margin" >
            <number>9</number>
           </property>
           <property name="spacing" >
            <number>6</number>
           </property>
-          <item row="7" column="1" >
-           <layout class="QHBoxLayout" >
+          <item>
+           <layout class="QGridLayout" >
             <property name="margin" >
              <number>0</number>
             </property>
             <property name="spacing" >
              <number>6</number>
             </property>
-            <item>
-             <widget class="QDoubleSpinBox" name="quantBoffsetSpinBox" >
-              <property name="decimals" >
-               <number>2</number>
+            <item row="5" column="0" >
+             <widget class="QLabel" name="label_7" >
+              <property name="text" >
+               <string>Maximum B-frame Quantiser:</string>
               </property>
-              <property name="maximum" >
-               <double>2.000000000000000</double>
-              </property>
-              <property name="singleStep" >
-               <double>0.100000000000000</double>
-              </property>
-              <property name="value" >
-               <double>1.000000000000000</double>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="4" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-             </spacer>
+              <item>
+               <widget class="QSpinBox" name="quantBminSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>2</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-           </layout>
-          </item>
-          <item row="6" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QDoubleSpinBox" name="quantBratioSpinBox" >
-              <property name="decimals" >
-               <number>2</number>
+            <item row="1" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="maximum" >
-               <double>2.000000000000000</double>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-              <property name="singleStep" >
-               <double>0.100000000000000</double>
+              <item>
+               <widget class="QSpinBox" name="quantImaxSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>31</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="7" column="0" >
+             <widget class="QLabel" name="label_23" >
+              <property name="text" >
+               <string>B-frame Quantiser Offset:</string>
               </property>
-              <property name="value" >
-               <double>1.500000000000000</double>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="0" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-             </spacer>
+              <item>
+               <widget class="QSpinBox" name="quantIminSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>2</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>47</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-           </layout>
-          </item>
-          <item row="7" column="0" >
-           <widget class="QLabel" name="label_23" >
-            <property name="text" >
-             <string>B-frame Quantiser Offset:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="6" column="0" >
-           <widget class="QLabel" name="label_20" >
-            <property name="text" >
-             <string>B-frame Quantiser Ratio:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="4" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantBminSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
+            <item row="2" column="0" >
+             <widget class="QLabel" name="label_17" >
+              <property name="text" >
+               <string>Minimum P-frame Quantiser:</string>
               </property>
-              <property name="minimum" >
-               <number>1</number>
-              </property>
-              <property name="value" >
-               <number>2</number>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="6" column="0" >
+             <widget class="QLabel" name="label_20" >
+              <property name="text" >
+               <string>B-frame Quantiser Ratio:</string>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
-              </property>
-             </spacer>
+             </widget>
             </item>
-           </layout>
-          </item>
-          <item row="1" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantImaxSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
+            <item row="0" column="0" >
+             <widget class="QLabel" name="label_15" >
+              <property name="text" >
+               <string>Minimum I-frame Quantiser:</string>
               </property>
-              <property name="minimum" >
-               <number>1</number>
-              </property>
-              <property name="value" >
-               <number>31</number>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="3" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-             </spacer>
+              <item>
+               <widget class="QSpinBox" name="quantPmaxSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>31</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-           </layout>
-          </item>
-          <item row="0" column="0" >
-           <widget class="QLabel" name="label_15" >
-            <property name="text" >
-             <string>Minimum I-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="3" column="0" >
-           <widget class="QLabel" name="label_5" >
-            <property name="text" >
-             <string>Maximum P-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="5" column="0" >
-           <widget class="QLabel" name="label_7" >
-            <property name="text" >
-             <string>Maximum B-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="2" column="0" >
-           <widget class="QLabel" name="label_17" >
-            <property name="text" >
-             <string>Minimum P-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="4" column="0" >
-           <widget class="QLabel" name="label_6" >
-            <property name="text" >
-             <string>Minimum B-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="1" column="0" >
-           <widget class="QLabel" name="label_16" >
-            <property name="text" >
-             <string>Maximum I-frame Quantiser:</string>
-            </property>
-           </widget>
-          </item>
-          <item row="3" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantPmaxSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
+            <item row="5" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="minimum" >
-               <number>1</number>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-              <property name="value" >
-               <number>31</number>
+              <item>
+               <widget class="QSpinBox" name="quantBmaxSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>31</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="4" column="0" >
+             <widget class="QLabel" name="label_6" >
+              <property name="text" >
+               <string>Minimum B-frame Quantiser:</string>
               </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="3" column="0" >
+             <widget class="QLabel" name="label_5" >
+              <property name="text" >
+               <string>Maximum P-frame Quantiser:</string>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-           </layout>
-          </item>
-          <item row="5" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantBmaxSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
-              </property>
-              <property name="minimum" >
-               <number>1</number>
-              </property>
-              <property name="value" >
-               <number>31</number>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="2" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-             </spacer>
+              <item>
+               <widget class="QSpinBox" name="quantPminSpinBox" >
+                <property name="maximum" >
+                 <number>31</number>
+                </property>
+                <property name="minimum" >
+                 <number>1</number>
+                </property>
+                <property name="value" >
+                 <number>2</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-           </layout>
-          </item>
-          <item row="0" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantIminSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
+            <item row="7" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="minimum" >
-               <number>1</number>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-              <property name="value" >
-               <number>2</number>
-              </property>
-             </widget>
+              <item>
+               <widget class="QDoubleSpinBox" name="quantBoffsetSpinBox" >
+                <property name="decimals" >
+                 <number>2</number>
+                </property>
+                <property name="maximum" >
+                 <double>2.000000000000000</double>
+                </property>
+                <property name="singleStep" >
+                 <double>0.100000000000000</double>
+                </property>
+                <property name="value" >
+                 <double>1.000000000000000</double>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
+            <item row="6" column="1" >
+             <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizeHint" >
-               <size>
-                <width>47</width>
-                <height>20</height>
-               </size>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-             </spacer>
+              <item>
+               <widget class="QDoubleSpinBox" name="quantBratioSpinBox" >
+                <property name="decimals" >
+                 <number>2</number>
+                </property>
+                <property name="maximum" >
+                 <double>2.000000000000000</double>
+                </property>
+                <property name="singleStep" >
+                 <double>0.100000000000000</double>
+                </property>
+                <property name="value" >
+                 <double>1.500000000000000</double>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer>
+                <property name="orientation" >
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" >
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-           </layout>
-          </item>
-          <item row="2" column="1" >
-           <layout class="QHBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
-            <property name="spacing" >
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QSpinBox" name="quantPminSpinBox" >
-              <property name="maximum" >
-               <number>31</number>
+            <item row="1" column="0" >
+             <widget class="QLabel" name="label_16" >
+              <property name="text" >
+               <string>Maximum I-frame Quantiser:</string>
               </property>
-              <property name="minimum" >
-               <number>1</number>
-              </property>
-              <property name="value" >
-               <number>2</number>
-              </property>
              </widget>
             </item>
-            <item>
-             <spacer>
-              <property name="orientation" >
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeHint" >
-               <size>
-                <width>40</width>
-                <height>20</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
            </layout>
           </item>
+          <item>
+           <widget class="QCheckBox" name="trellisCheckBox" >
+            <property name="text" >
+             <string>Trellis Quantisation</string>
+            </property>
+           </widget>
+          </item>
          </layout>
         </widget>
        </item>
        <item>
         <widget class="QGroupBox" name="groupBox_3" >
          <property name="title" >
-          <string>Quantiser Options</string>
+          <string>Quantisation Matrix</string>
          </property>
          <layout class="QVBoxLayout" >
           <property name="margin" >
@@ -1707,6 +1724,23 @@
            <number>6</number>
           </property>
           <item>
+           <widget class="QRadioButton" name="matrixH263RadioButton" >
+            <property name="text" >
+             <string>H.263 Matrix</string>
+            </property>
+            <property name="checked" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QRadioButton" name="matrixMpegRadioButton" >
+            <property name="text" >
+             <string>MPEG Matrix</string>
+            </property>
+           </widget>
+          </item>
+          <item>
            <layout class="QHBoxLayout" >
             <property name="margin" >
              <number>0</number>
@@ -1715,58 +1749,37 @@
              <number>6</number>
             </property>
             <item>
-             <widget class="QLabel" name="label_2" >
+             <widget class="QRadioButton" name="matrixCustomRadioButton" >
               <property name="text" >
-               <string>Quantisation Type:</string>
+               <string>Custom Matrix</string>
               </property>
              </widget>
             </item>
             <item>
-             <layout class="QHBoxLayout" >
-              <property name="margin" >
-               <number>0</number>
+             <widget class="QPushButton" name="matrixCustomEditButton" >
+              <property name="enabled" >
+               <bool>false</bool>
               </property>
-              <property name="spacing" >
-               <number>6</number>
+              <property name="text" >
+               <string>Edit</string>
               </property>
-              <item>
-               <widget class="QComboBox" name="quantTypeComboBox" >
-                <item>
-                 <property name="text" >
-                  <string>H.263</string>
-                 </property>
-                </item>
-                <item>
-                 <property name="text" >
-                  <string>MPEG</string>
-                 </property>
-                </item>
-               </widget>
-              </item>
-              <item>
-               <spacer>
-                <property name="orientation" >
-                 <enum>Qt::Horizontal</enum>
-                </property>
-                <property name="sizeHint" >
-                 <size>
-                  <width>40</width>
-                  <height>20</height>
-                 </size>
-                </property>
-               </spacer>
-              </item>
-             </layout>
+             </widget>
             </item>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
            </layout>
           </item>
-          <item>
-           <widget class="QCheckBox" name="trellisCheckBox" >
-            <property name="text" >
-             <string>Trellis Quantisation</string>
-            </property>
-           </widget>
-          </item>
          </layout>
         </widget>
        </item>
@@ -2620,8 +2633,11 @@
   <tabstop>quantBmaxSpinBox</tabstop>
   <tabstop>quantBratioSpinBox</tabstop>
   <tabstop>quantBoffsetSpinBox</tabstop>
-  <tabstop>quantTypeComboBox</tabstop>
   <tabstop>trellisCheckBox</tabstop>
+  <tabstop>matrixH263RadioButton</tabstop>
+  <tabstop>matrixMpegRadioButton</tabstop>
+  <tabstop>matrixCustomRadioButton</tabstop>
+  <tabstop>matrixCustomEditButton</tabstop>
   <tabstop>reactionDelaySpinBox</tabstop>
   <tabstop>averagingQuantiserSpinBox</tabstop>
   <tabstop>smootherSpinBox</tabstop>
@@ -2820,5 +2836,21 @@
     </hint>
    </hints>
   </connection>
+  <connection>
+   <sender>matrixCustomRadioButton</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>matrixCustomEditButton</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>85</x>
+     <y>478</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>176</x>
+     <y>479</y>
+    </hint>
+   </hints>
+  </connection>
  </connections>
 </ui>

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp	2009-01-09 16:23:44 UTC (rev 4527)
@@ -0,0 +1,339 @@
+/***************************************************************************
+                 xvidCustomMatrixDialog.cpp  -  description
+                 ------------------------------------------
+
+                      GUI for configuring Xvid matrix
+
+    begin                : Thu Jan 08 2009
+    copyright            : (C) 2009 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "xvidCustomMatrixDialog.h"
+#include "ADM_default.h"
+#include "DIA_fileSel.h"
+#include "DIA_coreToolkit.h"
+
+XvidCustomMatrixDialog::XvidCustomMatrixDialog(QWidget *parent, const unsigned char intra8x8Luma[64], 
+											   const unsigned char inter8x8Luma[64]) : QDialog(parent, Qt::Dialog)
+{
+	ui.setupUi(this);
+
+	connect(ui.loadFileButton, SIGNAL(pressed()), this, SLOT(loadFileButton_pressed()));
+
+	setIntra8x8Luma(intra8x8Luma);
+	setInter8x8Luma(inter8x8Luma);
+}
+
+void XvidCustomMatrixDialog::loadFileButton_pressed()
+{
+	char cqmFileName[1024];
+	unsigned char intra8x8Luma[64], inter8x8Luma[64];
+
+	if (FileSel_SelectRead(QT_TR_NOOP("Select Matrix File"), cqmFileName, 1023, NULL) && ADM_fileExist(cqmFileName))
+		if (parseCqmFile(cqmFileName, intra8x8Luma, inter8x8Luma) == 0)
+		{
+			setIntra8x8Luma(intra8x8Luma);
+			setInter8x8Luma(inter8x8Luma);
+		}
+		else
+			GUI_Error_HIG(QT_TR_NOOP("Read Error"), QT_TR_NOOP("Error reading custom matrix file."));
+}
+
+bool XvidCustomMatrixDialog::parseCqmFile(const char cqmFileName[1024], unsigned char intra8x8Luma[64], unsigned char inter8x8Luma[64])
+{
+	FILE *file = fopen(cqmFileName, "rb");
+	bool result = false;
+
+	if (file)
+	{
+		if (fread(intra8x8Luma, 1, 64, file) == 64)
+		{
+			if (fread(inter8x8Luma, 1, 64, file) != 64)
+				result = false;
+		}
+		else
+			result = false;
+
+		fclose(file);
+	}
+
+	return result;
+}
+
+void XvidCustomMatrixDialog::getMatrix(unsigned char intra8x8Luma[64], unsigned char inter8x8Luma[64])
+{
+	intra8x8Luma[0] = ui.intra8x8Luma1SpinBox->value();
+	intra8x8Luma[1] = ui.intra8x8Luma2SpinBox->value();
+	intra8x8Luma[2] = ui.intra8x8Luma3SpinBox->value();
+	intra8x8Luma[3] = ui.intra8x8Luma4SpinBox->value();
+	intra8x8Luma[4] = ui.intra8x8Luma5SpinBox->value();
+	intra8x8Luma[5] = ui.intra8x8Luma6SpinBox->value();
+	intra8x8Luma[6] = ui.intra8x8Luma7SpinBox->value();
+	intra8x8Luma[7] = ui.intra8x8Luma8SpinBox->value();
+	intra8x8Luma[8] = ui.intra8x8Luma9SpinBox->value();
+	intra8x8Luma[9] = ui.intra8x8Luma10SpinBox->value();
+	intra8x8Luma[10] = ui.intra8x8Luma11SpinBox->value();
+	intra8x8Luma[11] = ui.intra8x8Luma12SpinBox->value();
+	intra8x8Luma[12] = ui.intra8x8Luma13SpinBox->value();
+	intra8x8Luma[13] = ui.intra8x8Luma14SpinBox->value();
+	intra8x8Luma[14] = ui.intra8x8Luma15SpinBox->value();
+	intra8x8Luma[15] = ui.intra8x8Luma16SpinBox->value();
+	intra8x8Luma[16] = ui.intra8x8Luma17SpinBox->value();
+	intra8x8Luma[17] = ui.intra8x8Luma18SpinBox->value();
+	intra8x8Luma[18] = ui.intra8x8Luma19SpinBox->value();
+	intra8x8Luma[19] = ui.intra8x8Luma20SpinBox->value();
+	intra8x8Luma[20] = ui.intra8x8Luma21SpinBox->value();
+	intra8x8Luma[21] = ui.intra8x8Luma22SpinBox->value();
+	intra8x8Luma[22] = ui.intra8x8Luma23SpinBox->value();
+	intra8x8Luma[23] = ui.intra8x8Luma24SpinBox->value();
+	intra8x8Luma[24] = ui.intra8x8Luma25SpinBox->value();
+	intra8x8Luma[25] = ui.intra8x8Luma26SpinBox->value();
+	intra8x8Luma[26] = ui.intra8x8Luma27SpinBox->value();
+	intra8x8Luma[27] = ui.intra8x8Luma28SpinBox->value();
+	intra8x8Luma[28] = ui.intra8x8Luma29SpinBox->value();
+	intra8x8Luma[29] = ui.intra8x8Luma30SpinBox->value();
+	intra8x8Luma[30] = ui.intra8x8Luma31SpinBox->value();
+	intra8x8Luma[31] = ui.intra8x8Luma32SpinBox->value();
+	intra8x8Luma[32] = ui.intra8x8Luma33SpinBox->value();
+	intra8x8Luma[33] = ui.intra8x8Luma34SpinBox->value();
+	intra8x8Luma[34] = ui.intra8x8Luma35SpinBox->value();
+	intra8x8Luma[35] = ui.intra8x8Luma36SpinBox->value();
+	intra8x8Luma[36] = ui.intra8x8Luma37SpinBox->value();
+	intra8x8Luma[37] = ui.intra8x8Luma38SpinBox->value();
+	intra8x8Luma[38] = ui.intra8x8Luma39SpinBox->value();
+	intra8x8Luma[39] = ui.intra8x8Luma40SpinBox->value();
+	intra8x8Luma[40] = ui.intra8x8Luma41SpinBox->value();
+	intra8x8Luma[41] = ui.intra8x8Luma42SpinBox->value();
+	intra8x8Luma[42] = ui.intra8x8Luma43SpinBox->value();
+	intra8x8Luma[43] = ui.intra8x8Luma44SpinBox->value();
+	intra8x8Luma[44] = ui.intra8x8Luma45SpinBox->value();
+	intra8x8Luma[45] = ui.intra8x8Luma46SpinBox->value();
+	intra8x8Luma[46] = ui.intra8x8Luma47SpinBox->value();
+	intra8x8Luma[47] = ui.intra8x8Luma48SpinBox->value();
+	intra8x8Luma[48] = ui.intra8x8Luma49SpinBox->value();
+	intra8x8Luma[49] = ui.intra8x8Luma50SpinBox->value();
+	intra8x8Luma[50] = ui.intra8x8Luma51SpinBox->value();
+	intra8x8Luma[51] = ui.intra8x8Luma52SpinBox->value();
+	intra8x8Luma[52] = ui.intra8x8Luma53SpinBox->value();
+	intra8x8Luma[53] = ui.intra8x8Luma54SpinBox->value();
+	intra8x8Luma[54] = ui.intra8x8Luma55SpinBox->value();
+	intra8x8Luma[55] = ui.intra8x8Luma56SpinBox->value();
+	intra8x8Luma[56] = ui.intra8x8Luma57SpinBox->value();
+	intra8x8Luma[57] = ui.intra8x8Luma58SpinBox->value();
+	intra8x8Luma[58] = ui.intra8x8Luma59SpinBox->value();
+	intra8x8Luma[59] = ui.intra8x8Luma60SpinBox->value();
+	intra8x8Luma[60] = ui.intra8x8Luma61SpinBox->value();
+	intra8x8Luma[61] = ui.intra8x8Luma62SpinBox->value();
+	intra8x8Luma[62] = ui.intra8x8Luma63SpinBox->value();
+	intra8x8Luma[63] = ui.intra8x8Luma64SpinBox->value();
+
+	inter8x8Luma[0] = ui.inter8x8Luma1SpinBox->value();
+	inter8x8Luma[1] = ui.inter8x8Luma2SpinBox->value();
+	inter8x8Luma[2] = ui.inter8x8Luma3SpinBox->value();
+	inter8x8Luma[3] = ui.inter8x8Luma4SpinBox->value();
+	inter8x8Luma[4] = ui.inter8x8Luma5SpinBox->value();
+	inter8x8Luma[5] = ui.inter8x8Luma6SpinBox->value();
+	inter8x8Luma[6] = ui.inter8x8Luma7SpinBox->value();
+	inter8x8Luma[7] = ui.inter8x8Luma8SpinBox->value();
+	inter8x8Luma[8] = ui.inter8x8Luma9SpinBox->value();
+	inter8x8Luma[9] = ui.inter8x8Luma10SpinBox->value();
+	inter8x8Luma[10] = ui.inter8x8Luma11SpinBox->value();
+	inter8x8Luma[11] = ui.inter8x8Luma12SpinBox->value();
+	inter8x8Luma[12] = ui.inter8x8Luma13SpinBox->value();
+	inter8x8Luma[13] = ui.inter8x8Luma14SpinBox->value();
+	inter8x8Luma[14] = ui.inter8x8Luma15SpinBox->value();
+	inter8x8Luma[15] = ui.inter8x8Luma16SpinBox->value();
+	inter8x8Luma[16] = ui.inter8x8Luma17SpinBox->value();
+	inter8x8Luma[17] = ui.inter8x8Luma18SpinBox->value();
+	inter8x8Luma[18] = ui.inter8x8Luma19SpinBox->value();
+	inter8x8Luma[19] = ui.inter8x8Luma20SpinBox->value();
+	inter8x8Luma[20] = ui.inter8x8Luma21SpinBox->value();
+	inter8x8Luma[21] = ui.inter8x8Luma22SpinBox->value();
+	inter8x8Luma[22] = ui.inter8x8Luma23SpinBox->value();
+	inter8x8Luma[23] = ui.inter8x8Luma24SpinBox->value();
+	inter8x8Luma[24] = ui.inter8x8Luma25SpinBox->value();
+	inter8x8Luma[25] = ui.inter8x8Luma26SpinBox->value();
+	inter8x8Luma[26] = ui.inter8x8Luma27SpinBox->value();
+	inter8x8Luma[27] = ui.inter8x8Luma28SpinBox->value();
+	inter8x8Luma[28] = ui.inter8x8Luma29SpinBox->value();
+	inter8x8Luma[29] = ui.inter8x8Luma30SpinBox->value();
+	inter8x8Luma[30] = ui.inter8x8Luma31SpinBox->value();
+	inter8x8Luma[31] = ui.inter8x8Luma32SpinBox->value();
+	inter8x8Luma[32] = ui.inter8x8Luma33SpinBox->value();
+	inter8x8Luma[33] = ui.inter8x8Luma34SpinBox->value();
+	inter8x8Luma[34] = ui.inter8x8Luma35SpinBox->value();
+	inter8x8Luma[35] = ui.inter8x8Luma36SpinBox->value();
+	inter8x8Luma[36] = ui.inter8x8Luma37SpinBox->value();
+	inter8x8Luma[37] = ui.inter8x8Luma38SpinBox->value();
+	inter8x8Luma[38] = ui.inter8x8Luma39SpinBox->value();
+	inter8x8Luma[39] = ui.inter8x8Luma40SpinBox->value();
+	inter8x8Luma[40] = ui.inter8x8Luma41SpinBox->value();
+	inter8x8Luma[41] = ui.inter8x8Luma42SpinBox->value();
+	inter8x8Luma[42] = ui.inter8x8Luma43SpinBox->value();
+	inter8x8Luma[43] = ui.inter8x8Luma44SpinBox->value();
+	inter8x8Luma[44] = ui.inter8x8Luma45SpinBox->value();
+	inter8x8Luma[45] = ui.inter8x8Luma46SpinBox->value();
+	inter8x8Luma[46] = ui.inter8x8Luma47SpinBox->value();
+	inter8x8Luma[47] = ui.inter8x8Luma48SpinBox->value();
+	inter8x8Luma[48] = ui.inter8x8Luma49SpinBox->value();
+	inter8x8Luma[49] = ui.inter8x8Luma50SpinBox->value();
+	inter8x8Luma[50] = ui.inter8x8Luma51SpinBox->value();
+	inter8x8Luma[51] = ui.inter8x8Luma52SpinBox->value();
+	inter8x8Luma[52] = ui.inter8x8Luma53SpinBox->value();
+	inter8x8Luma[53] = ui.inter8x8Luma54SpinBox->value();
+	inter8x8Luma[54] = ui.inter8x8Luma55SpinBox->value();
+	inter8x8Luma[55] = ui.inter8x8Luma56SpinBox->value();
+	inter8x8Luma[56] = ui.inter8x8Luma57SpinBox->value();
+	inter8x8Luma[57] = ui.inter8x8Luma58SpinBox->value();
+	inter8x8Luma[58] = ui.inter8x8Luma59SpinBox->value();
+	inter8x8Luma[59] = ui.inter8x8Luma60SpinBox->value();
+	inter8x8Luma[60] = ui.inter8x8Luma61SpinBox->value();
+	inter8x8Luma[61] = ui.inter8x8Luma62SpinBox->value();
+	inter8x8Luma[62] = ui.inter8x8Luma63SpinBox->value();
+	inter8x8Luma[63] = ui.inter8x8Luma64SpinBox->value();
+}
+
+void XvidCustomMatrixDialog::setIntra8x8Luma(const unsigned char intra8x8Luma[64])
+{
+	ui.intra8x8Luma1SpinBox->setValue(intra8x8Luma[0]);
+	ui.intra8x8Luma2SpinBox->setValue(intra8x8Luma[1]);
+	ui.intra8x8Luma3SpinBox->setValue(intra8x8Luma[2]);
+	ui.intra8x8Luma4SpinBox->setValue(intra8x8Luma[3]);
+	ui.intra8x8Luma5SpinBox->setValue(intra8x8Luma[4]);
+	ui.intra8x8Luma6SpinBox->setValue(intra8x8Luma[5]);
+	ui.intra8x8Luma7SpinBox->setValue(intra8x8Luma[6]);
+	ui.intra8x8Luma8SpinBox->setValue(intra8x8Luma[7]);
+	ui.intra8x8Luma9SpinBox->setValue(intra8x8Luma[8]);
+	ui.intra8x8Luma10SpinBox->setValue(intra8x8Luma[9]);
+	ui.intra8x8Luma11SpinBox->setValue(intra8x8Luma[10]);
+	ui.intra8x8Luma12SpinBox->setValue(intra8x8Luma[11]);
+	ui.intra8x8Luma13SpinBox->setValue(intra8x8Luma[12]);
+	ui.intra8x8Luma14SpinBox->setValue(intra8x8Luma[13]);
+	ui.intra8x8Luma15SpinBox->setValue(intra8x8Luma[14]);
+	ui.intra8x8Luma16SpinBox->setValue(intra8x8Luma[15]);
+	ui.intra8x8Luma17SpinBox->setValue(intra8x8Luma[16]);
+	ui.intra8x8Luma18SpinBox->setValue(intra8x8Luma[17]);
+	ui.intra8x8Luma19SpinBox->setValue(intra8x8Luma[18]);
+	ui.intra8x8Luma20SpinBox->setValue(intra8x8Luma[19]);
+	ui.intra8x8Luma21SpinBox->setValue(intra8x8Luma[20]);
+	ui.intra8x8Luma22SpinBox->setValue(intra8x8Luma[21]);
+	ui.intra8x8Luma23SpinBox->setValue(intra8x8Luma[22]);
+	ui.intra8x8Luma24SpinBox->setValue(intra8x8Luma[23]);
+	ui.intra8x8Luma25SpinBox->setValue(intra8x8Luma[24]);
+	ui.intra8x8Luma26SpinBox->setValue(intra8x8Luma[25]);
+	ui.intra8x8Luma27SpinBox->setValue(intra8x8Luma[26]);
+	ui.intra8x8Luma28SpinBox->setValue(intra8x8Luma[27]);
+	ui.intra8x8Luma29SpinBox->setValue(intra8x8Luma[28]);
+	ui.intra8x8Luma30SpinBox->setValue(intra8x8Luma[29]);
+	ui.intra8x8Luma31SpinBox->setValue(intra8x8Luma[30]);
+	ui.intra8x8Luma32SpinBox->setValue(intra8x8Luma[31]);
+	ui.intra8x8Luma33SpinBox->setValue(intra8x8Luma[32]);
+	ui.intra8x8Luma34SpinBox->setValue(intra8x8Luma[33]);
+	ui.intra8x8Luma35SpinBox->setValue(intra8x8Luma[34]);
+	ui.intra8x8Luma36SpinBox->setValue(intra8x8Luma[35]);
+	ui.intra8x8Luma37SpinBox->setValue(intra8x8Luma[36]);
+	ui.intra8x8Luma38SpinBox->setValue(intra8x8Luma[37]);
+	ui.intra8x8Luma39SpinBox->setValue(intra8x8Luma[38]);
+	ui.intra8x8Luma40SpinBox->setValue(intra8x8Luma[39]);
+	ui.intra8x8Luma41SpinBox->setValue(intra8x8Luma[40]);
+	ui.intra8x8Luma42SpinBox->setValue(intra8x8Luma[41]);
+	ui.intra8x8Luma43SpinBox->setValue(intra8x8Luma[42]);
+	ui.intra8x8Luma44SpinBox->setValue(intra8x8Luma[43]);
+	ui.intra8x8Luma45SpinBox->setValue(intra8x8Luma[44]);
+	ui.intra8x8Luma46SpinBox->setValue(intra8x8Luma[45]);
+	ui.intra8x8Luma47SpinBox->setValue(intra8x8Luma[46]);
+	ui.intra8x8Luma48SpinBox->setValue(intra8x8Luma[47]);
+	ui.intra8x8Luma49SpinBox->setValue(intra8x8Luma[48]);
+	ui.intra8x8Luma50SpinBox->setValue(intra8x8Luma[49]);
+	ui.intra8x8Luma51SpinBox->setValue(intra8x8Luma[50]);
+	ui.intra8x8Luma52SpinBox->setValue(intra8x8Luma[51]);
+	ui.intra8x8Luma53SpinBox->setValue(intra8x8Luma[52]);
+	ui.intra8x8Luma54SpinBox->setValue(intra8x8Luma[53]);
+	ui.intra8x8Luma55SpinBox->setValue(intra8x8Luma[54]);
+	ui.intra8x8Luma56SpinBox->setValue(intra8x8Luma[55]);
+	ui.intra8x8Luma57SpinBox->setValue(intra8x8Luma[56]);
+	ui.intra8x8Luma58SpinBox->setValue(intra8x8Luma[57]);
+	ui.intra8x8Luma59SpinBox->setValue(intra8x8Luma[58]);
+	ui.intra8x8Luma60SpinBox->setValue(intra8x8Luma[59]);
+	ui.intra8x8Luma61SpinBox->setValue(intra8x8Luma[60]);
+	ui.intra8x8Luma62SpinBox->setValue(intra8x8Luma[61]);
+	ui.intra8x8Luma63SpinBox->setValue(intra8x8Luma[62]);
+	ui.intra8x8Luma64SpinBox->setValue(intra8x8Luma[63]);
+}
+
+void XvidCustomMatrixDialog::setInter8x8Luma(const unsigned char inter8x8Luma[64])
+{
+	ui.inter8x8Luma1SpinBox->setValue(inter8x8Luma[0]);
+	ui.inter8x8Luma2SpinBox->setValue(inter8x8Luma[1]);
+	ui.inter8x8Luma3SpinBox->setValue(inter8x8Luma[2]);
+	ui.inter8x8Luma4SpinBox->setValue(inter8x8Luma[3]);
+	ui.inter8x8Luma5SpinBox->setValue(inter8x8Luma[4]);
+	ui.inter8x8Luma6SpinBox->setValue(inter8x8Luma[5]);
+	ui.inter8x8Luma7SpinBox->setValue(inter8x8Luma[6]);
+	ui.inter8x8Luma8SpinBox->setValue(inter8x8Luma[7]);
+	ui.inter8x8Luma9SpinBox->setValue(inter8x8Luma[8]);
+	ui.inter8x8Luma10SpinBox->setValue(inter8x8Luma[9]);
+	ui.inter8x8Luma11SpinBox->setValue(inter8x8Luma[10]);
+	ui.inter8x8Luma12SpinBox->setValue(inter8x8Luma[11]);
+	ui.inter8x8Luma13SpinBox->setValue(inter8x8Luma[12]);
+	ui.inter8x8Luma14SpinBox->setValue(inter8x8Luma[13]);
+	ui.inter8x8Luma15SpinBox->setValue(inter8x8Luma[14]);
+	ui.inter8x8Luma16SpinBox->setValue(inter8x8Luma[15]);
+	ui.inter8x8Luma17SpinBox->setValue(inter8x8Luma[16]);
+	ui.inter8x8Luma18SpinBox->setValue(inter8x8Luma[17]);
+	ui.inter8x8Luma19SpinBox->setValue(inter8x8Luma[18]);
+	ui.inter8x8Luma20SpinBox->setValue(inter8x8Luma[19]);
+	ui.inter8x8Luma21SpinBox->setValue(inter8x8Luma[20]);
+	ui.inter8x8Luma22SpinBox->setValue(inter8x8Luma[21]);
+	ui.inter8x8Luma23SpinBox->setValue(inter8x8Luma[22]);
+	ui.inter8x8Luma24SpinBox->setValue(inter8x8Luma[23]);
+	ui.inter8x8Luma25SpinBox->setValue(inter8x8Luma[24]);
+	ui.inter8x8Luma26SpinBox->setValue(inter8x8Luma[25]);
+	ui.inter8x8Luma27SpinBox->setValue(inter8x8Luma[26]);
+	ui.inter8x8Luma28SpinBox->setValue(inter8x8Luma[27]);
+	ui.inter8x8Luma29SpinBox->setValue(inter8x8Luma[28]);
+	ui.inter8x8Luma30SpinBox->setValue(inter8x8Luma[29]);
+	ui.inter8x8Luma31SpinBox->setValue(inter8x8Luma[30]);
+	ui.inter8x8Luma32SpinBox->setValue(inter8x8Luma[31]);
+	ui.inter8x8Luma33SpinBox->setValue(inter8x8Luma[32]);
+	ui.inter8x8Luma34SpinBox->setValue(inter8x8Luma[33]);
+	ui.inter8x8Luma35SpinBox->setValue(inter8x8Luma[34]);
+	ui.inter8x8Luma36SpinBox->setValue(inter8x8Luma[35]);
+	ui.inter8x8Luma37SpinBox->setValue(inter8x8Luma[36]);
+	ui.inter8x8Luma38SpinBox->setValue(inter8x8Luma[37]);
+	ui.inter8x8Luma39SpinBox->setValue(inter8x8Luma[38]);
+	ui.inter8x8Luma40SpinBox->setValue(inter8x8Luma[39]);
+	ui.inter8x8Luma41SpinBox->setValue(inter8x8Luma[40]);
+	ui.inter8x8Luma42SpinBox->setValue(inter8x8Luma[41]);
+	ui.inter8x8Luma43SpinBox->setValue(inter8x8Luma[42]);
+	ui.inter8x8Luma44SpinBox->setValue(inter8x8Luma[43]);
+	ui.inter8x8Luma45SpinBox->setValue(inter8x8Luma[44]);
+	ui.inter8x8Luma46SpinBox->setValue(inter8x8Luma[45]);
+	ui.inter8x8Luma47SpinBox->setValue(inter8x8Luma[46]);
+	ui.inter8x8Luma48SpinBox->setValue(inter8x8Luma[47]);
+	ui.inter8x8Luma49SpinBox->setValue(inter8x8Luma[48]);
+	ui.inter8x8Luma50SpinBox->setValue(inter8x8Luma[49]);
+	ui.inter8x8Luma51SpinBox->setValue(inter8x8Luma[50]);
+	ui.inter8x8Luma52SpinBox->setValue(inter8x8Luma[51]);
+	ui.inter8x8Luma53SpinBox->setValue(inter8x8Luma[52]);
+	ui.inter8x8Luma54SpinBox->setValue(inter8x8Luma[53]);
+	ui.inter8x8Luma55SpinBox->setValue(inter8x8Luma[54]);
+	ui.inter8x8Luma56SpinBox->setValue(inter8x8Luma[55]);
+	ui.inter8x8Luma57SpinBox->setValue(inter8x8Luma[56]);
+	ui.inter8x8Luma58SpinBox->setValue(inter8x8Luma[57]);
+	ui.inter8x8Luma59SpinBox->setValue(inter8x8Luma[58]);
+	ui.inter8x8Luma60SpinBox->setValue(inter8x8Luma[59]);
+	ui.inter8x8Luma61SpinBox->setValue(inter8x8Luma[60]);
+	ui.inter8x8Luma62SpinBox->setValue(inter8x8Luma[61]);
+	ui.inter8x8Luma63SpinBox->setValue(inter8x8Luma[62]);
+	ui.inter8x8Luma64SpinBox->setValue(inter8x8Luma[63]);
+}

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h	2009-01-09 16:23:44 UTC (rev 4527)
@@ -0,0 +1,24 @@
+#ifndef XvidCustomMatrixDialog_h
+#define XvidCustomMatrixDialog_h
+
+#include "ui_XvidCustomMatrixDialog.h"
+
+class XvidCustomMatrixDialog : public QDialog
+{
+	Q_OBJECT
+
+private:
+	Ui_XvidCustomMatrixDialog ui;
+
+	void setIntra8x8Luma(const unsigned char intra8x8Luma[64]);
+	void setInter8x8Luma(const unsigned char inter8x8Luma[64]);
+	bool parseCqmFile(const char cqmFileName[1024], unsigned char intra8x8Luma[64], unsigned char inter8x8Luma[64]);
+
+public:
+	XvidCustomMatrixDialog(QWidget *parent, const unsigned char intra8x8Luma[64], const unsigned char inter8x8Luma[64]);
+	void getMatrix(unsigned char intra8x8Luma[64], unsigned char inter8x8Luma[64]);
+
+private slots:
+	void loadFileButton_pressed();
+};
+#endif	// XvidCustomMatrixDialog_h

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.ui	2009-01-07 19:10:42 UTC (rev 4526)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.ui	2009-01-09 16:23:44 UTC (rev 4527)
@@ -0,0 +1,1666 @@
+<ui version="4.0" >
+ <class>XvidCustomMatrixDialog</class>
+ <widget class="QDialog" name="XvidCustomMatrixDialog" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>509</width>
+    <height>315</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Xvid Custom Matrix</string>
+  </property>
+  <layout class="QVBoxLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item>
+    <widget class="QTabWidget" name="tabWidget" >
+     <property name="currentIndex" >
+      <number>0</number>
+     </property>
+     <widget class="QWidget" name="tab_3" >
+      <attribute name="title" >
+       <string>Intra 8x8</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <layout class="QHBoxLayout" >
+         <property name="margin" >
+          <number>0</number>
+         </property>
+         <property name="spacing" >
+          <number>6</number>
+         </property>
+         <item>
+          <layout class="QVBoxLayout" >
+           <property name="margin" >
+            <number>0</number>
+           </property>
+           <property name="spacing" >
+            <number>6</number>
+           </property>
+           <item>
+            <widget class="QLabel" name="label_7" >
+             <property name="text" >
+              <string>Luma:</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <spacer>
+             <property name="orientation" >
+              <enum>Qt::Vertical</enum>
+             </property>
+             <property name="sizeHint" >
+              <size>
+               <width>20</width>
+               <height>40</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+          </layout>
+         </item>
+         <item>
+          <layout class="QGridLayout" >
+           <property name="margin" >
+            <number>0</number>
+           </property>
+           <property name="spacing" >
+            <number>6</number>
+           </property>
+           <item row="4" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma40SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma55SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma48SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma22SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma33SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma60SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma31SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma32SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma64SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma5SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma2SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma10SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma4SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma8SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma29SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma25SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma1SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma53SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma3SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma50SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma15SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma58SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma6SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma56SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma11SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma49SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma13SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma51SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma9SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma63SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma14SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma54SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma7SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma59SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma12SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma61SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma21SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma57SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma18SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma62SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma26SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma20SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma24SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma17SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="7" >
+            <widget class="QSpinBox" name="intra8x8Luma16SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma19SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma37SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma27SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma34SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma36SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma30SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="1" >
+            <widget class="QSpinBox" name="intra8x8Luma42SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma23SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma35SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma28SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma47SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma38SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="2" >
+            <widget class="QSpinBox" name="intra8x8Luma43SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma52SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="4" >
+            <widget class="QSpinBox" name="intra8x8Luma45SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="0" >
+            <widget class="QSpinBox" name="intra8x8Luma41SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="5" >
+            <widget class="QSpinBox" name="intra8x8Luma46SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="6" >
+            <widget class="QSpinBox" name="intra8x8Luma39SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="3" >
+            <widget class="QSpinBox" name="intra8x8Luma44SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_4" >
+      <attribute name="title" >
+       <string>Inter 8x8</string>
+      </attribute>
+      <layout class="QVBoxLayout" >
+       <property name="margin" >
+        <number>9</number>
+       </property>
+       <property name="spacing" >
+        <number>6</number>
+       </property>
+       <item>
+        <layout class="QHBoxLayout" >
+         <property name="margin" >
+          <number>0</number>
+         </property>
+         <property name="spacing" >
+          <number>6</number>
+         </property>
+         <item>
+          <layout class="QVBoxLayout" >
+           <property name="margin" >
+            <number>0</number>
+           </property>
+           <property name="spacing" >
+            <number>6</number>
+           </property>
+           <item>
+            <widget class="QLabel" name="label_8" >
+             <property name="text" >
+              <string>Luma:</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <spacer>
+             <property name="orientation" >
+              <enum>Qt::Vertical</enum>
+             </property>
+             <property name="sizeHint" >
+              <size>
+               <width>20</width>
+               <height>40</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+          </layout>
+         </item>
+         <item>
+          <layout class="QGridLayout" >
+           <property name="margin" >
+            <number>0</number>
+           </property>
+           <property name="spacing" >
+            <number>6</number>
+           </property>
+           <item row="4" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma40SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma55SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma48SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma22SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma33SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma60SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma31SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma32SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma64SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma5SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma2SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma10SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma4SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma8SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma29SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma25SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma1SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma53SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma3SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma50SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma15SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma58SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma6SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma56SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma11SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma49SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma13SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma51SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma9SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma63SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma14SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma54SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="0" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma7SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma59SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma12SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma61SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma21SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma57SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma18SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="7" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma62SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma26SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma20SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma24SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma17SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="1" column="7" >
+            <widget class="QSpinBox" name="inter8x8Luma16SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma19SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma37SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma27SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma34SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma36SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma30SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="1" >
+            <widget class="QSpinBox" name="inter8x8Luma42SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="2" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma23SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma35SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="3" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma28SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma47SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma38SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="2" >
+            <widget class="QSpinBox" name="inter8x8Luma43SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="6" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma52SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="4" >
+            <widget class="QSpinBox" name="inter8x8Luma45SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="0" >
+            <widget class="QSpinBox" name="inter8x8Luma41SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="5" >
+            <widget class="QSpinBox" name="inter8x8Luma46SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="4" column="6" >
+            <widget class="QSpinBox" name="inter8x8Luma39SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+           <item row="5" column="3" >
+            <widget class="QSpinBox" name="inter8x8Luma44SpinBox" >
+             <property name="maximum" >
+              <number>255</number>
+             </property>
+             <property name="minimum" >
+              <number>1</number>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </widget>
+    </widget>
+   </item>
+   <item>
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>40</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QPushButton" name="loadFileButton" >
+       <property name="text" >
+        <string>Load File</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>131</width>
+         <height>31</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QPushButton" name="okButton" >
+       <property name="text" >
+        <string>OK</string>
+       </property>
+       <property name="default" >
+        <bool>true</bool>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="cancelButton" >
+       <property name="text" >
+        <string>Cancel</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+  </layout>
+ </widget>
+ <tabstops>
+  <tabstop>tabWidget</tabstop>
+  <tabstop>intra8x8Luma1SpinBox</tabstop>
+  <tabstop>intra8x8Luma2SpinBox</tabstop>
+  <tabstop>intra8x8Luma3SpinBox</tabstop>
+  <tabstop>intra8x8Luma4SpinBox</tabstop>
+  <tabstop>intra8x8Luma5SpinBox</tabstop>
+  <tabstop>intra8x8Luma6SpinBox</tabstop>
+  <tabstop>intra8x8Luma7SpinBox</tabstop>
+  <tabstop>intra8x8Luma8SpinBox</tabstop>
+  <tabstop>intra8x8Luma9SpinBox</tabstop>
+  <tabstop>intra8x8Luma10SpinBox</tabstop>
+  <tabstop>intra8x8Luma11SpinBox</tabstop>
+  <tabstop>intra8x8Luma12SpinBox</tabstop>
+  <tabstop>intra8x8Luma13SpinBox</tabstop>
+  <tabstop>intra8x8Luma14SpinBox</tabstop>
+  <tabstop>intra8x8Luma15SpinBox</tabstop>
+  <tabstop>intra8x8Luma16SpinBox</tabstop>
+  <tabstop>intra8x8Luma17SpinBox</tabstop>
+  <tabstop>intra8x8Luma18SpinBox</tabstop>
+  <tabstop>intra8x8Luma19SpinBox</tabstop>
+  <tabstop>intra8x8Luma20SpinBox</tabstop>
+  <tabstop>intra8x8Luma21SpinBox</tabstop>
+  <tabstop>intra8x8Luma22SpinBox</tabstop>
+  <tabstop>intra8x8Luma23SpinBox</tabstop>
+  <tabstop>intra8x8Luma24SpinBox</tabstop>
+  <tabstop>intra8x8Luma25SpinBox</tabstop>
+  <tabstop>intra8x8Luma26SpinBox</tabstop>
+  <tabstop>intra8x8Luma27SpinBox</tabstop>
+  <tabstop>intra8x8Luma28SpinBox</tabstop>
+  <tabstop>intra8x8Luma29SpinBox</tabstop>
+  <tabstop>intra8x8Luma30SpinBox</tabstop>
+  <tabstop>intra8x8Luma31SpinBox</tabstop>
+  <tabstop>intra8x8Luma32SpinBox</tabstop>
+  <tabstop>intra8x8Luma33SpinBox</tabstop>
+  <tabstop>intra8x8Luma34SpinBox</tabstop>
+  <tabstop>intra8x8Luma35SpinBox</tabstop>
+  <tabstop>intra8x8Luma36SpinBox</tabstop>
+  <tabstop>intra8x8Luma37SpinBox</tabstop>
+  <tabstop>intra8x8Luma38SpinBox</tabstop>
+  <tabstop>intra8x8Luma39SpinBox</tabstop>
+  <tabstop>intra8x8Luma40SpinBox</tabstop>
+  <tabstop>intra8x8Luma41SpinBox</tabstop>
+  <tabstop>intra8x8Luma42SpinBox</tabstop>
+  <tabstop>intra8x8Luma43SpinBox</tabstop>
+  <tabstop>intra8x8Luma44SpinBox</tabstop>
+  <tabstop>intra8x8Luma45SpinBox</tabstop>
+  <tabstop>intra8x8Luma46SpinBox</tabstop>
+  <tabstop>intra8x8Luma47SpinBox</tabstop>
+  <tabstop>intra8x8Luma48SpinBox</tabstop>
+  <tabstop>intra8x8Luma49SpinBox</tabstop>
+  <tabstop>intra8x8Luma50SpinBox</tabstop>
+  <tabstop>intra8x8Luma51SpinBox</tabstop>
+  <tabstop>intra8x8Luma52SpinBox</tabstop>
+  <tabstop>intra8x8Luma53SpinBox</tabstop>
+  <tabstop>intra8x8Luma54SpinBox</tabstop>
+  <tabstop>intra8x8Luma55SpinBox</tabstop>
+  <tabstop>intra8x8Luma56SpinBox</tabstop>
+  <tabstop>intra8x8Luma57SpinBox</tabstop>
+  <tabstop>intra8x8Luma58SpinBox</tabstop>
+  <tabstop>intra8x8Luma59SpinBox</tabstop>
+  <tabstop>intra8x8Luma60SpinBox</tabstop>
+  <tabstop>intra8x8Luma61SpinBox</tabstop>
+  <tabstop>intra8x8Luma62SpinBox</tabstop>
+  <tabstop>intra8x8Luma63SpinBox</tabstop>
+  <tabstop>intra8x8Luma64SpinBox</tabstop>
+  <tabstop>inter8x8Luma1SpinBox</tabstop>
+  <tabstop>inter8x8Luma2SpinBox</tabstop>
+  <tabstop>inter8x8Luma3SpinBox</tabstop>
+  <tabstop>inter8x8Luma4SpinBox</tabstop>
+  <tabstop>inter8x8Luma5SpinBox</tabstop>
+  <tabstop>inter8x8Luma6SpinBox</tabstop>
+  <tabstop>inter8x8Luma7SpinBox</tabstop>
+  <tabstop>inter8x8Luma8SpinBox</tabstop>
+  <tabstop>inter8x8Luma9SpinBox</tabstop>
+  <tabstop>inter8x8Luma10SpinBox</tabstop>
+  <tabstop>inter8x8Luma11SpinBox</tabstop>
+  <tabstop>inter8x8Luma12SpinBox</tabstop>
+  <tabstop>inter8x8Luma13SpinBox</tabstop>
+  <tabstop>inter8x8Luma14SpinBox</tabstop>
+  <tabstop>inter8x8Luma15SpinBox</tabstop>
+  <tabstop>inter8x8Luma16SpinBox</tabstop>
+  <tabstop>inter8x8Luma17SpinBox</tabstop>
+  <tabstop>inter8x8Luma18SpinBox</tabstop>
+  <tabstop>inter8x8Luma19SpinBox</tabstop>
+  <tabstop>inter8x8Luma20SpinBox</tabstop>
+  <tabstop>inter8x8Luma21SpinBox</tabstop>
+  <tabstop>inter8x8Luma22SpinBox</tabstop>
+  <tabstop>inter8x8Luma23SpinBox</tabstop>
+  <tabstop>inter8x8Luma24SpinBox</tabstop>
+  <tabstop>inter8x8Luma25SpinBox</tabstop>
+  <tabstop>inter8x8Luma26SpinBox</tabstop>
+  <tabstop>inter8x8Luma27SpinBox</tabstop>
+  <tabstop>inter8x8Luma28SpinBox</tabstop>
+  <tabstop>inter8x8Luma29SpinBox</tabstop>
+  <tabstop>inter8x8Luma30SpinBox</tabstop>
+  <tabstop>inter8x8Luma31SpinBox</tabstop>
+  <tabstop>inter8x8Luma32SpinBox</tabstop>
+  <tabstop>inter8x8Luma33SpinBox</tabstop>
+  <tabstop>inter8x8Luma34SpinBox</tabstop>
+  <tabstop>inter8x8Luma35SpinBox</tabstop>
+  <tabstop>inter8x8Luma36SpinBox</tabstop>
+  <tabstop>inter8x8Luma37SpinBox</tabstop>
+  <tabstop>inter8x8Luma38SpinBox</tabstop>
+  <tabstop>inter8x8Luma39SpinBox</tabstop>
+  <tabstop>inter8x8Luma40SpinBox</tabstop>
+  <tabstop>inter8x8Luma41SpinBox</tabstop>
+  <tabstop>inter8x8Luma42SpinBox</tabstop>
+  <tabstop>inter8x8Luma43SpinBox</tabstop>
+  <tabstop>inter8x8Luma44SpinBox</tabstop>
+  <tabstop>inter8x8Luma45SpinBox</tabstop>
+  <tabstop>inter8x8Luma46SpinBox</tabstop>
+  <tabstop>inter8x8Luma47SpinBox</tabstop>
+  <tabstop>inter8x8Luma48SpinBox</tabstop>
+  <tabstop>inter8x8Luma49SpinBox</tabstop>
+  <tabstop>inter8x8Luma50SpinBox</tabstop>
+  <tabstop>inter8x8Luma51SpinBox</tabstop>
+  <tabstop>inter8x8Luma52SpinBox</tabstop>
+  <tabstop>inter8x8Luma53SpinBox</tabstop>
+  <tabstop>inter8x8Luma54SpinBox</tabstop>
+  <tabstop>inter8x8Luma55SpinBox</tabstop>
+  <tabstop>inter8x8Luma56SpinBox</tabstop>
+  <tabstop>inter8x8Luma57SpinBox</tabstop>
+  <tabstop>inter8x8Luma58SpinBox</tabstop>
+  <tabstop>inter8x8Luma59SpinBox</tabstop>
+  <tabstop>inter8x8Luma60SpinBox</tabstop>
+  <tabstop>inter8x8Luma61SpinBox</tabstop>
+  <tabstop>inter8x8Luma62SpinBox</tabstop>
+  <tabstop>inter8x8Luma63SpinBox</tabstop>
+  <tabstop>inter8x8Luma64SpinBox</tabstop>
+  <tabstop>loadFileButton</tabstop>
+  <tabstop>okButton</tabstop>
+  <tabstop>cancelButton</tabstop>
+ </tabstops>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>okButton</sender>
+   <signal>clicked()</signal>
+   <receiver>XvidCustomMatrixDialog</receiver>
+   <slot>accept()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>278</x>
+     <y>253</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>96</x>
+     <y>254</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>cancelButton</sender>
+   <signal>clicked()</signal>
+   <receiver>XvidCustomMatrixDialog</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>369</x>
+     <y>253</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>179</x>
+     <y>282</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From gruntster at mail.berlios.de  Sat Jan 10 12:21:04 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 10 Jan 2009 12:21:04 +0100
Subject: [Avidemux-svn-commit] r4528 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk
Message-ID: <200901101121.n0ABL4i4017926@sheep.berlios.de>

Author: gruntster
Date: 2009-01-10 12:20:53 +0100 (Sat, 10 Jan 2009)
New Revision: 4528

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
Log:
[xvid] hook up GTK options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-09 16:23:44 UTC (rev 4527)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/CMakeLists.txt	2009-01-10 11:20:53 UTC (rev 4528)
@@ -16,7 +16,7 @@
 
 	ADD_DEFINITIONS(${GTK_CFLAGS})
 	ADD_LIBRARY(${GTK_PLUGIN_NAME} SHARED ${ADM_vidEnc_xvid_Gtk_SRCS})
-	TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ADM_vidEnc_xvid ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
+	TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ADM_vidEnc_xvid ADM_coreUI ${GTK_LDFLAGS} ${GTHREAD_LDFLAGS})
 	
 	IF (GETTEXT_FOUND)
 		TARGET_LINK_LIBRARIES(${GTK_PLUGIN_NAME} ${GETTEXT_LIBRARY_DIR})

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-09 16:23:44 UTC (rev 4527)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-10 11:20:53 UTC (rev 4528)
@@ -24,32 +24,30 @@
 #endif
 
 #include "ADM_inttype.h"
+#include "gtkSupport.h"
+
+#include "ADM_files.h"
+#include "DIA_fileSel.h"
 #include "DIA_coreToolkit.h"
-#include "DIA_fileSel.h"
 
-#include "../options.h"
-
-#include "gtkSupport.h"
+#include "../presetOptions.h"
 #include "xvidConfigDialog.h"
 
 #define WID(x) lookup_widget(dialog, #x)
 
-//static xvid4EncParam localParam;
-static uint32_t mQ,mB,mS,mA;
-static GtkWidget *dialog=NULL;
-//static COMPRESSION_MODE mMode;
-
 static GtkWidget *create_dialog1 (void);
 static GtkWidget *create_dialog3 (void);
 
-static void xvid4otherUpload(GtkWidget *dialog);
-static void xvid4otherDownload(GtkWidget *dialog);
-static uint8_t editMatrix(uint8_t *inter, uint8_t *intra, GtkWindow *parent);
-static void updateMode( void );
+static void loadOptions(GtkWidget *dialog, XvidOptions *options);
+void saveOptions(GtkWidget *dialog, XvidOptions *options);
 
-static int cb_mod(GtkObject * object, gpointer user_data);
-static int ch_par_asinput(GtkObject * object, gpointer user_data);
+static unsigned char editMatrix(unsigned char *inter, unsigned char *intra, GtkWidget *parent);
+static void updateMode(GtkWidget *dialog, int encodeMode, int encodeModeParameter);
+static int getCurrentEncodeMode(GtkWidget *dialog);
 
+static int cb_mod(GtkObject *object, gpointer user_data);
+static int ch_par_asinput(GtkObject *object, gpointer user_data);
+
 #define CALL_Z(x,y)  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),XVID4_RESPONSE_##y);
 
 typedef enum 
@@ -59,141 +57,113 @@
     XVID4_RESPONSE_LOAD_MATRIX,
     XVID4_RESPONSE_SAVE_MATRIX,
     XVID4_RESPONSE_LAST,
-}XVID4_CODE;
+} XVID4_CODE;
 
+static int _parWidth, _parHeight;
+static int _lastBitrate, _lastVideoSize;
+
 extern "C" int showXvidConfigDialog(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties, vidEncOptions *encodeOptions, XvidOptions *options)
 {
-	int b;
-	int ret=0;
-	int code;
-	//ADM_assert(incoming->extraSettingsLen==sizeof(localParam));
-	//memcpy(&localParam,incoming->extraSettings,sizeof(localParam));
-	dialog=create_dialog1();
+	_lastBitrate = 1500;
+	_lastVideoSize = 700;
 
+	GtkWidget *dialog = create_dialog1();
+
+	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
+										GTK_RESPONSE_OK,
+										GTK_RESPONSE_CANCEL,
+										-1);
+
 	gtk_window_set_modal(GTK_WINDOW(dialog), 1);
 	gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(configParameters->parent));
 
-#define HIST_SET(x) gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), x)
-#define VAL_SET(x) gtk_write_entry(WID(entryEntry), x)
+	_parWidth = properties->parWidth;
+	_parHeight = properties->parHeight;
 
-/*	mQ=incoming->qz;
-	mB=incoming->bitrate; // in kbits
-	mS=incoming->finalsize;	
-	mA=incoming->avg_bitrate;
-	mMode=incoming->mode;
-	updateMode();
+	updateMode(dialog, encodeOptions->encodeMode, encodeOptions->encodeModeParameter);
+	loadOptions(dialog, options);
 
-	xvid4otherUpload(dialog); */
-	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), "changed",
-		GTK_SIGNAL_FUNC(cb_mod),                   (void *) 0);
+	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), "changed", GTK_SIGNAL_FUNC(cb_mod), dialog);
+	gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), "clicked", GTK_SIGNAL_FUNC(ch_par_asinput), options);
 
-	gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), "clicked",
-		GTK_SIGNAL_FUNC(ch_par_asinput),                   (void *) 0);
+	CALL_Z(buttonCreateCustomMatrix, EDIT_MATRIX);
+	CALL_Z(buttonLoadMatrix, LOAD_MATRIX);
 
-	CALL_Z(buttonCreateCustomMatrix,EDIT_MATRIX);
-	CALL_Z(buttonLoadMatrix,LOAD_MATRIX);
+_again:
+	int code = gtk_dialog_run(GTK_DIALOG(dialog));
+	int b, ret = 0;
 
-_again:
-	code=gtk_dialog_run(GTK_DIALOG(dialog));
-/*	if(code==XVID4_RESPONSE_EDIT_MATRIX)
+	if (code == XVID4_RESPONSE_EDIT_MATRIX)
 	{
-		uint8_t intra[64],inter[64];
-		memcpy(intra,localParam.intraMatrix,64);
-		memcpy(inter,localParam.interMatrix,64);
-		if(editMatrix(intra,inter))
+		unsigned char intra[64], inter[64];
+
+		options->getIntraMatrix(intra);
+		options->getInterMatrix(inter);
+
+		if (editMatrix(intra, inter, dialog))
 		{
-			memcpy(localParam.intraMatrix,intra,64);
-			memcpy(localParam.interMatrix,inter,64);
+			options->setIntraMatrix(intra);
+			options->setInterMatrix(inter);
 		}
+
 		goto _again;
 	}
-	if(code==XVID4_RESPONSE_LOAD_MATRIX)
+
+	if (code == XVID4_RESPONSE_LOAD_MATRIX)
 	{
-		uint8_t intra[64],inter[64];
+		unsigned char intra[64], inter[64];
 		char name[1024];
-		FILE *file=NULL;
+		FILE *file = NULL;
 
 		if (!FileSel_SelectRead(_("Select Xvid matrix file to load"), name, 1023, NULL))
 			goto _again;
 
 		printf("Loading Matrix\n");
-		file=fopen(name,"rb");
-		if(!file)
+		file = fopen(name,"rb");
+
+		if (!file)
 		{
 _erLoad:
-			if(file) fclose(file);
+			if (file)
+				fclose(file);
+
 			GUI_Error_HIG(_("Error Loading"),_("Error loadind the custom matrix file."));
 			goto _again;
 		}
+
 		// Read it
-		if(64!=fread(intra,1,64,file))
+		if(64 != fread(intra, 1, 64, file))
 		{
 			printf("Error reading intra\n");
 			goto _erLoad;
 		}
-		if(64!=fread(inter,1,64,file))
+
+		if(64 != fread(inter, 1, 64, file))
 		{
 			printf("Error reading inter\n");
 			goto _erLoad;
 		}
-		// Ok
+
 		fclose(file);
-		memcpy(localParam.intraMatrix,intra,64);
-		memcpy(localParam.interMatrix,inter,64);
-		GUI_Info_HIG(ADM_LOG_INFO,_("Matrix Loaded"),_("The custom matrix file has been successfully loaded."));
+
+		options->setIntraMatrix(intra);
+		options->setInterMatrix(inter);
+
+		GUI_Info_HIG(ADM_LOG_INFO, _("Matrix Loaded"), _("The custom matrix file has been successfully loaded."));
 		goto _again;
 	}
-*/
-	if(code==GTK_RESPONSE_OK)
+
+	if (code == GTK_RESPONSE_OK)
 	{
-/*		int r,value=0;
-		ret=1;
-		r=getRangeInMenu(WID(optionmenuType));
-		xvid4otherDownload(dialog);
-		memcpy(incoming->extraSettings,&localParam,sizeof(localParam));
+		saveOptions(dialog, options);
 
-		switch(r)
+		if (getCurrentEncodeMode(dialog) == ADM_VIDENC_MODE_CQP)
+			encodeOptions->encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
+		else
 		{
-			case 0:
-				incoming->mode = COMPRESS_CBR;				      
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				incoming->bitrate = value;
-				ret = 1;
-				gtk_label_set_text(GTK_LABEL(WID(label11)),"Bitrate (kbps):");
-				break;
-			case 1:
-				incoming->mode = COMPRESS_CQ;		      			
-				value = (uint32_t) gtk_spin_button_get_value_as_int(
-					GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
-				if (value >= 2 && value <= 32)
-				{
-					incoming->qz = value;
-				}
-				break;
-
-			case 2:
-				incoming->mode = COMPRESS_2PASS;		       				
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				if((value>0)&&(value<4000))
-				{
-					incoming->finalsize=value;
-
-				}
-				gtk_label_set_text(GTK_LABEL(WID(label11)),_("Size (MBytes):"));
-				break;
-			case 3:
-				incoming->mode = COMPRESS_2PASS_BITRATE;	
-				value = (uint32_t) gtk_read_entry(WID(entryEntry));
-				incoming->avg_bitrate=value;
-				gtk_label_set_text(GTK_LABEL(WID(label11)),_("Average bitrate (kb/s):"));
-				break;
-
-			case 4:
-				incoming->mode=COMPRESS_SAME;
-				break;
-			default:
-				ADM_assert(0);
-		} */
+			char *str = gtk_editable_get_chars(GTK_EDITABLE(WID(entryEntry)), 0, -1);
+			encodeOptions->encodeModeParameter = atoi(str);
+		}
 	}
 
 	gtk_widget_destroy(dialog);
@@ -201,235 +171,340 @@
 	return ret;
 }
 
-// Read the localParam struct and set the ui fields
-// accordingly
-#define SPIN_GET(x,y) {localParam.y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-	printf(#x":%d\n",localParam.y);}
+int getRangeInMenu(GtkWidget *menu)
+{
+    GtkWidget *br = gtk_option_menu_get_menu(GTK_OPTION_MENU(menu));
+    GtkWidget *active = gtk_menu_get_active(GTK_MENU(br));
+    int mode = g_list_index(GTK_MENU_SHELL(br)->children, active);
 
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)localParam.y) ; \
-	printf(#x":%d\n",localParam.y);}
+    return mode;
+}
 
-#define MENU_SET(x,y) { gtk_option_menu_set_history (GTK_OPTION_MENU(WID(x)),localParam.y);}
-#define MENU_GET(x,y) { localParam.y	= getRangeInMenu(WID(x));}
-#define TOGGLE_SET(x,y) {gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}
-#define TOGGLE_GET(x,y) {localParam.y=gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(x)));\
-	printf(#y":%d\n",localParam.y);}
+void loadOptions(GtkWidget *dialog, XvidOptions *options)
+{
+	// Main tab
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonInterlaced)), options->getInterlaced() == INTERLACED_BFF);
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonCartoon)), options->getCartoon());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTurbo)), options->getTurboMode());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGreyScale)), options->getGreyscale());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChroma)), options->getChromaOptimisation());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonPacked)), options->getPacked());
 
-#define ENTRY_SET(x,y) {gtk_write_entry(WID(x),(int)localParam.y);}
-#define ENTRY_GET(x,y) {localParam.y=gtk_read_entry(WID(x));\
-	printf(#y":%d\n",localParam.y);}
+	// Motion & Misc tab
+	switch (options->getMotionEstimation())
+	{
+		case ME_NONE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 0);
+			break;
+		case ME_LOW:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 1);
+			break;
+		case ME_MEDIUM:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 2);
+			break;
+		case ME_HIGH:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), 3);
+			break;
+	}
 
-#define CHECK_GET(x,y) {localParam.y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}
+	switch (options->getRateDistortion())
+	{
+		case RD_NONE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 0);
+			break;
+		case RD_DCT_ME:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 1);
+			break;
+		case RD_HPEL_QPEL_16:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 2);
+			break;
+		case RD_HPEL_QPEL_8:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 3);
+			break;
+		case RD_SQUARE:
+			gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuVHQ)), 4);
+			break;
+	}
 
-void xvid4otherUpload(GtkWidget *dialog)
-{
-/*	MENU_SET(optionmenuMS,guiLevel);
-	MENU_SET(optionmenuVHQ,vhqmode);
-	if(localParam.useCustomIntra || localParam.useCustomInter)
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChromaMotion)), options->getChromaMotionEstimation());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbutton4MV)), options->getInterMotionVector());
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMaxPeriod)),(gfloat)options->getMaxKeyInterval());
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBFrame)),(gfloat)options->getMaxBframes());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonQPel)), options->getQpel());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGMC)), options->getGmc());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonBVHQ)), options->getBframeRdo());
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)), options->getParAsInput());
+
+	ch_par_asinput(GTK_OBJECT(WID(checkbutton_par_asinput)), options);
+
+	// Quantisation tab
+	switch (options->getCqmPreset())
 	{
-		RADIO_SET(radiobuttonCustomMatrix,		1);
-	}else
-		if(localParam.mpegQuantizer)
-			RADIO_SET(radiobuttonMpeg,		1);
-		else
-			RADIO_SET(radiobuttonH263,		1);		
-	CHECK_SET(checkbuttonInterlaced,	interlaced);
-	CHECK_SET(checkbutton4MV,		inter4mv);
-	CHECK_SET(checkbuttonTrellis,		trellis);
-	CHECK_SET(checkbuttonCartoon,		cartoon);
-	CHECK_SET(checkbuttonGreyScale,		greyscale);
-	CHECK_SET(checkbuttonChroma,		chroma_opt);
-	CHECK_SET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_SET(checkbuttonGMC,		gmc);
-	CHECK_SET(checkbuttonBVHQ,		bvhq);
-	CHECK_SET(checkbutton_par_asinput,	par_as_input);
-	CHECK_SET(checkbuttonQPel,		qpel);
-	CHECK_SET(checkbuttonHQAC,		hqac);
+		case CQM_H263:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonH263)), 1);
+			break;
+		case CQM_MPEG:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonMpeg)), 1);
+			break;
+		case CQM_CUSTOM:
+			gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(radiobuttonCustomMatrix)), 1);
+			break;
+	}
 
-	CHECK_SET(checkbuttonTurbo,		turbo);
-	CHECK_SET(checkbuttonPacked,		packed);
+	unsigned int minI, minP, minB;
+	unsigned int maxI, maxP, maxB;
 
-	SPIN_SET(spinbuttonIMaxPeriod,  max_key_interval);
-	ENTRY_SET(entryIInterv,		min_key_interval);
-	SPIN_SET(spinbuttonBFrame,	bframes);
-	ch_par_asinput(NULL, NULL);
+	options->getMinQuantiser(&minI, &minP, &minB);
+	options->getMaxQuantiser(&maxI, &maxP, &maxB);
 
-	SPIN_SET(spinbuttonIMax,	qmax[0]);
-	SPIN_SET(spinbuttonPMax,	qmax[1]);
-	SPIN_SET(spinbuttonBMax,	qmax[2]);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMax)),(gfloat)maxI);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonIMin)),(gfloat)minI);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonPMax)),(gfloat)maxP);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonPMin)),(gfloat)minP);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBMax)),(gfloat)maxB);
+	gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonBMin)),(gfloat)minB);
+	gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTrellis)), options->getTrellis());
 
-	SPIN_SET(spinbuttonIMin,	qmin[0]);
-	SPIN_SET(spinbuttonPMin,	qmin[1]);
-	SPIN_SET(spinbuttonBMin,	qmin[2]);
+	// Second Pass
+	char string[21];
 
+	snprintf(string, 20, "%d", options->getKeyFrameBoost());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIBoost)), string);
 
-	ENTRY_SET(entryIBoost		,	keyframe_boost		);
+	snprintf(string, 20, "%d", options->getAboveAverageCurveCompression());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryHiPass)), string);
 
-	ENTRY_SET(entryHiPass		,	curve_compression_high	);
-	ENTRY_SET(entryLowPass		,	curve_compression_low	);
-	ENTRY_SET(entryOvrControl,		overflow_control_strength	);
+	snprintf(string, 20, "%d", options->getBelowAverageCurveCompression());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryLowPass)), string);
 
-	ENTRY_SET(entryMaxOvrImp	,	max_overflow_improvement	);
-	ENTRY_SET(entryMaxOvrDeg	,	max_overflow_degradation	);
+	snprintf(string, 20, "%d", options->getOverflowControlStrength());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryOvrControl)), string);
 
-	ENTRY_SET(entryIreduction	,	kfreduction			);
-	ENTRY_SET(entryIInterv	,		kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-*/
+	snprintf(string, 20, "%d", options->getMaxOverflowImprovement());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryMaxOvrImp)), string);
+
+	snprintf(string, 20, "%d", options->getMaxOverflowDegradation());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryMaxOvrDeg)), string);
+
+	snprintf(string, 20, "%d", options->getMaxKeyFrameReduceBitrate());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIreduction)), string);
+
+	snprintf(string, 20, "%d", options->getKeyFrameBitrateThreshold());
+	gtk_entry_set_text(GTK_ENTRY(WID(entryIInterv)), string);
 }
 
 // Read the ui fields and set localParam
 // accordingly
-void xvid4otherDownload(GtkWidget *dialog)
+void saveOptions(GtkWidget *dialog, XvidOptions *options)
 {
-/*	MENU_GET(optionmenuMS,guiLevel);
-	MENU_GET(optionmenuVHQ,vhqmode);
+	// Main tab
+	options->setInterlaced(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonInterlaced))) ? INTERLACED_BFF : INTERLACED_NONE);
+	options->setCartoon(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonCartoon))));
+	options->setTurboMode(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTurbo))));
+	options->setGreyscale(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGreyScale))));
+	options->setChromaOptimisation(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChroma))));
+	options->setPacked(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonPacked))));
 
-	localParam.mpegQuantizer=RADIO_GET(radiobuttonMpeg);
-	if(RADIO_GET(radiobuttonCustomMatrix))
+	// Motion & Misc tab
+	switch (getRangeInMenu(WID(optionmenuMS)))
 	{
-		localParam.useCustomIntra=1;
-		localParam.useCustomInter=1;
-	}else
+		case 0:
+			options->setMotionEstimation(ME_NONE);
+			break;
+		case 1:
+			options->setMotionEstimation(ME_LOW);
+			break;
+		case 2:
+			options->setMotionEstimation(ME_MEDIUM);
+			break;
+		case 3:
+			options->setMotionEstimation(ME_HIGH);
+			break;
+	}
+
+	switch (getRangeInMenu(WID(optionmenuVHQ)))
 	{
-		localParam.useCustomIntra=0;
-		localParam.useCustomInter=0;
+		case 0:
+			options->setRateDistortion(RD_NONE);
+			break;
+		case 1:
+			options->setRateDistortion(RD_DCT_ME);
+			break;
+		case 2:
+			options->setRateDistortion(RD_HPEL_QPEL_16);
+			break;
+		case 3:
+			options->setRateDistortion(RD_HPEL_QPEL_8);
+			break;
+		case 4:
+			options->setRateDistortion(RD_SQUARE);
+			break;
 	}
-	CHECK_GET(checkbuttonInterlaced,	interlaced);
-	CHECK_GET(checkbutton4MV,		inter4mv);
-	CHECK_GET(checkbuttonTrellis,		trellis);
-	CHECK_GET(checkbuttonCartoon,		cartoon);
-	CHECK_GET(checkbuttonGreyScale,		greyscale);
-	CHECK_GET(checkbuttonChroma,		chroma_opt);
-	CHECK_GET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_GET(checkbuttonGMC,		gmc);
-	CHECK_GET(checkbuttonBVHQ,		bvhq);
-	CHECK_GET(checkbutton_par_asinput,	par_as_input);
-	CHECK_GET(checkbuttonQPel,		qpel);
-	CHECK_GET(checkbuttonHQAC,		hqac);
-	CHECK_GET(checkbuttonTurbo,		turbo);
-	CHECK_GET(checkbuttonPacked,		packed);
 
+	options->setChromaMotionEstimation(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonChromaMotion))));
+	options->setInterMotionVector(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton4MV))));
+	options->setMaxKeyInterval(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMaxPeriod))));
+	options->setMaxBframes(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBFrame))));
+	options->setQpel(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonQPel))));
+	options->setGmc(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonGMC))));
+	options->setBframeRdo(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonBVHQ))));
+	options->setParAsInput(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput))));
+	options->setPar(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_width))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_height))));
 
-	SPIN_GET(spinbuttonIMaxPeriod,  max_key_interval);	
-	ENTRY_GET(entryIInterv,			kfthreshold);
-	SPIN_GET(spinbuttonBFrame,		bframes);
+	// Quantisation tab
+	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(radiobuttonMpeg))))
+		options->setCqmPreset(CQM_MPEG);
+	else if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(radiobuttonCustomMatrix))))
+		options->setCqmPreset(CQM_CUSTOM);
+	else
+		options->setCqmPreset(CQM_H263);
 
-	SPIN_GET(spinbutton_par_width,	par_width);
-	SPIN_GET(spinbutton_par_height,	par_height);
+	options->setMinQuantiser(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMin))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonPMin))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBMin))));
+	options->setMaxQuantiser(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonIMax))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonPMax))),
+		gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbuttonBMax))));
+	options->setTrellis(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbuttonTrellis))));
 
+	// Second Pass
+	options->setKeyFrameBoost(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIBoost)), 0, -1)));
+	options->setAboveAverageCurveCompression(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryHiPass)), 0, -1)));
+	options->setBelowAverageCurveCompression(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryLowPass)), 0, -1)));
+	options->setOverflowControlStrength(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryOvrControl)), 0, -1)));
+	options->setMaxOverflowImprovement(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryMaxOvrImp)), 0, -1)));
+	options->setMaxOverflowDegradation(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryMaxOvrDeg)), 0, -1)));
+	options->setMaxKeyFrameReduceBitrate(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIreduction)), 0, -1)));
+	options->setKeyFrameBitrateThreshold(atoi(gtk_editable_get_chars(GTK_EDITABLE(WID(entryIInterv)), 0, -1)));
+}
 
-	ENTRY_GET(entryIBoost		,	keyframe_boost		);
+int getCurrentEncodeMode(GtkWidget *dialog)
+{
+	int modeIndex = getRangeInMenu(WID(optionmenuType));
+	int encodeMode;
 
-	ENTRY_GET(entryHiPass		,	curve_compression_high	);
-	ENTRY_GET(entryLowPass		,	curve_compression_low	);
-	ENTRY_GET(entryOvrControl,		overflow_control_strength	);
+	switch (modeIndex)
+	{
+		case 0:
+			encodeMode = ADM_VIDENC_MODE_AQP;
+			break;
+		case 1:
+			encodeMode = ADM_VIDENC_MODE_CQP;
+			break;
+		case 2:
+			encodeMode = ADM_VIDENC_MODE_CBR;
+			break;
+		case 3:
+			encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
+			break;
+		case 4:
+			encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
+			break;
+	}
 
-	ENTRY_GET(entryMaxOvrImp	,	max_overflow_improvement	);
-	ENTRY_GET(entryMaxOvrDeg	,	max_overflow_degradation	);
-
-	ENTRY_GET(entryIreduction	,	kfreduction			);
-	ENTRY_GET(entryIInterv	,	kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-	SPIN_GET(spinbuttonIMax,	qmax[0]);
-	SPIN_GET(spinbuttonPMax,	qmax[1]);
-	SPIN_GET(spinbuttonBMax,	qmax[2]);
-
-	SPIN_GET(spinbuttonIMin,	qmin[0]);
-	SPIN_GET(spinbuttonPMin,	qmin[1]);
-	SPIN_GET(spinbuttonBMin,	qmin[2]);
-*/
-
+	return encodeMode;
 }
 
-void updateMode( void )
+void updateMode(GtkWidget *dialog, int encodeMode, int encodeModeParameter)
 {
-/*	uint32_t b;
-	// set the right select button
-	switch (mMode)
+	int modeIndex = 0;
+	bool quantiser = false;
+
+	switch (encodeMode)
 	{
-	case COMPRESS_CBR:
-		HIST_SET(0);			
-		b=mB;
-		VAL_SET(b);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_("Target bitrate (kb/s):"));
-		break;
+		case ADM_VIDENC_MODE_CBR:
+			modeIndex = 0;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_("Target bitrate (kb/s)"));
+			break;
+		case ADM_VIDENC_MODE_CQP:
+			modeIndex = 1;
+			quantiser = true;
+			break;
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			modeIndex = 2;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_("Target video size (MB)"));
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			modeIndex = 3;
+			gtk_label_set_text(GTK_LABEL(WID(label11)),_("Average bitrate (kb/s)"));
+			break;
+	}
 
-	case COMPRESS_2PASS:
-		HIST_SET(2);
-		VAL_SET(mS);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_("Target video size (MB):"));
-		break;
-	case COMPRESS_2PASS_BITRATE:
-		HIST_SET(3);
-		VAL_SET(mA);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-		gtk_widget_set_sensitive(WID(entryEntry),1);
-		gtk_label_set_text(GTK_LABEL(WID(label11)),_("Average bitrate (kb/s):"));
-		break;
+	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), modeIndex);
 
-	case COMPRESS_CQ:
-		HIST_SET(1);
-		gtk_widget_set_sensitive(WID(entryEntry),0);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),1);
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)),(gfloat)mQ);
-		break;
-	case COMPRESS_SAME:
-		HIST_SET(4);
-		gtk_widget_set_sensitive(WID(entryEntry),0);
-		gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
+	if (quantiser)
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)), encodeModeParameter);
+	else
+	{
+		char string[21];
 
-		break;
+		snprintf(string, 20, "%d", encodeModeParameter);
+		gtk_entry_set_text(GTK_ENTRY(WID(entryEntry)), string);
+	}
 
-	} */
+	gtk_widget_set_sensitive(WID(spinbuttonQuant), quantiser);
+	gtk_widget_set_sensitive(WID(entryEntry), !quantiser);
 }
 
-int cb_mod(GtkObject * object, gpointer user_data)
+int cb_mod(GtkObject *object, gpointer user_data)
 {
-/*	int r;
-	r=getRangeInMenu(WID(optionmenuType));
-	switch(r)
+	GtkWidget *dialog = ((GtkWidget*)object)->parent;
+	int r = getRangeInMenu(WID(optionmenuType));
+	int mode = getCurrentEncodeMode(dialog);
+	int encodeModeParameter;
+
+	switch (mode)
 	{
-	case 0: mMode=COMPRESS_CBR ;break;
-	case 1: mMode=COMPRESS_CQ ;break;
-	case 2: mMode=COMPRESS_2PASS ;break;
-	case 3: mMode=COMPRESS_2PASS_BITRATE ;break;
-	case 4: mMode=COMPRESS_SAME;break;
+		case ADM_VIDENC_MODE_CBR:
+		case ADM_VIDENC_MODE_2PASS_SIZE:
+			encodeModeParameter = _lastBitrate;
+			break;
+		case ADM_VIDENC_MODE_2PASS_ABR:
+			encodeModeParameter = _lastVideoSize;
+			break;
+		default:
+			encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuantizer)));
+	}
 
-	}
-	updateMode();
-	printf("Changed!!!\n");
+	updateMode(((GtkWidget*)object)->parent, mode, encodeModeParameter);
+
 	return 0;
-*/
 }
 
-int ch_par_asinput(GtkObject * object, gpointer user_data)
+int ch_par_asinput(GtkObject *object, gpointer user_data)
 {
-/*	int on = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)));
+	XvidOptions *options = (XvidOptions*)user_data;
+	GtkWidget *dialog = ((GtkWidget*)object)->parent;
+	int on = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)));
+
 	gtk_widget_set_sensitive(WID(spinbutton_par_width), on^1);
 	gtk_widget_set_sensitive(WID(spinbutton_par_height), on^1);
 
-	if (on) {
-		SPIN_GET(spinbutton_par_width,	par_width);
-		SPIN_GET(spinbutton_par_height,	par_height);
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)), video_body->getPARWidth());
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)), video_body->getPARHeight());
-	}else{
-		SPIN_SET(spinbutton_par_width,	par_width);
-		SPIN_SET(spinbutton_par_height,	par_height);
+	if (on)
+	{
+		options->setPar(gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_width))),
+			gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton_par_height))));
+
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)), _parWidth);
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)), _parHeight);
 	}
+	else
+	{
+		unsigned int width, height;
 
-	return 0; */
+		options->getPar(&width, &height);
+
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)),(gfloat)width);
+		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)),(gfloat)height);
+	}
+
+	return 0;
 }
 
-uint8_t editMatrix(uint8_t *intra, uint8_t *inter, GtkWindow *parent)
+uint8_t editMatrix(uint8_t *intra, uint8_t *inter, GtkWidget *parent)
 {
-	GtkWidget *dialog=NULL;
+	GtkWidget *dialog = create_dialog3();
 	GtkWidget *spinbutton1;
 	GtkObject *spinbutton1_adj;
 	GtkWidget *intraCell[64],*interCell[64];
@@ -437,48 +512,47 @@
 	int code;
 	int col, row;
 
-	dialog=create_dialog3();
 	gtk_window_set_modal(GTK_WINDOW(dialog), 1);
-	gtk_window_set_transient_for(GTK_WINDOW(dialog), parent);
+	gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(parent));
 
-	for(int i=0;i<64;i++)
-	{  //Intra
-		col=i%8;
-		row=i>>3;
-		spinbutton1_adj = gtk_adjustment_new (intra[i], 8, 255, 1, 10, 0);
-		intraCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-		//     gtk_widget_show (spinbutton1);
-		gtk_table_attach (GTK_TABLE (WID(tableIntra)), spinbutton1, col, col+1, row, row+1,
-			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-			(GtkAttachOptions) (0), 0, 0);
+	for (int i = 0; i < 64; i++)
+	{
+		//Intra
+		col = i % 8;
+		row = i >> 3;
 
+		spinbutton1_adj = gtk_adjustment_new(intra[i], 8, 255, 1, 10, 0);
+		intraCell[i] = spinbutton1 = gtk_spin_button_new(GTK_ADJUSTMENT(spinbutton1_adj), 1, 0);
 
+		gtk_table_attach (GTK_TABLE (WID(tableIntra)), spinbutton1, col, col+1, row, row+1,
+			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL), (GtkAttachOptions) (0), 0, 0);
 	}
 
-	for(int i=0;i<64;i++)
-	{  //Inter
-		col=i%8;
-		row=i>>3;
+	for (int i = 0; i < 64; i++)
+	{
+		//Inter
+		col = i % 8;
+		row = i >> 3;
+
 		spinbutton1_adj = gtk_adjustment_new (inter[i], 1, 255, 1, 10, 0);
-		interCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-		//    gtk_widget_show (spinbutton1);
+		interCell[i] = spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
+
 		gtk_table_attach (GTK_TABLE (WID(tableInter)), spinbutton1, col, col+1, row, row+1,
-			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-			(GtkAttachOptions) (0), 0, 0);
+			(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),	(GtkAttachOptions) (0), 0, 0);
 	}
 
-	for(int i=0;i<64;i++)
+	for (int i = 0; i < 64; i++)
 	{
-		gtk_widget_show (intraCell[i]);
-		gtk_widget_show (interCell[i]);
+		gtk_widget_show(intraCell[i]);
+		gtk_widget_show(interCell[i]);
 	}
-	//
 
-	CALL_Z(button12,SAVE_MATRIX)
+	CALL_Z(button12, SAVE_MATRIX)
+
 _loop:
-	code=gtk_dialog_run(GTK_DIALOG(dialog));
+	code = gtk_dialog_run(GTK_DIALOG(dialog));
 
-	if(code==XVID4_RESPONSE_SAVE_MATRIX)
+	if (code == XVID4_RESPONSE_SAVE_MATRIX)
 	{
 		printf("Save\n");
 		char name[1024];
@@ -506,7 +580,7 @@
 		goto _loop;
 	}
 
-	if(code==GTK_RESPONSE_OK)
+	if (code==GTK_RESPONSE_OK)
 	{
 		printf("Accept\n");
 		ret=1;
@@ -545,7 +619,6 @@
   GtkWidget *one_pass_quantizer1;
   GtkWidget *two_pass1;
   GtkWidget *two_pass__average_bitrate1;
-  GtkWidget *same_qz_as_input1;
   GtkWidget *entryEntry;
   GtkObject *spinbuttonQuant_adj;
   GtkWidget *spinbuttonQuant;
@@ -569,13 +642,10 @@
   GtkWidget *vbox7;
   GtkWidget *optionmenuMS;
   GtkWidget *menu2;
-  GtkWidget *_0___none1;
-  GtkWidget *_1___very_low1;
-  GtkWidget *_2___low2;
-  GtkWidget *_3___medium1;
-  GtkWidget *_4___high1;
-  GtkWidget *_5___very_high1;
-  GtkWidget *_6___ultra_high1;
+  GtkWidget *_0___none;
+  GtkWidget *_1___low;
+  GtkWidget *_2___medium;
+  GtkWidget *_3___high;
   GtkWidget *optionmenuVHQ;
   GtkWidget *menu3;
   GtkWidget *_0___off1;
@@ -586,11 +656,7 @@
   GtkWidget *hbox10;
   GtkWidget *checkbuttonChromaMotion;
   GtkWidget *checkbutton4MV;
-  GtkWidget *checkbuttonHQAC;
   GtkWidget *hbox9;
-  GtkWidget *labelIFrameIntervalMin;
-  GtkObject *spinbuttonIMinPeriod_adj;
-  GtkWidget *spinbuttonIMinPeriod;
   GtkWidget *labelIFrameIntervalMax;
   GtkObject *spinbuttonIMaxPeriod_adj;
   GtkWidget *spinbuttonIMaxPeriod;
@@ -698,7 +764,7 @@
 
   dialog1 = gtk_dialog_new ();
   gtk_container_set_border_width (GTK_CONTAINER (dialog1), 2);
-  gtk_window_set_title (GTK_WINDOW (dialog1), _("XviD encoding options"));
+  gtk_window_set_title (GTK_WINDOW (dialog1), _("Xvid Configuration"));
   gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
 
   dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
@@ -774,10 +840,6 @@
   gtk_widget_show (two_pass__average_bitrate1);
   gtk_container_add (GTK_CONTAINER (menu1), two_pass__average_bitrate1);
 
-  same_qz_as_input1 = gtk_menu_item_new_with_mnemonic (_("Same Quantizer as Input"));
-  gtk_widget_show (same_qz_as_input1);
-  gtk_container_add (GTK_CONTAINER (menu1), same_qz_as_input1);
-
   gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuType), menu1);
 
   entryEntry = gtk_entry_new ();
@@ -786,8 +848,8 @@
   gtk_tooltips_set_tip (tooltips, entryEntry, _("Target video bitrate"), NULL);
   gtk_entry_set_width_chars (GTK_ENTRY (entryEntry), 10);
 
-  spinbuttonQuant_adj = gtk_adjustment_new (4, 1, 31, 0.1, 10, 0);
-  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 1);
+  spinbuttonQuant_adj = gtk_adjustment_new (4, 1, 31, 1, 10, 0);
+  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 0);
   gtk_widget_show (spinbuttonQuant);
   gtk_box_pack_start (GTK_BOX (vbox22), spinbuttonQuant, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, spinbuttonQuant, _("Constant quantizer - each frame will get the same compression"), NULL);
@@ -882,34 +944,22 @@
 
   menu2 = gtk_menu_new ();
 
-  _0___none1 = gtk_menu_item_new_with_mnemonic (_("0 - None"));
-  gtk_widget_show (_0___none1);
-  gtk_container_add (GTK_CONTAINER (menu2), _0___none1);
+  _0___none = gtk_menu_item_new_with_mnemonic (_("0 - None"));
+  gtk_widget_show (_0___none);
+  gtk_container_add (GTK_CONTAINER (menu2), _0___none);
 
-  _1___very_low1 = gtk_menu_item_new_with_mnemonic (_("1 - Very low"));
-  gtk_widget_show (_1___very_low1);
-  gtk_container_add (GTK_CONTAINER (menu2), _1___very_low1);
+  _1___low = gtk_menu_item_new_with_mnemonic (_("1 - Low"));
+  gtk_widget_show (_1___low);
+  gtk_container_add (GTK_CONTAINER (menu2), _1___low);
 
-  _2___low2 = gtk_menu_item_new_with_mnemonic (_("2 - Low"));
-  gtk_widget_show (_2___low2);
-  gtk_container_add (GTK_CONTAINER (menu2), _2___low2);
+  _2___medium = gtk_menu_item_new_with_mnemonic (_("2 - Medium"));
+  gtk_widget_show (_2___medium);
+  gtk_container_add (GTK_CONTAINER (menu2), _2___medium);
 
-  _3___medium1 = gtk_menu_item_new_with_mnemonic (_("3 - Medium"));
-  gtk_widget_show (_3___medium1);
-  gtk_container_add (GTK_CONTAINER (menu2), _3___medium1);
+  _3___high = gtk_menu_item_new_with_mnemonic (_("3 - High"));
+  gtk_widget_show (_3___high);
+  gtk_container_add (GTK_CONTAINER (menu2), _3___high);
 
-  _4___high1 = gtk_menu_item_new_with_mnemonic (_("4 - High"));
-  gtk_widget_show (_4___high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _4___high1);
-
-  _5___very_high1 = gtk_menu_item_new_with_mnemonic (_("5 - Very high"));
-  gtk_widget_show (_5___very_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _5___very_high1);
-
-  _6___ultra_high1 = gtk_menu_item_new_with_mnemonic (_("6 - Ultra high"));
-  gtk_widget_show (_6___ultra_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _6___ultra_high1);
-
   gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMS), menu2);
 
   optionmenuVHQ = gtk_option_menu_new ();
@@ -955,26 +1005,11 @@
   gtk_box_pack_start (GTK_BOX (hbox10), checkbutton4MV, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, checkbutton4MV, _("Use 4 motion vectors per macroblock, might give better compression"), NULL);
 
-  checkbuttonHQAC = gtk_check_button_new_with_mnemonic (_("HQ _AC"));
-  gtk_widget_show (checkbuttonHQAC);
-  gtk_box_pack_start (GTK_BOX (hbox10), checkbuttonHQAC, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonHQAC, _("Enable a better prediction of AC component. Turns on Lumi masking - applies more compression to dark/light areas that the eye cannot notice easily"), NULL);
-
   hbox9 = gtk_hbox_new (FALSE, 10);
   gtk_widget_show (hbox9);
   gtk_box_pack_start (GTK_BOX (vbox6), hbox9, FALSE, FALSE, 0);
 
-  labelIFrameIntervalMin = gtk_label_new (_("I-frame interval - Min:"));
-  gtk_widget_show (labelIFrameIntervalMin);
-  gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMin, FALSE, FALSE, 0);
-
-  spinbuttonIMinPeriod_adj = gtk_adjustment_new (1, 1, 9, 1, 10, 0);
-  spinbuttonIMinPeriod = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMinPeriod_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMinPeriod);
-  gtk_box_pack_start (GTK_BOX (hbox9), spinbuttonIMinPeriod, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMinPeriod, _("Minimum space between I-frames, 1 will disable forced I-frame spacing"), NULL);
-
-  labelIFrameIntervalMax = gtk_label_new (_("Max:"));
+  labelIFrameIntervalMax = gtk_label_new (_("Max I-frame interval:"));
   gtk_widget_show (labelIFrameIntervalMax);
   gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMax, FALSE, FALSE, 0);
 
@@ -1413,7 +1448,6 @@
   GLADE_HOOKUP_OBJECT (dialog1, one_pass_quantizer1, "one_pass_quantizer1");
   GLADE_HOOKUP_OBJECT (dialog1, two_pass1, "two_pass1");
   GLADE_HOOKUP_OBJECT (dialog1, two_pass__average_bitrate1, "two_pass__average_bitrate1");
-  GLADE_HOOKUP_OBJECT (dialog1, same_qz_as_input1, "same_qz_as_input1");
   GLADE_HOOKUP_OBJECT (dialog1, entryEntry, "entryEntry");
   GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQuant, "spinbuttonQuant");
   GLADE_HOOKUP_OBJECT (dialog1, label9, "label9");
@@ -1436,13 +1470,10 @@
   GLADE_HOOKUP_OBJECT (dialog1, vbox7, "vbox7");
   GLADE_HOOKUP_OBJECT (dialog1, optionmenuMS, "optionmenuMS");
   GLADE_HOOKUP_OBJECT (dialog1, menu2, "menu2");
-  GLADE_HOOKUP_OBJECT (dialog1, _0___none1, "_0___none1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1___very_low1, "_1___very_low1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2___low2, "_2___low2");
-  GLADE_HOOKUP_OBJECT (dialog1, _3___medium1, "_3___medium1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4___high1, "_4___high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _5___very_high1, "_5___very_high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _6___ultra_high1, "_6___ultra_high1");
+  GLADE_HOOKUP_OBJECT (dialog1, _0___none, "_0___none");
+  GLADE_HOOKUP_OBJECT (dialog1, _1___low, "_1___low");
+  GLADE_HOOKUP_OBJECT (dialog1, _2___medium, "_2___medium");
+  GLADE_HOOKUP_OBJECT (dialog1, _3___high, "_3___high");
   GLADE_HOOKUP_OBJECT (dialog1, optionmenuVHQ, "optionmenuVHQ");
   GLADE_HOOKUP_OBJECT (dialog1, menu3, "menu3");
   GLADE_HOOKUP_OBJECT (dialog1, _0___off1, "_0___off1");
@@ -1453,10 +1484,7 @@
   GLADE_HOOKUP_OBJECT (dialog1, hbox10, "hbox10");
   GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChromaMotion, "checkbuttonChromaMotion");
   GLADE_HOOKUP_OBJECT (dialog1, checkbutton4MV, "checkbutton4MV");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonHQAC, "checkbuttonHQAC");
   GLADE_HOOKUP_OBJECT (dialog1, hbox9, "hbox9");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMin, "labelIFrameIntervalMin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMinPeriod, "spinbuttonIMinPeriod");
   GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMax, "labelIFrameIntervalMax");
   GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMaxPeriod, "spinbuttonIMaxPeriod");
   GLADE_HOOKUP_OBJECT (dialog1, frameAdvancedSimpleProfile, "frameAdvancedSimpleProfile");



From gruntster at mail.berlios.de  Sun Jan 11 13:16:41 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Jan 2009 13:16:41 +0100
Subject: [Avidemux-svn-commit] r4529 - in
	branches/avidemux_2.5_branch_gruntster/plugins:
	ADM_videoEncoder/ADM_vidEnc_xvid/qt4
	ADM_videoFilters/TemporalCleaner
Message-ID: <200901111216.n0BCGfx7024743@sheep.berlios.de>

Author: gruntster
Date: 2009-01-11 13:16:32 +0100 (Sun, 11 Jan 2009)
New Revision: 4529

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/TemporalCleaner/CMakeLists.txt
Log:
[plugins] Unix tweaks

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h	2009-01-10 11:20:53 UTC (rev 4528)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.h	2009-01-11 12:16:32 UTC (rev 4529)
@@ -1,7 +1,7 @@
 #ifndef XvidCustomMatrixDialog_h
 #define XvidCustomMatrixDialog_h
 
-#include "ui_XvidCustomMatrixDialog.h"
+#include "ui_xvidCustomMatrixDialog.h"
 
 class XvidCustomMatrixDialog : public QDialog
 {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/TemporalCleaner/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/TemporalCleaner/CMakeLists.txt	2009-01-10 11:20:53 UTC (rev 4528)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/TemporalCleaner/CMakeLists.txt	2009-01-11 12:16:32 UTC (rev 4529)
@@ -5,5 +5,9 @@
 
 ADD_LIBRARY(ADM_vf_vlad SHARED ${ADM_vf_vlad_SRCS})
 
+IF (UNIX AND ADM_DEBUG)
+	ADD_DEFINITIONS(-O2)
+ENDIF (UNIX AND ADM_DEBUG)
+
 INIT_VIDEOFILTER_PLUGIN(ADM_vf_vlad)
 INSTALL_VIDEOFILTER(ADM_vf_vlad)



From gruntster at mail.berlios.de  Sun Jan 11 14:00:27 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Jan 2009 14:00:27 +0100
Subject: [Avidemux-svn-commit] r4530 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
Message-ID: <200901111300.n0BD0Raj004826@sheep.berlios.de>

Author: gruntster
Date: 2009-01-11 14:00:18 +0100 (Sun, 11 Jan 2009)
New Revision: 4530

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.h
Log:
[x264] tweaks for Qt configure window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-11 12:16:32 UTC (rev 4529)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-01-11 13:00:18 UTC (rev 4530)
@@ -137,8 +137,10 @@
 				connect(widget, SIGNAL(valueChanged(int)), this, SLOT(generic_valueChanged(int)));
 			else if (widget->inherits("QDoubleSpinBox"))
 				connect(widget, SIGNAL(valueChanged(double)), this, SLOT(generic_valueChanged(double)));
-			else if (widget->inherits("QAbstractButton"))
+			else if (widget->inherits("QCheckBox"))
 				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
+			else if (widget->inherits("QRadioButton"))
+				connect(widget, SIGNAL(pressed()), this, SLOT(generic_pressed()));
 			else if (widget->inherits("QLineEdit"))
 				connect(widget, SIGNAL(textEdited(QString)), this, SLOT(generic_textEdited(QString)));
 		}
@@ -473,10 +475,13 @@
 
 void x264ConfigDialog::matrixCustomEditButton_pressed()
 {
-	x264CustomMatrixDialog dialog(intra4x4Luma, intraChroma, inter4x4Luma, interChroma, intra8x8Luma, inter8x8Luma);
+	x264CustomMatrixDialog dialog(this, intra4x4Luma, intraChroma, inter4x4Luma, interChroma, intra8x8Luma, inter8x8Luma);
 
 	if (dialog.exec() == QDialog::Accepted)
+	{
 		dialog.getMatrix(intra4x4Luma, intraChroma, inter4x4Luma, interChroma, intra8x8Luma, inter8x8Luma);
+		ui.configurationComboBox->setCurrentIndex(1);
+	}
 }
 
 void x264ConfigDialog::zoneAddButton_pressed()

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp	2009-01-11 12:16:32 UTC (rev 4529)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp	2009-01-11 13:00:18 UTC (rev 4530)
@@ -23,8 +23,9 @@
 #include "DIA_coreToolkit.h"
 #include "../guiHelper.h"
 
-x264CustomMatrixDialog::x264CustomMatrixDialog(const uint8_t intra4x4Luma[16], const uint8_t intraChroma[16], const uint8_t inter4x4Luma[16],
-											   const uint8_t interChroma[16], const uint8_t intra8x8Luma[64], const uint8_t inter8x8Luma[64])
+x264CustomMatrixDialog::x264CustomMatrixDialog(QWidget *parent, const uint8_t intra4x4Luma[16], const uint8_t intraChroma[16], 
+											   const uint8_t inter4x4Luma[16],	const uint8_t interChroma[16], 
+											   const uint8_t intra8x8Luma[64],  const uint8_t inter8x8Luma[64]) : QDialog(parent)
 {
 	ui.setupUi(this);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.h	2009-01-11 12:16:32 UTC (rev 4529)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.h	2009-01-11 13:00:18 UTC (rev 4530)
@@ -18,7 +18,7 @@
 	void setInter8x8Luma(const uint8_t inter8x8Luma[]);
 
 public:
-	x264CustomMatrixDialog(const uint8_t* intra4x4Luma, const uint8_t* intraChroma, const uint8_t* inter4x4Luma, 
+	x264CustomMatrixDialog(QWidget *parent, const uint8_t* intra4x4Luma, const uint8_t* intraChroma, const uint8_t* inter4x4Luma, 
 		const uint8_t* interChroma, const uint8_t* intra8x8Luma, const uint8_t* inter8x8Luma);
 	void getMatrix(uint8_t* intra4x4Luma, uint8_t* intra4x4Chroma, uint8_t* inter4x4Luma, 
 		uint8_t* inter4x4Chroma, uint8_t* intra8x8Luma, uint8_t* inter8x8Luma);



From gruntster at mail.berlios.de  Sun Jan 11 14:03:12 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Jan 2009 14:03:12 +0100
Subject: [Avidemux-svn-commit] r4531 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_encoder
	avidemux/ADM_plugin plugins/ADM_videoEncoder/ADM_vidEnc_x264
	plugins/ADM_videoEncoder/ADM_vidEnc_xvid
Message-ID: <200901111303.n0BD3CdA005408@sheep.berlios.de>

Author: gruntster
Date: 2009-01-11 14:03:03 +0100 (Sun, 11 Jan 2009)
New Revision: 4531

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
Log:
[vidEnc] support flushing of external video encoders

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2009-01-11 13:03:03 UTC (rev 4531)
@@ -14,11 +14,12 @@
  *                                                                         *
  ***************************************************************************/
 
+#define __STDC_LIMIT_MACROS
+
 #include "ADM_default.h"
 #include "ADM_externalEncoder.h"
 #include "ADM_plugin/ADM_vidEnc_plugin.h"
 
-
 externalEncoder::externalEncoder(COMPRES_PARAMS *params, bool globalHeader)
 {
 	_plugin = getVideoEncoderPlugin(params->extra_param);
@@ -83,15 +84,25 @@
 	int64_t ptsFrame;
 	vidEncEncodeParameters params;
 
-	if (!_in->getFrameNumberNoAlloc(frame, &l, _vbuffer, &f))
+	if (frame != UINT32_MAX && !_in->getFrameNumberNoAlloc(frame, &l, _vbuffer, &f))
 	{
 		printf ("[externalEncoder] Error reading incoming frame\n");
 		return 0;
 	}
 
 	params.structSize = sizeof(vidEncEncodeParameters);
-	params.frameData = _vbuffer->data;
-	params.frameDataSize = ((_w + 15) & 0xffffff0) * ((_h + 15) & 0xfffffff0) * 2;
+
+	if (frame == UINT32_MAX)
+	{
+		params.frameData = NULL;
+		params.frameDataSize = 0;
+	}
+	else
+	{
+		params.frameData = _vbuffer->data;
+		params.frameDataSize = ((_w + 15) & 0xffffff0) * ((_h + 15) & 0xfffffff0) * 2;
+	}
+
 	params.encodedData = NULL;
 	params.encodedDataSize = 0;
 
@@ -105,6 +116,8 @@
 
 		switch (params.frameType)
 		{
+			case ADM_VIDENC_FRAMETYPE_NULL:
+				break;
 			case ADM_VIDENC_FRAMETYPE_IDR:
 				out->flags = AVI_KEY_FRAME;
 				break;
@@ -142,8 +155,10 @@
 
 int externalEncoder::getRequirements(void)
 {
-	// FIXME
-	return 0;
+	int req = _plugin->getEncoderRequirements(_plugin->encoderId);
+
+	if (req == ADM_VIDENC_REQ_NULL_FLUSH)
+		return ADM_ENC_REQ_NULL_FLUSH;
 }
 
 uint8_t externalEncoder::isDualPass(void)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.h	2009-01-11 13:03:03 UTC (rev 4531)
@@ -38,7 +38,7 @@
 public:
 	externalEncoder(COMPRES_PARAMS *params, bool globalHeader);
 	~externalEncoder();
-	virtual int getRequirements (void);
+	virtual int getRequirements(void);
 	virtual uint8_t isDualPass(void);
 	virtual uint8_t configure(AVDMGenericVideoStream * instream, int useExistingLogFile);
 	virtual uint8_t encode(uint32_t frame, ADMBitstream *out);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2009-01-11 13:03:03 UTC (rev 4531)
@@ -36,12 +36,13 @@
 
 ADM_vidEnc_plugin::ADM_vidEnc_plugin(const char *file) : ADM_LibWrapper()
 {
-	initialised = (loadLibrary(file) && getSymbols(20,
+	initialised = (loadLibrary(file) && getSymbols(21,
 		&getEncoders, "vidEncGetEncoders",
 		&getEncoderName, "vidEncGetEncoderName",
 		&getEncoderType, "vidEncGetEncoderType",
 		&getEncoderDescription, "vidEncGetEncoderDescription",
 		&getFourCC, "vidEncGetFourCC",
+		&getEncoderRequirements, "vidEncGetEncoderRequirements",
 		&getEncoderApiVersion, "vidEncGetEncoderApiVersion",
 		&getEncoderVersion, "vidEncGetEncoderVersion",
 		&getEncoderGuid, "vidEncGetEncoderGuid",
@@ -59,39 +60,39 @@
 		&close, "vidEncClose"));
 }
 
-std::vector<ADM_vidEnc_plugin *> ADM_videoEncoderPlugins;
-/**
-    \fn ADM_ve_getNbEncoders
-    \brief get the number of encoder plugin loaded
-    @return the number of encoder plugins
+std::vector<ADM_vidEnc_plugin *> ADM_videoEncoderPlugins;
+/**
+    \fn ADM_ve_getNbEncoders
+    \brief get the number of encoder plugin loaded
+    @return the number of encoder plugins
 */
-uint32_t ADM_ve_getNbEncoders(void)
-{
-    return ADM_videoEncoderPlugins.size();
-
-}
-/**
-     \fn ADM_ve_getEncoderInfo
-     \brief Get info about an encoder plugin
-     @param filter [in] Encoder index, between 0 and ADM_ve_getNbEncoders-1 included
-     @param name [out] Name + info of the encoder
-     @param major,minor,patch [out] Version number of the encoder
-     @return true
-*/
-bool     ADM_ve_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
-{
-    ADM_assert(filter>=0 && filter<ADM_videoEncoderPlugins.size());
-    ADM_vidEnc_plugin *plugin =ADM_videoEncoderPlugins[filter];
-        *name=plugin->getEncoderDescription(0);
-    int ma,mi,pa;
-        plugin->getEncoderVersion(0,&ma,&mi,&pa);
-        *major=(uint32_t)ma;
-        *minor=(uint32_t)mi;
-        *patch=(uint32_t)pa;
-        return true;
-
-}
+uint32_t ADM_ve_getNbEncoders(void)
+{
+    return ADM_videoEncoderPlugins.size();
 
+}
+/**
+     \fn ADM_ve_getEncoderInfo
+     \brief Get info about an encoder plugin
+     @param filter [in] Encoder index, between 0 and ADM_ve_getNbEncoders-1 included
+     @param name [out] Name + info of the encoder
+     @param major,minor,patch [out] Version number of the encoder
+     @return true
+*/
+bool     ADM_ve_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
+{
+    ADM_assert(filter>=0 && filter<ADM_videoEncoderPlugins.size());
+    ADM_vidEnc_plugin *plugin =ADM_videoEncoderPlugins[filter];
+        *name=plugin->getEncoderDescription(0);
+    int ma,mi,pa;
+        plugin->getEncoderVersion(0,&ma,&mi,&pa);
+        *major=(uint32_t)ma;
+        *minor=(uint32_t)mi;
+        *patch=(uint32_t)pa;
+        return true;
+
+}
+
 static int loadVideoEncoderPlugin(int uiType, const char *file)
 {
 	ADM_vidEnc_plugin *plugin = new ADM_vidEnc_plugin(file);
@@ -315,7 +316,3 @@
 
 	return ADM_videoEncoderPlugins[index];
 }
-/**
-
-*/
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_pluginLoad.h	2009-01-11 13:03:03 UTC (rev 4531)
@@ -26,6 +26,7 @@
 typedef const char* _vidEncGetEncoderType(int encoderId);
 typedef const char* _vidEncGetEncoderDescription(int encoderId);
 typedef const char* _vidEncGetFourCC(int encoderId);
+typedef int _vidEncGetEncoderRequirements(int encoderId);
 typedef int _vidEncGetEncoderApiVersion(int encoderId);
 typedef void _vidEncGetEncoderVersion(int encoderId, int *major, int *minor, int *patch);
 typedef const char* _vidEncGetEncoderGuid(int encoderId);
@@ -52,6 +53,7 @@
 		_vidEncGetEncoderType *getEncoderType;
 		_vidEncGetEncoderDescription *getEncoderDescription;
 		_vidEncGetFourCC *getFourCC;
+		_vidEncGetEncoderRequirements *getEncoderRequirements;
 		_vidEncGetEncoderApiVersion *getEncoderApiVersion;
 		_vidEncGetEncoderVersion *getEncoderVersion;
 		_vidEncGetEncoderGuid *getEncoderGuid;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_plugin/ADM_vidEnc_plugin.h	2009-01-11 13:03:03 UTC (rev 4531)
@@ -34,10 +34,13 @@
 #define ADM_VIDENC_MODE_2PASS_SIZE 4
 #define ADM_VIDENC_MODE_2PASS_ABR 5
 
-#define ADM_VIDENC_FRAMETYPE_IDR 1
-#define ADM_VIDENC_FRAMETYPE_B 2
-#define ADM_VIDENC_FRAMETYPE_P 3
+#define ADM_VIDENC_FRAMETYPE_NULL 1
+#define ADM_VIDENC_FRAMETYPE_IDR 2
+#define ADM_VIDENC_FRAMETYPE_B 3
+#define ADM_VIDENC_FRAMETYPE_P 4
 
+#define ADM_VIDENC_REQ_NULL_FLUSH 1
+
 #include "DIA_uiTypes.h"
 
 #define ADM_VIDENC_FLAG_GLOBAL_HEADER 1
@@ -97,6 +100,7 @@
 int vidEncGetEncoderApiVersion(int encoderId);
 void vidEncGetEncoderVersion(int encoderId, int *major, int *minor, int *patch);
 const char* vidEncGetEncoderGuid(int encoderId);
+int vidEncGetEncoderRequirements(int encoderId);
 
 int vidEncIsConfigurable(int encoderId);
 int vidEncConfigure(int encoderId, vidEncConfigParameters *configParameters, vidEncVideoProperties *properties);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2009-01-11 13:03:03 UTC (rev 4531)
@@ -27,7 +27,7 @@
 
 extern "C"
 {
-	void *encoders_getPointer(int uiType) { encoder.setUiType(uiType); return &encoders; } 
+	void *encoders_getPointer(int uiType) { encoder.setUiType(uiType); return &encoders; }
 	int x264Encoder_isConfigurable(void) { return encoder.isConfigurable(); }
 	int x264Encoder_configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties) { return encoder.configure(configParameters, properties); }
 	int x264Encoder_getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize) { return encoder.getOptions(encodeOptions, pluginOptions, bufferSize); };
@@ -41,7 +41,9 @@
 	void x264Encoder_close(void) { encoder.close(); }
 }
 
+#ifdef __WIN32
 extern void convertPathToAnsi(const char *path, char **ansiPath);
+#endif
 
 x264Encoder::x264Encoder(void)
 {
@@ -302,21 +304,27 @@
 
 	_picture.img.i_csp = X264_CSP_I420;
 	_picture.img.i_plane = 3;
-	_picture.img.plane[0] = encodeParams->frameData;	// Y
-	_picture.img.plane[2] = encodeParams->frameData + _param.i_width * _param.i_height;	// U
-	_picture.img.plane[1] = encodeParams->frameData + ((_param.i_width * _param.i_height * 5) >> 2);	// V
-	_picture.img.i_stride[0] = _param.i_width;
-	_picture.img.i_stride[1] = _param.i_width >> 1;
-	_picture.img.i_stride[2] = _param.i_width >> 1;
-	_picture.i_type = X264_TYPE_AUTO;
-	_picture.i_pts = _currentFrame++;
 
+	if (encodeParams->frameData)
+	{
+		_picture.img.plane[0] = encodeParams->frameData;	// Y
+		_picture.img.plane[2] = encodeParams->frameData + _param.i_width * _param.i_height;	// U
+		_picture.img.plane[1] = encodeParams->frameData + ((_param.i_width * _param.i_height * 5) >> 2);	// V
+		_picture.img.i_stride[0] = _param.i_width;
+		_picture.img.i_stride[1] = _param.i_width >> 1;
+		_picture.img.i_stride[2] = _param.i_width >> 1;
+		_picture.i_type = X264_TYPE_AUTO;
+		_picture.i_pts = _currentFrame;
+	}
+
 	if (x264_encoder_encode(_handle, &nal, &nalCount, &_picture, &picture_out) < 0)
 	{
 		printf("[x264] Error encoding\n");
 		return ADM_VIDENC_ERR_FAILED;
 	}
 
+	_currentFrame++;
+
 	// Write
 	int size = 0;
 	int currentNal, sizemax;
@@ -345,10 +353,6 @@
 	encodeParams->encodedDataSize = size;
 	encodeParams->ptsFrame = picture_out.i_pts;	// In fact it is the picture number in out case
 
-	// Delay for b-pyramid
-	if (_param.b_bframe_pyramid)
-		encodeParams->ptsFrame += _param.i_bframe;
-
 	switch (picture_out.i_type)
 	{
 		case X264_TYPE_IDR:
@@ -384,7 +388,7 @@
 			encodeParams->frameType = ADM_VIDENC_FRAMETYPE_B;
 			break;
 		default:
-			printf("[x264] Unknown image type: %d\n", picture_out.i_type);
+			encodeParams->frameType = ADM_VIDENC_FRAMETYPE_NULL;
 	}
 
 	encodeParams->quantiser = picture_out.i_qpplus1 - 1;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2009-01-11 13:03:03 UTC (rev 4531)
@@ -52,6 +52,11 @@
 	return "H264";
 }
 
+int vidEncGetEncoderRequirements(int encoderId)
+{
+	return ADM_VIDENC_REQ_NULL_FLUSH;
+}
+
 int vidEncGetEncoderApiVersion(int encoderId)
 {
 	return ADM_VIDENC_API_VERSION;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-01-11 13:03:03 UTC (rev 4531)
@@ -89,8 +89,12 @@
 	PRINT_CPU_FLAG(MMXEXT);
 	PRINT_CPU_FLAG(SSE);
 	PRINT_CPU_FLAG(SSE2);
+
+#if XVID_API >= XVID_MAKE_API(4, 2)
 	PRINT_CPU_FLAG(SSE3);
 	PRINT_CPU_FLAG(SSE41);
+#endif
+
 	PRINT_CPU_FLAG(3DNOW);
 	PRINT_CPU_FLAG(3DNOWEXT);
 	PRINT_CPU_FLAG(ALTIVEC);
@@ -98,6 +102,8 @@
 
 XvidEncoder::~XvidEncoder(void)
 {
+	close();
+
 	if (_logFileName)
 		delete [] _logFileName;
 
@@ -311,15 +317,24 @@
 
 	xvid_enc_stats.version = XVID_VERSION;
 	_xvid_enc_frame.bitstream = _buffer;
-	_xvid_enc_frame.length = 0;
-	_xvid_enc_frame.input.csp = XVID_CSP_YV12;
-	_xvid_enc_frame.input.stride[0] = _xvid_enc_create.width;
-	_xvid_enc_frame.input.stride[1] = _xvid_enc_create.width >> 1;
-	_xvid_enc_frame.input.stride[2] = _xvid_enc_create.width >> 1;
-	_xvid_enc_frame.input.plane[0] = encodeParams->frameData;
-	_xvid_enc_frame.input.plane[1] = encodeParams->frameData + (_xvid_enc_create.width * _xvid_enc_create.height);
-	_xvid_enc_frame.input.plane[2] = encodeParams->frameData + ((_xvid_enc_create.width * _xvid_enc_create.height * 5) >> 2);
 
+	if (encodeParams->frameData)
+	{
+		_xvid_enc_frame.length = 0;
+		_xvid_enc_frame.input.csp = XVID_CSP_YV12;
+		_xvid_enc_frame.input.stride[0] = _xvid_enc_create.width;
+		_xvid_enc_frame.input.stride[1] = _xvid_enc_create.width >> 1;
+		_xvid_enc_frame.input.stride[2] = _xvid_enc_create.width >> 1;
+		_xvid_enc_frame.input.plane[0] = encodeParams->frameData;
+		_xvid_enc_frame.input.plane[1] = encodeParams->frameData + (_xvid_enc_create.width * _xvid_enc_create.height);
+		_xvid_enc_frame.input.plane[2] = encodeParams->frameData + ((_xvid_enc_create.width * _xvid_enc_create.height * 5) >> 2);
+	}
+	else
+	{
+		_xvid_enc_frame.length = -1;
+		_xvid_enc_frame.input.csp = XVID_CSP_NULL;
+	}
+
 	int size = xvid_encore(_xvid_enc_create.handle, XVID_ENC_ENCODE, &_xvid_enc_frame, &xvid_enc_stats);
 
     if (size < 0)
@@ -492,11 +507,19 @@
 	printf("[Xvid] vol_flags = %d\n", xvid_enc_frame->vol_flags);
 
 	printf("[Xvid] quant_intra_matrix = ");
-	printArray(xvid_enc_frame->quant_intra_matrix, 64);
 
+	if (xvid_enc_frame->quant_intra_matrix)
+		printArray(xvid_enc_frame->quant_intra_matrix, 64);
+	else
+		printf("NULL");
+
 	printf("\n[Xvid] quant_inter_matrix = ");
-	printArray(xvid_enc_frame->quant_inter_matrix, 64);
 
+	if (xvid_enc_frame->quant_inter_matrix)
+		printArray(xvid_enc_frame->quant_inter_matrix, 64);
+	else
+		printf("NULL");
+
 	printf("\n[Xvid] par = %d\n", xvid_enc_frame->par);
 	printf("[Xvid] par_width = %d\n", xvid_enc_frame->par_width);
 	printf("[Xvid] par_height = %d\n", xvid_enc_frame->par_height);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-01-11 13:00:18 UTC (rev 4530)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-01-11 13:03:03 UTC (rev 4531)
@@ -52,6 +52,11 @@
 	return "XVID";
 }
 
+int vidEncGetEncoderRequirements(int encoderId)
+{
+	return ADM_VIDENC_REQ_NULL_FLUSH;
+}
+
 int vidEncGetEncoderApiVersion(int encoderId)
 {
 	return ADM_VIDENC_API_VERSION;



From gruntster at mail.berlios.de  Sun Jan 11 14:26:39 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Jan 2009 14:26:39 +0100
Subject: [Avidemux-svn-commit] r4532 -
	branches/avidemux_2.4_branch/avidemux/ADM_toolkit
Message-ID: <200901111326.n0BDQdsR009067@sheep.berlios.de>

Author: gruntster
Date: 2009-01-11 14:26:34 +0100 (Sun, 11 Jan 2009)
New Revision: 4532

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp
Log:
[cli] add AAC parameter to CLI (patch by LoRd_MuldeR) plus a few cosmetic tweaks

Modified: branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp	2009-01-11 13:03:03 UTC (rev 4531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_toolkit/automation.cpp	2009-01-11 13:26:34 UTC (rev 4532)
@@ -184,9 +184,9 @@
         {"audio-map",		0,"build audio map (MP3 VBR)",	call_buildtimemap},
         {"audio-bitrate",	1,"set audio encoding bitrate",	call_audiobitrate},
         {"fps",	                1,"set frames per second",	call_fps},
-        {"audio-codec",		1,"set audio codec (MP2/MP3/AC3/NONE (WAV PCM)/TWOLAME/COPY)",call_audiocodec},
+        {"audio-codec",		1,"set audio codec (AAC/AC3/COPY/MP2/MP3/NONE (WAV PCM)/TWOLAME)",call_audiocodec},
         
-        {"video-codec",		1,"set video codec (Divx/Xvid/FFmpeg4/VCD/SVCD/DVD/XVCD/XSVCD/COPY)",				call_videocodec},
+        {"video-codec",		1,"set video codec (COPY/DV/DVD/FFHUFF/FFmpeg4/FFV1/FLV1/H263/HUFF/MJPEG/REQUANT/SVCD/VCD/x264/XDVD/Xvid4/XVCD/XSVCD/Y800/YV12)", call_videocodec},
         {"video-conf",		1	,"set video codec conf (cq=q|cbr=br|2pass=size)[,mbr=br][,matrix=(0|1|2|3)]",				call_videoconf},
         {"reuse-2pass-log",	0	,"reuse 2pass logfile if it exists",	set_reuse_2pass_log},
         {"set-pp",		2	,"set post processing default value, value(1=hdeblok|2=vdeblock|4=dering) and strength (0-5)",
@@ -388,6 +388,10 @@
 {
 	if(!strcasecmp(p,"MP2"))
 		audioCodecSetcodec( AUDIOENC_MP2 );
+#ifdef USE_FAAC
+	else if(!strcasecmp(p,"AAC"))
+		audioCodecSetcodec( AUDIOENC_FAAC );
+#endif
 	else if(!strcasecmp(p,"AC3"))
 		audioCodecSetcodec( AUDIOENC_AC3 );
 #ifdef HAVE_LIBMP3LAME		
@@ -480,9 +484,9 @@
           printf("\n    --%s, %s ", reaction_table[i].string,reaction_table[i].help_string);
           switch(reaction_table[i].have_arg)
           {
-                  case 0:	 printf(" ( no arg )");break;
-                  case 1:	 printf(" (one arg )");break;
-                  case 2:	 printf(" (two args )");break;
+                  case 0:	 printf(" (no args)");break;
+                  case 1:	 printf(" (one arg)");break;
+                  case 2:	 printf(" (two args)");break;
                   case 3:	 printf(" (three args) ");break;
 
           }



From gruntster at mail.berlios.de  Sun Jan 11 17:57:43 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Jan 2009 17:57:43 +0100
Subject: [Avidemux-svn-commit] r4533 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk
Message-ID: <200901111657.n0BGvhXN005733@sheep.berlios.de>

Author: gruntster
Date: 2009-01-11 17:57:37 +0100 (Sun, 11 Jan 2009)
New Revision: 4533

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
Log:
[xvid] fix encode mode on GTK options window

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-11 13:26:34 UTC (rev 4532)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-01-11 16:57:37 UTC (rev 4533)
@@ -47,6 +47,7 @@
 
 static int cb_mod(GtkObject *object, gpointer user_data);
 static int ch_par_asinput(GtkObject *object, gpointer user_data);
+static int entryEntry_changed(GtkObject* object, gpointer user_data);
 
 #define CALL_Z(x,y)  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),XVID4_RESPONSE_##y);
 
@@ -85,6 +86,7 @@
 
 	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), "changed", GTK_SIGNAL_FUNC(cb_mod), dialog);
 	gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), "clicked", GTK_SIGNAL_FUNC(ch_par_asinput), options);
+	gtk_signal_connect(GTK_OBJECT(WID(entryEntry)), "changed", GTK_SIGNAL_FUNC(entryEntry_changed), dialog);
 
 	CALL_Z(buttonCreateCustomMatrix, EDIT_MATRIX);
 	CALL_Z(buttonLoadMatrix, LOAD_MATRIX);
@@ -387,18 +389,15 @@
 	switch (modeIndex)
 	{
 		case 0:
-			encodeMode = ADM_VIDENC_MODE_AQP;
+			encodeMode = ADM_VIDENC_MODE_CBR;
 			break;
 		case 1:
 			encodeMode = ADM_VIDENC_MODE_CQP;
 			break;
 		case 2:
-			encodeMode = ADM_VIDENC_MODE_CBR;
+			encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
 			break;
 		case 3:
-			encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
-			break;
-		case 4:
 			encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
 			break;
 	}
@@ -449,29 +448,39 @@
 
 int cb_mod(GtkObject *object, gpointer user_data)
 {
-	GtkWidget *dialog = ((GtkWidget*)object)->parent;
+	GtkWidget *dialog = (GtkWidget*)user_data;
 	int r = getRangeInMenu(WID(optionmenuType));
-	int mode = getCurrentEncodeMode(dialog);
 	int encodeModeParameter;
 
-	switch (mode)
+	switch (r)
 	{
-		case ADM_VIDENC_MODE_CBR:
-		case ADM_VIDENC_MODE_2PASS_SIZE:
+		case 0:
+		case 3:
 			encodeModeParameter = _lastBitrate;
 			break;
-		case ADM_VIDENC_MODE_2PASS_ABR:
+		case 1:
+			encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
+			break;
+		case 2:
 			encodeModeParameter = _lastVideoSize;
 			break;
-		default:
-			encodeModeParameter = (int)gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(spinbuttonQuantizer)));
 	}
 
-	updateMode(((GtkWidget*)object)->parent, mode, encodeModeParameter);
+	updateMode(dialog, getCurrentEncodeMode(dialog), encodeModeParameter);
 
 	return 0;
 }
 
+int entryEntry_changed(GtkObject* object, gpointer user_data)
+{
+	GtkWidget *dialog = (GtkWidget*)user_data;
+
+	if (getRangeInMenu(WID(optionmenuType)) == 2)
+		_lastVideoSize = atoi(gtk_entry_get_text(GTK_ENTRY(WID(entryEntry))));
+	else
+		_lastBitrate = atoi(gtk_entry_get_text(GTK_ENTRY(WID(entryEntry))));
+}
+
 int ch_par_asinput(GtkObject *object, gpointer user_data)
 {
 	XvidOptions *options = (XvidOptions*)user_data;



From gruntster at mail.berlios.de  Tue Jan 13 21:04:39 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Jan 2009 21:04:39 +0100
Subject: [Avidemux-svn-commit] r4534 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <200901132004.n0DK4dlV010109@sheep.berlios.de>

Author: gruntster
Date: 2009-01-13 21:04:35 +0100 (Tue, 13 Jan 2009)
New Revision: 4534

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/FindSubversion.cmake
Log:
[cmake] better handling of Subversion XML

Modified: branches/avidemux_2.5_branch_gruntster/cmake/FindSubversion.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/FindSubversion.cmake	2009-01-11 16:57:37 UTC (rev 4533)
+++ branches/avidemux_2.5_branch_gruntster/cmake/FindSubversion.cmake	2009-01-13 20:04:35 UTC (rev 4534)
@@ -67,53 +67,23 @@
       OUTPUT_STRIP_TRAILING_WHITESPACE)
     MESSAGE(STATUS "Getting svn version from ${dir}")
 
-# Old svn info call
-#    EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info . 
-#      WORKING_DIRECTORY ${dir}
-#      OUTPUT_VARIABLE ${prefix}_WC_INFO
-#      ERROR_VARIABLE Subversion_svn_info_error
-#      RESULT_VARIABLE Subversion_svn_info_result
-#      OUTPUT_STRIP_TRAILING_WHITESPACE)
+    EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info --xml . 
+      WORKING_DIRECTORY ${dir}
+      OUTPUT_VARIABLE ${prefix}_WC_INFO
+      ERROR_VARIABLE Subversion_svn_info_error
+      RESULT_VARIABLE Subversion_svn_info_result
+      OUTPUT_STRIP_TRAILING_WHITESPACE)
 
-# New svn info --xml call
-      EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info --xml . 
-        WORKING_DIRECTORY ${dir}
-        OUTPUT_VARIABLE ${prefix}_WC_INFO_XML
-        ERROR_VARIABLE Subversion_svn_info_error
-        RESULT_VARIABLE Subversion_svn_info_result
-        OUTPUT_STRIP_TRAILING_WHITESPACE)
-
     IF(NOT ${Subversion_svn_info_result} EQUAL 0)
       MESSAGE(SEND_ERROR "Command \"${Subversion_SVN_EXECUTABLE} info ${dir}\" failed with output:\n${Subversion_svn_info_error}")
     ELSE(NOT ${Subversion_svn_info_result} EQUAL 0)
-
-      STRING(REGEX REPLACE "^(.*\n)?svn, version ([.0-9]+).*"
-        "\\2" Subversion_VERSION_SVN "${Subversion_VERSION_SVN}")
-
-# Old REGEX REPLACE tests, working with non licalized versions of svn :
-#      STRING(REGEX REPLACE "^(.*\n)?URL: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_URL "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Revision: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_REVISION "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Author: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Rev: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Date: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO}")
-
-# New REGEX REPLACE tests, working with the xml output on all versions :
-      STRING(REGEX REPLACE "(.*)<url>(.*)</url>(.*)"
-        "\\2" ${prefix}_WC_URL "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<entry(.*)revision=\"(.*)\">(.*)"
-        "\\3" ${prefix}_WC_REVISION "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\5" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\3" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\7" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO_XML}")
-
+      STRING(REPLACE "\n" "" ${prefix}_WC_INFO "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE "^(.*\n)?svn, version ([.0-9]+).*" "\\2" Subversion_VERSION_SVN "${Subversion_VERSION_SVN}")
+      STRING(REGEX REPLACE ".*<url>([^<]+)</url>.*" "\\1" ${prefix}_WC_URL "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<entry[^>]+revision=\"([0-9]+)\">.*" "\\1" ${prefix}_WC_REVISION "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<author>([^<]+)</author>.*" "\\1" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<commit +revision=\"([0-9]+)\".*" "\\1" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<date>([^<]+)</date>.*" "\\1" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO}")
     ENDIF(NOT ${Subversion_svn_info_result} EQUAL 0)
 
     EXECUTE_PROCESS(COMMAND



From gruntster at mail.berlios.de  Thu Jan 15 20:37:41 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Jan 2009 20:37:41 +0100
Subject: [Avidemux-svn-commit] r4535 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200901151937.n0FJbfVw008272@sheep.berlios.de>

Author: gruntster
Date: 2009-01-15 20:37:35 +0100 (Thu, 15 Jan 2009)
New Revision: 4535

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/Makefile.am
Log:
[automake] update build script

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/Makefile.am	2009-01-13 20:04:35 UTC (rev 4534)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/Makefile.am	2009-01-15 19:37:35 UTC (rev 4535)
@@ -6,7 +6,7 @@
 libADM_codecs_a_METASOURCES = AUTO
 
 libADM_codecs_a_SOURCES =  ADM_theora_dec.cpp ADM_ffmp43.cpp \
-	ADM_mjpegEncode.cpp ADM_rgb16.cpp ADM_xvid.cpp ADM_xvideco.cpp ADM_mjpeg.cpp ADM_ffmpeg.cpp \
+	ADM_mjpegEncode.cpp ADM_xvid.cpp ADM_xvideco.cpp ADM_mjpeg.cpp ADM_ffmpeg.cpp \
 	ADM_codecs.cpp ADM_ffmpegConfig.h ADM_mpeg.h ADM_mpeg.cpp  \
 	ADM_xvidcvs.cpp ADM_xvid4.cpp ADM_uyvy.cpp ADM_x264.cpp
 



From gruntster at mail.berlios.de  Fri Jan 16 20:36:37 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 16 Jan 2009 20:36:37 +0100
Subject: [Avidemux-svn-commit] r4536 -
	branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4
Message-ID: <200901161936.n0GJabhx018841@sheep.berlios.de>

Author: gruntster
Date: 2009-01-16 20:36:32 +0100 (Fri, 16 Jan 2009)
New Revision: 4536

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
Log:
[mp4] don't report an error when queue runs out of audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2009-01-15 19:37:35 UTC (rev 4535)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2009-01-16 19:36:32 UTC (rev 4536)
@@ -369,10 +369,7 @@
 					  }
 				  }
 				  else
-				  {
-					  r = 0;
 					  break;
-				  }
 			  }
 
 			  muxer->writeVideoPacket(&bitstream);



From gruntster at mail.berlios.de  Mon Jan 19 23:15:04 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 19 Jan 2009 23:15:04 +0100
Subject: [Avidemux-svn-commit] r4537 - in
	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_codecs
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <200901192215.n0JMF4SG014676@sheep.berlios.de>

Author: gruntster
Date: 2009-01-19 23:14:53 +0100 (Mon, 19 Jan 2009)
New Revision: 4537

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4param.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
Log:
[xvid] remove old Xvid code

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.cpp	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.cpp	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,493 +0,0 @@
-/***************************************************************************
-                          ADM_xvid.cpp  -  description
-                             -------------------
-
-	Use dlopen to open xvid and use it as a separate encoder
- 	Decoding is still done by divx
-
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-
-#include <string.h>
-#include <math.h>
-
-#include "ADM_default.h"
-
-#include "ADM_codecs/ADM_codec.h"
-//#include "ADM_gui/GUI_xvidparam.h"
-
-#include "ADM_assert.h"
-
-//static myENC_RESULT xvid_res;
-
-
-#ifdef USE_XX_XVID
-#include "ADM_codecs/ADM_xvid.h"
-#include "xvid.h"
-
-void *dllHandle = NULL;
-
-// api v2.0
-/*
-typedef int(*XVID_PROTO) (void *handle, int opt,  void *param1, void *param2);
-
-XVID_PROTO xx_xvid_init=NULL;
-XVID_PROTO xx_xvid_encore=NULL;
-XVID_PROTO xx_xvid_decore=NULL;
-*/
-//
-static XVID_ENC_FRAME fr;
-static XVID_ENC_PARAM xparam;
-static XVID_ENC_STATS xstats;
-
-
-
-
-
-/*
-		Returns stat in Xvid Format 
-*/
-void *
-xvidEncoder::getXvidStat (void)
-{
-
-  return (void *) &xstats;
-
-}
-//____________________________________________
-//
-//  Initialize the compressor
-//
-uint8_t xvidEncoder::stopEncoder (void)
-{
-  int
-    ret;
-
-  ADM_assert (_init);
-
-  ret = xvid_encore (_handle, XVID_ENC_DESTROY, 0, 0);
-  _init = 0;
-  _handle = NULL;
-  if (ret == XVID_ERR_OK)
-    return 1;
-  return 0;
-}
-// Take from Xvid VFW code
-static int const
-  divx4_motion_presets[7] = {
-  0,
-  PMV_EARLYSTOP16,
-  PMV_EARLYSTOP16 | PMV_ADVANCEDDIAMOND16,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EARLYSTOP8 | PMV_HALFPELREFINE8,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EARLYSTOP8 | PMV_HALFPELREFINE8,
-  PMV_EARLYSTOP16 | PMV_HALFPELREFINE16 | PMV_EXTSEARCH16 | PMV_EARLYSTOP8 |
-    PMV_HALFPELREFINE8
-};
-
-
-/* Divx4 quality to general encoder flag presets */
-static int const
-  divx4_general_presets[7] = {
-  0,
-  0,
-  0,
-  0 | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL,
-  0 | XVID_INTER4V | XVID_HALFPEL
-};
-
-
-
-void
-xvidEncoder::checkFlags (xvidEncParam * extend)
-{
-
-  if (!extend)
-    {
-      // default : HPel & H263Quant
-      encode_flags = 0;
-      encode_flags |= XVID_HALFPEL;
-      encode_flags |= XVID_H263QUANT;
-      motion_flags = divx4_motion_presets[4];
-      return;
-    }
-  //
-  encode_flags = 0;
-  encode_flags |= extend->quantizer;
-  encode_flags |= divx4_general_presets[extend->gui_option];
-  motion_flags = divx4_motion_presets[extend->gui_option];
-  if (extend->interlaced)
-    encode_flags |= XVID_INTERLACING;
-}
-
-void
-xvidEncoder::dumpConf (void)
-{
-
-#define CHK(x) if( encode_flags & XVID_##x) printf("\n"#x" is set");
-
-  CHK (CUSTOM_QMATRIX);
-  CHK (H263QUANT);
-  CHK (MPEGQUANT);
-  CHK (HALFPEL);
-  CHK (ADAPTIVEQUANT);
-  CHK (LUMIMASKING);
-//CHK(LATEINTRA                   );
-
-  CHK (INTERLACING);
-  CHK (TOPFIELDFIRST);
-  CHK (ALTERNATESCAN);
-  CHK (HINTEDME_GET);
-  CHK (HINTEDME_SET);
-  CHK (INTER4V);
-  CHK (ME_ZERO);
-  CHK (ME_LOGARITHMIC);
-  CHK (ME_FULLSEARCH);
-  CHK (ME_PMVFAST);
-  CHK (ME_EPZS);
-
-#undef CHK
-#define CHK(x) if( motion_flags & PMV_##x) printf("\n"#x" is set");
-  CHK (EARLYSTOP16);
-  CHK (ADVANCEDDIAMOND16);
-  CHK (HALFPELREFINE16);
-  CHK (EARLYSTOP8);
-  CHK (HALFPELREFINE8);
-  CHK (EXTSEARCH16);
-
-  printf ("Max key interval : %d\n", xparam.max_key_interval);
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CBR
-// *************************************************
-// *************************************************
-uint8_t xvidEncoderCBR::init (uint32_t br, uint32_t fps1000)
-{
-  UNUSED_ARG (fps1000);
-  return initExtented (br, NULL);
-}
-uint8_t xvidEncoderCBR::init (uint32_t br, uint32_t fps1000, uint32_t extra)
-{
-  UNUSED_ARG (fps1000);
-  UNUSED_ARG (extra);
-  return initExtented (br, NULL);
-}
-
-uint8_t xvidEncoderCBR::initExtented (uint32_t br, xvidEncParam * extend)
-{
-  XVID_INIT_PARAM
-    xinit;
-  int
-    xerr;
-  encode_flags = 0;
-  checkFlags (extend);
-
-
-  memset (&xinit, 0, sizeof (xinit));
-  memset (&fr, 0, sizeof (fr));
-  //---
-  _br = br;
-  printf (" Xvid : Compressing %lu x %lu video in CBR %lu\n", _w, _h, _br);
-  ADM_assert (0 == _init);
-
-  xinit.cpu_flags = XVID_CPU_MMX;
-  xvid_init (NULL, 0, &xinit, NULL);
-
-  xparam.width = _w;
-  xparam.height = _h;
-  xparam.fincr = 1;
-  xparam.fbase = 25;
-
-  xparam.rc_bitrate = _br;
-  xparam.rc_reaction_delay_factor = 16;
-  xparam.rc_averaging_period = 100;
-  xparam.rc_buffer = 100;
-
-  xparam.min_quantizer = 2;
-  xparam.max_quantizer = 31;
-  xparam.max_key_interval = extend->max_key_interval;
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xparam, NULL);
-  if (XVID_ERR_OK != xerr)
-    {
-      printf ("\n Error initializing xvid !!!");
-      return 0;
-    }
-
-  _handle = xparam.handle;
-  dumpConf ();
-  return 1;
-}
-
-
-//
-//      Encode a single frame
-//
-uint8_t
-  xvidEncoderCBR::encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  // general features
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in->data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in <xvid.h>
-
-  xframe.intra = -1;		// let the codec decide between I-frame (1) and P-frame (0)
-  xframe.quant = 0;
-//        xframe.quant = QUANTI;        // is quant != 0, use a fixed quant (and ignore bitrate)
-
-
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &xframe, &xstats);
-
-/*	        enc_result->is_key_frame = xframe.intra;
-	        enc_result->quantizer = xframe.quant;
-	        enc_result->total_bits = xframe.length * 8;
-	        enc_result->motion_bits = xstats.hlength * 8;
-	        enc_result->texture_bits = enc_result->total_bits - enc_result->motion_bits;
-*/
-
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.out_quantizer = xstats.quant;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-/*  This is statictical data, e.g. for 2-pass.
-    If you are not interested in any of this, you can use NULL instead of &xstats
-*/
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-
-uint8_t xvidEncoderCQ::init (uint32_t q, uint32_t fps1000)
-{
-  UNUSED_ARG (fps1000);
-  return initExtented (q, NULL);
-}
-uint8_t xvidEncoderCQ::init (uint32_t q, uint32_t fps1000, uint32_t extra)
-{
-  UNUSED_ARG (fps1000);
-  UNUSED_ARG (extra);
-  return initExtented (q, NULL);
-}
-
-uint8_t xvidEncoderCQ::initExtented (uint32_t q, xvidEncParam * extend)
-{
-  XVID_INIT_PARAM
-    xinit;
-  int
-    xerr;
-
-  checkFlags (extend);
-  memset (&xinit, 0, sizeof (xinit));
-  memset (&fr, 0, sizeof (fr));
-  //xinit.cpu_flags=XVID_CPU_FORCE;
-  xinit.cpu_flags = XVID_CPU_MMX;
-  //---
-  _q = q;
-  printf (" Xvid : Compressing %lu x %lu video in CQ %lu\n", _w, _h, _q);
-  ADM_assert (0 == _init);
-
-
-  xvid_init (NULL, 0, &xinit, NULL);
-
-  xparam.width = _w;
-  xparam.height = _h;
-  xparam.fincr = 1;
-  xparam.fbase = 25;
-
-  xparam.rc_bitrate = 1000;
-  xparam.rc_reaction_delay_factor = 16;
-  xparam.rc_averaging_period = 100;
-  xparam.rc_buffer = 100;
-
-
-  xparam.min_quantizer = _q;
-  xparam.max_quantizer = _q;
-  xparam.max_key_interval = extend->max_key_interval;
-
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xparam, NULL);
-  if (XVID_ERR_OK != xerr)
-    {
-      printf ("\n Error initializing xvid !!!");
-      return 0;
-    }
-  _handle = xparam.handle;
-  dumpConf ();
-  return 1;
-}
-
-//
-
-uint8_t
-  xvidEncoderCQ::encode (ADMImage * in,
-			 uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  memset (&xframe, 0, sizeof (xframe));
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in->data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in <xvid.h>
-
-  xframe.intra = -1;		// let the codec decide between I-frame (1) and P-frame (0)
-  xframe.quant = _q;
-//        xframe.quant = QUANTI;        // is quant != 0, use a fixed quant (and ignore bitrate)
-
-
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &xframe, &xstats);
-
-/*	        enc_result->is_key_frame = xframe.intra;
-	        enc_result->quantizer = xframe.quant;
-	        enc_result->total_bits = xframe.length * 8;
-	        enc_result->motion_bits = xstats.hlength * 8;
-	        enc_result->texture_bits = enc_result->total_bits - enc_result->motion_bits;
-*/
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-  xvid_res.out_quantizer = xstats.quant;
-/*  This is statictical data, e.g. for 2-pass.
-    If you are not interested in any of this, you can use NULL instead of &xstats
-*/
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-
-}
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-
-uint8_t
-  xvidEncoderVBR::encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags)
-{
-  uint16_t q;
-  uint8_t kf;
-
-  q = (*flags) >> 8;
-  kf = (*flags) & 1;
-  return encodeVBR (in, out, len, flags, q, kf);
-
-
-}
-uint8_t
-  xvidEncoderVBR::encodeVBR (ADMImage * in,
-			     uint8_t * out,
-			     uint32_t * len,
-			     uint32_t * flags, uint16_t nq, uint8_t forcekey)
-{
-
-  XVID_ENC_FRAME xframe;
-
-  int xerr;
-
-  memset (&xframe, 0, sizeof (xframe));
-
-  xframe.general = encode_flags;
-  xframe.motion = motion_flags;
-
-  xframe.bitstream = out;
-  xframe.length = -1;		// this is written by the routine
-
-  xframe.image = in->data;
-  xframe.colorspace = XVID_CSP_YV12;	// defined in <xvid.h>
-
-  if (forcekey)
-    xframe.intra = 1;		// let the codec decide between I-frame (1) and P-frame (0)
-  else
-    xframe.intra = 0;		// let the codec decide between I-frame (1) and P-frame (0)
-
-  xframe.quant = nq;
-  xerr = xvid_encore (_handle, XVID_ENC_ENCODE, &xframe, &xstats);
-
-  xvid_res.is_key_frame = xframe.intra;
-  xvid_res.quantizer = xframe.quant;
-  xvid_res.out_quantizer = xstats.quant;
-  xvid_res.total_bits = xframe.length * 8;
-  xvid_res.motion_bits = xstats.hlength * 8;
-  xvid_res.texture_bits = xvid_res.total_bits - xvid_res.motion_bits;
-
-  *len = xframe.length;
-
-  *flags = 0;
-  if (xerr != XVID_ERR_OK)
-    return 0;
-  if (xframe.intra)
-    {
-      *flags = AVI_KEY_FRAME;
-    }
-
-  return 1;
-
-}
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.h	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid.h	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,102 +0,0 @@
-/***************************************************************************
-                          ADM_xvid.h.h  -  description
-                             -------------------
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifdef USE_XX_XVID
-
-
-
-#include "ADM_gui/GUI_xvidparam.h"
-
-class xvidEncoder
-{
-protected:uint32_t _w, _h;
-  uint8_t _init;
-  void *_handle;
-  uint32_t encode_flags;
-  uint32_t motion_flags;
-
-  void dumpConf (void);
-  void checkFlags (xvidEncParam * extend = NULL);
-
-public:void *getXvidStat (void);
-    xvidEncoder (uint32_t width, uint32_t height)
-    // : divxEncoder(width,height)
-  {
-    _w = width;
-    _h = height;
-    _init = 0;
-  };
-  uint8_t stopEncoder (void);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000) = 0;
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra) = 0;
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL) =
-    0;
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out,
-			  uint32_t * len, uint32_t * flags) = 0;
-
-
-};
-class xvidEncoderCBR:public xvidEncoder
-{
-protected:uint32_t _br;
-public:xvidEncoderCBR (uint32_t width, uint32_t height):xvidEncoder (width,
-								height)
-  {
-  };
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra);
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-};
-class xvidEncoderCQ:public xvidEncoder
-{
-protected:uint32_t _q;
-
-
-public:xvidEncoderCQ (uint32_t width, uint32_t height):xvidEncoder (width,
-							       height)
-  {
-
-  };
-  virtual uint8_t initExtented (uint32_t val, xvidEncParam * extend = NULL);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint32_t extra);
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-};
-class xvidEncoderVBR:public xvidEncoderCQ
-{
-protected: public:xvidEncoderVBR (uint32_t width,
-		  uint32_t height):xvidEncoderCQ (width,
-						  height)
-  {
-
-  };
-
-  virtual uint8_t encode (ADMImage * in,
-			  uint8_t * out, uint32_t * len, uint32_t * flags);
-  uint8_t encodeVBR (ADMImage * in,
-		     uint8_t * out,
-		     uint32_t * len,
-		     uint32_t * flags, uint16_t nq, uint8_t forcekey);
-
-};
-
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.cpp	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,794 +0,0 @@
-/***************************************************************************
-                          ADM_xvid4.cpp  -  description
-                             -------------------
-
-	Xvid4 api
-
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-
-#include "ADM_default.h"
-#include "ADM_codecs/ADM_codec.h"
-#ifdef USE_XVID_4
-
-#include "ADM_codecs/ADM_xvid4param.h"
-#include "ADM_codecs/ADM_xvid4.h"
-#include "xvid.h"
-#include "ADM_assert.h"
-#include "prefs.h"
-
-#include "ADM_editor/ADM_edit.hxx"
-extern ADM_Composer *video_body;
-
-#ifdef __WIN32
-extern void convertPathToAnsi(const char *path, char **ansiPath);
-#endif
-
-static const int motion_presets[] = {
-  0,
-  0,
-  0,
-  0,
-  XVID_ME_HALFPELREFINE16,
-  XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,
-  XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 |
-    XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
-};
-
-#define ME_ELEMENTS (sizeof(motion_presets)/sizeof(motion_presets[0]))
-
-
-#define VOP_ELEMENTS (sizeof(vop_presets)/sizeof(vop_presets[0]))
-
-
-static xvid_gbl_init_t xvid_gbl_init2;
-static xvid_enc_create_t xvid_enc_create;
-static xvid_plugin_single_t single;
-static xvid_plugin_2pass1_t pass1;
-static xvid_plugin_2pass2_t pass2;
-static xvid_enc_plugin_t plugins[7];
-static xvid_enc_frame_t xvid_enc_frame;
-static xvid_enc_stats_t xvid_enc_stats;
-static xvid_gbl_info_t xvid_gbl_info;
-static uint32_t xvid_framenum;
-#define MMSET(x) memset(&x,0,sizeof(x))
-
-/******/
-static int
-adm_hook (void *handle, int opt, void *param1, void *param2)
-{
-  xvid_plg_data_t *data = (xvid_plg_data_t *) param1;
-  // printf("Pass %d value %d\n",opt,data->frame_num);
-  if (opt == XVID_PLG_FRAME)
-    {
-
-      xvid_framenum = data->frame_num;
-      //printf("Before called with %u\n",xvid_framenum);
-    }
-
-
-  return 0;
-}
-
-uint8_t xvid4Encoder::encode(ADMImage * in,ADMBitstream * out)
-{
-    /* Encode the frame */
-    xvid_enc_frame.bitstream = out->data;
-	preAmble (in ? in->data : NULL);
-
-    int ret = xvid_encore (_handle, XVID_ENC_ENCODE, &xvid_enc_frame, &xvid_enc_stats);
-
-    if (ret < 0)
-    {
-        printf ("[xvid] Error calling xvid4 %d\n", ret);
-        return 0;
-    }
-
-    postAmble (out);
-    out->len = ret;
-
-    return 1;
-}
-
-void xvid4_init (void);
-/*
-	System wide init, do it once for all
-*/
-void
-xvid4_init (void)
-{
-  MMSET (xvid_gbl_init2);
-  MMSET (xvid_gbl_info);
-
-  printf ("[xvid] Initializing global Xvid 4\n");
-  xvid_gbl_init2.version = XVID_VERSION;
-  xvid_global (NULL, XVID_GBL_INIT, &xvid_gbl_init2, NULL);
-  xvid_gbl_info.version = XVID_VERSION;
-  xvid_global (NULL, XVID_GBL_INFO, &xvid_gbl_info, NULL);
-
-  if (xvid_gbl_info.build)
-      printf ("[xvid] Build: %s\n", xvid_gbl_info.build);
-
-  printf ("[xvid] SIMD supported: (%x)\n", xvid_gbl_info.cpu_flags);
-#define CPUF(x) if(xvid_gbl_info.cpu_flags  & XVID_CPU_##x) printf("\t\t"#x"\n");
-#ifdef ADM_CPU_X86
-  CPUF (MMX);
-  CPUF (MMXEXT);
-  CPUF (SSE);
-  CPUF (SSE2);
-  CPUF (3DNOW);
-  CPUF (3DNOWEXT);
-#endif
-#ifdef ADM_CPU_ALTIVEC
-  CPUF (ALTIVEC);
-#endif
-
-}
-xvid4Encoder::~xvid4Encoder ()
-{
-  stopEncoder ();
-}
-//--------------------------------------------------
-
-uint8_t
-  xvid4Encoder::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
-{
-  return 0;
-}
-
-
-void
-xvid4Encoder::createUpdate (void)
-{
-  uint32_t threads = 0;
-
-  prefs->get(FEATURE_THREADING_XVID, &threads);
-
-  if (threads == 0)
-	  xvid_enc_create.num_threads = xvid_gbl_info.num_threads;
-  else if (threads > 1)
-	  xvid_enc_create.num_threads = threads;
-  else
-      xvid_enc_create.num_threads = 0;
-
-  if (xvid_enc_create.num_threads)
-      printf ("[xvid] using %u threads\n", xvid_enc_create.num_threads);
-
-  xvid_enc_create.max_bframes = _param.bframes;
-  xvid_enc_create.max_key_interval = _param.max_key_interval;
-  xvid_enc_create.bquant_ratio = _param.bquant_ratio;
-  xvid_enc_create.bquant_offset = _param.bquant_offset;
-
-  if (_param.packed)
-    xvid_enc_create.global |=XVID_GLOBAL_PACKED;
-
-  if (_param.closed_gop)
-    xvid_enc_create.global |=XVID_GLOBAL_CLOSED_GOP;
-
-  for (uint32_t i = 0; i < 3; i++)
-    {
-      xvid_enc_create.min_quant[i] = _param.qmin[i];
-      xvid_enc_create.max_quant[i] = _param.qmax[i];
-    }
-
-  preAmble (NULL);
-#define C_VOP(x) if(xvid_enc_frame.vop_flags& XVID_VOP_##x) printf("[xvid] Vop: "#x" is set\n");
-#define C_VOL(x) if(xvid_enc_frame.vol_flags& XVID_VOL_##x) printf("[xvid] Vol: "#x" is set\n");
-#define C_ME(x) if(xvid_enc_frame.motion& XVID_ME_##x) printf("[xvid] ME: "#x" is set\n");
-
-  C_VOP (DEBUG);
-  C_VOP (CHROMAOPT);
-  C_VOP (HALFPEL);
-  C_VOP (INTER4V);
-  C_VOP (TRELLISQUANT);
-  C_VOP (CHROMAOPT);
-  C_VOP (CARTOON);
-  C_VOP (GREYSCALE);
-  C_VOP (HQACPRED);
-  C_VOP (MODEDECISION_RD);
-
-  C_VOL (MPEGQUANT);
-  C_VOL (EXTRASTATS);
-  C_VOL (GMC);
-  C_VOL (QUARTERPEL);
-  C_VOL (INTERLACING);
-
-  C_ME (ADVANCEDDIAMOND16);
-  C_ME (ADVANCEDDIAMOND8);
-
-  C_ME (USESQUARES16);
-  C_ME (USESQUARES8);
-
-  C_ME (HALFPELREFINE16);
-  C_ME (HALFPELREFINE8);
-
-  // Turbo Mode
-  C_ME (FASTREFINE16);
-  C_ME (FASTREFINE8);
-  C_ME (SKIP_DELTASEARCH);
-  C_ME (FAST_MODEINTERPOLATE);
-  C_ME (BFRAME_EARLYSTOP);
-
-  C_ME (GME_REFINE);
-  C_ME (QUARTERPELREFINE8);
-  C_ME (QUARTERPELREFINE16);
-  C_ME (EXTSEARCH16);
-  C_ME (EXTSEARCH8);
-  C_ME (CHROMA_BVOP);
-  C_ME (CHROMA_PVOP);
-  MMSET (xvid_enc_frame);
-
-
-}
-
-void
-xvid4Encoder::dump (void)
-{
-  printf ("[xvid] Configuration:\n");
-  if (_param.mpegQuantizer)
-    printf ("\t\tMPEGQUANT\n");
-  if (_param.interlaced)
-    printf ("\t\tINTERLACED\n");
-
-
-#define ST(x,y) \
-	if(_param.x) printf("\t\t"#y"\n");
-
-
-  ST (inter4mv, INTER4V);
-  ST (trellis, TRELLISQUANT);
-  ST (cartoon, CARTOON);
-  ST (greyscale, GREYSCALE);
-#undef ST
-
-}
-//____________________________________________
-//
-//  Initialize the compressor
-//
-uint8_t
-xvid4Encoder::stopEncoder (void)
-{
-  if (_handle)
-    {
-      xvid_encore (_handle, XVID_ENC_DESTROY, NULL, NULL);
-      printf ("[xvid] Destroying\n");
-      _handle = NULL;
-    }
-  return 1;
-}
-uint8_t
-xvid4Encoder::preAmble (uint8_t * in)
-{
-/* Version for the frame and the stats */
-  //MMSET (xvid_enc_frame);
-  MMSET (xvid_enc_stats);
-
-  xvid_enc_frame.version = XVID_VERSION;
-  xvid_enc_stats.version = XVID_VERSION;
-
-  if (_param.mpegQuantizer || _param.useCustomIntra || _param.useCustomInter)
-    xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
-  if (_param.interlaced)
-    xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
-
-
-#define SVOP(x,y) if(_param.x) xvid_enc_frame.vop_flags|=XVID_VOP_##y
-
-
-  xvid_enc_frame.motion = motion_presets[_param.guiLevel];
-
-  SVOP (inter4mv, INTER4V);
-  SVOP (trellis, TRELLISQUANT);
-  SVOP (hqac, HQACPRED);
-#if  XVID_API==XVID_MAKE_API(4, 1)
-  SVOP (bvhq, RD_BVOP);
-#endif
-
-  SVOP (greyscale, GREYSCALE);
-  SVOP (cartoon, CARTOON);
-  SVOP (chroma_opt, CHROMAOPT);
-  //SVOP(  1      ,HALFPEL);
-  xvid_enc_frame.vop_flags |= XVID_VOP_HALFPEL;
-  // ME
-  if (_param.chroma_me)
-    {
-      xvid_enc_frame.motion |= XVID_ME_CHROMA_BVOP;
-      xvid_enc_frame.motion |= XVID_ME_CHROMA_PVOP;
-    }
-  if (_param.cartoon)
-    {
-      xvid_enc_frame.motion |= XVID_ME_DETECT_STATIC_MOTION;
-    }
-  //printf("Vhq mode : %d\n",_param.vhqmode);
-#define VHME(x) xvid_enc_frame.motion|=	XVID_ME_##x
-  switch (_param.vhqmode)
-    {
-    case 4:
-      VHME (EXTSEARCH_RD);
-    case 3:
-      VHME (HALFPELREFINE8_RD);
-      VHME (QUARTERPELREFINE8_RD);
-      VHME (CHECKPREDICTION_RD);
-
-    case 2:
-      VHME (HALFPELREFINE16_RD);
-      VHME (QUARTERPELREFINE16_RD);
-    case 1:
-      SVOP (vhqmode, MODEDECISION_RD);
-    case 0:
-      break;
-    default:
-      ADM_assert (0);
-    }
-  if (_param.qpel)
-    {
-      xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
-
-      xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
-      xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
-    }
-
-  if (_param.gmc)
-    {
-      xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
-      xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
-    }
-
-  if (_param.turbo)
-    {
-      xvid_enc_frame.motion |= XVID_ME_FASTREFINE16;
-      xvid_enc_frame.motion |= XVID_ME_FASTREFINE8;
-      xvid_enc_frame.motion |= XVID_ME_SKIP_DELTASEARCH;
-      xvid_enc_frame.motion |= XVID_ME_FAST_MODEINTERPOLATE;
-      xvid_enc_frame.motion |= XVID_ME_BFRAME_EARLYSTOP;
-    }
-
-  xvid_enc_frame.bframe_threshold = _param.bframe_threshold;
-  xvid_enc_frame.type = XVID_TYPE_AUTO;
-
-  if (in)
-  {
-	  xvid_enc_frame.length = 0;
-	  xvid_enc_frame.input.csp = XVID_CSP_YV12;
-	  xvid_enc_frame.input.stride[0] = _w;
-	  xvid_enc_frame.input.stride[1] = _w >> 1;
-	  xvid_enc_frame.input.stride[2] = _w >> 1;
-
-	  /* Set up motion estimation flags */
-	  xvid_enc_frame.input.plane[0] = in;
-	  xvid_enc_frame.input.plane[1] = in + (_w * _h);
-	  xvid_enc_frame.input.plane[2] = in + ((_w * _h * 5) >> 2);
-
-	  xvid_enc_frame.par_width = _param.par_width;
-	  xvid_enc_frame.par_height = _param.par_height;
-
-	  if (xvid_enc_frame.par_width != xvid_enc_frame.par_height)
-		  xvid_enc_frame.par = XVID_PAR_EXT;
-	  else
-		  xvid_enc_frame.par = XVID_PAR_11_VGA;
-  }
-  else
-  {
-	  xvid_enc_frame.length = -1;
-	  xvid_enc_frame.input.csp = XVID_CSP_NULL;
-  }
-
-  //printf("Using AR : %u x %u\n",xvid_enc_frame.par_width,xvid_enc_frame.par_height );
-
-  /* Custome matrices */
-  if(_param.useCustomIntra)
-  {
-  if(!xvid_enc_frame.quant_intra_matrix)
-      printf("[xvid] Using custom intra matrix\n");
-      xvid_enc_frame.quant_intra_matrix=_param.intraMatrix;
-  }
-  if(_param.useCustomInter)
-  {
-    if(!xvid_enc_frame.quant_inter_matrix)
-      printf("[xvid] Using custom inter matrix\n");
-     xvid_enc_frame.quant_inter_matrix=_param.interMatrix;
-  }
-  return 1;
-}
-
-uint8_t
-xvid4Encoder::postAmble (ADMBitstream * out)
-{
-  out->flags = 0;
-  if (xvid_enc_frame.out_flags & XVID_KEYFRAME)
-    {
-      out->flags = AVI_KEY_FRAME;
-    }
-  else if (xvid_enc_stats.type == XVID_TYPE_BVOP)
-    {
-      out->flags = AVI_B_FRAME;
-
-    }
-  out->out_quantizer = xvid_enc_stats.quant;
-  out->ptsFrame= xvid_framenum;
-  return 1;
-}
-
-// *************************************************
-// *************************************************
-//                                                                      CQ
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderCQ::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
-{
-  int xerr;
-  printf ("[xvid] CQ mode = %lu (%d x %d)\n", q, _w, _h);
-  _q = q;
-  _fps1000 = fps1000;
-  memcpy (&_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-  MMSET (single);
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-
-  single.version = XVID_VERSION;
-  single.bitrate = 1500;
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
-  if (xerr < 0)
-    {
-      printf ("[xvid] init error: %d\n", xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf ("[xvid] CQ init Ok\n");
-
-  return 1;
-}
-
-
-uint8_t
-xvid4EncoderCQ::encode (ADMImage * in, ADMBitstream * out)
-{
-  int ret;
-
-  xvid_enc_frame.quant = _q;
-  return xvid4Encoder::encode(in,out);
-
-}
-// *************************************************
-// *************************************************
-//              CQ but Q is controlled externally
-// *************************************************
-// *************************************************
-
-uint8_t
-  xvid4EncoderVBRExternal::init (uint32_t q, uint32_t fps1000,
-				 xvid4EncParam * param)
-{
-  int xerr;
-  printf ("[xvid] CQ mode = %lu (%d x %d)\n", q, _w, _h);
-  _q = q;
-  _fps1000 = fps1000;
-  memcpy (&_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-  MMSET (single);
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  single.version = XVID_VERSION;
-  single.bitrate = 1500;
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
-  if (xerr < 0)
-    {
-      printf ("[xvid] init error: %d\n", xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf ("[xvid] CQ init Ok\n");
-
-  return 1;
-}
-
-
-
-
-uint8_t
-  xvid4EncoderVBRExternal::encode (ADMImage * in,
-				      ADMBitstream * out)
-{
-  xvid_enc_frame.quant = out->in_quantizer;
-  if (out->flags & AVI_KEY_FRAME)
-    {
-      xvid_enc_frame.type = XVID_TYPE_IVOP;
-    }
-  else if (out->flags & AVI_B_FRAME)
-    {
-      xvid_enc_frame.type = XVID_TYPE_BVOP;
-    }
-  else
-    {				//P
-      xvid_enc_frame.type = XVID_TYPE_PVOP;
-    }
-    return xvid4Encoder::encode(in,out);
-}
-// *************************************************
-// *************************************************
-//              CBR
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderCBR::init (uint32_t br, uint32_t fps1000, xvid4EncParam * param)
-{
-  int xerr;
-  printf ("[xvid] CBR mode = %lu kbps\n", br);
-  _bitrate = br;
-  _fps1000 = fps1000;
-  memcpy (&_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (single);
-  MMSET (xvid_enc_create);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-  plugins[0].func = xvid_plugin_single;
-  plugins[0].param = &single;
-
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  single.version = XVID_VERSION;
-  single.bitrate = _bitrate * 1000;	// Kb->bit
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
-  if (xerr < 0)
-    {
-      printf ("[xvid] Init error: %d\n", xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf ("[xvid] CBR init Ok\n");
-
-  return 1;
-}
-
-
-uint8_t
-xvid4EncoderCBR::encode (ADMImage * in, ADMBitstream * out)
-{
-  xvid_enc_frame.quant = 0;
-  return xvid4Encoder::encode(in,out);
-}
-// *************************************************
-// *************************************************
-//              Pass1
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderPass1::init (uint32_t br, uint32_t fps1000,
-			   xvid4EncParam * param)
-{
-  int xerr;
-  printf ("[xvid] Pass 1 of 2 (log: %s)\n",
-	  (char *) param->logName);
-
-  _fps1000 = fps1000;
-  memcpy (&_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  MMSET (pass1);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-
-  plugins[0].func = xvid_plugin_2pass1;
-  plugins[0].param = &pass1;
-
-
-  pass1.version = XVID_VERSION;
-
-#ifdef __WIN32
-	char *logFile;
-
-	convertPathToAnsi(_param.logName, &logFile);
-	pass1.filename = logFile;
-#else
-	pass1.filename = ADM_strdup(_param.logName);
-#endif
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 1;
-
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  // Force Qz=2 !
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
-  if (xerr < 0)
-    {
-      printf ("[xvid] Init error: %d\n", xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf ("[xvid] Pass 1 init Ok\n");
-
-  return 1;
-}
-
-xvid4EncoderPass1::~xvid4EncoderPass1()
-{
-	delete pass1.filename;
-	pass1.filename = NULL;
-}
-
-// *************************************************
-// *************************************************
-//              Pass2
-// *************************************************
-// *************************************************
-uint8_t
-  xvid4EncoderPass2::init (uint32_t br, uint32_t fps1000,
-			   xvid4EncParam * param)
-{
-  int xerr;
-  printf
-    ("[xvid] Pass 2 of 2, average bitrate = %lu\n",
-     br);
-  _bitrate = br;
-  _fps1000 = fps1000;
-  memcpy (&_param, param, sizeof (_param));
-  dump ();
-  // Here we go...
-  MMSET (xvid_enc_create);
-  MMSET (pass2);
-
-  xvid_enc_create.version = XVID_VERSION;
-  xvid_enc_create.width = _w;
-  xvid_enc_create.height = _h;
-
-
-
-  plugins[0].func = xvid_plugin_2pass2;
-  plugins[0].param = &pass2;
-  plugins[1].func = adm_hook;
-  plugins[1].param = NULL;
-
-  pass2.version = XVID_VERSION;
-
-#ifdef __WIN32
-	char *logFile;
-
-	convertPathToAnsi(_param.logName, &logFile);
-	pass2.filename = logFile;
-#else
-	pass2.filename = ADM_strdup(_param.logName);
-#endif
-
-  pass2.bitrate = br;		// Average bitrate
-#define CPY(x) pass2.x=_param.x;printf("[xvid] "#x"=%d\n",pass2.x);
-
-  CPY (keyframe_boost);
-  CPY (curve_compression_high);
-  CPY (curve_compression_low);
-  CPY (overflow_control_strength);
-  CPY (max_overflow_improvement);
-  CPY (max_overflow_degradation);
-  CPY (kfreduction);
-  CPY (kfthreshold);
-
-  CPY (container_frame_overhead);
-
-
-
-  xvid_enc_create.plugins = plugins;
-  xvid_enc_create.num_plugins = 2;
-
-  //Framerate
-  xvid_enc_create.fincr = 1000;
-  xvid_enc_create.fbase = _fps1000;
-  //
-  createUpdate ();
-  xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
-  if (xerr < 0)
-    {
-      printf ("[xvid] Init error: %d\n", xerr);
-      return 0;
-
-    }
-
-  _handle = xvid_enc_create.handle;
-
-  printf ("[xvid] Init Ok\n");
-
-  return 1;
-}
-
-xvid4EncoderPass2::~xvid4EncoderPass2()
-{
-	delete pass2.filename;
-	pass2.filename = NULL;
-}
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.h	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4.h	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,134 +0,0 @@
-/***************************************************************************
-                          ADM_xvid4.h.h  -  description
-			  	DevAPI4 xvid encoder
-                             -------------------
-    begin                : Fri Jul 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifdef USE_XVID_4
-
-
-
-#include "ADM_codecs/ADM_xvid4param.h"
-
-class xvid4Encoder:public encoder
-{
-protected:uint8_t _init;
-  void *_handle;
-  uint32_t encode_flags;
-  uint32_t motion_flags;
-  uint32_t _fps1000;
-  xvid4EncParam _param;
-  void dumpConf (void);
-  void checkFlags (xvid4EncParam * extend = NULL);
-  void createUpdate (void);
-
-  uint8_t preAmble (uint8_t * in);
-  uint8_t postAmble (ADMBitstream * out);
-  void dump (void);
-
-public:  xvid4Encoder (uint32_t width, uint32_t height):encoder (width,
-							    height)
-  {
-    _init = 0;
-    _handle = NULL;
-  };
-  ~xvid4Encoder ();
-  void *getXvidStat (void);
-  uint8_t stopEncoder (void);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-
-  uint8_t init (uint32_t a, uint32_t b)
-  {
-    return 0;
-  }				// not used
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out) ;
-};
-
-class xvid4EncoderCQ:public xvid4Encoder
-{
-protected:uint32_t _q;
-
-public:xvid4EncoderCQ (uint32_t width, uint32_t height):xvid4Encoder (width,
-								 height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-};
-class xvid4EncoderVBRExternal:public xvid4Encoder
-{
-protected:uint32_t _q;
-
-public:xvid4EncoderVBRExternal (uint32_t width,
-			   uint32_t height):xvid4Encoder (width,
-							  height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  
-};
-class xvid4EncoderCBR:public xvid4Encoder
-{
-protected:uint32_t _bitrate;	// In kBits!         
-
-public:xvid4EncoderCBR (uint32_t width,
-		   uint32_t height):xvid4Encoder (width, height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-};
-class xvid4EncoderPass1:public xvid4Encoder
-{
-protected: public:xvid4EncoderPass1 (uint32_t width,
-		     uint32_t height):xvid4Encoder (width,
-						    height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  ~xvid4EncoderPass1();
-  
-};
-class xvid4EncoderPass2:public xvid4Encoder
-{
-protected:uint32_t _bitrate;
-
-public:xvid4EncoderPass2 (uint32_t width,
-		     uint32_t height):xvid4Encoder (width, height)
-  {
-
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000,
-			xvid4EncParam * param);
-  ~xvid4EncoderPass2();
-};
-
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4param.h	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_xvid4param.h	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,80 +0,0 @@
-/***************************************************************************
-                          GUI_xvidparam.h  -  description
-                             -------------------
-    begin                : Sun Nov 17 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef XVID4ENCPARAM__
-#define XVID4ENCPARAM__
-
-typedef struct xvid4EncParam
-{
-
-  uint32_t guiLevel;			// equivalent to divx level : Fast/medium/insane
-
-  uint32_t min_key_interval;
-  uint32_t max_key_interval;
-  uint32_t bframes;
-
-  uint32_t mpegQuantizer;		// 0 h263/ 1 Mpeg quantizer
-  uint32_t interlaced;
-  uint32_t inter4mv;
-  uint32_t trellis;
-  uint32_t cartoon;
-  uint32_t greyscale;
-
-  uint32_t qpel;
-  uint32_t gmc;
-  uint32_t bvhq;
-  uint32_t hqac;
-
-  uint32_t   chroma_opt;
-  uint32_t qmin[3];			// IPB
-  uint32_t qmax[3];			// IPB
-
-  uint32_t par_as_input;
-  uint32_t par_width;
-  uint32_t par_height;
-
-
-  // This if for 2 pass   
-  uint32_t keyframe_boost;
-  uint32_t curve_compression_high;
-  uint32_t curve_compression_low;
-  uint32_t overflow_control_strength;
-  uint32_t max_overflow_improvement;
-  uint32_t max_overflow_degradation;
-  uint32_t kfreduction;
-  uint32_t kfthreshold;
-
-  int container_frame_overhead;
-  //
-  uint32_t bquant_ratio;
-  uint32_t bquant_offset;
-  uint32_t vhqmode;
-  uint32_t chroma_me;
-  uint32_t turbo;
-  uint32_t packed;
-  uint32_t closed_gop;
-  uint32_t bframe_threshold;
-  uint32_t useCustomIntra;
-  uint32_t useCustomInter;
-  uint8_t  intraMatrix[64];
-  uint8_t  interMatrix[64];
-  char logName[200];
-} xvid4EncParam;
-
-
-
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,11 +1,6 @@
 SET(ADM_codecs_SRCS 
-	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_theora_dec.cpp   ADM_xvid.cpp
-	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_uyvy.cpp        ADM_xvid4.cpp)
+	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_theora_dec.cpp
+	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_uyvy.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
-
-IF (USE_XVID_4)
-	ADD_SOURCE_CFLAGS(ADM_xvid4.cpp -I${XVID_INCLUDE_DIR})
-ENDIF (USE_XVID_4)
-
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
@@ -4,13 +4,11 @@
 DIA_about.cpp    
  DIA_calculator.cpp  
  DIA_preview.cpp    
- DIA_xvid4.cpp
  DIA_acodec.cpp   
  DIA_encoding.cpp  
  DIA_ocr.cpp      
  DIA_properties.cpp 
  DIA_vcodec.cpp  
- DIA_xvid.cpp
  DIA_idx_pg.cpp    
  DIA_partial.cpp  
  DIA_quota.cpp      

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,547 +0,0 @@
-#include "ADM_toolkitGtk.h"
-#include "ADM_lavcodec.h"
-
-
-
-#include "ADM_encoder/ADM_vidEncode.hxx"
-//#include "ADM_gui/GUI_xvidparam.h"
-#include "prefs.h"
-
-#ifdef USE_XX_XVID 
-#include "xvid.h"
-
-#define FILL_ENTRY(widget_name,value) 		{sprintf(string,"%ld",value);r=-1;   \
-gtk_editable_delete_text(GTK_EDITABLE(lookup_widget(dialog,#widget_name)), 0,-1);\
-gtk_editable_insert_text(GTK_EDITABLE(lookup_widget(dialog,#widget_name)), string, strlen(string), &r);}
-
-
-#define WID(x) lookup_widget(dialog,#x)
-
-#define SPIN_GET(x,y) {myParam->y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(lookup_widget(dialog,#x))) ;\
-				printf(#x":%d\n",myParam->y);}
-
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(lookup_widget(dialog,#x)),(gfloat)myParam->y) ; \
-				printf(#x":%d\n",myParam->y);}
-
-#define MENU_SET(x,y) { gtk_option_menu_set_history (GTK_OPTION_MENU(WID(x)),myParam->y);}
-
-static GtkWidget	*create_dialog1 (void);
-static void xvidFill(GtkWidget *dialog,xvidEncParam *myparam);
-static void xvidRead(GtkWidget *dialog,xvidEncParam *myParam);
-
-int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
-		      uint32_t * br,uint32_t *fsize,xvidEncParam *param)
-{
-	GtkWidget *dialog;
-
-	gchar *str;
-	char string[200];
-	int ret=0;
-
-	gint r,b;
-
-	dialog=create_dialog1();
-
-	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
-										GTK_RESPONSE_OK,
-										GTK_RESPONSE_CANCEL,
-										-1);
-        gtk_register_dialog(dialog);
-
-	// set the right select button
- 	switch (*mode)
-	    {
-	    	case COMPRESS_CBR:
-
-			RADIO_SET(radioCBR,1);
-			break;
-
-		case COMPRESS_2PASS:
-			RADIO_SET(radio2Pass,1);
-			break;
-
-	    	case COMPRESS_CQ:
-			RADIO_SET(radioCQ,1);
-			break;
-		}
-	/* set all values, to give the user neccessary defaults if he change the */
-	/* compress radio button */
-	b=*br/1000;
-	FILL_ENTRY(entryCBR,(uint32_t)b);
-	FILL_ENTRY(entry2Pass, *fsize);
-	FILL_ENTRY(entryCQ, *qz);
-
-		xvidFill(dialog,param);
-
-	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-	{
-
-		xvidRead(dialog,param);
-		int r;
-		uint value=0;
-		ret=1;
-		r=RADIO_GET(radioCQ)+(2*RADIO_GET(radioCBR))+(4*RADIO_GET(radio2Pass));
-
-		switch(r)
-			{
-				case 2:
-					*mode = COMPRESS_CBR;
-                                        prefs->set(CODECS_XVID_ENCTYPE,(uint)COMPRESS_CBR);
-				      str =		  gtk_editable_get_chars(GTK_EDITABLE (WID(entryCBR)), 0, -1);
-		      			value = (uint32_t) atoi(str);
-		      			if (value < 3000)
-			  			value *= 1000;
-					prefs->set(CODECS_XVID_BITRATE,value);
-					prefs->get(CODECS_XVID_BITRATE,br);
-			    		ret = 1;
-					break;
-				case 1:
-					*mode = COMPRESS_CQ;
-                                        prefs->set(CODECS_XVID_ENCTYPE,(uint)COMPRESS_CQ);
-		      			str =	  gtk_editable_get_chars(GTK_EDITABLE(WID(entryCQ)), 0,						 -1);
-		      			value = (uint32_t) atoi(str);
-					prefs->set(CODECS_XVID_QUANTIZER,value);
-					prefs->get(CODECS_XVID_QUANTIZER,qz);
-					ret = 1;
-		      			break;
-				case 4:
-		     			*mode = COMPRESS_2PASS;
-                                        prefs->set(CODECS_XVID_ENCTYPE,(uint)COMPRESS_2PASS);
-		       			str=gtk_editable_get_chars(GTK_EDITABLE(WID(entry2Pass)), 0,	 -1);
-		      			value = (uint32_t) atoi(str);
-					prefs->set(CODECS_XVID_FINALSIZE,value);
-					prefs->get(CODECS_XVID_FINALSIZE,fsize);
-				      	ret=1;
-            				break;
-		  		default:
-		      				ADM_assert(0);
-				}
-	}
-        gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-	return ret;
-
-}
-static 					uint32_t  stQuant[2]={XVID_H263QUANT,XVID_MPEGQUANT};
-
-/*
-
-*/
-void xvidFill(GtkWidget *dialog,xvidEncParam *myParam)
-{
-
-	 SPIN_SET(spinImin,imin);
-	 SPIN_SET(spinImax,imax);
-	 SPIN_SET(spinPmin,pmin);
-	 SPIN_SET(spinPmax,pmax);
-
-	 SPIN_SET(spinbuttonMaxIFrame,max_key_interval);
-	 SPIN_SET(spinbuttonMinIFrame,min_key_interval);
-
-	 if(myParam->quantizer==stQuant[0])
-	 	gtk_option_menu_set_history (GTK_OPTION_MENU(WID(optionQzer)),0);
-	else
-		gtk_option_menu_set_history (GTK_OPTION_MENU(WID(optionQzer)),1);
-
-	MENU_SET(optionME,gui_option);
-
-}
-void xvidRead(GtkWidget *dialog,xvidEncParam *myParam)
-{
-
-	 SPIN_GET(spinImin,imin);
-	 SPIN_GET(spinImax,imax);
-	 SPIN_GET(spinPmin,pmin);
-	 SPIN_GET(spinPmax,pmax);
-
-	 SPIN_GET(spinbuttonMaxIFrame,max_key_interval);
-	 SPIN_GET(spinbuttonMinIFrame,min_key_interval);
-
-	myParam->quantizer	= stQuant[getRangeInMenu(WID(optionQzer))];
-	myParam->gui_option	= getRangeInMenu(WID(optionME));
-
-}
-GtkWidget *create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *notebook1;
-  GtkWidget *table1;
-  GtkWidget *radioCQ;
-  GSList *radioCQ_group = NULL;
-  GtkWidget *radioCBR;
-  GtkWidget *radio2Pass;
-  GtkWidget *entryCQ;
-  GtkWidget *entryCBR;
-  GtkWidget *entry2Pass;
-  GtkWidget *label1;
-  GtkWidget *table2;
-  GtkWidget *label5;
-  GtkWidget *label6;
-  GtkWidget *label7;
-  GtkObject *spinbuttonMaxIFrame_adj;
-  GtkWidget *spinbuttonMaxIFrame;
-  GtkWidget *label8;
-  GtkObject *spinbuttonMinIFrame_adj;
-  GtkWidget *spinbuttonMinIFrame;
-  GtkWidget *optionME;
-  GtkWidget *menu4;
-  GtkWidget *_0___none1;
-  GtkWidget *_1__very_low1;
-  GtkWidget *_2__low1;
-  GtkWidget *_3__medium1;
-  GtkWidget *_4__high1;
-  GtkWidget *_5__very_high1;
-  GtkWidget *_6__ultra_high1;
-  GtkWidget *optionQzer;
-  GtkWidget *menu5;
-  GtkWidget *h263_quantizer1;
-  GtkWidget *mpeg_quantizer1;
-  GtkWidget *label2;
-  GtkWidget *table3;
-  GtkWidget *label9;
-  GtkWidget *label10;
-  GtkWidget *label11;
-  GtkWidget *label12;
-  GtkObject *spinImin_adj;
-  GtkWidget *spinImin;
-  GtkObject *spinImax_adj;
-  GtkWidget *spinImax;
-  GtkObject *spinPmin_adj;
-  GtkWidget *spinPmin;
-  GtkObject *spinPmax_adj;
-  GtkWidget *spinPmax;
-  GtkWidget *label3;
-  GtkWidget *label13;
-  GtkWidget *label4;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("Xvid Encoder"));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  notebook1 = gtk_notebook_new ();
-  gtk_widget_show (notebook1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), notebook1, TRUE, TRUE, 0);
-
-  table1 = gtk_table_new (3, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_container_add (GTK_CONTAINER (notebook1), table1);
-
-  radioCQ = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("Constant Quantizer"));
-  gtk_widget_show (radioCQ);
-  gtk_table_attach (GTK_TABLE (table1), radioCQ, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radioCQ), radioCQ_group);
-  radioCQ_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radioCQ));
-
-  radioCBR = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("Constant Bitrate (kbps)"));
-  gtk_widget_show (radioCBR);
-  gtk_table_attach (GTK_TABLE (table1), radioCBR, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radioCBR), radioCQ_group);
-  radioCQ_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radioCBR));
-
-  radio2Pass = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("Dual pass (MBytes)"));
-  gtk_widget_show (radio2Pass);
-  gtk_table_attach (GTK_TABLE (table1), radio2Pass, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radio2Pass), radioCQ_group);
-  radioCQ_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radio2Pass));
-
-  entryCQ = gtk_entry_new ();
-  gtk_widget_show (entryCQ);
-  gtk_table_attach (GTK_TABLE (table1), entryCQ, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  entryCBR = gtk_entry_new ();
-  gtk_widget_show (entryCBR);
-  gtk_table_attach (GTK_TABLE (table1), entryCBR, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  entry2Pass = gtk_entry_new ();
-  gtk_widget_show (entry2Pass);
-  gtk_table_attach (GTK_TABLE (table1), entry2Pass, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  label1 = gtk_label_new (QT_TR_NOOP("Basic"));
-  gtk_widget_show (label1);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 0), label1);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  table2 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table2);
-  gtk_container_add (GTK_CONTAINER (notebook1), table2);
-
-  label5 = gtk_label_new (QT_TR_NOOP("Motion Search"));
-  gtk_widget_show (label5);
-  gtk_table_attach (GTK_TABLE (table2), label5, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label5), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label5), 0, 0.5);
-
-  label6 = gtk_label_new (QT_TR_NOOP("Quantization"));
-  gtk_widget_show (label6);
-  gtk_table_attach (GTK_TABLE (table2), label6, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label6), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label6), 0, 0.5);
-
-  label7 = gtk_label_new (QT_TR_NOOP("Max I frame interval "));
-  gtk_widget_show (label7);
-  gtk_table_attach (GTK_TABLE (table2), label7, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label7), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label7), 0, 0.5);
-
-  spinbuttonMaxIFrame_adj = gtk_adjustment_new (300, 0, 600, 1, 10, 0);
-  spinbuttonMaxIFrame = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonMaxIFrame_adj), 1, 0);
-  gtk_widget_show (spinbuttonMaxIFrame);
-  gtk_table_attach (GTK_TABLE (table2), spinbuttonMaxIFrame, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonMaxIFrame), TRUE);
-
-  label8 = gtk_label_new (QT_TR_NOOP("Min I frame interval"));
-  gtk_widget_show (label8);
-  gtk_table_attach (GTK_TABLE (table2), label8, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label8), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label8), 0, 0.5);
-
-  spinbuttonMinIFrame_adj = gtk_adjustment_new (1, 0, 600, 1, 10, 0);
-  spinbuttonMinIFrame = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonMinIFrame_adj), 1, 0);
-  gtk_widget_show (spinbuttonMinIFrame);
-  gtk_table_attach (GTK_TABLE (table2), spinbuttonMinIFrame, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonMinIFrame), TRUE);
-
-  optionME = gtk_option_menu_new ();
-  gtk_widget_show (optionME);
-  gtk_table_attach (GTK_TABLE (table2), optionME, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  menu4 = gtk_menu_new ();
-
-  _0___none1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("0 - None"));
-  gtk_widget_show (_0___none1);
-  gtk_container_add (GTK_CONTAINER (menu4), _0___none1);
-
-  _1__very_low1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("1- Very low"));
-  gtk_widget_show (_1__very_low1);
-  gtk_container_add (GTK_CONTAINER (menu4), _1__very_low1);
-
-  _2__low1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("2- Low"));
-  gtk_widget_show (_2__low1);
-  gtk_container_add (GTK_CONTAINER (menu4), _2__low1);
-
-  _3__medium1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("3- Medium"));
-  gtk_widget_show (_3__medium1);
-  gtk_container_add (GTK_CONTAINER (menu4), _3__medium1);
-
-  _4__high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("4- High"));
-  gtk_widget_show (_4__high1);
-  gtk_container_add (GTK_CONTAINER (menu4), _4__high1);
-
-  _5__very_high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("5- Very High"));
-  gtk_widget_show (_5__very_high1);
-  gtk_container_add (GTK_CONTAINER (menu4), _5__very_high1);
-
-  _6__ultra_high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("6- Ultra High"));
-  gtk_widget_show (_6__ultra_high1);
-  gtk_container_add (GTK_CONTAINER (menu4), _6__ultra_high1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionME), menu4);
-
-  optionQzer = gtk_option_menu_new ();
-  gtk_widget_show (optionQzer);
-  gtk_table_attach (GTK_TABLE (table2), optionQzer, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  menu5 = gtk_menu_new ();
-
- h263_quantizer1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("H263 Quantizer"));
-  gtk_widget_show (h263_quantizer1);
-  gtk_container_add (GTK_CONTAINER (menu5), h263_quantizer1);
-
-
-  mpeg_quantizer1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("MPEG Quantizer"));
-  gtk_widget_show (mpeg_quantizer1);
-  gtk_container_add (GTK_CONTAINER (menu5), mpeg_quantizer1);
-
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionQzer), menu5);
-
-  label2 = gtk_label_new (QT_TR_NOOP("Advanced"));
-  gtk_widget_show (label2);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 1), label2);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-
-  table3 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table3);
-  gtk_container_add (GTK_CONTAINER (notebook1), table3);
-
-  label9 = gtk_label_new (QT_TR_NOOP("Min I Frame Qzer"));
-  gtk_widget_show (label9);
-  gtk_table_attach (GTK_TABLE (table3), label9, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label9), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label9), 0, 0.5);
-
-  label10 = gtk_label_new (QT_TR_NOOP("Max I Frame Qzer"));
-  gtk_widget_show (label10);
-  gtk_table_attach (GTK_TABLE (table3), label10, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label10), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label10), 0, 0.5);
-
-  label11 = gtk_label_new (QT_TR_NOOP("Min P Frame Qzer"));
-  gtk_widget_show (label11);
-  gtk_table_attach (GTK_TABLE (table3), label11, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label11), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label11), 0, 0.5);
-
-  label12 = gtk_label_new (QT_TR_NOOP("Max P Frame Qzer"));
-  gtk_widget_show (label12);
-  gtk_table_attach (GTK_TABLE (table3), label12, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label12), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label12), 0, 0.5);
-
-  spinImin_adj = gtk_adjustment_new (2, 2, 31, 1, 10, 0);
-  spinImin = gtk_spin_button_new (GTK_ADJUSTMENT (spinImin_adj), 1, 0);
-  gtk_widget_show (spinImin);
-  gtk_table_attach (GTK_TABLE (table3), spinImin, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinImin), TRUE);
-
-  spinImax_adj = gtk_adjustment_new (2, 2, 31, 1, 10, 0);
-  spinImax = gtk_spin_button_new (GTK_ADJUSTMENT (spinImax_adj), 1, 0);
-  gtk_widget_show (spinImax);
-  gtk_table_attach (GTK_TABLE (table3), spinImax, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinImax), TRUE);
-
-  spinPmin_adj = gtk_adjustment_new (2, 2, 31, 1, 10, 0);
-  spinPmin = gtk_spin_button_new (GTK_ADJUSTMENT (spinPmin_adj), 1, 0);
-  gtk_widget_show (spinPmin);
-  gtk_table_attach (GTK_TABLE (table3), spinPmin, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinPmin), TRUE);
-
-  spinPmax_adj = gtk_adjustment_new (2, 2, 31, 1, 10, 0);
-  spinPmax = gtk_spin_button_new (GTK_ADJUSTMENT (spinPmax_adj), 1, 0);
-  gtk_widget_show (spinPmax);
-  gtk_table_attach (GTK_TABLE (table3), spinPmax, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinPmax), TRUE);
-
-  label3 = gtk_label_new (QT_TR_NOOP("Quantizer"));
-  gtk_widget_show (label3);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 2), label3);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-
-  label13 = gtk_label_new (QT_TR_NOOP("Not Yet!"));
-  gtk_widget_show (label13);
-  gtk_container_add (GTK_CONTAINER (notebook1), label13);
-  gtk_label_set_justify (GTK_LABEL (label13), GTK_JUSTIFY_LEFT);
-
-  label4 = gtk_label_new (QT_TR_NOOP("B Frames"));
-  gtk_widget_show (label4);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 3), label4);
-  gtk_label_set_justify (GTK_LABEL (label4), GTK_JUSTIFY_LEFT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, notebook1, "notebook1");
-  GLADE_HOOKUP_OBJECT (dialog1, table1, "table1");
-  GLADE_HOOKUP_OBJECT (dialog1, radioCQ, "radioCQ");
-  GLADE_HOOKUP_OBJECT (dialog1, radioCBR, "radioCBR");
-  GLADE_HOOKUP_OBJECT (dialog1, radio2Pass, "radio2Pass");
-  GLADE_HOOKUP_OBJECT (dialog1, entryCQ, "entryCQ");
-  GLADE_HOOKUP_OBJECT (dialog1, entryCBR, "entryCBR");
-  GLADE_HOOKUP_OBJECT (dialog1, entry2Pass, "entry2Pass");
-  GLADE_HOOKUP_OBJECT (dialog1, label1, "label1");
-  GLADE_HOOKUP_OBJECT (dialog1, table2, "table2");
-  GLADE_HOOKUP_OBJECT (dialog1, label5, "label5");
-  GLADE_HOOKUP_OBJECT (dialog1, label6, "label6");
-  GLADE_HOOKUP_OBJECT (dialog1, label7, "label7");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonMaxIFrame, "spinbuttonMaxIFrame");
-  GLADE_HOOKUP_OBJECT (dialog1, label8, "label8");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonMinIFrame, "spinbuttonMinIFrame");
-  GLADE_HOOKUP_OBJECT (dialog1, optionME, "optionME");
-  GLADE_HOOKUP_OBJECT (dialog1, menu4, "menu4");
-  GLADE_HOOKUP_OBJECT (dialog1, _0___none1, "_0___none1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1__very_low1, "_1__very_low1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2__low1, "_2__low1");
-  GLADE_HOOKUP_OBJECT (dialog1, _3__medium1, "_3__medium1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4__high1, "_4__high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _5__very_high1, "_5__very_high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _6__ultra_high1, "_6__ultra_high1");
-  GLADE_HOOKUP_OBJECT (dialog1, optionQzer, "optionQzer");
-  GLADE_HOOKUP_OBJECT (dialog1, menu5, "menu5");
-  GLADE_HOOKUP_OBJECT (dialog1, h263_quantizer1, "h263_quantizer1");
-  GLADE_HOOKUP_OBJECT (dialog1, mpeg_quantizer1, "mpeg_quantizer1");
-  GLADE_HOOKUP_OBJECT (dialog1, label2, "label2");
-  GLADE_HOOKUP_OBJECT (dialog1, table3, "table3");
-  GLADE_HOOKUP_OBJECT (dialog1, label9, "label9");
-  GLADE_HOOKUP_OBJECT (dialog1, label10, "label10");
-  GLADE_HOOKUP_OBJECT (dialog1, label11, "label11");
-  GLADE_HOOKUP_OBJECT (dialog1, label12, "label12");
-  GLADE_HOOKUP_OBJECT (dialog1, spinImin, "spinImin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinImax, "spinImax");
-  GLADE_HOOKUP_OBJECT (dialog1, spinPmin, "spinPmin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinPmax, "spinPmax");
-  GLADE_HOOKUP_OBJECT (dialog1, label3, "label3");
-  GLADE_HOOKUP_OBJECT (dialog1, label13, "label13");
-  GLADE_HOOKUP_OBJECT (dialog1, label4, "label4");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-
-  return dialog1;
-}
-
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,1637 +0,0 @@
-#include "config.h"
-#include "ADM_toolkitGtk.h"
-#include "DIA_fileSel.h"
-#include "DIA_coreToolkit.h"
-
-#ifdef USE_XVID_4
-#include "ADM_encoder/ADM_vidEncode.hxx"
-
-#include "ADM_codecs/ADM_xvid4param.h"
-#include "avi_vars.h"
-static xvid4EncParam localParam;
-static uint32_t mQ,mB,mS,mA;
-static GtkWidget *dialog=NULL;
-static COMPRESSION_MODE mMode;
-
-
-static GtkWidget *create_dialog1 (void);
-static GtkWidget *create_dialog3 (void);
-
-static void xvid4otherUpload(GtkWidget *dialog);
-static void xvid4otherDownload(GtkWidget *dialog);
-static uint8_t editMatrix(uint8_t *inter, uint8_t *intra);
-static void updateMode( void );
-
-static int cb_mod(GtkObject * object, gpointer user_data);
-static int ch_par_asinput(GtkObject * object, gpointer user_data);
-
-#define CALL_Z(x,y)  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),XVID4_RESPONSE_##y);
-
-typedef enum 
-{
-    XVID4_RESPONSE_MODE_CHANGED,
-    XVID4_RESPONSE_EDIT_MATRIX,
-    XVID4_RESPONSE_LOAD_MATRIX,
-    XVID4_RESPONSE_SAVE_MATRIX,
-    XVID4_RESPONSE_LAST,
-}XVID4_CODE;
-uint8_t DIA_xvid4(COMPRES_PARAMS *incoming)
-{
-int b;
-int ret=0;
-int code;
-      ADM_assert(incoming->extraSettingsLen==sizeof(localParam));
-      memcpy(&localParam,incoming->extraSettings,sizeof(localParam));
-      dialog=create_dialog1();
-
-	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
-										GTK_RESPONSE_OK,
-										GTK_RESPONSE_CANCEL,
-										-1);
-      gtk_register_dialog(dialog);
-
-#define HIST_SET(x) gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), x)
-#define VAL_SET(x) gtk_write_entry(WID(entryEntry), x)
-
-      mQ=incoming->qz;
-      mB=incoming->bitrate; // in kbits
-      mS=incoming->finalsize;	
-      mA=incoming->avg_bitrate;
-      mMode=incoming->mode;
-      updateMode();	
-
-      xvid4otherUpload(dialog);
-      gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), "changed",
-                      GTK_SIGNAL_FUNC(cb_mod),                   (void *) 0);
-
-      gtk_signal_connect(GTK_OBJECT(WID(checkbutton_par_asinput)), "clicked",
-                      GTK_SIGNAL_FUNC(ch_par_asinput),                   (void *) 0);
-
-    CALL_Z(buttonCreateCustomMatrix,EDIT_MATRIX);
-    CALL_Z(buttonLoadMatrix,LOAD_MATRIX);
-      
-_again:
-        code=gtk_dialog_run(GTK_DIALOG(dialog));
-        if(code==XVID4_RESPONSE_EDIT_MATRIX)
-        {
-          uint8_t intra[64],inter[64];
-              memcpy(intra,localParam.intraMatrix,64);
-              memcpy(inter,localParam.interMatrix,64);
-              if(editMatrix(intra,inter))
-              {
-                    memcpy(localParam.intraMatrix,intra,64);
-                    memcpy(localParam.interMatrix,inter,64);
-              }
-              goto _again;
-        }
-        if(code==XVID4_RESPONSE_LOAD_MATRIX)
-        {
-          uint8_t intra[64],inter[64];
-          char *name;
-          FILE *file=NULL;
-          GUI_FileSelRead(QT_TR_NOOP("Select Xvid matrix file to load"), &name);
-               if(!name)
-               {
-                    goto _again;
-               }
-              printf("Loading Matrix\n");
-              file=fopen(name,"rb");
-              if(!file)
-              {
-_erLoad:
-                  if(name) ADM_dealloc(name);
-                  if(file) fclose(file);
-                  GUI_Error_HIG(QT_TR_NOOP("Error Loading"),QT_TR_NOOP("Error loadind the custom matrix file."));
-                  goto _again;
-              }
-              // Read it
-              if(64!=fread(intra,1,64,file))
-              {
-                  printf("Error reading intra\n");
-                  goto _erLoad;
-              }
-              if(64!=fread(inter,1,64,file))
-              {
-                  printf("Error reading inter\n");
-                  goto _erLoad;
-              }
-              // Ok
-              fclose(file);
-              memcpy(localParam.intraMatrix,intra,64);
-              memcpy(localParam.interMatrix,inter,64);
-              GUI_Info_HIG(ADM_LOG_INFO,QT_TR_NOOP("Matrix Loaded"),QT_TR_NOOP("The custom matrix file has been successfully loaded."));
-              goto _again;
-        }
-
-	if(code==GTK_RESPONSE_OK)
-	{
-
-		
-		int r,value=0;
-		ret=1;
-		r=getRangeInMenu(WID(optionmenuType));
-		xvid4otherDownload(dialog);
-		memcpy(incoming->extraSettings,&localParam,sizeof(localParam));
-		switch(r)
-			{
-				case 0:
-					incoming->mode = COMPRESS_CBR;				      
-		      			value = (uint32_t) gtk_read_entry(WID(entryEntry));
-			    		incoming->bitrate = value;
-                                        ret = 1;
-					gtk_label_set_text(GTK_LABEL(WID(label11)),"Bitrate (kbps):");
-					break;
-				case 1:
-					incoming->mode = COMPRESS_CQ;		      			
-					value = (uint32_t) gtk_spin_button_get_value_as_int(
-								GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
-					incoming->qz = value;
-					break;
-
-				case 2:
-		     				incoming->mode = COMPRESS_2PASS;		       				
-						value = (uint32_t) gtk_read_entry(WID(entryEntry));
-        					if((value>0)&&(value<4000))
-          					{
-       							incoming->finalsize=value;
-				      			
-           					}
-						gtk_label_set_text(GTK_LABEL(WID(label11)),QT_TR_NOOP("Size (MBytes):"));
-            					break;
-				case 3:
-		     				incoming->mode = COMPRESS_2PASS_BITRATE;	
-						value = (uint32_t) gtk_read_entry(WID(entryEntry));
-						incoming->avg_bitrate=value;
-						gtk_label_set_text(GTK_LABEL(WID(label11)),QT_TR_NOOP("Average bitrate (kb/s):"));
-            					break;
-
-				case 4:
-						incoming->mode=COMPRESS_SAME;
-						break;
-		  		default:
-		      				ADM_assert(0);
-				}
-	}
-	gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-	return ret;
-
-}
-// Read the localParam struct and set the ui fields
-// accordingly
-#define SPIN_GET(x,y) {localParam.y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-				printf(#x":%d\n",localParam.y);}
-
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)localParam.y) ; \
-				printf(#x":%d\n",localParam.y);}
-
-#define MENU_SET(x,y) { gtk_option_menu_set_history (GTK_OPTION_MENU(WID(x)),localParam.y);}
-#define MENU_GET(x,y) { localParam.y	= getRangeInMenu(WID(x));}
-#define TOGGLE_SET(x,y) {gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}
-#define TOGGLE_GET(x,y) {localParam.y=gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(x)));\
-				printf(#y":%d\n",localParam.y);}
-				
-#define ENTRY_SET(x,y) {gtk_write_entry(WID(x),(int)localParam.y);}
-#define ENTRY_GET(x,y) {localParam.y=gtk_read_entry(WID(x));\
-				printf(#y":%d\n",localParam.y);}
-
-#define CHECK_GET(x,y) {localParam.y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),localParam.y);}			//*****************************************************
-void xvid4otherUpload(GtkWidget *dialog)
-{
-	MENU_SET(optionmenuMS,guiLevel);
-	MENU_SET(optionmenuVHQ,vhqmode);
-        if(localParam.useCustomIntra || localParam.useCustomInter)
-        {
-            RADIO_SET(radiobuttonCustomMatrix,		1);
-        }else
-	if(localParam.mpegQuantizer)
-		RADIO_SET(radiobuttonMpeg,		1);
-	else
-		RADIO_SET(radiobuttonH263,		1);		
-	CHECK_SET(checkbuttonInterlaced,	interlaced);
-	CHECK_SET(checkbutton4MV,		inter4mv);
-	CHECK_SET(checkbuttonTrellis,		trellis);
-	CHECK_SET(checkbuttonCartoon,		cartoon);
-	CHECK_SET(checkbuttonGreyScale,		greyscale);
-	CHECK_SET(checkbuttonChroma,		chroma_opt);
-	CHECK_SET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_SET(checkbuttonGMC,		gmc);
-	CHECK_SET(checkbuttonBVHQ,		bvhq);
-	CHECK_SET(checkbutton_par_asinput,	par_as_input);
-	CHECK_SET(checkbuttonQPel,		qpel);
-	CHECK_SET(checkbuttonHQAC,		hqac);
-	
-	CHECK_SET(checkbuttonTurbo,		turbo);
-	CHECK_SET(checkbuttonPacked,		packed);
-		
-  	SPIN_SET(spinbuttonIMaxPeriod,  max_key_interval);
-	ENTRY_SET(entryIInterv,		min_key_interval);
-	SPIN_SET(spinbuttonBFrame,	bframes);
-	ch_par_asinput(NULL, NULL);
-	
-	SPIN_SET(spinbuttonIMax,	qmax[0]);
-	SPIN_SET(spinbuttonPMax,	qmax[1]);
-	SPIN_SET(spinbuttonBMax,	qmax[2]);
-	
-	SPIN_SET(spinbuttonIMin,	qmin[0]);
-	SPIN_SET(spinbuttonPMin,	qmin[1]);
-	SPIN_SET(spinbuttonBMin,	qmin[2]);
-	
-	
-  	ENTRY_SET(entryIBoost		,	keyframe_boost		);
-	
-  	ENTRY_SET(entryHiPass		,	curve_compression_high	);
-  	ENTRY_SET(entryLowPass		,	curve_compression_low	);
-  	ENTRY_SET(entryOvrControl,		overflow_control_strength	);
-  	
-	ENTRY_SET(entryMaxOvrImp	,	max_overflow_improvement	);
-  	ENTRY_SET(entryMaxOvrDeg	,	max_overflow_degradation	);
-	
-  	ENTRY_SET(entryIreduction	,	kfreduction			);
-  	ENTRY_SET(entryIInterv	,		kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-	
-}
-// Read the ui fields and set localParam
-// accordingly
-//*****************************************************
-
-void xvid4otherDownload(GtkWidget *dialog)
-{
-	MENU_GET(optionmenuMS,guiLevel);
-	MENU_GET(optionmenuVHQ,vhqmode);
-	
-	localParam.mpegQuantizer=RADIO_GET(radiobuttonMpeg);
-        if(RADIO_GET(radiobuttonCustomMatrix))
-        {
-            localParam.useCustomIntra=1;
-            localParam.useCustomInter=1;
-        }else
-        {
-            localParam.useCustomIntra=0;
-            localParam.useCustomInter=0;
-        }
-	CHECK_GET(checkbuttonInterlaced,	interlaced);
-	CHECK_GET(checkbutton4MV,		inter4mv);
-	CHECK_GET(checkbuttonTrellis,		trellis);
-	CHECK_GET(checkbuttonCartoon,		cartoon);
-	CHECK_GET(checkbuttonGreyScale,		greyscale);
-	CHECK_GET(checkbuttonChroma,		chroma_opt);
-	CHECK_GET(checkbuttonChromaMotion,	chroma_me);
-	CHECK_GET(checkbuttonGMC,		gmc);
-	CHECK_GET(checkbuttonBVHQ,		bvhq);
-	CHECK_GET(checkbutton_par_asinput,	par_as_input);
-	CHECK_GET(checkbuttonQPel,		qpel);
-	CHECK_GET(checkbuttonHQAC,		hqac);
-	CHECK_GET(checkbuttonTurbo,		turbo);
-	CHECK_GET(checkbuttonPacked,		packed);
-
-	
-	SPIN_GET(spinbuttonIMaxPeriod,  max_key_interval);	
-  	ENTRY_GET(entryIInterv,			kfthreshold);
-	SPIN_GET(spinbuttonBFrame,		bframes);
-
-	SPIN_GET(spinbutton_par_width,	par_width);
-	SPIN_GET(spinbutton_par_height,	par_height);
-
-
-  	ENTRY_GET(entryIBoost		,	keyframe_boost		);
-	
-  	ENTRY_GET(entryHiPass		,	curve_compression_high	);
-  	ENTRY_GET(entryLowPass		,	curve_compression_low	);
-  	ENTRY_GET(entryOvrControl,		overflow_control_strength	);
-  	
-	ENTRY_GET(entryMaxOvrImp	,	max_overflow_improvement	);
-  	ENTRY_GET(entryMaxOvrDeg	,	max_overflow_degradation	);
-	
-  	ENTRY_GET(entryIreduction	,	kfreduction			);
-  	ENTRY_GET(entryIInterv	,	kfthreshold			);
-	//TOGGLE_SET(toggleHPEL,			halfpel);
-	SPIN_GET(spinbuttonIMax,	qmax[0]);
-	SPIN_GET(spinbuttonPMax,	qmax[1]);
-	SPIN_GET(spinbuttonBMax,	qmax[2]);
-	
-	SPIN_GET(spinbuttonIMin,	qmin[0]);
-	SPIN_GET(spinbuttonPMin,	qmin[1]);
-	SPIN_GET(spinbuttonBMin,	qmin[2]);
-	
-	
-}
-//*****************************************************
-void updateMode( void )
-{
-uint32_t b;
-		// set the right select button
- 		switch (mMode)
-	    {
-	    	case COMPRESS_CBR:
-			HIST_SET(0);			
-			b=mB;
-			VAL_SET(b);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			gtk_widget_set_sensitive(WID(entryEntry),1);
-			gtk_label_set_text(GTK_LABEL(WID(label11)),QT_TR_NOOP("Target bitrate (kb/s):"));
-			break;
-
-		case COMPRESS_2PASS:
-			HIST_SET(2);
-			VAL_SET(mS);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			gtk_widget_set_sensitive(WID(entryEntry),1);
-			gtk_label_set_text(GTK_LABEL(WID(label11)),QT_TR_NOOP("Target video size (MB):"));
-			break;
-                case COMPRESS_2PASS_BITRATE:
-			HIST_SET(3);
-			VAL_SET(mA);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			gtk_widget_set_sensitive(WID(entryEntry),1);
-			gtk_label_set_text(GTK_LABEL(WID(label11)),QT_TR_NOOP("Average bitrate (kb/s):"));
-			break;
-
-	    	case COMPRESS_CQ:
-			HIST_SET(1);
-			gtk_widget_set_sensitive(WID(entryEntry),0);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),1);
-			gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)),(gfloat)mQ);
-			break;
-		case COMPRESS_SAME:
-			HIST_SET(4);
-			gtk_widget_set_sensitive(WID(entryEntry),0);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			
-			break;
-
-		}
-}
-
-//*****************************************************
-int cb_mod(GtkObject * object, gpointer user_data)
-{
-int r;
-	r=getRangeInMenu(WID(optionmenuType));
-	switch(r)
-	{
-		case 0: mMode=COMPRESS_CBR ;break;
-		case 1: mMode=COMPRESS_CQ ;break;
-		case 2: mMode=COMPRESS_2PASS ;break;
-                case 3: mMode=COMPRESS_2PASS_BITRATE ;break;
-		case 4: mMode=COMPRESS_SAME;break;
-	
-	}
-	updateMode();
-	printf("Changed!!!\n");
-        return 0;
-
-}
-//*****************************************************
-int ch_par_asinput(GtkObject * object, gpointer user_data)
-{
-	int on = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(checkbutton_par_asinput)));
-	gtk_widget_set_sensitive(WID(spinbutton_par_width), on^1);
-	gtk_widget_set_sensitive(WID(spinbutton_par_height), on^1);
-
-	if (on) {
-		SPIN_GET(spinbutton_par_width,	par_width);
-		SPIN_GET(spinbutton_par_height,	par_height);
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_width)), video_body->getPARWidth());
-		gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton_par_height)), video_body->getPARHeight());
-	}else{
-		SPIN_SET(spinbutton_par_width,	par_width);
-		SPIN_SET(spinbutton_par_height,	par_height);
-	}
-
-	return 0;
-}
-//*****************************************************
-uint8_t editMatrix(uint8_t *intra, uint8_t *inter)
-{
-GtkWidget *dialog=NULL;
-GtkWidget *spinbutton1;
-GtkObject *spinbutton1_adj;
-GtkWidget *intraCell[64],*interCell[64];
-uint8_t ret=0;
-int code;
-int col, row;
-
-      dialog=create_dialog3();
-
-	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
-										GTK_RESPONSE_OK,
-										GTK_RESPONSE_CANCEL,
-										-1);
-      gtk_register_dialog(dialog);
-      //
-      for(int i=0;i<64;i++)
-      {  //Intra
-          col=i%8;
-          row=i>>3;
-          spinbutton1_adj = gtk_adjustment_new (intra[i], 8, 255, 1, 10, 0);
-          intraCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-     //     gtk_widget_show (spinbutton1);
-          gtk_table_attach (GTK_TABLE (WID(tableIntra)), spinbutton1, col, col+1, row, row+1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-
-       }
-      for(int i=0;i<64;i++)
-      {  //Inter
-          col=i%8;
-          row=i>>3;
-          spinbutton1_adj = gtk_adjustment_new (inter[i], 1, 255, 1, 10, 0);
-          interCell[i]=spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
-      //    gtk_widget_show (spinbutton1);
-          gtk_table_attach (GTK_TABLE (WID(tableInter)), spinbutton1, col, col+1, row, row+1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-       }
-      for(int i=0;i<64;i++)
-      {
-        gtk_widget_show (intraCell[i]);
-        gtk_widget_show (interCell[i]);
-      }
-      //
-
-      CALL_Z(button12,SAVE_MATRIX)
-_loop:
-      code=gtk_dialog_run(GTK_DIALOG(dialog));
-      if(code==XVID4_RESPONSE_SAVE_MATRIX)
-      {
-        printf("Save\n");
-        char *name;
-        FILE *fd;
-        GUI_FileSelWrite(QT_TR_NOOP("Select Custom Matrix File to write"),&name);
-        if(!name) goto _loop;
-        fd=fopen(name,"wb");
-        if(!fd)
-        {
-            GUI_Error_HIG(QT_TR_NOOP("Error Writing"),QT_TR_NOOP("Error writing the custom matrix file."));
-            ADM_dealloc(name);
-            goto _loop;
-        }
-        for(int i=0;i<64;i++)
-        {
-          inter[i]=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(interCell[i]));
-          intra[i]=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(intraCell[i]));
-        }
-        fwrite(intra,1,64,fd);
-        fwrite(inter,1,64,fd);
-        fclose(fd);
-        ADM_dealloc(name);
-        goto _loop;
-      }
-      if(code==GTK_RESPONSE_OK)
-      {
-        printf("Accept\n");
-        ret=1;
-        for(int i=0;i<64;i++)
-        {
-          intra[i]=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(intraCell[i]));
-          inter[i]=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(interCell[i]));
-        }
-      }else
-      printf("refused\n");
-/*
-      for(int i=1;i<65;i++)
-      {
-        wid=findMatrixWidget("intra
-      }
-*/
-
-      gtk_unregister_dialog(dialog);
-      gtk_widget_destroy(dialog);
-      return ret;
-
-}
-//-------------------- Glade-2 here----------		
-//_____KK_______
-
-
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *notebook1;
-  GtkWidget *vbox2;
-  GtkWidget *frame1;
-  GtkWidget *vbox3;
-  GtkWidget *hbox19;
-  GtkWidget *vbox21;
-  GtkWidget *label10;
-  GtkWidget *label11;
-  GtkWidget *label12;
-  GtkWidget *vbox22;
-  GtkWidget *optionmenuType;
-  GtkWidget *menu1;
-  GtkWidget *one_pass_cbr1;
-  GtkWidget *one_pass_quantizer1;
-  GtkWidget *two_pass1;
-  GtkWidget *two_pass__average_bitrate1;
-  GtkWidget *same_qz_as_input1;
-  GtkWidget *entryEntry;
-  GtkObject *spinbuttonQuant_adj;
-  GtkWidget *spinbuttonQuant;
-  GtkWidget *label9;
-  GtkWidget *hbox7;
-  GtkWidget *vbox4;
-  GtkWidget *checkbuttonInterlaced;
-  GtkWidget *checkbuttonGreyScale;
-  GtkWidget *vbox5;
-  GtkWidget *checkbuttonCartoon;
-  GtkWidget *checkbuttonChroma;
-  GtkWidget *vbox23;
-  GtkWidget *checkbuttonTurbo;
-  GtkWidget *checkbuttonPacked;
-  GtkWidget *labelMain;
-  GtkWidget *vbox6;
-  GtkWidget *hbox8;
-  GtkWidget *vbox8;
-  GtkWidget *labelMotionSearchPrecision;
-  GtkWidget *labelVHQMode;
-  GtkWidget *vbox7;
-  GtkWidget *optionmenuMS;
-  GtkWidget *menu2;
-  GtkWidget *_0___none1;
-  GtkWidget *_1___very_low1;
-  GtkWidget *_2___low2;
-  GtkWidget *_3___medium1;
-  GtkWidget *_4___high1;
-  GtkWidget *_5___very_high1;
-  GtkWidget *_6___ultra_high1;
-  GtkWidget *optionmenuVHQ;
-  GtkWidget *menu3;
-  GtkWidget *_0___off1;
-  GtkWidget *_1___mode_decision1;
-  GtkWidget *_2___limited_search1;
-  GtkWidget *_3___medium_search1;
-  GtkWidget *_4___wide_search1;
-  GtkWidget *hbox10;
-  GtkWidget *checkbuttonChromaMotion;
-  GtkWidget *checkbutton4MV;
-  GtkWidget *checkbuttonHQAC;
-  GtkWidget *hbox9;
-  GtkWidget *labelIFrameIntervalMin;
-  GtkObject *spinbuttonIMinPeriod_adj;
-  GtkWidget *spinbuttonIMinPeriod;
-  GtkWidget *labelIFrameIntervalMax;
-  GtkObject *spinbuttonIMaxPeriod_adj;
-  GtkWidget *spinbuttonIMaxPeriod;
-  GtkWidget *frameAdvancedSimpleProfile;
-  GtkWidget *vbox9;
-  GtkWidget *hbox11;
-  GtkWidget *labelNumberOfBFrames;
-  GtkObject *spinbuttonBFrame_adj;
-  GtkWidget *spinbuttonBFrame;
-  GtkWidget *hbox12;
-  GtkWidget *checkbuttonQPel;
-  GtkWidget *checkbuttonGMC;
-  GtkWidget *checkbuttonBVHQ;
-  GtkWidget *labelAdvancedSimpleProfile;
-  GtkWidget *labelMotionEstimation;
-  GtkWidget *vbox10;
-  GtkWidget *hbox13;
-  GtkWidget *labelQuantizationType;
-  GtkWidget *radiobuttonH263;
-  GSList *radiobuttonH263_group = NULL;
-  GtkWidget *radiobuttonMpeg;
-  GtkWidget *radiobuttonCustomMatrix;
-  GtkWidget *hbox20;
-  GtkWidget *labelLoadCustomMatrix;
-  GtkWidget *buttonLoadMatrix;
-  GtkWidget *alignment6;
-  GtkWidget *hbox21;
-  GtkWidget *image1;
-  GtkWidget *label13;
-  GtkWidget *vseparator1;
-  GtkWidget *buttonCreateCustomMatrix;
-  GtkWidget *frameQuantizationRestrictions;
-  GtkWidget *hbox14;
-  GtkWidget *vbox11;
-  GtkWidget *labelIFrameQuantizerMin;
-  GtkWidget *labelPFrameQuantizerMin;
-  GtkWidget *labelBFrameQuantizaterMin;
-  GtkWidget *vbox12;
-  GtkObject *spinbuttonIMin_adj;
-  GtkWidget *spinbuttonIMin;
-  GtkObject *spinbuttonPMin_adj;
-  GtkWidget *spinbuttonPMin;
-  GtkObject *spinbuttonBMin_adj;
-  GtkWidget *spinbuttonBMin;
-  GtkWidget *vbox13;
-  GtkWidget *labelIFrameQuantizerMax;
-  GtkWidget *labelPFrameQuantizerMax;
-  GtkWidget *labelBFrameQuantizerMax;
-  GtkWidget *vbox14;
-  GtkObject *spinbuttonIMax_adj;
-  GtkWidget *spinbuttonIMax;
-  GtkObject *spinbuttonPMax_adj;
-  GtkWidget *spinbuttonPMax;
-  GtkObject *spinbuttonBMax_adj;
-  GtkWidget *spinbuttonBMax;
-  GtkWidget *labelQuantizerRestrictions;
-  GtkWidget *checkbuttonTrellis;
-  GtkWidget *labelQuantization;
-  GtkWidget *vbox15;
-  GtkWidget *frameTwoPassTuning;
-  GtkWidget *vbox16;
-  GtkWidget *hbox;
-  GtkWidget *vbox17;
-  GtkWidget *labelIFrameBoost;
-  GtkWidget *labelIFrameCloserThan;
-  GtkWidget *labelAreReducedBy;
-  GtkWidget *labelMaxOverflowImprovement;
-  GtkWidget *labelMaxOverflowDegradation;
-  GtkWidget *vbox18;
-  GtkWidget *entryIBoost;
-  GtkWidget *entryIInterv;
-  GtkWidget *entryIreduction;
-  GtkWidget *entryMaxOvrImp;
-  GtkWidget *entryMaxOvrDeg;
-  GtkWidget *labelTwoPassTuning;
-  GtkWidget *frameCurveCompression;
-  GtkWidget *hbox18;
-  GtkWidget *vbox19;
-  GtkWidget *labelHighBitrateScenes;
-  GtkWidget *labelLowBitrateScenes;
-  GtkWidget *labelOverflowControlStrength;
-  GtkWidget *vbox20;
-  GtkWidget *entryHiPass;
-  GtkWidget *entryLowPass;
-  GtkWidget *entryOvrControl;
-  GtkWidget *labelCurveCompression;
-  GtkWidget *labelSecondPass;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-  GtkTooltips *tooltips;
-
-  GtkWidget *frame_par1;
-  GtkWidget *hbox_par1;
-  GtkWidget *label_par1;
-  GtkWidget *label_par2;
-  GtkWidget *checkbutton_par_asinput;
-  GtkObject *spinbutton_par_width_adj;
-  GtkWidget *spinbutton_par_width;
-  GtkObject *spinbutton_par_height_adj;
-  GtkWidget *spinbutton_par_height;
-
-
-  tooltips = gtk_tooltips_new ();
-
-  dialog1 = gtk_dialog_new ();
-  gtk_container_set_border_width (GTK_CONTAINER (dialog1), 2);
-  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("XviD encoding options"));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  notebook1 = gtk_notebook_new ();
-  gtk_widget_show (notebook1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), notebook1, TRUE, TRUE, 0);
-
-  vbox2 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox2);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox2);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox2,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox2), 5);
-
-  frame1 = gtk_frame_new (NULL);
-  gtk_widget_show (frame1);
-  gtk_box_pack_start (GTK_BOX (vbox2), frame1, FALSE, FALSE, 0);
-
-  vbox3 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox3);
-  gtk_container_add (GTK_CONTAINER (frame1), vbox3);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox3), 5);
-
-  hbox19 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox19);
-  gtk_box_pack_start (GTK_BOX (vbox3), hbox19, TRUE, TRUE, 0);
-
-  vbox21 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox21);
-  gtk_box_pack_start (GTK_BOX (hbox19), vbox21, FALSE, FALSE, 0);
-
-  label10 = gtk_label_new (QT_TR_NOOP("Encoding type:"));
-  gtk_widget_show (label10);
-  gtk_box_pack_start (GTK_BOX (vbox21), label10, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (label10), 0, 0.5);
-
-  label11 = gtk_label_new (QT_TR_NOOP("Bitrate (kb/s):"));
-  gtk_widget_show (label11);
-  gtk_box_pack_start (GTK_BOX (vbox21), label11, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (label11), 0, 0.5);
-
-  label12 = gtk_label_new (QT_TR_NOOP("Quantizer:"));
-  gtk_widget_show (label12);
-  gtk_box_pack_start (GTK_BOX (vbox21), label12, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (label12), 0, 0.5);
-
-  vbox22 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox22);
-  gtk_box_pack_start (GTK_BOX (hbox19), vbox22, FALSE, FALSE, 0);
-
-  optionmenuType = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuType);
-  gtk_box_pack_start (GTK_BOX (vbox22), optionmenuType, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuType, QT_TR_NOOP("Select 1-pass or 2-pass encoding"), NULL);
-
-  menu1 = gtk_menu_new ();
-
-  one_pass_cbr1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("Single Pass - Bitrate"));
-  gtk_widget_show (one_pass_cbr1);
-  gtk_container_add (GTK_CONTAINER (menu1), one_pass_cbr1);
-
-  one_pass_quantizer1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("Single Pass - Quantizer"));
-  gtk_widget_show (one_pass_quantizer1);
-  gtk_container_add (GTK_CONTAINER (menu1), one_pass_quantizer1);
-
-  two_pass1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("Two Pass - Video Size"));
-  gtk_widget_show (two_pass1);
-  gtk_container_add (GTK_CONTAINER (menu1), two_pass1);
-
-  two_pass__average_bitrate1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("Two Pass - Average Bitrate"));
-  gtk_widget_show (two_pass__average_bitrate1);
-  gtk_container_add (GTK_CONTAINER (menu1), two_pass__average_bitrate1);
-
-  same_qz_as_input1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("Same Quantizer as Input"));
-  gtk_widget_show (same_qz_as_input1);
-  gtk_container_add (GTK_CONTAINER (menu1), same_qz_as_input1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuType), menu1);
-
-  entryEntry = gtk_entry_new ();
-  gtk_widget_show (entryEntry);
-  gtk_box_pack_start (GTK_BOX (vbox22), entryEntry, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryEntry, QT_TR_NOOP("Target video bitrate"), NULL);
-  gtk_entry_set_width_chars (GTK_ENTRY (entryEntry), 10);
-
-  spinbuttonQuant_adj = gtk_adjustment_new (4, 1, 31, 1, 10, 0);
-  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 0);
-  gtk_widget_show (spinbuttonQuant);
-  gtk_box_pack_start (GTK_BOX (vbox22), spinbuttonQuant, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonQuant, QT_TR_NOOP("Constant quantizer - each frame will get the same compression"), NULL);
-
-  label9 = gtk_label_new (QT_TR_NOOP("Variable bitrate mode"));
-  gtk_widget_show (label9);
-  gtk_frame_set_label_widget (GTK_FRAME (frame1), label9);
-
-  hbox7 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox7);
-  gtk_box_pack_start (GTK_BOX (vbox2), hbox7, FALSE, FALSE, 0);
-
-  vbox4 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox4);
-  gtk_box_pack_start (GTK_BOX (hbox7), vbox4, FALSE, FALSE, 0);
-
-  checkbuttonInterlaced = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_Interlaced"));
-  gtk_widget_show (checkbuttonInterlaced);
-  gtk_box_pack_start (GTK_BOX (vbox4), checkbuttonInterlaced, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonInterlaced, QT_TR_NOOP("Enables interlaced frame support - use only if your source contains interlacing artifacts (i.e. fields instead of progressive frames)"), NULL);
-
-  checkbuttonGreyScale = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_Greyscale"));
-  gtk_widget_show (checkbuttonGreyScale);
-  gtk_box_pack_start (GTK_BOX (vbox4), checkbuttonGreyScale, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonGreyScale, QT_TR_NOOP("Encode in black & white"), NULL);
-
-  vbox5 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox5);
-  gtk_box_pack_start (GTK_BOX (hbox7), vbox5, FALSE, FALSE, 0);
-
-  checkbuttonCartoon = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("Ca_rtoon mode"));
-  gtk_widget_show (checkbuttonCartoon);
-  gtk_box_pack_start (GTK_BOX (vbox5), checkbuttonCartoon, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonCartoon, QT_TR_NOOP("Enables special motion estimation features for cartoons/anime"), NULL);
-
-  checkbuttonChroma = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("C_hroma optimizer"));
-  gtk_widget_show (checkbuttonChroma);
-  gtk_box_pack_start (GTK_BOX (vbox5), checkbuttonChroma, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonChroma, QT_TR_NOOP("Enables a chroma optimizer prefilter"), NULL);
-
-  vbox23 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox23);
-  gtk_box_pack_start (GTK_BOX (hbox7), vbox23, TRUE, TRUE, 0);
-
-  checkbuttonTurbo = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("Turbo Mode"));
-  gtk_widget_show (checkbuttonTurbo);
-  gtk_box_pack_start (GTK_BOX (vbox23), checkbuttonTurbo, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonTurbo, QT_TR_NOOP("Enables fast 1st pass encoding"), NULL);
-
-  checkbuttonPacked = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("Packed bitstream"));
-  gtk_widget_show (checkbuttonPacked);
-  gtk_box_pack_start (GTK_BOX (vbox23), checkbuttonPacked, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonPacked, QT_TR_NOOP("Enables Divx like packed vop, DO NOT SET, it is ugly"), NULL);
-
-  labelMain = gtk_label_new (QT_TR_NOOP("Main"));
-  gtk_widget_show (labelMain);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 0), labelMain);
-
-  vbox6 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox6);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox6);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox6,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox6), 5);
-
-  hbox8 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox8);
-  gtk_box_pack_start (GTK_BOX (vbox6), hbox8, FALSE, FALSE, 0);
-
-  vbox8 = gtk_vbox_new (FALSE, 10);
-  gtk_widget_show (vbox8);
-  gtk_box_pack_start (GTK_BOX (hbox8), vbox8, FALSE, FALSE, 0);
-
-  labelMotionSearchPrecision = gtk_label_new (QT_TR_NOOP("Motion search precision:"));
-  gtk_widget_show (labelMotionSearchPrecision);
-  gtk_box_pack_start (GTK_BOX (vbox8), labelMotionSearchPrecision, TRUE, TRUE, 0);
-
-  labelVHQMode = gtk_label_new (QT_TR_NOOP("VHQ mode:"));
-  gtk_widget_show (labelVHQMode);
-  gtk_box_pack_start (GTK_BOX (vbox8), labelVHQMode, TRUE, TRUE, 0);
-  gtk_label_set_justify (GTK_LABEL (labelVHQMode), GTK_JUSTIFY_FILL);
-  gtk_misc_set_alignment (GTK_MISC (labelVHQMode), 0, 0.5);
-
-  vbox7 = gtk_vbox_new (FALSE, 10);
-  gtk_widget_show (vbox7);
-  gtk_box_pack_start (GTK_BOX (hbox8), vbox7, FALSE, FALSE, 0);
-
-  optionmenuMS = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuMS);
-  gtk_box_pack_start (GTK_BOX (vbox7), optionmenuMS, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuMS, QT_TR_NOOP("Higher settings give higher quality results, at the cost of slower encoding"), NULL);
-
-  menu2 = gtk_menu_new ();
-
-  _0___none1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("0 - None"));
-  gtk_widget_show (_0___none1);
-  gtk_container_add (GTK_CONTAINER (menu2), _0___none1);
-
-  _1___very_low1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("1 - Very low"));
-  gtk_widget_show (_1___very_low1);
-  gtk_container_add (GTK_CONTAINER (menu2), _1___very_low1);
-
-  _2___low2 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("2 - Low"));
-  gtk_widget_show (_2___low2);
-  gtk_container_add (GTK_CONTAINER (menu2), _2___low2);
-
-  _3___medium1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("3 - Medium"));
-  gtk_widget_show (_3___medium1);
-  gtk_container_add (GTK_CONTAINER (menu2), _3___medium1);
-
-  _4___high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("4 - High"));
-  gtk_widget_show (_4___high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _4___high1);
-
-  _5___very_high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("5 - Very high"));
-  gtk_widget_show (_5___very_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _5___very_high1);
-
-  _6___ultra_high1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("6 - Ultra high"));
-  gtk_widget_show (_6___ultra_high1);
-  gtk_container_add (GTK_CONTAINER (menu2), _6___ultra_high1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMS), menu2);
-
-  optionmenuVHQ = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuVHQ);
-  gtk_box_pack_start (GTK_BOX (vbox7), optionmenuVHQ, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuVHQ, QT_TR_NOOP("VHQ enables an additional search process to increase quality"), NULL);
-
-  menu3 = gtk_menu_new ();
-
-  _0___off1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("0 - Off"));
-  gtk_widget_show (_0___off1);
-  gtk_container_add (GTK_CONTAINER (menu3), _0___off1);
-
-  _1___mode_decision1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("1 - Mode decision"));
-  gtk_widget_show (_1___mode_decision1);
-  gtk_container_add (GTK_CONTAINER (menu3), _1___mode_decision1);
-
-  _2___limited_search1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("2 - Limited search"));
-  gtk_widget_show (_2___limited_search1);
-  gtk_container_add (GTK_CONTAINER (menu3), _2___limited_search1);
-
-  _3___medium_search1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("3 - Medium search"));
-  gtk_widget_show (_3___medium_search1);
-  gtk_container_add (GTK_CONTAINER (menu3), _3___medium_search1);
-
-  _4___wide_search1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("4 - Wide search"));
-  gtk_widget_show (_4___wide_search1);
-  gtk_container_add (GTK_CONTAINER (menu3), _4___wide_search1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuVHQ), menu3);
-
-  hbox10 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox10);
-  gtk_box_pack_start (GTK_BOX (vbox6), hbox10, FALSE, FALSE, 0);
-
-  checkbuttonChromaMotion = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("C_hroma motion"));
-  gtk_widget_show (checkbuttonChromaMotion);
-  gtk_box_pack_start (GTK_BOX (hbox10), checkbuttonChromaMotion, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonChromaMotion, QT_TR_NOOP("Use chroma information to estimate motion"), NULL);
-
-  checkbutton4MV = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_4MV"));
-  gtk_widget_show (checkbutton4MV);
-  gtk_box_pack_start (GTK_BOX (hbox10), checkbutton4MV, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbutton4MV, QT_TR_NOOP("Use 4 motion vectors per macroblock, might give better compression"), NULL);
-
-  checkbuttonHQAC = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("HQ _AC"));
-  gtk_widget_show (checkbuttonHQAC);
-  gtk_box_pack_start (GTK_BOX (hbox10), checkbuttonHQAC, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonHQAC, QT_TR_NOOP("Enable a better prediction of AC component. Turns on Lumi masking - applies more compression to dark/light areas that the eye cannot notice easily"), NULL);
-
-  hbox9 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox9);
-  gtk_box_pack_start (GTK_BOX (vbox6), hbox9, FALSE, FALSE, 0);
-
-  labelIFrameIntervalMin = gtk_label_new (QT_TR_NOOP("I-frame interval - Min:"));
-  gtk_widget_show (labelIFrameIntervalMin);
-  gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMin, FALSE, FALSE, 0);
-
-  spinbuttonIMinPeriod_adj = gtk_adjustment_new (1, 1, 9, 1, 10, 0);
-  spinbuttonIMinPeriod = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMinPeriod_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMinPeriod);
-  gtk_box_pack_start (GTK_BOX (hbox9), spinbuttonIMinPeriod, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMinPeriod, QT_TR_NOOP("Minimum space between I-frames, 1 will disable forced I-frame spacing"), NULL);
-
-  labelIFrameIntervalMax = gtk_label_new (QT_TR_NOOP("Max:"));
-  gtk_widget_show (labelIFrameIntervalMax);
-  gtk_box_pack_start (GTK_BOX (hbox9), labelIFrameIntervalMax, FALSE, FALSE, 0);
-
-  spinbuttonIMaxPeriod_adj = gtk_adjustment_new (250, 1, 500, 1, 10, 0);
-  spinbuttonIMaxPeriod = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMaxPeriod_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMaxPeriod);
-  gtk_box_pack_start (GTK_BOX (hbox9), spinbuttonIMaxPeriod, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMaxPeriod, QT_TR_NOOP("Maximum number of frames allowed between I-frames"), NULL);
-
-  frameAdvancedSimpleProfile = gtk_frame_new (NULL);
-  gtk_widget_show (frameAdvancedSimpleProfile);
-  gtk_box_pack_start (GTK_BOX (vbox6), frameAdvancedSimpleProfile, FALSE, FALSE, 0);
-
-  vbox9 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox9);
-  gtk_container_add (GTK_CONTAINER (frameAdvancedSimpleProfile), vbox9);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox9), 5);
-
-  hbox11 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox11);
-  gtk_box_pack_start (GTK_BOX (vbox9), hbox11, FALSE, FALSE, 0);
-
-  labelNumberOfBFrames = gtk_label_new (QT_TR_NOOP("Number of B-frames:"));
-  gtk_widget_show (labelNumberOfBFrames);
-  gtk_box_pack_start (GTK_BOX (hbox11), labelNumberOfBFrames, FALSE, FALSE, 0);
-
-  spinbuttonBFrame_adj = gtk_adjustment_new (1, 0, 3, 1, 1, 0);
-  spinbuttonBFrame = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBFrame_adj), 1, 0);
-  gtk_widget_show (spinbuttonBFrame);
-  gtk_box_pack_start (GTK_BOX (hbox11), spinbuttonBFrame, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonBFrame, QT_TR_NOOP("Maximum number of sequential B-frames (when set to 0, the original I/P encoder is used)"), NULL);
-
-  hbox12 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox12);
-  gtk_box_pack_start (GTK_BOX (vbox9), hbox12, FALSE, FALSE, 0);
-
-  checkbuttonQPel = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_Qpel"));
-  gtk_widget_show (checkbuttonQPel);
-  gtk_box_pack_start (GTK_BOX (hbox12), checkbuttonQPel, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonQPel, QT_TR_NOOP("Use Quarter pixel resolution for a more precise motion estimation"), NULL);
-
-  checkbuttonGMC = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_GMC"));
-  gtk_widget_show (checkbuttonGMC);
-  gtk_box_pack_start (GTK_BOX (hbox12), checkbuttonGMC, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonGMC, QT_TR_NOOP("Global Motion Compensation can save bits on camera pans, zooming and rotation"), NULL);
-
-  checkbuttonBVHQ = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_BVHQ"));
-  gtk_widget_show (checkbuttonBVHQ);
-  gtk_box_pack_start (GTK_BOX (hbox12), checkbuttonBVHQ, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonBVHQ, QT_TR_NOOP("Produces nicer-looking B-frames"), NULL);
-
-  labelAdvancedSimpleProfile = gtk_label_new (QT_TR_NOOP("Advanced Simple Profile"));
-  gtk_widget_show (labelAdvancedSimpleProfile);
-  gtk_frame_set_label_widget (GTK_FRAME (frameAdvancedSimpleProfile), labelAdvancedSimpleProfile);
-
-  frame_par1 = gtk_frame_new (NULL);
-  gtk_widget_show (frame_par1);
-  gtk_box_pack_start (GTK_BOX (vbox6), frame_par1, TRUE, TRUE, 1);
-  hbox_par1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox_par1);
-  gtk_container_add (GTK_CONTAINER (frame_par1), hbox_par1);
-  gtk_container_set_border_width (GTK_CONTAINER (hbox_par1), 5);
-
-  checkbutton_par_asinput = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("As Input"));
-  gtk_widget_show (checkbutton_par_asinput);
-  gtk_box_pack_start (GTK_BOX (hbox_par1), checkbutton_par_asinput, FALSE, FALSE, 10);
-  gtk_tooltips_set_tip (tooltips, checkbutton_par_asinput, QT_TR_NOOP("Get PAR from input video file"), NULL);
-
-  spinbutton_par_width_adj = gtk_adjustment_new (1, 1, 255, 1, 1, 0);
-  spinbutton_par_width = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton_par_width_adj), 1, 0);
-  gtk_widget_show (spinbutton_par_width);
-  gtk_box_pack_start (GTK_BOX (hbox_par1), spinbutton_par_width, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbutton_par_width, QT_TR_NOOP("Pixel Width"), NULL);
-
-  label_par1 = gtk_label_new (QT_TR_NOOP(":"));
-  gtk_widget_show (label_par1);
-  gtk_box_pack_start (GTK_BOX (hbox_par1), label_par1, FALSE, FALSE, 2);
-  gtk_label_set_justify (GTK_LABEL (label_par1), GTK_JUSTIFY_CENTER);
-
-  spinbutton_par_height_adj = gtk_adjustment_new (1, 1, 255, 1, 1, 0);
-  spinbutton_par_height = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton_par_height_adj), 1, 0);
-  gtk_widget_show (spinbutton_par_height);
-  gtk_box_pack_start (GTK_BOX (hbox_par1), spinbutton_par_height, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbutton_par_height, QT_TR_NOOP("Pixel Height"), NULL);
-  label_par2 = gtk_label_new (QT_TR_NOOP("Pixel Aspect Ratio"));
-  gtk_widget_show (label_par2);
-  gtk_frame_set_label_widget (GTK_FRAME (frame_par1), label_par2);
-  gtk_label_set_use_markup (GTK_LABEL (label_par2), TRUE);
-
-  labelMotionEstimation = gtk_label_new (QT_TR_NOOP("Motion & Misc"));
-  gtk_widget_show (labelMotionEstimation);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 1), labelMotionEstimation);
-
-  vbox10 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox10);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox10);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox10), 5);
-
-  hbox13 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox13);
-  gtk_box_pack_start (GTK_BOX (vbox10), hbox13, FALSE, FALSE, 0);
-
-  labelQuantizationType = gtk_label_new (QT_TR_NOOP("Quantization type:"));
-  gtk_widget_show (labelQuantizationType);
-  gtk_box_pack_start (GTK_BOX (hbox13), labelQuantizationType, FALSE, FALSE, 0);
-
-  radiobuttonH263 = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("_H.263"));
-  gtk_widget_show (radiobuttonH263);
-  gtk_box_pack_start (GTK_BOX (hbox13), radiobuttonH263, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, radiobuttonH263, QT_TR_NOOP("H.263 quantizers smooth the picture (useful at lower bitrates)"), NULL);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonH263), radiobuttonH263_group);
-  radiobuttonH263_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonH263));
-
-  radiobuttonMpeg = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("_MPEG"));
-  gtk_widget_show (radiobuttonMpeg);
-  gtk_box_pack_start (GTK_BOX (hbox13), radiobuttonMpeg, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, radiobuttonMpeg, QT_TR_NOOP("MPEG quantizers (slightly slower) produce sharper picture (useful at higher bitrates)"), NULL);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonMpeg), radiobuttonH263_group);
-  radiobuttonH263_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonMpeg));
-
-  radiobuttonCustomMatrix = gtk_radio_button_new_with_mnemonic (NULL, QT_TR_NOOP("_Custom Matrix"));
-  gtk_widget_show (radiobuttonCustomMatrix);
-  gtk_box_pack_start (GTK_BOX (hbox13), radiobuttonCustomMatrix, FALSE, FALSE, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonCustomMatrix), radiobuttonH263_group);
-  radiobuttonH263_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonCustomMatrix));
-
-  hbox20 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox20);
-  gtk_box_pack_start (GTK_BOX (vbox10), hbox20, FALSE, TRUE, 0);
-
-  labelLoadCustomMatrix = gtk_label_new (QT_TR_NOOP("Load Custom Matrix:  "));
-  gtk_widget_show (labelLoadCustomMatrix);
-  gtk_box_pack_start (GTK_BOX (hbox20), labelLoadCustomMatrix, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (labelLoadCustomMatrix), GTK_JUSTIFY_RIGHT);
-
-  buttonLoadMatrix = gtk_button_new ();
-  gtk_widget_show (buttonLoadMatrix);
-  gtk_box_pack_start (GTK_BOX (hbox20), buttonLoadMatrix, FALSE, FALSE, 0);
-
-  alignment6 = gtk_alignment_new (0.5, 0.5, 0, 0);
-  gtk_widget_show (alignment6);
-  gtk_container_add (GTK_CONTAINER (buttonLoadMatrix), alignment6);
-
-  hbox21 = gtk_hbox_new (FALSE, 2);
-  gtk_widget_show (hbox21);
-  gtk_container_add (GTK_CONTAINER (alignment6), hbox21);
-
-  image1 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_BUTTON);
-  gtk_widget_show (image1);
-  gtk_box_pack_start (GTK_BOX (hbox21), image1, FALSE, FALSE, 0);
-
-  label13 = gtk_label_new_with_mnemonic (QT_TR_NOOP("Open CQM file"));
-  gtk_widget_show (label13);
-  gtk_box_pack_start (GTK_BOX (hbox21), label13, FALSE, FALSE, 0);
-
-  vseparator1 = gtk_vseparator_new ();
-  gtk_widget_show (vseparator1);
-  gtk_box_pack_start (GTK_BOX (hbox20), vseparator1, FALSE, TRUE, 0);
-
-  buttonCreateCustomMatrix = gtk_button_new_with_mnemonic (QT_TR_NOOP("Edit Custom Matrix"));
-  gtk_widget_show (buttonCreateCustomMatrix);
-  gtk_box_pack_start (GTK_BOX (hbox20), buttonCreateCustomMatrix, FALSE, FALSE, 0);
-
-  frameQuantizationRestrictions = gtk_frame_new (NULL);
-  gtk_widget_show (frameQuantizationRestrictions);
-  gtk_box_pack_start (GTK_BOX (vbox10), frameQuantizationRestrictions, FALSE, FALSE, 0);
-
-  hbox14 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox14);
-  gtk_container_add (GTK_CONTAINER (frameQuantizationRestrictions), hbox14);
-  gtk_container_set_border_width (GTK_CONTAINER (hbox14), 5);
-
-  vbox11 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox11);
-  gtk_box_pack_start (GTK_BOX (hbox14), vbox11, FALSE, FALSE, 0);
-
-  labelIFrameQuantizerMin = gtk_label_new (QT_TR_NOOP("I-frame quantizer - Min:"));
-  gtk_widget_show (labelIFrameQuantizerMin);
-  gtk_box_pack_start (GTK_BOX (vbox11), labelIFrameQuantizerMin, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelIFrameQuantizerMin), 0, 0.5);
-
-  labelPFrameQuantizerMin = gtk_label_new (QT_TR_NOOP("P-frame quantizer - Min:"));
-  gtk_widget_show (labelPFrameQuantizerMin);
-  gtk_box_pack_start (GTK_BOX (vbox11), labelPFrameQuantizerMin, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelPFrameQuantizerMin), 0, 0.5);
-
-  labelBFrameQuantizaterMin = gtk_label_new (QT_TR_NOOP("B-frame quantizer - Min:"));
-  gtk_widget_show (labelBFrameQuantizaterMin);
-  gtk_box_pack_start (GTK_BOX (vbox11), labelBFrameQuantizaterMin, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelBFrameQuantizaterMin), 0, 0.5);
-
-  vbox12 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox12);
-  gtk_box_pack_start (GTK_BOX (hbox14), vbox12, FALSE, FALSE, 0);
-
-  spinbuttonIMin_adj = gtk_adjustment_new (2, 1, 31, 1, 10, 0);
-  spinbuttonIMin = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMin_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMin);
-  gtk_box_pack_start (GTK_BOX (vbox12), spinbuttonIMin, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMin, QT_TR_NOOP("Minimum quantizer allowed for I-frames"), NULL);
-
-  spinbuttonPMin_adj = gtk_adjustment_new (2, 1, 31, 1, 10, 0);
-  spinbuttonPMin = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonPMin_adj), 1, 0);
-  gtk_widget_show (spinbuttonPMin);
-  gtk_box_pack_start (GTK_BOX (vbox12), spinbuttonPMin, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonPMin, QT_TR_NOOP("Minimum quantizer allowed for P-frames"), NULL);
-
-  spinbuttonBMin_adj = gtk_adjustment_new (2, 1, 31, 1, 10, 0);
-  spinbuttonBMin = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBMin_adj), 1, 0);
-  gtk_widget_show (spinbuttonBMin);
-  gtk_box_pack_start (GTK_BOX (vbox12), spinbuttonBMin, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonBMin, QT_TR_NOOP("Minimum quantizer allowed for B-frames"), NULL);
-
-  vbox13 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox13);
-  gtk_box_pack_start (GTK_BOX (hbox14), vbox13, FALSE, FALSE, 0);
-
-  labelIFrameQuantizerMax = gtk_label_new (QT_TR_NOOP("Max:"));
-  gtk_widget_show (labelIFrameQuantizerMax);
-  gtk_box_pack_start (GTK_BOX (vbox13), labelIFrameQuantizerMax, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelIFrameQuantizerMax), 0, 0.5);
-
-  labelPFrameQuantizerMax = gtk_label_new (QT_TR_NOOP("Max:"));
-  gtk_widget_show (labelPFrameQuantizerMax);
-  gtk_box_pack_start (GTK_BOX (vbox13), labelPFrameQuantizerMax, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelPFrameQuantizerMax), 0, 0.5);
-
-  labelBFrameQuantizerMax = gtk_label_new (QT_TR_NOOP("Max:"));
-  gtk_widget_show (labelBFrameQuantizerMax);
-  gtk_box_pack_start (GTK_BOX (vbox13), labelBFrameQuantizerMax, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelBFrameQuantizerMax), 0, 0.5);
-
-  vbox14 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox14);
-  gtk_box_pack_start (GTK_BOX (hbox14), vbox14, FALSE, FALSE, 0);
-
-  spinbuttonIMax_adj = gtk_adjustment_new (31, 1, 31, 1, 10, 0);
-  spinbuttonIMax = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMax_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMax);
-  gtk_box_pack_start (GTK_BOX (vbox14), spinbuttonIMax, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMax, QT_TR_NOOP("Maximum quantizer allowed for I-frames"), NULL);
-
-  spinbuttonPMax_adj = gtk_adjustment_new (31, 1, 31, 1, 10, 0);
-  spinbuttonPMax = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonPMax_adj), 1, 0);
-  gtk_widget_show (spinbuttonPMax);
-  gtk_box_pack_start (GTK_BOX (vbox14), spinbuttonPMax, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonPMax, QT_TR_NOOP("Maximum quantizer allowed for P-frames"), NULL);
-
-  spinbuttonBMax_adj = gtk_adjustment_new (31, 1, 31, 1, 10, 0);
-  spinbuttonBMax = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBMax_adj), 1, 0);
-  gtk_widget_show (spinbuttonBMax);
-  gtk_box_pack_start (GTK_BOX (vbox14), spinbuttonBMax, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonBMax, QT_TR_NOOP("Maximum quantizer allowed for B-frames"), NULL);
-
-  labelQuantizerRestrictions = gtk_label_new (QT_TR_NOOP("Quantizer restrictions"));
-  gtk_widget_show (labelQuantizerRestrictions);
-  gtk_frame_set_label_widget (GTK_FRAME (frameQuantizationRestrictions), labelQuantizerRestrictions);
-
-  checkbuttonTrellis = gtk_check_button_new_with_mnemonic (QT_TR_NOOP("_Trellis quantization"));
-  gtk_widget_show (checkbuttonTrellis);
-  gtk_box_pack_start (GTK_BOX (vbox10), checkbuttonTrellis, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonTrellis, QT_TR_NOOP("Rate distortion quantization, will find optimal encoding for each block"), NULL);
-
-  labelQuantization = gtk_label_new (QT_TR_NOOP("Quantization"));
-  gtk_widget_show (labelQuantization);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 2), labelQuantization);
-
-  vbox15 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox15);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox15);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox15,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox15), 5);
-
-  frameTwoPassTuning = gtk_frame_new (NULL);
-  gtk_widget_show (frameTwoPassTuning);
-  gtk_box_pack_start (GTK_BOX (vbox15), frameTwoPassTuning, FALSE, FALSE, 0);
-
-  vbox16 = gtk_vbox_new (FALSE, 10);
-  gtk_widget_show (vbox16);
-  gtk_container_add (GTK_CONTAINER (frameTwoPassTuning), vbox16);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox16), 5);
-
-  hbox = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox);
-  gtk_box_pack_start (GTK_BOX (vbox16), hbox, FALSE, FALSE, 0);
-
-  vbox17 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox17);
-  gtk_box_pack_start (GTK_BOX (hbox), vbox17, TRUE, TRUE, 0);
-
-  labelIFrameBoost = gtk_label_new (QT_TR_NOOP("I-frame boost (%):"));
-  gtk_widget_show (labelIFrameBoost);
-  gtk_box_pack_start (GTK_BOX (vbox17), labelIFrameBoost, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelIFrameBoost), 0, 0.5);
-
-  labelIFrameCloserThan = gtk_label_new (QT_TR_NOOP("I-frames closer than ... frames..."));
-  gtk_widget_show (labelIFrameCloserThan);
-  gtk_box_pack_start (GTK_BOX (vbox17), labelIFrameCloserThan, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelIFrameCloserThan), 0, 0.5);
-
-  labelAreReducedBy = gtk_label_new (QT_TR_NOOP("...are reduced by (%):"));
-  gtk_widget_show (labelAreReducedBy);
-  gtk_box_pack_start (GTK_BOX (vbox17), labelAreReducedBy, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelAreReducedBy), 0, 0.5);
-
-  labelMaxOverflowImprovement = gtk_label_new (QT_TR_NOOP("Max overflow improvement (%):"));
-  gtk_widget_show (labelMaxOverflowImprovement);
-  gtk_box_pack_start (GTK_BOX (vbox17), labelMaxOverflowImprovement, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelMaxOverflowImprovement), 0, 0.5);
-
-  labelMaxOverflowDegradation = gtk_label_new (QT_TR_NOOP("Max overflow degradation (%):"));
-  gtk_widget_show (labelMaxOverflowDegradation);
-  gtk_box_pack_start (GTK_BOX (vbox17), labelMaxOverflowDegradation, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelMaxOverflowDegradation), 0, 0.5);
-
-  vbox18 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox18);
-  gtk_box_pack_start (GTK_BOX (hbox), vbox18, FALSE, FALSE, 0);
-
-  entryIBoost = gtk_entry_new ();
-  gtk_widget_show (entryIBoost);
-  gtk_box_pack_start (GTK_BOX (vbox18), entryIBoost, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryIBoost, QT_TR_NOOP("A value of 20 will give 20% more bits to every I-frame"), NULL);
-
-  entryIInterv = gtk_entry_new ();
-  gtk_widget_show (entryIInterv);
-  gtk_box_pack_start (GTK_BOX (vbox18), entryIInterv, FALSE, FALSE, 0);
-  gtk_widget_set_size_request (entryIInterv, 158, -1);
-  gtk_tooltips_set_tip (tooltips, entryIInterv, QT_TR_NOOP("I-frames appearing in the range below this value will be treated as consecutive keyframes"), NULL);
-
-  entryIreduction = gtk_entry_new ();
-  gtk_widget_show (entryIreduction);
-  gtk_box_pack_start (GTK_BOX (vbox18), entryIreduction, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryIreduction, QT_TR_NOOP("Reduction of bitrate for the first consecutive I-frames. The last I-frame will get treated normally"), NULL);
-
-  entryMaxOvrImp = gtk_entry_new ();
-  gtk_widget_show (entryMaxOvrImp);
-  gtk_box_pack_start (GTK_BOX (vbox18), entryMaxOvrImp, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryMaxOvrImp, QT_TR_NOOP("How much of the overflow the codec can eat into during undersized sections - larger values will bridge the gap faster"), NULL);
-
-  entryMaxOvrDeg = gtk_entry_new ();
-  gtk_widget_show (entryMaxOvrDeg);
-  gtk_box_pack_start (GTK_BOX (vbox18), entryMaxOvrDeg, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryMaxOvrDeg, QT_TR_NOOP("How much of the overflow the codec can eat into during oversized sections - larger values will bridge the gap faster"), NULL);
-
-  labelTwoPassTuning = gtk_label_new (QT_TR_NOOP("Two pass tuning"));
-  gtk_widget_show (labelTwoPassTuning);
-  gtk_frame_set_label_widget (GTK_FRAME (frameTwoPassTuning), labelTwoPassTuning);
-
-  frameCurveCompression = gtk_frame_new (NULL);
-  gtk_widget_show (frameCurveCompression);
-  gtk_box_pack_start (GTK_BOX (vbox15), frameCurveCompression, FALSE, FALSE, 0);
-
-  hbox18 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox18);
-  gtk_container_add (GTK_CONTAINER (frameCurveCompression), hbox18);
-  gtk_container_set_border_width (GTK_CONTAINER (hbox18), 5);
-
-  vbox19 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox19);
-  gtk_box_pack_start (GTK_BOX (hbox18), vbox19, TRUE, TRUE, 0);
-
-  labelHighBitrateScenes = gtk_label_new (QT_TR_NOOP("High bitrate scenes (%):"));
-  gtk_widget_show (labelHighBitrateScenes);
-  gtk_box_pack_start (GTK_BOX (vbox19), labelHighBitrateScenes, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelHighBitrateScenes), 0, 0.5);
-
-  labelLowBitrateScenes = gtk_label_new (QT_TR_NOOP("Low bitrate scenes (%):"));
-  gtk_widget_show (labelLowBitrateScenes);
-  gtk_box_pack_start (GTK_BOX (vbox19), labelLowBitrateScenes, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelLowBitrateScenes), 0, 0.5);
-
-  labelOverflowControlStrength = gtk_label_new (QT_TR_NOOP("Overflow control strength (%):"));
-  gtk_widget_show (labelOverflowControlStrength);
-  gtk_box_pack_start (GTK_BOX (vbox19), labelOverflowControlStrength, TRUE, TRUE, 0);
-  gtk_misc_set_alignment (GTK_MISC (labelOverflowControlStrength), 0, 0.5);
-
-  vbox20 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox20);
-  gtk_box_pack_start (GTK_BOX (hbox18), vbox20, FALSE, FALSE, 0);
-
-  entryHiPass = gtk_entry_new ();
-  gtk_widget_show (entryHiPass);
-  gtk_box_pack_start (GTK_BOX (vbox20), entryHiPass, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryHiPass, QT_TR_NOOP("The higher this value, the more bits get taken from frames larger than the average size, and redistributed to others"), NULL);
-
-  entryLowPass = gtk_entry_new ();
-  gtk_widget_show (entryLowPass);
-  gtk_box_pack_start (GTK_BOX (vbox20), entryLowPass, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryLowPass, QT_TR_NOOP("The higher this value, the more bits get assigned to frames below the average frame size"), NULL);
-
-  entryOvrControl = gtk_entry_new ();
-  gtk_widget_show (entryOvrControl);
-  gtk_box_pack_start (GTK_BOX (vbox20), entryOvrControl, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, entryOvrControl, QT_TR_NOOP("0 = default from core (let XviD decide), else overflow payback percent per frame"), NULL);
-
-  labelCurveCompression = gtk_label_new (QT_TR_NOOP("Curve compression"));
-  gtk_widget_show (labelCurveCompression);
-  gtk_frame_set_label_widget (GTK_FRAME (frameCurveCompression), labelCurveCompression);
-
-  labelSecondPass = gtk_label_new (QT_TR_NOOP("Second Pass"));
-  gtk_widget_show (labelSecondPass);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 3), labelSecondPass);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, notebook1, "notebook1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox2, "vbox2");
-  GLADE_HOOKUP_OBJECT (dialog1, frame1, "frame1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox3, "vbox3");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox19, "hbox19");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox21, "vbox21");
-  GLADE_HOOKUP_OBJECT (dialog1, label10, "label10");
-  GLADE_HOOKUP_OBJECT (dialog1, label11, "label11");
-  GLADE_HOOKUP_OBJECT (dialog1, label12, "label12");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox22, "vbox22");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuType, "optionmenuType");
-  GLADE_HOOKUP_OBJECT (dialog1, menu1, "menu1");
-  GLADE_HOOKUP_OBJECT (dialog1, one_pass_cbr1, "one_pass_cbr1");
-  GLADE_HOOKUP_OBJECT (dialog1, one_pass_quantizer1, "one_pass_quantizer1");
-  GLADE_HOOKUP_OBJECT (dialog1, two_pass1, "two_pass1");
-  GLADE_HOOKUP_OBJECT (dialog1, two_pass__average_bitrate1, "two_pass__average_bitrate1");
-  GLADE_HOOKUP_OBJECT (dialog1, same_qz_as_input1, "same_qz_as_input1");
-  GLADE_HOOKUP_OBJECT (dialog1, entryEntry, "entryEntry");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQuant, "spinbuttonQuant");
-  GLADE_HOOKUP_OBJECT (dialog1, label9, "label9");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox7, "hbox7");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox4, "vbox4");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonInterlaced, "checkbuttonInterlaced");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonGreyScale, "checkbuttonGreyScale");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox5, "vbox5");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonCartoon, "checkbuttonCartoon");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChroma, "checkbuttonChroma");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox23, "vbox23");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonTurbo, "checkbuttonTurbo");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonPacked, "checkbuttonPacked");
-  GLADE_HOOKUP_OBJECT (dialog1, labelMain, "labelMain");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox6, "vbox6");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox8, "hbox8");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox8, "vbox8");
-  GLADE_HOOKUP_OBJECT (dialog1, labelMotionSearchPrecision, "labelMotionSearchPrecision");
-  GLADE_HOOKUP_OBJECT (dialog1, labelVHQMode, "labelVHQMode");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox7, "vbox7");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuMS, "optionmenuMS");
-  GLADE_HOOKUP_OBJECT (dialog1, menu2, "menu2");
-  GLADE_HOOKUP_OBJECT (dialog1, _0___none1, "_0___none1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1___very_low1, "_1___very_low1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2___low2, "_2___low2");
-  GLADE_HOOKUP_OBJECT (dialog1, _3___medium1, "_3___medium1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4___high1, "_4___high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _5___very_high1, "_5___very_high1");
-  GLADE_HOOKUP_OBJECT (dialog1, _6___ultra_high1, "_6___ultra_high1");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuVHQ, "optionmenuVHQ");
-  GLADE_HOOKUP_OBJECT (dialog1, menu3, "menu3");
-  GLADE_HOOKUP_OBJECT (dialog1, _0___off1, "_0___off1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1___mode_decision1, "_1___mode_decision1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2___limited_search1, "_2___limited_search1");
-  GLADE_HOOKUP_OBJECT (dialog1, _3___medium_search1, "_3___medium_search1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4___wide_search1, "_4___wide_search1");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox10, "hbox10");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChromaMotion, "checkbuttonChromaMotion");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbutton4MV, "checkbutton4MV");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonHQAC, "checkbuttonHQAC");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox9, "hbox9");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMin, "labelIFrameIntervalMin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMinPeriod, "spinbuttonIMinPeriod");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameIntervalMax, "labelIFrameIntervalMax");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMaxPeriod, "spinbuttonIMaxPeriod");
-  GLADE_HOOKUP_OBJECT (dialog1, frameAdvancedSimpleProfile, "frameAdvancedSimpleProfile");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox9, "vbox9");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox11, "hbox11");
-  GLADE_HOOKUP_OBJECT (dialog1, labelNumberOfBFrames, "labelNumberOfBFrames");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBFrame, "spinbuttonBFrame");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox12, "hbox12");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonQPel, "checkbuttonQPel");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonGMC, "checkbuttonGMC");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonBVHQ, "checkbuttonBVHQ");
-  GLADE_HOOKUP_OBJECT (dialog1, labelAdvancedSimpleProfile, "labelAdvancedSimpleProfile");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbutton_par_asinput, "checkbutton_par_asinput");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbutton_par_width, "spinbutton_par_width");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbutton_par_height, "spinbutton_par_height");
-  GLADE_HOOKUP_OBJECT (dialog1, labelMotionEstimation, "labelMotionEstimation");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox10, "vbox10");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox13, "hbox13");
-  GLADE_HOOKUP_OBJECT (dialog1, labelQuantizationType, "labelQuantizationType");
-  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonH263, "radiobuttonH263");
-  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonMpeg, "radiobuttonMpeg");
-  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonCustomMatrix, "radiobuttonCustomMatrix");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox20, "hbox20");
-  GLADE_HOOKUP_OBJECT (dialog1, labelLoadCustomMatrix, "labelLoadCustomMatrix");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonLoadMatrix, "buttonLoadMatrix");
-  GLADE_HOOKUP_OBJECT (dialog1, alignment6, "alignment6");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox21, "hbox21");
-  GLADE_HOOKUP_OBJECT (dialog1, image1, "image1");
-  GLADE_HOOKUP_OBJECT (dialog1, label13, "label13");
-  GLADE_HOOKUP_OBJECT (dialog1, vseparator1, "vseparator1");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonCreateCustomMatrix, "buttonCreateCustomMatrix");
-  GLADE_HOOKUP_OBJECT (dialog1, frameQuantizationRestrictions, "frameQuantizationRestrictions");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox14, "hbox14");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox11, "vbox11");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameQuantizerMin, "labelIFrameQuantizerMin");
-  GLADE_HOOKUP_OBJECT (dialog1, labelPFrameQuantizerMin, "labelPFrameQuantizerMin");
-  GLADE_HOOKUP_OBJECT (dialog1, labelBFrameQuantizaterMin, "labelBFrameQuantizaterMin");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox12, "vbox12");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMin, "spinbuttonIMin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonPMin, "spinbuttonPMin");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBMin, "spinbuttonBMin");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox13, "vbox13");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameQuantizerMax, "labelIFrameQuantizerMax");
-  GLADE_HOOKUP_OBJECT (dialog1, labelPFrameQuantizerMax, "labelPFrameQuantizerMax");
-  GLADE_HOOKUP_OBJECT (dialog1, labelBFrameQuantizerMax, "labelBFrameQuantizerMax");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox14, "vbox14");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMax, "spinbuttonIMax");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonPMax, "spinbuttonPMax");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBMax, "spinbuttonBMax");
-  GLADE_HOOKUP_OBJECT (dialog1, labelQuantizerRestrictions, "labelQuantizerRestrictions");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonTrellis, "checkbuttonTrellis");
-  GLADE_HOOKUP_OBJECT (dialog1, labelQuantization, "labelQuantization");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox15, "vbox15");
-  GLADE_HOOKUP_OBJECT (dialog1, frameTwoPassTuning, "frameTwoPassTuning");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox16, "vbox16");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox, "hbox");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox17, "vbox17");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameBoost, "labelIFrameBoost");
-  GLADE_HOOKUP_OBJECT (dialog1, labelIFrameCloserThan, "labelIFrameCloserThan");
-  GLADE_HOOKUP_OBJECT (dialog1, labelAreReducedBy, "labelAreReducedBy");
-  GLADE_HOOKUP_OBJECT (dialog1, labelMaxOverflowImprovement, "labelMaxOverflowImprovement");
-  GLADE_HOOKUP_OBJECT (dialog1, labelMaxOverflowDegradation, "labelMaxOverflowDegradation");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox18, "vbox18");
-  GLADE_HOOKUP_OBJECT (dialog1, entryIBoost, "entryIBoost");
-  GLADE_HOOKUP_OBJECT (dialog1, entryIInterv, "entryIInterv");
-  GLADE_HOOKUP_OBJECT (dialog1, entryIreduction, "entryIreduction");
-  GLADE_HOOKUP_OBJECT (dialog1, entryMaxOvrImp, "entryMaxOvrImp");
-  GLADE_HOOKUP_OBJECT (dialog1, entryMaxOvrDeg, "entryMaxOvrDeg");
-  GLADE_HOOKUP_OBJECT (dialog1, labelTwoPassTuning, "labelTwoPassTuning");
-  GLADE_HOOKUP_OBJECT (dialog1, frameCurveCompression, "frameCurveCompression");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox18, "hbox18");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox19, "vbox19");
-  GLADE_HOOKUP_OBJECT (dialog1, labelHighBitrateScenes, "labelHighBitrateScenes");
-  GLADE_HOOKUP_OBJECT (dialog1, labelLowBitrateScenes, "labelLowBitrateScenes");
-  GLADE_HOOKUP_OBJECT (dialog1, labelOverflowControlStrength, "labelOverflowControlStrength");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox20, "vbox20");
-  GLADE_HOOKUP_OBJECT (dialog1, entryHiPass, "entryHiPass");
-  GLADE_HOOKUP_OBJECT (dialog1, entryLowPass, "entryLowPass");
-  GLADE_HOOKUP_OBJECT (dialog1, entryOvrControl, "entryOvrControl");
-  GLADE_HOOKUP_OBJECT (dialog1, labelCurveCompression, "labelCurveCompression");
-  GLADE_HOOKUP_OBJECT (dialog1, labelSecondPass, "labelSecondPass");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, tooltips, "tooltips");
-
-  return dialog1;
-}
-
-GtkWidget*
-create_dialog3 (void)
-{
-  GtkWidget *dialog3;
-  GtkWidget *dialog_vbox3;
-  GtkWidget *vbox26;
-  GtkWidget *frame7;
-  GtkWidget *alignment12;
-  GtkWidget *tableIntra;
-  GtkWidget *label19;
-  GtkWidget *frame6;
-  GtkWidget *alignment11;
-  GtkWidget *tableInter;
-  GtkWidget *label18;
-  GtkWidget *dialog_action_area4;
-  GtkWidget *button12;
-  GtkWidget *button13;
-  GtkWidget *button14;
-
-  dialog3 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog3), QT_TR_NOOP("Edit Custom Matrix"));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog3), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox3 = GTK_DIALOG (dialog3)->vbox;
-  gtk_widget_show (dialog_vbox3);
-
-  vbox26 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox26);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox3), vbox26, TRUE, TRUE, 0);
-
-  frame7 = gtk_frame_new (NULL);
-  gtk_widget_show (frame7);
-  gtk_box_pack_start (GTK_BOX (vbox26), frame7, TRUE, TRUE, 0);
-
-  alignment12 = gtk_alignment_new (0.5, 0.5, 1, 1);
-  gtk_widget_show (alignment12);
-  gtk_container_add (GTK_CONTAINER (frame7), alignment12);
-  gtk_alignment_set_padding (GTK_ALIGNMENT (alignment12), 0, 0, 12, 0);
-
-  tableIntra = gtk_table_new (8, 8, FALSE);
-  gtk_widget_show (tableIntra);
-  gtk_container_add (GTK_CONTAINER (alignment12), tableIntra);
-
-  label19 = gtk_label_new (QT_TR_NOOP("<b>Intra Matrix</b>"));
-  gtk_widget_show (label19);
-  gtk_frame_set_label_widget (GTK_FRAME (frame7), label19);
-  gtk_label_set_use_markup (GTK_LABEL (label19), TRUE);
-
-  frame6 = gtk_frame_new (NULL);
-  gtk_widget_show (frame6);
-  gtk_box_pack_start (GTK_BOX (vbox26), frame6, TRUE, TRUE, 0);
-
-  alignment11 = gtk_alignment_new (0.5, 0.5, 1, 1);
-  gtk_widget_show (alignment11);
-  gtk_container_add (GTK_CONTAINER (frame6), alignment11);
-  gtk_alignment_set_padding (GTK_ALIGNMENT (alignment11), 0, 0, 12, 0);
-
-  tableInter = gtk_table_new (8, 8, FALSE);
-  gtk_widget_show (tableInter);
-  gtk_container_add (GTK_CONTAINER (alignment11), tableInter);
-
-  label18 = gtk_label_new (QT_TR_NOOP("<b>Inter Matrix</b>"));
-  gtk_widget_show (label18);
-  gtk_frame_set_label_widget (GTK_FRAME (frame6), label18);
-  gtk_label_set_use_markup (GTK_LABEL (label18), TRUE);
-
-  dialog_action_area4 = GTK_DIALOG (dialog3)->action_area;
-  gtk_widget_show (dialog_action_area4);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area4), GTK_BUTTONBOX_END);
-
-  button12 = gtk_button_new_from_stock ("gtk-save");
-  gtk_widget_show (button12);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog3), button12, 0);
-  GTK_WIDGET_SET_FLAGS (button12, GTK_CAN_DEFAULT);
-
-  button13 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (button13);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog3), button13, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (button13, GTK_CAN_DEFAULT);
-
-  button14 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (button14);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog3), button14, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (button14, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog3, dialog3, "dialog3");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog3, dialog_vbox3, "dialog_vbox3");
-  GLADE_HOOKUP_OBJECT (dialog3, vbox26, "vbox26");
-  GLADE_HOOKUP_OBJECT (dialog3, frame7, "frame7");
-  GLADE_HOOKUP_OBJECT (dialog3, alignment12, "alignment12");
-  GLADE_HOOKUP_OBJECT (dialog3, tableIntra, "tableIntra");
-  GLADE_HOOKUP_OBJECT (dialog3, label19, "label19");
-  GLADE_HOOKUP_OBJECT (dialog3, frame6, "frame6");
-  GLADE_HOOKUP_OBJECT (dialog3, alignment11, "alignment11");
-  GLADE_HOOKUP_OBJECT (dialog3, tableInter, "tableInter");
-  GLADE_HOOKUP_OBJECT (dialog3, label18, "label18");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog3, dialog_action_area4, "dialog_action_area4");
-  GLADE_HOOKUP_OBJECT (dialog3, button12, "button12");
-  GLADE_HOOKUP_OBJECT (dialog3, button13, "button13");
-  GLADE_HOOKUP_OBJECT (dialog3, button14, "button14");
-
-  return dialog3;
-}
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
@@ -16,7 +16,7 @@
 	${${ADM_LIB}_headers}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource}  Q_about.cpp  
 	Q_calculator.cpp  Q_encoding.cpp  Q_license.cpp
 	Q_jobs.cpp  Q_props.cpp   Q_vobsub.cpp  Q_working.cpp   T_index_pg.cpp
-	alert_qt4.cpp  DIA_busy.cpp  DIA_none.cpp  DIA_xvid4.cpp  OCR_none.cpp  DIA_color.cpp)
+	alert_qt4.cpp  DIA_busy.cpp  DIA_none.cpp  OCR_none.cpp  DIA_color.cpp)
 
 ADD_DEFINITIONS(-DADM_SUBVERSION=${ADM_SUBVERSION})
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp	2009-01-16 19:36:32 UTC (rev 4536)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp	2009-01-19 22:14:53 UTC (rev 4537)
@@ -1,145 +0,0 @@
-
-// Author: mean <fixounet at free.fr>, (C) 2007
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-#include "config.h"
-
-#ifdef USE_XVID_4
-#include "ADM_default.h"
-
-#include "DIA_factory.h"
-#include "ADM_encoder/ADM_vidEncode.hxx"
-#include "ADM_codecs/ADM_xvid4param.h"
-/**
-      \fn getFFCompressParams
-      \brief Dialog for lavcodec mpeg4/... codec settings
-*/
-uint8_t DIA_xvid4(COMPRES_PARAMS *incoming)
-{
-int b;
-int ret=0;
-int code;
-      xvid4EncParam localParam;
-      ADM_assert(incoming->extraSettingsLen==sizeof(localParam));
-      memcpy(&localParam,incoming->extraSettings,sizeof(localParam));
-#define PX(x) &(localParam.x)
-         // Our tabs
-         /* Tab 1 main */
-           diaElemBitrate bitrate(incoming,NULL);
-		   bitrate.setMinQz(1);
-#define MKTOGGLE(y,x)           diaElemToggle  t_##x(PX(x),y)
-        MKTOGGLE(QT_TR_NOOP("_Interlaced"),	    interlaced);
-        MKTOGGLE(QT_TR_NOOP("Ca_rtoon mode"),      cartoon);
-        MKTOGGLE(QT_TR_NOOP("_Greyscale"),         greyscale);
-        MKTOGGLE(QT_TR_NOOP("Turbo mode"),      turbo);
-        MKTOGGLE(QT_TR_NOOP("C_hroma optimizer"),         chroma_opt);
-
-		diaElemToggle    parAsInput(PX(par_as_input), QT_TR_NOOP("As Input"));
-		diaElemAspectRatio  par(PX(par_width), PX(par_height), QT_TR_NOOP("Aspect Ratio:"));
-		diaElemFrame  framePar(QT_TR_NOOP("Pixel Aspect Ratio"));
-		
-		parAsInput.link(0, &par);
-		framePar.swallow(&parAsInput);
-		framePar.swallow(&par);
-
-        diaElem *main[]={&bitrate,&t_interlaced,&t_cartoon,&t_greyscale,&t_turbo,&t_chroma_opt,&framePar};
-        diaElemTabs tabMain(QT_TR_NOOP("Main"),7,main);
-         /* Tab 2 motion */
-         diaMenuEntry motionMenu[] = {
-                             {0,       QT_TR_NOOP("None"),NULL}
-                            ,{1,      QT_TR_NOOP("Very Low"),NULL}
-                            ,{2,      QT_TR_NOOP("Low"),NULL}
-                            ,{3,      QT_TR_NOOP("Medium"),NULL}
-                            ,{4,      QT_TR_NOOP("High"),NULL}
-                            ,{5,      QT_TR_NOOP("Very High"),NULL}
-                            ,{6,      QT_TR_NOOP("Ultra High"),NULL}};
-        diaElemMenu motion(PX(guiLevel),QT_TR_NOOP("Motion Search Precision"),7,motionMenu);
-        
-         diaMenuEntry vhqMenu[] = {
-                             {0,       QT_TR_NOOP("Off"),NULL}
-                            ,{1,      QT_TR_NOOP("Mode Decision"),NULL}
-                            ,{2,      QT_TR_NOOP("Limited Search"),NULL}
-                            ,{3,      QT_TR_NOOP("Medium Search"),NULL}
-                            ,{4,      QT_TR_NOOP("Wide Search"),NULL} };
-         diaElemMenu vhq(PX(vhqmode),QT_TR_NOOP("VHQ Mode"),5,vhqMenu);
-        
-        
-        /* Tab2-ASP */
-          diaElemUInteger  bframe(PX(bframes),QT_TR_NOOP("Max B Frames"),0,3);
-          diaElemToggle    qpel(PX(qpel),QT_TR_NOOP("Quarter Pixel"));
-          diaElemToggle    gmc(PX(gmc),QT_TR_NOOP("GMC"));
-          diaElemToggle    bvhq(PX(bvhq),QT_TR_NOOP("BVHQ"));
-          diaElemFrame  frameASP(QT_TR_NOOP("Advanced Simple Profile"));
-          frameASP.swallow(&bframe);
-          frameASP.swallow(&qpel);
-          frameASP.swallow(&gmc);
-          frameASP.swallow(&bvhq);
-        
-         
-          /* Tab 2 motion extra */
-            diaElemToggle    inter4mv(PX(inter4mv),QT_TR_NOOP("4MV"));
-            diaElemToggle    chroma_me(PX(chroma_me),QT_TR_NOOP("Chroma ME"));
-            diaElemToggle    hqac(PX(chroma_me),QT_TR_NOOP("HQ AC"));
-          diaElemFrame  frameMore(QT_TR_NOOP("More Search"));
-          frameMore.swallow(&inter4mv);
-          frameMore.swallow(&chroma_me);
-          frameMore.swallow(&hqac);
-          /* Tab 2 gop size */
-          diaElemUInteger  min_key_interval(PX(min_key_interval),QT_TR_NOOP("Min Gop Size"),1,900);
-          diaElemUInteger  max_key_interval(PX(max_key_interval),QT_TR_NOOP("Max Gop Size"),1,900);
-            diaElemFrame  frameGop(QT_TR_NOOP("GOP Size"));
-              frameGop.swallow(&min_key_interval);
-              frameGop.swallow(&max_key_interval);
-            
-           diaElem *motions[]={&motion,&vhq,&frameMore,&frameGop,&frameASP};
-          diaElemTabs tabMotion(QT_TR_NOOP("Motion"),5,motions);
-        /* Tab 3 Qz*/
-          diaMenuEntry qzMenu[] = {
-                             {0,       QT_TR_NOOP("H263"),NULL}
-                            ,{1,      QT_TR_NOOP("Mpeg"),NULL}}                            ;
-           diaElemMenu h263(PX(mpegQuantizer),QT_TR_NOOP("Quantization Matrix"),2,qzMenu);
-           diaElemToggle    trellis(PX(trellis),QT_TR_NOOP("Trellis Quantization"));
-           
-           
-          diaElem *qz[]={&h263,&trellis};
-          diaElemTabs tabQz(QT_TR_NOOP("Quantization"),2,qz);
-          
-          /* Tab 4 : 2nd pass */
-#define MKENTRY(y,x) diaElemUInteger x(PX(x),y,0,100); frameOne.swallow(&x);
-        diaElemFrame  frameOne(QT_TR_NOOP("Two Pass Tuning")); 
-         
-        MKENTRY(QT_TR_NOOP("Key Frame Boost(%)"), keyframe_boost);
-        
-        MKENTRY(QT_TR_NOOP("I-frames closer than..."), kfthreshold);
-        MKENTRY(QT_TR_NOOP(".. are reduced by(%)"), kfreduction);
-        MKENTRY(QT_TR_NOOP("Max Overflow Improvement(%)"), max_overflow_improvement);
-        MKENTRY(QT_TR_NOOP("Max Overglow Degradation(%)"), max_overflow_degradation);
-
-#undef MKENTRY
-#define MKENTRY(y,x) diaElemUInteger  x(PX(x),y,0,100);frameTwo.swallow(&x);
-        diaElemFrame  frameTwo(QT_TR_NOOP("Curve Compression"));  
-
-        MKENTRY(QT_TR_NOOP("High Bitrate Scenes (%)"), curve_compression_high);
-        MKENTRY(QT_TR_NOOP("Low Bitrate Scenes (%)"), curve_compression_low);
-        MKENTRY(QT_TR_NOOP("Overflow Control Strength"), overflow_control_strength);
-
-         diaElem *twopass[]={&frameOne,&frameTwo};
-          diaElemTabs tabPass(QT_TR_NOOP("Two Pass"),2,twopass);
-        /**/
-        
-        
-          
-          /* End of tabs */
-        diaElemTabs *tabs[4]={&tabMain,&tabMotion,&tabQz,&tabPass};
-        if( diaFactoryRunTabs(QT_TR_NOOP("Xvid4 Configuration"),4,tabs))
-	{
-           memcpy(incoming->extraSettings,&localParam,sizeof(localParam));
-           return 1;
-        }
-         return 0;
-}
-#endif
-// EOF



From gruntster at mail.berlios.de  Mon Jan 19 23:53:57 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 19 Jan 2009 23:53:57 +0100
Subject: [Avidemux-svn-commit] r4538 - in
	branches/avidemux_2.5_branch_gruntster: . avidemux
	avidemux/ADM_audio avidemux/ADM_core/src avidemux/ADM_coreAudio/src
	avidemux/ADM_coreAudio/src/ADM_libsamplerate
	avidemux/ADM_coreImage/include avidemux/ADM_coreImage/src
	avidemux/ADM_infoExtractor avidemux/ADM_inputs/ADM_flv
	avidemux/ADM_libraries avidemux/ADM_outputs
	avidemux/ADM_outputs/oplug_avi
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
	avidemux/ADM_videoFilter cmake cmake/patches plugins
	plugins/ADM_audioEncoders/lavcodec
	plugins/ADM_videoFilters/Equalizer
	plugins/ADM_videoFilters/Equalizer/gtk
	plugins/ADM_videoFilters/ForcedPP plugins/ADM_videoFilters/McDeint
	plugins/ADM_videoFilters/Mosaic
	plugins/ADM_videoFilters/MplayerResize
	plugins/ADM_videoFilters/lavDeinterlace
Message-ID: <200901192253.n0JMrvVU020754@sheep.berlios.de>

Author: gruntster
Date: 2009-01-19 23:53:34 +0100 (Mon, 19 Jan 2009)
New Revision: 4538

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_ffmpeg/
Modified:
   branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
Log:
[[ffmpeg] bootstrap ffmpeg (only tested win32)

Modified: branches/avidemux_2.5_branch_gruntster/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -3,11 +3,10 @@
 MESSAGE("#####################################")
 MESSAGE("")
 
-CMAKE_MINIMUM_REQUIRED(VERSION 2.4.7 FATAL_ERROR)
+CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2 FATAL_ERROR)
 
 if (COMMAND cmake_policy)
-	cmake_policy(VERSION 2.4)
-	cmake_policy(SET CMP0003 NEW)
+	cmake_policy(SET CMP0004 OLD)
 endif (COMMAND cmake_policy)
 
 SET(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -16,9 +16,9 @@
 #include "ADM_audio/ADM_dcainfo.h"
 extern "C"
 {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/common.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h"
+#include "libavutil/common.h"
+#include "libavutil/bswap.h"
+#include "libavcodec/bitstream.h"
 
 }
 #include "ADM_assert.h"

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -37,7 +37,11 @@
 #ifdef ADM_CPU_X86
 extern "C" 
 {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
+#define AV_WN16
+#define AV_WN32
+#define AV_RN16
+#define AV_RN32
+#include "libavcodec/dsputil.h"
 }
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -38,7 +38,13 @@
 
 extern "C"
 {
-	#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
+	#define HAVE_MMX
+	#define AV_WN16
+	#define AV_WN32
+	#define AV_RN16
+	#define AV_RN32
+	#include "libavcodec/dsputil.h"
+	#include "libavcodec/avcodec.h"
 
 adm_fast_memcpy myAdmMemcpy=NULL;
 /* Original comments from mplayer (file: aclib.c)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/ADM_libsamplerate/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,17 +0,0 @@
-SET(ADM_LIB ADM_libsamplerate)
-
-SET(${ADM_LIB}_SRCS 
-src_linear.c
-src_sinc.c
-src_zoh.c
-)
-
-ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-ADD_DEFINITIONS( "-I${CMAKE_CURRENT_SOURCE_DIR} ")
-ADD_DEFINITIONS( "-DADM_LEGACY_PROGGY")
-if(unix)
-ADD_DEFINITIONS( "-fpic ")
-endif(unix)
-# FIXME!
-ADD_DEFINITIONS( "-DHAVE_LRINT -DHAVE_LRINTF ")
-

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/src/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -10,12 +10,12 @@
 ADM_libsamplerate/src_zoh.c
 )	
 #*************************************************
-ADD_DEFINITIONS( "-DADM_LEGACY_PROGGY")
-ADD_DEFINITIONS( "-DHAVE_LRINT -DHAVE_LRINTF ")
-ADD_DEFINITIONS( "-DCPU_CLIPS_POSITIVE=0 -DCPU_CLIPS_NEGATIVE=0")
-ADD_DEFINITIONS( "-I${CMAKE_CURRENT_SOURCE_DIR} ")
-ADD_DEFINITIONS( '-DPACKAGE="SRC"')
-ADD_DEFINITIONS( '-DVERSION="0.1.4"')
+ADD_DEFINITIONS(-DADM_LEGACY_PROGGY)
+ADD_DEFINITIONS(-DHAVE_LRINT -DHAVE_LRINTF)
+ADD_DEFINITIONS(-DCPU_CLIPS_POSITIVE=0 -DCPU_CLIPS_NEGATIVE=0)
+ADD_DEFINITIONS(-I${CMAKE_CURRENT_SOURCE_DIR})
+ADD_DEFINITIONS(-DPACKAGE="SRC")
+ADD_DEFINITIONS(-DVERSION="0.1.4")
 #*************************************************
 ADD_LIBRARY(ADM_coreAudio SHARED ${ADMaudioCore_SRCS})
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_coreAudio/include)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_pp.h	2009-01-19 22:53:34 UTC (rev 4538)
@@ -12,7 +12,7 @@
 #ifndef ADMPP
 #define ADMPP
 extern "C" {
-#include "../ADM_libpostproc/postprocess.h"
+#include "libpostproc/postprocess.h"
 }
 typedef struct ADM_PP
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -20,9 +20,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 #include "ADM_rgb.h" 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -16,8 +16,8 @@
 #include "ADM_image.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -24,9 +24,9 @@
 #include "ADM_colorspace.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 	

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -19,7 +19,7 @@
 #include "ADM_assert.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "libavcodec/avcodec.h"
 }
 
 ADM_flyDialog::ADM_flyDialog(uint32_t width,uint32_t height,AVDMGenericVideoStream *in,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,8 +26,8 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libswscale/swscale.h"
 }
 
 #include "ADM_colorspace.h"

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/yuv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,7 +26,7 @@
 #include <string.h>
 
 #include "ADM_default.h"
-#include "colorspace.h"
+#include "libavcodec/colorspace.h"
 
 uint8_t COL_422_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -26,11 +26,11 @@
 
 extern "C"
 {
-#include "common.h"
-#include "bswap.h"
+#include "libavutil/common.h"
+#include "libavutil/bswap.h"
 #define INT_MAX (0x7FFFFFFF)
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/golomb.h"
+#include "libavcodec/bitstream.h"
+#include "libavcodec/golomb.h"
 }
 
 #include "ADM_infoExtractor/ADM_h264_tag.h"

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -25,7 +25,7 @@
 #include "ADM_flv.h"
 
 // Borrowed from lavformt/flv.h
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavformat/flv.h"
+#include "libavformat/flv.h"
 // Borrowed from lavformt/flv.h    
 
 uint32_t ADM_UsecFromFps1000(uint32_t fps1000);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_lavcodec.h	2009-01-19 22:53:34 UTC (rev 4538)
@@ -18,6 +18,6 @@
   #define  __ADM_LAVC
   extern "C"
   {  
-  #include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+  #include "libavcodec/avcodec.h"
   };
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,15 +1,14 @@
-subdirs (PREORDER ADM_ffmpeg)
-subdirs (PREORDER ADM_libmpeg2enc)
-subdirs (PREORDER ADM_lvemux)
-subdirs (PREORDER ADM_mplex)
-subdirs (PREORDER ADM_smjs)
-subdirs (PREORDER ADM_utilities)
-subdirs (PREORDER ADM_xvidratectl)
+add_subdirectory(ADM_libmpeg2enc)
+add_subdirectory(ADM_lvemux)
+add_subdirectory(ADM_mplex)
+add_subdirectory(ADM_smjs)
+add_subdirectory(ADM_utilities)
+add_subdirectory(ADM_xvidratectl)
 
 if (ADM_DEBUG AND FIND_LEAKS)
-	subdirs (PREORDER ADM_nvwa)
+	add_subdirectory(ADM_nvwa)
 endif (ADM_DEBUG AND FIND_LEAKS)
 
 if (APPLE AND USE_SDL)
-	subdirs (PREORDER ADM_libsdl)
+	add_subdirectory(ADM_libsdl)
 endif (APPLE AND USE_SDL)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -28,7 +28,7 @@
 
 extern "C"
 {
-	#include "ADM_libraries/ADM_ffmpeg/ADM_lavformat/avformat.h"
+	#include "libavformat/avformat.h"
 };
 
 #undef malloc

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -334,8 +334,8 @@
 {
 #undef av_always_inline
 #define av_always_inline inline
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/bswap.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h"
+#include "libavutil/bswap.h"
+#include "libavcodec/bitstream.h"
 }
 void putNvop(ADMBitstream *data,uint32_t timebits, uint32_t timeincval)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_preview.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -44,7 +44,6 @@
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_PREVIEW
 #include "ADM_osSupport/ADM_debug.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h"
 #include "ADM_userInterfaces/ADM_commonUI/GUI_ui.h"
 #include "ADM_preview.h"
 #define MAX(a,b) ( (a)>(b) ? (a) : (b) )

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -36,7 +36,6 @@
 #include "../ADM_render/GUI_accelRender.h"
 
 #include "ADM_colorspace.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h"
 
 void GUI_gtk_grow_off(int onff);
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -61,9 +61,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -58,8 +58,6 @@
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_coreImage/include")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_coreAudio/include")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_utilities")
-INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavutil")
-INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavcodec")
 
 IF (GETTEXT_FOUND)
 	INCLUDE_DIRECTORIES(${GETTEXT_INCLUDE_DIR})
@@ -130,24 +128,29 @@
 
 ADD_EXECUTABLE(avidemux2_cli MACOSX_BUNDLE ${ADM_EXE_SRCS} ${MO_FILES})
 ADD_TARGET_CFLAGS(avidemux2_cli "-I${CMAKE_BINARY_DIR}/config/cli")
-ADD_DEPENDENCIES(avidemux2_cli mofiles)
+ADD_DEPENDENCIES(avidemux2_cli mofiles  ffmpeg)
 
 IF (ADM_UI_GTK)
 	ADD_EXECUTABLE(avidemux2_gtk MACOSX_BUNDLE ${ADM_EXE_SRCS} ${MO_FILES})
 	ADD_TARGET_CFLAGS(avidemux2_gtk "-I${CMAKE_BINARY_DIR}/config/gtk")
-	ADD_DEPENDENCIES(avidemux2_gtk mofiles)
+	ADD_DEPENDENCIES(avidemux2_gtk mofiles  ffmpeg)
 ENDIF (ADM_UI_GTK)
 
 IF (ADM_UI_QT4)
 	ADD_EXECUTABLE(avidemux2_qt4 MACOSX_BUNDLE ${ADM_EXE_SRCS} ${QM_FILES})
 	ADD_TARGET_CFLAGS(avidemux2_qt4 "-I${CMAKE_BINARY_DIR}/config/qt4")
-	ADD_DEPENDENCIES(avidemux2_qt4 qmfiles)
+	ADD_DEPENDENCIES(avidemux2_qt4 qmfiles  ffmpeg)
 ENDIF (ADM_UI_QT4)
 
 SDLify(main.cpp)
 ADD_SOURCE_CFLAGS(main.cpp "-DADM_SUBVERSION=${ADM_SUBVERSION}")
 
 ########################################
+# FFmpeg
+########################################
+include(admFFmpegBuild)
+
+########################################
 # Compile and link general subdirs
 ########################################
 SET(ADM_SUBDIR 

Added: branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/FindPatch.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+if (NOT PATCH_EXECUTABLE)
+	message(STATUS "Checking for patch")
+	message(STATUS "******************")
+
+	find_program(PATCH_EXECUTABLE patch)
+	set(PATCH_EXECUTABLE ${PATCH_EXECUTABLE} CACHE STRING "")
+
+	if (PATCH_EXECUTABLE)
+		message(STATUS "Found patch")
+		
+		if (VERBOSE)
+			message(STATUS "Path: ${PATCH_EXECUTABLE}")
+		endif (VERBOSE)
+	else (PATCH_EXECUTABLE)
+		message(FATAL_ERROR "patch not found")
+	endif (PATCH_EXECUTABLE)
+
+	message("")
+endif (NOT PATCH_EXECUTABLE)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,181 @@
+include(admFFmpegUtil)
+
+set(FFMPEG_VERSION 12476)
+set(SWSCALE_VERSION 26258)
+set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
+
+set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  dnxhd  dvbsub  dvvideo  ffv1  ffvhuff  flv  fourxm  fraps  h263  h264  huffyuv  indeo2  indeo3
+					 interplay_video  mjpeg  mjpegb  mpeg1video  mpeg2video  mpeg4  mpegaudio_hp  mpegvideo  msmpeg4v1  msmpeg4v2  msmpeg4v3  msvideo1
+					 nellymoser  png  qdm2  rv10  rv20  snow  svq1  svq3  tscc  vc1  vcr1  vp3  vp5  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
+set(FFMPEG_ENCODERS  ac3  dvbsub  dvvideo  ffv1  ffvhuff  flv  flv1  h263  h263p  huffyuv  mjpeg  mpeg1video  mpeg2video  mp2  mpeg4  msmpeg4v3  snow)
+set(FFMPEG_MUXERS  flv  ipod  matroska  mov  mp4  psp  tg2  tgp)
+set(FFMPEG_PARSERS  h263  h264  mpeg4video)
+set(FFMPEG_PROTOCOLS  file)
+set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-filters --disable-protocols --disable-network --disable-indevs --disable-outdevs --disable-bsfs
+				  --disable-parsers --disable-decoders --disable-encoders --disable-demuxers --disable-muxers --enable-postproc --enable-swscale --enable-gpl 
+				  --prefix=${CMAKE_INSTALL_PREFIX})
+
+if (NOT VERBOSE)
+	set(ffmpegSvnOutput OUTPUT_VARIABLE FFMPEG_SVN_OUTPUT)
+	set(swscaleSvnOutput OUTPUT_VARIABLE SWSCALE_SVN_OUTPUT)
+	set(ffmpegBuildOutput OUTPUT_VARIABLE FFMPEG_CONFIGURE_OUTPUT)
+endif (NOT VERBOSE)
+
+# Checkout FFmpeg source and patch it
+if (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
+	find_package(Patch)
+
+	message(STATUS "Checking out FFmpeg")
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/ffmpeg/trunk -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})
+
+	message(STATUS "Checking out libswscale")
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/mplayer/trunk/libswscale -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+
+	set(FFMPEG_PERFORM_PATCH 1)
+endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
+
+# Check version
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
+message(STATUS "FFmpeg revision: ${ffmpeg_WC_REVISION}")
+
+if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+	MESSAGE(STATUS "Updating to revision ${FFMPEG_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+	
+	find_package(Patch)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})	
+endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+
+message("")
+
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
+message(STATUS "libswscale revision: ${swscale_WC_REVISION}")
+
+if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
+	message(STATUS "Updating to revision ${SWSCALE_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+	
+	find_package(Patch)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
+
+message("")
+
+if (FFMPEG_PERFORM_PATCH)
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+
+	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/cmake/patches/*.patch")
+
+	foreach(patchFile ${patchFiles})
+		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i ${patchFile}
+						WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}")
+	endforeach(patchFile)
+
+	message("")
+endif (FFMPEG_PERFORM_PATCH)
+
+# Configure FFmpeg, if required
+foreach (decoder ${FFMPEG_DECODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-decoder=${decoder})
+endforeach (decoder)
+
+foreach (encoder ${FFMPEG_DECODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-encoder=${encoder})
+endforeach (encoder)
+
+foreach (muxer ${FFMPEG_MUXERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-muxer=${muxer})
+endforeach (muxer)
+
+foreach (parser ${FFMPEG_PARSERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-parser=${parser})
+endforeach (parser)
+
+foreach (protocol ${FFMPEG_PROTOCOLS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-protocol=${protocol})
+endforeach (protocol)
+
+if (WIN32)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-memalign-hack --enable-w32threads)
+else (WIN32)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-pthreads)
+endif (WIN32)
+
+if (NOT ADM_DEBUG)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --disable-debug)
+endif (NOT ADM_DEBUG)
+
+if (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
+
+if (NOT EXISTS "${FFMPEG_BINARY_DIR}/Makefile")
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT EXISTS "${FFMPEG_BINARY_DIR}/Makefile")
+
+if (FFMPEG_PERFORM_BUILD)
+	message(STATUS "Configuring FFmpeg")
+	set(LAST_FFMPEG_FLAGS "${FFMPEG_FLAGS}" CACHE STRING "" FORCE)
+
+	file(MAKE_DIRECTORY "${FFMPEG_BINARY_DIR}")
+	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
+	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg_g${CMAKE_EXECUTABLE_SUFFIX}")
+
+	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
+					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
+					${ffmpegBuildOutput})
+	message("")
+endif (FFMPEG_PERFORM_BUILD)
+
+# Build FFmpeg
+add_custom_command(OUTPUT "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}"
+				   COMMAND ${CMAKE_COMMAND}  -DCMAKE_SHARED_LIBRARY_SUFFIX=${CMAKE_SHARED_LIBRARY_SUFFIX} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegMake.cmake"
+				   WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
+
+add_custom_target(ffmpeg ALL
+				  DEPENDS "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
+
+# Add and install libraries
+getFfmpegLibNames("${FFMPEG_SOURCE_DIR}")
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}")
+install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${BIN_DIR}")
+
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}")
+install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${BIN_DIR}")
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${BIN_DIR}")
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${BIN_DIR}")
+
+add_library(ADM_libavformat UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavformat PROPERTY IMPORTED_LOCATION "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${BIN_DIR}")
+
+include_directories("${FFMPEG_SOURCE_DIR}")
+include_directories("${FFMPEG_SOURCE_DIR}/libavutil")
+include_directories("${FFMPEG_SOURCE_DIR}/libpostproc")
+
+# Clean FFmpeg
+add_custom_target(cleanffmpeg
+				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
+				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
+				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegClean.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,2 @@
+execute_process(COMMAND make clean
+				WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegMake.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1 @@
+execute_process(COMMAND make)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+MACRO (getFfmpegVersionFromHeader description headerFile definition ffmpegVersion)
+	FILE(READ "${headerFile}" FFMPEG_H)
+	STRING(REGEX MATCH "#define[ ]+${definition}[ ]+([0-9]+)" FFMPEG_H "${FFMPEG_H}")
+	STRING(REGEX REPLACE ".*[ ]([0-9]+).*" "\\1" ${ffmpegVersion} "${FFMPEG_H}")
+ENDMACRO (getFfmpegVersionFromHeader)
+
+MACRO (getFfmpegLibNames sourceDir)
+	getFfmpegVersionFromHeader("libavcodec" "${sourceDir}/libavcodec/avcodec.h" LIBAVCODEC_VERSION_MAJOR LIBAVCODEC_VERSION)
+	getFfmpegVersionFromHeader("libavformat" "${sourceDir}/libavformat/avformat.h" LIBAVFORMAT_VERSION_MAJOR LIBAVFORMAT_VERSION)
+	getFfmpegVersionFromHeader("libavutil" "${sourceDir}/libavutil/avutil.h" LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
+	getFfmpegVersionFromHeader("libpostproc" "${sourceDir}/libpostproc/postprocess.h" LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
+	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
+	
+	set(LIBAVCODEC_LIB avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBAVFORMAT_LIB avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBAVUTIL_LIB avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBPOSTPROC_LIB postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	set(LIBSWSCALE_LIB swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+ENDMACRO (getFfmpegLibNames)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,78 @@
+*** libavcodec/avcodec.h	Sat Jan 17 18:42:27 2009
+--- libavcodec/avcodec.h	Sat Jan 17 17:54:54 2009
+***************
+*** 177,182 ****
+--- 177,183 ----
+      CODEC_ID_SUNRAST,
+      CODEC_ID_INDEO4,
+      CODEC_ID_INDEO5,
++     CODEC_ID_DIRAC,
+  
+      /* various PCM "codecs" */
+      CODEC_ID_PCM_S16LE= 0x10000,
+***************
+*** 449,454 ****
+--- 450,457 ----
+  #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
+  #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
+  #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
++ //MEANX: NEVER EVER USE CLOSED GOP ?
++ #define CODEC_FLAG2_32_PULLDOWN   0x80000000 
+  
+  /* Unsupported options :
+   *              Syntax Arithmetic coding (SAC)
+***************
+*** 1215,1220 ****
+--- 1218,1224 ----
+       * - decoding: unused
+       */
+      int rc_max_rate;
++     int rc_max_rate_header; /*< That one is set in the header MEANX */
+  
+      /**
+       * minimum bitrate
+***************
+*** 1229,1234 ****
+--- 1233,1240 ----
+       * - decoding: unused
+       */
+      int rc_buffer_size;
++     int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
++ 
+      float rc_buffer_aggressivity;
+  
+      /**
+***************
+*** 2293,2299 ****
+  
+  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
+  /* YUV420 format is assumed ! */
+! 
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+--- 2299,2305 ----
+  
+  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
+  /* YUV420 format is assumed ! */
+! #if 0 // MEANX
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+***************
+*** 2325,2331 ****
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! 
+  #endif
+  
+  /**
+--- 2331,2337 ----
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! #endif //MEANX
+  #endif
+  
+  /**

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,13 @@
+*** libavcodec/ffv1.c	Sat Jan 17 19:11:59 2009
+--- libavcodec/ffv1.c	Tue Jan 13 19:57:28 2009
+***************
+*** 959,964 ****
+--- 959,966 ----
+          clear_state(f);
+      }else{
+          p->key_frame= 0;
++          p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
++ 
+      }
+      if(!f->plane[0].state && !f->plane[0].vlc_state)
+          return -1;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,60 @@
+*** libavcodec/h263dec.c	Sat Jan 17 19:12:00 2009
+--- libavcodec/h263dec.c	Tue Jan 13 19:57:29 2009
+***************
+*** 118,123 ****
+--- 118,140 ----
+  
+      return 0;
+  }
++ /* MeanX : Ugly patch to detect vo ppacked stuff ... */
++ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
++ {
++     MpegEncContext *s = avctx->priv_data;
++     // set sane default
++     *vop_packed=0;
++     *gmc=0;
++     *qpel=0;
++     if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
++     	
++   	*vop_packed=(s->divx_packed);
++ 	*qpel=s->quarter_sample;
++ 	*gmc=0;	// FIXME
++ 	return 1;
++ 
++   }
++   /* MeanX */
+  
+  int ff_h263_decode_end(AVCodecContext *avctx)
+  {
+***************
+*** 412,417 ****
+--- 429,440 ----
+      } else {
+          ret = h263_decode_picture_header(s);
+      }
++ 	//MEANX we need to do it here also for quicktime file / ctts atom 
++         // we need the correct frame type, and qt file may contain 
++         // vop not coded frame.
++         pict->pict_type=s->current_picture.pict_type= s->pict_type;
++         pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
++         //MEANX
+  
+      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
+  
+***************
+*** 690,695 ****
+--- 713,726 ----
+  
+  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
+  assert(s->current_picture.pict_type == s->pict_type);
++ /* MEANX */
++   if(s->current_picture_ptr)
++       s->current_picture_ptr->opaque=pict->opaque;
++ /* MEANX */
++ 
++ 
++ 
++ 
+      if (s->pict_type == FF_B_TYPE || s->low_delay) {
+          *pict= *(AVFrame*)s->current_picture_ptr;
+      } else if (s->last_picture_ptr != NULL) {

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,22 @@
+*** libavcodec/h264.c	Sat Jan 17 19:11:59 2009
+--- libavcodec/h264.c	Tue Jan 13 19:57:28 2009
+***************
+*** 75,80 ****
+--- 75,91 ----
+  0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
+  };
+  
++ /* MEANX */
++ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
++ {
++       H264Context *h = avctx->priv_data;
++       assert(h);
++       *nalSize=h->nal_length_size;
++       *isAvc=h->is_avc;
++ 	return 1;
++ 
++   }
++ /* MeanX */
+  
+  static void fill_caches(H264Context *h, int mb_type, int for_deblock){
+      MpegEncContext * const s = &h->s;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,16 @@
+*** libavcodec/mpeg12.c	Sat Jan 17 19:17:41 2009
+--- libavcodec/mpeg12.c	Tue Jan 13 19:57:29 2009
+***************
+*** 1934,1939 ****
+--- 1934,1944 ----
+          ff_er_frame_end(s);
+  
+          MPV_frame_end(s);
++ /* MEANX */
++   if(s->current_picture_ptr)
++       s->current_picture_ptr->opaque=pict->opaque;
++ /* MEANX */
++ 
+  
+          if (s->pict_type == FF_B_TYPE || s->low_delay) {
+              *pict= *(AVFrame*)s->current_picture_ptr;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,231 @@
+*** libavcodec/mpeg12enc.c	Sat Jan 17 21:33:37 2009
+--- libavcodec/mpeg12enc.c	Sat Jan 17 21:35:16 2009
+***************
+*** 127,136 ****
+--- 127,145 ----
+              s->frame_rate_index= i;
+          }
+      }
++  /* MEANX 
++ 
+      if(dmin)
+          return -1;
+      else
+          return 0;
++   */
++         if(dmin>4)
++    {
++         av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
++    }
++         return 0; //MEANX
++ 
+  }
+  
+  static int encode_init(AVCodecContext *avctx)
+***************
+*** 208,213 ****
+--- 217,223 ----
+  
+              put_bits(&s->pb, 12, s->width);
+              put_bits(&s->pb, 12, s->height);
++ #if 0 //MEANX
+  
+              for(i=1; i<15; i++){
+                  float error= aspect_ratio;
+***************
+*** 223,242 ****
+                      s->aspect_ratio_info= i;
+                  }
+              }
+  
+!             put_bits(&s->pb, 4, s->aspect_ratio_info);
+!             put_bits(&s->pb, 4, s->frame_rate_index);
+! 
+!             if(s->avctx->rc_max_rate){
+!                 v = (s->avctx->rc_max_rate + 399) / 400;
+                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s->avctx->rc_buffer_size)
+!                 vbv_buffer_size = s->avctx->rc_buffer_size;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+--- 233,276 ----
+                      s->aspect_ratio_info= i;
+                  }
+              }
++ #endif // MEANX
++             //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
++             //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
++  // MEANX 4:3
++   if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
++             {
++                 //printf("FFmpeg : Wide\n");
++                 put_bits(&s->pb,4,3); //16:9
++             }
++             else        //4:3
++             {
++               if(s->codec_id == CODEC_ID_MPEG2VIDEO)
++                 put_bits(&s->pb, 4, 2);
++               else
++                 put_bits(&s->pb, 4, 12); // MPEG1
++             }
++ // /MEANX
++ 
++ // //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
++ if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
++             {           
++                 put_bits(&s->pb, 4,4);
++             }
++             else
++             {                                  
++                 put_bits(&s->pb, 4, s->frame_rate_index);
++             } //MEANX pulldown
+  
+!             if(s->avctx->rc_max_rate_header){ //MEANX we use header
+!                 v = (s->avctx->rc_max_rate_header + 399) / 400;
+                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s->avctx->rc_buffer_size_header) // MEANX we use header
+!                 vbv_buffer_size = s->avctx->rc_buffer_size_header;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+***************
+*** 269,276 ****
+  
+                  put_bits(&s->pb, 3, s->avctx->profile); //profile
+                  put_bits(&s->pb, 4, s->avctx->level); //level
+  
+-                 put_bits(&s->pb, 1, s->progressive_sequence);
+                  put_bits(&s->pb, 2, s->chroma_format);
+                  put_bits(&s->pb, 2, 0); //horizontal size ext
+                  put_bits(&s->pb, 2, 0); //vertical size ext
+--- 303,319 ----
+  
+                  put_bits(&s->pb, 3, s->avctx->profile); //profile
+                  put_bits(&s->pb, 4, s->avctx->level); //level
++    // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
++   // MEANX Pulldown
++  if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
++                         put_bits(&s->pb, 1, 0);
++                 else
++                         put_bits(&s->pb, 1, s->progressive_sequence);
++ 
++ 
++ // /MEANX
++ 
+  
+                  put_bits(&s->pb, 2, s->chroma_format);
+                  put_bits(&s->pb, 2, 0); //horizontal size ext
+                  put_bits(&s->pb, 2, 0); //vertical size ext
+***************
+*** 334,339 ****
+--- 377,384 ----
+  
+  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
+  {
++ 	int tff,rff; //MEANX
++ 
+      mpeg1_encode_sequence_header(s);
+  
+      /* mpeg1 picture header */
+***************
+*** 370,375 ****
+--- 415,463 ----
+  
+      s->frame_pred_frame_dct = 1;
+      if(s->codec_id == CODEC_ID_MPEG2VIDEO){
++  /* MEANX -- Pulldown */
++         if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
++         {
++         
++                 switch((s->picture_number - 
++                           s->gop_picture_number)&3)
++                 {
++                         case 0:
++                         default:
++                                 rff=1;
++                                 tff=1;
++                                 break;
++                         case 1:
++                                 rff=0;
++                                 tff=0;
++                                 break;
++                         case 2:
++                                 rff=1;
++                                 tff=0;
++                                 break;
++                         case 3:
++                                 rff=0;
++                                 tff=1;
++                                 break;
++                 }               
++            }
++         else
++         {
++                 if (s->progressive_sequence) 
++                 {
++                         tff=0; /* no repeat */
++                 } else 
++                 {
++                         tff= s->current_picture_ptr->top_field_first;
++                 }
++                 rff=s->repeat_first_field;
++         
++         }
++ 
++ //               /MEANX pulldown
++ 
++ 
++ 
+          put_header(s, EXT_START_CODE);
+          put_bits(&s->pb, 4, 8); //pic ext
+          if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
+***************
+*** 388,398 ****
+--- 476,491 ----
+  
+          assert(s->picture_structure == PICT_FRAME);
+          put_bits(&s->pb, 2, s->picture_structure);
++ #if 0 //MEANX
++ 
+          if (s->progressive_sequence) {
+              put_bits(&s->pb, 1, 0); /* no repeat */
+          } else {
+              put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
+          }
++ #endif
++          put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
++ 
+          /* XXX: optimize the generation of this flag with entropy
+             measures */
+          s->frame_pred_frame_dct = s->progressive_sequence;
+***************
+*** 402,408 ****
+          put_bits(&s->pb, 1, s->q_scale_type);
+          put_bits(&s->pb, 1, s->intra_vlc_format);
+          put_bits(&s->pb, 1, s->alternate_scan);
+!         put_bits(&s->pb, 1, s->repeat_first_field);
+          s->progressive_frame = s->progressive_sequence;
+          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+          put_bits(&s->pb, 1, s->progressive_frame);
+--- 495,504 ----
+          put_bits(&s->pb, 1, s->q_scale_type);
+          put_bits(&s->pb, 1, s->intra_vlc_format);
+          put_bits(&s->pb, 1, s->alternate_scan);
+!  // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
+! 	put_bits(&s->pb, 1, rff);
+!       // /MEANX
+! 
+          s->progressive_frame = s->progressive_sequence;
+          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+          put_bits(&s->pb, 1, s->progressive_frame);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,23 @@
+*** libavcodec/mpegvideo.c	Sat Jan 17 19:17:41 2009
+--- libavcodec/mpegvideo.c	Tue Jan 13 19:57:29 2009
+***************
+*** 558,564 ****
+      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s->parse_context.state= -1;
+!     if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+--- 558,568 ----
+      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s->parse_context.state= -1;
+!  //MEANX: Allocate them always, as they may be free when we decode 1st image
+! 
+!     // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+! if(1){ // MEANX
+! 
+         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,47 @@
+*** libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:28 2009
+--- libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:50 2009
+***************
+*** 371,382 ****
+--- 371,384 ----
+  
+          av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
+      }
++ #if 0 //MEANX
+  
+      if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
+         && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
+          av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
+          return -1;
+      }
++ #endif
+  
+      if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
+          av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
+***************
+*** 408,419 ****
+          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
+          return -1;
+      }
+  
+      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+          return -1;
+      }
+! 
+      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
+          return -1;
+--- 410,422 ----
+          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
+          return -1;
+      }
++ #if 0 //MEANX
+  
+      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+          return -1;
+      }
+! #endif
+      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
+          return -1;

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,34 @@
+*** libavcodec/utils.c	Sat Jan 17 19:17:40 2009
+--- libavcodec/utils.c	Tue Jan 13 19:57:28 2009
+***************
+*** 959,968 ****
+--- 959,970 ----
+  
+      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
+          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
++ #if 0 // MEANX : Silence
+          if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
+              av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
+              return -1;
+          }
++ #endif
+          if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
+          *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
+              av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
+***************
+*** 1387,1393 ****
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
+      fd = mkstemp(*filename);
+--- 1389,1395 ----
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
+      fd = mkstemp(*filename);

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,75 @@
+*** libavformat/file.c	Sat Jan 17 23:12:09 2009
+--- libavformat/file.c	Sat Jan 17 23:12:53 2009
+***************
+*** 26,31 ****
+--- 26,95 ----
+  #include <stdlib.h>
+  #include "os_support.h"
+  
++ // GRUNTSTER start
++ #ifdef __WIN32
++ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
++ {
++ 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
++ 
++ 	if (wideCharString)
++ 		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
++ 
++ 	return wideCharStringLength;
++ }
++ 
++ int ADM_open(const char *path, int oflag, ...)
++ {
++ 	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
++ 	wchar_t wcFile[fileNameLength];
++ 	int creation = 0, access = 0;
++ 	HANDLE hFile;
++ 
++ 	utf8StringToWideChar(path, -1, wcFile);
++ 
++ 	if (oflag & O_WRONLY || oflag & O_RDWR)
++ 	{
++ 		access = GENERIC_WRITE;
++ 
++ 		if (oflag & O_RDWR)
++ 			access |= GENERIC_READ;
++ 
++ 		if (oflag & O_CREAT)
++ 		{
++ 			if (oflag & O_EXCL)
++ 				creation = CREATE_NEW;
++ 			else if (oflag & O_TRUNC)
++ 				creation = CREATE_ALWAYS;
++ 			else
++ 				creation = OPEN_ALWAYS;
++ 		}
++ 		else if (oflag & O_TRUNC)
++ 			creation = TRUNCATE_EXISTING;
++ 	}
++ 	else if (oflag & O_RDONLY)
++ 		creation = OPEN_EXISTING;
++ 
++ 	if (creation & GENERIC_WRITE)
++ 	{
++ 		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
++ 
++ 		if (hFile == INVALID_HANDLE_VALUE)
++ 			return -1;
++ 		else
++ 			CloseHandle(hFile);
++ 	}
++ 
++ 	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
++ 
++ 	if (hFile == INVALID_HANDLE_VALUE)
++ 		return -1;
++ 	else
++ 		return _open_osfhandle((intptr_t)hFile, oflag);
++ }
++ 
++ #define open ADM_open
++ #endif
++ // GRUNTSTER end
+  
+  /* standard file protocol */
+  

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,33 @@
+*** libavformat/flvenc.c	Sat Jan 17 21:39:33 2009
+--- libavformat/flvenc.c	Sat Jan 17 21:39:38 2009
+***************
+*** 328,334 ****
+      "video/x-flv",
+      "flv",
+      sizeof(FLVContext),
+! #ifdef CONFIG_LIBMP3LAME
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
+--- 328,335 ----
+      "video/x-flv",
+      "flv",
+      sizeof(FLVContext),
+! //MEANX #ifdef CONFIG_LIBMP3LAME
+! #ifdef HAVE_LIBMP3LAME  
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
+***************
+*** 339,341 ****
+--- 340,348 ----
+      flv_write_trailer,
+      .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+  };
++ // MEANX
++ int flvenc_init(void)
++ {
++     av_register_output_format(&flv_muxer);
++     return 0;
++ }
+\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,39 @@
+*** libavformat/isom.c	Sat Jan 17 19:28:21 2009
+--- libavformat/isom.c	Tue Jan 13 19:57:35 2009
+***************
+*** 40,46 ****
+      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
+      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
+      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
+!     { CODEC_ID_MP3       , 107 }, /* 11172-3 */
+      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
+      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
+      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
+--- 40,46 ----
+      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
+      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
+      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
+!     { CODEC_ID_MP2       , 107 }, /* 11172-3 */ /* MEANX WAS MP3 */
+      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
+      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
+      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
+***************
+*** 149,155 ****
+      { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
+      { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
+  
+!     { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
+  
+--- 149,158 ----
+      { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
+      { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
+  
+!     //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+!      { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
+!      { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
+!     // /MEANX
+      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
+  

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,85 @@
+*** libavformat/matroskaenc.c	Sat Jan 17 19:28:21 2009
+--- libavformat/matroskaenc.c	Tue Jan 13 19:57:35 2009
+***************
+*** 391,396 ****
+--- 391,397 ----
+  
+  static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+  {
++ #if 0 // MEANX avidemux does thing differently
+      uint8_t *header_start[3];
+      int header_len[3];
+      int first_header_size;
+***************
+*** 415,420 ****
+--- 416,443 ----
+          put_buffer(pb, header_start[j], header_len[j]);
+  
+      return 0;
++ #else
++    // Not endian safe....
++       uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
++       uint8_t *data[3],i,j;
++       if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
++       {
++         av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
++         return -1;
++       }
++       data[0]=codec->extradata+3*4;
++       data[1]=data[0]+ptr[0];
++       data[2]=data[1]+ptr[1];
++       put_byte(pb, 2);                    // number packets - 1
++       for (j = 0; j < 2; j++) 
++       {
++           put_xiph_size(pb, ptr[j]);
++       }
++       for (j = 0; j < 3; j++)
++         put_buffer(pb, data[j], ptr[j]);
++       
++       return 0; // /MEANX
++ #endif
+  }
+  
+  #define FLAC_STREAMINFO_SIZE 34
+***************
+*** 544,549 ****
+--- 567,589 ----
+          put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
+          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
+          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
++ /**  MEANX : Add a default duration for video **/
++         if(codec->codec_type==CODEC_TYPE_VIDEO)
++         {
++           if(codec->time_base.den && codec->time_base.num)
++           {
++             int num=codec->time_base.num;
++             int den=codec->time_base.den;
++             unsigned int default_duration;
++             float period=num;
++                   period/=den;
++                   period*=1000*1000*1000; // in ns
++                   default_duration=(unsigned int)floor(period);
++                   put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
++           }
++         }
++         
++ /**  MEANX : Add a default duration for video **/
+  
+          if (st->language[0])
+              put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
+***************
+*** 845,847 ****
+--- 885,897 ----
+      mkv_write_trailer,
+      .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
+  };
++ // MEANX
++ //
++ int matroskaenc_init(void)
++ {
++     av_register_output_format(&matroska_muxer);
++     return 0;
++ }
++ // /MEANX
++ 
++ 

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,20 @@
+*** libavformat/movenc.c	Sat Jan 17 21:45:18 2009
+--- libavformat/movenc.c	Sat Jan 17 22:01:23 2009
+***************
+*** 1747,1749 ****
+--- 1747,1761 ----
+      .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
+  };
+  #endif
++ /* MEANX */
++ int movenc_init(void)
++ {
++     av_register_output_format(&mov_muxer);
++     av_register_output_format(&tgp_muxer);
++     av_register_output_format(&mp4_muxer);
++     av_register_output_format(&psp_muxer);
++     av_register_output_format(&tg2_muxer);
++     av_register_output_format(&ipod_muxer);
++     return 0;
++ }
++ /* MEANX */

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,18 @@
+*** libavutil/avutil.h	Sat Jan 17 21:11:42 2009
+--- libavutil/avutil.h	Sat Jan 17 21:42:06 2009
+***************
+*** 48,53 ****
+--- 48,60 ----
+  
+  #define LIBAVUTIL_IDENT         "Lavu" AV_STRINGIFY(LIBAVUTIL_VERSION)
+  
++ /* MEANX
++  * - */
++ #define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
++ /* /MEANX
++  */
++ 
++ 
+  
+  #include "common.h"
+  #include "mathematics.h"

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
@@ -0,0 +1,19 @@
+*** libavutil/internal.h	Sat Jan 17 21:11:42 2009
+--- libavutil/internal.h	Sat Jan 17 21:42:38 2009
+***************
+*** 234,245 ****
+--- 234,247 ----
+  #endif
+  
+  /* avoid usage of various functions */
++ #if 0 //MEANX
+  #undef  malloc
+  #define malloc please_use_av_malloc
+  #undef  free
+  #define free please_use_av_free
+  #undef  realloc
+  #define realloc please_use_av_realloc
++ #endif
+  #undef  time
+  #define time time_is_forbidden_due_to_security_issues
+  #undef  rand

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,9 +1,14 @@
 	INCLUDE(ae_plugin)
-        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/")
-        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/")
-        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/")
+	include(admFFmpegUtil)
 
+	getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux")
+	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+
 	SET(ADM_ae_lav_mp2_SRCS audioencoder_lavcodec.cpp)
+	
+	add_library(ADM_libavcodec UNKNOWN IMPORTED)
+	set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}")	
 
 	ADD_LIBRARY(ADM_ae_lav_mp2 SHARED ${ADM_ae_lav_mp2_SRCS})
 	ADD_TARGET_CFLAGS(ADM_ae_lav_mp2 "-DADM_LAV_MP2")

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -7,6 +7,7 @@
 
 INCLUDE(vf_plugin_gtk)
 INCLUDE(vf_plugin_qt4)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 
 SET(equalizerGtk_SRCS gtk/DIA_equalizer.cpp)
 SET(equalizerQT_SRCS  DIA_flyEqualiser.cpp  qt4/Q_equaliser.cpp  qt4/T_gridFrame.cpp  qt4/T_EqualiserPath.cpp)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -28,7 +28,7 @@
 #include "ADM_vidEqualizer.h"
 #include "ADM_colorspace.h"
 extern "C" {
-#include "../../../ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "libavcodec/avcodec.h"
 }
 
 static ColYuvRgb    *rgbConv=NULL;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,14 @@
 INCLUDE(vf_plugin)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc")
+include(admFFmpegUtil)
 
+getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+
 SET(ADM_vf_forcedPP_SRCS ADM_vidForcedPP.cpp)
 
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBPOSTPROC_LIB}")
+
 ADD_LIBRARY(ADM_vf_forcedPP SHARED ${ADM_vf_forcedPP_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_forcedPP ADM_libpostproc)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/McDeint/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,14 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
+getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 SET(ADM_vf_mcdeint_SRCS ADM_vidMcDeint.cpp)
 
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}")
+
 ADD_LIBRARY(ADM_vf_mcdeint SHARED ${ADM_vf_mcdeint_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_mcdeint ADM_libavcodec)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -21,10 +21,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
-
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Mosaic/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,12 +1,23 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
+SET(ADM_vf_Mosaic_SRCS ADM_vidMosaic.cpp)
 
-SET(ADM_vf_Mosaic_SRCS ADM_vidMosaic.cpp)
+getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}")
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}")
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVUTIL_LIB}")
+
 ADD_LIBRARY(ADM_vf_Mosaic SHARED ${ADM_vf_Mosaic_SRCS})
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libswscale)
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libavcodec)
-TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libavutil)
+TARGET_LINK_LIBRARIES(ADM_vf_Mosaic ADM_libswscale ADM_libavcodec ADM_libavutil)
 
 INIT_VIDEOFILTER_PLUGIN(ADM_vf_Mosaic)
 INSTALL_VIDEOFILTER(ADM_vf_Mosaic)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/ADM_vidMPLResize.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -27,9 +27,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 typedef struct alg

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/MplayerResize/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,4 +1,5 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
 SET(resizeCommon_SRCS ADM_vidMPLResize.cpp)
 SET(resizeCommonGtk_SRCS gtk/gtk_resize.cpp)
@@ -6,9 +7,19 @@
 SET(resizeCommonQT_Headers qt4/Q_resize.h)
 SET(resizeCommonQT_UI qt4/resizing)
 
+getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-#INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/../")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}")
+
+add_library(ADM_libavcodec UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVCODEC_LIB}")
+
+add_library(ADM_libavutil UNKNOWN IMPORTED)
+set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBAVUTIL_LIB}")
+
 INCLUDE(vf_plugin_gtk)
 INIT_VIDEOFILTER_PLUGIN_GTK(ADM_vf_mplayerResize_gtk ${resizeCommonGtk_SRCS} ${resizeCommon_SRCS})
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/ADM_lavpp_deint.cpp	2009-01-19 22:53:34 UTC (rev 4538)
@@ -31,7 +31,7 @@
 #include "ADM_lavpp_deintparam.h"
 extern "C"
 {
-#include "ADM_libraries/ADM_ffmpeg/ADM_libpostproc/postprocess.h"
+#include "libpostproc/postprocess.h"
 };
 #include "DIA_factory.h"
 /*

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/lavDeinterlace/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -1,8 +1,18 @@
 INCLUDE(vf_plugin)
+include(admFFmpegUtil)
 
+SET(ADM_vf_lavDeinterlace_SRCS ADM_lavpp_deint.cpp)
 
-SET(ADM_vf_lavDeinterlace_SRCS ADM_lavpp_deint.cpp)
+getFfmpegLibNames("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
+
+add_library(ADM_libswscale UNKNOWN IMPORTED)
+set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBSWSCALE_LIB}")
+
+add_library(ADM_libpostproc UNKNOWN IMPORTED)
+set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION "${AVIDEMUX_BIN_DIR}/${LIBPOSTPROC_LIB}")
+
 ADD_LIBRARY(ADM_vf_lavDeinterlace SHARED ${ADM_vf_lavDeinterlace_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vf_lavDeinterlace ADM_libswscale ADM_libpostproc)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2009-01-19 22:14:53 UTC (rev 4537)
+++ branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2009-01-19 22:53:34 UTC (rev 4538)
@@ -3,11 +3,11 @@
 MESSAGE("#####################################")
 MESSAGE("")
 
-CMAKE_MINIMUM_REQUIRED(VERSION 2.4.7 FATAL_ERROR)
+CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2 FATAL_ERROR)
 
 if (COMMAND cmake_policy)
-	cmake_policy(VERSION 2.4)
 	cmake_policy(SET CMP0003 NEW)
+	cmake_policy(SET CMP0004 OLD)
 endif (COMMAND cmake_policy)
 
 IF (NOT CMAKE_CXX_COMPILER_WORKS MATCHES "^${CMAKE_CXX_COMPILER_WORKS}$")
@@ -36,13 +36,13 @@
 ########################################
 # Where are the libraries
 ########################################
-IF(NOT AVIDEMUX_LIB_DIR)
-	MESSAGE(FATAL_ERROR "Please add -DAVIDEMUX_LIB_DIR=path_to_avidemux_libs")
-ELSE (NOT AVIDEMUX_LIB_DIR)
-	SET(AVIDEMUX_LIB_DIR "${AVIDEMUX_LIB_DIR}" CACHE STRING "")
-ENDIF(NOT AVIDEMUX_LIB_DIR)
+IF (NOT AVIDEMUX_INSTALL_PREFIX)
+	MESSAGE(FATAL_ERROR "Please add -DAVIDEMUX_INSTALL_PREFIX=path_to_avidemux_install")
+ELSE (NOT AVIDEMUX_INSTALL_PREFIX)
+	SET(AVIDEMUX_BIN_DIR "${AVIDEMUX_INSTALL_PREFIX}" CACHE STRING "")
+ENDIF (NOT AVIDEMUX_INSTALL_PREFIX)
 
-LINK_DIRECTORIES(${AVIDEMUX_LIB_DIR})
+LINK_DIRECTORIES(${AVIDEMUX_INSTALL_PREFIX}/lib)
 
 ########################################
 # Where is coreConfig ?
@@ -89,6 +89,7 @@
 
 IF (WIN32)
 	SET(BIN_DIR .)
+	set(AVIDEMUX_BIN_DIR ${AVIDEMUX_INSTALL_PREFIX})
 	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,-enable-auto-image-base -Wl,-enable-auto-import")
 
 	IF (CMAKE_BUILD_TYPE STREQUAL "Release")
@@ -96,6 +97,7 @@
 	ENDIF (CMAKE_BUILD_TYPE STREQUAL "Release")
 ELSE (WIN32)
 	SET(BIN_DIR bin)
+	set(AVIDEMUX_BIN_DIR ${AVIDEMUX_INSTALL_PREFIX}/bin)
 ENDIF (WIN32)
 
 ########################################



From gruntster at mail.berlios.de  Wed Jan 21 20:51:19 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 21 Jan 2009 20:51:19 +0100
Subject: [Avidemux-svn-commit] r4539 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <200901211951.n0LJpJas031882@sheep.berlios.de>

Author: gruntster
Date: 2009-01-21 20:51:01 +0100 (Wed, 21 Jan 2009)
New Revision: 4539

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/FindUnix2Dos.cmake
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Log:
[[ffmpeg] fix bootstrapping for Unix

Added: branches/avidemux_2.5_branch_gruntster/cmake/FindUnix2Dos.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/FindUnix2Dos.cmake	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/FindUnix2Dos.cmake	2009-01-21 19:51:01 UTC (rev 4539)
@@ -0,0 +1,19 @@
+if (NOT UNIX2DOS_EXECUTABLE)
+	message(STATUS "Checking for unix2dos")
+	message(STATUS "*********************")
+
+	find_program(UNIX2DOS_EXECUTABLE unix2dos)
+	set(UNIX2DOS_EXECUTABLE ${UNIX2DOS_EXECUTABLE} CACHE STRING "")
+
+	if (UNIX2DOS_EXECUTABLE)
+		message(STATUS "Found unix2dos")
+		
+		if (VERBOSE)
+			message(STATUS "Path: ${UNIX2DOS_EXECUTABLE}")
+		endif (VERBOSE)
+	else (UNIX2DOS_EXECUTABLE)
+		message(FATAL_ERROR "unix2dos not found")
+	endif (UNIX2DOS_EXECUTABLE)
+
+	message("")
+endif (NOT UNIX2DOS_EXECUTABLE)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-21 19:51:01 UTC (rev 4539)
@@ -20,12 +20,17 @@
 	set(ffmpegSvnOutput OUTPUT_VARIABLE FFMPEG_SVN_OUTPUT)
 	set(swscaleSvnOutput OUTPUT_VARIABLE SWSCALE_SVN_OUTPUT)
 	set(ffmpegBuildOutput OUTPUT_VARIABLE FFMPEG_CONFIGURE_OUTPUT)
+	set(unix2dosOutput OUTPUT_VARIABLE UNIX2DOS_OUTPUT)
 endif (NOT VERBOSE)
 
 # Checkout FFmpeg source and patch it
 if (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
 	find_package(Patch)
 
+	if (WIN32)
+		find_package(Unix2Dos)
+	endif (WIN32)
+
 	message(STATUS "Checking out FFmpeg")
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/ffmpeg/trunk -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})
@@ -34,6 +39,8 @@
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/mplayer/trunk/libswscale -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
 
+	message("")
+
 	set(FFMPEG_PERFORM_PATCH 1)
 endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
 
@@ -45,9 +52,13 @@
 	MESSAGE(STATUS "Updating to revision ${FFMPEG_VERSION}")
 	set(FFMPEG_PERFORM_BUILD 1)
 	set(FFMPEG_PERFORM_PATCH 1)
-	
+
 	find_package(Patch)
 
+	if (WIN32)
+		find_package(Unix2Dos)
+	endif (WIN32)
+
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})	
 endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
@@ -61,9 +72,13 @@
 	message(STATUS "Updating to revision ${SWSCALE_VERSION}")
 	set(FFMPEG_PERFORM_BUILD 1)
 	set(FFMPEG_PERFORM_PATCH 1)
-	
+
 	find_package(Patch)
 
+	if (WIN32)
+		find_package(Unix2Dos)
+	endif (WIN32)
+
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
 endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
@@ -79,7 +94,16 @@
 	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/cmake/patches/*.patch")
 
 	foreach(patchFile ${patchFiles})
-		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i ${patchFile}
+		if (WIN32)
+			file(MAKE_DIRECTORY "${FFMPEG_BINARY_DIR}/patches")
+			get_filename_component(fileName "${patchFile}" NAME)
+			execute_process(COMMAND ${UNIX2DOS_EXECUTABLE} -n ${patchFile} ${FFMPEG_BINARY_DIR}/patches/${fileName}
+							${unix2dosOutput})
+
+			set(patchFile "${FFMPEG_BINARY_DIR}/patches/${fileName}")
+		endif (WIN32)
+
+		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${patchFile}"
 						WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}")
 	endforeach(patchFile)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-01-21 19:51:01 UTC (rev 4539)
@@ -10,10 +10,18 @@
 	getFfmpegVersionFromHeader("libavutil" "${sourceDir}/libavutil/avutil.h" LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
 	getFfmpegVersionFromHeader("libpostproc" "${sourceDir}/libpostproc/postprocess.h" LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
 	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
-	
-	set(LIBAVCODEC_LIB avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-	set(LIBAVFORMAT_LIB avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-	set(LIBAVUTIL_LIB avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-	set(LIBPOSTPROC_LIB postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-	set(LIBSWSCALE_LIB swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+
+	if (UNIX)
+		set(LIBAVCODEC_LIB libavcodec${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCODEC_VERSION})
+		set(LIBAVFORMAT_LIB libavformat${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVFORMAT_VERSION})
+		set(LIBAVUTIL_LIB libavutil${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVUTIL_VERSION})
+		set(LIBPOSTPROC_LIB libpostproc${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBPOSTPROC_VERSION})
+		set(LIBSWSCALE_LIB libswscale${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBSWSCALE_VERSION})
+	else (UNIX)	
+		set(LIBAVCODEC_LIB avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVFORMAT_LIB avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVUTIL_LIB avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBPOSTPROC_LIB postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBSWSCALE_LIB swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	endif (UNIX)
 ENDMACRO (getFfmpegLibNames)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,76 +3,76 @@
 ***************
 *** 177,182 ****
 --- 177,183 ----
-      CODEC_ID_SUNRAST,
-      CODEC_ID_INDEO4,
-      CODEC_ID_INDEO5,
-+     CODEC_ID_DIRAC,
-  
-      /* various PCM "codecs" */
-      CODEC_ID_PCM_S16LE= 0x10000,
+      CODEC_ID_SUNRAST,
+      CODEC_ID_INDEO4,
+      CODEC_ID_INDEO5,
++     CODEC_ID_DIRAC,
+  
+      /* various PCM "codecs" */
+      CODEC_ID_PCM_S16LE= 0x10000,
 ***************
 *** 449,454 ****
 --- 450,457 ----
-  #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
-  #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
-  #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
-+ //MEANX: NEVER EVER USE CLOSED GOP ?
-+ #define CODEC_FLAG2_32_PULLDOWN   0x80000000 
-  
-  /* Unsupported options :
-   *              Syntax Arithmetic coding (SAC)
+  #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
+  #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
+  #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
++ //MEANX: NEVER EVER USE CLOSED GOP ?
++ #define CODEC_FLAG2_32_PULLDOWN   0x80000000 
+  
+  /* Unsupported options :
+   *              Syntax Arithmetic coding (SAC)
 ***************
 *** 1215,1220 ****
 --- 1218,1224 ----
-       * - decoding: unused
-       */
-      int rc_max_rate;
-+     int rc_max_rate_header; /*< That one is set in the header MEANX */
-  
-      /**
-       * minimum bitrate
+       * - decoding: unused
+       */
+      int rc_max_rate;
++     int rc_max_rate_header; /*< That one is set in the header MEANX */
+  
+      /**
+       * minimum bitrate
 ***************
 *** 1229,1234 ****
 --- 1233,1240 ----
-       * - decoding: unused
-       */
-      int rc_buffer_size;
-+     int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
-+ 
-      float rc_buffer_aggressivity;
-  
-      /**
+       * - decoding: unused
+       */
+      int rc_buffer_size;
++     int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
++ 
+      float rc_buffer_aggressivity;
+  
+      /**
 ***************
 *** 2293,2299 ****
-  
-  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
-  /* YUV420 format is assumed ! */
-! 
-  /**
-   * @deprecated Use the software scaler (swscale) instead.
-   */
+  
+  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
+  /* YUV420 format is assumed ! */
+! 
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
 --- 2299,2305 ----
-  
-  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
-  /* YUV420 format is assumed ! */
-! #if 0 // MEANX
-  /**
-   * @deprecated Use the software scaler (swscale) instead.
-   */
+  
+  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
+  /* YUV420 format is assumed ! */
+! #if 0 // MEANX
+  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
 ***************
 *** 2325,2331 ****
-   * @deprecated Use the software scaler (swscale) instead.
-   */
-  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
-! 
-  #endif
-  
-  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! 
+  #endif
+  
+  /**
 --- 2331,2337 ----
-   * @deprecated Use the software scaler (swscale) instead.
-   */
-  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
-! #endif //MEANX
-  #endif
-  
-  /**
+   * @deprecated Use the software scaler (swscale) instead.
+   */
+  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
+! #endif //MEANX
+  #endif
+  
+  /**

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,11 +3,11 @@
 ***************
 *** 959,964 ****
 --- 959,966 ----
-          clear_state(f);
-      }else{
-          p->key_frame= 0;
-+          p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
-+ 
-      }
-      if(!f->plane[0].state && !f->plane[0].vlc_state)
-          return -1;
+          clear_state(f);
+      }else{
+          p->key_frame= 0;
++          p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
++ 
+      }
+      if(!f->plane[0].state && !f->plane[0].vlc_state)
+          return -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,58 +3,58 @@
 ***************
 *** 118,123 ****
 --- 118,140 ----
-  
-      return 0;
-  }
-+ /* MeanX : Ugly patch to detect vo ppacked stuff ... */
-+ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
-+ {
-+     MpegEncContext *s = avctx->priv_data;
-+     // set sane default
-+     *vop_packed=0;
-+     *gmc=0;
-+     *qpel=0;
-+     if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
-+     	
-+   	*vop_packed=(s->divx_packed);
-+ 	*qpel=s->quarter_sample;
-+ 	*gmc=0;	// FIXME
-+ 	return 1;
-+ 
-+   }
-+   /* MeanX */
-  
-  int ff_h263_decode_end(AVCodecContext *avctx)
-  {
+  
+      return 0;
+  }
++ /* MeanX : Ugly patch to detect vo ppacked stuff ... */
++ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
++ {
++     MpegEncContext *s = avctx->priv_data;
++     // set sane default
++     *vop_packed=0;
++     *gmc=0;
++     *qpel=0;
++     if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
++     	
++   	*vop_packed=(s->divx_packed);
++ 	*qpel=s->quarter_sample;
++ 	*gmc=0;	// FIXME
++ 	return 1;
++ 
++   }
++   /* MeanX */
+  
+  int ff_h263_decode_end(AVCodecContext *avctx)
+  {
 ***************
 *** 412,417 ****
 --- 429,440 ----
-      } else {
-          ret = h263_decode_picture_header(s);
-      }
-+ 	//MEANX we need to do it here also for quicktime file / ctts atom 
-+         // we need the correct frame type, and qt file may contain 
-+         // vop not coded frame.
-+         pict->pict_type=s->current_picture.pict_type= s->pict_type;
-+         pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
-+         //MEANX
-  
-      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
-  
+      } else {
+          ret = h263_decode_picture_header(s);
+      }
++ 	//MEANX we need to do it here also for quicktime file / ctts atom 
++         // we need the correct frame type, and qt file may contain 
++         // vop not coded frame.
++         pict->pict_type=s->current_picture.pict_type= s->pict_type;
++         pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
++         //MEANX
+  
+      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
+  
 ***************
 *** 690,695 ****
 --- 713,726 ----
-  
-  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
-  assert(s->current_picture.pict_type == s->pict_type);
-+ /* MEANX */
-+   if(s->current_picture_ptr)
-+       s->current_picture_ptr->opaque=pict->opaque;
-+ /* MEANX */
-+ 
-+ 
-+ 
-+ 
-      if (s->pict_type == FF_B_TYPE || s->low_delay) {
-          *pict= *(AVFrame*)s->current_picture_ptr;
-      } else if (s->last_picture_ptr != NULL) {
+  
+  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
+  assert(s->current_picture.pict_type == s->pict_type);
++ /* MEANX */
++   if(s->current_picture_ptr)
++       s->current_picture_ptr->opaque=pict->opaque;
++ /* MEANX */
++ 
++ 
++ 
++ 
+      if (s->pict_type == FF_B_TYPE || s->low_delay) {
+          *pict= *(AVFrame*)s->current_picture_ptr;
+      } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,20 +3,20 @@
 ***************
 *** 75,80 ****
 --- 75,91 ----
-  0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
-  };
-  
-+ /* MEANX */
-+ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
-+ {
-+       H264Context *h = avctx->priv_data;
-+       assert(h);
-+       *nalSize=h->nal_length_size;
-+       *isAvc=h->is_avc;
-+ 	return 1;
-+ 
-+   }
-+ /* MeanX */
-  
-  static void fill_caches(H264Context *h, int mb_type, int for_deblock){
-      MpegEncContext * const s = &h->s;
+  0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
+  };
+  
++ /* MEANX */
++ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
++ {
++       H264Context *h = avctx->priv_data;
++       assert(h);
++       *nalSize=h->nal_length_size;
++       *isAvc=h->is_avc;
++ 	return 1;
++ 
++   }
++ /* MeanX */
+  
+  static void fill_caches(H264Context *h, int mb_type, int for_deblock){
+      MpegEncContext * const s = &h->s;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,14 +3,14 @@
 ***************
 *** 1934,1939 ****
 --- 1934,1944 ----
-          ff_er_frame_end(s);
-  
-          MPV_frame_end(s);
-+ /* MEANX */
-+   if(s->current_picture_ptr)
-+       s->current_picture_ptr->opaque=pict->opaque;
-+ /* MEANX */
-+ 
-  
-          if (s->pict_type == FF_B_TYPE || s->low_delay) {
-              *pict= *(AVFrame*)s->current_picture_ptr;
+          ff_er_frame_end(s);
+  
+          MPV_frame_end(s);
++ /* MEANX */
++   if(s->current_picture_ptr)
++       s->current_picture_ptr->opaque=pict->opaque;
++ /* MEANX */
++ 
+  
+          if (s->pict_type == FF_B_TYPE || s->low_delay) {
+              *pict= *(AVFrame*)s->current_picture_ptr;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,229 +3,229 @@
 ***************
 *** 127,136 ****
 --- 127,145 ----
-              s->frame_rate_index= i;
-          }
-      }
-+  /* MEANX 
-+ 
-      if(dmin)
-          return -1;
-      else
-          return 0;
-+   */
-+         if(dmin>4)
-+    {
-+         av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
-+    }
-+         return 0; //MEANX
-+ 
-  }
-  
-  static int encode_init(AVCodecContext *avctx)
+              s->frame_rate_index= i;
+          }
+      }
++  /* MEANX 
++ 
+      if(dmin)
+          return -1;
+      else
+          return 0;
++   */
++         if(dmin>4)
++    {
++         av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
++    }
++         return 0; //MEANX
++ 
+  }
+  
+  static int encode_init(AVCodecContext *avctx)
 ***************
 *** 208,213 ****
 --- 217,223 ----
-  
-              put_bits(&s->pb, 12, s->width);
-              put_bits(&s->pb, 12, s->height);
-+ #if 0 //MEANX
-  
-              for(i=1; i<15; i++){
-                  float error= aspect_ratio;
+  
+              put_bits(&s->pb, 12, s->width);
+              put_bits(&s->pb, 12, s->height);
++ #if 0 //MEANX
+  
+              for(i=1; i<15; i++){
+                  float error= aspect_ratio;
 ***************
 *** 223,242 ****
-                      s->aspect_ratio_info= i;
-                  }
-              }
-  
-!             put_bits(&s->pb, 4, s->aspect_ratio_info);
-!             put_bits(&s->pb, 4, s->frame_rate_index);
-! 
-!             if(s->avctx->rc_max_rate){
-!                 v = (s->avctx->rc_max_rate + 399) / 400;
-                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
-                      v = 0x3ffff;
-              }else{
-                  v= 0x3FFFF;
-              }
-  
-!             if(s->avctx->rc_buffer_size)
-!                 vbv_buffer_size = s->avctx->rc_buffer_size;
-              else
-                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
-                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+                      s->aspect_ratio_info= i;
+                  }
+              }
+  
+!             put_bits(&s->pb, 4, s->aspect_ratio_info);
+!             put_bits(&s->pb, 4, s->frame_rate_index);
+! 
+!             if(s->avctx->rc_max_rate){
+!                 v = (s->avctx->rc_max_rate + 399) / 400;
+                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s->avctx->rc_buffer_size)
+!                 vbv_buffer_size = s->avctx->rc_buffer_size;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
 --- 233,276 ----
-                      s->aspect_ratio_info= i;
-                  }
-              }
-+ #endif // MEANX
-+             //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
-+             //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
-+  // MEANX 4:3
-+   if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
-+             {
-+                 //printf("FFmpeg : Wide\n");
-+                 put_bits(&s->pb,4,3); //16:9
-+             }
-+             else        //4:3
-+             {
-+               if(s->codec_id == CODEC_ID_MPEG2VIDEO)
-+                 put_bits(&s->pb, 4, 2);
-+               else
-+                 put_bits(&s->pb, 4, 12); // MPEG1
-+             }
-+ // /MEANX
-+ 
-+ // //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
-+ if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
-+             {           
-+                 put_bits(&s->pb, 4,4);
-+             }
-+             else
-+             {                                  
-+                 put_bits(&s->pb, 4, s->frame_rate_index);
-+             } //MEANX pulldown
-  
-!             if(s->avctx->rc_max_rate_header){ //MEANX we use header
-!                 v = (s->avctx->rc_max_rate_header + 399) / 400;
-                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
-                      v = 0x3ffff;
-              }else{
-                  v= 0x3FFFF;
-              }
-  
-!             if(s->avctx->rc_buffer_size_header) // MEANX we use header
-!                 vbv_buffer_size = s->avctx->rc_buffer_size_header;
-              else
-                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
-                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+                      s->aspect_ratio_info= i;
+                  }
+              }
++ #endif // MEANX
++             //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
++             //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
++  // MEANX 4:3
++   if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
++             {
++                 //printf("FFmpeg : Wide\n");
++                 put_bits(&s->pb,4,3); //16:9
++             }
++             else        //4:3
++             {
++               if(s->codec_id == CODEC_ID_MPEG2VIDEO)
++                 put_bits(&s->pb, 4, 2);
++               else
++                 put_bits(&s->pb, 4, 12); // MPEG1
++             }
++ // /MEANX
++ 
++ // //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
++ if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
++             {           
++                 put_bits(&s->pb, 4,4);
++             }
++             else
++             {                                  
++                 put_bits(&s->pb, 4, s->frame_rate_index);
++             } //MEANX pulldown
+  
+!             if(s->avctx->rc_max_rate_header){ //MEANX we use header
+!                 v = (s->avctx->rc_max_rate_header + 399) / 400;
+                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                      v = 0x3ffff;
+              }else{
+                  v= 0x3FFFF;
+              }
+  
+!             if(s->avctx->rc_buffer_size_header) // MEANX we use header
+!                 vbv_buffer_size = s->avctx->rc_buffer_size_header;
+              else
+                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
 ***************
 *** 269,276 ****
-  
-                  put_bits(&s->pb, 3, s->avctx->profile); //profile
-                  put_bits(&s->pb, 4, s->avctx->level); //level
-  
--                 put_bits(&s->pb, 1, s->progressive_sequence);
-                  put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, 0); //horizontal size ext
-                  put_bits(&s->pb, 2, 0); //vertical size ext
+  
+                  put_bits(&s->pb, 3, s->avctx->profile); //profile
+                  put_bits(&s->pb, 4, s->avctx->level); //level
+  
+-                 put_bits(&s->pb, 1, s->progressive_sequence);
+                  put_bits(&s->pb, 2, s->chroma_format);
+                  put_bits(&s->pb, 2, 0); //horizontal size ext
+                  put_bits(&s->pb, 2, 0); //vertical size ext
 --- 303,319 ----
-  
-                  put_bits(&s->pb, 3, s->avctx->profile); //profile
-                  put_bits(&s->pb, 4, s->avctx->level); //level
-+    // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
-+   // MEANX Pulldown
-+  if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
-+                         put_bits(&s->pb, 1, 0);
-+                 else
-+                         put_bits(&s->pb, 1, s->progressive_sequence);
-+ 
-+ 
-+ // /MEANX
-+ 
-  
-                  put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, 0); //horizontal size ext
-                  put_bits(&s->pb, 2, 0); //vertical size ext
+  
+                  put_bits(&s->pb, 3, s->avctx->profile); //profile
+                  put_bits(&s->pb, 4, s->avctx->level); //level
++    // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
++   // MEANX Pulldown
++  if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
++                         put_bits(&s->pb, 1, 0);
++                 else
++                         put_bits(&s->pb, 1, s->progressive_sequence);
++ 
++ 
++ // /MEANX
++ 
+  
+                  put_bits(&s->pb, 2, s->chroma_format);
+                  put_bits(&s->pb, 2, 0); //horizontal size ext
+                  put_bits(&s->pb, 2, 0); //vertical size ext
 ***************
 *** 334,339 ****
 --- 377,384 ----
-  
-  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
-  {
-+ 	int tff,rff; //MEANX
-+ 
-      mpeg1_encode_sequence_header(s);
-  
-      /* mpeg1 picture header */
+  
+  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
+  {
++ 	int tff,rff; //MEANX
++ 
+      mpeg1_encode_sequence_header(s);
+  
+      /* mpeg1 picture header */
 ***************
 *** 370,375 ****
 --- 415,463 ----
-  
-      s->frame_pred_frame_dct = 1;
-      if(s->codec_id == CODEC_ID_MPEG2VIDEO){
-+  /* MEANX -- Pulldown */
-+         if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
-+         {
-+         
-+                 switch((s->picture_number - 
-+                           s->gop_picture_number)&3)
-+                 {
-+                         case 0:
-+                         default:
-+                                 rff=1;
-+                                 tff=1;
-+                                 break;
-+                         case 1:
-+                                 rff=0;
-+                                 tff=0;
-+                                 break;
-+                         case 2:
-+                                 rff=1;
-+                                 tff=0;
-+                                 break;
-+                         case 3:
-+                                 rff=0;
-+                                 tff=1;
-+                                 break;
-+                 }               
-+            }
-+         else
-+         {
-+                 if (s->progressive_sequence) 
-+                 {
-+                         tff=0; /* no repeat */
-+                 } else 
-+                 {
-+                         tff= s->current_picture_ptr->top_field_first;
-+                 }
-+                 rff=s->repeat_first_field;
-+         
-+         }
-+ 
-+ //               /MEANX pulldown
-+ 
-+ 
-+ 
-          put_header(s, EXT_START_CODE);
-          put_bits(&s->pb, 4, 8); //pic ext
-          if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
+  
+      s->frame_pred_frame_dct = 1;
+      if(s->codec_id == CODEC_ID_MPEG2VIDEO){
++  /* MEANX -- Pulldown */
++         if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
++         {
++         
++                 switch((s->picture_number - 
++                           s->gop_picture_number)&3)
++                 {
++                         case 0:
++                         default:
++                                 rff=1;
++                                 tff=1;
++                                 break;
++                         case 1:
++                                 rff=0;
++                                 tff=0;
++                                 break;
++                         case 2:
++                                 rff=1;
++                                 tff=0;
++                                 break;
++                         case 3:
++                                 rff=0;
++                                 tff=1;
++                                 break;
++                 }               
++            }
++         else
++         {
++                 if (s->progressive_sequence) 
++                 {
++                         tff=0; /* no repeat */
++                 } else 
++                 {
++                         tff= s->current_picture_ptr->top_field_first;
++                 }
++                 rff=s->repeat_first_field;
++         
++         }
++ 
++ //               /MEANX pulldown
++ 
++ 
++ 
+          put_header(s, EXT_START_CODE);
+          put_bits(&s->pb, 4, 8); //pic ext
+          if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
 ***************
 *** 388,398 ****
 --- 476,491 ----
-  
-          assert(s->picture_structure == PICT_FRAME);
-          put_bits(&s->pb, 2, s->picture_structure);
-+ #if 0 //MEANX
-+ 
-          if (s->progressive_sequence) {
-              put_bits(&s->pb, 1, 0); /* no repeat */
-          } else {
-              put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
-          }
-+ #endif
-+          put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
-+ 
-          /* XXX: optimize the generation of this flag with entropy
-             measures */
-          s->frame_pred_frame_dct = s->progressive_sequence;
+  
+          assert(s->picture_structure == PICT_FRAME);
+          put_bits(&s->pb, 2, s->picture_structure);
++ #if 0 //MEANX
++ 
+          if (s->progressive_sequence) {
+              put_bits(&s->pb, 1, 0); /* no repeat */
+          } else {
+              put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
+          }
++ #endif
++          put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
++ 
+          /* XXX: optimize the generation of this flag with entropy
+             measures */
+          s->frame_pred_frame_dct = s->progressive_sequence;
 ***************
 *** 402,408 ****
-          put_bits(&s->pb, 1, s->q_scale_type);
-          put_bits(&s->pb, 1, s->intra_vlc_format);
-          put_bits(&s->pb, 1, s->alternate_scan);
-!         put_bits(&s->pb, 1, s->repeat_first_field);
-          s->progressive_frame = s->progressive_sequence;
-          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
-          put_bits(&s->pb, 1, s->progressive_frame);
+          put_bits(&s->pb, 1, s->q_scale_type);
+          put_bits(&s->pb, 1, s->intra_vlc_format);
+          put_bits(&s->pb, 1, s->alternate_scan);
+!         put_bits(&s->pb, 1, s->repeat_first_field);
+          s->progressive_frame = s->progressive_sequence;
+          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+          put_bits(&s->pb, 1, s->progressive_frame);
 --- 495,504 ----
-          put_bits(&s->pb, 1, s->q_scale_type);
-          put_bits(&s->pb, 1, s->intra_vlc_format);
-          put_bits(&s->pb, 1, s->alternate_scan);
-!  // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
-! 	put_bits(&s->pb, 1, rff);
-!       // /MEANX
-! 
-          s->progressive_frame = s->progressive_sequence;
-          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
-          put_bits(&s->pb, 1, s->progressive_frame);
+          put_bits(&s->pb, 1, s->q_scale_type);
+          put_bits(&s->pb, 1, s->intra_vlc_format);
+          put_bits(&s->pb, 1, s->alternate_scan);
+!  // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
+! 	put_bits(&s->pb, 1, rff);
+!       // /MEANX
+! 
+          s->progressive_frame = s->progressive_sequence;
+          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+          put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -2,22 +2,22 @@
 --- libavcodec/mpegvideo.c	Tue Jan 13 19:57:29 2009
 ***************
 *** 558,564 ****
-      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
-  
-      s->parse_context.state= -1;
-!     if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s->parse_context.state= -1;
+!     if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
 --- 558,568 ----
-      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
-  
-      s->parse_context.state= -1;
-!  //MEANX: Allocate them always, as they may be free when we decode 1st image
-! 
-!     // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-! if(1){ // MEANX
-! 
-         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+      CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
+  
+      s->parse_context.state= -1;
+!  //MEANX: Allocate them always, as they may be free when we decode 1st image
+! 
+!     // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+! if(1){ // MEANX
+! 
+         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,45 +3,45 @@
 ***************
 *** 371,382 ****
 --- 371,384 ----
-  
-          av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
-      }
-+ #if 0 //MEANX
-  
-      if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
-         && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
-          av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
-          return -1;
-      }
-+ #endif
-  
-      if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
-          av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
+  
+          av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
+      }
++ #if 0 //MEANX
+  
+      if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
+         && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
+          av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
+          return -1;
+      }
++ #endif
+  
+      if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
+          av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
 ***************
 *** 408,419 ****
-          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
-          return -1;
-      }
-  
-      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
-          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
-          return -1;
-      }
-! 
-      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
-          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
-          return -1;
+          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
+          return -1;
+      }
+  
+      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+          return -1;
+      }
+! 
+      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
+          return -1;
 --- 410,422 ----
-          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
-          return -1;
-      }
-+ #if 0 //MEANX
-  
-      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
-          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
-          return -1;
-      }
-! #endif
-      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
-          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
-          return -1;
+          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
+          return -1;
+      }
++ #if 0 //MEANX
+  
+      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+          return -1;
+      }
+! #endif
+      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
+          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
+          return -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,32 +3,32 @@
 ***************
 *** 959,968 ****
 --- 959,970 ----
-  
-      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
-          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-+ #if 0 // MEANX : Silence
-          if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
-              av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
-              return -1;
-          }
-+ #endif
-          if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
-          *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
-              av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
+  
+      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
+          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
++ #if 0 // MEANX : Silence
+          if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
+              av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
+              return -1;
+          }
++ #endif
+          if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
+          *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
+              av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
 *** 1387,1393 ****
-          return -1;
-      }
-  #if !defined(HAVE_MKSTEMP)
-!     fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
-  #else
-      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
-      fd = mkstemp(*filename);
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
+      fd = mkstemp(*filename);
 --- 1389,1395 ----
-          return -1;
-      }
-  #if !defined(HAVE_MKSTEMP)
-!     fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
-  #else
-      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
-      fd = mkstemp(*filename);
+          return -1;
+      }
+  #if !defined(HAVE_MKSTEMP)
+!     fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
+  #else
+      snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
+      fd = mkstemp(*filename);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,73 +3,73 @@
 ***************
 *** 26,31 ****
 --- 26,95 ----
-  #include <stdlib.h>
-  #include "os_support.h"
-  
-+ // GRUNTSTER start
-+ #ifdef __WIN32
-+ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
-+ {
-+ 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
-+ 
-+ 	if (wideCharString)
-+ 		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
-+ 
-+ 	return wideCharStringLength;
-+ }
-+ 
-+ int ADM_open(const char *path, int oflag, ...)
-+ {
-+ 	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
-+ 	wchar_t wcFile[fileNameLength];
-+ 	int creation = 0, access = 0;
-+ 	HANDLE hFile;
-+ 
-+ 	utf8StringToWideChar(path, -1, wcFile);
-+ 
-+ 	if (oflag & O_WRONLY || oflag & O_RDWR)
-+ 	{
-+ 		access = GENERIC_WRITE;
-+ 
-+ 		if (oflag & O_RDWR)
-+ 			access |= GENERIC_READ;
-+ 
-+ 		if (oflag & O_CREAT)
-+ 		{
-+ 			if (oflag & O_EXCL)
-+ 				creation = CREATE_NEW;
-+ 			else if (oflag & O_TRUNC)
-+ 				creation = CREATE_ALWAYS;
-+ 			else
-+ 				creation = OPEN_ALWAYS;
-+ 		}
-+ 		else if (oflag & O_TRUNC)
-+ 			creation = TRUNCATE_EXISTING;
-+ 	}
-+ 	else if (oflag & O_RDONLY)
-+ 		creation = OPEN_EXISTING;
-+ 
-+ 	if (creation & GENERIC_WRITE)
-+ 	{
-+ 		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
-+ 
-+ 		if (hFile == INVALID_HANDLE_VALUE)
-+ 			return -1;
-+ 		else
-+ 			CloseHandle(hFile);
-+ 	}
-+ 
-+ 	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
-+ 
-+ 	if (hFile == INVALID_HANDLE_VALUE)
-+ 		return -1;
-+ 	else
-+ 		return _open_osfhandle((intptr_t)hFile, oflag);
-+ }
-+ 
-+ #define open ADM_open
-+ #endif
-+ // GRUNTSTER end
-  
-  /* standard file protocol */
-  
+  #include <stdlib.h>
+  #include "os_support.h"
+  
++ // GRUNTSTER start
++ #ifdef __WIN32
++ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
++ {
++ 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
++ 
++ 	if (wideCharString)
++ 		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
++ 
++ 	return wideCharStringLength;
++ }
++ 
++ int ADM_open(const char *path, int oflag, ...)
++ {
++ 	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
++ 	wchar_t wcFile[fileNameLength];
++ 	int creation = 0, access = 0;
++ 	HANDLE hFile;
++ 
++ 	utf8StringToWideChar(path, -1, wcFile);
++ 
++ 	if (oflag & O_WRONLY || oflag & O_RDWR)
++ 	{
++ 		access = GENERIC_WRITE;
++ 
++ 		if (oflag & O_RDWR)
++ 			access |= GENERIC_READ;
++ 
++ 		if (oflag & O_CREAT)
++ 		{
++ 			if (oflag & O_EXCL)
++ 				creation = CREATE_NEW;
++ 			else if (oflag & O_TRUNC)
++ 				creation = CREATE_ALWAYS;
++ 			else
++ 				creation = OPEN_ALWAYS;
++ 		}
++ 		else if (oflag & O_TRUNC)
++ 			creation = TRUNCATE_EXISTING;
++ 	}
++ 	else if (oflag & O_RDONLY)
++ 		creation = OPEN_EXISTING;
++ 
++ 	if (creation & GENERIC_WRITE)
++ 	{
++ 		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
++ 
++ 		if (hFile == INVALID_HANDLE_VALUE)
++ 			return -1;
++ 		else
++ 			CloseHandle(hFile);
++ 	}
++ 
++ 	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
++ 
++ 	if (hFile == INVALID_HANDLE_VALUE)
++ 		return -1;
++ 	else
++ 		return _open_osfhandle((intptr_t)hFile, oflag);
++ }
++ 
++ #define open ADM_open
++ #endif
++ // GRUNTSTER end
+  
+  /* standard file protocol */
+  

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -2,32 +2,32 @@
 --- libavformat/flvenc.c	Sat Jan 17 21:39:38 2009
 ***************
 *** 328,334 ****
-      "video/x-flv",
-      "flv",
-      sizeof(FLVContext),
-! #ifdef CONFIG_LIBMP3LAME
-      CODEC_ID_MP3,
-  #else // CONFIG_LIBMP3LAME
-      CODEC_ID_ADPCM_SWF,
+      "video/x-flv",
+      "flv",
+      sizeof(FLVContext),
+! #ifdef CONFIG_LIBMP3LAME
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
 --- 328,335 ----
-      "video/x-flv",
-      "flv",
-      sizeof(FLVContext),
-! //MEANX #ifdef CONFIG_LIBMP3LAME
-! #ifdef HAVE_LIBMP3LAME  
-      CODEC_ID_MP3,
-  #else // CONFIG_LIBMP3LAME
-      CODEC_ID_ADPCM_SWF,
+      "video/x-flv",
+      "flv",
+      sizeof(FLVContext),
+! //MEANX #ifdef CONFIG_LIBMP3LAME
+! #ifdef HAVE_LIBMP3LAME  
+      CODEC_ID_MP3,
+  #else // CONFIG_LIBMP3LAME
+      CODEC_ID_ADPCM_SWF,
 ***************
 *** 339,341 ****
 --- 340,348 ----
-      flv_write_trailer,
-      .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
-  };
-+ // MEANX
-+ int flvenc_init(void)
-+ {
-+     av_register_output_format(&flv_muxer);
-+     return 0;
+      flv_write_trailer,
+      .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+  };
++ // MEANX
++ int flvenc_init(void)
++ {
++     av_register_output_format(&flv_muxer);
++     return 0;
 + }
 \ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,18 +3,18 @@
 ***************
 *** 1747,1749 ****
 --- 1747,1761 ----
-      .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
-  };
-  #endif
-+ /* MEANX */
-+ int movenc_init(void)
-+ {
-+     av_register_output_format(&mov_muxer);
-+     av_register_output_format(&tgp_muxer);
-+     av_register_output_format(&mp4_muxer);
-+     av_register_output_format(&psp_muxer);
-+     av_register_output_format(&tg2_muxer);
-+     av_register_output_format(&ipod_muxer);
-+     return 0;
-+ }
-+ /* MEANX */
+      .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
+  };
+  #endif
++ /* MEANX */
++ int movenc_init(void)
++ {
++     av_register_output_format(&mov_muxer);
++     av_register_output_format(&tgp_muxer);
++     av_register_output_format(&mp4_muxer);
++     av_register_output_format(&psp_muxer);
++     av_register_output_format(&tg2_muxer);
++     av_register_output_format(&ipod_muxer);
++     return 0;
++ }
++ /* MEANX */

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,16 +3,16 @@
 ***************
 *** 48,53 ****
 --- 48,60 ----
-  
-  #define LIBAVUTIL_IDENT         "Lavu" AV_STRINGIFY(LIBAVUTIL_VERSION)
-  
-+ /* MEANX
-+  * - */
-+ #define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
-+ /* /MEANX
-+  */
-+ 
-+ 
-  
-  #include "common.h"
-  #include "mathematics.h"
+  
+  #define LIBAVUTIL_IDENT         "Lavu" AV_STRINGIFY(LIBAVUTIL_VERSION)
+  
++ /* MEANX
++  * - */
++ #define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
++ /* /MEANX
++  */
++ 
++ 
+  
+  #include "common.h"
+  #include "mathematics.h"

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-19 22:53:34 UTC (rev 4538)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-21 19:51:01 UTC (rev 4539)
@@ -3,17 +3,17 @@
 ***************
 *** 234,245 ****
 --- 234,247 ----
-  #endif
-  
-  /* avoid usage of various functions */
-+ #if 0 //MEANX
-  #undef  malloc
-  #define malloc please_use_av_malloc
-  #undef  free
-  #define free please_use_av_free
-  #undef  realloc
-  #define realloc please_use_av_realloc
-+ #endif
-  #undef  time
-  #define time time_is_forbidden_due_to_security_issues
-  #undef  rand
+  #endif
+  
+  /* avoid usage of various functions */
++ #if 0 //MEANX
+  #undef  malloc
+  #define malloc please_use_av_malloc
+  #undef  free
+  #define free please_use_av_free
+  #undef  realloc
+  #define realloc please_use_av_realloc
++ #endif
+  #undef  time
+  #define time time_is_forbidden_due_to_security_issues
+  #undef  rand



From gruntster at mail.berlios.de  Sat Jan 24 21:49:49 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 24 Jan 2009 21:49:49 +0100
Subject: [Avidemux-svn-commit] r4541 -
	branches/avidemux_2.5_branch_gruntster/cmake/patches
Message-ID: <200901242049.n0OKnnFm032032@sheep.berlios.de>

Author: gruntster
Date: 2009-01-24 21:49:39 +0100 (Sat, 24 Jan 2009)
New Revision: 4541

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_mem.c.patch
Log:
[ffmpeg] use Avidemux memory routines

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_mem.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_mem.c.patch	2009-01-24 15:18:39 UTC (rev 4540)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_mem.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
@@ -0,0 +1,207 @@
+*** libavutil/mem.c	Sat Jan 24 20:25:19 2009
+--- libavutil/mem.c	Sat Jan 24 20:17:09 2009
+***************
+*** 35,124 ****
+  #include <malloc.h>
+  #endif
+  
+- /* you can redefine av_malloc and av_free in your project to use your
+-    memory allocator. You do not need to suppress this file because the
+-    linker will do it automatically */
+- 
+  void *av_malloc(unsigned int size)
+  {
+!     void *ptr;
+! #ifdef CONFIG_MEMALIGN_HACK
+!     long diff;
+! #endif
+  
+!     /* let's disallow possible ambiguous cases */
+!     if(size > (INT_MAX-16) )
+!         return NULL;
+! 
+! #ifdef CONFIG_MEMALIGN_HACK
+!     ptr = malloc(size+16);
+!     if(!ptr)
+!         return ptr;
+!     diff= ((-(long)ptr - 1)&15) + 1;
+!     ptr = (char*)ptr + diff;
+!     ((char*)ptr)[-1]= diff;
+! #elif defined (HAVE_MEMALIGN)
+!     ptr = memalign(16,size);
+!     /* Why 64?
+!        Indeed, we should align it:
+!          on 4 for 386
+!          on 16 for 486
+!          on 32 for 586, PPro - k6-III
+!          on 64 for K7 (maybe for P3 too).
+!        Because L1 and L2 caches are aligned on those values.
+!        But I don't want to code such logic here!
+!      */
+!      /* Why 16?
+!         Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
+!         it will just trigger an exception and the unaligned load will be done in the
+!         exception handler or it will just segfault (SSE2 on P4)
+!         Why not larger? Because I did not see a difference in benchmarks ...
+!      */
+!      /* benchmarks with p3
+!         memalign(64)+1          3071,3051,3032
+!         memalign(64)+2          3051,3032,3041
+!         memalign(64)+4          2911,2896,2915
+!         memalign(64)+8          2545,2554,2550
+!         memalign(64)+16         2543,2572,2563
+!         memalign(64)+32         2546,2545,2571
+!         memalign(64)+64         2570,2533,2558
+  
+!         btw, malloc seems to do 8 byte alignment by default here
+!      */
+! #else
+!     ptr = malloc(size);
+  #endif
+-     return ptr;
+  }
+  
+! void *av_realloc(void *ptr, unsigned int size)
+  {
+! #ifdef CONFIG_MEMALIGN_HACK
+!     int diff;
+! #endif
+  
+!     /* let's disallow possible ambiguous cases */
+!     if(size > (INT_MAX-16) )
+!         return NULL;
+! 
+! #ifdef CONFIG_MEMALIGN_HACK
+!     //FIXME this isn't aligned correctly, though it probably isn't needed
+!     if(!ptr) return av_malloc(size);
+!     diff= ((char*)ptr)[-1];
+!     return (char*)realloc((char*)ptr - diff, size + diff) + diff;
+  #else
+!     return realloc(ptr, size);
+  #endif
+  }
+  
+  void av_free(void *ptr)
+  {
+!     /* XXX: this test should not be needed on most libcs */
+!     if (ptr)
+! #ifdef CONFIG_MEMALIGN_HACK
+!         free((char*)ptr - ((char*)ptr)[-1]);
+  #else
+!         free(ptr);
+  #endif
+  }
+  
+--- 35,146 ----
+  #include <malloc.h>
+  #endif
+  
+  void *av_malloc(unsigned int size)
+  {
+! #ifdef __APPLE__
+! 	return malloc(size);
+! #else
+! 	char *c;
+  
+! 	uint64_t l, lorg;
+! 	uint32_t *backdoor;
+  
+! 	l = (uint64_t)malloc(size + 32);
+! 
+! 	// Get next boundary
+! 	lorg = l;
+! 	l = (l + 15) & 0xfffffffffffffff0LL;
+! 	l += 16;
+! 	c = (char*)l;
+! 	backdoor = (uint32_t*)(c - 8);
+! 	*backdoor = (0xdead << 16) + l - lorg;
+! 	backdoor[1] = size;
+! 
+! 	return c;
+  #endif
+  }
+  
+! void *av_realloc(void *ptr, unsigned int newsize)
+  {
+! #ifdef __APPLE__
+! 	if (!ptr)
+! 		return av_malloc(newsize);
+  
+! 	if (!newsize)
+! 	{
+! 		av_free(ptr);
+! 		return NULL;
+! 	}
+! 
+! 	return realloc(ptr, newsize);
+  #else
+! 	void *nalloc;
+! 
+! 	if (!ptr)
+! 		return av_malloc(newsize);
+! 
+! 	if (!newsize) 
+! 	{    	
+! 		av_free(ptr);
+! 		return NULL;
+! 	}
+! 
+! 	// now we either shrink them or expand them
+! 	// in case of shrink, we do nothing
+! 	// in case of expand we have to copy
+! 	// Do copy everytime (slower)
+! 	uint32_t *backdoor;
+! 	uint32_t size, offset;
+! 	char *c = (char*)ptr;
+! 
+! 	backdoor = (uint32_t*)ptr;
+! 	backdoor -= 2;
+! 
+! 	assert(((*backdoor) >> 16) == 0xdead);
+! 
+! 	offset = backdoor[0] & 0xffff;
+! 	size = backdoor[1];
+! 
+! 	if(size >= newsize) // do nothing
+! 		return ptr;
+! 
+! 	// Allocate a new one
+! 	nalloc = av_malloc(newsize);
+! 	memcpy(nalloc, ptr, size);
+! 	av_free(ptr);
+! 
+! 	return nalloc;
+  #endif
+  }
+  
+  void av_free(void *ptr)
+  {
+! #ifdef __APPLE__
+! 	if (!ptr)
+! 		return;
+! 
+! 	free(ptr);
+  #else
+! 	uint32_t *backdoor;
+! 	uint32_t size, offset;
+! 	char *c = (char*)ptr;
+! 
+! 	if (!ptr)
+! 		return;
+! 
+! 	backdoor = (uint32_t*)ptr;
+! 	backdoor -= 2;
+! 
+! 	if (*backdoor == 0xbeefbeef)
+! 		assert(0);
+! 
+! 	assert(((*backdoor) >> 16) == 0xdead);
+! 
+! 	offset = backdoor[0] & 0xffff;
+! 	size = backdoor[1];
+! 	*backdoor = 0xbeefbeef; // Scratch sig
+! 
+! 	free(c - offset);
+  #endif
+  }
+  



From gruntster at mail.berlios.de  Sat Jan 24 23:08:54 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 24 Jan 2009 23:08:54 +0100
Subject: [Avidemux-svn-commit] r4542 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <200901242208.n0OM8sI6005563@sheep.berlios.de>

Author: gruntster
Date: 2009-01-24 23:08:46 +0100 (Sat, 24 Jan 2009)
New Revision: 4542

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Log:
[ffmpeg] update to FFmpeg r13000 & libswscale r26456

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 12476)
-set(SWSCALE_VERSION 26258)
+set(FFMPEG_VERSION 13000)
+set(SWSCALE_VERSION 26456)
 set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
 
@@ -59,6 +59,8 @@
 		find_package(Unix2Dos)
 	endif (WIN32)
 
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})	
 endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
@@ -79,6 +81,8 @@
 		find_package(Unix2Dos)
 	endif (WIN32)
 
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
 endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
@@ -86,11 +90,6 @@
 message("")
 
 if (FFMPEG_PERFORM_PATCH)
-	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}"
-					${ffmpegSvnOutput})
-	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}/libswscale"
-					${swscaleSvnOutput})
-
 	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/cmake/patches/*.patch")
 
 	foreach(patchFile ${patchFiles})

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2009-01-24 22:08:46 UTC (rev 4542)
@@ -0,0 +1,34 @@
+#!/bin/bash
+
+export curDir=$PWD
+export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
+
+function updatePatch {
+	cd $ffmpegPath
+	cp $1/$2 $1/$2.new
+	svn revert $1/$2
+	unix2dos $1/$2
+	mv $1/$2 $1/$2.old
+	mv $1/$2.new $1/$2
+	diff -c $1/$2.old $1/$2 > $curDir/$1_$2.patch
+	cd $curDir
+	dos2unix $1_$2.patch
+}
+
+updatePatch libavcodec avcodec.h
+updatePatch libavcodec ffv1.c
+updatePatch libavcodec h263dec.c
+updatePatch libavcodec h264.c
+updatePatch libavcodec mpeg12.c
+updatePatch libavcodec mpeg12enc.c
+updatePatch libavcodec mpegvideo.c
+updatePatch libavcodec mpegvideo_enc.c
+updatePatch libavcodec utils.c
+updatePatch libavformat file.c
+updatePatch libavformat flvenc.c
+updatePatch libavformat isom.c
+updatePatch libavformat matroskaenc.c
+updatePatch libavformat movenc.c
+updatePatch libavutil avutil.h
+updatePatch libavutil internal.h
+updatePatch libavutil mem.c
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,18 +1,8 @@
-*** libavcodec/avcodec.h	Sat Jan 17 18:42:27 2009
---- libavcodec/avcodec.h	Sat Jan 17 17:54:54 2009
+*** libavcodec/avcodec.h.old	Sat Jan 24 21:36:29 2009
+--- libavcodec/avcodec.h	Sat Jan 24 21:36:28 2009
 ***************
-*** 177,182 ****
---- 177,183 ----
-      CODEC_ID_SUNRAST,
-      CODEC_ID_INDEO4,
-      CODEC_ID_INDEO5,
-+     CODEC_ID_DIRAC,
-  
-      /* various PCM "codecs" */
-      CODEC_ID_PCM_S16LE= 0x10000,
-***************
-*** 449,454 ****
---- 450,457 ----
+*** 460,465 ****
+--- 460,467 ----
   #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
   #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
   #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
@@ -22,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1215,1220 ****
---- 1218,1224 ----
+*** 1228,1233 ****
+--- 1230,1236 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -32,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1229,1234 ****
---- 1233,1240 ----
+*** 1242,1247 ****
+--- 1245,1252 ----
        * - decoding: unused
        */
       int rc_buffer_size;
@@ -43,7 +33,7 @@
   
       /**
 ***************
-*** 2293,2299 ****
+*** 2316,2322 ****
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -51,7 +41,7 @@
   /**
    * @deprecated Use the software scaler (swscale) instead.
    */
---- 2299,2305 ----
+--- 2321,2327 ----
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -60,7 +50,7 @@
    * @deprecated Use the software scaler (swscale) instead.
    */
 ***************
-*** 2325,2331 ****
+*** 2348,2354 ****
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
@@ -68,7 +58,7 @@
   #endif
   
   /**
---- 2331,2337 ----
+--- 2353,2359 ----
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,5 +1,5 @@
-*** libavcodec/h263dec.c	Sat Jan 17 19:12:00 2009
---- libavcodec/h263dec.c	Tue Jan 13 19:57:29 2009
+*** libavcodec/h263dec.c.old	Sat Jan 24 21:36:31 2009
+--- libavcodec/h263dec.c	Sat Jan 24 21:36:30 2009
 ***************
 *** 118,123 ****
 --- 118,140 ----
@@ -24,7 +24,7 @@
 +   }
 +   /* MeanX */
   
-  int ff_h263_decode_end(AVCodecContext *avctx)
+  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
   {
 ***************
 *** 412,417 ****

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,8 +1,8 @@
-*** libavcodec/h264.c	Sat Jan 17 19:11:59 2009
---- libavcodec/h264.c	Tue Jan 13 19:57:28 2009
+*** libavcodec/h264.c.old	Sat Jan 24 21:36:32 2009
+--- libavcodec/h264.c	Sat Jan 24 21:36:31 2009
 ***************
-*** 75,80 ****
---- 75,91 ----
+*** 78,83 ****
+--- 78,94 ----
   0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
   };
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,5 +1,5 @@
-*** libavcodec/mpeg12enc.c	Sat Jan 17 21:33:37 2009
---- libavcodec/mpeg12enc.c	Sat Jan 17 21:35:16 2009
+*** libavcodec/mpeg12enc.c.old	Sat Jan 24 21:36:34 2009
+--- libavcodec/mpeg12enc.c	Sat Jan 24 21:36:33 2009
 ***************
 *** 127,136 ****
 --- 127,145 ----
@@ -21,7 +21,7 @@
 + 
   }
   
-  static int encode_init(AVCodecContext *avctx)
+  static av_cold int encode_init(AVCodecContext *avctx)
 ***************
 *** 208,213 ****
 --- 217,223 ----

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c	Sat Jan 17 19:17:40 2009
---- libavcodec/utils.c	Tue Jan 13 19:57:28 2009
+*** libavcodec/utils.c.old	Sat Jan 24 21:36:37 2009
+--- libavcodec/utils.c	Sat Jan 24 21:36:37 2009
 ***************
-*** 959,968 ****
---- 959,970 ----
+*** 963,972 ****
+--- 963,974 ----
   
       if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 1387,1393 ****
+*** 1391,1397 ****
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 1389,1395 ----
+--- 1393,1399 ----
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,5 +1,5 @@
-*** libavformat/isom.c	Sat Jan 17 19:28:21 2009
---- libavformat/isom.c	Tue Jan 13 19:57:35 2009
+*** libavformat/isom.c.old	Sat Jan 24 21:36:40 2009
+--- libavformat/isom.c	Sat Jan 24 21:36:39 2009
 ***************
 *** 40,46 ****
       { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
@@ -24,8 +24,8 @@
   
 !     { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
-      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
   
+  /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
 --- 149,158 ----
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
@@ -35,5 +35,5 @@
 !      { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
 !     // /MEANX
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
-      { CODEC_ID_MP3, MKTAG('m', 's', 0x00, 0x55) }, /* MPEG layer 3 *//* XXX: check endianness */
   
+  /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,8 +1,8 @@
-*** libavformat/matroskaenc.c	Sat Jan 17 19:28:21 2009
---- libavformat/matroskaenc.c	Tue Jan 13 19:57:35 2009
+*** libavformat/matroskaenc.c.old	Sat Jan 24 21:36:41 2009
+--- libavformat/matroskaenc.c	Sat Jan 24 21:36:40 2009
 ***************
-*** 391,396 ****
---- 391,397 ----
+*** 392,397 ****
+--- 392,398 ----
   
   static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
   {
@@ -11,8 +11,8 @@
       int header_len[3];
       int first_header_size;
 ***************
-*** 415,420 ****
---- 416,443 ----
+*** 416,421 ****
+--- 417,444 ----
           put_buffer(pb, header_start[j], header_len[j]);
   
       return 0;
@@ -42,8 +42,8 @@
   
   #define FLAC_STREAMINFO_SIZE 34
 ***************
-*** 544,549 ****
---- 567,589 ----
+*** 541,546 ****
+--- 564,586 ----
           put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
@@ -68,8 +68,8 @@
           if (st->language[0])
               put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
 ***************
-*** 845,847 ****
---- 885,897 ----
+*** 842,844 ****
+--- 882,894 ----
       mkv_write_trailer,
       .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
   };

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,8 +1,8 @@
-*** libavformat/movenc.c	Sat Jan 17 21:45:18 2009
---- libavformat/movenc.c	Sat Jan 17 22:01:23 2009
+*** libavformat/movenc.c.old	Sat Jan 24 21:36:42 2009
+--- libavformat/movenc.c	Sat Jan 24 21:36:41 2009
 ***************
-*** 1747,1749 ****
---- 1747,1761 ----
+*** 1757,1759 ****
+--- 1757,1771 ----
       .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
   };
   #endif

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-24 20:49:39 UTC (rev 4541)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-24 22:08:46 UTC (rev 4542)
@@ -1,8 +1,8 @@
-*** libavutil/internal.h	Sat Jan 17 21:11:42 2009
---- libavutil/internal.h	Sat Jan 17 21:42:38 2009
+*** libavutil/internal.h.old	Sat Jan 24 21:36:44 2009
+--- libavutil/internal.h	Sat Jan 24 21:36:43 2009
 ***************
-*** 234,245 ****
---- 234,247 ----
+*** 228,239 ****
+--- 228,241 ----
   #endif
   
   /* avoid usage of various functions */



From gruntster at mail.berlios.de  Sat Jan 24 23:48:43 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 24 Jan 2009 23:48:43 +0100
Subject: [Avidemux-svn-commit] r4543 - in
	branches/avidemux_2.5_branch_gruntster: avidemux
	avidemux/ADM_codecs cmake cmake/patches
Message-ID: <200901242248.n0OMmhs1009068@sheep.berlios.de>

Author: gruntster
Date: 2009-01-24 23:48:32 +0100 (Sat, 24 Jan 2009)
New Revision: 4543

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Log:
[ffmpeg] update to FFmpeg r14000 & libswscale r27035

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-24 22:48:32 UTC (rev 4543)
@@ -792,8 +792,4 @@
     printf("[lavc] %s\n",buf);
 }
 
-void ADM_lavDestroy(void)
-{
-	av_free_static();
-}
 // EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/main.cpp	2009-01-24 22:48:32 UTC (rev 4543)
@@ -37,10 +37,8 @@
 extern void xvid4_init(void);
 #endif
 
-
-
 extern void  ADM_lavInit();
-extern void  ADM_lavDestroy();
+
 extern "C" {
      extern uint8_t     ADM_InitMemcpy(void);
 };
@@ -303,7 +301,6 @@
     pthread_mutex_unlock(&g_pSpiderMonkeyMutex);
     destroyPrefs();
     filterCleanUp();
-	ADM_lavDestroy();
 
 #ifdef USE_SDL
 	quitSdl();

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 13000)
-set(SWSCALE_VERSION 26456)
+set(FFMPEG_VERSION 14000)
+set(SWSCALE_VERSION 27035)
 set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
 
@@ -49,20 +49,22 @@
 message(STATUS "FFmpeg revision: ${ffmpeg_WC_REVISION}")
 
 if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
-	MESSAGE(STATUS "Updating to revision ${FFMPEG_VERSION}")
-	set(FFMPEG_PERFORM_BUILD 1)
-	set(FFMPEG_PERFORM_PATCH 1)
-
 	find_package(Patch)
 
 	if (WIN32)
 		find_package(Unix2Dos)
 	endif (WIN32)
 
+	MESSAGE(STATUS "Updating to revision ${FFMPEG_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})	
+
+	message("")
 endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
 
 message("")
@@ -71,16 +73,16 @@
 message(STATUS "libswscale revision: ${swscale_WC_REVISION}")
 
 if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
-	message(STATUS "Updating to revision ${SWSCALE_VERSION}")
-	set(FFMPEG_PERFORM_BUILD 1)
-	set(FFMPEG_PERFORM_PATCH 1)
-
 	find_package(Patch)
 
 	if (WIN32)
 		find_package(Unix2Dos)
 	endif (WIN32)
 
+	message(STATUS "Updating to revision ${SWSCALE_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2009-01-24 22:48:32 UTC (rev 4543)
@@ -11,6 +11,7 @@
 	mv $1/$2 $1/$2.old
 	mv $1/$2.new $1/$2
 	diff -c $1/$2.old $1/$2 > $curDir/$1_$2.patch
+	rm $1/$2.old
 	cd $curDir
 	dos2unix $1_$2.patch
 }

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavcodec/avcodec.h.old	Sat Jan 24 21:36:29 2009
---- libavcodec/avcodec.h	Sat Jan 24 21:36:28 2009
+*** libavcodec/avcodec.h.old	Sat Jan 24 22:23:50 2009
+--- libavcodec/avcodec.h	Sat Jan 24 22:23:50 2009
 ***************
-*** 460,465 ****
---- 460,467 ----
+*** 465,470 ****
+--- 465,472 ----
   #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
   #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
   #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
@@ -12,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1228,1233 ****
---- 1230,1236 ----
+*** 1233,1238 ****
+--- 1235,1241 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1242,1247 ****
---- 1245,1252 ----
+*** 1247,1252 ****
+--- 1250,1257 ----
        * - decoding: unused
        */
       int rc_buffer_size;
@@ -33,7 +33,7 @@
   
       /**
 ***************
-*** 2316,2322 ****
+*** 2325,2331 ****
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -41,7 +41,7 @@
   /**
    * @deprecated Use the software scaler (swscale) instead.
    */
---- 2321,2327 ----
+--- 2330,2336 ----
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -50,7 +50,7 @@
    * @deprecated Use the software scaler (swscale) instead.
    */
 ***************
-*** 2348,2354 ****
+*** 2357,2363 ****
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
@@ -58,7 +58,7 @@
   #endif
   
   /**
---- 2353,2359 ----
+--- 2362,2368 ----
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavcodec/ffv1.c	Sat Jan 17 19:11:59 2009
---- libavcodec/ffv1.c	Tue Jan 13 19:57:28 2009
+*** libavcodec/ffv1.c.old	Sat Jan 24 22:23:51 2009
+--- libavcodec/ffv1.c	Sat Jan 24 22:23:50 2009
 ***************
-*** 959,964 ****
---- 959,966 ----
+*** 958,963 ****
+--- 958,965 ----
           clear_state(f);
       }else{
           p->key_frame= 0;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavcodec/mpeg12.c	Sat Jan 17 19:17:41 2009
---- libavcodec/mpeg12.c	Tue Jan 13 19:57:29 2009
+*** libavcodec/mpeg12.c.old	Sat Jan 24 22:23:54 2009
+--- libavcodec/mpeg12.c	Sat Jan 24 22:23:53 2009
 ***************
-*** 1934,1939 ****
---- 1934,1944 ----
+*** 1937,1942 ****
+--- 1937,1947 ----
           ff_er_frame_end(s);
   
           MPV_frame_end(s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,5 +1,5 @@
-*** libavcodec/mpeg12enc.c.old	Sat Jan 24 21:36:34 2009
---- libavcodec/mpeg12enc.c	Sat Jan 24 21:36:33 2009
+*** libavcodec/mpeg12enc.c.old	Sat Jan 24 22:23:55 2009
+--- libavcodec/mpeg12enc.c	Sat Jan 24 22:23:54 2009
 ***************
 *** 127,136 ****
 --- 127,145 ----
@@ -23,15 +23,22 @@
   
   static av_cold int encode_init(AVCodecContext *avctx)
 ***************
-*** 208,213 ****
+*** 208,214 ****
+  
+              put_bits(&s->pb, 12, s->width  & 0xFFF);
+              put_bits(&s->pb, 12, s->height & 0xFFF);
+! 
+              for(i=1; i<15; i++){
+                  float error= aspect_ratio;
+                  if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
 --- 217,223 ----
   
-              put_bits(&s->pb, 12, s->width);
-              put_bits(&s->pb, 12, s->height);
-+ #if 0 //MEANX
-  
+              put_bits(&s->pb, 12, s->width  & 0xFFF);
+              put_bits(&s->pb, 12, s->height & 0xFFF);
+! #if 0 //MEANX
               for(i=1; i<15; i++){
                   float error= aspect_ratio;
+                  if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
 ***************
 *** 223,242 ****
                       s->aspect_ratio_info= i;
@@ -54,7 +61,7 @@
               else
                   /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                   vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
---- 233,276 ----
+--- 232,275 ----
                       s->aspect_ratio_info= i;
                   }
               }
@@ -107,9 +114,9 @@
   
 -                 put_bits(&s->pb, 1, s->progressive_sequence);
                   put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, 0); //horizontal size ext
-                  put_bits(&s->pb, 2, 0); //vertical size ext
---- 303,319 ----
+                  put_bits(&s->pb, 2, s->width >>12);
+                  put_bits(&s->pb, 2, s->height>>12);
+--- 302,318 ----
   
                   put_bits(&s->pb, 3, s->avctx->profile); //profile
                   put_bits(&s->pb, 4, s->avctx->level); //level
@@ -125,11 +132,11 @@
 + 
   
                   put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, 0); //horizontal size ext
-                  put_bits(&s->pb, 2, 0); //vertical size ext
+                  put_bits(&s->pb, 2, s->width >>12);
+                  put_bits(&s->pb, 2, s->height>>12);
 ***************
 *** 334,339 ****
---- 377,384 ----
+--- 376,383 ----
   
   void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
   {
@@ -140,7 +147,7 @@
       /* mpeg1 picture header */
 ***************
 *** 370,375 ****
---- 415,463 ----
+--- 414,462 ----
   
       s->frame_pred_frame_dct = 1;
       if(s->codec_id == CODEC_ID_MPEG2VIDEO){
@@ -192,7 +199,7 @@
           if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
 ***************
 *** 388,398 ****
---- 476,491 ----
+--- 475,490 ----
   
           assert(s->picture_structure == PICT_FRAME);
           put_bits(&s->pb, 2, s->picture_structure);
@@ -218,7 +225,7 @@
           s->progressive_frame = s->progressive_sequence;
           put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
           put_bits(&s->pb, 1, s->progressive_frame);
---- 495,504 ----
+--- 494,503 ----
           put_bits(&s->pb, 1, s->q_scale_type);
           put_bits(&s->pb, 1, s->intra_vlc_format);
           put_bits(&s->pb, 1, s->alternate_scan);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:28 2009
---- libavcodec/mpegvideo_enc.c	Sat Jan 17 21:37:50 2009
+*** libavcodec/mpegvideo_enc.c.old	Sat Jan 24 22:23:57 2009
+--- libavcodec/mpegvideo_enc.c	Sat Jan 24 22:23:56 2009
 ***************
-*** 371,382 ****
---- 371,384 ----
+*** 376,387 ****
+--- 376,389 ----
   
           av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
       }
@@ -18,30 +18,17 @@
       if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
           av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
 ***************
-*** 408,419 ****
-          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
+*** 414,423 ****
+--- 416,427 ----
           return -1;
       }
   
-      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
-          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
-          return -1;
-      }
-! 
-      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
-          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
-          return -1;
---- 410,422 ----
-          av_log(avctx, AV_LOG_ERROR, "interlacing not supported by codec\n");
-          return -1;
-      }
 + #if 0 //MEANX
-  
       if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
           av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
           return -1;
       }
-! #endif
-      if((s->flags & CODEC_FLAG_CBP_RD) && !(s->flags & CODEC_FLAG_TRELLIS_QUANT)){
++ #endif
+  
+      if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
           av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
-          return -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c.old	Sat Jan 24 21:36:37 2009
---- libavcodec/utils.c	Sat Jan 24 21:36:37 2009
+*** libavcodec/utils.c.old	Sat Jan 24 22:23:58 2009
+--- libavcodec/utils.c	Sat Jan 24 22:23:57 2009
 ***************
-*** 963,972 ****
---- 963,974 ----
+*** 914,923 ****
+--- 914,925 ----
   
       if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 1391,1397 ****
+*** 1342,1348 ****
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 1393,1399 ----
+--- 1344,1350 ----
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavformat/file.c	Sat Jan 17 23:12:09 2009
---- libavformat/file.c	Sat Jan 17 23:12:53 2009
+*** libavformat/file.c.old	Sat Jan 24 22:23:59 2009
+--- libavformat/file.c	Sat Jan 24 22:23:58 2009
 ***************
-*** 26,31 ****
---- 26,95 ----
+*** 27,32 ****
+--- 27,96 ----
   #include <stdlib.h>
   #include "os_support.h"
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,7 +1,7 @@
-*** libavformat/flvenc.c	Sat Jan 17 21:39:33 2009
---- libavformat/flvenc.c	Sat Jan 17 21:39:38 2009
+*** libavformat/flvenc.c.old	Sat Jan 24 22:24:00 2009
+--- libavformat/flvenc.c	Sat Jan 24 22:23:59 2009
 ***************
-*** 328,334 ****
+*** 378,384 ****
       "video/x-flv",
       "flv",
       sizeof(FLVContext),
@@ -9,7 +9,7 @@
       CODEC_ID_MP3,
   #else // CONFIG_LIBMP3LAME
       CODEC_ID_ADPCM_SWF,
---- 328,335 ----
+--- 378,385 ----
       "video/x-flv",
       "flv",
       sizeof(FLVContext),
@@ -19,10 +19,10 @@
   #else // CONFIG_LIBMP3LAME
       CODEC_ID_ADPCM_SWF,
 ***************
-*** 339,341 ****
---- 340,348 ----
-      flv_write_trailer,
+*** 390,392 ****
+--- 391,399 ----
       .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+      .flags= AVFMT_GLOBALHEADER,
   };
 + // MEANX
 + int flvenc_init(void)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,5 +1,5 @@
-*** libavformat/isom.c.old	Sat Jan 24 21:36:40 2009
---- libavformat/isom.c	Sat Jan 24 21:36:39 2009
+*** libavformat/isom.c.old	Sat Jan 24 22:24:01 2009
+--- libavformat/isom.c	Sat Jan 24 22:24:00 2009
 ***************
 *** 40,46 ****
       { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
@@ -18,7 +18,7 @@
       { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
       { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
 ***************
-*** 149,155 ****
+*** 150,156 ****
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   
@@ -26,7 +26,7 @@
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
   
   /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
---- 149,158 ----
+--- 150,159 ----
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,5 +1,5 @@
-*** libavformat/matroskaenc.c.old	Sat Jan 24 21:36:41 2009
---- libavformat/matroskaenc.c	Sat Jan 24 21:36:40 2009
+*** libavformat/matroskaenc.c.old	Sat Jan 24 22:24:02 2009
+--- libavformat/matroskaenc.c	Sat Jan 24 22:24:01 2009
 ***************
 *** 392,397 ****
 --- 392,398 ----
@@ -42,8 +42,8 @@
   
   #define FLAC_STREAMINFO_SIZE 34
 ***************
-*** 541,546 ****
---- 564,586 ----
+*** 544,549 ****
+--- 567,589 ----
           put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
@@ -68,8 +68,8 @@
           if (st->language[0])
               put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
 ***************
-*** 842,844 ****
---- 882,894 ----
+*** 845,847 ****
+--- 885,897 ----
       mkv_write_trailer,
       .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
   };

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavformat/movenc.c.old	Sat Jan 24 21:36:42 2009
---- libavformat/movenc.c	Sat Jan 24 21:36:41 2009
+*** libavformat/movenc.c.old	Sat Jan 24 22:24:03 2009
+--- libavformat/movenc.c	Sat Jan 24 22:24:02 2009
 ***************
-*** 1757,1759 ****
---- 1757,1771 ----
+*** 1785,1787 ****
+--- 1785,1799 ----
       .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
   };
   #endif

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-24 22:08:46 UTC (rev 4542)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-24 22:48:32 UTC (rev 4543)
@@ -1,8 +1,8 @@
-*** libavutil/internal.h.old	Sat Jan 24 21:36:44 2009
---- libavutil/internal.h	Sat Jan 24 21:36:43 2009
+*** libavutil/internal.h.old	Sat Jan 24 22:24:05 2009
+--- libavutil/internal.h	Sat Jan 24 22:24:04 2009
 ***************
-*** 228,239 ****
---- 228,241 ----
+*** 227,238 ****
+--- 227,240 ----
   #endif
   
   /* avoid usage of various functions */



From gruntster at mail.berlios.de  Sun Jan 25 01:17:29 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 25 Jan 2009 01:17:29 +0100
Subject: [Avidemux-svn-commit] r4544 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_coreImage/src cmake cmake/patches
Message-ID: <200901250017.n0P0HTpL032630@sheep.berlios.de>

Author: gruntster
Date: 2009-01-25 01:17:13 +0100 (Sun, 25 Jan 2009)
New Revision: 4544

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Log:
[ffmpeg] update to FFmpeg r15000 & libswscale r27349

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-01-25 00:17:13 UTC (rev 4544)
@@ -30,7 +30,7 @@
 
 #ifdef ADM_CPU_X86
 		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
-#define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2);
+#define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2)	flags|=SWS_SPLINE;
 #else
 #ifdef ADM_CPU_ALTIVEC
 #define FLAGS() flags|=SWS_CPU_CAPS_ALTIVEC;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-01-25 00:17:13 UTC (rev 4544)
@@ -42,7 +42,7 @@
 
 #ifdef ADM_CPU_X86
 		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
-#define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2);
+#define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2)	flags|=SWS_SPLINE;
 #else
 #ifdef ADM_CPU_ALTIVEC
 #define FLAGS() flags|=SWS_CPU_CAPS_ALTIVEC;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 14000)
-set(SWSCALE_VERSION 27035)
+set(FFMPEG_VERSION 15000)
+set(SWSCALE_VERSION 27349)
 set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,8 +1,8 @@
-*** libavcodec/avcodec.h.old	Sat Jan 24 22:23:50 2009
---- libavcodec/avcodec.h	Sat Jan 24 22:23:50 2009
+*** libavcodec/avcodec.h.old	Sat Jan 24 22:57:36 2009
+--- libavcodec/avcodec.h	Sat Jan 24 22:57:35 2009
 ***************
-*** 465,470 ****
---- 465,472 ----
+*** 476,481 ****
+--- 476,483 ----
   #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
   #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
   #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
@@ -12,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1233,1238 ****
---- 1235,1241 ----
+*** 1260,1265 ****
+--- 1262,1268 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1247,1252 ****
---- 1250,1257 ----
+*** 1274,1279 ****
+--- 1277,1284 ----
        * - decoding: unused
        */
       int rc_buffer_size;
@@ -33,7 +33,7 @@
   
       /**
 ***************
-*** 2325,2331 ****
+*** 2362,2368 ****
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -41,7 +41,7 @@
   /**
    * @deprecated Use the software scaler (swscale) instead.
    */
---- 2330,2336 ----
+--- 2367,2373 ----
   
   #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
   /* YUV420 format is assumed ! */
@@ -50,7 +50,7 @@
    * @deprecated Use the software scaler (swscale) instead.
    */
 ***************
-*** 2357,2363 ****
+*** 2394,2400 ****
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
@@ -58,7 +58,7 @@
   #endif
   
   /**
---- 2362,2368 ----
+--- 2399,2405 ----
    * @deprecated Use the software scaler (swscale) instead.
    */
   attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,10 +1,10 @@
-*** libavcodec/h264.c.old	Sat Jan 24 21:36:32 2009
---- libavcodec/h264.c	Sat Jan 24 21:36:31 2009
+*** libavcodec/h264.c.old	Sat Jan 24 23:50:37 2009
+--- libavcodec/h264.c	Sat Jan 24 23:50:37 2009
 ***************
-*** 78,83 ****
---- 78,94 ----
-  0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
-  };
+*** 7890,7895 ****
+--- 7890,7906 ----
+      return 0;
+  }
   
 + /* MEANX */
 + int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
@@ -18,5 +18,5 @@
 +   }
 + /* MeanX */
   
-  static void fill_caches(H264Context *h, int mb_type, int for_deblock){
-      MpegEncContext * const s = &h->s;
+  AVCodec h264_decoder = {
+      "h264",

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,8 +1,8 @@
-*** libavcodec/mpeg12.c.old	Sat Jan 24 22:23:54 2009
---- libavcodec/mpeg12.c	Sat Jan 24 22:23:53 2009
+*** libavcodec/mpeg12.c.old	Sat Jan 24 22:57:40 2009
+--- libavcodec/mpeg12.c	Sat Jan 24 22:57:39 2009
 ***************
-*** 1937,1942 ****
---- 1937,1947 ----
+*** 1908,1913 ****
+--- 1908,1918 ----
           ff_er_frame_end(s);
   
           MPV_frame_end(s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,5 +1,5 @@
-*** libavcodec/mpeg12enc.c.old	Sat Jan 24 22:23:55 2009
---- libavcodec/mpeg12enc.c	Sat Jan 24 22:23:54 2009
+*** libavcodec/mpeg12enc.c.old	Sat Jan 24 22:57:41 2009
+--- libavcodec/mpeg12enc.c	Sat Jan 24 22:57:40 2009
 ***************
 *** 127,136 ****
 --- 127,145 ----
@@ -23,22 +23,15 @@
   
   static av_cold int encode_init(AVCodecContext *avctx)
 ***************
-*** 208,214 ****
+*** 209,214 ****
+--- 218,224 ----
+              put_sbits(&s->pb, 12, s->width );
+              put_sbits(&s->pb, 12, s->height);
   
-              put_bits(&s->pb, 12, s->width  & 0xFFF);
-              put_bits(&s->pb, 12, s->height & 0xFFF);
-! 
++ #if 0 //MEANX
               for(i=1; i<15; i++){
                   float error= aspect_ratio;
                   if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
---- 217,223 ----
-  
-              put_bits(&s->pb, 12, s->width  & 0xFFF);
-              put_bits(&s->pb, 12, s->height & 0xFFF);
-! #if 0 //MEANX
-              for(i=1; i<15; i++){
-                  float error= aspect_ratio;
-                  if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
 ***************
 *** 223,242 ****
                       s->aspect_ratio_info= i;
@@ -61,7 +54,7 @@
               else
                   /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                   vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
---- 232,275 ----
+--- 233,276 ----
                       s->aspect_ratio_info= i;
                   }
               }
@@ -116,7 +109,7 @@
                   put_bits(&s->pb, 2, s->chroma_format);
                   put_bits(&s->pb, 2, s->width >>12);
                   put_bits(&s->pb, 2, s->height>>12);
---- 302,318 ----
+--- 303,319 ----
   
                   put_bits(&s->pb, 3, s->avctx->profile); //profile
                   put_bits(&s->pb, 4, s->avctx->level); //level
@@ -136,7 +129,7 @@
                   put_bits(&s->pb, 2, s->height>>12);
 ***************
 *** 334,339 ****
---- 376,383 ----
+--- 377,384 ----
   
   void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
   {
@@ -147,7 +140,7 @@
       /* mpeg1 picture header */
 ***************
 *** 370,375 ****
---- 414,462 ----
+--- 415,463 ----
   
       s->frame_pred_frame_dct = 1;
       if(s->codec_id == CODEC_ID_MPEG2VIDEO){
@@ -199,7 +192,7 @@
           if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
 ***************
 *** 388,398 ****
---- 475,490 ----
+--- 476,491 ----
   
           assert(s->picture_structure == PICT_FRAME);
           put_bits(&s->pb, 2, s->picture_structure);
@@ -225,7 +218,7 @@
           s->progressive_frame = s->progressive_sequence;
           put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
           put_bits(&s->pb, 1, s->progressive_frame);
---- 494,503 ----
+--- 495,504 ----
           put_bits(&s->pb, 1, s->q_scale_type);
           put_bits(&s->pb, 1, s->intra_vlc_format);
           put_bits(&s->pb, 1, s->alternate_scan);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,5 +1,5 @@
-*** libavcodec/mpegvideo.c	Sat Jan 17 19:17:41 2009
---- libavcodec/mpegvideo.c	Tue Jan 13 19:57:29 2009
+*** libavcodec/mpegvideo.c.old	Sat Jan 24 22:57:42 2009
+--- libavcodec/mpegvideo.c	Sat Jan 24 22:57:41 2009
 ***************
 *** 558,564 ****
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
@@ -7,8 +7,8 @@
       s->parse_context.state= -1;
 !     if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
          s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
 --- 558,568 ----
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
   
@@ -19,5 +19,5 @@
 ! if(1){ // MEANX
 ! 
          s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*8 + EDGE_WIDTH) * s->mb_height*8 + EDGE_WIDTH);
+         s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+         s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c.old	Sat Jan 24 22:23:58 2009
---- libavcodec/utils.c	Sat Jan 24 22:23:57 2009
+*** libavcodec/utils.c.old	Sat Jan 24 22:57:44 2009
+--- libavcodec/utils.c	Sat Jan 24 22:57:44 2009
 ***************
-*** 914,923 ****
---- 914,925 ----
+*** 937,946 ****
+--- 937,948 ----
   
       if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 1342,1348 ****
+*** 1386,1392 ****
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 1344,1350 ----
+--- 1388,1394 ----
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,5 +1,5 @@
-*** libavformat/flvenc.c.old	Sat Jan 24 22:24:00 2009
---- libavformat/flvenc.c	Sat Jan 24 22:23:59 2009
+*** libavformat/flvenc.c.old	Sat Jan 24 22:57:46 2009
+--- libavformat/flvenc.c	Sat Jan 24 22:57:45 2009
 ***************
 *** 378,384 ****
       "video/x-flv",
@@ -21,7 +21,7 @@
 ***************
 *** 390,392 ****
 --- 391,399 ----
-      .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+      .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
       .flags= AVFMT_GLOBALHEADER,
   };
 + // MEANX

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,5 +1,5 @@
-*** libavformat/isom.c.old	Sat Jan 24 22:24:01 2009
---- libavformat/isom.c	Sat Jan 24 22:24:00 2009
+*** libavformat/isom.c.old	Sat Jan 24 22:57:47 2009
+--- libavformat/isom.c	Sat Jan 24 22:57:46 2009
 ***************
 *** 40,46 ****
       { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
@@ -18,7 +18,7 @@
       { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
       { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
 ***************
-*** 150,156 ****
+*** 176,182 ****
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   
@@ -26,7 +26,7 @@
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
   
   /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
---- 150,159 ----
+--- 176,185 ----
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,8 +1,8 @@
-*** libavformat/matroskaenc.c.old	Sat Jan 24 22:24:02 2009
---- libavformat/matroskaenc.c	Sat Jan 24 22:24:01 2009
+*** libavformat/matroskaenc.c.old	Sat Jan 24 22:57:48 2009
+--- libavformat/matroskaenc.c	Sat Jan 24 22:57:48 2009
 ***************
-*** 392,397 ****
---- 392,398 ----
+*** 393,398 ****
+--- 393,399 ----
   
   static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
   {
@@ -11,8 +11,8 @@
       int header_len[3];
       int first_header_size;
 ***************
-*** 416,421 ****
---- 417,444 ----
+*** 417,422 ****
+--- 418,445 ----
           put_buffer(pb, header_start[j], header_len[j]);
   
       return 0;
@@ -42,8 +42,8 @@
   
   #define FLAC_STREAMINFO_SIZE 34
 ***************
-*** 544,549 ****
---- 567,589 ----
+*** 553,558 ****
+--- 576,598 ----
           put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
           put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
@@ -68,10 +68,10 @@
           if (st->language[0])
               put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
 ***************
-*** 845,847 ****
---- 885,897 ----
+*** 863,865 ****
+--- 903,915 ----
       mkv_write_trailer,
-      .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
+      .codec_tag = (const AVCodecTag* const []){codec_wav_tags, 0},
   };
 + // MEANX
 + //

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,9 +1,9 @@
-*** libavformat/movenc.c.old	Sat Jan 24 22:24:03 2009
---- libavformat/movenc.c	Sat Jan 24 22:24:02 2009
+*** libavformat/movenc.c.old	Sat Jan 24 22:57:49 2009
+--- libavformat/movenc.c	Sat Jan 24 22:57:48 2009
 ***************
-*** 1785,1787 ****
---- 1785,1799 ----
-      .codec_tag = (const AVCodecTag*[]){ff_mp4_obj_type, 0},
+*** 1786,1788 ****
+--- 1786,1800 ----
+      .codec_tag = (const AVCodecTag* const []){ff_mp4_obj_type, 0},
   };
   #endif
 + /* MEANX */

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,11 +1,11 @@
-*** libavutil/avutil.h	Sat Jan 17 21:11:42 2009
---- libavutil/avutil.h	Sat Jan 17 21:42:06 2009
+*** libavutil/avutil.h.old	Sat Jan 24 22:57:50 2009
+--- libavutil/avutil.h	Sat Jan 24 22:57:49 2009
 ***************
-*** 48,53 ****
---- 48,60 ----
+*** 26,31 ****
+--- 26,38 ----
+   * external API header
+   */
   
-  #define LIBAVUTIL_IDENT         "Lavu" AV_STRINGIFY(LIBAVUTIL_VERSION)
-  
 + /* MEANX
 +  * - */
 + #define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
@@ -14,5 +14,5 @@
 + 
 + 
   
-  #include "common.h"
-  #include "mathematics.h"
+  #define AV_STRINGIFY(s)         AV_TOSTRING(s)
+  #define AV_TOSTRING(s) #s

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-24 22:48:32 UTC (rev 4543)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-25 00:17:13 UTC (rev 4544)
@@ -1,8 +1,8 @@
-*** libavutil/internal.h.old	Sat Jan 24 22:24:05 2009
---- libavutil/internal.h	Sat Jan 24 22:24:04 2009
+*** libavutil/internal.h.old	Sat Jan 24 22:57:51 2009
+--- libavutil/internal.h	Sat Jan 24 22:57:50 2009
 ***************
-*** 227,238 ****
---- 227,240 ----
+*** 222,233 ****
+--- 222,235 ----
   #endif
   
   /* avoid usage of various functions */



From gruntster at mail.berlios.de  Sun Jan 25 02:26:35 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 25 Jan 2009 02:26:35 +0100
Subject: [Avidemux-svn-commit] r4545 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_audiocodec avidemux/ADM_audiofilter
	avidemux/ADM_codecs avidemux/ADM_core/src
	avidemux/ADM_coreAudio/include cmake cmake/patches
	plugins/ADM_audioDecoders/ADM_ad_ac3
	plugins/ADM_audioDecoders/ADM_ad_dca
	plugins/ADM_audioDecoders/ADM_ad_faad
	plugins/ADM_audioDecoders/ADM_ad_vorbis
	plugins/ADM_audioEncoders/faac plugins/ADM_audioEncoders/vorbis
Message-ID: <200901250126.n0P1QZ7J009214@sheep.berlios.de>

Author: gruntster
Date: 2009-01-25 02:26:14 +0100 (Sun, 25 Jan 2009)
New Revision: 4545

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_lpcm.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_mixer.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audiodef.h
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp
Log:
[ffmpeg] update to FFmpeg r16000 & libswscale r28058

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodec.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -122,10 +122,10 @@
 	// For more complicated case (channel >2) , it is up to the decoder to do it...
 	switch(info->channels)
 	{
-			case 1: out->channelMapping[0] = CH_MONO;
+			case 1: out->channelMapping[0] = CHTYP_MONO;
 					break;
-			case 2: out->channelMapping[0] = CH_FRONT_LEFT;
-					out->channelMapping[1] = CH_FRONT_RIGHT;
+			case 2: out->channelMapping[0] = CHTYP_FRONT_LEFT;
+					out->channelMapping[1] = CHTYP_FRONT_RIGHT;
 					break;
 			default:break;
 	

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_lpcm.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_lpcm.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_lpcm.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -27,12 +27,12 @@
 
 ADM_AudiocodecWavSwapped::ADM_AudiocodecWavSwapped( uint32_t fourcc ) : ADM_Audiocodec(fourcc)
 {
-	channelMapping[0] = CH_FRONT_LEFT;
-	channelMapping[1] = CH_FRONT_RIGHT;
-	channelMapping[2] = CH_FRONT_CENTER;
-	channelMapping[3] = CH_LFE;
-	channelMapping[4] = CH_REAR_LEFT;
-	channelMapping[5] = CH_REAR_RIGHT;
+	channelMapping[0] = CHTYP_FRONT_LEFT;
+	channelMapping[1] = CHTYP_FRONT_RIGHT;
+	channelMapping[2] = CHTYP_FRONT_CENTER;
+	channelMapping[3] = CHTYP_LFE;
+	channelMapping[4] = CHTYP_REAR_LEFT;
+	channelMapping[5] = CHTYP_REAR_RIGHT;
 }
 
 ADM_AudiocodecWavSwapped::~ADM_AudiocodecWavSwapped()

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_mixer.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_mixer.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_mixer.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -33,61 +33,61 @@
 	switch (_output) {
 		case CHANNEL_MONO:
 			_wavHeader.channels = 1;
-			outputChannelMapping[0] = CH_MONO;
+			outputChannelMapping[0] = CHTYP_MONO;
 		break;
 		case CHANNEL_STEREO:
 			_wavHeader.channels = 2;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
 		break;
 		case CHANNEL_2F_1R:
 			_wavHeader.channels = 3;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_REAR_CENTER;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_REAR_CENTER;
 		break;
 		case CHANNEL_3F:
 			_wavHeader.channels = 3;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_FRONT_CENTER;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_FRONT_CENTER;
 		break;
 		case CHANNEL_3F_1R:
 			_wavHeader.channels = 4;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_REAR_CENTER;
-			outputChannelMapping[3] = CH_FRONT_CENTER;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_REAR_CENTER;
+			outputChannelMapping[3] = CHTYP_FRONT_CENTER;
 		break;
 		case CHANNEL_2F_2R:
 			_wavHeader.channels = 4;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_REAR_LEFT;
-			outputChannelMapping[3] = CH_REAR_RIGHT;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_REAR_LEFT;
+			outputChannelMapping[3] = CHTYP_REAR_RIGHT;
 		break;
 		case CHANNEL_3F_2R:
 			_wavHeader.channels = 5;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_REAR_LEFT;
-			outputChannelMapping[3] = CH_REAR_RIGHT;
-			outputChannelMapping[4] = CH_FRONT_CENTER;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_REAR_LEFT;
+			outputChannelMapping[3] = CHTYP_REAR_RIGHT;
+			outputChannelMapping[4] = CHTYP_FRONT_CENTER;
 		break;
 		case CHANNEL_3F_2R_LFE:
 			_wavHeader.channels = 6;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
-			outputChannelMapping[2] = CH_REAR_LEFT;
-			outputChannelMapping[3] = CH_REAR_RIGHT;
-			outputChannelMapping[4] = CH_FRONT_CENTER;
-			outputChannelMapping[5] = CH_LFE;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+			outputChannelMapping[2] = CHTYP_REAR_LEFT;
+			outputChannelMapping[3] = CHTYP_REAR_RIGHT;
+			outputChannelMapping[4] = CHTYP_FRONT_CENTER;
+			outputChannelMapping[5] = CHTYP_LFE;
 		break;
 		case CHANNEL_DOLBY_PROLOGIC:
 		case CHANNEL_DOLBY_PROLOGIC2:
 			_wavHeader.channels = 2;
-			outputChannelMapping[0] = CH_FRONT_LEFT;
-			outputChannelMapping[1] = CH_FRONT_RIGHT;
+			outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+			outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
 			DolbyInit();
 		break;
 	}
@@ -143,21 +143,21 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
-				case CH_REAR_CENTER:
-				case CH_LFE:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
+				case CHTYP_REAR_CENTER:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.707;
 					out[1]  += *in * 0.707;
 				break;
-				case CH_FRONT_LEFT:
-				case CH_REAR_LEFT:
-				case CH_SIDE_LEFT:
+				case CHTYP_FRONT_LEFT:
+				case CHTYP_REAR_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
-				case CH_REAR_RIGHT:
-				case CH_SIDE_RIGHT:
+				case CHTYP_FRONT_RIGHT:
+				case CHTYP_REAR_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in;
 				break;
 			}
@@ -176,32 +176,32 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
 					out[0]  += *in * 0.707;
 					out[1]  += *in * 0.707;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_LEFT:
-				case CH_REAR_RIGHT:
-				case CH_REAR_CENTER:
+				case CHTYP_REAR_LEFT:
+				case CHTYP_REAR_RIGHT:
+				case CHTYP_REAR_CENTER:
 					out[2]  += *in;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.595;
 					out[1]  += *in * 0.595;
 					out[2]  += *in * 0.595;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
@@ -221,22 +221,22 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
-				case CH_REAR_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
+				case CHTYP_REAR_CENTER:
 					out[2]  += *in;
 				break;
-				case CH_FRONT_LEFT:
-				case CH_REAR_LEFT:
-				case CH_SIDE_LEFT:
+				case CHTYP_FRONT_LEFT:
+				case CHTYP_REAR_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
-				case CH_REAR_RIGHT:
-				case CH_SIDE_RIGHT:
+				case CHTYP_FRONT_RIGHT:
+				case CHTYP_REAR_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.595;
 					out[1]  += *in * 0.595;
 					out[2]  += *in * 0.595;
@@ -257,32 +257,32 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
 					out[3]  += *in;
 				break;
-				case CH_REAR_CENTER:
-				case CH_REAR_LEFT:
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_CENTER:
+				case CHTYP_REAR_LEFT:
+				case CHTYP_REAR_RIGHT:
 					out[2]  += *in;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.5;
 					out[1]  += *in * 0.5;
 					out[2]  += *in * 0.5;
 					out[3]  += *in * 0.5;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
@@ -302,38 +302,38 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
 					out[0]  += *in * 0.707;
 					out[1]  += *in * 0.707;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_LEFT:
+				case CHTYP_REAR_LEFT:
 					out[2]  += *in;
 				break;
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_RIGHT:
 					out[3]  += *in;
 				break;
-				case CH_REAR_CENTER:
+				case CHTYP_REAR_CENTER:
 					out[2]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.5;
 					out[1]  += *in * 0.5;
 					out[2]  += *in * 0.5;
 					out[3]  += *in * 0.5;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
@@ -353,38 +353,38 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
 					out[4]  += *in;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_LEFT:
+				case CHTYP_REAR_LEFT:
 					out[2]  += *in;
 				break;
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_RIGHT:
 					out[3]  += *in;
 				break;
-				case CH_REAR_CENTER:
+				case CHTYP_REAR_CENTER:
 					out[2]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.459;
 					out[1]  += *in * 0.459;
 					out[2]  += *in * 0.459;
 					out[3]  += *in * 0.459;
 					out[4]  += *in * 0.459;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
@@ -404,34 +404,34 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
 					out[4]  += *in;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_LEFT:
+				case CHTYP_REAR_LEFT:
 					out[2]  += *in;
 				break;
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_RIGHT:
 					out[3]  += *in;
 				break;
-				case CH_REAR_CENTER:
+				case CHTYP_REAR_CENTER:
 					out[2]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
-				case CH_LFE:
+				case CHTYP_LFE:
 					out[5]  += *in;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[2]  += *in * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[3]  += *in * 0.707;
 				break;
@@ -451,30 +451,30 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
-				case CH_LFE:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.707;
 					out[1]  += *in * 0.707;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_CENTER:
-				case CH_REAR_LEFT:
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_CENTER:
+				case CHTYP_REAR_LEFT:
+				case CHTYP_REAR_RIGHT:
 					out[0]  += DolbyShiftLeft(*in) * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.707;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[0]  += DolbyShiftLeft(*in) * 0.707 * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.707 * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.5;
 					out[0]  += DolbyShiftLeft(*in) * 0.707 * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.707 * 0.707;
@@ -495,36 +495,36 @@
 	for (int i = 0; i < nbSample; i++) {
 		for (int c = 0; c < chan; c++) {
 			switch (chanMap[c]) {
-				case CH_MONO:
-				case CH_FRONT_CENTER:
-				case CH_LFE:
+				case CHTYP_MONO:
+				case CHTYP_FRONT_CENTER:
+				case CHTYP_LFE:
 					out[0]  += *in * 0.707;
 					out[1]  += *in * 0.707;
 				break;
-				case CH_FRONT_LEFT:
+				case CHTYP_FRONT_LEFT:
 					out[0]  += *in;
 				break;
-				case CH_FRONT_RIGHT:
+				case CHTYP_FRONT_RIGHT:
 					out[1]  += *in;
 				break;
-				case CH_REAR_CENTER:
+				case CHTYP_REAR_CENTER:
 					out[0]  += DolbyShiftLeft(*in) * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.707;
 				break;
-				case CH_REAR_LEFT:
+				case CHTYP_REAR_LEFT:
 					out[0]  += DolbyShiftLeft(*in) * 0.8165;
 					out[1]  += DolbyShiftRight(*in) * 0.5774;
 				break;
-				case CH_REAR_RIGHT:
+				case CHTYP_REAR_RIGHT:
 					out[0]  += DolbyShiftLeft(*in) * 0.5774;
 					out[1]  += DolbyShiftRight(*in) * 0.8165;
 				break;
-				case CH_SIDE_LEFT:
+				case CHTYP_SIDE_LEFT:
 					out[0]  += *in * 0.707;
 					out[0]  += DolbyShiftLeft(*in) * 0.8165 * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.5774 * 0.707;
 				break;
-				case CH_SIDE_RIGHT:
+				case CHTYP_SIDE_RIGHT:
 					out[1]  += *in * 0.707;
 					out[0]  += DolbyShiftLeft(*in) * 0.5774 * 0.707;
 					out[1]  += DolbyShiftRight(*in) * 0.8165 * 0.707;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -562,7 +562,7 @@
 
 decoderFFRaw::decoderFFRaw(uint32_t w, uint32_t h, uint32_t bpp) : decoderFF (w, h)
 {
-	_context->bits_per_sample = bpp;
+	_context->bits_per_coded_sample = bpp;
 	WRAP_Open (CODEC_ID_RAWVIDEO);
 }
 
@@ -576,7 +576,7 @@
 {
   _context->extradata = (uint8_t *) d;
   _context->extradata_size = (int) l;
-  _context->bits_per_sample=bpp;
+  _context->bits_per_coded_sample = bpp;
   printf ("[lavc] FFhuff: We have %d bytes of extra data\n", l);
   WRAP_Open (CODEC_ID_FFVHUFF);
 
@@ -618,7 +618,7 @@
 {
   _context->extradata = (uint8_t *) d;
   _context->extradata_size = (int) l;
-  _context->bits_per_sample = bpp;
+  _context->bits_per_coded_sample = bpp;
   WRAP_Open (CODEC_ID_HUFFYUV);
 }
 decoderFFWMV2::decoderFFWMV2 (uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,
@@ -684,7 +684,7 @@
 //*************
 decoderCamtasia::decoderCamtasia (uint32_t w, uint32_t h,uint32_t bpp):decoderFF (w,  h)
 {
-  _context->bits_per_sample = bpp;
+  _context->bits_per_coded_sample = bpp;
   WRAP_Open (CODEC_ID_TSCC);
 }
 //*************

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -742,7 +742,6 @@
       //SETX(_HQ);
       SETX (_4MV);
       SETX (_QPEL);
-      SETX (_TRELLIS_QUANT);
       SETX (_NORMALIZE_AQP);
 
       if (_settings.widescreen)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -395,14 +395,14 @@
 #if defined(ADM_CPU_X86)
   { "linux kernel memcpy()", linux_kernel_memcpy, 0, 0 },
 #if defined(ADM_CPU_X86)
-  { "MMX optimized memcpy()", mmx_memcpy, 0, MM_MMX },
-  { "MMXEXT optimized memcpy()", mmx2_memcpy, 0, MM_MMXEXT },
-  { "SSE optimized memcpy()", sse_memcpy, 0, MM_MMXEXT|MM_SSE },
+  { "MMX optimized memcpy()", mmx_memcpy, 0, FF_MM_MMX },
+  { "MMXEXT optimized memcpy()", mmx2_memcpy, 0, FF_MM_MMXEXT },
+  { "SSE optimized memcpy()", sse_memcpy, 0, FF_MM_MMXEXT|FF_MM_SSE },
 #endif
 #endif /* ARCH_X86 */
 #if 0 && defined(ADM_CPU_PPC) && !defined (__APPLE__)
   { "ppcasm_memcpy()", ppcasm_memcpy, 0, 0 },
-  { "ppcasm_cacheable_memcpy()", ppcasm_cacheable_memcpy, 0, MM_ACCEL_PPC_CACHE32 },
+  { "ppcasm_cacheable_memcpy()", ppcasm_cacheable_memcpy, 0, FF_MM_ACCEL_PPC_CACHE32 },
 #endif /* ARCH_PPC && !HOST_OS_DARWIN */
   { NULL, NULL, 0, 0 }
 };

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audiodef.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audiodef.h	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreAudio/include/ADM_audiodef.h	2009-01-25 01:26:14 UTC (rev 4545)
@@ -36,17 +36,17 @@
 
 typedef enum 
 {
-	CH_INVALID=0,
-	CH_MONO,
-	CH_FRONT_LEFT,
-	CH_FRONT_RIGHT,
-	CH_FRONT_CENTER,
-	CH_REAR_LEFT,
-	CH_REAR_RIGHT,
-	CH_REAR_CENTER,
-	CH_SIDE_LEFT,
-	CH_SIDE_RIGHT,
-	CH_LFE
+	CHTYP_INVALID=0,
+	CHTYP_MONO,
+	CHTYP_FRONT_LEFT,
+	CHTYP_FRONT_RIGHT,
+	CHTYP_FRONT_CENTER,
+	CHTYP_REAR_LEFT,
+	CHTYP_REAR_RIGHT,
+	CHTYP_REAR_CENTER,
+	CHTYP_SIDE_LEFT,
+	CHTYP_SIDE_RIGHT,
+	CHTYP_LFE
 }CHANNEL_TYPE;
 // returns true if channel mapping is identical
 bool ADM_audioCompareChannelMapping(WAVHeader *wh1, WAVHeader *wh2,CHANNEL_TYPE *map1,CHANNEL_TYPE *map2);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 15000)
-set(SWSCALE_VERSION 27349)
+set(FFMPEG_VERSION 16000)
+set(SWSCALE_VERSION 28058)
 set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavcodec/avcodec.h.old	Sat Jan 24 22:57:36 2009
---- libavcodec/avcodec.h	Sat Jan 24 22:57:35 2009
+*** libavcodec/avcodec.h.old	Sun Jan 25 00:55:13 2009
+--- libavcodec/avcodec.h	Sun Jan 25 00:55:13 2009
 ***************
-*** 476,481 ****
---- 476,483 ----
+*** 497,502 ****
+--- 497,504 ----
   #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
   #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
   #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
@@ -12,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1260,1265 ****
---- 1262,1268 ----
+*** 1274,1279 ****
+--- 1276,1282 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1274,1279 ****
---- 1277,1284 ----
+*** 1288,1293 ****
+--- 1291,1298 ----
        * - decoding: unused
        */
       int rc_buffer_size;
@@ -32,37 +32,3 @@
       float rc_buffer_aggressivity;
   
       /**
-***************
-*** 2362,2368 ****
-  
-  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
-  /* YUV420 format is assumed ! */
-! 
-  /**
-   * @deprecated Use the software scaler (swscale) instead.
-   */
---- 2367,2373 ----
-  
-  #if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
-  /* YUV420 format is assumed ! */
-! #if 0 // MEANX
-  /**
-   * @deprecated Use the software scaler (swscale) instead.
-   */
-***************
-*** 2394,2400 ****
-   * @deprecated Use the software scaler (swscale) instead.
-   */
-  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
-! 
-  #endif
-  
-  /**
---- 2399,2405 ----
-   * @deprecated Use the software scaler (swscale) instead.
-   */
-  attribute_deprecated void img_resample_close(struct ImgReSampleContext *s);
-! #endif //MEANX
-  #endif
-  
-  /**

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavcodec/h264.c.old	Sat Jan 24 23:50:37 2009
---- libavcodec/h264.c	Sat Jan 24 23:50:37 2009
+*** libavcodec/h264.c.old	Sun Jan 25 00:55:16 2009
+--- libavcodec/h264.c	Sun Jan 25 00:55:16 2009
 ***************
-*** 7890,7895 ****
---- 7890,7906 ----
+*** 7948,7953 ****
+--- 7948,7964 ----
       return 0;
   }
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavcodec/mpeg12.c.old	Sat Jan 24 22:57:40 2009
---- libavcodec/mpeg12.c	Sat Jan 24 22:57:39 2009
+*** libavcodec/mpeg12.c.old	Sun Jan 25 00:55:17 2009
+--- libavcodec/mpeg12.c	Sun Jan 25 00:55:17 2009
 ***************
-*** 1908,1913 ****
---- 1908,1918 ----
+*** 1925,1930 ****
+--- 1925,1935 ----
           ff_er_frame_end(s);
   
           MPV_frame_end(s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,7 +1,7 @@
-*** libavcodec/mpegvideo.c.old	Sat Jan 24 22:57:42 2009
---- libavcodec/mpegvideo.c	Sat Jan 24 22:57:41 2009
+*** libavcodec/mpegvideo.c.old	Sun Jan 25 00:55:19 2009
+--- libavcodec/mpegvideo.c	Sun Jan 25 00:55:19 2009
 ***************
-*** 558,564 ****
+*** 561,567 ****
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
   
       s->parse_context.state= -1;
@@ -9,7 +9,7 @@
          s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
          s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
          s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
---- 558,568 ----
+--- 561,571 ----
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
   
       s->parse_context.state= -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavcodec/mpegvideo_enc.c.old	Sat Jan 24 22:23:57 2009
---- libavcodec/mpegvideo_enc.c	Sat Jan 24 22:23:56 2009
+*** libavcodec/mpegvideo_enc.c.old	Sun Jan 25 00:55:20 2009
+--- libavcodec/mpegvideo_enc.c	Sun Jan 25 00:55:19 2009
 ***************
-*** 376,387 ****
---- 376,389 ----
+*** 349,360 ****
+--- 349,362 ----
   
           av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
       }
@@ -18,8 +18,8 @@
       if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
           av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
 ***************
-*** 414,423 ****
---- 416,427 ----
+*** 387,396 ****
+--- 389,400 ----
           return -1;
       }
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c.old	Sat Jan 24 22:57:44 2009
---- libavcodec/utils.c	Sat Jan 24 22:57:44 2009
+*** libavcodec/utils.c.old	Sun Jan 25 00:55:21 2009
+--- libavcodec/utils.c	Sun Jan 25 00:55:21 2009
 ***************
-*** 937,946 ****
---- 937,948 ----
+*** 945,954 ****
+--- 945,956 ----
   
       if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 1386,1392 ****
+*** 1365,1371 ****
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 1388,1394 ----
+--- 1367,1373 ----
           return -1;
       }
   #if !defined(HAVE_MKSTEMP)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,13 +1,15 @@
-*** libavformat/file.c.old	Sat Jan 24 22:23:59 2009
---- libavformat/file.c	Sat Jan 24 22:23:58 2009
+*** libavformat/file.c.old	Sun Jan 25 00:55:22 2009
+--- libavformat/file.c	Sun Jan 25 00:55:22 2009
 ***************
 *** 27,32 ****
---- 27,96 ----
+--- 27,98 ----
   #include <stdlib.h>
   #include "os_support.h"
   
 + // GRUNTSTER start
 + #ifdef __WIN32
++ #include <windows.h>
++ 
 + int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
 + {
 + 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,7 +1,7 @@
-*** libavformat/flvenc.c.old	Sat Jan 24 22:57:46 2009
---- libavformat/flvenc.c	Sat Jan 24 22:57:45 2009
+*** libavformat/flvenc.c.old	Sun Jan 25 00:55:23 2009
+--- libavformat/flvenc.c	Sun Jan 25 00:55:23 2009
 ***************
-*** 378,384 ****
+*** 382,388 ****
       "video/x-flv",
       "flv",
       sizeof(FLVContext),
@@ -9,7 +9,7 @@
       CODEC_ID_MP3,
   #else // CONFIG_LIBMP3LAME
       CODEC_ID_ADPCM_SWF,
---- 378,385 ----
+--- 382,389 ----
       "video/x-flv",
       "flv",
       sizeof(FLVContext),
@@ -19,8 +19,8 @@
   #else // CONFIG_LIBMP3LAME
       CODEC_ID_ADPCM_SWF,
 ***************
-*** 390,392 ****
---- 391,399 ----
+*** 394,396 ****
+--- 395,403 ----
       .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
       .flags= AVFMT_GLOBALHEADER,
   };

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,24 +1,7 @@
-*** libavformat/isom.c.old	Sat Jan 24 22:57:47 2009
---- libavformat/isom.c	Sat Jan 24 22:57:46 2009
+*** libavformat/isom.c.old	Sun Jan 25 00:55:24 2009
+--- libavformat/isom.c	Sun Jan 25 00:55:23 2009
 ***************
-*** 40,46 ****
-      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
-      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
-      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
-!     { CODEC_ID_MP3       , 107 }, /* 11172-3 */
-      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
-      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
-      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
---- 40,46 ----
-      { CODEC_ID_AAC       , 102 }, /* MPEG2 AAC Main */
-      { CODEC_ID_AAC       , 103 }, /* MPEG2 AAC Low */
-      { CODEC_ID_AAC       , 104 }, /* MPEG2 AAC SSR */
-!     { CODEC_ID_MP2       , 107 }, /* 11172-3 */ /* MEANX WAS MP3 */
-      { CODEC_ID_MP3       , 105 }, /* 13818-3 */
-      { CODEC_ID_MPEG1VIDEO, 106 }, /* 11172-2 */
-      { CODEC_ID_MJPEG     , 108 }, /* 10918-1 */
-***************
-*** 176,182 ****
+*** 184,190 ****
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   
@@ -26,7 +9,7 @@
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
   
   /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
---- 176,185 ----
+--- 184,193 ----
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,5 +1,5 @@
-*** libavformat/matroskaenc.c.old	Sat Jan 24 22:57:48 2009
---- libavformat/matroskaenc.c	Sat Jan 24 22:57:48 2009
+*** libavformat/matroskaenc.c.old	Sun Jan 25 00:55:25 2009
+--- libavformat/matroskaenc.c	Sun Jan 25 00:55:25 2009
 ***************
 *** 393,398 ****
 --- 393,399 ----
@@ -68,9 +68,9 @@
           if (st->language[0])
               put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
 ***************
-*** 863,865 ****
---- 903,915 ----
-      mkv_write_trailer,
+*** 922,924 ****
+--- 962,974 ----
+      .flags = AVFMT_GLOBALHEADER,
       .codec_tag = (const AVCodecTag* const []){codec_wav_tags, 0},
   };
 + // MEANX

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavformat/movenc.c.old	Sat Jan 24 22:57:49 2009
---- libavformat/movenc.c	Sat Jan 24 22:57:48 2009
+*** libavformat/movenc.c.old	Sun Jan 25 00:55:26 2009
+--- libavformat/movenc.c	Sun Jan 25 00:55:25 2009
 ***************
-*** 1786,1788 ****
---- 1786,1800 ----
+*** 1857,1859 ****
+--- 1857,1871 ----
       .codec_tag = (const AVCodecTag* const []){ff_mp4_obj_type, 0},
   };
   #endif

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-01-25 01:26:14 UTC (rev 4545)
@@ -1,8 +1,8 @@
-*** libavutil/internal.h.old	Sat Jan 24 22:57:51 2009
---- libavutil/internal.h	Sat Jan 24 22:57:50 2009
+*** libavutil/internal.h.old	Sun Jan 25 00:55:28 2009
+--- libavutil/internal.h	Sun Jan 25 00:55:28 2009
 ***************
-*** 222,233 ****
---- 222,235 ----
+*** 223,234 ****
+--- 223,236 ----
   #endif
   
   /* avoid usage of various functions */

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -133,45 +133,45 @@
 
 		CHANNEL_TYPE *p_ch_type = channelMapping;
 		if (flags & A52_LFE) {
-			*(p_ch_type++) = CH_LFE;
+			*(p_ch_type++) = CHTYP_LFE;
 		}
 		switch (flags & A52_CHANNEL_MASK) {
 			case A52_MONO:
-				*(p_ch_type++) = CH_MONO;
+				*(p_ch_type++) = CHTYP_MONO;
 			break;
 			case A52_STEREO:
 			case A52_DOLBY:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
 			break;
 			case A52_3F:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
 			break;
 			case A52_2F1R:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_CENTER;
 			break;
 			case A52_3F1R:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_CENTER;
 			break;
 			case A52_2F2R:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_LEFT;
+				*(p_ch_type++) = CHTYP_REAR_RIGHT;
 			break;
 			case A52_3F2R:
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_LEFT;
+				*(p_ch_type++) = CHTYP_REAR_RIGHT;
 			break;
 			default:
 				ADM_assert(0);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -174,48 +174,48 @@
 		switch (flags & DTS(CHANNEL_MASK)) 
 		{
 			case DTS(MONO):
-				*(p_ch_type++) = CH_MONO;
+				*(p_ch_type++) = CHTYP_MONO;
 			break;
 			case DTS(STEREO):
 			case DTS(DOLBY):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
 			break;
 			case DTS(3F):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
 			break;
 			case DTS(2F1R):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_CENTER;
 			break;
 			case DTS(3F1R):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_CENTER;
 			break;
 			case DTS(2F2R):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_LEFT;
+				*(p_ch_type++) = CHTYP_REAR_RIGHT;
 			break;
 			case DTS(3F2R):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) = CHTYP_FRONT_CENTER;
+				*(p_ch_type++) = CHTYP_FRONT_LEFT;
+				*(p_ch_type++) = CHTYP_FRONT_RIGHT;
+				*(p_ch_type++) = CHTYP_REAR_LEFT;
+				*(p_ch_type++) = CHTYP_REAR_RIGHT;
 			break;
 			default:
 				ADM_assert(0);
 		} // End switch
 		if (flags & DTS(LFE)) 
 		{
-			*(p_ch_type++) = CH_LFE;
+			*(p_ch_type++) = CHTYP_LFE;
 		}
 	
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -93,12 +93,12 @@
 			
 		}
 
-		channelMapping[0] = CH_FRONT_CENTER;
-		channelMapping[1] = CH_FRONT_LEFT;
-		channelMapping[2] = CH_FRONT_RIGHT;
-		channelMapping[3] = CH_REAR_LEFT;
-		channelMapping[4] = CH_REAR_RIGHT;
-		channelMapping[5] = CH_LFE;
+		channelMapping[0] = CHTYP_FRONT_CENTER;
+		channelMapping[1] = CHTYP_FRONT_LEFT;
+		channelMapping[2] = CHTYP_FRONT_RIGHT;
+		channelMapping[3] = CHTYP_REAR_LEFT;
+		channelMapping[4] = CHTYP_REAR_RIGHT;
+		channelMapping[5] = CHTYP_LFE;
 
 		printf("[FAAD]Faad decoder created\n");
 }

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -152,12 +152,12 @@
 	STRUCT->ampscale=1;
 	_init=1;
 
-	channelMapping[0] = CH_FRONT_LEFT;
-	channelMapping[1] = CH_FRONT_RIGHT;
-	channelMapping[2] = CH_REAR_LEFT;
-	channelMapping[3] = CH_REAR_RIGHT;
-	channelMapping[4] = CH_FRONT_CENTER;
-	channelMapping[5] = CH_LFE;
+	channelMapping[0] = CHTYP_FRONT_LEFT;
+	channelMapping[1] = CHTYP_FRONT_RIGHT;
+	channelMapping[2] = CHTYP_REAR_LEFT;
+	channelMapping[3] = CHTYP_REAR_RIGHT;
+	channelMapping[4] = CHTYP_FRONT_CENTER;
+	channelMapping[5] = CHTYP_LFE;
  }
  // This codec expects more or less one packet at a time !
  

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/faac/audioencoder_faac.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -68,18 +68,18 @@
   channels=instream->getInfo()->channels;
   switch(channels)
   {
-    case 1:outputChannelMapping[1] = CH_FRONT_LEFT;break;
+    case 1:outputChannelMapping[1] = CHTYP_FRONT_LEFT;break;
     case 2:
-    	outputChannelMapping[0] = CH_FRONT_LEFT;
-    	outputChannelMapping[1] = CH_FRONT_RIGHT;
+    	outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+    	outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
       break;
     default :
-    	outputChannelMapping[0] = CH_FRONT_CENTER;
-    	outputChannelMapping[1] = CH_FRONT_LEFT;
-    	outputChannelMapping[2] = CH_FRONT_RIGHT;
-    	outputChannelMapping[3] = CH_REAR_LEFT;
-    	outputChannelMapping[4] = CH_REAR_RIGHT;
-    	outputChannelMapping[5] = CH_LFE;
+    	outputChannelMapping[0] = CHTYP_FRONT_CENTER;
+    	outputChannelMapping[1] = CHTYP_FRONT_LEFT;
+    	outputChannelMapping[2] = CHTYP_FRONT_RIGHT;
+    	outputChannelMapping[3] = CHTYP_REAR_LEFT;
+    	outputChannelMapping[4] = CHTYP_REAR_RIGHT;
+    	outputChannelMapping[5] = CHTYP_LFE;
   }
 };
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp	2009-01-25 00:17:13 UTC (rev 4544)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/vorbis/audioencoder_vorbis.cpp	2009-01-25 01:26:14 UTC (rev 4545)
@@ -88,12 +88,12 @@
   _wavheader->encoding=WAV_OGG;
   _oldpos=0;
   _handle=(void *)new  vorbisStruct; 
-  outputChannelMapping[0] = CH_FRONT_LEFT;
-  outputChannelMapping[1] = CH_FRONT_RIGHT;
-  outputChannelMapping[2] = CH_REAR_LEFT;
-  outputChannelMapping[3] = CH_REAR_RIGHT;
-  outputChannelMapping[4] = CH_FRONT_CENTER;
-  outputChannelMapping[5] = CH_LFE;
+  outputChannelMapping[0] = CHTYP_FRONT_LEFT;
+  outputChannelMapping[1] = CHTYP_FRONT_RIGHT;
+  outputChannelMapping[2] = CHTYP_REAR_LEFT;
+  outputChannelMapping[3] = CHTYP_REAR_RIGHT;
+  outputChannelMapping[4] = CHTYP_FRONT_CENTER;
+  outputChannelMapping[5] = CHTYP_LFE;
 };
 
 /**



From mean at mail.berlios.de  Mon Jan 26 07:44:20 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 26 Jan 2009 07:44:20 +0100
Subject: [Avidemux-svn-commit] r4546 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS
Message-ID: <200901260644.n0Q6iKMu027460@sheep.berlios.de>

Author: mean
Date: 2009-01-26 07:44:18 +0100 (Mon, 26 Jan 2009)
New Revision: 4546

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.h
Log:
[psDemux] audio index

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp	2009-01-26 06:44:18 UTC (rev 4546)
@@ -36,6 +36,7 @@
     FP_TYPE appendType=FP_DONT_APPEND;
     uint32_t append;
     char *type;
+    uint64_t startDts;
 
     sprintf(idxName,"%s.idx",name);
     indexFile index;
@@ -90,6 +91,8 @@
         goto abt;
     }
     r=true;
+  
+
 abt:
     index.close();
     printf("[psDemuxer] Loaded %d\n",r);

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h	2009-01-26 06:44:18 UTC (rev 4546)
@@ -46,6 +46,7 @@
 {            
       uint64_t position;
       uint64_t dts;
+      uint32_t size;
 
 }ADM_psAudioSeekPoint;
 
@@ -55,11 +56,14 @@
 class ADM_psAccess : public ADM_audioAccess
 {
 protected:
-                vector          <ADM_psAudioSeekPoint >seekPoints;
+                
                 psPacket        demuxer;
                 uint8_t         pid;
+                uint64_t        dtsOffset;
                 
 public:
+                bool            setTimeOffset(uint64_t of) {dtsOffset=of;return true;}
+                vector          <ADM_psAudioSeekPoint >seekPoints;
                                   ADM_psAccess(const char *name,uint8_t pid,bool append); 
                 virtual           ~ADM_psAccess();
                                     /// Hint, the stream is pure CBR (AC3,MP2,MP3)
@@ -77,8 +81,9 @@
                                     /// Get a packet
                 virtual bool      getPacket(uint8_t *buffer, uint32_t *size, uint32_t maxSize,uint64_t *dts);
 
-                        bool      push(uint64_t at, uint64_t dts);
-
+                        bool      push(uint64_t at, uint64_t dts,uint32_t size);
+                                    /// Convert raw timestamp to scaled timestamp in us
+                uint64_t          timeConvert(uint64_t x);
 };
 /**
     \class ADM_psTrackDescriptor

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-26 06:44:18 UTC (rev 4546)
@@ -43,11 +43,12 @@
     \fn push
     \brief add a seek point.
 */
-bool      ADM_psAccess::push(uint64_t at, uint64_t dts)
+bool      ADM_psAccess::push(uint64_t at, uint64_t dts,uint32_t size)
 {
 ADM_psAudioSeekPoint s;
             s.position=at;
             s.dts=dts;
+            s.size=size;
             seekPoints.push_back(s);
             return true;
 }
@@ -57,7 +58,8 @@
 */
 uint64_t  ADM_psAccess::getDurationInUs(void)
 {
-    return 1000000LL; // FIXLE
+    // Take last seek point; should be accurate enough
+    return seekPoints[seekPoints.size()-1].dts;
 }
 /**
     \fn goToTime
@@ -66,6 +68,15 @@
 {
     return false;
 }
+uint64_t ADM_psAccess::timeConvert(uint64_t x)
+{
+    if(x==ADM_NO_PTS) return ADM_NO_PTS;
+    x=x-dtsOffset;
+    x=x*1000;
+    x/=90;
+    return x;
+
+}
 /**
     \fn getPacket
 */
@@ -75,6 +86,7 @@
     if(false==demuxer.getPacketOfType(pid,maxSize,size,&p,&d,buffer,&start)) return false;
     if(d==ADM_NO_PTS) *dts=p;
             else *dts=d;
+    *dts=timeConvert(*dts);
     return true;
 }
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-01-26 06:44:18 UTC (rev 4546)
@@ -310,7 +310,7 @@
                     uint8_t e=(*audioTracks)[i]->esID;
                     packetStats *s=pkt->getStat(e);
                     
-                    qfprintf(index,"Pes:%x:%08"LLD":%"LLD" ",e,s->lastDts,s->size);
+                    qfprintf(index,"Pes:%x:%08"LLX":%"LD":%"LLD" ",e,s->startAt,s->startSize,s->startDts);
                 }
                 
             }

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-26 06:44:18 UTC (rev 4546)
@@ -29,6 +29,7 @@
 bool    psHeader::readIndex(indexFile *index)
 {
 char buffer[2000];
+bool firstAudio=true;
         printf("[psDemuxer] Reading index\n");
         if(!index->goToSection("Data")) return false;
       
@@ -44,7 +45,9 @@
             }
             if(!strncmp(buffer,"Audio ",6))
             {
-                processAudioIndex(buffer+6);
+                if(firstAudio) firstAudio=false;
+                else
+                    processAudioIndex(buffer+6);
             }
         }
     return true;
@@ -55,21 +58,27 @@
 */
 bool psHeader::processAudioIndex(char *buffer)
 {
-    int64_t startAt,size,dts;
+    int64_t startAt,dts;
+    uint32_t size;
     uint32_t pes;
     char *head,*tail;
+    int trackNb=0;
         sscanf(buffer,"bf:%"LLX,&startAt);
         head=strstr(buffer," ");
         if(!head) return false;
         head++;
         while(tail=strstr(head," "))
         {
-            if(3!=sscanf(head,"Pes:%"LX":%"LLD":%"LLD" ",&pes,&dts,&size))
+            if(4!=sscanf(head,"Pes:%"LX":%"LLX":%"LD":%"LLD" ",&pes,&startAt,&size,&dts))
             {
+// qfprintf(index,"Pes:%x:%08"LLX":%"LD":%LLD ",e,s->startAt,s->startSize,s->startDts);
                 printf("[PsHeader::processAudioIndex] Reading index %s failed\n",buffer);
             }
             head=tail+1;
-            
+            ADM_psAccess *track=listOfAudioTracks[trackNb]->access;
+            track->push(startAt,dts,size);
+
+            trackNb++;
             //printf("[%s] => %"LX" Dts:%"LLD" Size:%"LLD"\n",buffer,pes,dts,size);
             if(strlen(head)<4) break;
         }
@@ -159,6 +168,34 @@
 bool psHeader::updatePtsDts(void)
 {
         uint64_t lastDts=0,lastPts=0,dtsIncrement=0;
+
+        // Make sure everyone starts at 0
+        // Search first timestamp (audio/video)
+        uint64_t startDts=ListOfFrames[0]->dts;
+        for(int i=0;i<listOfAudioTracks.size();i++)
+        {
+            uint64_t a=listOfAudioTracks[i]->access->seekPoints[0].dts;
+            if(a<startDts) startDts=a;
+        }
+        // Rescale all so that it starts ~ 0
+        // Video..
+        for(int i=0;i<ListOfFrames.size();i++)
+        {
+            dmxFrame *f=ListOfFrames[i];
+            if(f->pts!=ADM_NO_PTS) f->pts-=startDts;
+            if(f->dts!=ADM_NO_PTS) f->dts-=startDts;
+        }
+        // Audio start at 0 too
+        for(int i=0;i<listOfAudioTracks.size();i++)
+        {
+            ADM_psTrackDescriptor *track=listOfAudioTracks[i];
+            ADM_psAccess    *access=track->access;
+            access->setTimeOffset(startDts);
+        }
+
+        // Now fill in the missing timestamp and convert to us
+        // for video
+
         switch( _videostream.dwRate)
         {
             case 25000:   dtsIncrement=40000;break;
@@ -184,6 +221,18 @@
                 frame->pts=lastPts=timeConvert(frame->pts);
             }
         }
+        // convert to us for Audio tracks
+        for(int i=0;i<listOfAudioTracks.size();i++)
+        {
+            ADM_psTrackDescriptor *track=listOfAudioTracks[i];
+            ADM_psAccess    *access=track->access;
+            
+            for(int j=0;j<access->seekPoints.size();j++)
+            {
+                if( access->seekPoints[j].dts!=ADM_NO_PTS) 
+                    access->seekPoints[j].dts=access->timeConvert( access->seekPoints[j].dts);
+            }
+        }
         return 1;
                     
 }

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.cpp	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.cpp	2009-01-26 06:44:18 UTC (rev 4546)
@@ -625,13 +625,17 @@
                 // Update 
                 ADM_assert(tmppid<0x100);
                 packetStats *p=stats+tmppid;
-                p->count++;
-                p->size+=*packetSize;
                 uint64_t ts=*pts;
                 if(ts==ADM_NO_PTS) ts=*dts;
-                if(p->firstDts==ADM_NO_PTS) p->firstDts=ts;
                 if(ts!=ADM_NO_PTS)
-                    p->lastDts=ts;
+                {
+                    p->startCount=p->count;
+                    p->startAt=*startAt;
+                    p->startSize=p->size;
+                    p->startDts=ts;
+                }
+                p->count++;
+                p->size+=*packetSize;
                 if(tmppid==pid) return true;
         }
     }
@@ -646,8 +650,7 @@
     for(int i=0;i<256;i++)
     {
         packetStats *p=stats+i;
-        p->firstDts=ADM_NO_PTS;
-        p->lastDts=ADM_NO_PTS;
+        p->startDts=ADM_NO_PTS;
     }
 }
 //EOF

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.h	2009-01-25 01:26:14 UTC (rev 4545)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/dmxPSPacket.h	2009-01-26 06:44:18 UTC (rev 4546)
@@ -88,8 +88,11 @@
 {
     uint32_t count;
     uint32_t size;
-    uint64_t firstDts;
-    uint64_t lastDts;
+    
+    uint64_t startAt;
+    uint32_t startCount;
+    uint32_t startSize;
+    uint64_t startDts;
 }packetStats;
 
 class psPacketLinearTracker : public psPacketLinear



From mean at mail.berlios.de  Mon Jan 26 07:44:31 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 26 Jan 2009 07:44:31 +0100
Subject: [Avidemux-svn-commit] r4547 - in branches/avidemux_2.6_branch_mean:
	avidemux/ADM_codecs avidemux/ADM_editor plugins/ADM_demuxers/MpegPS
Message-ID: <200901260644.n0Q6iVpD027484@sheep.berlios.de>

Author: mean
Date: 2009-01-26 07:44:28 +0100 (Mon, 26 Jan 2009)
New Revision: 4547

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
Log:
[PsDemux] Workish audio (incomplete)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-01-26 06:44:28 UTC (rev 4547)
@@ -106,7 +106,7 @@
       out->_qSize = out->_qStride = 0;
       out->quant = NULL;
     }
-    printf("[LAVC] Old pts :%"LLD" new pts :%"LLD"\n",out->Pts, (uint64_t)(src->opaque));
+//    printf("[LAVC] Old pts :%"LLD" new pts :%"LLD"\n",out->Pts, (uint64_t)(src->opaque));
     out->Pts= (uint64_t)(src->opaque);
     return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-01-26 06:44:28 UTC (rev 4547)
@@ -132,10 +132,12 @@
     uint32_t decodedSample=nbOut;
     decodedSample/=trk->wavheader.channels;
     if(!decodedSample && !fillerSample) goto again;
-    if(nbSamples!=decodedSample)
+#define ADM_MAX_JITTER 5000  // in samples
+    if(abs(nbSamples-decodedSample)>ADM_MAX_JITTER)
+    {
         printf("[Composer::getPCMPacket] Demuxer was wrong %d vs %d samples!\n",nbSamples,decodedSample);
+    }
     
-    
     // This packet has been dropped, try the next one
     if(drop==true && !fillerSample) goto again;
     // Update infos

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.cpp	2009-01-26 06:44:28 UTC (rev 4547)
@@ -91,8 +91,18 @@
         goto abt;
     }
     r=true;
-  
-
+    for(int i=0;i<listOfAudioTracks.size();i++)
+    {
+        ADM_psTrackDescriptor *desc=listOfAudioTracks[i];
+        ADM_audioStream *audioStream=ADM_audioCreateStream(&desc->header,desc->access);
+        if(!audioStream)
+        {
+            
+        }else       
+        {
+                desc->stream=audioStream;
+        }
+    }
 abt:
     index.close();
     printf("[psDemuxer] Loaded %d\n",r);

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_ps.h	2009-01-26 06:44:28 UTC (rev 4547)
@@ -84,6 +84,9 @@
                         bool      push(uint64_t at, uint64_t dts,uint32_t size);
                                     /// Convert raw timestamp to scaled timestamp in us
                 uint64_t          timeConvert(uint64_t x);
+
+                virtual uint32_t  getLength(void);
+
 };
 /**
     \class ADM_psTrackDescriptor
@@ -93,6 +96,7 @@
 public:
         ADM_audioStream *stream;
         ADM_psAccess    *access;
+        WAVHeader       header;
         ADM_psTrackDescriptor()
             {
                 stream=NULL;

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-26 06:44:28 UTC (rev 4547)
@@ -52,20 +52,41 @@
             seekPoints.push_back(s);
             return true;
 }
+/**
+    \fn getLength
+*/
+uint32_t  ADM_psAccess::getLength(void)
+{
+  return (seekPoints[seekPoints.size()-1].size);
 
+}
 /**
     \fn getDurationInUs
 */
 uint64_t  ADM_psAccess::getDurationInUs(void)
 {
     // Take last seek point; should be accurate enough
-    return seekPoints[seekPoints.size()-1].dts;
+    return timeConvert(seekPoints[seekPoints.size()-1].dts);
 }
 /**
     \fn goToTime
 */                              
 bool      ADM_psAccess::goToTime(uint64_t timeUs)
 {
+    // Convert time in us to scaled 90 kHz tick
+    double f=timeUs;
+    f*=90;
+    f/=1000;
+    f+=dtsOffset;
+    uint64_t n=(uint64_t)f;
+    for(int i=0;i<seekPoints.size()-1;i++)
+    {
+        if(seekPoints[i].dts >=n && seekPoints[i+1].dts>n)
+        {
+            demuxer.setPos(seekPoints[i].position);
+            return true;
+        }
+    }
     return false;
 }
 uint64_t ADM_psAccess::timeConvert(uint64_t x)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-26 06:44:18 UTC (rev 4546)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-26 06:44:28 UTC (rev 4547)
@@ -45,7 +45,8 @@
             }
             if(!strncmp(buffer,"Audio ",6))
             {
-                if(firstAudio) firstAudio=false;
+                if(firstAudio) 
+                    firstAudio=false; // Ignore first line
                 else
                     processAudioIndex(buffer+6);
             }
@@ -300,18 +301,13 @@
             hdr.channels=chan;
             hdr.encoding=codec;
         ADM_psAccess *access=new ADM_psAccess(name,pid,true);
-        ADM_audioStream *audioStream=ADM_audioCreateStream(&hdr,access);
-        if(!audioStream)
-        {
-            delete access;
-        }else       
-        {
             ADM_psTrackDescriptor *desc=new ADM_psTrackDescriptor;
-            desc->stream=audioStream;
+            desc->stream=NULL;
             desc->access=access;
+            memcpy(&(desc->header),&hdr,sizeof(hdr));
             listOfAudioTracks.push_back(desc);
-        }
 
+
     }
     return true;
 }



From mean at mail.berlios.de  Thu Jan 29 19:48:29 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Jan 2009 19:48:29 +0100
Subject: [Avidemux-svn-commit] r4548 - in branches/avidemux_2.6_branch_mean:
	avidemux/ADM_userInterfaces/ADM_GTK
	avidemux/ADM_userInterfaces/ADM_GTK/glade cmake
Message-ID: <200901291848.n0TImTRE022147@sheep.berlios.de>

Author: mean
Date: 2009-01-29 19:48:28 +0100 (Thu, 29 Jan 2009)
New Revision: 4548

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCheckGlade.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCheckGtk.cmake
Log:
[UI] Use glade

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2009-01-26 06:44:28 UTC (rev 4547)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2009-01-29 18:48:28 UTC (rev 4548)
@@ -10,3 +10,4 @@
 ADD_SUBDIRECTORY(ADM_gui2)
 ADD_SUBDIRECTORY(ADM_ocr)
 ADD_SUBDIRECTORY(ADM_toolkit_gtk)
+ADD_SUBDIRECTORY(glade)

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/CMakeLists.txt	2009-01-26 06:44:28 UTC (rev 4547)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/CMakeLists.txt	2009-01-29 18:48:28 UTC (rev 4548)
@@ -0,0 +1,6 @@
+# Install glade file into FOO/lib/ADM_glade/
+set(ADM_glade
+gtk2_build.glade
+)
+INSTALL(FILES ${ADM_glade} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_glade/")
+

Added: branches/avidemux_2.6_branch_mean/cmake/admCheckGlade.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckGlade.cmake	2009-01-26 06:44:28 UTC (rev 4547)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckGlade.cmake	2009-01-29 18:48:28 UTC (rev 4548)
@@ -0,0 +1,21 @@
+MACRO(checkGlade)
+	IF (NOT GLADE_CHECKED)
+		OPTION(GLADE "" ON)
+
+		MESSAGE(STATUS "Checking for glade-2.0")
+		MESSAGE(STATUS "**********************")
+
+		IF (GLADE)
+			PKG_CHECK_MODULES(GLADE libglade-2.0)
+			PRINT_LIBRARY_INFO("LibGlade" GLADE_FOUND "${GLADE_CFLAGS}" "${GLADE_LDFLAGS}")
+
+		ELSE (GLADE)
+			MESSAGE("${MSG_DISABLE_OPTION}")
+		ENDIF (GLADE)
+
+		MESSAGE("")
+		SET(GLADE_CHECKED 1)
+
+		MESSAGE("")
+	ENDIF (NOT GLADE_CHECKED)
+ENDMACRO(checkGlade)

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckGtk.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckGtk.cmake	2009-01-26 06:44:28 UTC (rev 4547)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckGtk.cmake	2009-01-29 18:48:28 UTC (rev 4548)
@@ -1,3 +1,7 @@
+# we also need libglade from now on
+# So we search for both, them merge the flags into the gtk one
+include(admCheckGlade)
+
 MACRO(checkGtk)
 	IF (NOT GTK_CHECKED)
 		OPTION(GTK "" ON)
@@ -8,7 +12,12 @@
 		IF (GTK)
 			PKG_CHECK_MODULES(GTK gtk+-2.0)
 			PRINT_LIBRARY_INFO("GTK+" GTK_FOUND "${GTK_CFLAGS}" "${GTK_LDFLAGS}")
-
+                        checkGlade()
+                        if  (GLADE_FOUND)
+                        else(GLADE_FOUND)
+                                set(GTK_FOUND false)
+                        endif(GLADE_FOUND)
+                        
 			IF (GTK_FOUND)
 				ADM_COMPILE(gtk_x11_check.cpp "${GTK_CFLAGS}" "" "${GTK_LDFLAGS}" GTK_X11_SUPPORTED outputGtkX11Test)
 
@@ -23,6 +32,10 @@
 						MESSAGE("Error Message: ${outputGtkX11Test}")
 					ENDIF (VERBOSE)
 				ENDIF (GTK_X11_SUPPORTED)
+                               # Merge glade flags into gtk flags
+                                SET(  GTK_CFLAGS "${GTK_CFLAGS} ${GLADE_CFLAGS}")
+                                SET(  GTK_LDFLAGS "${GTK_LDFLAGS} ${GLADE_LDFLAGS}")
+                               # /Merge glade flags into gtk flags
 			ENDIF (GTK_FOUND)
 		ELSE (GTK)
 			MESSAGE("${MSG_DISABLE_OPTION}")
@@ -48,4 +61,4 @@
 
 		MESSAGE("")
 	ENDIF (NOT GTK_CHECKED)
-ENDMACRO(checkGtk)
\ No newline at end of file
+ENDMACRO(checkGtk)



From mean at mail.berlios.de  Thu Jan 29 19:48:31 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Jan 2009 19:48:31 +0100
Subject: [Avidemux-svn-commit] r4549 - in branches/avidemux_2.6_branch_mean:
	avidemux/ADM_editor plugins/ADM_demuxers/MpegPS
Message-ID: <200901291848.n0TImVUv022162@sheep.berlios.de>

Author: mean
Date: 2009-01-29 19:48:31 +0100 (Thu, 29 Jan 2009)
New Revision: 4549

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
Log:
[PsDemuxer] Ignore small audio jitters (32 ms), happens in mpeg file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-01-29 18:48:28 UTC (rev 4548)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-01-29 18:48:31 UTC (rev 4549)
@@ -41,7 +41,7 @@
 #define AUDIOSEG 	_segments[_audioseg]._reference
 #define SEG 		_segments[seg]._reference
 
-#define ADM_ALLOWED_DRIFT_US 30000 // Allow 30 ms jitter on audio
+#define ADM_ALLOWED_DRIFT_US 40000 // Allow 40 ms jitter on audio
 
 #if 1
 #define vprintf(...) {}

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-29 18:48:28 UTC (rev 4548)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psAudio.cpp	2009-01-29 18:48:31 UTC (rev 4549)
@@ -79,6 +79,13 @@
     f/=1000;
     f+=dtsOffset;
     uint64_t n=(uint64_t)f;
+
+    if(n<=seekPoints[seekPoints.size()-1].dts)
+    {
+            demuxer.setPos(seekPoints[0].position);
+            return true;
+    }
+
     for(int i=0;i<seekPoints.size()-1;i++)
     {
         if(seekPoints[i].dts >=n && seekPoints[i+1].dts>n)
@@ -89,6 +96,10 @@
     }
     return false;
 }
+/**
+    \fn timeConvert
+    \brief Convert time in ticks raw from the stream to avidemux time in us starting from the beginning of the file
+*/
 uint64_t ADM_psAccess::timeConvert(uint64_t x)
 {
     if(x==ADM_NO_PTS) return ADM_NO_PTS;

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-01-29 18:48:28 UTC (rev 4548)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-01-29 18:48:31 UTC (rev 4549)
@@ -24,6 +24,7 @@
 #include "avidemutils.h"
 #include "ADM_quota.h"
 #include "ADM_psAudioProbe.h"
+#include "DIA_encoding.h"
 
 static const char Type[5]={'X','I','P','B','P'};
 
@@ -87,6 +88,7 @@
         FILE *index;
         psPacketLinearTracker *pkt;
         listOfPsAudioTracks *audioTracks;
+        DIA_encodingBase  *ui;
 public:
                 PsIndexer(void);
                 ~PsIndexer();
@@ -118,6 +120,7 @@
     index=NULL;
     pkt=NULL;
     audioTracks=NULL;
+    ui=createEncoding (25000);
 }
 
 /**
@@ -128,6 +131,8 @@
     if(index) qfclose(index);
     if(pkt) delete pkt;
     if( audioTracks) DestroyListOfPsAudioTracks(audioTracks);
+    if(ui) delete ui;
+    ui=NULL;
 }
 /**
     \fn run
@@ -135,7 +140,7 @@
 bool PsIndexer::run(const char *file)
 {
 uint32_t temporal_ref,val;
-
+uint64_t fullSize;
 uint8_t buffer[50*1024];
 bool seq_found=false;
 
@@ -172,6 +177,7 @@
     }
     pkt->open(file,false);
     data.pkt=pkt;
+    fullSize=pkt->getSize();
       while(1)
       {
         uint32_t code=0xffff+0xffff0000;
@@ -213,7 +219,15 @@
                           qfprintf(index,"[Data]");
                           break;
                   case 0xb8: // GOP
-                          
+                          // Update ui
+                            {
+                                float pos=data.startAt;
+                                pos=pos/(float)fullSize;
+                                pos*=100;
+                                ui->setPercent( (uint32_t)pos);
+
+                            }
+
                           if(!seq_found) continue;
                           if(data.state==idx_startAtGopOrSeq) 
                           {         



From mean at mail.berlios.de  Thu Jan 29 19:48:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Jan 2009 19:48:38 +0100
Subject: [Avidemux-svn-commit] r4551 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main
Message-ID: <200901291848.n0TImcf4022187@sheep.berlios.de>

Author: mean
Date: 2009-01-29 19:48:37 +0100 (Thu, 29 Jan 2009)
New Revision: 4551

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/CMakeLists.txt
Log:
[Gtk] Use libglade rather than generated code

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/CMakeLists.txt	2009-01-29 18:48:33 UTC (rev 4550)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/CMakeLists.txt	2009-01-29 18:48:37 UTC (rev 4551)
@@ -0,0 +1,28 @@
+# Install glade file into FOO/lib/ADM_glade/
+set(ADM_glade
+gtk2_build.glade
+about.xpm
+avidemux_icon.xpm
+backward.xpm
+begin.xpm
+end.xpm
+forward.xpm
+gnome-calculator.png
+gnome-calculator_small.xpm
+gnome-calculator.xpm
+Kbackward.xpm
+Kforward.xpm
+markA.xpm
+markB.xpm
+play.xpm
+stop.xpm
+systray2.xpm
+systray.xpm
+xpm_nextblack.xpm
+xpm_prevblack.xpm
+avidemux_icon_small.png
+audio-volume-medium.png
+)
+INSTALL(FILES ${ADM_glade} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_glade/main")
+
+



From mean at mail.berlios.de  Sat Jan 31 19:34:10 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 31 Jan 2009 19:34:10 +0100
Subject: [Avidemux-svn-commit] r4552 - in
	branches/avidemux_2.6_branch_mean/avidemux: . ADM_audiofilter
	ADM_script ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200901311834.n0VIYARb026606@sheep.berlios.de>

Author: mean
Date: 2009-01-31 19:34:09 +0100 (Sat, 31 Jan 2009)
New Revision: 4552

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
Log:
[UI] Gtk Cleanup, remove obsolete parts

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2009-01-29 18:48:37 UTC (rev 4551)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2009-01-31 18:34:09 UTC (rev 4552)
@@ -263,8 +263,8 @@
          if(audioDelay!=olddelay ||oldshift!= audioShift)
          {  // Refresh
 
-             UI_setTimeShift(audioShift,audioDelay);
 
+
          }
 
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2009-01-29 18:48:37 UTC (rev 4551)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2009-01-31 18:34:09 UTC (rev 4552)
@@ -209,7 +209,7 @@
                                 priv->getObject()->m_nDelay = JSVAL_TO_INT(*vp);
                                 //audioFilterDelay(priv->getObject()->m_nDelay);
                                 enterLock();
-                                UI_setTimeShift(1, priv->getObject()->m_nDelay); 
+                                //UI_setTimeShift(1, priv->getObject()->m_nDelay); 
                                 leaveLock();
                                 break;
                         }

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2009-01-29 18:48:37 UTC (rev 4551)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2009-01-31 18:34:09 UTC (rev 4552)
@@ -52,18 +52,16 @@
 
 static admGlade glade;
 
-GtkWidget *guiRootWindow=NULL;
+GtkWidget        *guiRootWindow=NULL;
 static GtkWidget *guiDrawingArea=NULL;
 static GtkWidget *guiSlider=NULL;
 
-static GtkWidget *guiMarkA=NULL;
-static GtkWidget *guiMarkB=NULL;
 static GtkWidget *guiCurFrame=NULL;
 static GtkWidget *guiTotalFrame=NULL;
 static GtkWidget *guiCurTime=NULL;
 static GtkWidget *guiTotalTime=NULL;
 
-static GtkWidget *guiAudioToggle=NULL;
+
 static GtkWidget *guiVideoToggle=NULL;
 static GdkCursor *guiCursorBusy=NULL;
 static GdkCursor *guiCursorNormal=NULL;
@@ -72,7 +70,6 @@
 
 static int keyPressHandlerId=0;
 
-//static gint	  guiCursorEvtMask=0;
 static gint       jogChange( void );
 static void volumeChange( void );
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
@@ -102,9 +99,9 @@
 extern uint8_t AVDM_setVolume(int volume);
 #endif
 extern void checkCrashFile(void);
-#define AUDIO_WIDGET "comboboxAudio"
-#define VIDEO_WIDGET "comboboxVideo"
-#define FORMAT_WIDGET "comboboxFormat"
+#define AUDIO_WIDGET   "comboboxAudio"
+#define VIDEO_WIDGET   "comboboxVideo"
+#define FORMAT_WIDGET  "comboboxFormat"
 #define PREVIEW_WIDGET "comboboxPreview"
 //
 enum
@@ -181,12 +178,12 @@
 	{"buttonMarkB"			,"clicked"		,ACT_MarkB},
 	{"buttonBegin"			,"clicked"		,ACT_Begin},
 	{"buttonEnd"			,"clicked"		,ACT_End},
-	{"menutoolbuttonOpen"		,"clicked"		,ACT_OpenAvi},
-	{"toolbuttonInfo"			,"clicked"		,ACT_AviInfo},
+	{"menutoolbuttonOpen"	,"clicked"		,ACT_OpenAvi},
+	{"toolbuttonInfo"		,"clicked"		,ACT_AviInfo},
 	{"toolbuttonSave"		,"clicked"		,ACT_SaveAvi},
 
 	{"buttonFilters"		,"clicked"		,ACT_VideoParameter},
-	{"buttonAudioFilter"		,"clicked"		,ACT_AudioFilters},
+	{"buttonAudioFilter"	,"clicked"		,ACT_AudioFilters},
 	{"buttonConfV"			,"clicked"		,ACT_VideoCodec},
 	{"buttonConfA"			,"clicked"		,ACT_AudioCodec},
 
@@ -301,9 +298,10 @@
         jog_shuttle_set_value (jsw, angle);
 }
 
-///
-///	Create main window and bind to it
-///
+/**
+        \fn initGUI
+        \brief Create main window and bind to it
+*/
 uint8_t initGUI( void )
 {
 uint8_t ret=0;
@@ -350,7 +348,9 @@
 
 	return ret;
 }
-
+/**
+    \fn destroyGUI
+*/
 void destroyGUI(void)
 {
 	renderDestroy();
@@ -399,24 +399,15 @@
 
 	sliderAdjustment=gtk_range_get_adjustment (GTK_RANGE(guiSlider));
 
-	ADM_LOOKUP(guiMarkA,labelMarkA);
-	ADM_LOOKUP(guiMarkB,labelMarkB);
 	ADM_LOOKUP(guiCurFrame,boxCurFrame);
 	ADM_LOOKUP(guiTotalFrame,labelTotalFrame);
 
 	ADM_LOOKUP(guiCurTime,boxCurTime);
 	ADM_LOOKUP(guiTotalTime,labelTotalTime);
 
-#if 0
-	ADM_LOOKUP(guiPreviewToggle,toggletoolbuttonPreview);
-	ADM_LOOKUP(guiOutputToggle,toggletoolbuttonOutput);
-
-	ADM_LOOKUP(guiAudioToggle,togglebuttonAudio);
-	ADM_LOOKUP(guiVideoToggle,togglebuttonVideo);
-#endif
 #undef ADM_LOOKUP
   // bind menu
- #define CALLBACK(x,y) gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,#x)), "activate", \
+ #define CALLBACK(x,y) gtk_signal_connect(GTK_OBJECT( glade.getWidget(#x)), "activate", \
                       GTK_SIGNAL_FUNC(guiCallback),                   (void *) y)
 
  	#include "GUI_menumap.h"
@@ -535,15 +526,16 @@
         /*   Fill in output format window */
         uint32_t nbFormat;
 
-                nbFormat=ADM_mx_getNbMuxers();
-                combo_box=GTK_COMBO_BOX(glade.getWidget(FORMAT_WIDGET));
-                gtk_combo_box_remove_text(combo_box,0);
-                printf("Found %d Format \n",nbFormat);
-                for(uint32_t i=0;i<nbFormat;i++)
-                {
-                        name=ADM_mx_getDisplayName(i);
-                        gtk_combo_box_append_text      (combo_box,QT_TR_NOOP(name));
-                }
+        nbFormat=ADM_mx_getNbMuxers();
+        combo_box=GTK_COMBO_BOX(glade.getWidget(FORMAT_WIDGET));
+        ADM_assert(combo_box);
+        gtk_combo_box_remove_text(combo_box,0);
+        printf("Found %d Format \n",nbFormat);
+        for(uint32_t i=0;i<nbFormat;i++)
+        {
+                name=ADM_mx_getDisplayName(i);
+                gtk_combo_box_append_text      (combo_box,QT_TR_NOOP(name));
+        }
         gtk_combo_box_set_active(combo_box,0);
 
 
@@ -607,9 +599,9 @@
     return 1;
 
 }
-/****
-
-**/
+/**
+    \fn GUI_initCustom
+*/
 void GUI_initCustom(void )
 {
   GtkWidget *menuEntry=glade.getWidget("custom1");
@@ -665,17 +657,19 @@
         return true;
 }
 
-///
-///	Return the widget containing the image
-///
+/**
+        \fn getDrawWidget
+        \brief Return the widget containing the image
+*/
 GtkWidget *getDrawWidget( void )
 {
 	return guiDrawingArea;
 
 }
-///
-///	Set slider position
-///
+/**
+        \fn UI_setScale
+        \briefSet slider position
+*/
 static int _upd_in_progres=0;
 void UI_setScale( double val )
 {
@@ -703,7 +697,9 @@
         return (int32_t )val;
 
 }
-
+/**
+        \fn UI_setTitle
+*/
 void UI_setTitle(const char *name)
 {
 	char *title;
@@ -727,6 +723,9 @@
 	gtk_window_set_title(GTK_WINDOW (guiRootWindow), title);
 	delete [] title;
 }
+/**
+    \fn UI_setFrameType
+*/
 void UI_setFrameType( uint32_t frametype,uint32_t qp)
 {
 GtkLabel *wid=(GtkLabel *)glade.getWidget("labelFrameType");
@@ -744,15 +743,21 @@
 	gtk_label_set_text( wid,string);
 
 }
-///
-///	Get slider position
-///
+/**
+    \fn UI_readScale
+	\brief Get slider position, return double between 0.0 and 1.0
+*/
 double  UI_readScale( void )
 {
 
 	return (double)GTK_ADJUSTMENT(sliderAdjustment)->value;
 
 }
+/**
+    \fn UI_updateFrameCount
+	
+*/
+
 void UI_updateFrameCount(uint32_t curFrame)
 {
     //char text[80];
@@ -762,6 +767,11 @@
 	gtk_write_entry(guiCurFrame,curFrame);
 
 }
+/**
+    \fn UI_setFrameCount
+	
+*/
+
 void UI_setFrameCount(uint32_t curFrame,uint32_t total)
 {
     char text[80];
@@ -831,6 +841,9 @@
     HandleAction(ACT_Exit);
     return 1;
 }
+/**
+    \fn UI_grabFocus
+*/
 int UI_grabFocus( void)
 {
 #define RM(x,y)   gtk_widget_remove_accelerator (glade.getWidget(#x), accel_group, \
@@ -861,6 +874,9 @@
 	return FALSE;
 
 }
+/**
+    \fn UI_loseFocus
+*/
 int UI_loseFocus( void)
 {
 #define ADD(x,y)  gtk_widget_add_accelerator (glade.getWidget(#x), "clicked", accel_group, \
@@ -892,7 +908,9 @@
 
 	return FALSE;
 }
-
+/**
+    \fn UI_focusAfterActivate
+*/
 void UI_focusAfterActivate(GtkMenuItem * menuitem, gpointer user_data)
 {
 	// return focus to window once Enter has been pressed
@@ -908,20 +926,24 @@
 
 	gtk_widget_grab_focus(glade.getWidget( "menuBar"));
 }
-
+/**
+    \fn UI_returnFocus
+*/
 gboolean UI_returnFocus(GtkWidget *widget, GdkEventButton *event, gpointer user_data)
 {
 	gtk_widget_grab_focus(glade.getWidget( "menuBar"));
 	return FALSE;
 }
-
+/**
+    \fn UI_setMarkers
+*/
 void UI_setMarkers(uint32_t a, uint32_t b )
 {
 char string[500];
 		sprintf(string," %06"LU,a);
-        	gtk_label_set_text(GTK_LABEL(guiMarkA),string);
+        	gtk_label_set_text(GTK_LABEL(glade.getWidget("labelMarkA")),string);
 		sprintf(string," %06"LU,b);
-        	gtk_label_set_text(GTK_LABEL(guiMarkB),string);
+        	gtk_label_set_text(GTK_LABEL(glade.getWidget("labelMarkB")),string);
 			gtk_markscale_setA(guiSlider, a);
 			gtk_markscale_setB(guiSlider, b);
 }
@@ -935,31 +957,33 @@
 	 if(status) b=TRUE;
   	else			b=FALSE;
 
-	if(b!=gtk_toggle_tool_button_get_active(GTK_TOGGLE_TOOL_BUTTON(guiAudioToggle)))
-     		gtk_toggle_tool_button_set_active (GTK_TOGGLE_TOOL_BUTTON(guiAudioToggle),b);
+	if(b!=gtk_toggle_tool_button_get_active(GTK_TOGGLE_TOOL_BUTTON(glade.getWidget("togglebuttonAudio"))))
+     		gtk_toggle_tool_button_set_active (GTK_TOGGLE_TOOL_BUTTON(glade.getWidget("togglebuttonAudio")),b);
 	aprintf("++ audio toggle : %d(%d)\n",b,status);
 
 }
-/*
-	Set/unset the toggle button video process
+/**
+    \fn UI_setVProcessToggleStatus
+	\brief Set/unset the toggle button video process
 */
 void UI_setVProcessToggleStatus( uint8_t status )
 {
 gint b;
 	 if(status) 		b=TRUE;
   	else			b=FALSE;
-	if(b!=gtk_toggle_tool_button_get_active(GTK_TOGGLE_TOOL_BUTTON(guiVideoToggle)))
+	if(b!=gtk_toggle_tool_button_get_active(GTK_TOGGLE_TOOL_BUTTON(glade.getWidget("togglebuttonVideo"))))
 	{
-     		gtk_toggle_tool_button_set_active (GTK_TOGGLE_TOOL_BUTTON(guiVideoToggle),b);
+     		gtk_toggle_tool_button_set_active (GTK_TOGGLE_TOOL_BUTTON(glade.getWidget("togglebuttonVideo")),b);
 		aprintf("Changing it to %d\n",b);
 	}
 	aprintf("++ video toggle : %d\n",b);
 
 }
 
-///
-///	This is a relay function to do UI events -> gtk_gui.cpp
-///
+/**
+            \fn guiCallback
+            \brief This is a relay function to do UI events -> gtk_gui.cpp
+*/
 void guiCallback(GtkMenuItem * menuitem, gpointer user_data)
 {
     UNUSED_ARG(menuitem);
@@ -979,11 +1003,18 @@
     }
      HandleAction(act);
 }
+/**
+    \fn UI_JumpDone
+*/
 void UI_JumpDone(void )
 {
 
 
 }
+/**
+    \fn UI_readCurFrame
+*/
+
 int UI_readCurFrame( void )
 {
 	int i = gtk_read_entry(guiCurFrame);
@@ -993,7 +1024,9 @@
 
 	return i;
 }
-
+/**
+    \fn UI_readCurTime
+*/
 int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
 {
 	return 0;
@@ -1025,13 +1058,11 @@
 {
 	 gdk_window_set_cursor((guiRootWindow->window),
                                           guiCursorBusy);
-/*
-	guiCursorEvtMask=gtk_widget_get_events(guiRootWindow);
-	gtk_widget_set_events(guiRootWindow,0);
-*/
 
-
 }
+/**
+    \fn on_video_change
+*/
 void on_video_change(void)
 {
 int enable;
@@ -1050,6 +1081,10 @@
         gtk_widget_set_sensitive(glade.getWidget("buttonFilters"),enable);
         HandleAction(ACT_VideoCodecChanged);
 }
+/**
+    \fn on_audio_change
+*/
+
 void on_audio_change(void)
 {
 int enable;
@@ -1064,6 +1099,9 @@
         HandleAction(ACT_AudioCodecChanged);
 
 }
+/**
+    \fn on_preview_change
+*/
 void on_preview_change(void)
 {
 int enable;
@@ -1071,6 +1109,10 @@
         HandleAction(ACT_PreviewChanged);
 
 }
+/**
+    \fn on_format_change
+*/
+
 void on_format_change(void)
 {
 
@@ -1105,7 +1147,9 @@
         return gtk_combo_box_get_active(GTK_COMBO_BOX(glade.getWidget(VIDEO_WIDGET)));
 
  }
-
+/**
+    \fn UI_setAudioCodec
+*/
 void UI_setAudioCodec( int i)
 {
         //gtk_option_menu_set_history(GTK_OPTION_MENU(lookup_widget(guiRootWindow,AUDIO_WIDGET)), i);
@@ -1115,6 +1159,10 @@
         gtk_widget_set_sensitive(glade.getWidget("buttonAudioFilter"),i);
         update_ui=0;
 }
+/**
+    \fn UI_setVideoCodec
+*/
+
 void UI_setVideoCodec( int i)
 {
         //gtk_option_menu_set_history(GTK_OPTION_MENU(lookup_widget(guiRootWindow,VIDEO_WIDGET)), i);
@@ -1134,11 +1182,6 @@
 
 
 }
-void UI_PrintCurrentVCodec(const char *str)
-{
-
-
-}
 /**
     \fn UI_GetCurrentFormat
     \brief Returns index of the currently selected container
@@ -1245,6 +1288,9 @@
     }
     gtk_drag_finish(dc,TRUE,FALSE,t);
 }
+/**
+    \fn UI_toogleMain
+*/
 void UI_toogleMain(void)
 {
 static int show=1;
@@ -1254,6 +1300,9 @@
         else
                 gtk_widget_show(GTK_WIDGET(glade.getWidget("toolbar2")) );
 }
+/**
+    \fn UI_toogleSide
+*/
 void UI_toogleSide(void)
 {
 static int show=1;
@@ -1263,22 +1312,9 @@
         else
                 gtk_widget_show(GTK_WIDGET(glade.getWidget("vbox9")));
 }
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-
-        *onoff=gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (glade.getWidget("CheckButtonTimeshift")));
-        *value=gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(glade.getWidget("spinbuttonTimeShift"))) ;
-        return 1;
-}
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (!value)
-		onoff = 0;
-
-        gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (glade.getWidget("CheckButtonTimeshift")),onoff);
-        gtk_spin_button_set_value(GTK_SPIN_BUTTON(glade.getWidget("spinbuttonTimeShift")),value) ;
-        return 1;
-}
+/**
+    \fn UI_updateRecentMenu
+*/
 uint8_t UI_updateRecentMenu( void )
 {
 const char **names;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2009-01-29 18:48:37 UTC (rev 4551)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2009-01-31 18:34:09 UTC (rev 4552)
@@ -42,8 +42,6 @@
 void UI_toogleSide(void);
 void UI_toogleMain(void);
 
-uint8_t UI_getTimeShift(int *onoff,int *value);
-uint8_t UI_setTimeShift(int onoff,int value);
 
 uint8_t UI_updateRecentMenu( void );
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-01-29 18:48:37 UTC (rev 4551)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-01-31 18:34:09 UTC (rev 4552)
@@ -366,9 +366,6 @@
 	{
           case ACT_JOG:
                 break;
-        case ACT_TimeShift:
-                A_TimeShift();
-                break;
 	case ACT_OpenAvi:
           GUI_FileSelRead (QT_TR_NOOP("Select AVI File..."), (SELFILE_CB *)A_openAvi);
 	  break;
@@ -417,9 +414,6 @@
         case ACT_AUTO_PSP_H264:
                 A_autoDrive( action);
                 break;
-     case ACT_TimeShift:
-                A_TimeShift();
-                break;
 
    case ACT_SelectTrack1:
                 A_audioTrack();
@@ -2166,25 +2160,6 @@
 }
 
 
-//****************
-uint8_t A_TimeShift(void)
-{
-static int update=0;
-int onoff;
-int value;
-        if(update) return 1;
-        update=1;
-
-        // Read and update
-        update=0;
-        UI_getTimeShift(&onoff,&value);
-        if(onoff && value) audioFilterDelay(value);
-                else audioFilterDelay(0);
-        //****
-
-        update=0;
-
-}
 void A_Resync(void)
 {
 // Just in case update file info



From mean at mail.berlios.de  Sat Jan 31 19:34:12 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 31 Jan 2009 19:34:12 +0100
Subject: [Avidemux-svn-commit] r4553 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS
Message-ID: <200901311834.n0VIYCwZ026683@sheep.berlios.de>

Author: mean
Date: 2009-01-31 19:34:12 +0100 (Sat, 31 Jan 2009)
New Revision: 4553

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
Log:
[PsAudio] Fix up for the 1st packet

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-31 18:34:09 UTC (rev 4552)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psReadIndex.cpp	2009-01-31 18:34:12 UTC (rev 4553)
@@ -170,8 +170,42 @@
 {
         uint64_t lastDts=0,lastPts=0,dtsIncrement=0;
 
+
+        // For audio, The first packet in the seekpoints happens a bit after the action
+        // It means some audio may have been seen since we locked on video.
+        // So we compute the DTS of the first real packet
+        // by using the size field and byterate and arbitrarily make it begins
+        // at video
+        for(int i=0;i<listOfAudioTracks.size();i++)
+        {
+            vector          <ADM_psAudioSeekPoint > *seekPoints=&(listOfAudioTracks[i]->access->seekPoints);
+            uint64_t secondDts=(*seekPoints)[0].dts;
+            uint64_t secondSize=(*seekPoints)[0].size;
+            if(secondSize && listOfAudioTracks[i]->header.byterate)
+            {
+                    // it is actually an offset in time to the 2nd packet Dts
+                double  firstFloatDts=secondSize*1000*1000.; 
+                        firstFloatDts/=listOfAudioTracks[i]->header.byterate; // in us
+                uint64_t firstDts=(uint64_t)firstFloatDts;
+
+                        if(firstDts>secondDts) firstDts=0;
+                            else firstDts=secondDts-firstDts;
+
+                // Now add our seek point
+                ADM_psAudioSeekPoint sk;
+                sk.dts=firstDts;
+                sk.size=0;
+                sk.position=ListOfFrames[0]->startAt;
+                (*seekPoints).insert( (*seekPoints).begin(),sk);
+
+            }
+        }
+
+
         // Make sure everyone starts at 0
         // Search first timestamp (audio/video)
+
+
         uint64_t startDts=ListOfFrames[0]->dts;
         for(int i=0;i<listOfAudioTracks.size();i++)
         {



