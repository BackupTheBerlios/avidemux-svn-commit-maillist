From mean at mail.berlios.de  Sun Apr  1 16:18:10 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 1 Apr 2007 16:18:10 +0200
Subject: [Avidemux-svn-commit] r2913 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_libraries/ADM_lavcodec/i386
	ADM_userInterfaces/ADM_commonUI ADM_video
Message-ID: <200704011418.l31EIAJC032733@sheep.berlios.de>

Author: mean
Date: 2007-04-01 16:18:09 +0200 (Sun, 01 Apr 2007)
New Revision: 2913

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
   branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gtkgui.h
   branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp
   branches/avidemux_2.4_branch/avidemux/guiplay.cpp
Log:
use hw zoom if possible, uncomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-04-01 14:18:09 UTC (rev 2913)
@@ -81,6 +81,7 @@
         cpuid(1, eax, ebx, ecx, std_caps);
         if (std_caps & (1<<23))
             rval |= MM_MMX;
+#if 0	    
         if (std_caps & (1<<25))
             rval |= MM_MMXEXT | MM_SSE;
         if (std_caps & (1<<26))
@@ -89,6 +90,7 @@
             rval |= MM_SSE3;
         if (ecx & 0x00000200 )
             rval |= MM_SSSE3;
+#endif	    
     }
 
     cpuid(0x80000000, max_ext_level, ebx, ecx, edx);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -62,17 +62,56 @@
 static void previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);
 
 static   AVDMGenericVideoStream *preview=NULL;
-static ADMImage *previewImage;
+
 static ADM_PREVIEW_MODE previewMode=ADM_PREVIEW_NONE;
-static uint32_t _mainW=0,_mainH=0;
-static uint32_t _displayW=0,_displayH=0;
-static uint32_t defered_display=0;
-static renderZoom zoom=ZOOM_1_1;
+
+static uint32_t             defered_display=0;  /* When 1, it means we are in playback mode */
+static uint32_t             playbackOffset=0;   /* in playback mode, frame 0 = playbackOffset compared to real beginning of the file */
+static renderZoom           zoom=ZOOM_1_1;
 static ADMImage             *resized=NULL;
 static ADM_MplayerResize    *resizer=NULL;
 static ADMImage             *original=NULL;
-static uint32_t _resizedW=0,_resizedH=0;
+
+/*************************************/
+static ADMImage *rdrImage=NULL; /* Unprocessed image */
+static ADMImage *previewImage;  /* Processed image if any */
+
+static uint32_t  rdrPhysicalW=0;  /* W*H of the INPUT window */
+static uint32_t  rdrPhysicalH=0;
+
+static uint32_t  rdrWindowWUnzoomed=0;  /* W*H of the output window WITHOUT zoom */
+static uint32_t  rdrWindowHUnzoomed=0;
+
+static uint32_t  rdrWindowWZoomed=0;    /* Same but with zoom */
+static uint32_t  rdrWindowHZoomed=0;
+
+static uint32_t  rdrHwZoom=0;           /* Hw can do zoom */
+/*************************************/
+extern ADM_Composer *video_body;
+
 /**
+      \fn admPreview::setMainDimension
+      \brief Update width & height of input video
+      @param w : width
+      @param h : height
+*/
+
+void admPreview::setMainDimension(uint32_t w, uint32_t h)
+{
+  if(rdrImage) delete rdrImage;
+  rdrImage=new ADMImage(w,h);
+  rdrPhysicalW=w;
+  rdrPhysicalH=h;
+  
+  rdrWindowWUnzoomed=w;
+  rdrWindowHUnzoomed=h;
+  
+  renderResize(w,h,w,h);
+  
+}
+
+
+/**
       \fn getPreviewMode
       \brief returns current preview mode
       @return current preview mode
@@ -109,18 +148,20 @@
       \brief Enable or disable defered display
 
 */
-void admPreview::deferDisplay(uint32_t onoff)
+void admPreview::deferDisplay(uint32_t onoff,uint32_t startat)
 {
       
       if(onoff)
       {
         renderStartPlaying();
         defered_display=1;
+        playbackOffset=startat;
       }
       else
       {
         renderStopPlaying();
         defered_display=0;
+        playbackOffset=0;
       }
   
 }
@@ -150,27 +191,27 @@
                   /* no break here, not a mistake */
               case  ADM_PREVIEW_NONE:
               
-                  _displayW=_mainW;
-                  _displayH=_mainH;
+                  rdrWindowWUnzoomed=rdrPhysicalW;
+                  rdrWindowHUnzoomed=rdrPhysicalH;
                   break;
               case  ADM_PREVIEW_OUTPUT:
-                  _displayW=preview->getInfo()->width;
-                  _displayH=preview->getInfo()->height;
+                  rdrWindowWUnzoomed=preview->getInfo()->width;
+                  rdrWindowHUnzoomed=preview->getInfo()->height;
                   break;
               case  ADM_PREVIEW_SIDE:
               {
                   
-                  _displayH=MAX(_mainH,preview->getInfo()->height);
-                  _displayW=_mainW+preview->getInfo()->width;
-                  original=new ADMImage(_displayW,_displayH);
+                  rdrWindowHUnzoomed=MAX(rdrPhysicalH,preview->getInfo()->height);
+                  rdrWindowWUnzoomed=rdrPhysicalW+preview->getInfo()->width;
+                  original=new ADMImage(rdrWindowWUnzoomed,rdrWindowHUnzoomed);
                   break;
               }
               case  ADM_PREVIEW_TOP:
               {
                   
-                  _displayW=MAX(_mainW,preview->getInfo()->width);
-                  _displayH=_mainH+preview->getInfo()->height;
-                  original=new ADMImage(_displayW,_displayH);
+                  rdrWindowWUnzoomed=MAX(rdrPhysicalW,preview->getInfo()->width);
+                  rdrWindowHUnzoomed=rdrPhysicalH+preview->getInfo()->height;
+                  original=new ADMImage(rdrWindowWUnzoomed,rdrWindowHUnzoomed);
                   break;
               }
               default: ADM_assert(0);
@@ -188,19 +229,21 @@
                     default : ADM_assert(0);
     
             }
-            _resizedW=(_displayW*mul+3)/4;
-            _resizedH=(_displayH*mul+3)/4;
+            rdrWindowWZoomed=(rdrWindowWUnzoomed*mul+3)/4;
+            rdrWindowHZoomed=(rdrWindowHUnzoomed*mul+3)/4;
+            
     
-            if(_resizedW&1) _resizedW++;
-            if(_resizedH&1) _resizedH++;
+            if(rdrWindowWZoomed&1) rdrWindowWZoomed++;
+            if(rdrWindowHZoomed&1) rdrWindowHZoomed++;
             ADM_assert(!resized);
-            resized=new ADMImage(_resizedW,_resizedH);
+            resized=new ADMImage(rdrWindowWZoomed,rdrWindowHZoomed);
             ADM_assert(!resizer);
-            resizer=new  ADM_MplayerResize(_displayW,_displayH,_resizedW,_resizedH);
-            renderResize(_resizedW,_resizedH);
+            resizer=new  ADM_MplayerResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWZoomed,rdrWindowHZoomed);
+            renderResize(rdrWindowWZoomed,rdrWindowHZoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
         }else
         {
-             renderResize(_displayW,_displayH);
+             renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
+             rdrHwZoom=0;
         }
 }
 /**
@@ -217,7 +260,7 @@
         ADM_assert(original);
         original=NULL; 
       }
-      renderResize(_mainW,_mainH);
+      renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
       if(previewImage)
       {
         delete  previewImage; 
@@ -271,80 +314,74 @@
 }
 
 /**
-      \fn admPreview::setMainDimension
-      \brief Update width & height of input video
-      @param w : width
-      @param h : height
-*/
-
-void admPreview::setMainDimension(uint32_t w, uint32_t h)
-{
-  _mainW=w;
-  _mainH=h;
-  _displayW=w;
-  _displayH=h;
-  renderResize(w,h);
-  
-}
-/**
       \fn admPreview::update
       \brief display data associated with framenum image
       @param image : current main image (input)
       @param framenum, framenumber
 */
 
-void admPreview::update(uint32_t framenum,ADMImage *image)
+uint8_t admPreview::update(uint32_t framenum)
 {
-    uint32_t fl,len;	
+    uint32_t fl,len,flags;	
 
     switch(previewMode)
     {
       case ADM_PREVIEW_NONE:
-        if(image)
+       {
+        if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
         {
-            if(zoom==ZOOM_1_1 )
+          return 0; 
+        }
+            UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+
+            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
             {
                if(!defered_display) 
-                  renderUpdateImage(image->data);
+                  renderUpdateImage(rdrImage->data,zoom);
             }else
             {
                 ADM_assert(resizer);
                 ADM_assert(resized);
-                resizer->resize(image->data,resized->data);
+                resizer->resize(rdrImage->data,resized->data);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data);
+                  renderUpdateImage(resized->data,zoom);
             }
         }
         break;
       case ADM_PREVIEW_OUTPUT:
             if(framenum<=preview->getInfo()->nb_frames-1)
                   {
-                          if(!preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl)) return;
-                          if(zoom==ZOOM_1_1)
+                          if(!preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl)) return 0;
+                          if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
                           {
-                            if(!defered_display) renderUpdateImage(previewImage->data);
+                            if(!defered_display) renderUpdateImage(previewImage->data,zoom);
                           }
                           else
                           {
                              resizer->resize(previewImage->data,resized->data);
                              if(!defered_display) 
-                                  renderUpdateImage(resized->data);
+                                  renderUpdateImage(resized->data,zoom);
                           }
                   }
             break;
       case ADM_PREVIEW_SEPARATE:
             ADM_assert(preview);
             ADM_assert(previewImage);
-            if(zoom==ZOOM_1_1)
+            if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
             {
-              if(image && !defered_display) renderUpdateImage(image->data);
+              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
+              {
+                  return 0; 
+              }
+              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+              if(!defered_display) renderUpdateImage(rdrImage->data,zoom);
             }else
             {
                 ADM_assert(resizer);
                 ADM_assert(resized);
-                resizer->resize(image->data,resized->data);
+                resizer->resize(rdrImage->data,resized->data);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data);
+                  renderUpdateImage(resized->data,zoom);
             }
           if( GUI_PreviewStillAlive())
           {
@@ -361,21 +398,27 @@
               ADM_assert(previewImage);
               ADM_assert(original);
               
+              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
+              {
+                  return 0; 
+              }
+              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+              previewBlit(rdrImage,original,0,0);
               
-              previewBlit(image,original,0,0);
               if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
               {
-                previewBlit(previewImage,original,_mainW,0);
+                previewBlit(previewImage,original,rdrPhysicalW,0);
               }
-              if(zoom==ZOOM_1_1)
+              else printf("Cannot get frame %u\n",framenum);
+              if(zoom==ZOOM_1_1  || renderHasAccelZoom() )
               {
                 if(!defered_display)
-                  renderUpdateImage(original->data);
+                  renderUpdateImage(original->data,zoom);
               }else
               {
                 resizer->resize(original->data,resized->data);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data);
+                  renderUpdateImage(resized->data,zoom);
               }
               break;
         
@@ -384,20 +427,26 @@
               ADM_assert(previewImage);
               ADM_assert(original);
               
-              previewBlit(image,original,0,0);
+              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
+              {
+                  return 0; 
+              }
+              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+              previewBlit(rdrImage,original,0,0);
               if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
               {
-                previewBlit(previewImage,original,0,_mainH);
+                previewBlit(previewImage,original,0,rdrPhysicalH);
               }
-              if(zoom==ZOOM_1_1)
+              else printf("Cannot get frame %u\n",framenum);
+              if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
               {
                 if(!defered_display)
-                  renderUpdateImage(original->data);
+                  renderUpdateImage(original->data,zoom);
               }else
               {
                 resizer->resize(original->data,resized->data);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data);
+                  renderUpdateImage(resized->data,zoom);
               }
               break;
       default: ADM_assert(0);
@@ -419,40 +468,41 @@
       \brief display on screen immediately
 */
 
-void admPreview::displayNow(uint32_t framenum,ADMImage *image)
+void admPreview::displayNow(uint32_t framenum)
 {
+
     uint32_t fl,len;	
 
     switch(previewMode)
     {
       case ADM_PREVIEW_NONE:
            
-           if(zoom==ZOOM_1_1 )
+           if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
             {
-                renderUpdateImage(image->data);
+                renderUpdateImage(rdrImage->data,zoom);
             }else
             {
                 ADM_assert(resized);
-                renderUpdateImage(resized->data);
+                renderUpdateImage(resized->data,zoom);
             }
         break;
       case ADM_PREVIEW_OUTPUT:
-            if(zoom==ZOOM_1_1 )
+            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
             {
-                renderUpdateImage(previewImage->data);
+                renderUpdateImage(previewImage->data,zoom);
             }else
             {
                 ADM_assert(resized);
-                renderUpdateImage(resized->data);
+                renderUpdateImage(resized->data,zoom);
             }
             break;
       case ADM_PREVIEW_SEPARATE:
-            if(zoom==ZOOM_1_1 )
+            if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
             {
-                renderUpdateImage(image->data);
+                renderUpdateImage(rdrImage->data,zoom);
             }else{
                 ADM_assert(resized);
-                renderUpdateImage(resized->data);
+                renderUpdateImage(resized->data,zoom);
             }
             if( GUI_PreviewStillAlive())
             {
@@ -461,15 +511,16 @@
           break;
       case ADM_PREVIEW_SIDE:
       case ADM_PREVIEW_TOP:
-            if(zoom==ZOOM_1_1)
+            if(zoom==ZOOM_1_1|| renderHasAccelZoom() )
             {
-               renderUpdateImage(original->data);
+               renderUpdateImage(original->data,zoom);
             }else
             {
               ADM_assert(resized);
-              renderUpdateImage(resized->data);
+              renderUpdateImage(resized->data,zoom);
             }
               break;
       default: ADM_assert(0);
     }
+
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h	2007-04-01 14:18:09 UTC (rev 2913)
@@ -17,7 +17,8 @@
                               AccelRender( void) {};
               virtual	uint8_t init(GUI_WindowInfo * window, uint32_t w, uint32_t h)=0;
               virtual	uint8_t end(void)=0;
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h)=0;
+              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom=ZOOM_1_1)=0;
+              virtual uint8_t hasHwZoom(void) {return 0;}
               
 };
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -76,6 +76,7 @@
 static uint8_t		    *lastImage=NULL;
 static void                 *draw=NULL;
 static uint32_t 	     renderW=0,renderH=0;
+static uint32_t              phyW=0,phyH=0; /* Unzoomed size, only used when accel can do hw resize */
 
 //_______________________________________
 /**
@@ -93,7 +94,7 @@
 
 */
 //----------------------------------------
-uint8_t renderResize(uint32_t w, uint32_t h)
+uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
 {
 int mul,xx,yy;
 
@@ -105,6 +106,8 @@
         screenBuffer=new uint8_t[w*h*4];
 
 	updateWindowSize( draw,w,h);
+        phyW=pw;
+        phyH=ph;
 	UI_purge();
 	return 1;
 
@@ -115,51 +118,30 @@
 
 */
 //----------------------------------------
-uint8_t renderUpdateImage(uint8_t *ptr)
+uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom)
 {
-	
-        ADM_assert(screenBuffer);
-        lastImage=ptr;
 
-	if(!accel_mode)
-	 	GUI_ConvertRGB(ptr,screenBuffer, renderW,renderH);
-	renderRefresh();
-	return 1;
+    ADM_assert(screenBuffer);
+    lastImage=ptr;
 
-}
-/**
-      \fn renderUpdateImageBlit
-      \brief Blit the source into destination
-
-*/
-
-uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t h,uint32_t primary)
-{
-
-        ADM_assert(screenBuffer);
-        lastImage=NULL;
-        if(!accel_mode)
+    if(accel_mode)
+    {
+        if(accel_mode ->hasHwZoom())
         {
-                GUI_ConvertRGBBlit(ptr,screenBuffer, renderW,renderH,startx,starty,w,h,primary);
-                if(primary) renderRefresh();
+           accel_mode->display(lastImage, phyW, phyH,zoom);
+        }else
+        {
+          accel_mode->display(lastImage, renderW, renderH,zoom);
         }
-        else
-        { /* Accel mode, in that case we need to blit our part of the image inside the big image
-              It is assumed the accel render part can work with YV12
-          */
-          /* Luma */
-          uint32_t pageR=(renderW*renderH);
-          uint32_t pageS=(w*h);
-          BitBlit(accelSurface+startx+starty*renderW,renderW,ptr,w,w,h);
-          BitBlit(accelSurface+pageR+(startx>>1)+(starty>>1)*(renderW>>1),renderW>>1,ptr+pageS,w>>1,w>>1,h>>1);
-          BitBlit(accelSurface+(pageR*5)/4+(startx>>1)+(starty>>1)*(renderW>>1),renderW>>1,ptr+(pageS*5)/4,w>>1,w>>1,h>>1);
+      
+    }else
+    {
+      GUI_ConvertRGB(ptr,screenBuffer, renderW,renderH);
+      renderRefresh();
+    }
+  return 1;
 
-          lastImage=accelSurface;
-          if(primary) renderRefresh();
-        }
-        return 1;
 }
-
 /**
 	Refresh the image from internal buffer / last image
 	Used for example as call back for X11 events
@@ -208,6 +190,7 @@
 char *displ;
 unsigned int renderI;
 ADM_RENDER_TYPE render;
+uint8_t r=0;
 	ADM_assert(!accel_mode);
 	// First check if local
 	// We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
@@ -242,7 +225,9 @@
 #if defined(USE_XV)
 	       case RENDER_XV:
 		accel_mode=new XvAccelRender();
-		if(!accel_mode->init(&xinfo,renderW,renderH))
+                if(accel_mode->hasHwZoom()) r=accel_mode->init(&xinfo,phyW,phyH);
+                else r=accel_mode->init(&xinfo,renderW,renderH);
+                if(!r)
 		{
 			delete accel_mode;
 			accel_mode=NULL;
@@ -258,7 +243,9 @@
               case RENDER_SDL:
 		printf("Trying SDL\n");
 		accel_mode=new sdlAccelRender();
-		if(!accel_mode->init(&xinfo,renderW,renderH))
+		if(accel_mode->hasHwZoom()) r=accel_mode->init(&xinfo,phyW,phyH);
+                else r=accel_mode->init(&xinfo,renderW,renderH);
+                if(!r)
 		{
 			delete accel_mode;
 			accel_mode=NULL;
@@ -286,8 +273,16 @@
 	
 	return 1;
 }
+/**
+      \fn renderHasAccelZoom
+      \brief returns 1 if accel can do hw zoom
+*/
+uint8_t renderHasAccelZoom(void)
+{
+    if(!accel_mode) return 0;
+    return accel_mode->hasHwZoom(); 
+}
 
-
 uint8_t renderStopPlaying( void )
 {
 	if(accel_mode)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2007-04-01 14:18:09 UTC (rev 2913)
@@ -49,18 +49,18 @@
 
 ADM_PREVIEW_MODE getPreviewMode(void);
 void             setPreviewMode(ADM_PREVIEW_MODE preview);
-void changePreviewZoom(renderZoom nzoom);
+void             changePreviewZoom(renderZoom nzoom);
 
 class admPreview
 {
   public:
-      static void update(uint32_t framenum,ADMImage *image);
+      static uint8_t update(uint32_t framenum);
       static void start(void);
       static void stop(void);
       static void setMainDimension(uint32_t, uint32_t );
       static void updateFilters(AVDMGenericVideoStream *first,AVDMGenericVideoStream *last);
-      static void deferDisplay(uint32_t onoff);
-      static void displayNow(uint32_t framenum,ADMImage *image);
+      static void deferDisplay(uint32_t onoff,uint32_t startat);
+      static void displayNow(uint32_t framenum);
   
 };
 
@@ -69,16 +69,16 @@
 
 
 uint8_t renderInit( void );
-uint8_t renderResize(uint32_t w, uint32_t h);
+uint8_t renderResize(uint32_t w, uint32_t h,uint32_t phyW,uint32_t phyH);
 uint8_t renderRefresh(void);
 uint8_t renderExpose(void);
-uint8_t renderUpdateImage(uint8_t *ptr);
+uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom);
 uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t,uint32_t primary);
 
 uint8_t renderStartPlaying( void );
 uint8_t renderStopPlaying( void );
+uint8_t renderHasAccelZoom(void);
 
-
 void *UI_getDrawWidget(void);
 void UI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
 void UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -178,7 +178,7 @@
         dst+=stride;          
     }   
 }
-uint8_t sdlAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h)
+uint8_t sdlAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
 {
 int pitch;
 int page=w*h;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2007-04-01 14:18:09 UTC (rev 2913)
@@ -23,7 +23,7 @@
                                 sdlAccelRender( void ) ;
               virtual	uint8_t init( GUI_WindowInfo * window, uint32_t w, uint32_t h);
               virtual	uint8_t end(void);
-              virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h);
+              virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
 };
 
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -49,7 +49,7 @@
 static uint8_t 	GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt);
 static uint8_t 	GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h);
 static void 	GUI_XvEnd( void );
-static uint8_t 	GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h);
+static uint8_t 	GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom);
 static uint8_t 	GUI_XvSync(void);
 
 static uint8_t getAtom(char *string);
@@ -70,9 +70,9 @@
 	 return 1;
 }
 
-uint8_t XvAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h)
+uint8_t XvAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
 {
-	return GUI_XvDisplay(ptr, w, h);
+	return GUI_XvDisplay(ptr, w, h,zoom);
 }
 //________________Wrapper around Xv_______________
 
@@ -110,9 +110,9 @@
 }
 
 //------------------------------------
-uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h)
+uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom)
 {
-
+    uint32_t destW,destH;
     if (xvimage)
       {
 
@@ -122,11 +122,24 @@
 	  // total 1.5*
          XLockDisplay (xv_display);
 	  memcpy(xvimage->data, src, (w*h*3)>>1);
-	
+          uint32_t factor=4;
+        switch(zoom)
+        {
+            case ZOOM_1_4: factor=1;break;
+            case ZOOM_1_2: factor=2;break;
+            case ZOOM_1_1: factor=4;break;
+            case ZOOM_2:   factor=8;break;
+            case ZOOM_4:   factor=16;break;
+            default : ADM_assert(0);
+          
+        }
+	destW=(w*factor)/4;
+        destH=(h*factor)/4;
+        //printf("%u x %u => %u x %u\n",w,h,destW,destH);
         // And display it !
 #if 1
 	  XvShmPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
-			0, 0, w, h,	// dst
+			0, 0, destW, destH,	// dst
 			False);
 #else
 	 XvPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h	2007-04-01 14:18:09 UTC (rev 2913)
@@ -23,7 +23,8 @@
                               XvAccelRender( void ) ;
               virtual	uint8_t init( GUI_WindowInfo *  window, uint32_t w, uint32_t h);
               virtual	uint8_t end(void);				
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h);
+              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
+                      uint8_t hasHwZoom(void) {return 1;}
 };
 #endif
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -48,7 +48,7 @@
 #define LOOKUP 4
 #define CACHE_SIZE (LOOKUP*2+3)
 
-extern uint8_t Util_saveJpg (char *name,uint32_t w, uint32_t,ADMImage *image);
+
 extern uint8_t DIA_animated(ANIMATED_PARAM *param);
 
 uint8_t ADMVideoAnimated::configure(AVDMGenericVideoStream *in)

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -139,7 +139,7 @@
 uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss);
 //__________
 extern uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss);
-extern uint8_t GUI_getFrame(uint32_t frameno, ADMImage *image, uint32_t *flags);
+extern uint8_t GUI_getFrame(uint32_t frameno,  uint32_t *flags);
 extern int A_SaveUnpackedVop(const char *name);
 extern int A_SavePackedVop(const char *name);
 extern void      videoCodecConfigureUI(void);
@@ -166,7 +166,6 @@
 extern const char * GUI_getCustomScript(uint32_t nb);
 extern gboolean SliderIsShifted;
 
-ADMImage *rdr_decomp_buffer=NULL;
 
 
 
@@ -462,7 +461,7 @@
         case ACT_ZOOM_4_1:
                 currentZoom=(renderZoom)((action-ACT_ZOOM_1_4)+ZOOM_1_4);
                 changePreviewZoom(currentZoom);
-                admPreview::update(curframe,rdr_decomp_buffer);
+                admPreview::update(curframe);
                 break;
 
 
@@ -642,7 +641,7 @@
             admPreview::stop();
             setPreviewMode(newpreview);
             admPreview::start();
-            admPreview::update(curframe,rdr_decomp_buffer);
+            admPreview::update(curframe);
       }
       break;
     case ACT_StopAvi:
@@ -893,7 +892,7 @@
       if (getPreviewMode()!=ADM_PREVIEW_NONE)
       {
          admPreview::start();
-         admPreview::update (curframe,rdr_decomp_buffer);
+         admPreview::update (curframe);
       }
       break;
 
@@ -983,12 +982,6 @@
       filterCleanUp ();
 
 
-      if (rdr_decomp_buffer)
-	{
-	  delete  rdr_decomp_buffer;
-	  rdr_decomp_buffer = NULL;
-	}
-
     }
   DIA_StartBusy ();
   /*
@@ -1106,8 +1099,8 @@
 
   curframe = 0;
   getFirstVideoFilter(); // reinit first filter
-  ADM_assert (rdr_decomp_buffer =new ADMImage(avifileinfo->width,avifileinfo->height));
 
+
   //frameStart = 0;
   //frameEnd = avifileinfo->nb_frames - 1;
   video_body->getMarkers(&frameStart,&frameEnd);
@@ -1186,15 +1179,8 @@
         
   
   
-  if(!GUI_getFrame( curframe, rdr_decomp_buffer,NULL))
-  {
-    GUI_Error_HIG (_("Could not decode the frame"), NULL);
-    }
-  else
-    {
-      admPreview::update (curframe,rdr_decomp_buffer);
-      update_status_bar(rdr_decomp_buffer);
-    }
+      admPreview::update (curframe);
+      update_status_bar();
    
    printf("\n** conf updated **\n");
 }
@@ -1367,7 +1353,14 @@
 ________________________________________________________*/
 int A_saveJpg (char *name)
 {
-    return (int) Util_saveJpg (name,avifileinfo->width, avifileinfo->height,rdr_decomp_buffer);
+  uint8_t fl;
+    ADMImage image(avifileinfo->width, avifileinfo->height);
+    if(!GUI_getFrameContent(&image, curframe))
+    {
+      GUI_Error_HIG(_("Get Frame"),_("Cannot get this frame to save"));
+      return 0; 
+    }
+    return (int) Util_saveJpg (name,avifileinfo->width, avifileinfo->height,NULL);
 }
 #else
 
@@ -1457,7 +1450,7 @@
 	for(curImg=frameStart;curImg<=frameEnd;curImg++)
 	{	
                 working->update(curImg-frameStart,frameEnd-frameStart);	
-		if (!GUI_getFrame (curImg, src,NULL))
+		if (!GUI_getFrameContent (src,curImg ))
 		{
                   GUI_Error_HIG(_("Cannot decode frame"), _("Aborting."));
 			goto _bunch_abort;
@@ -1530,8 +1523,9 @@
 	bmph.colorEncoding=0;
 */
 
+  ADMImage image(avifileinfo->width,avifileinfo->height);
+  GUI_getFrameContent(&image, curframe);
 
-
   printf ("\n %u x %u=%u\n", bmph.biWidth, bmph.biHeight, sz);
 
   uint8_t *out;
@@ -1543,7 +1537,7 @@
 		return;
 	}
 
-	 if(!COL_yv12rgbBMP(bmph.biWidth, bmph.biHeight,rdr_decomp_buffer->data, out))
+	 if(!COL_yv12rgbBMP(bmph.biWidth, bmph.biHeight,image.data, out))
 	 {
            GUI_Error_HIG(_("Error converting to BMP"), NULL);
 		return;
@@ -2131,7 +2125,7 @@
   {
 	work->update(i, nb);
       	if(!work->isAlive()) break;
-	if(!GUI_getFrame (i, aImage,NULL))
+	if(!GUI_getFrameContent (aImage,i))
 	{
 		error ++;
 		printf("Frame %u has error\n",i);
@@ -2519,7 +2513,7 @@
 /// Update all  informations : current frame # and current time, total frame ...
 ///_____________________________________________________________
 
-void  update_status_bar(ADMImage *frame)
+void  update_status_bar(void)
 {
     char text[80];
     double len;
@@ -2530,8 +2524,7 @@
  
 	UI_updateFrameCount( curframe);
 	UI_updateTimeCount( curframe,avifileinfo->fps1000);
-        if(frame)
-	       UI_setFrameType(  frame->flags,frame->_Qp);
+       
     // progress bar
     len = 100;
     if(avifileinfo->nb_frames>1)
@@ -2570,6 +2563,15 @@
      UI_setScale(len);
 }
 
+/**
+      \fn GUI_getFrameContent
+      \brief fill image with content of frame frame
+*/
+uint8_t GUI_getFrameContent(ADMImage *image, uint32_t frame)
+{
+  uint32_t flags;
+  if(!video_body->getUncompressedFrame(frame,image,&flags)) return 0;
+  return 1; 
+}
 
-
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/gtkgui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtkgui.h	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/gtkgui.h	2007-04-01 14:18:09 UTC (rev 2913)
@@ -20,7 +20,7 @@
 void 			A_saveAudioDecoded	(char *name);
 void 			A_saveAVI		(char *name);
 void 			A_playAvi		(void);
-void 			update_status_bar(ADMImage *image );
+void 			update_status_bar(void );
 void 			rebuild_status_bar(void );
 
 
@@ -35,13 +35,7 @@
 void GUI_detransient(void );
 void GUI_retransient(void );
 
-typedef enum pipID
-{
-	P_TOOLAME,
-	P_LAME,
-	P_OTHER
-};
- void A_Pipe(pipID who,char *file=NULL );
+uint8_t GUI_getFrameContent(ADMImage *image, uint32_t frame);
 
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -45,19 +45,18 @@
 #include "ADM_filter/video_filters.h"
     
 extern void    UI_purge(void );
-extern ADMImage *rdr_decomp_buffer;
 //____________________________________
 
-uint8_t GUI_getFrame(uint32_t frameno, ADMImage *image, uint32_t *flags)
+uint8_t GUI_getFrame(uint32_t frameno,  uint32_t *flags)
 {
 uint32_t len;
 
 	//return video_body->getUncompressedFrame(frameno,image,flags);
 	AVDMGenericVideoStream *filter=getFirstCurrentVideoFilter( );
 	ADM_assert(filter);
-	return filter->getFrameNumberNoAlloc(frameno,&len,image,flags);
-	
+	return 1;
 
+
 }
 void GUI_NextFrame(void)
 {
@@ -71,15 +70,15 @@
 
     if (avifileinfo)
       {
-        if( !GUI_getFrame(curframe + 1,rdr_decomp_buffer,&flags))
+        if( !GUI_getFrame(curframe + 1,&flags))
         	{
                   GUI_Error_HIG(_("Decompressing error"),_( "Cannot decode next frame."));
            	}
            else
             {
                   curframe++;
-                  admPreview::update( curframe,rdr_decomp_buffer) ;
-                  update_status_bar(rdr_decomp_buffer);
+                  admPreview::update( curframe) ;
+                  update_status_bar();
   
                 UI_purge();
             }
@@ -109,13 +108,13 @@
 		else
 		{
                         curframe=f;
-                        if( !GUI_getFrame(curframe,rdr_decomp_buffer,&flags))
+                        if( !GUI_getFrame(curframe,&flags))
                         {
                           GUI_Error_HIG(_("Decompressing error"),_( "Cannot decode keyframe."));
                         }
                         
-                        admPreview::update( curframe,rdr_decomp_buffer) ;
-                        update_status_bar(rdr_decomp_buffer);
+                        admPreview::update( curframe) ;
+                        update_status_bar();
                         UI_purge();
 		}
 		
@@ -133,6 +132,11 @@
     uint32_t sz = width * height ;
     const int maxnonb=(width* height)>>8;
 
+    return 0;
+#warning FIXME
+#warning FIXME
+#warning FIXME
+#if 0
     uint8_t *buff;
 
     int cnt4=0;
@@ -146,7 +150,7 @@
 	if(cnt4>=maxnonb)
 	  return(1);
     }
-
+#endif
     return(0);
 }
 //**********************************************************************
@@ -160,8 +164,11 @@
 static int sliceScanNotBlack(int darkness, int maxnonb, int sliceNum)
 {
 
-{
-
+  return 0;
+#warning FIXME
+#warning FIXME
+#warning FIXME
+#if 0
     uint32_t width = avifileinfo->width;
     uint32_t height = avifileinfo->height>>3;
     uint32_t sz = width * height ;    
@@ -184,7 +191,7 @@
     }
     //printf("Slice : %d count:%d max:%d\n",sliceNum,cnt4,maxnonb);
     return(0);
-}
+#endif
 
 }
 uint8_t  fastIsNotBlack(int darkness)
@@ -218,7 +225,7 @@
    uint16_t reresh_count=0;
    uint32_t orgFrame;
    uint32_t r=1; 
-
+#if 0
     if (playing)
 		return;
     if (! avifileinfo)
@@ -266,9 +273,12 @@
     update_status_bar(rdr_decomp_buffer);
 
    return ;
+#endif
 }
 uint8_t A_ListAllBlackFrames(char *name)
 {
+  return 0;
+#if 0
 // Print a list of all black frames
 //_____________________________________________________________
     uint32_t f;
@@ -339,6 +349,7 @@
      update_status_bar(rdr_decomp_buffer);
 
     return 1;
+#endif
 }
 //**********************************************************************
 
@@ -373,15 +384,15 @@
               return 0;
     
 
-      if( !GUI_getFrame(frame ,rdr_decomp_buffer,&flags))
+      if( !GUI_getFrame(frame ,&flags))
       {
         GUI_Error_HIG(_("Decompressing error"),_( "Cannot decode the frame."));
               return 0;
       }
 
       curframe = frame;
-      admPreview::update( curframe,rdr_decomp_buffer) ;
-      update_status_bar(rdr_decomp_buffer);
+      admPreview::update( curframe) ;
+      update_status_bar();
       UI_purge();
       
       return 1;
@@ -409,14 +420,14 @@
             else
             {
                     curframe=f;
-                    if( !GUI_getFrame(curframe,rdr_decomp_buffer,&flags))
+                    if( !GUI_getFrame(curframe,&flags))
                     {
                       GUI_Error_HIG(_("Decompressing error"),_( "Cannot decode keyframe."));
                     }
                     
-                    admPreview::update( curframe,rdr_decomp_buffer) ;
+                    admPreview::update( curframe) ;
 
-                    update_status_bar(rdr_decomp_buffer);
+                    update_status_bar();
                     UI_purge();
             }
               

Modified: branches/avidemux_2.4_branch/avidemux/guiplay.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/guiplay.cpp	2007-03-30 16:35:56 UTC (rev 2912)
+++ branches/avidemux_2.4_branch/avidemux/guiplay.cpp	2007-04-01 14:18:09 UTC (rev 2913)
@@ -60,9 +60,9 @@
 
 #define EVEN(x) (x&0xffffffe)
 
- extern ADMImage *rdr_decomp_buffer;
+ 
 
- extern uint8_t GUI_getFrame(uint32_t frameno, ADMImage *image, uint32_t *flags);
+ extern uint8_t GUI_getFrame(uint32_t frameno,  uint32_t *flags);
 //___________________________________
 uint8_t stop_req;
 static int called = 0;
@@ -87,7 +87,6 @@
 
     uint32_t framelen,flags;
     AVDMGenericVideoStream *filter;
-    ADMImage *buffer=NULL;
 
     vids = 0, auds = 0, dauds = 0;
     // check we got everything...
@@ -124,17 +123,10 @@
     one_frame = (uint32_t) floor(1000.*1000.*10. / filter->getInfo()->fps1000);
     err = one_frame % 10;
     one_frame /= 10; // Duration of a frame in ms, err =leftover in 1/10 ms
-    buffer=new ADMImage(filter->getInfo()->width,filter->getInfo()->height);
+    
     // go to RealTime...    
     printf(" One frame : %lu, err=%lu ms\n", one_frame, err);
-    // read frame in chunk
-    if(!filter->getFrameNumberNoAlloc(1,&framelen,buffer,&flags))
-    {
-        printf("\n cannot read frame!\n");
-        goto abort_play;
-    }
-      curframe++;
-      played_frame++;
+    
     // prepare 1st frame
 
     stop_req = 0;
@@ -148,13 +140,13 @@
      //renderStartPlaying();
 // reset timer reference
     resetTime();
-    admPreview::deferDisplay(1);
-    admPreview::update(played_frame,buffer);
+    admPreview::deferDisplay(1,curframe);
+    admPreview::update(played_frame);
     do
     {
         vids++;
-        admPreview::displayNow(played_frame,buffer);;
-        update_status_bar(buffer);
+        admPreview::displayNow(played_frame);;
+        update_status_bar();
         if (time_a == 0)
             time_a = getTime(0);
         // mark !
@@ -166,12 +158,8 @@
             printf("\n End met (%lu  / %lu )\n",played_frame,max);
             goto abort_play;
          }
-        if(!filter->getFrameNumberNoAlloc(played_frame+1,&framelen,buffer,&flags))
-        {
-            printf("\n cannot read frame!\n");
-            goto abort_play;
-        }
-        admPreview::update(played_frame+1,buffer);;
+        
+        admPreview::update(played_frame+1);;
 	curframe++;
 	played_frame++;
 
@@ -222,13 +210,13 @@
     // go back to normal display mode
     //____________________________________
     playing = 0;
-	  delete  buffer;
+    uint32_t f;
           
 	   getFirstVideoFilter( );
-	   GUI_getFrame(curframe, rdr_decomp_buffer, &flags);
-           admPreview::deferDisplay(0);
+	   GUI_getFrame(curframe,&f);
+           admPreview::deferDisplay(0,0);
            // Updated by expose ? admPreview::update(curframe,rdr_decomp_buffer);
-     	   update_status_bar(rdr_decomp_buffer);
+     	   update_status_bar();
 #ifdef HAVE_AUDIO
     if (currentaudiostream)
       {



From mean at mail.berlios.de  Sun Apr  1 19:02:19 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 1 Apr 2007 19:02:19 +0200
Subject: [Avidemux-svn-commit] r2914 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386
Message-ID: <200704011702.l31H2J76023358@sheep.berlios.de>

Author: mean
Date: 2007-04-01 19:02:18 +0200 (Sun, 01 Apr 2007)
New Revision: 2914

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
Log:
re-enable sse for non valgrind build

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-04-01 14:18:09 UTC (rev 2913)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-04-01 17:02:18 UTC (rev 2914)
@@ -81,7 +81,7 @@
         cpuid(1, eax, ebx, ecx, std_caps);
         if (std_caps & (1<<23))
             rval |= MM_MMX;
-#if 0	    
+#if 1	    
         if (std_caps & (1<<25))
             rval |= MM_MMXEXT | MM_SSE;
         if (std_caps & (1<<26))



From mean at mail.berlios.de  Sun Apr  1 19:03:14 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 1 Apr 2007 19:03:14 +0200
Subject: [Avidemux-svn-commit] r2915 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
Message-ID: <200704011703.l31H3ETk024804@sheep.berlios.de>

Author: mean
Date: 2007-04-01 19:03:11 +0200 (Sun, 01 Apr 2007)
New Revision: 2915

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
Log:
update still incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-04-01 17:03:11 UTC (rev 2915)
@@ -69,7 +69,7 @@
 static uint32_t             playbackOffset=0;   /* in playback mode, frame 0 = playbackOffset compared to real beginning of the file */
 static renderZoom           zoom=ZOOM_1_1;
 static ADMImage             *resized=NULL;
-static ADM_MplayerResize    *resizer=NULL;
+static ADMImageResizer      *resizer=NULL;
 static ADMImage             *original=NULL;
 
 /*************************************/
@@ -85,7 +85,7 @@
 static uint32_t  rdrWindowWZoomed=0;    /* Same but with zoom */
 static uint32_t  rdrWindowHZoomed=0;
 
-static uint32_t  rdrHwZoom=0;           /* Hw can do zoom */
+
 /*************************************/
 extern ADM_Composer *video_body;
 
@@ -103,8 +103,8 @@
   rdrPhysicalW=w;
   rdrPhysicalH=h;
   
-  rdrWindowWUnzoomed=w;
-  rdrWindowHUnzoomed=h;
+  rdrWindowWZoomed=rdrWindowWUnzoomed=w;
+  rdrWindowHZoomed=rdrWindowHUnzoomed=h;
   
   renderResize(w,h,w,h);
   
@@ -145,7 +145,7 @@
 }
 /**
       \fn deferDisplay
-      \brief Enable or disable defered display
+      \brief Enable or disable defered display. Used by playback mode to have smooth output
 
 */
 void admPreview::deferDisplay(uint32_t onoff,uint32_t startat)
@@ -167,13 +167,14 @@
 }
 /**
       \fn admPreview::start
-      \brief start preview
+      \brief start preview, reiginite preview with new parameters
 
 */
 
 void 	admPreview::start( void )
 {
             aprintf("--killing\n");
+            renderLock();
             getFirstVideoFilter();
             
             preview=videofilters[  nb_active_filter-1].filter;
@@ -200,9 +201,8 @@
                   break;
               case  ADM_PREVIEW_SIDE:
               {
-                  
+                  rdrWindowWUnzoomed=rdrPhysicalW+preview->getInfo()->width;
                   rdrWindowHUnzoomed=MAX(rdrPhysicalH,preview->getInfo()->height);
-                  rdrWindowWUnzoomed=rdrPhysicalW+preview->getInfo()->width;
                   original=new ADMImage(rdrWindowWUnzoomed,rdrWindowHUnzoomed);
                   break;
               }
@@ -238,26 +238,28 @@
             ADM_assert(!resized);
             resized=new ADMImage(rdrWindowWZoomed,rdrWindowHZoomed);
             ADM_assert(!resizer);
-            resizer=new  ADM_MplayerResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWZoomed,rdrWindowHZoomed);
+            resizer=new  ADMImageResizer(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWZoomed,rdrWindowHZoomed);
             renderResize(rdrWindowWZoomed,rdrWindowHZoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
         }else
         {
              renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-             rdrHwZoom=0;
         }
+        renderUnlock();
 }
 /**
       \fn admPreview::stop
-      \brief kill preview window and associated datas
+      \brief kill preview  and associated datas
 */
 
 void admPreview::stop( void )
 {
+  renderLock();
       if(previewMode==ADM_PREVIEW_SEPARATE)
                 GUI_PreviewEnd();
       if(  previewMode==ADM_PREVIEW_SIDE || previewMode==ADM_PREVIEW_TOP)
       {
         ADM_assert(original);
+        delete original;
         original=NULL; 
       }
       renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
@@ -275,6 +277,7 @@
           resized=NULL;
           resizer=NULL;
       }
+  renderUnlock();
 }
 /**
       \fn admPreview::updateFilters
@@ -342,9 +345,9 @@
             {
                 ADM_assert(resizer);
                 ADM_assert(resized);
-                resizer->resize(rdrImage->data,resized->data);
+                resizer->resize(rdrImage,resized);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data,zoom);
+                  renderUpdateImage(resized->data,ZOOM_1_1);
             }
         }
         break;
@@ -358,9 +361,9 @@
                           }
                           else
                           {
-                             resizer->resize(previewImage->data,resized->data);
+                             resizer->resize(previewImage,resized);
                              if(!defered_display) 
-                                  renderUpdateImage(resized->data,zoom);
+                                  renderUpdateImage(resized->data,ZOOM_1_1);
                           }
                   }
             break;
@@ -379,7 +382,7 @@
             {
                 ADM_assert(resizer);
                 ADM_assert(resized);
-                resizer->resize(rdrImage->data,resized->data);
+                resizer->resize(rdrImage,resized);
                 if(!defered_display) 
                   renderUpdateImage(resized->data,zoom);
             }
@@ -416,9 +419,9 @@
                   renderUpdateImage(original->data,zoom);
               }else
               {
-                resizer->resize(original->data,resized->data);
+                resizer->resize(original,resized);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data,zoom);
+                  renderUpdateImage(resized->data,ZOOM_1_1);
               }
               break;
         
@@ -444,9 +447,9 @@
                   renderUpdateImage(original->data,zoom);
               }else
               {
-                resizer->resize(original->data,resized->data);
+                resizer->resize(original,resized);
                 if(!defered_display) 
-                  renderUpdateImage(resized->data,zoom);
+                  renderUpdateImage(resized->data,ZOOM_1_1);
               }
               break;
       default: ADM_assert(0);
@@ -464,15 +467,15 @@
   
 }
 /**
-      \fn displayNow
-      \brief display on screen immediately
+      \fn     displayNow
+      \brief  display on screen immediately. The image has been calculated previously by update
 */
 
 void admPreview::displayNow(uint32_t framenum)
 {
 
     uint32_t fl,len;	
-
+    
     switch(previewMode)
     {
       case ADM_PREVIEW_NONE:
@@ -522,5 +525,6 @@
               break;
       default: ADM_assert(0);
     }
+}
 
-}
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-04-01 17:03:11 UTC (rev 2915)
@@ -532,11 +532,8 @@
 UNUSED_ARG(widget);
 UNUSED_ARG(event);
 UNUSED_ARG(user_data);
-	
-		//renderRefresh();
-		renderExpose();
-		
-    	return true;
+        renderExpose();
+        return true;
 }
 
 ///

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-04-01 17:03:11 UTC (rev 2915)
@@ -58,7 +58,6 @@
 
 extern GtkWidget *getDrawWidget( void );
  ColYuvRgb rgbConverter(640,480);
- ColYuvRgb rgbConverter2(640,480);
 
 /**
     \brief return pointer to the drawing widget that displays video

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-04-01 17:03:11 UTC (rev 2915)
@@ -58,7 +58,6 @@
 static uint8_t *lastImage=NULL;
 
  ColYuvRgb rgbConverter(640,480,1);
- ColYuvRgb rgbConverter2(640,480,1);
 
 //****************************************************************************************************
 void GUI_PreviewInit(uint32_t w , uint32_t h, uint32_t modal)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-04-01 17:03:11 UTC (rev 2915)
@@ -24,16 +24,12 @@
 #include <math.h>
 #include <unistd.h>
 #include <string.h>
-
-
 #include <sys/time.h>
 
-
 #include <../ADM_assert.h>
 
 #include "default.h"
 
-
 #include "ADM_commonUI/GUI_render.h"
 
 #include "ADM_commonUI/GUI_accelRender.h"
@@ -50,23 +46,17 @@
 
 
 extern uint8_t BitBlit(uint8_t *dst, uint32_t pitchDest,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height);
+
 extern void UI_purge(void);
+extern uint8_t UI_shrink(uint32_t w,uint32_t h);
 
-
 static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
-void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
 static uint8_t  GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h);
-static uint8_t  GUI_ConvertRGBBlit(uint8_t * in, uint8_t * out,uint32_t totalW,uint32_t totalH, 
-                                  uint32_t startx,uint32_t starty,uint32_t w, uint32_t h,uint32_t primary);
 
+void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
 
-extern uint8_t UI_shrink(uint32_t w,uint32_t h);
 //_____________________________________
-
-
-extern ColYuvRgb rgbConverter;
-extern ColYuvRgb rgbConverter2;
-
+extern ColYuvRgb rgbConverter; // Declared in UI_xxx as it is not the same between GTK and QT (RGB vs BGR or whatever)
 //_____________________________________
 static AccelRender    *accel_mode=NULL;
 static uint8_t        *accelSurface=NULL;
@@ -75,9 +65,10 @@
 static uint8_t 	            *screenBuffer=NULL;
 static uint8_t		    *lastImage=NULL;
 static void                 *draw=NULL;
-static uint32_t 	     renderW=0,renderH=0;
+static uint32_t 	     renderW=0,renderH=0; /* Zoomed/display size */
 static uint32_t              phyW=0,phyH=0; /* Unzoomed size, only used when accel can do hw resize */
-
+static renderZoom            lastZoom;
+static uint8_t               _lock=0;
 //_______________________________________
 /**
 	Render init, initialize internals. Constuctor like function
@@ -88,6 +79,20 @@
 	draw=UI_getDrawWidget(  );
 	return 1;
 }
+/**
+    \fn renderLock
+    \brief Take the weak lock (i.e. not threadsafe)
+*/
+uint8_t renderLock(void)
+{
+  ADM_assert(!_lock);
+  _lock=1; 
+}
+uint8_t renderUnlock(void)
+{
+  ADM_assert(_lock);
+  _lock=0; 
+}
 
 /**
 	Warn the renderer that the display size is changing
@@ -97,20 +102,18 @@
 uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
 {
 int mul,xx,yy;
-
 	if(screenBuffer) 
-		{
-			delete  [] screenBuffer;
-			screenBuffer=NULL;
-		}
+        {
+                delete  [] screenBuffer;
+                screenBuffer=NULL;
+        }
         screenBuffer=new uint8_t[w*h*4];
-
-	updateWindowSize( draw,w,h);
         phyW=pw;
         phyH=ph;
-	UI_purge();
-	return 1;
-
+  
+        updateWindowSize( draw,w,h);
+        UI_purge();
+        return 1;
 }
 /**
 	Update the image and render it
@@ -123,9 +126,10 @@
 
     ADM_assert(screenBuffer);
     lastImage=ptr;
-
+    ADM_assert(!_lock);
     if(accel_mode)
     {
+        lastZoom=zoom;
         if(accel_mode ->hasHwZoom())
         {
            accel_mode->display(lastImage, phyW, phyH,zoom);
@@ -150,6 +154,7 @@
 //_______________________________________________
 uint8_t renderRefresh(void)
 {
+      if(_lock) return 1;
       if(!screenBuffer)
       {
               if(accel_mode) ADM_assert(0);
@@ -159,7 +164,13 @@
       if(accel_mode)
       {
           if(lastImage)
-              accel_mode->display(lastImage, renderW, renderH);
+               if(accel_mode ->hasHwZoom())
+                {
+                  accel_mode->display(lastImage, phyW, phyH,lastZoom);
+                }else
+                {
+                  accel_mode->display(lastImage, renderW, renderH,lastZoom);
+                }
       }
       else
               GUI_RGBDisplay(screenBuffer, renderW, renderH,draw);
@@ -168,22 +179,7 @@
 
 uint8_t renderExpose(void)
 {
-	if(!screenBuffer)
-	{
-		if(accel_mode) ADM_assert(0);
-		return 0;
-	}
-
-
-    if ( accel_mode)
-    {	
-        if(lastImage)
-		accel_mode->display(lastImage,renderW,renderH);
-    }
-    else
-	GUI_RGBDisplay(screenBuffer, renderW, renderH,draw);
-    return 1;
-
+    renderRefresh();
 }
 uint8_t renderStartPlaying( void )
 {
@@ -192,6 +188,7 @@
 ADM_RENDER_TYPE render;
 uint8_t r=0;
 	ADM_assert(!accel_mode);
+        
 	// First check if local
 	// We do it in a very wrong way : If DISPLAY!=:0.0 we assume remote display
 	// in that case we do not even try to use accel
@@ -285,16 +282,18 @@
 
 uint8_t renderStopPlaying( void )
 {
-	if(accel_mode)
-	{
-		accel_mode->end();
-		delete accel_mode;
-                if(accelSurface) delete [] accelSurface;
-                accelSurface=NULL;
-				
-	}
-	accel_mode=NULL;	
-	return 1;
+      
+      if(accel_mode)
+      {
+              accel_mode->end();
+              delete accel_mode;
+              if(accelSurface) delete [] accelSurface;
+              accelSurface=NULL;
+                              
+      }
+      accel_mode=NULL;	
+      
+      return 1;
 }
 
 
@@ -308,7 +307,6 @@
     renderH = h;
 
     UI_updateDrawWindowSize(win,w,h);
-    //gtk_widget_set_usize(win, w, h);
     rgbConverter.reset(w,h);
     return 1;
 }
@@ -319,25 +317,9 @@
     rgbConverter.scale(in,out);
     return 1;
 }
-uint8_t GUI_ConvertRGBBlit(uint8_t * in, uint8_t * out,uint32_t totalW,uint32_t totalH, uint32_t startx,uint32_t starty,uint32_t w, uint32_t h,uint32_t primary)
-{
-  if(!primary)
-  {
-    rgbConverter.reset(w,h);
-    rgbConverter.scale(in,out,startx,starty,w,h,renderW,renderH);
-  }else
-  {
-    rgbConverter2.reset(w,h);
-    rgbConverter2.scale(in,out,startx,starty,w,h,renderW,renderH);
-  }
-    return 1;
-}
-
-
-
 void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg)
 {
     
     UI_rgbDraw(widg,w,h,dis);
-
 }
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2007-04-01 17:02:18 UTC (rev 2914)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h	2007-04-01 17:03:11 UTC (rev 2915)
@@ -79,6 +79,9 @@
 uint8_t renderStopPlaying( void );
 uint8_t renderHasAccelZoom(void);
 
+uint8_t renderLock(void);
+uint8_t renderUnlock(void);
+
 void *UI_getDrawWidget(void);
 void UI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
 void UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h);



From mean at mail.berlios.de  Sun Apr  1 21:57:56 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 1 Apr 2007 21:57:56 +0200
Subject: [Avidemux-svn-commit] r2916 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_libraries/ADM_lavcodec ADM_libraries/ADM_lavutil
	ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200704011957.l31JvucG003617@sheep.berlios.de>

Author: mean
Date: 2007-04-01 21:57:56 +0200 (Sun, 01 Apr 2007)
New Revision: 2916

Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/swscale.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h
   branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
Log:
small update

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/swscale.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/swscale.h	2007-04-01 17:03:11 UTC (rev 2915)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/swscale.h	2007-04-01 19:57:56 UTC (rev 2916)
@@ -1,32 +0,0 @@
-#ifndef SWSCALE_EMU_H
-#define SWSCALE_EMU_H
-/* Dummy, only useful for compilation! */
-#define SWS_FAST_BILINEAR 1
-#define SWS_BILINEAR 2
-#define SWS_BICUBIC  4
-#define SWS_X        8
-#define SWS_POINT    0x10
-#define SWS_AREA     0x20
-#define SWS_BICUBLIN 0x40
-#define SWS_GAUSS    0x80
-#define SWS_SINC     0x100
-#define SWS_LANCZOS  0x200
-#define SWS_SPLINE   0x400
-
-#define SwsFilter void
-struct SwsContext {
-    struct ImgReSampleContext *resampling_ctx;
-    enum PixelFormat src_pix_fmt, dst_pix_fmt;
-};
-
-struct SwsContext *sws_getContext(int srcW, int srcH, int srcFormat,
-                                  int dstW, int dstH, int dstFormat,
-                                  int flags, SwsFilter *srcFilter,
-                                  SwsFilter *dstFilter, double *param);
-
-int sws_scale(struct SwsContext *ctx, uint8_t* src[], int srcStride[],
-              int srcSliceY, int srcSliceH, uint8_t* dst[], int dstStride[]);
-
-void sws_freeContext(struct SwsContext *swsContext);
-
-#endif /* SWSCALE_EMU_H */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h	2007-04-01 17:03:11 UTC (rev 2915)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h	2007-04-01 19:57:56 UTC (rev 2916)
@@ -42,6 +42,8 @@
 #define AV_LOG_ERROR 0
 #define AV_LOG_INFO 1
 #define AV_LOG_DEBUG 2
+#define AV_LOG_VERBOSE 2
+
 extern int av_log_level;
 
 #ifdef __GNUC__

Modified: branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-04-01 17:03:11 UTC (rev 2915)
+++ branches/avidemux_2.4_branch/avidemux/ADM_preview.cpp	2007-04-01 19:57:56 UTC (rev 2916)
@@ -270,14 +270,14 @@
       }
       if(zoom!=ZOOM_1_1)
       {
-          ADM_assert(resized);
-          ADM_assert(resizer);
-          delete resized;
-          delete resizer;
+          
+          
+          if(resized) delete resized;
+          if(resizer) delete resizer;
           resized=NULL;
           resizer=NULL;
       }
-  renderUnlock();
+      renderUnlock();
 }
 /**
       \fn admPreview::updateFilters

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-04-01 17:03:11 UTC (rev 2915)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-04-01 19:57:56 UTC (rev 2916)
@@ -58,7 +58,7 @@
 
 extern GtkWidget *getDrawWidget( void );
  ColYuvRgb rgbConverter(640,480);
-
+uint32_t lastW,lastH;
 /**
     \brief return pointer to the drawing widget that displays video
 */
@@ -74,6 +74,10 @@
     GtkWidget *widget;
     widget = (GtkWidget *)widg; 
 
+    if(lastW>w || lastH>h)
+    {
+      printf("[Gtk] Warning window bigger than display %u x %u vs %u x %u\n",w,h,lastW,lastH);
+    }
 
     gdk_draw_rgb_32_image(widget->window, widget->style->fg_gc[GTK_STATE_NORMAL], 0,    // X
                        0,       // y
@@ -93,6 +97,10 @@
     gtk_widget_set_usize((GtkWidget *)win, w, h);
     UI_purge();
     GUI_gtk_grow_off(1);
+    lastW=w;
+    lastH=h;
+    printf("[GTK] Changing size to %u %u\n",w,h);
+    UI_purge();
 }
 /**
       \brief Retrieve info from window, needed for accel layer



From mean at mail.berlios.de  Tue Apr  3 20:09:13 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 3 Apr 2007 20:09:13 +0200
Subject: [Avidemux-svn-commit] r2917 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200704031809.l33I9DVk031585@sheep.berlios.de>

Author: mean
Date: 2007-04-03 20:09:12 +0200 (Tue, 03 Apr 2007)
New Revision: 2917

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
audio track selector part 1

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-01 19:57:56 UTC (rev 2916)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-03 18:09:12 UTC (rev 2917)
@@ -92,15 +92,86 @@
   uint32_t *val=(uint32_t *)param;
   uint32_t rank;
   ADM_assert(widget);
+  if(!nbMenu) return;
   
-  
   rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
   ADM_assert(rank<this->nbMenu);
   *(uint32_t *)param=this->menu[rank].val;
 }
 
+//*******************************
+diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
+                diaMenuEntryDynamic **menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+  param=(void *)intValue;
+  paramTitle=itle;
+  this->tip=tip;
+  this->menu=menu;
+  this->nbMenu=nb;
+}
 
+diaElemMenuDynamic::~diaElemMenuDynamic()
+{
+  
+}
+void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  GtkWidget *widget;
+  GtkWidget *label;
+  GtkWidget *item;
+  GtkWidget *combo;
+  
+  
+  label = gtk_label_new_with_mnemonic (paramTitle);
+  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
+  gtk_widget_show(label);
+  
+  gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  combo = gtk_combo_box_new_text ();
+  gtk_widget_show (combo);
+  gtk_table_attach (GTK_TABLE (opaque), combo, 1, 2, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  gtk_label_set_mnemonic_widget (GTK_LABEL(label), combo);
+  
+  for(int i=0;i<nbMenu;i++)
+  {
+    gtk_combo_box_append_text (GTK_COMBO_BOX (combo),menu[i]->text);
+  }
+  
+  for(int i=0;i<nbMenu;i++)
+  {
+    if(menu[i]->val==*(uint32_t *)param) 
+    {
+      gtk_combo_box_set_active(GTK_COMBO_BOX(combo),i);
+    }
+  }
+  
+  
+  myWidget=(void *)combo;
+}
 
+void diaElemMenuDynamic::getMe(void)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  uint32_t *val=(uint32_t *)param;
+  uint32_t rank;
+  if(!nbMenu) return;
+  ADM_assert(widget);
+  
+  
+  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
+  ADM_assert(rank<this->nbMenu);
+  *(uint32_t *)param=this->menu[rank]->val;
+}
 
 
+
+
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-01 19:57:56 UTC (rev 2916)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-03 18:09:12 UTC (rev 2917)
@@ -231,4 +231,22 @@
   
             
 //******************************************************
+diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
+                diaMenuEntryDynamic **menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+}
+
+diaElemMenuDynamic::~diaElemMenuDynamic()
+{ 
+}
+void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
+{
+}
+
+void diaElemMenuDynamic::getMe(void)
+{ 
+}
+//******************************************************
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-01 19:57:56 UTC (rev 2916)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-03 18:09:12 UTC (rev 2917)
@@ -82,8 +82,23 @@
   *(uint32_t *)param=menu[r].val;
       
 }
+//*********************************
+diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
+                diaMenuEntryDynamic **menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+}
 
+diaElemMenuDynamic::~diaElemMenuDynamic()
+{ 
+}
+void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
+{
+}
 
+void diaElemMenuDynamic::getMe(void)
+{ 
+}
 
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-01 19:57:56 UTC (rev 2916)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-03 18:09:12 UTC (rev 2917)
@@ -16,6 +16,8 @@
 #ifndef DIA_FACTORY_H
 #define DIA_FACTORY_H
 
+#include "ADM_assert.h"
+
 typedef enum elemEnum
 {
   ELEM_INVALID=0,
@@ -116,11 +118,35 @@
 /*************************************************/
 typedef struct diaMenuEntry
 {
+  public:
   uint32_t    val;
   const char *text;
   const char *desc;
+  public:
+ /*   diaMenuEntry(uint32_t v,const char *t,const char *d) {val=v;t=ADM_strdup(t);desc=ADM_strdup(d);}
+    ~diaMenuEntry() { ADM_dealloc(text);ADM_dealloc(desc);}
+    */
 }diaMenuEntry;
 
+class diaMenuEntryDynamic : public diaMenuEntry
+{
+  public:
+  public:
+    diaMenuEntryDynamic(uint32_t v,const char *t,const char *d) 
+      {
+          val=v;
+          text=ADM_strdup(t);
+          desc=ADM_strdup(d);
+      }
+    ~diaMenuEntryDynamic() 
+      { 
+          ADM_dealloc(text);
+          ADM_dealloc(desc);
+      }
+    
+};
+
+// static (i.e. hardcoded) menu
 class diaElemMenu : public diaElem
 {
 const diaMenuEntry *menu;
@@ -134,6 +160,20 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
 };
+// Same but for dynamic menus
+class diaElemMenuDynamic : public diaElem
+{
+diaMenuEntryDynamic **menu;
+uint32_t     nbMenu;
+
+public:
+  diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
+               diaMenuEntryDynamic **menu,const char *tip=NULL);
+  
+  virtual ~diaElemMenuDynamic() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+};
 /*************************************************/
 #include "ADM_encoder/ADM_vidEncode.hxx"
 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-01 19:57:56 UTC (rev 2916)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-03 18:09:12 UTC (rev 2917)
@@ -70,6 +70,9 @@
 #include "ADM_libmpeg2enc/ADM_mpeg2enc.h"
 
 #include "ADM_filter/video_filters.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
 #include "ADM_assert.h"
 void A_handleSecondTrack (int tracktype);
 int A_delete(uint32_t start, uint32_t end);
@@ -119,8 +122,6 @@
 static void A_mpegIndexer (void);
 extern uint8_t indexMpeg (char *mpeg, char *file, uint8_t aid);
 void ADM_cutWizard (void);
-void computeIT (int size, int nb, int brate, uint32_t * frame,
-		uint32_t * rsize);
 uint8_t  ADM_saveRaw (const char *name);
 char * actual_workbench_file;
 void A_saveWorkbench (char *name);
@@ -162,7 +163,6 @@
 uint8_t DIA_builtin(void);
 renderZoom currentZoom=ZOOM_1_1;
 uint8_t A_setSecondAudioTrack(const AudioSource nw,char *name);
-uint8_t Util_saveJpg (char *name,uint32_t w, uint32_t,ADMImage *image);
 extern const char * GUI_getCustomScript(uint32_t nb);
 extern gboolean SliderIsShifted;
 
@@ -319,74 +319,7 @@
       }
       cleanUp (); 
       exit (0);
-#if 0
-    case ACT_AudioModeToggle:
-      if( !recursive )
-      {
-        recursive = 1;
-        UI_setAProcessToggleStatus(audioProcessMode);
-        recursive = 0;
-        printf ("\n audio is now : %d\n", audioProcessMode);
-      }
-      return;
-
-    case ACT_VideoModeToggle:
-      if( !recursive )
-      {
-        videoProcessMode ^= 1;
-        recursive = 1;
-        UI_setVProcessToggleStatus(videoProcessMode);
-        recursive = 0;
-        printf ("\n video is now : %d\n", videoProcessMode);
-      }
-      return;
-
-    case ACT_AudioModeProcess:
-      if( !recursive )
-      {
-        audioProcessMode = 1;
-        recursive = 1;
-        UI_setAProcessToggleStatus(audioProcessMode);
-        recursive = 0;
-        printf ("\n audio is now : %d\n", audioProcessMode);
-      }
-      return;
       break;
-
-    case ACT_AudioModeCopy:
-      if( !recursive )
-      {
-        audioProcessMode = 0;
-        recursive = 1;
-        UI_setAProcessToggleStatus(audioProcessMode);
-        recursive = 0;
-        printf ("\n audio is now : %d\n", audioProcessMode);
-      }
-      return;
-      break;
-    case ACT_VideoModeCopy:
-      if( !recursive )
-      {
-        videoProcessMode = 0;
-        recursive = 1;
-        UI_setVProcessToggleStatus(videoProcessMode);
-        recursive = 0;
-        printf ("\n video is now : %d\n", videoProcessMode);
-      }
-      return;
-      break;
-    case ACT_VideoModeProcess:
-      if( !recursive )
-      {
-        videoProcessMode = 1;
-        recursive = 1;
-        UI_setVProcessToggleStatus(videoProcessMode);
-        recursive = 0;
-        printf ("\n video is now : %d\n", videoProcessMode);
-      }
-      return;
-#endif
-      break;
 /*			case ACT_SelectEncoder:
 				
 						A_selectEncoder();
@@ -504,17 +437,7 @@
   	case ACT_TimeChanged:
 			printf("TimeChanged\n");
       			break;			
-#if 0
-    case ACT_Pipe2Lame:
-		 A_Pipe(P_TOOLAME);
-    	break;
- case ACT_PipeLame:
-		 A_Pipe(P_LAME);
-    	break;
-case ACT_Pipe2Other:
-		 A_Pipe(P_OTHER);
-    	break;
-#endif
+
     case ACT_SaveWork:
       GUI_FileSelWrite (_("Select workbench to save "), A_saveWorkbench);
       break;
@@ -1360,10 +1283,14 @@
       GUI_Error_HIG(_("Get Frame"),_("Cannot get this frame to save"));
       return 0; 
     }
-    return (int) Util_saveJpg (name,avifileinfo->width, avifileinfo->height,NULL);
+    return (int) image.saveAsJpg (name);
 }
 #else
+/**
+      \fn A_saveJpg
+      \brief Save current image as jpeg 95% qual
 
+*/
 int A_saveJpg (char *name)
 {
 static int b=1;
@@ -1374,215 +1301,70 @@
 }
 #endif
 
-uint8_t Util_saveJpg (char *name,uint32_t w, uint32_t h,ADMImage *image)
-{
-  ffmpegEncoderFFMjpeg *codec=NULL;
-  FILE *fd;
-  uint8_t *buffer=NULL;
-  uint32_t sz;
-  
 
-        sz = w*h*3;
-  ADMBitstream bitstream(sz);
-        buffer=new uint8_t[sz];
-        bitstream.data=buffer;
-        codec=new  ffmpegEncoderFFMjpeg(w,h,FF_MJPEG)  ;
-        codec->init( 95,25000);
-        if(!codec->encode(image,&bitstream))
-        {
-          GUI_Error_HIG(_("Cannot encode the frame"), NULL);
-                delete [] buffer;
-                delete codec;
-                return 0;
-        }
-        delete codec;
-        fd=fopen(name,"wb");
-        if(!fd)
-        {
-          GUI_Error_HIG(_("File error"),_( "Cannot open \"%s\" for writing."), name);
-                delete [] buffer;
-                return 0;
-        }
-        fwrite (buffer, bitstream.len, 1, fd);
-        fclose(fd);
-        delete [] buffer;
-        return 1;
-}
 /**
-	Save the selection  as a bunch of jpeg 95% qual
-	Used mainly to make animated DVD menu 
+      \fn A_saveBunchJpg
+      \brief Save the selection  as a bunch of jpeg 95% qual
 
 */
 void A_saveBunchJpg(char *name)
 {
-  ffmpegEncoderFFMjpeg *codec=NULL;
-  uint32_t sz,fl;
-  FILE *fd;
-  uint8_t *buffer=NULL;
   ADMImage *src=NULL;
   uint32_t curImg;
   char	 fullName[2048],*ext;
   DIA_working *working;
-  	if(frameStart>frameEnd)
-		{
+  uint8_t success=0;
+  
+        if(frameStart>frameEnd)
+                {
                   GUI_Error_HIG(_("Mark A > B"), _("Set your markers correctly."));
-			return;
-		}
-	// Split name into base + extension
-	PathSplit(name,&name,&ext);
-	
-	
-	sz = avifileinfo->width* avifileinfo->height * 3;
-	buffer=new uint8_t [sz];
-	ADM_assert(buffer);
-	//src=new uint8_t [sz];
-	src=new ADMImage(avifileinfo->width,avifileinfo->height);
-	ADM_assert(src);
+                        return;
+                }
+        // Split name into base + extension
+        PathSplit(name,&name,&ext);
+        
+        src=new ADMImage(avifileinfo->width,avifileinfo->height);
+        ADM_assert(src);
 
-
-		codec=new  ffmpegEncoderFFMjpeg( avifileinfo->width,avifileinfo->height,FF_MJPEG)  ;
-		codec->init( 95,25000);
-
         working=new DIA_working(_("Saving as set of jpegs"));
-        ADMBitstream bitstream(sz);
-
-        bitstream.data=	buffer;
-	for(curImg=frameStart;curImg<=frameEnd;curImg++)
-	{	
+        for(curImg=frameStart;curImg<=frameEnd;curImg++)
+        {	
                 working->update(curImg-frameStart,frameEnd-frameStart);	
-		if (!GUI_getFrameContent (src,curImg ))
-		{
+                if (!GUI_getFrameContent (src,curImg ))
+                {
                   GUI_Error_HIG(_("Cannot decode frame"), _("Aborting."));
-			goto _bunch_abort;
-		}
+                        goto _bunch_abort;
+                }
                 if(!working->isAlive()) goto _bunch_abort;
-		if(!codec->encode(src,&bitstream))
-			{
-                          GUI_Error_HIG(_("Cannot encode frame"),_( "Aborting."));
-				goto _bunch_abort;
-				
-			}
-		sprintf(fullName,"%s%04d.jpg",name,curImg-frameStart);
-		fd=fopen(fullName,"wb");
-		if(!fd)
-		{
-                  GUI_Error_HIG(_("Cannot write the file"), _("Aborting."));
-				goto _bunch_abort;
-
-		}
-		fwrite (buffer, bitstream.len, 1, fd);
-    		fclose(fd);
-	}
-	
-        GUI_Info_HIG(ADM_LOG_INFO,_("Done"),_( "Saved %d images."), curImg-frameStart);
+                sprintf(fullName,"%s%04d.jpg",name,curImg-frameStart);
+                if(!src->saveAsJpg(fullName)) goto _bunch_abort;
+        }
+        success=1;
+        
 _bunch_abort:
+        if(success)
+            GUI_Info_HIG(ADM_LOG_INFO,_("Done"),_( "Saved %d images."), curImg-frameStart);
+        else
+            GUI_Error_HIG(_("Error"),_( "Could not save all images."));
         delete working	;
-    	delete [] buffer;
-	delete src;
-	delete codec;
-	return ;
+        delete src;
+        return ;
 
 
 }
-/**________________________________________________________
- Save a BMP image from current display buffer
-________________________________________________________*/
-
-void
-A_saveImg (char *name)
+/**
+      \fn A_saveImg
+      \brief Save current displayed image as a BMP file
+*/
+void A_saveImg (char *name)
 {
-  BITMAPFILEHEADER bmfh;
-  BITMAPINFOHEADER bmph;
-  FILE *fd;
-  uint32_t sz;
-  uint16_t s16;
-  uint32_t s32;
   
-
-sz = avifileinfo->width* avifileinfo->height * 3;
-
-
-  printf ("\n Size : %X\n", bmfh.size);
-  bmfh.xHotspot = bmfh.yHotspot = 0;
-  bmfh.offsetToBits = sizeof (bmfh) + sizeof (bmph);
-//_________________________________________
-  bmph.biSize = sizeof (bmph);
-  bmph.biWidth = avifileinfo->width;
-  bmph.biHeight = avifileinfo->height;
-  bmph.biPlanes = 1;
-  bmph.biBitCount = 24;
-  bmph.biCompression = 0;	// COMPRESSION NONE
-  bmph.biSizeImage = sz;
-  bmph.biXPelsPerMeter = 0;
-  bmph.biYPelsPerMeter = 0;
-  bmph.biClrUsed = 0;
-  bmph.biClrImportant = 0;
-/*
-	bmph.resolutionUnits=0;
-	bmph.origin=0;
-	bmph.colorEncoding=0;
-*/
-
   ADMImage image(avifileinfo->width,avifileinfo->height);
   GUI_getFrameContent(&image, curframe);
-
-  printf ("\n %u x %u=%u\n", bmph.biWidth, bmph.biHeight, sz);
-
-  uint8_t *out;
-
-  	out=(uint8_t *)ADM_alloc(sz);
-	if(!out)
-	{
-          GUI_Error_HIG(_("Memory error"), NULL);
-		return;
-	}
-
-	 if(!COL_yv12rgbBMP(bmph.biWidth, bmph.biHeight,image.data, out))
-	 {
-           GUI_Error_HIG(_("Error converting to BMP"), NULL);
-		return;
- 	}
- 	fd = fopen (name, "wb");
-  	if (!fd)
-    	{
-          GUI_Error_HIG (_("Something bad happened"), NULL);
-		ADM_dealloc(out);
-      		return;
-    	}
-
-	// Bitmpap file header, not using tructure due to gcc padding it
-#ifdef ADM_BIG_ENDIAN
-	s16 = 0x424D;
-#else	
-  	s16 = 0x4D42;
-#endif	
-  	s32 = 14 + sizeof (bmph) + sz;
-#ifdef ADM_BIG_ENDIAN	
-	#define SWAP32(x) x=R32(x)	
-#else
-	#define SWAP32(x) ; 
-#endif
-	SWAP32(s32);	
-  	fwrite (&s16, 2, 1, fd);
-  	fwrite (&s32, 4, 1, fd);
-  	s32 = 0;
-  	fwrite (&s32, 4, 1, fd);
-  	s32 = 14 + sizeof (bmph);
-	SWAP32(s32);
-  	fwrite (&s32, 4, 1, fd);
-#ifdef ADM_BIG_ENDIAN
-//void Endian_BitMapInfo( BITMAPINFOHEADER *b)
-	Endian_BitMapInfo(&bmph);
-#endif
-	fwrite (&bmph, sizeof (bmph), 1, fd);
-      	fwrite (out, sz, 1, fd);
-
-    	fclose(fd);
-    	ADM_dealloc(out);
-
-
+  if(image.saveAsBmp(name))
         GUI_Info_HIG (ADM_LOG_INFO,_("Done"),_( "Saved \"%s\"."), GetFileName(name));
-
+  else
+        GUI_Error_HIG (_("BMP op failed"),_( "Saving %s as a BMP file failed."), GetFileName(name));
 }
 
 //_____________________________________________________________
@@ -1690,13 +1472,17 @@
   if (currentaudiostream)
     {
       if (currentaudiostream->isDestroyable ())
+        
+      {
 	delete currentaudiostream;
+        currentaudiostream=NULL;
+      }
       currentAudioSource=AudioNone;
       if(currentAudioName) ADM_dealloc(currentAudioName);
       currentAudioName=NULL;
     }
   currentaudiostream = newaudio;
-//  GUI_UpdateAudioToggle (nwsource);
+
   if (currentaudiostream)
   {
     wavinfo = currentaudiostream->getInfo ();
@@ -1891,68 +1677,7 @@
 #endif
 }
 
-void
-computeIT (int size, int nb, int brate, uint32_t * frame, uint32_t * rsize)
-{
-  uint32_t curframe, cursize;
-  uint32_t lastframe, lastsize;
-  uint32_t lsize = size;
-  curframe = cursize = lastframe = lastsize = 0;
-  uint32_t one_audio;
 
-//               uint8_t tmp[768*768*3];
-//               uint32_t len2;
-  uint32_t len, flag;
-
-  uint8_t ret;
-
-  lastframe = frameStart;
-//
-  double fi = brate >> 3;
-  fi = fi / avifileinfo->fps1000;
-  fi *= 1000000.;
-  one_audio = (uint32_t) floor (fi);
-
-  printf ("\n search for %u\n", lsize);
-  printf ("\n one audio  %u\n", one_audio);
-  for (uint32_t f = frameStart; f < avifileinfo->nb_frames; f++)
-    {
-
-      cursize += 32 + 32 + 2 * 32 * nb;	// index + header
-      cursize += one_audio * nb;
-      len = 0;
-      ret = video_body->getFrameSize (f, &len);
-      video_body->getFlags (f, &flag);
-      if (!ret)
-	{
-	  printf ("\n Error!\n");
-	  *frame = lastframe;
-	  *rsize = lastsize;
-	  return;
-	}
-      cursize += len;
-      // check if we went beyonf
-      if (cursize > lsize)
-	{
-	  *frame = lastframe;
-	  *rsize = lastsize;
-	  printf ("\n found : Frame %u  %u\n", lastframe, lastsize);
-	  return;
-	}
-      // if it is a key f we memorize it
-      if (flag & AVI_KEY_FRAME)
-	{
-	  lastframe = f;
-	  lastsize = size;
-	}
-    }
-
-
-  printf ("\n oops\n");
-  *rsize = 0;
-  *frame = 0;
-}
-
 /*
 	Save a raw video stream without any container
 	Usefull to cut mpeg stream or extract raw h263/mpeg4 stream
@@ -2248,58 +1973,100 @@
 
 }
 extern uint8_t DIA_audioTrack(AudioSource *source, uint32_t *track,uint32_t nbTrack, audioInfo *infos);
+extern const char *getStrFromAudioCodec( uint32_t codec);
+/**
+      \fn A_audioTrack
+      \brief Allow to select audio track
+*/
 void A_audioTrack( void )
 {
-    uint32_t nb;
-    audioInfo *infos=NULL;
-        AudioSource old,nw;        
+        uint32_t nb;
+        audioInfo *infos=NULL;
+        
+        uint32_t old,nw;        
         uint8_t r=0;
         uint32_t oldtrack,newtrack;
+        char *newtrackname=NULL;
 
-
         if(!video_body->getAudioStreamsInfo(0,&nb, &infos))
         {
           GUI_Error_HIG(_("Could not get tracks info"), NULL);
                 return ;
         }
-        newtrack=oldtrack=video_body->getCurrentAudioStreamNumber(0);
+        newtrack=oldtrack=(uint32_t)video_body->getCurrentAudioStreamNumber(0);
         nw=old=currentAudioSource;
-        r=DIA_audioTrack(&nw, &newtrack,nb, infos);
-        if(infos) delete [] infos;
-        // Change track here
-        if(old==nw && (nw!=AudioAvi)) return;
-
-        switch( nw)
+        
+        /* Build dialog factory widget */
+        diaMenuEntry sourcesStream[]={
+            {AudioAvi,_("Video"),_("Take audio from video file")},
+            {AudioNone,_("None"),_("No audio")},
+            {AudioAC3,_("External AC3"),_("Take audio from external AC3 file")},
+            {AudioMP3,_("External MP3"),_("Take audio from external MP3 file")},
+            {AudioWav,_("External Wav"),_("Take audio from external WAV file")}
+        };
+        
+        
+        diaElemMenu   sourceMenu(&nw,_("Audio source"),5,sourcesStream,NULL);
+        
+        
+        
+        diaElemFileRead sourceName(&newtrackname,_("External filename"));
+        
+        // Now build the list of embedded track
+#define MAX_AUDIO_TRACK 10
+#define MAX_AUDIO_TRACK_NAME 100
+        diaMenuEntryDynamic *sourceavitracks[MAX_AUDIO_TRACK];
+        char string[MAX_AUDIO_TRACK_NAME];
+        for(int i=0;i<nb;i++)
         {
-                case AudioMP3:
-                  GUI_FileSelRead (_("Select MP3 to load "), (SELFILE_CB *)A_loadMP3);
-                        break;
-                case AudioAC3:
-                  GUI_FileSelRead (_("Select AC3 to load "), (SELFILE_CB *)A_loadAC3);
-                        break;
-                case AudioWav:
-                  GUI_FileSelRead (_("Select WAV to load "),(SELFILE_CB *) A_loadWave);
-                        break;
-                case AudioNone:
-                          A_changeAudioStream((AVDMGenericAudioStream *) NULL, AudioNone,NULL);
-                        break;
-                case AudioAvi:
-                        //printf("New :%d old:%d\n",newtrack,oldtrack);
-                        if(oldtrack!=newtrack)
-                        {
-                                video_body->changeAudioStream(0,newtrack);
-                                //
-                                if(aviaudiostream==currentaudiostream)
-                                        currentaudiostream=NULL;
-                                delete aviaudiostream;
-                                aviaudiostream=NULL;
-                                video_body->getAudioStream(&aviaudiostream);
-                        }
-                        A_changeAudioStream (aviaudiostream, AudioAvi,NULL);
-                        break;
-                default:
-                        ADM_assert(0);
+          sprintf(string,"Audio track %d (%s/%d channels/%d kbit per s/%d ms shift)",i,getStrFromAudioCodec(infos[i].encoding),
+                        infos[i].channels,infos[i].bitrate,infos[i].av_sync);
+           sourceavitracks[i]=new diaMenuEntryDynamic(i,string,NULL);
         }
+         if(infos) delete [] infos;
+         
+         diaElemMenuDynamic   sourceFromVideo(&newtrack,"Track from video",nb,sourceavitracks);
+         diaElem *allWidgets[]={&sourceMenu,&sourceFromVideo,&sourceName};
+         
+         if( diaFactoryRun("Select Main audio Track",3,allWidgets))
+         {
+            switch( nw)
+            {
+                    case AudioMP3:
+                            A_loadMP3(newtrackname);
+                            break;
+                    case AudioAC3:
+                            A_loadAC3(newtrackname);
+                            break;
+                    case AudioWav:
+                            A_loadWave(newtrackname);
+                            break;
+                    case AudioNone:
+                              A_changeAudioStream((AVDMGenericAudioStream *) NULL, AudioNone,NULL);
+                            break;
+                    case AudioAvi:
+                            //printf("New :%d old:%d\n",newtrack,oldtrack);
+                            if(oldtrack!=newtrack)
+                            {
+                                    video_body->changeAudioStream(0,newtrack);
+                                    //
+                                    if(aviaudiostream==currentaudiostream)
+                                            currentaudiostream=NULL;
+                                    delete aviaudiostream;
+                                    aviaudiostream=NULL;
+                                    video_body->getAudioStream(&aviaudiostream);
+                            }
+                            A_changeAudioStream (aviaudiostream, AudioAvi,NULL);
+                            break;
+                    default:
+                            ADM_assert(0);
+        }
+         }
+         /* Clean up */
+         for(int i=0;i<nb;i++)
+            delete sourceavitracks[i];
+        return;
+
 }
 void A_externalAudioTrack( void )
 {



From mean at mail.berlios.de  Tue Apr  3 20:15:38 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 3 Apr 2007 20:15:38 +0200
Subject: [Avidemux-svn-commit] r2918 -
	branches/avidemux_2.4_branch/avidemux/ADM_encoder
Message-ID: <200704031815.l33IFcie032384@sheep.berlios.de>

Author: mean
Date: 2007-04-03 20:15:37 +0200 (Tue, 03 Apr 2007)
New Revision: 2918

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
Log:
changed default for x264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-04-03 18:09:12 UTC (rev 2917)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-04-03 18:15:37 UTC (rev 2918)
@@ -628,13 +628,13 @@
 0,//     int32_t  Strength;
 0,//     int32_t  Threshold;
 1,//     uint32_t CABAC;
-1,//     uint32_t Trellis;
+0,//     uint32_t Trellis;
 1, //        ChromaME
 0, // Mixed Ref
 0, //NoiseReduction
 51, // level IDC for psp  
 0, // fastPSkip;
-0,  //DCTDecimate;
+1,  //DCTDecimate;
 0,   //interlaced;
 0,    // vbv_max_bitrate;
 0,  // vbv_buffer_size;
@@ -691,7 +691,7 @@
 0, //NoiseReduction
 30, // level IDC for psp  
 0, // fastPSkip;
-0,  //DCTDecimate;
+1,  //DCTDecimate;
 0,   //interlaced;
 0,    // vbv_max_bitrate;
 0,  // vbv_buffer_size;



From mean at mail.berlios.de  Tue Apr  3 22:05:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 3 Apr 2007 22:05:55 +0200
Subject: [Avidemux-svn-commit] r2919 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities
Message-ID: <200704032005.l33K5t8h013007@sheep.berlios.de>

Author: mean
Date: 2007-04-03 22:05:55 +0200 (Tue, 03 Apr 2007)
New Revision: 2919

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
Log:
forgot to commit admimage stuff

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-04-03 18:15:37 UTC (rev 2918)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-04-03 20:05:55 UTC (rev 2919)
@@ -134,6 +134,11 @@
         uint8_t blacken(void);
         uint8_t copyTo(ADMImage *target, uint32_t x, uint32_t y);
         uint8_t pack(uint8_t invertChroma);     /// Transfer data from planes to regular packed space
+        
+        /* Some utilitarian functions */
+        uint8_t  saveAsBmp(const char *filename);
+        uint8_t  saveAsJpg(const char *filename);
+        
 static uint32_t lumaDiff(ADMImage *src1,ADMImage *src2,uint32_t noise);
 };
 void drawString(ADMImage *dst, int x, int y, const char *s) ;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2007-04-03 18:15:37 UTC (rev 2918)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp	2007-04-03 20:05:55 UTC (rev 2919)
@@ -81,9 +81,6 @@
 int ssrc[3];
 int ddst[3];
 
-uint32_t page;
-
-                page=orgWidth*orgHeight;
                 src[0]=YPLANE(source);
                 src[1]=UPLANE(source);
                 src[2]=VPLANE(source);
@@ -91,7 +88,7 @@
                 ssrc[0]=orgWidth;
                 ssrc[1]=ssrc[2]=orgWidth>>1;
 
-                page=destWidth*destHeight;
+         
                 dst[0]=YPLANE(dest);
                 dst[1]=UPLANE(dest);
                 dst[2]=VPLANE(dest);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-04-03 18:15:37 UTC (rev 2918)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-04-03 20:05:55 UTC (rev 2919)
@@ -21,7 +21,17 @@
 #include "default.h"
 
 #include "ADM_image.h"
+#include "ADM_toolkit/bitmap.h"
+#include "avifmt.h"
+#include "ADM_utilities/avifmt2.h"
+#include "ADM_utilities/ADM_bitstream.h"
 #include "ADM_osSupport/ADM_cpuCap.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_colorspace/colorspace.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_codecs/ADM_ffmpeg.h"
 #include "admmangle.h"
 static uint8_t tinyAverage(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {
@@ -336,5 +346,144 @@
 #endif
         return tinySubstract(YPLANE(this),YPLANE(src1),YPLANE(src2),src1->_width*src1->_height);
 }
+ BITMAPFILEHEADER bmfh;
+  BITMAPINFOHEADER bmph;
+  FILE *fd;
+  uint32_t sz;
+  uint16_t s16;
+  uint32_t s32;
+  
 
+/**
+    \fn saveAsBmp
+    \brief save current image into filename, into bmp format
+*/
+uint8_t  ADMImage::saveAsBmp(const char *filename)
+{
+  BITMAPFILEHEADER bmfh;
+  BITMAPINFOHEADER bmph;
+  FILE *fd;
+  uint32_t sz;
+  uint16_t s16;
+  uint32_t s32;
+  
+  sz = _width* _height * 3;
+
+  bmfh.xHotspot = bmfh.yHotspot = 0;
+  bmfh.offsetToBits = sizeof (bmfh) + sizeof (bmph);
+//_________________________________________
+  bmph.biSize = sizeof (bmph);
+  bmph.biWidth = _width;
+  bmph.biHeight = _height;
+  bmph.biPlanes = 1;
+  bmph.biBitCount = 24;
+  bmph.biCompression = 0;	// COMPRESSION NONE
+  bmph.biSizeImage = sz;
+  bmph.biXPelsPerMeter = 0;
+  bmph.biYPelsPerMeter = 0;
+  bmph.biClrUsed = 0;
+  bmph.biClrImportant = 0;
+/*
+	bmph.resolutionUnits=0;
+	bmph.origin=0;
+	bmph.colorEncoding=0;
+*/
+
+  ADMImage image(_width,_height);
+  
+
+  printf ("\n %u x %u=%u\n", bmph.biWidth, bmph.biHeight, sz);
+
+  uint8_t *out;
+
+        out=(uint8_t *)ADM_alloc(sz);
+        if(!out)
+        {
+            GUI_Error_HIG(_("Memory error"), NULL);
+//            ADM_dealloc(out);
+            return 0;
+        }
+
+        if(!COL_yv12rgbBMP(bmph.biWidth, bmph.biHeight,data, out))
+        {
+              GUI_Error_HIG(_("Error converting to BMP"), NULL);
+              ADM_dealloc(out);
+              return 0;
+        }
+        fd = fopen (filename, "wb");
+        if (!fd)
+        {
+                GUI_Error_HIG (_("Something bad happened"), NULL);
+                ADM_dealloc(out);
+                return 0;
+        }
+
+	// Bitmpap file header, not using tructure due to gcc padding it
+#ifdef ADM_BIG_ENDIAN
+	s16 = 0x424D;
+#else	
+  	s16 = 0x4D42;
+#endif	
+  	s32 = 14 + sizeof (bmph) + sz;
+#ifdef ADM_BIG_ENDIAN	
+	#define SWAP32(x) x=R32(x)	
+#else
+	#define SWAP32(x) ; 
+#endif
+        SWAP32(s32);	
+        fwrite (&s16, 2, 1, fd);
+        fwrite (&s32, 4, 1, fd);
+        s32 = 0;
+        fwrite (&s32, 4, 1, fd);
+        s32 = 14 + sizeof (bmph);
+        SWAP32(s32);
+        fwrite (&s32, 4, 1, fd);
+#ifdef ADM_BIG_ENDIAN
+	Endian_BitMapInfo(&bmph);
+#endif
+        fwrite (&bmph, sizeof (bmph), 1, fd);
+        fwrite (out, sz, 1, fd);
+  
+        fclose(fd);
+        ADM_dealloc(out);
+        return 1;
+}
+/**
+    \fn saveAsJpg
+    \brief save current image into filename, into jpg format
+*/
+uint8_t  ADMImage::saveAsJpg(const char *filename)
+{
+ ffmpegEncoderFFMjpeg *codec=NULL;
+  FILE *fd;
+  uint8_t *buffer=NULL;
+  uint32_t sz;
+  
+
+        sz = _width*_height*3;
+        ADMBitstream bitstream(sz);
+        buffer=new uint8_t[sz];
+        bitstream.data=buffer;
+        codec=new  ffmpegEncoderFFMjpeg(_width,_height,FF_MJPEG)  ;
+        codec->init( 95,25000);
+        if(!codec->encode(this,&bitstream))
+        {
+                GUI_Error_HIG(_("Cannot encode the frame"), NULL);
+                delete [] buffer;
+                delete codec;
+                return 0;
+        }
+        delete codec;
+        fd=fopen(filename,"wb");
+        if(!fd)
+        {
+                GUI_Error_HIG(_("File error"),_( "Cannot open \"%s\" for writing."), filename);
+                delete [] buffer;
+                return 0;
+        }
+        fwrite (buffer, bitstream.len, 1, fd);
+        fclose(fd);
+        delete [] buffer;
+        return 1;
+}
 //EOF



From mean at mail.berlios.de  Wed Apr  4 20:14:18 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 4 Apr 2007 20:14:18 +0200
Subject: [Avidemux-svn-commit] r2920 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200704041814.l34IEIOE015437@sheep.berlios.de>

Author: mean
Date: 2007-04-04 20:14:17 +0200 (Wed, 04 Apr 2007)
New Revision: 2920

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
improved dialogFactory (enable/disable + linked widgets)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -113,6 +113,12 @@
   gtk_dialog_add_action_widget (GTK_DIALOG (dialog), okbutton1, GTK_RESPONSE_OK);
   GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
   
+  /* Finalize them */
+  for(int i=0;i<nb;i++)
+  {
+    elems[i]->finalize();
+  }
+  
   // Show it & run
   gtk_register_dialog(dialog);
   if(GTK_RESPONSE_OK==gtk_dialog_run(GTK_DIALOG(dialog)))

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -129,11 +129,19 @@
   
 }
 
+void   diaElemFileRead::enable(uint32_t onoff)
+{
+     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+}
+
 void fileRead(void *w,void *p)
 {
   diaElemFileRead *me=(diaElemFileRead *)p;
   me->changeFile();
 }
+
+
+
 /*********************************************************************/
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_DIR_SELECT)
@@ -232,6 +240,10 @@
   }
   
 }
+void   diaElemDirSelect::enable(uint32_t onoff)
+{
+     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+}
 
 void dirSel(void *w,void *p)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -28,8 +28,9 @@
 #include "ADM_assert.h"
 
 
+static void cb_menu(void *w,void *p);
+static void cb_menus(void *w,void *p);
 
-
 diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
                const diaMenuEntry *menu,const char *tip)
   : diaElem(ELEM_MENU)
@@ -39,6 +40,7 @@
   this->tip=tip;
   this->menu=menu;
   this->nbMenu=nb;
+  nbLink=0;
 }
 
 diaElemMenu::~diaElemMenu()
@@ -84,6 +86,9 @@
   
   
   myWidget=(void *)combo;
+   gtk_signal_connect(GTK_OBJECT(combo), "changed",
+                      GTK_SIGNAL_FUNC(cb_menus),
+                      (void *) this);
 }
 
 void diaElemMenu::getMe(void)
@@ -98,7 +103,64 @@
   ADM_assert(rank<this->nbMenu);
   *(uint32_t *)param=this->menu[rank].val;
 }
-
+void   diaElemMenu::updateMe(void)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  uint32_t val;
+  uint32_t rank;
+  if(!nbMenu) return;
+  ADM_assert(widget);
+  
+  
+  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
+  ADM_assert(rank<this->nbMenu);
+  val=this->menu[rank].val;
+  /* Now search through the linked list to see if something happens ...*/
+  
+  /* 1 disable everything */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(!l->onoff)  l->widget->enable(0);
+    }else
+    {
+       if(l->onoff)  l->widget->enable(0);
+    }
+    
+  }
+  /* Then enable */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(l->onoff)  l->widget->enable(1);
+    }else
+    {
+       if(!l->onoff)  l->widget->enable(1);
+    }
+    
+  }
+}
+uint8_t   diaElemMenu::link(diaMenuEntry *entry,uint32_t onoff,diaElem *w)
+{
+    ADM_assert(nbLink<MENU_MAX_lINK);
+    links[nbLink].value=entry->val;
+    links[nbLink].onoff=onoff;
+    links[nbLink].widget=w;
+    nbLink++;
+    return 1;
+}
+void   diaElemMenu::enable(uint32_t onoff)
+{
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+}
+void   diaElemMenu::finalize(void)
+{
+  updateMe(); 
+}
 //*******************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
@@ -109,6 +171,7 @@
   this->tip=tip;
   this->menu=menu;
   this->nbMenu=nb;
+  nbLink=0;
 }
 
 diaElemMenuDynamic::~diaElemMenuDynamic()
@@ -151,9 +214,11 @@
       gtk_combo_box_set_active(GTK_COMBO_BOX(combo),i);
     }
   }
+  myWidget=(void *)combo;
+  gtk_signal_connect(GTK_OBJECT(combo), "changed",
+                      GTK_SIGNAL_FUNC(cb_menu),
+                      (void *) this);
   
-  
-  myWidget=(void *)combo;
 }
 
 void diaElemMenuDynamic::getMe(void)
@@ -170,8 +235,78 @@
   *(uint32_t *)param=this->menu[rank]->val;
 }
 
+uint8_t   diaElemMenuDynamic::link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w)
+{
+    ADM_assert(nbLink<MENU_MAX_lINK);
+    links[nbLink].value=entry->val;
+    links[nbLink].onoff=onoff;
+    links[nbLink].widget=w;
+    nbLink++;
+    return 1;
+}
 
+void   diaElemMenuDynamic::updateMe(void)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  uint32_t val;
+  uint32_t rank;
+  if(!nbMenu) return;
+  ADM_assert(widget);
+  
+  
+  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
+  ADM_assert(rank<this->nbMenu);
+  val=this->menu[rank]->val;
+  /* Now search through the linked list to see if something happens ...*/
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+   /* 1 disable everything */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(!l->onoff)  l->widget->enable(0);
+    }else
+    {
+       if(l->onoff)  l->widget->enable(0);
+    }
+    
+  }
+  /* Then enable */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(l->onoff)  l->widget->enable(1);
+    }else
+    {
+       if(!l->onoff)  l->widget->enable(1);
+    }
+    
+  }
+  }
+}
+void   diaElemMenuDynamic::finalize(void)
+{
+  updateMe(); 
+}
+void   diaElemMenuDynamic::enable(uint32_t onoff)
+{
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+}
+//** C callback **
+void cb_menu(void *w,void *p)
+{
+  diaElemMenuDynamic *me=(diaElemMenuDynamic *)p;
+  me->updateMe();
+}
+void cb_menus(void *w,void *p)
+{
+  diaElemMenu *me=(diaElemMenu *)p;
+  me->updateMe();
+}
 
-
-
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -141,7 +141,15 @@
 {
  
 }
-
+uint8_t   diaElemMenu::link(diaMenuEntry *entry,uint32_t onoff,diaElem *w)
+{
+}
+void   diaElemMenu::enable(uint32_t onoff)
+{}
+void diaElemMenu::finalize(void)
+{ 
+}
+//*****************
 diaElemFileRead::diaElemFileRead(char **filename,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_FILE_READ)
 {
@@ -161,7 +169,8 @@
 {
  
 }
-
+void   diaElemFileRead::enable(uint32_t onoff)
+{}
 #include "ADM_encoder/ADM_vidEncode.hxx"
   diaElemBitrate::diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_BITRATE)
@@ -222,6 +231,7 @@
 void diaElemDirSelect::getMe(void) {}
   
 void diaElemDirSelect::changeFile(void) {}
+void   diaElemDirSelect::enable(uint32_t onoff){}
 //******************************************************
 diaElemText::diaElemText(char **text,const char *toggleTitle,const char *tip)
     : diaElem(ELEM_NOTCH) {}
@@ -247,6 +257,14 @@
 void diaElemMenuDynamic::getMe(void)
 { 
 }
+uint8_t   diaElemMenuDynamic::link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w)
+{
+}
+void   diaElemMenuDynamic::enable(uint32_t onoff)
+{}
+void diaElemMenuDynamic::finalize(void)
+{ 
+}
 //******************************************************
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -82,6 +82,10 @@
   *(uint32_t *)param=menu[r].val;
       
 }
+void diaElemMenu::finalize(void)
+{ 
+}
+
 //*********************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
@@ -99,6 +103,9 @@
 void diaElemMenuDynamic::getMe(void)
 { 
 }
+void diaElemMenuDynamic::finalize(void)
+{ 
+}
 
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-04 18:14:17 UTC (rev 2920)
@@ -55,6 +55,9 @@
   virtual void getMe(void)=0;
           void setRo(void) {readOnly=1;}
           void setRw(void) {readOnly=0;}
+          
+  virtual void enable(uint32_t onoff) {printf("Enabling %d\n",onoff);}
+  virtual void finalize(void) {} // in case some widget needs some stuff just before using them
 };
 /*********************************************/
 class diaElemToggle : public diaElem
@@ -119,13 +122,10 @@
 typedef struct diaMenuEntry
 {
   public:
-  uint32_t    val;
-  const char *text;
-  const char *desc;
+    uint32_t    val;
+    const char *text;
+    const char *desc;
   public:
- /*   diaMenuEntry(uint32_t v,const char *t,const char *d) {val=v;t=ADM_strdup(t);desc=ADM_strdup(d);}
-    ~diaMenuEntry() { ADM_dealloc(text);ADM_dealloc(desc);}
-    */
 }diaMenuEntry;
 
 class diaMenuEntryDynamic : public diaMenuEntry
@@ -145,12 +145,23 @@
       }
     
 };
+//*******************************
+// static (i.e. hardcoded) menu
+//*******************************
+#define MENU_MAX_lINK 10
+typedef struct dialElemLink
+{
+  uint32_t  value;
+  uint32_t  onoff;
+  diaElem  *widget;
+}dialElemLink;
 
-// static (i.e. hardcoded) menu
 class diaElemMenu : public diaElem
 {
-const diaMenuEntry *menu;
-uint32_t     nbMenu;
+const diaMenuEntry  *menu;
+uint32_t            nbMenu;
+dialElemLink        links[MENU_MAX_lINK];
+uint32_t            nbLink;
 
 public:
   diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -159,20 +170,32 @@
   virtual ~diaElemMenu() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  uint8_t   link(diaMenuEntry *entry,uint32_t onoff,diaElem *w);
+  void      updateMe(void);
+  void      enable(uint32_t onoff) ;
+  void      finalize(void);;
 };
+//*******************************
 // Same but for dynamic menus
+//*******************************
 class diaElemMenuDynamic : public diaElem
 {
 diaMenuEntryDynamic **menu;
-uint32_t     nbMenu;
+uint32_t            nbMenu;
+dialElemLink        links[MENU_MAX_lINK];
+uint32_t            nbLink;
 
 public:
   diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                diaMenuEntryDynamic **menu,const char *tip=NULL);
   
-  virtual ~diaElemMenuDynamic() ;
-  void setMe(void *dialog, void *opaque,uint32_t line);
-  void getMe(void);
+  virtual   ~diaElemMenuDynamic() ;
+  void      setMe(void *dialog, void *opaque,uint32_t line);
+  void      getMe(void);
+  uint8_t   link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w);
+  void      updateMe(void);
+  void      enable(uint32_t onoff) ;
+  void      finalize(void);
 };
 /*************************************************/
 #include "ADM_encoder/ADM_vidEncode.hxx"
@@ -203,6 +226,7 @@
   void getMe(void);
   
   void changeFile(void);
+  void   enable(uint32_t onoff);
 };
 /*************************************************/
 class diaElemDirSelect : public diaElem
@@ -216,6 +240,7 @@
   void getMe(void);
   
   void changeFile(void);
+  void   enable(uint32_t onoff);
 };
 /*************************************************/
 /* The text MUST be copied internally ! */

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-03 20:05:55 UTC (rev 2919)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-04 18:14:17 UTC (rev 2920)
@@ -2028,6 +2028,13 @@
          diaElemMenuDynamic   sourceFromVideo(&newtrack,"Track from video",nb,sourceavitracks);
          diaElem *allWidgets[]={&sourceMenu,&sourceFromVideo,&sourceName};
          
+         /* Link..*/
+         sourceMenu.link(&(sourcesStream[0]),1,&sourceFromVideo);
+         sourceMenu.link(&(sourcesStream[2]),1,&sourceName);
+         sourceMenu.link(&(sourcesStream[3]),1,&sourceName);
+         sourceMenu.link(&(sourcesStream[4]),1,&sourceName);
+         
+         
          if( diaFactoryRun("Select Main audio Track",3,allWidgets))
          {
             switch( nw)



From mean at mail.berlios.de  Wed Apr  4 20:31:04 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 4 Apr 2007 20:31:04 +0200
Subject: [Avidemux-svn-commit] r2921 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
Message-ID: <200704041831.l34IV4eL016772@sheep.berlios.de>

Author: mean
Date: 2007-04-04 20:31:04 +0200 (Wed, 04 Apr 2007)
New Revision: 2921

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
Log:
stubs for QT4 concerning QT4 improvements

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-04 18:14:17 UTC (rev 2920)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-04 18:31:04 UTC (rev 2921)
@@ -44,6 +44,7 @@
   this->tip=tip;
   this->menu=menu;
   this->nbMenu=nb;
+  nbLink=0;
 }
 
 diaElemMenu::~diaElemMenu()
@@ -78,6 +79,7 @@
   QComboBox *combo=(QComboBox *)myWidget;
   int r;
   r=combo->currentIndex();
+  if(!nbMenu) return;
   ADM_assert(r<nbMenu);
   *(uint32_t *)param=menu[r].val;
       
@@ -85,27 +87,167 @@
 void diaElemMenu::finalize(void)
 { 
 }
+void diaElemMenu::enable(uint32_t onoff)
+{ 
+}
 
+uint8_t   diaElemMenu::link(diaMenuEntry *entry,uint32_t onoff,diaElem *w)
+{
+    ADM_assert(nbLink<MENU_MAX_lINK);
+    links[nbLink].value=entry->val;
+    links[nbLink].onoff=onoff;
+    links[nbLink].widget=w;
+    nbLink++;
+    return 1;
+}
+void   diaElemMenu::updateMe(void)
+{
+   QComboBox *combo=(QComboBox *)myWidget;
+  uint32_t val;
+  uint32_t rank;
+  if(!nbMenu) return;
+  
+  rank=combo->currentIndex();
+  ADM_assert(rank<this->nbMenu);
+  val=this->menu[rank].val;
+  /* Now search through the linked list to see if something happens ...*/
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+   /* 1 disable everything */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(!l->onoff)  l->widget->enable(0);
+    }else
+    {
+       if(l->onoff)  l->widget->enable(0);
+    }
+    
+  }
+  /* Then enable */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(l->onoff)  l->widget->enable(1);
+    }else
+    {
+       if(!l->onoff)  l->widget->enable(1);
+    }
+    
+  }
+  }
+}
 //*********************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
   : diaElem(ELEM_MENU)
 {
+   param=(void *)intValue;
+  paramTitle=shortkey(itle);
+  this->tip=tip;
+  this->menu=menu;
+  this->nbMenu=nb;
+  nbLink=0;
+  
 }
 
 diaElemMenuDynamic::~diaElemMenuDynamic()
 { 
+  if(paramTitle)
+    delete paramTitle;
 }
 void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
 {
+   QComboBox *combo=new QComboBox( (QWidget *)dialog);
+   QGridLayout *layout=(QGridLayout*) opaque;
+     myWidget=(void *)combo; 
+
+  QLabel *text=new QLabel( this->paramTitle,(QWidget *)dialog);
+  
+  // Fill in combobox
+  int mem=0;
+  diaMenuEntryDynamic **entries=menu;
+  for(int i=0;i<nbMenu;i++)
+  {
+    combo->addItem(entries[i]->text);
+    if( *(uint32_t *)param==entries[i]->val) mem=i;
+  }
+   combo->setCurrentIndex(mem);
+   text->setBuddy(combo);
+   layout->addWidget(text,line,0);
+   layout->addWidget(combo,line,1);
 }
 
 void diaElemMenuDynamic::getMe(void)
 { 
+   QComboBox *combo=(QComboBox *)myWidget;
+  int r;
+  if(!nbMenu) return;
+  r=combo->currentIndex();
+  ADM_assert(r<nbMenu);
+  *(uint32_t *)param=menu[r]->val;
+      
 }
 void diaElemMenuDynamic::finalize(void)
 { 
 }
-
-
+uint8_t   diaElemMenuDynamic::link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w)
+{
+    ADM_assert(nbLink<MENU_MAX_lINK);
+    links[nbLink].value=entry->val;
+    links[nbLink].onoff=onoff;
+    links[nbLink].widget=w;
+    nbLink++;
+    return 1;
+}
+void diaElemMenuDynamic::enable(uint32_t onoff)
+{
+}
+void   diaElemMenuDynamic::updateMe(void)
+{
+   QComboBox *combo=(QComboBox *)myWidget;
+  uint32_t val;
+  uint32_t rank;
+  if(!nbMenu) return;
+  
+  rank=combo->currentIndex();
+  ADM_assert(rank<this->nbMenu);
+  val=this->menu[rank]->val;
+  /* Now search through the linked list to see if something happens ...*/
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+   /* 1 disable everything */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(!l->onoff)  l->widget->enable(0);
+    }else
+    {
+       if(l->onoff)  l->widget->enable(0);
+    }
+    
+  }
+  /* Then enable */
+  for(int i=0;i<nbLink;i++)
+  {
+    dialElemLink *l=&(links[i]);
+    if(l->value==val)
+    {
+      if(l->onoff)  l->widget->enable(1);
+    }else
+    {
+       if(!l->onoff)  l->widget->enable(1);
+    }
+    
+  }
+  }
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-04-04 18:14:17 UTC (rev 2920)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-04-04 18:31:04 UTC (rev 2921)
@@ -126,6 +126,10 @@
   QString s=(fs->edit)->text();
   *n=ADM_strdup( s.toLatin1() );
 }
+void diaElemFileRead::enable(uint32_t onoff)
+{
+  
+}
 //****************************
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip)  : diaElem(ELEM_DIR_SELECT) 
 {
@@ -154,7 +158,11 @@
   QString s=(fs->edit)->text();
   *n=ADM_strdup( s.toLatin1() );
 }
+void diaElemDirSelect::enable(uint32_t onoff)
+{
   
+}
+  
 void diaElemDirSelect::changeFile(void) {}
 //EOF
 



From mean at mail.berlios.de  Wed Apr  4 21:04:33 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 4 Apr 2007 21:04:33 +0200
Subject: [Avidemux-svn-commit] r2922 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities
Message-ID: <200704041904.l34J4XMC019662@sheep.berlios.de>

Author: mean
Date: 2007-04-04 21:04:31 +0200 (Wed, 04 Apr 2007)
New Revision: 2922

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
Log:
added missing include

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-04-04 18:31:04 UTC (rev 2921)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-04-04 19:04:31 UTC (rev 2922)
@@ -31,6 +31,7 @@
 #include "ADM_encoder/ADM_vidEncode.hxx"
 
 #include "ADM_codecs/ADM_codec.h"
+#include "ADM_lavcodec.h"
 #include "ADM_codecs/ADM_ffmpeg.h"
 #include "admmangle.h"
 static uint8_t tinyAverage(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)



From mean at mail.berlios.de  Thu Apr  5 20:41:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 5 Apr 2007 20:41:30 +0200
Subject: [Avidemux-svn-commit] r2923 -
	branches/avidemux_2.4_branch/avidemux/ADM_audiofilter
Message-ID: <200704051841.l35IfUN4009520@sheep.berlios.de>

Author: mean
Date: 2007-04-05 20:41:28 +0200 (Thu, 05 Apr 2007)
New Revision: 2923

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
Log:
fix crash when DRC is on with normalize

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_limiter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2007-04-04 19:04:31 UTC (rev 2922)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_limiter.cpp	2007-04-05 18:41:28 UTC (rev 2923)
@@ -49,7 +49,7 @@
 
 AUDMAudioFilterLimiter::AUDMAudioFilterLimiter(AUDMAudioFilter *previous, DRCparam *param):AUDMAudioFilter (previous)
 {
-
+uint32_t nbChan=previous->getInfo()->channels;
 #define AMP 4
     _previous->rewind();
     memcpy(&_param,param,sizeof(_param));
@@ -58,8 +58,9 @@
 //
 
     mCircleSize=DRC_WINDOW;
+    mCircleSize=mCircleSize-(mCircleSize%nbChan);
     drc_cleanup();
-    printf("[DRC] Created\n");
+    printf("[DRC] Created DRC:%u Window:%u nbChan %u\n",mCircleSize,DRC_WINDOW,nbChan);
 
 };
 void AUDMAudioFilterLimiter::drc_cleanup(void)
@@ -111,6 +112,10 @@
   len=_tail-_head;
   if(len>max) len=max;
   if(len>=DELIM_WINDOW_SIZE) len=DELIM_WINDOW_SIZE-1;
+  
+  // Count in full sample  i.e. all channels
+  len=len-(len%_wavHeader.channels);
+  
   // Process..
   if (mLastLevel == 0.0) {
     int preSeed = mCircleSize;



From mean at mail.berlios.de  Thu Apr  5 21:07:46 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 5 Apr 2007 21:07:46 +0200
Subject: [Avidemux-svn-commit] r2924 - in
	branches/avidemux_2.4_branch/avidemux: ADM_audiofilter
	ADM_editor ADM_script
Message-ID: <200704051907.l35J7kN1011157@sheep.berlios.de>

Author: mean
Date: 2007-04-05 21:07:45 +0200 (Thu, 05 Apr 2007)
New Revision: 2924

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_AvidemuxAudio.h
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.h
Log:
also save DRC in project file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-04-05 19:07:45 UTC (rev 2924)
@@ -174,6 +174,10 @@
       return audioFreq;
         
 }
+uint32_t audioGetDrc(void)
+{
+  return audioDRC; 
+}
 uint32_t audioGetDelay(void)
 {
         if(audioShift && audioDelay)
@@ -242,6 +246,11 @@
 	else audioFilmConv=FILMCONV_NONE;
 	return 1;
 }
+uint8_t audioFilterDrc(uint8_t onoff)
+{
+  audioDRC=onoff;
+  return 1; 
+}
 uint8_t audioFilterPal2Film(uint8_t onoff)
 {
         if(onoff) audioFilmConv=FILMCONV_PAL2FILM;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-04-05 19:07:45 UTC (rev 2924)
@@ -100,7 +100,7 @@
 uint8_t audioFilterDelay(int32_t delay);
 uint8_t audioFilterFilm2Pal(uint8_t onoff);
 uint8_t audioFilterPal2Film(uint8_t onoff);
-
+uint8_t audioFilterDrc(uint8_t onoff);
 void audioFilter_SetBitrate( int i);
 /* -- Get filter -- */
 uint32_t audioGetBitrate(void);
@@ -109,6 +109,7 @@
 uint32_t audioGetResample(void);
 uint32_t audioGetDelay(void);
 FILMCONV audioGetFpsConv(void);
+uint32_t audioGetDrc(void);
 RESAMPLING  audioGetResampling(void);
 /*-----*/
 uint8_t                 A_changeAudioStream(AVDMGenericAudioStream *newaudio,AudioSource so,char *name);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edLoadSave.cpp	2007-04-05 19:07:45 UTC (rev 2924)
@@ -264,6 +264,9 @@
                 case RESAMPLING_CUSTOM:        qfprintf(fd,"app.audio.resample=%u;\n",audioGetResample());break;
                 default:ADM_assert(0);
         }
+        if (audioGetDrc()) qfprintf(fd,"app.audio.drc=true;\n");
+        
+        
   // Mixer
 
   // container

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_AvidemuxAudio.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_AvidemuxAudio.h	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_AvidemuxAudio.h	2007-04-05 19:07:45 UTC (rev 2924)
@@ -15,8 +15,10 @@
 	int m_nDelay;
 	bool m_bFilm2PAL;
 	bool m_bPAL2Film;
+        int  m_bDRC;
         int  m_nNormalizeMode;
         int  m_nNormalizeValue;
+        
 };
 
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2007-04-05 19:07:45 UTC (rev 2924)
@@ -46,6 +46,7 @@
         { "film2pal", film2pal_prop, JSPROP_ENUMERATE },	// convert film to pal
         { "pal2film", pal2film_prop, JSPROP_ENUMERATE },	// convert pal to film
         { "normalizeMode", normalizemode_prop, JSPROP_ENUMERATE },	//
+        { "drc", drc_prop, JSPROP_ENUMERATE },	//
         { "normalizeValue", normalizevalue_prop, JSPROP_ENUMERATE },	//
         { 0 }
 };
@@ -149,7 +150,9 @@
                         case normalizevalue_prop:
                           *vp = BOOLEAN_TO_JSVAL(priv->getObject()->m_nNormalizeValue);
                           break;
-
+                        case drc_prop:
+                            *vp = BOOLEAN_TO_JSVAL(priv->getObject()->m_bDRC);
+                            break;
 /*
                         case audio_prop:
                                 *vp = OBJECT_TO_JSVAL(priv->getObject()->m_pAudio);
@@ -178,6 +181,16 @@
                                 leaveLock();
                                 break;
                         }
+                        case drc_prop:
+                        {
+                                if(JSVAL_IS_BOOLEAN(*vp) == false)
+                                        break;
+                                priv->getObject()->m_bDRC = JSVAL_TO_BOOLEAN(*vp);
+                                enterLock();
+                                audioFilterDrc(priv->getObject()->m_bDRC);
+                                leaveLock();
+                                break;
+                        }
                         case resample_prop:
                         {
                                 if(JSVAL_IS_INT(*vp) == false)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.h	2007-04-05 18:41:28 UTC (rev 2923)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemuxAudio.h	2007-04-05 19:07:45 UTC (rev 2924)
@@ -41,7 +41,8 @@
 		film2pal_prop,
 		pal2film_prop,
                 normalizemode_prop,
-                normalizevalue_prop
+                normalizevalue_prop,
+                drc_prop
 	};
 	static JSClass m_classAvidemuxAudio;
         



From mean at mail.berlios.de  Thu Apr  5 21:21:02 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 5 Apr 2007 21:21:02 +0200
Subject: [Avidemux-svn-commit] r2925 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_audiofilter
Message-ID: <200704051921.l35JL29c011962@sheep.berlios.de>

Author: mean
Date: 2007-04-05 21:21:01 +0200 (Thu, 05 Apr 2007)
New Revision: 2925

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp
   branches/avidemux_2.4_branch/configure.in.in
Log:
grunster : aften 0.6 support

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp	2007-04-05 19:07:45 UTC (rev 2924)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp	2007-04-05 19:21:01 UTC (rev 2925)
@@ -33,7 +33,11 @@
 //
 extern "C"
 {
-#include "aften/aften.h"
+#ifdef USE_AFTEN_06
+	#include "aften.h"
+#else
+	#include "aften/aften.h"
+#endif
 };
 #include "ADM_audiofilter/audioencoder_aften_param.h"
 #include "ADM_audiofilter/audioencoder_aften.h"
@@ -76,7 +80,13 @@
 
 
 int ret=0;
+
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
 int mask;
+#else
+unsigned int mask;
+#endif
+
     _wavheader->byterate=(config->bitrate*1000)/8;
     _HANDLE->sample_format=A52_SAMPLE_FMT_FLT;
     _HANDLE->channels=_wavheader->channels;
@@ -92,7 +102,13 @@
         case 5: mask = 0x37;  break;
         case 6: mask = 0x3F;  break;
       }
-      aften_wav_chmask_to_acmod(_wavheader->channels, mask, &(_HANDLE->acmod), &(_HANDLE->lfe));
+
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
+	aften_wav_chmask_to_acmod(_wavheader->channels, mask, &(_HANDLE->acmod), &(_HANDLE->lfe));
+#else
+	aften_wav_channels_to_acmod(_wavheader->channels, mask, &(_HANDLE->acmod), &(_HANDLE->lfe));
+#endif
+
    //   _HANDLE->params.verbose=2;
     int er= aften_encode_init(_HANDLE);
     if(er<0)
@@ -122,8 +138,13 @@
         }
         ptr=(void *)&(tmpbuffer[tmphead]);
         ADM_assert(tmptail>=tmphead);
-        aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels,A52_SAMPLE_FMT_FLT,  (_HANDLE->acmod), (_HANDLE->lfe));
 
+#ifdef USE_AFTEN_05
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, (_HANDLE->acmod), (_HANDLE->lfe));
+#else
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, (_HANDLE->acmod));
+#endif
+
         r=aften_encode_frame(_HANDLE, dest,(void *)ptr);
         if(r<0)
         {

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-05 19:07:45 UTC (rev 2924)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-05 19:21:01 UTC (rev 2925)
@@ -404,16 +404,15 @@
 have_libdca=yes
 have_aften=yes
 have_nspr=yes
+
 dnl ____________________ Cygwin / mingwin ? ___________
 use_cygwin=no
 AC_MSG_CHECKING(win32 host)
 
-
 AC_TRY_COMPILE([
-	#if !defined(__CYGWIN__) &&!defined(__MINGW32__)
+	#if !defined(__CYGWIN__) && !defined(__MINGW32__)
 		#error
 	#endif
-
 ],
 int z=0
 ,[
@@ -486,16 +485,66 @@
 if test "x$with_aften" = "xno"; then
    have_aften=no
 fi
-if test "x$with_aften" != "xno"; then
-AC_MSG_CHECKING(for aften codec )
-AC_CHECK_HEADER(aften/aften.h,,have_aften=no)
+
 if test "x$have_aften" = "xyes"; then
- AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm )
+	AC_MSG_CHECKING([for aften codec])
+	AC_CHECK_HEADER(aften/aften.h,aften_header=aften/aften.h,have_aften=no)
+	
+	if test "x$have_aften" = "xno"; then
+		have_aften=yes
+		AC_CHECK_HEADER(aften.h,aften_header=aften.h,have_aften=no)		
+	fi
 fi
+
+if test "x$have_aften" = "xyes"; then
+	AC_LANG_PUSH(C++)
+	AC_TRY_RUN([
+		#include "$aften_header"
+
+		int determineVersion(char *version)
+		{
+			if (version == "0.06") { return 6; } else { return 0; }
+		}
+		
+		int determineVersion(double version)
+		{
+			if (version == 0.05) { return 5; } else { return 0; }
+		}
+		
+		int main()
+		{
+			// AFTEN_VERSION is deprecated after v0.06 so if this compiles the version must be <= 0.06
+			return determineVersion(AFTEN_VERSION);
+		}
+	])
+	AC_LANG_POP()
+
+	if test "x$ac_status" = "x5"; then
+		aften_version="0.05"
+		AC_DEFINE(USE_AFTEN_05, 1, [Use Aften 0.05 or earlier])
+		AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm)
+	else
+		if test "x$ac_status" = "x6"; then
+			aften_version="0.06"
+			AC_DEFINE(USE_AFTEN_06, 1, [Use Aften 0.06])
+			AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm)
+		else
+			AC_CHECK_LIB(aften,aften_get_version,,have_aften=no,-lm)
+			
+			if test "x$have_aften" = "xno"; then			
+				aften_version="unsupported"
+			else
+				aften_version=">= 0.06"
+			fi
+		fi
+	fi
+
+	AC_MSG_CHECKING([version of Aften])	
+	AC_MSG_RESULT($aften_version)
 fi
 
 if test "x$have_aften" = "xyes"; then
-AC_DEFINE(USE_AFTEN,1,[use aften ac3 encoder])
+	AC_DEFINE(USE_AFTEN,1,[use aften ac3 encoder])
 fi
 
 dnl __________________x264_________________
@@ -574,13 +623,9 @@
 	fi
  fi
 
-dnl __________________FFMPEG______________
-
-dnl __________________/FFMPEG______________
 dnl __________________OS dep stuff_____________
 
 dnl __________________Lrintf_____________
-
 have_lrintf=no
 AC_MSG_CHECKING(for lrintf in math.h)
 AC_TRY_COMPILE([
@@ -595,8 +640,8 @@
   AC_DEFINE(HAVE_LRINTF,1,[roundup function])
 fi
 AC_MSG_RESULT($have_lrintf)
+
 dnl __________________fast int_____________
-
 have_fastint=no
 AC_MSG_CHECKING(for fastint)
 AC_TRY_COMPILE([



From mean at mail.berlios.de  Sat Apr  7 10:58:46 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 7 Apr 2007 10:58:46 +0200
Subject: [Avidemux-svn-commit] r2926 - in
	branches/avidemux_2.4_branch/avidemux: ADM_outputs/oplug_avi
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200704070858.l378wk3q010280@sheep.berlios.de>

Author: mean
Date: 2007-04-07 10:58:39 +0200 (Sat, 07 Apr 2007)
New Revision: 2926

Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_muxer.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
Log:
redone avi muxer with dialog factory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -58,13 +58,49 @@
 
 
 #include "ADM_audiofilter/audioeng_buildfilters.h"
-
+#include "DIA_factory.h"
 const char *getStrFromAudioCodec( uint32_t codec);
 //_________________________
 uint8_t ADM_aviUISetMuxer(  void )
 {
-	return DIA_setUserMuxParam ((int *) &muxMode, (int *) &muxParam, (int *) &muxSize);
-}
+  
+//	return DIA_setUserMuxParam ((int *) &muxMode, (int *) &muxParam, (int *) &muxSize);
+  uint32_t mux_n_frame=muxParam;
+  uint32_t mux_size_block=muxParam;
+  uint32_t mux_mode=(uint32_t)muxMode;
+  
+  
+  diaMenuEntry muxingType[]={
+  {MUX_REGULAR,_("Normal")},
+  {MUX_N_FRAMES,_("Mux every N video frames")},
+  {MUX_N_BYTES,_("Mux by packet size")}
+  };
+  
+    diaElemMenu      mux(&(mux_mode),_("Muxing Type"),3,muxingType);
+    diaElemUInteger blockSize(&(muxSize),_("Split every MBytes"),1,9000);
+    
+    diaElemUInteger n_frames(&(mux_n_frame),_("Mux Every x video frames"),1,100);
+    diaElemUInteger n_block(&(mux_size_block),_("Mux with block of size"),1,50000);
+    
+    
+     mux.link(&(muxingType[1]),1,&n_frames);
+     mux.link(&(muxingType[2]),1,&n_block);
+    
+     diaElem *elems[4]={&mux,&n_frames,&n_block,&blockSize};
+     if( diaFactoryRun("Mpeg2 Encoding",4,elems))
+    {
+      muxMode=(PARAM_MUX)mux_mode;
+      switch(muxMode)
+      {
+        case MUX_REGULAR: muxParam=1;break;
+        case MUX_N_FRAMES: muxParam=mux_n_frame;break;
+        case MUX_N_BYTES: muxParam=mux_size_block;break;
+        default: ADM_assert(0);
+      }
+      return 1;
+    }
+    return 0;
+};
 
 
 //_______ set the autosplit size

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_muxer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_muxer.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_muxer.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -1,240 +0,0 @@
-
-#include <config.h>
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-
-#include "default.h"
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
-
-
-
-
-//#include "avi_vars.h"
-
-#include "ADM_assert.h" 
-
-#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
-
-
-
-#include "oplug_avi/GUI_mux.h"
-
-static GtkWidget	*create_dialog1 (void);
-
-#define ADJ_SET(widget_name,value) gtk_adjustment_set_value( GTK_ADJUSTMENT(gtk_spin_button_get_adjustment (GTK_SPIN_BUTTON (WID(widget_name)))),value)
-#define ADJ_GET(widget_name) (int)gtk_adjustment_get_value( GTK_ADJUSTMENT(gtk_spin_button_get_adjustment (GTK_SPIN_BUTTON (WID(widget_name)))))
-#define WID(x) lookup_widget(dialog,#x)
-
-uint8_t  DIA_setUserMuxParam( int *mode, int *param, int *muxsize)
-{
-
-  GtkWidget *dialog;
-
-	// gchar *str;
-	// char string[200];
-	int ret=0;
-
-                dialog=create_dialog1();
-//		gtk_transient(dialog);
-                gtk_register_dialog(dialog);
-                switch(*mode)
-                	{
-                   	case MUX_REGULAR:
-					RADIO_SET(radioN,1);
-					ADJ_SET(spinFrame,1);
-		                    	break;
-                   	case MUX_N_FRAMES:
-					RADIO_SET(radioN,1);
-					ADJ_SET(spinFrame,*param);
-		                    	break;
-                	case MUX_N_BYTES:
-					ADJ_SET(spinSize,*param);
-					RADIO_SET(radioBytes,1);
-         				break  ;
-               		default:
-                 				ADM_assert(0);
-                     }
-		ADJ_SET(spinbutton3,*muxsize);
-
-             if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-		{
-				int r; // ,value=0;
-				ret=1;
-				r=(RADIO_GET(radioN))+(2*RADIO_GET(radioBytes));
-				printf("\n r: %d \n",r);
-				switch(r)
-				{
-					case 1: // every or N
-							*param=ADJ_GET(spinFrame);
-							if(*param==1)
-								*mode=MUX_REGULAR;
-							else
-								*mode=MUX_N_FRAMES;
-							break;
-					case 2: // byte
-							*mode=MUX_N_BYTES;
-							*param=ADJ_GET(spinSize);
-							break;
-					default:
-							ADM_assert(0);
-							break;
-				}
-
-	        	        	*muxsize=ADJ_GET(spinbutton3);
-            }
-        gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-	 return ret;
-}
-
-GtkWidget	*create_dialog1 (void)
-{
-  GtkWidget *dialog;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *table1;
-  GtkWidget *radioN;
-  GSList *radioN_group = NULL;
-  GtkWidget *radioBytes;
-  GtkObject *spinFrame_adj;
-  GtkWidget *spinFrame;
-  GtkObject *spinSize_adj;
-  GtkWidget *spinSize;
-  GtkWidget *label1;
-  GtkWidget *label2;
-  GtkWidget *label3;
-  GtkObject *spinbutton3_adj;
-  GtkWidget *spinbutton3;
-  GtkWidget *label4;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog), _("AVI muxer options"));
-  gtk_window_set_modal (GTK_WINDOW (dialog), TRUE);
-
-  dialog_vbox1 = GTK_DIALOG (dialog)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  table1 = gtk_table_new (3, 3, FALSE);
-  gtk_widget_show (table1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), table1, TRUE, TRUE, 0);
-  gtk_container_set_border_width (GTK_CONTAINER (table1), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table1), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table1), 5);
-
-  radioN = gtk_radio_button_new_with_mnemonic (NULL, _("Mux audio every"));
-  gtk_widget_show (radioN);
-  gtk_table_attach (GTK_TABLE (table1), radioN, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radioN), radioN_group);
-  radioN_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radioN));
-
-  radioBytes = gtk_radio_button_new_with_mnemonic (NULL, _("Split in packets of"));
-  gtk_widget_show (radioBytes);
-  gtk_table_attach (GTK_TABLE (table1), radioBytes, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radioBytes), radioN_group);
-  radioN_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radioBytes));
-
-  spinFrame_adj = gtk_adjustment_new (1, 0, 100, 1, 10, 10);
-  spinFrame = gtk_spin_button_new (GTK_ADJUSTMENT (spinFrame_adj), 1, 0);
-  gtk_widget_show (spinFrame);
-  gtk_table_attach (GTK_TABLE (table1), spinFrame, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  spinSize_adj = gtk_adjustment_new (2048, 0, 100000, 1, 10, 10);
-  spinSize = gtk_spin_button_new (GTK_ADJUSTMENT (spinSize_adj), 1, 0);
-  gtk_widget_show (spinSize);
-  gtk_table_attach (GTK_TABLE (table1), spinSize, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  label1 = gtk_label_new (_("video frame(s)"));
-  gtk_widget_show (label1);
-  gtk_table_attach (GTK_TABLE (table1), label1, 2, 3, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label1), 0, 0.5);
-
-  label2 = gtk_label_new (_("bytes"));
-  gtk_widget_show (label2);
-  gtk_table_attach (GTK_TABLE (table1), label2, 2, 3, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
-
-  label3 = gtk_label_new (_("Autosplit file every"));
-  gtk_widget_show (label3);
-  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
-
-  spinbutton3_adj = gtk_adjustment_new (4090, 10, 4095, 1, 10, 10);
-  spinbutton3 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton3_adj), 1, 0);
-  gtk_widget_show (spinbutton3);
-  gtk_table_attach (GTK_TABLE (table1), spinbutton3, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  label4 = gtk_label_new (_("megabytes"));
-  gtk_widget_show (label4);
-  gtk_table_attach (GTK_TABLE (table1), label4, 2, 3, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label4), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
-
-  dialog_action_area1 = GTK_DIALOG (dialog)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog, dialog, "dialog");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog, table1, "table1");
-  GLADE_HOOKUP_OBJECT (dialog, radioN, "radioN");
-  GLADE_HOOKUP_OBJECT (dialog, radioBytes, "radioBytes");
-  GLADE_HOOKUP_OBJECT (dialog, spinFrame, "spinFrame");
-  GLADE_HOOKUP_OBJECT (dialog, spinSize, "spinSize");
-  GLADE_HOOKUP_OBJECT (dialog, label1, "label1");
-  GLADE_HOOKUP_OBJECT (dialog, label2, "label2");
-  GLADE_HOOKUP_OBJECT (dialog, label3, "label3");
-  GLADE_HOOKUP_OBJECT (dialog, spinbutton3, "spinbutton3");
-  GLADE_HOOKUP_OBJECT (dialog, label4, "label4");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog, okbutton1, "okbutton1");
-
-  return dialog;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-07 08:58:39 UTC (rev 2926)
@@ -12,7 +12,7 @@
 	DIA_properties.cpp DIA_mjpeg.cpp DIA_about.cpp DIA_recent.cpp \
 	DIA_resize.cpp DIA_working.cpp \
 	DIA_working.h DIA_busy.cpp DIA_busy.h DIA_exLame.cpp DIA_pipe.cpp DIA_mpeg2opt.cpp \
-	DIA_xvcd.cpp DIA_muxer.cpp \
+	DIA_xvcd.cpp  \
 	DIA_xvid.cpp DIA_crop.cpp DIA_color.cpp DIA_encoding.cpp   \
 	DIA_requant.cpp DIA_xvid4.cpp DIA_lavcodec.cpp \
 	DIA_pause.cpp \
@@ -42,7 +42,7 @@
 DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp    DIA_rotate.cpp \
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
 DIA_about.cpp        DIA_tdeint.cpp \
-DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp     DIA_muxer.cpp       DIA_v2v.cpp \
+DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp   DIA_v2v.cpp \
 DIA_animated.cpp     DIA_hue.cpp          DIA_ocr.cpp         DIA_vcodec.cpp \
 DIA_asharp.cpp       DIA_idx_pg.cpp       DIA_partial.cpp     DIA_vobsub.cpp \
 DIA_audio.cpp        DIA_idx_pg.h         DIA_pause.cpp       \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -85,5 +85,10 @@
   if(*val<min) *val=min;
   if(*val>max) *val=max;
 }
+void diaElemFloat::enable(uint32_t onoff)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -86,6 +86,13 @@
   if(*val>max) *val=max;
   
 }
+
+void diaElemInteger::enable(uint32_t onoff)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
+
 //**********************************************************************************
 
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
@@ -146,6 +153,11 @@
   if(*val>max) *val=max;
 
 }
+void diaElemUInteger::enable(uint32_t onoff)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
 
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -62,5 +62,9 @@
   ADM_assert(widget);
   *(uint32_t *)param=gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (widget));
 }
-
+void diaElemToggle::enable(uint32_t onoff)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -42,7 +42,7 @@
 void diaElemToggle::getMe(void)
 {
 }
-
+void diaElemToggle::enable(uint32_t onoff) {}
 //******************************************************
 diaElemInteger::diaElemInteger(int32_t *intValue,const char *toggleTitle, int32_t min, int32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -61,7 +61,7 @@
 {
  
 }
-
+void diaElemInteger::enable(uint32_t onoff) {}
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -80,7 +80,7 @@
 {
  
 }
-
+void diaElemUInteger::enable(uint32_t onoff) {}
 //******************************************************
 
 diaElemFloat::diaElemFloat(ELEM_TYPE_FLOAT *intValue,const char *toggleTitle, 
@@ -101,6 +101,7 @@
 {
  
 }
+void diaElemFloat::enable(uint32_t onoff) {}
 //******************************************************
 
 diaElemBar::diaElemBar(uint32_t percent,const char *toggleTitle)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -76,4 +76,5 @@
  if(val>max) val=max;
  *(ELEM_TYPE_FLOAT *)param=val;
  
-}
\ No newline at end of file
+}
+void diaElemFloat::enable(uint32_t onoff) {}
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -79,6 +79,7 @@
  *(int32_t *)param=val;
  
 }
+void diaElemInteger::enable(uint32_t onoff) {}
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -124,6 +125,6 @@
 
 }
 
+void diaElemUInteger::enable(uint32_t onoff) {}
 
-
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-04-07 08:58:39 UTC (rev 2926)
@@ -71,9 +71,9 @@
   }else
     *val=0;
 }
+void diaElemToggle::enable(uint32_t onoff) {}
 
 
-
 //******************************************************
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-05 19:21:01 UTC (rev 2925)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-07 08:58:39 UTC (rev 2926)
@@ -68,6 +68,7 @@
   virtual ~diaElemToggle() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  void      enable(uint32_t onoff) ;
 };
 /*********************************************/
 class diaElemInteger : public diaElem
@@ -79,6 +80,7 @@
   virtual ~diaElemInteger() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  void      enable(uint32_t onoff) ;
 };
 /* Same but unsigned */
 class diaElemUInteger : public diaElem
@@ -90,6 +92,7 @@
   virtual ~diaElemUInteger() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  void      enable(uint32_t onoff) ;
   
 };
 /*************************************************/
@@ -117,6 +120,7 @@
   virtual ~diaElemFloat() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  void      enable(uint32_t onoff) ;
 };
 /*************************************************/
 typedef struct diaMenuEntry



From mean at mail.berlios.de  Thu Apr 12 17:39:09 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 12 Apr 2007 17:39:09 +0200
Subject: [Avidemux-svn-commit] r2927 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI ADM_video
Message-ID: <200704121539.l3CFd9D7028673@sheep.berlios.de>

Author: mean
Date: 2007-04-12 17:39:08 +0200 (Thu, 12 Apr 2007)
New Revision: 2927

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
updated dialogFactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -1,144 +0,0 @@
-//
-
-# include <config.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-#include "config.h"
-
-#include "default.h"
-#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
-
-static GtkWidget        *create_dialog1 (void);
-
-
-#define SPIN_GET(x,y) {*y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-                                printf(#x":%d\n",*y);}
-
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)*y) ; \
-                                printf(#x":%d\n",*y);}
-static GtkWidget *create_dialog1 (void);
-uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss);
-uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss)
-{
-GtkWidget *dialog;
-uint8_t ret;
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-        ret=0;
-
-        SPIN_SET(spinbuttonH,hh);
-        SPIN_SET(spinbuttonM,mm);
-        SPIN_SET(spinbuttonS,ss);
-        if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-        {
-                SPIN_GET(spinbuttonH,hh);
-                SPIN_GET(spinbuttonM,mm);
-                SPIN_GET(spinbuttonS,ss);
-                ret=1;
-        }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        return ret;
-
-}
-
-GtkWidget *create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *hbox1;
-  GtkObject *spinbuttonH_adj;
-  GtkWidget *spinbuttonH;
-  GtkWidget *label1;
-  GtkObject *spinbuttonM_adj;
-  GtkWidget *spinbuttonM;
-  GtkWidget *label2;
-  GtkObject *spinbuttonS_adj;
-  GtkWidget *spinbuttonS;
-  GtkWidget *label3;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _("Go to time"));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), hbox1, TRUE, TRUE, 0);
-
-  spinbuttonH_adj = gtk_adjustment_new (0, 0, 10, 1, 10, 10);
-  spinbuttonH = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonH_adj), 1, 0);
-  gtk_widget_show (spinbuttonH);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonH, TRUE, TRUE, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonH), TRUE);
-
-  label1 = gtk_label_new (_("h"));
-  gtk_widget_show (label1);
-  gtk_box_pack_start (GTK_BOX (hbox1), label1, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  spinbuttonM_adj = gtk_adjustment_new (0, 0, 59, 1, 10, 10);
-  spinbuttonM = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonM_adj), 1, 0);
-  gtk_widget_show (spinbuttonM);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonM, TRUE, TRUE, 0);
-
-  label2 = gtk_label_new (_("mn"));
-  gtk_widget_show (label2);
-  gtk_box_pack_start (GTK_BOX (hbox1), label2, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-
-  spinbuttonS_adj = gtk_adjustment_new (0, 0, 59, 1, 10, 10);
-  spinbuttonS = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonS_adj), 1, 0);
-  gtk_widget_show (spinbuttonS);
-  gtk_box_pack_start (GTK_BOX (hbox1), spinbuttonS, TRUE, TRUE, 0);
-
-  label3 = gtk_label_new (_("s"));
-  gtk_widget_show (label3);
-  gtk_box_pack_start (GTK_BOX (hbox1), label3, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, "hbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonH, "spinbuttonH");
-  GLADE_HOOKUP_OBJECT (dialog1, label1, "label1");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonM, "spinbuttonM");
-  GLADE_HOOKUP_OBJECT (dialog1, label2, "label2");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonS, "spinbuttonS");
-  GLADE_HOOKUP_OBJECT (dialog1, label3, "label3");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-
-  gtk_widget_grab_default (okbutton1);
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
@@ -26,7 +26,6 @@
         DIA_preview.cpp \
         DIA_contrast.cpp \
         DIA_srt.cpp \
-        DIA_rotate.cpp \
 	DIA_coloryuv.cpp \
 	DIA_quota.cpp \
 	DIA_animated.cpp \
@@ -39,7 +38,7 @@
 DIA_mcdeint.cpp     DIA_resize.cpp \
 DIA_cnr2.cpp          DIA_mjpeg.cpp       \
 DIA_color.cpp         DIA_eq2.cpp          \
-DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp    DIA_rotate.cpp \
+DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp     \
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
 DIA_about.cpp        DIA_tdeint.cpp \
 DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp   DIA_v2v.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -41,6 +41,12 @@
 
 diaElemFileRead::~diaElemFileRead()
 {
+GtkWidget **wid=(GtkWidget **)myWidget;
+        if(wid)
+        {
+            delete [] wid;
+            myWidget=NULL;
+        }
   
 }
 void diaElemFileRead::setMe(void *dialog, void *opaque,uint32_t line)
@@ -96,27 +102,29 @@
   g_signal_connect(GTK_OBJECT(button), "clicked",
                     GTK_SIGNAL_FUNC(fileRead),  this);
 
+  GtkWidget **w=new GtkWidget *[2];
+  w[0]=entry;
+  w[1]=button;
+  myWidget=(void *)w;
   
-  myWidget=(void *)entry;
-  
 }
 void diaElemFileRead::getMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
+  GtkWidget **widget=(GtkWidget **)myWidget;
   char **name=(char **)param;
   if(*name) delete [] *name;
   *name=NULL;
-  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (myWidget)));
+  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
 }
 
 void diaElemFileRead::changeFile(void)
 {
 #define MAX_SEL 200
   char buffer[MAX_SEL+1];
-  
-  GtkWidget *widget=(GtkWidget *)myWidget;
+  GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=(GtkWidget *)wid[0];
   const char *txt;
-  txt =gtk_entry_get_text (GTK_ENTRY (myWidget));
+  txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
   if(FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt))
   {
@@ -124,14 +132,16 @@
     if(*name) delete [] *name;
     *name=NULL;
     *name =ADM_strdup(buffer);
-     gtk_entry_set_text (GTK_ENTRY (myWidget), *name);
+     gtk_entry_set_text (GTK_ENTRY (widget), *name);
   }
   
 }
 
 void   diaElemFileRead::enable(uint32_t onoff)
 {
-     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+GtkWidget **wid=(GtkWidget **)myWidget;
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[0]),onoff);  
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
 }
 
 void fileRead(void *w,void *p)
@@ -153,7 +163,12 @@
 
 diaElemDirSelect::~diaElemDirSelect()
 {
-  
+  GtkWidget **wid=(GtkWidget **)myWidget;
+        if(wid)
+        {
+            delete [] wid;
+            myWidget=NULL;
+        }
 }
 void diaElemDirSelect::setMe(void *dialog, void *opaque,uint32_t line)
 {
@@ -209,26 +224,32 @@
                     GTK_SIGNAL_FUNC(dirSel),  this);
 
   
-  myWidget=(void *)entry;
+   GtkWidget **w=new GtkWidget *[2];
+  w[0]=entry;
+  w[1]=button;
+  myWidget=(void *)w;
   
 }
 void diaElemDirSelect::getMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
+GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=wid[0];
   char **name=(char **)param;
   if(*name) delete [] *name;
   *name=NULL;
-  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (myWidget)));
+  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget)));
 }
 
 void diaElemDirSelect::changeFile(void)
 {
 #define MAX_SEL 200
   char buffer[MAX_SEL+1];
+  GtkWidget **wid=(GtkWidget **)myWidget;
+  GtkWidget *widget=wid[0];
+
   
-  GtkWidget *widget=(GtkWidget *)myWidget;
   const char *txt;
-  txt =gtk_entry_get_text (GTK_ENTRY (myWidget));
+  txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
   if(FileSel_SelectDir(paramTitle,buffer,MAX_SEL,txt))
   {
@@ -236,13 +257,16 @@
     if(*name) delete [] *name;
     *name=NULL;
     *name =ADM_strdup(buffer);
-     gtk_entry_set_text (GTK_ENTRY (myWidget), *name);
+     gtk_entry_set_text (GTK_ENTRY (widget), *name);
   }
   
 }
 void   diaElemDirSelect::enable(uint32_t onoff)
 {
-     gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+    GtkWidget **wid=(GtkWidget **)myWidget;
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[0]),onoff);  
+     gtk_widget_set_sensitive(GTK_WIDGET(wid[1]),onoff);  
+
 }
 
 void dirSel(void *w,void *p)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
@@ -3,7 +3,7 @@
 libADM_CommonUI_a_SOURCES = GUI_sdlRender.cpp  GUI_xvRender.cpp  \
 DIA_resizeWiz.cpp DIA_builtin.cpp DIA_postproc.cpp DIA_enter.cpp \
 DIA_audioconfig.cpp GUI_render.cpp DIA_SVCD.cpp DIA_DVDff.cpp \
-DIA_bitrateHisto.cpp DIA_prefs.cpp
+DIA_bitrateHisto.cpp DIA_prefs.cpp DIA_gototime.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -25,23 +25,47 @@
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidRotate.h"
+//#include "ADM_video/ADM_vidRotate.h"
 #include "ADM_filter/video_filters.h"
 #include <ADM_assert.h>
+        
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
 
+typedef struct ROTATE_PARAM
+{
+  uint32_t width;
+  uint32_t height;
+  uint32_t angle;
+}ROTATE_PARAM;
+
+class  ADMVideoRotate:public AVDMGenericVideoStream
+{
+
+ protected:
+  virtual char                  *printConf(void);
+  ROTATE_PARAM                  *_param;
+
+ public:
+                  ADMVideoRotate(AVDMGenericVideoStream *in, CONFcouple *setup);
+  virtual         ~ADMVideoRotate();
+  virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
+  virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
+  virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
+ }     ;
+
 static FILTER_PARAM rotpParam={3,{"width","height","angle"}};
 
 
 SCRIPT_CREATE(rotate_script,ADMVideoRotate,rotpParam);
 BUILD_CREATE(rotate_create,ADMVideoRotate);
 
-uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param);
+static void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle);
 
 char *ADMVideoRotate::printConf( void )
 {
   static char buf[50];
  	
-  sprintf((char *)buf," Rotate %3.2f degrees", _param->angle);
+  sprintf((char *)buf," Rotate %u degrees", _param->angle);
   return buf;
 }
 
@@ -69,7 +93,7 @@
   {
     _param = NEW( ROTATE_PARAM);
     printf("New Angle 0.0\n");
-    _param->angle = 0.0;
+    _param->angle = 0;
     _param->width = _info.width;
     _param->height = _info.height;
   }
@@ -124,117 +148,140 @@
   return 1;
 }
 
-void do_rotate(ADMImage *source,ADMImage *target,float angle)
-    //uint8_t *out, uint32_t *out_w, uint32_t *out_h)
+void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle)
 {
-  uint8_t *in;
-  uint32_t in_w,in_h;
+uint8_t *in;
+uint32_t in_w,in_h;
 
-  in=source->data;
-  in_w=source->_width;
-  in_h=source->_height;
+in=source->data;
+in_w=source->_width;
+in_h=source->_height;
 
-  uint32_t x, y;
-  uint32_t u_offset = (in_w * in_h);
-  uint32_t v_offset = u_offset + (in_w/2 * in_h/2);
-  uint32_t in_sub_w = in_w/2;
-  uint32_t in_sub_h = in_h/2;
-  uint32_t out_sub_w, out_sub_h;
-  
-  uint8_t *out=target->data;
-  uint32_t *out_w=&(target->_width);
-  uint32_t *out_h=&(target->_height);
-  
-  ADM_assert(in_w*in_h==(*out_w)*(*out_h));
-  
-  // In general, for 0 <= i < width and 0 <= j < height, the pixel (x + i, y + j) is colored with red value 
-  // red value   rgb_buf[(j * rowstride) + (i * 3) + 0], 
-  // green value rgb_buf[(j * rowstride) + (i * 3) + 1], 
-  // blue value  rgb_buf[(j * rowstride) + (i * 3) + 2].
+uint32_t x, y;
+uint32_t u_offset = (in_w * in_h);
+uint32_t v_offset = u_offset + (in_w/2 * in_h/2);
+uint32_t in_sub_w = in_w/2;
+uint32_t in_sub_h = in_h/2;
+uint32_t out_sub_w, out_sub_h;
 
-  if((angle >= 0.0) && (angle < 90.0))
-  {
-    *out_w = in_w;
-    *out_h = in_h;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
+uint8_t *out=target->data;
+uint32_t *out_w=&(target->_width);
+uint32_t *out_h=&(target->_height);
 
-    for(x = 0; x < *out_w; x++)
-      for(y = 0; y < *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * y) + x);
+ADM_assert(in_w*in_h==(*out_w)*(*out_h));
 
-    for(x = 0; x < out_sub_w; x++)
-      for(y = 0; y < out_sub_h; y++)
-       {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * y) + x);
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * y) + x);
-       }
-  }
-  else if((angle >= 90.0) && (angle < 180.0))
-  {
-    *out_w = in_h;
-    *out_h = in_w;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
+// In general, for 0 <= i < width and 0 <= j < height, the pixel (x + i, y + j) is colored with red value 
+// red value   rgb_buf[(j * rowstride) + (i * 3) + 0], 
+// green value rgb_buf[(j * rowstride) + (i * 3) + 1], 
+// blue value  rgb_buf[(j * rowstride) + (i * 3) + 2].
 
-    for(x = 0; x < *out_w; x++)
-      for(y = 0; y < *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-x-1)) + y);
-
-    for(x = 0; x < out_sub_w; x++)
-      for(y = 0; y < out_sub_h; y++)
-       {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-       }
-  }
-  else if((angle >= 180.0) && (angle < 270.0))
-  {
-    *out_w = in_w;
-    *out_h = in_h;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
-
-    for(x = 0; x < *out_w; x++)
-      for(y = 0; y < *out_h; y++)
-         *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-y-1)) + in_w-x-1);
-
-
-    for(x = 0; x < out_sub_w; x++)
-      for(y = 0; y < out_sub_h; y++)
-         {
-           *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-           *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-         }
-  }
-  else if((angle >= 270.0) && (angle < 360.0))
-  {
-    *out_w = in_h;
-    *out_h = in_w;
-    out_sub_w = *out_w/2;
-    out_sub_h = *out_h/2;
-
-    for(x = 0; x < *out_w; x++)
-      for(y = 0; y < *out_h; y++)
-        *(out + (*out_w * y) + x) = *(in + (in_w * x) + (in_w-y-1));
-
-    for(x = 0; x < out_sub_w; x++)
-      for(y = 0; y < out_sub_h; y++)
-      {
-         *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * x) + (in_sub_w-y-1));
-         *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * x) + (in_sub_w-y-1));
-      }
-  }
+        switch(angle)
+        {
+        case 0:
+                *out_w = in_w;
+                *out_h = in_h;
+                out_sub_w = *out_w/2;
+                out_sub_h = *out_h/2;
+            
+                for(x = 0; x < *out_w; x++)
+                for(y = 0; y < *out_h; y++)
+                    *(out + (*out_w * y) + x) = *(in + (in_w * y) + x);
+            
+                for(x = 0; x < out_sub_w; x++)
+                for(y = 0; y < out_sub_h; y++)
+                {
+                    *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * y) + x);
+                    *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * y) + x);
+                }
+                break;
+        case 90:
+        {
+            *out_w = in_h;
+            *out_h = in_w;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x < *out_w; x++)
+            for(y = 0; y < *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-x-1)) + y);
+        
+            for(x = 0; x < out_sub_w; x++)
+            for(y = 0; y < out_sub_h; y++)
+            {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-x-1)) + y);
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-x-1)) + y);
+            }
+        }
+        break;
+        case 180:
+        {
+            *out_w = in_w;
+            *out_h = in_h;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x < *out_w; x++)
+            for(y = 0; y < *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-y-1)) + in_w-x-1);
+        
+        
+            for(x = 0; x < out_sub_w; x++)
+            for(y = 0; y < out_sub_h; y++)
+                {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
+                }
+        }
+            break;
+        case 270:
+        {
+            *out_w = in_h;
+            *out_h = in_w;
+            out_sub_w = *out_w/2;
+            out_sub_h = *out_h/2;
+        
+            for(x = 0; x < *out_w; x++)
+            for(y = 0; y < *out_h; y++)
+                *(out + (*out_w * y) + x) = *(in + (in_w * x) + (in_w-y-1));
+        
+            for(x = 0; x < out_sub_w; x++)
+            for(y = 0; y < out_sub_h; y++)
+            {
+                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * x) + (in_sub_w-y-1));
+                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * x) + (in_sub_w-y-1));
+            }
+        }
+        break;
+        default:
+            ADM_assert(0);
+        }
 }
 uint8_t ADMVideoRotate::configure( AVDMGenericVideoStream *instream)
 {
   uint8_t r;
-  r= DIA_rotate(instream,_param);
-  if(r)
+  
+  diaMenuEntry rotateValues[]={
+      {0,_("None"),_("None")},
+      {90,_("90 degrees"),_("90?")},
+      {180,_("180 degrees"),_("180?")},
+      {270,_("270 degrees"),_("270?")}
+  };
+  diaElemMenu     rotate(&(_param->angle),_("Angle"),4,rotateValues,NULL);
+  diaElem *allWidgets[]={&rotate};
+  if( !diaFactoryRun(_("Rotate Params"),1,allWidgets)) return 0;
+  
+  uint32_t w,h;
+  w=_in->getInfo()->width;
+  h=_in->getInfo()->height;
+  if((_param->angle%180)==90)
   {
-    _info.width=_param->width;
-    _info.height=_param->height;
+    _info.width=_param->width=h;
+    _info.height=_param->height=w;
+  }else
+  {
+      _info.width=_param->width=w;
+      _info.height=_param->height=h;
   }
-  return r;
+  return 1;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-07 08:58:39 UTC (rev 2926)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-12 15:39:08 UTC (rev 2927)
@@ -1407,6 +1407,7 @@
 AudioSource currentAudioSource=AudioAvi;
 AudioSource secondAudioSource=AudioNone;
 char *currentAudioName=NULL;
+char *secondAudioName=NULL;
 //_____________________________________________________________
 //
 //              Load MP3 and identify wavfmt infos to fill avi header
@@ -1986,7 +1987,7 @@
         uint32_t old,nw;        
         uint8_t r=0;
         uint32_t oldtrack,newtrack;
-        char *newtrackname=NULL;
+        char *newtrackname=ADM_strdup(currentAudioName);
 
         if(!video_body->getAudioStreamsInfo(0,&nb, &infos))
         {
@@ -2075,33 +2076,48 @@
         return;
 
 }
+/**
+        \fn A_externalAudioTrack
+        \brief Select external audio track (for 2nd track)
+*/
 void A_externalAudioTrack( void )
 {
-        uint32_t nb=0,*infos=NULL;
-        AudioSource old,nw;        
-        uint8_t r=0;
+        uint32_t old,nw;
         uint32_t oldtrack,newtrack;
+        char  *newtrackname=ADM_strdup(secondAudioName);
 
-//secondaudiostream
+   diaMenuEntry sourcesStream[]={
+            {AudioNone,_("None"),_("No audio")},
+            {AudioAC3,_("External AC3"),_("Take audio from external AC3 file")},
+            {AudioMP3,_("External MP3"),_("Take audio from external MP3 file")},
+            {AudioWav,_("External Wav"),_("Take audio from external WAV file")}
+        };
+        
+        old=nw=secondAudioSource;
 
+        diaElemMenu     sourceMenu(&nw,_("Audio source"),4,sourcesStream,NULL);
+        diaElemFileRead sourceName(&newtrackname,_("Filename"));
+        diaElem *allWidgets[]={&sourceMenu,&sourceName};
 
-        nw=secondAudioSource;
-        r=DIA_audioTrack(&nw, NULL,0, NULL);
-        if(!r) return;
+  /* Link..*/
+        
+         sourceMenu.link(&(sourcesStream[2]),1,&sourceName);
+         sourceMenu.link(&(sourcesStream[3]),1,&sourceName);
+         sourceMenu.link(&(sourcesStream[1]),1,&sourceName);
 
+         if( !diaFactoryRun(_("Select 2nd audio Track"),2,allWidgets)) return;
+       
         if(secondAudioSource!=AudioNone)
         {
                  delete secondaudiostream;
                  secondAudioSource=AudioNone;
                  secondaudiostream=NULL;
+                 if(secondAudioName) ADM_dealloc(secondAudioName);
+                 secondAudioName=NULL;
         }
-        char               *name=NULL;
-        if(nw==AudioMP3|| nw==AudioAC3 || nw==AudioWav)
-        {
-          GUI_FileSelRead(_("Select 2nd track"),&name);
-        }
-        A_setSecondAudioTrack(nw,name);
-        if(name) ADM_dealloc(name);
+       secondAudioSource=(AudioSource)nw;
+        A_setSecondAudioTrack(secondAudioSource,newtrackname);
+        if(newtrackname) ADM_dealloc(newtrackname);
 }
 
 uint8_t A_setSecondAudioTrack(const AudioSource nw,char *name)
@@ -2124,6 +2140,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioMP3;
+                                secondAudioName=ADM_strdup(name);
                                 printf ("\n MP3 loaded\n");
                                 GUI_Info_HIG(ADM_LOG_INFO,_("Second track loaded"), NULL);
                                 return 1;
@@ -2145,6 +2162,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioAC3;
+                                secondAudioName=ADM_strdup(name);
                                 printf ("\n AC3 loaded\n");
                                 GUI_Info_HIG(ADM_LOG_INFO,_("Second track loaded"), NULL);
                                 return 1;
@@ -2166,6 +2184,7 @@
                         {
                                 secondaudiostream = tmp;     
                                 secondAudioSource=AudioAC3;
+                                secondAudioName=ADM_strdup(name);
                                 printf ("\n AC3 loaded\n");
                                 GUI_Info_HIG(ADM_LOG_INFO,_("Second track loaded"), NULL);
                                 return 1;



From mean at mail.berlios.de  Thu Apr 12 17:42:52 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 12 Apr 2007 17:42:52 +0200
Subject: [Avidemux-svn-commit] r2928 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
Message-ID: <200704121542.l3CFgq3J028917@sheep.berlios.de>

Author: mean
Date: 2007-04-12 17:42:51 +0200 (Thu, 12 Apr 2007)
New Revision: 2928

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidRotate.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate_param.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
cleanup

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-04-12 15:42:51 UTC (rev 2928)
@@ -43,7 +43,6 @@
 #include "ADM_encoder/adm_encmjpeg_param.h"
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidTDeint_param.h"
-#include "ADM_video/ADM_vidRotate_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
 #include "ADM_video/ADM_vidHue.h"
 #include "ADM_video/ADM_vobsubinfo.h"
@@ -80,7 +79,6 @@
 		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
 #endif
 uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
-uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}
 uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-04-12 15:42:51 UTC (rev 2928)
@@ -43,7 +43,6 @@
 #include "ADM_encoder/adm_encmjpeg_param.h"
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidTDeint_param.h"
-#include "ADM_video/ADM_vidRotate_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
 #include "ADM_video/ADM_vidHue.h"
 #include "ADM_video/ADM_vobsubinfo.h"
@@ -80,7 +79,6 @@
 		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
 #endif
 uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
-uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp	2007-04-12 15:42:51 UTC (rev 2928)
@@ -1,287 +0,0 @@
-/***************************************************************************
-                          ADM_vidRotate.cpp  -  description
-                             -------------------
-    begin                : Sat Jan 8 2003
-    copyright            : (C) 2003 by Tracy Harton
-    email                : tracy at amphibious.org
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "default.h"
-#include "ADM_osSupport/ADM_misc.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-//#include "ADM_video/ADM_vidRotate.h"
-#include "ADM_filter/video_filters.h"
-#include <ADM_assert.h>
-        
-#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
-
-typedef struct ROTATE_PARAM
-{
-  uint32_t width;
-  uint32_t height;
-  uint32_t angle;
-}ROTATE_PARAM;
-
-class  ADMVideoRotate:public AVDMGenericVideoStream
-{
-
- protected:
-  virtual char                  *printConf(void);
-  ROTATE_PARAM                  *_param;
-
- public:
-                  ADMVideoRotate(AVDMGenericVideoStream *in, CONFcouple *setup);
-  virtual         ~ADMVideoRotate();
-  virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
-  virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-  virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
- }     ;
-
-static FILTER_PARAM rotpParam={3,{"width","height","angle"}};
-
-
-SCRIPT_CREATE(rotate_script,ADMVideoRotate,rotpParam);
-BUILD_CREATE(rotate_create,ADMVideoRotate);
-
-static void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle);
-
-char *ADMVideoRotate::printConf( void )
-{
-  static char buf[50];
- 	
-  sprintf((char *)buf," Rotate %u degrees", _param->angle);
-  return buf;
-}
-
-ADMVideoRotate::ADMVideoRotate(AVDMGenericVideoStream *in, CONFcouple *couples)
-{
-  _in=in;		
-
-  memcpy(&_info,_in->getInfo(),sizeof(_info)); 
-  _info.encoding=1;
-
- // _uncompressed=new uint8_t [3*_in->getInfo()->width*_in->getInfo()->height];
- 
-
-  if(couples)
-  {
-   	 _param=NEW(ROTATE_PARAM);
-	GET(width);
-	GET(height);
-	GET(angle);
-	_info.width=_param->width;
-	_info.height=_param->height;
-
-  }
-  else
-  {
-    _param = NEW( ROTATE_PARAM);
-    printf("New Angle 0.0\n");
-    _param->angle = 0;
-    _param->width = _info.width;
-    _param->height = _info.height;
-  }
- _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
-  printf("New Rotate %ld %ld %f\n", _info.width, _info.height, _param->angle);
-  ADM_assert(_uncompressed);    	  	
-
-}
-
-
-
-uint8_t	ADMVideoRotate::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_assert(_param);
-			*couples=new CONFcouple(3);
-
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-			CSET(width);
-			CSET(height);
-			CSET(angle);
-
-			return 1;
-
-}
-
-
-ADMVideoRotate::~ADMVideoRotate()
-{
- 	delete  _uncompressed;
-	_uncompressed=NULL;
-	DELETE(_param);
-}
-uint8_t ADMVideoRotate::getFrameNumberNoAlloc(uint32_t frame,
-                                              uint32_t *len,
-                                              ADMImage *data,
-                                              uint32_t *flags)
-{
-  ADM_assert(frame<_info.nb_frames);
-								
-  // read uncompressed frame
-  if(!_in->getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
-
-  
-  do_rotate(_uncompressed,data,_param->angle);
-
-  //printf("%ld,%ld\n", _info.width, _info.height);
-
-  *flags=_uncompressed->flags;
-  *len= (_info.width * _info.height) + ((_info.width * _info.height) / 2);
-   data->copyInfo(_uncompressed);	
-  return 1;
-}
-
-void do_rotate(ADMImage *source,ADMImage *target,uint32_t angle)
-{
-uint8_t *in;
-uint32_t in_w,in_h;
-
-in=source->data;
-in_w=source->_width;
-in_h=source->_height;
-
-uint32_t x, y;
-uint32_t u_offset = (in_w * in_h);
-uint32_t v_offset = u_offset + (in_w/2 * in_h/2);
-uint32_t in_sub_w = in_w/2;
-uint32_t in_sub_h = in_h/2;
-uint32_t out_sub_w, out_sub_h;
-
-uint8_t *out=target->data;
-uint32_t *out_w=&(target->_width);
-uint32_t *out_h=&(target->_height);
-
-ADM_assert(in_w*in_h==(*out_w)*(*out_h));
-
-// In general, for 0 <= i < width and 0 <= j < height, the pixel (x + i, y + j) is colored with red value 
-// red value   rgb_buf[(j * rowstride) + (i * 3) + 0], 
-// green value rgb_buf[(j * rowstride) + (i * 3) + 1], 
-// blue value  rgb_buf[(j * rowstride) + (i * 3) + 2].
-
-        switch(angle)
-        {
-        case 0:
-                *out_w = in_w;
-                *out_h = in_h;
-                out_sub_w = *out_w/2;
-                out_sub_h = *out_h/2;
-            
-                for(x = 0; x < *out_w; x++)
-                for(y = 0; y < *out_h; y++)
-                    *(out + (*out_w * y) + x) = *(in + (in_w * y) + x);
-            
-                for(x = 0; x < out_sub_w; x++)
-                for(y = 0; y < out_sub_h; y++)
-                {
-                    *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * y) + x);
-                    *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * y) + x);
-                }
-                break;
-        case 90:
-        {
-            *out_w = in_h;
-            *out_h = in_w;
-            out_sub_w = *out_w/2;
-            out_sub_h = *out_h/2;
-        
-            for(x = 0; x < *out_w; x++)
-            for(y = 0; y < *out_h; y++)
-                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-x-1)) + y);
-        
-            for(x = 0; x < out_sub_w; x++)
-            for(y = 0; y < out_sub_h; y++)
-            {
-                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-x-1)) + y);
-            }
-        }
-        break;
-        case 180:
-        {
-            *out_w = in_w;
-            *out_h = in_h;
-            out_sub_w = *out_w/2;
-            out_sub_h = *out_h/2;
-        
-            for(x = 0; x < *out_w; x++)
-            for(y = 0; y < *out_h; y++)
-                *(out + (*out_w * y) + x) = *(in + (in_w * (in_h-y-1)) + in_w-x-1);
-        
-        
-            for(x = 0; x < out_sub_w; x++)
-            for(y = 0; y < out_sub_h; y++)
-                {
-                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * (in_sub_h-y-1)) + in_sub_w-x-1);
-                }
-        }
-            break;
-        case 270:
-        {
-            *out_w = in_h;
-            *out_h = in_w;
-            out_sub_w = *out_w/2;
-            out_sub_h = *out_h/2;
-        
-            for(x = 0; x < *out_w; x++)
-            for(y = 0; y < *out_h; y++)
-                *(out + (*out_w * y) + x) = *(in + (in_w * x) + (in_w-y-1));
-        
-            for(x = 0; x < out_sub_w; x++)
-            for(y = 0; y < out_sub_h; y++)
-            {
-                *(out + u_offset + (out_sub_w * y) + x) = *(in + u_offset + (in_sub_w * x) + (in_sub_w-y-1));
-                *(out + v_offset + (out_sub_w * y) + x) = *(in + v_offset + (in_sub_w * x) + (in_sub_w-y-1));
-            }
-        }
-        break;
-        default:
-            ADM_assert(0);
-        }
-}
-uint8_t ADMVideoRotate::configure( AVDMGenericVideoStream *instream)
-{
-  uint8_t r;
-  
-  diaMenuEntry rotateValues[]={
-      {0,_("None"),_("None")},
-      {90,_("90 degrees"),_("90?")},
-      {180,_("180 degrees"),_("180?")},
-      {270,_("270 degrees"),_("270?")}
-  };
-  diaElemMenu     rotate(&(_param->angle),_("Angle"),4,rotateValues,NULL);
-  diaElem *allWidgets[]={&rotate};
-  if( !diaFactoryRun(_("Rotate Params"),1,allWidgets)) return 0;
-  
-  uint32_t w,h;
-  w=_in->getInfo()->width;
-  h=_in->getInfo()->height;
-  if((_param->angle%180)==90)
-  {
-    _info.width=_param->width=h;
-    _info.height=_param->height=w;
-  }else
-  {
-      _info.width=_param->width=w;
-      _info.height=_param->height=h;
-  }
-  return 1;
-}
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.h	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.h	2007-04-12 15:42:51 UTC (rev 2928)
@@ -1,37 +0,0 @@
-/***************************************************************************
-                          ADM_vidRotate.h  -  description
-                             -------------------
-    begin                : Sat Jan 8 2003
-    copyright            : (C) 2003 by Tracy Harton
-    email                : tracy at amphibious.org
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ROTATE
-#define ROTATE
-
-#include "ADM_vidRotate_param.h"
-
-
-class  ADMVideoRotate:public AVDMGenericVideoStream
-{
-
- protected:
-  virtual char                  *printConf(void);
-  ROTATE_PARAM                  *_param;
-
- public:
-                  ADMVideoRotate(AVDMGenericVideoStream *in, CONFcouple *setup);
-  virtual         ~ADMVideoRotate();
-  virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
-  virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-  virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
- }     ;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate_param.h	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate_param.h	2007-04-12 15:42:51 UTC (rev 2928)
@@ -1,26 +0,0 @@
-/***************************************************************************
-              
-    copyright            : (C) 2006 Mean
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ROTATE_PARAM_H
-#define ROTATE_PARAM_H
-
-typedef struct ROTATE_PARAM
-{
-  uint32_t width;
-  uint32_t height;
-  float    angle;
-}ROTATE_PARAM;
-
-void do_rotate(ADMImage *source,ADMImage *target,float angle);
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-04-12 15:42:51 UTC (rev 2928)
@@ -19,8 +19,6 @@
 	ADM_vidClean.cpp \
 	ADM_resizebis.cpp \
  ADM_genvideo.cpp \
- ADM_vidRotate.cpp \
- ADM_vidRotate.h \
  ADM_vidResize25.cpp \
  ADM_vidFieldUtil.cpp \
  ADM_vidFieldUtil.h \
@@ -67,8 +65,8 @@
 ADM_interlaced.h ADM_vidEq2.cpp  ADM_vidResize.cpp \
 ADM_vidEq2.h  ADM_vidResize25.cpp \
 ADM_vidEqualizer.cpp  \
-ADM_mpdetc.cpp ADM_vidEqualizer.h  ADM_vidRotate.cpp \
-ADM_mpdetc.h ADM_vidRotate.h \
+ADM_mpdetc.cpp ADM_vidEqualizer.h   \
+ADM_mpdetc.h  \
 ADM_resizebis.cpp   ADM_vidSRT.cpp \
 ADM_resizebis.hxx    ADM_vidSRT.h \
 ADM_resizeter.cpp  ADM_vidField.h  ADM_vidSRTRender.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-04-12 15:42:51 UTC (rev 2928)
@@ -186,7 +186,8 @@
 #endif
        _ass_track = ass_read_file(_ass_lib, (char*)_params->subfile, NULL);
 
-        ADM_assert(_ass_track);
+//        ADM_assert(_ass_track);
+        GUI_Error_HIG("SSA Error","Cannot read_file for *%s*",(char*)_params->subfile);
         return 1;
 } 
 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidRotate.cpp (from rev 2927, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidRotate.cpp)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-12 15:39:08 UTC (rev 2927)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-12 15:42:51 UTC (rev 2928)
@@ -49,7 +49,8 @@
  ADM_vidAddBorder.cpp \
  ADM_vidFlux.cpp \
  ADM_vidMsmooth.cpp \
- ADM_vidFastConvolution.cpp 
+ ADM_vidFastConvolution.cpp  \
+ ADM_vidRotate.cpp
 			
 
 



From mean at mail.berlios.de  Thu Apr 12 20:41:57 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 12 Apr 2007 20:41:57 +0200
Subject: [Avidemux-svn-commit] r2929 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200704121841.l3CIfvLK024031@sheep.berlios.de>

Author: mean
Date: 2007-04-12 20:41:56 +0200 (Thu, 12 Apr 2007)
New Revision: 2929

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audioTrack.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_rotate.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
update QT4 widgets, moved changed files

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audioTrack.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audioTrack.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audioTrack.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -1,177 +0,0 @@
-/***************************************************************************
-                          Simple bitrate calculator
-                             -------------------
-    begin                : Wed Dec 18 2002
-    copyright            : (C) 2004 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include <math.h>
-#include <gtk/gtk.h>
-
-#include "fourcc.h"
-#include "avio.hxx"
-
-
-#include "default.h"
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_toolkit/filesel.h"
-#include "ADM_assert.h"
-
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_audiofilter/audioeng_buildfilters.h"
-#define NB_TRACK_MAX (8+4)
-static GtkWidget *create_dialog1 (void);
-extern const char *getStrFromAudioCodec( uint32_t codec);
-uint8_t DIA_audioTrack(AudioSource *source, uint32_t *track,uint32_t nbTrack, audioInfo *infos);
-//************************************
-uint8_t DIA_audioTrack(AudioSource *source, uint32_t *track,uint32_t nbTrack, audioInfo *infos)
-{
-uint8_t r=0;
-GtkWidget *menu,*dialog;
-char string[100];
-GtkWidget **fq=(GtkWidget **)ADM_alloc(sizeof(GtkWidget *)*NB_TRACK_MAX);
-int nbWidget=0;
-int old;
-
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-
-        menu = gtk_menu_new ();
-#define ADD_STRING() \
-                fq[nbWidget]=gtk_menu_item_new_with_mnemonic (string); \
-                gtk_widget_show (fq[nbWidget]); \
-                gtk_container_add (GTK_CONTAINER (menu), fq[nbWidget]); \
-                nbWidget++; 
-        
-        for(unsigned int i=0;i<nbTrack;i++)
-        {
-                sprintf(string,"Audio track %d (%s/%d channels/%d kbit per s/%d ms shift)",i,getStrFromAudioCodec(infos[i].encoding),
-                        infos[i].channels,infos[i].bitrate,infos[i].av_sync);
-                ADD_STRING();
-        }
-        // Add none
-        sprintf(string,"No audio");
-        ADD_STRING();
-
-        sprintf(string,"External PCM (Wav)");
-        ADD_STRING();
-
-        sprintf(string,"External MP2/3");
-        ADD_STRING();
-
-        sprintf(string,"External AC3");
-        ADD_STRING();
-
-        switch(*source)
-        {
-                case  AudioAvi: old=*track;break;
-                case  AudioMP3: old=nbWidget-2;break;
-                case  AudioWav: old=nbWidget-3;break;
-                case  AudioAC3: old=nbWidget-1;break;
-                case  AudioNone: old=nbWidget-4;break;
-                default:
-                        ADM_assert(0);
-        }
-        
-
-        gtk_option_menu_set_menu (GTK_OPTION_MENU (WID(optionmenu1)), menu);
-        gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenu1)), old);
-        if(GTK_RESPONSE_OK==gtk_dialog_run(GTK_DIALOG(dialog)))
-                {
-                        r=1;
-                        old=r=getRangeInMenu(WID(optionmenu1));
-                        if(old<nbTrack)
-                        {
-                                *source=AudioAvi;
-                                *track=old;
-                        }
-                        else
-                        {
-                                switch(old-nbTrack)
-                                {
-                                        case 0: *source=AudioNone;break;
-                                        case 1: *source=AudioWav;break;
-                                        case 2: *source=AudioMP3;break;
-                                        case 3: *source=AudioAC3;break;
-                                }
-                        }
-                }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        return r;
-}
-
-GtkWidget *create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *vbox1;
-  GtkWidget *label1;
-  GtkWidget *optionmenu1;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _("Audio selector"));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  vbox1 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
-
-  label1 = gtk_label_new (_("Select audio track"));
-  gtk_widget_show (label1);
-  gtk_box_pack_start (GTK_BOX (vbox1), label1, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  optionmenu1 = gtk_option_menu_new ();
-  gtk_widget_show (optionmenu1);
-  gtk_box_pack_start (GTK_BOX (vbox1), optionmenu1, FALSE, FALSE, 0);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox1, "vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, label1, "label1");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenu1, "optionmenu1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-
-  return dialog1;
-}
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_gototime.cpp
===================================================================

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_rotate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_rotate.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_rotate.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -1,210 +0,0 @@
-/***************************************************************************
-                          ADM_guiRotate.cpp  -  description
-                             -------------------
-    begin                : Sat Jan 8 2003
-    copyright            : (C) 2003 by Tracy Harton / (c) 2006 Mean
-    email                : tracy at amphibious.org
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include <gtk/gtk.h>
-#include <time.h>
-#include <sys/time.h>
-#include <math.h>
-
-
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidRotate_param.h"
-
-#include "ADM_colorspace/ADM_rgb.h"
-#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
-#include <ADM_assert.h>
-
-void    GUI_RGBDisplay(uint8_t *dis,uint32_t w,uint32_t h,void *widg);
-
-static GtkWidget *create_dialog1 (void);
-static GtkWidget *dialog = NULL;
-
-static gboolean gui_draw (GtkWidget * widget,  GdkEventExpose * event, gpointer user_data);
-static void gui_update (GtkButton * button, gpointer user_data);
-static void calculate(void);
-static void draw(void);
-
-
-// Ugly !
-static ColYuvRgb    *rgbConv=NULL;
-static ADMImage *video_src,*video_rotated;
-static AVDMGenericVideoStream *sstream;
-static uint8_t *video_rgb;
-static uint32_t ww, hh;
-static ROTATE_PARAM par;
-static GtkObject *adj_angle;
-
-#define CNX(x,y) gtk_signal_connect(GTK_OBJECT(WID(x)), y, GTK_SIGNAL_FUNC(gui_update), (void *) (1));  
-uint8_t DIA_rotate(AVDMGenericVideoStream *astream,ROTATE_PARAM *param)
-{
-  uint8_t ret=0;
-  uint32_t len,flags;
-  uint32_t curImage=0;
-        sstream=astream;
-        memcpy(&par,param,sizeof(par));
-        
-        ww=astream->getInfo()->width;
-        hh=astream->getInfo()->height;
-        video_src=new ADMImage(ww,hh);
-        video_rotated=new ADMImage(par.width,par.height);
-        video_rgb=new uint8_t[ww*hh*4];
-        rgbConv=new ColYuvRgb(par.width,par.height);
-        rgbConv->reset(par.width,par.height);
-
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-         if(!astream->getFrameNumberNoAlloc(curImage,&len,video_src,&flags))
-        {
-          GUI_Error_HIG("Frame error","Cannnot read frame to display");
-
-        }
-        else
-        {
-          calculate ();
-          CNX (hscale1, "value_changed");
-          gtk_signal_connect (GTK_OBJECT (WID (drawingarea1)), "expose_event",
-                            GTK_SIGNAL_FUNC (gui_draw), NULL);
-          if (gtk_dialog_run (GTK_DIALOG (dialog)) == GTK_RESPONSE_OK)
-            {
-              memcpy(param,&par,sizeof(par));
-              ret = 1;
-            }
-        }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        dialog=NULL;
-        delete video_src;
-        delete video_rotated;
-        delete [] video_rgb;
-        delete rgbConv;
-        return ret;
-}
-//
-//        Check entered values and green-out the selected portion on the screen
-//        Each value must be even
-//
-void calculate( void )
-{
-  do_rotate(video_src,video_rotated, par.angle);
-  par.width=video_rotated->_width;
-  par.height=video_rotated->_height;
-  rgbConv->reset(par.width,par.height);
-  rgbConv->scale(video_rotated->data,video_rgb);
-}
-void draw(void)
-{
-  GUI_RGBDisplay (video_rgb, par.width, par.height, (void *) WID (drawingarea1));
-  gtk_widget_set_usize (WID (drawingarea1), par.width,par.height);
-}
-void gui_update (GtkButton * button, gpointer user_data)
-{
-  UNUSED_ARG (button);
-  UNUSED_ARG (user_data);
-  uint32_t    sz;
-
-  par.angle = GTK_ADJUSTMENT(adj_angle)->value;
-  calculate();
-  draw();
- 
-}
-
-gboolean gui_draw (GtkWidget * widget, GdkEventExpose * event, gpointer user_data)
-{
-  UNUSED_ARG (widget);
-  UNUSED_ARG (event);
-  UNUSED_ARG (user_data);
-  
-  gtk_widget_set_usize (WID (drawingarea1), par.width, par.height);
-  GUI_RGBDisplay (video_rgb, par.width, par.height, (void *) WID (drawingarea1));
-  return TRUE;
-}
-
-//*****************************************
-GtkWidget	*create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *vbox1;
-  GtkWidget *hscale1;
-  GtkWidget *drawingarea1;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _("Rotate"));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  vbox1 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
-
-  adj_angle=gtk_adjustment_new (0.0, 0.0, 360.0, 90.0, 90.0, 90.0);
-  hscale1 = gtk_hscale_new (GTK_ADJUSTMENT (adj_angle));
-  gtk_widget_show (hscale1);
-  gtk_box_pack_start (GTK_BOX (vbox1), hscale1, FALSE, TRUE, 0);
-  gtk_scale_set_digits (GTK_SCALE (hscale1), 0);
-
-  drawingarea1 = gtk_drawing_area_new ();
-  gtk_widget_show (drawingarea1);
-  gtk_box_pack_start (GTK_BOX (vbox1), drawingarea1, TRUE, TRUE, 0);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox1, "vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, hscale1, "hscale1");
-  GLADE_HOOKUP_OBJECT (dialog1, drawingarea1, "drawingarea1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-
-  return dialog1;
-}
-
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-12 18:41:56 UTC (rev 2929)
@@ -18,8 +18,8 @@
 	DIA_pause.cpp \
 	DIA_lavdecoder.cpp DIA_calculator.cpp DIA_equalizer.cpp \
 	DIA_vobsub.cpp DIA_x264.cpp DIA_ocr.cpp  DIA_hue.cpp DIA_eq2.cpp \
-	DIA_asharp.cpp  DIA_idx_pg.cpp DIA_gototime.cpp \
-	DIA_audioTrack.cpp DIA_cnr2.cpp DIA_jobs.cpp DIA_jobs_save.cpp  \
+	DIA_asharp.cpp  DIA_idx_pg.cpp  \
+	DIA_cnr2.cpp DIA_jobs.cpp DIA_jobs_save.cpp  \
 	DIA_v2v.cpp DIA_tdeint.cpp DIA_mpdelogo.cpp \
         DIA_chromaShift.cpp \
         \
@@ -41,11 +41,11 @@
 DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp     \
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
 DIA_about.cpp        DIA_tdeint.cpp \
-DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp   DIA_v2v.cpp \
+DIA_acodec.cpp       DIA_crop.cpp         DIA_v2v.cpp \
 DIA_animated.cpp     DIA_hue.cpp          DIA_ocr.cpp         DIA_vcodec.cpp \
 DIA_asharp.cpp       DIA_idx_pg.cpp       DIA_partial.cpp     DIA_vobsub.cpp \
 DIA_audio.cpp        DIA_idx_pg.h         DIA_pause.cpp       \
-DIA_audioTrack.cpp   DIA_pipe.cpp        DIA_working.cpp \
+DIA_pipe.cpp        DIA_working.cpp \
 DIA_defaultAudio.cpp  DIA_jobs.cpp        DIA_working.h \
 DIA_jobs_save.cpp     DIA_x264.cpp \
 DIA_preview.cpp     DIA_xvcd.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -41,125 +41,51 @@
   this->menu=menu;
   this->nbMenu=nb;
   nbLink=0;
+  
+  menus=new diaMenuEntryDynamic * [nb];
+  for(int i=0;i<nb;i++)
+  {
+    menus[i]=new  diaMenuEntryDynamic(menu[i].val,menu[i].text,menu[i].desc);
+  }
+  dyna=new diaElemMenuDynamic(intValue,itle,nb,menus,tip);
 }
 
 diaElemMenu::~diaElemMenu()
 {
+  for(int i=0;i<nbMenu;i++)
+      delete menus[i];
+  delete [] menus;
   
 }
 void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)
 {
-  GtkWidget *widget;
-  GtkWidget *label;
-  GtkWidget *item;
-  GtkWidget *combo;
-  
-  
-  label = gtk_label_new_with_mnemonic (paramTitle);
-  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
-  gtk_widget_show(label);
-  
-  gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  
-  combo = gtk_combo_box_new_text ();
-  gtk_widget_show (combo);
-  gtk_table_attach (GTK_TABLE (opaque), combo, 1, 2, line, line+1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  
-  gtk_label_set_mnemonic_widget (GTK_LABEL(label), combo);
-  
-  for(int i=0;i<nbMenu;i++)
-  {
-    gtk_combo_box_append_text (GTK_COMBO_BOX (combo),this->menu[i].text);
-  }
-  
-  for(int i=0;i<nbMenu;i++)
-  {
-    if(this->menu[i].val==*(uint32_t *)param) 
-    {
-      gtk_combo_box_set_active(GTK_COMBO_BOX(combo),i);
-    }
-  }
-  
-  
-  myWidget=(void *)combo;
-   gtk_signal_connect(GTK_OBJECT(combo), "changed",
-                      GTK_SIGNAL_FUNC(cb_menus),
-                      (void *) this);
+  dyna->setMe(dialog,opaque,line);
 }
 
 void diaElemMenu::getMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
-  uint32_t *val=(uint32_t *)param;
-  uint32_t rank;
-  ADM_assert(widget);
-  if(!nbMenu) return;
-  
-  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
-  ADM_assert(rank<this->nbMenu);
-  *(uint32_t *)param=this->menu[rank].val;
+ dyna->getMe();
 }
 void   diaElemMenu::updateMe(void)
 {
-  GtkWidget *widget=(GtkWidget *)myWidget;
-  uint32_t val;
-  uint32_t rank;
-  if(!nbMenu) return;
-  ADM_assert(widget);
-  
-  
-  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
-  ADM_assert(rank<this->nbMenu);
-  val=this->menu[rank].val;
-  /* Now search through the linked list to see if something happens ...*/
-  
-  /* 1 disable everything */
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
-    if(l->value==val)
-    {
-      if(!l->onoff)  l->widget->enable(0);
-    }else
-    {
-       if(l->onoff)  l->widget->enable(0);
-    }
-    
-  }
-  /* Then enable */
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
-    if(l->value==val)
-    {
-      if(l->onoff)  l->widget->enable(1);
-    }else
-    {
-       if(!l->onoff)  l->widget->enable(1);
-    }
-    
-  }
+  dyna->updateMe();
 }
 uint8_t   diaElemMenu::link(diaMenuEntry *entry,uint32_t onoff,diaElem *w)
 {
-    ADM_assert(nbLink<MENU_MAX_lINK);
-    links[nbLink].value=entry->val;
-    links[nbLink].onoff=onoff;
-    links[nbLink].widget=w;
-    nbLink++;
-    return 1;
+    for(int i=0;i<nbMenu;i++)
+    {
+        if(entry->val==menus[i]->val)
+            return dyna->link(menus[i],onoff,w);
+    }
+    ADM_assert(0);
 }
 void   diaElemMenu::enable(uint32_t onoff)
 {
-  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);  
+  dyna->enable(onoff);
 }
 void   diaElemMenu::finalize(void)
 {
-  updateMe(); 
+  dyna->finalize();
 }
 //*******************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -258,9 +184,7 @@
   ADM_assert(rank<this->nbMenu);
   val=this->menu[rank]->val;
   /* Now search through the linked list to see if something happens ...*/
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
+  
    /* 1 disable everything */
   for(int i=0;i<nbLink;i++)
   {
@@ -287,7 +211,6 @@
     }
     
   }
-  }
 }
 void   diaElemMenuDynamic::finalize(void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -77,4 +77,12 @@
  *(ELEM_TYPE_FLOAT *)param=val;
  
 }
-void diaElemFloat::enable(uint32_t onoff) {}
\ No newline at end of file
+void diaElemFloat::enable(uint32_t onoff) 
+{
+   QDoubleSpinBox *box=(QDoubleSpinBox *)myWidget;
+  ADM_assert(box);
+  if(onoff)
+    box->setEnabled(1);
+  else
+    box->setDisabled(1);
+}
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -79,7 +79,15 @@
  *(int32_t *)param=val;
  
 }
-void diaElemInteger::enable(uint32_t onoff) {}
+void diaElemInteger::enable(uint32_t onoff) 
+{
+ QSpinBox *box=(QSpinBox *)myWidget;
+  ADM_assert(box);
+  if(onoff)
+    box->setEnabled(1);
+  else
+    box->setDisabled(1);
+}
 //******************************************************
 diaElemUInteger::diaElemUInteger(uint32_t *intValue,const char *toggleTitle, uint32_t min, uint32_t max,const char *tip)
   : diaElem(ELEM_TOGGLE)
@@ -125,6 +133,13 @@
 
 }
 
-void diaElemUInteger::enable(uint32_t onoff) {}
-
+void diaElemUInteger::enable(uint32_t onoff) 
+{
+ QSpinBox *box=(QSpinBox *)myWidget;
+  ADM_assert(box);
+  if(onoff)
+    box->setEnabled(1);
+  else
+    box->setDisabled(1);
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_menu.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -35,136 +35,87 @@
 
 extern const char *shortkey(const char *);
 
+
 diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
                const diaMenuEntry *menu,const char *tip)
   : diaElem(ELEM_MENU)
 {
   param=(void *)intValue;
-  paramTitle=shortkey(itle);
+  paramTitle=itle;
   this->tip=tip;
   this->menu=menu;
   this->nbMenu=nb;
   nbLink=0;
+  
+  menus=new diaMenuEntryDynamic * [nb];
+  for(int i=0;i<nb;i++)
+  {
+    menus[i]=new  diaMenuEntryDynamic(menu[i].val,menu[i].text,menu[i].desc);
+  }
+  dyna=new diaElemMenuDynamic(intValue,itle,nb,menus,tip);
 }
 
 diaElemMenu::~diaElemMenu()
 {
-  if(paramTitle)
-    delete paramTitle;
+  for(int i=0;i<nbMenu;i++)
+      delete menus[i];
+  delete [] menus;
+  
 }
 void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)
 {
-  QComboBox *combo=new QComboBox( (QWidget *)dialog);
-  QGridLayout *layout=(QGridLayout*) opaque;
-     myWidget=(void *)combo; 
-
-  QLabel *text=new QLabel( this->paramTitle,(QWidget *)dialog);
-  
-  // Fill in combobox
-  int mem=0;
-  const diaMenuEntry *entries=menu;
-  for(int i=0;i<nbMenu;i++)
-  {
-    combo->addItem(entries[i].text);
-    if( *(uint32_t *)param==entries[i].val) mem=i;
-  }
-   combo->setCurrentIndex(mem);
-   text->setBuddy(combo);
-   layout->addWidget(text,line,0);
-   layout->addWidget(combo,line,1);
+  dyna->setMe(dialog,opaque,line);
 }
 
 void diaElemMenu::getMe(void)
 {
-  QComboBox *combo=(QComboBox *)myWidget;
-  int r;
-  r=combo->currentIndex();
-  if(!nbMenu) return;
-  ADM_assert(r<nbMenu);
-  *(uint32_t *)param=menu[r].val;
-      
+ dyna->getMe();
 }
-void diaElemMenu::finalize(void)
-{ 
+void   diaElemMenu::updateMe(void)
+{
+  dyna->updateMe();
 }
-void diaElemMenu::enable(uint32_t onoff)
-{ 
-}
-
 uint8_t   diaElemMenu::link(diaMenuEntry *entry,uint32_t onoff,diaElem *w)
 {
-    ADM_assert(nbLink<MENU_MAX_lINK);
-    links[nbLink].value=entry->val;
-    links[nbLink].onoff=onoff;
-    links[nbLink].widget=w;
-    nbLink++;
-    return 1;
+    for(int i=0;i<nbMenu;i++)
+    {
+        if(entry->val==menus[i]->val)
+            return dyna->link(menus[i],onoff,w);
+    }
+    ADM_assert(0);
 }
-void   diaElemMenu::updateMe(void)
+void   diaElemMenu::enable(uint32_t onoff)
 {
-   QComboBox *combo=(QComboBox *)myWidget;
-  uint32_t val;
-  uint32_t rank;
-  if(!nbMenu) return;
   
-  rank=combo->currentIndex();
-  ADM_assert(rank<this->nbMenu);
-  val=this->menu[rank].val;
-  /* Now search through the linked list to see if something happens ...*/
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
-   /* 1 disable everything */
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
-    if(l->value==val)
-    {
-      if(!l->onoff)  l->widget->enable(0);
-    }else
-    {
-       if(l->onoff)  l->widget->enable(0);
-    }
-    
-  }
-  /* Then enable */
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
-    if(l->value==val)
-    {
-      if(l->onoff)  l->widget->enable(1);
-    }else
-    {
-       if(!l->onoff)  l->widget->enable(1);
-    }
-    
-  }
-  }
+    dyna->enable(onoff);
 }
+void   diaElemMenu::finalize(void)
+{
+  dyna->finalize();
+}
 //*********************************
+
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
                 diaMenuEntryDynamic **menu,const char *tip)
   : diaElem(ELEM_MENU)
 {
-   param=(void *)intValue;
+  param=(void *)intValue;
   paramTitle=shortkey(itle);
   this->tip=tip;
   this->menu=menu;
   this->nbMenu=nb;
   nbLink=0;
-  
 }
 
 diaElemMenuDynamic::~diaElemMenuDynamic()
-{ 
+{
   if(paramTitle)
     delete paramTitle;
 }
 void diaElemMenuDynamic::setMe(void *dialog, void *opaque,uint32_t line)
 {
-   QComboBox *combo=new QComboBox( (QWidget *)dialog);
-   QGridLayout *layout=(QGridLayout*) opaque;
+  QComboBox *combo=new QComboBox( (QWidget *)dialog);
+  QGridLayout *layout=(QGridLayout*) opaque;
      myWidget=(void *)combo; 
 
   QLabel *text=new QLabel( this->paramTitle,(QWidget *)dialog);
@@ -184,44 +135,29 @@
 }
 
 void diaElemMenuDynamic::getMe(void)
-{ 
-   QComboBox *combo=(QComboBox *)myWidget;
+{
+  QComboBox *combo=(QComboBox *)myWidget;
   int r;
-  if(!nbMenu) return;
   r=combo->currentIndex();
+  if(!nbMenu) return;
   ADM_assert(r<nbMenu);
   *(uint32_t *)param=menu[r]->val;
       
 }
 void diaElemMenuDynamic::finalize(void)
 { 
-}
-uint8_t   diaElemMenuDynamic::link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w)
-{
-    ADM_assert(nbLink<MENU_MAX_lINK);
-    links[nbLink].value=entry->val;
-    links[nbLink].onoff=onoff;
-    links[nbLink].widget=w;
-    nbLink++;
-    return 1;
-}
-void diaElemMenuDynamic::enable(uint32_t onoff)
-{
-}
-void   diaElemMenuDynamic::updateMe(void)
-{
    QComboBox *combo=(QComboBox *)myWidget;
   uint32_t val;
   uint32_t rank;
   if(!nbMenu) return;
+  ADM_assert(combo);
   
+  
   rank=combo->currentIndex();
   ADM_assert(rank<this->nbMenu);
   val=this->menu[rank]->val;
   /* Now search through the linked list to see if something happens ...*/
-  for(int i=0;i<nbLink;i++)
-  {
-    dialElemLink *l=&(links[i]);
+ 
    /* 1 disable everything */
   for(int i=0;i<nbLink;i++)
   {
@@ -248,6 +184,28 @@
     }
     
   }
-  }
 }
+void diaElemMenuDynamic::enable(uint32_t onoff)
+{ 
+   QComboBox *combo=(QComboBox *)myWidget;
+  ADM_assert(combo);
+  if(onoff)
+    combo->setEnabled(1);
+  else
+    combo->setDisabled(1);
+}
+
+uint8_t   diaElemMenuDynamic::link(diaMenuEntryDynamic *entry,uint32_t onoff,diaElem *w)
+{
+    ADM_assert(nbLink<MENU_MAX_lINK);
+    links[nbLink].value=entry->val;
+    links[nbLink].onoff=onoff;
+    links[nbLink].widget=w;
+    nbLink++;
+    return 1;
+}
+void   diaElemMenuDynamic::updateMe(void)
+{
+  finalize();
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -71,9 +71,18 @@
   }else
     *val=0;
 }
-void diaElemToggle::enable(uint32_t onoff) {}
+void diaElemToggle::enable(uint32_t onoff) 
+{
+  QCheckBox *box=(QCheckBox *)myWidget;
+  ADM_assert(box);
+  if(onoff)
+    box->setEnabled(1);
+  else
+    box->setDisabled(1);
+}
 
 
+
 //******************************************************
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -128,7 +128,8 @@
 }
 void diaElemFileRead::enable(uint32_t onoff)
 {
-  
+  ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
+  fs->setEnabled(onoff);
 }
 //****************************
 diaElemDirSelect::diaElemDirSelect(char **filename,const char *toggleTitle,const char *tip)  : diaElem(ELEM_DIR_SELECT) 
@@ -163,6 +164,8 @@
   
 }
   
-void diaElemDirSelect::changeFile(void) {}
+void diaElemDirSelect::changeFile(void) 
+{
+}
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-12 18:41:56 UTC (rev 2929)
@@ -160,25 +160,7 @@
   diaElem  *widget;
 }dialElemLink;
 
-class diaElemMenu : public diaElem
-{
-const diaMenuEntry  *menu;
-uint32_t            nbMenu;
-dialElemLink        links[MENU_MAX_lINK];
-uint32_t            nbLink;
 
-public:
-  diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
-               const diaMenuEntry *menu,const char *tip=NULL);
-  
-  virtual ~diaElemMenu() ;
-  void setMe(void *dialog, void *opaque,uint32_t line);
-  void getMe(void);
-  uint8_t   link(diaMenuEntry *entry,uint32_t onoff,diaElem *w);
-  void      updateMe(void);
-  void      enable(uint32_t onoff) ;
-  void      finalize(void);;
-};
 //*******************************
 // Same but for dynamic menus
 //*******************************
@@ -201,6 +183,29 @@
   void      enable(uint32_t onoff) ;
   void      finalize(void);
 };
+
+class diaElemMenu : public diaElem
+{
+const diaMenuEntry  *menu;
+uint32_t            nbMenu;
+dialElemLink        links[MENU_MAX_lINK];
+uint32_t            nbLink;
+
+diaElemMenuDynamic  *dyna;
+diaMenuEntryDynamic  **menus;
+public:
+  diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
+               const diaMenuEntry *menu,const char *tip=NULL);
+  
+  virtual ~diaElemMenu() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+  uint8_t   link(diaMenuEntry *entry,uint32_t onoff,diaElem *w);
+  void      updateMe(void);
+  void      enable(uint32_t onoff) ;
+  void      finalize(void);;
+};
+
 /*************************************************/
 #include "ADM_encoder/ADM_vidEncode.hxx"
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -0,0 +1,39 @@
+//
+// C++ Implementation: ADM_vidForcedPP
+//
+//
+//
+//
+#include "config.h"
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+
+#include <math.h>
+#include <math.h>
+#include <iconv.h>
+
+
+#include "default.h"
+#include "ADM_osSupport/ADM_misc.h"
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+#include <ADM_assert.h>
+
+
+uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss)
+{
+uint32_t h=*hh,m=*mm,s=*ss;
+
+diaElemUInteger   eh(&h,_("Hour"),0,24);
+diaElemUInteger   em(&m,_("Minutes"),0,59);
+diaElemUInteger   es(&s,_("Secons"),0,59);
+        diaElem *allWidgets[]={&eh,&em,&es};
+
+  if(!diaFactoryRun("Go to time",3,allWidgets)) return 0;
+    *hh=h;
+    *mm=m;
+    *ss=s;
+    return 1;
+
+}
+//EOF 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-12 15:42:51 UTC (rev 2928)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-12 18:41:56 UTC (rev 2929)
@@ -2038,16 +2038,25 @@
          
          if( diaFactoryRun("Select Main audio Track",3,allWidgets))
          {
+           if(nw!=AudioNone && nw!=AudioAvi)
+           {
+              if( !ADM_fileExist(newtrackname))
+                GUI_Info_HIG(ADM_LOG_INFO,_("Cannot load"),_("The selected audio file does not exist.")); 
+              goto roger_and_out;
+           }
             switch( nw)
             {
                     case AudioMP3:
-                            A_loadMP3(newtrackname);
+                            if( ADM_fileExist(newtrackname))
+                              A_loadMP3(newtrackname);
                             break;
                     case AudioAC3:
-                            A_loadAC3(newtrackname);
+                            if( ADM_fileExist(newtrackname))
+                              A_loadAC3(newtrackname);
                             break;
                     case AudioWav:
-                            A_loadWave(newtrackname);
+                            if( ADM_fileExist(newtrackname))
+                              A_loadWave(newtrackname);
                             break;
                     case AudioNone:
                               A_changeAudioStream((AVDMGenericAudioStream *) NULL, AudioNone,NULL);
@@ -2070,6 +2079,7 @@
                             ADM_assert(0);
         }
          }
+roger_and_out:         
          /* Clean up */
          for(int i=0;i<nb;i++)
             delete sourceavitracks[i];
@@ -2106,7 +2116,11 @@
          sourceMenu.link(&(sourcesStream[1]),1,&sourceName);
 
          if( !diaFactoryRun(_("Select 2nd audio Track"),2,allWidgets)) return;
-       
+         if(!ADM_fileExist(newtrackname))
+         {
+           GUI_Info_HIG(ADM_LOG_INFO,_("Cannot load"),_("The selected audio file does not exist."));
+           return;
+         }
         if(secondAudioSource!=AudioNone)
         {
                  delete secondaudiostream;



From mean at mail.berlios.de  Fri Apr 13 10:19:44 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 13 Apr 2007 10:19:44 +0200
Subject: [Avidemux-svn-commit] r2930 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_libraries/ADM_lavformat ADM_libraries/ADM_utilities
	ADM_outputs/oplug_avi ADM_userInterfaces/ADM_commonUI
Message-ID: <200704130819.l3D8JiUO003189@sheep.berlios.de>

Author: mean
Date: 2007-04-13 10:19:43 +0200 (Fri, 13 Apr 2007)
New Revision: 2930

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/movenc.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.4_branch/avidemux/prefs.h
   branches/avidemux_2.4_branch/avidemux/prefs.in
Log:
allow alternate tagging for ESDS atom (haali etc.. compatibility), used for mp3 in .mp4

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-04-13 08:19:43 UTC (rev 2930)
@@ -47,7 +47,7 @@
 #include "ADM_lavformat.h"
 #include "fourcc.h"
 
-
+#include "prefs.h"
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_LAVFORMAT
 #include "ADM_osSupport/ADM_debug.h"
@@ -617,7 +617,19 @@
                 av_register_input_format(&matroska_demuxer);
                 register_protocol(&file_protocol);
 }
-
+extern "C"
+{
+/** 
+    \fn ADM_useAlternateTagging
+    \brief returns 1 if using haali compatible tagging, 0 if normal. For mp3 in mp4ff.
+*/
+int ADM_useAlternateTagging(void)
+{
+  uint32_t v=1;
+  prefs->get(FEATURE_ALTERNATE_MP3_TAG,&v);
+  return v;
+} 
+}
 //___________________________________________________________________________
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/movenc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/movenc.c	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/movenc.c	2007-04-13 08:19:43 UTC (rev 2930)
@@ -39,6 +39,10 @@
 // ffmpeg -i testinput.avi  -f psp -r 14.985 -s 320x240 -b 768 -ar 24000 -ab 32 M4V00001.MP4
 #define MODE_3G2 4
 
+// MEANX
+extern int ADM_useAlternateTagging(void);
+// MEANX
+
 typedef struct MOVIentry {
     unsigned int flags, size;
     uint64_t     pos;
@@ -245,6 +249,7 @@
 
 static int mov_write_esds_tag(ByteIOContext *pb, MOVTrack* track) // Basic
 {
+  int codec_id;
     offset_t pos = url_ftell(pb);
     int decoderSpecificInfoLen = track->vosLen ? descrLength(track->vosLen):0;
 
@@ -262,8 +267,11 @@
     putDescr(pb, 0x04, 13 + decoderSpecificInfoLen);
 
     // Object type indication
-    put_byte(pb, codec_get_tag(ff_mov_obj_type, track->enc->codec_id));
-
+    // MEANX
+    codec_id=track->enc->codec_id;
+    if(ADM_useAlternateTagging() && codec_id==CODEC_ID_MP3) codec_id=CODEC_ID_MP2;
+    put_byte(pb, codec_get_tag(ff_mov_obj_type, codec_id));
+    // /MEANX
     // the following fields is made of 6 bits to identify the streamtype (4 for video, 5 for audio)
     // plus 1 bit to indicate upstream and 1 bit set to 1 (reserved)
     if(track->enc->codec_type == CODEC_TYPE_AUDIO)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-04-13 08:19:43 UTC (rev 2930)
@@ -133,10 +133,11 @@
 	{"feature.auto_unpack",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"downmixing.prologic",		UINT,	"2",	NULL,	"0",	"2"	},
 	{"filters.autoload.path",		STRING,"/tmp/",NULL, NULL, NULL },
-	{"filters.autoload.active",		UINT,	"0",	NULL,	"0",	"1"	}
+	{"filters.autoload.active",		UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.alternate_mp3_tag",		UINT,	"1",	NULL,	"0",	"1"	}
 };
 
-int num_opts = 72;
+int num_opts = 73;
 // </prefs_gen>
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-04-13 08:19:43 UTC (rev 2930)
@@ -87,7 +87,7 @@
      mux.link(&(muxingType[2]),1,&n_block);
     
      diaElem *elems[4]={&mux,&n_frames,&n_block,&blockSize};
-     if( diaFactoryRun("Mpeg2 Encoding",4,elems))
+     if( diaFactoryRun(_("Avi Muxer Option"),4,elems))
     {
       muxMode=(PARAM_MUX)mux_mode;
       switch(muxMode)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-13 08:19:43 UTC (rev 2930)
@@ -71,7 +71,7 @@
 uint32_t autovbr=0;
 uint32_t autoindex=0;
 uint32_t autounpack=0;
-
+uint32_t alternate_mp3_tag=1;
 	olddevice=newdevice=AVDM_getCurrentDevice();
 
         // Alsa
@@ -83,7 +83,9 @@
         prefs->get(FEATURE_AUTO_REBUILDINDEX,&autoindex);
          // autoindex
         prefs->get(FEATURE_AUTO_UNPACK,&autounpack);
-
+        // Alternate mp3 tag (haali)
+        prefs->get(FEATURE_ALTERNATE_MP3_TAG,&alternate_mp3_tag);
+        
         // Video renderer
         if(prefs->get(DEVICE_VIDEODEVICE,&render)!=RC_OK)
         {       
@@ -149,6 +151,8 @@
         diaElemUInteger multiThread(&mthreads,_("Number of threads"),0,10);
         diaElemUInteger autoSplit(&autosplit,_("Split mpegs every (MB)"),10,4096);
         
+        diaElemToggle   togTagMp3(&alternate_mp3_tag,_("Use alternative tag for mp3 in .mp4"));
+        
         diaMenuEntry videoMode[]={
                              {RENDER_GTK,      _("Gtk (Slow)"),NULL}
 #ifdef USE_XV
@@ -241,8 +245,8 @@
         diaElemTabs tabInput("Input",2,(diaElem **)diaInput);
         
         /* Third Tab : output */
-        diaElem *diaOutput[]={&autoSplit,&openDml,&allowAnyMpeg};
-        diaElemTabs tabOutput("Output",3,(diaElem **)diaOutput);
+        diaElem *diaOutput[]={&autoSplit,&openDml,&allowAnyMpeg,&togTagMp3};
+        diaElemTabs tabOutput("Output",4,(diaElem **)diaOutput);
         
         /* Fourth Tab : audio */
         diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio,&entryAlsaDevice};
@@ -314,6 +318,8 @@
                 // Filter directory
                 if(filterPath)
                   prefs->set(FILTERS_AUTOLOAD_PATH, filterPath);
+                // Alternate mp3 tag (haali)
+                prefs->set(FEATURE_ALTERNATE_MP3_TAG,alternate_mp3_tag);
 	}
 	return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.h	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/prefs.h	2007-04-13 08:19:43 UTC (rev 2930)
@@ -79,7 +79,8 @@
 	FEATURE_AUTO_UNPACK,
 	DOWNMIXING_PROLOGIC,
 	FILTERS_AUTOLOAD_PATH,
-	FILTERS_AUTOLOAD_ACTIVE
+	FILTERS_AUTOLOAD_ACTIVE,
+	FEATURE_ALTERNATE_MP3_TAG
 } options;
 // </prefs_gen>
 

Modified: branches/avidemux_2.4_branch/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.in	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/prefs.in	2007-04-13 08:19:43 UTC (rev 2930)
@@ -89,4 +89,5 @@
 # prologic 1/2
 downmixing.prologic,			UINT,	2,	0,	2
 filters.autoload.path,                  STRING, "/tmp/"
-filters.autoload.active,                UINT,   0,      0,      1
\ No newline at end of file
+filters.autoload.active,                UINT,   0,      0,      1
+feature.alternate_mp3_tag,              UINT,   1,      0,      1
\ No newline at end of file



From mean at mail.berlios.de  Fri Apr 13 14:12:25 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 13 Apr 2007 14:12:25 +0200
Subject: [Avidemux-svn-commit] r2931 - in
	branches/avidemux_2.4_branch/avidemux: ADM_filter ADM_videoFilter
Message-ID: <200704131212.l3DCCPmC032683@sheep.berlios.de>

Author: mean
Date: 2007-04-13 14:12:24 +0200 (Fri, 13 Apr 2007)
New Revision: 2931

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
skeleton for yadif (uncomplete/not working)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-04-13 08:19:43 UTC (rev 2930)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-04-13 12:12:24 UTC (rev 2931)
@@ -66,7 +66,7 @@
 	registerFilter("----------- Interlacing -------------",VF_INVALID,2,NULL,NULL);
 	// Buggy : Removed REGISTER("IVTC",VF_IVTC,1,ivtc_create);
 //	REGISTERX("mpivtc","Mplayer ivtc",VF_MPDETC,1,mpdetc_create,mpdetc_script);	
-
+        REGISTERX("YADIF","yadif","Yet Another DeInterlacer. Ported from MPlayer.",VF_YADIF,1,yadif_create,yadif_script);
         REGISTERX("mcdeinterlace","mcDeinterlace","Motion compensation deinterlacer. Ported from MPlayer.",VF_MCDEINT,1,mcdeint_create,mcdeint_script);
 	REGISTERX("deinterlace","Deinterlace","Mask interlacing artifacts. Port of Smart deinterlace.",VF_DEINTERLACE,1,deinterlace_create,deinterlace_script);
 	REGISTERX("kerneldeint","KernelDeint","Kernel deinterlacer by Donald Graft.",VF_KRNDEINT,1,kerneldeint_create,kerneldeint_script);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-04-13 08:19:43 UTC (rev 2930)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-04-13 12:12:24 UTC (rev 2931)
@@ -97,6 +97,7 @@
                 VF_REVERSE,
                 VF_FADE,
                 VF_ASS,
+                VF_YADIF,
                 VF_DUMMY,
                 VF_EXTERNAL_START=0xF0000000
           }VF_FILTERS;

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 08:19:43 UTC (rev 2930)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 12:12:24 UTC (rev 2931)
@@ -0,0 +1,667 @@
+/*
+    Copyright (C) 2006 Michael Niedermayer <michaelni at gmx.at>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+*/
+/*
+  Ported to avidemux by mean
+  Same license as original (?GPL)
+*/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <inttypes.h>
+#include <math.h>
+
+
+#include <ADM_assert.h>
+
+#include "admmangle.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_vidVlad.h"
+#include "ADM_filter/video_filters.h"
+#include "ADM_osSupport/ADM_cpuCap.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+//************************************************
+#define MIN(a,b) ((a) > (b) ? (b) : (a))
+#define MAX(a,b) ((a) < (b) ? (b) : (a))
+#define ABS(a) ((a) > 0 ? (a) : (-(a)))
+
+#define MIN3(a,b,c) MIN(MIN(a,b),c)
+#define MAX3(a,b,c) MAX(MAX(a,b),c)
+
+//===========================================================================//
+
+struct vf_priv_s {
+    int mode;
+    int parity;
+    int buffered_i;
+    int buffered_tff;
+    double buffered_pts;
+    ADMImage *buffered_mpi;
+    int stride[3];
+    uint8_t *ref[4][3];
+    int do_deinterlace;
+};
+
+//
+typedef struct YADIF_PARAM
+{
+    uint32_t mode;
+}YADIF_PARAM;
+
+class  ADMVideoYadif:public AVDMGenericVideoStream
+{
+
+ protected:
+  virtual char                  *printConf(void);
+  YADIF_PARAM                  *_param;
+  ADMImage                     *_images[4];
+  vf_priv_s                    priv;
+ public:
+                  ADMVideoYadif(AVDMGenericVideoStream *in, CONFcouple *setup);
+  virtual         ~ADMVideoYadif();
+  virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
+  virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
+  virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
+ }     ;
+
+static FILTER_PARAM yadifParam={1,{"mode","height","angle"}};
+
+
+SCRIPT_CREATE(yadif_script,ADMVideoYadif,yadifParam);
+BUILD_CREATE(yadif_create,ADMVideoYadif);
+//
+
+
+
+//
+static void (*filter_line)(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity);
+
+
+void memcpy_pic(uint8_t *tgt,uint8_t *src, uint32_t w,uint32_t h, uint32_t d_stride,uint32_t s_stride)
+{
+    for(int y=0;y<h;y++)
+    {
+      memcpy(tgt,src,w);
+      tgt+=d_stride;
+      src+=s_stride; 
+    }
+}
+
+static void store_ref(struct vf_priv_s *p, uint8_t *src[3], int src_stride[3], int width, int height){
+    int i;
+
+    memcpy (p->ref[3], p->ref[0], sizeof(uint8_t *)*3);
+    memmove(p->ref[0], p->ref[1], sizeof(uint8_t *)*3*3);
+
+    for(i=0; i<3; i++){
+        int is_chroma= !!i;
+
+        memcpy_pic(p->ref[2][i], src[i], width>>is_chroma, height>>is_chroma, p->stride[i], src_stride[i]);
+    }
+}
+
+#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
+
+#define LOAD4(mem,dst) \
+            "movd      "mem", "#dst" \n\t"\
+            "punpcklbw %%mm7, "#dst" \n\t"
+
+#define PABS(tmp,dst) \
+            "pxor     "#tmp", "#tmp" \n\t"\
+            "psubw    "#dst", "#tmp" \n\t"\
+            "pmaxsw   "#tmp", "#dst" \n\t"
+
+#define CHECK(pj,mj) \
+            "movq "#pj"(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1+j] */\
+            "movq "#mj"(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1-j] */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "movq      %%mm2, %%mm5 \n\t"\
+            "pxor      %%mm3, %%mm4 \n\t"\
+            "pavgb     %%mm3, %%mm5 \n\t"\
+            "pand     %[pb1], %%mm4 \n\t"\
+            "psubusb   %%mm4, %%mm5 \n\t"\
+            "psrlq     $8,    %%mm5 \n\t"\
+            "punpcklbw %%mm7, %%mm5 \n\t" /* (cur[x-refs+j] + cur[x+refs-j])>>1 */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "psubusb   %%mm3, %%mm2 \n\t"\
+            "psubusb   %%mm4, %%mm3 \n\t"\
+            "pmaxub    %%mm3, %%mm2 \n\t"\
+            "movq      %%mm2, %%mm3 \n\t"\
+            "movq      %%mm2, %%mm4 \n\t" /* ABS(cur[x-refs-1+j] - cur[x+refs-1-j]) */\
+            "psrlq      $8,   %%mm3 \n\t" /* ABS(cur[x-refs  +j] - cur[x+refs  -j]) */\
+            "psrlq     $16,   %%mm4 \n\t" /* ABS(cur[x-refs+1+j] - cur[x+refs+1-j]) */\
+            "punpcklbw %%mm7, %%mm2 \n\t"\
+            "punpcklbw %%mm7, %%mm3 \n\t"\
+            "punpcklbw %%mm7, %%mm4 \n\t"\
+            "paddw     %%mm3, %%mm2 \n\t"\
+            "paddw     %%mm4, %%mm2 \n\t" /* score */
+
+#define CHECK1 \
+            "movq      %%mm0, %%mm3 \n\t"\
+            "pcmpgtw   %%mm2, %%mm3 \n\t" /* if(score < spatial_score) */\
+            "pminsw    %%mm2, %%mm0 \n\t" /* spatial_score= score; */\
+            "movq      %%mm3, %%mm6 \n\t"\
+            "pand      %%mm3, %%mm5 \n\t"\
+            "pandn     %%mm1, %%mm3 \n\t"\
+            "por       %%mm5, %%mm3 \n\t"\
+            "movq      %%mm3, %%mm1 \n\t" /* spatial_pred= (cur[x-refs+j] + cur[x+refs-j])>>1; */
+
+#define CHECK2 /* pretend not to have checked dir=2 if dir=1 was bad.\
+                  hurts both quality and speed, but matches the C version. */\
+            "paddw    %[pw1], %%mm6 \n\t"\
+            "psllw     $14,   %%mm6 \n\t"\
+            "paddsw    %%mm6, %%mm2 \n\t"\
+            "movq      %%mm0, %%mm3 \n\t"\
+            "pcmpgtw   %%mm2, %%mm3 \n\t"\
+            "pminsw    %%mm2, %%mm0 \n\t"\
+            "pand      %%mm3, %%mm5 \n\t"\
+            "pandn     %%mm1, %%mm3 \n\t"\
+            "por       %%mm5, %%mm3 \n\t"\
+            "movq      %%mm3, %%mm1 \n\t"
+
+static void filter_line_mmx2(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity){
+    static const uint64_t pw_1 = 0x0001000100010001ULL;
+    static const uint64_t pb_1 = 0x0101010101010101ULL;
+    const int mode = p->mode;
+    uint64_t tmp0, tmp1, tmp2, tmp3;
+    int x;
+
+#define FILTER\
+    for(x=0; x<w; x+=4){\
+        asm volatile(\
+            "pxor      %%mm7, %%mm7 \n\t"\
+            LOAD4("(%[cur],%[mrefs])", %%mm0) /* c = cur[x-refs] */\
+            LOAD4("(%[cur],%[prefs])", %%mm1) /* e = cur[x+refs] */\
+            LOAD4("(%["prev2"])", %%mm2) /* prev2[x] */\
+            LOAD4("(%["next2"])", %%mm3) /* next2[x] */\
+            "movq      %%mm3, %%mm4 \n\t"\
+            "paddw     %%mm2, %%mm3 \n\t"\
+            "psraw     $1,    %%mm3 \n\t" /* d = (prev2[x] + next2[x])>>1 */\
+            "movq      %%mm0, %[tmp0] \n\t" /* c */\
+            "movq      %%mm3, %[tmp1] \n\t" /* d */\
+            "movq      %%mm1, %[tmp2] \n\t" /* e */\
+            "psubw     %%mm4, %%mm2 \n\t"\
+            PABS(      %%mm4, %%mm2) /* temporal_diff0 */\
+            LOAD4("(%[prev],%[mrefs])", %%mm3) /* prev[x-refs] */\
+            LOAD4("(%[prev],%[prefs])", %%mm4) /* prev[x+refs] */\
+            "psubw     %%mm0, %%mm3 \n\t"\
+            "psubw     %%mm1, %%mm4 \n\t"\
+            PABS(      %%mm5, %%mm3)\
+            PABS(      %%mm5, %%mm4)\
+            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff1 */\
+            "psrlw     $1,    %%mm2 \n\t"\
+            "psrlw     $1,    %%mm3 \n\t"\
+            "pmaxsw    %%mm3, %%mm2 \n\t"\
+            LOAD4("(%[next],%[mrefs])", %%mm3) /* next[x-refs] */\
+            LOAD4("(%[next],%[prefs])", %%mm4) /* next[x+refs] */\
+            "psubw     %%mm0, %%mm3 \n\t"\
+            "psubw     %%mm1, %%mm4 \n\t"\
+            PABS(      %%mm5, %%mm3)\
+            PABS(      %%mm5, %%mm4)\
+            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff2 */\
+            "psrlw     $1,    %%mm3 \n\t"\
+            "pmaxsw    %%mm3, %%mm2 \n\t"\
+            "movq      %%mm2, %[tmp3] \n\t" /* diff */\
+\
+            "paddw     %%mm0, %%mm1 \n\t"\
+            "paddw     %%mm0, %%mm0 \n\t"\
+            "psubw     %%mm1, %%mm0 \n\t"\
+            "psrlw     $1,    %%mm1 \n\t" /* spatial_pred */\
+            PABS(      %%mm2, %%mm0)      /* ABS(c-e) */\
+\
+            "movq -1(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1] */\
+            "movq -1(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1] */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "psubusb   %%mm3, %%mm2 \n\t"\
+            "psubusb   %%mm4, %%mm3 \n\t"\
+            "pmaxub    %%mm3, %%mm2 \n\t"\
+            "pshufw $9,%%mm2, %%mm3 \n\t"\
+            "punpcklbw %%mm7, %%mm2 \n\t" /* ABS(cur[x-refs-1] - cur[x+refs-1]) */\
+            "punpcklbw %%mm7, %%mm3 \n\t" /* ABS(cur[x-refs+1] - cur[x+refs+1]) */\
+            "paddw     %%mm2, %%mm0 \n\t"\
+            "paddw     %%mm3, %%mm0 \n\t"\
+            "psubw    %[pw1], %%mm0 \n\t" /* spatial_score */\
+\
+            CHECK(-2,0)\
+            CHECK1\
+            CHECK(-3,1)\
+            CHECK2\
+            CHECK(0,-2)\
+            CHECK1\
+            CHECK(1,-3)\
+            CHECK2\
+\
+            /* if(p->mode<2) ... */\
+            "movq    %[tmp3], %%mm6 \n\t" /* diff */\
+            "cmp       $2, %[mode] \n\t"\
+            "jge       1f \n\t"\
+            LOAD4("(%["prev2"],%[mrefs],2)", %%mm2) /* prev2[x-2*refs] */\
+            LOAD4("(%["next2"],%[mrefs],2)", %%mm4) /* next2[x-2*refs] */\
+            LOAD4("(%["prev2"],%[prefs],2)", %%mm3) /* prev2[x+2*refs] */\
+            LOAD4("(%["next2"],%[prefs],2)", %%mm5) /* next2[x+2*refs] */\
+            "paddw     %%mm4, %%mm2 \n\t"\
+            "paddw     %%mm5, %%mm3 \n\t"\
+            "psrlw     $1,    %%mm2 \n\t" /* b */\
+            "psrlw     $1,    %%mm3 \n\t" /* f */\
+            "movq    %[tmp0], %%mm4 \n\t" /* c */\
+            "movq    %[tmp1], %%mm5 \n\t" /* d */\
+            "movq    %[tmp2], %%mm7 \n\t" /* e */\
+            "psubw     %%mm4, %%mm2 \n\t" /* b-c */\
+            "psubw     %%mm7, %%mm3 \n\t" /* f-e */\
+            "movq      %%mm5, %%mm0 \n\t"\
+            "psubw     %%mm4, %%mm5 \n\t" /* d-c */\
+            "psubw     %%mm7, %%mm0 \n\t" /* d-e */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "pminsw    %%mm3, %%mm2 \n\t"\
+            "pmaxsw    %%mm4, %%mm3 \n\t"\
+            "pmaxsw    %%mm5, %%mm2 \n\t"\
+            "pminsw    %%mm5, %%mm3 \n\t"\
+            "pmaxsw    %%mm0, %%mm2 \n\t" /* max */\
+            "pminsw    %%mm0, %%mm3 \n\t" /* min */\
+            "pxor      %%mm4, %%mm4 \n\t"\
+            "pmaxsw    %%mm3, %%mm6 \n\t"\
+            "psubw     %%mm2, %%mm4 \n\t" /* -max */\
+            "pmaxsw    %%mm4, %%mm6 \n\t" /* diff= MAX3(diff, min, -max); */\
+            "1: \n\t"\
+\
+            "movq    %[tmp1], %%mm2 \n\t" /* d */\
+            "movq      %%mm2, %%mm3 \n\t"\
+            "psubw     %%mm6, %%mm2 \n\t" /* d-diff */\
+            "paddw     %%mm6, %%mm3 \n\t" /* d+diff */\
+            "pmaxsw    %%mm2, %%mm1 \n\t"\
+            "pminsw    %%mm3, %%mm1 \n\t" /* d = clip(spatial_pred, d-diff, d+diff); */\
+            "packuswb  %%mm1, %%mm1 \n\t"\
+\
+            :[tmp0]"=m"(tmp0),\
+             [tmp1]"=m"(tmp1),\
+             [tmp2]"=m"(tmp2),\
+             [tmp3]"=m"(tmp3)\
+            :[prev] "r"(prev),\
+             [cur]  "r"(cur),\
+             [next] "r"(next),\
+             [prefs]"r"((long)refs),\
+             [mrefs]"r"((long)-refs),\
+             [pw1]  "m"(pw_1),\
+             [pb1]  "m"(pb_1),\
+             [mode] "g"(mode)\
+        );\
+        asm volatile("movd %%mm1, %0" :"=m"(*dst));\
+        dst += 4;\
+        prev+= 4;\
+        cur += 4;\
+        next+= 4;\
+    }
+
+    if(parity){
+#define prev2 "prev"
+#define next2 "cur"
+        FILTER
+#undef prev2
+#undef next2
+    }else{
+#define prev2 "cur"
+#define next2 "next"
+        FILTER
+#undef prev2
+#undef next2
+    }
+}
+#undef LOAD4
+#undef PABS
+#undef CHECK
+#undef CHECK1
+#undef CHECK2
+#undef FILTER
+
+#endif /* defined(HAVE_MMX) && defined(NAMED_ASM_ARGS) */
+
+static void filter_line_c(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity){
+    int x;
+    uint8_t *prev2= parity ? prev : cur ;
+    uint8_t *next2= parity ? cur  : next;
+    for(x=0; x<w; x++){
+        int c= cur[-refs];
+        int d= (prev2[0] + next2[0])>>1;
+        int e= cur[+refs];
+        int temporal_diff0= ABS(prev2[0] - next2[0]);
+        int temporal_diff1=( ABS(prev[-refs] - c) + ABS(prev[+refs] - e) )>>1;
+        int temporal_diff2=( ABS(next[-refs] - c) + ABS(next[+refs] - e) )>>1;
+        int diff= MAX3(temporal_diff0>>1, temporal_diff1, temporal_diff2);
+        int spatial_pred= (c+e)>>1;
+        int spatial_score= ABS(cur[-refs-1] - cur[+refs-1]) + ABS(c-e)
+                         + ABS(cur[-refs+1] - cur[+refs+1]) - 1;
+
+#define CHECK(j)\
+    {   int score= ABS(cur[-refs-1+j] - cur[+refs-1-j])\
+                 + ABS(cur[-refs  +j] - cur[+refs  -j])\
+                 + ABS(cur[-refs+1+j] - cur[+refs+1-j]);\
+        if(score < spatial_score){\
+            spatial_score= score;\
+            spatial_pred= (cur[-refs  +j] + cur[+refs  -j])>>1;\
+
+        CHECK(-1) CHECK(-2) }} }}
+        CHECK( 1) CHECK( 2) }} }}
+
+        if(p->mode<2){
+            int b= (prev2[-2*refs] + next2[-2*refs])>>1;
+            int f= (prev2[+2*refs] + next2[+2*refs])>>1;
+#if 0
+            int a= cur[-3*refs];
+            int g= cur[+3*refs];
+            int max= MAX3(d-e, d-c, MIN3(MAX(b-c,f-e),MAX(b-c,b-a),MAX(f-g,f-e)) );
+            int min= MIN3(d-e, d-c, MAX3(MIN(b-c,f-e),MIN(b-c,b-a),MIN(f-g,f-e)) );
+#else
+            int max= MAX3(d-e, d-c, MIN(b-c, f-e));
+            int min= MIN3(d-e, d-c, MAX(b-c, f-e));
+#endif
+
+            diff= MAX3(diff, min, -max);
+        }
+
+        if(spatial_pred > d + diff)
+           spatial_pred = d + diff;
+        else if(spatial_pred < d - diff)
+           spatial_pred = d - diff;
+
+        dst[0] = spatial_pred;
+
+        dst++;
+        cur++;
+        prev++;
+        next++;
+        prev2++;
+        next2++;
+    }
+}
+
+static void filter(struct vf_priv_s *p, uint8_t *dst[3], int dst_stride[3], int width, int height, int parity, int tff){
+    int x, y, i;
+
+    for(i=0; i<3; i++){
+        int is_chroma= !!i;
+        int w= width >>is_chroma;
+        int h= height>>is_chroma;
+        int refs= p->stride[i];
+
+        for(y=0; y<h; y++){
+            if((y ^ parity) & 1){
+                uint8_t *prev= &p->ref[0][i][y*refs];
+                uint8_t *cur = &p->ref[1][i][y*refs];
+                uint8_t *next= &p->ref[2][i][y*refs];
+                uint8_t *dst2= &dst[i][y*dst_stride[i]];
+                filter_line(p, dst2, prev, cur, next, w, refs, parity ^ tff);
+            }else{
+                memcpy(&dst[i][y*dst_stride[i]], &p->ref[1][i][y*refs], w);
+            }
+        }
+    }
+#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
+    if(CpuCaps::hasMMXEXT()) asm volatile("emms \n\t" : : : "memory");
+#endif
+}
+//***************************************************
+//***************************************************
+char *ADMVideoYadif::printConf( void )
+{
+  static char buf[50];
+ 	
+  sprintf((char *)buf," Yadif");
+  return buf;
+}
+
+ADMVideoYadif::ADMVideoYadif(AVDMGenericVideoStream *in, CONFcouple *couples)
+{
+  _in=in;		
+
+  memcpy(&_info,_in->getInfo(),sizeof(_info)); 
+  _info.encoding=1;
+
+ // _uncompressed=new uint8_t [3*_in->getInfo()->width*_in->getInfo()->height];
+ 
+
+  if(couples)
+  {
+   	 _param=NEW(YADIF_PARAM);
+	GET(mode);
+  }
+  else
+  {
+    _param = NEW( YADIF_PARAM);
+    _param->mode=0;
+  }
+ _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
+  ADM_assert(_uncompressed);    	  	
+
+  // Allocate
+  uint32_t w=(_info.width+31)&(~31);
+  uint32_t h=(_info.height+6+31)&(~31);
+  for(int i=0;i<3;i++)
+  {
+    _images[i]=new ADMImage(w,h); 
+  }
+  memset(&priv,0,sizeof(priv));
+  for(int i=0;i<3;i++)
+  {
+    priv.ref[i][0]=YPLANE(_images[i]);
+    priv.ref[i][1]=UPLANE(_images[i]);
+    priv.ref[i][2]=VPLANE(_images[i]);
+  }
+  
+  
+}
+
+uint8_t ADMVideoYadif::configure( AVDMGenericVideoStream *instream) 
+{
+  _in= instream;
+  return 1;
+}
+
+uint8_t	ADMVideoYadif::getCoupledConf( CONFcouple **couples)
+{
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+
+          ADM_assert(_param);
+          *couples=new CONFcouple(1);
+
+          CSET(mode);
+          return 1;
+
+}
+
+
+ADMVideoYadif::~ADMVideoYadif()
+{
+        delete  _uncompressed;
+        _uncompressed=NULL;
+        DELETE(_param);
+        for(int i=0;i<3;i++)
+            delete _images[i];
+}
+uint8_t ADMVideoYadif::getFrameNumberNoAlloc(uint32_t frame,
+                                              uint32_t *len,
+                                              ADMImage *data,
+                                              uint32_t *flags)
+{
+  ADM_assert(frame<_info.nb_frames);
+                                                                
+  // read uncompressed frame
+  if(!_in->getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
+  
+  
+  
+  *len= (_info.width * _info.height*3) >>1;
+  return 1;
+}
+
+//***************************************************
+//***************************************************
+#if OPOPOP
+static int config(struct vf_instance_s* vf,
+        int width, int height, int d_width, int d_height,
+	unsigned int flags, unsigned int outfmt){
+        int i, j;
+
+        for(i=0; i<3; i++){
+            int is_chroma= !!i;
+            int w= ((width   + 31) & (~31))>>is_chroma;
+            int h= ((height+6+ 31) & (~31))>>is_chroma;
+
+            vf->priv->stride[i]= w;
+            for(j=0; j<3; j++)
+                vf->priv->ref[j][i]= malloc(w*h*sizeof(uint8_t))+3*w;
+        }
+
+	return vf_next_config(vf,width,height,d_width,d_height,flags,outfmt);
+}
+
+static int continue_buffered_image(struct vf_instance_s *vf);
+extern int correct_pts;
+
+static int put_image(struct vf_instance_s* vf, mp_image_t *mpi, double pts){
+    int tff;
+
+    if(vf->priv->parity < 0) {
+        if (mpi->fields & MP_IMGFIELD_ORDERED)
+            tff = !!(mpi->fields & MP_IMGFIELD_TOP_FIRST);
+        else
+            tff = 1;
+    }
+    else tff = (vf->priv->parity&1)^1;
+
+    store_ref(vf->priv, mpi->planes, mpi->stride, mpi->w, mpi->h);
+
+    vf->priv->buffered_mpi = mpi;
+    vf->priv->buffered_tff = tff;
+    vf->priv->buffered_i = 0;
+    vf->priv->buffered_pts = pts;
+
+    if(vf->priv->do_deinterlace == 0)
+        return vf_next_put_image(vf, mpi, pts);
+    else if(vf->priv->do_deinterlace == 1){
+        vf->priv->do_deinterlace= 2;
+        return 0;
+    }else
+        return continue_buffered_image(vf);
+}
+
+static int continue_buffered_image(struct vf_instance_s *vf)
+{
+    mp_image_t *mpi = vf->priv->buffered_mpi;
+    int tff = vf->priv->buffered_tff;
+    double pts = vf->priv->buffered_pts;
+    int i;
+    int ret=0;
+    mp_image_t *dmpi;
+
+    pts += vf->priv->buffered_i * .02; // XXX not right
+
+    for(i = vf->priv->buffered_i; i<=(vf->priv->mode&1); i++){
+        dmpi=vf_get_image(vf->next,mpi->imgfmt,
+            MP_IMGTYPE_TEMP,
+            MP_IMGFLAG_ACCEPT_STRIDE|MP_IMGFLAG_PREFER_ALIGNED_STRIDE,
+            mpi->width,mpi->height);
+        vf_clone_mpi_attributes(dmpi, mpi);
+        filter(vf->priv, dmpi->planes, dmpi->stride, mpi->w, mpi->h, i ^ tff ^ 1, tff);
+        if (correct_pts && i < (vf->priv->mode & 1))
+            vf_queue_frame(vf, continue_buffered_image);
+        ret |= vf_next_put_image(vf, dmpi, pts /*FIXME*/);
+        if (correct_pts)
+            break;
+        if(i<(vf->priv->mode&1))
+            vf_next_control(vf, VFCTRL_FLIP_PAGE, NULL);
+    }
+    vf->priv->buffered_i = 1;
+    return ret;
+}
+
+static void uninit(struct vf_instance_s* vf){
+    int i;
+    if(!vf->priv) return;
+
+    for(i=0; i<3*3; i++){
+        uint8_t **p= &vf->priv->ref[i%3][i/3];
+        if(*p) free(*p - 3*vf->priv->stride[i/3]);
+        *p= NULL;
+    }
+    free(vf->priv);
+    vf->priv=NULL;
+}
+
+//===========================================================================//
+static int query_format(struct vf_instance_s* vf, unsigned int fmt){
+    switch(fmt){
+	case IMGFMT_YV12:
+	case IMGFMT_I420:
+	case IMGFMT_IYUV:
+	case IMGFMT_Y800:
+	case IMGFMT_Y8:
+	    return vf_next_query_format(vf,fmt);
+    }
+    return 0;
+}
+
+static int control(struct vf_instance_s* vf, int request, void* data){
+    switch (request){
+      case VFCTRL_GET_DEINTERLACE:
+        *(int*)data = vf->priv->do_deinterlace;
+        return CONTROL_OK;
+      case VFCTRL_SET_DEINTERLACE:
+        vf->priv->do_deinterlace = 2*!!*(int*)data;
+        return CONTROL_OK;
+    }
+    return vf_next_control (vf, request, data);
+}
+
+static int open(vf_instance_t *vf, char* args){
+
+    vf->config=config;
+    vf->put_image=put_image;
+    vf->query_format=query_format;
+    vf->uninit=uninit;
+    vf->priv=malloc(sizeof(struct vf_priv_s));
+    vf->control=control;
+    memset(vf->priv, 0, sizeof(struct vf_priv_s));
+
+    vf->priv->mode=0;
+    vf->priv->parity= -1;
+    vf->priv->do_deinterlace=1;
+
+    if (args) sscanf(args, "%d:%d", &vf->priv->mode, &vf->priv->parity);
+
+    filter_line = filter_line_c;
+#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
+    if(gCpuCaps.hasMMX2) filter_line = filter_line_mmx2;
+#endif
+
+    return 1;
+}
+
+vf_info_t vf_info_yadif = {
+    "Yet Another DeInterlacing Filter",
+    "yadif",
+    "Michael Niedermayer",
+    "",
+    open,
+    NULL
+};
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-13 08:19:43 UTC (rev 2930)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-13 12:12:24 UTC (rev 2931)
@@ -50,7 +50,8 @@
  ADM_vidFlux.cpp \
  ADM_vidMsmooth.cpp \
  ADM_vidFastConvolution.cpp  \
- ADM_vidRotate.cpp
+ ADM_vidRotate.cpp \
+ ADM_vidYadif.cpp
 			
 
 



From mean at mail.berlios.de  Fri Apr 13 17:38:42 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 13 Apr 2007 17:38:42 +0200
Subject: [Avidemux-svn-commit] r2932 -
	branches/avidemux_2.4_branch/avidemux/ADM_videoFilter
Message-ID: <200704131538.l3DFcgd8017091@sheep.berlios.de>

Author: mean
Date: 2007-04-13 17:38:41 +0200 (Fri, 13 Apr 2007)
New Revision: 2932

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
yadif, ported from Fizick avisynth port, original from michael Niedermeyer

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 12:12:24 UTC (rev 2931)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 15:38:41 UTC (rev 2932)
@@ -1,19 +1,25 @@
 /*
-    Copyright (C) 2006 Michael Niedermayer <michaelni at gmx.at>
+	Yadif C-plugin for Avisynth 2.5 - Yet Another DeInterlacing Filter
+	Copyright (C)2007 Alexander G. Balakhnin aka Fizick  http://avisynth.org.ru
+    Port of YADIF filter from MPlayer
+	Copyright (C) 2006 Michael Niedermayer <michaelni at gmx.at>
 
     This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation.
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
 
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+
+    Avisynth_C plugin
+	Assembler optimized for GNU C compiler
+
 */
 /*
   Ported to avidemux by mean
@@ -49,33 +55,28 @@
 #define MAX3(a,b,c) MAX(MAX(a,b),c)
 
 //===========================================================================//
-
-struct vf_priv_s {
-    int mode;
-    int parity;
-    int buffered_i;
-    int buffered_tff;
-    double buffered_pts;
-    ADMImage *buffered_mpi;
-    int stride[3];
-    uint8_t *ref[4][3];
-    int do_deinterlace;
-};
-
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+extern "C"
+{
+void filter_line_mmx2(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity);
+}
+#endif
 //
 typedef struct YADIF_PARAM
 {
     uint32_t mode;
+    uint32_t order;
 }YADIF_PARAM;
 
 class  ADMVideoYadif:public AVDMGenericVideoStream
 {
 
  protected:
-  virtual char                  *printConf(void);
+  virtual char                 *printConf(void);
   YADIF_PARAM                  *_param;
-  ADMImage                     *_images[4];
-  vf_priv_s                    priv;
+   VideoCache                  *vidCache;
+  void                         updateInfo(void);
+
  public:
                   ADMVideoYadif(AVDMGenericVideoStream *in, CONFcouple *setup);
   virtual         ~ADMVideoYadif();
@@ -84,348 +85,26 @@
   virtual uint8_t	getCoupledConf( CONFcouple **couples)				;
  }     ;
 
-static FILTER_PARAM yadifParam={1,{"mode","height","angle"}};
+static FILTER_PARAM yadifParam={2,{"mode","order"}};
 
 
 SCRIPT_CREATE(yadif_script,ADMVideoYadif,yadifParam);
 BUILD_CREATE(yadif_create,ADMVideoYadif);
 //
+static void filter_plane(int mode, uint8_t *dst, int dst_stride, const uint8_t *prev0, const uint8_t *cur0, const uint8_t *next0, int refs, int w, int h, int parity, int tff, int mmx);
 
 
-
 //
-static void (*filter_line)(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity);
 
 
-void memcpy_pic(uint8_t *tgt,uint8_t *src, uint32_t w,uint32_t h, uint32_t d_stride,uint32_t s_stride)
-{
-    for(int y=0;y<h;y++)
-    {
-      memcpy(tgt,src,w);
-      tgt+=d_stride;
-      src+=s_stride; 
-    }
-}
 
-static void store_ref(struct vf_priv_s *p, uint8_t *src[3], int src_stride[3], int width, int height){
-    int i;
-
-    memcpy (p->ref[3], p->ref[0], sizeof(uint8_t *)*3);
-    memmove(p->ref[0], p->ref[1], sizeof(uint8_t *)*3*3);
-
-    for(i=0; i<3; i++){
-        int is_chroma= !!i;
-
-        memcpy_pic(p->ref[2][i], src[i], width>>is_chroma, height>>is_chroma, p->stride[i], src_stride[i]);
-    }
-}
-
-#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
-
-#define LOAD4(mem,dst) \
-            "movd      "mem", "#dst" \n\t"\
-            "punpcklbw %%mm7, "#dst" \n\t"
-
-#define PABS(tmp,dst) \
-            "pxor     "#tmp", "#tmp" \n\t"\
-            "psubw    "#dst", "#tmp" \n\t"\
-            "pmaxsw   "#tmp", "#dst" \n\t"
-
-#define CHECK(pj,mj) \
-            "movq "#pj"(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1+j] */\
-            "movq "#mj"(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1-j] */\
-            "movq      %%mm2, %%mm4 \n\t"\
-            "movq      %%mm2, %%mm5 \n\t"\
-            "pxor      %%mm3, %%mm4 \n\t"\
-            "pavgb     %%mm3, %%mm5 \n\t"\
-            "pand     %[pb1], %%mm4 \n\t"\
-            "psubusb   %%mm4, %%mm5 \n\t"\
-            "psrlq     $8,    %%mm5 \n\t"\
-            "punpcklbw %%mm7, %%mm5 \n\t" /* (cur[x-refs+j] + cur[x+refs-j])>>1 */\
-            "movq      %%mm2, %%mm4 \n\t"\
-            "psubusb   %%mm3, %%mm2 \n\t"\
-            "psubusb   %%mm4, %%mm3 \n\t"\
-            "pmaxub    %%mm3, %%mm2 \n\t"\
-            "movq      %%mm2, %%mm3 \n\t"\
-            "movq      %%mm2, %%mm4 \n\t" /* ABS(cur[x-refs-1+j] - cur[x+refs-1-j]) */\
-            "psrlq      $8,   %%mm3 \n\t" /* ABS(cur[x-refs  +j] - cur[x+refs  -j]) */\
-            "psrlq     $16,   %%mm4 \n\t" /* ABS(cur[x-refs+1+j] - cur[x+refs+1-j]) */\
-            "punpcklbw %%mm7, %%mm2 \n\t"\
-            "punpcklbw %%mm7, %%mm3 \n\t"\
-            "punpcklbw %%mm7, %%mm4 \n\t"\
-            "paddw     %%mm3, %%mm2 \n\t"\
-            "paddw     %%mm4, %%mm2 \n\t" /* score */
-
-#define CHECK1 \
-            "movq      %%mm0, %%mm3 \n\t"\
-            "pcmpgtw   %%mm2, %%mm3 \n\t" /* if(score < spatial_score) */\
-            "pminsw    %%mm2, %%mm0 \n\t" /* spatial_score= score; */\
-            "movq      %%mm3, %%mm6 \n\t"\
-            "pand      %%mm3, %%mm5 \n\t"\
-            "pandn     %%mm1, %%mm3 \n\t"\
-            "por       %%mm5, %%mm3 \n\t"\
-            "movq      %%mm3, %%mm1 \n\t" /* spatial_pred= (cur[x-refs+j] + cur[x+refs-j])>>1; */
-
-#define CHECK2 /* pretend not to have checked dir=2 if dir=1 was bad.\
-                  hurts both quality and speed, but matches the C version. */\
-            "paddw    %[pw1], %%mm6 \n\t"\
-            "psllw     $14,   %%mm6 \n\t"\
-            "paddsw    %%mm6, %%mm2 \n\t"\
-            "movq      %%mm0, %%mm3 \n\t"\
-            "pcmpgtw   %%mm2, %%mm3 \n\t"\
-            "pminsw    %%mm2, %%mm0 \n\t"\
-            "pand      %%mm3, %%mm5 \n\t"\
-            "pandn     %%mm1, %%mm3 \n\t"\
-            "por       %%mm5, %%mm3 \n\t"\
-            "movq      %%mm3, %%mm1 \n\t"
-
-static void filter_line_mmx2(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity){
-    static const uint64_t pw_1 = 0x0001000100010001ULL;
-    static const uint64_t pb_1 = 0x0101010101010101ULL;
-    const int mode = p->mode;
-    uint64_t tmp0, tmp1, tmp2, tmp3;
-    int x;
-
-#define FILTER\
-    for(x=0; x<w; x+=4){\
-        asm volatile(\
-            "pxor      %%mm7, %%mm7 \n\t"\
-            LOAD4("(%[cur],%[mrefs])", %%mm0) /* c = cur[x-refs] */\
-            LOAD4("(%[cur],%[prefs])", %%mm1) /* e = cur[x+refs] */\
-            LOAD4("(%["prev2"])", %%mm2) /* prev2[x] */\
-            LOAD4("(%["next2"])", %%mm3) /* next2[x] */\
-            "movq      %%mm3, %%mm4 \n\t"\
-            "paddw     %%mm2, %%mm3 \n\t"\
-            "psraw     $1,    %%mm3 \n\t" /* d = (prev2[x] + next2[x])>>1 */\
-            "movq      %%mm0, %[tmp0] \n\t" /* c */\
-            "movq      %%mm3, %[tmp1] \n\t" /* d */\
-            "movq      %%mm1, %[tmp2] \n\t" /* e */\
-            "psubw     %%mm4, %%mm2 \n\t"\
-            PABS(      %%mm4, %%mm2) /* temporal_diff0 */\
-            LOAD4("(%[prev],%[mrefs])", %%mm3) /* prev[x-refs] */\
-            LOAD4("(%[prev],%[prefs])", %%mm4) /* prev[x+refs] */\
-            "psubw     %%mm0, %%mm3 \n\t"\
-            "psubw     %%mm1, %%mm4 \n\t"\
-            PABS(      %%mm5, %%mm3)\
-            PABS(      %%mm5, %%mm4)\
-            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff1 */\
-            "psrlw     $1,    %%mm2 \n\t"\
-            "psrlw     $1,    %%mm3 \n\t"\
-            "pmaxsw    %%mm3, %%mm2 \n\t"\
-            LOAD4("(%[next],%[mrefs])", %%mm3) /* next[x-refs] */\
-            LOAD4("(%[next],%[prefs])", %%mm4) /* next[x+refs] */\
-            "psubw     %%mm0, %%mm3 \n\t"\
-            "psubw     %%mm1, %%mm4 \n\t"\
-            PABS(      %%mm5, %%mm3)\
-            PABS(      %%mm5, %%mm4)\
-            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff2 */\
-            "psrlw     $1,    %%mm3 \n\t"\
-            "pmaxsw    %%mm3, %%mm2 \n\t"\
-            "movq      %%mm2, %[tmp3] \n\t" /* diff */\
-\
-            "paddw     %%mm0, %%mm1 \n\t"\
-            "paddw     %%mm0, %%mm0 \n\t"\
-            "psubw     %%mm1, %%mm0 \n\t"\
-            "psrlw     $1,    %%mm1 \n\t" /* spatial_pred */\
-            PABS(      %%mm2, %%mm0)      /* ABS(c-e) */\
-\
-            "movq -1(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1] */\
-            "movq -1(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1] */\
-            "movq      %%mm2, %%mm4 \n\t"\
-            "psubusb   %%mm3, %%mm2 \n\t"\
-            "psubusb   %%mm4, %%mm3 \n\t"\
-            "pmaxub    %%mm3, %%mm2 \n\t"\
-            "pshufw $9,%%mm2, %%mm3 \n\t"\
-            "punpcklbw %%mm7, %%mm2 \n\t" /* ABS(cur[x-refs-1] - cur[x+refs-1]) */\
-            "punpcklbw %%mm7, %%mm3 \n\t" /* ABS(cur[x-refs+1] - cur[x+refs+1]) */\
-            "paddw     %%mm2, %%mm0 \n\t"\
-            "paddw     %%mm3, %%mm0 \n\t"\
-            "psubw    %[pw1], %%mm0 \n\t" /* spatial_score */\
-\
-            CHECK(-2,0)\
-            CHECK1\
-            CHECK(-3,1)\
-            CHECK2\
-            CHECK(0,-2)\
-            CHECK1\
-            CHECK(1,-3)\
-            CHECK2\
-\
-            /* if(p->mode<2) ... */\
-            "movq    %[tmp3], %%mm6 \n\t" /* diff */\
-            "cmp       $2, %[mode] \n\t"\
-            "jge       1f \n\t"\
-            LOAD4("(%["prev2"],%[mrefs],2)", %%mm2) /* prev2[x-2*refs] */\
-            LOAD4("(%["next2"],%[mrefs],2)", %%mm4) /* next2[x-2*refs] */\
-            LOAD4("(%["prev2"],%[prefs],2)", %%mm3) /* prev2[x+2*refs] */\
-            LOAD4("(%["next2"],%[prefs],2)", %%mm5) /* next2[x+2*refs] */\
-            "paddw     %%mm4, %%mm2 \n\t"\
-            "paddw     %%mm5, %%mm3 \n\t"\
-            "psrlw     $1,    %%mm2 \n\t" /* b */\
-            "psrlw     $1,    %%mm3 \n\t" /* f */\
-            "movq    %[tmp0], %%mm4 \n\t" /* c */\
-            "movq    %[tmp1], %%mm5 \n\t" /* d */\
-            "movq    %[tmp2], %%mm7 \n\t" /* e */\
-            "psubw     %%mm4, %%mm2 \n\t" /* b-c */\
-            "psubw     %%mm7, %%mm3 \n\t" /* f-e */\
-            "movq      %%mm5, %%mm0 \n\t"\
-            "psubw     %%mm4, %%mm5 \n\t" /* d-c */\
-            "psubw     %%mm7, %%mm0 \n\t" /* d-e */\
-            "movq      %%mm2, %%mm4 \n\t"\
-            "pminsw    %%mm3, %%mm2 \n\t"\
-            "pmaxsw    %%mm4, %%mm3 \n\t"\
-            "pmaxsw    %%mm5, %%mm2 \n\t"\
-            "pminsw    %%mm5, %%mm3 \n\t"\
-            "pmaxsw    %%mm0, %%mm2 \n\t" /* max */\
-            "pminsw    %%mm0, %%mm3 \n\t" /* min */\
-            "pxor      %%mm4, %%mm4 \n\t"\
-            "pmaxsw    %%mm3, %%mm6 \n\t"\
-            "psubw     %%mm2, %%mm4 \n\t" /* -max */\
-            "pmaxsw    %%mm4, %%mm6 \n\t" /* diff= MAX3(diff, min, -max); */\
-            "1: \n\t"\
-\
-            "movq    %[tmp1], %%mm2 \n\t" /* d */\
-            "movq      %%mm2, %%mm3 \n\t"\
-            "psubw     %%mm6, %%mm2 \n\t" /* d-diff */\
-            "paddw     %%mm6, %%mm3 \n\t" /* d+diff */\
-            "pmaxsw    %%mm2, %%mm1 \n\t"\
-            "pminsw    %%mm3, %%mm1 \n\t" /* d = clip(spatial_pred, d-diff, d+diff); */\
-            "packuswb  %%mm1, %%mm1 \n\t"\
-\
-            :[tmp0]"=m"(tmp0),\
-             [tmp1]"=m"(tmp1),\
-             [tmp2]"=m"(tmp2),\
-             [tmp3]"=m"(tmp3)\
-            :[prev] "r"(prev),\
-             [cur]  "r"(cur),\
-             [next] "r"(next),\
-             [prefs]"r"((long)refs),\
-             [mrefs]"r"((long)-refs),\
-             [pw1]  "m"(pw_1),\
-             [pb1]  "m"(pb_1),\
-             [mode] "g"(mode)\
-        );\
-        asm volatile("movd %%mm1, %0" :"=m"(*dst));\
-        dst += 4;\
-        prev+= 4;\
-        cur += 4;\
-        next+= 4;\
-    }
-
-    if(parity){
-#define prev2 "prev"
-#define next2 "cur"
-        FILTER
-#undef prev2
-#undef next2
-    }else{
-#define prev2 "cur"
-#define next2 "next"
-        FILTER
-#undef prev2
-#undef next2
-    }
-}
-#undef LOAD4
-#undef PABS
-#undef CHECK
-#undef CHECK1
-#undef CHECK2
-#undef FILTER
-
-#endif /* defined(HAVE_MMX) && defined(NAMED_ASM_ARGS) */
-
-static void filter_line_c(struct vf_priv_s *p, uint8_t *dst, uint8_t *prev, uint8_t *cur, uint8_t *next, int w, int refs, int parity){
-    int x;
-    uint8_t *prev2= parity ? prev : cur ;
-    uint8_t *next2= parity ? cur  : next;
-    for(x=0; x<w; x++){
-        int c= cur[-refs];
-        int d= (prev2[0] + next2[0])>>1;
-        int e= cur[+refs];
-        int temporal_diff0= ABS(prev2[0] - next2[0]);
-        int temporal_diff1=( ABS(prev[-refs] - c) + ABS(prev[+refs] - e) )>>1;
-        int temporal_diff2=( ABS(next[-refs] - c) + ABS(next[+refs] - e) )>>1;
-        int diff= MAX3(temporal_diff0>>1, temporal_diff1, temporal_diff2);
-        int spatial_pred= (c+e)>>1;
-        int spatial_score= ABS(cur[-refs-1] - cur[+refs-1]) + ABS(c-e)
-                         + ABS(cur[-refs+1] - cur[+refs+1]) - 1;
-
-#define CHECK(j)\
-    {   int score= ABS(cur[-refs-1+j] - cur[+refs-1-j])\
-                 + ABS(cur[-refs  +j] - cur[+refs  -j])\
-                 + ABS(cur[-refs+1+j] - cur[+refs+1-j]);\
-        if(score < spatial_score){\
-            spatial_score= score;\
-            spatial_pred= (cur[-refs  +j] + cur[+refs  -j])>>1;\
-
-        CHECK(-1) CHECK(-2) }} }}
-        CHECK( 1) CHECK( 2) }} }}
-
-        if(p->mode<2){
-            int b= (prev2[-2*refs] + next2[-2*refs])>>1;
-            int f= (prev2[+2*refs] + next2[+2*refs])>>1;
-#if 0
-            int a= cur[-3*refs];
-            int g= cur[+3*refs];
-            int max= MAX3(d-e, d-c, MIN3(MAX(b-c,f-e),MAX(b-c,b-a),MAX(f-g,f-e)) );
-            int min= MIN3(d-e, d-c, MAX3(MIN(b-c,f-e),MIN(b-c,b-a),MIN(f-g,f-e)) );
-#else
-            int max= MAX3(d-e, d-c, MIN(b-c, f-e));
-            int min= MIN3(d-e, d-c, MAX(b-c, f-e));
-#endif
-
-            diff= MAX3(diff, min, -max);
-        }
-
-        if(spatial_pred > d + diff)
-           spatial_pred = d + diff;
-        else if(spatial_pred < d - diff)
-           spatial_pred = d - diff;
-
-        dst[0] = spatial_pred;
-
-        dst++;
-        cur++;
-        prev++;
-        next++;
-        prev2++;
-        next2++;
-    }
-}
-
-static void filter(struct vf_priv_s *p, uint8_t *dst[3], int dst_stride[3], int width, int height, int parity, int tff){
-    int x, y, i;
-
-    for(i=0; i<3; i++){
-        int is_chroma= !!i;
-        int w= width >>is_chroma;
-        int h= height>>is_chroma;
-        int refs= p->stride[i];
-
-        for(y=0; y<h; y++){
-            if((y ^ parity) & 1){
-                uint8_t *prev= &p->ref[0][i][y*refs];
-                uint8_t *cur = &p->ref[1][i][y*refs];
-                uint8_t *next= &p->ref[2][i][y*refs];
-                uint8_t *dst2= &dst[i][y*dst_stride[i]];
-                filter_line(p, dst2, prev, cur, next, w, refs, parity ^ tff);
-            }else{
-                memcpy(&dst[i][y*dst_stride[i]], &p->ref[1][i][y*refs], w);
-            }
-        }
-    }
-#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
-    if(CpuCaps::hasMMXEXT()) asm volatile("emms \n\t" : : : "memory");
-#endif
-}
 //***************************************************
 //***************************************************
 char *ADMVideoYadif::printConf( void )
 {
   static char buf[50];
  	
-  sprintf((char *)buf," Yadif");
+  sprintf((char *)buf," Yadif : mode %u order %d",_param->mode, _param->order);
   return buf;
 }
 
@@ -443,37 +122,55 @@
   {
    	 _param=NEW(YADIF_PARAM);
 	GET(mode);
+        GET(order);
   }
   else
   {
     _param = NEW( YADIF_PARAM);
     _param->mode=0;
+    _param->order=1;
   }
- _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
+  _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
   ADM_assert(_uncompressed);    	  	
+  vidCache = new VideoCache (10, in);
+  updateInfo();
+}
 
-  // Allocate
-  uint32_t w=(_info.width+31)&(~31);
-  uint32_t h=(_info.height+6+31)&(~31);
-  for(int i=0;i<3;i++)
+void ADMVideoYadif::updateInfo(void)
+{
+   memcpy(&_info,_in->getInfo(),sizeof(_info)); 
+  if(_param->mode &1 ) // Bob
   {
-    _images[i]=new ADMImage(w,h); 
+    _info.nb_frames*=2;
+    _info.fps1000*=2;
   }
-  memset(&priv,0,sizeof(priv));
-  for(int i=0;i<3;i++)
-  {
-    priv.ref[i][0]=YPLANE(_images[i]);
-    priv.ref[i][1]=UPLANE(_images[i]);
-    priv.ref[i][2]=VPLANE(_images[i]);
-  }
-  
-  
 }
 
 uint8_t ADMVideoYadif::configure( AVDMGenericVideoStream *instream) 
 {
   _in= instream;
-  return 1;
+     diaMenuEntry tMode[]={
+                             {0,      _("Temporal & Spatial check"),NULL},
+                             {1,   _("Bob, T+S check"),NULL},
+                             {2,      _("Skip spatial temporal check"),NULL},
+                             {3,  _("Bob, Skip spatial temporal check"),NULL}
+          };
+     diaMenuEntry tOrder[]={
+                             {0,      _("Bottom Field first"),NULL},
+                             {1,   _("Top Field First"),NULL}
+          };
+  
+     diaElemMenu mMode(&(_param->mode),   _("Mode"), 4,tMode);
+     diaElemMenu morder(&(_param->order),   _("Order"), 2,tOrder);
+     
+     diaElem *elems[]={&mMode,&morder};
+     
+     if(diaFactoryRun("Blend Removal",sizeof(elems)/sizeof(diaElem *),elems))
+     {
+        updateInfo();
+        return 1;
+     }
+     return 0;
 }
 
 uint8_t	ADMVideoYadif::getCoupledConf( CONFcouple **couples)
@@ -481,9 +178,10 @@
 #define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
 
           ADM_assert(_param);
-          *couples=new CONFcouple(1);
+          *couples=new CONFcouple(2);
 
           CSET(mode);
+          CSET(order);
           return 1;
 
 }
@@ -493,175 +191,222 @@
 {
         delete  _uncompressed;
         _uncompressed=NULL;
-        DELETE(_param);
-        for(int i=0;i<3;i++)
-            delete _images[i];
+       
+        delete vidCache;
+        vidCache = NULL;
+        
+        delete _param;
+        _param=NULL;
 }
+
 uint8_t ADMVideoYadif::getFrameNumberNoAlloc(uint32_t frame,
                                               uint32_t *len,
                                               ADMImage *data,
                                               uint32_t *flags)
 {
-  ADM_assert(frame<_info.nb_frames);
-                                                                
-  // read uncompressed frame
-  if(!_in->getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
-  
-  
-  
-  *len= (_info.width * _info.height*3) >>1;
-  return 1;
-}
+        int mode;
+        int parity;
+        int tff;
+        int iplane;
+        int cpu;
+        int n;
+        ADMImage *src, *dst, * prev, *next;
 
-//***************************************************
-//***************************************************
-#if OPOPOP
-static int config(struct vf_instance_s* vf,
-        int width, int height, int d_width, int d_height,
-	unsigned int flags, unsigned int outfmt){
-        int i, j;
+    
+        mode = _param->mode;
 
-        for(i=0; i<3; i++){
-            int is_chroma= !!i;
-            int w= ((width   + 31) & (~31))>>is_chroma;
-            int h= ((height+6+ 31) & (~31))>>is_chroma;
+        if (mode & 1) 
+                n = (frame>>1); // bob
+        else
+                n = frame;
 
-            vf->priv->stride[i]= w;
-            for(j=0; j<3; j++)
-                vf->priv->ref[j][i]= malloc(w*h*sizeof(uint8_t))+3*w;
+        src = vidCache->getImage(n);
+  // Request frame 'n' from the child (source) clip.
+
+        if (n>0)
+                prev =  vidCache->getImage( n-1); // get previous frame
+        else
+                prev= vidCache->getImage(0); // get very first frame
+
+        if (n< _in->getInfo()->nb_frames)
+                next = vidCache->getImage( n+1); // get next frame
+        else
+                next = vidCache->getImage( _in->getInfo()->nb_frames-1); // get last frame
+
+        dst = data;
+        
+        if(!prev || !src || !next)
+        {
+            printf("Failed to read frame for frame %u\n",frame);
+            vidCache->unlockAll();
+            return 0;
         }
+        
+  // Construct a frame based on the information of the current frame
+  // contained in the "vi" struct.
+#if 0 //MEANX
+        if (_params->order == -1)
+//		tff = avs_is_tff(&p->vi) == 0 ? 0 : 1; // 0 or 1
+                tff = avs_get_parity(p->child, n) ? 1 : 0; // 0 or 1
+        else
+#endif
+                tff = _param->order;	
+        
+        parity = (mode & 1) ? (frame & 1) ^ (1^tff) : (tff ^ 1);  // 0 or 1
 
-	return vf_next_config(vf,width,height,d_width,d_height,flags,outfmt);
-}
+      //MEANX  cpu = avs_get_cpu_flags(p->env);
 
-static int continue_buffered_image(struct vf_instance_s *vf);
-extern int correct_pts;
+        for (iplane = 0; iplane<3; iplane++)
+        {
+                ADM_PLANE plane = (iplane==0) ? PLANAR_Y : (iplane==1) ? PLANAR_U : PLANAR_V;
 
-static int put_image(struct vf_instance_s* vf, mp_image_t *mpi, double pts){
-    int tff;
+                const unsigned char* srcp = src->GetWritePtr(plane);
+          // Request a Read pointer from the current source frame
 
-    if(vf->priv->parity < 0) {
-        if (mpi->fields & MP_IMGFIELD_ORDERED)
-            tff = !!(mpi->fields & MP_IMGFIELD_TOP_FIRST);
-        else
-            tff = 1;
-    }
-    else tff = (vf->priv->parity&1)^1;
+                const unsigned char* prevp0 = prev->GetWritePtr( plane);
+                unsigned char* prevp = (unsigned char*) prevp0; // with same pitch
+          // Request a Read pointer from the prev source frame.
 
-    store_ref(vf->priv, mpi->planes, mpi->stride, mpi->w, mpi->h);
+                const unsigned char* nextp0 = next->GetWritePtr( plane);
+                unsigned char* nextp = (unsigned char*) nextp0; // with same pitch
+          // Request a Read pointer from the next source frame.
 
-    vf->priv->buffered_mpi = mpi;
-    vf->priv->buffered_tff = tff;
-    vf->priv->buffered_i = 0;
-    vf->priv->buffered_pts = pts;
+                unsigned char* dstp = dst->GetWritePtr( plane);
+                // Request a Write pointer from the newly created destination image.
+          // You can request a writepointer to images that have just been
 
-    if(vf->priv->do_deinterlace == 0)
-        return vf_next_put_image(vf, mpi, pts);
-    else if(vf->priv->do_deinterlace == 1){
-        vf->priv->do_deinterlace= 2;
-        return 0;
-    }else
-        return continue_buffered_image(vf);
-}
+                const int dst_pitch = dst->GetPitch( plane);
+          // Requests pitch (length of a line) of the destination image.
+          // For more information on pitch see: http://www.avisynth.org/index.php?page=WorkingWithImages
+                // (short version - pitch is always equal to or greater than width to allow for seriously fast assembly code)
 
-static int continue_buffered_image(struct vf_instance_s *vf)
-{
-    mp_image_t *mpi = vf->priv->buffered_mpi;
-    int tff = vf->priv->buffered_tff;
-    double pts = vf->priv->buffered_pts;
-    int i;
-    int ret=0;
-    mp_image_t *dmpi;
+                const int width =dst->GetPitch( plane);
+          // Requests rowsize (number of used bytes in a line.
+          // See the link above for more information.
 
-    pts += vf->priv->buffered_i * .02; // XXX not right
+                const int height = dst->GetHeight( plane);
+          // Requests the height of the destination image.
 
-    for(i = vf->priv->buffered_i; i<=(vf->priv->mode&1); i++){
-        dmpi=vf_get_image(vf->next,mpi->imgfmt,
-            MP_IMGTYPE_TEMP,
-            MP_IMGFLAG_ACCEPT_STRIDE|MP_IMGFLAG_PREFER_ALIGNED_STRIDE,
-            mpi->width,mpi->height);
-        vf_clone_mpi_attributes(dmpi, mpi);
-        filter(vf->priv, dmpi->planes, dmpi->stride, mpi->w, mpi->h, i ^ tff ^ 1, tff);
-        if (correct_pts && i < (vf->priv->mode & 1))
-            vf_queue_frame(vf, continue_buffered_image);
-        ret |= vf_next_put_image(vf, dmpi, pts /*FIXME*/);
-        if (correct_pts)
-            break;
-        if(i<(vf->priv->mode&1))
-            vf_next_control(vf, VFCTRL_FLIP_PAGE, NULL);
-    }
-    vf->priv->buffered_i = 1;
-    return ret;
+                const int src_pitch = src->GetPitch(plane);
+                const int prev_pitch = prev->GetPitch(plane);
+                const int next_pitch = next->GetPitch(plane);
+
+                // in v.0.1-0.3  all source pitches are  assumed equal (for simplicity)
+                                // consider other (rare) case
+                if (prev_pitch != src_pitch)
+                {
+                    prevp = (unsigned char *)ADM_alloc(height*src_pitch);
+                    int h;
+                    for (h=0; h<0; h++)
+                      memcpy(prevp+h*src_pitch, prevp0+h*prev_pitch, width);
+                }
+                    
+                if (next_pitch != src_pitch)
+                {
+                    nextp = (unsigned char *)ADM_alloc(height*src_pitch);
+                    int h;
+                    for (h=0; h<0; h++)
+                      memcpy(nextp+h*src_pitch, nextp0+h*next_pitch, width);
+                }
+                    
+                filter_plane(mode, dstp, dst_pitch, prevp, srcp, nextp, src_pitch, width, height, parity, tff, 0);
+                if (prev_pitch != src_pitch)
+                        ADM_dealloc(prevp);
+                if (next_pitch != src_pitch)
+                        ADM_dealloc(nextp);
+        }
+       vidCache->unlockAll();
+      return 1;
 }
+//****************
 
-static void uninit(struct vf_instance_s* vf){
-    int i;
-    if(!vf->priv) return;
+static void filter_line_c(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity){
+    int x;
+    const uint8_t *prev2= parity ? prev : cur ;
+    const uint8_t *next2= parity ? cur  : next;
+    for(x=0; x<w; x++){
+        int c= cur[-refs];
+        int d= (prev2[0] + next2[0])>>1;
+        int e= cur[+refs];
+        int temporal_diff0= ABS(prev2[0] - next2[0]);
+        int temporal_diff1=( ABS(prev[-refs] - c) + ABS(prev[+refs] - e) )>>1;
+        int temporal_diff2=( ABS(next[-refs] - c) + ABS(next[+refs] - e) )>>1;
+        int diff= MAX3(temporal_diff0>>1, temporal_diff1, temporal_diff2);
+        int spatial_pred= (c+e)>>1;
+        int spatial_score= ABS(cur[-refs-1] - cur[+refs-1]) + ABS(c-e)
+                         + ABS(cur[-refs+1] - cur[+refs+1]) - 1;
 
-    for(i=0; i<3*3; i++){
-        uint8_t **p= &vf->priv->ref[i%3][i/3];
-        if(*p) free(*p - 3*vf->priv->stride[i/3]);
-        *p= NULL;
-    }
-    free(vf->priv);
-    vf->priv=NULL;
-}
+#define CHECK(j)\
+    {   int score= ABS(cur[-refs-1+ j] - cur[+refs-1- j])\
+                 + ABS(cur[-refs  + j] - cur[+refs  - j])\
+                 + ABS(cur[-refs+1+ j] - cur[+refs+1- j]);\
+        if(score < spatial_score){\
+            spatial_score= score;\
+            spatial_pred= (cur[-refs  + j] + cur[+refs  - j])>>1;\
 
-//===========================================================================//
-static int query_format(struct vf_instance_s* vf, unsigned int fmt){
-    switch(fmt){
-	case IMGFMT_YV12:
-	case IMGFMT_I420:
-	case IMGFMT_IYUV:
-	case IMGFMT_Y800:
-	case IMGFMT_Y8:
-	    return vf_next_query_format(vf,fmt);
-    }
-    return 0;
-}
+        CHECK(-1) CHECK(-2) }} }}
+        CHECK( 1) CHECK( 2) }} }}
 
-static int control(struct vf_instance_s* vf, int request, void* data){
-    switch (request){
-      case VFCTRL_GET_DEINTERLACE:
-        *(int*)data = vf->priv->do_deinterlace;
-        return CONTROL_OK;
-      case VFCTRL_SET_DEINTERLACE:
-        vf->priv->do_deinterlace = 2*!!*(int*)data;
-        return CONTROL_OK;
-    }
-    return vf_next_control (vf, request, data);
-}
+        if(mode<2){
+            int b= (prev2[-2*refs] + next2[-2*refs])>>1;
+            int f= (prev2[+2*refs] + next2[+2*refs])>>1;
+#if 0
+            int a= cur[-3*refs];
+            int g= cur[+3*refs];
+            int max= MAX3(d-e, d-c, MIN3(MAX(b-c,f-e),MAX(b-c,b-a),MAX(f-g,f-e)) );
+            int min= MIN3(d-e, d-c, MAX3(MIN(b-c,f-e),MIN(b-c,b-a),MIN(f-g,f-e)) );
+#else
+            int max= MAX3(d-e, d-c, MIN(b-c, f-e));
+            int min= MIN3(d-e, d-c, MAX(b-c, f-e));
+#endif
 
-static int open(vf_instance_t *vf, char* args){
+            diff= MAX3(diff, min, -max);
+        }
 
-    vf->config=config;
-    vf->put_image=put_image;
-    vf->query_format=query_format;
-    vf->uninit=uninit;
-    vf->priv=malloc(sizeof(struct vf_priv_s));
-    vf->control=control;
-    memset(vf->priv, 0, sizeof(struct vf_priv_s));
+        if(spatial_pred > d + diff)
+           spatial_pred = d + diff;
+        else if(spatial_pred < d - diff)
+           spatial_pred = d - diff;
 
-    vf->priv->mode=0;
-    vf->priv->parity= -1;
-    vf->priv->do_deinterlace=1;
+        dst[0] = spatial_pred;
 
-    if (args) sscanf(args, "%d:%d", &vf->priv->mode, &vf->priv->parity);
+        dst++;
+        cur++;
+        prev++;
+        next++;
+        prev2++;
+        next2++;
+    }
+}
 
-    filter_line = filter_line_c;
-#if defined(HAVE_MMX) && defined(NAMED_ASM_ARGS)
-    if(gCpuCaps.hasMMX2) filter_line = filter_line_mmx2;
+void filter_plane(int mode, uint8_t *dst, int dst_stride, const uint8_t *prev0, const uint8_t *cur0, const uint8_t *next0, int refs, int w, int h, int parity, int tff, int mmx)
+{
+void (*filter_line)(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity);
+	int y;
+	filter_line = filter_line_c;
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+	if (CpuCaps::hasMMXEXT()) 
+		filter_line = filter_line_mmx2;
 #endif
 
-    return 1;
-}
+        memcpy(dst, cur0, w);
+        memcpy(dst + dst_stride, cur0 + refs, w);
+        for(y=2; y<h-1; y++){
+            if(((y ^ parity) & 1)){
+                const uint8_t *prev= prev0 + y*refs;
+                const uint8_t *cur = cur0 + y*refs;
+                const uint8_t *next= next0 + y*refs;
+                uint8_t *dst2= dst + y*dst_stride;
+                filter_line(mode, dst2, prev, cur, next, w, refs, (parity ^ tff));
+            }else{
+                memcpy(dst + y*dst_stride, cur0 + y*refs, w);
+            }
+        }
+        memcpy(dst + (h-1)*dst_stride, cur0 + (h-1)*refs, w);
 
-vf_info_t vf_info_yadif = {
-    "Yet Another DeInterlacing Filter",
-    "yadif",
-    "Michael Niedermayer",
-    "",
-    open,
-    NULL
-};
+#ifdef __GNUC__
+	if (mmx) 
+		;//asm volatile("emms");
 #endif
+}
+

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c	2007-04-13 12:12:24 UTC (rev 2931)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif_asm.c	2007-04-13 15:38:41 UTC (rev 2932)
@@ -0,0 +1,228 @@
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <inttypes.h>
+#include <math.h>
+
+#include "default.h"
+#include "admmangle.h"
+
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+
+
+#define LOAD4(mem,dst) \
+            "movd      "mem", "#dst" \n\t"\
+            "punpcklbw %%mm7, "#dst" \n\t"
+
+#define PABS(tmp,dst) \
+            "pxor     "#tmp", "#tmp" \n\t"\
+            "psubw    "#dst", "#tmp" \n\t"\
+            "pmaxsw   "#tmp", "#dst" \n\t"
+
+#define CHECK(pj,mj) \
+            "movq "#pj"(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1+j] */\
+            "movq "#mj"(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1-j] */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "movq      %%mm2, %%mm5 \n\t"\
+            "pxor      %%mm3, %%mm4 \n\t"\
+            "pavgb     %%mm3, %%mm5 \n\t"\
+            "pand     %[pb1], %%mm4 \n\t"\
+            "psubusb   %%mm4, %%mm5 \n\t"\
+            "psrlq     $8,    %%mm5 \n\t"\
+            "punpcklbw %%mm7, %%mm5 \n\t" /* (cur[x-refs+j] + cur[x+refs-j])>>1 */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "psubusb   %%mm3, %%mm2 \n\t"\
+            "psubusb   %%mm4, %%mm3 \n\t"\
+            "pmaxub    %%mm3, %%mm2 \n\t"\
+            "movq      %%mm2, %%mm3 \n\t"\
+            "movq      %%mm2, %%mm4 \n\t" /* ABS(cur[x-refs-1+j] - cur[x+refs-1-j]) */\
+            "psrlq      $8,   %%mm3 \n\t" /* ABS(cur[x-refs  +j] - cur[x+refs  -j]) */\
+            "psrlq     $16,   %%mm4 \n\t" /* ABS(cur[x-refs+1+j] - cur[x+refs+1-j]) */\
+            "punpcklbw %%mm7, %%mm2 \n\t"\
+            "punpcklbw %%mm7, %%mm3 \n\t"\
+            "punpcklbw %%mm7, %%mm4 \n\t"\
+            "paddw     %%mm3, %%mm2 \n\t"\
+            "paddw     %%mm4, %%mm2 \n\t" /* score */
+
+#define CHECK1 \
+            "movq      %%mm0, %%mm3 \n\t"\
+            "pcmpgtw   %%mm2, %%mm3 \n\t" /* if(score < spatial_score) */\
+            "pminsw    %%mm2, %%mm0 \n\t" /* spatial_score= score; */\
+            "movq      %%mm3, %%mm6 \n\t"\
+            "pand      %%mm3, %%mm5 \n\t"\
+            "pandn     %%mm1, %%mm3 \n\t"\
+            "por       %%mm5, %%mm3 \n\t"\
+            "movq      %%mm3, %%mm1 \n\t" /* spatial_pred= (cur[x-refs+j] + cur[x+refs-j])>>1; */
+
+#define CHECK2 /* pretend not to have checked dir=2 if dir=1 was bad.\
+                  hurts both quality and speed, but matches the C version. */\
+            "paddw    %[pw1], %%mm6 \n\t"\
+            "psllw     $14,   %%mm6 \n\t"\
+            "paddsw    %%mm6, %%mm2 \n\t"\
+            "movq      %%mm0, %%mm3 \n\t"\
+            "pcmpgtw   %%mm2, %%mm3 \n\t"\
+            "pminsw    %%mm2, %%mm0 \n\t"\
+            "pand      %%mm3, %%mm5 \n\t"\
+            "pandn     %%mm1, %%mm3 \n\t"\
+            "por       %%mm5, %%mm3 \n\t"\
+            "movq      %%mm3, %%mm1 \n\t"
+
+void filter_line_mmx2(int mode, uint8_t *dst, const uint8_t *prev, const uint8_t *cur, const uint8_t *next, int w, int refs, int parity){
+    static const uint64_t pw_1 = 0x0001000100010001ULL;
+    static const uint64_t pb_1 = 0x0101010101010101ULL;
+//    const int mode = p->mode;
+    uint64_t tmp0, tmp1, tmp2, tmp3;
+    int x;
+
+#define FILTER\
+    for(x=0; x<w; x+=4){\
+        asm volatile(\
+            "pxor      %%mm7, %%mm7 \n\t"\
+            LOAD4("(%[cur],%[mrefs])", %%mm0) /* c = cur[x-refs] */\
+            LOAD4("(%[cur],%[prefs])", %%mm1) /* e = cur[x+refs] */\
+            LOAD4("(%["prev2"])", %%mm2) /* prev2[x] */\
+            LOAD4("(%["next2"])", %%mm3) /* next2[x] */\
+            "movq      %%mm3, %%mm4 \n\t"\
+            "paddw     %%mm2, %%mm3 \n\t"\
+            "psraw     $1,    %%mm3 \n\t" /* d = (prev2[x] + next2[x])>>1 */\
+            "movq      %%mm0, %[tmp0] \n\t" /* c */\
+            "movq      %%mm3, %[tmp1] \n\t" /* d */\
+            "movq      %%mm1, %[tmp2] \n\t" /* e */\
+            "psubw     %%mm4, %%mm2 \n\t"\
+            PABS(      %%mm4, %%mm2) /* temporal_diff0 */\
+            LOAD4("(%[prev],%[mrefs])", %%mm3) /* prev[x-refs] */\
+            LOAD4("(%[prev],%[prefs])", %%mm4) /* prev[x+refs] */\
+            "psubw     %%mm0, %%mm3 \n\t"\
+            "psubw     %%mm1, %%mm4 \n\t"\
+            PABS(      %%mm5, %%mm3)\
+            PABS(      %%mm5, %%mm4)\
+            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff1 */\
+            "psrlw     $1,    %%mm2 \n\t"\
+            "psrlw     $1,    %%mm3 \n\t"\
+            "pmaxsw    %%mm3, %%mm2 \n\t"\
+            LOAD4("(%[next],%[mrefs])", %%mm3) /* next[x-refs] */\
+            LOAD4("(%[next],%[prefs])", %%mm4) /* next[x+refs] */\
+            "psubw     %%mm0, %%mm3 \n\t"\
+            "psubw     %%mm1, %%mm4 \n\t"\
+            PABS(      %%mm5, %%mm3)\
+            PABS(      %%mm5, %%mm4)\
+            "paddw     %%mm4, %%mm3 \n\t" /* temporal_diff2 */\
+            "psrlw     $1,    %%mm3 \n\t"\
+            "pmaxsw    %%mm3, %%mm2 \n\t"\
+            "movq      %%mm2, %[tmp3] \n\t" /* diff */\
+\
+            "paddw     %%mm0, %%mm1 \n\t"\
+            "paddw     %%mm0, %%mm0 \n\t"\
+            "psubw     %%mm1, %%mm0 \n\t"\
+            "psrlw     $1,    %%mm1 \n\t" /* spatial_pred */\
+            PABS(      %%mm2, %%mm0)      /* ABS(c-e) */\
+\
+            "movq -1(%[cur],%[mrefs]), %%mm2 \n\t" /* cur[x-refs-1] */\
+            "movq -1(%[cur],%[prefs]), %%mm3 \n\t" /* cur[x+refs-1] */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "psubusb   %%mm3, %%mm2 \n\t"\
+            "psubusb   %%mm4, %%mm3 \n\t"\
+            "pmaxub    %%mm3, %%mm2 \n\t"\
+            "pshufw $9,%%mm2, %%mm3 \n\t"\
+            "punpcklbw %%mm7, %%mm2 \n\t" /* ABS(cur[x-refs-1] - cur[x+refs-1]) */\
+            "punpcklbw %%mm7, %%mm3 \n\t" /* ABS(cur[x-refs+1] - cur[x+refs+1]) */\
+            "paddw     %%mm2, %%mm0 \n\t"\
+            "paddw     %%mm3, %%mm0 \n\t"\
+            "psubw    %[pw1], %%mm0 \n\t" /* spatial_score */\
+\
+            CHECK(-2,0)\
+            CHECK1\
+            CHECK(-3,1)\
+            CHECK2\
+            CHECK(0,-2)\
+            CHECK1\
+            CHECK(1,-3)\
+            CHECK2\
+\
+            /* if(p->mode<2) ... */\
+            "movq    %[tmp3], %%mm6 \n\t" /* diff */\
+            "cmp       $2, %[mode] \n\t"\
+            "jge       1f \n\t"\
+            LOAD4("(%["prev2"],%[mrefs],2)", %%mm2) /* prev2[x-2*refs] */\
+            LOAD4("(%["next2"],%[mrefs],2)", %%mm4) /* next2[x-2*refs] */\
+            LOAD4("(%["prev2"],%[prefs],2)", %%mm3) /* prev2[x+2*refs] */\
+            LOAD4("(%["next2"],%[prefs],2)", %%mm5) /* next2[x+2*refs] */\
+            "paddw     %%mm4, %%mm2 \n\t"\
+            "paddw     %%mm5, %%mm3 \n\t"\
+            "psrlw     $1,    %%mm2 \n\t" /* b */\
+            "psrlw     $1,    %%mm3 \n\t" /* f */\
+            "movq    %[tmp0], %%mm4 \n\t" /* c */\
+            "movq    %[tmp1], %%mm5 \n\t" /* d */\
+            "movq    %[tmp2], %%mm7 \n\t" /* e */\
+            "psubw     %%mm4, %%mm2 \n\t" /* b-c */\
+            "psubw     %%mm7, %%mm3 \n\t" /* f-e */\
+            "movq      %%mm5, %%mm0 \n\t"\
+            "psubw     %%mm4, %%mm5 \n\t" /* d-c */\
+            "psubw     %%mm7, %%mm0 \n\t" /* d-e */\
+            "movq      %%mm2, %%mm4 \n\t"\
+            "pminsw    %%mm3, %%mm2 \n\t"\
+            "pmaxsw    %%mm4, %%mm3 \n\t"\
+            "pmaxsw    %%mm5, %%mm2 \n\t"\
+            "pminsw    %%mm5, %%mm3 \n\t"\
+            "pmaxsw    %%mm0, %%mm2 \n\t" /* max */\
+            "pminsw    %%mm0, %%mm3 \n\t" /* min */\
+            "pxor      %%mm4, %%mm4 \n\t"\
+            "pmaxsw    %%mm3, %%mm6 \n\t"\
+            "psubw     %%mm2, %%mm4 \n\t" /* -max */\
+            "pmaxsw    %%mm4, %%mm6 \n\t" /* diff= MAX3(diff, min, -max); */\
+            "1: \n\t"\
+\
+            "movq    %[tmp1], %%mm2 \n\t" /* d */\
+            "movq      %%mm2, %%mm3 \n\t"\
+            "psubw     %%mm6, %%mm2 \n\t" /* d-diff */\
+            "paddw     %%mm6, %%mm3 \n\t" /* d+diff */\
+            "pmaxsw    %%mm2, %%mm1 \n\t"\
+            "pminsw    %%mm3, %%mm1 \n\t" /* d = clip(spatial_pred, d-diff, d+diff); */\
+            "packuswb  %%mm1, %%mm1 \n\t"\
+\
+            :[tmp0]"=m"(tmp0),\
+             [tmp1]"=m"(tmp1),\
+             [tmp2]"=m"(tmp2),\
+             [tmp3]"=m"(tmp3)\
+            :[prev] "r"(prev),\
+             [cur]  "r"(cur),\
+             [next] "r"(next),\
+             [prefs]"r"((long)refs),\
+             [mrefs]"r"((long)-refs),\
+             [pw1]  "m"(pw_1),\
+             [pb1]  "m"(pb_1),\
+             [mode] "g"(mode)\
+        );\
+        asm volatile("movd %%mm1, %0" :"=m"(*dst));\
+        dst += 4;\
+        prev+= 4;\
+        cur += 4;\
+        next+= 4;\
+    }
+
+    if(parity){
+#define prev2 "prev"
+#define next2 "cur"
+        FILTER
+#undef prev2
+#undef next2
+    }else{
+#define prev2 "cur"
+#define next2 "next"
+        FILTER
+#undef prev2
+#undef next2
+    }
+}
+#undef LOAD4
+#undef PABS
+#undef CHECK
+#undef CHECK1
+#undef CHECK2
+#undef FILTER
+#endif
+
+
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-13 12:12:24 UTC (rev 2931)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-04-13 15:38:41 UTC (rev 2932)
@@ -51,7 +51,8 @@
  ADM_vidMsmooth.cpp \
  ADM_vidFastConvolution.cpp  \
  ADM_vidRotate.cpp \
- ADM_vidYadif.cpp
+ ADM_vidYadif.cpp \
+ ADM_vidYadif_asm.c
 			
 
 



From mean at mail.berlios.de  Fri Apr 13 18:32:47 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 13 Apr 2007 18:32:47 +0200
Subject: [Avidemux-svn-commit] r2933 -
	branches/avidemux_2.4_branch/avidemux/ADM_videoFilter
Message-ID: <200704131632.l3DGWlHa025094@sheep.berlios.de>

Author: mean
Date: 2007-04-13 18:32:46 +0200 (Fri, 13 Apr 2007)
New Revision: 2933

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
Log:
add plugin declarations

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 15:38:41 UTC (rev 2932)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 16:32:46 UTC (rev 2933)
@@ -94,10 +94,28 @@
 static void filter_plane(int mode, uint8_t *dst, int dst_stride, const uint8_t *prev0, const uint8_t *cur0, const uint8_t *next0, int refs, int w, int h, int parity, int tff, int mmx);
 
 
-//
-
-
-
+/*   Hook to build it as a dll */
+extern "C"
+{
+SCRIPT_CREATE(FILTER_create_fromscript,ADMVideoYadif,yadifParam);
+BUILD_CREATE(FILTER_create,ADMVideoYadif);
+char *FILTER_getName(void)
+{
+	return "DynYadif";
+}
+char *FILTER_getDesc(void)
+{
+	return "YADIF";
+}
+uint32_t FILTER_getVersion(void)
+{
+  return 1; 
+}
+uint32_t FILTER_getAPIVersion(void)
+{
+  return ADM_FILTER_API_VERSION; 
+}
+}
 //***************************************************
 //***************************************************
 char *ADMVideoYadif::printConf( void )
@@ -120,13 +138,13 @@
 
   if(couples)
   {
-   	 _param=NEW(YADIF_PARAM);
+   	 _param=new (YADIF_PARAM);
 	GET(mode);
         GET(order);
   }
   else
   {
-    _param = NEW( YADIF_PARAM);
+    _param = new ( YADIF_PARAM);
     _param->mode=0;
     _param->order=1;
   }



From mean at mail.berlios.de  Fri Apr 13 18:41:25 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 13 Apr 2007 18:41:25 +0200
Subject: [Avidemux-svn-commit] r2934 -
	branches/avidemux_2.4_branch/avidemux/ADM_videoFilter
Message-ID: <200704131641.l3DGfP5N009159@sheep.berlios.de>

Author: mean
Date: 2007-04-13 18:41:24 +0200 (Fri, 13 Apr 2007)
New Revision: 2934

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
Log:
correctly do emms

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 16:32:46 UTC (rev 2933)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-13 16:41:24 UTC (rev 2934)
@@ -422,9 +422,9 @@
         }
         memcpy(dst + (h-1)*dst_stride, cur0 + (h-1)*refs, w);
 
-#ifdef __GNUC__
-	if (mmx) 
-		;//asm volatile("emms");
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+	if (CpuCaps::hasMMXEXT()) 
+		asm volatile("emms");
 #endif
 }
 



From mean at mail.berlios.de  Sat Apr 14 11:04:53 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 11:04:53 +0200
Subject: [Avidemux-svn-commit] r2935 -
	branches/avidemux_2.4_branch/avidemux/ADM_filter
Message-ID: <200704140904.l3E94r9R009809@sheep.berlios.de>

Author: mean
Date: 2007-04-14 11:04:53 +0200 (Sat, 14 Apr 2007)
New Revision: 2935

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp
Log:
fix tag nb for external filters

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp	2007-04-13 16:41:24 UTC (rev 2934)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_dylib.cpp	2007-04-14 09:04:53 UTC (rev 2935)
@@ -152,7 +152,7 @@
     
     printf("Loaded filter %s, version %d\n",name,versionP());
   
-   registerFilterEx(name,(VF_FILTERS)dynTag,1,createP,name,createFromScriptP,desc);
+   registerFilterEx(name,(VF_FILTERS)dynTag++,1,createP,name,createFromScriptP,desc);
 
 }
 



From mean at mail.berlios.de  Sat Apr 14 15:01:34 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 15:01:34 +0200
Subject: [Avidemux-svn-commit] r2936 -
	branches/avidemux_2.4_branch/avidemux/ADM_videoFilter
Message-ID: <200704141301.l3ED1YfH009299@sheep.berlios.de>

Author: mean
Date: 2007-04-14 15:01:33 +0200 (Sat, 14 Apr 2007)
New Revision: 2936

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
Log:
fix go beyond end bug

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-14 09:04:53 UTC (rev 2935)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-14 13:01:33 UTC (rev 2936)
@@ -246,7 +246,7 @@
         else
                 prev= vidCache->getImage(0); // get very first frame
 
-        if (n< _in->getInfo()->nb_frames)
+        if (n< _in->getInfo()->nb_frames-1)
                 next = vidCache->getImage( n+1); // get next frame
         else
                 next = vidCache->getImage( _in->getInfo()->nb_frames-1); // get last frame



From mean at mail.berlios.de  Sat Apr 14 16:05:47 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 16:05:47 +0200
Subject: [Avidemux-svn-commit] r2937 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory ADM_videoFilter
Message-ID: <200704141405.l3EE5lc0013063@sheep.berlios.de>

Author: mean
Date: 2007-04-14 16:05:47 +0200 (Sat, 14 Apr 2007)
New Revision: 2937

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
Log:
fix title + add tooltip for GTK dialogfactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-04-14 13:01:33 UTC (rev 2936)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-04-14 14:05:47 UTC (rev 2937)
@@ -74,7 +74,12 @@
   gtk_label_set_mnemonic_widget (GTK_LABEL(label), widget);
   
   myWidget=(void *)widget;
-  
+    if(tip)
+  {
+      GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
+  }
+
 }
 void diaElemFloat::getMe(void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-04-14 13:01:33 UTC (rev 2936)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-04-14 14:05:47 UTC (rev 2937)
@@ -75,6 +75,12 @@
   myWidget=(void *)widget;
   if(readOnly)
     gtk_widget_set_sensitive(widget,0);
+   if(tip)
+   {
+     GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
+   }
+ 
 }
 void diaElemInteger::getMe(void)
 {
@@ -139,6 +145,12 @@
   
   myWidget=(void *)widget;
 
+  if(tip)
+  {
+      GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
+  }
+  
   if(readOnly)
       gtk_widget_set_sensitive(widget,0);
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp	2007-04-14 13:01:33 UTC (rev 2936)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_toggle.cpp	2007-04-14 14:05:47 UTC (rev 2937)
@@ -54,6 +54,12 @@
                     (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), *(uint32_t *)param);
+  if(tip)
+  {
+      GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
+  }
+
 }
 void diaElemToggle::getMe(void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-14 13:01:33 UTC (rev 2936)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidYadif.cpp	2007-04-14 14:05:47 UTC (rev 2937)
@@ -183,7 +183,7 @@
      
      diaElem *elems[]={&mMode,&morder};
      
-     if(diaFactoryRun("Blend Removal",sizeof(elems)/sizeof(diaElem *),elems))
+     if(diaFactoryRun("Yadif  configuration",sizeof(elems)/sizeof(diaElem *),elems))
      {
         updateInfo();
         return 1;



From mean at mail.berlios.de  Sat Apr 14 18:45:03 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 18:45:03 +0200
Subject: [Avidemux-svn-commit] r2938 - branches/avidemux_2.4_branch
Message-ID: <200704141645.l3EGj3mX011521@sheep.berlios.de>

Author: mean
Date: 2007-04-14 18:45:01 +0200 (Sat, 14 Apr 2007)
New Revision: 2938

Modified:
   branches/avidemux_2.4_branch/configure.in.bot
   branches/avidemux_2.4_branch/configure.in.in
Log:
grunster : Cleanup of configure.in.in

Modified: branches/avidemux_2.4_branch/configure.in.bot
===================================================================
--- branches/avidemux_2.4_branch/configure.in.bot	2007-04-14 14:05:47 UTC (rev 2937)
+++ branches/avidemux_2.4_branch/configure.in.bot	2007-04-14 16:45:01 UTC (rev 2938)
@@ -1,45 +1,44 @@
 dnl **   mean   ***
 echo "****************************************"
-echo "****** Configure Summary   *************"
+echo "********** Configure Summary ***********"
 echo "****************************************"
-echo "**********User Interfaces ************"
+echo "*********** User Interfaces ************"
 echo " CLI                 : yes"
-echo " GTK                 : $adm_gtk_enabled"
-echo " GTK+ version        : $GTK_VERSION"
+echo " GTK                 : $adm_gtk_enabled ($GTK_VERSION)"
 echo " QT4                 : $adm_qt4_enabled"
-echo "**********Video Codec     ************"
-echo " FFMPEG              : $have_ff"
-echo " Xvid 1.0 Codec      : $have_xvid4"
-echo " x264 encoder        : $have_x264"
-echo " Xvid 0.9 Codec      : $have_xx_xvid"
-echo "**********Audio Codec     ************"
-echo " Mad decoder         : $have_mad"
-echo " Lame                : $have_lame"
-echo " Ogg Vorbis          : $have_vorbis"
-echo " Aften ac3 encoder   : $have_aften"
-echo " Faad2(decoder)      : $have_faad"
-echo " Faac (encoder)      : $have_faac"
-echo " A52/AC3             : $have_ac3"
+echo "************* Video Codecs *************"
+echo " FFmpeg              : yes"
+echo " x264                : $have_x264"
+echo " Xvid                : $have_xvid ($xvid_version)"
+echo "************* Audio Codecs *************"
+echo " A52/AC3             : yes"
+echo " Aften               : $have_aften ($aften_version)"
+echo " FAAC                : $have_faac"
+echo " FAAD2               : $have_faad"
+echo " LAME                : $have_lame"
 echo " libdca              : $have_libdca"
-echo "********** Misc libraries ************"
-echo " OSS                 : $have_oss"
+echo " MAD                 : yes"
+echo " Ogg Vorbis          : $have_vorbis"
+echo "************ Misc Libraries ************"
 echo " ALSA                : $have_alsa"
-echo " SDL                 : $have_sdl"
-echo " Xvideo              : $have_xv"
+echo " aRts                : $have_arts"
 echo " ESD                 : $have_esd"
-echo " aRTs                : $have_arts"
-echo " FreeType            : $have_freetype"
-echo " FontConfig          : $have_fontconfig"
-echo " XML2                : $have_xml2"
-echo " locale              : $ADM_LOCALEDIR"
-echo "********** Machin Dependant************"
-echo " Little endian cpu   : $have_little_endian"
+echo " Fontconfig          : $have_fontconfig"
+echo " FreeType 2          : $have_freetype"
+echo " gettext locale      : $ADM_LOCALEDIR"
+echo " Libxml2             : $have_xml2"
+echo " OSS                 : $have_oss"
+echo " SDL                 : $have_sdl"
+echo " XVideo              : $have_xv"
+echo "********** Machine Dependent ***********"
+echo " AltiVec             : $have_altivec"
 echo " AMD64               : $have_amd64"
-echo " Altivec             : $have_altivec"
-echo " PPC                 : $have_ppc"
+echo " Little endian CPU   : $have_little_endian"
+echo " PowerPC             : $have_ppc"
 echo " X86                 : $use_mmx"
-echo " MacOsX(Darwin)      : $have_darwin"
 echo " Cygwin              : $use_cygwin"
-echo " Gcc supports vectors: $use_builtin"
+echo " Mac OS X (Darwin)   : $have_darwin"
 echo " Debug               : $use_debug"
+echo " GCC vector support  : $use_builtin"
+echo " Profiling           : $use_profile"
 echo "****************************************"
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-14 14:05:47 UTC (rev 2937)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-14 16:45:01 UTC (rev 2938)
@@ -40,16 +40,19 @@
 dnl Automake doc recommends to do this only here. (Janos)
 AM_INIT_AUTOMAKE(avidemux,"2.4.0")
 ADM_SUBVERSION="0"
+
 if [[ -f .svn/entries ]]; then
 	AC_PATH_PROG(SVNVERSION, svnversion, no)
+	
 	if test "$SVNVERSION" != "no" ; then
 		rev=`svnversion . | sed 's/^.*://g' | sed 's/M$//g'`
 		ADM_SUBVERSION="\"$rev\""
 	fi
 fi
+
 dnl almost the same like KDE_SET_PEFIX but the path is /usr/local
-dnl
 unset CDPATH
+
 dnl make /usr/local the default for the installation
 AC_PREFIX_DEFAULT(/usr/local)
 
@@ -57,41 +60,47 @@
 AC_PROG_RANLIB
 AC_PROG_CXX
 AC_PROG_LIBTOOL
+
 dnl without this order in this file, automake will be confused!
-dnl
 AM_CONFIG_HEADER(config.h)
 
 # needed for make install
 #inlined, AM_PROG_MKDIR_P, it is not present on some system (fedora)
 
 if mkdir -p --version . >/dev/null 2>&1 && test ! -d ./--version; then
-# Keeping the `.' argument allows $(mkdir_p) to be used without
-# argument.  Indeed, we sometimes output rules like
-#   $(mkdir_p) $(somedir)
-# where $(somedir) is conditionally defined.
-# (`test -n '$(somedir)' && $(mkdir_p) $(somedir)' is a more
-# expensive solution, as it forces Make to start a sub-shell.)
-  mkdir_p='mkdir -p -- .'
+	# Keeping the `.' argument allows $(mkdir_p) to be used without
+	# argument.  Indeed, we sometimes output rules like
+	#   $(mkdir_p) $(somedir)
+	# where $(somedir) is conditionally defined.
+	# (`test -n '$(somedir)' && $(mkdir_p) $(somedir)' is a more
+	# expensive solution, as it forces Make to start a sub-shell.)
+	
+	mkdir_p='mkdir -p -- .'
 else
-# On NextStep and OpenStep, the `mkdir' command does not
-# recognize any option.  It will interpret all options as
-# directories to create, and then abort because `.' already
-# exists.
-  for d in ./-p ./--version;
-  do
-    test -d $d && rmdir $d
-  done
-# $(mkinstalldirs) is defined by Automake if mkinstalldirs exists.
-  if test -f "$ac_aux_dir/mkinstalldirs"; then
-    mkdir_p='$(mkinstalldirs)'
-  else
-    mkdir_p='$(install_sh) -d'
-  fi
+	# On NextStep and OpenStep, the `mkdir' command does not
+	# recognize any option.  It will interpret all options as
+	# directories to create, and then abort because `.' already
+	# exists.
+	
+	for d in ./-p ./--version;
+	do
+		test -d $d && rmdir $d
+	done
+	
+	# $(mkinstalldirs) is defined by Automake if mkinstalldirs exists.
+	
+	if test -f "$ac_aux_dir/mkinstalldirs"; then
+		mkdir_p='$(mkinstalldirs)'
+	else
+		mkdir_p='$(install_sh) -d'
+	fi
 fi
+
 AC_SUBST([mkdir_p])
 
 # /AM_PROG_MKDIR_P
 AC_PROG_INSTALL
+
 dnl create only shared libtool-libraries
 AC_ENABLE_SHARED(no)
 
@@ -101,9 +110,8 @@
 
 dnl create a working libtool-script
 dnl KDE_PROG_LIBTOOL
-
-
 dnl KDE_CHECK_EXTRA_LIBS
+
 all_libraries="$all_libraries $USER_LDFLAGS"
 AC_SUBST(all_includes)
 AC_SUBST(all_libraries)
@@ -111,121 +119,115 @@
 AC_SUBST(AUTODIRS)
 AC_SUBST(ADM_SUBVERSION)
 
+dnl added to ease install in uncommon place
+CPPFLAGS="$USER_INCLUDES $CPPFLAGS"
 
-dnl ___ added to ease install in uncommon place __
-
-CPPFLAGS="  $USER_INCLUDES  $CPPFLAGS"
-dnl __________gettext_________________
-AM_GNU_GETTEXT( [external])
+dnl _________________ gettext _________________
+AM_GNU_GETTEXT([external])
 GETTEXT_PACKAGE=avidemux
-AC_DEFINE_UNQUOTED([GETTEXT_PACKAGE], "$GETTEXT_PACKAGE",
-                   [gettext package name])
+AC_DEFINE_UNQUOTED([GETTEXT_PACKAGE], "$GETTEXT_PACKAGE", [gettext package name])
 ADM_LOCALEDIR=${datadir}/locale
 AC_SUBST(ADM_LOCALEDIR)
-    
+
+dnl _________________ GTK 2.x _________________
 adm_gtk_enabled=yes
-adm_qt4_enabled=yes
 
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl __________GTK2 Stuff____________
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
 echo " -------------------  for GTK 2.x ------------------"
- AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
- if test "$PKG_CONFIG" = "no" ; then
- 	echo "************ pkg-config IS MANDATORY ***************"
+AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
+if test "$PKG_CONFIG" = "no" ; then
+	echo "************ pkg-config IS MANDATORY ***************"
  	AC_MSG_ERROR([*** pkg-config not found ! ***])
-        adm_gtk_enabled="no"
- fi
+	adm_gtk_enabled="no"
+fi
 
-dnl    AC_PATH_PROG(PKG_CONFIG,pkg-config, AC_MSG_ERROR([*** pkg-config not found ! ***]))
-   GTK_VERSION=`$PKG_CONFIG  gtk+-2.0 --modversion`
-   GLIB_VERSION=`$PKG_CONFIG  glib-2.0 --modversion`
+dnl AC_PATH_PROG(PKG_CONFIG,pkg-config, AC_MSG_ERROR([*** pkg-config not found ! ***]))
 
- if test "x$GTK_VERSION" = "x" ; then
- 	echo "************ Cannot identify gtk2 version ***************"
- 	AC_MSG_WARN([*** pkg-config installed incorrectly or gtk2-dev absent ! ***])
-        adm_gtk_enabled="no"
- fi
- if test "x$GLIB_VERSION" = "x" ; then
- 	echo "************ Cannot identify glib-2.0 version ***************"
- 	AC_MSG_WARN([*** pkg-config installed incorrectly or glib2-dev absent ! ***])
-        adm_gtk_enabled="no"
- fi
- VEROK=`echo "$GTK_VERSION" | perl -ne '@a=split(/\./,$_);
-                 if( $a[[0]] > 2 or ($a[[0]] == 2 and $a[[1]] >= 6) ){
-                    print "OK";
-                 }else{
-                    print "FAILED";
-                 }'`
- if test "x$VEROK" != "xOK" ; then
+GTK_VERSION=`$PKG_CONFIG  gtk+-2.0 --modversion`
+GLIB_VERSION=`$PKG_CONFIG  glib-2.0 --modversion`
+
+if test "x$GTK_VERSION" = "x" ; then
+	echo "************ Cannot identify gtk2 version ***************"
+	AC_MSG_WARN([*** pkg-config installed incorrectly or gtk2-dev absent ! ***])
+	adm_gtk_enabled="no"
+fi
+
+if test "x$GLIB_VERSION" = "x" ; then
+	echo "************ Cannot identify glib-2.0 version ***************"
+	AC_MSG_WARN([*** pkg-config installed incorrectly or glib2-dev absent ! ***])
+	adm_gtk_enabled="no"
+fi
+
+VEROK=`echo "$GTK_VERSION" | perl -ne '@a=split(/\./,$_);
+	if( $a[[0]] > 2 or ($a[[0]] == 2 and $a[[1]] >= 6) ){
+		print "OK";
+	} else {
+		print "FAILED";
+	}'`
+                 
+if test "x$VEROK" != "xOK" ; then
 	AC_MSG_WARN([*** need gtk+ v2.6 or greater ! ***])
-        adm_gtk_enabled="no"
- fi
+	adm_gtk_enabled="no"
+fi
 
+GTK_LIBS=`$PKG_CONFIG  gtk+-2.0 --libs`
+GLIB_LIBS=`$PKG_CONFIG  glib-2.0 --libs`
+GTHREAD_LIBS=`$PKG_CONFIG  gthread-2.0  --libs`
 
-   GTK_LIBS=`$PKG_CONFIG  gtk+-2.0 --libs`
-   GLIB_LIBS=`$PKG_CONFIG  glib-2.0 --libs`
-   GTHREAD_LIBS=`$PKG_CONFIG  gthread-2.0  --libs`
+GTK_LIBS="$GTK_LIBS  $GTHREAD_LIBS"
+GTK_CFLAGS=`$PKG_CONFIG  gtk+-2.0 --cflags`
+GLIB_CFLAGS=`$PKG_CONFIG  glib-2.0 --cflags`  
 
-   GTK_LIBS="$GTK_LIBS  $GTHREAD_LIBS"
-   GTK_CFLAGS=`$PKG_CONFIG  gtk+-2.0 --cflags`
-   GLIB_CFLAGS=`$PKG_CONFIG  glib-2.0 --cflags`  
-    
-   AC_SUBST(GLIB_LIBS)
-   AC_SUBST(GLIB_CFLAGS)
-    
-   AC_SUBST(GTK_CFLAGS)
-   AC_SUBST(GTK_LIBS)
-   AC_SUBST(GTK_VERSION)
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl __________QT Stuff____________
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
+AC_SUBST(GLIB_LIBS)
+AC_SUBST(GLIB_CFLAGS)
+
+AC_SUBST(GTK_CFLAGS)
+AC_SUBST(GTK_LIBS)
+AC_SUBST(GTK_VERSION)
+
+dnl _________________ QT 4.x __________________
+adm_qt4_enabled=yes
+
 echo " ------------------- Probing for QT 4.x ------------------"
 QTDIR=xxx
-dnl
+
 QTPOSTFIX="-qt4"
 QTEXTRAINC="/usr/include/qt4"
 QTEXTRALIB="/usr/lib/qt4"
-dnl
+
 AC_ARG_WITH([qt-dir],
-             AC_HELP_STRING([--with-qt-dir=/path/to/Qt-4.x.0],
-                            [to specify the path to the Qt-4.x.0 directory.]),
-             [QTPATHS="$withval"],
-             [QTPATHS="/usr/local/Trolltech/Qt-4.1.0 /c/Qt/4.1.0"])
+	AC_HELP_STRING([--with-qt-dir=/path/to/Qt-4.x.0], 
+		[to specify the path to the Qt-4.x.0 directory.]),
+	[QTPATHS="$withval"],
+	[QTPATHS="/usr/local/Trolltech/Qt-4.1.0 /c/Qt/4.1.0"])
+	
 AC_ARG_WITH([qt-include],
-             AC_HELP_STRING([--with-qt-include=/path/to/Qt-4.x include],
-                            [to specify the path to the Qt-4. include directory]),
-             [QTEXTRAINC="$withval"],
-             [QTEXTRAINC="/usr/include/qt4"])
+	AC_HELP_STRING([--with-qt-include=/path/to/Qt-4.x include],
+		[to specify the path to the Qt-4. include directory]),
+	[QTEXTRAINC="$withval"],
+	[QTEXTRAINC="/usr/include/qt4"])
+	
 for x in $QTPATHS; do
     if test -d $x ; then
        QTDIR="$x"
     fi
 done
+
 AC_MSG_CHECKING(QT4.2 directory)
+
 if test $QTDIR = xxx ; then
    AC_MSG_WARN(Could not locate QT 4.x)
    adm_qt4_enabled="no"
 fi
+
 AC_MSG_RESULT($QTDIR)
 AC_MSG_CHECKING(QT4.x lib)
+
 AC_ARG_WITH([qt-lib],
 	AC_HELP_STRING([--with-qt-lib=/path/to/Qt-4.x lib],
-                            [to specify the path to the Qt-4. lib directory]),
-             [QTEXTRALIB="$withval"],
-             [QTEXTRALIB="$QTDIR/lib"])
+		[to specify the path to the Qt-4. lib directory]),
+	[QTEXTRALIB="$withval"],
+	[QTEXTRALIB="$QTDIR/lib"])
+
 AC_MSG_RESULT($QTEXTRALIB)
 
 host=`uname -a` # AC_CANONICAL_HOST is broken at the time of this writing.
@@ -248,7 +250,6 @@
 
 AC_MSG_CHECKING(QT4.x include)
 AC_MSG_RESULT($QTINC $QTEXTRAINC)
-#
 
 ADM_QTLIBS="$QTLIBS"
 ADM_QTINCLUDES="$QTINC"
@@ -263,186 +264,177 @@
 
 # Now we check whether we can actually build a Qt app.
 cat > myqt.h << EOF
-#include <QObject>
-class Test : public QObject
-{
-Q_OBJECT
-public:
-  Test() {}
-  ~Test() {}
-public slots:
-  void receive() {}
-signals:
-  void send();
-};
+	#include <QObject>
+
+	class Test : public QObject
+	{
+		Q_OBJECT
+		
+		public:
+			Test() {}
+			~Test() {}
+			
+		public slots:
+			void receive() {}
+			
+		signals:
+			void send();
+	};
 EOF
 
 cat > myqt.cpp << EOF
-#include "myqt.h"
-#include <QApplication>
-int main( int argc, char **argv )
-{
-  QApplication app( argc, argv );
-  Test t;
-  QObject::connect( &t, SIGNAL(send()), &t, SLOT(receive()) );
-}
+	#include "myqt.h"
+	#include <QApplication>
+
+	int main( int argc, char **argv )
+	{
+		QApplication app( argc, argv );
+		Test t;
+		QObject::connect( &t, SIGNAL(send()), &t, SLOT(receive()) );
+	}
 EOF
 
 AC_MSG_CHECKING(does moc work?)
 bnv_try_1="$MOC myqt.h -o moc_myqt.cpp"
 AC_TRY_EVAL(bnv_try_1)
+
 if test x"$ac_status" != x0; then
-   AC_MSG_WARN(moc doesn't work)
-   adm_qt4_enabled="no"
+	AC_MSG_WARN(moc doesn't work)
+	adm_qt4_enabled="no"
 fi
+
 AC_MSG_RESULT(yes)
 AC_MSG_CHECKING(can I compile moc_myqt.cpp?)
 bnv_try_2="$CXX -c $CXXFLAGS $ADM_QTINCLUDES $ADM_QTCFLAGS -o moc_myqt.o moc_myqt.cpp"
 AC_TRY_EVAL(bnv_try_2)
+
 if test x"$ac_status" != x0; then
-   AC_MSG_WARN(couldn't compile moc_myqt.cpp)
-   adm_qt4_enabled="no"
+	AC_MSG_WARN(couldn't compile moc_myqt.cpp)
+	adm_qt4_enabled="no"
 fi
+
 AC_MSG_RESULT(yes)
 AC_MSG_CHECKING(can I compile myqt.cpp?)
 bnv_try_3="$CXX $QTINC -c $CXXFLAGS $ADM_QTINCLUDES $ADM_QTCFLAGS -o myqt.o myqt.cpp"
 AC_TRY_EVAL(bnv_try_3)
+
 if test x"$ac_status" != x0; then
-   AC_MSG_WARN(couldn't compile myqt.cpp)
-   adm_qt4_enabled="no"
+	AC_MSG_WARN(couldn't compile myqt.cpp)
+	adm_qt4_enabled="no"
 fi
+
 AC_MSG_RESULT(yes)
 AC_MSG_CHECKING(can I link against QT?)
 nv_try_4="$CXX $LIBS $ADM_QTLIBS -o myqt myqt.o moc_myqt.o"
 AC_TRY_EVAL(bnv_try_4)
+
 if test x"$ac_status" != x0; then
-   AC_MSG_WARN(couldn't link)
-   adm_qt4_enabled="no"
+	AC_MSG_WARN(couldn't link)
+	adm_qt4_enabled="no"
 fi
-AC_MSG_RESULT(yes)
 
+AC_MSG_RESULT(yes)
 AC_MSG_CHECKING(for mkoctfile)
 AC_TRY_EVAL(mkoctfile)
+
 if test x"$ac_status" != x0; then
-   AC_MSG_WARN(mkoctfile is not in the path)
-   adm_qt4_enabled="no"
+	AC_MSG_WARN(mkoctfile is not in the path)
+	adm_qt4_enabled="no"
 fi
+
 AC_MSG_RESULT(yes)
 rm -f moc_myqt.cpp myqt.h myqt.cpp myqt.o myqt moc_myqt.o
 
 echo " ------------------- End of UI probe ------------------"
     
-dnl 
-dnl##############################################################################################"
-dnl 
-   AC_SUBST(ADM_QTLIBS)
-   AC_SUBST(ADM_QTINCLUDES)
-   AC_SUBST(ADM_QTCFLAGS)
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl __________/QT Stuff____________
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
-dnl##############################################################################################"
+AC_SUBST(ADM_QTLIBS)
+AC_SUBST(ADM_QTINCLUDES)
+AC_SUBST(ADM_QTCFLAGS)
 
-   
-   AC_SUBST(AS)
-   AC_SUBST(ASFLAGS)
-   AC_SUBST(CCAS)
-   AC_SUBST(CCASFLAGS)
+dnl __________ Initialise Variables ___________
+AM_CONDITIONAL(ADM_UI_GTK,  test "x$adm_gtk_enabled" = "xyes" )
+AM_CONDITIONAL(ADM_UI_NONE, test "xnone" = "xnone" )
+AM_CONDITIONAL(ADM_UI_QT4,  test "x$adm_qt4_enabled" = "xyes" )
 
-dnl ______________________
-dnl AC_DEFINE(USE_DIV5,0,[Divx 5])
-dnl AC_DEFINE(USE_AC3,0,[A52dec])
-AC_DEFINE(USE_FFMPEG,1,[FFMPEG])
+AC_SUBST(AS)
+AC_SUBST(ASFLAGS)
+AC_SUBST(CCAS)
+AC_SUBST(CCASFLAGS)
 
-dnl yes we are a free country :)
-dnl we force mjpeg as it is now bundled
+AC_DEFINE(USE_FFMPEG,1,[FFmpeg])
 AC_DEFINE(USE_MJPEG,1,[MJPEG])
 AC_DEFINE(AMR_NB,1,[AMR_NB])
 AC_DEFINE(CONFIG_AMR_NB,1,[AMR_NB])
 AC_DEFINE(CONFIG_DVVIDEO_ENCODER,1,[DV encoder])
-dnl AC_DEFINE(USE_MP3,0,[libmad])
-dnl AC_DEFINE(USE_MPEG,0,[libmpeg3])
-dnl AC_DEFINE(OSS_SUPPORT,0,[OSS])
-dnl AC_DEFINE(USE_XVID,0,[XVID_AS_DIVX])
-dnl AC_DEFINE(USE_SDL,0,[XVID_AS_DIVX])
-dnl AC_DEFINE(USE_XX_XVID,0,[XVID_AS_XVID])
-dnl AC_DEFINE(USE_DIVX,0,[DIVX is present])
-dnl ___________________________________
 
-dnl ____________________________________
-have_mad=yes
-have_divxdecore=yes
-have_divxencore=yes
 have_alsa=yes
-have_esd=yes
-have_xvid=yes
-have_mjpeg=yes
-have_lmpeg3=yes
-have_lmpeg2=yes
-have_divx=yes
 have_little_endian=yes
 have_vorbis=yes
-have_ac3=yes
+have_xvid=no
 have_xx_xvid=yes
-have_xx_xvid_cvs=yes
 have_xvid4=yes
-have_ff=yes
 have_xml2=yes
 have_bsd=no
-have_nasm=no
 have_altivec=no
 have_malloc=no
 have_darwin=no
 have_amd64=no
 have_ppc=no
 have_x264=yes
-have_libdca=yes
 have_aften=yes
-have_nspr=yes
 
-dnl ____________________ Cygwin / mingwin ? ___________
+dnl ____________ Cygwin / MinGW ? _____________
 use_cygwin=no
-AC_MSG_CHECKING(win32 host)
+AC_MSG_CHECKING(Win32 host)
 
 AC_TRY_COMPILE([
 	#if !defined(__CYGWIN__) && !defined(__MINGW32__)
 		#error
 	#endif
 ],
-int z=0
+	int z=0
 ,[
-  use_cygwin=yes
+	use_cygwin=yes
 ])
 
 AC_MSG_RESULT($use_cygwin)
 AM_CONDITIONAL(HAVE_CYGWIN, test "x$use_cygwin" = "xyes")
 
-dnl _________ gettimeofday _________
+if test "x$use_cygwin" = "xyes"; then
+	AC_DEFINE(MEMALIGN_HACK,1,"SSE on Cywin")
+	AC_DEFINE(CYG_MANGLING,1,"Name mangling")
+	AC_DEFINE(rindex,ADM_rindex,"rindex does not exist on Cygwin")
+	AC_DEFINE(index,ADM_index,"rindex does not exist on Cygwin")
+	AC_DEFINE(fseeko,fseeko_adm,"")
+	AC_DEFINE(ftello,ftello_adm,"")
+	CXXFLAGS="$CXXFLAGS -mno-cygwin -mms-bitfields"
+	CFLAGS="$CFLAGS -mno-cygwin -mms-bitfields"	
+fi
+
+dnl _______________ gettimeofday ______________
 AC_CHECK_FUNCS(gettimeofday, AC_DEFINE(HAVE_GETTIMEOFDAY,1,"[Use native gettimeofday function]"))
 
-dnl _____________ needed for multithreaded x264 and for mplex_________
+dnl ______________ Multithreading _____________
+dnl required for x264 and mplex
+
 if test "x$use_cygwin" = "xyes"; then
-        LIBS="$LIBS -lpthreadGC2 -Wl,-s"
+	LIBS="$LIBS -lpthreadGC2 -Wl,-s"
 else
-        LDFLAGS="$LDFLAGS -lpthread -lX11 -lXext -L/usr/X11R6/lib"
+	LDFLAGS="$LDFLAGS -lpthread -lX11 -lXext -L/usr/X11R6/lib"
 fi
 
-dnl _________________ malloc.h ___________________
-
+dnl _________________ malloc.h ________________
 AC_CHECK_HEADERS(malloc.h,have_malloc_h=yes)
 AC_CHECK_HEADERS(malloc/malloc.h,have_malloc_h=yes)
+
 if test "x$have_malloc_h" = "xyes"; then
 	CPPFLAGS="$CPPFLAGS -I/usr/include/malloc"
-	AC_DEFINE(HAVE_MALLOC_H,1,[have malloc.h])	
+	AC_DEFINE(HAVE_MALLOC_H,1,[Use malloc.h])	
 fi
 
-dnl ______________ libxml2 _____________
+dnl _________________ Libxml2 _________________
 AC_PATH_PROG(XML_CONFIG, xml2-config, no)
+
 if test "$XML_CONFIG" = "no" ; then
  	XML_LIBS=""
 	XML_CFLAGS=""
@@ -467,27 +459,36 @@
 	AC_CHECK_HEADERS(libxml/parser.h,,have_xml2=no)
 	
 	if test "x$have_xml2" = "xyes"; then
-		AC_DEFINE(USE_LIBXML2,1,[LibXML2 is available])		
+		AC_DEFINE(USE_LIBXML2,1,[Libxml2 is available])		
 	else
-		AC_MSG_WARN(no parser.h valid header found for xml2)
+		AC_MSG_WARN(no valid parser.h header found for Libxml2)
 	fi
 fi
 
-dnl __________________Aften______________
+if test "x$have_xml2" = "xno"; then
+	echo "************ LIBXML2 IS MANDATORY ************"
+	echo "***** get it from http://www.xmlsoft.org *****"
+	
+	AC_MSG_ERROR([*** No Libxml2 found ***])
+fi
 
+AC_SUBST(XML_CFLAGS)
+AC_SUBST(XML_LIBS)
+
+dnl __________________ Aften __________________
 AC_ARG_WITH([aften],
- AC_HELP_STRING([--without-aften], [Force compilation without aften (default: test)]),
- [with_aften=${withval}], [with_aften=test])
+	[AC_HELP_STRING([--without-aften], [force compilation without Aften [default=test]])],
+	[with_aften=${withval}], [with_aften=test])
 
-AC_MSG_CHECKING([if aften support is requested])
+AC_MSG_CHECKING([if Aften support is requested])
 AC_MSG_RESULT($with_aften)
 
 if test "x$with_aften" = "xno"; then
-   have_aften=no
+	have_aften=no
 fi
 
 if test "x$have_aften" = "xyes"; then
-	AC_MSG_CHECKING([for aften codec])
+	AC_MSG_CHECKING([for Aften codec])
 	AC_CHECK_HEADER(aften/aften.h,aften_header=aften/aften.h,have_aften=no)
 	
 	if test "x$have_aften" = "xno"; then
@@ -523,19 +524,17 @@
 		aften_version="0.05"
 		AC_DEFINE(USE_AFTEN_05, 1, [Use Aften 0.05 or earlier])
 		AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm)
+	elif test "x$ac_status" = "x6"; then
+		aften_version="0.06"
+		AC_DEFINE(USE_AFTEN_06, 1, [Use Aften 0.06])
+		AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm)
 	else
-		if test "x$ac_status" = "x6"; then
-			aften_version="0.06"
-			AC_DEFINE(USE_AFTEN_06, 1, [Use Aften 0.06])
-			AC_CHECK_LIB(aften,aften_encode_init,,have_aften=no,-lm)
-		else
-			AC_CHECK_LIB(aften,aften_get_version,,have_aften=no,-lm)
+		AC_CHECK_LIB(aften,aften_get_version,,have_aften=no,-lm)
 			
-			if test "x$have_aften" = "xno"; then			
-				aften_version="unsupported"
-			else
-				aften_version=">= 0.06"
-			fi
+		if test "x$have_aften" = "xno"; then			
+			aften_version="unsupported"
+		else
+			aften_version=">= 0.06"
 		fi
 	fi
 
@@ -544,162 +543,171 @@
 fi
 
 if test "x$have_aften" = "xyes"; then
-	AC_DEFINE(USE_AFTEN,1,[use aften ac3 encoder])
+	AC_DEFINE(USE_AFTEN,1,[use Aften AC3 encoder])
 fi
 
-dnl __________________x264_________________
-AC_MSG_CHECKING(for x264 codec )
+dnl ___________________ x264 __________________
+AC_MSG_CHECKING(for x264 codec)
 AC_CHECK_HEADER(x264.h,,have_x264=no)
+
 if test "x$have_x264" = "xyes"; then
    AC_CHECK_LIB(x264,x264_encoder_open,,have_x264=no,-lm )
 fi
+
 if test "x$have_x264" = "xyes"; then
 	AC_DEFINE(USE_X264,1,[use x264 encoder])
 fi
 
-dnl __________________xvid 0.9______________
-AC_MSG_CHECKING(for xvid codec 0.9)
+dnl _________________ Xvid 0.9 ________________
+AC_MSG_CHECKING(for Xvid 0.9 codec)
 AC_CHECK_HEADER(xvid.h,,have_xx_xvid=no)
 
-dnl -- check API version 2.1 and not 2.0--
-
+dnl -- check API version 2.1 and not 2.0 --
 cat >> conftest.$ac_ext <<EOF
-#include "xvid.h"
-int main()
-{
-	#if  API_VERSION != ((2<<16)+1)
-	#error Xvid Api Not 2.1
-	#endif
-return 1;
-}
+	#include "xvid.h"
+
+	int main()
+	{
+		#if API_VERSION != ((2<<16)+1)
+			#error Xvid API Not 2.1
+		#endif
+		
+		return 1;
+	}
 EOF
 
- ac_compile='${CXX} -c $CXXFLAGS $all_includes $CPPFLAGS conftest.$ac_ext > /dev/null'
- if AC_TRY_EVAL(ac_compile); then
-   have_xx_xvid=yes
-   AC_CHECK_LIB(xvidcore,xvid_encore,,have_xx_xvid=no,-lm)
- else
-   have_xx_xvid=no
+ac_compile='${CXX} -c $CXXFLAGS $all_includes $CPPFLAGS conftest.$ac_ext > /dev/null'
+ 
+if AC_TRY_EVAL(ac_compile); then
+	have_xx_xvid=yes
+	AC_CHECK_LIB(xvidcore,xvid_encore,,have_xx_xvid=no,-lm)
+else
+	have_xx_xvid=no
 fi
-dnl config.h 
- if test "x$have_xx_xvid" = "xyes"; then
- 	AC_DEFINE(USE_XX_XVID,1,[use xvid api])
- fi
 
-dnl __________________libpng______________
-AC_MSG_CHECKING(for libpng )
-have_png=yes
-AC_CHECK_HEADER(png.h,,have_png=no)
-AC_CHECK_LIB(png,png_malloc,,have_png=no)
- 
-if test "x$have_png" = "xyes"; then
-	AC_DEFINE(USE_PNG,1,[Png is available])
+if test "x$have_xx_xvid" = "xyes"; then
+	AC_DEFINE(USE_XX_XVID,1,[use Xvid 0.9 API])
+	have_xvid=yes
+	xvid_version="0.9"
 fi
 
-dnl __________________xvid 1.0______________
-AC_MSG_CHECKING(for xvid codec 1.0)
+dnl _________________ Xvid 1.x ________________
+AC_MSG_CHECKING(for Xvid 1.x codec)
 AC_CHECK_HEADER(xvid.h,,have_xvid4=no)
 
-dnl -- check API version 4.0
+dnl -- check API version 4.0 --
 AC_TRY_COMPILE([
   	#include "xvid.h"
+  	
 	#if ( XVID_API == ((4<<16)+0)) || ( XVID_API == ((4<<16)+1))
-	#error Xvid Api is 4.0 :)
+		#error Xvid Api is 4.0 :)
 	#endif
-
 ],
-int z=0
+	int z=0
 ,[
-  have_xvid4=no
+	have_xvid4=no
 ])
 
 AC_CHECK_LIB(xvidcore,xvid_encore,,have_xvid4=no,-lm)
  
-if test "x$have_xvid4" = "xyes"; then
- 	
+if test "x$have_xvid4" = "xyes"; then 	
 	AC_CHECK_LIB(xvidcore,xvid_encore,,have_xvid4=no,-lm)
+	
 	if test "x$have_xvid4" = "xyes"; then
-		AC_DEFINE(USE_XVID_4,1,[use xvid api 1.0 beta])
+		AC_DEFINE(USE_XVID_4,1,[use Xvid 1.x API])
+		have_xvid=yes
+		xvid_version="1.x"
 	fi
- fi
+fi
 
-dnl __________________OS dep stuff_____________
+dnl __________________ libpng _________________
+AC_MSG_CHECKING(for libpng)
+have_png=yes
+AC_CHECK_HEADER(png.h,,have_png=no)
+AC_CHECK_LIB(png,png_malloc,,have_png=no)
+ 
+if test "x$have_png" = "xyes"; then
+	AC_DEFINE(USE_PNG,1,[libpng is available])
+fi
 
-dnl __________________Lrintf_____________
+dnl _______________ OS dep stuff ______________
+
+dnl ------- lrintf --------
 have_lrintf=no
 AC_MSG_CHECKING(for lrintf in math.h)
+
 AC_TRY_COMPILE([
-  #include <math.h>
+	#include <math.h>
 ],[
-  int arg = 0;
+	int arg = 0;
 	arg=lrintf(0.5);
 ],[
-  have_lrintf=yes
+	have_lrintf=yes
 ])
+
 if test x$have_lrintf = xyes ; then
-  AC_DEFINE(HAVE_LRINTF,1,[roundup function])
+	AC_DEFINE(HAVE_LRINTF,1,[roundup function])
 fi
+
 AC_MSG_RESULT($have_lrintf)
 
-dnl __________________fast int_____________
+dnl ------ fast int -------
 have_fastint=no
 AC_MSG_CHECKING(for fastint)
+
 AC_TRY_COMPILE([
-  #include <stdio.h>
-  #include <stdint.h>
+	#include <stdio.h>
+	#include <stdint.h>
 ],[
-  int arg = 0;
-  int_fast16_t fst=0;
+	int arg = 0;
+	int_fast16_t fst=0;
 ],[
-  have_fastint=yes
+	have_fastint=yes
 ])
+
 if test x$have_fastint = xno ; then
-  AC_DEFINE(EMULATE_FAST_INT,1,[roundup function])
+	AC_DEFINE(EMULATE_FAST_INT,1,[roundup function])
 fi
-AC_MSG_RESULT($have_lrintf)
 
-dnl ____________________iconv need const ?___________________
+AC_MSG_RESULT($have_fastint)
+
+dnl -- iconv needs const? --
 have_consticonv=yes
 AC_MSG_CHECKING(iconv needs const)
+
 AC_TRY_COMPILE([
-  #include <stdio.h>
-  #include <stdlib.h>
-  #include <iconv.h>
+	#include <stdio.h>
+	#include <stdlib.h>
+	#include <iconv.h>
 ],[
-char *in,*out;
-size_t sin,sout,sz;
-iconv_t _conv;		
+	char *in,*out;
+	size_t sin, sout, sz;
+	iconv_t _conv;
 	sin=1;
 	sout=4;
- 	sz=iconv(_conv,&in,&sin,&out,&sout);  
-
-
+ 	sz=iconv(_conv,&in,&sin,&out,&sout);
 ],[
-  have_consticonv=no
+	have_consticonv=no
 ])
+
 if test x$have_consticonv = xyes ; then
-  AC_DEFINE(ICONV_NEED_CONST,1,[Stricter prototyping])
+	AC_DEFINE(ICONV_NEED_CONST,1,[stricter prototyping])
 fi
+
 AC_MSG_RESULT($have_consticonv)
 
-
-dnl __________________/OS dep stuff______________
-
-
-dnl
-dnl ESD sound daemon 
-dnl
+dnl ___________________ ESD ___________________
 AC_ARG_WITH([esd],
-	AC_HELP_STRING([--without-esd], [Force compilation without esd (default: test)]),
+	[AC_HELP_STRING([--without-esd], [force compilation without ESD [default=test]])],
 	[with_esd=${withval}], [with_esd=test])
 
-AC_MSG_CHECKING([if esd support is requested])
+AC_MSG_CHECKING([if ESD support is requested])
 AC_MSG_RESULT($with_esd)
 
 have_esd=no
 
 if test "x$with_esd" != "xno"; then
-	AC_MSG_CHECKING(for esd audio support)
+	AC_MSG_CHECKING(for ESD support)
 	AC_TRY_COMPILE([
 		#include <esd.h>
 	],[
@@ -707,9 +715,11 @@
 	],[
 		have_esd=yes
 	])
+	
 	if test "x$have_esd" = "xyes"; then
 		AC_CHECK_LIB(esd,esd_close,,have_esd=no,-lesd)
 	fi
+	
 	AC_MSG_RESULT($have_esd)
 
 	if test "x$have_esd" = "xyes"; then
@@ -717,11 +727,9 @@
 	fi
 fi
 
-dnl
-dnl Open Sound System support
-dnl
+dnl ___________________ OSS ___________________
 AC_ARG_WITH([oss],
-	AC_HELP_STRING([--without-oss], [Force compilation without OSS (default: test)]),
+	[AC_HELP_STRING([--without-oss], [force compilation without OSS [default=test]])],
 	[with_oss=${withval}], [with_oss=test])
 
 AC_MSG_CHECKING([if OSS support is requested])
@@ -730,13 +738,13 @@
 have_oss=no
 
 if test "x$with_oss" != "xno"; then
-	AC_MSG_CHECKING(for OSS audio support)
+	AC_MSG_CHECKING(for OSS support)
 	AC_TRY_COMPILE([
 		#ifdef __NetBSD__
-		#include <sys/ioccom.h>
-		#include <soundcard.h>
+			#include <sys/ioccom.h>
+			#include <soundcard.h>
 		#else
-		#include <sys/soundcard.h>
+			#include <sys/soundcard.h>
 		#endif
 	],[
 		int arg = SNDCTL_DSP_SETFRAGMENT;
@@ -750,60 +758,60 @@
 	fi
 fi
 
-dnl __________________ALSA______________
-AC_MSG_CHECKING(for ALSA audio support)
+dnl ___________________ ALSA __________________
+AC_MSG_CHECKING(for ALSA support)
 AC_CHECK_HEADERS(alsa/asoundlib.h,,have_alsa=no)
-dnl check version 0.9.x
+
 if test "x$have_alsa" = "xyes"; then
-have_alsa=no
-AC_TRY_COMPILE([
-#include <alsa/asoundlib.h>
-],
-[
-#if SND_LIB_MAJOR!=0 || SND_LIB_MINOR!=9
-#error Not alsa 0.9!
-#endif
-int arg = 0;
-],[
-have_alsa=yes
-have_alsa_1=no
-])
-dnl __ if it fails, try alsa 1.0 ___
-if test "x$have_alsa" = "xno"; then
-AC_TRY_COMPILE([
-#include <alsa/asoundlib.h>
-],
-[
-#if SND_LIB_MAJOR!=1 || SND_LIB_MINOR!=0
-#error Not alsa 1.0!
-#endif
-int arg = 0;
-],[
-have_alsa=yes
-have_alsa_1=yes
-])
+	have_alsa=no
+
+	dnl -- check version 0.9.x --
+	AC_TRY_COMPILE([
+		#include <alsa/asoundlib.h>
+	],[
+		#if SND_LIB_MAJOR!=0 || SND_LIB_MINOR!=9
+			#error Not ALSA 0.9!
+		#endif
+		
+		int arg = 0;
+	],[
+		have_alsa=yes
+		have_alsa_1=no
+	])
+
+	dnl -- if it fails, try ALSA 1.0 --
+	if test "x$have_alsa" = "xno"; then
+		AC_TRY_COMPILE([
+			#include <alsa/asoundlib.h>
+		],[
+			#if SND_LIB_MAJOR!=1 || SND_LIB_MINOR!=0
+				#error Not ALSA 1.0!
+			#endif
+			
+			int arg = 0;
+		],[
+			have_alsa=yes
+			have_alsa_1=yes
+		])
+	fi
+	
+	AC_CHECK_LIB(asound,snd_pcm_hw_params_set_channels,,have_alsa=no,-lm)
 fi
-AC_CHECK_LIB(asound,snd_pcm_hw_params_set_channels,,have_alsa=no,-lm)
-fi
+
 if test "x$have_alsa" = "xyes"; then				
-	AC_DEFINE(ALSA_SUPPORT,1,"[Use alsa as possible audio device]")
+	AC_DEFINE(ALSA_SUPPORT,1,"[use ALSA as possible audio device]")
 fi
+
 if test "x$have_alsa_1" = "xyes"; then				
-	AC_DEFINE(ALSA_1_0_SUPPORT,1,"[Alsa is 1.0]")
+	AC_DEFINE(ALSA_1_0_SUPPORT,1,"[ALSA is 1.0]")
 fi
 
-dnl __________________/ALSA______________
-
-
-
-dnl
-dnl aRTs daemon support
-dnl
+dnl ___________________ aRts __________________
 AC_ARG_WITH([arts],
-	AC_HELP_STRING([--without-arts], [Force compilation without aRTs (default: test)]),
+	[AC_HELP_STRING([--without-arts], [force compilation without aRts [default=test]])],
 	[with_arts=${withval}], [with_arts=test])
 
-AC_MSG_CHECKING([if aRTs support is required])
+AC_MSG_CHECKING([if aRts support is required])
 AC_MSG_RESULT($with_arts)
 
 have_arts=no
@@ -831,18 +839,18 @@
 	fi
 
 	if test "x$have_arts" = "xyes"; then
-		AC_DEFINE(USE_ARTS, 1, "[Arts]")
+		AC_DEFINE(USE_ARTS, 1, "[aRts detected]")
 	elif test "x$with_arts" = "xyes"; then
-		AC_MSG_ERROR([aRTs support requested but not found.])
+		AC_MSG_ERROR([aRts support requested but not found])
 	fi
 fi
+
 AC_SUBST(ARTS_CFLAGS)
 AC_SUBST(ARTS_LIBS)
-dnl ____________________________
-dnl LibDCA
-dnl ____________________________
+
+dnl __________________ libdca _________________
 AC_ARG_WITH([libdca],
-	AC_HELP_STRING([--without-libdca], [Force compilation without libdca (default: test)]),
+	[AC_HELP_STRING([--without-libdca], [force compilation without libdca [default=test]])],
 	[with_libdca=${withval}], [with_libdca=test])
 
 AC_MSG_CHECKING([if libdca support is required])
@@ -853,179 +861,156 @@
 if test "x$with_libdca" != "xno"; then
     have_libdca=yes
     AC_CHECK_HEADERS([dts.h], , have_libdca=no)
+    
     if test "x$have_libdca" = "xyes"; then
     	AC_CHECK_HEADERS([dts_internal.h], , have_libdca=no)
+    	
     	if test "x$have_libdca" = "xyes"; then
-            AC_CHECK_LIB( dts, dts_init, , have_libdca=no )
-	else
-    	AC_MSG_WARN(dts.h is there but i also need dts_internal.h to compile libdca/libdts. Please copy dts_internal.h where dts.h is)
+            AC_CHECK_LIB(dts, dts_init, , have_libdca=no)
+		else
+    		AC_MSG_WARN(dts.h is there but i also need dts_internal.h to compile libdca/libdts. Please copy dts_internal.h where dts.h is)
     	fi
     fi
+    
     if test "x$have_libdca" = "xyes"; then
-            AC_DEFINE(USE_LIBDCA, 1, "[libDCA]")
+		AC_DEFINE(USE_LIBDCA, 1, "[libdca detected]")
     elif test "x$with_libdca" = "xyes"; then
-            AC_MSG_ERROR([libdca support requested but not found.])
+		AC_MSG_ERROR([libdca support requested but not found])
     fi
 fi
 
-dnl __________________mad______________
-	AC_DEFINE(USE_MP3,1,[libmad])
-dnl __________________/mad______________
- dnl
- dnl FAAD support
- dnl
- AC_ARG_WITH([faad2],
- 	AC_HELP_STRING([--without-faad2], [Force compilation without FAAD2 (default: test)]),
+dnl ___________________ MAD ___________________
+AC_DEFINE(USE_MP3,1,[use libmad])
+
+dnl __________________ FAAD2 __________________
+AC_ARG_WITH([faad2],
+	[AC_HELP_STRING([--without-faad2], [force compilation without FAAD2 [default=test]])],
  	[with_faad2=${withval}], [with_faad2=test])
- AC_ARG_WITH([newfaad],
- 	AC_HELP_STRING([--with-newfaad], [Use Gentoo hacked faad2.h]),
+ 	
+AC_ARG_WITH([newfaad],
+ 	AC_HELP_STRING([--with-newfaad], [use Gentoo hacked faad2.h]),
  	[newfaad=${withval}], [newfaad=no])
  
- AC_MSG_CHECKING([if FAAD2 support is required])
- AC_MSG_RESULT($with_faad2)
+AC_MSG_CHECKING([if FAAD2 support is required])
+AC_MSG_RESULT($with_faad2)
  
- have_faad=no
+have_faad=no
  
- if test "x$with_faad2" != "xno"; then
+if test "x$with_faad2" != "xno"; then
  	have_faad=yes
- 
  	AC_CHECK_HEADERS([faad.h], , have_faad=no)
+ 	
  	if test "x$have_faad" = "xyes"; then
  		AC_CHECK_LIB( faad, faacDecInit, , have_faad=no )
+ 		
  		if test "x$have_faad" = "xno"; then
 			have_faad=yes
  			AC_CHECK_LIB( faad, NeAACDecInit, , have_faad=no )
-		fi	
+		fi
+		
  		if test "x$have_faad" = "xyes"; then
- 			AC_DEFINE(USE_FAAD, 1, [Use faad audio decoder])
+			AC_DEFINE(USE_FAAD, 1, [FAAD2 detected])
  		elif test "x$with_faad2" = "xyes"; then
- 			AC_MSG_ERROR([FAAD2 support requested but not found.])
+ 			AC_MSG_ERROR([FAAD2 support requested but not found])
  		fi
  
  		if test "x$newfaad" = "xno"; then
- 			AC_DEFINE(OLD_FAAD_PROTO, 1, [Use classing FAAD support])
+ 			AC_DEFINE(OLD_FAAD_PROTO, 1, [use classing FAAD support])
  		fi
-
 	fi
  fi
- 
 
-dnl ____________ faac ?________________
-have_faac=yes
- AC_CHECK_HEADERS(faac.h,,have_faac=no)
- 
- AC_ARG_ENABLE(faac,[  --disable-faac           Force no faac],have_faac=no)
-   
-    if test "x$have_faac" = "xyes"; then
+dnl ___________________ FAAC __________________
+AC_ARG_WITH([faac],
+	[AC_HELP_STRING([--without-faac], [force compilation without FAAC [default=test]])],
+ 	[have_faac=${withval}], [have_faac=test])
+
+AC_MSG_CHECKING([if FAAC support is required]) 
+AC_MSG_RESULT($have_faac)
+ 	
+if test "x$have_faac" != "xno"; then
+	have_faac=yes
+	AC_CHECK_HEADERS(faac.h,,have_faac=no)
+	
+	if test "x$have_faad" = "xyes"; then
 		AC_CHECK_LIB( faac,faacEncClose,,have_faac=no, -lm )
-		if test "x$have_faac" = "xyes"; then
-	  		AC_DEFINE(USE_FAAC,1,"[Use faac audio enccoder]")
-		fi  
-    fi     
- AC_MSG_CHECKING(faac library) 
- AC_MSG_RESULT($have_faac)
-  
-dnl _______________/faac_______________
-dnl _________________ /freetype 2 _________________
-dnl __________________ac3______________
- dnl
- dnl a52dec decoding library
-AC_DEFINE(USE_AC3,1,[liba52dec])
-dnl __________________/ac3______________
-dnl __________________VORBIS______________
+	fi
+	
+	if test "x$have_faac" = "xyes"; then
+		AC_DEFINE(USE_FAAC,1,"[Use faac audio enccoder]")
+	fi  
+fi
+
+dnl __________________ liba52 _________________
+AC_DEFINE(USE_AC3,1,[use liba52])
+
+dnl __________________ Vorbis _________________
 AC_CHECK_LIB(vorbis,vorbis_info_init,,have_vorbis=no, -lm)
+
 if test "x$have_vorbis" = "xyes"; then
 	AC_CHECK_LIB(vorbisenc,vorbis_encode_init,,have_vorbis=no, -lm)
+	
 	if test "x$have_vorbis" = "xyes"; then
 		AC_CHECK_LIB(vorbis,vorbis_synthesis_restart,,have_vorbis=no, -lm)
+		
 		if test "x$have_vorbis" = "xyes"; then
-			AC_DEFINE(USE_VORBIS,1,[Vorbis audio codec])
+			AC_DEFINE(USE_VORBIS,1,[Vorbis detected])
 		fi
 	fi
 fi
-dnl __________________/VORBIS______________
 
-dnl __________________LAME______________
- AC_ARG_WITH([lame],
- 	AC_HELP_STRING([--without-lame], [Force compilation without LAME (default: test)]),
+dnl ___________________ LAME __________________
+AC_ARG_WITH([lame],
+	[AC_HELP_STRING([--without-lame], [force compilation without LAME [default=test]])],
  	[with_lame=${withval}], [with_lame=test])
  
- AC_MSG_CHECKING([if LAME support is required])
- AC_MSG_RESULT($with_lame)
+AC_MSG_CHECKING([if LAME support is required])
+AC_MSG_RESULT($with_lame)
  
- have_lame=no
+have_lame=no
  
- if test "x$with_lame" != "xno"; then
- 	have_lame=yes
- 	AC_CHECK_HEADERS(lame/lame.h, , have_lame=no)
- 	AC_CHECK_LIB(mp3lame, lame_init, , have_lame=no, -lm)
- 
- 	if test "x$with_lame" = "xyes" && test "x$have_lame" = "xno"; then
- 		AC_MSG_ERROR([LAME support requested but not found.])
- 	fi
- fi
- 
- 
+if test "x$with_lame" != "xno"; then
+	have_lame=yes
+	AC_CHECK_HEADERS(lame/lame.h, , have_lame=no)
+	AC_CHECK_LIB(mp3lame, lame_init, , have_lame=no, -lm)
 
-dnl __________________/mad______________
-dnl __________________MJPEG______________
-dnl AC_CHECK_HEADERS(mjpegtools/jpegutils.h,,have_mjpeg=no)
-dnl if test "x$have_mjpeg" = "xyes"; then
-dnl AC_CHECK_LIB( mjpegutils,mpeg_framerate_code_definition,,have_mjpeg=no, -lm )
-dnl fi
-dnl if test "x$have_mjpeg" = "xyes"; then
-dnl AC_CHECK_LIB( lavjpeg,decode_jpeg_raw,,have_mjpeg=no, -lm -lmjpegutils)
-dnl fi
-dnl if test "x$have_mjpeg" = "xyes"; then
-dnl AC_DEFINE(USE_MJPEG,1,[Mjpeg lib])
-dnl fi
-dnl __________________/MJEG______________
+	if test "x$with_lame" = "xyes" && test "x$have_lame" = "xno"; then
+		AC_MSG_ERROR([LAME support requested but not found])
+	fi
+fi
 
-
-dnl
-dnl FreeType2 font rendering support
-dnl
+dnl ________________ FreeType 2 _______________
 AC_ARG_WITH([freetype2],
-	AC_HELP_STRING([--without-freetype2], [Force compilation without FreeType2 (default: test)]),
+	[AC_HELP_STRING([--without-freetype2], [force compilation without FreeType 2 [default=test]])],
 	[with_freetype2=${withval}], [with_freetype2=test])
 
-AC_MSG_CHECKING([if FreeType2 support is required])
+AC_MSG_CHECKING([if FreeType 2 support is required])
 AC_MSG_RESULT($with_freetype2)
 
 have_freetype=no
 
 if test "x$with_freetype2" != "xno"; then
 	PKG_CHECK_MODULES(FREETYPE, freetype2, have_freetype=yes, [
-			if test "x$with_freetype2" = "xyes"; then
-				AC_MSG_ERROR([FreeType2 support requested but not found.])
-			fi
-		])
+		if test "x$with_freetype2" = "xyes"; then
+			AC_MSG_ERROR([FreeType 2 support requested but not found])
+		fi
+	])
 
 	if test "x$have_freetype" = "xyes"; then
-		AC_DEFINE(USE_FREETYPE,1,"[Use FreeType2 font rendering]")
-
+		AC_DEFINE(USE_FREETYPE,1,"[FreeType2 detected]")
 	fi
 fi
-AM_CONDITIONAL(HAVE_FREETYPE, test "x$have_freetype" = "xyes" )
-dnl --------- UI ----------------------
-dnl gtk/none (/qt)
-dnl ----- Only GTK for now -----------
-AM_CONDITIONAL(ADM_UI_GTK,  test "x$adm_gtk_enabled" = "xyes" )
-AM_CONDITIONAL(ADM_UI_NONE, test "xnone" = "xnone" )
-AM_CONDITIONAL(ADM_UI_QT4,  test "x$adm_qt4_enabled" = "xyes" )
 
-dnl -----------------------------
+AM_CONDITIONAL(HAVE_FREETYPE, test "x$have_freetype" = "xyes" )
 AC_SUBST(FREETYPE_CFLAGS)
 AC_SUBST(FREETYPE_LIBS)
 
-AC_MSG_CHECKING(/usr/local/ is full of divx)
-AC_MSG_RESULT("yes")
-dnl --------------- fontconfig ----------------
+dnl ________________ Fontconfig _______________
 AC_ARG_WITH([fontconfig],
-	AC_HELP_STRING([--without-fontconfig], [Force compilation without fontconfig (default: test)]),
+	[AC_HELP_STRING([--without-fontconfig], [force compilation without Fontconfig [default=test]])],
 	[with_fontconfig=${withval}], [with_fontconfig=test])
 
-AC_MSG_CHECKING([if fontconfig support is required])
+AC_MSG_CHECKING([if Fontconfig support is required])
 AC_MSG_RESULT($with_fontconfig)
 
 have_fontconfig=no
@@ -1033,91 +1018,53 @@
 if test "x$with_fontconfig" != "xno"; then
 	have_fontconfig=yes
 	AC_CHECK_HEADER(fontconfig/fontconfig.h,,have_fontconfig=no)
+	
 	if test "x$have_fontconfig" = "xyes"; then
-     		AC_CHECK_LIB(fontconfig,FcStrSetCreate,,have_fontconfig=no,-lm)
+		AC_CHECK_LIB(fontconfig,FcStrSetCreate,,have_fontconfig=no,-lm)
 	fi
+	
 	if test "x$have_freetype" = "xyes"; then
-		AC_DEFINE(USE_FONTCONFIG,1,"[Use FontConfig helper functions ]")
-		AC_DEFINE(HAVE_FONTCONFIG,1,"[Use FontConfig helper functions ]")
+		AC_DEFINE(USE_FONTCONFIG,1,"[FontConfig detected]")
+		AC_DEFINE(HAVE_FONTCONFIG,1,"[FontConfig detected]")
 	fi
 fi
 
+dnl __________________ XVideo _________________
+have_xv=no
 
-dnl --------------- fontconfig ----------------
-dnl __________________________________________
-
-use_debug=0
-use_gpt=0
-dnl debug
-
-AC_ARG_WITH(gpt, [  gpt flag],
-  [
-	   use_gpt=1
-
-  ]
-)
-AC_ARG_WITH(debug, [  debug flag],
-  [
-	   use_debug=1
-
-  ]
-)
-
-CXXFLAGS="   -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 $CXXFLAGS -I../.."
-CFLAGS=" $CFLAGS"
-
-dnl ___________________profiling _______________________
-
-use_profile=0
-
-dnl debug
-
-AC_ARG_WITH(profile, [  profile flag],
-  [
-	   use_profile=1
-
-  ]
-)
-if test "x$use_profile" = "x1"; then
-CXXFLAGS="$CXXFLAGS -pg "
-CFLAGS="$CFLAGS -pg "
-LDFLAGS="$LDFLAGS -pg "
-fi
-
-dnl ______________________________
-dnl          Xvideo
-dnl
 if test "x$use_cygwin" = "xyes"; then
 	enable_xv="no";
 else
-AC_ARG_ENABLE([xv],
-	AC_HELP_STRING([--disable-xv], [Force compilation without XV support. (default: test)]),
-	[enable_xv=${enableval}], [enable_xv=test])
+	AC_ARG_WITH([xv],
+		[AC_HELP_STRING([--without-xv], [force compilation without XVideo [default=test]])],
+		[enable_xv=${enableval}], [enable_xv=test])
 
-have_xv=no
+	AC_MSG_CHECKING([if XVideo support is required])
+	AC_MSG_RESULT($enable_xv)	
 
-if test "x$enable_xv" != "xno"; then
-	have_xv=yes
+	if test "x$enable_xv" != "xno"; then
+		have_xv=yes
 
-	AC_CHECK_HEADERS([sys/shm.h X11/extensions/XShm.h X11/extensions/Xvlib.h], , have_xv=no,
-		[
+		AC_CHECK_HEADERS([sys/shm.h X11/extensions/XShm.h X11/extensions/Xvlib.h], , have_xv=no, [
 			#include <stdio.h>
 			#include <X11/Intrinsic.h>
 		])
-	AC_CHECK_LIB(Xv, XvShmPutImage, , have_xv=no, -L/usr/X11R6/lib -L/usr/X11R6/lib64  -lXext -lX11 -lm)
+			
+		if test "x$have_xv" = "xyes"; then
+			AC_CHECK_LIB(Xv, XvShmPutImage, , have_xv=no, -L/usr/X11R6/lib -L/usr/X11R6/lib64  -lXext -lX11 -lm)
+		fi
 
-	if test "x$have_xv" = "xyes"; then
-		AC_DEFINE(USE_XV,1,[Try to use Xv extension])
-	elif test "x$enable_xv" = "xyes"; then
-		AC_MSG_ERROR([XV support requested but not found.])
+		if test "x$have_xv" = "xyes"; then
+			AC_DEFINE(USE_XV,1,[XVideo detected])
+		elif test "x$enable_xv" = "xyes"; then
+			AC_MSG_ERROR([XVideo support requested but not found])
+		fi
 	fi
 fi
-fi
-dnl
-dnl SDL
-dnl
+
+dnl ___________________ SDL ___________________
 AC_ARG_WITH([libsdl],
-	AC_HELP_STRING([--without-libsdl], [Force compilation without SDL (default: test)]),
+	[AC_HELP_STRING([--without-libsdl], [force compilation without SDL [default=test]])],
 	[with_sdl=${withval}], [with_sdl=test])
 
 AC_MSG_CHECKING([if SDL support is required])
@@ -1127,228 +1074,227 @@
 SDL_CFLAGS=
 SDL_LIBS=
 
-dnl if test "x$with_sdl" != "xno"; then
-dnl 	AM_PATH_SDL(, [
-dnl			have_sdl=yes
-dnl			AC_DEFINE(USE_SDL,1,[Use SDL ])
-dnl		], [
-dnl			if test "x$with_sdl" = "xyes"; then
-dnl				AC_MSG_ERROR([SDL support requested but not found.])
-dnl			fi
-dnl		])
-dnl fi
-
 if test "x$with_sdl" != "xno"; then
-AC_PATH_PROG(SDL_CONFIG, sdl-config, "no")
- if test "$SDL_CONFIG" = "no" ; then
-                SDL_LIBS=""
-                SDL_CFLAGS=""
-                have_sdl=no
-        else
-
-                SDL_CFLAGS=`$SDL_CONFIG  --cflags`
-                SDL_LIBS=`$SDL_CONFIG  --libs`                  
-                CPPFLAGS="$CPPFLAGS $SDL_CFLAGS"
-                have_sdl=yes
- fi
-if test "x$have_sdl" = "xyes" ;  then
-        AC_DEFINE(USE_SDL,1,[Use SDL ])
+	AC_PATH_PROG(SDL_CONFIG, sdl-config, "no")
+	
+	if test "$SDL_CONFIG" = "no" ; then
+		SDL_LIBS=""
+		SDL_CFLAGS=""
+		have_sdl=no
+	else
+		SDL_CFLAGS=`$SDL_CONFIG  --cflags`
+		SDL_LIBS=`$SDL_CONFIG  --libs`                  
+		CPPFLAGS="$CPPFLAGS $SDL_CFLAGS"
+		have_sdl=yes
+	fi
+	
+	if test "x$have_sdl" = "xyes" ;  then
+		AC_DEFINE(USE_SDL,1,[SDL detected])
+	fi
 fi
-fi
 
 AC_SUBST(SDL_CFLAGS)
 AC_SUBST(SDL_LIBS)
 
+dnl ___________________ CPU ___________________
+echo "Checking CPU/system type"
+echo "CPU type: $host_cpu"
 
-dnl ____________________ CPU____________________________
-echo "Checking cpu/system type"
+use_mmx=no
 
-echo "CPU type : $host_cpu"
-use_mmx=0
 case $host_cpu in
 	i386|i486|i586|i686)
-		
 		have_little_endian=yes;		
 		AC_DEFINE(ARCH_X86,1,[post proc])		
-                AC_DEFINE(HAVE_MMX,1,[post proc])       
-                AC_DEFINE(FPM_INTEL,1,[Mad ])       
-		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let ffmpeg decide which is faster")		
-		AC_DEFINE(ARCH_X86_32,1,"X86_32  assembly")
-                use_mmx=1
+		AC_DEFINE(HAVE_MMX,1,[post proc])       
+		AC_DEFINE(FPM_INTEL,1,[Mad ])       
+		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")		
+		AC_DEFINE(ARCH_X86_32,1,"X86_32 assembly")
+		use_mmx=yes
 		echo "X86 is ON"
 		;;
 	x86_64|amd64)
 		have_little_endian=yes;		
-                AC_DEFINE(ARCH_X86_64,1,"X86_64 amd64 assembly")
-                AC_DEFINE(ARCH_64_BITS,1,"X86_64 amd64 assembly")
-                AC_DEFINE(HAVE_MMX,1,[post proc])       
-                AC_DEFINE(FPM_DEFAULT,1,[Mad ])       
-		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let ffmpeg decide which is faster")
-                use_mmx=1
+		AC_DEFINE(ARCH_X86_64,1,"X86_64 AMD64 assembly")
+		AC_DEFINE(ARCH_64_BITS,1,"X86_64 AMD64 assembly")
+		AC_DEFINE(HAVE_MMX,1,[post proc])
+		AC_DEFINE(FPM_DEFAULT,1,[Mad ])
+		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")
+		use_mmx=yes
 		have_amd64=yes                
-		echo "ADM64";;
+		echo "AMD64"
+		;;
 	 ia64)
-                have_little_endian=yes;
-                AC_DEFINE(ARCH_64_BITS,1,"X86_64 amd64 assembly")
-                 AC_DEFINE(FPM_DEFAULT,1,[Mad ])
-                AC_DEFINE(RUNTIME_CPUDETECT,1,"Let ffmpeg decide which is faster")
-                echo "IA64";;
-
+		have_little_endian=yes;
+		AC_DEFINE(ARCH_64_BITS,1,"X86_64 AMD64 assembly")
+		AC_DEFINE(FPM_DEFAULT,1,[Mad ])
+		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")
+		echo "IA64"
+		;;
 	sparc|sparc64)
 		have_little_endian=no;
-		LMPG_OPT="";			
-		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian cpu  sparc or powerpc])		
-                AC_DEFINE(FPM_SPARC,1,[Mad ])       
-		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian cpu  sparc or powerpc]);;
-		
+		LMPG_OPT="";
+		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		AC_DEFINE(FPM_SPARC,1,[Mad ])
+		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		;;		
 	sun4u)
 		LDFLAGS="$LDFLAGS -lposix4";
 		have_little_endian=no;
-                AC_DEFINE(FPM_SPARC,1,[Mad ])       
-		LMPG_OPT="";		
+		AC_DEFINE(FPM_SPARC,1,[Mad ])
+		LMPG_OPT="";
 		AC_DEFINE(ADM_SPARC,1,[Sparc workstations])
-		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian cpu  sparc or powerpc])		
-		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian cpu  sparc or powerpc]);;
+		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		;;
 	ppc)
 		have_little_endian=no;
 		LMPG_OPT="";
-                AC_DEFINE(FPM_PPC,1,[Mad ])       
+		AC_DEFINE(FPM_PPC,1,[Mad ])       
 		have_ppc=yes				
 		dnl we assume to be on linux-ish system here
 		AC_DEFINE(restrict,__restrict__,[roundup function])
-		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian cpu  sparc or powerpc])
-		AC_DEFINE(ARCH_POWERPC,1,[Enable powerpc optim])		
-		AC_ARG_ENABLE(altivec,[  --enable-altivec           enable  altivec acceleration(ppc)],have_altivec=yes)
-		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian cpu  sparc or powerpc]);;
-
+		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		AC_DEFINE(ARCH_POWERPC,1,[Enable PowerPC optim])		
+		AC_ARG_ENABLE(altivec, 
+			AC_HELP_STRING([--enable-altivec], [enable AltiVec acceleration (PowerPC)]),
+			have_altivec=yes)
+		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+		;;
 	*)
 		adm_cpu=`uname -p`;
+		
 		case $adm_cpu in
 			powerpc)
-			echo "Power Macintosh (darwin ??)"
-			have_darwin=yes
-			have_little_endian=no
-                	AC_DEFINE(FPM_PPC,1,[Mad ])       
-  			AC_DEFINE(ADM_BSD_FAMILY,1,[BSD os specific ifdef])
-			LMPG_OPT="";
-			LDFLAGS="$LDFLAGS  \
-				-framework CoreServices \
-				-framework CoreAudio  \
-				-framework AudioUnit"  
+				echo "Power Macintosh (Darwin ??)"
+				have_darwin=yes
+				have_little_endian=no
+				AC_DEFINE(FPM_PPC,1,[Mad ])       
+				AC_DEFINE(ADM_BSD_FAMILY,1,[BSD OS specific ifdef])
+				LMPG_OPT="";
+				LDFLAGS="$LDFLAGS  \
+					-framework CoreServices \
+					-framework CoreAudio  \
+					-framework AudioUnit"  
 			
-			AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian cpu  sparc or powerpc])
-			AC_DEFINE(CONFIG_DARWIN,0,[Say to ffmpeg we are using darwin macOsX])
-			AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian cpu  sparc or powerpc])
-			AC_ARG_ENABLE(altivec,[  --enable-altivec           enable  altivec acceleration(ppc)],have_altivec=yes)
-			AC_DEFINE(ARCH_POWERPC,1,[Enable powerpc optim])
-			have_ppc=yes;;
+				AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+				AC_DEFINE(CONFIG_DARWIN,0,[Inform FFmpeg we are using Darwin Mac OS X])
+				AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+				AC_ARG_ENABLE(altivec, 
+					AC_HELP_STRING([--enable-altivec], [enable AltiVec acceleration (PowerPC)]),
+					have_altivec=yes)
+				AC_DEFINE(ARCH_POWERPC,1,[Enable PowerPC optim])
+				have_ppc=yes
+				;;
 			*)
-			have_little_endian=no;
-			LMPG_OPT="";
-			
-                	AC_DEFINE(FPM_DEFAULT,1,[Mad ])       
-			AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian cpu  sparc or powerpc])
-			AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian cpu  sparc or powerpc]);;
+				have_little_endian=no;
+				LMPG_OPT="";
+
+				AC_DEFINE(FPM_DEFAULT,1,[Mad ])       
+				AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+				AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
+				;;
 		esac
 esac
+
 ALTIVEC_SWITCH=''
-AC_MSG_CHECKING(for Altivec )
+AC_MSG_CHECKING(for AltiVec)
 AC_MSG_RESULT($have_altivec)
+
 if test "x$have_altivec" = "xyes"; then
-		echo "Altivec enabled";
-		
-		AC_DEFINE(HAVE_ALTIVEC,1,[Enable altivec by default])
-		if test "x$have_darwin" = "xno"; then
-			AC_DEFINE(HAVE_ALTIVEC_H,1,[Enable altivec by default])
-			ALTIVEC_SWITCH='-mabi=altivec -maltivec'
-			
-		else
-			dnl we are using macOsX, deal with how they do stuff
-			ALTIVEC_SWITCH='-mabi=altivec -maltivec -faltivec -force_cpusubtype_ALL'
-		fi
-		CFLAGS="$CFLAGS $ALTIVEC_SWITCH"
-		CXXFLAGS="$CXXFLAGS $ALTIVEC_SWITCH"
-		AC_DEFINE(ARCH_PPC,1,[Altivec for libmpeg2])
-		AC_DEFINE(USE_ALTIVEC,1,[Altivec for mpeg2enc]) 
-		AC_DEFINE(HAVE_ALTIVEC,1,[Altivec for mpeg2enc]) 
+	echo "AltiVec enabled";
 
-fi
-echo "cpu done"
-dnl ____________________ /CPU____________________________
-
-if test "x$use_cygwin" = "xyes"; then
-	AC_DEFINE(MEMALIGN_HACK,1,"sse on cywin")
-	AC_DEFINE(CYG_MANGLING,1,"Name mangling")
-	AC_DEFINE(rindex,ADM_rindex,"rindex does not exist on cygwin")
-	AC_DEFINE(index,ADM_index,"rindex does not exist on cygwin")
-	AC_DEFINE(fseeko,fseeko_adm,"")
-	AC_DEFINE(ftello,ftello_adm,"")
-	#AC_DEFINE(link(x,y),-1,"")	
-	CXXFLAGS=" $CXXFLAGS -mno-cygwin -mms-bitfields"
-	CFLAGS=" $CFLAGS -mno-cygwin -mms-bitfields"
+	AC_DEFINE(HAVE_ALTIVEC,1,[Enable AltiVec by default])
 	
-fi
-
-dnl ______________ vectors ? for altivec mainly and a bit of 386 (fft) _______
-dnl (except for amd64 ? bug in ubuntu ?)
-if test "x$have_amd64" = "xno"; then
-use_builtin=no
-AC_MSG_CHECKING(Built in vectors)
-
-
-AC_TRY_COMPILE([
+	if test "x$have_darwin" = "xno"; then
+		AC_DEFINE(HAVE_ALTIVEC_H,1,[Enable AltiVec by default])
+		ALTIVEC_SWITCH='-mabi=altivec -maltivec'		
+	else
+		dnl we are using Mac OS X, deal with how they do stuff
+		ALTIVEC_SWITCH='-mabi=altivec -maltivec -faltivec -force_cpusubtype_ALL'
+	fi
 	
-#if __GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 2)
-#else
-#error no vector builtins
-#endif
-],
-int z=0
-,[
-  use_builtin=yes
-])
-
-AC_MSG_RESULT(use_builtin)
-if test "x$use_builtin" = "xyes"; then
-	AC_DEFINE(HAVE_BUILTIN_VECTOR,1,[Enable altivec by default])
-fi 
+	CFLAGS="$CFLAGS $ALTIVEC_SWITCH"
+	CXXFLAGS="$CXXFLAGS $ALTIVEC_SWITCH"
+	AC_DEFINE(ARCH_PPC,1,[AltiVec for libmpeg2])
+	AC_DEFINE(USE_ALTIVEC,1,[AltiVec for mpeg2enc]) 
+	AC_DEFINE(HAVE_ALTIVEC,1,[AltiVec for mpeg2enc]) 
 fi
-dnl __________ conditional ___________________
 
-AM_CONDITIONAL(BUILD_MMX_COMPATIBLE, test "x$use_mmx" = "x1" || test "x$have_amd64" = "xyes")
+echo "CPU done"
 
+AC_SUBST(LMPG_OPT)
+AC_SUBST(ALTIVEC_SWITCH)
+
+AM_CONDITIONAL(BUILD_MMX_COMPATIBLE, test "x$use_mmx" = "xyes" || test "x$have_amd64" = "xyes")
 AM_CONDITIONAL(BUILD_DARWIN, test "x$have_darwin" = "xyes")
 AM_CONDITIONAL(BUILD_PPC, test "x$have_ppc" = "xyes")
 AM_CONDITIONAL(BUILD_ALTIVEC, test "x$have_altivec" = "xyes")
 AM_CONDITIONAL(BUILD_A64, test "x$have_amd64" = "xyes")
-dnl ____________________BSD famiy patch____________________________
+
+dnl _________________ Vectors _________________
+dnl for AltiVec mainly and a bit of 386 (fft)
+dnl (except for AMD64 ? bug in Ubuntu ?)
+
+if test "x$have_amd64" = "xno"; then
+	use_builtin=no
+	AC_MSG_CHECKING(Built-in vectors)
+
+	AC_TRY_COMPILE([	
+		#if __GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 2)
+		#else
+			#error no vector built-ins
+		#endif
+		],
+			int z=0
+		,[
+			use_builtin=yes
+		])
+
+	AC_MSG_RESULT(use_builtin)
+	
+	if test "x$use_builtin" = "xyes"; then
+		AC_DEFINE(HAVE_BUILTIN_VECTOR,1,[Enable AltiVec by default])
+	fi
+fi
+
+dnl _________________ BSD OS __________________
 AC_TRY_COMPILE([
   	#include <stdlib.h>
 
 	#if !defined (__FreeBSD__) && !defined(__NetBSD__) && !defined(__OpenBSD__) && !defined(__APPLE__)
 		#error
 	#endif
-
 ],
-int z=0
+	int z=0
 ,[
-  	AC_DEFINE(ADM_BSD_FAMILY,1,[BSD os specific ifdef])
+  	AC_DEFINE(ADM_BSD_FAMILY,1,[BSD OS specific ifdef])
 	have_bsd=yes;
 	echo "BSD type OS"
 ])
 
+dnl ________ Debug, Profiling & Optims ________
+AC_ARG_ENABLE([profile],
+	[AC_HELP_STRING([--enable-profile], [enable profiling [default=no]])],
+	[use_profile=${withval}], [use_profile=no])
 
-dnl ____________________ /BSD____________________________
+if test "x$use_profile" = "xyes"; then
+	CXXFLAGS="$CXXFLAGS -pg"
+	CFLAGS="$CFLAGS -pg"
+	LDFLAGS="$LDFLAGS -pg"
+fi
 
-dnl _________debug and optims________________
-dnl __ builtin means gcc3, for gcc 2 we stick to -O2 ___
-if test "x$use_debug" = "x1"; then
+AC_ARG_ENABLE([debug],
+	[AC_HELP_STRING([--enable-debug], [enable debug symbols [default=no]])],
+	[use_debug=${withval}], [use_debug=no])
+ 
+if test "x$use_debug" = "xyes"; then
 	AC_DEFINE(ADM_DEBUG,1,[be verbose])
 	CXXFLAGS="$CXXFLAGS -O1 -g3"
 	CFLAGS="$CFLAGS -O1 -g3"
-	
 else
-	if test "x$use_builtin" = "x1"; then
+	dnl -- built-in means gcc3, for gcc 2 we stick to -O2 --
+	if test "x$use_builtin" = "xyes"; then
 		CXXFLAGS="$CXXFLAGS -O3"
 		CFLAGS="$CFLAGS -O3"
 	else
@@ -1356,15 +1302,20 @@
 		CFLAGS="$CFLAGS -O2"
 	fi
 fi
-if test "x$use_gpt" = "x1"; then
-	LDFLAGS="$LDFLAGS -lprofiler -ltcmalloc"
-	
+
+AC_ARG_WITH([gpt],
+	[AC_HELP_STRING([--with-gpt], [use Google Performance Tools [default=no]])],
+	[use_gpt=${withval}], [use_gpt=no])
+ 
+if test "x$use_gpt" = "xyes"; then
+	LDFLAGS="$LDFLAGS -lprofiler -ltcmalloc"	
 fi
 
 CFLAGS="$CFLAGS -falign-loops=16"
 CXXFLAGS="$CXXFLAGS -falign-loops=16"
-dnl ___________________lavcodec _________________________
+CXXFLAGS="-I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 $CXXFLAGS -I../.."
 
+dnl ________________ lavcodec _________________
 AC_DEFINE(CONFIG_WMV3_DECODER,1,[FFMPEG])
 AC_DEFINE(CONFIG_VC1_DECODER,1,[FFMPEG])
 AC_DEFINE(CONFIG_RISKY,1,[FFMPEG])
@@ -1374,6 +1325,7 @@
 AC_DEFINE(CONFIG_MPEGAUDIO_HP,1,[FFMPEG])
 AC_DEFINE(AMR_NB,1,[AMR_NB])
 AC_DEFINE(CONFIG_AMR_NB_DECODER,1,[AMR_NB])
+
 dnl bunch of new stuff
 AC_DEFINE(CONFIG_SNOW_ENCODER,1,[CONFIG_SNOW_ENCODER])
 AC_DEFINE(CONFIG_AC3_ENCODER,1,[CONFIG_AC3_ENCODER])
@@ -1388,8 +1340,8 @@
 AC_DEFINE(CONFIG_HUFFYUV_ENCODER,1,[CONFIG_HUFFYUV_ENCODER])
 AC_DEFINE(CONFIG_FFVHUFF_ENCODER,1,[CONFIG_FFVHUFF_ENCODER])
 AC_DEFINE(CONFIG_FFV1_ENCODER,1,[CONFIG_FFV1_ENCODER])
-dnl decoders
 
+dnl decoders
 AC_DEFINE(CONFIG_SNOW_DECODER,1,[CONFIG_SNOW_DECODER])
 AC_DEFINE(CONFIG_TSCC_DECODER,1,[CONFIG_MPEG1VIDEO_ENCODER])
 AC_DEFINE(CONFIG_ZLIB,1,[CONFIG_MPEG1VIDEO_ENCODER])
@@ -1419,46 +1371,29 @@
 AC_DEFINE(CONFIG_MOV_MUXER,1,[CONFIG_MUXERS])
 AC_DEFINE(HAVE_THREADS,1,[HAVE_THREADS])
 
-dnl _________mpeg2dec_______________
+dnl ________________ libmpeg2 _________________
 AC_DEFINE(ACCEL_DETECT,1,[MPEG2DEC])
 
-dnl ______________________________________________________
-  AC_SUBST(LMPG_OPT)
-  AC_SUBST(ALTIVEC_SWITCH)
-
-  AC_SUBST(XML_CFLAGS)
-  AC_SUBST(XML_LIBS)
-  
-
-
-  AC_SUBST(SMONKEY_CFLAGS)
-
-dnl **   mean   ***
- if test "x$have_xml2" = "xno"; then
- 	echo "************ LIBXML2 IS MANDATORY ***************"
- 	echo "************ get it from http://www.xmlsoft.org*********"
-	AC_MSG_ERROR([*** No xml2 found***])
-fi
-dnl _______________________________________________________
-dnl autogen prefs..
-dnl _______________________________________________________
+dnl _______________ Preferences _______________
 echo "Generating prefs if needed...(srcdir: <$srcdir> pwd:<$PWD>)"
+
 if test $srcdir/admin/prefs_gen.pl -nt $srcdir/avidemux/prefs.in; then
 	touch $srcdir/avidemux/prefs.in
 fi
+
 if test $srcdir/avidemux/prefs.in -nt $srcdir/avidemux/prefs.h -o $srcdir/avidemux/prefs.in -nt $srcdir/avidemux/prefs.cpp; then
 	echo "Regeneration preferences definitions"
 	perl $srcdir/admin/prefs_gen.pl $srcdir/avidemux
 fi
-dnl _______________________________________________________
-dnl detect gcc 2.9x.x
-dnl _______________________________________________________
+
+dnl _______________ GCC 2.9x.x ________________
 if { echo '#if __GNUC__ == 2 && __GNUC_MINOR__ >= 95'
-     echo ' yes '
-     echo '#endif'; } | ${CC} -E - | grep yes > /dev/null; then
-   AC_DEFINE(GCC_2_95_X,1,we are using gcc 2.9x.x)
+	echo ' yes '
+	echo '#endif'; } | ${CC} -E - | grep yes > /dev/null; then
+		AC_DEFINE(GCC_2_95_X,1,[Using GCC 2.9x.x])
 fi
-dnl
+
 dnl ##AC_CONFIG_FILES(po/Makefile.in)
 dnl ##AC_CONFIG_FILES(po/Makefile)
-dnl --end of file --
+
+dnl --end of file --
\ No newline at end of file



From mean at mail.berlios.de  Sat Apr 14 18:45:50 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 18:45:50 +0200
Subject: [Avidemux-svn-commit] r2939 -
	branches/avidemux_2.4_branch/avidemux/ADM_filter
Message-ID: <200704141645.l3EGjorT012404@sheep.berlios.de>

Author: mean
Date: 2007-04-14 18:45:48 +0200 (Sat, 14 Apr 2007)
New Revision: 2939

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif.sh
   branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif_win32.sh
Log:
 build yadif as plugin

Added: branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif.sh
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif.sh	2007-04-14 16:45:01 UTC (rev 2938)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif.sh	2007-04-14 16:45:48 UTC (rev 2939)
@@ -0,0 +1,4 @@
+g++ -DHAVE_CONFIG_H -I. -I. -I../..  -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil -I/usr/include/libxml2  -I/usr/include/malloc -I/usr/include/libxml2 -I/usr/include/SDL -D_GNU_SOURCE=1 -D_REENTRANT  -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -g -O2 -I../.. -O1 -g3 -falign-loops=16  -o dummy.o ../ADM_videoFilter/ADM_vidYadif.cpp  -c -fPIC
+gcc -DHAVE_CONFIG_H -I. -I. -I../..  -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil -I/usr/include/libxml2  -I/usr/include/malloc -I/usr/include/libxml2 -I/usr/include/SDL -D_GNU_SOURCE=1 -D_REENTRANT  -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -g -O2 -I../.. -O1 -g3 -falign-loops=16  -o dummy2.o ../ADM_videoFilter/ADM_vidYadif_asm.c  -c -fPIC
+g++ -shared dummy.o dummy2.o -o yadif.so
+cp yadif.so ~/Xfilters

Added: branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif_win32.sh
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif_win32.sh	2007-04-14 16:45:01 UTC (rev 2938)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/buildummy_yadif_win32.sh	2007-04-14 16:45:48 UTC (rev 2939)
@@ -0,0 +1,15 @@
+i586-pc-mingw32-g++ -DHAVE_CONFIG_H -I/rot2/include/ -I. -I. -I../..  -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil -I/usr/include/libxml2  -I/usr/include/malloc -I/usr/include/libxml2 -I/usr/include/SDL -D_GNU_SOURCE=1 -D_REENTRANT  -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -g -O2 -I../.. -O1 -g3 -falign-loops=16 \
+-c -o yad_dummy.o \
+../ADM_videoFilter/ADM_vidYadif.cpp  -mno-cygwin -mms-bitfields -mwindows
+
+i586-pc-mingw32-gcc -DHAVE_CONFIG_H -I/rot2/include/ -I. -I. -I../..  -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil -I/usr/include/libxml2  -I/usr/include/malloc -I/usr/include/libxml2 -I/usr/include/SDL -D_GNU_SOURCE=1 -D_REENTRANT  -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -g -O2 -I../.. -O1 -g3 -falign-loops=16 \
+-c -o yad_dummy2.o \
+../ADM_videoFilter/ADM_vidYadif_asm.c  -mno-cygwin -mms-bitfields -mwindows
+
+i586-pc-mingw32-g++ -shared yad_dummy.o yad_dummy2.o -o yadif.dll -L.. \
+    -Wl,--export-all-symbols \
+    -Wl,--enable-auto-import \
+    -mno-cygwin -lmingw32  ../libavidemux2.dll.a
+    #../avidemux2_gtk.exe
+i586-pc-mingw32-strip -S yadiff.dll
+#../avidemux2_gtk.exe.a \



From mean at mail.berlios.de  Sat Apr 14 21:12:48 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 21:12:48 +0200
Subject: [Avidemux-svn-commit] r2940 - branches/avidemux_2.4_branch
Message-ID: <200704141912.l3EJCmNp013290@sheep.berlios.de>

Author: mean
Date: 2007-04-14 21:12:47 +0200 (Sat, 14 Apr 2007)
New Revision: 2940

Modified:
   branches/avidemux_2.4_branch/configure.in.in
Log:
dont break cross compile

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-14 16:45:48 UTC (rev 2939)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-14 19:12:47 UTC (rev 2940)
@@ -64,6 +64,11 @@
 dnl without this order in this file, automake will be confused!
 AM_CONFIG_HEADER(config.h)
 
+dnl added to ease install in uncommon place
+dnl it has to be done early else it breaks cross compile
+CPPFLAGS="$USER_INCLUDES $CPPFLAGS"
+CFLAGS="$USER_INCLUDES $CFLAGS"
+CXXFLAGS="$USER_INCLUDES $CXXFLAGS"
 # needed for make install
 #inlined, AM_PROG_MKDIR_P, it is not present on some system (fedora)
 
@@ -119,8 +124,6 @@
 AC_SUBST(AUTODIRS)
 AC_SUBST(ADM_SUBVERSION)
 
-dnl added to ease install in uncommon place
-CPPFLAGS="$USER_INCLUDES $CPPFLAGS"
 
 dnl _________________ gettext _________________
 AM_GNU_GETTEXT([external])
@@ -1396,4 +1399,4 @@
 dnl ##AC_CONFIG_FILES(po/Makefile.in)
 dnl ##AC_CONFIG_FILES(po/Makefile)
 
-dnl --end of file --
\ No newline at end of file
+dnl --end of file --



From mean at mail.berlios.de  Sat Apr 14 21:26:00 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 14 Apr 2007 21:26:00 +0200
Subject: [Avidemux-svn-commit] r2941 - branches/avidemux_2.4_branch
Message-ID: <200704141926.l3EJQ0sY014218@sheep.berlios.de>

Author: mean
Date: 2007-04-14 21:25:59 +0200 (Sat, 14 Apr 2007)
New Revision: 2941

Modified:
   branches/avidemux_2.4_branch/configure.in.in
Log:
dont break cross compile (II)

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-14 19:12:47 UTC (rev 2940)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-14 19:25:59 UTC (rev 2941)
@@ -1316,7 +1316,7 @@
 
 CFLAGS="$CFLAGS -falign-loops=16"
 CXXFLAGS="$CXXFLAGS -falign-loops=16"
-CXXFLAGS="-I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 $CXXFLAGS -I../.."
+CXXFLAGS="$CXXFLAGS -I.. -I../ADM_lavutil -IADM_utilities -I../ADM_utilities  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -I../.."
 
 dnl ________________ lavcodec _________________
 AC_DEFINE(CONFIG_WMV3_DECODER,1,[FFMPEG])



From mean at mail.berlios.de  Sun Apr 15 12:32:23 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 15 Apr 2007 12:32:23 +0200
Subject: [Avidemux-svn-commit] r2942 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_GTK/ADM_dialogFactory ADM_NONE/ADM_dialogFactory
	ADM_QT4/ADM_dialogFactory ADM_commonUI
Message-ID: <200704151032.l3FAWN0N019147@sheep.berlios.de>

Author: mean
Date: 2007-04-15 12:32:22 +0200 (Sun, 15 Apr 2007)
New Revision: 2942

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
added new widget frame (gtk only)

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:32:22 UTC (rev 2942)
@@ -0,0 +1,106 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean Fixounet at free.fr 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+
+
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+
+#include "default.h"
+#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
+#include "ADM_toolkit_gtk/toolkit_gtk.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h"
+
+
+diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
+  : diaElem(ELEM_FRAME)
+{
+  param=NULL;
+  paramTitle=toggleTitle;
+  this->tip=tip;
+  nbElems=0;
+  frameSize=0;
+  setSize(2);
+}
+void diaElemFrame::swallow(diaElem *widget)
+{
+  elems[nbElems]=widget;
+  frameSize+=widget->getSize();
+ // setSize(frameSize);
+  nbElems++;
+  ADM_assert(nbElems<DIA_MAX_FRAME); 
+  
+}
+diaElemFrame::~diaElemFrame()
+{
+  
+}
+void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  
+  GtkWidget *label;
+  GtkWidget *table;
+  char str[200];
+  
+  
+  sprintf(str,"<b>%s</b>",paramTitle);
+  label = gtk_label_new (str);
+  gtk_label_set_use_markup (GTK_LABEL (label), TRUE);
+  gtk_widget_show(label);
+  
+   table = gtk_table_new (frameSize, 2, FALSE);
+   
+  gtk_table_set_col_spacings (GTK_TABLE (table), 12);
+  gtk_table_set_row_spacings (GTK_TABLE (table), 6);
+  gtk_container_set_border_width (GTK_CONTAINER (table), 6);
+  
+   
+   gtk_widget_show(table);
+   
+   gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 1);
+
+   gtk_misc_set_alignment (GTK_MISC (label), 0, 1);
+
+   gtk_table_attach (GTK_TABLE (opaque), table, 0, 2, line+1, line+2,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+    
+    
+  uint32_t v=0;
+  for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->setMe(dialog,table,v); 
+    v+=elems[i]->getSize();
+  }
+}
+void diaElemFrame::getMe(void)
+{
+   for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->getMe(); 
+  }
+}
+void diaElemFrame::enable(uint32_t onoff)
+{
+//   GtkWidget *widget=(GtkWidget *)myWidget;
+//   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-04-15 10:32:22 UTC (rev 2942)
@@ -8,7 +8,16 @@
 
 libADM_dialogFactory_a_METASOURCES = AUTO
 
-libADM_dialogFactory_a_SOURCES = DIA_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_float.cpp FAC_menu.cpp \
-				DIA_filesel.cpp FAC_bitrate.cpp FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp
+libADM_dialogFactory_a_SOURCES = DIA_dialogFactory.cpp \
+FAC_toggle.cpp \
+FAC_integer.cpp \
+FAC_float.cpp \
+FAC_menu.cpp \
+DIA_filesel.cpp \
+FAC_bitrate.cpp \
+FAC_bar.cpp \
+FAC_readOnlyText.cpp \
+FAC_notch.cpp \
+FAC_frame.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-15 10:32:22 UTC (rev 2942)
@@ -267,5 +267,29 @@
 { 
 }
 //******************************************************
+diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
+  : diaElem(ELEM_FRAME)
+{
+  
+}
+void diaElemFrame::swallow(diaElem *widget)
+{
+ 
+}
+diaElemFrame::~diaElemFrame()
+{
+  
+}
+void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
+{
+ 
+}
+void diaElemFrame::getMe(void)
+{
+  
+}
+void diaElemFrame::enable(uint32_t onoff)
+{
 
+}
 //EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp (from rev 2929, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-04-12 18:41:56 UTC (rev 2929)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:32:22 UTC (rev 2942)
@@ -0,0 +1,61 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean Fixounet at free.fr 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+
+
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <math.h>
+
+#include <QDialog>
+#include <QMessageBox>
+#include <QGridLayout>
+#include <QCheckBox>
+
+#include "default.h"
+#include "ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h"
+diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
+  : diaElem(ELEM_FRAME)
+{
+  
+}
+void diaElemFrame::swallow(diaElem *widget)
+{
+ 
+}
+diaElemFrame::~diaElemFrame()
+{
+  
+}
+void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
+{
+ 
+}
+void diaElemFrame::getMe(void)
+{
+  
+}
+void diaElemFrame::enable(uint32_t onoff)
+{
+
+}
+
+
+//******************************************************
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-04-15 10:32:22 UTC (rev 2942)
@@ -3,7 +3,7 @@
 
 libADM_dialogFactory_a_METASOURCES = AUTO
 
-libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_menu.cpp FAC_float.cpp AT_filesel.cpp AT_bitrate.cpp FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp
+libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_menu.cpp FAC_float.cpp AT_filesel.cpp AT_bitrate.cpp FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp
 
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-15 10:32:22 UTC (rev 2942)
@@ -32,6 +32,7 @@
   ELEM_NOTCH,
   ELEM_DIR_SELECT,
   ELEM_TEXT,
+  ELEM_FRAME,
   ELEM_MAX=ELEM_TOGGLE
 };
 /*********************************************/
@@ -307,6 +308,23 @@
   {
   }
 };
+/**********************************************/
+#define DIA_MAX_FRAME 10
+class diaElemFrame : public diaElem
+{
+  uint32_t frameSize;
+  uint32_t nbElems;
+  diaElem  *elems[DIA_MAX_FRAME];
+public:
+  
+  diaElemFrame(const char *toggleTitle, const char *tip=NULL);
+  virtual ~diaElemFrame() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void) ;
+  void swallow(diaElem *widget);
+  void enable(uint32_t onoff);
+};
+/**********************************************/
 
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-14 19:25:59 UTC (rev 2941)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-15 10:32:22 UTC (rev 2942)
@@ -72,8 +72,20 @@
 uint32_t autoindex=0;
 uint32_t autounpack=0;
 uint32_t alternate_mp3_tag=1;
+uint32_t pp_type=3;
+uint32_t pp_value=5;
+uint32_t hzd,vzd,dring;
 	olddevice=newdevice=AVDM_getCurrentDevice();
 
+        // Default pp
+         if(!prefs->get(DEFAULT_POSTPROC_TYPE,&pp_type)) pp_type=3;
+         if(!prefs->get(DEFAULT_POSTPROC_VALUE,&pp_value)) pp_value=3;
+#define DOME(x,y) y=!!(pp_type & x)
+    
+    DOME(1,hzd);
+    DOME(2,vzd);
+    DOME(4,dring);
+     
         // Alsa
         if( prefs->get(DEVICE_AUDIO_ALSA_DEVICE, &alsaDevice) != RC_OK )
                 alsaDevice = ADM_strdup("plughw:0,0");
@@ -221,7 +233,12 @@
         
         diaElemText entryAlsaDevice(&alsaDevice,"Alsa Device",NULL);
         
-        
+        // default Post proc
+     diaElemToggle     fhzd(&hzd,_("Default Postproc, Horizontal deblocking"));
+     diaElemToggle     fvzd(&vzd,_("Default Potsproc, Vertical deblocking"));
+     diaElemToggle     fdring(&dring,_("Default Postproc, Deringing"));
+     diaElemUInteger   postProcStrength(&pp_value,_("Default Postproc strength:"),0,5);
+     
         // Filter path
         if( prefs->get(FILTERS_AUTOLOAD_PATH, &filterPath) != RC_OK )
 #ifndef CYG_MANGLING
@@ -254,8 +271,8 @@
         
         /* Fifth Tab : video */
         
-        diaElem *diaVideo[]={&menuVideoMode};
-        diaElemTabs tabVideo("Video",1,(diaElem **)diaVideo);
+        diaElem *diaVideo[]={&menuVideoMode,&fhzd,&fvzd,&fdring,&postProcStrength};
+        diaElemTabs tabVideo("Video",5,(diaElem **)diaVideo);
         
         /* Sixth Tab : mthread */
         diaElem *diaMthread[]={&multiThread};
@@ -270,6 +287,15 @@
         if( diaFactoryRunTabs(_("Preferences"),8,tabs))
 	{
 		ret=1;
+                // Postproc
+                #undef DOME
+                #define DOME(x,y) if(y) pp_type |=x;
+                pp_type=0;
+                DOME(1,hzd);
+                DOME(2,vzd);
+                DOME(4,dring);
+                prefs->set(DEFAULT_POSTPROC_TYPE,pp_type);
+                prefs->set(DEFAULT_POSTPROC_VALUE,pp_value);
                 //
                  prefs->set(FEATURE_AUTO_UNPACK,autounpack);
                  // autovbr
@@ -334,7 +360,6 @@
         {
                 prefs->set(DEFAULT_POSTPROC_TYPE,type);
                 prefs->set(DEFAULT_POSTPROC_VALUE,strength);
-
         }
 //	video_body->setPostProc(type, strength, uv);
 }



From mean at mail.berlios.de  Sun Apr 15 12:54:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 15 Apr 2007 12:54:30 +0200
Subject: [Avidemux-svn-commit] r2943 - in
	branches/avidemux_2.4_branch/avidemux: ADM_script
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200704151054.l3FAsUVP017545@sheep.berlios.de>

Author: mean
Date: 2007-04-15 12:54:29 +0200 (Sun, 15 Apr 2007)
New Revision: 2943

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
enhance prefs, finish frames

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -77,6 +77,7 @@
 JSBool facRoText(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facText(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facTab(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+JSBool facFrame(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facDirSel(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool assertTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
@@ -108,6 +109,7 @@
   {"dialogFactoryText",       facText,        0},
   {"dialogFactoryTabs",       facTab,        0},
   {"dialogFactoryDirSel",       facDirSel,        0},
+  {"dialogFactoryFrame",       facFrame,        0},
   {"crashTest",               crashTest,        0},
   {"assertTest",               assertTest,        0},
   {0}
@@ -694,7 +696,33 @@
   
   return JS_TRUE;
 }
+JSBool facFrame(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
     
+      uint32_t test,test2;
+      
+      diaElemReadOnlyText align("*****","Value:");
+      diaElemReadOnlyText txt("blah blah","Value:");
+      diaElemUInteger     bt(&test,"Entry1",0,10);
+      diaElemUInteger     bt2(&test2,"Entry2",0,10);
+      diaElemFrame        frm("Frame1");
+      
+      frm.swallow(&txt);
+      frm.swallow(&bt);
+      frm.swallow(&bt2);
+      
+         diaElem *elems[]={&align,&frm   };
+  if(diaFactoryRun("Test frame",2,elems))
+  {
+    *rval = BOOLEAN_TO_JSVAL(1);
+    
+  }else
+    *rval = BOOLEAN_TO_JSVAL(0);
+  
+  return JS_TRUE;
+      
+      
+}
 JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
 {
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_dialogFactory.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -173,7 +173,15 @@
     buildOneTab(notebook1,i,tabs[i]); 
   }
   
- 
+  diaElemTabs *itab;
+  for(int i=0;i<nb;i++)
+  {
+    itab=(tabs[i]);
+    for(int j=0;j<itab->nbElems;j++)
+    {
+      itab->dias[j]->finalize();
+    }
+  }
   // Add a Close button
   GtkWidget *okbutton1;
   GtkWidget *cancelbutton1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -90,6 +90,7 @@
     elems[i]->setMe(dialog,table,v); 
     v+=elems[i]->getSize();
   }
+  myWidget=(void *)table;
 }
 void diaElemFrame::getMe(void)
 {
@@ -98,9 +99,16 @@
     elems[i]->getMe(); 
   }
 }
+void diaElemFrame::finalize(void)
+{
+   for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->finalize(); 
+  }
+}
 void diaElemFrame::enable(uint32_t onoff)
 {
-//   GtkWidget *widget=(GtkWidget *)myWidget;
-//   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+   GtkWidget *widget=(GtkWidget *)myWidget;
+   gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -128,4 +128,11 @@
   *input=ADM_strdup(gtk_editable_get_chars(GTK_EDITABLE (myWidget), 0, -1));
   
 }
+
+void diaElemText::enable(uint32_t onoff)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
+}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -210,6 +210,7 @@
 {
  
 }
+
 //******************************************************
 diaElemNotch::diaElemNotch(uint32_t yes,const char *toggleTitle, const char *tip)
   : diaElem(ELEM_NOTCH)
@@ -239,7 +240,7 @@
 diaElemText::~diaElemText() {}
 void diaElemText::setMe(void *dialog, void *opaque,uint32_t line) {}
 void diaElemText::getMe(void) {}  
-  
+void diaElemText::enable(uint32_t onoff) {};
             
 //******************************************************
 diaElemMenuDynamic::diaElemMenuDynamic(uint32_t *intValue,const char *itle, uint32_t nb, 
@@ -292,4 +293,7 @@
 {
 
 }
+void diaElemFrame::finalize(void)
+{
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -54,6 +54,9 @@
 {
 
 }
+void diaElemFrame::finalize(void)
+{
+}
 
 
 //******************************************************

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -107,6 +107,9 @@
   *c=ADM_strdup(lineEdit->text().toAscii().data());
  
 }
+void diaElemText::enable(uint32_t onoff)
+{
+  
+}
 
-
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-04-15 10:54:29 UTC (rev 2943)
@@ -276,6 +276,7 @@
   virtual ~diaElemText() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
+  void enable(uint32_t onoff);
 };
 
 /*********************************************/
@@ -323,6 +324,7 @@
   void getMe(void) ;
   void swallow(diaElem *widget);
   void enable(uint32_t onoff);
+  void finalize(void);
 };
 /**********************************************/
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-15 10:32:22 UTC (rev 2942)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-15 10:54:29 UTC (rev 2943)
@@ -232,13 +232,27 @@
         diaElemMenu menuAudio(&newdevice,_("Audio output"), sizeof(audioEntries)/sizeof(diaMenuEntry),audioEntries,"");
         
         diaElemText entryAlsaDevice(&alsaDevice,"Alsa Device",NULL);
-        
+#ifdef ALSA_SUPPORT
+          int z,m;
+          m=sizeof(audioEntries)/sizeof(diaMenuEntry);
+          for(z=0;z<m;z++)
+          {
+            if(audioEntries[z].val==DEVICE_ALSA)
+                menuAudio.link(&(audioEntries[z]),1,&entryAlsaDevice);
+          }
+#endif
         // default Post proc
-     diaElemToggle     fhzd(&hzd,_("Default Postproc, Horizontal deblocking"));
-     diaElemToggle     fvzd(&vzd,_("Default Potsproc, Vertical deblocking"));
-     diaElemToggle     fdring(&dring,_("Default Postproc, Deringing"));
-     diaElemUInteger   postProcStrength(&pp_value,_("Default Postproc strength:"),0,5);
+     diaElemToggle     fhzd(&hzd,_("Horizontal deblocking"));
+     diaElemToggle     fvzd(&vzd,_("Vertical deblocking"));
+     diaElemToggle     fdring(&dring,_("Deringing"));
+     diaElemUInteger   postProcStrength(&pp_value,_("Strength:"),0,5);
+     diaElemFrame      framePP(_("Default Postprocessing"));
      
+     framePP.swallow(&fhzd);
+     framePP.swallow(&fvzd);
+     framePP.swallow(&fdring);
+     framePP.swallow(&postProcStrength);
+     
         // Filter path
         if( prefs->get(FILTERS_AUTOLOAD_PATH, &filterPath) != RC_OK )
 #ifndef CYG_MANGLING
@@ -271,8 +285,8 @@
         
         /* Fifth Tab : video */
         
-        diaElem *diaVideo[]={&menuVideoMode,&fhzd,&fvzd,&fdring,&postProcStrength};
-        diaElemTabs tabVideo("Video",5,(diaElem **)diaVideo);
+        diaElem *diaVideo[]={&menuVideoMode,&framePP};
+        diaElemTabs tabVideo("Video",2,(diaElem **)diaVideo);
         
         /* Sixth Tab : mthread */
         diaElem *diaMthread[]={&multiThread};



From mean at mail.berlios.de  Sun Apr 15 14:55:45 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 15 Apr 2007 14:55:45 +0200
Subject: [Avidemux-svn-commit] r2944 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog
	ADM_commonUI
Message-ID: <200704151255.l3FCtjmO004405@sheep.berlios.de>

Author: mean
Date: 2007-04-15 14:55:44 +0200 (Sun, 15 Apr 2007)
New Revision: 2944

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
Log:
lavcodec redone using dialogFactory

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp	2007-04-15 10:54:29 UTC (rev 2943)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp	2007-04-15 12:55:44 UTC (rev 2944)
@@ -1,1701 +0,0 @@
-# include <config.h>
-
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
-#include <math.h>
-
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-
-
-#include <gdk/gdkkeysyms.h>
-#include <gtk/gtk.h>
-
-#include "default.h"
-
-#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
-#include "ADM_toolkit/toolkit.hxx"
-
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
-#include "ADM_assert.h" 
-#include "ADM_lavcodec.h"
-#include "ADM_codecs/ADM_ffmpegConfig.h"
-#include "ADM_encoder/ADM_vidEncode.hxx"
-
-#define SPIN_GETF(x,y) {conf->y= gtk_spin_button_get_value(GTK_SPIN_BUTTON(WID(x))) ;\
-				printf(#x":%d\n",conf->y);}
-#define SPIN_GET(x,y) {conf->y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;\
-				printf(#x":%d\n",conf->y);}
-
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)conf->y) ; \
-				printf(#x":%d\n",conf->y);}
-
-#define MENU_SET(x,y) { gtk_option_menu_set_history (GTK_OPTION_MENU(WID(x)),conf->y);}
-#define MENU_GET(x,y) { conf->y	= getRangeInMenu(WID(x));}
-#define TOGGLE_SET(x,y) {gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(WID(x)),conf->y);}
-#define TOGGLE_GET(x,y) {conf->y=gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(WID(x)));\
-				printf(#y":%d\n",conf->y);}
-				
-#define ENTRY_SET(x,y) {gtk_write_entry(WID(x),(int)conf->y);}
-#define ENTRY_GET(x,y) {localParam.y=gtk_read_entry(WID(x));\
-				printf(#y":%d\n",conf->y);}
-
-#define CHECK_GET(x,y) {conf->y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),conf->y);}	
-
-
-static 	GtkWidget *create_dialog1 (void);
-static  void 	upload(GtkWidget *dialog, FFcodecSetting *conf);
-static  void 	download(GtkWidget *dialog, FFcodecSetting *conf);
-static  void updateMode( void );
-static  int cb_mod(GtkObject * object, gpointer user_data);
-
-
-uint8_t getFFCompressParams(COMPRES_PARAMS *incoming);
-
-static GtkWidget *dialog=NULL;		      
-static uint32_t mQ,mB,mS;
-static COMPRESSION_MODE mMode;
-		      
-		      
-/*
-
-
-*/		      		      
-uint8_t getFFCompressParams(COMPRES_PARAMS *incoming)
-{
-int ret=0;	
-	FFcodecSetting *conf=(FFcodecSetting *)incoming->extraSettings;
-	ADM_assert(incoming->extraSettingsLen==sizeof(FFcodecSetting));
-	dialog=create_dialog1();
-	upload(dialog,conf);
-	
-	gtk_register_dialog(dialog);
-	
-#define HIST_SET(x) gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuType)), x)
-#define VAL_SET(x) gtk_write_entry(WID(entryEntry), x)
-
-		mQ=incoming->qz;
-		mB=incoming->bitrate;
-		mS=incoming->finalsize;	
-		mMode=incoming->mode;
-		
-	updateMode();	
-
-	
- 	gtk_signal_connect(GTK_OBJECT(WID(optionmenuType)), "changed",
-                      GTK_SIGNAL_FUNC(cb_mod),                   (void *) 0);
-	
-	
-	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-	{
-		int r=-1,value=-1;
-		
-		ret=1;
-		download(dialog,conf);	
-		r=getRangeInMenu(WID(optionmenuType));				
-		switch(r)
-			{
-				case 0:
-					incoming->mode = COMPRESS_CBR;				      
-		      			value = (uint32_t) gtk_read_entry(WID(entryEntry));
-		      			if (value < 3000)
-			  			value *= 1000;
-		      			if (value > 16 && value < 6000000)
-					{
-			    			incoming->bitrate = value;
-			    			ret = 1;						
-		      			}
-					
-					break;
-				case 1:
-					incoming->mode = COMPRESS_CQ;		      			
-					value = (uint32_t) gtk_spin_button_get_value_as_int(
-								GTK_SPIN_BUTTON(WID(spinbuttonQuant)));
-		      			if (value >= 2 && value <= 32)
-						{
-			    			incoming->qz = value;
-		      				}
-		      			break;
-
-				case 2:
-		     				incoming->mode = COMPRESS_2PASS;		       				
-						value = (uint32_t) gtk_read_entry(WID(entryEntry));
-        					if((value>0)&&(value<4000))
-          					{
-       							incoming->finalsize=value;
-				      			
-           					}						
-            					break;
-				case 3:
-						incoming->mode=COMPRESS_SAME;
-						ret=1;
-						break;
-		  		default:
-		      				ADM_assert(0);
-				}
-		
-	}
-	gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-
-	return ret;
-}	
-/**
-
-*/	 
-void updateMode( void )
-{
-uint32_t b;
-		// set the right select button
- 		switch (mMode)
-	    {
-	    	case COMPRESS_CBR:
-			HIST_SET(0);			
-			b=mB/1000;
-			VAL_SET(b);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			gtk_widget_set_sensitive(WID(entryEntry),1);
-			gtk_label_set_text(GTK_LABEL(WID(label11)),"Target bitrate (kb/s):");
-			break;
-
-		case COMPRESS_2PASS:
-			HIST_SET(2);
-			VAL_SET(mS);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			gtk_widget_set_sensitive(WID(entryEntry),1);
-			gtk_label_set_text(GTK_LABEL(WID(label11)),"Target size (MBytes):");
-			break;
-
-	    	case COMPRESS_CQ:
-			HIST_SET(1);
-			gtk_widget_set_sensitive(WID(entryEntry),0);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),1);
-			gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbuttonQuant)),(gfloat)mQ);
-			break;
-		case COMPRESS_SAME:
-			HIST_SET(3);
-			gtk_widget_set_sensitive(WID(entryEntry),0);
-			gtk_widget_set_sensitive(WID(spinbuttonQuant),0);
-			break;
-		}
-}
-/**
-
-*/		
-int cb_mod(GtkObject * object, gpointer user_data)
-{
-int r;
-	r=getRangeInMenu(WID(optionmenuType));
-	switch(r)
-	{
-		case 0: mMode=COMPRESS_CBR ;break;
-		case 1: mMode=COMPRESS_CQ ;break;
-		case 2: mMode=COMPRESS_2PASS ;break;
-		case 3: mMode=COMPRESS_SAME ;break;
-	
-	}
-	updateMode();
-	printf("Changed!!!\n");
-
-}
-void upload(GtkWidget *dialog, FFcodecSetting *conf)
-{
-
-	// Disable some
-#define GTK_DISABLE(x) gtk_widget_set_sensitive(WID(x),0);	
-	//
-	GTK_DISABLE(checkbuttonPMask);
-	GTK_DISABLE(checkbuttonLumaElimDC);
-	GTK_DISABLE(checkbuttonChromaElimDC);
-	GTK_DISABLE(spinbuttonPMask);
-	GTK_DISABLE(checkbuttonCbp );
-	GTK_DISABLE(checkbuttonMV0);
-	GTK_DISABLE(table1);
-	GTK_DISABLE(table2);
-	GTK_DISABLE(checkbuttonAspect );
-	//---------------------------------------
-	
-	CHECK_SET(checkbuttonGMC,_GMC);
-	CHECK_SET(checkbuttonQPel,_QPEL);
-	CHECK_SET(checkbutton4MV,_4MV);
-	CHECK_SET(checkbuttonTrellis,_TRELLIS_QUANT);
-	CHECK_SET(checkbuttonInterlaced,interlaced);
-	
-	CHECK_SET(checkbuttonNaq,_NORMALIZE_AQP);
-	CHECK_SET(checkbuttonAspect,widescreen);
-	
-	
-	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMS)), conf->me_method-1);
-	gtk_option_menu_set_history(GTK_OPTION_MENU(WID(optionmenuMbd)), conf->mb_eval);
-	
-	
-	//SPIN_SET(spinbuttonIMaxPeriod, 
-	
-	SPIN_SET(spinbuttonBFrame, max_b_frames);
-	SPIN_SET(spinbuttonIMin, qmin);
-	SPIN_SET(spinbuttonIMax, qmax);
-	SPIN_SET(spinbuttonMaxQDiff, max_qdiff);
-	
-	SPIN_SET(spinbuttonLumaElim,luma_elim_threshold);
-	SPIN_SET(spinbuttonChromaElim,chroma_elim_threshold);
-	
-	SPIN_SET(spinbuttonLumiMask,lumi_masking);
-	SPIN_SET(spinbuttonDarkMask,dark_masking );
-	
-	SPIN_SET( spinbuttonQComp,qcompress);
-	SPIN_SET( spinbuttonQBlur ,qblur );
-	
-	SPIN_SET( spinbuttonScplxMask ,spatial_cplx_masking );
-	SPIN_SET( spinbuttonTcplxMask,temporal_cplx_masking );
-	
-	
-	if(conf->mpeg_quant)
-		RADIO_SET(radiobuttonMpeg,		1);
-	else
-		RADIO_SET(radiobuttonH263,		1);	
-
-	TOGGLE_SET(checkbuttonScplxMask,is_spatial_cplx_masking);		
-	TOGGLE_SET(checkbuttonTcplxMask,is_temporal_cplx_masking);
-	
-	TOGGLE_SET(checkbuttonLumiMask ,is_lumi_masking);		
-	TOGGLE_SET(checkbuttonDarkMask ,is_dark_masking);
-	
-	TOGGLE_SET(checkbuttonLumaElim  ,is_luma_elim_threshold);		
-	TOGGLE_SET(checkbuttonChromaElim ,is_chroma_elim_threshold);
-		
-}
-void download(GtkWidget *dialog,FFcodecSetting *conf)
-{
-	CHECK_GET(checkbuttonGMC,_GMC);
-	CHECK_GET(checkbuttonQPel,_QPEL);
-	CHECK_GET(checkbutton4MV,_4MV);
-	CHECK_GET(checkbuttonTrellis,_TRELLIS_QUANT);
-	CHECK_GET(checkbuttonInterlaced,interlaced);
-	
-	
-	CHECK_GET(checkbuttonNaq,_NORMALIZE_AQP);
-	CHECK_GET(checkbuttonAspect,widescreen);
-	
-	SPIN_GET(spinbuttonBFrame, max_b_frames);
-	SPIN_GET(spinbuttonIMin, qmin);
-	SPIN_GET(spinbuttonIMax, qmax);
-	SPIN_GET(spinbuttonMaxQDiff, max_qdiff);
-	
-	SPIN_GET(spinbuttonLumaElim,luma_elim_threshold);
-	SPIN_GET(spinbuttonChromaElim,chroma_elim_threshold);
-	
-	SPIN_GETF(spinbuttonLumiMask,lumi_masking);
-	SPIN_GETF(spinbuttonDarkMask,dark_masking );
-	
-	SPIN_GETF( spinbuttonQComp,qcompress);
-	SPIN_GETF( spinbuttonQBlur ,qblur );
-	
-	SPIN_GETF( spinbuttonScplxMask ,spatial_cplx_masking );
-	SPIN_GETF( spinbuttonTcplxMask,temporal_cplx_masking );
-	
-	
-	conf->me_method=(Motion_Est_ID)(1+getRangeInMenu(WID(optionmenuMS)));		
-	conf->mb_eval=(Motion_Est_ID)getRangeInMenu(WID(optionmenuMbd));
-
-	
-		
-	conf->mpeg_quant=RADIO_GET(radiobuttonMpeg);
-	TOGGLE_GET(checkbuttonScplxMask,is_spatial_cplx_masking);		
-	TOGGLE_GET(checkbuttonTcplxMask,is_temporal_cplx_masking);
-	
-	TOGGLE_GET(checkbuttonLumiMask ,is_lumi_masking);		
-	TOGGLE_GET(checkbuttonDarkMask ,is_dark_masking);
-	
-	TOGGLE_GET(checkbuttonLumaElim  ,is_luma_elim_threshold);		
-	TOGGLE_GET(checkbuttonChromaElim ,is_chroma_elim_threshold);
-	
-	
-}
-
-// Glade     
-
-
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *notebook1;
-  GtkWidget *vbox2;
-  GtkWidget *frame10;
-  GtkWidget *table3;
-  GtkWidget *label10;
-  GtkWidget *label11;
-  GtkWidget *label12;
-  GtkWidget *optionmenuType;
-  GtkWidget *menu1;
-  GtkWidget *one_pass_cbr1;
-  GtkWidget *one_pass_quantizer1;
-  GtkWidget *two_pass1;
-  GtkWidget *same_qz_as_input1;
-  GtkObject *spinbuttonQuant_adj;
-  GtkWidget *spinbuttonQuant;
-  GtkWidget *entryEntry;
-  GtkWidget *label51;
-  GtkWidget *hbox7;
-  GtkWidget *vbox4;
-  GtkWidget *checkbuttonInterlaced;
-  GtkWidget *checkbuttonGreyScale;
-  GtkWidget *hbox20;
-  GtkWidget *checkbuttonAspect;
-  GtkWidget *entryAspectX;
-  GtkWidget *label40;
-  GtkWidget *entryAspectY;
-  GtkWidget *label8;
-  GtkWidget *vbox6;
-  GtkWidget *table7;
-  GtkWidget *label41;
-  GtkWidget *label15;
-  GtkWidget *hbox30;
-  GtkWidget *checkbutton4MV;
-  GtkWidget *checkbuttonMV0;
-  GtkWidget *optionmenuMS;
-  GtkWidget *menu2;
-  GtkWidget *_0___none1;
-  GtkWidget *_1___full1;
-  GtkWidget *_2___log2;
-  GtkWidget *_3___phods1;
-  GtkWidget *_4___epzs1;
-  GtkWidget *_5___x1;
-  GtkObject *spinbuttonIMaxPeriod_adj;
-  GtkWidget *spinbuttonIMaxPeriod;
-  GtkWidget *frame2;
-  GtkWidget *hbox11;
-  GtkWidget *label18;
-  GtkObject *spinbuttonBFrame_adj;
-  GtkWidget *spinbuttonBFrame;
-  GtkWidget *checkbuttonQPel;
-  GtkWidget *checkbuttonGMC;
-  GtkWidget *label17;
-  GtkWidget *hbox24;
-  GtkWidget *frame8;
-  GtkWidget *table1;
-  GtkWidget *label43;
-  GtkWidget *optionmenuPrecmp;
-  GtkWidget *menu4;
-  GtkWidget *_0__sad1;
-  GtkWidget *_1__sse1;
-  GtkWidget *_2__satd1;
-  GtkWidget *_3__dct1;
-  GtkWidget *_4__psnr1;
-  GtkWidget *_5__bit1;
-  GtkWidget *_6__rd1;
-  GtkWidget *_7__zero1;
-  GtkWidget *label44;
-  GtkWidget *optionmenuCmp;
-  GtkWidget *menu5;
-  GtkWidget *menuitem1;
-  GtkWidget *menuitem2;
-  GtkWidget *menuitem3;
-  GtkWidget *menuitem4;
-  GtkWidget *menuitem5;
-  GtkWidget *menuitem6;
-  GtkWidget *menuitem7;
-  GtkWidget *menuitem8;
-  GtkWidget *label45;
-  GtkWidget *optionmenuSubcmp;
-  GtkWidget *menu6;
-  GtkWidget *menuitem9;
-  GtkWidget *menuitem10;
-  GtkWidget *menuitem11;
-  GtkWidget *menuitem12;
-  GtkWidget *menuitem13;
-  GtkWidget *menuitem14;
-  GtkWidget *menuitem15;
-  GtkWidget *menuitem16;
-  GtkWidget *label68;
-  GtkWidget *optionmenuMBcmp;
-  GtkWidget *menu10;
-  GtkWidget *menuitem28;
-  GtkWidget *menuitem29;
-  GtkWidget *menuitem30;
-  GtkWidget *menuitem31;
-  GtkWidget *menuitem32;
-  GtkWidget *menuitem33;
-  GtkWidget *menuitem34;
-  GtkWidget *menuitem35;
-  GtkWidget *checkbuttonPrecmpChroma;
-  GtkWidget *checkbuttonCmpChroma;
-  GtkWidget *checkbuttonSubcmpChroma;
-  GtkWidget *checkbuttonMBcmpChroma;
-  GtkWidget *label49;
-  GtkWidget *frame9;
-  GtkWidget *table2;
-  GtkWidget *label47;
-  GtkWidget *label48;
-  GtkWidget *optionmenuPreDia;
-  GtkWidget *menu7;
-  GtkWidget *_3__adaptive_with_size_1;
-  GtkWidget *_2__adaptive_with_size_1;
-  GtkWidget *experimental1;
-  GtkWidget *_1__normal_with_size_1__epzs_1;
-  GtkWidget *_2__normal_with_size_1;
-  GtkWidget *optionmenuDia;
-  GtkWidget *menu8;
-  GtkWidget *menuitem23;
-  GtkWidget *menuitem24;
-  GtkWidget *menuitem25;
-  GtkWidget *menuitem26;
-  GtkWidget *menuitem27;
-  GtkWidget *label50;
-  GtkWidget *label2;
-  GtkWidget *vbox10;
-  GtkWidget *table6;
-  GtkWidget *label19;
-  GtkWidget *label52;
-  GtkWidget *label62;
-  GtkWidget *optionmenuMbd;
-  GtkWidget *menu9;
-  GtkWidget *_0__mbcmp1;
-  GtkWidget *_1__fewest_bits1;
-  GtkWidget *_2__rate_distortion1;
-  GtkWidget *hbox28;
-  GtkWidget *radiobuttonH263;
-  GSList *radiobuttonH263_group = NULL;
-  GtkWidget *radiobuttonMpeg;
-  GtkWidget *hbox29;
-  GtkObject *spinbuttonIMin_adj;
-  GtkWidget *spinbuttonIMin;
-  GtkWidget *label24;
-  GtkObject *spinbuttonIMax_adj;
-  GtkWidget *spinbuttonIMax;
-  GtkWidget *checkbuttonTrellis;
-  GtkWidget *checkbuttonCbp;
-  GtkWidget *label3;
-  GtkWidget *vbox11;
-  GtkWidget *table4;
-  GtkObject *spinbuttonDarkMask_adj;
-  GtkWidget *spinbuttonDarkMask;
-  GtkObject *spinbuttonLumiMask_adj;
-  GtkWidget *spinbuttonLumiMask;
-  GtkObject *spinbuttonScplxMask_adj;
-  GtkWidget *spinbuttonScplxMask;
-  GtkObject *spinbuttonTcplxMask_adj;
-  GtkWidget *spinbuttonTcplxMask;
-  GtkWidget *checkbuttonDarkMask;
-  GtkWidget *checkbuttonScplxMask;
-  GtkWidget *checkbuttonTcplxMask;
-  GtkWidget *checkbuttonLumiMask;
-  GtkObject *spinbuttonPMask_adj;
-  GtkWidget *spinbuttonPMask;
-  GtkWidget *checkbuttonPMask;
-  GtkWidget *checkbuttonNaq;
-  GtkWidget *frame11;
-  GtkWidget *table5;
-  GtkObject *spinbuttonLumaElim_adj;
-  GtkWidget *spinbuttonLumaElim;
-  GtkObject *spinbuttonChromaElim_adj;
-  GtkWidget *spinbuttonChromaElim;
-  GtkWidget *checkbuttonLumaElim;
-  GtkWidget *checkbuttonChromaElim;
-  GtkWidget *checkbuttonLumaElimDC;
-  GtkWidget *checkbuttonChromaElimDC;
-  GtkWidget *label59;
-  GtkWidget *label53;
-  GtkWidget *table8;
-  GtkWidget *label64;
-  GtkWidget *label65;
-  GtkWidget *label66;
-  GtkWidget *label67;
-  GtkObject *spinbuttonMaxQDiff_adj;
-  GtkWidget *spinbuttonMaxQDiff;
-  GtkObject *spinbuttonQBlur_adj;
-  GtkWidget *spinbuttonQBlur;
-  GtkObject *spinbuttonQComp_adj;
-  GtkWidget *spinbuttonQComp;
-  GtkWidget *entryRateTol;
-  GtkWidget *labelRateTol;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-  GtkTooltips *tooltips;
-
-  tooltips = gtk_tooltips_new ();
-
-  dialog1 = gtk_dialog_new ();
-  gtk_container_set_border_width (GTK_CONTAINER (dialog1), 2);
-  gtk_window_set_title (GTK_WINDOW (dialog1), _("FFmpeg encoding options"));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  notebook1 = gtk_notebook_new ();
-  gtk_widget_show (notebook1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), notebook1, TRUE, TRUE, 0);
-
-  vbox2 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox2);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox2);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox2,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox2), 5);
-
-  frame10 = gtk_frame_new (NULL);
-  gtk_widget_show (frame10);
-  gtk_box_pack_start (GTK_BOX (vbox2), frame10, FALSE, FALSE, 0);
-
-  table3 = gtk_table_new (3, 2, FALSE);
-  gtk_widget_show (table3);
-  gtk_container_add (GTK_CONTAINER (frame10), table3);
-  gtk_container_set_border_width (GTK_CONTAINER (table3), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table3), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table3), 10);
-
-  label10 = gtk_label_new (_("Encoding type:"));
-  gtk_widget_show (label10);
-  gtk_table_attach (GTK_TABLE (table3), label10, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label10), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label10), 0, 0.5);
-
-  label11 = gtk_label_new (_("Bitrate (kb/s):"));
-  gtk_widget_show (label11);
-  gtk_table_attach (GTK_TABLE (table3), label11, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label11), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label11), 0, 0.5);
-
-  label12 = gtk_label_new (_("Quantizer:"));
-  gtk_widget_show (label12);
-  gtk_table_attach (GTK_TABLE (table3), label12, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label12), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label12), 0, 0.5);
-
-  optionmenuType = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuType);
-  gtk_table_attach (GTK_TABLE (table3), optionmenuType, 1, 2, 0, 1,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuType, _("Select 1-pass or 2-pass encoding"), NULL);
-
-  menu1 = gtk_menu_new ();
-
-  one_pass_cbr1 = gtk_menu_item_new_with_mnemonic (_("Single pass - bitrate"));
-  gtk_widget_show (one_pass_cbr1);
-  gtk_container_add (GTK_CONTAINER (menu1), one_pass_cbr1);
-
-  one_pass_quantizer1 = gtk_menu_item_new_with_mnemonic (_("Single pass - quantizer"));
-  gtk_widget_show (one_pass_quantizer1);
-  gtk_container_add (GTK_CONTAINER (menu1), one_pass_quantizer1);
-
-  two_pass1 = gtk_menu_item_new_with_mnemonic (_("Two pass"));
-  gtk_widget_show (two_pass1);
-  gtk_container_add (GTK_CONTAINER (menu1), two_pass1);
-
-  same_qz_as_input1 = gtk_menu_item_new_with_mnemonic (_("Same Qz as input"));
-  gtk_widget_show (same_qz_as_input1);
-  gtk_container_add (GTK_CONTAINER (menu1), same_qz_as_input1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuType), menu1);
-
-  spinbuttonQuant_adj = gtk_adjustment_new (4, 2, 31, 1, 10, 10);
-  spinbuttonQuant = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQuant_adj), 1, 0);
-  gtk_widget_show (spinbuttonQuant);
-  gtk_table_attach (GTK_TABLE (table3), spinbuttonQuant, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonQuant, _("Set quantizer for a constant quantizer/quality encoding"), NULL);
-
-  entryEntry = gtk_entry_new ();
-  gtk_widget_show (entryEntry);
-  gtk_table_attach (GTK_TABLE (table3), entryEntry, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, entryEntry, _("Target video bitrate"), NULL);
-  gtk_entry_set_width_chars (GTK_ENTRY (entryEntry), 10);
-
-  label51 = gtk_label_new (_("Variable bitrate mode"));
-  gtk_widget_show (label51);
-  gtk_frame_set_label_widget (GTK_FRAME (frame10), label51);
-  gtk_label_set_justify (GTK_LABEL (label51), GTK_JUSTIFY_LEFT);
-
-  hbox7 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox7);
-  gtk_box_pack_start (GTK_BOX (vbox2), hbox7, FALSE, FALSE, 0);
-
-  vbox4 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox4);
-  gtk_box_pack_start (GTK_BOX (hbox7), vbox4, FALSE, FALSE, 0);
-
-  checkbuttonInterlaced = gtk_check_button_new_with_mnemonic (_("_Interlaced"));
-  gtk_widget_show (checkbuttonInterlaced);
-  gtk_box_pack_start (GTK_BOX (vbox4), checkbuttonInterlaced, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonInterlaced, _("Enable interlaced encoding"), NULL);
-
-  checkbuttonGreyScale = gtk_check_button_new_with_mnemonic (_("_Greyscale"));
-  gtk_widget_show (checkbuttonGreyScale);
-  gtk_box_pack_start (GTK_BOX (vbox2), checkbuttonGreyScale, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonGreyScale, _("Encode in black & white"), NULL);
-
-  hbox20 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox20);
-  gtk_box_pack_start (GTK_BOX (vbox2), hbox20, FALSE, FALSE, 0);
-
-  checkbuttonAspect = gtk_check_button_new_with_mnemonic (_("_Aspect ratio"));
-  gtk_widget_show (checkbuttonAspect);
-  gtk_box_pack_start (GTK_BOX (hbox20), checkbuttonAspect, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonAspect, _("Set MPEG-4 aspect ratio (warning: MPlayer supports it, but most other players don't)"), NULL);
-
-  entryAspectX = gtk_entry_new ();
-  gtk_widget_show (entryAspectX);
-  gtk_box_pack_start (GTK_BOX (hbox20), entryAspectX, FALSE, FALSE, 0);
-  gtk_entry_set_width_chars (GTK_ENTRY (entryAspectX), 8);
-
-  label40 = gtk_label_new (_(":"));
-  gtk_widget_show (label40);
-  gtk_box_pack_start (GTK_BOX (hbox20), label40, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label40), GTK_JUSTIFY_LEFT);
-
-  entryAspectY = gtk_entry_new ();
-  gtk_widget_show (entryAspectY);
-  gtk_box_pack_start (GTK_BOX (hbox20), entryAspectY, FALSE, FALSE, 0);
-  gtk_entry_set_width_chars (GTK_ENTRY (entryAspectY), 9);
-
-  label8 = gtk_label_new (_("Main"));
-  gtk_widget_show (label8);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 0), label8);
-  gtk_label_set_justify (GTK_LABEL (label8), GTK_JUSTIFY_LEFT);
-
-  vbox6 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox6);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox6);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox6,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox6), 5);
-
-  table7 = gtk_table_new (2, 3, FALSE);
-  gtk_widget_show (table7);
-  gtk_box_pack_start (GTK_BOX (vbox6), table7, FALSE, FALSE, 0);
-  gtk_table_set_row_spacings (GTK_TABLE (table7), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table7), 10);
-
-  label41 = gtk_label_new (_("ME method:"));
-  gtk_widget_show (label41);
-  gtk_table_attach (GTK_TABLE (table7), label41, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label41), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label41), 0, 0.5);
-
-  label15 = gtk_label_new (_("Max I-frame interval:"));
-  gtk_widget_show (label15);
-  gtk_table_attach (GTK_TABLE (table7), label15, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label15), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label15), 0, 0.5);
-
-  hbox30 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox30);
-  gtk_table_attach (GTK_TABLE (table7), hbox30, 2, 3, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  checkbutton4MV = gtk_check_button_new_with_mnemonic (_("_4MV"));
-  gtk_widget_show (checkbutton4MV);
-  gtk_box_pack_start (GTK_BOX (hbox30), checkbutton4MV, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbutton4MV, _("Allow 4 motion vectors per macroblock (slightly better quality)"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbutton4MV), TRUE);
-
-  checkbuttonMV0 = gtk_check_button_new_with_mnemonic (_("MV0"));
-  gtk_widget_show (checkbuttonMV0);
-  gtk_box_pack_start (GTK_BOX (hbox30), checkbuttonMV0, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonMV0, _("Try  to encode each MB with MV=<0,0> and choose the better one"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonMV0), TRUE);
-
-  optionmenuMS = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuMS);
-  gtk_table_attach (GTK_TABLE (table7), optionmenuMS, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuMS, _("Motion estimation method, 0-3 currently ignores the amount of bits spent, so quality may be low"), NULL);
-
-  menu2 = gtk_menu_new ();
-
-  _0___none1 = gtk_menu_item_new_with_mnemonic (_("0: None"));
-  gtk_widget_show (_0___none1);
-  gtk_container_add (GTK_CONTAINER (menu2), _0___none1);
-
-  _1___full1 = gtk_menu_item_new_with_mnemonic (_("1: Full"));
-  gtk_widget_show (_1___full1);
-  gtk_container_add (GTK_CONTAINER (menu2), _1___full1);
-
-  _2___log2 = gtk_menu_item_new_with_mnemonic (_("2: Log"));
-  gtk_widget_show (_2___log2);
-  gtk_container_add (GTK_CONTAINER (menu2), _2___log2);
-
-  _3___phods1 = gtk_menu_item_new_with_mnemonic (_("3: Phods"));
-  gtk_widget_show (_3___phods1);
-  gtk_container_add (GTK_CONTAINER (menu2), _3___phods1);
-
-  _4___epzs1 = gtk_menu_item_new_with_mnemonic (_("4: EPZS"));
-  gtk_widget_show (_4___epzs1);
-  gtk_container_add (GTK_CONTAINER (menu2), _4___epzs1);
-
-  _5___x1 = gtk_menu_item_new_with_mnemonic (_("5: X1"));
-  gtk_widget_show (_5___x1);
-  gtk_container_add (GTK_CONTAINER (menu2), _5___x1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMS), menu2);
-
-  spinbuttonIMaxPeriod_adj = gtk_adjustment_new (250, 0, 300, 1, 10, 10);
-  spinbuttonIMaxPeriod = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMaxPeriod_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMaxPeriod);
-  gtk_table_attach (GTK_TABLE (table7), spinbuttonIMaxPeriod, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMaxPeriod, _("Maximum interval between keyframes in frames"), NULL);
-
-  frame2 = gtk_frame_new (NULL);
-  gtk_widget_show (frame2);
-  gtk_box_pack_start (GTK_BOX (vbox6), frame2, FALSE, FALSE, 5);
-
-  hbox11 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox11);
-  gtk_container_add (GTK_CONTAINER (frame2), hbox11);
-  gtk_container_set_border_width (GTK_CONTAINER (hbox11), 5);
-
-  label18 = gtk_label_new (_("Number of B-frames:"));
-  gtk_widget_show (label18);
-  gtk_box_pack_start (GTK_BOX (hbox11), label18, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label18), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label18), 0, 0.5);
-
-  spinbuttonBFrame_adj = gtk_adjustment_new (1, 0, 4, 1, 1, 1);
-  spinbuttonBFrame = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBFrame_adj), 1, 0);
-  gtk_widget_show (spinbuttonBFrame);
-  gtk_box_pack_start (GTK_BOX (hbox11), spinbuttonBFrame, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonBFrame, _("Maximum number of B-frames between non B-frames, 0-2 is a sane range"), NULL);
-
-  checkbuttonQPel = gtk_check_button_new_with_mnemonic (_("_Qpel"));
-  gtk_widget_show (checkbuttonQPel);
-  gtk_box_pack_start (GTK_BOX (hbox11), checkbuttonQPel, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonQPel, _("Use quarter pixel motion compensation (useful at higher bitrates)"), NULL);
-
-  checkbuttonGMC = gtk_check_button_new_with_mnemonic (_("_GMC"));
-  gtk_widget_show (checkbuttonGMC);
-  gtk_box_pack_start (GTK_BOX (hbox11), checkbuttonGMC, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonGMC, _("Global Motion Compensation can save bits on camera pans, zooming and rotation"), NULL);
-
-  label17 = gtk_label_new (_("Advanced Simple Profile"));
-  gtk_widget_show (label17);
-  gtk_frame_set_label_widget (GTK_FRAME (frame2), label17);
-  gtk_label_set_justify (GTK_LABEL (label17), GTK_JUSTIFY_LEFT);
-
-  hbox24 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox24);
-  gtk_box_pack_start (GTK_BOX (vbox6), hbox24, FALSE, FALSE, 0);
-
-  frame8 = gtk_frame_new (NULL);
-  gtk_widget_show (frame8);
-  gtk_box_pack_start (GTK_BOX (hbox24), frame8, FALSE, FALSE, 0);
-
-  table1 = gtk_table_new (4, 3, FALSE);
-  gtk_widget_show (table1);
-  gtk_container_add (GTK_CONTAINER (frame8), table1);
-  gtk_container_set_border_width (GTK_CONTAINER (table1), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table1), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table1), 10);
-
-  label43 = gtk_label_new (_("Prepass:"));
-  gtk_widget_show (label43);
-  gtk_table_attach (GTK_TABLE (table1), label43, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label43), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label43), 0, 0.5);
-
-  optionmenuPrecmp = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuPrecmp);
-  gtk_table_attach (GTK_TABLE (table1), optionmenuPrecmp, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuPrecmp, _("Comparison function for motion estimation pre pass. Tip: SAD is fast, SATD is good"), NULL);
-
-  menu4 = gtk_menu_new ();
-
-  _0__sad1 = gtk_menu_item_new_with_mnemonic (_("0: SAD"));
-  gtk_widget_show (_0__sad1);
-  gtk_container_add (GTK_CONTAINER (menu4), _0__sad1);
-
-  _1__sse1 = gtk_menu_item_new_with_mnemonic (_("1: SSE"));
-  gtk_widget_show (_1__sse1);
-  gtk_container_add (GTK_CONTAINER (menu4), _1__sse1);
-
-  _2__satd1 = gtk_menu_item_new_with_mnemonic (_("2: SATD"));
-  gtk_widget_show (_2__satd1);
-  gtk_container_add (GTK_CONTAINER (menu4), _2__satd1);
-
-  _3__dct1 = gtk_menu_item_new_with_mnemonic (_("3: DCT"));
-  gtk_widget_show (_3__dct1);
-  gtk_container_add (GTK_CONTAINER (menu4), _3__dct1);
-
-  _4__psnr1 = gtk_menu_item_new_with_mnemonic (_("4: PSNR"));
-  gtk_widget_show (_4__psnr1);
-  gtk_container_add (GTK_CONTAINER (menu4), _4__psnr1);
-
-  _5__bit1 = gtk_menu_item_new_with_mnemonic (_("5: BIT"));
-  gtk_widget_show (_5__bit1);
-  gtk_container_add (GTK_CONTAINER (menu4), _5__bit1);
-
-  _6__rd1 = gtk_menu_item_new_with_mnemonic (_("6: RD"));
-  gtk_widget_show (_6__rd1);
-  gtk_container_add (GTK_CONTAINER (menu4), _6__rd1);
-
-  _7__zero1 = gtk_menu_item_new_with_mnemonic (_("7: ZERO"));
-  gtk_widget_show (_7__zero1);
-  gtk_container_add (GTK_CONTAINER (menu4), _7__zero1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuPrecmp), menu4);
-
-  label44 = gtk_label_new (_("Full pixel:"));
-  gtk_widget_show (label44);
-  gtk_table_attach (GTK_TABLE (table1), label44, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label44), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label44), 0, 0.5);
-
-  optionmenuCmp = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuCmp);
-  gtk_table_attach (GTK_TABLE (table1), optionmenuCmp, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuCmp, _("Comparison function for full pel motion estimation"), NULL);
-
-  menu5 = gtk_menu_new ();
-
-  menuitem1 = gtk_menu_item_new_with_mnemonic (_("0: SAD"));
-  gtk_widget_show (menuitem1);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem1);
-
-  menuitem2 = gtk_menu_item_new_with_mnemonic (_("1: SSE"));
-  gtk_widget_show (menuitem2);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem2);
-
-  menuitem3 = gtk_menu_item_new_with_mnemonic (_("2: SATD"));
-  gtk_widget_show (menuitem3);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem3);
-
-  menuitem4 = gtk_menu_item_new_with_mnemonic (_("3: DCT"));
-  gtk_widget_show (menuitem4);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem4);
-
-  menuitem5 = gtk_menu_item_new_with_mnemonic (_("4: PSNR"));
-  gtk_widget_show (menuitem5);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem5);
-
-  menuitem6 = gtk_menu_item_new_with_mnemonic (_("5: BIT"));
-  gtk_widget_show (menuitem6);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem6);
-
-  menuitem7 = gtk_menu_item_new_with_mnemonic (_("6: RD"));
-  gtk_widget_show (menuitem7);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem7);
-
-  menuitem8 = gtk_menu_item_new_with_mnemonic (_("7: ZERO"));
-  gtk_widget_show (menuitem8);
-  gtk_container_add (GTK_CONTAINER (menu5), menuitem8);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuCmp), menu5);
-
-  label45 = gtk_label_new (_("Subpixel:"));
-  gtk_widget_show (label45);
-  gtk_table_attach (GTK_TABLE (table1), label45, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label45), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label45), 0, 0.5);
-
-  optionmenuSubcmp = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuSubcmp);
-  gtk_table_attach (GTK_TABLE (table1), optionmenuSubcmp, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuSubcmp, _("Comparison function for sub pel motion estimation"), NULL);
-
-  menu6 = gtk_menu_new ();
-
-  menuitem9 = gtk_menu_item_new_with_mnemonic (_("0: SAD"));
-  gtk_widget_show (menuitem9);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem9);
-
-  menuitem10 = gtk_menu_item_new_with_mnemonic (_("1: SSE"));
-  gtk_widget_show (menuitem10);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem10);
-
-  menuitem11 = gtk_menu_item_new_with_mnemonic (_("2: SATD"));
-  gtk_widget_show (menuitem11);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem11);
-
-  menuitem12 = gtk_menu_item_new_with_mnemonic (_("3: DCT"));
-  gtk_widget_show (menuitem12);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem12);
-
-  menuitem13 = gtk_menu_item_new_with_mnemonic (_("4: PSNR"));
-  gtk_widget_show (menuitem13);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem13);
-
-  menuitem14 = gtk_menu_item_new_with_mnemonic (_("5: BIT"));
-  gtk_widget_show (menuitem14);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem14);
-
-  menuitem15 = gtk_menu_item_new_with_mnemonic (_("6: RD"));
-  gtk_widget_show (menuitem15);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem15);
-
-  menuitem16 = gtk_menu_item_new_with_mnemonic (_("7: ZERO"));
-  gtk_widget_show (menuitem16);
-  gtk_container_add (GTK_CONTAINER (menu6), menuitem16);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuSubcmp), menu6);
-
-  label68 = gtk_label_new (_("Macroblock:"));
-  gtk_widget_show (label68);
-  gtk_table_attach (GTK_TABLE (table1), label68, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label68), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label68), 0, 0.5);
-
-  optionmenuMBcmp = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuMBcmp);
-  gtk_table_attach (GTK_TABLE (table1), optionmenuMBcmp, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuMBcmp, _("Comparison  function for the macroblock decision, used only when macroblock decision is set to 0"), NULL);
-
-  menu10 = gtk_menu_new ();
-
-  menuitem28 = gtk_menu_item_new_with_mnemonic (_("0: SAD"));
-  gtk_widget_show (menuitem28);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem28);
-
-  menuitem29 = gtk_menu_item_new_with_mnemonic (_("1: SSE"));
-  gtk_widget_show (menuitem29);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem29);
-
-  menuitem30 = gtk_menu_item_new_with_mnemonic (_("2: SATD"));
-  gtk_widget_show (menuitem30);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem30);
-
-  menuitem31 = gtk_menu_item_new_with_mnemonic (_("3: DCT"));
-  gtk_widget_show (menuitem31);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem31);
-
-  menuitem32 = gtk_menu_item_new_with_mnemonic (_("4: PSNR"));
-  gtk_widget_show (menuitem32);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem32);
-
-  menuitem33 = gtk_menu_item_new_with_mnemonic (_("5: BIT"));
-  gtk_widget_show (menuitem33);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem33);
-
-  menuitem34 = gtk_menu_item_new_with_mnemonic (_("6: RD"));
-  gtk_widget_show (menuitem34);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem34);
-
-  menuitem35 = gtk_menu_item_new_with_mnemonic (_("7: ZERO"));
-  gtk_widget_show (menuitem35);
-  gtk_container_add (GTK_CONTAINER (menu10), menuitem35);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMBcmp), menu10);
-
-  checkbuttonPrecmpChroma = gtk_check_button_new_with_mnemonic (_("Chroma"));
-  gtk_widget_show (checkbuttonPrecmpChroma);
-  gtk_table_attach (GTK_TABLE (table1), checkbuttonPrecmpChroma, 2, 3, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonPrecmpChroma, _("Use chroma, too, currently doesn't work (correctly) with B-frames"), NULL);
-
-  checkbuttonCmpChroma = gtk_check_button_new_with_mnemonic (_("Chroma"));
-  gtk_widget_show (checkbuttonCmpChroma);
-  gtk_table_attach (GTK_TABLE (table1), checkbuttonCmpChroma, 2, 3, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonCmpChroma, _("Use chroma, too, currently doesn't work (correctly) with B-frames"), NULL);
-
-  checkbuttonSubcmpChroma = gtk_check_button_new_with_mnemonic (_("Chroma"));
-  gtk_widget_show (checkbuttonSubcmpChroma);
-  gtk_table_attach (GTK_TABLE (table1), checkbuttonSubcmpChroma, 2, 3, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonSubcmpChroma, _("Use chroma, too, currently doesn't work (correctly) with B-frames"), NULL);
-
-  checkbuttonMBcmpChroma = gtk_check_button_new_with_mnemonic (_("Chroma"));
-  gtk_widget_show (checkbuttonMBcmpChroma);
-  gtk_table_attach (GTK_TABLE (table1), checkbuttonMBcmpChroma, 2, 3, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonMBcmpChroma, _("Use chroma, too, currently doesn't work (correctly) with B-frames"), NULL);
-
-  label49 = gtk_label_new (_("ME comparison function"));
-  gtk_widget_show (label49);
-  gtk_frame_set_label_widget (GTK_FRAME (frame8), label49);
-  gtk_label_set_justify (GTK_LABEL (label49), GTK_JUSTIFY_LEFT);
-
-  frame9 = gtk_frame_new (NULL);
-  gtk_widget_show (frame9);
-  gtk_box_pack_start (GTK_BOX (hbox24), frame9, FALSE, FALSE, 0);
-
-  table2 = gtk_table_new (3, 2, FALSE);
-  gtk_widget_show (table2);
-  gtk_container_add (GTK_CONTAINER (frame9), table2);
-  gtk_container_set_border_width (GTK_CONTAINER (table2), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table2), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table2), 10);
-
-  label47 = gtk_label_new (_("Prepass:"));
-  gtk_widget_show (label47);
-  gtk_table_attach (GTK_TABLE (table2), label47, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label47), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label47), 0, 0.5);
-
-  label48 = gtk_label_new (_("ME:"));
-  gtk_widget_show (label48);
-  gtk_table_attach (GTK_TABLE (table2), label48, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label48), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label48), 0, 0.5);
-
-  optionmenuPreDia = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuPreDia);
-  gtk_table_attach (GTK_TABLE (table2), optionmenuPreDia, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuPreDia, _("Diamond type and size for motion estimation pre pass"), NULL);
-
-  menu7 = gtk_menu_new ();
-
-  _3__adaptive_with_size_1 = gtk_menu_item_new_with_mnemonic (_("adaptive, size 3"));
-  gtk_widget_show (_3__adaptive_with_size_1);
-  gtk_container_add (GTK_CONTAINER (menu7), _3__adaptive_with_size_1);
-
-  _2__adaptive_with_size_1 = gtk_menu_item_new_with_mnemonic (_("adaptive, size 2"));
-  gtk_widget_show (_2__adaptive_with_size_1);
-  gtk_container_add (GTK_CONTAINER (menu7), _2__adaptive_with_size_1);
-
-  experimental1 = gtk_menu_item_new_with_mnemonic (_("experimental"));
-  gtk_widget_show (experimental1);
-  gtk_container_add (GTK_CONTAINER (menu7), experimental1);
-
-  _1__normal_with_size_1__epzs_1 = gtk_menu_item_new_with_mnemonic (_("normal, size 1"));
-  gtk_widget_show (_1__normal_with_size_1__epzs_1);
-  gtk_container_add (GTK_CONTAINER (menu7), _1__normal_with_size_1__epzs_1);
-
-  _2__normal_with_size_1 = gtk_menu_item_new_with_mnemonic (_("normal, size 2"));
-  gtk_widget_show (_2__normal_with_size_1);
-  gtk_container_add (GTK_CONTAINER (menu7), _2__normal_with_size_1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuPreDia), menu7);
-
-  optionmenuDia = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuDia);
-  gtk_table_attach (GTK_TABLE (table2), optionmenuDia, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuDia, _("Diamond type and size for motion estimation"), NULL);
-
-  menu8 = gtk_menu_new ();
-
-  menuitem23 = gtk_menu_item_new_with_mnemonic (_("adaptive, size 3"));
-  gtk_widget_show (menuitem23);
-  gtk_container_add (GTK_CONTAINER (menu8), menuitem23);
-
-  menuitem24 = gtk_menu_item_new_with_mnemonic (_("adaptive, size 2"));
-  gtk_widget_show (menuitem24);
-  gtk_container_add (GTK_CONTAINER (menu8), menuitem24);
-
-  menuitem25 = gtk_menu_item_new_with_mnemonic (_("experimental"));
-  gtk_widget_show (menuitem25);
-  gtk_container_add (GTK_CONTAINER (menu8), menuitem25);
-
-  menuitem26 = gtk_menu_item_new_with_mnemonic (_("normal, size 1"));
-  gtk_widget_show (menuitem26);
-  gtk_container_add (GTK_CONTAINER (menu8), menuitem26);
-
-  menuitem27 = gtk_menu_item_new_with_mnemonic (_("normal, size 2"));
-  gtk_widget_show (menuitem27);
-  gtk_container_add (GTK_CONTAINER (menu8), menuitem27);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuDia), menu8);
-
-  label50 = gtk_label_new (_("Diamond type and size"));
-  gtk_widget_show (label50);
-  gtk_frame_set_label_widget (GTK_FRAME (frame9), label50);
-  gtk_label_set_justify (GTK_LABEL (label50), GTK_JUSTIFY_LEFT);
-
-  label2 = gtk_label_new (_("Motion Estimation"));
-  gtk_widget_show (label2);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 1), label2);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-
-  vbox10 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox10);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox10);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox10,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox10), 5);
-
-  table6 = gtk_table_new (3, 2, FALSE);
-  gtk_widget_show (table6);
-  gtk_box_pack_start (GTK_BOX (vbox10), table6, FALSE, FALSE, 0);
-  gtk_table_set_row_spacings (GTK_TABLE (table6), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table6), 10);
-
-  label19 = gtk_label_new (_("Quantization type:"));
-  gtk_widget_show (label19);
-  gtk_table_attach (GTK_TABLE (table6), label19, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label19), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label19), 0, 0.5);
-
-  label52 = gtk_label_new (_("Macroblock decision:"));
-  gtk_widget_show (label52);
-  gtk_table_attach (GTK_TABLE (table6), label52, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label52), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label52), 0, 0.5);
-
-  label62 = gtk_label_new (_("Quantizer range - Min:"));
-  gtk_widget_show (label62);
-  gtk_table_attach (GTK_TABLE (table6), label62, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label62), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label62), 0, 0.5);
-
-  optionmenuMbd = gtk_option_menu_new ();
-  gtk_widget_show (optionmenuMbd);
-  gtk_table_attach (GTK_TABLE (table6), optionmenuMbd, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, optionmenuMbd, _("Macroblock decision algorithm (high quality mode), encode each macroblock in all modes and choose the best"), NULL);
-
-  menu9 = gtk_menu_new ();
-
-  _0__mbcmp1 = gtk_menu_item_new_with_mnemonic (_("0: MB comparison"));
-  gtk_widget_show (_0__mbcmp1);
-  gtk_container_add (GTK_CONTAINER (menu9), _0__mbcmp1);
-
-  _1__fewest_bits1 = gtk_menu_item_new_with_mnemonic (_("1: Fewest bits (vhq)"));
-  gtk_widget_show (_1__fewest_bits1);
-  gtk_container_add (GTK_CONTAINER (menu9), _1__fewest_bits1);
-
-  _2__rate_distortion1 = gtk_menu_item_new_with_mnemonic (_("2: Rate distortion"));
-  gtk_widget_show (_2__rate_distortion1);
-  gtk_container_add (GTK_CONTAINER (menu9), _2__rate_distortion1);
-
-  gtk_option_menu_set_menu (GTK_OPTION_MENU (optionmenuMbd), menu9);
-
-  hbox28 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox28);
-  gtk_table_attach (GTK_TABLE (table6), hbox28, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  radiobuttonH263 = gtk_radio_button_new_with_mnemonic (NULL, _("_H.263"));
-  gtk_widget_show (radiobuttonH263);
-  gtk_box_pack_start (GTK_BOX (hbox28), radiobuttonH263, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, radiobuttonH263, _("H.263 quantizers smooth the picture (useful at lower bitrates)"), NULL);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonH263), radiobuttonH263_group);
-  radiobuttonH263_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonH263));
-
-  radiobuttonMpeg = gtk_radio_button_new_with_mnemonic (NULL, _("_MPEG"));
-  gtk_widget_show (radiobuttonMpeg);
-  gtk_box_pack_start (GTK_BOX (hbox28), radiobuttonMpeg, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, radiobuttonMpeg, _("MPEG quantizers produce sharper picture (useful at higher bitrates)"), NULL);
-  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonMpeg), radiobuttonH263_group);
-  radiobuttonH263_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonMpeg));
-
-  hbox29 = gtk_hbox_new (FALSE, 10);
-  gtk_widget_show (hbox29);
-  gtk_table_attach (GTK_TABLE (table6), hbox29, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  spinbuttonIMin_adj = gtk_adjustment_new (2, 1, 31, 1, 10, 10);
-  spinbuttonIMin = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMin_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMin);
-  gtk_box_pack_start (GTK_BOX (hbox29), spinbuttonIMin, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMin, _("Minimum quantizer, 1 is not recommended, should be 2 for normal MPEG-4 encoding"), NULL);
-
-  label24 = gtk_label_new (_("Max:"));
-  gtk_widget_show (label24);
-  gtk_box_pack_start (GTK_BOX (hbox29), label24, FALSE, FALSE, 0);
-  gtk_label_set_justify (GTK_LABEL (label24), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label24), 0, 0.5);
-
-  spinbuttonIMax_adj = gtk_adjustment_new (31, 1, 31, 1, 10, 10);
-  spinbuttonIMax = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonIMax_adj), 1, 0);
-  gtk_widget_show (spinbuttonIMax);
-  gtk_box_pack_start (GTK_BOX (hbox29), spinbuttonIMax, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonIMax, _("Maximum quantizer, 10-31 should be a sane range"), NULL);
-
-  checkbuttonTrellis = gtk_check_button_new_with_mnemonic (_("_Trellis quantization"));
-  gtk_widget_show (checkbuttonTrellis);
-  gtk_box_pack_start (GTK_BOX (vbox10), checkbuttonTrellis, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonTrellis, _("Trellis searched quantization will find the optimal encoding for each 8x8 block"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonTrellis), TRUE);
-
-  checkbuttonCbp = gtk_check_button_new_with_mnemonic (_("Rate distorted CBP"));
-  gtk_widget_show (checkbuttonCbp);
-  gtk_box_pack_start (GTK_BOX (vbox10), checkbuttonCbp, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonCbp, _("Rate distorted optimal coded block pattern"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonCbp), TRUE);
-
-  label3 = gtk_label_new (_("Quantization"));
-  gtk_widget_show (label3);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 2), label3);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-
-  vbox11 = gtk_vbox_new (FALSE, 5);
-  gtk_widget_show (vbox11);
-  gtk_container_add (GTK_CONTAINER (notebook1), vbox11);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), vbox11,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (vbox11), 5);
-
-  table4 = gtk_table_new (5, 2, FALSE);
-  gtk_widget_show (table4);
-  gtk_box_pack_start (GTK_BOX (vbox11), table4, FALSE, FALSE, 0);
-  gtk_table_set_row_spacings (GTK_TABLE (table4), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table4), 10);
-
-  spinbuttonDarkMask_adj = gtk_adjustment_new (0.01, 0, 1, 0.01, 10, 10);
-  spinbuttonDarkMask = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonDarkMask_adj), 1, 2);
-  gtk_widget_show (spinbuttonDarkMask);
-  gtk_table_attach (GTK_TABLE (table4), spinbuttonDarkMask, 1, 2, 1, 2,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonDarkMask, _("Sane range: 0-0.3. Large values might look good on some monitors, but horrible on others (TV, LCD...)"), NULL);
-
-  spinbuttonLumiMask_adj = gtk_adjustment_new (0.05, 0, 1, 0.01, 10, 10);
-  spinbuttonLumiMask = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonLumiMask_adj), 1, 2);
-  gtk_widget_show (spinbuttonLumiMask);
-  gtk_table_attach (GTK_TABLE (table4), spinbuttonLumiMask, 1, 2, 0, 1,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonLumiMask, _("Sane range: 0-0.3. Large values might look good on some monitors, but horrible on others (TV, LCD...)"), NULL);
-
-  spinbuttonScplxMask_adj = gtk_adjustment_new (0.1, 0, 1, 0.01, 10, 10);
-  spinbuttonScplxMask = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonScplxMask_adj), 1, 2);
-  gtk_widget_show (spinbuttonScplxMask);
-  gtk_table_attach (GTK_TABLE (table4), spinbuttonScplxMask, 1, 2, 2, 3,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonScplxMask, _("Sane range: 0-0.5. Large values help against blockiness, but may introduce ringing/mosquito noise artifacts on sharp edges"), NULL);
-
-  spinbuttonTcplxMask_adj = gtk_adjustment_new (0, 0, 1, 0.01, 10, 10);
-  spinbuttonTcplxMask = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTcplxMask_adj), 1, 2);
-  gtk_widget_show (spinbuttonTcplxMask);
-  gtk_table_attach (GTK_TABLE (table4), spinbuttonTcplxMask, 1, 2, 3, 4,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  checkbuttonDarkMask = gtk_check_button_new_with_mnemonic (_("Darkness masking:"));
-  gtk_widget_show (checkbuttonDarkMask);
-  gtk_table_attach (GTK_TABLE (table4), checkbuttonDarkMask, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonDarkMask), TRUE);
-
-  checkbuttonScplxMask = gtk_check_button_new_with_mnemonic (_("Spatial complexity masking:"));
-  gtk_widget_show (checkbuttonScplxMask);
-  gtk_table_attach (GTK_TABLE (table4), checkbuttonScplxMask, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonScplxMask), TRUE);
-
-  checkbuttonTcplxMask = gtk_check_button_new_with_mnemonic (_("Temporal complexity masking:"));
-  gtk_widget_show (checkbuttonTcplxMask);
-  gtk_table_attach (GTK_TABLE (table4), checkbuttonTcplxMask, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  checkbuttonLumiMask = gtk_check_button_new_with_mnemonic (_("Lumi masking:"));
-  gtk_widget_show (checkbuttonLumiMask);
-  gtk_table_attach (GTK_TABLE (table4), checkbuttonLumiMask, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonLumiMask), TRUE);
-
-  spinbuttonPMask_adj = gtk_adjustment_new (0, 0, 1, 0.1, 10, 10);
-  spinbuttonPMask = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonPMask_adj), 1, 2);
-  gtk_widget_show (spinbuttonPMask);
-  gtk_table_attach (GTK_TABLE (table4), spinbuttonPMask, 1, 2, 4, 5,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  checkbuttonPMask = gtk_check_button_new_with_mnemonic (_("P block masking:"));
-  gtk_widget_show (checkbuttonPMask);
-  gtk_table_attach (GTK_TABLE (table4), checkbuttonPMask, 0, 1, 4, 5,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  checkbuttonNaq = gtk_check_button_new_with_mnemonic (_("Normalize adaptive quantization"));
-  gtk_widget_show (checkbuttonNaq);
-  gtk_box_pack_start (GTK_BOX (vbox11), checkbuttonNaq, FALSE, FALSE, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonNaq, _("Attempt  to adjust the per-MB quantizers to maintain the proper average when using adaptive quantization (*masking)"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonNaq), TRUE);
-
-  frame11 = gtk_frame_new (NULL);
-  gtk_widget_show (frame11);
-  gtk_box_pack_start (GTK_BOX (vbox11), frame11, FALSE, FALSE, 5);
-
-  table5 = gtk_table_new (2, 3, FALSE);
-  gtk_widget_show (table5);
-  gtk_container_add (GTK_CONTAINER (frame11), table5);
-  gtk_container_set_border_width (GTK_CONTAINER (table5), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table5), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table5), 10);
-
-  spinbuttonLumaElim_adj = gtk_adjustment_new (2, 0, 1000, 1, 10, 10);
-  spinbuttonLumaElim = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonLumaElim_adj), 1, 0);
-  gtk_widget_show (spinbuttonLumaElim);
-  gtk_table_attach (GTK_TABLE (table5), spinbuttonLumaElim, 1, 2, 0, 1,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  spinbuttonChromaElim_adj = gtk_adjustment_new (7, 0, 1000, 1, 10, 10);
-  spinbuttonChromaElim = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonChromaElim_adj), 1, 0);
-  gtk_widget_show (spinbuttonChromaElim);
-  gtk_table_attach (GTK_TABLE (table5), spinbuttonChromaElim, 1, 2, 1, 2,
-                    (GtkAttachOptions) (0),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  checkbuttonLumaElim = gtk_check_button_new_with_mnemonic (_("Luminance:"));
-  gtk_widget_show (checkbuttonLumaElim);
-  gtk_table_attach (GTK_TABLE (table5), checkbuttonLumaElim, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonLumaElim), TRUE);
-
-  checkbuttonChromaElim = gtk_check_button_new_with_mnemonic (_("Chrominance:"));
-  gtk_widget_show (checkbuttonChromaElim);
-  gtk_table_attach (GTK_TABLE (table5), checkbuttonChromaElim, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonChromaElim), TRUE);
-
-  checkbuttonLumaElimDC = gtk_check_button_new_with_mnemonic (_("DC"));
-  gtk_widget_show (checkbuttonLumaElimDC);
-  gtk_table_attach (GTK_TABLE (table5), checkbuttonLumaElimDC, 2, 3, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonLumaElimDC, _("Consider also the dc coefficient"), NULL);
-  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (checkbuttonLumaElimDC), TRUE);
-
-  checkbuttonChromaElimDC = gtk_check_button_new_with_mnemonic (_("DC"));
-  gtk_widget_show (checkbuttonChromaElimDC);
-  gtk_table_attach (GTK_TABLE (table5), checkbuttonChromaElimDC, 2, 3, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, checkbuttonChromaElimDC, _("Consider also the dc coefficient"), NULL);
-
-  label59 = gtk_label_new (_("Single coefficient elimination threshold"));
-  gtk_widget_show (label59);
-  gtk_frame_set_label_widget (GTK_FRAME (frame11), label59);
-  gtk_label_set_justify (GTK_LABEL (label59), GTK_JUSTIFY_LEFT);
-
-  label53 = gtk_label_new (_("Masking"));
-  gtk_widget_show (label53);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 3), label53);
-  gtk_label_set_justify (GTK_LABEL (label53), GTK_JUSTIFY_LEFT);
-
-  table8 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table8);
-  gtk_container_add (GTK_CONTAINER (notebook1), table8);
-  gtk_notebook_set_tab_label_packing (GTK_NOTEBOOK (notebook1), table8,
-                                      FALSE, FALSE, GTK_PACK_START);
-  gtk_container_set_border_width (GTK_CONTAINER (table8), 5);
-  gtk_table_set_row_spacings (GTK_TABLE (table8), 5);
-  gtk_table_set_col_spacings (GTK_TABLE (table8), 10);
-
-  label64 = gtk_label_new (_("Filesize tolerance (kb):"));
-  gtk_widget_show (label64);
-  gtk_table_attach (GTK_TABLE (table8), label64, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label64), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label64), 0, 0.5);
-
-  label65 = gtk_label_new (_("Quantizer compression:"));
-  gtk_widget_show (label65);
-  gtk_table_attach (GTK_TABLE (table8), label65, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label65), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label65), 0, 0.5);
-
-  label66 = gtk_label_new (_("Quantizer blur:"));
-  gtk_widget_show (label66);
-  gtk_table_attach (GTK_TABLE (table8), label66, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label66), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label66), 0, 0.5);
-
-  label67 = gtk_label_new (_("Max quantizer difference:"));
-  gtk_widget_show (label67);
-  gtk_table_attach (GTK_TABLE (table8), label67, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_label_set_justify (GTK_LABEL (label67), GTK_JUSTIFY_LEFT);
-  gtk_misc_set_alignment (GTK_MISC (label67), 0, 0.5);
-
-  spinbuttonMaxQDiff_adj = gtk_adjustment_new (3, 1, 31, 1, 10, 10);
-  spinbuttonMaxQDiff = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonMaxQDiff_adj), 1, 0);
-  gtk_widget_show (spinbuttonMaxQDiff);
-  gtk_table_attach (GTK_TABLE (table8), spinbuttonMaxQDiff, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonMaxQDiff, _("Maximum  quantizer difference between I or P frames"), NULL);
-
-  spinbuttonQBlur_adj = gtk_adjustment_new (0.5, 0, 1, 0.1, 10, 10);
-  spinbuttonQBlur = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQBlur_adj), 1, 1);
-  gtk_widget_show (spinbuttonQBlur);
-  gtk_table_attach (GTK_TABLE (table8), spinbuttonQBlur, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonQBlur, _("Quantizer  gaussian blur, larger values will average the quantizer more over time (slower change)"), NULL);
-
-  spinbuttonQComp_adj = gtk_adjustment_new (0.5, 0, 1, 1, 10, 10);
-  spinbuttonQComp = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonQComp_adj), 1, 1);
-  gtk_widget_show (spinbuttonQComp);
-  gtk_table_attach (GTK_TABLE (table8), spinbuttonQComp, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  entryRateTol = gtk_entry_new ();
-  gtk_widget_show (entryRateTol);
-  gtk_table_attach (GTK_TABLE (table8), entryRateTol, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, entryRateTol, _("Filesize tolerance (1 kb = 1000 bits). 1000-100000 is a sane range"), NULL);
-  gtk_entry_set_text (GTK_ENTRY (entryRateTol), _("8000"));
-
-  labelRateTol = gtk_label_new (_("Ratecontrol"));
-  gtk_widget_show (labelRateTol);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (notebook1), gtk_notebook_get_nth_page (GTK_NOTEBOOK (notebook1), 4), labelRateTol);
-  gtk_label_set_justify (GTK_LABEL (labelRateTol), GTK_JUSTIFY_LEFT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, notebook1, "notebook1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox2, "vbox2");
-  GLADE_HOOKUP_OBJECT (dialog1, frame10, "frame10");
-  GLADE_HOOKUP_OBJECT (dialog1, table3, "table3");
-  GLADE_HOOKUP_OBJECT (dialog1, label10, "label10");
-  GLADE_HOOKUP_OBJECT (dialog1, label11, "label11");
-  GLADE_HOOKUP_OBJECT (dialog1, label12, "label12");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuType, "optionmenuType");
-  GLADE_HOOKUP_OBJECT (dialog1, menu1, "menu1");
-  GLADE_HOOKUP_OBJECT (dialog1, one_pass_cbr1, "one_pass_cbr1");
-  GLADE_HOOKUP_OBJECT (dialog1, one_pass_quantizer1, "one_pass_quantizer1");
-  GLADE_HOOKUP_OBJECT (dialog1, two_pass1, "two_pass1");
-  GLADE_HOOKUP_OBJECT (dialog1, same_qz_as_input1, "same_qz_as_input1");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQuant, "spinbuttonQuant");
-  GLADE_HOOKUP_OBJECT (dialog1, entryEntry, "entryEntry");
-  GLADE_HOOKUP_OBJECT (dialog1, label51, "label51");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox7, "hbox7");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox4, "vbox4");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonInterlaced, "checkbuttonInterlaced");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonGreyScale, "checkbuttonGreyScale");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox20, "hbox20");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonAspect, "checkbuttonAspect");
-  GLADE_HOOKUP_OBJECT (dialog1, entryAspectX, "entryAspectX");
-  GLADE_HOOKUP_OBJECT (dialog1, label40, "label40");
-  GLADE_HOOKUP_OBJECT (dialog1, entryAspectY, "entryAspectY");
-  GLADE_HOOKUP_OBJECT (dialog1, label8, "label8");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox6, "vbox6");
-  GLADE_HOOKUP_OBJECT (dialog1, table7, "table7");
-  GLADE_HOOKUP_OBJECT (dialog1, label41, "label41");
-  GLADE_HOOKUP_OBJECT (dialog1, label15, "label15");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox30, "hbox30");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbutton4MV, "checkbutton4MV");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonMV0, "checkbuttonMV0");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuMS, "optionmenuMS");
-  GLADE_HOOKUP_OBJECT (dialog1, menu2, "menu2");
-  GLADE_HOOKUP_OBJECT (dialog1, _0___none1, "_0___none1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1___full1, "_1___full1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2___log2, "_2___log2");
-  GLADE_HOOKUP_OBJECT (dialog1, _3___phods1, "_3___phods1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4___epzs1, "_4___epzs1");
-  GLADE_HOOKUP_OBJECT (dialog1, _5___x1, "_5___x1");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMaxPeriod, "spinbuttonIMaxPeriod");
-  GLADE_HOOKUP_OBJECT (dialog1, frame2, "frame2");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox11, "hbox11");
-  GLADE_HOOKUP_OBJECT (dialog1, label18, "label18");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBFrame, "spinbuttonBFrame");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonQPel, "checkbuttonQPel");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonGMC, "checkbuttonGMC");
-  GLADE_HOOKUP_OBJECT (dialog1, label17, "label17");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox24, "hbox24");
-  GLADE_HOOKUP_OBJECT (dialog1, frame8, "frame8");
-  GLADE_HOOKUP_OBJECT (dialog1, table1, "table1");
-  GLADE_HOOKUP_OBJECT (dialog1, label43, "label43");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuPrecmp, "optionmenuPrecmp");
-  GLADE_HOOKUP_OBJECT (dialog1, menu4, "menu4");
-  GLADE_HOOKUP_OBJECT (dialog1, _0__sad1, "_0__sad1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1__sse1, "_1__sse1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2__satd1, "_2__satd1");
-  GLADE_HOOKUP_OBJECT (dialog1, _3__dct1, "_3__dct1");
-  GLADE_HOOKUP_OBJECT (dialog1, _4__psnr1, "_4__psnr1");
-  GLADE_HOOKUP_OBJECT (dialog1, _5__bit1, "_5__bit1");
-  GLADE_HOOKUP_OBJECT (dialog1, _6__rd1, "_6__rd1");
-  GLADE_HOOKUP_OBJECT (dialog1, _7__zero1, "_7__zero1");
-  GLADE_HOOKUP_OBJECT (dialog1, label44, "label44");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuCmp, "optionmenuCmp");
-  GLADE_HOOKUP_OBJECT (dialog1, menu5, "menu5");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem1, "menuitem1");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem2, "menuitem2");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem3, "menuitem3");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem4, "menuitem4");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem5, "menuitem5");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem6, "menuitem6");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem7, "menuitem7");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem8, "menuitem8");
-  GLADE_HOOKUP_OBJECT (dialog1, label45, "label45");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuSubcmp, "optionmenuSubcmp");
-  GLADE_HOOKUP_OBJECT (dialog1, menu6, "menu6");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem9, "menuitem9");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem10, "menuitem10");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem11, "menuitem11");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem12, "menuitem12");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem13, "menuitem13");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem14, "menuitem14");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem15, "menuitem15");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem16, "menuitem16");
-  GLADE_HOOKUP_OBJECT (dialog1, label68, "label68");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuMBcmp, "optionmenuMBcmp");
-  GLADE_HOOKUP_OBJECT (dialog1, menu10, "menu10");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem28, "menuitem28");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem29, "menuitem29");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem30, "menuitem30");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem31, "menuitem31");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem32, "menuitem32");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem33, "menuitem33");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem34, "menuitem34");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem35, "menuitem35");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonPrecmpChroma, "checkbuttonPrecmpChroma");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonCmpChroma, "checkbuttonCmpChroma");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonSubcmpChroma, "checkbuttonSubcmpChroma");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonMBcmpChroma, "checkbuttonMBcmpChroma");
-  GLADE_HOOKUP_OBJECT (dialog1, label49, "label49");
-  GLADE_HOOKUP_OBJECT (dialog1, frame9, "frame9");
-  GLADE_HOOKUP_OBJECT (dialog1, table2, "table2");
-  GLADE_HOOKUP_OBJECT (dialog1, label47, "label47");
-  GLADE_HOOKUP_OBJECT (dialog1, label48, "label48");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuPreDia, "optionmenuPreDia");
-  GLADE_HOOKUP_OBJECT (dialog1, menu7, "menu7");
-  GLADE_HOOKUP_OBJECT (dialog1, _3__adaptive_with_size_1, "_3__adaptive_with_size_1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2__adaptive_with_size_1, "_2__adaptive_with_size_1");
-  GLADE_HOOKUP_OBJECT (dialog1, experimental1, "experimental1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1__normal_with_size_1__epzs_1, "_1__normal_with_size_1__epzs_1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2__normal_with_size_1, "_2__normal_with_size_1");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuDia, "optionmenuDia");
-  GLADE_HOOKUP_OBJECT (dialog1, menu8, "menu8");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem23, "menuitem23");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem24, "menuitem24");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem25, "menuitem25");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem26, "menuitem26");
-  GLADE_HOOKUP_OBJECT (dialog1, menuitem27, "menuitem27");
-  GLADE_HOOKUP_OBJECT (dialog1, label50, "label50");
-  GLADE_HOOKUP_OBJECT (dialog1, label2, "label2");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox10, "vbox10");
-  GLADE_HOOKUP_OBJECT (dialog1, table6, "table6");
-  GLADE_HOOKUP_OBJECT (dialog1, label19, "label19");
-  GLADE_HOOKUP_OBJECT (dialog1, label52, "label52");
-  GLADE_HOOKUP_OBJECT (dialog1, label62, "label62");
-  GLADE_HOOKUP_OBJECT (dialog1, optionmenuMbd, "optionmenuMbd");
-  GLADE_HOOKUP_OBJECT (dialog1, menu9, "menu9");
-  GLADE_HOOKUP_OBJECT (dialog1, _0__mbcmp1, "_0__mbcmp1");
-  GLADE_HOOKUP_OBJECT (dialog1, _1__fewest_bits1, "_1__fewest_bits1");
-  GLADE_HOOKUP_OBJECT (dialog1, _2__rate_distortion1, "_2__rate_distortion1");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox28, "hbox28");
-  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonH263, "radiobuttonH263");
-  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonMpeg, "radiobuttonMpeg");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox29, "hbox29");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMin, "spinbuttonIMin");
-  GLADE_HOOKUP_OBJECT (dialog1, label24, "label24");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonIMax, "spinbuttonIMax");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonTrellis, "checkbuttonTrellis");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonCbp, "checkbuttonCbp");
-  GLADE_HOOKUP_OBJECT (dialog1, label3, "label3");
-  GLADE_HOOKUP_OBJECT (dialog1, vbox11, "vbox11");
-  GLADE_HOOKUP_OBJECT (dialog1, table4, "table4");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonDarkMask, "spinbuttonDarkMask");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonLumiMask, "spinbuttonLumiMask");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonScplxMask, "spinbuttonScplxMask");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTcplxMask, "spinbuttonTcplxMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonDarkMask, "checkbuttonDarkMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonScplxMask, "checkbuttonScplxMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonTcplxMask, "checkbuttonTcplxMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonLumiMask, "checkbuttonLumiMask");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonPMask, "spinbuttonPMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonPMask, "checkbuttonPMask");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonNaq, "checkbuttonNaq");
-  GLADE_HOOKUP_OBJECT (dialog1, frame11, "frame11");
-  GLADE_HOOKUP_OBJECT (dialog1, table5, "table5");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonLumaElim, "spinbuttonLumaElim");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonChromaElim, "spinbuttonChromaElim");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonLumaElim, "checkbuttonLumaElim");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChromaElim, "checkbuttonChromaElim");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonLumaElimDC, "checkbuttonLumaElimDC");
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonChromaElimDC, "checkbuttonChromaElimDC");
-  GLADE_HOOKUP_OBJECT (dialog1, label59, "label59");
-  GLADE_HOOKUP_OBJECT (dialog1, label53, "label53");
-  GLADE_HOOKUP_OBJECT (dialog1, table8, "table8");
-  GLADE_HOOKUP_OBJECT (dialog1, label64, "label64");
-  GLADE_HOOKUP_OBJECT (dialog1, label65, "label65");
-  GLADE_HOOKUP_OBJECT (dialog1, label66, "label66");
-  GLADE_HOOKUP_OBJECT (dialog1, label67, "label67");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonMaxQDiff, "spinbuttonMaxQDiff");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQBlur, "spinbuttonQBlur");
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonQComp, "spinbuttonQComp");
-  GLADE_HOOKUP_OBJECT (dialog1, entryRateTol, "entryRateTol");
-  GLADE_HOOKUP_OBJECT (dialog1, labelRateTol, "labelRateTol");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, tooltips, "tooltips");
-
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-15 10:54:29 UTC (rev 2943)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-04-15 12:55:44 UTC (rev 2944)
@@ -14,7 +14,7 @@
 	DIA_working.h DIA_busy.cpp DIA_busy.h DIA_exLame.cpp DIA_pipe.cpp DIA_mpeg2opt.cpp \
 	DIA_xvcd.cpp  \
 	DIA_xvid.cpp DIA_crop.cpp DIA_color.cpp DIA_encoding.cpp   \
-	DIA_requant.cpp DIA_xvid4.cpp DIA_lavcodec.cpp \
+	DIA_requant.cpp DIA_xvid4.cpp  \
 	DIA_pause.cpp \
 	DIA_lavdecoder.cpp DIA_calculator.cpp DIA_equalizer.cpp \
 	DIA_vobsub.cpp DIA_x264.cpp DIA_ocr.cpp  DIA_hue.cpp DIA_eq2.cpp \
@@ -50,7 +50,7 @@
 DIA_jobs_save.cpp     DIA_x264.cpp \
 DIA_preview.cpp     DIA_xvcd.cpp \
 DIA_busy.cpp         DIA_properties.cpp  DIA_xvid.cpp \
-DIA_busy.h           DIA_lavcodec.cpp     DIA_quota.cpp       DIA_xvid4.cpp \
+DIA_busy.h            DIA_quota.cpp       DIA_xvid4.cpp \
 DIA_calculator.cpp   DIA_encoding.cpp      DIA_lavdecoder.cpp   DIA_recent.cpp \
 DIA_chromaShift.cpp  DIA_encoding.h        DIA_lavpp_deint.cpp  DIA_requant.cpp 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-04-15 10:54:29 UTC (rev 2943)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-04-15 12:55:44 UTC (rev 2944)
@@ -102,7 +102,6 @@
 uint8_t DIA_xvid4(COMPRES_PARAMS *incoming){return 0;}
 
 //******************************
-uint8_t getFFCompressParams (COMPRES_PARAMS * incoming) {return 0;}
 uint8_t DIA_quota(char *) {return 0;}
 
 uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-04-15 10:54:29 UTC (rev 2943)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-04-15 12:55:44 UTC (rev 2944)
@@ -100,7 +100,7 @@
 uint8_t DIA_xvid4(COMPRES_PARAMS *incoming){return 0;}
 
 //******************************
-uint8_t getFFCompressParams (COMPRES_PARAMS * incoming) {return 0;}
+
 uint8_t DIA_quota(char *) {return 0;}
 
 uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp (from rev 2818, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavcodec.cpp	2007-02-13 19:16:54 UTC (rev 2818)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp	2007-04-15 12:55:44 UTC (rev 2944)
@@ -0,0 +1,127 @@
+//
+// C++ Implementation: ADM_vidForcedPP
+//
+// Description: 
+//
+//	Force postprocessing assuming constant quant & image type
+//	Uselefull on some badly authored DVD for example
+//
+// Author: mean <fixounet at free.fr>, (C) 2004
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+#include <math.h>
+#include <math.h>
+#include <iconv.h>
+#include "config.h"
+
+
+#include "fourcc.h"
+#include "avio.hxx"
+
+#include "avi_vars.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h" 
+#include "ADM_lavcodec.h"
+#include "ADM_codecs/ADM_ffmpegConfig.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+/**
+      \fn getFFCompressParams
+      \brief Dialog for lavcodec mpeg4/... codec settings
+*/
+uint8_t getFFCompressParams(COMPRES_PARAMS *incoming)
+{
+int ret=0;	
+	FFcodecSetting *conf=(FFcodecSetting *)incoming->extraSettings;
+	ADM_assert(incoming->extraSettingsLen==sizeof(FFcodecSetting));
+#define PX(x) &(conf->x)
+         
+         
+         
+diaMenuEntry meE[]={
+  {1,_("None")},
+  {2,_("Full")},
+  {3,_("Log")},
+  {4,_("Phods")},
+  {5,_("EPZS")},
+  {6,_("X1")}
+};       
+
+diaMenuEntry qzE[]={
+  {0,_("H263")},
+  {1,_("MPEG")}
+};       
+
+diaMenuEntry rdE[]={
+  {0,_("MB Comparison")},
+  {1,_("Fewest bits (vhq)")},
+  {2,_("Rate distortion")}
+};     
+
+uint32_t me=(uint32_t)conf->me_method;  
+
+         diaElemBitrate bitrate(incoming,NULL);
+         diaElemMenu      meM(&me,_("Matrices"),4,meE);
+         diaElemUInteger  qminM(PX(qmin),_("Min Qz"),1,31);
+         diaElemUInteger  qmaxM(PX(qmax),_("Max Qz"),1,31);
+         diaElemUInteger  qdiffM(PX(max_qdiff),_("Max QDiff"),1,31);
+         
+         diaElemToggle    fourMv(PX(_4MV),_("4MV"));
+         diaElemToggle    trellis(PX(_TRELLIS_QUANT),_("Trellis"));
+         
+         diaElemToggle    qpel(PX(_QPEL),_("Quarter Pel"));
+         diaElemToggle    gmc(PX(_GMC),_("GMC"));
+
+         
+         diaElemUInteger  max_b_frames(PX(max_b_frames),_("Number of BFrames"),0,32);
+         diaElemMenu     qzM(PX(mpeg_quant),_("Quantization type"),2,qzE);
+         
+         diaElemMenu     rdM(PX(mb_eval),_("Macroblock decision"),3,rdE);
+         
+         diaElemUInteger filetol(PX(vratetol),_("Filesize tolerance (kb"),0,100000);
+         
+         diaElemFloat    qzComp(PX(qcompress),_("Quantize compression"),0,1);
+         diaElemFloat    qzBlur(PX(qblur),_("Quantize blur"),0,1);
+         
+         
+          /* First Tab : encoding mode */
+        diaElem *diamode[]={&bitrate};
+        diaElemTabs tabMode(_("User Interface"),1,diamode);
+        
+        /* 2nd Tab : ME */
+        diaElemFrame frameMe(_("Advanced Simple Profile"));
+        
+        frameMe.swallow(&max_b_frames);
+        frameMe.swallow(&qpel);
+        frameMe.swallow(&gmc);
+        
+        diaElem *diaME[]={&fourMv,&frameMe};
+        diaElemTabs tabME(_("Motion Estimation"),2,diaME);
+        /* 3nd Tab : Qz */
+        
+         diaElem *diaQze[]={&qzM,&rdM,&qminM,&qmaxM,&qdiffM,&trellis};
+        diaElemTabs tabQz(_("Quantization"),6,diaQze);
+        
+        /* 4th Tab : RControl */
+        
+         diaElem *diaRC[]={&filetol,&qzComp,&qzBlur};
+        diaElemTabs tabRC(_("Rate Control"),3,diaRC);
+        
+         diaElemTabs *tabs[]={&tabMode,&tabME,&tabQz,&tabRC};
+        if( diaFactoryRunTabs(_("Lavcodec Mpeg4 configuration"),4,tabs))
+	{
+          conf->me_method=(Motion_Est_ID)me;
+          return 1;
+        }
+         return 0;
+}
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-15 10:54:29 UTC (rev 2943)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-04-15 12:55:44 UTC (rev 2944)
@@ -3,7 +3,8 @@
 libADM_CommonUI_a_SOURCES = GUI_sdlRender.cpp  GUI_xvRender.cpp  \
 DIA_resizeWiz.cpp DIA_builtin.cpp DIA_postproc.cpp DIA_enter.cpp \
 DIA_audioconfig.cpp GUI_render.cpp DIA_SVCD.cpp DIA_DVDff.cpp \
-DIA_bitrateHisto.cpp DIA_prefs.cpp DIA_gototime.cpp
+DIA_bitrateHisto.cpp DIA_prefs.cpp DIA_gototime.cpp \
+DIA_lavcodec.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \



From mean at mail.berlios.de  Sun Apr 15 18:51:25 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 15 Apr 2007 18:51:25 +0200
Subject: [Avidemux-svn-commit] r2945 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200704151651.l3FGpPQo024280@sheep.berlios.de>

Author: mean
Date: 2007-04-15 18:51:20 +0200 (Sun, 15 Apr 2007)
New Revision: 2945

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h
Log:
oops

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2007-04-15 12:55:44 UTC (rev 2944)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2007-04-15 16:51:20 UTC (rev 2945)
@@ -24,24 +24,24 @@
 typedef struct FFcodecSetting
 {
   Motion_Est_ID me_method;
-  uint8_t _GMC;
-  uint8_t _4MV;
-  uint8_t _QPEL;
-  uint8_t _TRELLIS_QUANT;
-  int qmin;			// 2-31
-  int qmax;			// 2-31
-  int max_qdiff;		// 1-31
-  int max_b_frames;		// 0-1
-  int mpeg_quant;		// 0-1
-  int is_luma_elim_threshold;
-  int luma_elim_threshold;	// -99--99
-  int is_chroma_elim_threshold;	// -99--99           
-  int chroma_elim_threshold;	// -99--99      
+  uint32_t _GMC;
+  uint32_t _4MV;
+  uint32_t _QPEL;
+  uint32_t _TRELLIS_QUANT;
+  uint32_t qmin;			// 2-31
+  uint32_t qmax;			// 2-31
+  uint32_t max_qdiff;		// 1-31
+  uint32_t max_b_frames;		// 0-1
+  uint32_t mpeg_quant;		// 0-1
+  uint32_t is_luma_elim_threshold;
+  uint32_t luma_elim_threshold;	// -99--99
+  uint32_t is_chroma_elim_threshold;	// -99--99           
+  uint32_t chroma_elim_threshold;	// -99--99      
 
   float lumi_masking;		// -1--1        
-  int is_lumi_masking;		// -1--1
+  int32_t is_lumi_masking;		// -1--1
   float dark_masking;		// -1--1        
-  int is_dark_masking;		// -1--1
+  int32_t is_dark_masking;		// -1--1
   float qcompress;		// 0.0--1.0
   float qblur;			// 0.0--1.0
   uint32_t minBitrate;          // In kBits/s
@@ -55,15 +55,15 @@
   uint32_t widescreen;          //0 4/3  1 16/9
 
   // new stuff from jakub ui
-  int mb_eval;			// Replace hq 0..2
-  int vratetol;			// filesize tolerance in kb
+  uint32_t mb_eval;			// Replace hq 0..2
+  uint32_t vratetol;			// filesize tolerance in kb
 
-  int is_temporal_cplx_masking;	// temporal masking 0--1        
+  uint32_t is_temporal_cplx_masking;	// temporal masking 0--1        
   float temporal_cplx_masking;	// temporal masking 0--1
 
-  int is_spatial_cplx_masking;	// spatial masking 0--1
+  uint32_t is_spatial_cplx_masking;	// spatial masking 0--1
   float spatial_cplx_masking;	// spatial masking 0--1
-  int _NORMALIZE_AQP;		// normalize adap quantiz
+  uint32_t _NORMALIZE_AQP;		// normalize adap quantiz
 
   //
   uint32_t use_xvid_ratecontrol;



From mean at mail.berlios.de  Mon Apr 16 19:16:16 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 16 Apr 2007 19:16:16 +0200
Subject: [Avidemux-svn-commit] r2946 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200704161716.l3GHGGnn028229@sheep.berlios.de>

Author: mean
Date: 2007-04-16 19:16:15 +0200 (Mon, 16 Apr 2007)
New Revision: 2946

Modified:
   branches/avidemux_2.4_branch/avidemux/guiplay.cpp
Log:
try to fix redraw problem when using renderAccel

Modified: branches/avidemux_2.4_branch/avidemux/guiplay.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/guiplay.cpp	2007-04-15 16:51:20 UTC (rev 2945)
+++ branches/avidemux_2.4_branch/avidemux/guiplay.cpp	2007-04-16 17:16:15 UTC (rev 2946)
@@ -213,9 +213,12 @@
     uint32_t f;
           
 	   getFirstVideoFilter( );
-	   GUI_getFrame(curframe,&f);
+	   //GUI_getFrame(curframe,&f);
            admPreview::deferDisplay(0,0);
-           // Updated by expose ? admPreview::update(curframe,rdr_decomp_buffer);
+           UI_purge();
+           // Updated by expose ? 
+           admPreview::update(curframe);
+           UI_purge();
      	   update_status_bar();
 #ifdef HAVE_AUDIO
     if (currentaudiostream)



From mean at mail.berlios.de  Mon Apr 16 19:35:59 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 16 Apr 2007 19:35:59 +0200
Subject: [Avidemux-svn-commit] r2947 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_GTK/ADM_dialogFactory ADM_QT4/ADM_dialogFactory
Message-ID: <200704161735.l3GHZxVn020741@sheep.berlios.de>

Author: mean
Date: 2007-04-16 19:35:58 +0200 (Mon, 16 Apr 2007)
New Revision: 2947

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp
Log:
add frames to QT4, alignment enhancement for Gtk (jm)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-16 17:16:15 UTC (rev 2946)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_frame.cpp	2007-04-16 17:35:58 UTC (rev 2947)
@@ -56,20 +56,23 @@
   
   GtkWidget *label;
   GtkWidget *table;
+  GtkWidget *alignment;
   char str[200];
-  
-  
+ 
   sprintf(str,"<b>%s</b>",paramTitle);
   label = gtk_label_new (str);
   gtk_label_set_use_markup (GTK_LABEL (label), TRUE);
   gtk_widget_show(label);
   
+  alignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (alignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (alignment), 0, 0, 18, 0);
+  
    table = gtk_table_new (frameSize, 2, FALSE);
+   gtk_container_add (GTK_CONTAINER (alignment), table);
    
   gtk_table_set_col_spacings (GTK_TABLE (table), 12);
   gtk_table_set_row_spacings (GTK_TABLE (table), 6);
-  gtk_container_set_border_width (GTK_CONTAINER (table), 6);
-  
    
    gtk_widget_show(table);
    
@@ -79,7 +82,7 @@
 
    gtk_misc_set_alignment (GTK_MISC (label), 0, 1);
 
-   gtk_table_attach (GTK_TABLE (opaque), table, 0, 2, line+1, line+2,
+   gtk_table_attach (GTK_TABLE (opaque), alignment, 0, 2, line+1, line+2,
                     (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
     

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp	2007-04-16 17:16:15 UTC (rev 2946)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp	2007-04-16 17:35:58 UTC (rev 2947)
@@ -25,40 +25,81 @@
 #include <QMessageBox>
 #include <QGridLayout>
 #include <QCheckBox>
+#include <QLabel>
 
 #include "default.h"
 #include "ADM_commonUI/DIA_factory.h"
 #include "ADM_assert.h"
+
+extern const char *shortkey(const char *);
+
 diaElemFrame::diaElemFrame(const char *toggleTitle, const char *tip)
   : diaElem(ELEM_FRAME)
 {
-  
+  param=NULL;
+  paramTitle=shortkey(toggleTitle);
+  this->tip=tip;
+   nbElems=0;
+  frameSize=0;
+  setSize(2);
 }
 void diaElemFrame::swallow(diaElem *widget)
 {
- 
+   elems[nbElems]=widget;
+  frameSize+=widget->getSize();
+ // setSize(frameSize);
+  nbElems++;
+  ADM_assert(nbElems<DIA_MAX_FRAME); 
 }
 diaElemFrame::~diaElemFrame()
 {
-  
+  if(paramTitle)
+    delete paramTitle;
 }
 void diaElemFrame::setMe(void *dialog, void *opaque,uint32_t line)
 {
- 
+  
+   QGridLayout *layout=(QGridLayout*) opaque;  
+   QGridLayout *layout2;
+   
+   layout2=new QGridLayout((QWidget *)dialog);
+   myWidget=(void *)layout2; 
+
+    QLabel *text=new QLabel( (QWidget *)dialog);
+    QString string(paramTitle);
+    
+    string="<b>"+string+"</b>";
+    text->setText(string);
+ layout->addWidget(text,line,0);
+ layout->addLayout(layout2,line+1,0);
+ int  v=0;
+  for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->setMe(dialog,layout2,v); 
+    v+=elems[i]->getSize();
+  }
+  myWidget=(void *)layout2;
 }
+//*****************************
 void diaElemFrame::getMe(void)
 {
-  
+   for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->getMe(); 
+  }
 }
-void diaElemFrame::enable(uint32_t onoff)
+void diaElemFrame::finalize(void)
 {
-
+   for(int i=0;i<nbElems;i++)
+  {
+    elems[i]->finalize(); 
+  }
 }
-void diaElemFrame::finalize(void)
+void diaElemFrame::enable(uint32_t onoff)
 {
+  
 }
 
-
 //******************************************************
 
 //EOF



From mean at mail.berlios.de  Mon Apr 16 22:32:06 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 16 Apr 2007 22:32:06 +0200
Subject: [Avidemux-svn-commit] r2948 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200704162032.l3GKW6tt001842@sheep.berlios.de>

Author: mean
Date: 2007-04-16 22:32:05 +0200 (Mon, 16 Apr 2007)
New Revision: 2948

Modified:
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
fix badly placed {} for xternal audio

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-16 17:35:58 UTC (rev 2947)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-16 20:32:05 UTC (rev 2948)
@@ -2041,8 +2041,10 @@
            if(nw!=AudioNone && nw!=AudioAvi)
            {
               if( !ADM_fileExist(newtrackname))
+              {
                 GUI_Info_HIG(ADM_LOG_INFO,_("Cannot load"),_("The selected audio file does not exist.")); 
-              goto roger_and_out;
+                goto roger_and_out;
+              }
            }
             switch( nw)
             {



From mean at mail.berlios.de  Wed Apr 18 09:03:51 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 18 Apr 2007 09:03:51 +0200
Subject: [Avidemux-svn-commit] r2949 - in
	branches/avidemux_2.4_branch/avidemux: ADM_editor
	ADM_inputs/ADM_mpegdemuxer
Message-ID: <200704180703.l3I73peo009978@sheep.berlios.de>

Author: mean
Date: 2007-04-18 09:03:50 +0200 (Wed, 18 Apr 2007)
New Revision: 2949

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
Log:
support for m2ts file, uncomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -250,6 +250,7 @@
       case  DMX_MPG_H264_ES:
       case  DMX_MPG_PS :
       case  DMX_MPG_TS : 
+      case  DMX_MPG_TS2 : 
                           printf("Probe says it is mpeg\n");
                           *type = Mpeg_FileType;   return 1;
       case  DMX_MPG_MSDVR  :*type = ASF_FileType; return 1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -201,8 +201,12 @@
                 demuxer = new dmx_demuxerPS (1,&track,multi);
                 break;
     case 'T':
-                demuxer = new dmx_demuxerTS (1,&track,0);
+                demuxer = new dmx_demuxerTS (1,&track,0,DMX_MPG_TS);
                 break;
+    case 'S':
+                demuxer = new dmx_demuxerTS (1,&track,0,DMX_MPG_TS2);
+                break;
+
     default:
       ADM_assert (0);
     }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -51,7 +51,7 @@
         _pesBufferLen=0;
         _pesBufferIndex=0;
 }
-dmx_demuxerTS::dmx_demuxerTS(uint32_t nb,MPEG_TRACK *tracks,uint32_t psi)
+dmx_demuxerTS::dmx_demuxerTS(uint32_t nb,MPEG_TRACK *tracks,uint32_t psi,DMX_TYPE muxType)
 {
         consumed=0;
         parser=new fileParser();
@@ -83,7 +83,13 @@
         packMode=0;
         packLen=0;
         isPsi=psi;
-        printf("Creating mpeg TS demuxer  main Pid: %X , pes id :%x\n",myPid,tracks[0].pes);
+        switch(muxType)
+        {
+          case DMX_MPG_TS: TS_PacketSize=TS_PACKET_SIZE;break; 
+          case DMX_MPG_TS2: TS_PacketSize=TS2_PACKET_SIZE;break;
+          default: ADM_assert(0);
+        }
+        printf("Creating mpeg TS demuxer  main Pid: %X , pes id :%x, packet size=%u\n",myPid,tracks[0].pes,TS_PacketSize);
 }
 dmx_demuxerTS::~dmx_demuxerTS()
 {
@@ -453,12 +459,12 @@
         parser->getpos(&count);
         count=_size-count;
         discarded=0;
-        while(parser->read8i()!=0x47 && count>TS_PACKET_SIZE)
+        while(parser->read8i()!=0x47 && count>TS_PacketSize)
                 {
                         discarded++;
                         count--;
                 }
-        if(count<TS_PACKET_SIZE)
+        if(count<TS_PacketSize)
         {
                 printf("DmxTS: cannot sync (EOF reached) \n");
                 _lastErr=1;
@@ -469,9 +475,9 @@
         if(discarded) // We did not have a continuous sync, check 2 more packet boundaries..
         {
                 
-                parser->forward(TS_PACKET_SIZE-1);
+                parser->forward(TS_PacketSize-1);
                 byte1=parser->read8i();
-                parser->forward(TS_PACKET_SIZE-1);
+                parser->forward(TS_PacketSize-1);
                 byte2=parser->read8i();
                 parser->setpos(abs);  // The setpos/getpos is mostly free due to the parser large buffer
                 if(byte1!=0x47 || byte2!=0x47) goto _again;
@@ -488,7 +494,7 @@
         if(discarded)
                 printf("Ts: Discontinuity of %lu at %"LLX" pid:%lx\n",discarded,abs,pid);
         // Start of packet..
-        left=TS_PACKET_SIZE-3;
+        left=TS_PacketSize-3;
         if(_probeSize)
         {
                 if(abs>_probeSize)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h	2007-04-18 07:03:50 UTC (rev 2949)
@@ -3,12 +3,13 @@
 
  
 #include "dmx_demuxer.h"
-
+#include "dmx_identify.h"
 #define MAX_TS_BUFFER (2*1024*1024) // should be safe enough, 2 MB for a full compressed frame,even for HDTV
 #define MAX_TS_STREAM 50       // should be enough too :)
 
 
 #define TS_PACKET_SIZE       188
+#define TS2_PACKET_SIZE      192 // .m2ts
 #define TS_SYNC_BYTE         0x47
 #define TS_UNIT_START        0x40
 #define TS_UNIT_PAYLOAD_ONLY 0x10
@@ -37,7 +38,7 @@
                   uint32_t       myPid;           // pid: high part =0xff if private stream, 00 if not
                   uint32_t      isPsi;
                   uint8_t       *_pesBuffer;
-
+                  uint32_t      TS_PacketSize;
                   uint32_t      _pesBufferIndex; // current position in pesBuffer
                   uint64_t      _pesBufferStart;
                   uint32_t      _pesBufferLen;
@@ -67,7 +68,7 @@
                   uint8_t       updateTracker(uint32_t trackerPid,uint32_t nbData);
                   
           public:
-                           dmx_demuxerTS(uint32_t nb,MPEG_TRACK *tracks,uint32_t psi) ;
+                           dmx_demuxerTS(uint32_t nb,MPEG_TRACK *tracks,uint32_t psi,DMX_TYPE muxType) ;
                 virtual    ~dmx_demuxerTS();             
                 
                      uint8_t      open(const char *name);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -35,7 +35,7 @@
 #define MIN_DETECT 40
 #define H264MIN_DETECT 50
 
-static uint8_t probeTs(fileParser *parser);
+static uint8_t probeTs(fileParser *parser,uint32_t packetSize);
 uint8_t probeH264(fileParser *parser);
 
 DMX_TYPE dmxIdentify(const char *name)
@@ -65,12 +65,21 @@
           return DMX_MPG_MSDVR;
         }
         // Try to see if it is a TS:
-        if(probeTs(parser))
+        if(probeTs(parser,TS_PACKET_SIZE))
                 {
                         delete parser;
+                        printf("Detected as TS file\n");
                         return DMX_MPG_TS;
                 }
         parser->setpos(0);
+        if(probeTs(parser,TS2_PACKET_SIZE))
+                {
+                        delete parser;
+                        printf("Detected as TS2 file\n");
+                        return DMX_MPG_TS2;
+                }
+        parser->setpos(0);
+
         while(1)
         {
                 parser->getpos(&pos);
@@ -119,7 +128,11 @@
                 delete parser;
                 return ret;
 }
-uint8_t probeTs(fileParser *parser)
+/**
+    \fn probeTs
+    \brief Try to detect if the stream is TS type with packet size packetSize
+*/
+uint8_t probeTs(fileParser *parser,uint32_t packetSize)
 {
 uint64_t size,pos,left;
 uint32_t count,discarded;
@@ -128,27 +141,27 @@
         while(1)
         {
                 parser->getpos(&pos);
-                if(size-pos<TS_PACKET_SIZE || pos> 100*1024)
+                if(size-pos<packetSize || pos> 100*1024)
                 {
                         return 0;
                 }
                 left=size-pos;
                 count=0;
                 discarded=0;
-                while(parser->read8i()!=0x47 && left > TS_PACKET_SIZE)
+                while(parser->read8i()!=0x47 && left > packetSize)
                         {
                                 left--;
                                 discarded++;
-                                if(discarded>TS_PACKET_SIZE*3) return 0;
+                                if(discarded>packetSize*3) return 0;
                         }
-                if(left<=TS_PACKET_SIZE) return 0;
+                if(left<=packetSize) return 0;
                 parser->getpos(&pos);
 
-                parser->forward(TS_PACKET_SIZE-1);
+                parser->forward(packetSize-1);
                 if(parser->read8i()!=0x47) goto loop;
-                parser->forward(TS_PACKET_SIZE-1);
+                parser->forward(packetSize-1);
                 if(parser->read8i()!=0x47) goto loop;
-                parser->forward(TS_PACKET_SIZE-1);
+                parser->forward(packetSize-1);
                 if(parser->read8i()!=0x47) goto loop;
                 // It is a TS file:
                 return 1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.h	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.h	2007-04-18 07:03:50 UTC (rev 2949)
@@ -12,6 +12,7 @@
         DMX_MPG_H264_ES,
         DMX_MPG_PS,
         DMX_MPG_TS,
+        DMX_MPG_TS2,
         DMX_MPG_MSDVR
 }DMX_TYPE;
 DMX_TYPE dmxIdentify(const char *name);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -105,11 +105,17 @@
                                   break;
                                 }
                 case DMX_MPG_TS:
+                case DMX_MPG_TS2:
                                 {
                                 dmx_demuxerTS *dmx;
-                                dmx=new dmx_demuxerTS(nbTracks,tracks,0);
+                                dmx=new dmx_demuxerTS(nbTracks,tracks,0,mpegType);
                                 demuxer=dmx;
-                                mpegTypeChar='T';
+                                switch(mpegType)
+                                {
+                                  case DMX_MPG_TS :mpegTypeChar='T';break;
+                                  case DMX_MPG_TS2 :mpegTypeChar='S';break;
+                                  default: ADM_assert(0);
+                                }
                                 switch(tracks[0].streamType)
                                   {
                                     case ADM_STREAM_H264:       payloadType=DMX_PAYLOAD_H264;break;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -58,7 +58,7 @@
 //****************************************************************************************
 
 static uint8_t dmx_probePS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks);
-extern uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks);
+extern uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE t);
 static uint8_t dmx_probeMSDVR(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks);
 
 
@@ -91,7 +91,8 @@
                 return 1;
                 }
         case DMX_MPG_TS:
-                return dmx_probeTS(file,nbTracks,tracks);
+        case DMX_MPG_TS2:
+                return dmx_probeTS(file,nbTracks,tracks, *type);
 
         case DMX_MPG_PS:
                 return dmx_probePS(file,nbTracks,tracks);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -59,10 +59,10 @@
 }MPEG_PMT;
 //****************************************************************************************
 
-uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks);
+uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE t);
 //****************************************************************************************
-static uint8_t dmx_probeTSBruteForce(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks);
-static uint8_t dmx_probeTSPat(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks);
+static uint8_t dmx_probeTSBruteForce(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type);
+static uint8_t dmx_probeTSPat(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type);
 static uint8_t dmx_probePat(dmx_demuxerTS *demuxer, uint32_t *nbPmt,MPEG_PMT *pmts,uint32_t maxPmt);
 static uint8_t dmx_probePMT(dmx_demuxerTS *demuxer, uint32_t pmtId,MPEG_TRACK *pmts,uint32_t *cur, uint32_t max);
 
@@ -74,18 +74,18 @@
 {
   uint32_t nb;
   MPEG_TRACK *t;
-  return  dmx_probeTSPat(file, &nb,&t);
+  return  dmx_probeTSPat(file, &nb,&t,DMX_MPG_TS);
   
 }
 
-uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks)
+uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type)
 {
     // Try through PMT/PAT first
-      if(! dmx_probeTSPat(file,nbTracks,tracks))
+      if(! dmx_probeTSPat(file,nbTracks,tracks,type))
       {
         
         printf("PAT/PMT Failed, using brute force\n");
-        return dmx_probeTSBruteForce(file,nbTracks,tracks);
+        return dmx_probeTSBruteForce(file,nbTracks,tracks,type);
       }
       return 1;
 }
@@ -102,7 +102,16 @@
   uint32_t pes;
 
 }myPid;
-uint8_t dmx_probeTSBruteForce(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks)
+/**
+        \fn dmx_probeTSBruteForce
+        \brief Extract PID by scanning the file and guessing what they are
+        @param file Filename to scan
+        @param *nbTrack # of tracks found
+        @param **tracks Tracks found
+        @param type demuxer type to use (TS or TS2)
+        @return 1 on success, 0 on failure
+*/
+uint8_t dmx_probeTSBruteForce(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type)
 {
 
   // Brute force indexing
@@ -118,7 +127,7 @@
     dummy[0].pid=0x1; // should no be in use
     dummy[0].pes=0xE0;
 
-        dmx_demuxerTS demuxer(TS_ALL_PID,dummy,0);
+        dmx_demuxerTS demuxer(TS_ALL_PID,dummy,0,type);
         if(!demuxer.open(file))
         {
           return 0;
@@ -251,7 +260,7 @@
       @param **tracks : contains info about the tracks found (out)
 
 */
-uint8_t dmx_probeTSPat(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks)
+uint8_t dmx_probeTSPat(const char *file, uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type)
 {
 MPEG_TRACK dummy[TS_ALL_PID];
 fileParser *parser;
@@ -264,7 +273,7 @@
     dummy[0].pid=0x00; // should no be in use
     dummy[0].pes=0xE0;
 
-        dmx_demuxerTS demuxer(1,dummy,1);
+        dmx_demuxerTS demuxer(1,dummy,1,type);
         if(!demuxer.open(file))
         {
           return 0;
@@ -364,7 +373,7 @@
                                     uint32_t *leftbyte,uint32_t *payloadSize)
 {
   
-  uint8_t packet[TS_PACKET_SIZE];
+  uint8_t packet[TS_PACKET_SIZE*2];
   uint32_t tableId;
   uint32_t misc;
   uint32_t sectionLength;
@@ -485,6 +494,7 @@
                   pmts[*nbPmt].tid=parser->read16i()&0x1FFF;
                   aprintf(" [PAT]Program Number :%03x\n",pmts[*nbPmt].programNumber);
                   aprintf(" [PAT]PID for this   :%03x\n",pmts[*nbPmt].tid);
+                  aprintf(" toScan :%u left :%u\n",toScan,left);
                   if((*nbPmt)<maxPmt)
                       (*nbPmt)++;
                   left-=4;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2007-04-16 20:32:05 UTC (rev 2948)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2007-04-18 07:03:50 UTC (rev 2949)
@@ -319,10 +319,19 @@
                                         MPEG_TRACK track;
                                         track.pid=vTsId;
                                         track.pes=vPid;
-                                        demuxer=new dmx_demuxerTS(1,&track,0);
+                                        demuxer=new dmx_demuxerTS(1,&track,0,DMX_MPG_TS);
                                         break;
 
                                 }
+                        case 'S' :
+                              {
+                                      MPEG_TRACK track;
+                                      track.pid=vTsId;
+                                      track.pes=vPid;
+                                      demuxer=new dmx_demuxerTS(1,&track,0,DMX_MPG_TS2);
+                                      break;
+
+                              }
                         case 'P':
                                 {
                                         MPEG_TRACK track;



From mean at mail.berlios.de  Wed Apr 18 20:27:42 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 18 Apr 2007 20:27:42 +0200
Subject: [Avidemux-svn-commit] r2950 - in
	branches/avidemux_2.4_branch/avidemux: ADM_editor
	ADM_inputs/ADM_mpegdemuxer
Message-ID: <200704181827.l3IIRgmr016888@sheep.berlios.de>

Author: mean
Date: 2007-04-18 20:27:41 +0200 (Wed, 18 Apr 2007)
New Revision: 2950

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
Log:
support for m2ts

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-18 07:03:50 UTC (rev 2949)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-18 18:27:41 UTC (rev 2950)
@@ -1494,7 +1494,7 @@
                 }
 
           
-                if(type==DMX_MPG_PS || type==DMX_MPG_TS)
+                if(type==DMX_MPG_PS || type==DMX_MPG_TS || type==DMX_MPG_TS2)
                 {
                        if(nbTrack>2)
 		       if(autoidx)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp	2007-04-18 07:03:50 UTC (rev 2949)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp	2007-04-18 18:27:41 UTC (rev 2950)
@@ -339,8 +339,17 @@
                         _oldPesStart=_pesBufferStart;
                         _oldPesLen=_pesBufferLen;
                         _pesBufferStart=abs;
+                        
+                        parser->read32(left,_pesBuffer);
+                        // FIXME HACK
+                        if(TS_PacketSize==192 && left >4)
+                          {
+                            left-=4; // Remove timestamp of m2ts packet
+                          }
+                       // FIXME HACK
                         _pesBufferLen=left;
-                        parser->read32(left,_pesBuffer);
+                        
+                           
                         _pesPTS=ADM_NO_PTS;
                         _pesDTS=ADM_NO_PTS;
                         // If we are in pack mode, cut padding bits
@@ -376,12 +385,19 @@
                         goto _againBranch;
                 left-=consumed;
                 _pesBufferStart=abs;
-                _pesBufferLen=left;
 
+
                 _pesPTS=ADM_NO_PTS;
                 _pesDTS=ADM_NO_PTS;
 
                 parser->read32(left,_pesBuffer);
+                 // FIXME HACK
+                if(TS_PacketSize==192 && left >4)
+                  {
+                    left-=4; // Remove timestamp of m2ts packet
+                  }
+                _pesBufferLen=left;
+                 // FIXME HACK
                 return 1;
         }
 
@@ -421,12 +437,18 @@
                 _oldPesLen=_pesBufferLen;
 
                 _pesBufferStart=abs;
-                _pesBufferLen=left;
+                
 
                 _pesPTS=pts;
                 _pesDTS=dts;
 
                 parser->read32(left,_pesBuffer);
+                  // FIXME HACK
+                if(TS_PacketSize==192 && left >4)
+                  {
+                    left-=4; // Remove timestamp of m2ts packet
+                  }
+                _pesBufferLen=left;
                 if(packMode)
                 {
                         if(packLen<left) _pesBufferLen=packLen;
@@ -542,7 +564,6 @@
                 left-=val;
         }
         // Ok now we got the raw data packet
-        
         *oleft=left;
         *opid=pid;
         *occ=cc;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-18 07:03:50 UTC (rev 2949)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-18 18:27:41 UTC (rev 2950)
@@ -80,8 +80,10 @@
 
 uint8_t dmx_probeTS(const char *file,  uint32_t *nbTracks,MPEG_TRACK **tracks,DMX_TYPE type)
 {
+  
     // Try through PMT/PAT first
-      if(! dmx_probeTSPat(file,nbTracks,tracks,type))
+      if(type==DMX_MPG_TS2 || !dmx_probeTSPat(file,nbTracks,tracks,type))
+      //if( !dmx_probeTSPat(file,nbTracks,tracks,type))
       {
         
         printf("PAT/PMT Failed, using brute force\n");
@@ -210,7 +212,7 @@
 
         if(!id) continue;
 
-        if((code>=0xC0 && code <= 0xC9) || code==0xbd)
+        if((code>=0xC0 && code <= 0xC9) || ((code==0xbd)&& (type==DMX_MPG_TS)) || ((code==0xfd)&& (type==DMX_MPG_TS2)))
         {
             demuxer.changePid(id,code);
             demuxer.setPos(0,0);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2007-04-18 07:03:50 UTC (rev 2949)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp	2007-04-18 18:27:41 UTC (rev 2950)
@@ -548,7 +548,7 @@
                                 return 0;
                         }
                         //Dump();
-                        if(type=='P' || type=='T' || type=='M')
+                        if(type!='E')
                         {
                                 // We have potentially some audio
                                 // Try to get it



From mean at mail.berlios.de  Wed Apr 18 20:28:14 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 18 Apr 2007 20:28:14 +0200
Subject: [Avidemux-svn-commit] r2951 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200704181828.l3IISEUn016933@sheep.berlios.de>

Author: mean
Date: 2007-04-18 20:28:14 +0200 (Wed, 18 Apr 2007)
New Revision: 2951

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
fix local downmixing

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-18 18:27:41 UTC (rev 2950)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-04-18 18:28:14 UTC (rev 2951)
@@ -200,7 +200,7 @@
                              ,{2,      _("Prologic"),NULL}
                               ,{3,      _("Prologic II"),NULL}
          };
-        diaElemMenu menuMixer(&useMaster,_("Local Playback Downmixing"), sizeof(mixerEntries)/sizeof(diaMenuEntry),mixerEntries,"");
+        diaElemMenu menuMixer(&downmix,_("Local Playback Downmixing"), sizeof(mixerEntries)/sizeof(diaMenuEntry),mixerEntries,"");
 #undef MKADID        
 #define MKADID(x) {DEVICE_##x,_(#x),NULL}
         diaMenuEntry audioEntries[]=



From mean at mail.berlios.de  Thu Apr 19 19:24:05 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 19 Apr 2007 19:24:05 +0200
Subject: [Avidemux-svn-commit] r2952 -
	branches/avidemux_2.4_branch/avidemux/xpm
Message-ID: <200704191724.l3JHO2Xf013574@sheep.berlios.de>

Author: mean
Date: 2007-04-19 19:24:01 +0200 (Thu, 19 Apr 2007)
New Revision: 2952

Modified:
   branches/avidemux_2.4_branch/avidemux/xpm/adm.ico
   branches/avidemux_2.4_branch/avidemux/xpm/adm.o
Log:
grunster: Updated icon(s) for win32

Modified: branches/avidemux_2.4_branch/avidemux/xpm/adm.ico
===================================================================
(Binary files differ)

Modified: branches/avidemux_2.4_branch/avidemux/xpm/adm.o
===================================================================
(Binary files differ)



From mean at mail.berlios.de  Thu Apr 19 20:07:46 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 19 Apr 2007 20:07:46 +0200
Subject: [Avidemux-svn-commit] r2953 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer
Message-ID: <200704191807.l3JI7kQM001243@sheep.berlios.de>

Author: mean
Date: 2007-04-19 20:07:45 +0200 (Thu, 19 Apr 2007)
New Revision: 2953

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
Log:
dont loop if programInfo exceeds one packet

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-19 17:24:01 UTC (rev 2952)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-04-19 18:07:45 UTC (rev 2953)
@@ -82,7 +82,7 @@
 {
   
     // Try through PMT/PAT first
-      if(type==DMX_MPG_TS2 || !dmx_probeTSPat(file,nbTracks,tracks,type))
+      if( type==DMX_MPG_TS2 || !dmx_probeTSPat(file,nbTracks,tracks,type))
       //if( !dmx_probeTSPat(file,nbTracks,tracks,type))
       {
         
@@ -545,6 +545,11 @@
                aprintf("[PMT]PCR for it    :x%x\n",parser->read16i()&0x1FFF);
                programInfo=parser->read16i() & 0x0FFF;
                aprintf("[PMT]Program Info  :%d\n",programInfo);
+               if( (programInfo+2 > left) || (programInfo+2>toScan))
+               {
+                 printf("Program Info too big :%u\n",programInfo);
+                 return 0;
+               }
                parser->forward(programInfo);
                toScan-=(2+programInfo);
                left-=(2+programInfo);



From mean at mail.berlios.de  Fri Apr 20 20:58:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 20 Apr 2007 20:58:30 +0200
Subject: [Avidemux-svn-commit] r2954 - branches/avidemux_2.4_branch/po
Message-ID: <200704201858.l3KIwUcQ007636@sheep.berlios.de>

Author: mean
Date: 2007-04-20 20:58:28 +0200 (Fri, 20 Apr 2007)
New Revision: 2954

Added:
   branches/avidemux_2.4_branch/po/jp.po
Modified:
   branches/avidemux_2.4_branch/po/LINGUAS
   branches/avidemux_2.4_branch/po/Makefile.am
Log:
jp translation from testuro

Modified: branches/avidemux_2.4_branch/po/LINGUAS
===================================================================
--- branches/avidemux_2.4_branch/po/LINGUAS	2007-04-19 18:07:45 UTC (rev 2953)
+++ branches/avidemux_2.4_branch/po/LINGUAS	2007-04-20 18:58:28 UTC (rev 2954)
@@ -3,3 +3,4 @@
 de
 ru
 cs
+jp

Modified: branches/avidemux_2.4_branch/po/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/po/Makefile.am	2007-04-19 18:07:45 UTC (rev 2953)
+++ branches/avidemux_2.4_branch/po/Makefile.am	2007-04-20 18:58:28 UTC (rev 2954)
@@ -1,3 +1,3 @@
-POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po
-EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po
+POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po jp.po
+EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po jp.po
 

Added: branches/avidemux_2.4_branch/po/jp.po
===================================================================
--- branches/avidemux_2.4_branch/po/jp.po	2007-04-19 18:07:45 UTC (rev 2953)
+++ branches/avidemux_2.4_branch/po/jp.po	2007-04-20 18:58:28 UTC (rev 2954)
@@ -0,0 +1,2890 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: ja\n"
+"POT-Creation-Date: 2007-03-24 15:57+0100\n"
+"PO-Revision-Date: 2007-04-20 18:28+0900\n"
+"Last-Translator: tetsuro\n"
+"Language-Team: Japan\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=utf-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: Japanese\n"
+"X-Poedit-Country: JAPAN\n"
+"X-Poedit-SourceCharset: utf-8\n"
+
+msgid ""
+"\n"
+" Reuse the existing log-file ?"
+msgstr ""
+"\n"
+" ????????????????? ?"
+
+msgid "  Job Name  "
+msgstr "  ????  "
+
+msgid " Error X:"
+msgstr " ?? X:"
+
+msgid " Error Y:"
+msgstr " ?? Y:"
+
+msgid " Height "
+msgstr "??"
+
+msgid " No"
+msgstr "???"
+
+msgid " Text:"
+msgstr "????:"
+
+msgid " Width "
+msgstr "?"
+
+msgid " Yes"
+msgstr "??"
+
+msgid "\"%s\" does not exist."
+msgstr "\"%s\" ??????."
+
+msgid "# of frames"
+msgstr "?????"
+
+msgid "...are reduced by (%):"
+msgstr "...? (%) ?????:"
+
+msgid "/dev/null"
+msgstr "NUL"
+
+msgid "0 - None"
+msgstr "0 - ??"
+
+msgid "0 - Off"
+msgstr "0 - ??"
+
+msgid ""
+"0 = default from core (let XviD decide), else overflow payback percent per "
+"frame"
+msgstr ""
+"0 = ??????????(XviD??????)???? = ???????????"
+"?????????"
+
+msgid "1  - Extremely Low (Fastest)"
+msgstr "1  - ????? (??)"
+
+msgid "1 - Mode decision"
+msgstr "1 - ?????"
+
+msgid "1 - Very low"
+msgstr "1 - ?????"
+
+msgid "16 round up"
+msgstr "16????"
+
+msgid "2  - Very Low"
+msgstr "2  - ?????"
+
+msgid "2 - Limited search"
+msgstr "2 - ????"
+
+msgid "2 - Low"
+msgstr "2 - ??"
+
+msgid "3  - Low"
+msgstr "3  - ??"
+
+msgid "3 - Medium"
+msgstr "3 - ????"
+
+msgid "3 - Medium search"
+msgstr "3 - ????"
+
+msgid "4  - Medium"
+msgstr "4  - ????"
+
+msgid "4 - High"
+msgstr "4 - ??"
+
+msgid "4 - Wide search"
+msgstr "4 - ?????"
+
+msgid "4 field check"
+msgstr "4?????????"
+
+msgid "4 field check (no average)"
+msgstr "4?????????(????)"
+
+msgid "4x4 Intra search"
+msgstr "4x4 ??????"
+
+msgid "4x4, 4x8 and 8x4 P-frame search"
+msgstr "4x4, 4x8 ? 8x4 P-??????"
+
+msgid "5  - High (Default)"
+msgstr "5  - ?? (?????)"
+
+msgid "5 - Very high"
+msgstr "5 - ?????"
+
+msgid "5 channels"
+msgstr "5 ?????"
+
+msgid "5 field check"
+msgstr "5?????????"
+
+msgid "5 field check (no average)"
+msgstr "5?????????(????)"
+
+msgid "6  - Very High"
+msgstr "6  - ?????"
+
+msgid "6 - Ultra high"
+msgstr "6 - ???"
+
+msgid "6B - Very High (RDO on Bframes)"
+msgstr "6B - ????? (RDO on Bframes)"
+
+msgid "7 - Ultra High"
+msgstr "7 - ???"
+
+msgid "7B - Ultra High (RDO on Bframes)"
+msgstr "7B - ??? (RDO on Bframes)"
+
+msgid "8x8 Intra search"
+msgstr "8x8 ??????"
+
+msgid "8x8 Transform"
+msgstr "8x8 ??"
+
+msgid "8x8, 8x16 and 16x8 B-frame search"
+msgstr "8x8, 8x16 ? 16x8 B-??????"
+
+msgid "8x8, 8x16 and 16x8 P-frame search"
+msgstr "8x8, 8x16 ? 16x8 P-??????"
+
+msgid "<b >Active Filters</b>"
+msgstr "<b >???????</b>"
+
+msgid "<b><big>Encoding files</big></b>"
+msgstr "<b><big>??????????????</big></b>"
+
+msgid "<b>Aspect Ratio</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Aud Codec:</b>"
+msgstr "<b>???????:</b>"
+
+msgid "<b>Audio Bitrate</b>"
+msgstr "<b>????????</b>"
+
+msgid "<b>Audio Size:</b>"
+msgstr "<b>?????:</b>"
+
+msgid "<b>Audio</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Available Filters</b>"
+msgstr "<b>?????????</b>"
+
+msgid "<b>B-Frames</b>"
+msgstr "<b>B-????</b>"
+
+msgid "<b>Bitmap</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Bitrate :</b>"
+msgstr "<b>?????? :</b>"
+
+msgid "<b>Bitrate:</b>"
+msgstr "<b>??????:</b>"
+
+msgid "<b>Bitrate</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Channel Mode:</b>"
+msgstr "<b>????????:</b>"
+
+msgid "<b>Color Correction Matrix</b>"
+msgstr "<b>?????????</b>"
+
+msgid "<b>Container:</b>"
+msgstr "<b>????:</b>"
+
+msgid "<b>Encoding mode </b>"
+msgstr "<b>????? ??? </b>"
+
+msgid "<b>Extra Properties</b>"
+msgstr "<b>???????</b>"
+
+msgid "<b>Files</b>"
+msgstr "<b>????</b>"
+
+msgid "<b>Format</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Fps convert</b>"
+msgstr "<b>Fps ??</b>"
+
+msgid "<b>Frame:</b>"
+msgstr "<b>????:</b>"
+
+msgid "<b>Gain</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Gamma</b>"
+msgstr "<b>???</b>"
+
+msgid "<b>General</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Hue:</b>"
+msgstr "<b>??:</b>"
+
+msgid "<b>Input file</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Interlacing</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Matrices</b>"
+msgstr "<b>??????</b>"
+
+msgid ""
+"<b>Matrix Warning :</b>\n"
+"all above values are normalized to 256!"
+msgstr ""
+"<b>???????? :</b>\n"
+"???????256????????!"
+
+msgid "<b>Misc. Options</b>"
+msgstr "<b>??, ?????</b>"
+
+msgid "<b>Misc</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Mixer</b>"
+msgstr "<b>????</b>"
+
+msgid "<b>Mode :</b>"
+msgstr "<b>??? :</b>"
+
+msgid "<b>Mode:</b>"
+msgstr "<b>???:</b>"
+
+msgid "<b>Mode</b>"
+msgstr "<b>???</b>"
+
+msgid "<b>More Rate Settings</b>"
+msgstr "<b>????????</b>"
+
+msgid "<b>Motion Estimation</b>"
+msgstr "<b>????</b>"
+
+msgid "<b>Partition Macroblocks</b>"
+msgstr "<b>?????????</b>"
+
+msgid "<b>Phasis:</b>"
+msgstr "<b>????:</b>"
+
+msgid "<b>Quality :</b>"
+msgstr "<b>?? :</b>"
+
+msgid "<b>Quality:</b>"
+msgstr "<b>??:</b>"
+
+msgid "<b>Quantization Limits</b>"
+msgstr "<b>?????</b>"
+
+msgid "<b>Quantization Matrices</b>"
+msgstr "<b>?????????</b>"
+
+msgid "<b>Quantizer:</b>"
+msgstr "<b>????:</b>"
+
+msgid "<b>Quantizers</b>"
+msgstr "<b>????</b>"
+
+msgid "<b>RateControl</b>"
+msgstr "<b>?????</b>"
+
+msgid "<b>Resampling</b>"
+msgstr "<b>?????</b>"
+
+msgid "<b>Result</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Sample Aspect Ratio (A/R)</b>"
+msgstr "<b>?????????? (A/R)</b>"
+
+msgid "<b>Saturation:</b>"
+msgstr "<b>???:</b>"
+
+msgid "<b>Scene change Treshold</b>"
+msgstr "<b>???????</b>"
+
+msgid "<b>Selection</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Settings</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>Target</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>TimeCode</b>"
+msgstr "<b>??????</b>"
+
+msgid "<b>Total Size:</b>"
+msgstr "<b>?????:</b>"
+
+msgid "<b>Vid Bitrate:</b>"
+msgstr "<b>????????:</b>"
+
+msgid "<b>Vid codec:</b>"
+msgstr "<b>???????:</b>"
+
+msgid "<b>Video Buffer Verifier</b>"
+msgstr "<b>????????</b>"
+
+msgid "<b>Video Size:</b>"
+msgstr "<b>?????:</b>"
+
+msgid "<b>Video</b>"
+msgstr "<b>??</b>"
+
+msgid "<b>frame2</b>"
+msgstr "<b>????2</b>"
+
+msgid "<i>Strength</i>"
+msgstr "<i>??</i>"
+
+msgid "<i>Threshold</i>"
+msgstr "<i>??</i>"
+
+msgid "A value of 20 will give 20% more bits to every I-frame"
+msgstr "20????I-?????20%??????????"
+
+msgid "AP type"
+msgstr "AP???"
+
+msgid "ASharp by MarcFD"
+msgstr "MarcFD???ASharp"
+
+msgid "AVI _Muxer Options"
+msgstr "AVI????????(_M)"
+
+msgid "A_dd to Joblist..."
+msgstr "?????????(_D)"
+
+msgid "A_uto"
+msgstr "??(_U)"
+
+msgid "Abort"
+msgstr "??"
+
+msgid "Aborting"
+msgstr "??"
+
+msgid "Accept non standard audio frequency for DVD"
+msgstr "DVD?????????????????"
+
+msgid "Adaptative DCT"
+msgstr "???DCT"
+
+msgid "Advanced Simple Profile"
+msgstr "????????????"
+
+msgid ""
+"Allow B-frames to make references non-linearly to another B-frame (instead "
+"of creating a duplicate copy)"
+msgstr ""
+"(???????????)B-???????B-?????????????????"
+"??"
+
+msgid ""
+"Allowed variance of average bitrate. Lower values mean less variance. Higher "
+"values mean more variance."
+msgstr ""
+"???????????????. ??????????????????????"
+"??."
+
+msgid ""
+"Allowed variance of average quantizer or quality. Lower values mean less "
+"variance. Higher values mean more variance. Note that 0 means constant "
+"quality while 1 means constant fluctuation. Recommended 0.6."
+msgstr ""
+"??????????????????. ???????????????????"
+"?????. 0???????1?????????????????. 0.6???."
+
+msgid "Area Combing Threshold"
+msgstr "?????????"
+
+msgid "Artefact Protection threshold "
+msgstr "??????"
+
+msgid "As input"
+msgstr "?????"
+
+msgid "Aspect Ratio"
+msgstr "??????"
+
+msgid "Audio"
+msgstr "??"
+
+msgid "Audio Encoder Settings"
+msgstr "?????????"
+
+msgid "Audio Processing"
+msgstr "????"
+
+msgid "Audio duration  "
+msgstr "????"
+
+msgid "Audio filters"
+msgstr "??????"
+
+msgid "Audio output"
+msgstr "????"
+
+msgid "Audio settings"
+msgstr "?????"
+
+msgid "Audio size (MB):"
+msgstr "????? (MB):"
+
+msgid "Audio source"
+msgstr "?????"
+
+msgid "Audio track is not suitable"
+msgstr "????????????????"
+
+msgid "Audio/video file information"
+msgstr "??/????????"
+
+msgid "Audio/video time shift (ms)"
+msgstr "??/?????? (ms)"
+
+msgid "AudioCodec"
+msgstr "???????"
+
+msgid "Auto split"
+msgstr "????"
+
+msgid "AutoCrop"
+msgstr "??????"
+
+msgid "AutoGain"
+msgstr "????"
+
+msgid "AutoWhite"
+msgstr "??????"
+
+msgid "Automatic ( max is -3dB)"
+msgstr "?? ( ??? -3dB)"
+
+msgid "Automatically"
+msgstr "??"
+
+msgid "Automatically build VBR map"
+msgstr "????VBR????????"
+
+msgid "Automatically index mpeg files"
+msgstr "????MPEG????????????????"
+
+msgid "Automatically rebuild index"
+msgstr "????????????????"
+
+msgid "Automatically remove packed bitstream"
+msgstr "?????????????????????"
+
+msgid "Automatically swap A and B if A>B"
+msgstr "A > B ?????A?B?????"
+
+msgid "Average Br (kb/s)"
+msgstr "????????(kb/s)"
+
+msgid "Avi Muxer Option"
+msgstr "AVI????????"
+
+msgid "B-Frame Direct Mode:  "
+msgstr "B-?????????:"
+
+msgid "B-frame quantizer - Min:"
+msgstr "B-???????? - ??:"
+
+msgid "B-frame reduction (%)"
+msgstr "B-?????? (%)"
+
+msgid "BackGround Image :"
+msgstr "???? :"
+
+msgid "Bias"
+msgstr "????"
+
+msgid "Bidirectional ME"
+msgstr "???ME"
+
+msgid "Bitrate"
+msgstr "??????"
+
+msgid "Bitrate "
+msgstr "??????"
+
+msgid "Bitrate (kb/s)"
+msgstr "?????? (kb/s)"
+
+msgid "Bitrate (kb/s):"
+msgstr "?????? (kb/s):"
+
+msgid "Bitrate Calculator"
+msgstr "????????"
+
+msgid "Bitrate Histogram"
+msgstr "????????????"
+
+msgid "Bitrate Variance"
+msgstr "????????"
+
+msgid "Bitrate out of range"
+msgstr "??????????"
+
+msgid "Bitrate variability (%)"
+msgstr "????????? (%)"
+
+msgid "Bitrate/size calculator"
+msgstr "??????/?????"
+
+msgid "Bits per pixel:"
+msgstr "???/????:"
+
+msgid "Block Adaptative :"
+msgstr "??????? :"
+
+msgid "Bob, Skip spatial temporal check"
+msgstr "Bob, ??-???????????"
+
+msgid "Bob, T+S check"
+msgstr "Bob, T+S????"
+
+msgid "Bottom"
+msgstr "???"
+
+msgid "Bottom Field First"
+msgstr "??????????"
+
+msgid "Bottom Field first"
+msgstr "??????????"
+
+msgid "Bottom field (keep top)"
+msgstr "????????(??????)"
+
+msgid "Bottom:"
+msgstr "?:"
+
+msgid "Brigh_tness:"
+msgstr "???(_T):"
+
+msgid "Brightness"
+msgstr "???"
+
+msgid "Buffer Size"
+msgstr "???????"
+
+msgid "CBR (bitrate based)"
+msgstr "CBR (??????????)"
+
+msgid "C_heck Frames (slow)"
+msgstr "?????? (??)"
+
+msgid "C_hroma motion"
+msgstr "????(_H)"
+
+msgid "C_hroma optimizer"
+msgstr "?????(_H)"
+
+msgid "Ca_rtoon mode"
+msgstr "?????(_R)"
+
+msgid "Calculate referencing individually based on each partition"
+msgstr "??????????????????"
+
+msgid "Calculator"
+msgstr "??"
+
+msgid "Cannot decode frame"
+msgstr "??????????????"
+
+msgid "Cannot decode keyframe."
+msgstr "????????????????"
+
+msgid "Cannot decode next frame."
+msgstr "????????????????"
+
+msgid "Cannot decode the frame."
+msgstr "??????????????"
+
+msgid "Cannot identify subtitle format"
+msgstr "????????????"
+
+msgid "Cannot initialize the audio stream"
+msgstr "????????????????"
+
+msgid "Cannot initialize the video stream"
+msgstr "????????????????"
+
+msgid "Cannot initiate save"
+msgstr "??????????"
+
+msgid "Cannot open \"%s\" for writing."
+msgstr "????? \"%s\" ??????."
+
+msgid "Cannot open \"%s\"."
+msgstr "\"%s\" ??????."
+
+msgid "Cannot open AMR codec."
+msgstr "AMR???????????."
+
+msgid "Cannot open WMA2 codec."
+msgstr "WMA2???????????."
+
+msgid "Cannot open directory as a file"
+msgstr "?????????????????"
+
+msgid "Cannot write .idx"
+msgstr ".idx???????"
+
+msgid "Cannot write .sub"
+msgstr ".sub???????"
+
+msgid "Cannot write the file"
+msgstr "???????????"
+
+msgid "Channels  "
+msgstr "?????"
+
+msgid "Chapter 1"
+msgstr "?????1"
+
+msgid "Chapter 2"
+msgstr "?????2"
+
+msgid "Chapter 3"
+msgstr "?????3"
+
+msgid "Chapter 4"
+msgstr "?????4"
+
+msgid "Chapter 5"
+msgstr "?????5"
+
+msgid "Chapter 6"
+msgstr "?????6"
+
+msgid "Chroma"
+msgstr "??"
+
+msgid "Chroma ME"
+msgstr "?? ME"
+
+msgid "Chroma Noise Reduction 2"
+msgstr "??????? 2"
+
+msgid "Chroma QP Offset"
+msgstr "??QP?????"
+
+msgid "Chroma U"
+msgstr "?? U"
+
+msgid "Chroma U :"
+msgstr "?? U :"
+
+msgid "Chroma V"
+msgstr "?? V"
+
+msgid "Chroma V :"
+msgstr "?? V :"
+
+msgid "Chrominance:"
+msgstr "??:"
+
+msgid "Codec "
+msgstr "?????"
+
+msgid "Codec 4CC"
+msgstr "?????4CC"
+
+msgid "Codec Error"
+msgstr "????????"
+
+msgid "ColorYuv (From avisynth)"
+msgstr "ColorYuv (avisynth??)"
+
+msgid "Colors"
+msgstr "?"
+
+msgid "Combed Treshold"
+msgstr "Combed ??"
+
+msgid "Configure"
+msgstr "??"
+
+msgid "Configure Codec"
+msgstr "????????"
+
+msgid "Configure audio encoder"
+msgstr "??????????"
+
+msgid "Configure video encoder"
+msgstr "??????????"
+
+msgid "Constant Bitrate"
+msgstr "????????"
+
+msgid "Constant Bitrate (kbps)"
+msgstr "???????? (kbps)"
+
+msgid "Constant Quality"
+msgstr "????"
+
+msgid "Constant Quantizer"
+msgstr "??????"
+
+msgid ""
+"Constant Quantizer - Each frame will the same compression. Low numbers equal "
+"higher quality while high numbers equal lower quality"
+msgstr ""
+"?????? - ??????????. ????????????????????"
+"???"
+
+msgid "Constant quantizer - each frame will get the same compression"
+msgstr "?????? - ?????????????"
+
+msgid "Contrast"
+msgstr "??????"
+
+msgid "Copy"
+msgstr "???"
+
+msgid "Could not initialize audio"
+msgstr "???????????"
+
+msgid "Could not initialize video"
+msgstr "???????????"
+
+msgid "Could not open subtitle file"
+msgstr "????????????"
+
+msgid "Could not open the file"
+msgstr "??????????"
+
+msgid "Create openDML file"
+msgstr "openDML ?????????"
+
+msgid "Crop Bottom:"
+msgstr "?????:"
+
+msgid "Crop Left :"
+msgstr "?????:"
+
+msgid "Crop Right:"
+msgstr "?????:"
+
+msgid "Crop Settings"
+msgstr "???????"
+
+msgid "Crop Top:"
+msgstr "?????:"
+
+msgid "Cu_t"
+msgstr "???(_T)"
+
+msgid "Current frame"
+msgstr "???????"
+
+msgid "Current time"
+msgstr "?????"
+
+msgid "Curve compression"
+msgstr "????"
+
+msgid "Custom"
+msgstr "????"
+
+msgid "Custom matrix"
+msgstr "??????????"
+
+msgid "Cycle"
+msgstr "????"
+
+msgid "DVD resolution [Ctrl-1]"
+msgstr "DVD ??? [Ctrl-1]"
+
+msgid "Deblocking Filter :"
+msgstr "????? ???? :"
+
+msgid "Default"
+msgstr "?????"
+
+msgid "Default mpeg"
+msgstr "?????MPEG"
+
+msgid ""
+"Define how many pixels are analysised. The higher the range the more "
+"accurate the analysis but the slower the encoding time"
+msgstr ""
+"?????????????. ????????????????????????"
+"?????"
+
+msgid ""
+"Define how much the bitrate can fluctuate over the entire video. 0% results "
+"in a constant bitrate stream, while 100% results in a pure quality based "
+"bitrate stream"
+msgstr ""
+"??????????????????. 0%?????????????????"
+"??100%??????????????????????????"
+
+msgid ""
+"Define how much the quantizer rate can change between two consecutive frames"
+msgstr "????????????????????????"
+
+msgid "Define the level for when deblocking is applied"
+msgstr "??????????????????????"
+
+msgid "Delay in ms"
+msgstr "?? (ms)"
+
+msgid "Delete All Jobs"
+msgstr "???????"
+
+msgid "Delete Job"
+msgstr "??????"
+
+msgid "Delete job"
+msgstr "??????"
+
+msgid "Denoise"
+msgstr "?????"
+
+msgid "Deringing"
+msgstr "????"
+
+msgid "Destination"
+msgstr "???"
+
+msgid "Detected Audio :"
+msgstr "??????? :"
+
+msgid "Diamond search"
+msgstr "????????"
+
+msgid "Disable NUV audio sync"
+msgstr "NuppelVideo ??????????"
+
+msgid "Discard Closer"
+msgstr "???????"
+
+msgid "Discard longer dupe (anim??s)"
+msgstr "??dupe???(???)"
+
+msgid "Display Stats"
+msgstr "????"
+
+msgid "Display _Output"
+msgstr "?????(_O)"
+
+msgid "Display all alerts"
+msgstr "???????????"
+
+msgid "Display only error alerts"
+msgstr "????????????"
+
+msgid "Do you want to save an index ?"
+msgstr "????????????? ?"
+
+msgid "Dolby Prologic"
+msgstr "??????????"
+
+msgid "Dolby Prologic 2"
+msgstr "??????????2"
+
+msgid "Done"
+msgstr "??"
+
+msgid "Done : %02d%%"
+msgstr "?? : %02d%%"
+
+msgid "Double nb of frames (slow motion)"
+msgstr "???????????(????????)"
+
+msgid "Double nb of frames and fps"
+msgstr "??????FPS??????"
+
+msgid "Dual pass"
+msgstr "????"
+
+msgid "Dual pass (MBytes)"
+msgstr "???? (MBytes)"
+
+msgid "Duration:"
+msgstr "????:"
+
+msgid "Edit Custom Matrix"
+msgstr "?????????????"
+
+msgid "Edit a loaded custom quantization matrix file"
+msgstr "???????????????????????????"
+
+msgid "Enable DCT Intra block search to improve quality"
+msgstr "DCT??????????????????????"
+
+msgid ""
+"Enable a better prediction of AC component. Turns on Lumi masking - applies "
+"more compression to dark/light areas that the eye cannot notice easily"
+msgstr ""
+"AC????????????????????. Lumi??????? - ??????"
+"??????????????????"
+
+msgid "Enable in-loop deblocking to filter the video"
+msgstr "????????????????????????"
+
+msgid "Enable time shift"
+msgstr "??????????"
+
+msgid "Enables Divx like packed vop, DO NOT SET, it is ugly"
+msgstr "????vop????Divx??????. ??????????????"
+
+msgid "Enables a chroma optimizer prefilter"
+msgstr "?????????????????"
+
+msgid "Enables fast 1st pass encoding"
+msgstr "????????????????????"
+
+msgid ""
+"Enables interlaced frame support - use only if your source contains "
+"interlacing artifacts (i.e. fields instead of progressive frames)"
+msgstr ""
+"???????????????????? - ???????????(?????"
+"???????????????????)??????????"
+
+msgid "Enables special motion estimation features for cartoons/anime"
+msgstr "??/?????????????????????"
+
+msgid "Enables weighting of B-frames to help fades"
+msgstr "B-????????????????????????"
+
+msgid "Encode in black & white"
+msgstr "????????"
+
+msgid "Encode interlaced"
+msgstr "??????????????"
+
+msgid "Encoding "
+msgstr "?????"
+
+msgid "Encoding Mode:"
+msgstr "????????:"
+
+msgid "Encoding Type"
+msgstr "????????"
+
+msgid "Encoding Type:"
+msgstr "????? ???:"
+
+msgid "Encoding mode"
+msgstr "????????"
+
+msgid "Encoding type:"
+msgstr "????????:"
+
+msgid "Enforce a maximum quantizer level"
+msgstr "????????????"
+
+msgid "Enforce a minimum quantizer level"
+msgstr "????????????"
+
+msgid ""
+"Enforce the size of a decoded pixel decoded to a certain value. Leave this "
+"at 1:1 for non-anamorphic video"
+msgstr ""
+"??????????????????????????. ???????????"
+"??1:1?????????"
+
+msgid "Entry input for target file size or bitrate"
+msgstr "??????????????????????????"
+
+msgid "Error Loading"
+msgstr "??????"
+
+msgid "Error Writing"
+msgstr "??????"
+
+msgid "Error in pass 1"
+msgstr "?? 1 ????"
+
+msgid "Error in pass 2"
+msgstr "?? 2 ????"
+
+msgid "Error initalizing audio filters"
+msgstr "????????????"
+
+msgid "Error initalizing video filters"
+msgstr "????????????"
+
+msgid "Error loadind the custom matrix file."
+msgstr "????????????????????"
+
+msgid "Error reading ifo file, aborting."
+msgstr "IFO???????????????."
+
+msgid "Error while encoding"
+msgstr "??????????"
+
+msgid "Error writing the custom matrix file."
+msgstr "????????????????????"
+
+msgid "Errors found in %u frames"
+msgstr "%u ????????????????"
+
+msgid "Evaluate ALL frames"
+msgstr "????????"
+
+msgid "Exhaustive search"
+msgstr "????"
+
+msgid "External"
+msgstr "??"
+
+msgid "External AC3"
+msgstr "??AC3"
+
+msgid "External Filters"
+msgstr "??????"
+
+msgid "External MP3"
+msgstr "??MP3"
+
+msgid "External Wav"
+msgstr "??WAV"
+
+msgid "External filename"
+msgstr "???????"
+
+msgid "Extra Settings"
+msgstr "????"
+
+msgid "Extra Shrink Factor :"
+msgstr "????? :"
+
+msgid "FFmpeg encoding options"
+msgstr "FFmpeg??????????"
+
+msgid "Factor between I and P frame Quants"
+msgstr "I ? P ??????????"
+
+msgid "Factor between P and B frame Quants"
+msgstr "P ? B ??????????"
+
+msgid "Fast (parial luma and chroma)"
+msgstr "??(???????)"
+
+msgid "Fast P-Skip"
+msgstr "??P-????"
+
+msgid "Fastest (no chroma, partial luma)"
+msgstr "??(????, ????)"
+
+msgid "Fatal error"
+msgstr "??????"
+
+msgid "Fewest bits (vhq)"
+msgstr "??????(vhq)"
+
+msgid "Field Order"
+msgstr "?????????"
+
+msgid "Field Order :"
+msgstr "????????? :"
+
+msgid "Fil_ters"
+msgstr "????(_T)"
+
+msgid "File %s has been successfully saved."
+msgstr "???? %s ??????????."
+
+msgid "File :"
+msgstr "???? :"
+
+msgid "File error"
+msgstr "???????"
+
+msgid "FileSize (MB)"
+msgstr "???????(MB)"
+
+msgid "Filename"
+msgstr "?????"
+
+msgid "Filesize tolerance (kb"
+msgstr "?????????(kb"
+
+msgid "Filter Strength"
+msgstr "???????"
+
+msgid "Filter directory"
+msgstr "?????????"
+
+msgid "Filter init failed"
+msgstr "?????????"
+
+msgid "Filters"
+msgstr "????"
+
+msgid "First frame"
+msgstr "???????"
+
+msgid "Flat matrix"
+msgstr "????????"
+
+msgid "Font (TTF)"
+msgstr "????(TTF)"
+
+msgid "Font Size"
+msgstr "???????"
+
+msgid "Force background"
+msgstr "????"
+
+msgid "Frame Rate"
+msgstr "???????"
+
+msgid "Frame: "
+msgstr "????: "
+
+msgid "Frame: ?"
+msgstr "????: ?"
+
+msgid "Frame:%c(%02d)"
+msgstr "????:%c(%02d)"
+
+msgid "Frequency"
+msgstr "???"
+
+msgid "Full linking"
+msgstr "?????"
+
+msgid "Further enable DCT Intra block search to improve quality"
+msgstr "???DCT??????????????????????"
+
+msgid "Further improve the P-frame quality"
+msgstr "P-?????????????"
+
+msgid "Gain"
+msgstr "??"
+
+msgid "Gamma"
+msgstr "???"
+
+msgid "General block breakdown transformation"
+msgstr "????????????"
+
+msgid "Get PAR from input video file"
+msgstr "??????????PAR???"
+
+msgid ""
+"Global Motion Compensation can save bits on camera pans, zooming and rotation"
+msgstr ""
+"?????????(GMC)????????????????????????"
+
+msgid "Go to Marker _A"
+msgstr "????A???(_A)"
+
+msgid "Go to Marker _B"
+msgstr "????B???(_B)"
+
+msgid "Go to marker A"
+msgstr "????A???"
+
+msgid "Go to marker B"
+msgstr "????B???"
+
+msgid "Go to time"
+msgstr "?????"
+
+msgid "Gop Size"
+msgstr "GOP???"
+
+msgid "Gop Size  (12):"
+msgstr "GOP??? (12):"
+
+msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
+msgstr "H.263 ??????????????? (??????????)"
+
+msgid "Half D1 resolution [Ctrl-2]"
+msgstr "Half D1 ??? [Ctrl-2]"
+
+msgid "Hexagonal search"
+msgstr "?????"
+
+msgid "High bitrate scenes (%):"
+msgstr "?????????? (%):"
+
+msgid "HighQ"
+msgstr "?Q (_H)"
+
+msgid ""
+"Higher settings give higher quality results, at the cost of slower encoding"
+msgstr "??????????????????????????"
+
+msgid "Horizontal deblocking"
+msgstr "???????"
+
+msgid ""
+"How much of the overflow the codec can eat into during oversized sections - "
+"larger values will bridge the gap faster"
+msgstr ""
+"????????????????????? - ????????????????"
+"?"
+
+msgid ""
+"How much of the overflow the codec can eat into during undersized sections - "
+"larger values will bridge the gap faster"
+msgstr ""
+"????????????????????? - ????????????????"
+"?"
+
+msgid "Hue/Saturation"
+msgstr "??/???"
+
+msgid "I-frame boost (%):"
+msgstr "I-?????? (%):"
+
+msgid "I-frame interval - Min:"
+msgstr "I-?????? - ??:"
+
+msgid "I-frame quantizer - Min:"
+msgstr "I-???????? - ??:"
+
+msgid ""
+"I-frames appearing in the range below this value will be treated as "
+"consecutive keyframes"
+msgstr "???????I-????????????????????"
+
+msgid "I-frames closer than ... frames..."
+msgstr "...?????????I-?????"
+
+msgid "If metric is less than identical, images are considered identical"
+msgstr "????????????????????????"
+
+msgid "If pixel are closer than noise, they are considered to be the same"
+msgstr "?????????????????????"
+
+msgid "If pixels are closer than noise, they are considered to be the same"
+msgstr "?????????????????????"
+
+msgid ""
+"If value is smaller than threshold it is considered valid. Smaller value "
+"might mean more false positive"
+msgstr ""
+"?????????????????. ???????????????????"
+
+msgid "Ifo error"
+msgstr "IFO ???"
+
+msgid "Ignore"
+msgstr "??"
+
+msgid "Image size"
+msgstr "?????"
+
+msgid "Improve the B-frame quality"
+msgstr "B-??????????"
+
+msgid "Improve the P-frame quality"
+msgstr "P-??????????"
+
+msgid "Incompatible audio"
+msgstr "????????"
+
+msgid "Incompatible frame rate"
+msgstr "?????????????"
+
+msgid "Incompatible output format"
+msgstr "??????????"
+
+msgid "Incorrect output file"
+msgstr "???????????"
+
+msgid ""
+"Increase / decrease probability for how often B-frames are used. Will not "
+"violate the maximum consecutive frame limit"
+msgstr ""
+"B-???????????????/???. ????????????????"
+
+msgid ""
+"Increase / decrease sensitivity for detecting Scene Changes to compensate "
+"for. Improves I-frame usage and helps quality"
+msgstr ""
+"????????????????????/???. I-?????????????"
+"??????"
+
+msgid "Informations"
+msgstr "??"
+
+msgid "Initial VBV buffer (%)"
+msgstr "??VBV????(%)"
+
+msgid "Input"
+msgstr "??"
+
+msgid "Int. BFF"
+msgstr "???? BFF"
+
+msgid "Int. TFF"
+msgstr "???? TFF"
+
+msgid "Interlace"
+msgstr "??????"
+
+msgid "Interlaced BFF"
+msgstr "?????? BFF"
+
+msgid "Interlaced TFF"
+msgstr "?????? TFF"
+
+msgid "Interlacing"
+msgstr "??????"
+
+msgid "Internal error"
+msgstr "?????"
+
+msgid "Internal error finding codec"
+msgstr "??????????????"
+
+msgid "Internal error opening codec"
+msgstr "???????????????"
+
+msgid "Interpolate :"
+msgstr "?? :"
+
+msgid "Invalid filename"
+msgstr "????????"
+
+msgid "Invalid jobname"
+msgstr "???????"
+
+msgid "JVT matrix"
+msgstr "JVT??????"
+
+msgid "Jobs"
+msgstr "???"
+
+msgid "Joint Stereo"
+msgstr "?????????"
+
+msgid ""
+"Jointly optimize both Motion Vector's in B-frames. This will improve quality "
+"but take more time for encoding"
+msgstr ""
+"B-????????????????????????. ????????????"
+"?????????????"
+
+msgid "Jump to _Time..."
+msgstr "?????(_T)"
+
+msgid "Keep nb of frames and fps"
+msgstr "??????FPS???"
+
+msgid "KeyFrame error"
+msgstr "?????? ???"
+
+msgid "Keyframe boost (%)"
+msgstr "???????? (%)"
+
+msgid "Last frame"
+msgstr "???????"
+
+msgid "Left:"
+msgstr "?:"
+
+msgid "Level"
+msgstr "???"
+
+msgid "Libavcodec Decoder Option"
+msgstr "Libavcodec ???? ?????"
+
+msgid "Link"
+msgstr "???"
+
+msgid "Load Custom Matrix:  "
+msgstr "??????????????:"
+
+msgid "Load external filters"
+msgstr "??????????"
+
+msgid "Local Playback Downmixing"
+msgstr "?????????????"
+
+msgid ""
+"Lossless compression method which usually improves the bitrate usage by 15% "
+"(especially on high bitrate). Helps the quality a lot but is slower. "
+msgstr ""
+"???????????(??????????)?15%??????????. ???"
+"?????????."
+
+msgid "Low bitrate scenes (%):"
+msgstr "?????????? (%):"
+
+msgid "Luma"
+msgstr "??"
+
+msgid "Luma :"
+msgstr "?? :"
+
+msgid "Luma Y"
+msgstr "?? Y"
+
+msgid "Luminance:"
+msgstr "??:"
+
+msgid "MB Comparison"
+msgstr "MB ??"
+
+msgid ""
+"MPEG quantizers (slightly slower) produce sharper picture (useful at higher "
+"bitrates)"
+msgstr ""
+"MPEG ???? (????) ???????????? (??????????)"
+
+msgid "Macroblock decision"
+msgstr "?????????"
+
+msgid "Macroblock decision:"
+msgstr "?????????:"
+
+msgid "Macroblock:"
+msgstr "???????:"
+
+msgid "Main"
+msgstr "??"
+
+msgid "Manual (db) : "
+msgstr "?? (db) : "
+
+msgid "Matrices"
+msgstr "??????"
+
+msgid "Matrix"
+msgstr "??????"
+
+msgid "Max"
+msgstr "??"
+
+msgid "Max Bitrate"
+msgstr "????????"
+
+msgid "Max Consecutive"
+msgstr "?????"
+
+msgid "Max IDR frame interval"
+msgstr "??IDR??????"
+
+msgid "Max QDiff"
+msgstr "?? QDiff"
+
+msgid "Max QP Step"
+msgstr "?? QP ????"
+
+msgid "Max Qp"
+msgstr "?? Qp"
+
+msgid "Max Qz"
+msgstr "?? Qz"
+
+msgid "Max bitrate (kbps) :"
+msgstr "???????? (kbps) :"
+
+msgid "Max overflow degradation (%):"
+msgstr "?????????? (%):"
+
+msgid "Max overflow improvement (%):"
+msgstr "?????????? (%):"
+
+msgid "Max. Ref. frames"
+msgstr "?????????"
+
+msgid "Max:"
+msgstr "??:"
+
+msgid "Maximum Bitrate (kb/s)"
+msgstr "???????? (kb/s)"
+
+msgid "Maximum local bitrate"
+msgstr "??????????"
+
+msgid "Maximum number of frames allowed between I-frames"
+msgstr "I-?????????????????"
+
+msgid ""
+"Maximum number of sequential B-frames (when set to 0, the original I/P "
+"encoder is used)"
+msgstr "????B-????? (0?????????I/P????????)"
+
+msgid "Maximum quantizer allowed for B-frames"
+msgstr "B-???????????????"
+
+msgid "Maximum quantizer allowed for I-frames"
+msgstr "I-???????????????"
+
+msgid "Maximum quantizer allowed for P-frames"
+msgstr "P-???????????????"
+
+msgid "Medium (full luma no chroma)"
+msgstr "????(????, ????)"
+
+msgid "Memory error"
+msgstr "??????"
+
+msgid "Message level"
+msgstr "????????"
+
+msgid "Method"
+msgstr "??"
+
+msgid "Metrics"
+msgstr "??????"
+
+msgid "Min Bitrate"
+msgstr "????????"
+
+msgid "Min IDR frame interval"
+msgstr "??IDR??????"
+
+msgid "Min Qp"
+msgstr "?? Qp"
+
+msgid "Min Qz"
+msgstr "?? Qz"
+
+msgid "Min bitrate (kbps) :"
+msgstr "???????? (kbps) :"
+
+msgid "Minimum Bitrate (kb/s) "
+msgstr "???????? (kb/s)"
+
+msgid "Minimum quantizer allowed for B-frames"
+msgstr "B-???????????????"
+
+msgid "Minimum quantizer allowed for I-frames"
+msgstr "I-???????????????"
+
+msgid "Minimum quantizer allowed for P-frames"
+msgstr "P-???????????????"
+
+msgid "Minimum space between I-frames, 1 will disable forced I-frame spacing"
+msgstr "I-???????????1 ???I-????????????????"
+
+msgid "Misc"
+msgstr "??"
+
+msgid "Miscellaneous"
+msgstr "??"
+
+msgid "Mixed Refs"
+msgstr "????"
+
+msgid "Mjpeg Codec settings"
+msgstr "Mjpeg???????"
+
+msgid "MntMode"
+msgstr "Mnt???"
+
+msgid "Mode"
+msgstr "???"
+
+msgid "Mode :"
+msgstr "??? :"
+
+msgid "Mono"
+msgstr "??"
+
+msgid "More"
+msgstr "??"
+
+msgid "Motion & Misc"
+msgstr "?????"
+
+msgid "Motion Estimation"
+msgstr "????"
+
+msgid "Motion search precision:"
+msgstr "??????:"
+
+msgid "MultiThreading"
+msgstr "???????"
+
+msgid "Mux Every x video frames"
+msgstr "N?????????????"
+
+msgid "Mux by packet size"
+msgstr "?????????"
+
+msgid "Mux every N video frames"
+msgstr "N??????????"
+
+msgid "Mux with block of size"
+msgstr "???????????????"
+
+msgid "Muxing Type"
+msgstr "??????"
+
+msgid "NONE"
+msgstr "??"
+
+msgid "NTSC (default is PAL)"
+msgstr "NTSC (?????? PAL)"
+
+msgid "Narrow"
+msgstr "??"
+
+msgid "Ne_xt Black Frame"
+msgstr "???????(_X)"
+
+msgid "Next _Intra Frame"
+msgstr "??I-????(_I)"
+
+msgid "Next black frame"
+msgstr "???????"
+
+msgid "Next frame"
+msgstr "??????"
+
+msgid "Next keyframe"
+msgstr "????????"
+
+msgid "No alerts"
+msgstr "?????"
+
+msgid "No audio track"
+msgstr "????????"
+
+msgid "No change"
+msgstr "????"
+
+msgid "No data"
+msgstr "?????"
+
+msgid "No downmixing"
+msgstr "?????????"
+
+msgid "No error found"
+msgstr "???????????"
+
+msgid "No link"
+msgstr "?????"
+
+msgid "No more supported."
+msgstr "????????????"
+
+msgid "Noise"
+msgstr "???"
+
+msgid "Noise Reduction"
+msgstr "?????"
+
+msgid "None"
+msgstr "??"
+
+msgid "Normal"
+msgstr "??"
+
+msgid "Not coded in this version"
+msgstr "????????????????????"
+
+msgid "Nothing to do."
+msgstr "???????."
+
+msgid "Nothing to save"
+msgstr "????????????"
+
+msgid "Number of B-frames:"
+msgstr "B-?????:"
+
+msgid "Number of BFrames"
+msgstr "B-?????"
+
+msgid "Number of threads"
+msgstr "?????"
+
+msgid "Obsolete"
+msgstr "??"
+
+msgid "Old format project file"
+msgstr "???????????????"
+
+msgid "Open CQM file"
+msgstr "CQM???????"
+
+msgid "Open a file"
+msgstr "???????"
+
+msgid "Open filter list [Ctrl-O]"
+msgstr "?????????? [Ctrl-O]"
+
+msgid "Order"
+msgstr "????"
+
+msgid "Out of memory"
+msgstr "??????"
+
+msgid "Output"
+msgstr "??"
+
+msgid "Output _file:"
+msgstr "??????(_F):"
+
+msgid "Output file error"
+msgstr "?????????"
+
+msgid "Output vobsub (.idx) :"
+msgstr "??VobSub (.idx) :"
+
+msgid "Overflow control strength (%):"
+msgstr "??????????? (%):"
+
+msgid "Overwrite file ?"
+msgstr "???????????? ?"
+
+msgid "P-frame quantizer - Min:"
+msgstr "P-???????? - ??:"
+
+msgid "P_review"
+msgstr "?????(_R)"
+
+msgid "P_revious Frame"
+msgstr "??????(_R)"
+
+msgid "Packed Bistream"
+msgstr "????????????"
+
+msgid "Packed bitstream"
+msgstr "????????????"
+
+msgid "Partition decision"
+msgstr "????"
+
+msgid "Partitions & Frames"
+msgstr "???????"
+
+msgid "Pause / Abort"
+msgstr "?? / ??"
+
+msgid "Pixel Aspect Ratio"
+msgstr "??????????"
+
+msgid "Pixel Height"
+msgstr "??????"
+
+msgid "Pixel Width"
+msgstr "?????"
+
+msgid "Play"
+msgstr "??"
+
+msgid "Please select or enter a valid filename"
+msgstr "?????????????????????"
+
+msgid "Postprocessing"
+msgstr "???"
+
+msgid "Pr_evious Intra Frame"
+msgstr "??I-????(_E)"
+
+msgid "Pre_ferences"
+msgstr "??(_F)"
+
+msgid "Predefined Aspect Ratios"
+msgstr "??????????"
+
+msgid "Preferences"
+msgstr "??"
+
+msgid "Previou_s Black Frame"
+msgstr "???????(_S)"
+
+msgid "Previous black frame"
+msgstr "???????"
+
+msgid "Previous frame"
+msgstr "??????"
+
+msgid "Previous keyframe"
+msgstr "????????"
+
+msgid "Problem loading sub"
+msgstr "????????"
+
+msgid "Problem opening the mpeg files"
+msgstr "MPEG???????????"
+
+msgid "Produces nicer-looking B-frames"
+msgstr "????????B-???????"
+
+msgid "Progressive"
+msgstr "???????"
+
+msgid "Proper_ties"
+msgstr "?????"
+
+msgid "PullDown dupe removal"
+msgstr "?????dupe??"
+
+msgid "Quality"
+msgstr "??"
+
+msgid "Quality "
+msgstr "??"
+
+msgid "Quantisation (2-31)"
+msgstr "??? (2-31)"
+
+msgid "Quantization"
+msgstr "???"
+
+msgid "Quantization difference between chroma (color) and luma (brightness)"
+msgstr "??(?)???(???)???????"
+
+msgid "Quantization factors used between I- and P- frames"
+msgstr "I- ?P- ???????????????"
+
+msgid "Quantization type"
+msgstr "??????"
+
+msgid "Quantization type:"
+msgstr "??????:"
+
+msgid "Quantization used between P- and B- frames"
+msgstr "P- ?B- ???????????????"
+
+msgid "Quantize blur"
+msgstr "??????"
+
+msgid "Quantize compression"
+msgstr "?????"
+
+msgid "Quantizer"
+msgstr "????"
+
+msgid "Quantizer (0-51):"
+msgstr "???? (0-51):"
+
+msgid "Quantizer Compression"
+msgstr "?????"
+
+msgid "Quantizer restrictions"
+msgstr "???????"
+
+msgid "Quantizer:"
+msgstr "????:"
+
+msgid "Quarter Pixel"
+msgstr "1/4 ????"
+
+msgid "Range"
+msgstr "??"
+
+msgid "Rate Control"
+msgstr "?????"
+
+msgid "Rate distortion"
+msgstr "??????"
+
+msgid "Rate distortion quantization, will find optimal encoding for each block"
+msgstr "??????????????????????????????"
+
+msgid "Ratecontrol"
+msgstr "?????"
+
+msgid "Reduce fluctuations in QP (after curve compression)"
+msgstr "(???????)QP????????"
+
+msgid "Reduced fluctuations in Quantizer (before curve compression)"
+msgstr "(???????)????????????"
+
+msgid ""
+"Reduction of bitrate for the first consecutive I-frames. The last I-frame "
+"will get treated normally"
+msgstr ""
+"?????I-?????????????. ???I-????????????"
+
+msgid "Replace (interpolate)"
+msgstr "??(??)"
+
+msgid "Resample to hz"
+msgstr "???????hz"
+
+msgid "Reset"
+msgstr "????"
+
+msgid "Resize"
+msgstr "????"
+
+msgid "Resume"
+msgstr "??"
+
+msgid "Retry"
+msgstr "???"
+
+msgid "Reuse log file ?"
+msgstr "?????????????? ?"
+
+msgid "Right:"
+msgstr "?:"
+
+msgid "Run all jobs"
+msgstr "???????"
+
+msgid "SVCD resolution [Ctrl-3]"
+msgstr "SVCD ??? [Ctrl-3]"
+
+msgid "S_ave..."
+msgstr "??(_A)"
+
+msgid "S_patial chroma strength:"
+msgstr "????????(_P):"
+
+msgid "Same Qz as input"
+msgstr "????????"
+
+msgid "Sample A/R "
+msgstr "???? A/R"
+
+msgid "Save Job"
+msgstr "??????"
+
+msgid "Save P_roject As..."
+msgstr "???????????????(_R)"
+
+msgid "Save _BMP Image..."
+msgstr "BMP?????(_B)"
+
+msgid "Save _JPEG Image..."
+msgstr "JPEG?????(_J)"
+
+msgid "Save _Project"
+msgstr "?????????(_P)"
+
+msgid "Save _Selection as JPEG images..."
+msgstr "???JPEG???????(_S)"
+
+msgid "Save _Video..."
+msgstr "?????(_V)"
+
+msgid "Save as script [Ctrl-J]"
+msgstr "?????????? [Ctrl-J]"
+
+msgid "Save filter list [Ctrl-S]"
+msgstr "?????????? [Ctrl-S]"
+
+msgid "Save the file"
+msgstr "?????????"
+
+msgid "Scene Cut Threshold"
+msgstr "????????"
+
+msgid "Scene change detect"
+msgstr "???????"
+
+msgid "Second Pass"
+msgstr "??????"
+
+msgid "Seeking"
+msgstr "????"
+
+msgid "Select"
+msgstr "??"
+
+msgid "Select  file to save "
+msgstr "???????????"
+
+msgid "Select .idx"
+msgstr ".idx???"
+
+msgid "Select .idx file"
+msgstr ".idx???????"
+
+msgid "Select 1-pass or 2-pass encoding"
+msgstr "1-???2-???????????"
+
+msgid "Select AC3 to load "
+msgstr "???AC3???"
+
+msgid "Select AVI file to append..."
+msgstr "????AVI???????..."
+
+msgid "Select AVI file..."
+msgstr "AVI???????..."
+
+msgid "Select Avi file to write"
+msgstr "???AVI???????"
+
+msgid "Select BMP to save "
+msgstr "????BMP???"
+
+msgid "Select Custom Matrix File to write"
+msgstr "????????????????????"
+
+msgid "Select Jpeg sequence to save "
+msgstr "????JPEG?????"
+
+msgid "Select Jpeg to save "
+msgstr "????JPEG???"
+
+msgid "Select Language :"
+msgstr "???? :"
+
+msgid "Select MP3 to load "
+msgstr "???MP3???"
+
+msgid "Select OGM file to write"
+msgstr "???OGM???????"
+
+msgid "Select SRT to save"
+msgstr "????SRT???"
+
+msgid "Select Sub"
+msgstr "?????"
+
+msgid "Select WAV to load "
+msgstr "???WAV???"
+
+msgid "Select Xvid matrix file to load"
+msgstr "???Xvid?????????????"
+
+msgid "Select background picture"
+msgstr "???????"
+
+msgid "Select color"
+msgstr "???"
+
+msgid "Select file to save"
+msgstr "???????????"
+
+msgid "Select file to save audio"
+msgstr "??????????????"
+
+msgid "Select postprocessing level"
+msgstr "?????????"
+
+msgid "Select raw file to save "
+msgstr "????raw???????"
+
+msgid "Select the output file"
+msgstr "?????????"
+
+msgid "Select workbench to save "
+msgstr "????workbench??"
+
+msgid "Selection: end"
+msgstr "??: ??"
+
+msgid "Selection: start"
+msgstr "??: ??"
+
+msgid "Sensibility"
+msgstr "??"
+
+msgid "Separate"
+msgstr "??"
+
+msgid "Set Marker _A"
+msgstr "????A???(_A)"
+
+msgid "Set Marker _B"
+msgstr "????B???(_B)"
+
+msgid "Set a common predefined aspect ratio"
+msgstr "???????????????????"
+
+msgid "Set a custom aspect ratio. Default 1:1 is recommended for most video."
+msgstr "???????????????. ?????1:1????????????"
+
+msgid ""
+"Set how many previous frames can be referenced by a P/B-frame. Numbers above "
+"5 do not seem to improve quality greatly. Numbers are 3 to 5 are recommended"
+msgstr ""
+"????????????P/B-?????????????. 5??????????"
+"?????????. 3??5?????"
+
+msgid "Set how much \"bitrate bonus\" a keyframe can get"
+msgstr "??????????????? \"??????????\" ???????"
+
+msgid ""
+"Set how much bitrate is deducted from a B-frame as compared to the previous "
+"P-frame"
+msgstr ""
+"?P-?????????B-????????????????????????"
+
+msgid ""
+"Set maximum frame interval between IDR frames. Defines the maximum amount a "
+"frame can be reused and referenced by other frames before a new clean one is "
+"established"
+msgstr ""
+"IDR???????????????????. ?????????????????"
+"?????????????????????????????????????"
+
+msgid ""
+"Set minimum frame interval between IDR frames. Defines the minimum amount a "
+"frame can be reused and referenced by other frames before a new clean one is "
+"established"
+msgstr ""
+"IDR???????????????????. ?????????????????"
+"?????????????????????????????????????"
+
+msgid "Set the amount of blurring to use for block edges when they are found"
+msgstr ""
+"??????????????????????????????????????"
+
+msgid "Set the amount of noise reduction"
+msgstr "???????????????"
+
+msgid ""
+"Set the maximum number of consecutive B-frames. This defines how many "
+"duplicate frames can be droped. Numbers 2 to 5 are recommended. This greatly "
+"improves the use of bitrate and quality"
+msgstr ""
+"??B-?????????????????. ?????????????????"
+"??. 2??5?????. ?????????????????????"
+
+msgid "Sharp :"
+msgstr "???? :"
+
+msgid "Sharpness"
+msgstr "?????"
+
+msgid "Shift (ms) :"
+msgstr "?? (ms) :"
+
+msgid "Shift:"
+msgstr "??:"
+
+msgid "Show _Joblist"
+msgstr "????????(_J)"
+
+msgid "Show _frame"
+msgstr "???????(_F)"
+
+msgid "Show _mask"
+msgstr "??????(_M)"
+
+msgid "Show builtin support"
+msgstr "?????????"
+
+msgid "Show metric in image (debug)"
+msgstr "????????????(?????)"
+
+msgid "Show motion Vectors"
+msgstr "?????????"
+
+msgid "Shrink factor"
+msgstr "???"
+
+msgid "Side"
+msgstr "???"
+
+msgid "Single Pass - Bitrate"
+msgstr "1-?? - ??????"
+
+msgid "Single Pass - Bitrate (Average)"
+msgstr "1-?? - ?????? (??)"
+
+msgid "Single Pass - Quality Quantizer (Average)"
+msgstr "1-?? - ?????? (??)"
+
+msgid "Single Pass - Quality Quantizer (Constant)"
+msgstr "1-?? - ?????? (??)"
+
+msgid "Single Pass - Quantizer"
+msgstr "1-?? - ????"
+
+msgid "Single pass - bitrate"
+msgstr "1-?? - ??????"
+
+msgid "Single pass - quantizer"
+msgstr "1-?? - ????"
+
+msgid "Single pass:Quantizer"
+msgstr "1-??: ????"
+
+msgid "Size mismatch"
+msgstr "?????????"
+
+msgid "Skip spatial temporal check"
+msgstr "??-???????????"
+
+msgid "Slow (full luma and chroma)"
+msgstr "??(???????)"
+
+msgid "Something failed"
+msgstr "?????????"
+
+msgid "Source :"
+msgstr "??? :"
+
+msgid "Spatial"
+msgstr "???"
+
+msgid "Split every MBytes"
+msgstr "MBytes????"
+
+msgid "Split mpegs every (MB)"
+msgstr "MPEG??? (MB)"
+
+msgid "Standard"
+msgstr "??"
+
+msgid "Stereo"
+msgstr "????"
+
+msgid "Stereo Front+Stero Rear"
+msgstr "???? ????+???? ??"
+
+msgid "Stereo+Center"
+msgstr "????+???"
+
+msgid "Stereo+Center+Surround"
+msgstr "????+???+?????"
+
+msgid "Stereo+Surround"
+msgstr "????+?????"
+
+msgid "Stop"
+msgstr "??"
+
+msgid "Strength :"
+msgstr "?? :"
+
+msgid "Strength:"
+msgstr "??:"
+
+msgid "Subtitle file "
+msgstr "??????"
+
+msgid "Subtitle selector"
+msgstr "??????"
+
+msgid "Subtitle to load"
+msgstr "?????"
+
+msgid "Subtitles"
+msgstr "??"
+
+msgid "Sure ?"
+msgstr "???"
+
+msgid "Sure you want to abort ?"
+msgstr "????????? ?"
+
+msgid "Swap U & V"
+msgstr "U?V???"
+
+msgid "Swap U&V"
+msgstr "U?V???"
+
+msgid "Swap UV"
+msgstr "UV?????"
+
+msgid "TTF font to use"
+msgstr "????TTF????"
+
+msgid "Target Bitrate (kb/s)   "
+msgstr "???????? (kb/s)"
+
+msgid "Target Size:"
+msgstr "?????:"
+
+msgid "Target video bitrate"
+msgstr "??????????"
+
+msgid "Temp. Blur of Quant after CC"
+msgstr "CC???????????"
+
+msgid "Temp. Blur of est Frame Complexity"
+msgstr "?????????????????"
+
+msgid "Temporal"
+msgstr "???"
+
+msgid "Temporal & Spatial check"
+msgstr "?????????"
+
+msgid ""
+"The beginning frame is not a key frame.\n"
+"Please move the A marker."
+msgstr ""
+"??????????????????????.\n"
+"????A????????."
+
+msgid "The custom matrix file has been successfully loaded."
+msgstr "????????????????????????"
+
+msgid ""
+"The higher this value, the more bits get assigned to frames below the "
+"average frame size"
+msgstr ""
+"?????????????????????????????????????"
+
+msgid ""
+"The higher this value, the more bits get taken from frames larger than the "
+"average size, and redistributed to others"
+msgstr ""
+"??????????????????????????????????????"
+"??????????"
+
+msgid ""
+"The number of channels is greater than what the selected audio codec can "
+"do.\n"
+"Either change codec or use the mixer filter to have less channels."
+msgstr ""
+"????????????????????????????.\n"
+"??????????????????????????????????????"
+"??."
+
+msgid "There is no audio track"
+msgstr "????????????"
+
+msgid "There is no jobs stored, nothing to do"
+msgstr "????????????????"
+
+msgid "There is no second track"
+msgstr "????????????"
+
+msgid "This is not MPEG compatible"
+msgstr "???MPEG?????????"
+
+msgid "Threshold"
+msgstr "??"
+
+msgid "Threshold 1"
+msgstr "?? 1"
+
+msgid "Threshold 2"
+msgstr "?? 2"
+
+msgid "Threshold :"
+msgstr "?? :"
+
+msgid "Time left :"
+msgstr "???? :"
+
+msgid "Time: "
+msgstr "??:"
+
+msgid "Timecode :"
+msgstr "?????? :"
+
+msgid "Timeshift"
+msgstr "????"
+
+msgid "Top"
+msgstr "???"
+
+msgid "Top Field First"
+msgstr "??????????"
+
+msgid "Top Field first"
+msgstr "??????????"
+
+msgid "Top field (keep bottom)"
+msgstr "????????(??????)"
+
+msgid "Top:"
+msgstr "?:"
+
+msgid "Total size (MB):"
+msgstr "????? (MB):"
+
+msgid "Track _1:"
+msgstr "???? _1:"
+
+msgid "Track _2: "
+msgstr "???? _2: "
+
+msgid "Transform"
+msgstr "??"
+
+msgid "Turbo Mode"
+msgstr "??????"
+
+msgid "Two Pass (bitrate) "
+msgstr "2-?? (??????)"
+
+msgid "Two Pass (filesize) "
+msgstr "2-?? (???????)"
+
+msgid "Two Pass - Average bitrate"
+msgstr "2-?? - ????????"
+
+msgid "Two Pass - File Size"
+msgstr "2-?? - ???????"
+
+msgid "Two pass"
+msgstr "2-??"
+
+msgid "Two pass tuning"
+msgstr "2????"
+
+msgid "Two pass, average bitrate"
+msgstr "2-??, ????????"
+
+msgid "Two pass, final size"
+msgstr "2-??, ?????"
+
+msgid "Two pass-Avg bitrate"
+msgstr "2??-????????"
+
+msgid "Two pass-filesize"
+msgstr "2??-???????"
+
+msgid "Type"
+msgstr "???"
+
+msgid "Type :"
+msgstr "??? :"
+
+msgid "U Shift :"
+msgstr "U ???:"
+
+msgid "UV to Y link"
+msgstr "UV?Y????"
+
+msgid "Uncheck to enable fast p-skip"
+msgstr "??????????P-??????????"
+
+msgid "Uneven multi hexagon"
+msgstr "????????"
+
+msgid "Unknown flag :"
+msgstr "????? :"
+
+msgid "Unsupported"
+msgstr "?????"
+
+msgid "Use 4 motion vectors per macroblock, might give better compression"
+msgstr "??????????4?????????????????????"
+
+msgid "Use Chroma to evalute"
+msgstr "????????"
+
+msgid "Use Quarter pixel resolution for a more precise motion estimation"
+msgstr "??????????1/4 ??????????"
+
+msgid "Use Xvid Rate Control"
+msgstr "Xvid????????"
+
+msgid "Use Xvid ratecontrol"
+msgstr "Xvid????????"
+
+msgid "Use alternative tag for mp3 in .mp4"
+msgstr ".mp4?mp3????????"
+
+msgid "Use as reference"
+msgstr "???????"
+
+msgid "Use chroma information to estimate motion"
+msgstr "????????????"
+
+msgid ""
+"Use fewer B-frame if needed. This is always recommended. If not enabled, the "
+"codec will always use the maximum number of consecutive B-frames"
+msgstr ""
+"?????????B-???????. ???????????. ????????"
+"?????????????B-????????????"
+
+msgid "Use lavcodec mpeg2 decoder"
+msgstr "lavcodec MPEG2 ???????"
+
+msgid "Use linear blend ?"
+msgstr "????????????? ?"
+
+msgid ""
+"Use rate distortion quantization to find optimal encoding for each block. "
+"Level 0 equals disabled, level 1 equals normal and level 2 equals high"
+msgstr ""
+"????????????????????????????. ???0??????"
+"??1????????2?????????"
+
+msgid "Use systray while encoding"
+msgstr "????????????????"
+
+msgid "User Interface"
+msgstr "??????????"
+
+msgid ""
+"Uses chroma (color) components for motion for compression and helps the "
+"quality"
+msgstr "?????(?)????????????????????"
+
+msgid "V Shift :"
+msgstr "V ???:"
+
+msgid "VBR (Quality based)"
+msgstr "VBR (??????)"
+
+msgid "VBV buffer size"
+msgstr "VBV???????"
+
+msgid "VCD resolution [Ctrl-4]"
+msgstr "VCD  ??? [Ctrl-4]"
+
+msgid "VHQ enables an additional search process to increase quality"
+msgstr "VHQ ???????????????????"
+
+msgid "VHQ mode:"
+msgstr "VHQ ???:"
+
+msgid "Variable bitrate mode"
+msgstr "???????????"
+
+msgid "Vertical deblocking"
+msgstr "???????"
+
+msgid "Vi_deo"
+msgstr "??(_D)"
+
+msgid "Video"
+msgstr "??"
+
+msgid "Video Display"
+msgstr "????"
+
+msgid "Video Duration  "
+msgstr "????"
+
+msgid "Video Filter Manager"
+msgstr "?? ???? ?????"
+
+msgid "Video bitrate:"
+msgstr "????????:"
+
+msgid "Video encoder"
+msgstr "???????"
+
+msgid "Video filters"
+msgstr "??????"
+
+msgid "Video size (MB):"
+msgstr "????? (MB):"
+
+msgid "Video stream :"
+msgstr "??????? :"
+
+msgid "VideoCodec"
+msgstr "???????"
+
+msgid "Vignette Height"
+msgstr "??????"
+
+msgid "Vignette Width"
+msgstr "?????"
+
+msgid "VobSub Settings"
+msgstr "VobSub???"
+
+msgid "Volume control"
+msgstr "????"
+
+msgid "Weighted biprediction"
+msgstr "???????"
+
+msgid ""
+"Width is not a multiple of 8\n"
+" continue anyway ?"
+msgstr ""
+"??8??????????\n"
+" ????????? ?"
+
+msgid "Wrong output format"
+msgstr "???????"
+
+msgid "Wrong video codec"
+msgstr "??????????"
+
+msgid "X264 configuration"
+msgstr "X264 ??"
+
+msgid "XVCD encoding"
+msgstr "XVCD ?????"
+
+msgid "XviD encoding options"
+msgstr "XviD??????????"
+
+msgid "Y to UV link"
+msgstr "Y?UV????"
+
+msgid "Z_oom 1:2"
+msgstr "??? 1:2 (_O)"
+
+msgid "Zoom _1:1"
+msgstr "??? 1:1 (_1)"
+
+msgid "Zoom _2:1"
+msgstr "??? 2:1 (_2)"
+
+msgid "Zoom _4:1"
+msgstr "??? 4:1 (_4)"
+
+msgid "_A/V Sidebar"
+msgstr "A/V??????(_A)"
+
+msgid "_About"
+msgstr "Avidemux????(_A)"
+
+msgid "_Append..."
+msgstr "??(_A)"
+
+msgid "_Aspect ratio"
+msgstr "??????(_A)"
+
+msgid "_Audio"
+msgstr "??(_A)"
+
+msgid "_Bitrate Histogram"
+msgstr "?????? ??????(_B)"
+
+msgid "_Bottom margin"
+msgstr "???(_B)"
+
+msgid "_Build VBR Time Map"
+msgstr "VBR?????????(_B)"
+
+msgid "_Calculator"
+msgstr "??(_C)"
+
+msgid "_Contrast:"
+msgstr "??????(_C):"
+
+msgid "_Copy"
+msgstr "???(_C)"
+
+msgid "_Custom Matrix"
+msgstr "??????????(_C)"
+
+msgid "_Custom size (MB):"
+msgstr "???????(_C) (MB):"
+
+msgid "_Decoder Options"
+msgstr "?????????(_D)"
+
+msgid "_Delete"
+msgstr "??(_D)"
+
+msgid "_Deringing"
+msgstr "????(_D)"
+
+msgid "_Edit"
+msgstr "??(_E)"
+
+msgid "_Encoder"
+msgstr "?????(_E)"
+
+msgid "_Extra"
+msgstr "??(_E)"
+
+msgid "_Field dominance:"
+msgstr "???????(_F):"
+
+msgid "_Field order:"
+msgstr "?????????(_F):"
+
+msgid "_File"
+msgstr "????(_F)"
+
+msgid "_Filter strength:"
+msgstr "???????(_F):"
+
+msgid "_Filters"
+msgstr "????(_F)"
+
+msgid "_First Frame"
+msgstr "???????(_F)"
+
+msgid "_Font scale"
+msgstr "????????(_F)"
+
+msgid "_Format:"
+msgstr "??(_F):"
+
+msgid "_Frame Rate"
+msgstr "???????(_F)"
+
+msgid "_Go"
+msgstr "??(_G)"
+
+msgid "_Greyscale"
+msgstr "???????(_G)"
+
+msgid "_Help"
+msgstr "???(_H)"
+
+msgid "_High quality"
+msgstr "???(_H)"
+
+msgid "_Horizontal deblocking"
+msgstr "???????(_H)"
+
+msgid "_Horizontal stacking:"
+msgstr "??????(_H):"
+
+msgid "_Identical:"
+msgstr "??(_I):"
+
+msgid "_Interlaced"
+msgstr "??????(_I)"
+
+msgid "_Job name:"
+msgstr "????(_J)"
+
+msgid "_Jump to Frame..."
+msgstr "???????(_J)"
+
+msgid "_Last Frame"
+msgstr "???????(_L)"
+
+msgid "_Line spacing"
+msgstr "???????(_L)"
+
+msgid "_Load/Run Project..."
+msgstr "??????????/??(_L)"
+
+msgid "_Main Toolbar"
+msgstr "??????(_M)"
+
+msgid "_Main Track"
+msgstr "?????(_M)"
+
+msgid "_Mask"
+msgstr "??? (_M)"
+
+msgid "_Medium:"
+msgstr "????(_M):"
+
+msgid "_Mode:"
+msgstr "???(_M):"
+
+msgid "_Next Frame"
+msgstr "??????(_N)"
+
+msgid "_Noise:"
+msgstr "???(_N):"
+
+msgid "_Open..."
+msgstr "??(_O)"
+
+msgid "_Paste"
+msgstr "????(_P)"
+
+msgid "_Play/Stop"
+msgstr "??/??(_P)"
+
+msgid "_Postprocessing"
+msgstr "???(_P)"
+
+msgid "_Preview"
+msgstr "?????(_P)"
+
+msgid "_Quantizer:"
+msgstr "????(_Q):"
+
+msgid "_Quit"
+msgstr "??(_Q)"
+
+msgid "_Rebuild Frames (I & B)"
+msgstr "????(I?B)????(_R)"
+
+msgid "_Reset Edits"
+msgstr "???????(_R)"
+
+msgid "_Saturation:"
+msgstr "???(_S):"
+
+msgid "_Save"
+msgstr "??(_S)"
+
+msgid "_Scan for Black Frames..."
+msgstr "??????????(_S)"
+
+msgid "_Second Track"
+msgstr "??????(_S)"
+
+msgid "_Show metrics"
+msgstr "??????(_S)"
+
+msgid "_Shrink factor:"
+msgstr "???(_S):"
+
+msgid "_Spatial luma strength:"
+msgstr "????????(_S):"
+
+msgid "_Strength:"
+msgstr "??(_S):"
+
+msgid "_Subtitle file (ass/ssa)"
+msgstr "??????(_S) (ass/ssa)"
+
+msgid "_Temporal strength:"
+msgstr "?????(_T):"
+
+msgid "_Threshold:"
+msgstr "??(_T):"
+
+msgid "_Tools"
+msgstr "???(_T)"
+
+msgid "_Top margin"
+msgstr "???(_T)"
+
+msgid "_Trellis quantization"
+msgstr "_Trellis ???"
+
+msgid "_Vertical deblocking"
+msgstr "???????(_V)"
+
+msgid "_Vertical stacking:"
+msgstr "??????(_V):"
+
+msgid "_View"
+msgstr "??(_V)"
+
+msgid "_Zoom 1:4"
+msgstr "??? 1:4 (_Z)"
+
+msgid "font"
+msgstr "????"
+
+msgid "identical"
+msgstr "??"
+
+msgid "label5"
+msgstr "???5"
+
+msgid "label6"
+msgstr "???6"
+
+msgid "label7"
+msgstr "???7"
+
+msgid "motion Threshold, Chroma"
+msgstr "????, ??"
+
+msgid "motion Threshold, Luma"
+msgstr "????, ??"
+
+msgid "noise"
+msgstr "???"
+
+msgid "show"
+msgstr "??"
+
+msgid "threshold"
+msgstr "??"
+
+msgid "translator-credits"
+msgstr "tetsuro"



From mean at mail.berlios.de  Fri Apr 20 22:50:29 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 20 Apr 2007 22:50:29 +0200
Subject: [Avidemux-svn-commit] r2955 - branches/avidemux_2.4_branch/po
Message-ID: <200704202050.l3KKoTtR015439@sheep.berlios.de>

Author: mean
Date: 2007-04-20 22:50:28 +0200 (Fri, 20 Apr 2007)
New Revision: 2955

Added:
   branches/avidemux_2.4_branch/po/ja.po
Removed:
   branches/avidemux_2.4_branch/po/jp.po
Modified:
   branches/avidemux_2.4_branch/po/LINGUAS
   branches/avidemux_2.4_branch/po/Makefile.am
   branches/avidemux_2.4_branch/po/cs.po
   branches/avidemux_2.4_branch/po/klingon.po
   branches/avidemux_2.4_branch/po/ru.po
Log:
switch from jp to ja

Modified: branches/avidemux_2.4_branch/po/LINGUAS
===================================================================
--- branches/avidemux_2.4_branch/po/LINGUAS	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/LINGUAS	2007-04-20 20:50:28 UTC (rev 2955)
@@ -3,4 +3,4 @@
 de
 ru
 cs
-jp
+ja

Modified: branches/avidemux_2.4_branch/po/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/po/Makefile.am	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/Makefile.am	2007-04-20 20:50:28 UTC (rev 2955)
@@ -1,3 +1,3 @@
-POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po jp.po
-EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po jp.po
+POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po
+EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po
 

Modified: branches/avidemux_2.4_branch/po/cs.po
===================================================================
--- branches/avidemux_2.4_branch/po/cs.po	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/cs.po	2007-04-20 20:50:28 UTC (rev 2955)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: cs\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-10-04 22:09+0300\n"
+"POT-Creation-Date: 2006-12-07 19:20+0100\n"
 "PO-Revision-Date: 2006-11-18 11:22+0100\n"
 "Last-Translator: Jakub Misak <jmisak at centrum.cz>\n"
 "Language-Team:  <cs at li.org>\n"
@@ -86,19 +86,19 @@
 "Po?et kan?l? je v?t?? ne? zvl?dne zvolen? audio kodek.\n"
 "Bu? zm??te kodek, nebo mix?rem v audio filtrech sni?te po?et kan?l?."
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:567
+#: avidemux/ADM_nuv/ADM_nuv.cpp:568
 msgid "Sure you want to abort ?"
 msgstr "Opravdu chcete p?eru?it ?lohu?"
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Size mismatch"
 msgstr "Neshoda velikosti"
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Expect a crash."
 msgstr "O?ek?vejte p?d programu."
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:1070
+#: avidemux/ADM_nuv/ADM_nuv.cpp:1071
 msgid "Do you want to save an index ?"
 msgstr "Chcete ulo?it index?"
 
@@ -509,7 +509,8 @@
 msgstr "Re?im VHQ:"
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:880
-msgid "Higher settings give higher quality results, at the cost of slower encoding"
+msgid ""
+"Higher settings give higher quality results, at the cost of slower encoding"
 msgstr "Vy??? hodnoty znamenaj? vy??? kvalitu za cenu pomalej??ho k?dov?n?"
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:884 avidemux/ADM_dialog/DIA_xvid.cpp:357
@@ -589,7 +590,9 @@
 msgid ""
 "Enable a better prediction of AC component. Turns on Lumi masking - applies "
 "more compression to dark/light areas that the eye cannot notice easily"
-msgstr "Lep?? predikce AC komponentu. Zapne maskov?n? luminance - aplikuje v?t?? m?ru komprese na tmav?/sv?tl? m?sta, kde to oko tak snadno nepozn?."
+msgstr ""
+"Lep?? predikce AC komponentu. Zapne maskov?n? luminance - aplikuje v?t?? "
+"m?ru komprese na tmav?/sv?tl? m?sta, kde to oko tak snadno nepozn?."
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:966
 msgid "I-frame interval - Min:"
@@ -640,7 +643,8 @@
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:1021
 #: avidemux/ADM_dialog/DIA_lavcodec.cpp:792
-msgid "Global Motion Compensation can save bits on camera pans, zooming and rotation"
+msgid ""
+"Global Motion Compensation can save bits on camera pans, zooming and rotation"
 msgstr ""
 "Global Motion Compensation (glob?ln? kompenzace pohybu) m??e u?et?it bity na "
 "p?ejezdech kamery, p?ibl??en? a rotaci"
@@ -1149,7 +1153,7 @@
 msgstr "Indexace..."
 
 #: avidemux/ADM_dialog/DIA_idx_pg.cpp:174
-#: avidemux/ADM_dialog/DIA_working.cpp:249
+#: avidemux/ADM_dialog/DIA_working.cpp:257
 msgid "Time left :"
 msgstr "Zb?vaj?c? ?as:"
 
@@ -1197,7 +1201,7 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_enter.cpp:223
-#: avidemux/ADM_dialog/DIA_working.cpp:236 avidemux/ADM_dialog/DIA_d3d.cpp:93
+#: avidemux/ADM_dialog/DIA_working.cpp:244 avidemux/ADM_dialog/DIA_d3d.cpp:93
 #: avidemux/ADM_dialog/DIA_4entries.cpp:88
 msgid "dialog1"
 msgstr ""
@@ -1257,11 +1261,16 @@
 msgid "Recent files"
 msgstr "Ned?vn? soubory"
 
-#: avidemux/ADM_dialog/DIA_working.cpp:254
+#: avidemux/ADM_dialog/DIA_working.cpp:168
+#, c-format
+msgid " %d m %d s left"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_working.cpp:262
 msgid "0:0:0"
 msgstr ""
 
-#: avidemux/ADM_dialog/DIA_busy.cpp:102
+#: avidemux/ADM_dialog/DIA_busy.cpp:120
 msgid "Busy"
 msgstr "Zanepr?zdn?n"
 
@@ -2377,7 +2386,8 @@
 "nespr?vn?ch detekc?"
 
 #: avidemux/ADM_dialog/DIA_deblend.cpp:167
-msgid "If pixels are closer than noise threshold, they are considered identical"
+msgid ""
+"If pixels are closer than noise threshold, they are considered identical"
 msgstr "Pokud jsou pixely bl?? ne? pr?h ?umu, jsou pova?ov?ny za identick?"
 
 #: avidemux/ADM_dialog/DIA_deblend.cpp:176
@@ -2459,7 +2469,9 @@
 msgid ""
 "Constant Quantizer - Each frame will the same compression. Low numbers equal "
 "higher quality while high numbers equal lower quality"
-msgstr "Konstantn? kvantiz?r - ka?d? sn?mek se stejnou m?rou komprese. N?zk? ??sla znamenaj? vy??? kvalitu a naopak"
+msgstr ""
+"Konstantn? kvantiz?r - ka?d? sn?mek se stejnou m?rou komprese. N?zk? ??sla "
+"znamenaj? vy??? kvalitu a naopak"
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:494
 msgid "Load Defaults"
@@ -2573,7 +2585,9 @@
 msgid ""
 "Set how many previous frames can be referenced by a P/B-frame. Numbers above "
 "5 do not seem to improve quality greatly. Numbers are 3 to 5 are recommended"
-msgstr "Kolik p?edchoz?ch sn?mk? m??e b?t odkazov?no z P/B sn?mk?. Hodnoty nad 5 u? moc kvalitu nezvy?uj?. Doporu?eno je 3 a? 5."
+msgstr ""
+"Kolik p?edchoz?ch sn?mk? m??e b?t odkazov?no z P/B sn?mk?. Hodnoty nad 5 u? "
+"moc kvalitu nezvy?uj?. Doporu?eno je 3 a? 5."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:608
 msgid "Max. Ref. frames"
@@ -2605,7 +2619,9 @@
 msgid ""
 "Define how many pixels are analysised. The higher the range the more "
 "accurate the analysis but the slower the encoding time"
-msgstr "Ur?uje kolik pixel? je analyzov?no. ??m vy??? rozsah, t?m p?esn?j?? anal?za, ale pomalej?? k?dov?n?."
+msgstr ""
+"Ur?uje kolik pixel? je analyzov?no. ??m vy??? rozsah, t?m p?esn?j?? anal?za, "
+"ale pomalej?? k?dov?n?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:645
 msgid "<b>Motion Estimation</b>"
@@ -2619,7 +2635,9 @@
 msgid ""
 "Enforce the size of a decoded pixel decoded to a certain value. Leave this "
 "at 1:1 for non-anamorphic video"
-msgstr "Nastav? velikost dek?dovan?ho pixelu na ur?itou hodnotu. Pro neanamorfn? video nechte na 1:1."
+msgstr ""
+"Nastav? velikost dek?dovan?ho pixelu na ur?itou hodnotu. Pro neanamorfn? "
+"video nechte na 1:1."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:675 avidemux/ADM_dialog/DIA_x264.cpp:686
 msgid "1"
@@ -2657,7 +2675,9 @@
 msgid ""
 "Lossless compression method which usually improves the bitrate usage by 15% "
 "(especially on high bitrate). Helps the quality a lot but is slower. "
-msgstr "Bezeztr?tov? kompresn? metoda,kter? obvykle zlep?? datov? tok o 15 % (zejm?na u vysok?ho datov?ho toku). V?razn? zlep?? kvalitu, ale je pomalej??."
+msgstr ""
+"Bezeztr?tov? kompresn? metoda,kter? obvykle zlep?? datov? tok o 15 % "
+"(zejm?na u vysok?ho datov?ho toku). V?razn? zlep?? kvalitu, ale je pomalej??."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:746
 msgid "Trellis"
@@ -2667,7 +2687,9 @@
 msgid ""
 "Use rate distortion quantization to find optimal encoding for each block. "
 "Level 0 equals disabled, level 1 equals normal and level 2 equals high"
-msgstr "Pou??t rate distortion kvantizaci k nalezen? optim?ln?ho zak?dov?n? ka?d?ho bloku. 0 znamen? vypnuto, 1 znamen? norm?ln? ?rove? a 2 vysokou."
+msgstr ""
+"Pou??t rate distortion kvantizaci k nalezen? optim?ln?ho zak?dov?n? ka?d?ho "
+"bloku. 0 znamen? vypnuto, 1 znamen? norm?ln? ?rove? a 2 vysokou."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:757
 msgid "Noise Reduction"
@@ -2741,7 +2763,9 @@
 msgid ""
 "Increase / decrease probability for how often B-frames are used. Will not "
 "violate the maximum consecutive frame limit"
-msgstr "Zv??it/sn??it pravd?podobnost jak ?asto jsou pou?ity B sn?mky. Neporu?? limit maxima n?sledn?ch sn?mk?."
+msgstr ""
+"Zv??it/sn??it pravd?podobnost jak ?asto jsou pou?ity B sn?mky. Neporu?? "
+"limit maxima n?sledn?ch sn?mk?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:869
 msgid "Max Consecutive"
@@ -2752,7 +2776,10 @@
 "Set the maximum number of consecutive B-frames. This defines how many "
 "duplicate frames can be droped. Numbers 2 to 5 are recommended. This greatly "
 "improves the use of bitrate and quality"
-msgstr "Maxim?ln? po?et po sob? jdouc?ch B sn?mk?. To ur?uje kolik duplikovan?ch sn?mk? lze zahodit. Doporu?eno 2 a? 5. Toto velmi zlep?uje vyu?it? datov?ho toku a kvalitu."
+msgstr ""
+"Maxim?ln? po?et po sob? jdouc?ch B sn?mk?. To ur?uje kolik duplikovan?ch "
+"sn?mk? lze zahodit. Doporu?eno 2 a? 5. Toto velmi zlep?uje vyu?it? datov?ho "
+"toku a kvalitu."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:889
 msgid "Bidirectional ME"
@@ -2762,7 +2789,9 @@
 msgid ""
 "Jointly optimize both Motion Vector's in B-frames. This will improve quality "
 "but take more time for encoding"
-msgstr "Spole?n? optimalizuje vektory pohybu v B sn?mc?ch. Zlep?? kvalitu, ale zpomal? k?dov?n?."
+msgstr ""
+"Spole?n? optimalizuje vektory pohybu v B sn?mc?ch. Zlep?? kvalitu, ale "
+"zpomal? k?dov?n?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:896
 msgid "Weighted biprediction"
@@ -2780,7 +2809,9 @@
 msgid ""
 "Use fewer B-frame if needed. This is always recommended. If not enabled, the "
 "codec will always use the maximum number of consecutive B-frames"
-msgstr "Pou?ije m?n? B sn?mk? kdy? je t?eba. Toto je v?dy doporu?eno. Pokud nen? aktivov?no, kodek v?dy pou?ije maxim?ln? po?et po sob? jdouc?ch B sn?mk?."
+msgstr ""
+"Pou?ije m?n? B sn?mk? kdy? je t?eba. Toto je v?dy doporu?eno. Pokud nen? "
+"aktivov?no, kodek v?dy pou?ije maxim?ln? po?et po sob? jdouc?ch B sn?mk?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:912
 msgid "Use as reference"
@@ -2790,7 +2821,9 @@
 msgid ""
 "Allow B-frames to make references non-linearly to another B-frame (instead "
 "of creating a duplicate copy)"
-msgstr "Povol?, aby B sn?mky odkazovaly neline?rn? na dal?? B sn?mky (m?sto vytvo?en? kopie)"
+msgstr ""
+"Povol?, aby B sn?mky odkazovaly neline?rn? na dal?? B sn?mky (m?sto "
+"vytvo?en? kopie)"
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:923
 msgid "B-Frame Direct Mode:  "
@@ -2832,14 +2865,18 @@
 msgid ""
 "Set how much bitrate is deducted from a B-frame as compared to the previous "
 "P-frame"
-msgstr "Kolik datov?ho toku je ode?teno z B sn?mku v porovn?n? s p?edchoz?m P sn?mkem"
+msgstr ""
+"Kolik datov?ho toku je ode?teno z B sn?mku v porovn?n? s p?edchoz?m P sn?mkem"
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1006
 msgid ""
 "Define how much the bitrate can fluctuate over the entire video. 0% results "
 "in a constant bitrate stream, while 100% results in a pure quality based "
 "bitrate stream"
-msgstr "Jak moc m??e datov? tok kol?sat p?es cel? video. Nastaven? s 0 % vytvo?? video s konstantn?m datov?m tokem, zat?mco 100 % znamen? video zalo?en? ?ist? na kvalit?."
+msgstr ""
+"Jak moc m??e datov? tok kol?sat p?es cel? video. Nastaven? s 0 % vytvo?? "
+"video s konstantn?m datov?m tokem, zat?mco 100 % znamen? video zalo?en? "
+"?ist? na kvalit?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1009
 msgid "<b>Bitrate</b>"
@@ -2866,7 +2903,8 @@
 msgstr "Nastav? maxim?ln? ?rove? kvantizace"
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1073
-msgid "Define how much the quantizer rate can change between two consecutive frames"
+msgid ""
+"Define how much the quantizer rate can change between two consecutive frames"
 msgstr "Jak moc se m??e kvantizace m?nit mezi po sob? jdouc?mi sn?mky"
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1076
@@ -2881,7 +2919,9 @@
 msgid ""
 "Increase / decrease sensitivity for detecting Scene Changes to compensate "
 "for. Improves I-frame usage and helps quality"
-msgstr "Zv???/sn??? citlivost detekce zm?ny sc?ny pro kompenzaci. Zlep?uje vyu?it? I sn?mk? a kvalitu."
+msgstr ""
+"Zv???/sn??? citlivost detekce zm?ny sc?ny pro kompenzaci. Zlep?uje vyu?it? I "
+"sn?mk? a kvalitu."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1111
 msgid "Min IDR frame interval"
@@ -2892,14 +2932,20 @@
 "Set minimum frame interval between IDR frames. Defines the minimum amount a "
 "frame can be reused and referenced by other frames before a new clean one is "
 "established"
-msgstr "Minim?ln? interval mezi IDR sn?mky. Nastav? minim?ln? m?ru kdy m??e b?t sn?mek znovupou?it a odkazov?n z jin?ch sn?mk? p?edt?m, ne? je vytvo?en nov? ?ist?."
+msgstr ""
+"Minim?ln? interval mezi IDR sn?mky. Nastav? minim?ln? m?ru kdy m??e b?t "
+"sn?mek znovupou?it a odkazov?n z jin?ch sn?mk? p?edt?m, ne? je vytvo?en nov? "
+"?ist?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1133
 msgid ""
 "Set maximum frame interval between IDR frames. Defines the maximum amount a "
 "frame can be reused and referenced by other frames before a new clean one is "
 "established"
-msgstr "Maxim?ln? interval mezi IDR sn?mky. Nastav? maxim?ln? m?ru kdy m??e b?t sn?mek znovupou?it a odkazov?n z jin?ch sn?mk? p?edt?m, ne? je vytvo?en nov? ?ist?."
+msgstr ""
+"Maxim?ln? interval mezi IDR sn?mky. Nastav? maxim?ln? m?ru kdy m??e b?t "
+"sn?mek znovupou?it a odkazov?n z jin?ch sn?mk? p?edt?m, ne? je vytvo?en nov? "
+"?ist?."
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1136
 msgid "Max IDR frame interval"
@@ -3030,6 +3076,7 @@
 msgid "Band"
 msgstr "Tlou??ka rozmazan?ho okraje"
 
+#. TRANSLATORS: Replace this string with your names, one name per line.
 #: avidemux/ADM_dialog/DIA_about.cpp:56
 msgid "translator-credits"
 msgstr ""
@@ -3400,11 +3447,13 @@
 "Public License instead of this License."
 msgstr ""
 "Avidemux je svobodn? software; m??ete jej ???it a modifikovat podle\n"
-"ustanoven? GNU General Public License verze 2.\n\n"
+"ustanoven? GNU General Public License verze 2.\n"
+"\n"
 "Tento program je roz?i?ov?n v nad?ji, ?e bude u?ite?n?, av?ak BEZ\n"
 "JAK?KOLI Z?RUKY; neposkytuj? se ani odvozen? z?ruky PRODEJNOSTI nebo\n"
 "VHODNOSTI PRO UR?IT? ??EL. Dal?? podrobnosti hledejte v GNU General Public\n"
-"License.\n\n"
+"License.\n"
+"\n"
 "Kopii GNU General Public License jste m?li obdr?et spolu s t?mto\n"
 "programem; pokud se tak nestalo, napi?te o ni Free Software Foundation,\n"
 "Inc., 675 Mass Ave, Cambridge, MA 02139, USA."
@@ -4042,7 +4091,8 @@
 
 #: avidemux/ADM_dialog/DIA_jobs_save.cpp:153
 msgid "Job name displayed in the job list and used as the script filename"
-msgstr "N?zev ?lohy zobrazen? v seznamu ?loh a pou?it? jako n?zev souboru se skriptem"
+msgstr ""
+"N?zev ?lohy zobrazen? v seznamu ?loh a pou?it? jako n?zev souboru se skriptem"
 
 #: avidemux/ADM_dialog/DIA_jobs_save.cpp:162
 msgid "Filename of the audio/video output"
@@ -4668,7 +4718,8 @@
 
 #: avidemux/ADM_dialog/DIA_lavcodec.cpp:1494
 msgid "Filesize tolerance (1 kb = 1000 bits). 1000-100000 is a sane range"
-msgstr "Tolerance velikosti souboru (1 kb = 1000 bit?). 1000-100000 je rozumn? rozsah"
+msgstr ""
+"Tolerance velikosti souboru (1 kb = 1000 bit?). 1000-100000 je rozumn? rozsah"
 
 #: avidemux/ADM_dialog/DIA_lavcodec.cpp:1495
 msgid "8000"
@@ -5371,7 +5422,8 @@
 
 #: avidemux/oplug_mpeg/op_mpegpass.cpp:182
 msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
-msgstr "Pro DVD mus? b?t audio 48kHz MP2 (stereo), AC3, DTS nebo LPCM (stereo)."
+msgstr ""
+"Pro DVD mus? b?t audio 48kHz MP2 (stereo), AC3, DTS nebo LPCM (stereo)."
 
 #: avidemux/ADM_encoder/adm_encConfig.cpp:193
 msgid "Wrong output format"
@@ -5413,15 +5465,15 @@
 msgid "MPEG renumbering error"
 msgstr "Chyba p?e??slov?n? MPEG souboru"
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:486
+#: avidemux/ADM_3gp/ADM_3gp.cpp:488
 msgid "Expect troubles"
 msgstr "O?ek?vejte probl?my"
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:929
+#: avidemux/ADM_3gp/ADM_3gp.cpp:972
 msgid "Problem reading SVQ3 headers"
 msgstr "Chyba ?ten? hlavi?ky SVQ3"
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:1457
+#: avidemux/ADM_3gp/ADM_3gp.cpp:1524
 msgid "No stts table"
 msgstr "Nen? stts tabulka"
 
@@ -5752,8 +5804,10 @@
 "resolution\n"
 "2.) concatinate them together"
 msgstr ""
-"Zat?m nem??ete m?chat r?zn? rozm?ry obrazu. Pozd?j?? pou?it? ??ste?n?ho filtru tento probl?m obejde. Do?asn? ?e?en? tedy je:\n"
-"1) Zm?na velikosti, p?id?n? ?ern?ch okraj? nebo o?ez ka?d?ho souboru na stejn? rozli?en?\n"
+"Zat?m nem??ete m?chat r?zn? rozm?ry obrazu. Pozd?j?? pou?it? ??ste?n?ho "
+"filtru tento probl?m obejde. Do?asn? ?e?en? tedy je:\n"
+"1) Zm?na velikosti, p?id?n? ?ern?ch okraj? nebo o?ez ka?d?ho souboru na "
+"stejn? rozli?en?\n"
 "2) Spojit je dohromady"
 
 #: avidemux/ADM_editor/ADM_edit.cpp:517
@@ -5780,8 +5834,10 @@
 "ACCURACY</b>.\n"
 "Do you want to use that mode ?"
 msgstr ""
-"Pokud soubor pou??v? B sn?mky jako referenci, m??e to v?st k p?du programu nebo trh?n?.\n"
-"Avidemux m??e pou??t jin? re?im kter? je bezpe?n?, ale <b>p?ijdete o p?esnost na sn?mky</b>.\n"
+"Pokud soubor pou??v? B sn?mky jako referenci, m??e to v?st k p?du programu "
+"nebo trh?n?.\n"
+"Avidemux m??e pou??t jin? re?im kter? je bezpe?n?, ale <b>p?ijdete o "
+"p?esnost na sn?mky</b>.\n"
 "Chcete pou??t tento re?im?"
 
 #: avidemux/ADM_editor/ADM_edit.cpp:665
@@ -5919,7 +5975,7 @@
 msgstr "Nem??u identifikovat form?t titulk?"
 
 #: avidemux/gui_navigate.cpp:78 avidemux/gui_navigate.cpp:119
-#: avidemux/gui_navigate.cpp:381 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:392 avidemux/gui_navigate.cpp:434
 msgid "Decompressing error"
 msgstr "Dekomprima?n? chyba"
 
@@ -5927,11 +5983,15 @@
 msgid "Cannot decode next frame."
 msgstr "Nelze dek?dovat dal?? sn?mek."
 
-#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:434
 msgid "Cannot decode keyframe."
 msgstr "Nelze dek?dovat kl??ov? sn?mek."
 
-#: avidemux/gui_navigate.cpp:381
+#: avidemux/gui_navigate.cpp:237
+msgid "Seeking"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:392
 msgid "Cannot decode the frame."
 msgstr "Nelze dek?dovat sn?mek."
 
@@ -6087,7 +6147,8 @@
 
 #: avidemux/gtk_gui.cpp:1181
 msgid "Save (A+V) will generate bad AVI. Save audio will work."
-msgstr "Ulo?en? souboru vytvo?? ?patn? AVI soubor. Ulo?en? zvuku bude fungovat."
+msgstr ""
+"Ulo?en? souboru vytvo?? ?patn? AVI soubor. Ulo?en? zvuku bude fungovat."
 
 #: avidemux/gtk_gui.cpp:1196
 msgid "Could not decode the frame"
@@ -6106,7 +6167,8 @@
 msgstr "V kop?rovac?m re?imu toto audio nelze ulo?it"
 
 #: avidemux/gtk_gui.cpp:1295
-msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
+msgid ""
+"Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "Jako audio kodek vyberte WAV PCM, jinak bude zvukov? soubor ?ist? PCM."
 
 #: avidemux/gtk_gui.cpp:1303 avidemux/gtk_gui.cpp:1787
@@ -6258,7 +6320,8 @@
 
 #: avidemux/gtk_gui.cpp:2469
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
-msgstr "Selhalo ulo?en? ?lohy. Mo?n? je probl?m s p??stupov?mi pr?vy ~/.avidemux"
+msgstr ""
+"Selhalo ulo?en? ?lohy. Mo?n? je probl?m s p??stupov?mi pr?vy ~/.avidemux"
 
 #: avidemux/gtk_gui.cpp:2481
 #, c-format
@@ -6412,7 +6475,7 @@
 msgid "It is not MPEG-4 video. File will not be saved."
 msgstr "Nen? to MPEG-4 video. Soubor se neulo??."
 
-#: avidemux/gui_savenew.cpp:308
+#: avidemux/gui_savenew.cpp:311
 msgid ""
 "You may need smart copy.\n"
 " Enable it ?"
@@ -6420,15 +6483,12 @@
 "Mo?n? bude pot?eba Smart Copy.\n"
 "M? se aktivovat?"
 
-#: avidemux/gui_savenew.cpp:333
-msgid "No encoder"
-msgstr "Nen? kod?r"
-
-#: avidemux/gui_savenew.cpp:333
-msgid "Cannot save in process mode."
-msgstr "Nelze ulo?it soubor ve zpracov?vac?m re?imu."
-
 #: avidemux/guiplay.cpp:384
 msgid "Trouble initializing audio device"
 msgstr "Chyba inicializace zvukov?ho za??zen?"
 
+#~ msgid "No encoder"
+#~ msgstr "Nen? kod?r"
+
+#~ msgid "Cannot save in process mode."
+#~ msgstr "Nelze ulo?it soubor ve zpracov?vac?m re?imu."

Copied: branches/avidemux_2.4_branch/po/ja.po (from rev 2954, branches/avidemux_2.4_branch/po/jp.po)

Deleted: branches/avidemux_2.4_branch/po/jp.po
===================================================================
--- branches/avidemux_2.4_branch/po/jp.po	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/jp.po	2007-04-20 20:50:28 UTC (rev 2955)
@@ -1,2890 +0,0 @@
-msgid ""
-msgstr ""
-"Project-Id-Version: ja\n"
-"POT-Creation-Date: 2007-03-24 15:57+0100\n"
-"PO-Revision-Date: 2007-04-20 18:28+0900\n"
-"Last-Translator: tetsuro\n"
-"Language-Team: Japan\n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=utf-8\n"
-"Content-Transfer-Encoding: 8bit\n"
-"X-Poedit-Language: Japanese\n"
-"X-Poedit-Country: JAPAN\n"
-"X-Poedit-SourceCharset: utf-8\n"
-
-msgid ""
-"\n"
-" Reuse the existing log-file ?"
-msgstr ""
-"\n"
-" ????????????????? ?"
-
-msgid "  Job Name  "
-msgstr "  ????  "
-
-msgid " Error X:"
-msgstr " ?? X:"
-
-msgid " Error Y:"
-msgstr " ?? Y:"
-
-msgid " Height "
-msgstr "??"
-
-msgid " No"
-msgstr "???"
-
-msgid " Text:"
-msgstr "????:"
-
-msgid " Width "
-msgstr "?"
-
-msgid " Yes"
-msgstr "??"
-
-msgid "\"%s\" does not exist."
-msgstr "\"%s\" ??????."
-
-msgid "# of frames"
-msgstr "?????"
-
-msgid "...are reduced by (%):"
-msgstr "...? (%) ?????:"
-
-msgid "/dev/null"
-msgstr "NUL"
-
-msgid "0 - None"
-msgstr "0 - ??"
-
-msgid "0 - Off"
-msgstr "0 - ??"
-
-msgid ""
-"0 = default from core (let XviD decide), else overflow payback percent per "
-"frame"
-msgstr ""
-"0 = ??????????(XviD??????)???? = ???????????"
-"?????????"
-
-msgid "1  - Extremely Low (Fastest)"
-msgstr "1  - ????? (??)"
-
-msgid "1 - Mode decision"
-msgstr "1 - ?????"
-
-msgid "1 - Very low"
-msgstr "1 - ?????"
-
-msgid "16 round up"
-msgstr "16????"
-
-msgid "2  - Very Low"
-msgstr "2  - ?????"
-
-msgid "2 - Limited search"
-msgstr "2 - ????"
-
-msgid "2 - Low"
-msgstr "2 - ??"
-
-msgid "3  - Low"
-msgstr "3  - ??"
-
-msgid "3 - Medium"
-msgstr "3 - ????"
-
-msgid "3 - Medium search"
-msgstr "3 - ????"
-
-msgid "4  - Medium"
-msgstr "4  - ????"
-
-msgid "4 - High"
-msgstr "4 - ??"
-
-msgid "4 - Wide search"
-msgstr "4 - ?????"
-
-msgid "4 field check"
-msgstr "4?????????"
-
-msgid "4 field check (no average)"
-msgstr "4?????????(????)"
-
-msgid "4x4 Intra search"
-msgstr "4x4 ??????"
-
-msgid "4x4, 4x8 and 8x4 P-frame search"
-msgstr "4x4, 4x8 ? 8x4 P-??????"
-
-msgid "5  - High (Default)"
-msgstr "5  - ?? (?????)"
-
-msgid "5 - Very high"
-msgstr "5 - ?????"
-
-msgid "5 channels"
-msgstr "5 ?????"
-
-msgid "5 field check"
-msgstr "5?????????"
-
-msgid "5 field check (no average)"
-msgstr "5?????????(????)"
-
-msgid "6  - Very High"
-msgstr "6  - ?????"
-
-msgid "6 - Ultra high"
-msgstr "6 - ???"
-
-msgid "6B - Very High (RDO on Bframes)"
-msgstr "6B - ????? (RDO on Bframes)"
-
-msgid "7 - Ultra High"
-msgstr "7 - ???"
-
-msgid "7B - Ultra High (RDO on Bframes)"
-msgstr "7B - ??? (RDO on Bframes)"
-
-msgid "8x8 Intra search"
-msgstr "8x8 ??????"
-
-msgid "8x8 Transform"
-msgstr "8x8 ??"
-
-msgid "8x8, 8x16 and 16x8 B-frame search"
-msgstr "8x8, 8x16 ? 16x8 B-??????"
-
-msgid "8x8, 8x16 and 16x8 P-frame search"
-msgstr "8x8, 8x16 ? 16x8 P-??????"
-
-msgid "<b >Active Filters</b>"
-msgstr "<b >???????</b>"
-
-msgid "<b><big>Encoding files</big></b>"
-msgstr "<b><big>??????????????</big></b>"
-
-msgid "<b>Aspect Ratio</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Aud Codec:</b>"
-msgstr "<b>???????:</b>"
-
-msgid "<b>Audio Bitrate</b>"
-msgstr "<b>????????</b>"
-
-msgid "<b>Audio Size:</b>"
-msgstr "<b>?????:</b>"
-
-msgid "<b>Audio</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Available Filters</b>"
-msgstr "<b>?????????</b>"
-
-msgid "<b>B-Frames</b>"
-msgstr "<b>B-????</b>"
-
-msgid "<b>Bitmap</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Bitrate :</b>"
-msgstr "<b>?????? :</b>"
-
-msgid "<b>Bitrate:</b>"
-msgstr "<b>??????:</b>"
-
-msgid "<b>Bitrate</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Channel Mode:</b>"
-msgstr "<b>????????:</b>"
-
-msgid "<b>Color Correction Matrix</b>"
-msgstr "<b>?????????</b>"
-
-msgid "<b>Container:</b>"
-msgstr "<b>????:</b>"
-
-msgid "<b>Encoding mode </b>"
-msgstr "<b>????? ??? </b>"
-
-msgid "<b>Extra Properties</b>"
-msgstr "<b>???????</b>"
-
-msgid "<b>Files</b>"
-msgstr "<b>????</b>"
-
-msgid "<b>Format</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Fps convert</b>"
-msgstr "<b>Fps ??</b>"
-
-msgid "<b>Frame:</b>"
-msgstr "<b>????:</b>"
-
-msgid "<b>Gain</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Gamma</b>"
-msgstr "<b>???</b>"
-
-msgid "<b>General</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Hue:</b>"
-msgstr "<b>??:</b>"
-
-msgid "<b>Input file</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Interlacing</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Matrices</b>"
-msgstr "<b>??????</b>"
-
-msgid ""
-"<b>Matrix Warning :</b>\n"
-"all above values are normalized to 256!"
-msgstr ""
-"<b>???????? :</b>\n"
-"???????256????????!"
-
-msgid "<b>Misc. Options</b>"
-msgstr "<b>??, ?????</b>"
-
-msgid "<b>Misc</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Mixer</b>"
-msgstr "<b>????</b>"
-
-msgid "<b>Mode :</b>"
-msgstr "<b>??? :</b>"
-
-msgid "<b>Mode:</b>"
-msgstr "<b>???:</b>"
-
-msgid "<b>Mode</b>"
-msgstr "<b>???</b>"
-
-msgid "<b>More Rate Settings</b>"
-msgstr "<b>????????</b>"
-
-msgid "<b>Motion Estimation</b>"
-msgstr "<b>????</b>"
-
-msgid "<b>Partition Macroblocks</b>"
-msgstr "<b>?????????</b>"
-
-msgid "<b>Phasis:</b>"
-msgstr "<b>????:</b>"
-
-msgid "<b>Quality :</b>"
-msgstr "<b>?? :</b>"
-
-msgid "<b>Quality:</b>"
-msgstr "<b>??:</b>"
-
-msgid "<b>Quantization Limits</b>"
-msgstr "<b>?????</b>"
-
-msgid "<b>Quantization Matrices</b>"
-msgstr "<b>?????????</b>"
-
-msgid "<b>Quantizer:</b>"
-msgstr "<b>????:</b>"
-
-msgid "<b>Quantizers</b>"
-msgstr "<b>????</b>"
-
-msgid "<b>RateControl</b>"
-msgstr "<b>?????</b>"
-
-msgid "<b>Resampling</b>"
-msgstr "<b>?????</b>"
-
-msgid "<b>Result</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Sample Aspect Ratio (A/R)</b>"
-msgstr "<b>?????????? (A/R)</b>"
-
-msgid "<b>Saturation:</b>"
-msgstr "<b>???:</b>"
-
-msgid "<b>Scene change Treshold</b>"
-msgstr "<b>???????</b>"
-
-msgid "<b>Selection</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Settings</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>Target</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>TimeCode</b>"
-msgstr "<b>??????</b>"
-
-msgid "<b>Total Size:</b>"
-msgstr "<b>?????:</b>"
-
-msgid "<b>Vid Bitrate:</b>"
-msgstr "<b>????????:</b>"
-
-msgid "<b>Vid codec:</b>"
-msgstr "<b>???????:</b>"
-
-msgid "<b>Video Buffer Verifier</b>"
-msgstr "<b>????????</b>"
-
-msgid "<b>Video Size:</b>"
-msgstr "<b>?????:</b>"
-
-msgid "<b>Video</b>"
-msgstr "<b>??</b>"
-
-msgid "<b>frame2</b>"
-msgstr "<b>????2</b>"
-
-msgid "<i>Strength</i>"
-msgstr "<i>??</i>"
-
-msgid "<i>Threshold</i>"
-msgstr "<i>??</i>"
-
-msgid "A value of 20 will give 20% more bits to every I-frame"
-msgstr "20????I-?????20%??????????"
-
-msgid "AP type"
-msgstr "AP???"
-
-msgid "ASharp by MarcFD"
-msgstr "MarcFD???ASharp"
-
-msgid "AVI _Muxer Options"
-msgstr "AVI????????(_M)"
-
-msgid "A_dd to Joblist..."
-msgstr "?????????(_D)"
-
-msgid "A_uto"
-msgstr "??(_U)"
-
-msgid "Abort"
-msgstr "??"
-
-msgid "Aborting"
-msgstr "??"
-
-msgid "Accept non standard audio frequency for DVD"
-msgstr "DVD?????????????????"
-
-msgid "Adaptative DCT"
-msgstr "???DCT"
-
-msgid "Advanced Simple Profile"
-msgstr "????????????"
-
-msgid ""
-"Allow B-frames to make references non-linearly to another B-frame (instead "
-"of creating a duplicate copy)"
-msgstr ""
-"(???????????)B-???????B-?????????????????"
-"??"
-
-msgid ""
-"Allowed variance of average bitrate. Lower values mean less variance. Higher "
-"values mean more variance."
-msgstr ""
-"???????????????. ??????????????????????"
-"??."
-
-msgid ""
-"Allowed variance of average quantizer or quality. Lower values mean less "
-"variance. Higher values mean more variance. Note that 0 means constant "
-"quality while 1 means constant fluctuation. Recommended 0.6."
-msgstr ""
-"??????????????????. ???????????????????"
-"?????. 0???????1?????????????????. 0.6???."
-
-msgid "Area Combing Threshold"
-msgstr "?????????"
-
-msgid "Artefact Protection threshold "
-msgstr "??????"
-
-msgid "As input"
-msgstr "?????"
-
-msgid "Aspect Ratio"
-msgstr "??????"
-
-msgid "Audio"
-msgstr "??"
-
-msgid "Audio Encoder Settings"
-msgstr "?????????"
-
-msgid "Audio Processing"
-msgstr "????"
-
-msgid "Audio duration  "
-msgstr "????"
-
-msgid "Audio filters"
-msgstr "??????"
-
-msgid "Audio output"
-msgstr "????"
-
-msgid "Audio settings"
-msgstr "?????"
-
-msgid "Audio size (MB):"
-msgstr "????? (MB):"
-
-msgid "Audio source"
-msgstr "?????"
-
-msgid "Audio track is not suitable"
-msgstr "????????????????"
-
-msgid "Audio/video file information"
-msgstr "??/????????"
-
-msgid "Audio/video time shift (ms)"
-msgstr "??/?????? (ms)"
-
-msgid "AudioCodec"
-msgstr "???????"
-
-msgid "Auto split"
-msgstr "????"
-
-msgid "AutoCrop"
-msgstr "??????"
-
-msgid "AutoGain"
-msgstr "????"
-
-msgid "AutoWhite"
-msgstr "??????"
-
-msgid "Automatic ( max is -3dB)"
-msgstr "?? ( ??? -3dB)"
-
-msgid "Automatically"
-msgstr "??"
-
-msgid "Automatically build VBR map"
-msgstr "????VBR????????"
-
-msgid "Automatically index mpeg files"
-msgstr "????MPEG????????????????"
-
-msgid "Automatically rebuild index"
-msgstr "????????????????"
-
-msgid "Automatically remove packed bitstream"
-msgstr "?????????????????????"
-
-msgid "Automatically swap A and B if A>B"
-msgstr "A > B ?????A?B?????"
-
-msgid "Average Br (kb/s)"
-msgstr "????????(kb/s)"
-
-msgid "Avi Muxer Option"
-msgstr "AVI????????"
-
-msgid "B-Frame Direct Mode:  "
-msgstr "B-?????????:"
-
-msgid "B-frame quantizer - Min:"
-msgstr "B-???????? - ??:"
-
-msgid "B-frame reduction (%)"
-msgstr "B-?????? (%)"
-
-msgid "BackGround Image :"
-msgstr "???? :"
-
-msgid "Bias"
-msgstr "????"
-
-msgid "Bidirectional ME"
-msgstr "???ME"
-
-msgid "Bitrate"
-msgstr "??????"
-
-msgid "Bitrate "
-msgstr "??????"
-
-msgid "Bitrate (kb/s)"
-msgstr "?????? (kb/s)"
-
-msgid "Bitrate (kb/s):"
-msgstr "?????? (kb/s):"
-
-msgid "Bitrate Calculator"
-msgstr "????????"
-
-msgid "Bitrate Histogram"
-msgstr "????????????"
-
-msgid "Bitrate Variance"
-msgstr "????????"
-
-msgid "Bitrate out of range"
-msgstr "??????????"
-
-msgid "Bitrate variability (%)"
-msgstr "????????? (%)"
-
-msgid "Bitrate/size calculator"
-msgstr "??????/?????"
-
-msgid "Bits per pixel:"
-msgstr "???/????:"
-
-msgid "Block Adaptative :"
-msgstr "??????? :"
-
-msgid "Bob, Skip spatial temporal check"
-msgstr "Bob, ??-???????????"
-
-msgid "Bob, T+S check"
-msgstr "Bob, T+S????"
-
-msgid "Bottom"
-msgstr "???"
-
-msgid "Bottom Field First"
-msgstr "??????????"
-
-msgid "Bottom Field first"
-msgstr "??????????"
-
-msgid "Bottom field (keep top)"
-msgstr "????????(??????)"
-
-msgid "Bottom:"
-msgstr "?:"
-
-msgid "Brigh_tness:"
-msgstr "???(_T):"
-
-msgid "Brightness"
-msgstr "???"
-
-msgid "Buffer Size"
-msgstr "???????"
-
-msgid "CBR (bitrate based)"
-msgstr "CBR (??????????)"
-
-msgid "C_heck Frames (slow)"
-msgstr "?????? (??)"
-
-msgid "C_hroma motion"
-msgstr "????(_H)"
-
-msgid "C_hroma optimizer"
-msgstr "?????(_H)"
-
-msgid "Ca_rtoon mode"
-msgstr "?????(_R)"
-
-msgid "Calculate referencing individually based on each partition"
-msgstr "??????????????????"
-
-msgid "Calculator"
-msgstr "??"
-
-msgid "Cannot decode frame"
-msgstr "??????????????"
-
-msgid "Cannot decode keyframe."
-msgstr "????????????????"
-
-msgid "Cannot decode next frame."
-msgstr "????????????????"
-
-msgid "Cannot decode the frame."
-msgstr "??????????????"
-
-msgid "Cannot identify subtitle format"
-msgstr "????????????"
-
-msgid "Cannot initialize the audio stream"
-msgstr "????????????????"
-
-msgid "Cannot initialize the video stream"
-msgstr "????????????????"
-
-msgid "Cannot initiate save"
-msgstr "??????????"
-
-msgid "Cannot open \"%s\" for writing."
-msgstr "????? \"%s\" ??????."
-
-msgid "Cannot open \"%s\"."
-msgstr "\"%s\" ??????."
-
-msgid "Cannot open AMR codec."
-msgstr "AMR???????????."
-
-msgid "Cannot open WMA2 codec."
-msgstr "WMA2???????????."
-
-msgid "Cannot open directory as a file"
-msgstr "?????????????????"
-
-msgid "Cannot write .idx"
-msgstr ".idx???????"
-
-msgid "Cannot write .sub"
-msgstr ".sub???????"
-
-msgid "Cannot write the file"
-msgstr "???????????"
-
-msgid "Channels  "
-msgstr "?????"
-
-msgid "Chapter 1"
-msgstr "?????1"
-
-msgid "Chapter 2"
-msgstr "?????2"
-
-msgid "Chapter 3"
-msgstr "?????3"
-
-msgid "Chapter 4"
-msgstr "?????4"
-
-msgid "Chapter 5"
-msgstr "?????5"
-
-msgid "Chapter 6"
-msgstr "?????6"
-
-msgid "Chroma"
-msgstr "??"
-
-msgid "Chroma ME"
-msgstr "?? ME"
-
-msgid "Chroma Noise Reduction 2"
-msgstr "??????? 2"
-
-msgid "Chroma QP Offset"
-msgstr "??QP?????"
-
-msgid "Chroma U"
-msgstr "?? U"
-
-msgid "Chroma U :"
-msgstr "?? U :"
-
-msgid "Chroma V"
-msgstr "?? V"
-
-msgid "Chroma V :"
-msgstr "?? V :"
-
-msgid "Chrominance:"
-msgstr "??:"
-
-msgid "Codec "
-msgstr "?????"
-
-msgid "Codec 4CC"
-msgstr "?????4CC"
-
-msgid "Codec Error"
-msgstr "????????"
-
-msgid "ColorYuv (From avisynth)"
-msgstr "ColorYuv (avisynth??)"
-
-msgid "Colors"
-msgstr "?"
-
-msgid "Combed Treshold"
-msgstr "Combed ??"
-
-msgid "Configure"
-msgstr "??"
-
-msgid "Configure Codec"
-msgstr "????????"
-
-msgid "Configure audio encoder"
-msgstr "??????????"
-
-msgid "Configure video encoder"
-msgstr "??????????"
-
-msgid "Constant Bitrate"
-msgstr "????????"
-
-msgid "Constant Bitrate (kbps)"
-msgstr "???????? (kbps)"
-
-msgid "Constant Quality"
-msgstr "????"
-
-msgid "Constant Quantizer"
-msgstr "??????"
-
-msgid ""
-"Constant Quantizer - Each frame will the same compression. Low numbers equal "
-"higher quality while high numbers equal lower quality"
-msgstr ""
-"?????? - ??????????. ????????????????????"
-"???"
-
-msgid "Constant quantizer - each frame will get the same compression"
-msgstr "?????? - ?????????????"
-
-msgid "Contrast"
-msgstr "??????"
-
-msgid "Copy"
-msgstr "???"
-
-msgid "Could not initialize audio"
-msgstr "???????????"
-
-msgid "Could not initialize video"
-msgstr "???????????"
-
-msgid "Could not open subtitle file"
-msgstr "????????????"
-
-msgid "Could not open the file"
-msgstr "??????????"
-
-msgid "Create openDML file"
-msgstr "openDML ?????????"
-
-msgid "Crop Bottom:"
-msgstr "?????:"
-
-msgid "Crop Left :"
-msgstr "?????:"
-
-msgid "Crop Right:"
-msgstr "?????:"
-
-msgid "Crop Settings"
-msgstr "???????"
-
-msgid "Crop Top:"
-msgstr "?????:"
-
-msgid "Cu_t"
-msgstr "???(_T)"
-
-msgid "Current frame"
-msgstr "???????"
-
-msgid "Current time"
-msgstr "?????"
-
-msgid "Curve compression"
-msgstr "????"
-
-msgid "Custom"
-msgstr "????"
-
-msgid "Custom matrix"
-msgstr "??????????"
-
-msgid "Cycle"
-msgstr "????"
-
-msgid "DVD resolution [Ctrl-1]"
-msgstr "DVD ??? [Ctrl-1]"
-
-msgid "Deblocking Filter :"
-msgstr "????? ???? :"
-
-msgid "Default"
-msgstr "?????"
-
-msgid "Default mpeg"
-msgstr "?????MPEG"
-
-msgid ""
-"Define how many pixels are analysised. The higher the range the more "
-"accurate the analysis but the slower the encoding time"
-msgstr ""
-"?????????????. ????????????????????????"
-"?????"
-
-msgid ""
-"Define how much the bitrate can fluctuate over the entire video. 0% results "
-"in a constant bitrate stream, while 100% results in a pure quality based "
-"bitrate stream"
-msgstr ""
-"??????????????????. 0%?????????????????"
-"??100%??????????????????????????"
-
-msgid ""
-"Define how much the quantizer rate can change between two consecutive frames"
-msgstr "????????????????????????"
-
-msgid "Define the level for when deblocking is applied"
-msgstr "??????????????????????"
-
-msgid "Delay in ms"
-msgstr "?? (ms)"
-
-msgid "Delete All Jobs"
-msgstr "???????"
-
-msgid "Delete Job"
-msgstr "??????"
-
-msgid "Delete job"
-msgstr "??????"
-
-msgid "Denoise"
-msgstr "?????"
-
-msgid "Deringing"
-msgstr "????"
-
-msgid "Destination"
-msgstr "???"
-
-msgid "Detected Audio :"
-msgstr "??????? :"
-
-msgid "Diamond search"
-msgstr "????????"
-
-msgid "Disable NUV audio sync"
-msgstr "NuppelVideo ??????????"
-
-msgid "Discard Closer"
-msgstr "???????"
-
-msgid "Discard longer dupe (anim??s)"
-msgstr "??dupe???(???)"
-
-msgid "Display Stats"
-msgstr "????"
-
-msgid "Display _Output"
-msgstr "?????(_O)"
-
-msgid "Display all alerts"
-msgstr "???????????"
-
-msgid "Display only error alerts"
-msgstr "????????????"
-
-msgid "Do you want to save an index ?"
-msgstr "????????????? ?"
-
-msgid "Dolby Prologic"
-msgstr "??????????"
-
-msgid "Dolby Prologic 2"
-msgstr "??????????2"
-
-msgid "Done"
-msgstr "??"
-
-msgid "Done : %02d%%"
-msgstr "?? : %02d%%"
-
-msgid "Double nb of frames (slow motion)"
-msgstr "???????????(????????)"
-
-msgid "Double nb of frames and fps"
-msgstr "??????FPS??????"
-
-msgid "Dual pass"
-msgstr "????"
-
-msgid "Dual pass (MBytes)"
-msgstr "???? (MBytes)"
-
-msgid "Duration:"
-msgstr "????:"
-
-msgid "Edit Custom Matrix"
-msgstr "?????????????"
-
-msgid "Edit a loaded custom quantization matrix file"
-msgstr "???????????????????????????"
-
-msgid "Enable DCT Intra block search to improve quality"
-msgstr "DCT??????????????????????"
-
-msgid ""
-"Enable a better prediction of AC component. Turns on Lumi masking - applies "
-"more compression to dark/light areas that the eye cannot notice easily"
-msgstr ""
-"AC????????????????????. Lumi??????? - ??????"
-"??????????????????"
-
-msgid "Enable in-loop deblocking to filter the video"
-msgstr "????????????????????????"
-
-msgid "Enable time shift"
-msgstr "??????????"
-
-msgid "Enables Divx like packed vop, DO NOT SET, it is ugly"
-msgstr "????vop????Divx??????. ??????????????"
-
-msgid "Enables a chroma optimizer prefilter"
-msgstr "?????????????????"
-
-msgid "Enables fast 1st pass encoding"
-msgstr "????????????????????"
-
-msgid ""
-"Enables interlaced frame support - use only if your source contains "
-"interlacing artifacts (i.e. fields instead of progressive frames)"
-msgstr ""
-"???????????????????? - ???????????(?????"
-"???????????????????)??????????"
-
-msgid "Enables special motion estimation features for cartoons/anime"
-msgstr "??/?????????????????????"
-
-msgid "Enables weighting of B-frames to help fades"
-msgstr "B-????????????????????????"
-
-msgid "Encode in black & white"
-msgstr "????????"
-
-msgid "Encode interlaced"
-msgstr "??????????????"
-
-msgid "Encoding "
-msgstr "?????"
-
-msgid "Encoding Mode:"
-msgstr "????????:"
-
-msgid "Encoding Type"
-msgstr "????????"
-
-msgid "Encoding Type:"
-msgstr "????? ???:"
-
-msgid "Encoding mode"
-msgstr "????????"
-
-msgid "Encoding type:"
-msgstr "????????:"
-
-msgid "Enforce a maximum quantizer level"
-msgstr "????????????"
-
-msgid "Enforce a minimum quantizer level"
-msgstr "????????????"
-
-msgid ""
-"Enforce the size of a decoded pixel decoded to a certain value. Leave this "
-"at 1:1 for non-anamorphic video"
-msgstr ""
-"??????????????????????????. ???????????"
-"??1:1?????????"
-
-msgid "Entry input for target file size or bitrate"
-msgstr "??????????????????????????"
-
-msgid "Error Loading"
-msgstr "??????"
-
-msgid "Error Writing"
-msgstr "??????"
-
-msgid "Error in pass 1"
-msgstr "?? 1 ????"
-
-msgid "Error in pass 2"
-msgstr "?? 2 ????"
-
-msgid "Error initalizing audio filters"
-msgstr "????????????"
-
-msgid "Error initalizing video filters"
-msgstr "????????????"
-
-msgid "Error loadind the custom matrix file."
-msgstr "????????????????????"
-
-msgid "Error reading ifo file, aborting."
-msgstr "IFO???????????????."
-
-msgid "Error while encoding"
-msgstr "??????????"
-
-msgid "Error writing the custom matrix file."
-msgstr "????????????????????"
-
-msgid "Errors found in %u frames"
-msgstr "%u ????????????????"
-
-msgid "Evaluate ALL frames"
-msgstr "????????"
-
-msgid "Exhaustive search"
-msgstr "????"
-
-msgid "External"
-msgstr "??"
-
-msgid "External AC3"
-msgstr "??AC3"
-
-msgid "External Filters"
-msgstr "??????"
-
-msgid "External MP3"
-msgstr "??MP3"
-
-msgid "External Wav"
-msgstr "??WAV"
-
-msgid "External filename"
-msgstr "???????"
-
-msgid "Extra Settings"
-msgstr "????"
-
-msgid "Extra Shrink Factor :"
-msgstr "????? :"
-
-msgid "FFmpeg encoding options"
-msgstr "FFmpeg??????????"
-
-msgid "Factor between I and P frame Quants"
-msgstr "I ? P ??????????"
-
-msgid "Factor between P and B frame Quants"
-msgstr "P ? B ??????????"
-
-msgid "Fast (parial luma and chroma)"
-msgstr "??(???????)"
-
-msgid "Fast P-Skip"
-msgstr "??P-????"
-
-msgid "Fastest (no chroma, partial luma)"
-msgstr "??(????, ????)"
-
-msgid "Fatal error"
-msgstr "??????"
-
-msgid "Fewest bits (vhq)"
-msgstr "??????(vhq)"
-
-msgid "Field Order"
-msgstr "?????????"
-
-msgid "Field Order :"
-msgstr "????????? :"
-
-msgid "Fil_ters"
-msgstr "????(_T)"
-
-msgid "File %s has been successfully saved."
-msgstr "???? %s ??????????."
-
-msgid "File :"
-msgstr "???? :"
-
-msgid "File error"
-msgstr "???????"
-
-msgid "FileSize (MB)"
-msgstr "???????(MB)"
-
-msgid "Filename"
-msgstr "?????"
-
-msgid "Filesize tolerance (kb"
-msgstr "?????????(kb"
-
-msgid "Filter Strength"
-msgstr "???????"
-
-msgid "Filter directory"
-msgstr "?????????"
-
-msgid "Filter init failed"
-msgstr "?????????"
-
-msgid "Filters"
-msgstr "????"
-
-msgid "First frame"
-msgstr "???????"
-
-msgid "Flat matrix"
-msgstr "????????"
-
-msgid "Font (TTF)"
-msgstr "????(TTF)"
-
-msgid "Font Size"
-msgstr "???????"
-
-msgid "Force background"
-msgstr "????"
-
-msgid "Frame Rate"
-msgstr "???????"
-
-msgid "Frame: "
-msgstr "????: "
-
-msgid "Frame: ?"
-msgstr "????: ?"
-
-msgid "Frame:%c(%02d)"
-msgstr "????:%c(%02d)"
-
-msgid "Frequency"
-msgstr "???"
-
-msgid "Full linking"
-msgstr "?????"
-
-msgid "Further enable DCT Intra block search to improve quality"
-msgstr "???DCT??????????????????????"
-
-msgid "Further improve the P-frame quality"
-msgstr "P-?????????????"
-
-msgid "Gain"
-msgstr "??"
-
-msgid "Gamma"
-msgstr "???"
-
-msgid "General block breakdown transformation"
-msgstr "????????????"
-
-msgid "Get PAR from input video file"
-msgstr "??????????PAR???"
-
-msgid ""
-"Global Motion Compensation can save bits on camera pans, zooming and rotation"
-msgstr ""
-"?????????(GMC)????????????????????????"
-
-msgid "Go to Marker _A"
-msgstr "????A???(_A)"
-
-msgid "Go to Marker _B"
-msgstr "????B???(_B)"
-
-msgid "Go to marker A"
-msgstr "????A???"
-
-msgid "Go to marker B"
-msgstr "????B???"
-
-msgid "Go to time"
-msgstr "?????"
-
-msgid "Gop Size"
-msgstr "GOP???"
-
-msgid "Gop Size  (12):"
-msgstr "GOP??? (12):"
-
-msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
-msgstr "H.263 ??????????????? (??????????)"
-
-msgid "Half D1 resolution [Ctrl-2]"
-msgstr "Half D1 ??? [Ctrl-2]"
-
-msgid "Hexagonal search"
-msgstr "?????"
-
-msgid "High bitrate scenes (%):"
-msgstr "?????????? (%):"
-
-msgid "HighQ"
-msgstr "?Q (_H)"
-
-msgid ""
-"Higher settings give higher quality results, at the cost of slower encoding"
-msgstr "??????????????????????????"
-
-msgid "Horizontal deblocking"
-msgstr "???????"
-
-msgid ""
-"How much of the overflow the codec can eat into during oversized sections - "
-"larger values will bridge the gap faster"
-msgstr ""
-"????????????????????? - ????????????????"
-"?"
-
-msgid ""
-"How much of the overflow the codec can eat into during undersized sections - "
-"larger values will bridge the gap faster"
-msgstr ""
-"????????????????????? - ????????????????"
-"?"
-
-msgid "Hue/Saturation"
-msgstr "??/???"
-
-msgid "I-frame boost (%):"
-msgstr "I-?????? (%):"
-
-msgid "I-frame interval - Min:"
-msgstr "I-?????? - ??:"
-
-msgid "I-frame quantizer - Min:"
-msgstr "I-???????? - ??:"
-
-msgid ""
-"I-frames appearing in the range below this value will be treated as "
-"consecutive keyframes"
-msgstr "???????I-????????????????????"
-
-msgid "I-frames closer than ... frames..."
-msgstr "...?????????I-?????"
-
-msgid "If metric is less than identical, images are considered identical"
-msgstr "????????????????????????"
-
-msgid "If pixel are closer than noise, they are considered to be the same"
-msgstr "?????????????????????"
-
-msgid "If pixels are closer than noise, they are considered to be the same"
-msgstr "?????????????????????"
-
-msgid ""
-"If value is smaller than threshold it is considered valid. Smaller value "
-"might mean more false positive"
-msgstr ""
-"?????????????????. ???????????????????"
-
-msgid "Ifo error"
-msgstr "IFO ???"
-
-msgid "Ignore"
-msgstr "??"
-
-msgid "Image size"
-msgstr "?????"
-
-msgid "Improve the B-frame quality"
-msgstr "B-??????????"
-
-msgid "Improve the P-frame quality"
-msgstr "P-??????????"
-
-msgid "Incompatible audio"
-msgstr "????????"
-
-msgid "Incompatible frame rate"
-msgstr "?????????????"
-
-msgid "Incompatible output format"
-msgstr "??????????"
-
-msgid "Incorrect output file"
-msgstr "???????????"
-
-msgid ""
-"Increase / decrease probability for how often B-frames are used. Will not "
-"violate the maximum consecutive frame limit"
-msgstr ""
-"B-???????????????/???. ????????????????"
-
-msgid ""
-"Increase / decrease sensitivity for detecting Scene Changes to compensate "
-"for. Improves I-frame usage and helps quality"
-msgstr ""
-"????????????????????/???. I-?????????????"
-"??????"
-
-msgid "Informations"
-msgstr "??"
-
-msgid "Initial VBV buffer (%)"
-msgstr "??VBV????(%)"
-
-msgid "Input"
-msgstr "??"
-
-msgid "Int. BFF"
-msgstr "???? BFF"
-
-msgid "Int. TFF"
-msgstr "???? TFF"
-
-msgid "Interlace"
-msgstr "??????"
-
-msgid "Interlaced BFF"
-msgstr "?????? BFF"
-
-msgid "Interlaced TFF"
-msgstr "?????? TFF"
-
-msgid "Interlacing"
-msgstr "??????"
-
-msgid "Internal error"
-msgstr "?????"
-
-msgid "Internal error finding codec"
-msgstr "??????????????"
-
-msgid "Internal error opening codec"
-msgstr "???????????????"
-
-msgid "Interpolate :"
-msgstr "?? :"
-
-msgid "Invalid filename"
-msgstr "????????"
-
-msgid "Invalid jobname"
-msgstr "???????"
-
-msgid "JVT matrix"
-msgstr "JVT??????"
-
-msgid "Jobs"
-msgstr "???"
-
-msgid "Joint Stereo"
-msgstr "?????????"
-
-msgid ""
-"Jointly optimize both Motion Vector's in B-frames. This will improve quality "
-"but take more time for encoding"
-msgstr ""
-"B-????????????????????????. ????????????"
-"?????????????"
-
-msgid "Jump to _Time..."
-msgstr "?????(_T)"
-
-msgid "Keep nb of frames and fps"
-msgstr "??????FPS???"
-
-msgid "KeyFrame error"
-msgstr "?????? ???"
-
-msgid "Keyframe boost (%)"
-msgstr "???????? (%)"
-
-msgid "Last frame"
-msgstr "???????"
-
-msgid "Left:"
-msgstr "?:"
-
-msgid "Level"
-msgstr "???"
-
-msgid "Libavcodec Decoder Option"
-msgstr "Libavcodec ???? ?????"
-
-msgid "Link"
-msgstr "???"
-
-msgid "Load Custom Matrix:  "
-msgstr "??????????????:"
-
-msgid "Load external filters"
-msgstr "??????????"
-
-msgid "Local Playback Downmixing"
-msgstr "?????????????"
-
-msgid ""
-"Lossless compression method which usually improves the bitrate usage by 15% "
-"(especially on high bitrate). Helps the quality a lot but is slower. "
-msgstr ""
-"???????????(??????????)?15%??????????. ???"
-"?????????."
-
-msgid "Low bitrate scenes (%):"
-msgstr "?????????? (%):"
-
-msgid "Luma"
-msgstr "??"
-
-msgid "Luma :"
-msgstr "?? :"
-
-msgid "Luma Y"
-msgstr "?? Y"
-
-msgid "Luminance:"
-msgstr "??:"
-
-msgid "MB Comparison"
-msgstr "MB ??"
-
-msgid ""
-"MPEG quantizers (slightly slower) produce sharper picture (useful at higher "
-"bitrates)"
-msgstr ""
-"MPEG ???? (????) ???????????? (??????????)"
-
-msgid "Macroblock decision"
-msgstr "?????????"
-
-msgid "Macroblock decision:"
-msgstr "?????????:"
-
-msgid "Macroblock:"
-msgstr "???????:"
-
-msgid "Main"
-msgstr "??"
-
-msgid "Manual (db) : "
-msgstr "?? (db) : "
-
-msgid "Matrices"
-msgstr "??????"
-
-msgid "Matrix"
-msgstr "??????"
-
-msgid "Max"
-msgstr "??"
-
-msgid "Max Bitrate"
-msgstr "????????"
-
-msgid "Max Consecutive"
-msgstr "?????"
-
-msgid "Max IDR frame interval"
-msgstr "??IDR??????"
-
-msgid "Max QDiff"
-msgstr "?? QDiff"
-
-msgid "Max QP Step"
-msgstr "?? QP ????"
-
-msgid "Max Qp"
-msgstr "?? Qp"
-
-msgid "Max Qz"
-msgstr "?? Qz"
-
-msgid "Max bitrate (kbps) :"
-msgstr "???????? (kbps) :"
-
-msgid "Max overflow degradation (%):"
-msgstr "?????????? (%):"
-
-msgid "Max overflow improvement (%):"
-msgstr "?????????? (%):"
-
-msgid "Max. Ref. frames"
-msgstr "?????????"
-
-msgid "Max:"
-msgstr "??:"
-
-msgid "Maximum Bitrate (kb/s)"
-msgstr "???????? (kb/s)"
-
-msgid "Maximum local bitrate"
-msgstr "??????????"
-
-msgid "Maximum number of frames allowed between I-frames"
-msgstr "I-?????????????????"
-
-msgid ""
-"Maximum number of sequential B-frames (when set to 0, the original I/P "
-"encoder is used)"
-msgstr "????B-????? (0?????????I/P????????)"
-
-msgid "Maximum quantizer allowed for B-frames"
-msgstr "B-???????????????"
-
-msgid "Maximum quantizer allowed for I-frames"
-msgstr "I-???????????????"
-
-msgid "Maximum quantizer allowed for P-frames"
-msgstr "P-???????????????"
-
-msgid "Medium (full luma no chroma)"
-msgstr "????(????, ????)"
-
-msgid "Memory error"
-msgstr "??????"
-
-msgid "Message level"
-msgstr "????????"
-
-msgid "Method"
-msgstr "??"
-
-msgid "Metrics"
-msgstr "??????"
-
-msgid "Min Bitrate"
-msgstr "????????"
-
-msgid "Min IDR frame interval"
-msgstr "??IDR??????"
-
-msgid "Min Qp"
-msgstr "?? Qp"
-
-msgid "Min Qz"
-msgstr "?? Qz"
-
-msgid "Min bitrate (kbps) :"
-msgstr "???????? (kbps) :"
-
-msgid "Minimum Bitrate (kb/s) "
-msgstr "???????? (kb/s)"
-
-msgid "Minimum quantizer allowed for B-frames"
-msgstr "B-???????????????"
-
-msgid "Minimum quantizer allowed for I-frames"
-msgstr "I-???????????????"
-
-msgid "Minimum quantizer allowed for P-frames"
-msgstr "P-???????????????"
-
-msgid "Minimum space between I-frames, 1 will disable forced I-frame spacing"
-msgstr "I-???????????1 ???I-????????????????"
-
-msgid "Misc"
-msgstr "??"
-
-msgid "Miscellaneous"
-msgstr "??"
-
-msgid "Mixed Refs"
-msgstr "????"
-
-msgid "Mjpeg Codec settings"
-msgstr "Mjpeg???????"
-
-msgid "MntMode"
-msgstr "Mnt???"
-
-msgid "Mode"
-msgstr "???"
-
-msgid "Mode :"
-msgstr "??? :"
-
-msgid "Mono"
-msgstr "??"
-
-msgid "More"
-msgstr "??"
-
-msgid "Motion & Misc"
-msgstr "?????"
-
-msgid "Motion Estimation"
-msgstr "????"
-
-msgid "Motion search precision:"
-msgstr "??????:"
-
-msgid "MultiThreading"
-msgstr "???????"
-
-msgid "Mux Every x video frames"
-msgstr "N?????????????"
-
-msgid "Mux by packet size"
-msgstr "?????????"
-
-msgid "Mux every N video frames"
-msgstr "N??????????"
-
-msgid "Mux with block of size"
-msgstr "???????????????"
-
-msgid "Muxing Type"
-msgstr "??????"
-
-msgid "NONE"
-msgstr "??"
-
-msgid "NTSC (default is PAL)"
-msgstr "NTSC (?????? PAL)"
-
-msgid "Narrow"
-msgstr "??"
-
-msgid "Ne_xt Black Frame"
-msgstr "???????(_X)"
-
-msgid "Next _Intra Frame"
-msgstr "??I-????(_I)"
-
-msgid "Next black frame"
-msgstr "???????"
-
-msgid "Next frame"
-msgstr "??????"
-
-msgid "Next keyframe"
-msgstr "????????"
-
-msgid "No alerts"
-msgstr "?????"
-
-msgid "No audio track"
-msgstr "????????"
-
-msgid "No change"
-msgstr "????"
-
-msgid "No data"
-msgstr "?????"
-
-msgid "No downmixing"
-msgstr "?????????"
-
-msgid "No error found"
-msgstr "???????????"
-
-msgid "No link"
-msgstr "?????"
-
-msgid "No more supported."
-msgstr "????????????"
-
-msgid "Noise"
-msgstr "???"
-
-msgid "Noise Reduction"
-msgstr "?????"
-
-msgid "None"
-msgstr "??"
-
-msgid "Normal"
-msgstr "??"
-
-msgid "Not coded in this version"
-msgstr "????????????????????"
-
-msgid "Nothing to do."
-msgstr "???????."
-
-msgid "Nothing to save"
-msgstr "????????????"
-
-msgid "Number of B-frames:"
-msgstr "B-?????:"
-
-msgid "Number of BFrames"
-msgstr "B-?????"
-
-msgid "Number of threads"
-msgstr "?????"
-
-msgid "Obsolete"
-msgstr "??"
-
-msgid "Old format project file"
-msgstr "???????????????"
-
-msgid "Open CQM file"
-msgstr "CQM???????"
-
-msgid "Open a file"
-msgstr "???????"
-
-msgid "Open filter list [Ctrl-O]"
-msgstr "?????????? [Ctrl-O]"
-
-msgid "Order"
-msgstr "????"
-
-msgid "Out of memory"
-msgstr "??????"
-
-msgid "Output"
-msgstr "??"
-
-msgid "Output _file:"
-msgstr "??????(_F):"
-
-msgid "Output file error"
-msgstr "?????????"
-
-msgid "Output vobsub (.idx) :"
-msgstr "??VobSub (.idx) :"
-
-msgid "Overflow control strength (%):"
-msgstr "??????????? (%):"
-
-msgid "Overwrite file ?"
-msgstr "???????????? ?"
-
-msgid "P-frame quantizer - Min:"
-msgstr "P-???????? - ??:"
-
-msgid "P_review"
-msgstr "?????(_R)"
-
-msgid "P_revious Frame"
-msgstr "??????(_R)"
-
-msgid "Packed Bistream"
-msgstr "????????????"
-
-msgid "Packed bitstream"
-msgstr "????????????"
-
-msgid "Partition decision"
-msgstr "????"
-
-msgid "Partitions & Frames"
-msgstr "???????"
-
-msgid "Pause / Abort"
-msgstr "?? / ??"
-
-msgid "Pixel Aspect Ratio"
-msgstr "??????????"
-
-msgid "Pixel Height"
-msgstr "??????"
-
-msgid "Pixel Width"
-msgstr "?????"
-
-msgid "Play"
-msgstr "??"
-
-msgid "Please select or enter a valid filename"
-msgstr "?????????????????????"
-
-msgid "Postprocessing"
-msgstr "???"
-
-msgid "Pr_evious Intra Frame"
-msgstr "??I-????(_E)"
-
-msgid "Pre_ferences"
-msgstr "??(_F)"
-
-msgid "Predefined Aspect Ratios"
-msgstr "??????????"
-
-msgid "Preferences"
-msgstr "??"
-
-msgid "Previou_s Black Frame"
-msgstr "???????(_S)"
-
-msgid "Previous black frame"
-msgstr "???????"
-
-msgid "Previous frame"
-msgstr "??????"
-
-msgid "Previous keyframe"
-msgstr "????????"
-
-msgid "Problem loading sub"
-msgstr "????????"
-
-msgid "Problem opening the mpeg files"
-msgstr "MPEG???????????"
-
-msgid "Produces nicer-looking B-frames"
-msgstr "????????B-???????"
-
-msgid "Progressive"
-msgstr "???????"
-
-msgid "Proper_ties"
-msgstr "?????"
-
-msgid "PullDown dupe removal"
-msgstr "?????dupe??"
-
-msgid "Quality"
-msgstr "??"
-
-msgid "Quality "
-msgstr "??"
-
-msgid "Quantisation (2-31)"
-msgstr "??? (2-31)"
-
-msgid "Quantization"
-msgstr "???"
-
-msgid "Quantization difference between chroma (color) and luma (brightness)"
-msgstr "??(?)???(???)???????"
-
-msgid "Quantization factors used between I- and P- frames"
-msgstr "I- ?P- ???????????????"
-
-msgid "Quantization type"
-msgstr "??????"
-
-msgid "Quantization type:"
-msgstr "??????:"
-
-msgid "Quantization used between P- and B- frames"
-msgstr "P- ?B- ???????????????"
-
-msgid "Quantize blur"
-msgstr "??????"
-
-msgid "Quantize compression"
-msgstr "?????"
-
-msgid "Quantizer"
-msgstr "????"
-
-msgid "Quantizer (0-51):"
-msgstr "???? (0-51):"
-
-msgid "Quantizer Compression"
-msgstr "?????"
-
-msgid "Quantizer restrictions"
-msgstr "???????"
-
-msgid "Quantizer:"
-msgstr "????:"
-
-msgid "Quarter Pixel"
-msgstr "1/4 ????"
-
-msgid "Range"
-msgstr "??"
-
-msgid "Rate Control"
-msgstr "?????"
-
-msgid "Rate distortion"
-msgstr "??????"
-
-msgid "Rate distortion quantization, will find optimal encoding for each block"
-msgstr "??????????????????????????????"
-
-msgid "Ratecontrol"
-msgstr "?????"
-
-msgid "Reduce fluctuations in QP (after curve compression)"
-msgstr "(???????)QP????????"
-
-msgid "Reduced fluctuations in Quantizer (before curve compression)"
-msgstr "(???????)????????????"
-
-msgid ""
-"Reduction of bitrate for the first consecutive I-frames. The last I-frame "
-"will get treated normally"
-msgstr ""
-"?????I-?????????????. ???I-????????????"
-
-msgid "Replace (interpolate)"
-msgstr "??(??)"
-
-msgid "Resample to hz"
-msgstr "???????hz"
-
-msgid "Reset"
-msgstr "????"
-
-msgid "Resize"
-msgstr "????"
-
-msgid "Resume"
-msgstr "??"
-
-msgid "Retry"
-msgstr "???"
-
-msgid "Reuse log file ?"
-msgstr "?????????????? ?"
-
-msgid "Right:"
-msgstr "?:"
-
-msgid "Run all jobs"
-msgstr "???????"
-
-msgid "SVCD resolution [Ctrl-3]"
-msgstr "SVCD ??? [Ctrl-3]"
-
-msgid "S_ave..."
-msgstr "??(_A)"
-
-msgid "S_patial chroma strength:"
-msgstr "????????(_P):"
-
-msgid "Same Qz as input"
-msgstr "????????"
-
-msgid "Sample A/R "
-msgstr "???? A/R"
-
-msgid "Save Job"
-msgstr "??????"
-
-msgid "Save P_roject As..."
-msgstr "???????????????(_R)"
-
-msgid "Save _BMP Image..."
-msgstr "BMP?????(_B)"
-
-msgid "Save _JPEG Image..."
-msgstr "JPEG?????(_J)"
-
-msgid "Save _Project"
-msgstr "?????????(_P)"
-
-msgid "Save _Selection as JPEG images..."
-msgstr "???JPEG???????(_S)"
-
-msgid "Save _Video..."
-msgstr "?????(_V)"
-
-msgid "Save as script [Ctrl-J]"
-msgstr "?????????? [Ctrl-J]"
-
-msgid "Save filter list [Ctrl-S]"
-msgstr "?????????? [Ctrl-S]"
-
-msgid "Save the file"
-msgstr "?????????"
-
-msgid "Scene Cut Threshold"
-msgstr "????????"
-
-msgid "Scene change detect"
-msgstr "???????"
-
-msgid "Second Pass"
-msgstr "??????"
-
-msgid "Seeking"
-msgstr "????"
-
-msgid "Select"
-msgstr "??"
-
-msgid "Select  file to save "
-msgstr "???????????"
-
-msgid "Select .idx"
-msgstr ".idx???"
-
-msgid "Select .idx file"
-msgstr ".idx???????"
-
-msgid "Select 1-pass or 2-pass encoding"
-msgstr "1-???2-???????????"
-
-msgid "Select AC3 to load "
-msgstr "???AC3???"
-
-msgid "Select AVI file to append..."
-msgstr "????AVI???????..."
-
-msgid "Select AVI file..."
-msgstr "AVI???????..."
-
-msgid "Select Avi file to write"
-msgstr "???AVI???????"
-
-msgid "Select BMP to save "
-msgstr "????BMP???"
-
-msgid "Select Custom Matrix File to write"
-msgstr "????????????????????"
-
-msgid "Select Jpeg sequence to save "
-msgstr "????JPEG?????"
-
-msgid "Select Jpeg to save "
-msgstr "????JPEG???"
-
-msgid "Select Language :"
-msgstr "???? :"
-
-msgid "Select MP3 to load "
-msgstr "???MP3???"
-
-msgid "Select OGM file to write"
-msgstr "???OGM???????"
-
-msgid "Select SRT to save"
-msgstr "????SRT???"
-
-msgid "Select Sub"
-msgstr "?????"
-
-msgid "Select WAV to load "
-msgstr "???WAV???"
-
-msgid "Select Xvid matrix file to load"
-msgstr "???Xvid?????????????"
-
-msgid "Select background picture"
-msgstr "???????"
-
-msgid "Select color"
-msgstr "???"
-
-msgid "Select file to save"
-msgstr "???????????"
-
-msgid "Select file to save audio"
-msgstr "??????????????"
-
-msgid "Select postprocessing level"
-msgstr "?????????"
-
-msgid "Select raw file to save "
-msgstr "????raw???????"
-
-msgid "Select the output file"
-msgstr "?????????"
-
-msgid "Select workbench to save "
-msgstr "????workbench??"
-
-msgid "Selection: end"
-msgstr "??: ??"
-
-msgid "Selection: start"
-msgstr "??: ??"
-
-msgid "Sensibility"
-msgstr "??"
-
-msgid "Separate"
-msgstr "??"
-
-msgid "Set Marker _A"
-msgstr "????A???(_A)"
-
-msgid "Set Marker _B"
-msgstr "????B???(_B)"
-
-msgid "Set a common predefined aspect ratio"
-msgstr "???????????????????"
-
-msgid "Set a custom aspect ratio. Default 1:1 is recommended for most video."
-msgstr "???????????????. ?????1:1????????????"
-
-msgid ""
-"Set how many previous frames can be referenced by a P/B-frame. Numbers above "
-"5 do not seem to improve quality greatly. Numbers are 3 to 5 are recommended"
-msgstr ""
-"????????????P/B-?????????????. 5??????????"
-"?????????. 3??5?????"
-
-msgid "Set how much \"bitrate bonus\" a keyframe can get"
-msgstr "??????????????? \"??????????\" ???????"
-
-msgid ""
-"Set how much bitrate is deducted from a B-frame as compared to the previous "
-"P-frame"
-msgstr ""
-"?P-?????????B-????????????????????????"
-
-msgid ""
-"Set maximum frame interval between IDR frames. Defines the maximum amount a "
-"frame can be reused and referenced by other frames before a new clean one is "
-"established"
-msgstr ""
-"IDR???????????????????. ?????????????????"
-"?????????????????????????????????????"
-
-msgid ""
-"Set minimum frame interval between IDR frames. Defines the minimum amount a "
-"frame can be reused and referenced by other frames before a new clean one is "
-"established"
-msgstr ""
-"IDR???????????????????. ?????????????????"
-"?????????????????????????????????????"
-
-msgid "Set the amount of blurring to use for block edges when they are found"
-msgstr ""
-"??????????????????????????????????????"
-
-msgid "Set the amount of noise reduction"
-msgstr "???????????????"
-
-msgid ""
-"Set the maximum number of consecutive B-frames. This defines how many "
-"duplicate frames can be droped. Numbers 2 to 5 are recommended. This greatly "
-"improves the use of bitrate and quality"
-msgstr ""
-"??B-?????????????????. ?????????????????"
-"??. 2??5?????. ?????????????????????"
-
-msgid "Sharp :"
-msgstr "???? :"
-
-msgid "Sharpness"
-msgstr "?????"
-
-msgid "Shift (ms) :"
-msgstr "?? (ms) :"
-
-msgid "Shift:"
-msgstr "??:"
-
-msgid "Show _Joblist"
-msgstr "????????(_J)"
-
-msgid "Show _frame"
-msgstr "???????(_F)"
-
-msgid "Show _mask"
-msgstr "??????(_M)"
-
-msgid "Show builtin support"
-msgstr "?????????"
-
-msgid "Show metric in image (debug)"
-msgstr "????????????(?????)"
-
-msgid "Show motion Vectors"
-msgstr "?????????"
-
-msgid "Shrink factor"
-msgstr "???"
-
-msgid "Side"
-msgstr "???"
-
-msgid "Single Pass - Bitrate"
-msgstr "1-?? - ??????"
-
-msgid "Single Pass - Bitrate (Average)"
-msgstr "1-?? - ?????? (??)"
-
-msgid "Single Pass - Quality Quantizer (Average)"
-msgstr "1-?? - ?????? (??)"
-
-msgid "Single Pass - Quality Quantizer (Constant)"
-msgstr "1-?? - ?????? (??)"
-
-msgid "Single Pass - Quantizer"
-msgstr "1-?? - ????"
-
-msgid "Single pass - bitrate"
-msgstr "1-?? - ??????"
-
-msgid "Single pass - quantizer"
-msgstr "1-?? - ????"
-
-msgid "Single pass:Quantizer"
-msgstr "1-??: ????"
-
-msgid "Size mismatch"
-msgstr "?????????"
-
-msgid "Skip spatial temporal check"
-msgstr "??-???????????"
-
-msgid "Slow (full luma and chroma)"
-msgstr "??(???????)"
-
-msgid "Something failed"
-msgstr "?????????"
-
-msgid "Source :"
-msgstr "??? :"
-
-msgid "Spatial"
-msgstr "???"
-
-msgid "Split every MBytes"
-msgstr "MBytes????"
-
-msgid "Split mpegs every (MB)"
-msgstr "MPEG??? (MB)"
-
-msgid "Standard"
-msgstr "??"
-
-msgid "Stereo"
-msgstr "????"
-
-msgid "Stereo Front+Stero Rear"
-msgstr "???? ????+???? ??"
-
-msgid "Stereo+Center"
-msgstr "????+???"
-
-msgid "Stereo+Center+Surround"
-msgstr "????+???+?????"
-
-msgid "Stereo+Surround"
-msgstr "????+?????"
-
-msgid "Stop"
-msgstr "??"
-
-msgid "Strength :"
-msgstr "?? :"
-
-msgid "Strength:"
-msgstr "??:"
-
-msgid "Subtitle file "
-msgstr "??????"
-
-msgid "Subtitle selector"
-msgstr "??????"
-
-msgid "Subtitle to load"
-msgstr "?????"
-
-msgid "Subtitles"
-msgstr "??"
-
-msgid "Sure ?"
-msgstr "???"
-
-msgid "Sure you want to abort ?"
-msgstr "????????? ?"
-
-msgid "Swap U & V"
-msgstr "U?V???"
-
-msgid "Swap U&V"
-msgstr "U?V???"
-
-msgid "Swap UV"
-msgstr "UV?????"
-
-msgid "TTF font to use"
-msgstr "????TTF????"
-
-msgid "Target Bitrate (kb/s)   "
-msgstr "???????? (kb/s)"
-
-msgid "Target Size:"
-msgstr "?????:"
-
-msgid "Target video bitrate"
-msgstr "??????????"
-
-msgid "Temp. Blur of Quant after CC"
-msgstr "CC???????????"
-
-msgid "Temp. Blur of est Frame Complexity"
-msgstr "?????????????????"
-
-msgid "Temporal"
-msgstr "???"
-
-msgid "Temporal & Spatial check"
-msgstr "?????????"
-
-msgid ""
-"The beginning frame is not a key frame.\n"
-"Please move the A marker."
-msgstr ""
-"??????????????????????.\n"
-"????A????????."
-
-msgid "The custom matrix file has been successfully loaded."
-msgstr "????????????????????????"
-
-msgid ""
-"The higher this value, the more bits get assigned to frames below the "
-"average frame size"
-msgstr ""
-"?????????????????????????????????????"
-
-msgid ""
-"The higher this value, the more bits get taken from frames larger than the "
-"average size, and redistributed to others"
-msgstr ""
-"??????????????????????????????????????"
-"??????????"
-
-msgid ""
-"The number of channels is greater than what the selected audio codec can "
-"do.\n"
-"Either change codec or use the mixer filter to have less channels."
-msgstr ""
-"????????????????????????????.\n"
-"??????????????????????????????????????"
-"??."
-
-msgid "There is no audio track"
-msgstr "????????????"
-
-msgid "There is no jobs stored, nothing to do"
-msgstr "????????????????"
-
-msgid "There is no second track"
-msgstr "????????????"
-
-msgid "This is not MPEG compatible"
-msgstr "???MPEG?????????"
-
-msgid "Threshold"
-msgstr "??"
-
-msgid "Threshold 1"
-msgstr "?? 1"
-
-msgid "Threshold 2"
-msgstr "?? 2"
-
-msgid "Threshold :"
-msgstr "?? :"
-
-msgid "Time left :"
-msgstr "???? :"
-
-msgid "Time: "
-msgstr "??:"
-
-msgid "Timecode :"
-msgstr "?????? :"
-
-msgid "Timeshift"
-msgstr "????"
-
-msgid "Top"
-msgstr "???"
-
-msgid "Top Field First"
-msgstr "??????????"
-
-msgid "Top Field first"
-msgstr "??????????"
-
-msgid "Top field (keep bottom)"
-msgstr "????????(??????)"
-
-msgid "Top:"
-msgstr "?:"
-
-msgid "Total size (MB):"
-msgstr "????? (MB):"
-
-msgid "Track _1:"
-msgstr "???? _1:"
-
-msgid "Track _2: "
-msgstr "???? _2: "
-
-msgid "Transform"
-msgstr "??"
-
-msgid "Turbo Mode"
-msgstr "??????"
-
-msgid "Two Pass (bitrate) "
-msgstr "2-?? (??????)"
-
-msgid "Two Pass (filesize) "
-msgstr "2-?? (???????)"
-
-msgid "Two Pass - Average bitrate"
-msgstr "2-?? - ????????"
-
-msgid "Two Pass - File Size"
-msgstr "2-?? - ???????"
-
-msgid "Two pass"
-msgstr "2-??"
-
-msgid "Two pass tuning"
-msgstr "2????"
-
-msgid "Two pass, average bitrate"
-msgstr "2-??, ????????"
-
-msgid "Two pass, final size"
-msgstr "2-??, ?????"
-
-msgid "Two pass-Avg bitrate"
-msgstr "2??-????????"
-
-msgid "Two pass-filesize"
-msgstr "2??-???????"
-
-msgid "Type"
-msgstr "???"
-
-msgid "Type :"
-msgstr "??? :"
-
-msgid "U Shift :"
-msgstr "U ???:"
-
-msgid "UV to Y link"
-msgstr "UV?Y????"
-
-msgid "Uncheck to enable fast p-skip"
-msgstr "??????????P-??????????"
-
-msgid "Uneven multi hexagon"
-msgstr "????????"
-
-msgid "Unknown flag :"
-msgstr "????? :"
-
-msgid "Unsupported"
-msgstr "?????"
-
-msgid "Use 4 motion vectors per macroblock, might give better compression"
-msgstr "??????????4?????????????????????"
-
-msgid "Use Chroma to evalute"
-msgstr "????????"
-
-msgid "Use Quarter pixel resolution for a more precise motion estimation"
-msgstr "??????????1/4 ??????????"
-
-msgid "Use Xvid Rate Control"
-msgstr "Xvid????????"
-
-msgid "Use Xvid ratecontrol"
-msgstr "Xvid????????"
-
-msgid "Use alternative tag for mp3 in .mp4"
-msgstr ".mp4?mp3????????"
-
-msgid "Use as reference"
-msgstr "???????"
-
-msgid "Use chroma information to estimate motion"
-msgstr "????????????"
-
-msgid ""
-"Use fewer B-frame if needed. This is always recommended. If not enabled, the "
-"codec will always use the maximum number of consecutive B-frames"
-msgstr ""
-"?????????B-???????. ???????????. ????????"
-"?????????????B-????????????"
-
-msgid "Use lavcodec mpeg2 decoder"
-msgstr "lavcodec MPEG2 ???????"
-
-msgid "Use linear blend ?"
-msgstr "????????????? ?"
-
-msgid ""
-"Use rate distortion quantization to find optimal encoding for each block. "
-"Level 0 equals disabled, level 1 equals normal and level 2 equals high"
-msgstr ""
-"????????????????????????????. ???0??????"
-"??1????????2?????????"
-
-msgid "Use systray while encoding"
-msgstr "????????????????"
-
-msgid "User Interface"
-msgstr "??????????"
-
-msgid ""
-"Uses chroma (color) components for motion for compression and helps the "
-"quality"
-msgstr "?????(?)????????????????????"
-
-msgid "V Shift :"
-msgstr "V ???:"
-
-msgid "VBR (Quality based)"
-msgstr "VBR (??????)"
-
-msgid "VBV buffer size"
-msgstr "VBV???????"
-
-msgid "VCD resolution [Ctrl-4]"
-msgstr "VCD  ??? [Ctrl-4]"
-
-msgid "VHQ enables an additional search process to increase quality"
-msgstr "VHQ ???????????????????"
-
-msgid "VHQ mode:"
-msgstr "VHQ ???:"
-
-msgid "Variable bitrate mode"
-msgstr "???????????"
-
-msgid "Vertical deblocking"
-msgstr "???????"
-
-msgid "Vi_deo"
-msgstr "??(_D)"
-
-msgid "Video"
-msgstr "??"
-
-msgid "Video Display"
-msgstr "????"
-
-msgid "Video Duration  "
-msgstr "????"
-
-msgid "Video Filter Manager"
-msgstr "?? ???? ?????"
-
-msgid "Video bitrate:"
-msgstr "????????:"
-
-msgid "Video encoder"
-msgstr "???????"
-
-msgid "Video filters"
-msgstr "??????"
-
-msgid "Video size (MB):"
-msgstr "????? (MB):"
-
-msgid "Video stream :"
-msgstr "??????? :"
-
-msgid "VideoCodec"
-msgstr "???????"
-
-msgid "Vignette Height"
-msgstr "??????"
-
-msgid "Vignette Width"
-msgstr "?????"
-
-msgid "VobSub Settings"
-msgstr "VobSub???"
-
-msgid "Volume control"
-msgstr "????"
-
-msgid "Weighted biprediction"
-msgstr "???????"
-
-msgid ""
-"Width is not a multiple of 8\n"
-" continue anyway ?"
-msgstr ""
-"??8??????????\n"
-" ????????? ?"
-
-msgid "Wrong output format"
-msgstr "???????"
-
-msgid "Wrong video codec"
-msgstr "??????????"
-
-msgid "X264 configuration"
-msgstr "X264 ??"
-
-msgid "XVCD encoding"
-msgstr "XVCD ?????"
-
-msgid "XviD encoding options"
-msgstr "XviD??????????"
-
-msgid "Y to UV link"
-msgstr "Y?UV????"
-
-msgid "Z_oom 1:2"
-msgstr "??? 1:2 (_O)"
-
-msgid "Zoom _1:1"
-msgstr "??? 1:1 (_1)"
-
-msgid "Zoom _2:1"
-msgstr "??? 2:1 (_2)"
-
-msgid "Zoom _4:1"
-msgstr "??? 4:1 (_4)"
-
-msgid "_A/V Sidebar"
-msgstr "A/V??????(_A)"
-
-msgid "_About"
-msgstr "Avidemux????(_A)"
-
-msgid "_Append..."
-msgstr "??(_A)"
-
-msgid "_Aspect ratio"
-msgstr "??????(_A)"
-
-msgid "_Audio"
-msgstr "??(_A)"
-
-msgid "_Bitrate Histogram"
-msgstr "?????? ??????(_B)"
-
-msgid "_Bottom margin"
-msgstr "???(_B)"
-
-msgid "_Build VBR Time Map"
-msgstr "VBR?????????(_B)"
-
-msgid "_Calculator"
-msgstr "??(_C)"
-
-msgid "_Contrast:"
-msgstr "??????(_C):"
-
-msgid "_Copy"
-msgstr "???(_C)"
-
-msgid "_Custom Matrix"
-msgstr "??????????(_C)"
-
-msgid "_Custom size (MB):"
-msgstr "???????(_C) (MB):"
-
-msgid "_Decoder Options"
-msgstr "?????????(_D)"
-
-msgid "_Delete"
-msgstr "??(_D)"
-
-msgid "_Deringing"
-msgstr "????(_D)"
-
-msgid "_Edit"
-msgstr "??(_E)"
-
-msgid "_Encoder"
-msgstr "?????(_E)"
-
-msgid "_Extra"
-msgstr "??(_E)"
-
-msgid "_Field dominance:"
-msgstr "???????(_F):"
-
-msgid "_Field order:"
-msgstr "?????????(_F):"
-
-msgid "_File"
-msgstr "????(_F)"
-
-msgid "_Filter strength:"
-msgstr "???????(_F):"
-
-msgid "_Filters"
-msgstr "????(_F)"
-
-msgid "_First Frame"
-msgstr "???????(_F)"
-
-msgid "_Font scale"
-msgstr "????????(_F)"
-
-msgid "_Format:"
-msgstr "??(_F):"
-
-msgid "_Frame Rate"
-msgstr "???????(_F)"
-
-msgid "_Go"
-msgstr "??(_G)"
-
-msgid "_Greyscale"
-msgstr "???????(_G)"
-
-msgid "_Help"
-msgstr "???(_H)"
-
-msgid "_High quality"
-msgstr "???(_H)"
-
-msgid "_Horizontal deblocking"
-msgstr "???????(_H)"
-
-msgid "_Horizontal stacking:"
-msgstr "??????(_H):"
-
-msgid "_Identical:"
-msgstr "??(_I):"
-
-msgid "_Interlaced"
-msgstr "??????(_I)"
-
-msgid "_Job name:"
-msgstr "????(_J)"
-
-msgid "_Jump to Frame..."
-msgstr "???????(_J)"
-
-msgid "_Last Frame"
-msgstr "???????(_L)"
-
-msgid "_Line spacing"
-msgstr "???????(_L)"
-
-msgid "_Load/Run Project..."
-msgstr "??????????/??(_L)"
-
-msgid "_Main Toolbar"
-msgstr "??????(_M)"
-
-msgid "_Main Track"
-msgstr "?????(_M)"
-
-msgid "_Mask"
-msgstr "??? (_M)"
-
-msgid "_Medium:"
-msgstr "????(_M):"
-
-msgid "_Mode:"
-msgstr "???(_M):"
-
-msgid "_Next Frame"
-msgstr "??????(_N)"
-
-msgid "_Noise:"
-msgstr "???(_N):"
-
-msgid "_Open..."
-msgstr "??(_O)"
-
-msgid "_Paste"
-msgstr "????(_P)"
-
-msgid "_Play/Stop"
-msgstr "??/??(_P)"
-
-msgid "_Postprocessing"
-msgstr "???(_P)"
-
-msgid "_Preview"
-msgstr "?????(_P)"
-
-msgid "_Quantizer:"
-msgstr "????(_Q):"
-
-msgid "_Quit"
-msgstr "??(_Q)"
-
-msgid "_Rebuild Frames (I & B)"
-msgstr "????(I?B)????(_R)"
-
-msgid "_Reset Edits"
-msgstr "???????(_R)"
-
-msgid "_Saturation:"
-msgstr "???(_S):"
-
-msgid "_Save"
-msgstr "??(_S)"
-
-msgid "_Scan for Black Frames..."
-msgstr "??????????(_S)"
-
-msgid "_Second Track"
-msgstr "??????(_S)"
-
-msgid "_Show metrics"
-msgstr "??????(_S)"
-
-msgid "_Shrink factor:"
-msgstr "???(_S):"
-
-msgid "_Spatial luma strength:"
-msgstr "????????(_S):"
-
-msgid "_Strength:"
-msgstr "??(_S):"
-
-msgid "_Subtitle file (ass/ssa)"
-msgstr "??????(_S) (ass/ssa)"
-
-msgid "_Temporal strength:"
-msgstr "?????(_T):"
-
-msgid "_Threshold:"
-msgstr "??(_T):"
-
-msgid "_Tools"
-msgstr "???(_T)"
-
-msgid "_Top margin"
-msgstr "???(_T)"
-
-msgid "_Trellis quantization"
-msgstr "_Trellis ???"
-
-msgid "_Vertical deblocking"
-msgstr "???????(_V)"
-
-msgid "_Vertical stacking:"
-msgstr "??????(_V):"
-
-msgid "_View"
-msgstr "??(_V)"
-
-msgid "_Zoom 1:4"
-msgstr "??? 1:4 (_Z)"
-
-msgid "font"
-msgstr "????"
-
-msgid "identical"
-msgstr "??"
-
-msgid "label5"
-msgstr "???5"
-
-msgid "label6"
-msgstr "???6"
-
-msgid "label7"
-msgstr "???7"
-
-msgid "motion Threshold, Chroma"
-msgstr "????, ??"
-
-msgid "motion Threshold, Luma"
-msgstr "????, ??"
-
-msgid "noise"
-msgstr "???"
-
-msgid "show"
-msgstr "??"
-
-msgid "threshold"
-msgstr "??"
-
-msgid "translator-credits"
-msgstr "tetsuro"

Modified: branches/avidemux_2.4_branch/po/klingon.po
===================================================================
--- branches/avidemux_2.4_branch/po/klingon.po	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/klingon.po	2007-04-20 20:50:28 UTC (rev 2955)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: klingon\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-10-04 22:09+0300\n"
+"POT-Creation-Date: 2006-12-07 19:20+0100\n"
 "PO-Revision-Date: 2003-03-23 21:15+0000\n"
 "Last-Translator: \n"
 "Language-Team: fr_FR <en at li.org>\n"
@@ -78,19 +78,19 @@
 "Either change codec or use the mixer filter to have less channels."
 msgstr ""
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:567
+#: avidemux/ADM_nuv/ADM_nuv.cpp:568
 msgid "Sure you want to abort ?"
 msgstr ""
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Size mismatch"
 msgstr ""
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Expect a crash."
 msgstr ""
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:1070
+#: avidemux/ADM_nuv/ADM_nuv.cpp:1071
 msgid "Do you want to save an index ?"
 msgstr ""
 
@@ -1118,7 +1118,7 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_idx_pg.cpp:174
-#: avidemux/ADM_dialog/DIA_working.cpp:249
+#: avidemux/ADM_dialog/DIA_working.cpp:257
 msgid "Time left :"
 msgstr ""
 
@@ -1166,7 +1166,7 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_enter.cpp:223
-#: avidemux/ADM_dialog/DIA_working.cpp:236 avidemux/ADM_dialog/DIA_d3d.cpp:93
+#: avidemux/ADM_dialog/DIA_working.cpp:244 avidemux/ADM_dialog/DIA_d3d.cpp:93
 #: avidemux/ADM_dialog/DIA_4entries.cpp:88
 msgid "dialog1"
 msgstr ""
@@ -1226,11 +1226,16 @@
 msgid "Recent files"
 msgstr ""
 
-#: avidemux/ADM_dialog/DIA_working.cpp:254
+#: avidemux/ADM_dialog/DIA_working.cpp:168
+#, c-format
+msgid " %d m %d s left"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_working.cpp:262
 msgid "0:0:0"
 msgstr ""
 
-#: avidemux/ADM_dialog/DIA_busy.cpp:102
+#: avidemux/ADM_dialog/DIA_busy.cpp:120
 msgid "Busy"
 msgstr ""
 
@@ -2997,6 +3002,7 @@
 msgid "Band"
 msgstr ""
 
+#. TRANSLATORS: Replace this string with your names, one name per line.
 #: avidemux/ADM_dialog/DIA_about.cpp:56
 msgid "translator-credits"
 msgstr ""
@@ -5360,15 +5366,15 @@
 msgid "MPEG renumbering error"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:486
+#: avidemux/ADM_3gp/ADM_3gp.cpp:488
 msgid "Expect troubles"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:929
+#: avidemux/ADM_3gp/ADM_3gp.cpp:972
 msgid "Problem reading SVQ3 headers"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:1457
+#: avidemux/ADM_3gp/ADM_3gp.cpp:1524
 msgid "No stts table"
 msgstr ""
 
@@ -5860,7 +5866,7 @@
 msgstr ""
 
 #: avidemux/gui_navigate.cpp:78 avidemux/gui_navigate.cpp:119
-#: avidemux/gui_navigate.cpp:381 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:392 avidemux/gui_navigate.cpp:434
 msgid "Decompressing error"
 msgstr ""
 
@@ -5868,11 +5874,15 @@
 msgid "Cannot decode next frame."
 msgstr ""
 
-#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:434
 msgid "Cannot decode keyframe."
 msgstr ""
 
-#: avidemux/gui_navigate.cpp:381
+#: avidemux/gui_navigate.cpp:237
+msgid "Seeking"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:392
 msgid "Cannot decode the frame."
 msgstr ""
 
@@ -6348,20 +6358,12 @@
 msgid "It is not MPEG-4 video. File will not be saved."
 msgstr ""
 
-#: avidemux/gui_savenew.cpp:308
+#: avidemux/gui_savenew.cpp:311
 msgid ""
 "You may need smart copy.\n"
 " Enable it ?"
 msgstr ""
 
-#: avidemux/gui_savenew.cpp:333
-msgid "No encoder"
-msgstr ""
-
-#: avidemux/gui_savenew.cpp:333
-msgid "Cannot save in process mode."
-msgstr ""
-
 #: avidemux/guiplay.cpp:384
 msgid "Trouble initializing audio device"
 msgstr ""

Modified: branches/avidemux_2.4_branch/po/ru.po
===================================================================
--- branches/avidemux_2.4_branch/po/ru.po	2007-04-20 18:58:28 UTC (rev 2954)
+++ branches/avidemux_2.4_branch/po/ru.po	2007-04-20 20:50:28 UTC (rev 2955)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: ru\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-10-04 22:09+0300\n"
+"POT-Creation-Date: 2006-12-07 19:20+0100\n"
 "PO-Revision-Date: 2006-10-05 10:42+0300\n"
 "Last-Translator: Mihail Zenkov <kreator at tut.by>\n"
 "Language-Team: Russian <ru at li.org>\n"
@@ -87,19 +87,19 @@
 "??????????? ?????? ????? ??? ??????????? ?????? ?????? ??? ?????????? "
 "?????????? ???????."
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:567
+#: avidemux/ADM_nuv/ADM_nuv.cpp:568
 msgid "Sure you want to abort ?"
 msgstr "?? ???????, ??? ?????? ?????????"
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Size mismatch"
 msgstr "?????? ?? ?????????"
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:778
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
 msgid "Expect a crash."
 msgstr "???????? ????."
 
-#: avidemux/ADM_nuv/ADM_nuv.cpp:1070
+#: avidemux/ADM_nuv/ADM_nuv.cpp:1071
 msgid "Do you want to save an index ?"
 msgstr "?????? ????????? ???????"
 
@@ -506,7 +506,8 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:880
-msgid "Higher settings give higher quality results, at the cost of slower encoding"
+msgid ""
+"Higher settings give higher quality results, at the cost of slower encoding"
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:884 avidemux/ADM_dialog/DIA_xvid.cpp:357
@@ -635,7 +636,8 @@
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:1021
 #: avidemux/ADM_dialog/DIA_lavcodec.cpp:792
-msgid "Global Motion Compensation can save bits on camera pans, zooming and rotation"
+msgid ""
+"Global Motion Compensation can save bits on camera pans, zooming and rotation"
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_xvid4.cpp:1023
@@ -1129,7 +1131,7 @@
 msgstr "??????????????..."
 
 #: avidemux/ADM_dialog/DIA_idx_pg.cpp:174
-#: avidemux/ADM_dialog/DIA_working.cpp:249
+#: avidemux/ADM_dialog/DIA_working.cpp:257
 msgid "Time left :"
 msgstr "??????? ????????:"
 
@@ -1177,7 +1179,7 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_enter.cpp:223
-#: avidemux/ADM_dialog/DIA_working.cpp:236 avidemux/ADM_dialog/DIA_d3d.cpp:93
+#: avidemux/ADM_dialog/DIA_working.cpp:244 avidemux/ADM_dialog/DIA_d3d.cpp:93
 #: avidemux/ADM_dialog/DIA_4entries.cpp:88
 msgid "dialog1"
 msgstr ""
@@ -1237,11 +1239,16 @@
 msgid "Recent files"
 msgstr "??????? ???????? ?????"
 
-#: avidemux/ADM_dialog/DIA_working.cpp:254
+#: avidemux/ADM_dialog/DIA_working.cpp:168
+#, c-format
+msgid " %d m %d s left"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_working.cpp:262
 msgid "0:0:0"
 msgstr ""
 
-#: avidemux/ADM_dialog/DIA_busy.cpp:102
+#: avidemux/ADM_dialog/DIA_busy.cpp:120
 msgid "Busy"
 msgstr "?????"
 
@@ -2352,7 +2359,8 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_deblend.cpp:167
-msgid "If pixels are closer than noise threshold, they are considered identical"
+msgid ""
+"If pixels are closer than noise threshold, they are considered identical"
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_deblend.cpp:176
@@ -2841,7 +2849,8 @@
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1073
-msgid "Define how much the quantizer rate can change between two consecutive frames"
+msgid ""
+"Define how much the quantizer rate can change between two consecutive frames"
 msgstr ""
 
 #: avidemux/ADM_dialog/DIA_x264.cpp:1076
@@ -3005,6 +3014,7 @@
 msgid "Band"
 msgstr ""
 
+#. TRANSLATORS: Replace this string with your names, one name per line.
 #: avidemux/ADM_dialog/DIA_about.cpp:56
 msgid "translator-credits"
 msgstr ""
@@ -4008,7 +4018,8 @@
 
 #: avidemux/ADM_dialog/DIA_jobs_save.cpp:153
 msgid "Job name displayed in the job list and used as the script filename"
-msgstr "??? ??????? ???????????? ? ?????? ??????? ? ???????????? ??? ??? ???????."
+msgstr ""
+"??? ??????? ???????????? ? ?????? ??????? ? ???????????? ??? ??? ???????."
 
 #: avidemux/ADM_dialog/DIA_jobs_save.cpp:162
 msgid "Filename of the audio/video output"
@@ -5364,15 +5375,15 @@
 msgid "MPEG renumbering error"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:486
+#: avidemux/ADM_3gp/ADM_3gp.cpp:488
 msgid "Expect troubles"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:929
+#: avidemux/ADM_3gp/ADM_3gp.cpp:972
 msgid "Problem reading SVQ3 headers"
 msgstr ""
 
-#: avidemux/ADM_3gp/ADM_3gp.cpp:1457
+#: avidemux/ADM_3gp/ADM_3gp.cpp:1524
 msgid "No stts table"
 msgstr ""
 
@@ -5868,7 +5879,7 @@
 msgstr ""
 
 #: avidemux/gui_navigate.cpp:78 avidemux/gui_navigate.cpp:119
-#: avidemux/gui_navigate.cpp:381 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:392 avidemux/gui_navigate.cpp:434
 msgid "Decompressing error"
 msgstr "?????? ??? ??????????"
 
@@ -5876,11 +5887,15 @@
 msgid "Cannot decode next frame."
 msgstr "?????????? ???????????? ????????? ????."
 
-#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:423
+#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:434
 msgid "Cannot decode keyframe."
 msgstr "?????????? ???????????? ???????? ????."
 
-#: avidemux/gui_navigate.cpp:381
+#: avidemux/gui_navigate.cpp:237
+msgid "Seeking"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:392
 msgid "Cannot decode the frame."
 msgstr "?????????? ???????????? ????."
 
@@ -6055,7 +6070,8 @@
 msgstr "?????????? ????????? ????? ? ?????? '??????????'"
 
 #: avidemux/gtk_gui.cpp:1295
-msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
+msgid ""
+"Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "???????? WAV PCM ??? ?????, ????? ????? ????? raw PCM."
 
 #: avidemux/gtk_gui.cpp:1303 avidemux/gtk_gui.cpp:1787
@@ -6207,7 +6223,8 @@
 
 #: avidemux/gtk_gui.cpp:2469
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
-msgstr "?????? ??? ??????????. ????????, ? ??? ???????? ????? ??????? ? ~/.avidemux."
+msgstr ""
+"?????? ??? ??????????. ????????, ? ??? ???????? ????? ??????? ? ~/.avidemux."
 
 #: avidemux/gtk_gui.cpp:2481
 #, c-format
@@ -6328,7 +6345,8 @@
 
 #: avidemux/gui_savenew.cpp:86
 msgid "Dual audio can only be used in copy mode"
-msgstr "??? ???????? ??????? ????? ???? ???????????? ?????? ? ?????? ???????????."
+msgstr ""
+"??? ???????? ??????? ????? ???? ???????????? ?????? ? ?????? ???????????."
 
 #: avidemux/gui_savenew.cpp:86
 msgid "Select Copy as the video codec."
@@ -6359,21 +6377,18 @@
 msgid "It is not MPEG-4 video. File will not be saved."
 msgstr "??? ?? MPEG-4 ?????. ???? ?? ????? ????????."
 
-#: avidemux/gui_savenew.cpp:308
+#: avidemux/gui_savenew.cpp:311
 msgid ""
 "You may need smart copy.\n"
 " Enable it ?"
 msgstr "????????, ??? ????? '?????' ???????????? ?????????"
 
-#: avidemux/gui_savenew.cpp:333
-msgid "No encoder"
-msgstr "??? ??????."
-
-#: avidemux/gui_savenew.cpp:333
-msgid "Cannot save in process mode."
-msgstr "?????????? ???????? ?????? ? ?????? ???????????."
-
 #: avidemux/guiplay.cpp:384
 msgid "Trouble initializing audio device"
 msgstr "???????? ??? ????????????? ???????????????."
 
+#~ msgid "No encoder"
+#~ msgstr "??? ??????."
+
+#~ msgid "Cannot save in process mode."
+#~ msgstr "?????????? ???????? ?????? ? ?????? ???????????."



From mean at mail.berlios.de  Mon Apr 23 19:19:45 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 23 Apr 2007 19:19:45 +0200
Subject: [Avidemux-svn-commit] r2956 - in
	branches/avidemux_2.4_branch/addons: . mkvscan
Message-ID: <200704231719.l3NHJjDP016947@sheep.berlios.de>

Author: mean
Date: 2007-04-23 19:19:44 +0200 (Mon, 23 Apr 2007)
New Revision: 2956

Added:
   branches/avidemux_2.4_branch/addons/mkvscan/
   branches/avidemux_2.4_branch/addons/mkvscan/Makefile
   branches/avidemux_2.4_branch/addons/mkvscan/ebml.cpp
   branches/avidemux_2.4_branch/addons/mkvscan/mkv_c.cpp
   branches/avidemux_2.4_branch/addons/mkvscan/mkv_tags.cpp
Log:
new utility to scan mkv files

Added: branches/avidemux_2.4_branch/addons/mkvscan/Makefile
===================================================================
--- branches/avidemux_2.4_branch/addons/mkvscan/Makefile	2007-04-20 20:50:28 UTC (rev 2955)
+++ branches/avidemux_2.4_branch/addons/mkvscan/Makefile	2007-04-23 17:19:44 UTC (rev 2956)
@@ -0,0 +1,9 @@
+CFLAGS=-g3 -I../../avidemux/ADM_inputs/ADM_matroska
+LDFLAGS=-g
+OBJS=ebml.o mkv_c.o mkv_tags.o
+%.o:%.cpp 
+	$(CXX) -o $@  $< -c $(CFLAGS)
+mkv: $(OBJS)
+	$(CXX) -o $@ $(OBJS) $(LDFLAGS)
+clean:
+	rm $(OBJS) mkv

Added: branches/avidemux_2.4_branch/addons/mkvscan/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/addons/mkvscan/ebml.cpp	2007-04-20 20:50:28 UTC (rev 2955)
+++ branches/avidemux_2.4_branch/addons/mkvscan/ebml.cpp	2007-04-23 17:19:44 UTC (rev 2956)
@@ -0,0 +1,231 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdint.h>
+#include <assert.h>
+#define ADM_assert assert
+#include "ADM_ebml.h"
+#define aprintf(...) {}
+
+/*
+  It is slow , optimize later
+*/  
+
+uint8_t    ADM_ebml::readElemId(uint64_t *code,uint64_t *len)
+{
+  *code=readEBMCode_Full(); // Keep the length-bits, easier to match with documentation
+  *len=readEBMCode();
+  return 1;
+}
+
+/**
+      \fn       readEBMCode
+      \brief    Returns unsigned integer
+*/
+
+uint64_t    ADM_ebml::readEBMCode(void)
+{
+ uint64_t start=readu8();
+  uint64_t val;      
+  uint32_t mask=0x80,outmask=0x7F,more=0;
+  
+  aprintf("Start :%x at %llx\n",start,tell()-1);
+  
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  outmask=mask-1;
+  start=start&outmask;
+  for(int i=0;i<more;i++)
+  {
+    start=(start<<8)+readu8(); 
+  }
+  aprintf("End at %llx\n",tell());
+  return start;
+}
+/**
+      \fn       readEBMCode
+      \brief    Returns unsigned integer
+*/
+
+int64_t    ADM_ebml::readEBMCode_Signed(void)
+{
+  uint8_t start=readu8();
+  int64_t val;      
+  uint32_t mask=0x80,outmask=0x7F,more=0;
+  
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  outmask=mask-1;
+  val=start&outmask;
+  for(int i=0;i<more;i++)
+  {
+    val=(val<<8)+readu8(); 
+  }
+  // Signed !
+  //FIXME
+  return val;
+}
+/**
+      \fn       readEBMCode_Full
+      \brief    Returns complete code, including size-bits (used only for EBML_ID)
+*/
+uint64_t    ADM_ebml::readEBMCode_Full(void)
+{
+  uint64_t start=readu8();
+  uint32_t mask=0x80,more=0;
+  aprintf(">>StartFull :%x at %llx\n",start,tell()-1);
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  for(int i=0;i<more;i++)
+  {
+    start=(start<<8)+readu8(); 
+  }
+  return start;
+}
+
+uint64_t    ADM_ebml::readUnsignedInt(uint32_t nb) 
+{
+  uint64_t val=0;
+  for(int i=0;i<nb;i++)
+  {
+    val=(val<<8)+readu8(); 
+  }
+  return val;
+}
+int64_t    ADM_ebml::readSignedInt(uint32_t nb) 
+{
+  return 0;
+}
+uint8_t     ADM_ebml::readString(char *string, uint32_t maxLen)
+{
+  uint8_t v;
+  while(maxLen--)
+  {
+    v=*string++=readu8();
+    if(!v) return 1;
+  }
+  *string=0;
+  return 1;  
+}
+/******************
+  Low level read
+**********************/
+
+
+uint8_t ADM_ebml::readu8(void)
+{
+  uint8_t v;
+    readBin(&v,1);
+    return v;
+}
+uint16_t ADM_ebml::readu16(void)
+{
+  uint8_t v[2];
+    readBin(v,2);
+    return (uint16_t)(v[0]<<8)+v[1];
+}
+ADM_ebml::ADM_ebml(void)
+{
+  
+}
+ADM_ebml::~ADM_ebml()
+{
+  
+}
+
+
+//*******************************************
+//***********FILE IO PART *******************
+//*******************************************
+ADM_ebml_file::ADM_ebml_file(ADM_ebml_file *father,uint32_t size)
+{
+  _close=0;
+  _size=size;
+  fp=father->fp;
+   _begin=ftello(fp);
+}
+ADM_ebml_file::ADM_ebml_file(void) : ADM_ebml()
+{
+  
+}
+ADM_ebml_file::~ADM_ebml_file()
+{
+  ADM_assert(fp);
+  if(_close) fclose(fp);
+  else fseeko(fp,_begin+_size,SEEK_SET);
+  fp=NULL; 
+}
+uint8_t ADM_ebml_file::open(const char *name)
+{
+  _close=1;
+  fp=fopen(name,"rb");
+  if(!fp) 
+  {
+    aprintf("[EBML FILE] Failed to open <%s>\n",name);
+    return 0;
+  }
+  fseeko(fp,0,SEEK_END);
+  _begin=0;
+  _size=ftello(fp);
+  fseeko(fp,0,SEEK_SET);
+  return 1;
+}
+uint8_t  ADM_ebml_file::readBin(uint8_t *whereto,uint32_t len)
+{
+  ADM_assert(fp);
+  if(!fread(whereto,len,1,fp)) return 0;
+  return 1;
+}
+
+uint8_t ADM_ebml_file::skip(uint32_t vv)
+{
+  fseeko(fp,vv,SEEK_CUR);
+  return 1; 
+}
+uint64_t ADM_ebml_file::tell(void)
+{
+  return ftello(fp);
+}
+uint8_t ADM_ebml_file::seek(uint64_t pos)
+{
+  fseeko(fp,pos,SEEK_SET);
+  return 1;
+}
+uint8_t ADM_ebml_file::finished(void)
+{
+  if(tell()>(_begin+_size-4)) return 1;
+  return 0; 
+}
+//EOF

Added: branches/avidemux_2.4_branch/addons/mkvscan/mkv_c.cpp
===================================================================
--- branches/avidemux_2.4_branch/addons/mkvscan/mkv_c.cpp	2007-04-20 20:50:28 UTC (rev 2955)
+++ branches/avidemux_2.4_branch/addons/mkvscan/mkv_c.cpp	2007-04-23 17:19:44 UTC (rev 2956)
@@ -0,0 +1,139 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by fx   *
+ *   fx at debian64   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdint.h>
+#include <assert.h>
+#define ADM_assert assert
+#include "ADM_ebml.h"
+#include "mkv_tags.h"
+
+void ADM_mkvWalk(ADM_ebml_file *working, uint32_t size);
+
+int main(int argc, char *argv[])
+{
+  ADM_ebml_file ebml;
+  uint64_t id,len;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  
+  if(!ebml.open(argv[1])) ADM_assert(0);
+  
+  // Read level 1 stuff
+  while(!ebml.finished())
+  {
+      ebml.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found\n",id);
+        ebml.skip(len);
+        continue;
+      }
+      printf("Found Tag : %x (%s)\n",id,ss);
+      if(type==ADM_MKV_TYPE_CONTAINER)
+      {
+        uint64_t w=ebml.tell();
+        ADM_mkvWalk(&ebml,len);
+        ebml.seek(w+len);
+      }else
+        ebml.skip(len);
+  }
+  return 0;
+}
+/**
+
+*/
+#define recTab() for(int pretty=0;pretty<recurse;pretty++) printf("\t");
+void ADM_mkvWalk(ADM_ebml_file *working, uint32_t size)
+{
+  uint64_t id,len;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  static int recurse=0;
+  uint64_t pos; 
+  
+  recurse++;
+   ADM_ebml_file son(working,size);
+   while(!son.finished())
+   {
+      pos=son.tell();
+      son.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        recTab();printf("[MKV] Tag 0x%x not found\n",id);
+        son.skip(len);
+        continue;
+      }
+      recTab();printf("at 0x%llx, Found Tag : %x (%s) type %d (%s) size %d\n",pos,id,ss,type,ADM_mkvTypeAsString(type),len);
+      uint32_t val;
+      switch(type)
+      {
+        case ADM_MKV_TYPE_CONTAINER:
+                  //if(id!=MKV_CLUSTER)
+                    ADM_mkvWalk(&son,len);
+                  //else
+                  //    son.skip(len);
+                  break;
+        case ADM_MKV_TYPE_UINTEGER:
+                  val=son.readUnsignedInt(len);
+                  recTab();printf("\tval uint: %llu (0x%llx) \n",val,val);
+                  break;
+        case ADM_MKV_TYPE_INTEGER:
+                  recTab();printf("\tval int: %lld \n",son.readSignedInt(len));
+                  break;
+        case ADM_MKV_TYPE_STRING:
+        {
+                  char string[len+1];
+                  string[0]=0;
+                  son.readString(string,len);
+                  recTab();printf("\tval string: <%s> \n",string);
+                  break;
+        }
+        default:
+                son.skip(len);
+                break;
+      }
+   }
+   recurse--;
+}
+
+void bigHexPrint(uint64_t v)
+{
+  int s=56;
+  int n=0,z;
+  
+  for(int i=0;i<8;i++)
+  {
+    z=(v>>s)&0xff;
+    if(!z && !n) 
+    {
+      
+    }else
+    {
+      printf("[%02x]", (v>>s)&0xff);
+      n=1;
+    }
+    s-=8;
+  }
+  printf("\n"); 
+}
+//EOF

Added: branches/avidemux_2.4_branch/addons/mkvscan/mkv_tags.cpp
===================================================================
--- branches/avidemux_2.4_branch/addons/mkvscan/mkv_tags.cpp	2007-04-20 20:50:28 UTC (rev 2955)
+++ branches/avidemux_2.4_branch/addons/mkvscan/mkv_tags.cpp	2007-04-23 17:19:44 UTC (rev 2956)
@@ -0,0 +1,80 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdint.h>
+#include "ADM_ebml.h"
+#include "mkv_tags.h"
+
+
+typedef struct ADM_mkvTagEnum
+{
+    MKV_ELEM_ID   id;
+    ADM_MKV_TYPE  type;
+    const char    *name;
+}ADM_mkvTagEnum;
+#define ADM_BUILD_TAG
+static const ADM_mkvTagEnum mkvTags[]={
+#include "mkv_tagenum.h"
+};
+
+/**
+    \fn ADM_searchMkvTag
+    \brief Search the payload of this ELEM_ID
+*/
+uint8_t ADM_searchMkvTag(MKV_ELEM_ID tag,const char **asString,ADM_MKV_TYPE *type)
+{
+  int full=sizeof(mkvTags)/sizeof(ADM_mkvTagEnum);
+  
+  for(int i=0;i<full;i++)
+  {
+    if(mkvTags[i].id==tag)
+    {
+      *asString=mkvTags[i].name;
+      *type  =mkvTags[i].type;
+      return 1;
+    }
+    
+  }
+  return 0;
+}
+/**
+    \fn ADM_mkvTypeAsString
+    \brief Returns the type as a string
+*/
+const char *ADM_mkvTypeAsString(ADM_MKV_TYPE type)
+{
+#define CONV(x) if(type==x) return #x;
+    CONV(ADM_MKV_TYPE_UNKNOWN)
+    CONV(ADM_MKV_TYPE_CONTAINER)
+    CONV(ADM_MKV_TYPE_STRING)
+    CONV(ADM_MKV_TYPE_UTF8)
+    CONV(ADM_MKV_TYPE_DATE)
+    CONV(ADM_MKV_TYPE_FLOAT)
+    CONV(ADM_MKV_TYPE_UINTEGER)
+    CONV(ADM_MKV_TYPE_INTEGER)
+    CONV(ADM_MKV_TYPE_BINARY)
+        return "unknown type ???";
+ 
+  
+}
+// EOF



From mean at mail.berlios.de  Mon Apr 23 19:20:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 23 Apr 2007 19:20:58 +0200
Subject: [Avidemux-svn-commit] r2957 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704231720.l3NHKwXX022344@sheep.berlios.de>

Author: mean
Date: 2007-04-23 19:20:56 +0200 (Mon, 23 Apr 2007)
New Revision: 2957

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am
Log:
skeleton for mkv parser

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,70 @@
+/*
+      EBML Reader
+      (c) Mean 2007
+      fixounet at free.fr
+      
+      GPL v2
+      
+*/
+
+#ifndef  ADM_EBML
+#define ADM_EBML
+#include "mkv_tags.h"
+class ADM_ebml
+{
+  protected:
+    
+    
+  public:
+                    ADM_ebml(void);
+        virtual     ~ADM_ebml();
+        int64_t     readSignedInt(uint32_t nb);
+        uint64_t    readUnsignedInt(uint32_t nb);
+        float       readFloat(uint32_t n);
+        uint8_t     readString(char *string, uint32_t maxLen);
+        uint8_t     readUTF8(char *string, uint32_t maxLen);
+        uint8_t     readElemId(uint64_t *code,uint64_t *len);
+        uint64_t    readEBMCode(void);
+        uint64_t    readEBMCode_Full(void);
+        int64_t     readEBMCode_Signed(void);
+        
+        
+        /***********************************/
+             uint8_t readu8(void);  
+             int8_t  reads8(void);
+             uint16_t readu16(void);  
+             int16_t  reads16(void);
+             uint32_t readu32(void);  
+             int32_t  reads32(void);
+        /***********************************/
+        virtual     uint8_t  readBin(uint8_t *whereto,uint32_t len)=0;
+        virtual     uint8_t  skip(uint32_t nbBytes)=0;
+        virtual     uint64_t tell(void)=0;
+};
+
+class ADM_ebml_file : public ADM_ebml
+{
+  protected:
+                FILE *fp;
+                uint64_t  _begin;
+                uint64_t  _size;
+                uint32_t  _close;
+  public: 
+                            ADM_ebml_file();
+                            ADM_ebml_file(ADM_ebml_file *father,uint32_t size);
+                            ~ADM_ebml_file();
+                    uint8_t open(const char *fn);
+       
+        virtual     uint8_t   readBin(uint8_t *whereto,uint32_t len);
+        virtual     uint8_t   skip(uint32_t nbBytes);
+                    uint64_t  tell(void);
+                    uint8_t   seek(uint64_t pos);
+                    uint8_t   finished(void);
+                    uint8_t   find(ADM_MKV_SEARCHTYPE search,
+                                        MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len);
+                    uint8_t   simplefind(MKV_ELEM_ID  prim,uint32_t *len);
+};
+
+void bigHexPrint(uint64_t v);
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -29,17 +29,151 @@
 
 #include "ADM_mkv.h"
 
-extern "C"
+#include "mkv_tags.h"
+/*
+    __________________________________________________________
+*/
+
+uint8_t mkvHeader::open(char *name)
 {
-#include "ADM_lavcodec/avcodec.h"
-#include "ADM_lavformat/avformat.h"
-};
+ 
+  ADM_ebml_file ebml;
+  uint64_t id,len;
+  uint32_t alen;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  
+  if(!ebml.open(name)) 
+  {
+    printf("[MKV]Failed to open file\n");
+    return 0; 
+  }
+  if(!ebml.find(ADM_MKV_PRIMARY,EBML_HEADER,(MKV_ELEM_ID)0,&alen))
+  {
+    printf("[MKV] Cannot find header\n");
+    return 0;
+  }
+  if(!checkHeader(&ebml,alen))
+  {
+     printf("[MKV] Incorrect Header\n");
+     return 0;
+  }
 
-#define CONTEXT ((AVFormatContext* )_context)
+  /* Now find tracks */
+  if(!ebml.find(ADM_MKV_SECONDARY,MKV_SEGMENT,MKV_TRACKS,&alen))
+  {
+     printf("[MKV] Cannot find tracks\n");
+    return 0;
+  }
+  /* And analyze them */
+  if(!analyzeTracks(&ebml,alen))
+  {
+      printf("[MKV] incorrect tracks\n");
+  }
+  return 0;
+}
+/**
+    \fn checkHeader
+    \brief Check that we are compatible with that version of matroska. At the moment, just dump some infos.
+*/
+uint8_t mkvHeader::checkHeader(void *head,uint32_t headlen)
+{
+  printf("[MKV] *** Header dump ***\n");
+ ADM_ebml_file father( (ADM_ebml_file *)head,headlen);
+ walk(&father);
+ printf("[MKV] *** End of Header dump ***\n");
+ return 1; 
+  
+}
+/**
+    \fn analyzeTracks
+    \brief Read Tracks Info.
+*/
+uint8_t mkvHeader::analyzeTracks(void *head,uint32_t headlen)
+{
+  uint64_t id,len;
+  ADM_MKV_TYPE type;
+  const char *ss;
+ ADM_ebml_file father( (ADM_ebml_file *)head,headlen);
+ while(!father.finished())
+ {
+      father.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+        father.skip(len);
+        continue;
+      }
+      ADM_assert(ss);
+      if(id!=MKV_TRACK_ENTRY) 
+      {
+        printf("[MKV] skipping %s\n",ss);
+        father.skip(len);
+        continue; 
+      }
+      if(!analyzeOneTrack(&father,len)) return 0;
+ }
+ return 1; 
+}
 
+/**
+    \fn walk
+    \brief Walk a matroska atom and print out what is found.
+*/
+uint8_t mkvHeader::walk(void *seed)
+{
+  uint64_t id,len;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  
+   ADM_ebml_file *father=(ADM_ebml_file *)seed;
+    while(!father->finished())
+   {
+      father->readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+        father->skip(len);
+        continue;
+      }
+      ADM_assert(ss);
+      switch(type)
+      {
+        case ADM_MKV_TYPE_CONTAINER:
+                  father->skip(len);
+                  printf("%s skipped\n",ss);
+                  break;
+        case ADM_MKV_TYPE_UINTEGER:
+                  printf("%s:%llu\n",ss,father->readUnsignedInt(len));
+                  break;
+        case ADM_MKV_TYPE_INTEGER:
+                  printf("%s:%lld\n",ss,father->readSignedInt(len));
+                  break;
+        case ADM_MKV_TYPE_STRING:
+        {
+                  char string[len+1];
+                  string[0]=0;
+                  father->readString(string,len);
+                  printf("%s:<%s>\n",ss,string);
+                  break;
+        }
+        default:
+                printf("%s skipped\n",ss);
+                father->skip(len);
+                break;
+      }
+   }
+  return 1;
+}
+/**
+
+*/
+/*
+  __________________________________________________________
+*/
 WAVHeader *mkvHeader::getAudioInfo(void )
 {
-  if(_curAudio) return _curAudio->getInfo();
+
   return NULL;
 }
 /*
@@ -48,11 +182,6 @@
 
 uint8_t mkvHeader::getAudioStream(AVDMGenericAudioStream **audio)
 {
-  if(_curAudio)
-  {
-    *audio=_curAudio;
-    return 1;
-  }
   *audio=NULL;
   return 0; 
 }
@@ -62,25 +191,7 @@
 
 void mkvHeader::Dump(void)
 {
-  printf("*********** MKV INFO***********\n");
-  printf("[MKV] %d x %d, %d frames\n",
-                 _mainaviheader.dwWidth,_mainaviheader.dwHeight,_mainaviheader.dwTotalFrames);
-  printf("[MKV] We have %u bytes of extradata for video\n",_videoExtraLen);
-  printf("[MKV] %u / %u\n",  _videostream.dwScale,  _videostream.dwRate);
-  printf("[MKV] %u frames\n",_videostream.dwLength);
-  for(int i=0;i<_nbAudioTrack;i++)
-  {
-    printf("[MKV] Track:%u index:%u fq:%u channels:%u codec:%u extradatalen:%u length:%u nbchunk %u\n"
-            ,i,_audioTracks[i].streamIndex ,
-            _audioTracks[i].wavHeader.frequency,
-            _audioTracks[i].wavHeader.channels,
-            _audioTracks[i].wavHeader.encoding,
-            _audioTracks[i].extraDataLen,
-            _audioTracks[i].length,
-            _audioTracks[i].nbPackets);
-    
-  }
-  printf("*********** MKV INFO***********\n");
+ 
 }
 /*
     __________________________________________________________
@@ -88,7 +199,7 @@
 
 uint32_t mkvHeader::getNbStream(void) 
 {
-  return _nbAudioTrack; 
+  return 0; 
 }
 /*
     __________________________________________________________
@@ -96,31 +207,7 @@
 
 uint8_t mkvHeader::close(void)
 {
-  if(_context)
-  {
-    av_close_input_file(CONTEXT);
-    _context=NULL;
-  }
-  if(_audioTracks)
-  {
-    for(int i=0;i<_nbAudioTrack;i++)
-    { 
-      if(_audioTracks[i].extraData) delete []  _audioTracks[i].extraData;
-      
-    }
-    delete _audioTracks;
-    _audioTracks=NULL;
-  }
-  if(_videoExtraData)
-  {
-    delete [] _videoExtraData;
-    _videoExtraData=NULL; 
-  }
-  if(myName)
-  {
-    delete [] myName;
-    myName=NULL; 
-  }
+  
 }
 /*
     __________________________________________________________
@@ -137,11 +224,8 @@
  mkvHeader::mkvHeader( void ) : vidHeader()
 {
   _fd=NULL;
-  _audioIndex=_videoIndex=-1;
-  _context=NULL;
   _nbAudioTrack=0;
-  _audioTracks=NULL;
-  myName=NULL;
+  memset(_tracks,0,sizeof(_tracks));
 }
 /*
     __________________________________________________________
@@ -151,143 +235,11 @@
 {
   close();
 }
-/*
-    __________________________________________________________
-*/
 
-uint8_t mkvHeader::open(char *name)
-{
-  int err;
-  AVInputFormat *format;
-  
-  printf("[Matroska] Open\n");
-  format= av_find_input_format("matroska");
-  if(!format)
-  {
-    printf("[MKV] input format failed\n");
-    return 0;
-  }
-  err = av_open_input_file((AVFormatContext **)&_context, name, format, 0, NULL);
-  if (err < 0) {
-    printf("[MKV] Error in open input file %d\n",err);
-    return 0;
-  }
-  av_find_stream_info(CONTEXT);
-  
-  for(int i = 0; i < CONTEXT->nb_streams; i++) {
-    AVCodecContext *enc = CONTEXT->streams[i]->codec;
-    switch(enc->codec_type) {
-      case CODEC_TYPE_AUDIO:
-        _nbAudioTrack++;
-        printf("[MKV] %d is audio\n",i,CONTEXT->nb_streams);
-        break;
-      case CODEC_TYPE_VIDEO:
-        _videoIndex=i;
-        printf("[MKV] %d is video\n",i,CONTEXT->nb_streams);
-        break;
-      default:
-        break;
-    }
-  }
-  if(_videoIndex<0)
-  {
-    printf("[MKV] No video track found\n");
-    return 0; 
-  }
-  if(_nbAudioTrack)
-  {
-    int cur=0;
-    _audioTracks=new mkvAudioTrak[ _nbAudioTrack];
-    memset(_audioTracks,0,sizeof(mkvAudioTrak) *_nbAudioTrack);
-    for(int i = 0; i < CONTEXT->nb_streams; i++) 
-    {
-      AVCodecContext *enc = CONTEXT->streams[i]->codec;
-      switch(enc->codec_type) 
-      {
-        case CODEC_TYPE_AUDIO:
-          _audioTracks[cur++].streamIndex=i;
-          break;
-        default:
-          break;
-      }
-    }
-    
-  }
-  
-  if(!readVideoInfo())
-  {
-    printf("[MKV] Failed reading video info\n");
-    return 0; 
-  }
-  myName=ADM_strdup(name);
-  prebuildIndex();
-
-  for(int i=0;i<_nbAudioTrack;i++)
-  {
-    readAudioInfo(i); 
-  }
-  if(_nbAudioTrack)
-  {
-    printf("[MKV] Building current audio track\n");
-    _isaudiopresent=1;
-    _curAudio=new mkvAudio(name,&_audioTracks[0]);
-  }
-  printf("[MKV] Successfully open\n");
-  
-  Dump();
-  return 1;
-}
 /*
     __________________________________________________________
 */
 
- uint8_t  mkvHeader::prebuildIndex(void)
-{
-  AVPacket pkt1, *pkt = &pkt1;
-  int ret;
-  int nbVideo=0;
-  printf("\n[MKV]Preindexing started, that can take a while...\n");
-  while(1)
-  {
-    ret = av_read_frame(CONTEXT, pkt);
-    if (ret < 0) 
-    {
-      break;
-    }
-    if(pkt->stream_index==_videoIndex) 
-    {
-      nbVideo++;
-    }
-    for(int i=0;i<_nbAudioTrack;i++)
-    {
-      if( pkt->stream_index==_audioTracks[i].streamIndex)
-      {
-        _audioTracks[i].nbPackets++;
-        _audioTracks[i].length+=pkt->size;
-      }
-    }
-  }
-  printf("\n[MKV]Preindexing done\n");
-  _videostream.dwLength=_mainaviheader.dwTotalFrames=nbVideo;
-  
-  rewind();
-        
-        
-  return 1;
-}
-uint8_t mkvHeader::rewind( void )
-{
-  int err;
-  AVInputFormat *format;
-  
-  
-  format= av_find_input_format("matroska");
-  av_close_input_file(CONTEXT);
-  _context=NULL;
-  err = av_open_input_file((AVFormatContext **)&_context, myName, format, 0, NULL);
-  ADM_assert(err>=0);
-  return 1;
-}
 /*
     __________________________________________________________
 */
@@ -311,142 +263,9 @@
 
 uint8_t  mkvHeader::getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img)
 {
-  AVPacket pkt1, *pkt = &pkt1;
-  int ret;
-  if(!framenum) rewind();
-  while(1)
-  {
-    ret = av_read_frame(CONTEXT, pkt);
-    if (ret < 0) 
-    {
-      printf("[MKV] Error reading frame %d\n",framenum);
-      return 0;
-    }
-    if(pkt->stream_index!=_videoIndex) 
-    {
-      //printf("[MKV] Wrong stream %u %u\n",pkt->stream_index,_videoIndex);
-      continue;
-    }
-    memcpy(img->data,pkt->data,pkt->size);
-    img->dataLength=pkt->size;
-    
-    {
-      if(pkt->flags  &  PKT_FLAG_KEY)
-        img->flags=AVI_KEY_FRAME;
-      else
-        img->flags=0;
-    }
-    break;
-  }
+ 
   return 1; 
 }
-/*
-    __________________________________________________________
-*/
-/*
-    Read info, fill in mainaviheader & video streamheader
-    __________________________________________________________
-*/
-uint8_t mkvHeader::readVideoInfo( void)
-{
-  AVCodecContext *enc=CONTEXT->streams[_videoIndex]->codec;
-  uint32_t nbFrame;
-  if(!enc) 
-  {
-    printf("[MKV]Failed to get video\n");
-    return 0;
-  }
-  _isvideopresent=1;
-  memset(&_mainaviheader,0,sizeof(_mainaviheader));
-  _mainaviheader.dwWidth=enc->width;
-  _mainaviheader.dwHeight=enc->height;
-  _video_bih.biWidth=enc->width;
-  _video_bih.biHeight=enc->height;
-  
- 
-  uint32_t fcc=0;
-  // Set codec
-  switch(enc->codec_id)
-  {
-    case CODEC_ID_H264:      fcc=fourCC::get((uint8_t *)"H264");break; 
-    case CODEC_ID_MPEG4:     fcc=fourCC::get((uint8_t *)"DIVX");break;
-    case CODEC_ID_MSMPEG4V3: fcc=fourCC::get((uint8_t *)"DIV3");break;
-    default:
-      printf("[MKV] Unknown video fourcc %d\n",enc->codec_id);
-      return 0;
-  }
-  _video_bih.biCompression=_videostream.fccHandler=fcc;
-  // Extradata ?
-  if(enc->extradata && enc->extradata_size )
-  {
-    _videoExtraData=new uint8_t[enc->extradata_size];
-    _videoExtraLen= enc->extradata_size;
-    memcpy(_videoExtraData,enc->extradata,_videoExtraLen);
-    
-    
-  }
-  // FrameRate, frame count
-  AVRational r=CONTEXT->streams[_videoIndex]->r_frame_rate;
-  if(r.num && r.den)
-  {
-    _videostream.dwScale=r.num;
-    _videostream.dwRate=r.den;
-  }else
-  {
-    _videostream.dwScale=1000;
-    _videostream.dwRate=25000;
-   
-  }
-  //
-  _videostream.dwLength=_mainaviheader.dwTotalFrames=5;
-  printf("[MKV] Video info ok\n");
-  Dump();
-  return 1;
-}
-/*
-    __________________________________________________________
-*/
 
-uint8_t mkvHeader::readAudioInfo( uint32_t track)
-{
-  int index=_audioTracks[track].streamIndex;
-  WAVHeader *hdr=&(_audioTracks[track].wavHeader);
-  AVCodecContext *enc=CONTEXT->streams[index]->codec;
-  if(!enc) 
-  {
-    printf("[MKV]Failed to get audio for track %d (track index %d)\n",track,index);
-    return 0;
-  }
-  // Set codec
-  switch(enc->codec_id)
-  {
-    case CODEC_ID_MPEG4AAC:
-    case CODEC_ID_AAC: hdr->encoding=WAV_AAC;break; 
-    case CODEC_ID_MP3: hdr->encoding=WAV_MP3;break; 
-    case CODEC_ID_AC3: hdr->encoding=WAV_AC3;break; 
-    case CODEC_ID_VORBIS: hdr->encoding=WAV_OGG;break; 
-    default:
-      printf("[MKV] Unknown audio fourcc %d\n",enc->codec_id);
-      hdr->encoding=WAV_UNKNOWN;
-      return 0;
-  }
-  // Extradata ?
-  if(enc->extradata && enc->extradata_size )
-  {
-    _audioTracks[track].extraData=new uint8_t[enc->extradata_size];
-    _audioTracks[track].extraDataLen= enc->extradata_size;
-    memcpy(_audioTracks[track].extraData,enc->extradata,_audioTracks[track].extraDataLen);
-  }
-  // Channels fq etc...
-  hdr->frequency=enc->sample_rate;
-  hdr->channels=enc->channels;
-  hdr->byterate=(enc->bit_rate>>3);
-  if(!hdr->byterate) hdr->byterate=128000>>3;
 
-  
-  printf("[MKV] Video audio ok for track %d\n",track);
-
-  return 1;
-}
-
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 17:20:56 UTC (rev 2957)
@@ -22,54 +22,39 @@
 
 #include "ADM_editor/ADM_Video.h"
 #include "ADM_audio/aviaudio.hxx"
-typedef struct mkvAudioTrak
+#include "ADM_inputs/ADM_matroska/ADM_ebml.h"
+typedef struct mkvTrak
 {
+  /* Index in mkv */
   uint32_t  streamIndex;
+  
+  /* Used for audio */
   WAVHeader wavHeader;
-  uint32_t  extraDataLen;
-  uint8_t   *extraData;
   uint32_t  nbPackets;
   uint32_t  length;
-  
+  /* Used for both */
+  uint8_t    *extraData;
+  uint32_t   extraDataLen;
 };
 
-class mkvAudio : public AVDMGenericAudioStream
-{
-  protected:
-    void                    *_context;
-    uint32_t                _trackIndex;
-    WAVHeader               _wavHeader;
-    uint32_t                _extraDataLen;
-    uint8_t                 *_extraData;
-    char                    *myName;
-  public:
-                                mkvAudio(char *name,mkvAudioTrak *track);
-    virtual                     ~mkvAudio();
-    virtual uint32_t            read(uint32_t len,uint8_t *buffer);
-    virtual uint8_t             goTo(uint32_t newoffset);
-    virtual uint8_t             getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-    virtual uint8_t             goToTime(uint32_t mstime);
-    virtual uint8_t             extraData(uint32_t *l,uint8_t **d);
-};
+#define ADM_MKV_MAX_TRACKS 20
 
-
-
 class mkvHeader         :public vidHeader
 {
   protected:
                                 
     FILE                    *_fd;
-    int32_t                 _audioIndex;
-    int32_t                 _videoIndex;
-    uint8_t                 readVideoInfo( void);
-    uint8_t                 readAudioInfo( uint32_t track);
-    uint8_t                 prebuildIndex(void);
-    uint8_t                 rewind(void);
-    void                    *_context;
+    mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
+
+    
     uint32_t                _nbAudioTrack;
-    mkvAudioTrak            *_audioTracks;
-    mkvAudio                *_curAudio;
-    char                    *myName;
+    
+    
+    uint8_t                 checkHeader(void *head,uint32_t headlen);
+    uint8_t                 analyzeTracks(void *head,uint32_t headlen);
+    uint8_t                 analyzeOneTrack(void *head,uint32_t headlen);
+    uint8_t                 walk(void *seed);
+    
   public:
 
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,199 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <string.h>
+
+#include "math.h"
+
+#include "default.h"
+#include "ADM_editor/ADM_Video.h"
+#include <ADM_assert.h>
+
+#include "fourcc.h"
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_mkv.h"
+
+#include "mkv_tags.h"
+
+class entryDesc
+{
+  public:
+          uint32_t     trackNo;
+          uint32_t     trackType;
+          uint32_t     extraDataLen;
+          
+          uint32_t fcc;
+          uint32_t w,h,fps;
+          uint32_t fq,chan,bpp;
+          uint32_t defaultDuration;
+          float    trackScale;
+          uint8_t *extraData;
+         
+          
+          entryDesc(void) {memset(this,0,sizeof(entryDesc));}
+          
+          void dump(void);
+};
+/* Prototypes */
+static uint8_t entryWalk(ADM_ebml_file *head,uint32_t headlen,entryDesc *entry);
+uint32_t ADM_mkvCodecToFourcc(const char *codec);
+/**
+    \fn entryDesc::dump
+    \brief Dump the track entry
+*/
+void entryDesc::dump(void)
+{
+      printf("*** TRACK SUMMARY **\n");
+#define PRINT(x) printf(#x" :%u\n",x)
+      PRINT(trackNo);
+      switch(trackType)
+      {
+        case 1: // Video
+          PRINT(trackType);
+          printf("==>Video\n");
+          PRINT(extraDataLen);
+          PRINT(fcc);
+          PRINT(w);
+          PRINT(h);
+          PRINT(fps);
+          break;
+        case 2: // Video
+          printf("==>Audio\n");
+          PRINT(extraDataLen);
+          PRINT(fcc);
+          PRINT(fq);
+          PRINT(chan);
+          PRINT(bpp);
+          break;
+        default:
+          printf("Unkown track type (%d)\n",trackType);
+      }
+}
+
+/**
+      \fn analyzeOneTrack
+      \brief Grab info about the track (it is a recursive function !)
+              
+*/
+uint8_t mkvHeader::analyzeOneTrack(void *head,uint32_t headlen)
+{
+
+entryDesc entry;
+
+      entryWalk(  (ADM_ebml_file *)head,headlen,&entry);
+      entry.dump();
+      if(entry.trackType==1 &&  !_isvideopresent)
+      {
+        _isvideopresent=1; 
+        _videostream.dwScale=1000;
+        _videostream.dwRate=25000;
+    
+        _mainaviheader.dwMicroSecPerFrame=(uint32_t)floor(50);;     
+        _videostream.fccType=fourCC::get((uint8_t *)"vids");
+        _video_bih.biBitCount=24;
+        _videostream.dwInitialFrames= 0;
+        _videostream.dwStart= 0;
+        _video_bih.biWidth=_mainaviheader.dwWidth=entry.w;
+        _video_bih.biHeight=_mainaviheader.dwHeight=entry.h;
+        _videostream.fccHandler=_video_bih.biCompression=entry.fcc;
+        _tracks[0].extraData=entry.extraData; 
+        _tracks[0].extraDataLen=entry.extraDataLen;       
+        _tracks[0].streamIndex=entry.trackNo;
+        return 1;
+      }
+      if(entry.trackType==2 && _nbAudioTrack<ADM_MKV_MAX_TRACKS)
+      {
+         uint32_t  streamIndex;
+         mkvTrak *t=&(_tracks[1+_nbAudioTrack]);
+         
+         t->wavHeader.encoding=entry.fcc;
+         t->wavHeader.channels=entry.chan;
+         t->wavHeader.frequency=entry.fq;
+         t->wavHeader.bitspersample=16;
+         t->streamIndex=entry.trackNo;
+         t->extraData=entry.extraData;
+         t->extraDataLen=entry.extraDataLen;
+                  
+        _nbAudioTrack++;
+        return 1;
+      }
+      if(entry.extraData) delete [] entry.extraData;
+      return 1;
+  
+}
+  
+/**
+    \fn entryWalk
+    \brief walk a trackEntry atom and grabs all infos. Store them in entry
+*/
+uint8_t entryWalk(ADM_ebml_file *head,uint32_t headlen,entryDesc *entry)
+{
+  ADM_ebml_file father( head,headlen);
+   uint64_t id,len;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  
+  while(!father.finished())
+  {
+      father.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+        father.skip(len);
+        continue;
+      }
+      switch(id)
+      {
+        case  MKV_TRACK_NUMBER: entry->trackNo=father.readUnsignedInt(len);break;
+        case  MKV_TRACK_TYPE: entry->trackType=father.readUnsignedInt(len);break;
+        case  MKV_FRAME_DEFAULT_DURATION:entry->defaultDuration=father.readUnsignedInt(len);break;
+        // FIXME FLOAT case  MKV_AUDIO_FREQUENCY: entry->fq=father.readUnsignedInt(len);break;
+        case  MKV_VIDEO_WIDTH: entry->w=father.readUnsignedInt(len);break;
+        case  MKV_VIDEO_HEIGHT: entry->h=father.readUnsignedInt(len);break;
+        case  MKV_TRACK_TIMECODESCALE:father.skip(len);break; //FIXME
+
+        
+        case  MKV_CODEC_EXTRADATA:
+        {
+              uint8_t *data=new uint8_t[len];
+                    father.readBin(data,len);
+                    entry->extraData=data;
+                    entry->extraDataLen=len;
+                    break;
+        }
+        case  MKV_AUDIO_SETTINGS:
+        case  MKV_VIDEO_SETTINGS:
+                  entryWalk(&father,len,entry);
+                  break;
+        case MKV_CODEC_ID:
+            {
+            uint8_t codec[len+1];
+                  father.readBin(codec,len);
+                  codec[len]=0;
+                  entry->fcc=ADM_mkvCodecToFourcc((char *)codec);
+                  
+            }
+                  break;
+        default: printf("[MKV]not handled %s\n",ss);
+                  father.skip(len);  
+        }
+        
+      }
+  return 1;
+}//EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,70 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <string.h>
+
+#include "math.h"
+
+#include "default.h"
+#include "ADM_editor/ADM_Video.h"
+#include <ADM_assert.h>
+
+#include "fourcc.h"
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_mkv.h"
+
+#include "mkv_tags.h"
+
+typedef struct MKVCC
+{
+    const char *name;
+    uint32_t isVideo;
+    uint32_t audioCC;
+    const char *videoCC;
+};
+
+MKVCC mkvCC[]=
+{
+  {"A_MPEG/L3",0,WAV_MP3,""},
+  
+  // Video
+  {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264
+  {"V_MS/VFW/FOURCC",1,0,"DIV3"}, // Divx 2.
+  
+  
+  // Filler
+  {"AVIDEMUX_RULES",1,0,"DIV2"} // DUMMY
+};
+
+uint32_t ADM_mkvCodecToFourcc(const char *codec)
+{
+int nbEntry=sizeof(mkvCC)/sizeof(MKVCC);
+    for(int i=0;i<nbEntry;i++)
+    {
+      MKVCC *cur=&(mkvCC[i]);
+      if(!strcmp(cur->name,codec))
+      {
+         if(cur->isVideo) return fourCC::get((uint8_t *)cur->videoCC);
+               else return cur->audioCC;
+      }
+    }
+    printf("[MKV] Warning type <%s> unkown!!\n",codec);
+    return 0;
+}
+  //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -27,122 +27,6 @@
 #include "fourcc.h"
 #include "ADM_toolkit/toolkit.hxx"
 
-#include "ADM_mkv.h"
 
-extern "C"
-{
-#include "ADM_lavcodec/avcodec.h"
-#include "ADM_lavformat/avformat.h"
-};
 
-#define CONTEXT ((AVFormatContext* )_context)
-
-/*
-    __________________________________________________________
-*/
-
-mkvAudio::~mkvAudio()
-{
-  printf("[MkvAudio] Destroying track\n");
-  if(_context)
-  {
-    av_close_input_file(CONTEXT);
-    _context=NULL;
-  }
-}
-/*
-    __________________________________________________________
-*/
-
-mkvAudio::mkvAudio(char *name,mkvAudioTrak *track)
-{
-   printf("[MkvAudio] Creating track\n");
-   _trackIndex=track->streamIndex; 
-   _wavheader=&(track->wavHeader);
-  _extraDataLen=track->extraDataLen;
-  _extraData=track->extraData;
-  _length=track->length;
-  
-  // Open it
-  AVInputFormat *format;
-  
-  printf("[Matroska] Open\n");
-  format= av_find_input_format("matroska");
-  ADM_assert(format)
-  ADM_assert(0<= av_open_input_file((AVFormatContext **)&_context, name, format, 0, NULL));
-  av_find_stream_info(CONTEXT);
-}
-/*
-    __________________________________________________________
-*/
-
-uint32_t            mkvAudio::read(uint32_t len,uint8_t *buffer)
-{
-  uint32_t lan,samples;
-  if(!getPacket(      buffer,    &lan, &samples)) return 0;
-  return lan;
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t   mkvAudio::goTo(uint32_t newoffset)
-{
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t   mkvAudio::goToTime(uint32_t newoffset)
-{
-  return 1; 
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t   mkvAudio::extraData(uint32_t *l,uint8_t **d)
-{
-  if(_extraDataLen)
-  {
-    *l=_extraDataLen;
-    *d=_extraData;  
-  }
-  else
-  {
-    *l=0;
-    *d=NULL; 
-  }
-  return 1;
-}
-/*
-    __________________________________________________________
-*/
-
-uint8_t  mkvAudio::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
-{
-  
-  AVPacket pkt1, *pkt = &pkt1;
-  int ret;
-  while(1)
-  {
-    ret = av_read_frame(CONTEXT, pkt);
-    if (ret < 0) 
-    {
-      printf("[MKV] Error reading audio frame %d\n");
-      return 0;
-    }
-    if(pkt->stream_index!=_trackIndex) 
-    {
-      //printf("[MKV] Wrong stream %u %u\n",pkt->stream_index,_videoIndex);
-      continue;
-    }
-    memcpy(dest,pkt->data,pkt->size);
-    *len=pkt->size;
-    *samples=1024; // FIXME
-    break;
-  }
-  return 1; 
-}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am	2007-04-23 17:20:56 UTC (rev 2957)
@@ -6,6 +6,6 @@
 
 libADM_matroska_a_METASOURCES = AUTO
 
-libADM_matroska_a_SOURCES = ADM_mkv.cpp ADM_mkv_audio.cpp
+libADM_matroska_a_SOURCES = ADM_mkv.cpp ADM_mkv_audio.cpp ebml.cpp mkv_tags.cpp ADM_mkvEntries.cpp ADM_mkvTrackType.cpp
 
-EXTRA_DIST = ADM_mkv.cpp  ADM_mkv.h  ADM_mkv_audio.cpp
+EXTRA_DIST = ADM_mkv.cpp  ADM_mkv.h  ADM_mkv_audio.cpp 

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,309 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#include "config.h"
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdint.h>
+#include "default.h"
+#include "ADM_ebml.h"
+#define aprintf(...) {}
+
+#include "ADM_assert.h"
+#if 0
+#define vprintf printf
+#else
+#define vprintf(...) {}
+#endif
+/*
+  It is slow , optimize later
+*/  
+
+uint8_t    ADM_ebml::readElemId(uint64_t *code,uint64_t *len)
+{
+  *code=readEBMCode_Full(); // Keep the length-bits, easier to match with documentation
+  *len=readEBMCode();
+  return 1;
+}
+
+/**
+      \fn       readEBMCode
+      \brief    Returns unsigned integer
+*/
+
+uint64_t    ADM_ebml::readEBMCode(void)
+{
+ uint64_t start=readu8();
+  uint64_t val;      
+  uint32_t mask=0x80,outmask=0x7F,more=0;
+  
+  aprintf("Start :%x at %llx\n",start,tell()-1);
+  
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  outmask=mask-1;
+  start=start&outmask;
+  for(int i=0;i<more;i++)
+  {
+    start=(start<<8)+readu8(); 
+  }
+  aprintf("End at %llx\n",tell());
+  return start;
+}
+/**
+      \fn       readEBMCode
+      \brief    Returns unsigned integer
+*/
+
+int64_t    ADM_ebml::readEBMCode_Signed(void)
+{
+  uint8_t start=readu8();
+  int64_t val;      
+  uint32_t mask=0x80,outmask=0x7F,more=0;
+  
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  outmask=mask-1;
+  val=start&outmask;
+  for(int i=0;i<more;i++)
+  {
+    val=(val<<8)+readu8(); 
+  }
+  // Signed !
+  //FIXME
+  return val;
+}
+/**
+      \fn       readEBMCode_Full
+      \brief    Returns complete code, including size-bits (used only for EBML_ID)
+*/
+uint64_t    ADM_ebml::readEBMCode_Full(void)
+{
+  uint64_t start=readu8();
+  uint32_t mask=0x80,more=0;
+  aprintf(">>StartFull :%x at %llx\n",start,tell()-1);
+  while(!(mask&start))
+  {
+    mask>>=1;
+    ADM_assert(mask);
+    more++; 
+  }
+  for(int i=0;i<more;i++)
+  {
+    start=(start<<8)+readu8(); 
+  }
+  return start;
+}
+
+uint64_t    ADM_ebml::readUnsignedInt(uint32_t nb) 
+{
+  uint64_t val=0;
+  for(int i=0;i<nb;i++)
+  {
+    val=(val<<8)+readu8(); 
+  }
+  return val;
+}
+int64_t    ADM_ebml::readSignedInt(uint32_t nb) 
+{
+  return 0;
+}
+uint8_t     ADM_ebml::readString(char *string, uint32_t maxLen)
+{
+  uint8_t v;
+  while(maxLen--)
+  {
+    v=*string++=readu8();
+    if(!v) return 1;
+  }
+  *string=0;
+  return 1;  
+}
+/******************
+  Low level read
+**********************/
+
+
+uint8_t ADM_ebml::readu8(void)
+{
+  uint8_t v;
+    readBin(&v,1);
+    return v;
+}
+uint16_t ADM_ebml::readu16(void)
+{
+  uint8_t v[2];
+    readBin(v,2);
+    return (uint16_t)(v[0]<<8)+v[1];
+}
+ADM_ebml::ADM_ebml(void)
+{
+  
+}
+ADM_ebml::~ADM_ebml()
+{
+  
+}
+
+
+//*******************************************
+//***********FILE IO PART *******************
+//*******************************************
+ADM_ebml_file::ADM_ebml_file(ADM_ebml_file *father,uint32_t size)
+{
+  _close=0;
+  _size=size;
+  fp=father->fp;
+   _begin=ftello(fp);
+}
+ADM_ebml_file::ADM_ebml_file(void) : ADM_ebml()
+{
+  
+}
+ADM_ebml_file::~ADM_ebml_file()
+{
+  ADM_assert(fp);
+  if(_close) fclose(fp);
+  else fseeko(fp,_begin+_size,SEEK_SET);
+  fp=NULL; 
+}
+uint8_t ADM_ebml_file::open(const char *name)
+{
+  _close=1;
+  fp=fopen(name,"rb");
+  if(!fp) 
+  {
+    aprintf("[EBML FILE] Failed to open <%s>\n",name);
+    return 0;
+  }
+  fseeko(fp,0,SEEK_END);
+  _begin=0;
+  _size=ftello(fp);
+  fseeko(fp,0,SEEK_SET);
+  return 1;
+}
+uint8_t  ADM_ebml_file::readBin(uint8_t *whereto,uint32_t len)
+{
+  ADM_assert(fp);
+  if(!fread(whereto,len,1,fp)) return 0;
+  return 1;
+}
+
+uint8_t ADM_ebml_file::skip(uint32_t vv)
+{
+  fseeko(fp,vv,SEEK_CUR);
+  return 1; 
+}
+uint64_t ADM_ebml_file::tell(void)
+{
+  return ftello(fp);
+}
+uint8_t ADM_ebml_file::seek(uint64_t pos)
+{
+  fseeko(fp,pos,SEEK_SET);
+  return 1;
+}
+uint8_t ADM_ebml_file::finished(void)
+{
+  if(tell()>(_begin+_size-4)) return 1;
+  return 0; 
+}
+/** 
+  \fn find
+  \brief Search for the tag given and returns the corresponding atom
+*/
+ uint8_t ADM_ebml_file::find(ADM_MKV_SEARCHTYPE search,MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len)
+{
+  uint64_t id,pos;
+  ADM_MKV_TYPE type;
+  const char *ss;
+
+    vprintf("[MKV]Searching for tag %llx %llx\n",prim,second);
+    seek(_begin);
+    if(search==ADM_MKV_PRIMARY)
+    {
+          return simplefind(prim,len);
+      }
+    vprintf("[MKV]Searching primary : %llx\n",prim);
+    if(!simplefind(prim,len))
+    {
+      vprintf("[MKV] Primary find failed for %llx\n",prim);
+      return 0; 
+    }
+    // Now we have the father, go inside
+    ADM_ebml_file *son=new ADM_ebml_file(this,*len);
+    vprintf("[MKV]Searching secondary : %llx\n",second);
+    if(!son->simplefind(second,len))
+    {
+      vprintf("[MKV] secondary find failed for secondary %llx\n",second);
+      delete son;
+      return 0; 
+    }
+    pos=son->tell();
+    delete son;
+    seek(pos);
+    return 1;
+}
+
+/** 
+  \fn find
+  \brief Search for the tag given and returns the corresponding atom
+*/
+uint8_t ADM_ebml_file::simplefind(MKV_ELEM_ID  prim,uint32_t *len)
+{
+  uint64_t id,alen;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  uint64_t pos;
+
+    vprintf("[MKV] Simple Searching for tag %llx\n",prim);
+    seek(_begin);
+   
+      while(!finished())
+      {
+          
+          readElemId(&id,&alen);
+          if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+          {
+              vprintf("[MKV] Tag 0x%x not found\n",id);
+              skip(alen);
+              continue;
+           }
+          vprintf("Found Tag : %x (%s)\n",id,ss);
+          if(id==prim)
+          {
+            *len=(uint32_t )alen;
+            return 1;
+          }else
+            skip(alen);
+      }
+    vprintf("[MKV] Failed to locate %llx\n",prim);
+    return 0;
+}
+
+//EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,104 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+
+#if !defined( MKV_TAG_ENUM) || defined(ADM_BUILD_TAG)
+#define MKV_TAG_ENUM
+
+#ifndef ADM_BUILD_TAG
+#define MKTAG(a,b,c) a=b
+#else
+#define MKTAG(a,b,c) {a,c,#a}
+#endif
+  MKTAG(EBML_HEADER,0x1A45DFA3,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(EBML_VERSION,0x4286,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(EBML_COMPAT,0x42F7,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(EBML_MAXIDLEN,0x42F2,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(EBML_MAXSIZELEN,0x42F3,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(EBML_DOCTYPE,0x4282,ADM_MKV_TYPE_STRING),
+  MKTAG(EBML_DOCTYPE_VERSION,0x4287,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(EBML_DOCTYPE_COMPAT,0x4285,ADM_MKV_TYPE_UINTEGER),
+ 
+  MKTAG(MKV_SEGMENT, 0x18538067,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_CLUSTER, 0x1f43b675,ADM_MKV_TYPE_CONTAINER),
+  
+  MKTAG(MKV_SEEK_HEAD,0x114d9b74,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_SEEK,0x4dbb,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_SEEK_POSITION,0x53AC,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_ID,0x53AB,ADM_MKV_TYPE_BINARY),
+  
+  MKTAG(MKV_INFO,0x1549a966,ADM_MKV_TYPE_CONTAINER),
+  
+  MKTAG(MKV_CUES,0x1c53bb6b,ADM_MKV_TYPE_CONTAINER),
+  
+  MKTAG(MKV_MUXING_APP, 0x4D80,ADM_MKV_TYPE_UTF8),
+  MKTAG(MKV_WRITING_APP, 0x5741,ADM_MKV_TYPE_UTF8),
+  MKTAG(MKV_TITLE, 0x7BA9,ADM_MKV_TYPE_UTF8),
+  
+  MKTAG(MKV_TIMECODE_SCALE,0x2AD7B1,ADM_MKV_TYPE_UINTEGER),
+  
+  MKTAG(MKV_TRACKS,0x1654AE6B,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_TRACK_ENTRY,0xAE,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_TRACK_NUMBER,0xD7,ADM_MKV_TYPE_UINTEGER),
+  
+  MKTAG(MKV_TRACK_TYPE,0x83,ADM_MKV_TYPE_UINTEGER),
+  
+  MKTAG(MKV_TRACK_TIMECODESCALE, 0x23314F,ADM_MKV_TYPE_FLOAT),
+  
+  MKTAG(MKV_CODEC_ID,0x86,ADM_MKV_TYPE_STRING),
+  
+  MKTAG(MKV_CODEC_NAME,0x258688,ADM_MKV_TYPE_UTF8),
+   	
+  MKTAG(MKV_VIDEO_SETTINGS,0xE0,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_FRAME_DEFAULT_DURATION,0x23E383,ADM_MKV_TYPE_UINTEGER),
+  
+  MKTAG(MKV_CODEC_EXTRADATA,0x63A2,ADM_MKV_TYPE_BINARY),
+  
+  MKTAG(MKV_VIDEO_WIDTH,0xB0,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_VIDEO_HEIGHT,0xBA,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_VIDEO_AR,0x54B3,ADM_MKV_TYPE_UINTEGER),
+
+  MKTAG(MKV_AUDIO_SETTINGS,0xE1,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_AUDIO_FREQUENCY,0xB5,ADM_MKV_TYPE_FLOAT),
+  MKTAG(MKV_AUDIO_OUT_FREQUENCY,0x78B5,ADM_MKV_TYPE_FLOAT),
+  MKTAG(MKV_AUDIO_CHANNELS,0x9F,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_AUDIO_BITS_PER_SAMPLE,0x6264,ADM_MKV_TYPE_UINTEGER),
+  
+  /***/
+  MKTAG(MKV_TIMECODE,0xE7,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_BLOCK_GROUP,0xA0,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_BLOCK,0xA1,ADM_MKV_TYPE_BINARY),
+  /** */
+  MKTAG(MKV_CUE_POINT,0xBB,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_CUE_TIME,0xB3,ADM_MKV_TYPE_UINTEGER),
+  
+  MKTAG(MKV_CUE_TRACK_POSITION,0xB7,ADM_MKV_TYPE_CONTAINER),
+  MKTAG(MKV_CUE_CLUSTER_POSITION,0xF1,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_CUE_TRACK,0xF7,ADM_MKV_TYPE_UINTEGER),
+  MKTAG(MKV_CUE_BLOCK_NUMBER,0x5378,ADM_MKV_TYPE_UINTEGER),
+  
+   MKTAG(MKV_VOID,0xEC,ADM_MKV_TYPE_BINARY),
+  
+         //*************************
+   MKTAG(MKV_MAX,0xFFFF,ADM_MKV_TYPE_UNKNOWN)    
+       
+#undef MKTAG
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,80 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdint.h>
+#include "ADM_ebml.h"
+#include "mkv_tags.h"
+
+
+typedef struct ADM_mkvTagEnum
+{
+    MKV_ELEM_ID   id;
+    ADM_MKV_TYPE  type;
+    const char    *name;
+}ADM_mkvTagEnum;
+#define ADM_BUILD_TAG
+static const ADM_mkvTagEnum mkvTags[]={
+#include "mkv_tagenum.h"
+};
+
+/**
+    \fn ADM_searchMkvTag
+    \brief Search the payload of this ELEM_ID
+*/
+uint8_t ADM_searchMkvTag(MKV_ELEM_ID tag,const char **asString,ADM_MKV_TYPE *type)
+{
+  int full=sizeof(mkvTags)/sizeof(ADM_mkvTagEnum);
+  
+  for(int i=0;i<full;i++)
+  {
+    if(mkvTags[i].id==tag)
+    {
+      *asString=mkvTags[i].name;
+      *type  =mkvTags[i].type;
+      return 1;
+    }
+    
+  }
+  return 0;
+}
+/**
+    \fn ADM_mkvTypeAsString
+    \brief Returns the type as a string
+*/
+const char *ADM_mkvTypeAsString(ADM_MKV_TYPE type)
+{
+#define CONV(x) if(type==x) return #x;
+    CONV(ADM_MKV_TYPE_UNKNOWN)
+    CONV(ADM_MKV_TYPE_CONTAINER)
+    CONV(ADM_MKV_TYPE_STRING)
+    CONV(ADM_MKV_TYPE_UTF8)
+    CONV(ADM_MKV_TYPE_DATE)
+    CONV(ADM_MKV_TYPE_FLOAT)
+    CONV(ADM_MKV_TYPE_UINTEGER)
+    CONV(ADM_MKV_TYPE_INTEGER)
+    CONV(ADM_MKV_TYPE_BINARY)
+        return "unknown type ???";
+ 
+  
+}
+// EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.h	2007-04-23 17:19:44 UTC (rev 2956)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tags.h	2007-04-23 17:20:56 UTC (rev 2957)
@@ -0,0 +1,54 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by mean,    *
+ *   fixounet at free.fr   *
+ *                                                                         *
+ *        EBML Handling code                                               *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+ 
+#ifndef ADM_MKV_TAGS
+#define ADM_MKV_TAGS
+
+
+typedef enum ADM_MKV_TYPE
+{
+    ADM_MKV_TYPE_UNKNOWN,
+    ADM_MKV_TYPE_CONTAINER,
+    ADM_MKV_TYPE_STRING,
+    ADM_MKV_TYPE_UTF8,
+    ADM_MKV_TYPE_DATE,
+    ADM_MKV_TYPE_FLOAT,
+    ADM_MKV_TYPE_UINTEGER,
+    ADM_MKV_TYPE_INTEGER,
+    ADM_MKV_TYPE_BINARY
+};
+
+typedef enum ADM_MKV_SEARCHTYPE
+{
+  ADM_MKV_PRIMARY, 
+  ADM_MKV_SECONDARY
+};
+
+typedef enum MKV_ELEM_ID
+{
+#include "mkv_tagenum.h"
+};
+
+
+uint8_t ADM_searchMkvTag(MKV_ELEM_ID tag,const char **asString,ADM_MKV_TYPE *type);
+const char *ADM_mkvTypeAsString(ADM_MKV_TYPE type);
+
+#endif



From mean at mail.berlios.de  Mon Apr 23 21:09:02 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 23 Apr 2007 21:09:02 +0200
Subject: [Avidemux-svn-commit] r2958 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704231909.l3NJ92HG014954@sheep.berlios.de>

Author: mean
Date: 2007-04-23 21:09:02 +0200 (Mon, 23 Apr 2007)
New Revision: 2958

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
Log:
very simple and incomplete video only indexer for mkv

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 19:09:02 UTC (rev 2958)
@@ -63,6 +63,7 @@
                     uint8_t   find(ADM_MKV_SEARCHTYPE search,
                                         MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len);
                     uint8_t   simplefind(MKV_ELEM_ID  prim,uint32_t *len);
+                    uint64_t remaining(void);
 };
 
 void bigHexPrint(uint64_t v);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 19:09:02 UTC (rev 2958)
@@ -43,6 +43,7 @@
   ADM_MKV_TYPE type;
   const char *ss;
   
+  _isvideopresent=0;
   if(!ebml.open(name)) 
   {
     printf("[MKV]Failed to open file\n");
@@ -70,7 +71,24 @@
   {
       printf("[MKV] incorrect tracks\n");
   }
-  return 0;
+  printf("[MKV] Tracks analyzed\n");
+  if(!_isvideopresent)
+  {
+    printf("[MKV] No video\n");
+    return 0;
+  }
+  printf("[MKV] Indexing video\n");
+    if(!videoIndexer(&ebml))
+    {
+      printf("[MKV] Video indexing failed\n");
+      return 0; 
+    }
+  // update some infos
+  _videostream.dwLength= _mainaviheader.dwTotalFrames=_tracks[0]._nbIndex; 
+  printf("Matroska successfully read\n");
+  _parser=new ADM_ebml_file();
+  ADM_assert(_parser->open(name));
+  return 1;
 }
 /**
     \fn checkHeader
@@ -207,7 +225,10 @@
 
 uint8_t mkvHeader::close(void)
 {
-  
+  // CLEANUP!!
+  if(_parser) delete _parser;
+  _parser=NULL;
+  // FIXME Cleanup index!
 }
 /*
     __________________________________________________________
@@ -222,8 +243,8 @@
 */
 
  mkvHeader::mkvHeader( void ) : vidHeader()
-{
-  _fd=NULL;
+{ 
+  _parser=NULL;
   _nbAudioTrack=0;
   memset(_tracks,0,sizeof(_tracks));
 }
@@ -254,7 +275,9 @@
 
 uint32_t mkvHeader::getFlags(uint32_t frame,uint32_t *flags)
 {
-  *flags=AVI_KEY_FRAME;
+  if(frame>=_tracks[0]._nbIndex) return 0;
+  *flags=_tracks[0]._index[frame].flags;
+  if(!frame) *flags=AVI_KEY_FRAME;
   return 1; 
 }
 /*
@@ -263,7 +286,20 @@
 
 uint8_t  mkvHeader::getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img)
 {
- 
+  ADM_assert(_parser);
+  if(framenum>=_tracks[0]._nbIndex) return 0;
+  
+  mkvIndex *dx=&(_tracks[0]._index[framenum]);
+  
+  _parser->seek(dx->pos);
+  _parser->readBin(img->data,dx->size);
+  img->dataLength=dx->size;
+  
+  img->flags=dx->flags;
+  
+  if(!framenum) img->flags=AVI_KEY_FRAME;
+  
+  
   return 1; 
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 19:09:02 UTC (rev 2958)
@@ -23,6 +23,16 @@
 #include "ADM_editor/ADM_Video.h"
 #include "ADM_audio/aviaudio.hxx"
 #include "ADM_inputs/ADM_matroska/ADM_ebml.h"
+
+
+typedef struct mkvIndex
+{
+    uint64_t pos;
+    uint32_t size;
+    uint32_t flags;
+    uint32_t timeCode;
+};
+
 typedef struct mkvTrak
 {
   /* Index in mkv */
@@ -35,6 +45,9 @@
   /* Used for both */
   uint8_t    *extraData;
   uint32_t   extraDataLen;
+  mkvIndex  *_index;
+  uint32_t  _nbIndex;  // current size of the index
+  uint32_t  _indexMax; // Max size of the index
 };
 
 #define ADM_MKV_MAX_TRACKS 20
@@ -43,7 +56,7 @@
 {
   protected:
                                 
-    FILE                    *_fd;
+    ADM_ebml_file           *_parser;
     mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
 
     
@@ -55,6 +68,9 @@
     uint8_t                 analyzeOneTrack(void *head,uint32_t headlen);
     uint8_t                 walk(void *seed);
     
+    // Indexers
+    uint8_t                 addVideoEntry(uint64_t where, uint32_t size);
+    uint8_t                 videoIndexer(ADM_ebml_file *parser);
   public:
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-23 19:09:02 UTC (rev 2958)
@@ -44,10 +44,7 @@
           uint32_t defaultDuration;
           float    trackScale;
           uint8_t *extraData;
-         
           
-          entryDesc(void) {memset(this,0,sizeof(entryDesc));}
-          
           void dump(void);
 };
 /* Prototypes */
@@ -95,7 +92,8 @@
 {
 
 entryDesc entry;
-
+      memset(&entry,0,sizeof(entry));
+      
       entryWalk(  (ADM_ebml_file *)head,headlen,&entry);
       entry.dump();
       if(entry.trackType==1 &&  !_isvideopresent)
@@ -160,10 +158,13 @@
       }
       switch(id)
       {
+        
         case  MKV_TRACK_NUMBER: entry->trackNo=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TYPE: entry->trackType=father.readUnsignedInt(len);break;
         case  MKV_FRAME_DEFAULT_DURATION:entry->defaultDuration=father.readUnsignedInt(len);break;
-        // FIXME FLOAT case  MKV_AUDIO_FREQUENCY: entry->fq=father.readUnsignedInt(len);break;
+        // FIXME 
+        case  MKV_AUDIO_FREQUENCY: entry->fq=48000;father.skip(len);break;
+        // FIXME
         case  MKV_VIDEO_WIDTH: entry->w=father.readUnsignedInt(len);break;
         case  MKV_VIDEO_HEIGHT: entry->h=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TIMECODESCALE:father.skip(len);break; //FIXME

Added: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-23 19:09:02 UTC (rev 2958)
@@ -0,0 +1,156 @@
+/***************************************************************************
+    copyright            : (C) 2006 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <string.h>
+
+#include "math.h"
+
+#include "default.h"
+#include "ADM_editor/ADM_Video.h"
+#include <ADM_assert.h>
+
+#include "fourcc.h"
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_mkv.h"
+
+#include "mkv_tags.h"
+#define VIDEO _tracks[0]
+/**
+    \fn videoIndexer
+    \brief index the video Track
+*/
+uint8_t mkvHeader::videoIndexer(ADM_ebml_file *parser)
+{
+  uint64_t fileSize,len,bsize;
+  uint32_t alen,vlen;
+  uint64_t id;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  
+   parser->seek(0);
+   
+   // Start with a small index, it will grow automatically afterward
+    VIDEO._indexMax=1000;
+    VIDEO._index=new mkvIndex[VIDEO._indexMax];
+    //************
+   
+   if(!parser->find(ADM_MKV_PRIMARY,MKV_SEGMENT,MKV_CLUSTER,&vlen))
+   {
+     printf("[MKV] Cannot find CLUSTER atom\n");
+     return 0;
+   }
+  
+  ADM_ebml_file segment(parser,vlen);
+  printf("[MKV] Segment found at %llx (size %llx)\n",segment.tell(),vlen);
+  
+  //while FIXME LOOP ON ALL CLUSTER!
+  if(segment.find(ADM_MKV_PRIMARY,MKV_CLUSTER,MKV_CLUSTER,&alen))
+  {
+    printf("[MKV] Beginning new cluster at 0x%llx\n",segment.tell());
+   ADM_ebml_file cluster(&segment,alen);
+   while(!cluster.finished())
+   {
+      cluster.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+        cluster.skip(len);
+        continue;
+      }
+      //printf("\t\tFound %s\n",ss);
+      switch(id)
+      {
+                default: 
+                case MKV_TIMECODE: 
+                  //printf("Skipping %s\n",ss);
+                  cluster.skip(len);
+                  break;
+                
+                case MKV_BLOCK_GROUP:
+                {
+                        //printf("Block Group\n");
+                        ADM_ebml_file blockGroup(parser,len);
+                        while(!blockGroup.finished())
+                        {
+                                blockGroup.readElemId(&id,&len);
+                                if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+                                {
+                                  printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+                                  blockGroup.skip(len);
+                                  continue;
+                                }
+                                //printf("\t\t\t\tFound %s\n",ss);
+                                //printf(">%s\n",ss);
+                                switch(id)
+                                {
+                                  default: blockGroup.skip(len);
+                                  case MKV_BLOCK : 
+                                  {
+                                    // Read Track id 
+                                      uint32_t tid=blockGroup.readEBMCode();
+                                      //printf("Wanted %u got %u\n",_tracks[0].streamIndex,tid);
+                                      if(_tracks[0].streamIndex!=tid)
+                                      {
+                                        blockGroup.skip(blockGroup.remaining());
+                                        break;  // Not our track
+                                      }
+                                      // Skip timecode
+                                      blockGroup.skip(3);
+                                      addVideoEntry(blockGroup.tell(),blockGroup.remaining());
+                                      blockGroup.skip(blockGroup.remaining());
+                                      break;
+                                  }
+                                }
+                          }
+            }
+            break; // Block Group
+       }
+     }
+    
+  }
+     printf("Found %lu images in this cluster\n",VIDEO._nbIndex);
+     return 1;
+}
+/**
+    \fn addVideoEntry
+    \brief add an entry to the video index
+*/
+uint8_t mkvHeader::addVideoEntry(uint64_t where, uint32_t size)
+{
+  // Need to grow index ?
+  if(VIDEO._nbIndex==VIDEO._indexMax-1)
+  {
+    // Realloc 
+    mkvIndex *dx=new mkvIndex[VIDEO._indexMax*2];
+    memcpy(dx, _tracks[0]._index,sizeof(mkvIndex)*VIDEO._nbIndex);
+    VIDEO._indexMax*=2;
+    delete [] _tracks[0]._index;
+    _tracks[0]._index=dx;
+  }
+  
+  mkvIndex *index=_tracks[0]._index;
+  int x=VIDEO._nbIndex;
+  index[x].pos=where;
+  index[x].size=size;
+  index[x].flags=0;
+  index[x].timeCode=0;
+  VIDEO._nbIndex++;
+  printf("++\n");
+  return 1;
+}
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/Makefile.am	2007-04-23 19:09:02 UTC (rev 2958)
@@ -6,6 +6,6 @@
 
 libADM_matroska_a_METASOURCES = AUTO
 
-libADM_matroska_a_SOURCES = ADM_mkv.cpp ADM_mkv_audio.cpp ebml.cpp mkv_tags.cpp ADM_mkvEntries.cpp ADM_mkvTrackType.cpp
+libADM_matroska_a_SOURCES = ADM_mkv.cpp ADM_mkv_audio.cpp ebml.cpp mkv_tags.cpp ADM_mkvEntries.cpp ADM_mkvTrackType.cpp ADM_mkvIndexer.cpp
 
 EXTRA_DIST = ADM_mkv.cpp  ADM_mkv.h  ADM_mkv_audio.cpp 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 17:20:56 UTC (rev 2957)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 19:09:02 UTC (rev 2958)
@@ -183,12 +183,15 @@
 }
 ADM_ebml_file::ADM_ebml_file(void) : ADM_ebml()
 {
-  
+  _close=0;
 }
 ADM_ebml_file::~ADM_ebml_file()
 {
   ADM_assert(fp);
-  if(_close) fclose(fp);
+  if(_close)
+  {
+    fclose(fp);
+  }
   else fseeko(fp,_begin+_size,SEEK_SET);
   fp=NULL; 
 }
@@ -305,5 +308,14 @@
     vprintf("[MKV] Failed to locate %llx\n",prim);
     return 0;
 }
-
+/**
+    \fn remaining
+    \brief returns the # of bytes remaining in this atom
+*/
+uint64_t ADM_ebml_file::remaining(void)
+{
+  uint64_t pos=tell();
+  ADM_assert(pos<=(_begin+_size));
+  return (_begin+_size)-pos; 
+}
 //EOF



From mean at mail.berlios.de  Mon Apr 23 21:21:01 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 23 Apr 2007 21:21:01 +0200
Subject: [Avidemux-svn-commit] r2959 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704231921.l3NJL11i016088@sheep.berlios.de>

Author: mean
Date: 2007-04-23 21:21:00 +0200 (Mon, 23 Apr 2007)
New Revision: 2959

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
Log:
add extradata, needed for mp4/h264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 19:09:02 UTC (rev 2958)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 19:21:00 UTC (rev 2959)
@@ -302,6 +302,14 @@
   
   return 1; 
 }
+/*
+    __________________________________________________________
+*/
 
-
+uint8_t  mkvHeader::getExtraHeaderData(uint32_t *len, uint8_t **data)
+{
+                *len=_tracks[0].extraDataLen;
+                *data=_tracks[0].extraData;
+                return 1;            
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 19:09:02 UTC (rev 2958)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-23 19:21:00 UTC (rev 2959)
@@ -104,6 +104,8 @@
     virtual uint32_t getFlags(uint32_t frame,uint32_t *flags);
     virtual uint8_t  getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img);
 
+            uint8_t  getExtraHeaderData(uint32_t *len, uint8_t **data);
+    
 };
 #endif
 



From mean at mail.berlios.de  Mon Apr 23 22:25:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 23 Apr 2007 22:25:30 +0200
Subject: [Avidemux-svn-commit] r2960 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704232025.l3NKPUuS028583@sheep.berlios.de>

Author: mean
Date: 2007-04-23 22:25:29 +0200 (Mon, 23 Apr 2007)
New Revision: 2960

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
Log:
grab all clusters, update flags

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 19:21:00 UTC (rev 2959)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h	2007-04-23 20:25:29 UTC (rev 2960)
@@ -61,8 +61,8 @@
                     uint8_t   seek(uint64_t pos);
                     uint8_t   finished(void);
                     uint8_t   find(ADM_MKV_SEARCHTYPE search,
-                                        MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len);
-                    uint8_t   simplefind(MKV_ELEM_ID  prim,uint32_t *len);
+                                        MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len,uint32_t rewind=1);
+                    uint8_t   simplefind(MKV_ELEM_ID  prim,uint32_t *len,uint32_t rewind=1);
                     uint64_t remaining(void);
 };
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 19:21:00 UTC (rev 2959)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-23 20:25:29 UTC (rev 2960)
@@ -267,7 +267,9 @@
 
   uint8_t  mkvHeader::setFlag(uint32_t frame,uint32_t flags)
 {
-  return 0; 
+  if(frame>=_tracks[0]._nbIndex) return 0;
+  _tracks[0]._index[frame].flags=flags;
+  return 1; 
 }
 /*
     __________________________________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-23 19:21:00 UTC (rev 2959)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-23 20:25:29 UTC (rev 2960)
@@ -60,9 +60,9 @@
   printf("[MKV] Segment found at %llx (size %llx)\n",segment.tell(),vlen);
   
   //while FIXME LOOP ON ALL CLUSTER!
-  if(segment.find(ADM_MKV_PRIMARY,MKV_CLUSTER,MKV_CLUSTER,&alen))
+  while(segment.find(ADM_MKV_PRIMARY,MKV_CLUSTER,MKV_CLUSTER,&alen,0))
   {
-    printf("[MKV] Beginning new cluster at 0x%llx\n",segment.tell());
+  //  printf("[MKV] Beginning new cluster at 0x%llx\n",segment.tell());
    ADM_ebml_file cluster(&segment,alen);
    while(!cluster.finished())
    {
@@ -122,7 +122,7 @@
             break; // Block Group
        }
      }
-    
+   // printf("[MKV] ending cluster at 0x%llx\n",segment.tell());
   }
      printf("Found %lu images in this cluster\n",VIDEO._nbIndex);
      return 1;
@@ -151,6 +151,6 @@
   index[x].flags=0;
   index[x].timeCode=0;
   VIDEO._nbIndex++;
-  printf("++\n");
+ // printf("++\n");
   return 1;
 }
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 19:21:00 UTC (rev 2959)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-23 20:25:29 UTC (rev 2960)
@@ -240,20 +240,20 @@
   \fn find
   \brief Search for the tag given and returns the corresponding atom
 */
- uint8_t ADM_ebml_file::find(ADM_MKV_SEARCHTYPE search,MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len)
+ uint8_t ADM_ebml_file::find(ADM_MKV_SEARCHTYPE search,MKV_ELEM_ID  prim,MKV_ELEM_ID second,uint32_t *len,uint32_t rewind)
 {
   uint64_t id,pos;
   ADM_MKV_TYPE type;
   const char *ss;
 
     vprintf("[MKV]Searching for tag %llx %llx\n",prim,second);
-    seek(_begin);
+    if(rewind) seek(_begin);
     if(search==ADM_MKV_PRIMARY)
     {
-          return simplefind(prim,len);
+          return simplefind(prim,len,rewind);
       }
     vprintf("[MKV]Searching primary : %llx\n",prim);
-    if(!simplefind(prim,len))
+    if(!simplefind(prim,len,rewind))
     {
       vprintf("[MKV] Primary find failed for %llx\n",prim);
       return 0; 
@@ -277,7 +277,7 @@
   \fn find
   \brief Search for the tag given and returns the corresponding atom
 */
-uint8_t ADM_ebml_file::simplefind(MKV_ELEM_ID  prim,uint32_t *len)
+uint8_t ADM_ebml_file::simplefind(MKV_ELEM_ID  prim,uint32_t *len,uint32_t rewind)
 {
   uint64_t id,alen;
   ADM_MKV_TYPE type;
@@ -285,7 +285,7 @@
   uint64_t pos;
 
     vprintf("[MKV] Simple Searching for tag %llx\n",prim);
-    seek(_begin);
+    if(rewind) seek(_begin);
    
       while(!finished())
       {



From mean at mail.berlios.de  Tue Apr 24 07:59:47 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 24 Apr 2007 07:59:47 +0200
Subject: [Avidemux-svn-commit] r2961 - branches/avidemux_2.4_branch/po
Message-ID: <200704240559.l3O5xlBf015113@sheep.berlios.de>

Author: mean
Date: 2007-04-24 07:59:45 +0200 (Tue, 24 Apr 2007)
New Revision: 2961

Added:
   branches/avidemux_2.4_branch/po/sr.po
Modified:
   branches/avidemux_2.4_branch/po/LINGUAS
   branches/avidemux_2.4_branch/po/Makefile.am
Log:
popac: sr translation

Modified: branches/avidemux_2.4_branch/po/LINGUAS
===================================================================
--- branches/avidemux_2.4_branch/po/LINGUAS	2007-04-23 20:25:29 UTC (rev 2960)
+++ branches/avidemux_2.4_branch/po/LINGUAS	2007-04-24 05:59:45 UTC (rev 2961)
@@ -4,3 +4,4 @@
 ru
 cs
 ja
+sr

Modified: branches/avidemux_2.4_branch/po/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/po/Makefile.am	2007-04-23 20:25:29 UTC (rev 2960)
+++ branches/avidemux_2.4_branch/po/Makefile.am	2007-04-24 05:59:45 UTC (rev 2961)
@@ -1,3 +1,3 @@
-POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po
-EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po
+POFILES= es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po sr.po
+EXTRA_DIST = es.po fr.po klingon.po ru.po de.po pt_BR.po ja.po sr.po
 

Added: branches/avidemux_2.4_branch/po/sr.po
===================================================================
--- branches/avidemux_2.4_branch/po/sr.po	2007-04-23 20:25:29 UTC (rev 2960)
+++ branches/avidemux_2.4_branch/po/sr.po	2007-04-24 05:59:45 UTC (rev 2961)
@@ -0,0 +1,6433 @@
+# translation of sr.po to Serbian
+# This file is distributed under the same license as the PACKAGE package.
+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
+msgid ""
+msgstr ""
+"Project-Id-Version: sr\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: \n"
+"PO-Revision-Date: \n"
+"Last-Translator: ??????? ????? <gpopac at gmail.com>\n"
+"Language-Team: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%" "10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
+"X-Poedit-Language: Serbian\n"
+
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:75
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:182
+msgid "Internal error"
+msgstr "???????? ??????"
+
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:75
+msgid "Cannot open WMA2 codec."
+msgstr "?? ???? ?? ??????? WMA2 ?????."
+
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:182
+msgid "Cannot open AMR codec."
+msgstr "?? ???? ?? ??????? AMR ?????."
+
+#: avidemux/oplug_avi/op_avisavecopy.cpp:94
+#: avidemux/oplug_avi/op_avisave.cpp:410
+msgid "Cannot initiate save"
+msgstr "?? ???? ?? ???????? ???????"
+
+#: avidemux/oplug_avi/op_saveprocess.cpp:73
+msgid ""
+"Width is not a multiple of 8\n"
+" continue anyway ?"
+msgstr ""
+"?????? ????? ???? ???? ??????? ??????.\n"
+"?? ?????????"
+
+#: avidemux/oplug_avi/op_saveprocess.cpp:93
+#: avidemux/oplug_mp4/oplug_mp4.cpp:170
+#: avidemux/oplug_ogm/op_ogsaveprocess.cpp:75
+msgid "Filter init failed"
+msgstr "????????? ??????? ????????"
+
+#: avidemux/oplug_avi/op_saveprocess.cpp:127
+#: avidemux/oplug_mp4/oplug_mp4.cpp:388
+#: avidemux/oplug_ogm/op_ogsaveprocess.cpp:99
+msgid ""
+"\n"
+" Reuse the existing log-file ?"
+msgstr ""
+"\n"
+" ?? ?? ?? ?????????? ????????? ??????? ?????? ?"
+
+#: avidemux/oplug_avi/op_saveprocess.cpp:152
+#: avidemux/oplug_mp4/oplug_mp4.cpp:408
+msgid "Aborting"
+msgstr "????????"
+
+#: avidemux/oplug_avi/op_avisave.cpp:152
+msgid "Error initalizing audio filters"
+msgstr "?? ???? ?? ???????? ????? ???????"
+
+#: avidemux/oplug_avi/op_avisave.cpp:161
+msgid "Error initalizing video filters"
+msgstr "?? ???? ?? ???????? ????? ???????"
+
+#: avidemux/ADM_audiofilter/audiofilter_buildchain.cpp:322
+#: avidemux/gui_autodrive.cpp:69 avidemux/gui_autodrive.cpp:86
+msgid "Codec Error"
+msgstr "?????? ? ????????"
+
+#: avidemux/ADM_audiofilter/audiofilter_buildchain.cpp:322
+msgid ""
+"The number of channels is greater than what the selected audio codec can "
+"do.\n"
+"Either change codec or use the mixer filter to have less channels."
+msgstr ""
+"???? ????? ?????? ?? ???? ???? ??? ???????? ????? ????? ????????.\n"
+"??? ????????? ????? ????? ??? ????????? ?????? ?? ??????? ???? ??????."
+
+#: avidemux/ADM_nuv/ADM_nuv.cpp:568
+msgid "Sure you want to abort ?"
+msgstr "?? ?????? ???????? ?"
+
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
+msgid "Size mismatch"
+msgstr "???????? ?? ?? ???????"
+
+#: avidemux/ADM_nuv/ADM_nuv.cpp:779
+msgid "Expect a crash."
+msgstr "???????? ???????."
+
+#: avidemux/ADM_nuv/ADM_nuv.cpp:1071
+msgid "Do you want to save an index ?"
+msgstr "?????? ?? ?? ???????? ?????? ?"
+
+#: avidemux/oplug_mp4/oplug_mp4.cpp:152
+msgid "Cannot initialize the video stream"
+msgstr "?? ???? ?? ???????? ????? ?????"
+
+#: avidemux/oplug_mp4/oplug_mp4.cpp:208 avidemux/oplug_mp4/oplug_mp4.cpp:328
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:352
+msgid "Error while encoding"
+msgstr "?????? ??? ??????????"
+
+#: avidemux/oplug_mp4/oplug_mp4.cpp:218
+msgid "KeyFrame error"
+msgstr "?????? ? ??????? ?????"
+
+#: avidemux/oplug_mp4/oplug_mp4.cpp:218
+msgid ""
+"The beginning frame is not a key frame.\n"
+"Please move the A marker."
+msgstr ""
+"??????? ????? ???? ?????? ?????.\n"
+"???????? ? ??????."
+
+#: avidemux/oplug_mp4/oplug_mp4.cpp:245
+msgid "Cannot initialize the audio stream"
+msgstr "?? ???? ?? ???????? ????? ?????."
+
+#: avidemux/ADM_dialog/DIA_chromaShift.cpp:257
+msgid "ChromaShift"
+msgstr "????? ???????"
+
+#: avidemux/ADM_dialog/DIA_chromaShift.cpp:270
+msgid "U Shift :"
+msgstr "? ???????"
+
+#: avidemux/ADM_dialog/DIA_chromaShift.cpp:278
+msgid "V Shift :"
+msgstr "? ???????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:155
+msgid "ColorYuv (From avisynth)"
+msgstr "Yuv ???? (?? avisynth-?)"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:179
+#: avidemux/ADM_dialog/DIA_contrast.cpp:307
+#: avidemux/ADM_dialog/DIA_contrast.cpp:324
+msgid "Contrast"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:186
+#: avidemux/ADM_dialog/DIA_contrast.cpp:337
+msgid "Brightness"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:193
+msgid "Gamma"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:200
+#: avidemux/ADM_dialog/DIA_audio.cpp:327
+msgid "Gain"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:207
+msgid "Luma Y"
+msgstr "???? Y"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:214
+#: avidemux/ADM_dialog/DIA_contrast.cpp:358
+msgid "Chroma U"
+msgstr "????? ?"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:221
+#: avidemux/ADM_dialog/DIA_contrast.cpp:362
+msgid "Chroma V"
+msgstr "????? ?"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:324
+msgid "<b>Color Correction Matrix</b>"
+msgstr "<b>??????? ?? ???????? ????</b>"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:347
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:470
+msgid "Matrix"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:354
+msgid "Opt"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:361
+msgid "Level"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:373
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:381
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:389
+#: avidemux/ADM_dialog/DIA_encoding.cpp:420
+#: avidemux/ADM_dialog/DIA_encoding.cpp:518
+#: avidemux/ADM_dialog/DIA_encoding.cpp:526
+#: avidemux/ADM_dialog/DIA_encoding.cpp:612
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:219
+#: avidemux/ADM_dialog/DIA_audio.cpp:257 avidemux/ADM_dialog/DIA_audio.cpp:290
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:133
+msgid "None"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:374
+msgid "Rec.709"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:382
+msgid "Coring"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:390
+msgid "TV->PC"
+msgstr "??->???????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:391
+msgid "PC->TV"
+msgstr "???????->??"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:392
+msgid "PC->TV.Y"
+msgstr "???????->??.Y"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:398
+msgid ""
+"<b>Matrix Warning :</b>\n"
+"all above values are normalized to 256!"
+msgstr ""
+"<b>????????? ? ??????? :</b>\n"
+"??? ????????? ????? ?? ???? ???????????? ?? 256!"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:404
+msgid "AutoGain"
+msgstr "?????????? ????????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:408
+msgid "Display Stats"
+msgstr "??????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:412
+msgid "AutoWhite"
+msgstr "?????????? ?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_coloryuv.cpp:416
+msgid "<b>frame2</b>"
+msgstr "<b>?????2</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:269
+#, c-format
+msgid "Done : %02d%%"
+msgstr "???????? : %02d%%"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:377
+msgid "Encoding in Progress"
+msgstr "?????????? ? ????"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:387
+msgid "<b><big>Encoding files</big></b>"
+msgstr "<b><big>??????? ?? ??????????</big></b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:400
+msgid "<b>Phasis:</b>"
+msgstr "<b>????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:410
+msgid "<b>Frame:</b>"
+msgstr "<b>?????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:428
+msgid "00000/00000"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:436
+msgid "<b>Vid codec:</b>"
+msgstr "<b>????? ?????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:447
+msgid "<b>Aud Codec:</b>"
+msgstr "<b>????? ?????</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:457
+msgid "<b>FPS:</b>"
+msgstr "<b>??????? ? ???????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:467
+msgid "<b>Vid Bitrate:</b>"
+msgstr "<b>????? ???????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:477
+msgid "<b>Quantizer:</b>"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:487
+msgid "<b>Video Size:</b>"
+msgstr "<b>???????? ?????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:498
+msgid "<b>Audio Size:</b>"
+msgstr "<b>???????? ?????</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:508
+msgid "<b>Total Size:</b>"
+msgstr "<b>?????? ????????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:534
+#: avidemux/ADM_dialog/DIA_encoding.cpp:542
+#: avidemux/ADM_dialog/DIA_encoding.cpp:558
+#: avidemux/ADM_dialog/DIA_encoding.cpp:566
+#: avidemux/ADM_dialog/DIA_encoding.cpp:574
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:166
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:206
+#: avidemux/ADM_dialog/DIA_resize.cpp:419
+#: avidemux/ADM_dialog/DIA_resize.cpp:433 avidemux/ADM_dialog/DIA_srt.cpp:649
+#: avidemux/ADM_dialog/DIA_ocr.cpp:148 avidemux/ADM_dialog/DIA_ocr.cpp:156
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:659
+#: avidemux/ADM_dialog/DIA_calculator.cpp:633
+#: avidemux/ADM_dialog/DIA_calculator.cpp:649
+#: avidemux/ADM_dialog/DIA_calculator.cpp:665
+#: avidemux/ADM_dialog/DIA_calculator.cpp:695
+#: avidemux/ADM_gui2/GUI_main2.cpp:1390
+msgid "0"
+msgstr "0"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:550
+msgid "31"
+msgstr "31"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:582
+msgid "<b>ETA:</b>"
+msgstr "<b>????????? ?????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:592
+msgid "0 h 0 mn 0 s"
+msgstr "0 ???? 0 ??? 0 ???"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:602
+msgid "<b>Container:</b>"
+msgstr "<b>?????????:</b>"
+
+#: avidemux/ADM_dialog/DIA_encoding.cpp:649
+msgid "Pause / Abort"
+msgstr "????? / ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:109
+msgid "Select Xvid matrix file to load"
+msgstr "??????? ???????? ?? Xvid ???????? ?? ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:121
+msgid "Error Loading"
+msgstr "?????? ???????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:121
+msgid "Error loadind the custom matrix file."
+msgstr "?????? ??? ????????? ???????? ?? ????????."
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:139
+msgid "Matrix Loaded"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:139
+msgid "The custom matrix file has been successfully loaded."
+msgstr "???????? ?? ???????? ?? ??????? ???????."
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:479
+msgid "Select Custom Matrix File to write"
+msgstr "??????? ???????? ?? ???? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:484
+msgid "Error Writing"
+msgstr "?????? ??? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:484
+msgid "Error writing the custom matrix file."
+msgstr "?????? ??? ????? ??????? ? ????????."
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:700
+msgid "XviD encoding options"
+msgstr "?????? XviD ??????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:734
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:554
+msgid "Encoding type:"
+msgstr "??? ??????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:739
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:562
+msgid "Bitrate (kb/s):"
+msgstr "??????? (??/???)"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:744 avidemux/ADM_dialog/DIA_SVCD.cpp:368
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:570
+msgid "Quantizer:"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:756
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:583
+msgid "Select 1-pass or 2-pass encoding"
+msgstr "??????? ????? ??? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:760
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:587
+msgid "Single pass - bitrate"
+msgstr "????? ?????? - ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:764
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:591
+msgid "Single pass - quantizer"
+msgstr "????? ?????? - ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:768
+msgid "Two pass, final size"
+msgstr "??? ??????? - ???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:772
+msgid "Two pass, average bitrate"
+msgstr "??? ??????? - ?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:776
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:599
+msgid "Same Qz as input"
+msgstr "???? ??? ? ??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:785
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:618
+msgid "Target video bitrate"
+msgstr "??????? ???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:792
+msgid "Constant quantizer - each frame will get the same compression"
+msgstr "?????? ????????? - ????? ????? ?? ????? ???? ???? ??????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:794
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:621
+msgid "Variable bitrate mode"
+msgstr "????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:806
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:634
+msgid "_Interlaced"
+msgstr "_???????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:809
+msgid ""
+"Enables interlaced frame support - use only if your source contains "
+"interlacing artifacts (i.e. fields instead of progressive frames)"
+msgstr ""
+"????????? ??????? ????????????? ??????? - ??????? ???? ??????? ??????????? "
+"???????????? ?????? (?? ?????? ???? ?????? ???????????? ???????)"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:811
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:639
+msgid "_Greyscale"
+msgstr "_????-????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:814
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:642
+msgid "Encode in black & white"
+msgstr "????????? ????-????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:820
+msgid "Ca_rtoon mode"
+msgstr "??? ?? _?????? ????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:823
+msgid "Enables special motion estimation features for cartoons/anime"
+msgstr "????????? ?????????? ????????? ??????? ?? ?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:825
+msgid "C_hroma optimizer"
+msgstr "????? ????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:828
+msgid "Enables a chroma optimizer prefilter"
+msgstr "????????? ?????????? ?? ???????????? ??????? ????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:834
+msgid "Turbo Mode"
+msgstr "???? ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:837
+msgid "Enables fast 1st pass encoding"
+msgstr "??????? ??? ???? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:839
+msgid "Packed bitstream"
+msgstr "???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:842
+msgid "Enables Divx like packed vop, DO NOT SET, it is ugly"
+msgstr ""
+"????????? VOP ???????? ?????? ??? ??? Divx-?.?? ????????? ???, ????? ??"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:844
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:668
+msgid "Main"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:863
+msgid "Motion search precision:"
+msgstr "?????????? ??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:867
+msgid "VHQ mode:"
+msgstr "VHQ ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:880
+msgid ""
+"Higher settings give higher quality results, at the cost of slower encoding"
+msgstr ""
+"(????? ??????? ?????????)???? ????????? ???? ???? ????????, ??? ?? ????????? "
+"???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:884 avidemux/ADM_dialog/DIA_xvid.cpp:357
+msgid "0 - None"
+msgstr "0 - ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:888
+msgid "1 - Very low"
+msgstr "1 - ????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:892
+msgid "2 - Low"
+msgstr "2 - ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:896
+msgid "3 - Medium"
+msgstr "3 - ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:900
+msgid "4 - High"
+msgstr "4 - ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:904
+msgid "5 - Very high"
+msgstr "5 - ????? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:908
+msgid "6 - Ultra high"
+msgstr "6 - ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:917
+msgid "VHQ enables an additional search process to increase quality"
+msgstr ""
+"VHQ (????? ??????? ?????????) ????????? ??????? ???? ???????????????? "
+"???????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:921
+msgid "0 - Off"
+msgstr "0 - ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:925
+msgid "1 - Mode decision"
+msgstr "1 - ???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:929
+msgid "2 - Limited search"
+msgstr "2 - ?????????? ????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:933
+msgid "3 - Medium search"
+msgstr "3 - ?????? ???? ????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:937
+msgid "4 - Wide search"
+msgstr "4 - ?????? ????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:947
+msgid "C_hroma motion"
+msgstr "_??????? ??????? ????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:950
+msgid "Use chroma information to estimate motion"
+msgstr "??????? ??????????? ? ??????? ???? ?? ??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:952
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:708
+msgid "_4MV"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:955
+msgid "Use 4 motion vectors per macroblock, might give better compression"
+msgstr ""
+"??????? 4 ??????? ??????? ?? ??????????.???? ?? ????????? ????? ???????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:957
+msgid "HQ _AC"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:960
+msgid ""
+"Enable a better prediction of AC component. Turns on Lumi masking - applies "
+"more compression to dark/light areas that the eye cannot notice easily"
+msgstr ""
+"????????? ???? ?????????? AC ??????????. ???????? ????????? ?????? ?????? - "
+"????????? ???? ?????????? ?? ???????/??????? ???????? ???? ??? ?? ???? ???? "
+"?? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:966
+msgid "I-frame interval - Min:"
+msgstr "???????? ? ????? - ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:974
+msgid "Minimum space between I-frames, 1 will disable forced I-frame spacing"
+msgstr "????????? ????? ?????? ? ??????. 1 ????????? ????????? ??????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:976
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1194
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1199
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1204
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1242
+msgid "Max:"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:984
+msgid "Maximum number of frames allowed between I-frames"
+msgstr "??????? ???? ??????? ?????????? ?????? ? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:999
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:772
+msgid "Number of B-frames:"
+msgstr "???? ? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1007
+msgid ""
+"Maximum number of sequential B-frames (when set to 0, the original I/P "
+"encoder is used)"
+msgstr ""
+"??????? ???? ????????? ? ??????? (???? ?? 0, ?????????? ?/? ???????????? "
+"???? ?????????)"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1013
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:784
+msgid "_Qpel"
+msgstr "_Qpel"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1016
+msgid "Use Quarter pixel resolution for a more precise motion estimation"
+msgstr "??????? ?????????? ????????? ??????? ?? ?????????? ???????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1018
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:789
+msgid "_GMC"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1021
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:792
+msgid ""
+"Global Motion Compensation can save bits on camera pans, zooming and rotation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1023
+msgid "_BVHQ"
+msgstr "_BVHQ"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1026
+msgid "Produces nicer-looking B-frames"
+msgstr "????????? ????? ? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1028
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:794
+msgid "Advanced Simple Profile"
+msgstr "???????? ?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1040
+msgid "As input"
+msgstr "??? ? ????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1043
+msgid "Get PAR from input video file"
+msgstr "???? PAR ?? ?????? ????? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1049
+msgid "Pixel Width"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1051 avidemux/ADM_dialog/DIA_x264.cpp:677
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:658
+msgid ":"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1060
+msgid "Pixel Height"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1061
+msgid "Pixel Aspect Ratio"
+msgstr "??????? ???????:"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1066 avidemux/ADM_dialog/DIA_x264.cpp:773
+msgid "Motion & Misc"
+msgstr "??????? ? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1079
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1163
+msgid "Quantization type:"
+msgstr "??? ????????????: "
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1083
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1216
+msgid "_H.263"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1086
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1219
+msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
+msgstr "H.263 ????????? ???????? ????? (??????? ?? ???? ??????????)"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1090
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1223
+msgid "_MPEG"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1093
+msgid ""
+"MPEG quantizers (slightly slower) produce sharper picture (useful at higher "
+"bitrates)"
+msgstr ""
+"MPEG ????????? (???????? ???????) ????????? ??????? ?????(??????? ?? ???? "
+"??????????)"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1097
+msgid "_Custom Matrix"
+msgstr "_?????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1107
+msgid "Load Custom Matrix:  "
+msgstr "?????? ?????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1128
+msgid "Open CQM file"
+msgstr "?????? CQM ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1136
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1568
+msgid "Edit Custom Matrix"
+msgstr "?????? ?????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1153
+msgid "I-frame quantizer - Min:"
+msgstr "????????? ? ????? - ??? "
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1158
+msgid "P-frame quantizer - Min:"
+msgstr "????????? ? ????? - ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1163
+msgid "B-frame quantizer - Min:"
+msgstr "????????? ? ????? - ???"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1176
+msgid "Minimum quantizer allowed for I-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1182
+msgid "Minimum quantizer allowed for P-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1188
+msgid "Minimum quantizer allowed for B-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1217
+msgid "Maximum quantizer allowed for I-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1223
+msgid "Maximum quantizer allowed for P-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1229
+msgid "Maximum quantizer allowed for B-frames"
+msgstr "??????? ????????? ???????? ?? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1231
+msgid "Quantizer restrictions"
+msgstr "?????????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1235
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1254
+msgid "_Trellis quantization"
+msgstr "_?????? ????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1238
+msgid "Rate distortion quantization, will find optimal encoding for each block"
+msgstr "Rate distortion ???????????? ?? ???? ????????? ????????? ?? ????? ????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1240 avidemux/ADM_dialog/DIA_xvid.cpp:309
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1266
+msgid "Quantization"
+msgstr "????????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1268
+msgid "I-frame boost (%):"
+msgstr "???????? ? ????? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1273
+msgid "I-frames closer than ... frames..."
+msgstr "? ??????? ????? ????... ???????..."
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1278
+msgid "...are reduced by (%):"
+msgstr "...?? ??????? ?? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1283
+msgid "Max overflow improvement (%):"
+msgstr "??????? overflow ?????????? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1288
+msgid "Max overflow degradation (%):"
+msgstr "??????? overflow ????????? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1300
+#, c-format
+msgid "A value of 20 will give 20% more bits to every I-frame"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1306
+msgid ""
+"I-frames appearing in the range below this value will be treated as "
+"consecutive keyframes"
+msgstr ""
+"? ??????? ???? ?? ????????? ? ?????? ????? ??? ????????? ?? ????????????? "
+"??? consecutive ?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1311
+msgid ""
+"Reduction of bitrate for the first consecutive I-frames. The last I-frame "
+"will get treated normally"
+msgstr ""
+"??????? ???????? ?? ???? consecutive ? ?????. ???????? ? ??????? ???? "
+"???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1316
+msgid ""
+"How much of the overflow the codec can eat into during undersized sections - "
+"larger values will bridge the gap faster"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1321
+msgid ""
+"How much of the overflow the codec can eat into during oversized sections - "
+"larger values will bridge the gap faster"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1323
+msgid "Two pass tuning"
+msgstr "?????????? ?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1340
+msgid "High bitrate scenes (%):"
+msgstr "????? ?? ??????? ????????? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1345
+msgid "Low bitrate scenes (%):"
+msgstr "????? ?? ?????? ????????? (%):"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1350
+msgid "Overflow control strength (%):"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1362
+msgid ""
+"The higher this value, the more bits get taken from frames larger than the "
+"average size, and redistributed to others"
+msgstr ""
+"??? ?? ???????? ????, ???? ???? ?????? ?? ???? ????? ?? ??????? ????? "
+"?????????? ???????? ? ???? ???? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1367
+msgid ""
+"The higher this value, the more bits get assigned to frames below the "
+"average frame size"
+msgstr ""
+"??? ?? ???????? ????, ???? ?????? ?? ???? ????? ?? ??????????? ?? ???????? "
+"???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1372
+msgid ""
+"0 = default from core (let XviD decide), else overflow payback percent per "
+"frame"
+msgstr ""
+"0 = ???????????? ?? ?????? (????? ?? XviD ??????), ? ????????? "
+"overflow?????? ???????????? ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1374
+msgid "Curve compression"
+msgstr "??????????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1378
+msgid "Second Pass"
+msgstr "????? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1591
+msgid "<b>Intra Matrix</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid4.cpp:1609
+msgid "<b>Inter Matrix</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mjpeg.cpp:73
+msgid "Mjpeg Codec settings"
+msgstr "???????? Mjpeg ??????"
+
+#: avidemux/ADM_dialog/DIA_mjpeg.cpp:82
+msgid "Quality"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_mjpeg.cpp:93
+#: avidemux/ADM_dialog/DIA_postproc.cpp:131
+msgid "Swap U & V"
+msgstr "?????? ? ? ?"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:186
+msgid "XVCD encoding"
+msgstr "XVCD ??????????"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:195 avidemux/ADM_dialog/DIA_xvid.cpp:250
+msgid "Constant Quantizer"
+msgstr "?????????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:209
+msgid "Constant Bitrate"
+msgstr "?????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:223
+msgid "Dual pass"
+msgstr "????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:237
+msgid "Min bitrate (kbps) :"
+msgstr "??????? ??????? (??/???)"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:245
+msgid "Max bitrate (kbps) :"
+msgstr "??????? ??????? (??/???)"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:265
+msgid "Matrices"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:281
+msgid "Default mpeg"
+msgstr "????????????? mpeg"
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:285
+msgid "Tmpeng "
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:289
+msgid "Anim?"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:293
+msgid "K-VCD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:299
+msgid "Gop Size  (12):"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvcd.cpp:315
+msgid "Use Xvid ratecontrol"
+msgstr "??????? Xvid ???????? ???????"
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:144
+msgid "Builtin support for"
+msgstr "???????? ??????? ??"
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:158
+msgid ""
+"If an option is not checked, it means\n"
+"you must RECOMPILE avidemux to have\n"
+"support for it!"
+msgstr ""
+"??????? ?? ????? ?????? ???? ????????,\n"
+"?????? ?? ?????? ????????? ??????? ???\n"
+"Avidemux-? ?? ?? ???? ????????!"
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:171
+msgid "X264"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:178
+msgid "ESD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:185
+msgid "Arts"
+msgstr "aRts"
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:192
+msgid "Vorbis"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:199
+msgid "Altivec"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:206
+msgid "Mad"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:213
+msgid "A52"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:220
+msgid "Win32"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:227
+msgid "Freetype"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:234
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:185
+msgid "Xvid"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:301
+msgid "FAAC"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:308
+msgid "FAAD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_builtin.cpp:327
+msgid "libDCA/libDTS"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:47
+msgid " No"
+msgstr " ??"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:47
+msgid " Yes"
+msgstr " ??"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:141
+#, c-format
+msgid "NONE"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:207
+msgid "Informations"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:229
+msgid "Frame Rate"
+msgstr "?????????? ??????? "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:236
+msgid "# of frames"
+msgstr "# ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:243
+msgid "Codec 4CC"
+msgstr "????? 4CC"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:250
+msgid "Video Duration  "
+msgstr "??????? ????? "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:264
+#: avidemux/ADM_dialog/DIA_properties.cpp:292
+#: avidemux/ADM_dialog/DIA_ocr.cpp:208 avidemux/ADM_dialog/DIA_ocr.cpp:271
+#: avidemux/ADM_dialog/DIA_deblend.cpp:117
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:119
+#: avidemux/ADM_dialog/DIA_asharp.cpp:362
+msgid " "
+msgstr " "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:271
+msgid "Image size"
+msgstr "???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:299
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:438
+msgid "Aspect Ratio"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:306
+msgid "-/-"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:339
+msgid "Packed Bistream"
+msgstr "?????????? ????????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:346
+msgid "Quarter Pixel"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:353
+msgid "GMC "
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:381
+msgid "<b>Extra Properties</b>"
+msgstr "<b>??????? ??????????</b>"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:386
+#: avidemux/ADM_gui2/GUI_main2.cpp:999
+msgid "<b>Video</b>"
+msgstr "<b>?????</b>"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:399
+msgid "Codec "
+msgstr "????? "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:406
+msgid "Channels  "
+msgstr "??????  "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:413
+msgid "Bitrate "
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:420
+msgid "Frequency"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:427
+msgid "Audio duration  "
+msgstr "??????? ?????? "
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:469
+msgid "VBR"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_properties.cpp:482
+#: avidemux/ADM_dialog/DIA_dmx.cpp:222 avidemux/ADM_gui2/GUI_main2.cpp:1039
+msgid "<b>Audio</b>"
+msgstr "<b>?????</b>"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:51
+msgid "Continue indexing"
+msgstr "??????? ???????????"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:51
+msgid "Abort Requested"
+msgstr "?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:51
+msgid "Do you want to abort indexing ?"
+msgstr "?? ?? ?????? ?? ????????? ????????????"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:153
+msgid "Indexing..."
+msgstr "??????????..."
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:174
+#: avidemux/ADM_dialog/DIA_working.cpp:257
+msgid "Time left :"
+msgstr "???????? ????? :"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:182
+msgid "Timecode :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:190
+msgid "Nb pictures seen :"
+msgstr "???? ?????????? ????? :"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:198
+#: avidemux/ADM_dialog/DIA_calculator.cpp:437
+msgid "00:00:00"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:214
+msgid "Indexing :"
+msgstr "??????????:"
+
+#: avidemux/ADM_dialog/DIA_idx_pg.cpp:222
+msgid "/dev/null"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_exLame.cpp:80
+msgid "Lame command"
+msgstr "Lame ???????"
+
+#: avidemux/ADM_dialog/DIA_exLame.cpp:89
+msgid "Enter parameters (i.e. -b 192 -m s ...)"
+msgstr "????? ????????? (?? ?????? -b 192 -m s ...)"
+
+#: avidemux/ADM_dialog/DIA_enter.cpp:165
+msgid "Title"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_enter.cpp:174 avidemux/ADM_dialog/DIA_enter.cpp:232
+#: avidemux/ADM_dialog/DIA_enter.cpp:297
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:587
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:659
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:721
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:781
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:844
+msgid "label1"
+msgstr "??????1"
+
+#: avidemux/ADM_dialog/DIA_enter.cpp:223
+#: avidemux/ADM_dialog/DIA_working.cpp:244 avidemux/ADM_dialog/DIA_d3d.cpp:93
+#: avidemux/ADM_dialog/DIA_4entries.cpp:88
+msgid "dialog1"
+msgstr "???????1"
+
+#: avidemux/ADM_dialog/DIA_enter.cpp:305
+msgid "label2"
+msgstr "??????2"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:113
+msgid "DGbob"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:122
+#: avidemux/ADM_dialog/DIA_dectel.cpp:152
+msgid "Field Order"
+msgstr "???????? ????"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:130
+#: avidemux/ADM_dialog/DIA_decimate.cpp:141
+msgid "Mode"
+msgstr "???"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:138
+#: avidemux/ADM_dialog/DIA_msharpen.cpp:141
+msgid "Threshold"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:146
+msgid "Extra check"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:160
+msgid "BFF"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:166
+msgid "TFF"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:180
+msgid "Keep fps and frame #"
+msgstr "?????? ???? ??????? ?? ??? ? ????? #"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:184
+msgid "Double fps and frame #"
+msgstr "?????????? ???? ??????? ?? ??? ? ????? #"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:188
+msgid "Double frame # (slow mo)"
+msgstr "?????????? ????? # (????????)"
+
+#: avidemux/ADM_dialog/DIA_dgbob.cpp:200
+msgid "(avoid using it)"
+msgstr "(??????? ?? ????????)"
+
+#: avidemux/ADM_dialog/DIA_recent.cpp:96
+msgid "Recent files"
+msgstr "???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_working.cpp:168
+#, c-format
+msgid " %d m %d s left"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_working.cpp:262
+msgid "0:0:0"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_busy.cpp:120
+msgid "Busy"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_gototime.cpp:73
+msgid "Go to time"
+msgstr "????? ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_gototime.cpp:88
+msgid "h"
+msgstr "???"
+
+#: avidemux/ADM_dialog/DIA_gototime.cpp:98
+msgid "mn"
+msgstr "???"
+
+#: avidemux/ADM_dialog/DIA_gototime.cpp:108
+msgid "s"
+msgstr "???"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:159
+msgid "TDeint param"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:173
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:117
+msgid "Field Order :"
+msgstr "???????? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:185
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:125
+#: avidemux/ADM_dialog/DIA_dectel.cpp:167
+msgid "Bottom Field First"
+msgstr "?????? ???? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:186
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:131
+#: avidemux/ADM_dialog/DIA_dectel.cpp:171
+msgid "Top Field First"
+msgstr "?????? ????? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:188
+msgid "Interpolate :"
+msgstr "?????? :"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:200
+msgid "Top field (keep bottom)"
+msgstr "????? ???? (??????? ????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:201
+msgid "Bottom field (keep top)"
+msgstr "???? ???? (??????? ?????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:203
+msgid "Type"
+msgstr "???"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:215
+msgid "Cubic Interpolation"
+msgstr "????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:216
+msgid "Modified ELA"
+msgstr "???????? ELA"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:217
+msgid "Kernerl interpolation"
+msgstr "?????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:218
+msgid "Modified ELA-2"
+msgstr "???????? ELA-2"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:220
+msgid "MntMode"
+msgstr "?nt ???"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:232
+msgid "4 field check"
+msgstr "??????? ?? 4 ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:233
+msgid "5 field check"
+msgstr "??????? ?? 5 ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:234
+msgid "4 field check (no average)"
+msgstr "??????? ?? 4 ???? (?? ???????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:235
+msgid "5 field check (no average)"
+msgstr "??????? ?? 4 ???? (?? ???????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:237
+msgid "Use Chroma to evalute"
+msgstr "??????? ?????? ???? ?? ???????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:250
+msgid "Try weave "
+msgstr "????? ?????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:263
+#: avidemux/ADM_filter/gui_filterlist.cpp:173
+msgid "Denoise"
+msgstr "??????? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:276
+msgid "Link"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:288
+msgid "No link"
+msgstr "??? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:289
+msgid "Full linking"
+msgstr "???? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:290
+msgid "Y to UV link"
+msgstr "???? Y ?? UV"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:291
+msgid "UV to Y link"
+msgstr "???? UV ?? Y"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:293
+msgid "Sharp :"
+msgstr "????? :"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:306
+msgid "AP type"
+msgstr "AP ???"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:319
+msgid "Evaluate ALL frames"
+msgstr "??????? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:331
+msgid "0 (read manual)"
+msgstr "0 (???????? ????????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:332
+msgid "1 (read manual)"
+msgstr "1 (???????? ????????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:333
+msgid "2 (read manual)"
+msgstr "2 (???????? ????????)"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:339
+msgid "motion Threshold, Luma"
+msgstr "?????????? ???????, ???????????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:346
+msgid "motion Threshold, Chroma"
+msgstr "?????????? ???????, ?????? ????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:369
+msgid "Area Combing Threshold"
+msgstr "??????????? ??????????? ????????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:383
+msgid "Combed Treshold"
+msgstr "Combed ??????????"
+
+#: avidemux/ADM_dialog/DIA_tdeint.cpp:398
+msgid "Artefact Protection threshold "
+msgstr "?????????? ?? ??????? ?? ?????????"
+
+#: avidemux/ADM_dialog/DIA_equalizer.cpp:433
+msgid "Equalizer"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_mpeg2opt.cpp:104
+msgid "Mpeg2 options"
+msgstr "Mpeg2 ??????"
+
+#: avidemux/ADM_dialog/DIA_mpeg2opt.cpp:113
+msgid "Other arg"
+msgstr "?????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_mpeg2opt.cpp:121
+msgid "Quantisation (2-31)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mpeg2opt.cpp:129
+msgid "Maximum bitrate (kbps)"
+msgstr "??????? ??????? (??/???)"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:304
+msgid "DVD Parameters"
+msgstr "??? ?????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:325
+msgid "Encoding Type:"
+msgstr "??? ??????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:336
+msgid "Single pass:Bitrate"
+msgstr "????? ??????: ???????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:340
+msgid "Single pass:Quantizer"
+msgstr "????? ??????: ?????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:344
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:595
+msgid "Two pass"
+msgstr "??? ???????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:354
+msgid "Bitrate (kb/s)"
+msgstr "?????? (??/???)"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:380
+msgid "Encoding mode"
+msgstr "????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:392 avidemux/ADM_dialog/DIA_DVDff.cpp:541
+msgid "Progressive"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:398 avidemux/ADM_dialog/DIA_DVDff.cpp:547
+msgid "Interlaced TFF"
+msgstr "???????????? TFF"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:404 avidemux/ADM_dialog/DIA_DVDff.cpp:553
+msgid "Interlaced BFF"
+msgstr "???????????? BFF"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:410
+#: avidemux/ADM_filter/gui_filterlist.cpp:123
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:283
+msgid "Interlacing"
+msgstr "????????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:426 avidemux/ADM_dialog/DIA_resize.cpp:380
+#: avidemux/ADM_dialog/DIA_resize.cpp:402
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:577
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:124
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:141
+msgid "4:3"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:432 avidemux/ADM_dialog/DIA_resize.cpp:384
+#: avidemux/ADM_dialog/DIA_resize.cpp:406
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:583
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:125
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:142
+msgid "16:9"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:452 avidemux/ADM_dialog/DIA_DVDff.cpp:605
+msgid "Default"
+msgstr "?????????????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:456 avidemux/ADM_dialog/DIA_DVDff.cpp:609
+msgid "Tmpgenc"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:460 avidemux/ADM_dialog/DIA_DVDff.cpp:613
+msgid "Anime"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:464 avidemux/ADM_dialog/DIA_DVDff.cpp:617
+msgid "KVCD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:478 avidemux/ADM_dialog/DIA_DVDff.cpp:637
+msgid "Gop Size:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_SVCD.cpp:494
+msgid "Max Bitrate:"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:98
+msgid "Select .idx file"
+msgstr "??????? .idx ????????"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:196
+msgid "VobSub Settings"
+msgstr "VobSub ????????"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:213
+msgid "Select .idx"
+msgstr "??????? .idx"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:227
+msgid "Select Language :"
+msgstr "??????? ?????"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:241
+msgid "Select Sub"
+msgstr "??????? Sub"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:254
+msgid "Extra Shrink Factor :"
+msgstr "??????? ?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:269
+msgid "Shift (ms) :"
+msgstr "?????? (????)"
+
+#: avidemux/ADM_dialog/DIA_vobsub.cpp:283
+msgid "Extra Settings"
+msgstr "??????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:104
+msgid "Kernel Deinterlacer"
+msgstr "????????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:141
+#: avidemux/ADM_dialog/DIA_Msmooth.cpp:141
+#: avidemux/ADM_dialog/DIA_deblend.cpp:124
+#: avidemux/ADM_dialog/DIA_asharp.cpp:306
+msgid "Threshold :"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:149
+msgid "smaller means deinterlace more!"
+msgstr "???? ???? ????????!"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:152
+msgid "Sharp"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:155
+msgid "Sharper engine"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:157
+msgid "Two Way"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:160
+msgid "Extrapolate two ways (better not use it)"
+msgstr "Extrapolate two ways (????? ?? ???????)"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:162
+msgid "Map"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_kerneldeint.cpp:165
+msgid "Show the interlaced areas (test only!)"
+msgstr "??????? ???????????? ???????? (???? ?? ?????????!)"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:209
+msgid "Audio Processing"
+msgstr "????????? ?????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:227
+msgid "DRC"
+msgstr "????????? ????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:235
+msgid "Timeshift"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:244
+msgid "<b>Misc</b>"
+msgstr "<b>??????</b>"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:267
+msgid "Resample to hz"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:277
+msgid "<b>Resampling</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:296
+msgid "Film -> PAL"
+msgstr "???? -> ???"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:302
+msgid "PAL->Film"
+msgstr "??? -> ????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:308
+msgid "<b>Fps convert</b>"
+msgstr "<b>??????? ????? ??????? ?? ???????</b>"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:335
+msgid "Automatic ( max is -3dB)"
+msgstr "?????????? (??????? ?? -3dB)"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:345
+msgid "Manual (db) : "
+msgstr "????? (dB) :"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:357
+msgid "<b>Gain</b>"
+msgstr "<b>????????</b>"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:369
+msgid "No change"
+msgstr "??? ??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:370 avidemux/ADM_dialog/DIA_lame.cpp:169
+msgid "Mono"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:371
+#: avidemux/ADM_dialog/DIA_audiocodec.cpp:160
+#: avidemux/ADM_dialog/DIA_lame.cpp:170 avidemux/ADM_dialog/DIA_prefs.cpp:598
+msgid "Stereo"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:372
+msgid "Stereo+Surround"
+msgstr "??????+???????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:373
+msgid "Stereo+Center"
+msgstr "??????+??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:374
+msgid "Stereo+Center+Surround"
+msgstr "??????+??????+???????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:375
+msgid "Stereo Front+Stero Rear"
+msgstr "?????? ??????+?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:376
+msgid "5 channels"
+msgstr "5 ??????"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:377
+msgid "5.1"
+msgstr "5.1"
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:378 avidemux/ADM_dialog/DIA_prefs.cpp:599
+msgid "Dolby Prologic"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:379 avidemux/ADM_dialog/DIA_prefs.cpp:600
+msgid "Dolby Prologic 2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_audio.cpp:381
+msgid "<b>Mixer</b>"
+msgstr "<b>??????</b>"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:312
+msgid "Resize"
+msgstr "??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:326
+msgid " Width "
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:333
+msgid " Height "
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:356
+msgid "Source :"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:362
+msgid "Destination"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:376
+#: avidemux/ADM_dialog/DIA_resize.cpp:398
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:123
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:140
+msgid "1:1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:412
+msgid " Error X:"
+msgstr " ?????? X:"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:426
+msgid " Error Y:"
+msgstr " ?????? Y:"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:440
+msgid "16 round up"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:454
+msgid "Bilinear"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:458
+msgid "Bicubic"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_resize.cpp:462
+msgid "Lanczos3"
+msgstr "??????3"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:544
+msgid "Crop Settings"
+msgstr "?????????? ???????"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:578
+msgid "AutoCrop"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:600
+msgid "Reset"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:609
+msgid "Crop Left :"
+msgstr "????? ????:"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:617
+msgid "Crop Top:"
+msgstr "????? ????:"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:625
+msgid "Crop Right:"
+msgstr "????? ?????:"
+
+#: avidemux/ADM_dialog/DIA_crop.cpp:633
+msgid "Crop Bottom:"
+msgstr "????? ????:"
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:150
+msgid "VideoCodec"
+msgstr "????? ?????"
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:169
+msgid "FFmpeg Mpeg4"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:173
+msgid "FFmpeg H263"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:177
+msgid "FFmpeg H263+"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:181
+msgid "FFmpeg Huffyuv"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:189
+msgid "Divx"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:193
+msgid "Mjpeg"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:199
+msgid "Configure Codec"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_vcodec.cpp:207 avidemux/ADM_gui2/GUI_main2.cpp:950
+msgid "Calculator"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_pause.cpp:93
+msgid "Paused"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_pause.cpp:109
+msgid ""
+"<b>Encoding is paused.</b>\n"
+"\n"
+"You can either resume or Abort it."
+msgstr ""
+"<b>?????????? ?? ???????????.</b>\n"
+"?????? ??? ????????? ??? ????????? ??????????.</b>"
+
+#: avidemux/ADM_dialog/DIA_pause.cpp:136
+msgid "Abort"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_pause.cpp:158
+msgid "Resume"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:375
+msgid "Subtitle to load"
+msgstr "???? ?? ?????????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:385
+msgid "TTF font to use"
+msgstr "??? ?????? ???"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:502
+msgid "Subtitle selector"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:515
+msgid "Subtitle file "
+msgstr "???????? ?? ??????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:522
+msgid "Font (TTF)"
+msgstr "?????? ??? (???)"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:529
+msgid "Encoding "
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:536
+msgid "Font Size"
+msgstr "???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:549
+msgid "sub"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:567
+msgid "font"
+msgstr "?????? ???"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:587
+msgid "Ascii"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:613
+msgid "Select color"
+msgstr "??????? ????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:626
+msgid "Select"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:630
+msgid "Auto split"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:636
+msgid "Delay in ms"
+msgstr "??????? ? ????"
+
+#: avidemux/ADM_dialog/DIA_srt.cpp:651
+msgid "Force background"
+msgstr "?????? ????????"
+
+#: avidemux/ADM_dialog/DIA_d3d.cpp:102
+msgid "Spatial Luma Thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_d3d.cpp:110
+msgid "Spatial Chroma Thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_d3d.cpp:118
+msgid "Temporal Thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_color.cpp:71
+msgid "Select Color"
+msgstr "??????? ????"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:56
+msgid "Select Vob file to scan"
+msgstr "??????? Vob ???????? ?? ?????????"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:67
+msgid "Select ifo file to use"
+msgstr "??????? ???? ifo ???????? ?? ????????"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:78
+msgid "Select vobsub to write"
+msgstr "??????? vobsub ?? ????"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:92
+msgid "Invalid vobname"
+msgstr "???????? vob ???"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:92
+msgid "Please select or enter a valid vob name"
+msgstr "????????? ??? ??????? ???????? vob ???"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:98
+msgid "Invalid ifo"
+msgstr "???????? ifo"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:98
+msgid "Please select or enter a valid ifo file"
+msgstr "????????? ??? ??????? ???????? ifo ????????"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:104
+msgid "Invalid vobsubname"
+msgstr "???????? vobsub ???"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:104
+msgid "Please select or enter a valid vobsub file"
+msgstr "????????? ??? ??????? ???????? vobsub ???"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:152
+msgid "Vob to Vobsub"
+msgstr "Vob ? Vobsub"
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:162
+msgid "Vob :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:169
+msgid "Ifo :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_v2v.cpp:176
+msgid "Output vobsub (.idx) :"
+msgstr "??????? vobsub (.idx) :"
+
+#: avidemux/ADM_dialog/DIA_preview.cpp:283 avidemux/ADM_gui2/GUI_main2.cpp:961
+#: avidemux/ADM_filter/gui_filtersub.cpp:150
+msgid "Preview"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_preview.cpp:319
+msgid "Stack Field"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_hue.cpp:246
+msgid "Hue/Saturation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_hue.cpp:260
+msgid "<b>Hue:</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_hue.cpp:268
+msgid "<b>Saturation:</b>"
+msgstr "<b>??????????:</b>"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:92
+msgid "Select background picture"
+msgstr "??????? ?????????? ?????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:178
+msgid "Animated Menu"
+msgstr "????????? ????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:202
+msgid "BackGround Image :"
+msgstr "?????????? ?????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:209
+msgid "Standard"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:216
+msgid "NTSC (default is PAL)"
+msgstr "NTSC (????????????? ?? PAL)"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:236
+msgid "Vignette Width"
+msgstr "?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:243
+msgid "Vignette Height"
+msgstr "?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:266
+msgid "<b>General</b>"
+msgstr "<b>?????</b>"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:285
+msgid "Chapter 1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:292
+msgid "Chapter 2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:299
+msgid "Chapter 3"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:306
+msgid "Chapter 4"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:313
+msgid "Chapter 5"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:320
+msgid "Chapter 6"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:333
+#: avidemux/ADM_dialog/DIA_animated.cpp:342
+#: avidemux/ADM_dialog/DIA_animated.cpp:351
+#: avidemux/ADM_dialog/DIA_animated.cpp:360
+#: avidemux/ADM_dialog/DIA_animated.cpp:369
+#: avidemux/ADM_dialog/DIA_animated.cpp:378
+msgid "Start frame for this vignette."
+msgstr "???????? ????? ?? ??? ?????"
+
+#: avidemux/ADM_dialog/DIA_animated.cpp:381
+msgid "<b>TimeCode</b>"
+msgstr "<b>????????? ???</b>"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:85
+msgid "Mini OCR"
+msgstr "???? ???"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:118
+msgid "<b>Glyphs</b>"
+msgstr "<b>?????????</b>"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:132
+msgid "# of Glyphs :"
+msgstr "# ?? ?????????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:140
+msgid "# of lines"
+msgstr "# ?? ??????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:164
+msgid "<b>Stats</b>"
+msgstr "<b>??????????</b>"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:186
+msgid "  "
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:195
+msgid "VobSub"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:217
+msgid "Output Srt"
+msgstr "??????? Srt"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:222
+msgid "<b>Files</b>"
+msgstr "<b>????????</b>"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:228
+msgid "StartOcr"
+msgstr "????? ???"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:249
+msgid "Current Glyph"
+msgstr "???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:263
+msgid " Text:"
+msgstr " ?????:"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:287
+msgid "Calibrate"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:292
+msgid "Skip all"
+msgstr "???????? ???"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:297
+msgid "Skip Glyph"
+msgstr "???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:302
+msgid "Ignore glyph"
+msgstr "???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:307
+msgid "Ok"
+msgstr "? ????"
+
+#: avidemux/ADM_dialog/DIA_ocr.cpp:316
+msgid "<b>Bitmap</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_Msmooth.cpp:116
+msgid "MSmooth settings"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_Msmooth.cpp:125
+msgid "High Quality :"
+msgstr "????? ????????"
+
+#: avidemux/ADM_dialog/DIA_Msmooth.cpp:133
+msgid "Show Mask :"
+msgstr "??????? ????? :"
+
+#: avidemux/ADM_dialog/DIA_Msmooth.cpp:149
+msgid "Filter Strength :"
+msgstr "????? ??????? :"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:330
+msgid "MPlayer eq2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:356
+msgid "Brigh_tness:"
+msgstr "_???????????:"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:364
+msgid "_Saturation:"
+msgstr "_????????"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:399
+msgid "_Contrast:"
+msgstr "????????:"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:425
+msgid "_Initial:"
+msgstr "_??????"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:451
+msgid "_Red:"
+msgstr "_??????:"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:468
+msgid "_Green:"
+msgstr "_??????:"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:476
+msgid "_Blue:"
+msgstr "_?????:"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:484
+msgid "_Weight:"
+msgstr "_????????"
+
+#: avidemux/ADM_dialog/DIA_eq2.cpp:510
+msgid "<b>Gamma</b>"
+msgstr "<b>????</b>"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:134
+msgid "Mpeg, Select audio"
+msgstr "Mpeg, ??????? ????"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:151
+msgid "File :"
+msgstr "???????? :"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:159
+msgid "Type :"
+msgstr "??? :"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:167
+msgid "Video stream :"
+msgstr "????? ????? :"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:175
+msgid "label5"
+msgstr "??????5"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:183
+msgid "label6"
+msgstr "??????6"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:191
+msgid "label7"
+msgstr "??????7"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:199
+msgid "<b>Input file</b>"
+msgstr "<b>?????? ????????</b>"
+
+#: avidemux/ADM_dialog/DIA_dmx.cpp:213
+msgid "Detected Audio :"
+msgstr "?????? ???? :"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:108 avidemux/ADM_dialog/DIA_DVDff.cpp:112
+msgid "Bitrate out of range"
+msgstr "??????? ??? ??????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:108
+msgid "choosing maxBitrate instead"
+msgstr "???????? ??????? ??????? ??????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:112
+msgid "choosing minBitrate instead"
+msgstr "???????? ??????? ??????? ??????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:359
+msgid "DVD FFmpeg codec settings"
+msgstr "?????????? DVD FFmpeg ??????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:376
+msgid "Encoding Type"
+msgstr "??? ??????????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:384
+msgid "Target Bitrate (kb/s)   "
+msgstr "??????? ??????? (????/???)"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:392 avidemux/ADM_dialog/DIA_xvid.cpp:480
+msgid "Quantizer"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:408
+msgid "Single Pass - Bitrate"
+msgstr "????? ?????? - ???????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:412
+msgid "Single Pass - Quantizer"
+msgstr "??? ??????? - ?????????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:416
+msgid "Two Pass (filesize) "
+msgstr "??? ??????? (???????? ????????) "
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:420
+msgid "Two Pass (bitrate) "
+msgstr "??? ??????? (???????) "
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:441
+msgid "<b>Encoding mode </b>"
+msgstr "<b>??? ??????????</b>"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:455
+msgid "Minimum Bitrate (kb/s) "
+msgstr "??????? ??????? (????/???) "
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:463
+msgid "Maximum Bitrate (kb/s)"
+msgstr "??????? ??????? (????/???) "
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:483
+msgid "Use Xvid Ratecontrol"
+msgstr "??????? Xvid ???????? ???????"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:497
+msgid "VBV buffer size"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:513
+msgid "VCD: 40 kB"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:517
+msgid "SVCD: 112 kB"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:521
+msgid "DVD: 224 kB"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:527
+msgid "<b>RateControl</b>"
+msgstr "<b>???????? ???????</b>"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:559
+msgid "<b>Interlacing</b>"
+msgstr "<b>???????????</b>"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:589
+msgid "<b>Aspect Ratio</b>"
+msgstr "<b>???????</b>"
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:621
+msgid "HR-Tmpgenc"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:627
+msgid "<b>Matrices</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:654
+msgid "For info, size is : "
+msgstr "?? ???????????, ???????? ?? : "
+
+#: avidemux/ADM_dialog/DIA_DVDff.cpp:664
+msgid "<b>Indicative audio size</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_4entries.cpp:103
+msgid "Left:"
+msgstr "????:"
+
+#: avidemux/ADM_dialog/DIA_4entries.cpp:119
+msgid "Right:"
+msgstr "?????:"
+
+#: avidemux/ADM_dialog/DIA_4entries.cpp:135
+msgid "Top:"
+msgstr "????:"
+
+#: avidemux/ADM_dialog/DIA_4entries.cpp:151
+msgid "Bottom:"
+msgstr "????:"
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:86
+msgid "Blend removal / Hard pulldown removal"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:96
+#: avidemux/ADM_dialog/DIA_deblend.cpp:103
+#: avidemux/ADM_dialog/DIA_deblend.cpp:110
+msgid "%"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:131
+msgid "Noise threshold :"
+msgstr "?????????? ?? ???"
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:138
+msgid "Identical threshold :"
+msgstr "???? ??????????"
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:145
+msgid "Show metrics"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:158
+msgid ""
+"If the image is closer than treshold, is it considered valid, smaller means "
+"more false detection"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:167
+msgid ""
+"If pixels are closer than noise threshold, they are considered identical"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:176
+msgid ""
+"If the picture are less than identical threshold, they are considered "
+"identical"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_deblend.cpp:184
+msgid "Show metrics in picture (debug only)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_rotate.cpp:226
+msgid "Rotate"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_audiocodec.cpp:112
+msgid "Audio settings"
+msgstr "?????????? ?????"
+
+#: avidemux/ADM_dialog/DIA_audiocodec.cpp:121
+#: avidemux/ADM_dialog/DIA_x264.cpp:530
+msgid "Bitrate"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_audiocodec.cpp:149
+msgid "Mode (ignored for mono)"
+msgstr "??? (???????? ?? ????)"
+
+#: avidemux/ADM_dialog/DIA_audiocodec.cpp:164
+msgid "Joint Stereo"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:125
+msgid "AVI muxer options"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:138
+msgid "Mux audio every"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:146
+msgid "Split in packets of"
+msgstr "?????? ?? ?????? ??"
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:168
+msgid "video frame(s)"
+msgstr "????? ?????/???????"
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:176
+msgid "bytes"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:184
+msgid "Autosplit file every"
+msgstr "?????? ???? ??????"
+
+#: avidemux/ADM_dialog/DIA_muxer.cpp:199
+msgid "megabytes"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:442
+msgid "X264 configuration"
+msgstr "X264 ??????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:457
+msgid "Encoding Mode:"
+msgstr "????? ??????????:"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:469
+msgid "Entry input for target file size or bitrate"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:471
+msgid "Quantizer (0-51):"
+msgstr "????????? (0-51):"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:484
+msgid ""
+"Constant Quantizer - Each frame will the same compression. Low numbers equal "
+"higher quality while high numbers equal lower quality"
+msgstr ""
+"?????????? ????????? - ????? ????? ?? ????? ???? ??????????. ???? "
+"????????????? ???? ???????? ??? ???? ????????? ???? ???? ????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:494
+msgid "Load Defaults"
+msgstr "?????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:498
+msgid "Load the stored default settings for the codec"
+msgstr "?????? ???????? ????????????? ?????????? ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:500
+msgid "Save Defaults"
+msgstr "????? ??? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:504
+msgid "Save the current codec configuration as the stored default settings"
+msgstr "????? ???????? ?????????? ?????? ??? ????????????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:506
+msgid "Reset Defaults"
+msgstr "??????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:510
+msgid "Reload the initial default codec settings"
+msgstr "?????? ?????? ??????? ????????????? ?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:512
+msgid "Target Size:"
+msgstr "??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:524
+msgid "Single Pass - Quality Quantizer (Average)"
+msgstr "????? ?????? - ????????? (??????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:525
+msgid "Single Pass - Quality Quantizer (Constant)"
+msgstr "????? ?????? - ????????? (??????????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:526
+msgid "Single Pass - Bitrate (Average)"
+msgstr "????? ?????? - ??????? (??????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:527
+msgid "Two Pass - File Size"
+msgstr "??? ??????? - ??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:528
+msgid "Two Pass - Average bitrate"
+msgstr "??? ??????? - ???????? ???????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:556
+msgid "Partition decision"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:563
+msgid "Method"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:575
+msgid "1  - Extremely Low (Fastest)"
+msgstr "1 - ??????? (???????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:576
+msgid "2  - Very Low"
+msgstr "2 - ????? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:577
+msgid "3  - Low"
+msgstr "3 - ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:578
+msgid "4  - Medium"
+msgstr "4 - ??????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:579
+msgid "5  - High (Default)"
+msgstr "5 - ?????? (?????????????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:580
+msgid "6  - Very High"
+msgstr "6 - ????? ??????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:581
+msgid "6B - Very High (RDO on Bframes)"
+msgstr "6? - ????? ?????? (RDO ?? ? ?????????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:582
+msgid "7 - Ultra High"
+msgstr "7 - ???????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:583
+msgid "7B - Ultra High (RDO on Bframes)"
+msgstr "7? - ??????? (RDO ?? ? ?????????)"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:590
+msgid "Diamond search"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:591
+msgid "Hexagonal search"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:592
+msgid "Uneven multi hexagon"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:593
+msgid "Exhaustive search"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:605
+msgid ""
+"Set how many previous frames can be referenced by a P/B-frame. Numbers above "
+"5 do not seem to improve quality greatly. Numbers are 3 to 5 are recommended"
+msgstr ""
+"??????? ?????? ?????????? ??????? ???? ???? ???????? ?? ?????? ?/? ?????. "
+"???????????? 5 ??????? ?? ?? ?????????? ?????? ????????. ??????? ?? 3 ?? 5 "
+"?? ????????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:608
+msgid "Max. Ref. frames"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:615
+msgid "Range"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:622
+msgid "Chroma ME"
+msgstr "?????? ???? ME"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:627
+msgid ""
+"Uses chroma (color) components for motion for compression and helps the "
+"quality"
+msgstr ""
+"??????? ?????????? ?? ??????? ??????? ???? ?? ?????????? ? ?????? ?????????."
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:630
+msgid "Mixed Refs"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:635
+msgid "Calculate referencing individually based on each partition"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:643
+msgid ""
+"Define how many pixels are analysised. The higher the range the more "
+"accurate the analysis but the slower the encoding time"
+msgstr ""
+"???????? ?????? ??????? ?? ???????????. ???? ????? ???? ?????????? ? "
+"?????????? ??????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:645
+msgid "<b>Motion Estimation</b>"
+msgstr "<b>?????????? ???????</b>"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:667
+msgid "Sample A/R "
+msgstr "?????? A/R"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:674 avidemux/ADM_dialog/DIA_x264.cpp:685
+msgid ""
+"Enforce the size of a decoded pixel decoded to a certain value. Leave this "
+"at 1:1 for non-anamorphic video"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:675 avidemux/ADM_dialog/DIA_x264.cpp:686
+msgid "1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:692
+msgid "Deblocking Filter :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:695
+msgid "Enable in-loop deblocking to filter the video"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:708
+msgid "Set the amount of blurring to use for block edges when they are found"
+msgstr ""
+"?????? ???? ???????? ???? ?? ???????? ?? ????? ??????? ???? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:717
+msgid "Define the level for when deblocking is applied"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:720
+msgid "<i>Threshold</i>"
+msgstr "<i>??????????</i>"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:728
+msgid "<i>Strength</i>"
+msgstr "<i>??????</i>"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:740
+msgid "CABAC"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:743
+msgid ""
+"Lossless compression method which usually improves the bitrate usage by 15% "
+"(especially on high bitrate). Helps the quality a lot but is slower. "
+msgstr ""
+"?????????? ??? ??????? ???????? ???? ?????? ?????????? ????????? ???????? ?? "
+"15%(??????? ?? ??????? ????????????). ???? ????? ???? ???????? ??? ?? "
+"???????."
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:746
+msgid "Trellis"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:755
+msgid ""
+"Use rate distortion quantization to find optimal encoding for each block. "
+"Level 0 equals disabled, level 1 equals normal and level 2 equals high"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:757
+msgid "Noise Reduction"
+msgstr "??????? ????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:766
+msgid "Set the amount of noise reduction"
+msgstr "??????? ???? ??????? ????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:768
+msgid "<b>Misc. Options</b>"
+msgstr "<b>?????? ??????</b>"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:795
+msgid "8x8 Transform"
+msgstr "8x8 ??????????????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:798
+msgid "General block breakdown transformation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:801
+msgid "8x8, 8x16 and 16x8 P-frame search"
+msgstr "8x8, 8x16 ? 16x8 ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:804
+msgid "Improve the P-frame quality"
+msgstr "???????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:807
+msgid "8x8, 8x16 and 16x8 B-frame search"
+msgstr "8x8, 8x16 ? 16x8 ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:810
+msgid "Improve the B-frame quality"
+msgstr "???????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:813
+msgid "4x4, 4x8 and 8x4 P-frame search"
+msgstr "4x4, 4x8 ? 8x4 ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:816
+msgid "Further improve the P-frame quality"
+msgstr "??? ???????? ??????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:818
+msgid "8x8 Intra search"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:821
+msgid "Enable DCT Intra block search to improve quality"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:824
+msgid "4x4 Intra search"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:827
+msgid "Further enable DCT Intra block search to improve quality"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:830
+msgid "<b>Partition Macroblocks</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:853
+msgid "Bias"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:866
+msgid ""
+"Increase / decrease probability for how often B-frames are used. Will not "
+"violate the maximum consecutive frame limit"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:869
+msgid "Max Consecutive"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:882
+msgid ""
+"Set the maximum number of consecutive B-frames. This defines how many "
+"duplicate frames can be droped. Numbers 2 to 5 are recommended. This greatly "
+"improves the use of bitrate and quality"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:889
+msgid "Bidirectional ME"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:894
+msgid ""
+"Jointly optimize both Motion Vector's in B-frames. This will improve quality "
+"but take more time for encoding"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:896
+msgid "Weighted biprediction"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:901
+msgid "Enables weighting of B-frames to help fades"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:904
+msgid "Adaptative DCT"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:909
+msgid ""
+"Use fewer B-frame if needed. This is always recommended. If not enabled, the "
+"codec will always use the maximum number of consecutive B-frames"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:912
+msgid "Use as reference"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:917
+msgid ""
+"Allow B-frames to make references non-linearly to another B-frame (instead "
+"of creating a duplicate copy)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:923
+msgid "B-Frame Direct Mode:  "
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:931
+msgid "Temporal"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:932
+msgid "Spatial"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:934
+msgid "<b>B-Frames</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:939
+msgid "Partitions & Frames"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:967
+msgid "Set how much \"bitrate bonus\" a keyframe can get"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:970
+msgid "Keyframe boots (%)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:977
+msgid "B-frame reduction (%)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:984
+msgid "Bitrate variability (%)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:997
+msgid ""
+"Set how much bitrate is deducted from a B-frame as compared to the previous "
+"P-frame"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1006
+msgid ""
+"Define how much the bitrate can fluctuate over the entire video. 0% results "
+"in a constant bitrate stream, while 100% results in a pure quality based "
+"bitrate stream"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1009
+msgid "<b>Bitrate</b>"
+msgstr "<b>??????</b>"
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1027
+msgid "Min Qp"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1034
+msgid "Max Qp"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1041
+msgid "Max QP Step"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1055
+msgid "Enforce a minimum quantizer level"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1064
+msgid "Enforce a maximum quantizer level"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1073
+msgid ""
+"Define how much the quantizer rate can change between two consecutive frames"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1076
+msgid "<b>Quantization Limits</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1094
+msgid "Scene Cut Threshold"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1108
+msgid ""
+"Increase / decrease sensitivity for detecting Scene Changes to compensate "
+"for. Improves I-frame usage and helps quality"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1111
+msgid "Min IDR frame interval"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1124
+msgid ""
+"Set minimum frame interval between IDR frames. Defines the minimum amount a "
+"frame can be reused and referenced by other frames before a new clean one is "
+"established"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1133
+msgid ""
+"Set maximum frame interval between IDR frames. Defines the maximum amount a "
+"frame can be reused and referenced by other frames before a new clean one is "
+"established"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1136
+msgid "Max IDR frame interval"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1143
+msgid "<b>More Rate Settings</b>"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_x264.cpp:1148
+msgid "Rate Control"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:137
+msgid "Chroma Noise Reduction 2"
+msgstr "??????? ???? ??????? ???? (CNR2)"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:162
+msgid "<b>Scene change Treshold</b>"
+msgstr "<b>?????????? ?? ??????? ?????</b>"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:181
+msgid "Sensibility"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:189
+msgid "Max"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:204
+msgid "Luma :"
+msgstr "??????????? :"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:211
+msgid "Chroma U :"
+msgstr "?????? ???? U"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:218
+msgid "Chroma V :"
+msgstr "?????? ???? V :"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:261
+msgid "Narrow"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:286
+msgid "<b>Settings</b>"
+msgstr "<b>????????</b>"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:305
+msgid "Use also chroma to detect scene change"
+msgstr "?????? ??????? ?????? ???? ?? ????????? ??????? ?????"
+
+#: avidemux/ADM_dialog/DIA_cnr2.cpp:309
+msgid "<b>Mode</b>"
+msgstr "<b>???</b>"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:94
+msgid "Lavc PP Deint"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:103
+msgid "Deinterlacing : "
+msgstr "?????????? :"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:111
+msgid "AutoLevel :"
+msgstr "?????????? ????"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:137
+msgid "Linear Blend"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:141
+msgid "Linear Interpolation"
+msgstr "???????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:145
+msgid "Cubic interpolation"
+msgstr "????? ?????????????"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:149
+msgid "Median Deinterlacer"
+msgstr "?????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_lavpp_deint.cpp:153
+msgid "FFmpeg Deinterlacer"
+msgstr "FFmpeg ?????????"
+
+#: avidemux/ADM_dialog/DIA_conv.cpp:115
+msgid "Convolution settings"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_conv.cpp:124
+#: avidemux/ADM_dialog/DIA_contrast.cpp:354
+msgid "Luma"
+msgstr "???????????"
+
+#: avidemux/ADM_dialog/DIA_conv.cpp:128 avidemux/ADM_dialog/DIA_dectel.cpp:268
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1018
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1025
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1032
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1039
+msgid "Chroma"
+msgstr "?????? ????"
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:356
+msgid "Mplayer Delogo"
+msgstr "MPlayer ???????? ?????"
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:374
+msgid "X"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:381
+msgid "Y"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:388
+msgid "W"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:395
+msgid "H"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mpdelogo.cpp:402
+msgid "Band"
+msgstr ""
+
+#. TRANSLATORS: Replace this string with your names, one name per line.
+#: avidemux/ADM_dialog/DIA_about.cpp:56
+msgid "translator-credits"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_about.cpp:71 avidemux/ADM_gui2/GUI_main2.cpp:260
+msgid "Avidemux"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_about.cpp:72
+msgid "? 2001-2006 Mean"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_about.cpp:73
+msgid "Multiplatform video editor"
+msgstr "???????????????? ????? ????????"
+
+#: avidemux/ADM_dialog/DIA_about.cpp:74
+msgid ""
+"Avidemux is free software; you can redistribute it and/or modify it \n"
+"under the terms of the GNU General Public License version 2 \n"
+"as published by the Free Software Foundation.\n"
+"\n"
+"\t\t    GNU GENERAL PUBLIC LICENSE\n"
+"\t\t       Version 2, June 1991\n"
+"\n"
+" Copyright (C) 1989, 1991 Free Software Foundation, Inc.\n"
+"                       51 Franklin St, Fifth Floor, Boston, MA  02110-1301  "
+"USA\n"
+" Everyone is permitted to copy and distribute verbatim copies\n"
+" of this license document, but changing it is not allowed.\n"
+"\n"
+"\t\t\t    Preamble\n"
+"\n"
+"  The licenses for most software are designed to take away your\n"
+"freedom to share and change it.  By contrast, the GNU General Public\n"
+"License is intended to guarantee your freedom to share and change free\n"
+"software--to make sure the software is free for all its users.  This\n"
+"General Public License applies to most of the Free Software\n"
+"Foundation's software and to any other program whose authors commit to\n"
+"using it.  (Some other Free Software Foundation software is covered by\n"
+"the GNU Library General Public License instead.)  You can apply it to\n"
+"your programs, too.\n"
+"\n"
+"  When we speak of free software, we are referring to freedom, not\n"
+"price.  Our General Public Licenses are designed to make sure that you\n"
+"have the freedom to distribute copies of free software (and charge for\n"
+"this service if you wish), that you receive source code or can get it\n"
+"if you want it, that you can change the software or use pieces of it\n"
+"in new free programs; and that you know you can do these things.\n"
+"\n"
+"  To protect your rights, we need to make restrictions that forbid\n"
+"anyone to deny you these rights or to ask you to surrender the rights.\n"
+"These restrictions translate to certain responsibilities for you if you\n"
+"distribute copies of the software, or if you modify it.\n"
+"\n"
+"  For example, if you distribute copies of such a program, whether\n"
+"gratis or for a fee, you must give the recipients all the rights that\n"
+"you have.  You must make sure that they, too, receive or can get the\n"
+"source code.  And you must show them these terms so they know their\n"
+"rights.\n"
+"\n"
+"  We protect your rights with two steps: (1) copyright the software, and\n"
+"(2) offer you this license which gives you legal permission to copy,\n"
+"distribute and/or modify the software.\n"
+"\n"
+"  Also, for each author's protection and ours, we want to make certain\n"
+"that everyone understands that there is no warranty for this free\n"
+"software.  If the software is modified by someone else and passed on, we\n"
+"want its recipients to know that what they have is not the original, so\n"
+"that any problems introduced by others will not reflect on the original\n"
+"authors' reputations.\n"
+"\n"
+"  Finally, any free program is threatened constantly by software\n"
+"patents.  We wish to avoid the danger that redistributors of a free\n"
+"program will individually obtain patent licenses, in effect making the\n"
+"program proprietary.  To prevent this, we have made it clear that any\n"
+"patent must be licensed for everyone's free use or not licensed at all.\n"
+"\n"
+"  The precise terms and conditions for copying, distribution and\n"
+"modification follow.\n"
+"\n"
+"\t\t    GNU GENERAL PUBLIC LICENSE\n"
+"   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n"
+"\n"
+"  0. This License applies to any program or other work which contains\n"
+"a notice placed by the copyright holder saying it may be distributed\n"
+"under the terms of this General Public License.  The \"Program\", below,\n"
+"refers to any such program or work, and a \"work based on the Program\"\n"
+"means either the Program or any derivative work under copyright law:\n"
+"that is to say, a work containing the Program or a portion of it,\n"
+"either verbatim or with modifications and/or translated into another\n"
+"language.  (Hereinafter, translation is included without limitation in\n"
+"the term \"modification\".)  Each licensee is addressed as \"you\".\n"
+"\n"
+"Activities other than copying, distribution and modification are not\n"
+"covered by this License; they are outside its scope.  The act of\n"
+"running the Program is not restricted, and the output from the Program\n"
+"is covered only if its contents constitute a work based on the\n"
+"Program (independent of having been made by running the Program).\n"
+"Whether that is true depends on what the Program does.\n"
+"\n"
+"  1. You may copy and distribute verbatim copies of the Program's\n"
+"source code as you receive it, in any medium, provided that you\n"
+"conspicuously and appropriately publish on each copy an appropriate\n"
+"copyright notice and disclaimer of warranty; keep intact all the\n"
+"notices that refer to this License and to the absence of any warranty;\n"
+"and give any other recipients of the Program a copy of this License\n"
+"along with the Program.\n"
+"\n"
+"You may charge a fee for the physical act of transferring a copy, and\n"
+"you may at your option offer warranty protection in exchange for a fee.\n"
+"\n"
+"  2. You may modify your copy or copies of the Program or any portion\n"
+"of it, thus forming a work based on the Program, and copy and\n"
+"distribute such modifications or work under the terms of Section 1\n"
+"above, provided that you also meet all of these conditions:\n"
+"\n"
+"    a) You must cause the modified files to carry prominent notices\n"
+"    stating that you changed the files and the date of any change.\n"
+"\n"
+"    b) You must cause any work that you distribute or publish, that in\n"
+"    whole or in part contains or is derived from the Program or any\n"
+"    part thereof, to be licensed as a whole at no charge to all third\n"
+"    parties under the terms of this License.\n"
+"\n"
+"    c) If the modified program normally reads commands interactively\n"
+"    when run, you must cause it, when started running for such\n"
+"    interactive use in the most ordinary way, to print or display an\n"
+"    announcement including an appropriate copyright notice and a\n"
+"    notice that there is no warranty (or else, saying that you provide\n"
+"    a warranty) and that users may redistribute the program under\n"
+"    these conditions, and telling the user how to view a copy of this\n"
+"    License.  (Exception: if the Program itself is interactive but\n"
+"    does not normally print such an announcement, your work based on\n"
+"    the Program is not required to print an announcement.)\n"
+"\n"
+"These requirements apply to the modified work as a whole.  If\n"
+"identifiable sections of that work are not derived from the Program,\n"
+"and can be reasonably considered independent and separate works in\n"
+"themselves, then this License, and its terms, do not apply to those\n"
+"sections when you distribute them as separate works.  But when you\n"
+"distribute the same sections as part of a whole which is a work based\n"
+"on the Program, the distribution of the whole must be on the terms of\n"
+"this License, whose permissions for other licensees extend to the\n"
+"entire whole, and thus to each and every part regardless of who wrote it.\n"
+"\n"
+"Thus, it is not the intent of this section to claim rights or contest\n"
+"your rights to work written entirely by you; rather, the intent is to\n"
+"exercise the right to control the distribution of derivative or\n"
+"collective works based on the Program.\n"
+"\n"
+"In addition, mere aggregation of another work not based on the Program\n"
+"with the Program (or with a work based on the Program) on a volume of\n"
+"a storage or distribution medium does not bring the other work under\n"
+"the scope of this License.\n"
+"\n"
+"  3. You may copy and distribute the Program (or a work based on it,\n"
+"under Section 2) in object code or executable form under the terms of\n"
+"Sections 1 and 2 above provided that you also do one of the following:\n"
+"\n"
+"    a) Accompany it with the complete corresponding machine-readable\n"
+"    source code, which must be distributed under the terms of Sections\n"
+"    1 and 2 above on a medium customarily used for software interchange; "
+"or,\n"
+"\n"
+"    b) Accompany it with a written offer, valid for at least three\n"
+"    years, to give any third party, for a charge no more than your\n"
+"    cost of physically performing source distribution, a complete\n"
+"    machine-readable copy of the corresponding source code, to be\n"
+"    distributed under the terms of Sections 1 and 2 above on a medium\n"
+"    customarily used for software interchange; or,\n"
+"\n"
+"    c) Accompany it with the information you received as to the offer\n"
+"    to distribute corresponding source code.  (This alternative is\n"
+"    allowed only for noncommercial distribution and only if you\n"
+"    received the program in object code or executable form with such\n"
+"    an offer, in accord with Subsection b above.)\n"
+"\n"
+"The source code for a work means the preferred form of the work for\n"
+"making modifications to it.  For an executable work, complete source\n"
+"code means all the source code for all modules it contains, plus any\n"
+"associated interface definition files, plus the scripts used to\n"
+"control compilation and installation of the executable.  However, as a\n"
+"special exception, the source code distributed need not include\n"
+"anything that is normally distributed (in either source or binary\n"
+"form) with the major components (compiler, kernel, and so on) of the\n"
+"operating system on which the executable runs, unless that component\n"
+"itself accompanies the executable.\n"
+"\n"
+"If distribution of executable or object code is made by offering\n"
+"access to copy from a designated place, then offering equivalent\n"
+"access to copy the source code from the same place counts as\n"
+"distribution of the source code, even though third parties are not\n"
+"compelled to copy the source along with the object code.\n"
+"\n"
+"  4. You may not copy, modify, sublicense, or distribute the Program\n"
+"except as expressly provided under this License.  Any attempt\n"
+"otherwise to copy, modify, sublicense or distribute the Program is\n"
+"void, and will automatically terminate your rights under this License.\n"
+"However, parties who have received copies, or rights, from you under\n"
+"this License will not have their licenses terminated so long as such\n"
+"parties remain in full compliance.\n"
+"\n"
+"  5. You are not required to accept this License, since you have not\n"
+"signed it.  However, nothing else grants you permission to modify or\n"
+"distribute the Program or its derivative works.  These actions are\n"
+"prohibited by law if you do not accept this License.  Therefore, by\n"
+"modifying or distributing the Program (or any work based on the\n"
+"Program), you indicate your acceptance of this License to do so, and\n"
+"all its terms and conditions for copying, distributing or modifying\n"
+"the Program or works based on it.\n"
+"\n"
+"  6. Each time you redistribute the Program (or any work based on the\n"
+"Program), the recipient automatically receives a license from the\n"
+"original licensor to copy, distribute or modify the Program subject to\n"
+"these terms and conditions.  You may not impose any further\n"
+"restrictions on the recipients' exercise of the rights granted herein.\n"
+"You are not responsible for enforcing compliance by third parties to\n"
+"this License.\n"
+"\n"
+"  7. If, as a consequence of a court judgment or allegation of patent\n"
+"infringement or for any other reason (not limited to patent issues),\n"
+"conditions are imposed on you (whether by court order, agreement or\n"
+"otherwise) that contradict the conditions of this License, they do not\n"
+"excuse you from the conditions of this License.  If you cannot\n"
+"distribute so as to satisfy simultaneously your obligations under this\n"
+"License and any other pertinent obligations, then as a consequence you\n"
+"may not distribute the Program at all.  For example, if a patent\n"
+"license would not permit royalty-free redistribution of the Program by\n"
+"all those who receive copies directly or indirectly through you, then\n"
+"the only way you could satisfy both it and this License would be to\n"
+"refrain entirely from distribution of the Program.\n"
+"\n"
+"If any portion of this section is held invalid or unenforceable under\n"
+"any particular circumstance, the balance of the section is intended to\n"
+"apply and the section as a whole is intended to apply in other\n"
+"circumstances.\n"
+"\n"
+"It is not the purpose of this section to induce you to infringe any\n"
+"patents or other property right claims or to contest validity of any\n"
+"such claims; this section has the sole purpose of protecting the\n"
+"integrity of the free software distribution system, which is\n"
+"implemented by public license practices.  Many people have made\n"
+"generous contributions to the wide range of software distributed\n"
+"through that system in reliance on consistent application of that\n"
+"system; it is up to the author/donor to decide if he or she is willing\n"
+"to distribute software through any other system and a licensee cannot\n"
+"impose that choice.\n"
+"\n"
+"This section is intended to make thoroughly clear what is believed to\n"
+"be a consequence of the rest of this License.\n"
+"\n"
+"  8. If the distribution and/or use of the Program is restricted in\n"
+"certain countries either by patents or by copyrighted interfaces, the\n"
+"original copyright holder who places the Program under this License\n"
+"may add an explicit geographical distribution limitation excluding\n"
+"those countries, so that distribution is permitted only in or among\n"
+"countries not thus excluded.  In such case, this License incorporates\n"
+"the limitation as if written in the body of this License.\n"
+"\n"
+"  9. The Free Software Foundation may publish revised and/or new versions\n"
+"of the General Public License from time to time.  Such new versions will\n"
+"be similar in spirit to the present version, but may differ in detail to\n"
+"address new problems or concerns.\n"
+"\n"
+"Each version is given a distinguishing version number.  If the Program\n"
+"specifies a version number of this License which applies to it and \"any\n"
+"later version\", you have the option of following the terms and conditions\n"
+"either of that version or of any later version published by the Free\n"
+"Software Foundation.  If the Program does not specify a version number of\n"
+"this License, you may choose any version ever published by the Free "
+"Software\n"
+"Foundation.\n"
+"\n"
+"  10. If you wish to incorporate parts of the Program into other free\n"
+"programs whose distribution conditions are different, write to the author\n"
+"to ask for permission.  For software which is copyrighted by the Free\n"
+"Software Foundation, write to the Free Software Foundation; we sometimes\n"
+"make exceptions for this.  Our decision will be guided by the two goals\n"
+"of preserving the free status of all derivatives of our free software and\n"
+"of promoting the sharing and reuse of software generally.\n"
+"\n"
+"\t\t\t    NO WARRANTY\n"
+"\n"
+"  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY\n"
+"FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN\n"
+"OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES\n"
+"PROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY OF ANY KIND, EITHER "
+"EXPRESSED\n"
+"OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\n"
+"MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS\n"
+"TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE\n"
+"PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,\n"
+"REPAIR OR CORRECTION.\n"
+"\n"
+"  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\n"
+"WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR\n"
+"REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,\n"
+"INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING\n"
+"OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED\n"
+"TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY\n"
+"YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER\n"
+"PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE\n"
+"POSSIBILITY OF SUCH DAMAGES.\n"
+"\n"
+"\t\t     END OF TERMS AND CONDITIONS\n"
+"\n"
+"\t    How to Apply These Terms to Your New Programs\n"
+"\n"
+"  If you develop a new program, and you want it to be of the greatest\n"
+"possible use to the public, the best way to achieve this is to make it\n"
+"free software which everyone can redistribute and change under these terms.\n"
+"\n"
+"  To do so, attach the following notices to the program.  It is safest\n"
+"to attach them to the start of each source file to most effectively\n"
+"convey the exclusion of warranty; and each file should have at least\n"
+"the \"copyright\" line and a pointer to where the full notice is found.\n"
+"\n"
+"    <one line to give the program's name and a brief idea of what it does.>\n"
+"    Copyright (C) <year>  <name of author>\n"
+"\n"
+"    This program is free software; you can redistribute it and/or modify\n"
+"    it under the terms of the GNU General Public License as published by\n"
+"    the Free Software Foundation; either version 2 of the License, or\n"
+"    (at your option) any later version.\n"
+"\n"
+"    This program is distributed in the hope that it will be useful,\n"
+"    but WITHOUT ANY WARRANTY; without even the implied warranty of\n"
+"    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n"
+"    GNU General Public License for more details.\n"
+"\n"
+"    You should have received a copy of the GNU General Public License\n"
+"    along with this program; if not, write to the Free Software\n"
+"    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  "
+"USA\n"
+"\n"
+"\n"
+"Also add information on how to contact you by electronic and paper mail.\n"
+"\n"
+"If the program is interactive, make it output a short notice like this\n"
+"when it starts in an interactive mode:\n"
+"\n"
+"    Gnomovision version 69, Copyright (C) year name of author\n"
+"    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show "
+"w'.\n"
+"    This is free software, and you are welcome to redistribute it\n"
+"    under certain conditions; type `show c' for details.\n"
+"\n"
+"The hypothetical commands `show w' and `show c' should show the appropriate\n"
+"parts of the General Public License.  Of course, the commands you use may\n"
+"be called something other than `show w' and `show c'; they could even be\n"
+"mouse-clicks or menu items--whatever suits your program.\n"
+"\n"
+"You should also get your employer (if you work as a programmer) or your\n"
+"school, if any, to sign a \"copyright disclaimer\" for the program, if\n"
+"necessary.  Here is a sample; alter the names:\n"
+"\n"
+"  Yoyodyne, Inc., hereby disclaims all copyright interest in the program\n"
+"  `Gnomovision' (which makes passes at compilers) written by James Hacker.\n"
+"\n"
+"  <signature of Ty Coon>, 1 April 1989\n"
+"  Ty Coon, President of Vice\n"
+"\n"
+"This General Public License does not permit incorporating your program into\n"
+"proprietary programs.  If your program is a subroutine library, you may\n"
+"consider it more useful to permit linking proprietary applications with the\n"
+"library.  If this is what you want to do, use the GNU Library General\n"
+"Public License instead of this License."
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_about.cpp:76
+msgid "http://www.avidemux.org"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:237
+msgid "Xvid Encoder"
+msgstr "Xvid ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:258
+msgid "Constant Bitrate (kbps)"
+msgstr "?????????? ??????? (????/sek)"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:266
+msgid "Dual pass (MBytes)"
+msgstr "??? ??????? (?????????)"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:292
+msgid "Basic"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:301
+msgid "Motion Search"
+msgstr "???????? ?? ????????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:317
+msgid "Max I frame interval "
+msgstr "??????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:333
+msgid "Min I frame interval"
+msgstr "??????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:361
+msgid "1- Very low"
+msgstr "1 - ????? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:365
+msgid "2- Low"
+msgstr "2 - ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:369
+msgid "3- Medium"
+msgstr "3 - ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:373
+msgid "4- High"
+msgstr "4 - ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:377
+msgid "5- Very High"
+msgstr "5 - ????? ??????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:381
+msgid "6- Ultra High"
+msgstr "6 - ???????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:395
+msgid "H263 Quantizer"
+msgstr "H263 ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:400
+msgid "MPEG Quantizer"
+msgstr "MPEG ?????????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:407
+msgid "Advanced"
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:416
+msgid "Min I Frame Qzer"
+msgstr "??????? ????????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:424
+msgid "Max I Frame Qzer"
+msgstr "??????? ????????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:432
+msgid "Min P Frame Qzer"
+msgstr "??????? ????????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:440
+msgid "Max P Frame Qzer"
+msgstr "??????? ????????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:485
+msgid "Not Yet!"
+msgstr "??? ???? ??????????!"
+
+#: avidemux/ADM_dialog/DIA_xvid.cpp:490
+msgid "B Frames"
+msgstr "? ???????"
+
+#: avidemux/ADM_dialog/DIA_mosaic.cpp:79
+msgid "Mosaic"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_mosaic.cpp:89
+msgid "Horizontal stacking :"
+msgstr "H???????????? ???? :"
+
+#: avidemux/ADM_dialog/DIA_mosaic.cpp:96
+msgid "Vertical stacking : "
+msgstr "?????????? ???? :"
+
+#: avidemux/ADM_dialog/DIA_mosaic.cpp:103
+msgid "Shrink factor :"
+msgstr "?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_mosaic.cpp:110
+msgid "Show frame # :"
+msgstr "??????? ????? # :"
+
+#: avidemux/ADM_dialog/DIA_msharpen.cpp:120
+msgid "Donal Graft MSharpen"
+msgstr "MSharpen ??????????? ??????? Donal Graft"
+
+#: avidemux/ADM_dialog/DIA_msharpen.cpp:129
+msgid "Show Mask"
+msgstr "??????? ?????"
+
+#: avidemux/ADM_dialog/DIA_msharpen.cpp:135
+msgid "HighQ"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_msharpen.cpp:149
+msgid "Strength"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_asharp.cpp:293
+msgid "ASharp by MarcFD"
+msgstr "ASharp ??????????? ??????? MarcFD"
+
+#: avidemux/ADM_dialog/DIA_asharp.cpp:314
+msgid "Strength :"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_asharp.cpp:322
+msgid "Block Adaptative :"
+msgstr "??????????? ?? ????? :"
+
+#: avidemux/ADM_dialog/DIA_asharp.cpp:330
+msgid "Unknown flag :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_requant.cpp:85
+msgid "Requantize Option"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_requant.cpp:95
+msgid "Shrink factor"
+msgstr "?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:87
+msgid "Dynamic Noise Reduction"
+msgstr "????????? ???????? ????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:96
+msgid "Luma Lock"
+msgstr "???????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:104
+msgid "Luma Threshold"
+msgstr "?????????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:112
+msgid "Chroma Lock"
+msgstr "???????? ?????? ????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:120
+msgid "Chroma Threshold"
+msgstr "?????????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_dnr.cpp:128
+msgid "Scene change detect"
+msgstr "????????? ??????? ?????"
+
+#: avidemux/ADM_dialog/DIA_audioTrack.cpp:133
+msgid "Audio selector"
+msgstr "?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_audioTrack.cpp:142
+msgid "Select audio track"
+msgstr "??????? ?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:403
+msgid "Bitrate Calculator"
+msgstr "??????? ?????????? "
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:431
+msgid "Duration:"
+msgstr "???????:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:451
+msgid "_Medium:"
+msgstr "??????:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:462
+msgid "_Format:"
+msgstr "??????:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:473
+#: avidemux/ADM_dialog/DIA_calculator.cpp:531
+msgid "Total size (custom)"
+msgstr "?????? ???????? (?????????)"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:483
+msgid "_Custom size (MB):"
+msgstr "???????? ???????? (MB):"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:497
+msgid "Output container format"
+msgstr "??????? ??????"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:501
+#: avidemux/ADM_gui2/GUI_main2.cpp:1121
+msgid "AVI"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:505
+#: avidemux/ADM_gui2/GUI_main2.cpp:1124
+msgid "OGM"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:509
+msgid "MPEG"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:524
+msgid "Total size"
+msgstr "?????? ????????"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:528
+msgid "1x 80 min. CD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:533
+msgid "2x 80 min. CD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:537
+msgid "1x 74 min. CD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:541
+msgid "2x 74 min. CD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:545
+msgid "DVD5"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:549
+#: avidemux/ADM_gui2/GUI_main2.cpp:893
+msgid "Custom"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:555
+msgid "<b>Target</b>"
+msgstr "<b>????</b>"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:575
+msgid "Track _1:"
+msgstr "????? _1:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:583
+msgid "Audio bitrate in kb/s for track 1 (0 for no audio)"
+msgstr "??????? ????? (????/???) ?? ????? 1 (0 ?? ??? ?????)"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:591
+msgid "Track _2: "
+msgstr "????? _2:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:599
+msgid "Audio bitrate in kb/s for track 2 (optional)"
+msgstr "??????? ????? (????/???) ?? ????? 2 (???????)"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:603
+msgid "<b>Audio Bitrate</b>"
+msgstr "<b>??????? ?????</b>"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:625
+msgid "Audio size (MB):"
+msgstr "???????? ????? (MB):"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:641
+msgid "Video size (MB):"
+msgstr "???????? ????? (MB)"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:657
+msgid "Total size (MB):"
+msgstr "?????? ???????? (MB):"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:679
+msgid "Video bitrate:"
+msgstr "????? ???????:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:687
+msgid "Bits per pixel:"
+msgstr "???? ?? ???????:"
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:703
+msgid "0.0"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_calculator.cpp:711
+msgid "<b>Result</b>"
+msgstr "<b>????????</b>"
+
+#: avidemux/ADM_dialog/DIA_quota.cpp:90
+msgid "Filesystem full / quota exceeded"
+msgstr "?????? ???????? ??????"
+
+#: avidemux/ADM_dialog/DIA_quota.cpp:133
+msgid "Ignore"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_quota.cpp:155
+msgid "Retry"
+msgstr "?????? ??????"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:93
+msgid "Resize for VCD/SVCD/...."
+msgstr "??????? ???????? ?? VCD/SVCD/...."
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:103
+msgid "Target type : "
+msgstr "??????? ???:"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:110
+msgid "Source Aspect Ratio :"
+msgstr "??????? ?????:"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:127
+msgid "Destination Aspect Ratio :"
+msgstr "??????? ??????:"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:150
+msgid "VCD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:151
+msgid "SVCD"
+msgstr "SVCD"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:152
+msgid "DVD"
+msgstr "DVD"
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:153
+msgid "DVD, half D1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_resizeWiz.cpp:154
+#: avidemux/ADM_gui2/GUI_main2.cpp:751
+msgid "PSP"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_pipe.cpp:95
+msgid "Pipe to"
+msgstr "???????? ?"
+
+#: avidemux/ADM_dialog/DIA_pipe.cpp:104
+msgid "Application path/name (/usr/bin/sox...)"
+msgstr "??????/??? ?? ???????? (/usr/bin/sox...)"
+
+#: avidemux/ADM_dialog/DIA_pipe.cpp:113
+msgid "Full parameter line"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:25
+msgid "Ready"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:25
+msgid "Succeeded"
+msgstr "???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:25 avidemux/gtk_gui.cpp:2485
+msgid "Failed"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:25
+msgid "Deleted"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:25
+msgid "Running"
+msgstr "? ????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:98
+msgid "  Job Name  "
+msgstr " ??? ??????? "
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:103
+msgid "Started at"
+msgstr "???????? ?"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:107
+msgid "Finished at"
+msgstr "???????? ?"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:134 avidemux/ADM_dialog/DIA_jobs.cpp:172
+msgid "Sure!"
+msgstr "??"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:134
+msgid "Delete ALL jobs"
+msgstr "?????? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:134
+msgid "Are you sure you want to delete all jobs ?"
+msgstr "?? ?? ??? ??????? ?? ?????? ?? ???????? ??? ????????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:172
+msgid "Delete job"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:172
+#, c-format
+msgid "Are you sure you want to delete %s job ?"
+msgstr "?? ?? ??? ?????? ?? ?????? ?? ???????? ??????? %s ?"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:181
+msgid "Unknown event"
+msgstr "???????? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:261
+msgid "Jobs"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:287
+msgid "Delete All Jobs"
+msgstr "?????? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:292
+msgid "Delete Job"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:297
+msgid "Run all jobs"
+msgstr "??????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_jobs.cpp:302
+msgid "Run Job"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:142
+msgid "Decomb Telecide"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:177
+msgid "Try backward field"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:192
+msgid "Never"
+msgstr "??????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:196
+msgid "When forward is still combed"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:200
+msgid "Always try"
+msgstr "???? ???????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:214
+msgid "No strategy"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:218
+msgid "Telecine 3:2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:222
+msgid "Pal/Secam"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:226
+msgid "NTSC converted from Pal"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:232
+msgid "Decomb strategy"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:239
+msgid "Postprocessing"
+msgstr "???????? ???????????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:254
+msgid "No postprocessing"
+msgstr "??? ????????? ???????????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:258
+msgid "No postproc, but compute"
+msgstr "??? ????????? ???????????, ??? ??????????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:262
+msgid "Postproc on best match"
+msgstr "???????? ??????????? ?? ???????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:283
+msgid "Ignore chroma to decide"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:287
+msgid "Use chroma to decide"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:293
+msgid "Blend or interpolate"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:308
+msgid "Interpolate"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:312
+msgid "Blend"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:318
+msgid "Backward thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:331
+msgid "Direct thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:344
+msgid "Postproc thresh"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:357
+msgid "Noise Threshold"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_dectel.cpp:370
+msgid "Show"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:162
+msgid "Vorbis encoder settings"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:172
+msgid "<b>Mode :</b>"
+msgstr "<b>???:</b>"
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:180
+#: avidemux/ADM_dialog/DIA_defaultAudio.cpp:109
+msgid "<b>Bitrate :</b>"
+msgstr "<b>??????? :</b>"
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:188
+msgid "<b>Quality :</b>"
+msgstr "<b>???????? :</b>"
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:202
+msgid "CBR (bitrate based)"
+msgstr "CBR (?????????? ???????)"
+
+#: avidemux/ADM_dialog/DIA_vorbis.cpp:208
+msgid "VBR (Quality based)"
+msgstr "VBR (?????????? ???????)"
+
+#: avidemux/ADM_dialog/DIA_lavdecoder.cpp:79
+msgid "Libavcodec Decoder Option"
+msgstr "?????? libavcodec"
+
+#: avidemux/ADM_dialog/DIA_lavdecoder.cpp:88
+msgid "Swap UV"
+msgstr "?????? UV"
+
+#: avidemux/ADM_dialog/DIA_lavdecoder.cpp:92
+msgid "Show motion Vectors"
+msgstr "??????? ??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_postproc.cpp:90
+msgid "Mplayer PostProc options"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_postproc.cpp:99
+msgid "Horizontal Deblocking"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_postproc.cpp:103
+msgid "Vertical Deblocking"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_postproc.cpp:107
+msgid "Deringing"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_postproc.cpp:136
+msgid "Filter Strength"
+msgstr "?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:49
+msgid "Select video to write"
+msgstr "??????? ????? ?? ????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:63
+msgid "Invalid filename"
+msgstr "???????? ??? ????????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:63
+msgid "Please select or enter a valid filename"
+msgstr "????????? ??? ??????? ???????? ??? ????????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:69
+msgid "Invalid jobname"
+msgstr "???????? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:69
+msgid "Please select or enter a valid jobname"
+msgstr "????????? ??? ??????? ???????? ??? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:111
+msgid "Save Job"
+msgstr "??????? ???????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:130
+msgid "Select the output file"
+msgstr "??????? ??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:144
+msgid "_Browse..."
+msgstr "_???????..."
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:153
+msgid "Job name displayed in the job list and used as the script filename"
+msgstr "??? ??????? ????????? ? ????? ???????? ? ????????? ??? ??? ???????."
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:162
+msgid "Filename of the audio/video output"
+msgstr "??? ???????? ?? ????/????? ??????"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:165
+msgid "_Job name:"
+msgstr "_??? ???????:"
+
+#: avidemux/ADM_dialog/DIA_jobs_save.cpp:172
+msgid "Output _file:"
+msgstr "??????? _????????:"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:116
+msgid "Decomb Decimate"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:125
+msgid "Cycle"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:157
+msgid "Discard Closer"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:161
+msgid "Replace by interpolate"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:165
+msgid "Discard from longest dups (anim?s)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:169
+msgid "Pulldown dups removal"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:175
+msgid "Threshold "
+msgstr "??????????"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:189
+msgid "Threshold2 "
+msgstr "??????????2"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:203
+msgid "Quality "
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:219
+msgid "Fastest (no chroma,partial luma)"
+msgstr "??????? (??? ??????? ????, ????????? ?????????)"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:223
+msgid "Fast (partial luma and chroma)"
+msgstr "???? (????????? ????????? ? ????? ????)"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:227
+msgid "Medium (full luma not chroma)"
+msgstr "?????? (???? ?????????, ??? ??????? ????)"
+
+#: avidemux/ADM_dialog/DIA_decimate.cpp:231
+msgid "Slow (full luma and chroma)"
+msgstr "????? (???? ????????? ? ?????? ????)"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:147
+msgid "Lame Encoder Settings"
+msgstr "???????? Lame enkodera"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:171
+msgid "Joint-Stereo"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:185
+msgid "<b>Channel Mode:</b>"
+msgstr "<b>??? ??????:</b>"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:193
+msgid "<b>Bitrate:</b>"
+msgstr "<b>???????:</b>"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:201
+msgid "<b>Mode:</b>"
+msgstr "<b>???:</b>"
+
+#: avidemux/ADM_dialog/DIA_lame.cpp:209
+msgid "<b>Quality:</b>"
+msgstr "<b>????????:</b>"
+
+#: avidemux/ADM_dialog/DIA_acodec.cpp:138
+msgid "AudioCodec"
+msgstr "?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_acodec.cpp:163
+msgid "Configure codec"
+msgstr "?????????? ??????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:409
+msgid "Preferences"
+msgstr "????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:433
+msgid "_Message level:"
+msgstr "???? _???????????:"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:440
+msgid "No alerts"
+msgstr "??? ?????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:441
+msgid "Display only error alerts"
+msgstr "??????? ???? ????????? ??? ????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:442
+msgid "Display all alerts"
+msgstr "??????? ??? ?????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:444
+msgid "_Swap marks A and B if A > B"
+msgstr "_?????? ?????? A ? B ??? ?? A > B"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:448
+msgid "_Go to systray when encoding"
+msgstr "_?????? ? ????????? ?????? ???????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:452
+msgid "S_ave preferences on exit"
+msgstr "_??????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:456
+msgid "User Interface"
+msgstr "?????????? ????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:467
+msgid "_Automatically index MPEG files"
+msgstr "_?????????? ?????????? MPEG ????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:471
+msgid "_Disable NuppelVideo resync"
+msgstr "_??????? NuppelVideo ???????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:475
+msgid "_Use libavcodec MPEG decoder"
+msgstr "_??????? libavcodec MPEG ???????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:479
+msgid "_Set Default Postprocessing Level"
+msgstr "_??????? ????????????? ???? ????????? ???????????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:483
+msgid "Input"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:498
+msgid "_MPEG auto split (MB):"
+msgstr "????????? MPEG _?????? (MB):"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:507
+msgid "_Use OpenDML (don't split large AVI files)"
+msgstr "_??????? OpenDML (?? ???? ?????? AVI ????????)"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:511
+msgid "_Reuse 2-pass log"
+msgstr "_?????? ???????? ??????? ?????? ???????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:515
+msgid "Allow non standard audio frequency for DVD output"
+msgstr "??????? ???????????? ??????????? ????? ?? DVD ?????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:519 avidemux/ADM_gui2/GUI_main2.cpp:970
+msgid "Output"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:533
+msgid "_Audio output:"
+msgstr "??????? _????:"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:540
+msgid "ALSA _device:"
+msgstr "ALSA ??????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:562
+msgid "_Master"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:570
+msgid "_PCM"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:578
+msgid "_Volume bar controls:"
+msgstr "??????? ?? ???????? _?????? ?????:"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:585
+msgid "Local Playback Downmixing"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:597
+msgid "No downmixing (multichannel)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:603
+msgid "Audio"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:620
+msgid "_Video output:"
+msgstr "??????? _?????:"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:624 avidemux/ADM_dialog/DIA_prefs.cpp:634
+msgid "Video"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:642
+msgid "Enable multithreading : "
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:652 avidemux/ADM_dialog/DIA_prefs.cpp:663
+msgid "MultiThread"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_prefs.cpp:659
+msgid "Threads"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:527
+msgid "FFmpeg encoding options"
+msgstr "?????????? FFmpeg ????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:611
+msgid "Set quantizer for a constant quantizer/quality encoding"
+msgstr "??????? ????????? ?? ?????????? ?????????/???????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:637
+msgid "Enable interlaced encoding"
+msgstr "?????? ???????????? ??????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:648
+msgid "_Aspect ratio"
+msgstr "_???????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:651
+msgid ""
+"Set MPEG-4 aspect ratio (warning: MPlayer supports it, but most other "
+"players don't)"
+msgstr ""
+"??????? MPEG-4 ??????? (?????????: MPlayer ?? ????????, ??? ????????????? "
+"??????? ??)"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:686
+msgid "ME method:"
+msgstr "ME ??????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:694
+msgid "Max I-frame interval:"
+msgstr "??????? ???????? ? ?????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:711
+msgid "Allow 4 motion vectors per macroblock (slightly better quality)"
+msgstr "??????? 4 ??????? ??????? ?? ?????????? (????? ???? ????????)"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:714
+msgid "MV0"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:717
+msgid "Try  to encode each MB with MV=<0,0> and choose the better one"
+msgstr "??????? ?????????? ?????? MB ?? MV=<0,0> ? ??????? ????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:725
+msgid ""
+"Motion estimation method, 0-3 currently ignores the amount of bits spent, so "
+"quality may be low"
+msgstr ""
+"????? ??????? ???????, 0-3 ??? ???? ???????? ???????? ?????????? ??????, ?? "
+"???????? ???? ???? ?????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:729
+msgid "0: None"
+msgstr "0: ???"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:733
+msgid "1: Full"
+msgstr "1: ????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:737
+msgid "2: Log"
+msgstr "2: ???????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:741
+msgid "3: Phods"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:745
+msgid "4: EPZS"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:749
+msgid "5: X1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:761
+msgid "Maximum interval between keyframes in frames"
+msgstr "??????? ???????? ?????? ??????? ??????? ? ?????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:782
+msgid "Maximum number of B-frames between non B-frames, 0-2 is a sane range"
+msgstr "??????? ???? ? ??????? ?????? ??-? ???????, 0-2 ?? ??????? ????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:787
+msgid "Use quarter pixel motion compensation (useful at higher bitrates)"
+msgstr ""
+"??????? ???????????? ??????? ? ?????? ??????? (??????? ?? ???? ??????????)"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:814
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1062
+msgid "Prepass:"
+msgstr "???? ??????:"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:827
+msgid ""
+"Comparison function for motion estimation pre pass. Tip: SAD is fast, SATD "
+"is good"
+msgstr ""
+"???????? ???????? ?? ??????? ??????? ???? ???????. SAD ?? ????, SADT ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:831
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:882
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:933
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:984
+msgid "0: SAD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:835
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:886
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:937
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:988
+msgid "1: SSE"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:839
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:890
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:941
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:992
+msgid "2: SATD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:843
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:894
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:945
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:996
+msgid "3: DCT"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:847
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:898
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:949
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1000
+msgid "4: PSNR"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:851
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:902
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:953
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1004
+msgid "5: BIT"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:855
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:906
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:957
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1008
+msgid "6: RD"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:859
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:910
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:961
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1012
+msgid "7: ZERO"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:865
+msgid "Full pixel:"
+msgstr "??? ??????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:878
+msgid "Comparison function for full pel motion estimation"
+msgstr "???????? ???????? ?? ??????? ??????? ????? ?????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:916
+msgid "Subpixel:"
+msgstr "??? ??????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:929
+msgid "Comparison function for sub pel motion estimation"
+msgstr "???????? ???????? ?? ??????? ??????? ??? ?????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:967
+msgid "Macroblock:"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:980
+msgid ""
+"Comparison  function for the macroblock decision, used only when macroblock "
+"decision is set to 0"
+msgstr ""
+"???????? ???????? ?? ?? ?????? ? ??????????, ??????? ?? ???? ???? ?? ??????? "
+"?????????? ?????????? ?? 0"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1023
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1030
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1037
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1044
+msgid "Use chroma, too, currently doesn't work (correctly) with B-frames"
+msgstr ""
+"??????? ?????? ????, ??????, ???????? ?? ???? (????????) ?? ? ?????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1046
+msgid "ME comparison function"
+msgstr "ME ???????? ????????"
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1070
+msgid "ME:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1083
+msgid "Diamond type and size for motion estimation pre pass"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1087
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1118
+msgid "adaptive, size 3"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1091
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1122
+msgid "adaptive, size 2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1095
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1126
+msgid "experimental"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1099
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1130
+msgid "normal, size 1"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1103
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1134
+msgid "normal, size 2"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1114
+msgid "Diamond type and size for motion estimation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1140
+msgid "Diamond type and size"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1145
+msgid "Motion Estimation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1171
+msgid "Macroblock decision:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1179
+msgid "Quantizer range - Min:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1192
+msgid ""
+"Macroblock decision algorithm (high quality mode), encode each macroblock in "
+"all modes and choose the best"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1196
+msgid "0: MB comparison"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1200
+msgid "1: Fewest bits (vhq)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1204
+msgid "2: Rate distortion"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1226
+msgid "MPEG quantizers produce sharper picture (useful at higher bitrates)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1240
+msgid ""
+"Minimum quantizer, 1 is not recommended, should be 2 for normal MPEG-4 "
+"encoding"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1252
+msgid "Maximum quantizer, 10-31 should be a sane range"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1257
+msgid ""
+"Trellis searched quantization will find the optimal encoding for each 8x8 "
+"block"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1260
+msgid "Rate distorted CBP"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1263
+msgid "Rate distorted optimal coded block pattern"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1290
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1298
+msgid ""
+"Sane range: 0-0.3. Large values might look good on some monitors, but "
+"horrible on others (TV, LCD...)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1306
+msgid ""
+"Sane range: 0-0.5. Large values help against blockiness, but may introduce "
+"ringing/mosquito noise artifacts on sharp edges"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1315
+msgid "Darkness masking:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1322
+msgid "Spatial complexity masking:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1329
+msgid "Temporal complexity masking:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1335
+msgid "Lumi masking:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1349
+msgid "P block masking:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1355
+msgid "Normalize adaptive quantization"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1358
+msgid ""
+"Attempt  to adjust the per-MB quantizers to maintain the proper average when "
+"using adaptive quantization (*masking)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1386
+msgid "Luminance:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1393
+msgid "Chrominance:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1400
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1408
+msgid "DC"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1405
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1413
+msgid "Consider also the dc coefficient"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1415
+msgid "Single coefficient elimination threshold"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1420
+msgid "Masking"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1434
+msgid "Filesize tolerance (kb):"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1442
+msgid "Quantizer compression:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1450
+msgid "Quantizer blur:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1458
+msgid "Max quantizer difference:"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1472
+msgid "Maximum  quantizer difference between I or P frames"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1480
+msgid ""
+"Quantizer  gaussian blur, larger values will average the quantizer more over "
+"time (slower change)"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1494
+msgid "Filesize tolerance (1 kb = 1000 bits). 1000-100000 is a sane range"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1495
+msgid "8000"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_lavcodec.cpp:1497
+msgid "Ratecontrol"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:79
+msgid "MC Deint"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:89
+msgid "Mode :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:96
+msgid "Field Dominance :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:103
+msgid "Qp :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:115
+msgid "0- Fast"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:116
+msgid "1- Medium"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:117
+msgid "2- Slow, iterative motion estimation"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:118
+msgid "3- Extra slow, same as [2] + multiple reference frame"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:125
+msgid "Top"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_mcdeint.cpp:126
+msgid "Bottom"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_defaultAudio.cpp:99
+msgid "Audio Encoder Settings"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_partial.cpp:123
+#: avidemux/ADM_filter/gui_filtersub.cpp:144
+msgid "Partial"
+msgstr "?????????"
+
+#: avidemux/ADM_dialog/DIA_partial.cpp:137
+msgid "Start frame for partial :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_partial.cpp:144
+msgid "End frame for partial :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_partial.cpp:167
+msgid "Configure partialized filter"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:124
+msgid "Fade Filter"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:134
+msgid "Fade Type"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:146
+#, fuzzy
+msgid "Out"
+msgstr "?????"
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:147
+msgid "In"
+msgstr "????"
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:149
+msgid "Start Frame"
+msgstr "??????? ?????"
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:156
+msgid "End Frame"
+msgstr "?????? ?????"
+
+#: avidemux/ADM_dialog/DIA_fade.cpp:179
+msgid "Fade to black "
+msgstr "??????? ?? ?????"
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:138
+msgid "ASS/SSA Subtitle"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:148
+msgid "Subtitle file (ass/ssa) :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:155
+msgid "Font scale :"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:162
+msgid "Line spacing"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:169
+msgid "Top margin"
+msgstr ""
+
+#: avidemux/ADM_dialog/DIA_ass.cpp:176
+msgid "Bottom margin"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_bindings.cpp:562
+#, c-format
+msgid "Frame:%c(%02d)"
+msgstr "?????:%c(%02d)"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:277 avidemux/main.cpp:151
+msgid "_File"
+msgstr "_????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:284
+msgid "_Open..."
+msgstr "_??????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:295
+msgid "_Append..."
+msgstr "_?????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:306
+msgid "_Save"
+msgstr "_???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:317
+msgid "Save _Video..."
+msgstr "??????? _?????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:329
+msgid "Save _BMP Image..."
+msgstr "??????? BMP ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:333
+msgid "Save _JPEG Image..."
+msgstr "??????? JPEG ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:337
+msgid "Save _Selection as JPEG images..."
+msgstr "??????? ????????? ??? JPEG ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:346
+msgid "Save _Project"
+msgstr "??????? _????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:354
+msgid "Save P_roject As..."
+msgstr "??????? ???????? _???..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:362
+msgid "_Load/Run Project..."
+msgstr "_??????/??????? ????????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:370
+msgid "A_dd to Joblist..."
+msgstr "????_? ? ????? ???????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:374
+msgid "Show _Joblist"
+msgstr "??????? _????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:386
+msgid "Proper_ties"
+msgstr "O??_????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:397
+msgid "AVI _Muxer Options"
+msgstr "AVI _Muxer Options"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:406
+msgid "_Quit"
+msgstr "_?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:417
+msgid "_Edit"
+msgstr "_?????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:424
+msgid "_Reset Edits"
+msgstr "??????? ???_??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:437
+msgid "Cu_t"
+msgstr "_?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:448
+msgid "_Copy"
+msgstr "_??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:459
+msgid "_Paste"
+msgstr "?_????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:470
+msgid "_Delete"
+msgstr "_??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:486
+msgid "Set Marker _A"
+msgstr "??????? ?????? _?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:493
+msgid "Set Marker _B"
+msgstr "??????? ?????? _?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:505
+msgid "Pre_ferences"
+msgstr "_????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:513
+msgid "_View"
+msgstr "?_??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:520
+msgid "_Main Toolbar"
+msgstr "_?????? ????? ?? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:525
+msgid "_A/V Sidebar"
+msgstr "?/? _?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:535
+msgid "_Zoom 1:4"
+msgstr "??????? 1:_4"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:542
+msgid "Z_oom 1:2"
+msgstr "??????? 1:_2"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:549
+msgid "Zoom _1:1"
+msgstr "??????? 1:_1"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:556
+msgid "Zoom _2:1"
+msgstr "??????? 2:1"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:563
+msgid "Zoom _4:1"
+msgstr "??????? 4:1"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:570
+msgid "Vi_deo"
+msgstr "_?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:577
+msgid "_Decoder Options"
+msgstr "_?????? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:584
+msgid "_Postprocessing"
+msgstr "_???????? ???????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:587
+msgid "Select postprocessing level"
+msgstr "??????? ???? ????????? ???????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:597
+msgid "P_review"
+msgstr "?_??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:604
+msgid "Display _Output"
+msgstr "??????? _?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:616
+msgid "_Frame Rate"
+msgstr "_?????????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:620 avidemux/ADM_gui2/GUI_main2.cpp:669
+msgid "_Encoder"
+msgstr "_???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:627
+msgid "Fil_ters"
+msgstr "_???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:634
+msgid "_Audio"
+msgstr "_?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:641
+msgid "_Main Track"
+msgstr "_?????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:645
+msgid "_Second Track"
+msgstr "_???????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:649
+msgid "_Build VBR Time Map"
+msgstr "??????? VBR _???? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:658
+msgid "S_ave..."
+msgstr "_???????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:676
+msgid "_Filters"
+msgstr "_???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:680
+msgid "_Tools"
+msgstr "???_??"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:687
+msgid "_Calculator"
+msgstr "_??????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:703
+msgid "_Rebuild Frames (I & B)"
+msgstr "_??-??????? ??????? (? ? ?)"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:707
+msgid "C_heck Frames (slow)"
+msgstr "_??????? ??????? (?????)"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:711
+msgid "_Bitrate Histogram"
+msgstr "_????????? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:715
+msgid "_Scan for Black Frames..."
+msgstr "???? _???? ???????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:724
+msgid "_VOB -> VobSub"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:728
+msgid "_OCR (VobSub -> srt)"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:732
+msgid "A_uto"
+msgstr "???_?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:739
+msgid "_VCD"
+msgstr "_???"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:743
+msgid "_SVCD"
+msgstr "_????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:747
+msgid "_DVD"
+msgstr "_???"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:755
+msgid "_Go"
+msgstr "??? _??"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:762
+msgid "_Play/Stop"
+msgstr "_?????/????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:773
+msgid "P_revious Frame"
+msgstr "????_????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:784
+msgid "_Next Frame"
+msgstr "????_??? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:795
+msgid "Pr_evious Intra Frame"
+msgstr "????????? _Intra ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:806
+msgid "Next _Intra Frame"
+msgstr "??????? I_ntra ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:817
+msgid "Previou_s Black Frame"
+msgstr "????????? _???? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:821
+msgid "Ne_xt Black Frame"
+msgstr "??????? ?_??? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:825
+msgid "_First Frame"
+msgstr "_???? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:836
+msgid "_Last Frame"
+msgstr "??_?????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:852
+msgid "Go to Marker _A"
+msgstr "??? ?? ?????? _?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:859
+msgid "Go to Marker _B"
+msgstr "??? ?? ?????? _?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:871
+msgid "_Jump to Frame..."
+msgstr "????? ?? _?????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:882
+msgid "Jump to _Time..."
+msgstr "????? ?? _?????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:897
+msgid "_Help"
+msgstr "_?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:904
+msgid "_About"
+msgstr "_? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:912
+msgid "Show builtin support"
+msgstr "_?????? ????????..."
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:926
+msgid "Open a file"
+msgstr "?????? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:936
+msgid "Save the file"
+msgstr "??????? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:942
+msgid "Audio/video file information"
+msgstr "??????????? ? ?????/????? ????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:953
+msgid "Bitrate/size calculator"
+msgstr "?????????? ???????/????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:967
+msgid "Preview filtered video in a new window"
+msgstr "????????? ?????????? ????? ? ????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:976
+msgid "Display filtered output in the main window"
+msgstr "????????? ?????????? ????? ? ??????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1017 avidemux/ADM_gui2/GUI_main2.cpp:1057
+msgid "Copy"
+msgstr "??? ??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1019 avidemux/ADM_gui2/GUI_main2.cpp:1059
+msgid "Configure"
+msgstr "????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1022
+msgid "Configure video encoder"
+msgstr "?????? ????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1027 avidemux/ADM_gui2/GUI_main2.cpp:1083
+msgid "Filters"
+msgstr "???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1030
+msgid "Video filters"
+msgstr "????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1062
+msgid "Configure audio encoder"
+msgstr "?????? ????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1070
+msgid "Audio filters"
+msgstr "????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1091
+msgid "Shift:"
+msgstr "??????:"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1094
+msgid "Enable time shift"
+msgstr "??????? ??????? ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1100
+msgid "Audio/video time shift (ms)"
+msgstr "?????/????? ???????? ??????? (????)"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1107
+msgid "<b>Format</b>"
+msgstr "<b>??????</b>"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1122
+msgid "AVI, unp. VOP"
+msgstr "AVI ??????. VOP"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1123
+msgid "AVI, dual audio"
+msgstr "AVI ??? ??????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1125
+msgid "MPEG video"
+msgstr "MPEG ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1126
+msgid "MPEG PS A+V"
+msgstr "MPEG PS ?+?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1127
+msgid "MPEG TS A+V"
+msgstr "MPEG TS ?+?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1128
+msgid "MP4"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1129
+msgid "PSP (broken)"
+msgstr "PSP (?? ????)"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1149
+msgid "<b>Selection</b>"
+msgstr "<b>?????????</b>"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1166 avidemux/ADM_gui2/GUI_main2.cpp:1174
+msgid " 0000000"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1182
+msgid "A:"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1189
+msgid "Go to marker A"
+msgstr "??? ?? ?????? ?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1191
+msgid "B:"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1198
+msgid "Go to marker B"
+msgstr "??? ?? ?????? ?"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1210
+msgid "Play"
+msgstr "?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1224
+msgid "Stop"
+msgstr "????????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1236
+msgid "Previous frame"
+msgstr "????????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1251
+msgid "Next frame"
+msgstr "??????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1266
+msgid "Previous keyframe"
+msgstr "????????? ?????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1281
+msgid "Next keyframe"
+msgstr "??????? ?????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1295
+msgid "Selection: start"
+msgstr "???????????: ???????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1306
+msgid "Selection: end"
+msgstr "???????????: ????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1317
+msgid "Previous black frame"
+msgstr "????????? ???? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1328
+msgid "Next black frame"
+msgstr "??????? ???? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1339
+msgid "First frame"
+msgstr "???? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1350
+msgid "Last frame"
+msgstr "???????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1381
+msgid "Frame: "
+msgstr "?????: "
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1388
+msgid "Current frame"
+msgstr "???????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1393
+msgid "/0000000"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1400
+msgid "Time: "
+msgstr "?????: "
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1407
+msgid "Current time"
+msgstr "???????? ?????"
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1408
+msgid "00:00:00.000"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1411
+msgid "/00:00:00,000"
+msgstr ""
+
+#: avidemux/ADM_gui2/GUI_main2.cpp:1418
+msgid "Frame: ?"
+msgstr "?????: ?"
+
+#: avidemux/ADM_gui2/support.cpp:251 avidemux/ADM_gui2/support.cpp:275
+#, c-format
+msgid "Couldn't find pixmap file: %s"
+msgstr ""
+
+#: avidemux/oplug_ogm/op_ogsave.cpp:112
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:394
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:178 avidemux/gtk_gui.cpp:989
+#: avidemux/gtk_gui.cpp:1415 avidemux/gtk_gui.cpp:1755
+msgid "File error"
+msgstr ""
+
+#: avidemux/oplug_ogm/op_ogsave.cpp:112
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:394 avidemux/gtk_gui.cpp:1415
+#: avidemux/gtk_gui.cpp:1755
+#, c-format
+msgid "Cannot open \"%s\" for writing."
+msgstr ""
+
+#: avidemux/oplug_ogm/op_ogsave.cpp:126
+msgid "Could not initialize video"
+msgstr ""
+
+#: avidemux/oplug_ogm/op_ogsave.cpp:134
+msgid "Could not initialize audio"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:89
+msgid "This is not MPEG compatible"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:89
+msgid "You can't use the Copy codec."
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:94
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:155
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:166
+msgid "There is no audio track"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:101
+msgid "The first frame is not intra frame"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:101
+msgid "Use the &lt;&lt; and the &gt;&gt; buttons to move using Intra frames."
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:113
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:176
+msgid "Audio track is not suitable"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:153
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:208
+#: avidemux/ADM_lvemux/ADM_muxer.cpp:85
+msgid "Incompatible audio"
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:153
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:186
+msgid "For VCD, audio must be 44.1 kHz MP2."
+msgstr ""
+
+#: avidemux/oplug_mpeg/op_mpegpass.cpp:182
+msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:193
+msgid "Wrong output format"
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:193
+msgid "Select MPEG as the output."
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:198
+msgid "Wrong video codec"
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:199
+msgid "Select DVD as the video codec for MPEG TS output."
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:712
+msgid "Only QCIF and subQCIF are allowed for H.263"
+msgstr ""
+
+#: avidemux/ADM_encoder/adm_encConfig.cpp:891
+msgid "Fatal error"
+msgstr ""
+
+#: avidemux/ADM_mpegdemuxer/dmx_indexer.cpp:160
+msgid "There is several mpeg file, append them ?"
+msgstr ""
+
+#: avidemux/ADM_mpegdemuxer/dmx_indexer.cpp:358
+msgid "Can't determine aspect ratio"
+msgstr ""
+
+#: avidemux/ADM_mpegdemuxer/dmx_video.cpp:312
+msgid "Out of memory"
+msgstr ""
+
+#: avidemux/ADM_mpegdemuxer/dmx_video.cpp:485
+msgid "MPEG renumbering error"
+msgstr ""
+
+#: avidemux/ADM_3gp/ADM_3gp.cpp:488
+msgid "Expect troubles"
+msgstr ""
+
+#: avidemux/ADM_3gp/ADM_3gp.cpp:972
+msgid "Problem reading SVQ3 headers"
+msgstr ""
+
+#: avidemux/ADM_3gp/ADM_3gp.cpp:1524
+msgid "No stts table"
+msgstr ""
+
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:208
+msgid "For DVD, audio must be 48 kHz MP2, AC3 or LPCM."
+msgstr ""
+
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:325
+msgid "Reuse log file ?"
+msgstr ""
+
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:342
+msgid "Error in pass 1"
+msgstr ""
+
+#: avidemux/oplug_mpegFF/oplug_vcdff.cpp:492
+msgid "Error in pass 2"
+msgstr ""
+
+#: avidemux/ADM_openDML/ADM_openDML.cpp:290
+#: avidemux/ADM_openDML/ADM_openDML.cpp:375
+#: avidemux/ADM_openDML/ADM_openDML.cpp:510
+msgid "Malformed header"
+msgstr ""
+
+#: avidemux/ADM_lvemux/ADM_muxer.cpp:85
+msgid "For DVD, audio must be MP2 or AC3."
+msgstr ""
+
+#: avidemux/ADM_lvemux/ADM_muxer.cpp:92
+msgid "lvemux init failed"
+msgstr ""
+
+#: avidemux/ADM_toolkit/toolkit_dialog.cpp:708
+msgid "Alert"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:121
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:316
+msgid "Cannot open directory as a file"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:178 avidemux/gtk_gui.cpp:986
+#, c-format
+msgid "Cannot open \"%s\"."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:188
+msgid "Overwrite file ?"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:213
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:227
+msgid "It could be possible that you try to overwrite an input file!"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:238 avidemux/gtk_gui.cpp:1482
+msgid "Cannot write the file"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:238
+#, c-format
+msgid "No write access to \"%s\"."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:516
+msgid "Images"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:528
+msgid "All"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:576
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:600
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:620
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:627
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:638 avidemux/GUI_jobs.cpp:37
+msgid "Oops"
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:576
+#, c-format
+msgid "can't create custom directory (%s)."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:600
+#, c-format
+msgid "can't create job directory (%s)."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:620
+msgid "can't determine $USERPROFILE."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:627
+msgid "can't determine $HOME."
+msgstr ""
+
+#: avidemux/ADM_toolkit/TLK_filesel.cpp:638
+msgid "Cannot create the .avidemux directory"
+msgstr ""
+
+#: avidemux/ADM_filter/filter_saveload.cpp:156
+msgid "Problem reading XML filters"
+msgstr ""
+
+#: avidemux/ADM_filter/filter_saveload.cpp:164
+msgid "No filter found"
+msgstr ""
+
+#: avidemux/ADM_filter/filter_saveload.cpp:200
+msgid "Could not find a filter"
+msgstr ""
+
+#: avidemux/ADM_filter/filter_saveload.cpp:208
+msgid "No tag found"
+msgstr ""
+
+#: avidemux/ADM_filter/filter_saveload.cpp:288
+msgid "Node not found"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:52
+msgid "Video Filters"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:112
+msgid "VCD res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:118
+msgid "SVCD res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:124
+msgid "DVD res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:130
+msgid "Half D1 res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtersub.cpp:156
+msgid "Save as script"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:64
+msgid "Add Video Filter"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:98
+msgid "Transformation"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:148
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:307
+msgid "Colors"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:198
+msgid "Sharpen/Blur"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:223
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:379
+msgid "Subtitles"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filterlist.cpp:248
+msgid "Miscellaneous"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filter.cpp:327
+#: avidemux/ADM_filter/gui_filtermanager.cpp:241
+msgid "The filter is already partial"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filter.cpp:455
+#: avidemux/ADM_filter/gui_filter.cpp:457
+#: avidemux/ADM_filter/gui_filtermanager.cpp:347
+#: avidemux/ADM_filter/gui_filtermanager.cpp:349
+msgid "Load set of filters"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filter.cpp:464
+#: avidemux/ADM_filter/gui_filtermanager.cpp:362
+msgid "Nothing to save"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filter.cpp:468
+#: avidemux/ADM_filter/gui_filter.cpp:470
+#: avidemux/ADM_filter/gui_filtermanager.cpp:366
+#: avidemux/ADM_filter/gui_filtermanager.cpp:368
+msgid "Save set of filters"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:122
+msgid "Video Filter Manager"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:143
+msgid "Open filter list [Ctrl-O]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:152
+msgid "Save filter list [Ctrl-S]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:160
+msgid "Save Script"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:163
+msgid "Save as script [Ctrl-J]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:171
+msgid "DVD Res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:174
+msgid "DVD resolution [Ctrl-1]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:182
+msgid "Half D1 Res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:185
+msgid "Half D1 resolution [Ctrl-2]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:193
+msgid "SVCD Res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:196
+msgid "SVCD resolution [Ctrl-3]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:204
+msgid "VCD Res"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:207
+msgid "VCD resolution [Ctrl-4]"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:258
+msgid "Transform"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:331
+msgid "Noise"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:355
+msgid "Sharpness"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:403
+msgid "Misc"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:414
+msgid "Add selected filter to the Active Filters list"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:420
+msgid "<b>Available Filters</b>"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:465
+msgid "Remove filter"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:474
+msgid "Move filter down"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:483
+msgid "Move filter up"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:489
+msgid "P_artial"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:492
+msgid "Apply the current filter only to a part of the file"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:497
+msgid "Configure filter"
+msgstr "?????? ??????"
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:507
+msgid "C_onfigure"
+msgstr "_??????"
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:511
+msgid "<b >Active Filters</b>"
+msgstr ""
+
+#: avidemux/ADM_filter/gui_filtermanager_dialog.cpp:538
+msgid "_Preview"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:388
+msgid "File type identified but no loader support detected..."
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:389
+msgid "May be related to an old index file."
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:396
+#, c-format
+msgid "Attempt to open %s failed!"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:420
+msgid ""
+"You cannot mix different video dimensions yet. Using the partial video "
+"filter later, will not work around this problem. The workaround is:\n"
+"1.) \"resize\" / \"add border\" / \"crop\" each stream to the same "
+"resolution\n"
+"2.) concatinate them together"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:517
+msgid "Build Time Map"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:517
+msgid "Build VBR time map?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:551
+msgid "Use that mode"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:551
+msgid "H264 detected"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:551
+msgid ""
+"If the file is using bframe as reference, it can lead to crash or "
+"stutteting.\n"
+"Avidemux can use another mode which is safed but <b>YOU WILL LOOSE FRAME "
+"ACCURACY</b>.\n"
+"Do you want to use that mode ?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:665
+msgid "Packed Bitstream detected"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:666
+msgid "Do you want me to unpack it ?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:686
+msgid "Could not unpack the video"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:686
+msgid "Using backup decoder - not frame accurate."
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:691
+msgid "Weird"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:691
+msgid "The unpacking succeedeed but the index is still not up to date."
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:697
+msgid "Troubles ahead"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:697
+msgid "This a VOP packed AVI."
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:706
+msgid "Index is not up to date"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:706
+msgid "You should use Tool->Rebuild frame. Do it now ?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:1457
+msgid ""
+"This looks like mpeg\n"
+" Do you want to index it?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edit.cpp:1509
+msgid "Indexing failed"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:57
+msgid "No video loaded"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:62
+msgid "Not indexable"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:62
+msgid "DivX 5 + packed?"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:122
+msgid "Aborted"
+msgstr "?????????"
+
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:75
+msgid "Unsupported"
+msgstr "???? ????????"
+
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:294
+msgid "Old format project file"
+msgstr ""
+
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:294
+msgid "No more supported."
+msgstr ""
+
+#: avidemux/ADM_lavformat/ADM_lavformat.cpp:291
+msgid "Incompatible frame rate"
+msgstr ""
+
+#: avidemux/ADM_codecs/ADM_ffmp43.cpp:51
+msgid "Internal error finding codec"
+msgstr ""
+
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:51
+msgid "Internal error opening codec"
+msgstr ""
+
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+msgid "Internal error with context for  codec"
+msgstr ""
+
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+msgid ""
+".\n"
+" Did you use too low / too high target for 2 pass ?"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
+msgid "Metrics"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
+msgid "Do you want to print metrics on screen ?"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidPalShift.cpp:74
+msgid "Try reverse ?"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidMPLResize.cpp:143
+#: avidemux/ADM_video/ADM_guiResize.cpp:96
+msgid "Width and height cannot be 0"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidMPLResize.cpp:145
+#: avidemux/ADM_video/ADM_guiResize.cpp:98
+msgid "Width and height cannot be odd"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidResampleFPS.cpp:91
+msgid "Use linear blend ?"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidSRT.cpp:215
+msgid "Could not open subtitle file"
+msgstr ""
+
+#: avidemux/ADM_video/ADM_vidSRT.cpp:238
+msgid "Cannot identify subtitle format"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:78 avidemux/gui_navigate.cpp:119
+#: avidemux/gui_navigate.cpp:392 avidemux/gui_navigate.cpp:434
+msgid "Decompressing error"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:78
+msgid "Cannot decode next frame."
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:119 avidemux/gui_navigate.cpp:434
+msgid "Cannot decode keyframe."
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:237
+msgid "Seeking"
+msgstr ""
+
+#: avidemux/gui_navigate.cpp:392
+msgid "Cannot decode the frame."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:261
+msgid "Select ecmascript to run "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:308 avidemux/gtk_gui.cpp:420
+msgid "Obsolete"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:448
+msgid "Not coded in this version"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:461 avidemux/gtk_gui.cpp:466 avidemux/gtk_gui.cpp:590
+#: avidemux/gtk_gui.cpp:593
+msgid "Select AVI file..."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:516
+msgid ""
+"This is to be used to undo packed vop on mpeg4.\n"
+"Continue ?"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:518
+msgid "Select Avi file to write"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:524
+msgid "Select OGM file to write"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:545 avidemux/gtk_gui.cpp:556
+msgid "Select workbench to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:580
+msgid "Select raw file to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:596
+msgid "Select AVI file to append..."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:600
+msgid "Select file to save audio"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:634
+msgid "Select Jpeg sequence to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:637
+msgid "Select BMP to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:641
+msgid "Select Jpeg to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:698
+msgid "Select file to save"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:750 avidemux/gtk_gui.cpp:2289
+msgid "Select MP3 to load "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:753 avidemux/gtk_gui.cpp:2292
+msgid "Select AC3 to load "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:756 avidemux/gtk_gui.cpp:2295
+msgid "Select WAV to load "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:804
+msgid "Out of bounds"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:810
+msgid "Select  file to save "
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:815 avidemux/gtk_gui.cpp:2201
+msgid "Marker A > B"
+msgstr "?????? A > B"
+
+#: avidemux/gtk_gui.cpp:815
+msgid "Cannot copy."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:827
+msgid "Something bad happened (II))"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:841
+msgid "Are you sure ?"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:920
+msgid "Width is not a multiple of 8"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:921
+msgid "This will make trouble for avi files."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:932
+msgid "Rebuild all Keyframes?"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:986
+msgid "Permission error"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:989
+#, c-format
+msgid "\"%s\" does not exist."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1052
+msgid "Cannot open project using the video loader."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1053
+msgid "Try 'File' -> 'Load/Run Project...'"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1055
+msgid "Could not open the file"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1089
+msgid "Multiple Audio Tracks"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1089
+msgid ""
+"The file you just loaded contains several audio tracks.\n"
+"Go to Audio->MainTrack to select the active one."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1180
+msgid "No audio decoder found for this file"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1181
+msgid "Save (A+V) will generate bad AVI. Save audio will work."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1196
+msgid "Could not decode the frame"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1222
+msgid "Something failed"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1231 avidemux/gtk_gui.cpp:2220
+msgid "Something bad happened (II)"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1295
+msgid "Cannot save the audio in copy mode"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1295
+msgid ""
+"Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1303 avidemux/gtk_gui.cpp:1787
+msgid "Saving audio"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1406
+msgid "Cannot encode the frame"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1441
+msgid "Mark A > B"
+msgstr "?????? A > B"
+
+#: avidemux/gtk_gui.cpp:1441
+msgid "Set your markers correctly."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1459
+msgid "Saving as set of jpegs"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1468
+msgid "Cannot decode frame"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1468 avidemux/gtk_gui.cpp:1474
+#: avidemux/gtk_gui.cpp:1482
+msgid "Aborting."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1474
+msgid "Cannot encode frame"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1490 avidemux/gtk_gui.cpp:1596
+#: avidemux/gtk_gui.cpp:2481
+msgid "Done"
+msgstr "????????"
+
+#: avidemux/gtk_gui.cpp:1490
+#, c-format
+msgid "Saved %d images."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1548
+msgid "Memory error"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1554
+msgid "Error converting to BMP"
+msgstr "?????? ??? ??????????? ? BMP"
+
+#: avidemux/gtk_gui.cpp:1560 avidemux/gtk_gui.cpp:2213
+msgid "Something bad happened"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1596
+#, c-format
+msgid "Saved \"%s\"."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1617 avidemux/gtk_gui.cpp:1682
+msgid "Failed to open the file"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1617 avidemux/gtk_gui.cpp:1682
+msgid "Not a WAV file?"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1618
+#, c-format
+msgid "WAV open file failed..."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1748
+msgid "Cannot decompress audio frame"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1762
+msgid "Memory Error"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1808
+msgid "No frames to encode"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1808
+msgid "Please check markers. Is \"A>\" == \">B\"?"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:1988
+msgid "Saving raw video stream"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2152
+msgid "No error found"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2156
+#, c-format
+msgid "Errors found in %u frames"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2174
+msgid "Cannot decompress the audio stream"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2174
+msgid "Switch audio codec to Copy."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2201
+msgid "Cannot delete the selection."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2206
+msgid "You can't remove all frames"
+msgstr "?? ?????? ?? ???????? ??? ???????"
+
+#: avidemux/gtk_gui.cpp:2276
+msgid "Could not get tracks info"
+msgstr "?? ???? ?? ????? ??????????? ? ???????."
+
+#: avidemux/gtk_gui.cpp:2341
+msgid "Select 2nd track"
+msgstr "??????? ????? ?????"
+
+#: avidemux/gtk_gui.cpp:2360
+msgid "Error loading the MP3 file"
+msgstr "?????? ??? ????????? MP3 ????????"
+
+#: avidemux/gtk_gui.cpp:2368 avidemux/gtk_gui.cpp:2389
+#: avidemux/gtk_gui.cpp:2410
+msgid "Second track loaded"
+msgstr "????? ????? ???????"
+
+#: avidemux/gtk_gui.cpp:2382
+msgid "Error loading the AC3 file"
+msgstr "?????? ??? ????????? AC3 ????????"
+
+#: avidemux/gtk_gui.cpp:2403
+msgid "Error loading the WAV file"
+msgstr "?????? ??? ????????? WAV ????????"
+
+#: avidemux/gtk_gui.cpp:2469
+msgid "Saving failed"
+msgstr "?????? ??? ???????"
+
+#: avidemux/gtk_gui.cpp:2469
+msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2481
+#, c-format
+msgid "File %s has been successfully saved."
+msgstr ""
+
+#: avidemux/gtk_gui.cpp:2485
+#, c-format
+msgid "File %s was NOT saved correctly."
+msgstr ""
+
+#: avidemux/GUI_jobs.cpp:37
+msgid "Something very wrong happened when buildint joblist"
+msgstr ""
+
+#: avidemux/GUI_jobs.cpp:42
+msgid "Nothing to do."
+msgstr ""
+
+#: avidemux/GUI_jobs.cpp:42
+msgid "There is no jobs stored, nothing to do"
+msgstr ""
+
+#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:113
+msgid "Could not open OSS audio device"
+msgstr ""
+
+#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:113
+msgid "Check the permissions for /dev/dsp."
+msgstr ""
+
+#: avidemux/ADM_guiBitrate.cpp:104 avidemux/ADM_guiBitrate.cpp:136
+msgid "No data"
+msgstr ""
+
+#: avidemux/gui_autodrive.cpp:51
+msgid "No audio track"
+msgstr ""
+
+#: avidemux/gui_autodrive.cpp:51
+msgid "An audio track is necessary to create such file"
+msgstr ""
+
+#: avidemux/gui_autodrive.cpp:69
+msgid "Cannot select mpeg4 sp codec."
+msgstr "?? ???? ?? ???????? mpeg4 sp ?????."
+
+#: avidemux/gui_autodrive.cpp:86
+msgid ""
+"You don't have FAAC!.\n"
+"It is needed to create PSP compatible video."
+msgstr ""
+
+#: avidemux/ADM_h263/ADM_h263.cpp:263
+msgid "Size is not (s)QCIF"
+msgstr ""
+
+#: avidemux/ADM_ogm/ADM_ogm.cpp:362
+msgid "Take second track ?"
+msgstr "?? ????? ????? ????? ?"
+
+#: avidemux/ADM_ogm/ADM_ogm.cpp:442
+msgid "Scanning OGM"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:211
+msgid "Incorrect output file"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:217
+msgid "Output file error"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:217
+#, c-format
+msgid "Could not open \"%s\" for writing."
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:226
+msgid "Problem loading sub"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:591
+msgid "Sure ?"
+msgstr "??????? ?"
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:754
+msgid "Select SRT to save"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:766
+msgid "Select Glyoh to save"
+msgstr ""
+
+#: avidemux/ADM_ocr/adm_ocr.cpp:780
+msgid "No glyphs to save"
+msgstr ""
+
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:244
+msgid "Ifo error"
+msgstr "Ifo ??????"
+
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:244
+msgid "Error reading ifo file, aborting."
+msgstr "?????? ??? ?????? ifo ????????, ????????."
+
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:252
+msgid "Cannot write .idx"
+msgstr "?? ???? ?? ?????? .idx"
+
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:265
+msgid "Cannot write .sub"
+msgstr "?? ???? ?? ?????? .sub"
+
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:277
+msgid "Problem opening the mpeg files"
+msgstr "??????? ??? ???????? mpeg ????????."
+
+#: avidemux/gui_savenew.cpp:86
+msgid "Dual audio can only be used in copy mode"
+msgstr "??? ?????? ????? ???? ???? ????????? ???? ? ???? ?? ???????."
+
+#: avidemux/gui_savenew.cpp:86
+msgid "Select Copy as the video codec."
+msgstr "??????? ???????? ??? ????? ?????."
+
+#: avidemux/gui_savenew.cpp:192 avidemux/gui_savenew.cpp:208
+#: avidemux/gui_savenew.cpp:221
+msgid "Incompatible output format"
+msgstr "?? ???????????? ??????? ??????"
+
+#: avidemux/gui_savenew.cpp:239
+msgid "There is no second track"
+msgstr "?? ??????? ????? ?????"
+
+#: avidemux/gui_savenew.cpp:239
+msgid "Select a second audio track in the Audio menu."
+msgstr "????????? ????? ????? ????? ?? ?????? '????'"
+
+#: avidemux/gui_savenew.cpp:243
+msgid "Select dual audio AVI to write"
+msgstr "????????? AVI ???????? ?? ???? ?? ??? ?????? ??????"
+
+#: avidemux/gui_savenew.cpp:265
+msgid "This cannot have packed VOP"
+msgstr "?? ?????? ?????????? VOP"
+
+#: avidemux/gui_savenew.cpp:265
+msgid "It is not MPEG-4 video. File will not be saved."
+msgstr "??? ???? MPEG-4 ?????. ???????? ???? ???? ????????."
+
+#: avidemux/gui_savenew.cpp:311
+msgid ""
+"You may need smart copy.\n"
+" Enable it ?"
+msgstr ""
+"????? ?? ???????? ??????? ????????.\n"
+"?? ?? ?? ???????? ?"
+
+#: avidemux/guiplay.cpp:384
+msgid "Trouble initializing audio device"
+msgstr "???????? ??? ????????? ?????? ???????."
+
+#~ msgid "No encoder"
+#~ msgstr "???? ????????."
+
+#~ msgid "Cannot save in process mode."
+#~ msgstr "?? ???? ?? ?????? ? ???? ?? ??????????."



From mean at mail.berlios.de  Tue Apr 24 20:55:40 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 24 Apr 2007 20:55:40 +0200
Subject: [Avidemux-svn-commit] r2962 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704241855.l3OIteIa010909@sheep.berlios.de>

Author: mean
Date: 2007-04-24 20:55:38 +0200 (Tue, 24 Apr 2007)
New Revision: 2962

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
Log:
some audio, better indexing, still very incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-24 05:59:45 UTC (rev 2961)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-24 18:55:38 UTC (rev 2962)
@@ -43,6 +43,7 @@
   ADM_MKV_TYPE type;
   const char *ss;
   
+  
   _isvideopresent=0;
   if(!ebml.open(name)) 
   {
@@ -88,6 +89,7 @@
   printf("Matroska successfully read\n");
   _parser=new ADM_ebml_file();
   ADM_assert(_parser->open(name));
+  _filename=ADM_strdup(name);
   return 1;
 }
 /**
@@ -191,7 +193,10 @@
 */
 WAVHeader *mkvHeader::getAudioInfo(void )
 {
-
+  if(_nbAudioTrack)
+  {
+    return &(_tracks[1].wavHeader); 
+  }
   return NULL;
 }
 /*
@@ -200,6 +205,11 @@
 
 uint8_t mkvHeader::getAudioStream(AVDMGenericAudioStream **audio)
 {
+  if(_nbAudioTrack)
+  {
+      *audio=new mkvAudio(_filename,&(_tracks[1]));
+      return 1;
+  }
   *audio=NULL;
   return 0; 
 }
@@ -228,7 +238,32 @@
   // CLEANUP!!
   if(_parser) delete _parser;
   _parser=NULL;
-  // FIXME Cleanup index!
+  
+  
+#define FREEIF(i) { if(_tracks[i].extraData) delete [] _tracks[i].extraData; _tracks[i].extraData=0;}
+  if(_isvideopresent)
+  {
+      FREEIF(0); 
+  }
+  for(int i=0;i<_nbAudioTrack;i++)
+  {
+    FREEIF(1+i); 
+  }
+  // Delete index
+  if(_isvideopresent && _tracks[0]._index)
+  {
+    delete []  _tracks[0]._index;
+    _tracks[0]._index=NULL;
+  }
+  for(int i=0;i<_nbAudioTrack;i++)
+  {
+    mkvIndex **dx=&(_tracks[1+1]._index);
+    if(*dx)
+    {
+        delete []  *dx;
+        *dx=NULL;
+    }
+  }
 }
 /*
     __________________________________________________________
@@ -246,6 +281,7 @@
 { 
   _parser=NULL;
   _nbAudioTrack=0;
+  _filename=NULL;
   memset(_tracks,0,sizeof(_tracks));
 }
 /*

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-24 05:59:45 UTC (rev 2961)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-24 18:55:38 UTC (rev 2962)
@@ -49,7 +49,24 @@
   uint32_t  _nbIndex;  // current size of the index
   uint32_t  _indexMax; // Max size of the index
 };
+class mkvAudio : public AVDMGenericAudioStream
+{
+  protected:
+    mkvTrak                     *_track;
+    ADM_ebml_file               *_parser;
+    uint32_t                    _index;
+    uint32_t                    _offset;
+  public:
+                                mkvAudio(const char *name,mkvTrak *track);
+    virtual                     ~mkvAudio();
+    virtual uint32_t            read(uint32_t len,uint8_t *buffer);
+    virtual uint8_t             goTo(uint32_t newoffset);
+    virtual uint8_t             getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+  //  virtual uint8_t             goToTime(uint32_t mstime);
+    virtual uint8_t             extraData(uint32_t *l,uint8_t **d);
+};
 
+
 #define ADM_MKV_MAX_TRACKS 20
 
 class mkvHeader         :public vidHeader
@@ -57,6 +74,7 @@
   protected:
                                 
     ADM_ebml_file           *_parser;
+    char                    *_filename;
     mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
 
     
@@ -67,9 +85,11 @@
     uint8_t                 analyzeTracks(void *head,uint32_t headlen);
     uint8_t                 analyzeOneTrack(void *head,uint32_t headlen);
     uint8_t                 walk(void *seed);
+    int                     searchTrackFromTid(uint32_t tid);
     
     // Indexers
     uint8_t                 addVideoEntry(uint64_t where, uint32_t size);
+    uint8_t                 addVideoEntry(uint32_t track,uint64_t where, uint32_t size);
     uint8_t                 videoIndexer(ADM_ebml_file *parser);
   public:
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-24 05:59:45 UTC (rev 2961)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-24 18:55:38 UTC (rev 2962)
@@ -93,6 +93,9 @@
 
 entryDesc entry;
       memset(&entry,0,sizeof(entry));
+      /* Set some defaults value */
+
+      entry.chan=2;
       
       entryWalk(  (ADM_ebml_file *)head,headlen,&entry);
       entry.dump();
@@ -124,6 +127,7 @@
          t->wavHeader.channels=entry.chan;
          t->wavHeader.frequency=entry.fq;
          t->wavHeader.bitspersample=16;
+         t->wavHeader.byterate=(128000)>>3; //FIXME
          t->streamIndex=entry.trackNo;
          t->extraData=entry.extraData;
          t->extraDataLen=entry.extraDataLen;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-24 05:59:45 UTC (rev 2961)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-24 18:55:38 UTC (rev 2962)
@@ -46,8 +46,11 @@
    parser->seek(0);
    
    // Start with a small index, it will grow automatically afterward
-    VIDEO._indexMax=1000;
-    VIDEO._index=new mkvIndex[VIDEO._indexMax];
+   for(int i=0;i<_nbAudioTrack+1;i++)
+   {
+    _tracks[i]._indexMax=1000;
+    _tracks[i]._index=new mkvIndex[_tracks[i]._indexMax];
+   }
     //************
    
    if(!parser->find(ADM_MKV_PRIMARY,MKV_SEGMENT,MKV_CLUSTER,&vlen))
@@ -86,6 +89,7 @@
                 {
                         //printf("Block Group\n");
                         ADM_ebml_file blockGroup(parser,len);
+                        uint32_t lacing,nbLaces;
                         while(!blockGroup.finished())
                         {
                                 blockGroup.readElemId(&id,&len);
@@ -104,16 +108,37 @@
                                   {
                                     // Read Track id 
                                       uint32_t tid=blockGroup.readEBMCode();
+                                      int track=searchTrackFromTid(tid);
                                       //printf("Wanted %u got %u\n",_tracks[0].streamIndex,tid);
-                                      if(_tracks[0].streamIndex!=tid)
+                                      if(track==-1)
                                       {
                                         blockGroup.skip(blockGroup.remaining());
                                         break;  // Not our track
                                       }
                                       // Skip timecode
-                                      blockGroup.skip(3);
-                                      addVideoEntry(blockGroup.tell(),blockGroup.remaining());
-                                      blockGroup.skip(blockGroup.remaining());
+                                      blockGroup.skip(2); // Timecode
+                                      uint8_t flags=blockGroup.readu8();
+                                      uint32_t remaining=blockGroup.remaining();
+                                      lacing=((flags>>1)&3);
+                                      switch(lacing)
+                                      {
+                                        case 0: // No lacing
+                                              addVideoEntry(track,blockGroup.tell(),remaining);
+                                              break;
+                                        case 2 : // Constant size lacing
+                                            {
+                                                    nbLaces=blockGroup.readu8()+1;
+                                                    remaining--;
+                                                    // Only mp3/Ac3 supported, ignore lacing FIXME : Vorbis or AAC will not work
+                                                    addVideoEntry(track,blockGroup.tell(),remaining);
+                                                    //printf("tid:%u track %u Remaining : %llu laces %u blksize %d er%d\n",tid,track,remaining,nbLaces,remaining/nbLaces,remaining-(remaining/nbLaces)*nbLaces);
+                                            } 
+                                        break;
+                                        default: 
+                                            printf("unsupported lacing\n");
+                                            break;
+                                      }
+                                      blockGroup.skip(remaining);
                                       break;
                                   }
                                 }
@@ -131,26 +156,45 @@
     \fn addVideoEntry
     \brief add an entry to the video index
 */
-uint8_t mkvHeader::addVideoEntry(uint64_t where, uint32_t size)
+uint8_t mkvHeader::addVideoEntry(uint32_t track,uint64_t where, uint32_t size)
 {
+  //
+  mkvTrak *Track=&(_tracks[track]);
+  
+  
   // Need to grow index ?
-  if(VIDEO._nbIndex==VIDEO._indexMax-1)
+  if(Track->_nbIndex==Track->_indexMax-1)
   {
     // Realloc 
-    mkvIndex *dx=new mkvIndex[VIDEO._indexMax*2];
-    memcpy(dx, _tracks[0]._index,sizeof(mkvIndex)*VIDEO._nbIndex);
-    VIDEO._indexMax*=2;
-    delete [] _tracks[0]._index;
-    _tracks[0]._index=dx;
+    mkvIndex *dx=new mkvIndex[Track->_indexMax*2];
+    memcpy(dx, Track->_index,sizeof(mkvIndex)*Track->_nbIndex);
+    Track->_indexMax*=2;
+    delete [] Track->_index;
+    Track->_index=dx;
   }
   
-  mkvIndex *index=_tracks[0]._index;
-  int x=VIDEO._nbIndex;
+  mkvIndex *index=Track->_index;
+  int x=Track->_nbIndex;
   index[x].pos=where;
   index[x].size=size;
   index[x].flags=0;
   index[x].timeCode=0;
-  VIDEO._nbIndex++;
+  Track->_nbIndex++;
  // printf("++\n");
   return 1;
-}
\ No newline at end of file
+}
+
+/**
+  \fn searchTrackFromTid
+  \brief Returns our track number for the stream track number. -1 if the stream is not handled.
+
+*/
+int mkvHeader::searchTrackFromTid(uint32_t tid)
+{
+  for(int i=0;i<1+_nbAudioTrack;i++)
+  {
+    if(tid==_tracks[i].streamIndex) return i;
+  }
+  return -1;
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-24 05:59:45 UTC (rev 2961)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-24 18:55:38 UTC (rev 2962)
@@ -28,5 +28,115 @@
 #include "ADM_toolkit/toolkit.hxx"
 
 
+#include "ADM_mkv.h"
+#if 0
+class mkvAudio : public AVDMGenericAudioStream
+{
+  protected:
+    mkvTrak                     *_track;
+    
+  public:
+                                mkvAudio(mkvTrak *track);
+    virtual                     ~mkvAudio();
+    virtual uint32_t            read(uint32_t len,uint8_t *buffer);
+    virtual uint8_t             goTo(uint32_t newoffset);
+    virtual uint8_t             getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
+    virtual uint8_t             goToTime(uint32_t mstime);
+    virtual uint8_t             extraData(uint32_t *l,uint8_t **d);
+};
+#endif
 
+/**
+    \fn ~mkvAudio
+    
+*/
+ mkvAudio ::~mkvAudio()
+{
+  if(_parser) delete _parser;
+  _parser=NULL; 
+  _offset=0;
+  _index=0;
+}
+
+uint32_t    mkvAudio::read(uint32_t len,uint8_t *buffer)
+{
+  uint32_t red=0;
+  while(1)
+  {
+    //********************************************
+    if(_index>=_track->_nbIndex)
+    {
+      return 0; 
+    }
+    //********************************************
+    if(len+_offset <=_track->_index[_index].size)
+    {
+      _parser->readBin(buffer,len);
+      _offset+=len;
+      return len; 
+    }
+    // empty...
+    //********************************************
+    int32_t remaining=_track->_index[_index].size-_offset;
+    ADM_assert(remaining>=0);
+    
+    _parser->readBin(buffer,remaining);
+    red+=remaining;
+    len-=remaining;
+    buffer+=remaining;
+    _index++;
+    if(_index>=_track->_nbIndex)
+    {
+      return red; 
+    }
+    _parser->seek(_track->_index[_index].pos);
+    _offset=0;
+  }
+}
+/**
+      \fn goTo
+*/
+uint8_t             mkvAudio::goTo(uint32_t newoffset)
+{
+  _parser->seek(_track->_index[0].pos);
+    _offset=0;
+    _index=0;
+}
+/**
+      \fn extraData
+*/
+uint8_t             mkvAudio::extraData(uint32_t *l,uint8_t **d)
+{
+  *l=_track->extraDataLen;
+  *d=_track->extraData; 
+}
+/**
+    \fn getPacket
+*/
+uint8_t             mkvAudio::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+{
+    *samples=1152;
+    *len=read(384,dest);
+    if(*len) return 1;
+    return 0;
+}
+/**
+      \fn mkvAudio
+*/
+ mkvAudio::mkvAudio(const char *name,mkvTrak *track) : AVDMGenericAudioStream()
+{
+   _parser=new ADM_ebml_file();
+   ADM_assert(_parser->open(name));
+  _track=track; 
+  
+  // Compute total length in byte
+  _length=0;
+  for(int i=0;i<track->_nbIndex;i++)
+  {
+    _length+=track->_index[i].size; 
+  }
+  _wavheader=new WAVHeader;
+  memcpy(_wavheader,&(_track->wavHeader),sizeof(WAVHeader));
+  printf("[MKVAUDIO] found %lu bytes\n",_length);
+}
 //EOF



From mihailzenkov at mail.berlios.de  Wed Apr 25 12:14:30 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Wed, 25 Apr 2007 12:14:30 +0200
Subject: [Avidemux-svn-commit] r2964 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_libraries/ADM_libmpeg2enc
	avidemux/ADM_userInterfaces/ADM_QT4
Message-ID: <200704251014.l3PAEU22030870@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-25 12:14:30 +0200 (Wed, 25 Apr 2007)
New Revision: 2964

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.adm
   branches/avidemux_2.4_branch/configure.in.in
Log:
fix build with automake-1.10

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/Makefile.am	2007-04-25 06:13:27 UTC (rev 2963)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libmpeg2enc/Makefile.am	2007-04-25 10:14:30 UTC (rev 2964)
@@ -40,6 +40,7 @@
 ####### kdevelop will overwrite this part!!! (end)############
 
 INCLUDES = $(all_includes)
+AUTOMAKE_OPTIONS = -Wno-portability
 #
 # From mpeg2enc 's Makefile.am
 %.o: %.s ; 	$(AS) $(ASFLAGS) -o $@ $<

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.adm
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.adm	2007-04-25 06:13:27 UTC (rev 2963)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.adm	2007-04-25 10:14:30 UTC (rev 2964)
@@ -1,3 +1,5 @@
+AUTOMAKE_OPTIONS = -Wno-portability
+
 AQ_%.cpp : Q_%.cpp %.ui
 	$(UIC) $*.ui -o ui_$*.h
 	$(MOC) Q_$*.cpp -o Q_$*.moc

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-25 06:13:27 UTC (rev 2963)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-25 10:14:30 UTC (rev 2964)
@@ -56,6 +56,8 @@
 dnl make /usr/local the default for the installation
 AC_PREFIX_DEFAULT(/usr/local)
 
+AM_PROG_AS
+
 dnl Ranlib
 AC_PROG_RANLIB
 AC_PROG_CXX



From mihailzenkov at mail.berlios.de  Wed Apr 25 15:06:26 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Wed, 25 Apr 2007 15:06:26 +0200
Subject: [Avidemux-svn-commit] r2965 - branches/avidemux_2.4_branch
Message-ID: <200704251306.l3PD6Q0M028642@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-25 15:06:19 +0200 (Wed, 25 Apr 2007)
New Revision: 2965

Modified:
   branches/avidemux_2.4_branch/configure.in.in
Log:
fix configure (test case ./configure --without-libsdl --enable-debug)

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-04-25 10:14:30 UTC (rev 2964)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-04-25 13:06:19 UTC (rev 2965)
@@ -1281,7 +1281,7 @@
 dnl ________ Debug, Profiling & Optims ________
 AC_ARG_ENABLE([profile],
 	[AC_HELP_STRING([--enable-profile], [enable profiling [default=no]])],
-	[use_profile=${withval}], [use_profile=no])
+	[use_profile=${enableval}], [use_profile=no])
 
 if test "x$use_profile" = "xyes"; then
 	CXXFLAGS="$CXXFLAGS -pg"
@@ -1291,7 +1291,7 @@
 
 AC_ARG_ENABLE([debug],
 	[AC_HELP_STRING([--enable-debug], [enable debug symbols [default=no]])],
-	[use_debug=${withval}], [use_debug=no])
+	[use_debug=${enableval}], [use_debug=no])
  
 if test "x$use_debug" = "xyes"; then
 	AC_DEFINE(ADM_DEBUG,1,[be verbose])



From mihailzenkov at mail.berlios.de  Wed Apr 25 16:01:20 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Wed, 25 Apr 2007 16:01:20 +0200
Subject: [Avidemux-svn-commit] r2966 -
	branches/avidemux_2.4_branch/avidemux/ADM_editor
Message-ID: <200704251401.l3PE1Kx5002901@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-25 16:01:19 +0200 (Wed, 25 Apr 2007)
New Revision: 2966

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
Log:
fix container select (broken in 2963)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-04-25 13:06:19 UTC (rev 2965)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-04-25 14:01:19 UTC (rev 2966)
@@ -14,14 +14,14 @@
 typedef enum 
 {
 	ADM_AVI=0,
+	ADM_AVI_DUAL,
+	ADM_AVI_PAK,
 	ADM_AVI_UNP,
-	ADM_AVI_PAK,
-	ADM_AVI_DUAL,
-	ADM_OGM,
-	ADM_ES,
 	ADM_PS,
 	ADM_TS,
+	ADM_ES,
 	ADM_MP4,
+	ADM_OGM,
 	ADM_PSP,
 	ADM_FORMAT_MAX,
 	ADM_FMT_DUMMY=ADM_FORMAT_MAX



From mean at mail.berlios.de  Wed Apr 25 19:19:09 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 25 Apr 2007 19:19:09 +0200
Subject: [Avidemux-svn-commit] r2967 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704251719.l3PHJ9Ho011339@sheep.berlios.de>

Author: mean
Date: 2007-04-25 19:19:01 +0200 (Wed, 25 Apr 2007)
New Revision: 2967

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
Log:
fix size of audio blocks

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-25 14:01:19 UTC (rev 2966)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-25 17:19:01 UTC (rev 2967)
@@ -131,6 +131,12 @@
                                                     remaining--;
                                                     // Only mp3/Ac3 supported, ignore lacing FIXME : Vorbis or AAC will not work
                                                     addVideoEntry(track,blockGroup.tell(),remaining);
+                                                    int bsize=remaining/nbLaces;
+                                                    if(bsize*nbLaces!=remaining)
+                                                    {
+                                                      printf("Warning not multiple bsize=%d total=%u  nbLaces=%u\n",bsize,remaining,nbLaces);
+                                                    }
+                                                    if(!track) printf("Warning lacing on video track\n");
                                                     //printf("tid:%u track %u Remaining : %llu laces %u blksize %d er%d\n",tid,track,remaining,nbLaces,remaining/nbLaces,remaining-(remaining/nbLaces)*nbLaces);
                                             } 
                                         break;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-25 14:01:19 UTC (rev 2966)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-25 17:19:01 UTC (rev 2967)
@@ -27,25 +27,9 @@
 #include "fourcc.h"
 #include "ADM_toolkit/toolkit.hxx"
 
-
 #include "ADM_mkv.h"
-#if 0
-class mkvAudio : public AVDMGenericAudioStream
-{
-  protected:
-    mkvTrak                     *_track;
-    
-  public:
-                                mkvAudio(mkvTrak *track);
-    virtual                     ~mkvAudio();
-    virtual uint32_t            read(uint32_t len,uint8_t *buffer);
-    virtual uint8_t             goTo(uint32_t newoffset);
-    virtual uint8_t             getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
-    virtual uint8_t             goToTime(uint32_t mstime);
-    virtual uint8_t             extraData(uint32_t *l,uint8_t **d);
-};
-#endif
 
+
 /**
     \fn ~mkvAudio
     
@@ -66,14 +50,15 @@
     //********************************************
     if(_index>=_track->_nbIndex)
     {
-      return 0; 
+      return red; 
     }
     //********************************************
     if(len+_offset <=_track->_index[_index].size)
     {
       _parser->readBin(buffer,len);
       _offset+=len;
-      return len; 
+      red+=len;
+      return red; 
     }
     // empty...
     //********************************************

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-25 14:01:19 UTC (rev 2966)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-25 17:19:01 UTC (rev 2967)
@@ -86,6 +86,7 @@
   MKTAG(MKV_TIMECODE,0xE7,ADM_MKV_TYPE_UINTEGER),
   MKTAG(MKV_BLOCK_GROUP,0xA0,ADM_MKV_TYPE_CONTAINER),
   MKTAG(MKV_BLOCK,0xA1,ADM_MKV_TYPE_BINARY),
+  MKTAG(MKV_SIMPLE_BLOCK,0xA3,ADM_MKV_TYPE_BINARY),
   /** */
   MKTAG(MKV_CUE_POINT,0xBB,ADM_MKV_TYPE_CONTAINER),
   MKTAG(MKV_CUE_TIME,0xB3,ADM_MKV_TYPE_UINTEGER),



From mean at mail.berlios.de  Wed Apr 25 21:19:16 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 25 Apr 2007 21:19:16 +0200
Subject: [Avidemux-svn-commit] r2968 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_inputs/ADM_matroska ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200704251919.l3PJJGms007642@sheep.berlios.de>

Author: mean
Date: 2007-04-25 21:19:15 +0200 (Wed, 25 Apr 2007)
New Revision: 2968

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
Log:
more stuff, does not work for h264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-25 19:19:15 UTC (rev 2968)
@@ -86,10 +86,15 @@
     }
   // update some infos
   _videostream.dwLength= _mainaviheader.dwTotalFrames=_tracks[0]._nbIndex; 
-  printf("Matroska successfully read\n");
+  
   _parser=new ADM_ebml_file();
   ADM_assert(_parser->open(name));
   _filename=ADM_strdup(name);
+  
+  // Finaly update index with queue
+  readCue(&ebml);
+  printf("[MKV]Matroska successfully read\n");
+  
   return 1;
 }
 /**

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-25 19:19:15 UTC (rev 2968)
@@ -91,6 +91,7 @@
     uint8_t                 addVideoEntry(uint64_t where, uint32_t size);
     uint8_t                 addVideoEntry(uint32_t track,uint64_t where, uint32_t size);
     uint8_t                 videoIndexer(ADM_ebml_file *parser);
+    uint8_t                 readCue(ADM_ebml_file *parser);
   public:
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-25 19:19:15 UTC (rev 2968)
@@ -203,4 +203,90 @@
   }
   return -1;
 }
+
+/**
+  \fn readCue
+  \brief Update index with cue content
+
+*/
+uint8_t                 mkvHeader::readCue(ADM_ebml_file *parser)
+{
+  uint64_t fileSize,len,bsize;
+  uint32_t alen,vlen;
+  uint64_t id;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  uint64_t time;
+  
+   parser->seek(0);
+   
+   if(!parser->find(ADM_MKV_PRIMARY,MKV_SEGMENT,MKV_CLUSTER,&vlen))
+   {
+     printf("[MKV] Cannot find CLUSTER atom\n");
+     return 0;
+   }
+   ADM_ebml_file segment(parser,vlen);
+   
+   while(segment.find(ADM_MKV_PRIMARY,MKV_CUES,MKV_CLUSTER,&alen,0))
+  {
+   ADM_ebml_file cues(&segment,alen);
+   while(!cues.finished())
+   {
+      cues.readElemId(&id,&len);
+      if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+      {
+        printf("[MKV] Tag 0x%x not found (len %llu)\n",id,len);
+        cues.skip(len);
+        continue;
+      }
+      if(id!=MKV_CUE_POINT)
+      {
+        printf("Found %s in CUES, ignored \n",ss); 
+        cues.skip(len);
+        continue;
+      }
+      ADM_ebml_file cue(&cues,len);
+      // Cue TIME normally
+       cue.readElemId(&id,&len);
+       if(id!=MKV_CUE_TIME)
+       {
+          ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type);
+          printf("Found %s(0x%x), expected CUE_TIME  (0x%x)\n", ss,id,MKV_CUE_TIME);
+          cue.skip(cue.remaining());
+          continue;
+       }
+       time=cue.readUnsignedInt(len);
+       
+       
+       cue.readElemId(&id,&len);
+       if(id!=MKV_CUE_TRACK_POSITION)
+       {
+          ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type);
+          printf("Found %s (0x%x), expected MKV_CUE_TRACK_POSITION (0x%x)\n", ss,id,MKV_CUE_TRACK_POSITION);
+          cue.skip(cues.remaining());
+          continue;
+       }
+       ADM_ebml_file trackPos(&cue,len);
+       uint64_t tid=0;
+       uint64_t cluster_position=0;
+       while(!trackPos.finished())
+       {
+         trackPos.readElemId(&id,&len);
+         switch(id)
+         {
+           case MKV_CUE_TRACK: tid=trackPos.readUnsignedInt(len);break;
+           case MKV_CUE_CLUSTER_POSITION: cluster_position=trackPos.readUnsignedInt(len);break;
+           default: 
+                 ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type);
+                 printf("[MKV] in cluster position found tag %s (0x%x)\n",ss,id);
+                 trackPos.skip(len);
+                 continue;
+         }
+       }
+       printf("Track %u Position 0x%llx time %llu\n",tid,cluster_position,time);
+     }
+   }
+   printf("[MKV] Cues updated\n");
+   return 1;  
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-25 19:19:15 UTC (rev 2968)
@@ -83,6 +83,20 @@
 */
 uint8_t             mkvAudio::goTo(uint32_t newoffset)
 {
+  uint32_t cumul=0;
+  for(int i=0;i<_track->_nbIndex;i++)
+  {
+    if(newoffset>=cumul && newoffset<=cumul+_track->_index[i].size)
+    {
+      _offset=0;
+      _index=i;
+      _parser->seek(_track->_index[_index].pos);
+      return 1;
+    }
+    cumul+=_track->_index[i].size;
+  }
+  // 
+  printf("[Mkv audio] Goto failed\n");
   _parser->seek(_track->_index[0].pos);
     _offset=0;
     _index=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-25 19:19:15 UTC (rev 2968)
@@ -11,18 +11,12 @@
 #include <unistd.h>
 #include <string.h>
 #include <stdio.h>
+#include "../ADM_toolkit_gtk/ADM_gladeSupport.h"
 
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
-#if 0
-#include "callbacks.h"
-#include "interface.h"
-#include "support.h"
-#else
-#include "default.h"
-#include "ADM_toolkit_gtk/toolkit_gtk.h"
-#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
-#endif
+
+
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)
@@ -40,11 +34,11 @@
   GtkWidget *menuitem1;
   GtkWidget *menuitem1_menu;
   GtkWidget *open_video1;
-  GtkWidget *image7996;
+  GtkWidget *image8046;
   GtkWidget *append_video1;
-  GtkWidget *image7997;
+  GtkWidget *image8047;
   GtkWidget *save_stuff;
-  GtkWidget *image7998;
+  GtkWidget *image8048;
   GtkWidget *save_stuff_menu;
   GtkWidget *save_as_avi1;
   GtkWidget *separator1;
@@ -53,39 +47,39 @@
   GtkWidget *save_selection_as_jpegs1;
   GtkWidget *separator3;
   GtkWidget *save_project1;
-  GtkWidget *image7999;
+  GtkWidget *image8049;
   GtkWidget *save_project_as1;
-  GtkWidget *image8000;
+  GtkWidget *image8050;
   GtkWidget *run_script1;
-  GtkWidget *image8001;
+  GtkWidget *image8051;
   GtkWidget *add_to_joblist1;
   GtkWidget *joblist1;
   GtkWidget *separator16;
   GtkWidget *video_informations1;
-  GtkWidget *image8002;
+  GtkWidget *image8052;
   GtkWidget *avi_muxer_options1;
   GtkWidget *separator4;
   GtkWidget *quit1;
-  GtkWidget *image8003;
+  GtkWidget *image8053;
   GtkWidget *menuitem2;
   GtkWidget *menuitem2_menu;
   GtkWidget *reset_edits1;
-  GtkWidget *image8004;
+  GtkWidget *image8054;
   GtkWidget *separator5;
   GtkWidget *cut1;
-  GtkWidget *image8005;
+  GtkWidget *image8055;
   GtkWidget *copy1;
-  GtkWidget *image8006;
+  GtkWidget *image8056;
   GtkWidget *paste1;
-  GtkWidget *image8007;
+  GtkWidget *image8057;
   GtkWidget *delete1;
-  GtkWidget *image8008;
+  GtkWidget *image8058;
   GtkWidget *separator6;
   GtkWidget *set_marker_a1;
   GtkWidget *set_marker_b1;
   GtkWidget *separator7;
   GtkWidget *preferences1;
-  GtkWidget *image8009;
+  GtkWidget *image8059;
   GtkWidget *view1;
   GtkWidget *view1_menu;
   GtkWidget *toolbar1;
@@ -114,13 +108,13 @@
   GtkWidget *build_vbr_time_map1;
   GtkWidget *separator11;
   GtkWidget *save_audio1;
-  GtkWidget *image8010;
+  GtkWidget *image8060;
   GtkWidget *audio_encoder1;
   GtkWidget *filters2;
   GtkWidget *tools1;
   GtkWidget *tools1_menu;
   GtkWidget *calculator1;
-  GtkWidget *image8011;
+  GtkWidget *image8061;
   GtkWidget *separator12;
   GtkWidget *rebuild_frames;
   GtkWidget *check_frames;
@@ -129,6 +123,8 @@
   GtkWidget *separator13;
   GtkWidget *v2v;
   GtkWidget *ocr_vobsub_2_srt;
+  GtkWidget *separator17;
+  GtkWidget *see_hex1;
   GtkWidget *help1;
   GtkWidget *help1_menu;
   GtkWidget *vcd1;
@@ -139,34 +135,34 @@
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
-  GtkWidget *image8012;
+  GtkWidget *image8062;
   GtkWidget *previous_frame1;
-  GtkWidget *image8013;
+  GtkWidget *image8063;
   GtkWidget *next_frame1;
-  GtkWidget *image8014;
+  GtkWidget *image8064;
   GtkWidget *previous_intra_frame1;
-  GtkWidget *image8015;
+  GtkWidget *image8065;
   GtkWidget *next_intra_frame1;
-  GtkWidget *image8016;
+  GtkWidget *image8066;
   GtkWidget *search_previous_black_frame1;
   GtkWidget *search_next_black_frame1;
   GtkWidget *first_frame1;
-  GtkWidget *image8017;
+  GtkWidget *image8067;
   GtkWidget *last_frame1;
-  GtkWidget *image8018;
+  GtkWidget *image8068;
   GtkWidget *separator14;
   GtkWidget *go_to_marker_a1;
   GtkWidget *go_to_marker_b1;
   GtkWidget *separator15;
   GtkWidget *jum_to_frame1;
-  GtkWidget *image8019;
+  GtkWidget *image8069;
   GtkWidget *jump_to_time1;
-  GtkWidget *image8020;
+  GtkWidget *image8070;
   GtkWidget *custom1;
   GtkWidget *help2;
   GtkWidget *help2_menu;
   GtkWidget *about1;
-  GtkWidget *image8021;
+  GtkWidget *image8071;
   GtkWidget *show_builtin_support1;
   GtkWidget *toolbar2;
   GtkIconSize tmp_toolbar_icon_size;
@@ -293,9 +289,9 @@
                               GDK_O, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image7996 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image7996);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image7996);
+  image8046 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8046);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8046);
 
   append_video1 = gtk_image_menu_item_new_with_mnemonic (_("_Append..."));
   gtk_widget_show (append_video1);
@@ -304,17 +300,17 @@
                               GDK_A, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image7997 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image7997);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image7997);
+  image8047 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8047);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8047);
 
   save_stuff = gtk_image_menu_item_new_with_mnemonic (_("_Save"));
   gtk_widget_show (save_stuff);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_stuff);
 
-  image7998 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image7998);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image7998);
+  image8048 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8048);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8048);
 
   save_stuff_menu = gtk_menu_new ();
   gtk_menu_item_set_submenu (GTK_MENU_ITEM (save_stuff), save_stuff_menu);
@@ -352,25 +348,25 @@
   gtk_widget_show (save_project1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project1);
 
-  image7999 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image7999);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image7999);
+  image8049 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8049);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8049);
 
   save_project_as1 = gtk_image_menu_item_new_with_mnemonic (_("Save P_roject As..."));
   gtk_widget_show (save_project_as1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project_as1);
 
-  image8000 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8000);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8000);
+  image8050 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8050);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8050);
 
   run_script1 = gtk_image_menu_item_new_with_mnemonic (_("_Load/Run Project..."));
   gtk_widget_show (run_script1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), run_script1);
 
-  image8001 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8001);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8001);
+  image8051 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8051);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8051);
 
   add_to_joblist1 = gtk_menu_item_new_with_mnemonic (_("A_dd to Joblist..."));
   gtk_widget_show (add_to_joblist1);
@@ -395,9 +391,9 @@
                               GDK_Return, (GdkModifierType)( GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8002 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8002);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8002);
+  image8052 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8052);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8052);
 
   avi_muxer_options1 = gtk_menu_item_new_with_mnemonic (_("AVI _Muxer Options"));
   gtk_widget_show (avi_muxer_options1);
@@ -415,9 +411,9 @@
                               GDK_Q, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8003 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8003);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8003);
+  image8053 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8053);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8053);
 
   menuitem2 = gtk_menu_item_new_with_mnemonic (_("_Edit"));
   gtk_widget_show (menuitem2);
@@ -430,9 +426,9 @@
   gtk_widget_show (reset_edits1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), reset_edits1);
 
-  image8004 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8004);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8004);
+  image8054 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8054);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8054);
 
   separator5 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator5);
@@ -446,9 +442,9 @@
                               GDK_X, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8005 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8005);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8005);
+  image8055 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8055);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8055);
 
   copy1 = gtk_image_menu_item_new_with_mnemonic (_("_Copy"));
   gtk_widget_show (copy1);
@@ -457,9 +453,9 @@
                               GDK_C, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8006 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8006);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8006);
+  image8056 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8056);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8056);
 
   paste1 = gtk_image_menu_item_new_with_mnemonic (_("_Paste"));
   gtk_widget_show (paste1);
@@ -468,9 +464,9 @@
                               GDK_V, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8007 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8007);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8007);
+  image8057 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8057);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8057);
 
   delete1 = gtk_image_menu_item_new_with_mnemonic (_("_Delete"));
   gtk_widget_show (delete1);
@@ -479,9 +475,9 @@
                               GDK_Delete, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8008 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8008);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8008);
+  image8058 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8058);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8058);
 
   separator6 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator6);
@@ -511,9 +507,9 @@
   gtk_widget_show (preferences1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), preferences1);
 
-  image8009 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8009);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8009);
+  image8059 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8059);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8059);
 
   view1 = gtk_menu_item_new_with_mnemonic (_("_View"));
   gtk_widget_show (view1);
@@ -667,9 +663,9 @@
                               GDK_S, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8010 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8010);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8010);
+  image8060 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8060);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8060);
 
   audio_encoder1 = gtk_menu_item_new_with_mnemonic (_("_Encoder"));
   gtk_widget_show (audio_encoder1);
@@ -696,9 +692,9 @@
                               GDK_F7, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8011 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
-  gtk_widget_show (image8011);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8011);
+  image8061 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
+  gtk_widget_show (image8061);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8061);
 
   separator12 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator12);
@@ -734,6 +730,15 @@
   gtk_widget_show (ocr_vobsub_2_srt);
   gtk_container_add (GTK_CONTAINER (tools1_menu), ocr_vobsub_2_srt);
 
+  separator17 = gtk_separator_menu_item_new ();
+  gtk_widget_show (separator17);
+  gtk_container_add (GTK_CONTAINER (tools1_menu), separator17);
+  gtk_widget_set_sensitive (separator17, FALSE);
+
+  see_hex1 = gtk_menu_item_new_with_mnemonic (_("See Hex"));
+  gtk_widget_show (see_hex1);
+  gtk_container_add (GTK_CONTAINER (tools1_menu), see_hex1);
+
   help1 = gtk_menu_item_new_with_mnemonic (_("A_uto"));
   gtk_widget_show (help1);
   gtk_container_add (GTK_CONTAINER (menuBar), help1);
@@ -775,9 +780,9 @@
                               GDK_P, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8012 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8012);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8012);
+  image8062 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8062);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8062);
 
   previous_frame1 = gtk_image_menu_item_new_with_mnemonic (_("P_revious Frame"));
   gtk_widget_show (previous_frame1);
@@ -786,9 +791,9 @@
                               GDK_KP_4, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8013 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8013);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8013);
+  image8063 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8063);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8063);
 
   next_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Next Frame"));
   gtk_widget_show (next_frame1);
@@ -797,9 +802,9 @@
                               GDK_KP_6, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8014 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8014);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8014);
+  image8064 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8064);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8064);
 
   previous_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Pr_evious Intra Frame"));
   gtk_widget_show (previous_intra_frame1);
@@ -808,9 +813,9 @@
                               GDK_KP_2, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8015 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8015);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8015);
+  image8065 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8065);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8065);
 
   next_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Next _Intra Frame"));
   gtk_widget_show (next_intra_frame1);
@@ -819,9 +824,9 @@
                               GDK_KP_8, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8016 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8016);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8016);
+  image8066 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8066);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8066);
 
   search_previous_black_frame1 = gtk_menu_item_new_with_mnemonic (_("Previou_s Black Frame"));
   gtk_widget_show (search_previous_black_frame1);
@@ -838,9 +843,9 @@
                               GDK_Home, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8017 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8017);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8017);
+  image8067 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8067);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8067);
 
   last_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Last Frame"));
   gtk_widget_show (last_frame1);
@@ -849,9 +854,9 @@
                               GDK_End, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8018 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8018);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8018);
+  image8068 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8068);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8068);
 
   separator14 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator14);
@@ -884,9 +889,9 @@
                               GDK_F, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8019 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8019);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8019);
+  image8069 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8069);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8069);
 
   jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_("Jump to _Time..."));
   gtk_widget_show (jump_to_time1);
@@ -895,9 +900,9 @@
                               GDK_T, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8020 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8020);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8020);
+  image8070 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8070);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8070);
 
   custom1 = gtk_menu_item_new_with_mnemonic (_("Custom"));
   gtk_widget_show (custom1);
@@ -914,9 +919,9 @@
   gtk_widget_show (about1);
   gtk_container_add (GTK_CONTAINER (help2_menu), about1);
 
-  image8021 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8021);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8021);
+  image8071 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8071);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8071);
 
   show_builtin_support1 = gtk_menu_item_new_with_mnemonic (_("Show builtin support"));
   gtk_widget_show (show_builtin_support1);
@@ -1015,7 +1020,7 @@
   gtk_box_pack_start (GTK_BOX (vbox7), comboboxVideo, FALSE, FALSE, 0);
   gtk_combo_box_append_text (GTK_COMBO_BOX (comboboxVideo), _("Copy"));
 
-  buttonConfV = gtk_button_new_with_mnemonic ("Configure");
+  buttonConfV = gtk_button_new_with_mnemonic (_("Configure"));
   gtk_widget_show (buttonConfV);
   gtk_box_pack_start (GTK_BOX (vbox7), buttonConfV, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, buttonConfV, _("Configure video encoder"), NULL);
@@ -1055,7 +1060,7 @@
   gtk_box_pack_start (GTK_BOX (vbox8), comboboxAudio, FALSE, FALSE, 0);
   gtk_combo_box_append_text (GTK_COMBO_BOX (comboboxAudio), _("Copy"));
 
-  buttonConfA = gtk_button_new_with_mnemonic ("Configure");
+  buttonConfA = gtk_button_new_with_mnemonic (_("Configure"));
   gtk_widget_show (buttonConfA);
   gtk_box_pack_start (GTK_BOX (vbox8), buttonConfA, FALSE, FALSE, 0);
   gtk_tooltips_set_tip (tooltips, buttonConfA, _("Configure audio encoder"), NULL);
@@ -1418,11 +1423,11 @@
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1, "menuitem1");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1_menu, "menuitem1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, open_video1, "open_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image7996, "image7996");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8046, "image8046");
   GLADE_HOOKUP_OBJECT (mainWindow, append_video1, "append_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image7997, "image7997");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8047, "image8047");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff, "save_stuff");
-  GLADE_HOOKUP_OBJECT (mainWindow, image7998, "image7998");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8048, "image8048");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff_menu, "save_stuff_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, save_as_avi1, "save_as_avi1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator1, "separator1");
@@ -1431,39 +1436,39 @@
   GLADE_HOOKUP_OBJECT (mainWindow, save_selection_as_jpegs1, "save_selection_as_jpegs1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator3, "separator3");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project1, "save_project1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image7999, "image7999");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8049, "image8049");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project_as1, "save_project_as1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8000, "image8000");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8050, "image8050");
   GLADE_HOOKUP_OBJECT (mainWindow, run_script1, "run_script1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8001, "image8001");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8051, "image8051");
   GLADE_HOOKUP_OBJECT (mainWindow, add_to_joblist1, "add_to_joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, joblist1, "joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator16, "separator16");
   GLADE_HOOKUP_OBJECT (mainWindow, video_informations1, "video_informations1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8002, "image8002");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8052, "image8052");
   GLADE_HOOKUP_OBJECT (mainWindow, avi_muxer_options1, "avi_muxer_options1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator4, "separator4");
   GLADE_HOOKUP_OBJECT (mainWindow, quit1, "quit1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8003, "image8003");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8053, "image8053");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2, "menuitem2");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2_menu, "menuitem2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, reset_edits1, "reset_edits1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8004, "image8004");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8054, "image8054");
   GLADE_HOOKUP_OBJECT (mainWindow, separator5, "separator5");
   GLADE_HOOKUP_OBJECT (mainWindow, cut1, "cut1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8005, "image8005");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8055, "image8055");
   GLADE_HOOKUP_OBJECT (mainWindow, copy1, "copy1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8006, "image8006");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8056, "image8056");
   GLADE_HOOKUP_OBJECT (mainWindow, paste1, "paste1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8007, "image8007");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8057, "image8057");
   GLADE_HOOKUP_OBJECT (mainWindow, delete1, "delete1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8008, "image8008");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8058, "image8058");
   GLADE_HOOKUP_OBJECT (mainWindow, separator6, "separator6");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_a1, "set_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_b1, "set_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator7, "separator7");
   GLADE_HOOKUP_OBJECT (mainWindow, preferences1, "preferences1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8009, "image8009");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8059, "image8059");
   GLADE_HOOKUP_OBJECT (mainWindow, view1, "view1");
   GLADE_HOOKUP_OBJECT (mainWindow, view1_menu, "view1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar1, "toolbar1");
@@ -1492,13 +1497,13 @@
   GLADE_HOOKUP_OBJECT (mainWindow, build_vbr_time_map1, "build_vbr_time_map1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator11, "separator11");
   GLADE_HOOKUP_OBJECT (mainWindow, save_audio1, "save_audio1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8010, "image8010");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8060, "image8060");
   GLADE_HOOKUP_OBJECT (mainWindow, audio_encoder1, "audio_encoder1");
   GLADE_HOOKUP_OBJECT (mainWindow, filters2, "filters2");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1, "tools1");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1_menu, "tools1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, calculator1, "calculator1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8011, "image8011");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8061, "image8061");
   GLADE_HOOKUP_OBJECT (mainWindow, separator12, "separator12");
   GLADE_HOOKUP_OBJECT (mainWindow, rebuild_frames, "rebuild_frames");
   GLADE_HOOKUP_OBJECT (mainWindow, check_frames, "check_frames");
@@ -1507,6 +1512,8 @@
   GLADE_HOOKUP_OBJECT (mainWindow, separator13, "separator13");
   GLADE_HOOKUP_OBJECT (mainWindow, v2v, "v2v");
   GLADE_HOOKUP_OBJECT (mainWindow, ocr_vobsub_2_srt, "ocr_vobsub_2_srt");
+  GLADE_HOOKUP_OBJECT (mainWindow, separator17, "separator17");
+  GLADE_HOOKUP_OBJECT (mainWindow, see_hex1, "see_hex1");
   GLADE_HOOKUP_OBJECT (mainWindow, help1, "help1");
   GLADE_HOOKUP_OBJECT (mainWindow, help1_menu, "help1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, vcd1, "vcd1");
@@ -1517,34 +1524,34 @@
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8012, "image8012");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8062, "image8062");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_frame1, "previous_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8013, "image8013");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8063, "image8063");
   GLADE_HOOKUP_OBJECT (mainWindow, next_frame1, "next_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8014, "image8014");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8064, "image8064");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_intra_frame1, "previous_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8015, "image8015");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8065, "image8065");
   GLADE_HOOKUP_OBJECT (mainWindow, next_intra_frame1, "next_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8016, "image8016");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8066, "image8066");
   GLADE_HOOKUP_OBJECT (mainWindow, search_previous_black_frame1, "search_previous_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, search_next_black_frame1, "search_next_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, first_frame1, "first_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8017, "image8017");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8067, "image8067");
   GLADE_HOOKUP_OBJECT (mainWindow, last_frame1, "last_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8018, "image8018");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8068, "image8068");
   GLADE_HOOKUP_OBJECT (mainWindow, separator14, "separator14");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_a1, "go_to_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_b1, "go_to_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator15, "separator15");
   GLADE_HOOKUP_OBJECT (mainWindow, jum_to_frame1, "jum_to_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8019, "image8019");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8069, "image8069");
   GLADE_HOOKUP_OBJECT (mainWindow, jump_to_time1, "jump_to_time1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8020, "image8020");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8070, "image8070");
   GLADE_HOOKUP_OBJECT (mainWindow, custom1, "custom1");
   GLADE_HOOKUP_OBJECT (mainWindow, help2, "help2");
   GLADE_HOOKUP_OBJECT (mainWindow, help2_menu, "help2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, about1, "about1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8021, "image8021");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8071, "image8071");
   GLADE_HOOKUP_OBJECT (mainWindow, show_builtin_support1, "show_builtin_support1");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar2, "toolbar2");
   GLADE_HOOKUP_OBJECT (mainWindow, menutoolbuttonOpen, "menutoolbuttonOpen");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-25 19:19:15 UTC (rev 2968)
@@ -6,6 +6,7 @@
 
 
 */
+CALLBACK( see_hex1                              ,ACT_HEX_DUMP);
 CALLBACK( show_builtin_support1                 ,ACT_BUILT_IN);
 CALLBACK( open_video1         			,ACT_OpenAvi); 
 CALLBACK( append_video1     			,ACT_AppendAvi);

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-25 19:19:15 UTC (rev 2968)
@@ -166,9 +166,9 @@
 extern const char * GUI_getCustomScript(uint32_t nb);
 extern gboolean SliderIsShifted;
 
+void GUI_showCurrentFrameHex(void);
 
 
-
 //___________________________________________
 // serialization of user event throught gui
 //
@@ -827,6 +827,10 @@
 	}
       break;
 
+   case ACT_HEX_DUMP:
+      GUI_showCurrentFrameHex();
+      break;
+      
     default:
       printf ("\n unhandled action %d\n", action);
       ADM_assert (0);
@@ -2383,4 +2387,42 @@
   return 1; 
 }
 
+/**
+      \fn GUI_showCurrentFrameHex
+      \brief Display the first 32 bytes of the current frame in hex
+*/
+
+void GUI_showCurrentFrameHex(void)
+{
+#define DISPLAY_HEX 32
+ uint8_t *buffer;
+ uint32_t len,fullLen;
+ char     string[DISPLAY_HEX*3+6],*s;
+ char     title[80];
+ 
+ if (!avifileinfo) return;
+ 
+ buffer=new uint8_t [avifileinfo->width*avifileinfo->height*3];
+ video_body->getRaw (curframe, buffer, &fullLen);  
+ 
+ len=fullLen;
+ if(len>DISPLAY_HEX) len=DISPLAY_HEX;
+ s=string;
+ for(int i=0;i<len;i++)
+ {
+    sprintf(s,"%02x ",buffer[i]); 
+    s+=3;
+    if(i%8==7)
+    {
+      *s++='\n'; 
+    }
+    
+ }
+ *s=0;
+ sprintf(title,"Len: %u bytes\n",fullLen);
+ 
+ GUI_Info_HIG( ADM_LOG_IMPORTANT,title, string);
+ delete [] buffer;
+}
+
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-25 17:19:01 UTC (rev 2967)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-25 19:19:15 UTC (rev 2968)
@@ -187,6 +187,7 @@
 ACT_ZOOM_2_1,
 ACT_ZOOM_4_1,
 ACT_BUILT_IN,
+ACT_HEX_DUMP,
 ACT_CUSTOM_BASE,
 ACT_CUSTOM_END=ACT_CUSTOM_BASE+ADM_MAC_CUSTOM_SCRIPT,
 ACT_DUMMY



From mean at mail.berlios.de  Wed Apr 25 21:19:56 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 25 Apr 2007 21:19:56 +0200
Subject: [Avidemux-svn-commit] r2969 -
	branches/avidemux_2.4_branch/avidemux/ADM_editor
Message-ID: <200704251919.l3PJJu2w007689@sheep.berlios.de>

Author: mean
Date: 2007-04-25 21:19:55 +0200 (Wed, 25 Apr 2007)
New Revision: 2969

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
Log:
show extradata in all cases

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-25 19:19:15 UTC (rev 2968)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-25 19:19:55 UTC (rev 2969)
@@ -427,6 +427,19 @@
   // else update info
   _videos[_nb_video]._aviheader->getVideoInfo (&info);
   _videos[_nb_video]._aviheader->setMyName (name);
+  
+  // Printf some info about extradata
+  {
+    uint32_t l=0;
+    uint8_t *d=NULL;
+    _videos[_nb_video]._aviheader->getExtraHeaderData(&l,&d);
+    if(l && d)
+    {
+        printf("The video codec has some extradata (%d bytes)\n",l);
+        mixDump(d,l);
+        printf("\n");
+    }
+  }
   // 1st if it is our first video we update postproc
  if(!_nb_video)
  {



From mean at mail.berlios.de  Wed Apr 25 21:45:45 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 25 Apr 2007 21:45:45 +0200
Subject: [Avidemux-svn-commit] r2970 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704251945.l3PJjj3f009214@sheep.berlios.de>

Author: mean
Date: 2007-04-25 21:45:45 +0200 (Wed, 25 Apr 2007)
New Revision: 2970

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
Log:
ac3 and mp4 as default vfw, still incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-25 19:19:55 UTC (rev 2969)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-25 19:45:45 UTC (rev 2970)
@@ -42,10 +42,11 @@
 MKVCC mkvCC[]=
 {
   {"A_MPEG/L3",0,WAV_MP3,""},
+  {"A_AC3",0,WAV_AC3,""},
   
   // Video
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264
-  {"V_MS/VFW/FOURCC",1,0,"DIV3"}, // Divx 2.
+  {"V_MS/VFW/FOURCC",1,0,"DIVX"}, // Divx 2.
   
   
   // Filler



From mihailzenkov at mail.berlios.de  Thu Apr 26 14:28:08 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Thu, 26 Apr 2007 14:28:08 +0200
Subject: [Avidemux-svn-commit] r2971 -
	branches/avidemux_2.4_branch/avidemux/ADM_audio
Message-ID: <200704261228.l3QCS8tX002066@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-26 14:28:07 +0200 (Thu, 26 Apr 2007)
New Revision: 2971

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_a52info.cpp
Log:
fix ac3 input 2.1/3.1/etc

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_a52info.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_a52info.cpp	2007-04-25 19:45:45 UTC (rev 2970)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_a52info.cpp	2007-04-26 12:28:07 UTC (rev 2971)
@@ -13,6 +13,7 @@
 #include "config.h"
 #include <stdio.h>
 #include "default.h"
+#include <ADM_assert.h>
 #include "ADM_audio/ADM_a52info.h"
 
 #define A52_CHANNEL 0
@@ -120,28 +121,33 @@
 		}
 		printf("Sync found at offset %lu\n",of);
 		*syncoff=of;
-       		*fq=(uint32_t)ifq;
-       		*br=(uint32_t)ibr>>3;
-       		*chan=2;
-                if(flags == A52_3F2R+A52_LFE)
-                {
-                  *chan=6;
-                  return 1;
-                }
-                else
-                {
-                    flags=flags & A52_CHANNEL_MASK;
-                    #define LOOK(x,y) if(flags ==x) *chan=y;       
-          
-                    LOOK(A52_MONO,1);
-                    LOOK(A52_STEREO ,2);
-                    LOOK(A52_3F  ,3);
-                    LOOK(A52_2F1R,3);
-                    LOOK(A52_3F1R,4);
-                    LOOK(A52_2F2R,4);
-                    LOOK(A52_3F2R,5);
-                    return 1;
-                }
+		*fq=(uint32_t)ifq;
+		*br=(uint32_t)ibr>>3;
+		switch (flags & A52_CHANNEL_MASK) {
+			case A52_MONO:
+				*chan = 1;
+			break;
+			case A52_STEREO:
+			case A52_DOLBY:
+				*chan = 2;
+			break;
+			case A52_3F:
+			case A52_2F1R:
+				*chan = 3;
+			break;
+			case A52_3F1R:
+			case A52_2F2R:
+				*chan = 4;
+			break;
+			case A52_3F2R:
+				*chan = 5;
+			break;
+			default:
+				ADM_assert(0);
+		}
+		if (flags & A52_LFE)
+			(*chan)++;
+		return 1;
 	}
 	return 0;
 }



From mihailzenkov at mail.berlios.de  Thu Apr 26 16:21:28 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Thu, 26 Apr 2007 16:21:28 +0200
Subject: [Avidemux-svn-commit] r2972 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
Message-ID: <200704261421.l3QELSbU021205@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-26 16:21:27 +0200 (Thu, 26 Apr 2007)
New Revision: 2972

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp
Log:
DIA x264: AR as input

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp	2007-04-26 12:28:07 UTC (rev 2971)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp	2007-04-26 14:21:27 UTC (rev 2972)
@@ -23,6 +23,8 @@
 
 #include "ADM_assert.h" 
 
+#include "avidemutils.h"
+
 #ifdef USE_X264
 #include "ADM_video/ADM_genvideo.hxx"
 #include "ADM_encoder/ADM_vidEncode.hxx"
@@ -339,6 +341,11 @@
               param-> AR_Num=x264_ar[rank].num;
               param-> AR_Den=x264_ar[rank].den;
         }
+        if(RADIO_GET(radiobuttonAsInputAR))
+        {
+              param-> AR_Num=video_body->getPARWidth();
+              param-> AR_Den=video_body->getPARHeight();
+        }
 }
 
 GtkWidget*
@@ -387,10 +394,12 @@
   GtkWidget *entryAR_Num;
   GtkWidget *label53;
   GtkWidget *entryAR_Den;
+  GtkWidget *radiobuttonAsInputAR;
   GtkWidget *radiobuttonCustomAR;
   GSList *radiobuttonCustomAR_group = NULL;
   GtkWidget *radiobuttonPredefinedAR;
   GtkWidget *comboboxentry1;
+  GtkWidget *label40;
   GtkWidget *label39;
   GtkWidget *frame7;
   GtkWidget *alignment7;
@@ -818,6 +827,29 @@
   gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonPredefinedAR), radiobuttonCustomAR_group);
   radiobuttonCustomAR_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonPredefinedAR));
 
+  radiobuttonAsInputAR = gtk_radio_button_new_with_mnemonic (NULL, _("As input"));
+  gtk_widget_show (radiobuttonAsInputAR);
+  gtk_table_attach (GTK_TABLE (table35), radiobuttonAsInputAR, 0, 1, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_tooltips_set_tip (tooltips, radiobuttonAsInputAR, _("Get PAR from input video file"), NULL);
+  gtk_radio_button_set_group (GTK_RADIO_BUTTON (radiobuttonAsInputAR), radiobuttonCustomAR_group);
+  radiobuttonCustomAR_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (radiobuttonAsInputAR));
+
+  char text[80];
+  uint32_t war,har;
+  const char *s;
+  war=video_body->getPARWidth();
+  har=video_body->getPARHeight();
+  getAspectRatioFromAR(war,har, &s);
+  sprintf(text, " %s (%u:%u)", s,war,har);
+
+  label40 = gtk_label_new (text);
+  gtk_widget_show (label40);
+  gtk_table_attach (GTK_TABLE (table35), label40, 1, 2, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
   comboboxentry1 = gtk_combo_box_entry_new_text ();
   gtk_widget_show (comboboxentry1);
   gtk_table_attach (GTK_TABLE (table35), comboboxentry1, 1, 2, 0, 1,
@@ -1656,6 +1688,7 @@
   GLADE_HOOKUP_OBJECT (dialog1, entryAR_Den, "entryAR_Den");
   GLADE_HOOKUP_OBJECT (dialog1, radiobuttonCustomAR, "radiobuttonCustomAR");
   GLADE_HOOKUP_OBJECT (dialog1, radiobuttonPredefinedAR, "radiobuttonPredefinedAR");
+  GLADE_HOOKUP_OBJECT (dialog1, radiobuttonAsInputAR, "radiobuttonAsInputAR");
   GLADE_HOOKUP_OBJECT (dialog1, comboboxentry1, "comboboxentry1");
   GLADE_HOOKUP_OBJECT (dialog1, label39, "label39");
   GLADE_HOOKUP_OBJECT (dialog1, frame7, "frame7");



From mean at mail.berlios.de  Thu Apr 26 20:16:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 26 Apr 2007 20:16:58 +0200
Subject: [Avidemux-svn-commit] r2973 - in
	branches/avidemux_2.4_branch/avidemux: ADM_audiocodec
	ADM_inputs/ADM_matroska ADM_inputs/ADM_openDML ADM_video
Message-ID: <200704261816.l3QIGwZA019824@sheep.berlios.de>

Author: mean
Date: 2007-04-26 20:16:58 +0200 (Thu, 26 Apr 2007)
New Revision: 2973

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_reorderTemplate.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecac3.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reorder.cpp
Log:
allow reorder for mkv, dont crash in ac3dec

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecac3.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecac3.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecac3.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -108,7 +108,7 @@
         if(length==0)
         {
             printf("[a52] No startcode found\n");
-            ADM_assert(0); 
+            break;
         }
         if(length>nbIn)
         {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -93,6 +93,7 @@
   
   // Finaly update index with queue
   readCue(&ebml);
+    
   printf("[MKV]Matroska successfully read\n");
   
   return 1;
@@ -288,6 +289,7 @@
   _nbAudioTrack=0;
   _filename=NULL;
   memset(_tracks,0,sizeof(_tracks));
+  _reordered=0;
 }
 /*
     __________________________________________________________
@@ -355,4 +357,29 @@
                 *data=_tracks[0].extraData;
                 return 1;            
 }
+/*
+    __________________________________________________________
+*/
+uint8_t			mkvHeader::isReordered( void )
+{ 
+ 	return _reordered;
+}
+/*
+    __________________________________________________________
+*/
+uint8_t mkvHeader::reorder( void )
+{
+  
+#define INDEX_TMPL        mkvIndex
+#define INDEX_ARRAY_TMPL  (_tracks[0]._index)
+#define FRAMETYPE_TMPL    flags
+  
+#include "ADM_video/ADM_reorderTemplate.cpp"
+
+#undef INDEX_TMPL       
+#undef INDEX_ARRAY_TMPL 
+#undef FRAMETYPE_TMPL   
+     _tracks[0]._nbIndex=_videostream.dwLength;
+         return 1;
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-26 18:16:58 UTC (rev 2973)
@@ -79,8 +79,8 @@
 
     
     uint32_t                _nbAudioTrack;
+    uint32_t                _reordered;
     
-    
     uint8_t                 checkHeader(void *head,uint32_t headlen);
     uint8_t                 analyzeTracks(void *head,uint32_t headlen);
     uint8_t                 analyzeOneTrack(void *head,uint32_t headlen);
@@ -126,7 +126,9 @@
     virtual uint8_t  getFrameNoAlloc(uint32_t framenum,ADMCompressedImage *img);
 
             uint8_t  getExtraHeaderData(uint32_t *len, uint8_t **data);
-    
+            uint8_t  isReordered( void );
+            uint8_t  reorder( void );
+
 };
 #endif
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -113,9 +113,25 @@
         _video_bih.biWidth=_mainaviheader.dwWidth=entry.w;
         _video_bih.biHeight=_mainaviheader.dwHeight=entry.h;
         _videostream.fccHandler=_video_bih.biCompression=entry.fcc;
+        
+        // if it is vfw...
+        if(fourCC::check(entry.fcc,(uint8_t *)"VFWX") && entry.extraData && entry.extraDataLen>=sizeof(BITMAPINFOHEADER))
+        {
+          memcpy(& _video_bih,entry.extraData,sizeof(BITMAPINFOHEADER));
+          delete [] _tracks[0].extraData;
+          entry.extraData=NULL;
+          entry.extraDataLen=0;
+          
+          _videostream.fccHandler=_video_bih.biCompression;
+          _mainaviheader.dwWidth=  _video_bih.biWidth;
+          _mainaviheader.dwHeight= _video_bih.biHeight;    
+          
+        } // FIXME there can be real extradata after bitmapinfoheader
+        
         _tracks[0].extraData=entry.extraData; 
         _tracks[0].extraDataLen=entry.extraDataLen;       
         _tracks[0].streamIndex=entry.trackNo;
+        
         return 1;
       }
       if(entry.trackType==2 && _nbAudioTrack<ADM_MKV_MAX_TRACKS)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -46,7 +46,7 @@
   
   // Video
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264
-  {"V_MS/VFW/FOURCC",1,0,"DIVX"}, // Divx 2.
+  {"V_MS/VFW/FOURCC",1,0,"VFWX"}, // Divx 2.
   
   
   // Filler

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reorder.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reorder.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reorder.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -44,73 +44,15 @@
 
 uint8_t OpenDMLHeader::reorder( void )
 {
-odmlIndex *index;
-uint8_t ret=1;
-uint32_t nbFrame= _videostream.dwLength;
-	// already done..
-	if( _reordered) return 1;
-	ADM_assert(_idx);
-	
-	index=new odmlIndex[nbFrame];
-	// clear B frame flag for last frames
-	_idx[nbFrame-1].intra &=~AVI_B_FRAME;
+  
+#define INDEX_TMPL        odmlIndex
+#define INDEX_ARRAY_TMPL  _idx
+#define FRAMETYPE_TMPL    intra
+  
+#include "ADM_video/ADM_reorderTemplate.cpp"
 
-			//__________________________________________
-			// the direct index is in DTS time (i.e. decoder time)
-			// we will now do the PTS index, so that frame numbering is done
-			// according to the frame # as they are seen by editor / user
-			// I1 P0 B0 B1 P1 B2 B3 I2 B7 B8
-			// xx I1 B0 B1 P0 B2 B3 P1 B7 B8
-			//__________________________________________
-			uint32_t forward=0;
-			uint32_t curPTS=0;
-			uint32_t dropped=0;
-
-			for(uint32_t c=1;c<nbFrame;c++)
-			{
-				if(!(_idx[c].intra & AVI_B_FRAME))
-					{
-								memcpy(&index[curPTS],
-										&_idx[forward],
-										sizeof(odmlIndex));
-								forward=c;
-								curPTS++;
-								dropped++;
-					}
-					else
-					{// we need  at lest 2 i/P frames to start decoding B frames
-						if(dropped>=1)
-						{
-							memcpy(&index[curPTS],
-								&_idx[c],
-								sizeof(odmlIndex));
-							curPTS++;
-						}
-						else
-						{
-						printf("We dropped a frame (%d/%d).\n",dropped,c);
-						}
-					}
-			}
-
-			uint32_t last;
-
-
-			// put back last I/P we had in store
-			memcpy(&index[curPTS],
-				&_idx[forward],
-				sizeof(odmlIndex));
-			last=curPTS;
-
-			_videostream.dwLength= _mainaviheader.dwTotalFrames=nbFrame=last+1;
-			// last frame is always I
-
-			delete [] _idx;
-
-			_idx=index;;
-			// last frame cannot be B frame
-			_idx[last].intra&=~AVI_B_FRAME;
-			 _reordered=ret;
-			return ret;
-
+#undef INDEX_TMPL       
+#undef INDEX_ARRAY_TMPL 
+#undef FRAMETYPE_TMPL   
+             
 }

Added: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_reorderTemplate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_reorderTemplate.cpp	2007-04-26 14:21:27 UTC (rev 2972)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_reorderTemplate.cpp	2007-04-26 18:16:58 UTC (rev 2973)
@@ -0,0 +1,82 @@
+/*
+ * INDEX_TMPL is the type of each index
+ * INDEX_ARRAY_TMPL is the attribute holding the index
+ * FRAMETYPE_TMPL is the field holding video flags
+ * */
+#ifndef INDEX_TMPL
+#error INDEX_TMPL
+#endif
+#ifndef INDEX_ARRAY_TMPL
+#error INDEX_ARRAY_TMPL
+#endif
+#ifndef FRAMETYPE_TMPL
+#error FRAMETYPE_TMPL
+#endif
+
+INDEX_TMPL *index;
+uint8_t ret=1;
+uint32_t nbFrame= _videostream.dwLength;
+	// already done..
+	if( _reordered) return 1;
+	ADM_assert(INDEX_ARRAY_TMPL);
+	
+	index=new INDEX_TMPL[nbFrame];
+	// clear B frame flag for last frames
+	INDEX_ARRAY_TMPL[nbFrame-1].FRAMETYPE_TMPL &=~AVI_B_FRAME;
+
+			//__________________________________________
+			// the direct index is in DTS time (i.e. decoder time)
+			// we will now do the PTS index, so that frame numbering is done
+			// according to the frame # as they are seen by editor / user
+			// I1 P0 B0 B1 P1 B2 B3 I2 B7 B8
+			// xx I1 B0 B1 P0 B2 B3 P1 B7 B8
+			//__________________________________________
+			uint32_t forward=0;
+			uint32_t curPTS=0;
+			uint32_t dropped=0;
+
+			for(uint32_t c=1;c<nbFrame;c++)
+			{
+				if(!(INDEX_ARRAY_TMPL[c].FRAMETYPE_TMPL & AVI_B_FRAME))
+					{
+								memcpy(&index[curPTS],
+										&INDEX_ARRAY_TMPL[forward],
+										sizeof(INDEX_TMPL));
+								forward=c;
+								curPTS++;
+								dropped++;
+					}
+					else
+					{// we need  at lest 2 i/P frames to start decoding B frames
+						if(dropped>=1)
+						{
+							memcpy(&index[curPTS],
+								&INDEX_ARRAY_TMPL[c],
+								sizeof(INDEX_TMPL));
+							curPTS++;
+						}
+						else
+						{
+						printf("We dropped a frame (%d/%d).\n",dropped,c);
+						}
+					}
+			}
+
+			uint32_t last;
+
+
+			// put back last I/P we had in store
+			memcpy(&index[curPTS],
+				&INDEX_ARRAY_TMPL[forward],
+				sizeof(INDEX_TMPL));
+			last=curPTS;
+
+			_videostream.dwLength= _mainaviheader.dwTotalFrames=nbFrame=last+1;
+			// last frame is always I
+
+			delete [] INDEX_ARRAY_TMPL;
+
+			INDEX_ARRAY_TMPL=index;;
+			// last frame cannot be B frame
+			INDEX_ARRAY_TMPL[last].FRAMETYPE_TMPL&=~AVI_B_FRAME;
+			 _reordered=ret;



From mean at mail.berlios.de  Thu Apr 26 21:29:49 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 26 Apr 2007 21:29:49 +0200
Subject: [Avidemux-svn-commit] r2974 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704261929.l3QJTnEV026568@sheep.berlios.de>

Author: mean
Date: 2007-04-26 21:29:48 +0200 (Thu, 26 Apr 2007)
New Revision: 2974

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
Log:
added readFloat so that we have the correct fq

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-26 18:16:58 UTC (rev 2973)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-26 19:29:48 UTC (rev 2974)
@@ -182,9 +182,9 @@
         case  MKV_TRACK_NUMBER: entry->trackNo=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TYPE: entry->trackType=father.readUnsignedInt(len);break;
         case  MKV_FRAME_DEFAULT_DURATION:entry->defaultDuration=father.readUnsignedInt(len);break;
-        // FIXME 
-        case  MKV_AUDIO_FREQUENCY: entry->fq=48000;father.skip(len);break;
-        // FIXME
+
+        case  MKV_AUDIO_FREQUENCY: entry->fq=(uint32_t)floor(father.readFloat(len));break;
+
         case  MKV_VIDEO_WIDTH: entry->w=father.readUnsignedInt(len);break;
         case  MKV_VIDEO_HEIGHT: entry->h=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TIMECODESCALE:father.skip(len);break; //FIXME

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-26 18:16:58 UTC (rev 2973)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-26 19:29:48 UTC (rev 2974)
@@ -217,17 +217,19 @@
   ADM_MKV_TYPE type;
   const char *ss;
   uint64_t time;
+  uint64_t segmentPos;
   
    parser->seek(0);
    
-   if(!parser->find(ADM_MKV_PRIMARY,MKV_SEGMENT,MKV_CLUSTER,&vlen))
+   if(!parser->simplefind(MKV_SEGMENT,&vlen,1))
    {
      printf("[MKV] Cannot find CLUSTER atom\n");
      return 0;
    }
    ADM_ebml_file segment(parser,vlen);
+   segmentPos=segment.tell();
    
-   while(segment.find(ADM_MKV_PRIMARY,MKV_CUES,MKV_CLUSTER,&alen,0))
+   while(segment.simplefind(MKV_CUES,&alen,0))
   {
    ADM_ebml_file cues(&segment,alen);
    while(!cues.finished())
@@ -283,7 +285,8 @@
                  continue;
          }
        }
-       printf("Track %u Position 0x%llx time %llu\n",tid,cluster_position,time);
+       printf("Track %u Position 0x%llx time %llu final pos:%llx \n",tid,cluster_position,time,
+             cluster_position+segmentPos );
      }
    }
    printf("[MKV] Cues updated\n");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-26 18:16:58 UTC (rev 2973)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-26 19:29:48 UTC (rev 2974)
@@ -32,6 +32,13 @@
 #else
 #define vprintf(...) {}
 #endif
+
+extern "C"
+{
+  double av_int2dbl(int64_t v);
+  float av_int2flt(int32_t v);
+}
+
 /*
   It is slow , optimize later
 */  
@@ -161,6 +168,29 @@
     readBin(v,2);
     return (uint16_t)(v[0]<<8)+v[1];
 }
+/**
+*/
+float       ADM_ebml::readFloat(uint32_t n)
+{
+  if(n!=4 && n!=8) ADM_assert(0);
+  
+  switch(n)
+  {
+    case 4:
+    {
+        uint32_t u4=readUnsignedInt(4);
+        return av_int2flt(u4);
+      }
+    case 8:
+    {
+        uint64_t u8=readUnsignedInt(8);
+        return  av_int2dbl(u8);
+    }
+    default:
+        ADM_assert(0);
+  }
+}
+
 ADM_ebml::ADM_ebml(void)
 {
   
@@ -282,14 +312,13 @@
   uint64_t id,alen;
   ADM_MKV_TYPE type;
   const char *ss;
-  uint64_t pos;
+  
 
     vprintf("[MKV] Simple Searching for tag %llx\n",prim);
     if(rewind) seek(_begin);
    
       while(!finished())
       {
-          
           readElemId(&id,&alen);
           if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
           {



From mihailzenkov at mail.berlios.de  Fri Apr 27 10:17:14 2007
From: mihailzenkov at mail.berlios.de (mihailzenkov at BerliOS)
Date: Fri, 27 Apr 2007 10:17:14 +0200
Subject: [Avidemux-svn-commit] r2976 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_encoder
	ADM_userInterfaces/ADM_GTK/ADM_dialog
Message-ID: <200704270817.l3R8HEPd028351@sheep.berlios.de>

Author: mihailzenkov
Date: 2007-04-27 10:17:13 +0200 (Fri, 27 Apr 2007)
New Revision: 2976

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264param.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp
Log:
save x264 asinput param

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-04-26 23:33:13 UTC (rev 2975)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-04-27 08:17:13 UTC (rev 2976)
@@ -31,6 +31,7 @@
 };
 #include "ADM_osSupport/ADM_cpuCap.h"
 #include <ADM_assert.h>
+#include "avi_vars.h"
 
 #define HANDLE ((x264_t *)_handle)
 #define PICS ((x264_picture_t *)_pic)
@@ -75,10 +76,15 @@
 
 #define MKPARAM(x,y) {param.x = zparam->y;printf(#x" = %d\n",param.x);}
 #define MKPARAMF(x,y) {param.x = (float)zparam->y / 100; printf(#x" = %.2f\n",param.x);}
-  
-  MKPARAM(vui.i_sar_width , AR_Num);	// FIXME
-  MKPARAM(vui.i_sar_height, AR_Den);
 
+  if (zparam->AR_AsInput) {
+    param.vui.i_sar_width = video_body->getPARWidth();
+    param.vui.i_sar_height = video_body->getPARHeight();
+  } else {
+    MKPARAM(vui.i_sar_width , AR_Num);	// FIXME
+    MKPARAM(vui.i_sar_height, AR_Den);
+  }
+
   param.i_fps_num = fps1000;
   param.i_fps_den = 1000;
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264param.h	2007-04-26 23:33:13 UTC (rev 2975)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264param.h	2007-04-27 08:17:13 UTC (rev 2976)
@@ -51,6 +51,7 @@
   uint32_t Method;
   uint32_t AR_Num;
   uint32_t AR_Den;
+  uint8_t  AR_AsInput;
   uint32_t DeblockingFilter;
   int32_t  Strength;
   int32_t  Threshold;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-04-26 23:33:13 UTC (rev 2975)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-04-27 08:17:13 UTC (rev 2976)
@@ -624,6 +624,7 @@
 1,//     uint32_t Method;
 1,//     uint32_t AR_Num;
 1,//     uint32_t AR_Den;
+0,//     uint8_t AR_AsInput;
 1,//     uint32_t DeblockingFilter;
 0,//     int32_t  Strength;
 0,//     int32_t  Threshold;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp	2007-04-26 23:33:13 UTC (rev 2975)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp	2007-04-27 08:17:13 UTC (rev 2976)
@@ -321,6 +321,7 @@
 #undef CHECK
 #undef ENTRY
 #undef PSEUDO
+	RADIO_SET(radiobuttonAsInputAR, param->AR_AsInput);
 }
 void download(GtkWidget *dialog,ADM_x264Param *param)
 {
@@ -341,11 +342,7 @@
               param-> AR_Num=x264_ar[rank].num;
               param-> AR_Den=x264_ar[rank].den;
         }
-        if(RADIO_GET(radiobuttonAsInputAR))
-        {
-              param-> AR_Num=video_body->getPARWidth();
-              param-> AR_Den=video_body->getPARHeight();
-        }
+        param->AR_AsInput = RADIO_GET(radiobuttonAsInputAR);
 }
 
 GtkWidget*



From mean at mail.berlios.de  Fri Apr 27 22:48:09 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 27 Apr 2007 22:48:09 +0200
Subject: [Avidemux-svn-commit] r2977 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704272048.l3RKm9N1005416@sheep.berlios.de>

Author: mean
Date: 2007-04-27 22:48:08 +0200 (Fri, 27 Apr 2007)
New Revision: 2977

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
Log:
better way of handling audio, still incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-27 20:48:08 UTC (rev 2977)
@@ -78,6 +78,12 @@
     printf("[MKV] No video\n");
     return 0;
   }
+  printf("[MKV] Indexing clusters\n");
+  if(!indexClusters(&ebml))
+  {
+    printf("[MKV] Cluster indexing failed\n");
+    return 0;
+  }
   printf("[MKV] Indexing video\n");
     if(!videoIndexer(&ebml))
     {
@@ -92,7 +98,7 @@
   _filename=ADM_strdup(name);
   
   // Finaly update index with queue
-  readCue(&ebml);
+  // Useless.....readCue(&ebml);
     
   printf("[MKV]Matroska successfully read\n");
   
@@ -213,7 +219,7 @@
 {
   if(_nbAudioTrack)
   {
-      *audio=new mkvAudio(_filename,&(_tracks[1]));
+      *audio=new mkvAudio(_filename,&(_tracks[1]),_clusters,_nbClusters);
       return 1;
   }
   *audio=NULL;
@@ -241,6 +247,11 @@
 
 uint8_t mkvHeader::close(void)
 {
+  if(_clusters)
+  {
+    delete [] _clusters;
+    _clusters=NULL; 
+  }
   // CLEANUP!!
   if(_parser) delete _parser;
   _parser=NULL;
@@ -290,6 +301,10 @@
   _filename=NULL;
   memset(_tracks,0,sizeof(_tracks));
   _reordered=0;
+  
+  _clusters=NULL;
+  _clustersCeil=0;
+  _nbClusters=0;
 }
 /*
     __________________________________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-27 20:48:08 UTC (rev 2977)
@@ -32,7 +32,7 @@
     uint32_t flags;
     uint32_t timeCode;
 };
-
+//**********************************************
 typedef struct mkvTrak
 {
   /* Index in mkv */
@@ -48,16 +48,31 @@
   mkvIndex  *_index;
   uint32_t  _nbIndex;  // current size of the index
   uint32_t  _indexMax; // Max size of the index
+  uint32_t  _sizeInBytes; // Approximate size in bytes of that stream
 };
+
+#define MKV_MAX_LACES 20 // ?
+//**********************************************
 class mkvAudio : public AVDMGenericAudioStream
 {
   protected:
     mkvTrak                     *_track;
     ADM_ebml_file               *_parser;
-    uint32_t                    _index;
-    uint32_t                    _offset;
+    ADM_ebml_file               *_clusterParser;
+    mkvIndex                    *_clusters;
+    uint32_t                    _nbClusters;
+    uint32_t                    _currentCluster;
+    
+    uint32_t                    _currentLace;
+    uint32_t                    _maxLace;
+    uint32_t                    _Laces[MKV_MAX_LACES];
+
+    uint8_t                     goToCluster(uint32_t x);
+    
   public:
-                                mkvAudio(const char *name,mkvTrak *track);
+                                mkvAudio(const char *name,mkvTrak *track,mkvIndex *clust,uint32_t nbClusters);
+                                
+                                
     virtual                     ~mkvAudio();
     virtual uint32_t            read(uint32_t len,uint8_t *buffer);
     virtual uint8_t             goTo(uint32_t newoffset);
@@ -77,7 +92,10 @@
     char                    *_filename;
     mkvTrak                 _tracks[ADM_MKV_MAX_TRACKS+1];
 
-    
+    mkvIndex                    *_clusters;
+    uint32_t                    _nbClusters;
+    uint32_t                    _clustersCeil;
+ 
     uint32_t                _nbAudioTrack;
     uint32_t                _reordered;
     
@@ -88,10 +106,12 @@
     int                     searchTrackFromTid(uint32_t tid);
     
     // Indexers
-    uint8_t                 addVideoEntry(uint64_t where, uint32_t size);
-    uint8_t                 addVideoEntry(uint32_t track,uint64_t where, uint32_t size);
+    
+    uint8_t                 addIndexEntry(uint32_t track,uint64_t where, uint32_t size,uint32_t flags);
     uint8_t                 videoIndexer(ADM_ebml_file *parser);
     uint8_t                 readCue(ADM_ebml_file *parser);
+    uint8_t                 indexClusters(ADM_ebml_file *parser);
+    uint8_t                 indexBlock(ADM_ebml_file *parser,uint32_t count);
   public:
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-27 20:48:08 UTC (rev 2977)
@@ -52,23 +52,14 @@
     _tracks[i]._index=new mkvIndex[_tracks[i]._indexMax];
    }
     //************
-   
-   if(!parser->find(ADM_MKV_PRIMARY,MKV_SEGMENT,MKV_CLUSTER,&vlen))
+   for(int clusters=0;clusters<_nbClusters;clusters++)
    {
-     printf("[MKV] Cannot find CLUSTER atom\n");
-     return 0;
-   }
-  
-  ADM_ebml_file segment(parser,vlen);
-  printf("[MKV] Segment found at %llx (size %llx)\n",segment.tell(),vlen);
-  
-  //while FIXME LOOP ON ALL CLUSTER!
-  while(segment.find(ADM_MKV_PRIMARY,MKV_CLUSTER,MKV_CLUSTER,&alen,0))
-  {
-  //  printf("[MKV] Beginning new cluster at 0x%llx\n",segment.tell());
-   ADM_ebml_file cluster(&segment,alen);
+   parser->seek(_clusters[clusters].pos);
+   ADM_ebml_file cluster(parser,_clusters[clusters].size);
+   int thiscluster=0;
    while(!cluster.finished())
    {
+      
       cluster.readElemId(&id,&len);
       if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
       {
@@ -106,50 +97,14 @@
                                   default: blockGroup.skip(len);
                                   case MKV_BLOCK : 
                                   {
-                                    // Read Track id 
-                                      uint32_t tid=blockGroup.readEBMCode();
-                                      int track=searchTrackFromTid(tid);
-                                      //printf("Wanted %u got %u\n",_tracks[0].streamIndex,tid);
-                                      if(track==-1)
-                                      {
-                                        blockGroup.skip(blockGroup.remaining());
-                                        break;  // Not our track
-                                      }
-                                      // Skip timecode
-                                      blockGroup.skip(2); // Timecode
-                                      uint8_t flags=blockGroup.readu8();
-                                      uint32_t remaining=blockGroup.remaining();
-                                      lacing=((flags>>1)&3);
-                                      switch(lacing)
-                                      {
-                                        case 0: // No lacing
-                                              addVideoEntry(track,blockGroup.tell(),remaining);
-                                              break;
-                                        case 2 : // Constant size lacing
-                                            {
-                                                    nbLaces=blockGroup.readu8()+1;
-                                                    remaining--;
-                                                    // Only mp3/Ac3 supported, ignore lacing FIXME : Vorbis or AAC will not work
-                                                    addVideoEntry(track,blockGroup.tell(),remaining);
-                                                    int bsize=remaining/nbLaces;
-                                                    if(bsize*nbLaces!=remaining)
-                                                    {
-                                                      printf("Warning not multiple bsize=%d total=%u  nbLaces=%u\n",bsize,remaining,nbLaces);
-                                                    }
-                                                    if(!track) printf("Warning lacing on video track\n");
-                                                    //printf("tid:%u track %u Remaining : %llu laces %u blksize %d er%d\n",tid,track,remaining,nbLaces,remaining/nbLaces,remaining-(remaining/nbLaces)*nbLaces);
-                                            } 
-                                        break;
-                                        default: 
-                                            printf("unsupported lacing\n");
-                                            break;
-                                      }
-                                      blockGroup.skip(remaining);
-                                      break;
-                                  }
+                                    indexBlock(&blockGroup,thiscluster);
+                                    
+                                  }         
                                 }
                           }
+                          thiscluster++;
             }
+            
             break; // Block Group
        }
      }
@@ -159,15 +114,68 @@
      return 1;
 }
 /**
+      \fn indexBlock
+      \brief index a block, identify it and update index
+*/
+uint8_t mkvHeader::indexBlock(ADM_ebml_file *parser,uint32_t count)
+{
+  int lacing,nbLaces,entryFlags;
+  // Read Track id 
+  uint32_t tid=parser->readEBMCode();
+  int track=searchTrackFromTid(tid);
+      //printf("Wanted %u got %u\n",_tracks[0].streamIndex,tid);
+      if(track!=0)
+      {
+        uint32_t remaining=parser->remaining();
+        if(track!=-1)
+        {
+          _tracks[track]._sizeInBytes+=remaining; // keep some stat, useful for audio
+        }
+        parser->skip(remaining);
+        return 1; // we do only video here...
+      }
+      // Skip timecode
+      parser->skip(2); // Timecode FIXME Timecode
+      uint8_t flags=parser->readu8();
+      uint32_t remaining=parser->remaining();
+      lacing=((flags>>1)&3);
+      switch(lacing)
+      {
+        case 0: // No lacing
+              
+              addIndexEntry(track,parser->tell(),remaining,entryFlags);
+              break;
+        case 2 : // Constant size lacing
+            {
+                    nbLaces=parser->readu8()+1;
+                    remaining--;
+                    // Only mp3/Ac3 supported, ignore lacing FIXME : Vorbis or AAC will not work
+                    addIndexEntry(track,parser->tell(),remaining,0);
+                    int bsize=remaining/nbLaces;
+                    if(bsize*nbLaces!=remaining)
+                    {
+                      printf("Warning not multiple bsize=%d total=%u  nbLaces=%u\n",bsize,remaining,nbLaces);
+                    }
+                    if(!track) printf("Warning lacing on video track\n");
+                    //printf("tid:%u track %u Remaining : %llu laces %u blksize %d er%d\n",tid,track,remaining,nbLaces,remaining/nbLaces,remaining-(remaining/nbLaces)*nbLaces);
+            } 
+            break;
+        default: 
+            printf("unsupported lacing\n");
+            break;
+      }
+      parser->skip(remaining);
+      return 1;
+}
+
+/**
     \fn addVideoEntry
     \brief add an entry to the video index
 */
-uint8_t mkvHeader::addVideoEntry(uint32_t track,uint64_t where, uint32_t size)
+uint8_t mkvHeader::addIndexEntry(uint32_t track,uint64_t where, uint32_t size,uint32_t flags)
 {
   //
   mkvTrak *Track=&(_tracks[track]);
-  
-  
   // Need to grow index ?
   if(Track->_nbIndex==Track->_indexMax-1)
   {
@@ -183,7 +191,7 @@
   int x=Track->_nbIndex;
   index[x].pos=where;
   index[x].size=size;
-  index[x].flags=0;
+  index[x].flags=flags;
   index[x].timeCode=0;
   Track->_nbIndex++;
  // printf("++\n");
@@ -292,4 +300,67 @@
    printf("[MKV] Cues updated\n");
    return 1;  
 }
+/**
+        \fn indexClusters
+        \brief make a list of all clusters with there position & size
+*/
+uint8_t   mkvHeader::indexClusters(ADM_ebml_file *parser)
+{
+  uint64_t fileSize,len,bsize;
+  uint32_t alen,vlen;
+  uint64_t id;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  uint64_t time;
+  uint64_t pos;
+
+#define NB_DEFAULT_CLUSTERS 10
+  // Allocate some clusters
+  _clusters=new mkvIndex[NB_DEFAULT_CLUSTERS];
+  _clustersCeil=NB_DEFAULT_CLUSTERS;
+  _nbClusters=0;
+  
+  // Search segment
+   parser->seek(0);
+   if(!parser->simplefind(MKV_SEGMENT,&vlen,1))
+   {
+     printf("[MKV] cluster indexer, cannot find CLUSTER atom\n");
+     return 0;
+   }
+   ADM_ebml_file segment(parser,vlen);
+   
+   while(segment.simplefind(MKV_CLUSTER,&alen,0)) 
+   {
+     // Grow clusters index if needed
+     if(_nbClusters==_clustersCeil-1)
+     {
+         mkvIndex *dx=new mkvIndex[_clustersCeil*2];
+         memcpy(dx,_clusters,sizeof(mkvIndex)*_nbClusters);
+         delete [] _clusters;
+         _clusters=dx;
+         _clustersCeil*=2;
+     }
+     _clusters[_nbClusters].pos=segment.tell();
+     _clusters[_nbClusters].size=alen;
+     
+     // Normally the timecode is the 1st one following 
+       segment.readElemId(&id,&len);
+       int seekme=_nbClusters;
+       if(id!=MKV_TIMECODE)
+       {
+          ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type);
+          printf("[MKV] Cluster : no time code Found %s(0x%x), expected MKV_TIMECODE  (0x%x)\n",
+                  ss,id,MKV_TIMECODE);
+       } 
+       else
+       {
+           uint64_t timecode=segment.readUnsignedInt(len);
+           _clusters[_nbClusters].timeCode=timecode;
+           _nbClusters++;
+       }
+       segment.seek( _clusters[seekme].pos+ _clusters[seekme].size);
+   }
+   printf("[MKV] Found %u clusters\n",_nbClusters);
+   return 1;
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-27 20:48:08 UTC (rev 2977)
@@ -42,7 +42,8 @@
 MKVCC mkvCC[]=
 {
   {"A_MPEG/L3",0,WAV_MP3,""},
-  {"A_AC3",0,WAV_AC3,""},
+  {"A_AC3",0,WAV_AC3,""}, 
+  {"A_AAC/MPEG2/LC",0,WAV_AAC,""},
   
   // Video
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-27 20:48:08 UTC (rev 2977)
@@ -29,6 +29,7 @@
 
 #include "ADM_mkv.h"
 
+#define vprintf(...) {}
 
 /**
     \fn ~mkvAudio
@@ -38,68 +39,24 @@
 {
   if(_parser) delete _parser;
   _parser=NULL; 
-  _offset=0;
-  _index=0;
+  if(_clusterParser)  delete _clusterParser;
+  _clusterParser=NULL;
 }
 
 uint32_t    mkvAudio::read(uint32_t len,uint8_t *buffer)
 {
-  uint32_t red=0;
-  while(1)
-  {
-    //********************************************
-    if(_index>=_track->_nbIndex)
-    {
-      return red; 
-    }
-    //********************************************
-    if(len+_offset <=_track->_index[_index].size)
-    {
-      _parser->readBin(buffer,len);
-      _offset+=len;
-      red+=len;
-      return red; 
-    }
-    // empty...
-    //********************************************
-    int32_t remaining=_track->_index[_index].size-_offset;
-    ADM_assert(remaining>=0);
-    
-    _parser->readBin(buffer,remaining);
-    red+=remaining;
-    len-=remaining;
-    buffer+=remaining;
-    _index++;
-    if(_index>=_track->_nbIndex)
-    {
-      return red; 
-    }
-    _parser->seek(_track->_index[_index].pos);
-    _offset=0;
-  }
+  uint32_t l,sam;
+  if(!getPacket(buffer, &l, &sam)) return 0;
+  return l;
 }
 /**
       \fn goTo
 */
 uint8_t             mkvAudio::goTo(uint32_t newoffset)
 {
-  uint32_t cumul=0;
-  for(int i=0;i<_track->_nbIndex;i++)
-  {
-    if(newoffset>=cumul && newoffset<=cumul+_track->_index[i].size)
-    {
-      _offset=0;
-      _index=i;
-      _parser->seek(_track->_index[_index].pos);
-      return 1;
-    }
-    cumul+=_track->_index[i].size;
-  }
-  // 
-  printf("[Mkv audio] Goto failed\n");
-  _parser->seek(_track->_index[0].pos);
-    _offset=0;
-    _index=0;
+  goToCluster(0);
+  _currentCluster=0;
+  return 1;
 }
 /**
       \fn extraData
@@ -112,30 +69,187 @@
 /**
     \fn getPacket
 */
-uint8_t             mkvAudio::getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples)
+uint8_t             mkvAudio::getPacket(uint8_t *dest, uint32_t *packlen, uint32_t *samples)
 {
-    *samples=1152;
-    *len=read(384,dest);
-    if(*len) return 1;
-    return 0;
+  uint64_t fileSize,len,bsize,pos;
+  uint32_t alen,vlen;
+  uint64_t id;
+  ADM_MKV_TYPE type;
+  const char *ss;
+  vprintf("Enter: Currently at :%llx\n",_clusterParser->tell());
+    // Have we still lace to go ?
+    if(_currentLace<_maxLace)
+    {
+      _clusterParser->readBin(dest,_Laces[_currentLace]);
+      *packlen= _Laces[_currentLace];
+      vprintf("Continuing lacing : %u bytes, lacing %u/%u\n",*packlen,_currentLace,_maxLace);
+      _currentLace++;
+      *samples=1024; // FIXME
+      
+      return 1;
+    }
+    while(1)
+    {
+        vprintf("While: Currently at :%llx\n",_clusterParser->tell());
+        // need to switch cluster ?
+        if(_clusterParser->finished())
+        {
+          if(!goToCluster(_currentCluster+1))
+          {
+            printf("[MKVAUDIO] cannot go to next cluster\n");
+            return 0; 
+          }
+          _currentCluster++;
+        }
+        // Ok read a new block
+        while(!_clusterParser->finished())
+        {
+          
+            _clusterParser->readElemId(&id,&len);
+            pos=_clusterParser->tell();
+            if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
+            {
+              vprintf("[MKVAUDIO] unknown tag %x\n",id);
+              _clusterParser->skip(len);
+              continue;
+            }
+            
+            vprintf("[MKVAudio]Found tag %x (%s) at 0x%llx len %u\n",id,ss,_clusterParser->tell(),len);
+            
+            switch(id)
+            {
+              default:
+              case MKV_TIMECODE:     _clusterParser->skip(len);  break;
+              case MKV_BLOCK_GROUP:    break;
+              case MKV_BLOCK: 
+              {
+                  uint32_t tid=_clusterParser->readEBMCode();
+                  len--; // ASSUME TRACK FITS ON 1 BYTE!
+                    vprintf("Tid = %u, my tid=%u\n",tid,_track->streamIndex);
+                  if(tid!=_track->streamIndex)
+                    {
+                      _clusterParser->skip(len); // skip this block
+                      break; // not our track
+                    }
+                    // Skip timecode
+                    _clusterParser->skip(2); // Timecode FIXME Timecode
+                    len-=2;
+                    uint8_t flags=_clusterParser->readu8();
+                    len--;
+                    uint32_t remaining=len;
+                    uint32_t lacing=((flags>>1)&3);
+                    switch(lacing)
+                    {
+                      case 0 : // no lacing 
+                          
+                              vprintf("No lacing :%d bytes\n",remaining);
+                              _clusterParser->readBin(dest,remaining);
+                              *packlen=remaining; 
+                              *samples=1024; // FIXME
+                              _currentLace=_maxLace=0;
+                              return 1;
+                      case 2 : // constant size lacing
+                              {
+                                int nbLaces=_clusterParser->readu8()+1;
+                                
+                                remaining--;
+                                int bsize=remaining/nbLaces;
+                                vprintf("NbLaces :%u lacesize:%u\n",nbLaces,bsize);
+                                ADM_assert(nbLaces<MKV_MAX_LACES);
+                                for(int i=0;i<nbLaces;i++)
+                                {
+                                  _Laces[i]=bsize; 
+                                }
+                                _currentLace=0;
+                                _maxLace=nbLaces;
+                                return getPacket(dest, packlen, samples);
+                              }
+                      case 3: // Ebml lacing
+                        {
+                                int nbLaces=_clusterParser->readu8()+1;
+                                int32_t curSize=_clusterParser->readEBMCode();
+                                int32_t delta;
+                                printf("Ebml nbLaces :%u lacesize(0):%u\n",nbLaces,curSize);
+                                _Laces[0]=curSize;
+                                len-=curSize;
+                                ADM_assert(nbLaces<MKV_MAX_LACES);
+                                for(int i=1;i<nbLaces-1;i++)
+                                {
+                                  delta=_clusterParser->readEBMCode_Signed();
+                                  printf("Ebml delta :%d lacesize[%d]->:%d\n",delta,i,curSize+delta);
+                                  curSize+=delta;
+                                  ADM_assert(curSize>0);
+                                  _Laces[i]=curSize; 
+                                  len-=curSize;
+                                }
+                                int64_t d=pos+len-_clusterParser->tell();
+                                _Laces[nbLaces-1]=(uint32_t)d; 
+                                _currentLace=0;
+                                _maxLace=nbLaces;
+                                return getPacket(dest, packlen, samples);
+                              }
+                      default:
+                            printf("Unsupported lacing %u\n",lacing);
+                            _clusterParser->seek(pos+len);
+                    }
+                
+              }
+              break;
+            }
+        }
+  }
+  return 0;
 }
 /**
-      \fn mkvAudio
+      \fn mkvAudio 
 */
- mkvAudio::mkvAudio(const char *name,mkvTrak *track) : AVDMGenericAudioStream()
+ mkvAudio::mkvAudio(const char *name,mkvTrak *track,mkvIndex *clust,uint32_t nbClusters) 
+  : AVDMGenericAudioStream()
 {
+  _nbClusters=nbClusters;
+  _clusters=clust;
+  ADM_assert(_clusters);
+  
    _parser=new ADM_ebml_file();
    ADM_assert(_parser->open(name));
   _track=track; 
+  ADM_assert(_track);
   
+  
   // Compute total length in byte
-  _length=0;
-  for(int i=0;i<track->_nbIndex;i++)
-  {
-    _length+=track->_index[i].size; 
-  }
+  _length=_track->_sizeInBytes; // FIXME
+  
+  
   _wavheader=new WAVHeader;
   memcpy(_wavheader,&(_track->wavHeader),sizeof(WAVHeader));
   printf("[MKVAUDIO] found %lu bytes\n",_length);
+  _currentLace=_maxLace=0;
+  _clusterParser=NULL;
+  goToCluster(0);
 }
+/**
+    \fn goToCluster
+    \brief Change the cluster parser...
+*/
+uint8_t mkvAudio::goToCluster(uint32_t x)
+{
+  ADM_assert(_nbClusters);
+  
+  if(x>=_nbClusters)
+  {
+    printf("Exceeding max cluster : asked: %u max :%u\n",x,_nbClusters); 
+    return 0;  // FIXME
+  }
+  
+  if( _clusterParser) delete _clusterParser;
+  _clusterParser=NULL;
+  
+  //************/
+  _parser->seek(_clusters[x].pos);
+  _clusterParser=new ADM_ebml_file(_parser,_clusters[x].size);
+  _currentLace=_maxLace=0;
+  printf("switching to cluster :%u/%u\n",x,_nbClusters);
+  return 1;
+}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ebml.cpp	2007-04-27 20:48:08 UTC (rev 2977)
@@ -102,7 +102,18 @@
     val=(val<<8)+readu8(); 
   }
   // Signed !
-  //FIXME
+
+  switch(more)
+  {
+    case 0: val-=63;break; 
+    case 1: val-=8191;break;
+    case 2: val-=1048575L;break;  
+    default: 
+        ADM_assert(0);
+        return 0;
+    
+  }
+
   return val;
 }
 /**

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-27 08:17:13 UTC (rev 2976)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-27 20:48:08 UTC (rev 2977)
@@ -97,6 +97,16 @@
   MKTAG(MKV_CUE_BLOCK_NUMBER,0x5378,ADM_MKV_TYPE_UINTEGER),
   
    MKTAG(MKV_VOID,0xEC,ADM_MKV_TYPE_BINARY),
+   MKTAG(MKV_DURATION,0x4489,ADM_MKV_TYPE_FLOAT),
+   MKTAG(MKV_SEGMENT_UID,0x73A4,ADM_MKV_TYPE_BINARY),
+   MKTAG(MKV_DATE_UTC,0x4461,ADM_MKV_TYPE_BINARY), //FIXME IT IS DATE TYPE
+   MKTAG(MKV_TRACK_UID,0x73C5,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_FLAG_ENABLED,0xB9,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_FLAG_DEFAULT,0x88,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_FLAG_LACING,0x9C,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_FLAG_FORCED,0x55AA,ADM_MKV_TYPE_UINTEGER),
+   
+   MKTAG(MKV_BLOCK_DURATION,0x9B,ADM_MKV_TYPE_UINTEGER),
   
          //*************************
    MKTAG(MKV_MAX,0xFFFF,ADM_MKV_TYPE_UNKNOWN)    



From mean at mail.berlios.de  Sat Apr 28 11:10:28 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 28 Apr 2007 11:10:28 +0200
Subject: [Avidemux-svn-commit] r2978 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704280910.l3S9ASDW016533@sheep.berlios.de>

Author: mean
Date: 2007-04-28 11:10:28 +0200 (Sat, 28 Apr 2007)
New Revision: 2978

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
Log:
handle ebml lacing, compute fps

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-27 20:48:08 UTC (rev 2977)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-28 09:10:28 UTC (rev 2978)
@@ -102,8 +102,22 @@
       if(entry.trackType==1 &&  !_isvideopresent)
       {
         _isvideopresent=1; 
-        _videostream.dwScale=1000;
-        _videostream.dwRate=25000;
+        if(entry.defaultDuration)
+        {
+            double inv=entry.defaultDuration; // in us
+            inv=1/inv;
+            inv*=1000.;
+            inv*=1000.;
+            inv*=1000.;
+            _videostream.dwScale=1000;
+            _videostream.dwRate=(uint32_t)inv;
+        }else
+        {
+          printf("[MKV] No duration, assuming 25 fps\n"); 
+          _videostream.dwScale=1000;
+          _videostream.dwRate=25000;
+
+        }
     
         _mainaviheader.dwMicroSecPerFrame=(uint32_t)floor(50);;     
         _videostream.fccType=fourCC::get((uint8_t *)"vids");
@@ -181,7 +195,6 @@
         
         case  MKV_TRACK_NUMBER: entry->trackNo=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TYPE: entry->trackType=father.readUnsignedInt(len);break;
-        case  MKV_FRAME_DEFAULT_DURATION:entry->defaultDuration=father.readUnsignedInt(len);break;
 
         case  MKV_AUDIO_FREQUENCY: entry->fq=(uint32_t)floor(father.readFloat(len));break;
 
@@ -189,7 +202,7 @@
         case  MKV_VIDEO_HEIGHT: entry->h=father.readUnsignedInt(len);break;
         case  MKV_TRACK_TIMECODESCALE:father.skip(len);break; //FIXME
 
-        
+        case  MKV_FRAME_DEFAULT_DURATION: entry->defaultDuration=father.readUnsignedInt(len)/1000; break; // In us
         case  MKV_CODEC_EXTRADATA:
         {
               uint8_t *data=new uint8_t[len];

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-27 20:48:08 UTC (rev 2977)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-28 09:10:28 UTC (rev 2978)
@@ -124,8 +124,12 @@
               case MKV_BLOCK: 
               {
                   uint32_t tid=_clusterParser->readEBMCode();
-                  len--; // ASSUME TRACK FITS ON 1 BYTE!
-                    vprintf("Tid = %u, my tid=%u\n",tid,_track->streamIndex);
+                  uint64_t tail=pos+len;
+                  uint64_t head=pos;
+                  
+                  // FIXME WARNING ASSUME TRACK FITS ON 1 BYTE!
+                  len--; 
+                  vprintf("Tid = %u, my tid=%u\n",tid,_track->streamIndex);
                   if(tid!=_track->streamIndex)
                     {
                       _clusterParser->skip(len); // skip this block
@@ -166,23 +170,33 @@
                               }
                       case 3: // Ebml lacing
                         {
+                                
                                 int nbLaces=_clusterParser->readu8()+1;
                                 int32_t curSize=_clusterParser->readEBMCode();
                                 int32_t delta;
-                                printf("Ebml nbLaces :%u lacesize(0):%u\n",nbLaces,curSize);
+                                
+                                vprintf("Ebml nbLaces :%u lacesize(0):%u\n",nbLaces,curSize);
+                                
                                 _Laces[0]=curSize;
-                                len-=curSize;
                                 ADM_assert(nbLaces<MKV_MAX_LACES);
                                 for(int i=1;i<nbLaces-1;i++)
                                 {
                                   delta=_clusterParser->readEBMCode_Signed();
-                                  printf("Ebml delta :%d lacesize[%d]->:%d\n",delta,i,curSize+delta);
+                                  vprintf("Ebml delta :%d lacesize[%d]->:%d\n",delta,i,curSize+delta);
                                   curSize+=delta;
                                   ADM_assert(curSize>0);
                                   _Laces[i]=curSize; 
-                                  len-=curSize;
+                                 
                                 }
-                                int64_t d=pos+len-_clusterParser->tell();
+                                uint64_t d=_clusterParser->tell();
+                                
+                                d=tail-d;
+                                /* We have the remaining size after laces, substract the already known lace size */
+                                for(int i=0;i<nbLaces-1;i++)
+                                {
+                                  d-=_Laces[i]; 
+                                }
+                                // What is left is the sift of the last lace
                                 _Laces[nbLaces-1]=(uint32_t)d; 
                                 _currentLace=0;
                                 _maxLace=nbLaces;



From mean at mail.berlios.de  Sat Apr 28 12:00:51 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 28 Apr 2007 12:00:51 +0200
Subject: [Avidemux-svn-commit] r2979 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704281000.l3SA0pGR018690@sheep.berlios.de>

Author: mean
Date: 2007-04-28 12:00:51 +0200 (Sat, 28 Apr 2007)
New Revision: 2979

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
Log:
better seek with mkv for audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-28 09:10:28 UTC (rev 2978)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-28 10:00:51 UTC (rev 2979)
@@ -68,7 +68,8 @@
     uint32_t                    _Laces[MKV_MAX_LACES];
 
     uint8_t                     goToCluster(uint32_t x);
-    
+    uint8_t                     getPacket(uint8_t *dest, uint32_t *packlen, uint32_t *samples,uint32_t *timecode);
+    uint32_t                    _curTimeCode;
   public:
                                 mkvAudio(const char *name,mkvTrak *track,mkvIndex *clust,uint32_t nbClusters);
                                 
@@ -76,6 +77,7 @@
     virtual                     ~mkvAudio();
     virtual uint32_t            read(uint32_t len,uint8_t *buffer);
     virtual uint8_t             goTo(uint32_t newoffset);
+            uint8_t	        goToTime(uint32_t mstime);
     virtual uint8_t             getPacket(uint8_t *dest, uint32_t *len, uint32_t *samples);
   //  virtual uint8_t             goToTime(uint32_t mstime);
     virtual uint8_t             extraData(uint32_t *l,uint8_t **d);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-28 09:10:28 UTC (rev 2978)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-28 10:00:51 UTC (rev 2979)
@@ -71,6 +71,11 @@
 */
 uint8_t             mkvAudio::getPacket(uint8_t *dest, uint32_t *packlen, uint32_t *samples)
 {
+  uint32_t t;
+  return  getPacket(dest, packlen,samples,&t);
+}
+uint8_t             mkvAudio::getPacket(uint8_t *dest, uint32_t *packlen, uint32_t *samples,uint32_t *timecode)
+{
   uint64_t fileSize,len,bsize,pos;
   uint32_t alen,vlen;
   uint64_t id;
@@ -85,6 +90,7 @@
       vprintf("Continuing lacing : %u bytes, lacing %u/%u\n",*packlen,_currentLace,_maxLace);
       _currentLace++;
       *samples=1024; // FIXME
+      *timecode=_curTimeCode;
       
       return 1;
     }
@@ -136,8 +142,11 @@
                       break; // not our track
                     }
                     // Skip timecode
-                    _clusterParser->skip(2); // Timecode FIXME Timecode
+                    int tc=_clusterParser->readUnsignedInt(2); // FIXME Should be signed
+                    if(tc<0) tc=0;
+                    _curTimeCode=(uint32_t )tc;
                     len-=2;
+                    *timecode=_curTimeCode;
                     uint8_t flags=_clusterParser->readu8();
                     len--;
                     uint32_t remaining=len;
@@ -151,6 +160,7 @@
                               *packlen=remaining; 
                               *samples=1024; // FIXME
                               _currentLace=_maxLace=0;
+                              
                               return 1;
                       case 2 : // constant size lacing
                               {
@@ -265,5 +275,56 @@
   printf("switching to cluster :%u/%u\n",x,_nbClusters);
   return 1;
 }
+/**
+      \fn goToTime
+      \brief seek in the current track until we meet the time give (in ms)
+*/
+ uint8_t	mkvAudio::goToTime(uint32_t mstime)
+{
+uint64_t target=mstime;
 
+      // First identify the cluster...
+      int clus=-1;
+            for(int i=0;i<_nbClusters-1;i++)
+            {
+              if(target>=_clusters[i].timeCode && target<_clusters[i+1].timeCode)
+              {
+                clus=i;
+                i=_nbClusters; 
+              }
+            }
+            if(clus==-1) clus=_nbClusters-1; // Hopefully in the last one
+            
+            target-=_clusters[clus].timeCode; // now the time is relative
+            goToCluster(clus);
+            _currentCluster=clus;
+            _curTimeCode=_clusters[clus].timeCode;
+            
+            printf("[MKVAUDIO] Asked for %u ms, go to cluster %u which starts at %u\n",mstime,clus,_curTimeCode);
+            if(clus<_nbClusters-1)
+              printf("[MKVAUDIO] next cluster starts at %u\n",_clusters[clus+1].timeCode);
+#if 1
+            // Now seek more finely
+            // will be off by one frame
+#define MAX_SEEK_BUFFER 20000
+            uint8_t buffer[MAX_SEEK_BUFFER];
+            uint32_t len,samples,timecode;
+            while(getPacket(buffer, &len, &samples,&timecode))
+            {
+              uint32_t curTime=_clusters[_currentCluster].timeCode;
+              vprintf("Wanted: %u clus : %u Timecode:%u=> %u\n",mstime,curTime,timecode,timecode+curTime);
+              ADM_assert(len<MAX_SEEK_BUFFER); 
+              
+              if(timecode+curTime>=mstime) 
+              {
+                printf("[MKV audio] fine seek to %u (clu)+%u=%u\n",curTime,timecode,timecode+curTime);
+                return 1;
+              }
+            }
+            printf("Failed to seek to %u mstime\n");
+            return 0;
+#else
+            return 1;
+#endif
+}
 //EOF



From mean at mail.berlios.de  Sat Apr 28 15:32:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 28 Apr 2007 15:32:55 +0200
Subject: [Avidemux-svn-commit] r2980 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704281332.l3SDWtAd014025@sheep.berlios.de>

Author: mean
Date: 2007-04-28 15:32:55 +0200 (Sat, 28 Apr 2007)
New Revision: 2980

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
Log:
compute sample per frame for audio correctly

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-28 10:00:51 UTC (rev 2979)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-28 13:32:55 UTC (rev 2980)
@@ -49,6 +49,7 @@
   uint32_t  _nbIndex;  // current size of the index
   uint32_t  _indexMax; // Max size of the index
   uint32_t  _sizeInBytes; // Approximate size in bytes of that stream
+  uint32_t  _defaultFrameDuration; // in us!
 };
 
 #define MKV_MAX_LACES 20 // ?
@@ -63,6 +64,8 @@
     uint32_t                    _nbClusters;
     uint32_t                    _currentCluster;
     
+    uint32_t                    _frameDurationInSample; // Nb Samples per frame
+    
     uint32_t                    _currentLace;
     uint32_t                    _maxLace;
     uint32_t                    _Laces[MKV_MAX_LACES];

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-28 10:00:51 UTC (rev 2979)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2007-04-28 13:32:55 UTC (rev 2980)
@@ -104,6 +104,7 @@
         _isvideopresent=1; 
         if(entry.defaultDuration)
         {
+            _tracks[0]._defaultFrameDuration=entry.defaultDuration;
             double inv=entry.defaultDuration; // in us
             inv=1/inv;
             inv*=1000.;
@@ -161,7 +162,10 @@
          t->streamIndex=entry.trackNo;
          t->extraData=entry.extraData;
          t->extraDataLen=entry.extraDataLen;
-                  
+         if(entry.defaultDuration)
+          t->_defaultFrameDuration=entry.defaultDuration;
+         else
+           t->_defaultFrameDuration=24000;
         _nbAudioTrack++;
         return 1;
       }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-28 10:00:51 UTC (rev 2979)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-04-28 13:32:55 UTC (rev 2980)
@@ -44,6 +44,7 @@
   {"A_MPEG/L3",0,WAV_MP3,""},
   {"A_AC3",0,WAV_AC3,""}, 
   {"A_AAC/MPEG2/LC",0,WAV_AAC,""},
+  {"A_AAC",0,WAV_AAC,""},
   
   // Video
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-28 10:00:51 UTC (rev 2979)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2007-04-28 13:32:55 UTC (rev 2980)
@@ -89,7 +89,7 @@
       *packlen= _Laces[_currentLace];
       vprintf("Continuing lacing : %u bytes, lacing %u/%u\n",*packlen,_currentLace,_maxLace);
       _currentLace++;
-      *samples=1024; // FIXME
+      *samples=_frameDurationInSample;
       *timecode=_curTimeCode;
       
       return 1;
@@ -158,7 +158,7 @@
                               vprintf("No lacing :%d bytes\n",remaining);
                               _clusterParser->readBin(dest,remaining);
                               *packlen=remaining; 
-                              *samples=1024; // FIXME
+                              *samples=_frameDurationInSample;
                               _currentLace=_maxLace=0;
                               
                               return 1;
@@ -243,10 +243,15 @@
   // Compute total length in byte
   _length=_track->_sizeInBytes; // FIXME
   
+  float f=_track->wavHeader.frequency;
+  f*=_track->_defaultFrameDuration;
+  f=f/1000000.;
   
+  _frameDurationInSample=(uint32_t)floor(f+0.5);
+  
   _wavheader=new WAVHeader;
   memcpy(_wavheader,&(_track->wavHeader),sizeof(WAVHeader));
-  printf("[MKVAUDIO] found %lu bytes\n",_length);
+  printf("[MKVAUDIO] found %lu bytes, %u samples per frame\n",_length,_frameDurationInSample);
   _currentLace=_maxLace=0;
   _clusterParser=NULL;
   goToCluster(0);



From mean at mail.berlios.de  Sat Apr 28 18:23:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 28 Apr 2007 18:23:55 +0200
Subject: [Avidemux-svn-commit] r2981 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200704281623.l3SGNtvF023178@sheep.berlios.de>

Author: mean
Date: 2007-04-28 18:23:55 +0200 (Sat, 28 Apr 2007)
New Revision: 2981

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
Log:
skip nal size if it does not fit

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-28 13:32:55 UTC (rev 2980)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-28 16:23:55 UTC (rev 2981)
@@ -8075,7 +8075,10 @@
         int i, nalsize = 0;
 
       if(h->is_avc) {
-        if(buf_index >= buf_size) break;
+        /*** MEANX: The nal size must fit in the buffer and not just begin in it ****/
+        // if(buf_index >= buf_size) break;
+        if(buf_index +h->nal_length_size>= buf_size) break;
+        // /MEANX
         nalsize = 0;
         for(i = 0; i < h->nal_length_size; i++)
             nalsize = (nalsize << 8) | buf[buf_index++];



From mean at mail.berlios.de  Sun Apr 29 11:08:43 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 29 Apr 2007 11:08:43 +0200
Subject: [Avidemux-svn-commit] r2982 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200704290908.l3T98ha2018166@sheep.berlios.de>

Author: mean
Date: 2007-04-29 11:08:42 +0200 (Sun, 29 Apr 2007)
New Revision: 2982

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
Log:
more complete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-28 16:23:55 UTC (rev 2981)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-29 09:08:42 UTC (rev 2982)
@@ -8075,19 +8075,21 @@
         int i, nalsize = 0;
 
       if(h->is_avc) {
-        /*** MEANX: The nal size must fit in the buffer and not just begin in it ****/
-        // if(buf_index >= buf_size) break;
-        if(buf_index +h->nal_length_size>= buf_size) break;
-        // /MEANX
+        if(buf_index==buf_size) break;
+        if(buf_index +h->nal_length_size>= buf_size) 
+        {
+          av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal_size does not fit in buffer (need %d bytes, only %d available)\n",h->nal_length_size,buf_size-buf_index);
+          break;
+        }
         nalsize = 0;
         for(i = 0; i < h->nal_length_size; i++)
             nalsize = (nalsize << 8) | buf[buf_index++];
-        if(nalsize <= 1 || nalsize > buf_size){
+        if(nalsize <= 1 || (nalsize+buf_index > buf_size)){
             if(nalsize == 1){
                 buf_index++;
                 continue;
             }else{
-                av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal size %d\n", nalsize);
+                av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal does not fit in buffer, need %d\n", nalsize);
                 break;
             }
         }



From mean at mail.berlios.de  Sun Apr 29 11:09:42 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 29 Apr 2007 11:09:42 +0200
Subject: [Avidemux-svn-commit] r2983 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704290909.l3T99ghZ018249@sheep.berlios.de>

Author: mean
Date: 2007-04-29 11:09:41 +0200 (Sun, 29 Apr 2007)
New Revision: 2983

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
Log:
better computation of audio size, correct computation of video frame length

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-29 09:08:42 UTC (rev 2982)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-29 09:09:41 UTC (rev 2983)
@@ -80,7 +80,6 @@
                 {
                         //printf("Block Group\n");
                         ADM_ebml_file blockGroup(parser,len);
-                        uint32_t lacing,nbLaces;
                         while(!blockGroup.finished())
                         {
                                 blockGroup.readElemId(&id,&len);
@@ -97,7 +96,7 @@
                                   default: blockGroup.skip(len);
                                   case MKV_BLOCK : 
                                   {
-                                    indexBlock(&blockGroup,thiscluster);
+                                    indexBlock(&blockGroup,len);
                                     
                                   }         
                                 }
@@ -117,54 +116,89 @@
       \fn indexBlock
       \brief index a block, identify it and update index
 */
-uint8_t mkvHeader::indexBlock(ADM_ebml_file *parser,uint32_t count)
+uint8_t mkvHeader::indexBlock(ADM_ebml_file *parser,uint32_t len)
 {
   int lacing,nbLaces,entryFlags;
+  //
+  uint64_t tail=parser->tell()+len;
   // Read Track id 
   uint32_t tid=parser->readEBMCode();
   int track=searchTrackFromTid(tid);
+  
       //printf("Wanted %u got %u\n",_tracks[0].streamIndex,tid);
-      if(track!=0)
+      if(track==-1) //dont care track
       {
-        uint32_t remaining=parser->remaining();
-        if(track!=-1)
-        {
-          _tracks[track]._sizeInBytes+=remaining; // keep some stat, useful for audio
-        }
-        parser->skip(remaining);
+        
+        parser->seek(tail);
         return 1; // we do only video here...
       }
       // Skip timecode
       parser->skip(2); // Timecode FIXME Timecode
       uint8_t flags=parser->readu8();
-      uint32_t remaining=parser->remaining();
+      uint32_t remaining=tail-parser->tell();
       lacing=((flags>>1)&3);
       switch(lacing)
       {
         case 0: // No lacing
-              
-              addIndexEntry(track,parser->tell(),remaining,entryFlags);
+              if(!track) // Video
+              {    
+                  addIndexEntry(track,parser->tell(),remaining,entryFlags);
+              }
+              else
+              {
+                _tracks[track]._sizeInBytes+=remaining; // keep some stat, useful for audio 
+              }
               break;
         case 2 : // Constant size lacing
             {
                     nbLaces=parser->readu8()+1;
                     remaining--;
                     // Only mp3/Ac3 supported, ignore lacing FIXME : Vorbis or AAC will not work
-                    addIndexEntry(track,parser->tell(),remaining,0);
+                    
+                    
                     int bsize=remaining/nbLaces;
                     if(bsize*nbLaces!=remaining)
                     {
                       printf("Warning not multiple bsize=%d total=%u  nbLaces=%u\n",bsize,remaining,nbLaces);
                     }
-                    if(!track) printf("Warning lacing on video track\n");
+                    if(!track) 
+                    {
+                      addIndexEntry(track,parser->tell(),remaining,0);
+                      printf("Warning lacing on video track\n");
+                    }
+                    else
+                    {
+                       _tracks[track]._sizeInBytes+=remaining;
+                    }
                     //printf("tid:%u track %u Remaining : %llu laces %u blksize %d er%d\n",tid,track,remaining,nbLaces,remaining/nbLaces,remaining-(remaining/nbLaces)*nbLaces);
-            } 
+            }
             break;
+#if 1
+        case 3: // Ebml lacing
+          {
+                                
+                                int nbLaces=parser->readu8()+1;
+                                int32_t curSize=parser->readEBMCode();
+                                int32_t delta,sum;
+                                int64_t tail;
+                                
+                                sum=curSize;
+                                for(int i=1;i<nbLaces-1;i++)
+                                {
+                                  delta=parser->readEBMCode_Signed();
+                                  curSize+=delta;
+                                }
+                                ADM_assert(track); // Not video!
+                                _tracks[track]._sizeInBytes+=tail-parser->tell();
+                                
+                              }
+            break;
+#endif
         default: 
             printf("unsupported lacing\n");
             break;
       }
-      parser->skip(remaining);
+      parser->seek(tail);
       return 1;
 }
 



From mean at mail.berlios.de  Sun Apr 29 15:34:49 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 29 Apr 2007 15:34:49 +0200
Subject: [Avidemux-svn-commit] r2986 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs
	ADM_inputs/ADM_3gp ADM_inputs/ADM_matroska
Message-ID: <200704291334.l3TDYnhp024897@sheep.berlios.de>

Author: mean
Date: 2007-04-29 15:34:49 +0200 (Sun, 29 Apr 2007)
New Revision: 2986

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.h
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
Log:
fast identify IDR in mpeg4/avc

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-04-29 13:34:49 UTC (rev 2986)
@@ -44,6 +44,7 @@
 #include "ADM_osSupport/ADM_debug.h"
 #include "ADM_osSupport/ADM_cpuCap.h"
 
+#include "ADM_video/ADM_videoInfoExtractor.h"
 //****************************
 #define WRAP_Open(x) \
 {\
@@ -317,6 +318,8 @@
       _context->debug &= ~(FF_DEBUG_VIS_MB_TYPE + FF_DEBUG_VIS_QP);
     }
 
+    
+    
   if (in->dataLength == 0 && !_allowNull)	// Null frame, silently skipped
     {
       
@@ -526,6 +529,24 @@
   WRAP_Open (CODEC_ID_H264);
 
 }
+//*********************
+extern "C" {int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);}
+
+uint8_t   decoderFFH264::uncompress (ADMCompressedImage * in, ADMImage * out)
+{
+  if(!_context->hurry_up) return decoderFF::uncompress (in, out);
+  
+  uint32_t nalSize, isAvc;
+  av_getAVCStreamInfo(_context,&nalSize,&isAvc);
+  if(isAvc)
+  {
+      return extractH264FrameType(nalSize, in->data,in->dataLength,&(out->flags));
+  }else
+  {
+    return extractH264FrameType_startCode(nalSize, in->data,in->dataLength,&(out->flags));
+  }
+}
+//*********************
 decoderFFhuff::decoderFFhuff (uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,
 	   h)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.h	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.h	2007-04-29 13:34:49 UTC (rev 2986)
@@ -168,6 +168,7 @@
   {
       return _lowDelay;
   }
+  uint8_t   uncompress (ADMCompressedImage * in, ADMImage * out);
 
 };
 class decoderFFhuff:public decoderFF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp	2007-04-29 13:34:49 UTC (rev 2986)
@@ -71,6 +71,8 @@
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_codecs/ADM_codec.h"
 
+#include "ADM_video/ADM_videoInfoExtractor.h"
+
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_3GP
 #include "ADM_osSupport/ADM_debug.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.h	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_3gp.h	2007-04-29 13:34:49 UTC (rev 2986)
@@ -152,10 +152,6 @@
 
 };
 
-uint8_t extractMpeg4Info(uint8_t *data,uint32_t dataSize,uint32_t *w,uint32_t *h,uint32_t *time_inc);
-uint8_t extractH263Info(uint8_t *data,uint32_t dataSize,uint32_t *w,uint32_t *h);
-uint8_t extractVopInfo(uint8_t *data, uint32_t len,uint32_t timeincbits,uint32_t *vopType,uint32_t *modulo, uint32_t *time_inc);
-uint8_t extractSPSInfo(uint8_t *data, uint32_t len,uint32_t *wwidth,uint32_t *hheight);
 #endif
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp	2007-04-29 13:34:49 UTC (rev 2986)
@@ -307,5 +307,105 @@
            
            return 1;
 }
+/**
+      \fn extractH264FrameType
+      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  mkv/mp4 nal type (i.e. no startcode)
+      
+*/
+uint8_t extractH264FrameType(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
+{
+  uint8_t *head=buffer, *tail=buffer+len;
+  uint8_t stream;
+#define NAL_NON_IDR       1
+#define NAL_IDR           5
 
+  uint32_t val,hnt;  
+  
+// FIXME :  no startcode only !
+  
+  while(head+4<tail)
+  {
+    
+              uint32_t length=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
+              if(length>len)
+              {
+                printf("Warning , incomplete nal (%u/%u)\n",length,len); 
+              }
+              head+=4; // Skip nal lenth
+              length-=4;
+              stream=*(head++)&0x1F;
+                switch(stream)
+                {
+                  case NAL_IDR: 
+                                  *flags=AVI_KEY_FRAME;
+                                //  printf("IDR\n");
+                                  return 1;
+                                  break; 
+                  case NAL_NON_IDR: 
+                                  *flags=0;
+                                //  printf("NON IDR\n");
+                                  return 1;
+                                  break;
+                  default:
+                          printf("??0x%x\n",stream);
+                          head+=length+1;
+                          continue;
+                }
+  }
+  printf("No stream\n");
+  return 0;
+}
+
+/**
+      \fn extractH264FrameType_startCode
+      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  avi / mpeg TS nal type (i.e. with startcode)
+      
+*/
+uint8_t extractH264FrameType_startCode(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
+{
+  uint8_t *head=buffer, *tail=buffer+len;
+  uint8_t stream;
+#define NAL_NON_IDR       1
+#define NAL_IDR           5
+
+  uint32_t val,hnt;  
+  
+// FIXME :  no startcode only !
+  
+  while(head+4<tail)
+  {
+          // Search startcode
+      
+                hnt=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
+                head+=4;
+                while((hnt!=1) && head<tail)
+                {
+
+                        hnt<<=8;
+                        val=*head++;
+                        hnt+=val;
+                }
+                if(head>=tail) break;
+                stream=*(head++) &0x1f;
+                switch(stream)
+                {
+                  case NAL_IDR: 
+                                  *flags=AVI_KEY_FRAME;
+                                 // printf("IDR\n");
+                                  return 1;
+                                  break; 
+                  case NAL_NON_IDR: 
+                                  *flags=0;
+                                //  printf("NON IDR\n");
+                                  return 1;
+                                  break;
+                  default:
+                          printf("??0x%x\n",stream);
+                          continue;
+                }
+  }
+  printf("No stream\n");
+  return 0;
+}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-29 11:56:48 UTC (rev 2985)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-04-29 13:34:49 UTC (rev 2986)
@@ -107,6 +107,7 @@
    MKTAG(MKV_FLAG_FORCED,0x55AA,ADM_MKV_TYPE_UINTEGER),
    
    MKTAG(MKV_BLOCK_DURATION,0x9B,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_REFERENCE_BLOCK,0xfB,ADM_MKV_TYPE_INTEGER),
   
          //*************************
    MKTAG(MKV_MAX,0xFFFF,ADM_MKV_TYPE_UNKNOWN)    



From mean at mail.berlios.de  Sun Apr 29 15:35:12 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 29 Apr 2007 15:35:12 +0200
Subject: [Avidemux-svn-commit] r2987 -
	branches/avidemux_2.4_branch/avidemux/ADM_video
Message-ID: <200704291335.l3TDZCR2024988@sheep.berlios.de>

Author: mean
Date: 2007-04-29 15:35:12 +0200 (Sun, 29 Apr 2007)
New Revision: 2987

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_videoInfoExtractor.h
Log:
new file

Added: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_videoInfoExtractor.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_videoInfoExtractor.h	2007-04-29 13:34:49 UTC (rev 2986)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_videoInfoExtractor.h	2007-04-29 13:35:12 UTC (rev 2987)
@@ -0,0 +1,25 @@
+/***************************************************************************
+  GPL License
+  Get info from frames
+  (C) Mean 2007
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_VIDEO_INFO_EXTRACTOR
+#define ADM_VIDEO_INFO_EXTRACTOR
+
+uint8_t extractMpeg4Info(uint8_t *data,uint32_t dataSize,uint32_t *w,uint32_t *h,uint32_t *time_inc);
+uint8_t extractH263Info(uint8_t *data,uint32_t dataSize,uint32_t *w,uint32_t *h);
+uint8_t extractVopInfo(uint8_t *data, uint32_t len,uint32_t timeincbits,uint32_t *vopType,uint32_t *modulo, uint32_t *time_inc);
+uint8_t extractSPSInfo(uint8_t *data, uint32_t len,uint32_t *wwidth,uint32_t *hheight);
+uint8_t extractH264FrameType(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags);
+uint8_t extractH264FrameType_startCode(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags);
+
+#endif
\ No newline at end of file



From mean at mail.berlios.de  Sun Apr 29 18:12:39 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 29 Apr 2007 18:12:39 +0200
Subject: [Avidemux-svn-commit] r2988 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704291612.l3TGCdGd003560@sheep.berlios.de>

Author: mean
Date: 2007-04-29 18:12:38 +0200 (Sun, 29 Apr 2007)
New Revision: 2988

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
Log:
show indexing progress (mkv)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-29 13:35:12 UTC (rev 2987)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-29 16:12:38 UTC (rev 2988)
@@ -30,6 +30,7 @@
 #include "ADM_mkv.h"
 
 #include "mkv_tags.h"
+#include "ADM_userInterfaces/ADM_commonUI/DIA_idx_pg.h"
 #define VIDEO _tracks[0]
 /**
     \fn videoIndexer
@@ -44,7 +45,7 @@
   const char *ss;
   
    parser->seek(0);
-   
+   DIA_progressIndexing *work=new DIA_progressIndexing("Matroska Images");
    // Start with a small index, it will grow automatically afterward
    for(int i=0;i<_nbAudioTrack+1;i++)
    {
@@ -52,6 +53,7 @@
     _tracks[i]._index=new mkvIndex[_tracks[i]._indexMax];
    }
     //************
+   work->update(0,_nbClusters,0,0,0,0);
    for(int clusters=0;clusters<_nbClusters;clusters++)
    {
    parser->seek(_clusters[clusters].pos);
@@ -59,7 +61,7 @@
    int thiscluster=0;
    while(!cluster.finished())
    {
-      
+      work->update(clusters,_nbClusters,VIDEO._nbIndex,0,0,0);
       cluster.readElemId(&id,&len);
       if(!ADM_searchMkvTag( (MKV_ELEM_ID)id,&ss,&type))
       {
@@ -110,6 +112,7 @@
    // printf("[MKV] ending cluster at 0x%llx\n",segment.tell());
   }
      printf("Found %lu images in this cluster\n",VIDEO._nbIndex);
+     delete work;
      return 1;
 }
 /**
@@ -355,16 +358,22 @@
   _nbClusters=0;
   
   // Search segment
+   
+   parser->seek(0x7000000000); //Hackish, fixme
+   fileSize=parser->tell();
    parser->seek(0);
+   
    if(!parser->simplefind(MKV_SEGMENT,&vlen,1))
    {
      printf("[MKV] cluster indexer, cannot find CLUSTER atom\n");
      return 0;
    }
    ADM_ebml_file segment(parser,vlen);
-   
+   DIA_progressIndexing *work=new DIA_progressIndexing("Matroska clusters");
    while(segment.simplefind(MKV_CLUSTER,&alen,0)) 
    {
+     // UI update
+     work->update(segment.tell()>>10,fileSize>>10,_nbClusters,0,0,0);
      // Grow clusters index if needed
      if(_nbClusters==_clustersCeil-1)
      {
@@ -394,6 +403,7 @@
        }
        segment.seek( _clusters[seekme].pos+ _clusters[seekme].size);
    }
+   delete work;
    printf("[MKV] Found %u clusters\n",_nbClusters);
    return 1;
 }



From mean at mail.berlios.de  Mon Apr 30 11:34:52 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 11:34:52 +0200
Subject: [Avidemux-svn-commit] r2989 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_editor
	ADM_inputs/ADM_3gp ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200704300934.l3U9YqYF010488@sheep.berlios.de>

Author: mean
Date: 2007-04-30 11:34:51 +0200 (Mon, 30 Apr 2007)
New Revision: 2989

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
Log:
direct menu to connect to avsproxy

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-04-30 09:34:51 UTC (rev 2989)
@@ -245,26 +245,36 @@
 */
 
 /**
-	Load or append a file.
-	The file type is determined automatically and the ad-hoc video decoder is spawned
+    \fn addFile
+    \brief	Load or append a file.	The file type is determined automatically and the ad-hoc video decoder is spawned
+    
+    @param name: filename
+    @param mode: 0 open, 1 append
+    @param forcedType : if !=Unknown_FileType, it enables to force the file type
 
+    @return 1 on success, 0 on failure
+        
 
 */
-uint8_t ADM_Composer::addFile (char *name, uint8_t mode)
+uint8_t ADM_Composer::addFile (char *name, uint8_t mode,fileType forcedType)
 {
   uint8_t    ret =    0;
   aviInfo    info;
   WAVHeader *    _wavinfo;
 //  aviHeader *    tmp;
-  fileType    type =    Unknown_FileType;
+  fileType    type =    forcedType;
 
 UNUSED_ARG(mode);
 	_haveMarkers=0; // by default no markers are present
   ADM_assert (_nb_segment < max_seg);
   ADM_assert (_nb_video < MAX_VIDEO);
 
-  if (!identify (name, &type))
-    return 0;
+  // Autodetect file type ?
+  if(Unknown_FileType==type)
+  {
+      if (!identify (name, &type))
+        return 0;
+  }
 
 
 #define OPEN_AS(x,y) case x:\

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.hxx	2007-04-30 09:34:51 UTC (rev 2989)
@@ -177,7 +177,7 @@
   				//_______________________
   				// specific to composer
   				//_______________________
-  						uint8_t 	addFile(char *name,uint8_t mode=0);
+  						uint8_t 	addFile (char *name, uint8_t mode=0,fileType forcedType=Unknown_FileType);
   						uint8_t 	cleanup( void);
 			   			uint8_t 	isMultiSeg( void) { if(_nb_segment>1) return 1; else return 0;}
   						uint8_t 	removeFrames(uint32_t start,uint32_t end);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_3gp/ADM_infoextractor.cpp	2007-04-30 09:34:51 UTC (rev 2989)
@@ -41,6 +41,7 @@
 #include "ADM_lavcodec/bitstream.h"
 #include "ADM_lavcodec/golomb.h"
 }
+static void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags);
 /*
     Extract width & height from vol header passed as arg
 
@@ -318,7 +319,7 @@
   uint8_t stream;
 #define NAL_NON_IDR       1
 #define NAL_IDR           5
-
+  
   uint32_t val,hnt;  
   
 // FIXME :  no startcode only !
@@ -338,12 +339,11 @@
                 {
                   case NAL_IDR: 
                                   *flags=AVI_KEY_FRAME;
-                                //  printf("IDR\n");
+                                  
                                   return 1;
                                   break; 
                   case NAL_NON_IDR: 
-                                  *flags=0;
-                                //  printf("NON IDR\n");
+                                  refineH264FrameType(head,tail,flags);
                                   return 1;
                                   break;
                   default:
@@ -395,8 +395,7 @@
                                   return 1;
                                   break; 
                   case NAL_NON_IDR: 
-                                  *flags=0;
-                                //  printf("NON IDR\n");
+                                  refineH264FrameType(head,tail,flags);
                                   return 1;
                                   break;
                   default:
@@ -407,5 +406,25 @@
   printf("No stream\n");
   return 0;
 }
-
+/**
+    \fn refineH264FrameType
+    \brief Try to detect B slice, warning the stream is not escaped!
+*/
+void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags)
+{
+GetBitContext s;
+uint32_t sliceType;
+            *flags=0;
+            init_get_bits(&s,head, (tail-head)*8);
+            get_ue_golomb(&s);
+            sliceType= get_ue_golomb(&s);
+            if(sliceType > 9) 
+            {
+              printf("Weird Slice %d\n",sliceType);
+              return ;
+            }
+            if(sliceType > 4)
+                sliceType -= 5;
+            if(sliceType==3) *flags=AVI_B_FRAME;  
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-30 09:34:51 UTC (rev 2989)
@@ -16,7 +16,6 @@
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
 
-
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)
@@ -34,11 +33,11 @@
   GtkWidget *menuitem1;
   GtkWidget *menuitem1_menu;
   GtkWidget *open_video1;
-  GtkWidget *image8046;
+  GtkWidget *image8071;
   GtkWidget *append_video1;
-  GtkWidget *image8047;
+  GtkWidget *image8072;
   GtkWidget *save_stuff;
-  GtkWidget *image8048;
+  GtkWidget *image8073;
   GtkWidget *save_stuff_menu;
   GtkWidget *save_as_avi1;
   GtkWidget *separator1;
@@ -47,39 +46,41 @@
   GtkWidget *save_selection_as_jpegs1;
   GtkWidget *separator3;
   GtkWidget *save_project1;
-  GtkWidget *image8049;
+  GtkWidget *image8074;
   GtkWidget *save_project_as1;
-  GtkWidget *image8050;
+  GtkWidget *image8075;
   GtkWidget *run_script1;
-  GtkWidget *image8051;
+  GtkWidget *image8076;
   GtkWidget *add_to_joblist1;
   GtkWidget *joblist1;
   GtkWidget *separator16;
+  GtkWidget *connect_to_avsproxy1;
+  GtkWidget *separator18;
   GtkWidget *video_informations1;
-  GtkWidget *image8052;
+  GtkWidget *image8077;
   GtkWidget *avi_muxer_options1;
   GtkWidget *separator4;
   GtkWidget *quit1;
-  GtkWidget *image8053;
+  GtkWidget *image8078;
   GtkWidget *menuitem2;
   GtkWidget *menuitem2_menu;
   GtkWidget *reset_edits1;
-  GtkWidget *image8054;
+  GtkWidget *image8079;
   GtkWidget *separator5;
   GtkWidget *cut1;
-  GtkWidget *image8055;
+  GtkWidget *image8080;
   GtkWidget *copy1;
-  GtkWidget *image8056;
+  GtkWidget *image8081;
   GtkWidget *paste1;
-  GtkWidget *image8057;
+  GtkWidget *image8082;
   GtkWidget *delete1;
-  GtkWidget *image8058;
+  GtkWidget *image8083;
   GtkWidget *separator6;
   GtkWidget *set_marker_a1;
   GtkWidget *set_marker_b1;
   GtkWidget *separator7;
   GtkWidget *preferences1;
-  GtkWidget *image8059;
+  GtkWidget *image8084;
   GtkWidget *view1;
   GtkWidget *view1_menu;
   GtkWidget *toolbar1;
@@ -108,13 +109,13 @@
   GtkWidget *build_vbr_time_map1;
   GtkWidget *separator11;
   GtkWidget *save_audio1;
-  GtkWidget *image8060;
+  GtkWidget *image8085;
   GtkWidget *audio_encoder1;
   GtkWidget *filters2;
   GtkWidget *tools1;
   GtkWidget *tools1_menu;
   GtkWidget *calculator1;
-  GtkWidget *image8061;
+  GtkWidget *image8086;
   GtkWidget *separator12;
   GtkWidget *rebuild_frames;
   GtkWidget *check_frames;
@@ -135,34 +136,34 @@
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
-  GtkWidget *image8062;
+  GtkWidget *image8087;
   GtkWidget *previous_frame1;
-  GtkWidget *image8063;
+  GtkWidget *image8088;
   GtkWidget *next_frame1;
-  GtkWidget *image8064;
+  GtkWidget *image8089;
   GtkWidget *previous_intra_frame1;
-  GtkWidget *image8065;
+  GtkWidget *image8090;
   GtkWidget *next_intra_frame1;
-  GtkWidget *image8066;
+  GtkWidget *image8091;
   GtkWidget *search_previous_black_frame1;
   GtkWidget *search_next_black_frame1;
   GtkWidget *first_frame1;
-  GtkWidget *image8067;
+  GtkWidget *image8092;
   GtkWidget *last_frame1;
-  GtkWidget *image8068;
+  GtkWidget *image8093;
   GtkWidget *separator14;
   GtkWidget *go_to_marker_a1;
   GtkWidget *go_to_marker_b1;
   GtkWidget *separator15;
   GtkWidget *jum_to_frame1;
-  GtkWidget *image8069;
+  GtkWidget *image8094;
   GtkWidget *jump_to_time1;
-  GtkWidget *image8070;
+  GtkWidget *image8095;
   GtkWidget *custom1;
   GtkWidget *help2;
   GtkWidget *help2_menu;
   GtkWidget *about1;
-  GtkWidget *image8071;
+  GtkWidget *image8096;
   GtkWidget *show_builtin_support1;
   GtkWidget *toolbar2;
   GtkIconSize tmp_toolbar_icon_size;
@@ -289,9 +290,9 @@
                               GDK_O, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8046 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8046);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8046);
+  image8071 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8071);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8071);
 
   append_video1 = gtk_image_menu_item_new_with_mnemonic (_("_Append..."));
   gtk_widget_show (append_video1);
@@ -300,17 +301,17 @@
                               GDK_A, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8047 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8047);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8047);
+  image8072 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8072);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8072);
 
   save_stuff = gtk_image_menu_item_new_with_mnemonic (_("_Save"));
   gtk_widget_show (save_stuff);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_stuff);
 
-  image8048 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8048);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8048);
+  image8073 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8073);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8073);
 
   save_stuff_menu = gtk_menu_new ();
   gtk_menu_item_set_submenu (GTK_MENU_ITEM (save_stuff), save_stuff_menu);
@@ -348,25 +349,25 @@
   gtk_widget_show (save_project1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project1);
 
-  image8049 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8049);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8049);
+  image8074 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8074);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8074);
 
   save_project_as1 = gtk_image_menu_item_new_with_mnemonic (_("Save P_roject As..."));
   gtk_widget_show (save_project_as1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project_as1);
 
-  image8050 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8050);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8050);
+  image8075 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8075);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8075);
 
   run_script1 = gtk_image_menu_item_new_with_mnemonic (_("_Load/Run Project..."));
   gtk_widget_show (run_script1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), run_script1);
 
-  image8051 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8051);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8051);
+  image8076 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8076);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8076);
 
   add_to_joblist1 = gtk_menu_item_new_with_mnemonic (_("A_dd to Joblist..."));
   gtk_widget_show (add_to_joblist1);
@@ -384,6 +385,15 @@
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), separator16);
   gtk_widget_set_sensitive (separator16, FALSE);
 
+  connect_to_avsproxy1 = gtk_menu_item_new_with_mnemonic (_("Connect to avsproxy"));
+  gtk_widget_show (connect_to_avsproxy1);
+  gtk_container_add (GTK_CONTAINER (menuitem1_menu), connect_to_avsproxy1);
+
+  separator18 = gtk_separator_menu_item_new ();
+  gtk_widget_show (separator18);
+  gtk_container_add (GTK_CONTAINER (menuitem1_menu), separator18);
+  gtk_widget_set_sensitive (separator18, FALSE);
+
   video_informations1 = gtk_image_menu_item_new_with_mnemonic (_("Proper_ties"));
   gtk_widget_show (video_informations1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), video_informations1);
@@ -391,9 +401,9 @@
                               GDK_Return, (GdkModifierType)( GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8052 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8052);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8052);
+  image8077 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8077);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8077);
 
   avi_muxer_options1 = gtk_menu_item_new_with_mnemonic (_("AVI _Muxer Options"));
   gtk_widget_show (avi_muxer_options1);
@@ -411,9 +421,9 @@
                               GDK_Q, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8053 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8053);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8053);
+  image8078 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8078);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8078);
 
   menuitem2 = gtk_menu_item_new_with_mnemonic (_("_Edit"));
   gtk_widget_show (menuitem2);
@@ -426,9 +436,9 @@
   gtk_widget_show (reset_edits1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), reset_edits1);
 
-  image8054 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8054);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8054);
+  image8079 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8079);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8079);
 
   separator5 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator5);
@@ -442,9 +452,9 @@
                               GDK_X, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8055 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8055);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8055);
+  image8080 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8080);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8080);
 
   copy1 = gtk_image_menu_item_new_with_mnemonic (_("_Copy"));
   gtk_widget_show (copy1);
@@ -453,9 +463,9 @@
                               GDK_C, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8056 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8056);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8056);
+  image8081 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8081);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8081);
 
   paste1 = gtk_image_menu_item_new_with_mnemonic (_("_Paste"));
   gtk_widget_show (paste1);
@@ -464,9 +474,9 @@
                               GDK_V, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8057 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8057);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8057);
+  image8082 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8082);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8082);
 
   delete1 = gtk_image_menu_item_new_with_mnemonic (_("_Delete"));
   gtk_widget_show (delete1);
@@ -475,9 +485,9 @@
                               GDK_Delete, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8058 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8058);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8058);
+  image8083 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8083);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8083);
 
   separator6 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator6);
@@ -507,9 +517,9 @@
   gtk_widget_show (preferences1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), preferences1);
 
-  image8059 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8059);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8059);
+  image8084 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8084);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8084);
 
   view1 = gtk_menu_item_new_with_mnemonic (_("_View"));
   gtk_widget_show (view1);
@@ -663,9 +673,9 @@
                               GDK_S, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8060 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8060);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8060);
+  image8085 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8085);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8085);
 
   audio_encoder1 = gtk_menu_item_new_with_mnemonic (_("_Encoder"));
   gtk_widget_show (audio_encoder1);
@@ -692,9 +702,9 @@
                               GDK_F7, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8061 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
-  gtk_widget_show (image8061);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8061);
+  image8086 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
+  gtk_widget_show (image8086);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8086);
 
   separator12 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator12);
@@ -780,9 +790,9 @@
                               GDK_P, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8062 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8062);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8062);
+  image8087 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8087);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8087);
 
   previous_frame1 = gtk_image_menu_item_new_with_mnemonic (_("P_revious Frame"));
   gtk_widget_show (previous_frame1);
@@ -791,9 +801,9 @@
                               GDK_KP_4, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8063 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8063);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8063);
+  image8088 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8088);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8088);
 
   next_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Next Frame"));
   gtk_widget_show (next_frame1);
@@ -802,9 +812,9 @@
                               GDK_KP_6, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8064 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8064);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8064);
+  image8089 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8089);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8089);
 
   previous_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Pr_evious Intra Frame"));
   gtk_widget_show (previous_intra_frame1);
@@ -813,9 +823,9 @@
                               GDK_KP_2, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8065 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8065);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8065);
+  image8090 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8090);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8090);
 
   next_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Next _Intra Frame"));
   gtk_widget_show (next_intra_frame1);
@@ -824,9 +834,9 @@
                               GDK_KP_8, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8066 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8066);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8066);
+  image8091 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8091);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8091);
 
   search_previous_black_frame1 = gtk_menu_item_new_with_mnemonic (_("Previou_s Black Frame"));
   gtk_widget_show (search_previous_black_frame1);
@@ -843,9 +853,9 @@
                               GDK_Home, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8067 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8067);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8067);
+  image8092 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8092);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8092);
 
   last_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Last Frame"));
   gtk_widget_show (last_frame1);
@@ -854,9 +864,9 @@
                               GDK_End, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8068 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8068);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8068);
+  image8093 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8093);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8093);
 
   separator14 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator14);
@@ -889,9 +899,9 @@
                               GDK_F, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8069 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8069);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8069);
+  image8094 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8094);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8094);
 
   jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_("Jump to _Time..."));
   gtk_widget_show (jump_to_time1);
@@ -900,9 +910,9 @@
                               GDK_T, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8070 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8070);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8070);
+  image8095 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8095);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8095);
 
   custom1 = gtk_menu_item_new_with_mnemonic (_("Custom"));
   gtk_widget_show (custom1);
@@ -919,9 +929,9 @@
   gtk_widget_show (about1);
   gtk_container_add (GTK_CONTAINER (help2_menu), about1);
 
-  image8071 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8071);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8071);
+  image8096 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8096);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8096);
 
   show_builtin_support1 = gtk_menu_item_new_with_mnemonic (_("Show builtin support"));
   gtk_widget_show (show_builtin_support1);
@@ -1423,11 +1433,11 @@
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1, "menuitem1");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1_menu, "menuitem1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, open_video1, "open_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8046, "image8046");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8071, "image8071");
   GLADE_HOOKUP_OBJECT (mainWindow, append_video1, "append_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8047, "image8047");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8072, "image8072");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff, "save_stuff");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8048, "image8048");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8073, "image8073");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff_menu, "save_stuff_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, save_as_avi1, "save_as_avi1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator1, "separator1");
@@ -1436,39 +1446,41 @@
   GLADE_HOOKUP_OBJECT (mainWindow, save_selection_as_jpegs1, "save_selection_as_jpegs1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator3, "separator3");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project1, "save_project1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8049, "image8049");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8074, "image8074");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project_as1, "save_project_as1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8050, "image8050");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8075, "image8075");
   GLADE_HOOKUP_OBJECT (mainWindow, run_script1, "run_script1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8051, "image8051");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8076, "image8076");
   GLADE_HOOKUP_OBJECT (mainWindow, add_to_joblist1, "add_to_joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, joblist1, "joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator16, "separator16");
+  GLADE_HOOKUP_OBJECT (mainWindow, connect_to_avsproxy1, "connect_to_avsproxy1");
+  GLADE_HOOKUP_OBJECT (mainWindow, separator18, "separator18");
   GLADE_HOOKUP_OBJECT (mainWindow, video_informations1, "video_informations1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8052, "image8052");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8077, "image8077");
   GLADE_HOOKUP_OBJECT (mainWindow, avi_muxer_options1, "avi_muxer_options1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator4, "separator4");
   GLADE_HOOKUP_OBJECT (mainWindow, quit1, "quit1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8053, "image8053");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8078, "image8078");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2, "menuitem2");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2_menu, "menuitem2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, reset_edits1, "reset_edits1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8054, "image8054");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8079, "image8079");
   GLADE_HOOKUP_OBJECT (mainWindow, separator5, "separator5");
   GLADE_HOOKUP_OBJECT (mainWindow, cut1, "cut1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8055, "image8055");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8080, "image8080");
   GLADE_HOOKUP_OBJECT (mainWindow, copy1, "copy1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8056, "image8056");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8081, "image8081");
   GLADE_HOOKUP_OBJECT (mainWindow, paste1, "paste1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8057, "image8057");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8082, "image8082");
   GLADE_HOOKUP_OBJECT (mainWindow, delete1, "delete1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8058, "image8058");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8083, "image8083");
   GLADE_HOOKUP_OBJECT (mainWindow, separator6, "separator6");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_a1, "set_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_b1, "set_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator7, "separator7");
   GLADE_HOOKUP_OBJECT (mainWindow, preferences1, "preferences1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8059, "image8059");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8084, "image8084");
   GLADE_HOOKUP_OBJECT (mainWindow, view1, "view1");
   GLADE_HOOKUP_OBJECT (mainWindow, view1_menu, "view1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar1, "toolbar1");
@@ -1497,13 +1509,13 @@
   GLADE_HOOKUP_OBJECT (mainWindow, build_vbr_time_map1, "build_vbr_time_map1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator11, "separator11");
   GLADE_HOOKUP_OBJECT (mainWindow, save_audio1, "save_audio1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8060, "image8060");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8085, "image8085");
   GLADE_HOOKUP_OBJECT (mainWindow, audio_encoder1, "audio_encoder1");
   GLADE_HOOKUP_OBJECT (mainWindow, filters2, "filters2");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1, "tools1");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1_menu, "tools1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, calculator1, "calculator1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8061, "image8061");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8086, "image8086");
   GLADE_HOOKUP_OBJECT (mainWindow, separator12, "separator12");
   GLADE_HOOKUP_OBJECT (mainWindow, rebuild_frames, "rebuild_frames");
   GLADE_HOOKUP_OBJECT (mainWindow, check_frames, "check_frames");
@@ -1524,34 +1536,34 @@
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8062, "image8062");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8087, "image8087");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_frame1, "previous_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8063, "image8063");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8088, "image8088");
   GLADE_HOOKUP_OBJECT (mainWindow, next_frame1, "next_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8064, "image8064");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8089, "image8089");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_intra_frame1, "previous_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8065, "image8065");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8090, "image8090");
   GLADE_HOOKUP_OBJECT (mainWindow, next_intra_frame1, "next_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8066, "image8066");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8091, "image8091");
   GLADE_HOOKUP_OBJECT (mainWindow, search_previous_black_frame1, "search_previous_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, search_next_black_frame1, "search_next_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, first_frame1, "first_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8067, "image8067");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8092, "image8092");
   GLADE_HOOKUP_OBJECT (mainWindow, last_frame1, "last_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8068, "image8068");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8093, "image8093");
   GLADE_HOOKUP_OBJECT (mainWindow, separator14, "separator14");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_a1, "go_to_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_b1, "go_to_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator15, "separator15");
   GLADE_HOOKUP_OBJECT (mainWindow, jum_to_frame1, "jum_to_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8069, "image8069");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8094, "image8094");
   GLADE_HOOKUP_OBJECT (mainWindow, jump_to_time1, "jump_to_time1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8070, "image8070");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8095, "image8095");
   GLADE_HOOKUP_OBJECT (mainWindow, custom1, "custom1");
   GLADE_HOOKUP_OBJECT (mainWindow, help2, "help2");
   GLADE_HOOKUP_OBJECT (mainWindow, help2_menu, "help2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, about1, "about1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8071, "image8071");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8096, "image8096");
   GLADE_HOOKUP_OBJECT (mainWindow, show_builtin_support1, "show_builtin_support1");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar2, "toolbar2");
   GLADE_HOOKUP_OBJECT (mainWindow, menutoolbuttonOpen, "menutoolbuttonOpen");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-30 09:34:51 UTC (rev 2989)
@@ -6,6 +6,8 @@
 
 
 */
+
+CALLBACK( connect_to_avsproxy1                  ,ACT_AVS_PROXY);
 CALLBACK( see_hex1                              ,ACT_HEX_DUMP);
 CALLBACK( show_builtin_support1                 ,ACT_BUILT_IN);
 CALLBACK( open_video1         			,ACT_OpenAvi); 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-30 09:34:51 UTC (rev 2989)
@@ -167,8 +167,8 @@
 extern gboolean SliderIsShifted;
 
 void GUI_showCurrentFrameHex(void);
-
-
+void GUI_avsProxy(void);
+uint8_t GUI_close(void);
 //___________________________________________
 // serialization of user event throught gui
 //
@@ -196,6 +196,9 @@
   }
   switch (action)
     {
+        case ACT_AVS_PROXY:
+                                GUI_avsProxy();
+                                return;
         case ACT_BUILT_IN:
                                 DIA_builtin();
                                 return;
@@ -2386,7 +2389,63 @@
   if(!video_body->getUncompressedFrame(frame,image,&flags)) return 0;
   return 1; 
 }
+/**
+    \fn GUI_close
+    \brief Close opened file and cleanup filters etc..
+*/
+uint8_t GUI_close(void)
+{
+  if (avifileinfo)		// already opened ?
+    {				// delete everything
+      // if preview is on
+      if(getPreviewMode()!=ADM_PREVIEW_NONE)
+      {
+	admPreview::stop();
+        setPreviewMode(ADM_PREVIEW_NONE);
+      }
+      delete avifileinfo;
+      //delete wavinfo;
+      wavinfo = (WAVHeader *) NULL;
+      avifileinfo = (aviInfo *) NULL;
+      video_body->cleanup ();
+      curframe = 0;
+      currentaudiostream = NULL;
+      A_changeAudioStream (NULL, AudioNone,NULL);
+      filterCleanUp ();
+      return 1;
+    }
+    return 0;
+}
+/**
+      \fn GUI_avsProxy
+      \brief Shortcut to connect to avsProxy
+*/
 
+void GUI_avsProxy(void)
+{
+  uint8_t res;
+
+
+  GUI_close();
+  res = video_body->addFile ("avsproxy.avs",0,AvsProxy_FileType);
+  // forget last project file
+  if( actual_workbench_file ){
+     ADM_dealloc(actual_workbench_file);
+     actual_workbench_file = NULL;
+  }
+
+  if (res!=ADM_OK)			// an error occured
+    {
+        currentaudiostream = NULL;
+        avifileinfo = NULL;
+        GUI_Error_HIG (_("AvsProxy"), _("Failed to connect to avsproxy.\nIs it running ?"));
+        return ;
+    }
+
+       updateLoaded ();
+       UI_setTitle("avsproxy");
+       return ;
+}
 /**
       \fn GUI_showCurrentFrameHex
       \brief Display the first 32 bytes of the current frame in hex
@@ -2394,7 +2453,7 @@
 
 void GUI_showCurrentFrameHex(void)
 {
-#define DISPLAY_HEX 32
+#define DISPLAY_HEX 32*3
  uint8_t *buffer;
  uint32_t len,fullLen;
  char     string[DISPLAY_HEX*3+6],*s;

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-29 16:12:38 UTC (rev 2988)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-30 09:34:51 UTC (rev 2989)
@@ -188,6 +188,7 @@
 ACT_ZOOM_4_1,
 ACT_BUILT_IN,
 ACT_HEX_DUMP,
+ACT_AVS_PROXY,
 ACT_CUSTOM_BASE,
 ACT_CUSTOM_END=ACT_CUSTOM_BASE+ADM_MAC_CUSTOM_SCRIPT,
 ACT_DUMMY



From mean at mail.berlios.de  Mon Apr 30 11:57:13 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 11:57:13 +0200
Subject: [Avidemux-svn-commit] r2990 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200704300957.l3U9vDkI012589@sheep.berlios.de>

Author: mean
Date: 2007-04-30 11:57:12 +0200 (Mon, 30 Apr 2007)
New Revision: 2990

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
Log:
added close

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-30 09:34:51 UTC (rev 2989)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-04-30 09:57:12 UTC (rev 2990)
@@ -11,11 +11,14 @@
 #include <unistd.h>
 #include <string.h>
 #include <stdio.h>
+
 #include "../ADM_toolkit_gtk/ADM_gladeSupport.h"
 
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
 
+
+
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)
@@ -33,54 +36,55 @@
   GtkWidget *menuitem1;
   GtkWidget *menuitem1_menu;
   GtkWidget *open_video1;
-  GtkWidget *image8071;
+  GtkWidget *image8096;
   GtkWidget *append_video1;
-  GtkWidget *image8072;
+  GtkWidget *image8097;
   GtkWidget *save_stuff;
-  GtkWidget *image8073;
+  GtkWidget *image8098;
   GtkWidget *save_stuff_menu;
   GtkWidget *save_as_avi1;
   GtkWidget *separator1;
   GtkWidget *save_image1;
   GtkWidget *save_jpg_image1;
   GtkWidget *save_selection_as_jpegs1;
+  GtkWidget *close1;
   GtkWidget *separator3;
   GtkWidget *save_project1;
-  GtkWidget *image8074;
+  GtkWidget *image8099;
   GtkWidget *save_project_as1;
-  GtkWidget *image8075;
+  GtkWidget *image8100;
   GtkWidget *run_script1;
-  GtkWidget *image8076;
+  GtkWidget *image8101;
   GtkWidget *add_to_joblist1;
   GtkWidget *joblist1;
   GtkWidget *separator16;
   GtkWidget *connect_to_avsproxy1;
   GtkWidget *separator18;
   GtkWidget *video_informations1;
-  GtkWidget *image8077;
+  GtkWidget *image8102;
   GtkWidget *avi_muxer_options1;
   GtkWidget *separator4;
   GtkWidget *quit1;
-  GtkWidget *image8078;
+  GtkWidget *image8103;
   GtkWidget *menuitem2;
   GtkWidget *menuitem2_menu;
   GtkWidget *reset_edits1;
-  GtkWidget *image8079;
+  GtkWidget *image8104;
   GtkWidget *separator5;
   GtkWidget *cut1;
-  GtkWidget *image8080;
+  GtkWidget *image8105;
   GtkWidget *copy1;
-  GtkWidget *image8081;
+  GtkWidget *image8106;
   GtkWidget *paste1;
-  GtkWidget *image8082;
+  GtkWidget *image8107;
   GtkWidget *delete1;
-  GtkWidget *image8083;
+  GtkWidget *image8108;
   GtkWidget *separator6;
   GtkWidget *set_marker_a1;
   GtkWidget *set_marker_b1;
   GtkWidget *separator7;
   GtkWidget *preferences1;
-  GtkWidget *image8084;
+  GtkWidget *image8109;
   GtkWidget *view1;
   GtkWidget *view1_menu;
   GtkWidget *toolbar1;
@@ -109,13 +113,13 @@
   GtkWidget *build_vbr_time_map1;
   GtkWidget *separator11;
   GtkWidget *save_audio1;
-  GtkWidget *image8085;
+  GtkWidget *image8110;
   GtkWidget *audio_encoder1;
   GtkWidget *filters2;
   GtkWidget *tools1;
   GtkWidget *tools1_menu;
   GtkWidget *calculator1;
-  GtkWidget *image8086;
+  GtkWidget *image8111;
   GtkWidget *separator12;
   GtkWidget *rebuild_frames;
   GtkWidget *check_frames;
@@ -136,34 +140,34 @@
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
-  GtkWidget *image8087;
+  GtkWidget *image8112;
   GtkWidget *previous_frame1;
-  GtkWidget *image8088;
+  GtkWidget *image8113;
   GtkWidget *next_frame1;
-  GtkWidget *image8089;
+  GtkWidget *image8114;
   GtkWidget *previous_intra_frame1;
-  GtkWidget *image8090;
+  GtkWidget *image8115;
   GtkWidget *next_intra_frame1;
-  GtkWidget *image8091;
+  GtkWidget *image8116;
   GtkWidget *search_previous_black_frame1;
   GtkWidget *search_next_black_frame1;
   GtkWidget *first_frame1;
-  GtkWidget *image8092;
+  GtkWidget *image8117;
   GtkWidget *last_frame1;
-  GtkWidget *image8093;
+  GtkWidget *image8118;
   GtkWidget *separator14;
   GtkWidget *go_to_marker_a1;
   GtkWidget *go_to_marker_b1;
   GtkWidget *separator15;
   GtkWidget *jum_to_frame1;
-  GtkWidget *image8094;
+  GtkWidget *image8119;
   GtkWidget *jump_to_time1;
-  GtkWidget *image8095;
+  GtkWidget *image8120;
   GtkWidget *custom1;
   GtkWidget *help2;
   GtkWidget *help2_menu;
   GtkWidget *about1;
-  GtkWidget *image8096;
+  GtkWidget *image8121;
   GtkWidget *show_builtin_support1;
   GtkWidget *toolbar2;
   GtkIconSize tmp_toolbar_icon_size;
@@ -290,9 +294,9 @@
                               GDK_O, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8071 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8071);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8071);
+  image8096 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8096);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8096);
 
   append_video1 = gtk_image_menu_item_new_with_mnemonic (_("_Append..."));
   gtk_widget_show (append_video1);
@@ -301,17 +305,17 @@
                               GDK_A, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8072 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8072);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8072);
+  image8097 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8097);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8097);
 
   save_stuff = gtk_image_menu_item_new_with_mnemonic (_("_Save"));
   gtk_widget_show (save_stuff);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_stuff);
 
-  image8073 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8073);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8073);
+  image8098 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8098);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8098);
 
   save_stuff_menu = gtk_menu_new ();
   gtk_menu_item_set_submenu (GTK_MENU_ITEM (save_stuff), save_stuff_menu);
@@ -340,6 +344,10 @@
   gtk_widget_show (save_selection_as_jpegs1);
   gtk_container_add (GTK_CONTAINER (save_stuff_menu), save_selection_as_jpegs1);
 
+  close1 = gtk_image_menu_item_new_from_stock ("gtk-close", accel_group);
+  gtk_widget_show (close1);
+  gtk_container_add (GTK_CONTAINER (menuitem1_menu), close1);
+
   separator3 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator3);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), separator3);
@@ -349,25 +357,25 @@
   gtk_widget_show (save_project1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project1);
 
-  image8074 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8074);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8074);
+  image8099 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8099);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8099);
 
   save_project_as1 = gtk_image_menu_item_new_with_mnemonic (_("Save P_roject As..."));
   gtk_widget_show (save_project_as1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project_as1);
 
-  image8075 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8075);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8075);
+  image8100 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8100);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8100);
 
   run_script1 = gtk_image_menu_item_new_with_mnemonic (_("_Load/Run Project..."));
   gtk_widget_show (run_script1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), run_script1);
 
-  image8076 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8076);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8076);
+  image8101 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8101);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8101);
 
   add_to_joblist1 = gtk_menu_item_new_with_mnemonic (_("A_dd to Joblist..."));
   gtk_widget_show (add_to_joblist1);
@@ -401,9 +409,9 @@
                               GDK_Return, (GdkModifierType)( GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8077 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8077);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8077);
+  image8102 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8102);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8102);
 
   avi_muxer_options1 = gtk_menu_item_new_with_mnemonic (_("AVI _Muxer Options"));
   gtk_widget_show (avi_muxer_options1);
@@ -421,9 +429,9 @@
                               GDK_Q, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8078 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8078);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8078);
+  image8103 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8103);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8103);
 
   menuitem2 = gtk_menu_item_new_with_mnemonic (_("_Edit"));
   gtk_widget_show (menuitem2);
@@ -436,9 +444,9 @@
   gtk_widget_show (reset_edits1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), reset_edits1);
 
-  image8079 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8079);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8079);
+  image8104 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8104);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8104);
 
   separator5 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator5);
@@ -452,9 +460,9 @@
                               GDK_X, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8080 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8080);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8080);
+  image8105 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8105);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8105);
 
   copy1 = gtk_image_menu_item_new_with_mnemonic (_("_Copy"));
   gtk_widget_show (copy1);
@@ -463,9 +471,9 @@
                               GDK_C, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8081 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8081);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8081);
+  image8106 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8106);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8106);
 
   paste1 = gtk_image_menu_item_new_with_mnemonic (_("_Paste"));
   gtk_widget_show (paste1);
@@ -474,9 +482,9 @@
                               GDK_V, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8082 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8082);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8082);
+  image8107 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8107);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8107);
 
   delete1 = gtk_image_menu_item_new_with_mnemonic (_("_Delete"));
   gtk_widget_show (delete1);
@@ -485,9 +493,9 @@
                               GDK_Delete, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8083 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8083);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8083);
+  image8108 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8108);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8108);
 
   separator6 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator6);
@@ -517,9 +525,9 @@
   gtk_widget_show (preferences1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), preferences1);
 
-  image8084 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8084);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8084);
+  image8109 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8109);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8109);
 
   view1 = gtk_menu_item_new_with_mnemonic (_("_View"));
   gtk_widget_show (view1);
@@ -673,9 +681,9 @@
                               GDK_S, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8085 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8085);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8085);
+  image8110 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8110);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8110);
 
   audio_encoder1 = gtk_menu_item_new_with_mnemonic (_("_Encoder"));
   gtk_widget_show (audio_encoder1);
@@ -702,9 +710,9 @@
                               GDK_F7, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8086 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
-  gtk_widget_show (image8086);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8086);
+  image8111 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
+  gtk_widget_show (image8111);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8111);
 
   separator12 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator12);
@@ -790,9 +798,9 @@
                               GDK_P, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8087 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8087);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8087);
+  image8112 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8112);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8112);
 
   previous_frame1 = gtk_image_menu_item_new_with_mnemonic (_("P_revious Frame"));
   gtk_widget_show (previous_frame1);
@@ -801,9 +809,9 @@
                               GDK_KP_4, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8088 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8088);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8088);
+  image8113 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8113);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8113);
 
   next_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Next Frame"));
   gtk_widget_show (next_frame1);
@@ -812,9 +820,9 @@
                               GDK_KP_6, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8089 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8089);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8089);
+  image8114 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8114);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8114);
 
   previous_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Pr_evious Intra Frame"));
   gtk_widget_show (previous_intra_frame1);
@@ -823,9 +831,9 @@
                               GDK_KP_2, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8090 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8090);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8090);
+  image8115 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8115);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8115);
 
   next_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Next _Intra Frame"));
   gtk_widget_show (next_intra_frame1);
@@ -834,9 +842,9 @@
                               GDK_KP_8, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8091 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8091);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8091);
+  image8116 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8116);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8116);
 
   search_previous_black_frame1 = gtk_menu_item_new_with_mnemonic (_("Previou_s Black Frame"));
   gtk_widget_show (search_previous_black_frame1);
@@ -853,9 +861,9 @@
                               GDK_Home, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8092 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8092);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8092);
+  image8117 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8117);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8117);
 
   last_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Last Frame"));
   gtk_widget_show (last_frame1);
@@ -864,9 +872,9 @@
                               GDK_End, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8093 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8093);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8093);
+  image8118 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8118);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8118);
 
   separator14 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator14);
@@ -899,9 +907,9 @@
                               GDK_F, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8094 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8094);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8094);
+  image8119 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8119);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8119);
 
   jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_("Jump to _Time..."));
   gtk_widget_show (jump_to_time1);
@@ -910,9 +918,9 @@
                               GDK_T, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8095 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8095);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8095);
+  image8120 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8120);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8120);
 
   custom1 = gtk_menu_item_new_with_mnemonic (_("Custom"));
   gtk_widget_show (custom1);
@@ -929,9 +937,9 @@
   gtk_widget_show (about1);
   gtk_container_add (GTK_CONTAINER (help2_menu), about1);
 
-  image8096 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8096);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8096);
+  image8121 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8121);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8121);
 
   show_builtin_support1 = gtk_menu_item_new_with_mnemonic (_("Show builtin support"));
   gtk_widget_show (show_builtin_support1);
@@ -1433,54 +1441,55 @@
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1, "menuitem1");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1_menu, "menuitem1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, open_video1, "open_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8071, "image8071");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8096, "image8096");
   GLADE_HOOKUP_OBJECT (mainWindow, append_video1, "append_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8072, "image8072");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8097, "image8097");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff, "save_stuff");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8073, "image8073");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8098, "image8098");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff_menu, "save_stuff_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, save_as_avi1, "save_as_avi1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator1, "separator1");
   GLADE_HOOKUP_OBJECT (mainWindow, save_image1, "save_image1");
   GLADE_HOOKUP_OBJECT (mainWindow, save_jpg_image1, "save_jpg_image1");
   GLADE_HOOKUP_OBJECT (mainWindow, save_selection_as_jpegs1, "save_selection_as_jpegs1");
+  GLADE_HOOKUP_OBJECT (mainWindow, close1, "close1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator3, "separator3");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project1, "save_project1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8074, "image8074");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8099, "image8099");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project_as1, "save_project_as1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8075, "image8075");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8100, "image8100");
   GLADE_HOOKUP_OBJECT (mainWindow, run_script1, "run_script1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8076, "image8076");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8101, "image8101");
   GLADE_HOOKUP_OBJECT (mainWindow, add_to_joblist1, "add_to_joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, joblist1, "joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator16, "separator16");
   GLADE_HOOKUP_OBJECT (mainWindow, connect_to_avsproxy1, "connect_to_avsproxy1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator18, "separator18");
   GLADE_HOOKUP_OBJECT (mainWindow, video_informations1, "video_informations1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8077, "image8077");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8102, "image8102");
   GLADE_HOOKUP_OBJECT (mainWindow, avi_muxer_options1, "avi_muxer_options1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator4, "separator4");
   GLADE_HOOKUP_OBJECT (mainWindow, quit1, "quit1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8078, "image8078");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8103, "image8103");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2, "menuitem2");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2_menu, "menuitem2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, reset_edits1, "reset_edits1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8079, "image8079");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8104, "image8104");
   GLADE_HOOKUP_OBJECT (mainWindow, separator5, "separator5");
   GLADE_HOOKUP_OBJECT (mainWindow, cut1, "cut1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8080, "image8080");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8105, "image8105");
   GLADE_HOOKUP_OBJECT (mainWindow, copy1, "copy1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8081, "image8081");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8106, "image8106");
   GLADE_HOOKUP_OBJECT (mainWindow, paste1, "paste1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8082, "image8082");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8107, "image8107");
   GLADE_HOOKUP_OBJECT (mainWindow, delete1, "delete1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8083, "image8083");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8108, "image8108");
   GLADE_HOOKUP_OBJECT (mainWindow, separator6, "separator6");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_a1, "set_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_b1, "set_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator7, "separator7");
   GLADE_HOOKUP_OBJECT (mainWindow, preferences1, "preferences1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8084, "image8084");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8109, "image8109");
   GLADE_HOOKUP_OBJECT (mainWindow, view1, "view1");
   GLADE_HOOKUP_OBJECT (mainWindow, view1_menu, "view1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar1, "toolbar1");
@@ -1509,13 +1518,13 @@
   GLADE_HOOKUP_OBJECT (mainWindow, build_vbr_time_map1, "build_vbr_time_map1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator11, "separator11");
   GLADE_HOOKUP_OBJECT (mainWindow, save_audio1, "save_audio1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8085, "image8085");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8110, "image8110");
   GLADE_HOOKUP_OBJECT (mainWindow, audio_encoder1, "audio_encoder1");
   GLADE_HOOKUP_OBJECT (mainWindow, filters2, "filters2");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1, "tools1");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1_menu, "tools1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, calculator1, "calculator1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8086, "image8086");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8111, "image8111");
   GLADE_HOOKUP_OBJECT (mainWindow, separator12, "separator12");
   GLADE_HOOKUP_OBJECT (mainWindow, rebuild_frames, "rebuild_frames");
   GLADE_HOOKUP_OBJECT (mainWindow, check_frames, "check_frames");
@@ -1536,34 +1545,34 @@
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8087, "image8087");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8112, "image8112");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_frame1, "previous_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8088, "image8088");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8113, "image8113");
   GLADE_HOOKUP_OBJECT (mainWindow, next_frame1, "next_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8089, "image8089");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8114, "image8114");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_intra_frame1, "previous_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8090, "image8090");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8115, "image8115");
   GLADE_HOOKUP_OBJECT (mainWindow, next_intra_frame1, "next_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8091, "image8091");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8116, "image8116");
   GLADE_HOOKUP_OBJECT (mainWindow, search_previous_black_frame1, "search_previous_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, search_next_black_frame1, "search_next_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, first_frame1, "first_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8092, "image8092");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8117, "image8117");
   GLADE_HOOKUP_OBJECT (mainWindow, last_frame1, "last_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8093, "image8093");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8118, "image8118");
   GLADE_HOOKUP_OBJECT (mainWindow, separator14, "separator14");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_a1, "go_to_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_b1, "go_to_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator15, "separator15");
   GLADE_HOOKUP_OBJECT (mainWindow, jum_to_frame1, "jum_to_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8094, "image8094");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8119, "image8119");
   GLADE_HOOKUP_OBJECT (mainWindow, jump_to_time1, "jump_to_time1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8095, "image8095");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8120, "image8120");
   GLADE_HOOKUP_OBJECT (mainWindow, custom1, "custom1");
   GLADE_HOOKUP_OBJECT (mainWindow, help2, "help2");
   GLADE_HOOKUP_OBJECT (mainWindow, help2_menu, "help2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, about1, "about1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8096, "image8096");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8121, "image8121");
   GLADE_HOOKUP_OBJECT (mainWindow, show_builtin_support1, "show_builtin_support1");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar2, "toolbar2");
   GLADE_HOOKUP_OBJECT (mainWindow, menutoolbuttonOpen, "menutoolbuttonOpen");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-30 09:34:51 UTC (rev 2989)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-04-30 09:57:12 UTC (rev 2990)
@@ -9,6 +9,10 @@
 
 CALLBACK( connect_to_avsproxy1                  ,ACT_AVS_PROXY);
 CALLBACK( see_hex1                              ,ACT_HEX_DUMP);
+
+CALLBACK( close1                                ,ACT_CLOSE);
+
+
 CALLBACK( show_builtin_support1                 ,ACT_BUILT_IN);
 CALLBACK( open_video1         			,ACT_OpenAvi); 
 CALLBACK( append_video1     			,ACT_AppendAvi);

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-30 09:34:51 UTC (rev 2989)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-04-30 09:57:12 UTC (rev 2990)
@@ -389,6 +389,9 @@
   // we have an AVI loaded
   switch (action)
     {
+       case ACT_CLOSE:
+              GUI_close();
+              break;
 
         case ACT_ZOOM_1_4:
         case ACT_ZOOM_1_2:
@@ -893,26 +896,8 @@
   fclose (fd);
 
 
-  if (avifileinfo)		// already opened ?
-    {				// delete everything
-      // if preview is on
-      if(getPreviewMode()!=ADM_PREVIEW_NONE)
-      {
-	admPreview::stop();
-        setPreviewMode(ADM_PREVIEW_NONE);
-      }
-      delete avifileinfo;
-      //delete wavinfo;
-      wavinfo = (WAVHeader *) NULL;
-      avifileinfo = (aviInfo *) NULL;
-      video_body->cleanup ();
-      curframe = 0;
-      currentaudiostream = NULL;
-      A_changeAudioStream (NULL, AudioNone,NULL);
-      filterCleanUp ();
-
-
-    }
+  GUI_close(); // Cleanup
+  
   DIA_StartBusy ();
   /*
   ** we may get a relative path by cmdline

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-30 09:34:51 UTC (rev 2989)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-04-30 09:57:12 UTC (rev 2990)
@@ -20,10 +20,12 @@
 #define ADM_MAC_CUSTOM_SCRIPT 10
 typedef enum
 {
+  
   ACT_OpenAvi = 1,
   ACT_AppendAvi,
   ACT_BrokenAvi ,
   ACT_AviInfo,
+  ACT_CLOSE,
   ACT_Exit,
   ACT_PlayAvi,
   ACT_StopAvi,



From mean at mail.berlios.de  Mon Apr 30 11:58:20 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 11:58:20 +0200
Subject: [Avidemux-svn-commit] r2991 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade
Message-ID: <200704300958.l3U9wK22012707@sheep.berlios.de>

Author: mean
Date: 2007-04-30 11:58:19 +0200 (Mon, 30 Apr 2007)
New Revision: 2991

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
Log:
up to date glade file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2007-04-30 09:57:12 UTC (rev 2990)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2007-04-30 09:58:19 UTC (rev 2991)
@@ -50,7 +50,7 @@
 		      <accelerator key="O" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image7996">
+			<widget class="GtkImage" id="image8096">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-open</property>
 			  <property name="icon_size">1</property>
@@ -71,7 +71,7 @@
 		      <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image7997">
+			<widget class="GtkImage" id="image8097">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-add</property>
 			  <property name="icon_size">1</property>
@@ -91,7 +91,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image7998">
+			<widget class="GtkImage" id="image8098">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save</property>
 			  <property name="icon_size">1</property>
@@ -149,6 +149,14 @@
 		  </child>
 
 		  <child>
+		    <widget class="GtkImageMenuItem" id="close1">
+		      <property name="visible">True</property>
+		      <property name="label">gtk-close</property>
+		      <property name="use_stock">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
 		    <widget class="GtkSeparatorMenuItem" id="separator3">
 		      <property name="visible">True</property>
 		    </widget>
@@ -161,7 +169,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image7999">
+			<widget class="GtkImage" id="image8099">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save</property>
 			  <property name="icon_size">1</property>
@@ -181,7 +189,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8000">
+			<widget class="GtkImage" id="image8100">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save-as</property>
 			  <property name="icon_size">1</property>
@@ -201,7 +209,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8001">
+			<widget class="GtkImage" id="image8101">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-execute</property>
 			  <property name="icon_size">1</property>
@@ -238,6 +246,20 @@
 		  </child>
 
 		  <child>
+		    <widget class="GtkMenuItem" id="connect_to_avsproxy1">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Connect to avsproxy</property>
+		      <property name="use_underline">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
+		    <widget class="GtkSeparatorMenuItem" id="separator18">
+		      <property name="visible">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
 		    <widget class="GtkImageMenuItem" id="video_informations1">
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">Proper_ties</property>
@@ -245,7 +267,7 @@
 		      <accelerator key="Return" modifiers="GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8002">
+			<widget class="GtkImage" id="image8102">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-properties</property>
 			  <property name="icon_size">1</property>
@@ -280,7 +302,7 @@
 		      <accelerator key="Q" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8003">
+			<widget class="GtkImage" id="image8103">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-quit</property>
 			  <property name="icon_size">1</property>
@@ -313,7 +335,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8004">
+			<widget class="GtkImage" id="image8104">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-undo</property>
 			  <property name="icon_size">1</property>
@@ -340,7 +362,7 @@
 		      <accelerator key="X" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8005">
+			<widget class="GtkImage" id="image8105">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-cut</property>
 			  <property name="icon_size">1</property>
@@ -361,7 +383,7 @@
 		      <accelerator key="C" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8006">
+			<widget class="GtkImage" id="image8106">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-copy</property>
 			  <property name="icon_size">1</property>
@@ -382,7 +404,7 @@
 		      <accelerator key="V" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8007">
+			<widget class="GtkImage" id="image8107">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-paste</property>
 			  <property name="icon_size">1</property>
@@ -403,7 +425,7 @@
 		      <accelerator key="Delete" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8008">
+			<widget class="GtkImage" id="image8108">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-remove</property>
 			  <property name="icon_size">1</property>
@@ -453,7 +475,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8009">
+			<widget class="GtkImage" id="image8109">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-preferences</property>
 			  <property name="icon_size">1</property>
@@ -689,7 +711,7 @@
 		      <accelerator key="S" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8010">
+			<widget class="GtkImage" id="image8110">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save-as</property>
 			  <property name="icon_size">1</property>
@@ -740,7 +762,7 @@
 		      <accelerator key="F7" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8011">
+			<widget class="GtkImage" id="image8111">
 			  <property name="visible">True</property>
 			  <property name="pixbuf">gnome-calculator_small.xpm</property>
 			  <property name="xalign">0.5</property>
@@ -811,6 +833,20 @@
 		      <property name="use_underline">True</property>
 		    </widget>
 		  </child>
+
+		  <child>
+		    <widget class="GtkSeparatorMenuItem" id="separator17">
+		      <property name="visible">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
+		    <widget class="GtkMenuItem" id="see_hex1">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">See Hex</property>
+		      <property name="use_underline">True</property>
+		    </widget>
+		  </child>
 		</widget>
 	      </child>
 	    </widget>
@@ -862,7 +898,6 @@
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">PSP (H264)</property>
 		      <property name="use_underline">True</property>
-		      <signal name="activate" handler="on_psp_h264_activate" last_modification_time="Mon, 01 Jan 2007 13:24:11 GMT"/>
 		    </widget>
 		  </child>
 		</widget>
@@ -887,7 +922,7 @@
 		      <accelerator key="P" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8012">
+			<widget class="GtkImage" id="image8112">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-play</property>
 			  <property name="icon_size">1</property>
@@ -908,7 +943,7 @@
 		      <accelerator key="KP_4" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8013">
+			<widget class="GtkImage" id="image8113">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-previous</property>
 			  <property name="icon_size">1</property>
@@ -929,7 +964,7 @@
 		      <accelerator key="KP_6" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8014">
+			<widget class="GtkImage" id="image8114">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-next</property>
 			  <property name="icon_size">1</property>
@@ -950,7 +985,7 @@
 		      <accelerator key="KP_2" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8015">
+			<widget class="GtkImage" id="image8115">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-rewind</property>
 			  <property name="icon_size">1</property>
@@ -971,7 +1006,7 @@
 		      <accelerator key="KP_8" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8016">
+			<widget class="GtkImage" id="image8116">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-forward</property>
 			  <property name="icon_size">1</property>
@@ -1008,7 +1043,7 @@
 		      <accelerator key="Home" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8017">
+			<widget class="GtkImage" id="image8117">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-goto-first</property>
 			  <property name="icon_size">1</property>
@@ -1029,7 +1064,7 @@
 		      <accelerator key="End" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8018">
+			<widget class="GtkImage" id="image8118">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-goto-last</property>
 			  <property name="icon_size">1</property>
@@ -1080,7 +1115,7 @@
 		      <accelerator key="F" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8019">
+			<widget class="GtkImage" id="image8119">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-jump-to</property>
 			  <property name="icon_size">1</property>
@@ -1101,7 +1136,7 @@
 		      <accelerator key="T" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8020">
+			<widget class="GtkImage" id="image8120">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-jump-to</property>
 			  <property name="icon_size">1</property>
@@ -1142,7 +1177,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8021">
+			<widget class="GtkImage" id="image8121">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-about</property>
 			  <property name="icon_size">1</property>
@@ -1284,38 +1319,24 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkToggleToolButton" id="toggletoolbuttonPreview">
+	    <widget class="GtkToolItem" id="toolitem12">
 	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Preview filtered video in a new window</property>
-	      <property name="label" translatable="yes">Preview</property>
-	      <property name="use_underline">True</property>
-	      <property name="icon">preview.png</property>
 	      <property name="visible_horizontal">True</property>
 	      <property name="visible_vertical">True</property>
 	      <property name="is_important">False</property>
-	      <property name="active">False</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">True</property>
-	    </packing>
-	  </child>
 
-	  <child>
-	    <widget class="GtkToggleToolButton" id="toggletoolbuttonOutput">
-	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Display filtered output in the main window</property>
-	      <property name="label" translatable="yes">Output</property>
-	      <property name="use_underline">True</property>
-	      <property name="icon">output.png</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-	      <property name="active">False</property>
+	      <child>
+		<widget class="GtkComboBox" id="comboboxPreview">
+		  <property name="visible">True</property>
+		  <property name="items" translatable="yes"></property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="expand">False</property>
-	      <property name="homogeneous">True</property>
+	      <property name="homogeneous">False</property>
 	    </packing>
 	  </child>
 	</widget>
@@ -1424,7 +1445,7 @@
 				      <property name="visible">True</property>
 				      <property name="tooltip" translatable="yes">Configure video encoder</property>
 				      <property name="can_focus">True</property>
-				      <property name="label">Configure</property>
+				      <property name="label" translatable="yes">Configure</property>
 				      <property name="use_underline">True</property>
 				      <property name="relief">GTK_RELIEF_NORMAL</property>
 				      <property name="focus_on_click">True</property>
@@ -1539,7 +1560,7 @@
 				      <property name="visible">True</property>
 				      <property name="tooltip" translatable="yes">Configure audio encoder</property>
 				      <property name="can_focus">True</property>
-				      <property name="label">Configure</property>
+				      <property name="label" translatable="yes">Configure</property>
 				      <property name="use_underline">True</property>
 				      <property name="relief">GTK_RELIEF_NORMAL</property>
 				      <property name="focus_on_click">True</property>
@@ -1730,15 +1751,6 @@
 			      <child>
 				<widget class="GtkComboBox" id="comboboxFormat">
 				  <property name="visible">True</property>
-				  <property name="items" translatable="yes">AVI
-AVI, unp. VOP
-AVI, dual audio
-OGM
-MPEG video
-MPEG PS A+V
-MPEG TS A+V
-MP4
-PSP</property>
 				  <property name="add_tearoffs">False</property>
 				  <property name="focus_on_click">True</property>
 				</widget>



From mean at mail.berlios.de  Mon Apr 30 13:21:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 13:21:30 +0200
Subject: [Avidemux-svn-commit] r2992 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200704301121.l3UBLUC5028853@sheep.berlios.de>

Author: mean
Date: 2007-04-30 13:21:29 +0200 (Mon, 30 Apr 2007)
New Revision: 2992

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
Log:
add info for avc : escape/not escaped

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-30 09:58:19 UTC (rev 2991)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h264.c	2007-04-30 11:21:29 UTC (rev 2992)
@@ -417,7 +417,20 @@
 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
 };
 
+/* MEANX */
+int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
+{
+      H264Context *h = avctx->priv_data;
+      assert(h);
+      *nalSize=h->nal_length_size;
+      *isAvc=h->is_avc;
+	return 1;
 
+  }
+/* MeanX */
+
+
+
 /**
  * fill a rectangle.
  * @param h height of the rectangle, should be a constant
@@ -8075,12 +8088,7 @@
         int i, nalsize = 0;
 
       if(h->is_avc) {
-        if(buf_index==buf_size) break;
-        if(buf_index +h->nal_length_size>= buf_size) 
-        {
-          av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal_size does not fit in buffer (need %d bytes, only %d available)\n",h->nal_length_size,buf_size-buf_index);
-          break;
-        }
+        if(buf_index >= buf_size) break;
         nalsize = 0;
         for(i = 0; i < h->nal_length_size; i++)
             nalsize = (nalsize << 8) | buf[buf_index++];
@@ -8089,7 +8097,7 @@
                 buf_index++;
                 continue;
             }else{
-                av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal does not fit in buffer, need %d\n", nalsize);
+                av_log(h->s.avctx, AV_LOG_ERROR, "AVC: nal size %d\n", nalsize);
                 break;
             }
         }



From mean at mail.berlios.de  Mon Apr 30 13:22:46 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 13:22:46 +0200
Subject: [Avidemux-svn-commit] r2993 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704301122.l3UBMkF7030502@sheep.berlios.de>

Author: mean
Date: 2007-04-30 13:22:46 +0200 (Mon, 30 Apr 2007)
New Revision: 2993

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
Log:
grunster: compile on 32 bits

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-30 11:21:29 UTC (rev 2992)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp	2007-04-30 11:22:46 UTC (rev 2993)
@@ -359,7 +359,7 @@
   
   // Search segment
    
-   parser->seek(0x7000000000); //Hackish, fixme
+   parser->seek(0x7000000000LL); //Hackish, fixme
    fileSize=parser->tell();
    parser->seek(0);
    



From mean at mail.berlios.de  Mon Apr 30 15:17:59 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 15:17:59 +0200
Subject: [Avidemux-svn-commit] r2995 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
Message-ID: <200704301317.l3UDHxar006187@sheep.berlios.de>

Author: mean
Date: 2007-04-30 15:17:58 +0200 (Mon, 30 Apr 2007)
New Revision: 2995

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
Log:
fix rounding issue (spotted by Teetrinker)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-04-30 12:45:15 UTC (rev 2994)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-04-30 13:17:58 UTC (rev 2995)
@@ -453,9 +453,11 @@
             f/=1000000.; // In ms seconds 
             f*=_audioFq;
             
+            f=floor(f+0.4);
+            pkt.dts=pkt.pts=(int)(f);
+
+            //printf("F:%f Q:%u D=%u\n",f,pkt.pts,timeInUs-_lastAudioDts);
             
-            pkt.dts=pkt.pts=(int)f;
-
             pkt.flags |= PKT_FLAG_KEY; 
             pkt.data= buf;
             pkt.size= len;



From mean at mail.berlios.de  Mon Apr 30 16:32:14 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 16:32:14 +0200
Subject: [Avidemux-svn-commit] r2996 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200704301432.l3UEWExF011412@sheep.berlios.de>

Author: mean
Date: 2007-04-30 16:32:14 +0200 (Mon, 30 Apr 2007)
New Revision: 2996

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
Log:
disable postproc for h264, different quant ranges

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-04-30 13:17:58 UTC (rev 2995)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-04-30 14:32:14 UTC (rev 2996)
@@ -96,7 +96,7 @@
   out->flags = frameType ();
 
   // Quant ?
-  if (src->qstride && src->qscale_table)
+  if (src->qstride && src->qscale_table && codecId != CODEC_ID_H264)
     {
       out->quant = (uint8_t *) src->qscale_table;
       out->_qStride = src->qstride;



From mean at mail.berlios.de  Mon Apr 30 16:48:21 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 30 Apr 2007 16:48:21 +0200
Subject: [Avidemux-svn-commit] r2997 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200704301448.l3UEmL6O012408@sheep.berlios.de>

Author: mean
Date: 2007-04-30 16:48:21 +0200 (Mon, 30 Apr 2007)
New Revision: 2997

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
Log:
multi track support for mkv

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-30 14:32:14 UTC (rev 2996)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp	2007-04-30 14:48:21 UTC (rev 2997)
@@ -207,7 +207,7 @@
 {
   if(_nbAudioTrack)
   {
-    return &(_tracks[1].wavHeader); 
+    return &(_tracks[1+_currentAudioTrack].wavHeader); 
   }
   return NULL;
 }
@@ -219,7 +219,7 @@
 {
   if(_nbAudioTrack)
   {
-      *audio=new mkvAudio(_filename,&(_tracks[1]),_clusters,_nbClusters);
+      *audio=new mkvAudio(_filename,&(_tracks[_currentAudioTrack+1]),_clusters,_nbClusters);
       return 1;
   }
   *audio=NULL;
@@ -274,7 +274,7 @@
   }
   for(int i=0;i<_nbAudioTrack;i++)
   {
-    mkvIndex **dx=&(_tracks[1+1]._index);
+    mkvIndex **dx=&(_tracks[1+i]._index);
     if(*dx)
     {
         delete []  *dx;
@@ -305,6 +305,7 @@
   _clusters=NULL;
   _clustersCeil=0;
   _nbClusters=0;
+  _currentAudioTrack=0;
 }
 /*
     __________________________________________________________
@@ -397,4 +398,49 @@
      _tracks[0]._nbIndex=_videostream.dwLength;
          return 1;
 }
+/*
+    __________________________________________________________
+*/
+uint8_t  mkvHeader::changeAudioStream(uint32_t newstream)
+{
+    ADM_assert(_currentAudioTrack<_nbAudioTrack);
+    _currentAudioTrack=newstream;
+    return 1;
+}
+/*
+    __________________________________________________________
+*/
+uint32_t  mkvHeader::getCurrentAudioStreamNumber(void)
+{
+  return _currentAudioTrack;
+}
+/**
+    \fn getAudioStreamsInfo
+    \brief returns infos about audio streams (code,...)
+    @param nbStreams (out) nb audio streams
+    @param infos (out) pointer to streams info. It is up to the caller to free them.
+*/
+uint8_t  mkvHeader::getAudioStreamsInfo(uint32_t *nbStreams, audioInfo **infos)
+{
+    if(!_nbAudioTrack)
+    {
+        *nbStreams=0;
+        *infos=NULL;
+        return 1;
+    }
+    *nbStreams=_nbAudioTrack;
+    *infos=new audioInfo[_nbAudioTrack];
+    memset(*infos,0,sizeof(audioInfo)*_nbAudioTrack);
+    for(int i=0;i<_nbAudioTrack;i++)
+    {
+      audioInfo *inf=&((*infos)[i]);
+      WAVHeader *head=&(_tracks[i+1].wavHeader);
+      inf->encoding=head->encoding;
+      inf->bitrate=(head->byterate*8)/1000;
+      inf->channels=head->channels;
+      inf->frequency=head->frequency;
+    }
+    return 1;
+}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-30 14:32:14 UTC (rev 2996)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h	2007-04-30 14:48:21 UTC (rev 2997)
@@ -102,6 +102,7 @@
     uint32_t                    _clustersCeil;
  
     uint32_t                _nbAudioTrack;
+    uint32_t                _currentAudioTrack;
     uint32_t                _reordered;
     
     uint8_t                 checkHeader(void *head,uint32_t headlen);
@@ -117,6 +118,11 @@
     uint8_t                 readCue(ADM_ebml_file *parser);
     uint8_t                 indexClusters(ADM_ebml_file *parser);
     uint8_t                 indexBlock(ADM_ebml_file *parser,uint32_t count);
+    
+    uint8_t                 changeAudioStream(uint32_t newstream);
+    uint32_t                getCurrentAudioStreamNumber(void);
+    uint8_t                 getAudioStreamsInfo(uint32_t *nbStreams, audioInfo **infos);
+    
   public:
 
 



