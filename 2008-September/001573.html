<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4333 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_QT4/src ADM_coreImage/include	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4333%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_QT4/src%20ADM_coreImage/include%0A%09ADM_userInterfaces/ADM_GTK/ADM_filters%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui&In-Reply-To=%3C200809132313.m8DND9bQ026890%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001572.html">
   <LINK REL="Next"  HREF="001574.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4333 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_QT4/src ADM_coreImage/include	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4333%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_QT4/src%20ADM_coreImage/include%0A%09ADM_userInterfaces/ADM_GTK/ADM_filters%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui&In-Reply-To=%3C200809132313.m8DND9bQ026890%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4333 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_QT4/src ADM_coreImage/include	ADM_userInterfaces/ADM_GTK/ADM_filters	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui">gruntster at mail.berlios.de
       </A><BR>
    <I>Sun Sep 14 01:13:09 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001572.html">[Avidemux-svn-commit] r4332 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters:	AvisynthResize/qt4 MplayerResize/qt4
</A></li>
        <LI>Next message: <A HREF="001574.html">[Avidemux-svn-commit] r4334 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_codecs	avidemux/ADM_core/include avidemux/ADM_core/src	plugins/ADM_videoEncoder/ADM_vidEnc_x264
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1573">[ date ]</a>
              <a href="thread.html#1573">[ thread ]</a>
              <a href="subject.html#1573">[ subject ]</a>
              <a href="author.html#1573">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-09-14 01:12:54 +0200 (Sun, 14 Sep 2008)
New Revision: 4333

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/seekablePreview.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/preview.ui
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/seekablePreview.ui
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
Log:
[Merge] integrate changes from 2.4 branch (r4320)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -24,13 +24,7 @@
 #include &quot;DIA_coreUI_internal.h&quot;
 
 static void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab);
-factoryWindow::factoryWindow()     : QDialog()
- {
-//     ui.setupUi(this);
-     //connect( (ui.pushButton),SIGNAL(pressed()),this,SLOT(buttonPressed()));
- }
 
-
 /**
     \fn qt4DiaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
     \brief  Run a dialog made of nb elems, each elem being described in the **elems
@@ -39,7 +33,7 @@
 
 uint8_t qt4DiaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
 {
-  factoryWindow dialog;
+  QDialog dialog;
   
   ADM_assert(title);
   ADM_assert(nb);
@@ -47,16 +41,11 @@
   
   dialog.setWindowTitle(QString::fromUtf8(title));
   
-  QGridLayout layout(&amp;dialog);
+  QVBoxLayout vboxLayout;
+  QGridLayout layout;
   
-  /* First compute the size of our window */
-  int vsize=0;
-  for(int i=0;i&lt;nb;i++)
-  {
-    ADM_assert(elems[i]);
-     vsize+=elems[i]-&gt;getSize(); 
-  }
-
+  vboxLayout.addLayout(&amp;layout);
+  
  int  v=0;
   for(int i=0;i&lt;nb;i++)
   {
@@ -70,15 +59,15 @@
     ADM_assert(elems[i]);
      elems[i]-&gt;finalize(); 
   }
+
   // Add buttons
-   QDialogButtonBox buttonBox((QWidget *)&amp;dialog);
-    buttonBox.setStandardButtons(QDialogButtonBox::Ok
-                            | QDialogButtonBox::Cancel);
+   QDialogButtonBox buttonBox(&amp;dialog);
+    buttonBox.setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
      QObject::connect(&amp;buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
      QObject::connect(&amp;buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
-     layout.addWidget(&amp;buttonBox,vsize,0);
-  // run
-  dialog.setLayout(&amp;layout);
+     vboxLayout.addWidget(&amp;buttonBox);
+	 dialog.setLayout(&amp;vboxLayout);
+
   if(dialog.exec()==QDialog::Accepted)
   {
      for(int i=0;i&lt;nb;i++)
@@ -110,7 +99,7 @@
  */
 uint8_t qt4DiaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs)
 {
-    factoryWindow dialog;
+    QDialog dialog;
   
   ADM_assert(title);
   ADM_assert(nb);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_flyDialogQt4.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -32,11 +32,12 @@
 {
 	QWidget *graphicsView = ((ADM_QCanvas*)_canvas)-&gt;parentWidget();
 	QSlider  *slider=(QSlider *)_slider;
-	
+
 	graphicsView-&gt;setMinimumSize(_w, _h);
 	graphicsView-&gt;resize(_w, _h);
-	uint32_t nbFrames=_in-&gt;getInfo()-&gt;nb_frames; 
-	slider-&gt;setMaximum(nbFrames);
+
+	if (slider)
+		slider-&gt;setMaximum(_in-&gt;getInfo()-&gt;nb_frames);
 }
 
 float ADM_flyDialogQt4::calcZoomFactor(void) {return 1;}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/include/ADM_videoFilter.h	2008-09-13 23:12:54 UTC (rev 4333)
@@ -135,7 +135,6 @@
 uint8_t  DIA_previewUpdate(uint8_t *data);
 void 	 DIA_previewEnd(void);
 uint8_t  DIA_previewStillAlive(void);
-uint8_t	 DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame);
 
  // Pseudo class used to register filters automagically
  // Does not work atm

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -49,6 +49,7 @@
 						    AVDMGenericVideoStream *
 						    in);
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
+extern uint8_t DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame);
 //___________________________________________
 extern FILTER videofilters[VF_MAX_FILTER];
 extern uint32_t nb_active_filter;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -23,4 +23,3 @@
 uint8_t DIA_previewUpdate(uint8_t *buffer) {return 1;}
 void DIA_previewEnd(void) {}
 uint8_t DIA_previewStillAlive(void) {return 1;}
-uint8_t DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame) {}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/CMakeLists.txt	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/CMakeLists.txt	2008-09-13 23:12:54 UTC (rev 4333)
@@ -1,11 +1,11 @@
 SET(ADM_LIB ADM_filtersQt4)
 
-QT4_WRAP_UI(${ADM_LIB}_header  mainfilter.ui)
-QT4_WRAP_CPP(${ADM_LIB}_source  Q_mainfilter.h)
+QT4_WRAP_UI(${ADM_LIB}_header  mainfilter.ui  seekablePreview.ui)
+QT4_WRAP_CPP(${ADM_LIB}_source  Q_mainfilter.h  Q_seekablePreview.h)
 QT4_ADD_RESOURCES(${ADM_LIB}_resource  filter.qrc)
 
 SET(${ADM_LIB}_SRCS
-	filter_none.cpp  Q_mainfilter.cpp  ${${ADM_LIB}_header}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource})
+	filter_none.cpp  Q_mainfilter.cpp  Q_seekablePreview.cpp ${${ADM_LIB}_header}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource})
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})
 ADD_ADM_LIB_QT4_TARGET(${ADM_LIB} ${${ADM_LIB}_SRCS})
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -52,6 +52,7 @@
 #define EXTERNAL_FILTER_BASE  2000
 #define ACTIVE_FILTER_BASE    3000
 /******************************************************/
+extern QWidget *QuiMainWindows;
 extern FILTER videofilters[VF_MAX_FILTER];
 extern uint32_t nb_active_filter;
 extern std::vector &lt;FilterDescriptor *&gt; allfilters;
@@ -132,9 +133,32 @@
 	ADM_assert(itag &gt; ACTIVE_FILTER_BASE);
 	itag -= ACTIVE_FILTER_BASE;
 
-	DIA_filterPreview(QT_TR_NOOP(&quot;Preview&quot;), videofilters[itag].filter, curframe);
+	if (previewDialog)
+		previewDialog-&gt;resetVideoStream(videofilters[itag].filter);
+	else
+	{
+		previewDialog = new Ui_seekablePreviewWindow(this, videofilters[itag].filter, previewFrameIndex);
+
+		if (previewDialogX != INT_MIN)
+			previewDialog-&gt;move(previewDialogX, previewDialogY);
+	}
+
+	previewDialog-&gt;show();
 }
 
+void filtermainWindow::closePreview()
+{
+	if (previewDialog)
+	{
+		previewFrameIndex = previewDialog-&gt;frameIndex();
+		previewDialogX = previewDialog-&gt;x();
+		previewDialogY = previewDialog-&gt;y();
+
+		delete previewDialog;
+		previewDialog = NULL;
+	}
+}
+
 /**
         \fn     void setSelected(int sel)
         \brief  Set the sel line as selected in the active filter window
@@ -181,12 +205,19 @@
             delete videofilters[nb_active_filter].filter;
             return;
         }
+
+		bool previewDialogOpen = (previewDialog != NULL);
+
+		closePreview();
         videofilters[nb_active_filter].filter-&gt;getCoupledConf (&amp;coup);
         videofilters[nb_active_filter].tag = tag;
         videofilters[nb_active_filter].conf = coup;
         nb_active_filter++;
 		buildActiveFilterList();
         setSelected(nb_active_filter - 1);
+
+		if (previewDialogOpen)
+			preview(true);
    }
 
 }
@@ -204,7 +235,11 @@
       printf(&quot;No selection\n&quot;);
       return;
    }
-    
+
+   bool previewDialogOpen = (previewDialog != NULL);
+
+   closePreview();
+
      int itag=item-&gt;type();
      ADM_assert(itag&gt;ACTIVE_FILTER_BASE);
      itag-=ACTIVE_FILTER_BASE;
@@ -241,15 +276,25 @@
               else
                   setSelected(nb_active_filter-1);
             }
-  
+
+			if (previewDialogOpen)
+				preview(true);
 }
 #define MAKE_BUTTON(button,call) \
 void filtermainWindow::button( bool b) \
 { \
-    call(); \
-    getFirstVideoFilter (); \
-    buildActiveFilterList ();  \
-	setSelected(nb_active_filter - 1); \
+    if (call()) \
+	{ \
+		bool previewDialogOpen = (previewDialog != NULL); \
+\
+		closePreview(); \
+		getFirstVideoFilter (); \
+		buildActiveFilterList ();  \
+		setSelected(nb_active_filter - 1); \
+\
+		if (previewDialogOpen) \
+			preview(true); \
+	} \
 }
 MAKE_BUTTON(DVD,setDVD)
 MAKE_BUTTON(VCD,setVCD)
@@ -279,6 +324,11 @@
      /**/
      
         if(!videofilters[itag].filter-&gt;configure (videofilters[itag - 1].filter)) return;
+
+		bool previewDialogOpen = (previewDialog != NULL);
+
+		closePreview();
+
         /* Recreate chain if needed , config has changed */
         CONFcouple *couple;
         videofilters[itag].filter-&gt;getCoupledConf (&amp;couple);
@@ -286,6 +336,9 @@
         getFirstVideoFilter ();
         buildActiveFilterList ();
 		setSelected(itag);
+
+		if (previewDialogOpen)
+			preview(true);
 }
 /**
         \fn     up( bool b)
@@ -308,6 +361,11 @@
      ADM_assert(itag);
      
      if (itag &lt; 2) return;
+
+	 bool previewDialogOpen = (previewDialog != NULL);
+
+	 closePreview();
+
         // swap action parameter &amp; action parameter -1
         FILTER tmp;
         memcpy (&amp;tmp, &amp;videofilters[itag - 1], sizeof (FILTER));
@@ -317,6 +375,9 @@
         getFirstVideoFilter ();
         buildActiveFilterList ();
         setSelected(itag-1);
+
+		if (previewDialogOpen)
+			preview(true);
 }
 /**
         \fn     down( bool b)
@@ -340,6 +401,10 @@
      
     if (((int) itag &lt; (int) (nb_active_filter - 1)) &amp;&amp; (itag))
         {
+			bool previewDialogOpen = (previewDialog != NULL);
+
+			closePreview();
+
             // swap action parameter &amp; action parameter -1
             FILTER tmp;
             memcpy (&amp;tmp, &amp;videofilters[itag + 1], sizeof (FILTER));
@@ -349,6 +414,9 @@
             getFirstVideoFilter ();
             buildActiveFilterList ();
             setSelected(itag+1);
+
+			if (previewDialogOpen)
+				preview(true);
         }
 }
 /**
@@ -356,17 +424,14 @@
         \brief  Select family among color etc... 
 */
 
-void filtermainWindow::filterFamilyClick(QListWidgetItem *item)
+void filtermainWindow::filterFamilyItemChanged(QListWidgetItem *current, QListWidgetItem *previous)
 {
-    int family= ui.listFilterCategory-&gt;currentRow();
-    if(family&gt;=0)
-        displayFamily(family);
+	int family = ui.listFilterCategory-&gt;currentRow();
+
+	if(family &gt;= 0)
+		displayFamily(family);
 }
-void filtermainWindow::filterFamilyClick(int  m)
-{
-        if(m&gt;=0)
-                displayFamily(m);
-}
+
 void filtermainWindow::displayFamily(uint32_t family)
 {
   printf(&quot;Family :%u\n&quot;,family);
@@ -389,6 +454,19 @@
 	  availableList-&gt;setCurrentRow(0);
 }
 
+void filtermainWindow::activeItemChanged(QListWidgetItem *current, QListWidgetItem *previous)
+{
+	if (previewDialog &amp;&amp; previewDialog-&gt;isVisible())
+	{
+		int itag = current-&gt;type();
+
+		ADM_assert(itag &gt; ACTIVE_FILTER_BASE);
+		itag -= ACTIVE_FILTER_BASE;
+
+		previewDialog-&gt;resetVideoStream(videofilters[itag].filter);
+	}
+}
+
 /**
         \fn     filtermainWindow::activeDoubleClick( QListWidgetItem  *item)
         \brief  One of the active window has been double clicked, call configure
@@ -444,6 +522,10 @@
         
         if(replace-&gt;configure (videofilters[itag - 1].filter))
         {
+			bool previewDialogOpen = (previewDialog != NULL);
+
+			closePreview();
+
             delete videofilters[itag].filter;
             if (conf) delete conf;
             videofilters[itag].filter = replace;
@@ -453,9 +535,47 @@
             getFirstVideoFilter ();
             buildActiveFilterList ();
 			setSelected(itag);
+
+			if (previewDialogOpen)
+				preview(true);
         }
         else delete replace;
 }
+
+void filtermainWindow::loadScript(bool)
+{
+	bool previewDialogOpen = (previewDialog != NULL);
+
+	closePreview();
+
+#ifdef USE_LIBXML2
+	GUI_FileSelRead (QT_TR_NOOP(&quot;Load set of filters&quot;), filterLoadXml);
+#else
+	GUI_FileSelRead (QT_TR_NOOP(&quot;Load set of filters&quot;), filterLoad);
+#endif
+
+	getFirstVideoFilter ();
+	buildActiveFilterList ();
+	setSelected(nb_active_filter - 1);
+
+	if (previewDialogOpen)
+		preview(true);
+}
+
+void filtermainWindow::saveScript(bool)
+{
+	if (nb_active_filter &lt; 2)
+	{
+		GUI_Error_HIG (QT_TR_NOOP(&quot;Nothing to save&quot;), NULL);
+	}
+	else
+#ifdef USE_LIBXML2
+		GUI_FileSelWrite(QT_TR_NOOP(&quot;Save set of filters&quot;), filterSaveXml);
+#else
+		GUI_FileSelWrite(QT_TR_NOOP(&quot;Save set of filters&quot;), filterSave);
+#endif
+}
+
 /**
         \fn setup
         \brief Prepare 
@@ -496,29 +616,39 @@
 }
   /**
   */
-filtermainWindow::filtermainWindow()     : QDialog()
+filtermainWindow::filtermainWindow(QWidget* parent) : QDialog(parent)
  {
         
     ui.setupUi(this);
-    setupFilters();  
-      
+    setupFilters();
+
+	previewDialog = NULL;
+	previewDialogX = INT_MIN;
+	previewDialogY = INT_MIN;
+	previewFrameIndex = curframe;
+
     availableList=ui.listWidgetAvailable;
     activeList=ui.listWidgetActive;
-    connect(ui.listFilterCategory,SIGNAL(itemDoubleClicked(QListWidgetItem *)),
-                this,SLOT(filterFamilyClick(QListWidgetItem *)));
-    connect(ui.listFilterCategory,SIGNAL(itemClicked(QListWidgetItem *)),
-                this,SLOT(filterFamilyClick(QListWidgetItem *)));
 
+	ui.buttonBox-&gt;button(QDialogButtonBox::Close)-&gt;setDefault(true);
+	ui.buttonBox-&gt;addButton(ui.pushButtonPreview, QDialogButtonBox::ActionRole);
+
+	connect(ui.listFilterCategory, SIGNAL(currentItemChanged(QListWidgetItem*, QListWidgetItem*)), this, SLOT(filterFamilyItemChanged(QListWidgetItem*, QListWidgetItem *)));
+
     connect(activeList,SIGNAL(itemDoubleClicked(QListWidgetItem *)),this,SLOT(activeDoubleClick(QListWidgetItem *)));
+	connect(activeList, SIGNAL(currentItemChanged(QListWidgetItem*, QListWidgetItem*)), this, SLOT(activeItemChanged(QListWidgetItem*, QListWidgetItem*)));
     connect(availableList,SIGNAL(itemDoubleClicked(QListWidgetItem *)),this,SLOT(allDoubleClick(QListWidgetItem *)));
-    
+
     connect((ui.toolButtonConfigure),SIGNAL(clicked(bool)),this,SLOT(configure(bool)));
     connect((ui.toolButtonAdd),SIGNAL(clicked(bool)),this,SLOT(add(bool)));
     connect((ui.pushButtonRemove),SIGNAL(clicked(bool)),this,SLOT(remove(bool)));
     connect((ui.toolButtonUp),SIGNAL(clicked(bool)),this,SLOT(up(bool)));
     connect((ui.toolButtonDown),SIGNAL(clicked(bool)),this,SLOT(down(bool)));
     connect((ui.toolButtonPartial),SIGNAL(clicked(bool)),this,SLOT(partial(bool)));
-    connect(ui.buttonClose, SIGNAL(clicked(bool)), this, SLOT(accept()));
+
+	connect(ui.toolButtonLoad, SIGNAL(clicked(bool)), this, SLOT(loadScript(bool)));
+	connect(ui.toolButtonSaveScript, SIGNAL(clicked(bool)), this, SLOT(saveScript(bool)));
+
     connect(ui.pushButtonDVD, SIGNAL(clicked(bool)), this, SLOT(DVD(bool)));
     connect(ui.pushButtonVCD, SIGNAL(clicked(bool)), this, SLOT(VCD(bool)));
     connect(ui.pushButtonSVCD, SIGNAL(clicked(bool)), this, SLOT(SVCD(bool)));
@@ -532,6 +662,12 @@
     buildActiveFilterList();
 	setSelected(nb_active_filter - 1);
  }
+
+filtermainWindow::~filtermainWindow()
+{
+	if (previewDialog)
+		delete previewDialog;
+}
 /*******************************************************/
 
 int GUI_handleVFilter(void);
@@ -545,10 +681,10 @@
 */
 int GUI_handleVFilter(void)
 {
-        filtermainWindow dialog;
-        if(QDialog::Accepted==dialog.exec())
-        {
-        }
+	filtermainWindow dialog(QuiMainWindows);
+
+	dialog.exec();
+
 	return 0;
 }
 /** 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h	2008-09-13 23:12:54 UTC (rev 4333)
@@ -3,6 +3,7 @@
 
 #include &lt;QtGui/QItemDelegate&gt;
 #include &quot;ui_mainfilter.h&quot;
+#include &quot;Q_seekablePreview.h&quot;
 
 class FilterItemEventFilter : public QObject
 {
@@ -32,7 +33,8 @@
 	Q_OBJECT
 
 public:
-	filtermainWindow();
+	filtermainWindow(QWidget *parent);
+	~filtermainWindow();
 	void buildActiveFilterList(void);
 
 	Ui_mainFilterDialog ui;
@@ -50,15 +52,22 @@
 	void remove(bool b);
 	void configure(bool b);
 	void partial(bool b);
+	void loadScript(bool b);
+	void saveScript(bool b);
 	void activeDoubleClick( QListWidgetItem  *item);
+	void activeItemChanged(QListWidgetItem *current, QListWidgetItem *previous);
 	void allDoubleClick( QListWidgetItem  *item);
-	void filterFamilyClick(QListWidgetItem *item);
-	void filterFamilyClick(int  item);
+	void filterFamilyItemChanged(QListWidgetItem *current, QListWidgetItem *previous);
 	void preview(bool b);
 
 private:
+	uint32_t previewFrameIndex;
+	int previewDialogX, previewDialogY;
+	Ui_seekablePreviewWindow *previewDialog;
+
 	void setSelected(int sel);
 	void displayFamily(uint32_t family);
 	void setupFilters(void);
+	void closePreview();
 };
 #endif	// Q_mainfilter_h

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.cpp (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.cpp	2008-09-09 01:00:20 UTC (rev 4320)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -0,0 +1,67 @@
+/***************************************************************************
+                           Q_seekablePreview.cpp
+                           ---------------------
+
+    begin                : Fri Sep 5 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;Q_seekablePreview.h&quot;
+
+Ui_seekablePreviewWindow::Ui_seekablePreviewWindow(QWidget *parent, AVDMGenericVideoStream *videoStream, uint32_t defaultFrame) : QDialog(parent)
+{
+	ui.setupUi(this);
+
+	seekablePreview = NULL;
+	canvas = NULL;
+
+	resetVideoStream(videoStream);
+	seekablePreview-&gt;sliderSet(defaultFrame);
+	seekablePreview-&gt;sliderChanged();
+
+	connect(ui.horizontalSlider, SIGNAL(valueChanged(int)), this, SLOT(sliderChanged(int)));
+}
+
+Ui_seekablePreviewWindow::~Ui_seekablePreviewWindow()
+{
+	delete seekablePreview;
+	delete canvas;
+}
+
+void Ui_seekablePreviewWindow::resetVideoStream(AVDMGenericVideoStream *videoStream)
+{
+	if (seekablePreview)
+		delete seekablePreview;
+
+	if (canvas)
+		delete canvas;
+
+	uint32_t canvasWidth = videoStream-&gt;getInfo()-&gt;width;
+	uint32_t canvasHeight = videoStream-&gt;getInfo()-&gt;height;
+
+	canvas = new ADM_QCanvas(ui.frame, canvasWidth, canvasHeight);
+	canvas-&gt;show();
+	seekablePreview = new flySeekablePreview(canvasWidth, canvasHeight, videoStream, canvas, ui.horizontalSlider);	
+
+	seekablePreview-&gt;process();
+	seekablePreview-&gt;sliderChanged();
+}
+
+void Ui_seekablePreviewWindow::sliderChanged(int value)
+{
+	seekablePreview-&gt;sliderChanged();
+}
+
+uint32_t Ui_seekablePreviewWindow::frameIndex()
+{
+	return seekablePreview-&gt;sliderGet();
+}
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.h (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.h	2008-09-09 01:00:20 UTC (rev 4320)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_seekablePreview.h	2008-09-13 23:12:54 UTC (rev 4333)
@@ -0,0 +1,40 @@
+/***************************************************************************
+                            Q_seekablePreview.h
+                            -------------------
+
+    begin                : Fri Sep 5 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ui_seekablePreview.h&quot;
+
+#include &quot;ADM_assert.h&quot;
+#include &quot;ADM_videofilter.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;../ADM_dialog/DIA_flyPreview.h&quot;
+
+class Ui_seekablePreviewWindow : public QDialog
+{
+	Q_OBJECT
+
+public:
+	ADM_QCanvas *canvas;
+	flySeekablePreview *seekablePreview;
+	Ui_seekablePreviewDialog ui;
+	Ui_seekablePreviewWindow(QWidget *parent, AVDMGenericVideoStream *videoStream, uint32_t defaultFrame = 0);
+	~Ui_seekablePreviewWindow();
+	void resetVideoStream(AVDMGenericVideoStream *videoStream);
+	uint32_t frameIndex();
+
+public slots:
+	void sliderChanged(int value);
+};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2008-09-13 23:12:54 UTC (rev 4333)
@@ -58,7 +58,7 @@
           &lt;/size&gt;
          &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
-          &lt;string&gt;&amp;SVCD res&lt;/string&gt;
+          &lt;string&gt;&amp;SVCD Res&lt;/string&gt;
          &lt;/property&gt;
          &lt;property name=&quot;icon&quot; &gt;
           &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/cd.png&lt;/iconset&gt;
@@ -70,7 +70,7 @@
          &lt;property name=&quot;sizePolicy&quot; &gt;
           &lt;sizepolicy&gt;
            &lt;hsizetype&gt;5&lt;/hsizetype&gt;
-           &lt;vsizetype&gt;0&lt;/vsizetype&gt;
+           &lt;vsizetype&gt;5&lt;/vsizetype&gt;
            &lt;horstretch&gt;0&lt;/horstretch&gt;
            &lt;verstretch&gt;0&lt;/verstretch&gt;
           &lt;/sizepolicy&gt;
@@ -82,7 +82,7 @@
           &lt;/size&gt;
          &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
-          &lt;string&gt;&amp;VCD res&lt;/string&gt;
+          &lt;string&gt;&amp;VCD Res&lt;/string&gt;
          &lt;/property&gt;
          &lt;property name=&quot;icon&quot; &gt;
           &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/cd.png&lt;/iconset&gt;
@@ -93,8 +93,8 @@
         &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButtonHalfDVD&quot; &gt;
          &lt;property name=&quot;sizePolicy&quot; &gt;
           &lt;sizepolicy&gt;
-           &lt;hsizetype&gt;7&lt;/hsizetype&gt;
-           &lt;vsizetype&gt;5&lt;/vsizetype&gt;
+           &lt;hsizetype&gt;5&lt;/hsizetype&gt;
+           &lt;vsizetype&gt;0&lt;/vsizetype&gt;
            &lt;horstretch&gt;0&lt;/horstretch&gt;
            &lt;verstretch&gt;0&lt;/verstretch&gt;
           &lt;/sizepolicy&gt;
@@ -106,7 +106,7 @@
           &lt;/size&gt;
          &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
-          &lt;string&gt;&amp;Half D1 res&lt;/string&gt;
+          &lt;string&gt;&amp;Half D1 Res&lt;/string&gt;
          &lt;/property&gt;
          &lt;property name=&quot;icon&quot; &gt;
           &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/cd.png&lt;/iconset&gt;
@@ -130,7 +130,7 @@
           &lt;/size&gt;
          &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
-          &lt;string&gt;&amp;DVD res&lt;/string&gt;
+          &lt;string&gt;&amp;DVD Res&lt;/string&gt;
          &lt;/property&gt;
          &lt;property name=&quot;icon&quot; &gt;
           &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/cd.png&lt;/iconset&gt;
@@ -365,6 +365,9 @@
        &lt;/item&gt;
        &lt;item&gt;
         &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonLoad&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Open Script&lt;/string&gt;
+         &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Load&lt;/string&gt;
          &lt;/property&gt;
@@ -374,17 +377,10 @@
         &lt;/widget&gt;
        &lt;/item&gt;
        &lt;item&gt;
-        &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonSave&quot; &gt;
-         &lt;property name=&quot;text&quot; &gt;
-          &lt;string&gt;Save&lt;/string&gt;
+        &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonSaveScript&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Save Script As&lt;/string&gt;
          &lt;/property&gt;
-         &lt;property name=&quot;icon&quot; &gt;
-          &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/filesave.png&lt;/iconset&gt;
-         &lt;/property&gt;
-        &lt;/widget&gt;
-       &lt;/item&gt;
-       &lt;item&gt;
-        &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonSaveScript&quot; &gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Save Script&lt;/string&gt;
          &lt;/property&gt;
@@ -395,6 +391,9 @@
        &lt;/item&gt;
        &lt;item&gt;
         &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonDown&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Move Filter Down&lt;/string&gt;
+         &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Down&lt;/string&gt;
          &lt;/property&gt;
@@ -405,6 +404,9 @@
        &lt;/item&gt;
        &lt;item&gt;
         &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonUp&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Move Filter Up&lt;/string&gt;
+         &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Up&lt;/string&gt;
          &lt;/property&gt;
@@ -415,6 +417,9 @@
        &lt;/item&gt;
        &lt;item&gt;
         &lt;widget class=&quot;QToolButton&quot; name=&quot;pushButtonRemove&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Remove Filter&lt;/string&gt;
+         &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Remove&lt;/string&gt;
          &lt;/property&gt;
@@ -448,6 +453,9 @@
        &lt;/item&gt;
        &lt;item&gt;
         &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButtonAdd&quot; &gt;
+         &lt;property name=&quot;toolTip&quot; &gt;
+          &lt;string&gt;Add Filter&lt;/string&gt;
+         &lt;/property&gt;
          &lt;property name=&quot;text&quot; &gt;
           &lt;string&gt;Add&lt;/string&gt;
          &lt;/property&gt;
@@ -524,20 +532,25 @@
         &lt;string&gt;&amp;Preview&lt;/string&gt;
        &lt;/property&gt;
        &lt;property name=&quot;icon&quot; &gt;
-        &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/thumbnail.png&lt;/iconset&gt;
+        &lt;iconset/&gt;
        &lt;/property&gt;
       &lt;/widget&gt;
      &lt;/item&gt;
      &lt;item&gt;
-      &lt;widget class=&quot;QPushButton&quot; name=&quot;buttonClose&quot; &gt;
-       &lt;property name=&quot;text&quot; &gt;
-        &lt;string&gt;&amp;Close&lt;/string&gt;
+      &lt;widget class=&quot;QDialogButtonBox&quot; name=&quot;buttonBox&quot; &gt;
+       &lt;property name=&quot;sizePolicy&quot; &gt;
+        &lt;sizepolicy&gt;
+         &lt;hsizetype&gt;0&lt;/hsizetype&gt;
+         &lt;vsizetype&gt;0&lt;/vsizetype&gt;
+         &lt;horstretch&gt;0&lt;/horstretch&gt;
+         &lt;verstretch&gt;0&lt;/verstretch&gt;
+        &lt;/sizepolicy&gt;
        &lt;/property&gt;
-       &lt;property name=&quot;icon&quot; &gt;
-        &lt;iconset resource=&quot;filter.qrc&quot; &gt;:/new/prefix1/icons/close.png&lt;/iconset&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
        &lt;/property&gt;
-       &lt;property name=&quot;default&quot; &gt;
-        &lt;bool&gt;true&lt;/bool&gt;
+       &lt;property name=&quot;standardButtons&quot; &gt;
+        &lt;set&gt;QDialogButtonBox::Close&lt;/set&gt;
        &lt;/property&gt;
       &lt;/widget&gt;
      &lt;/item&gt;
@@ -557,16 +570,31 @@
   &lt;tabstop&gt;toolButtonConfigure&lt;/tabstop&gt;
   &lt;tabstop&gt;toolButtonPartial&lt;/tabstop&gt;
   &lt;tabstop&gt;toolButtonLoad&lt;/tabstop&gt;
-  &lt;tabstop&gt;toolButtonSave&lt;/tabstop&gt;
   &lt;tabstop&gt;toolButtonSaveScript&lt;/tabstop&gt;
   &lt;tabstop&gt;toolButtonDown&lt;/tabstop&gt;
   &lt;tabstop&gt;toolButtonUp&lt;/tabstop&gt;
   &lt;tabstop&gt;pushButtonRemove&lt;/tabstop&gt;
   &lt;tabstop&gt;pushButtonPreview&lt;/tabstop&gt;
-  &lt;tabstop&gt;buttonClose&lt;/tabstop&gt;
  &lt;/tabstops&gt;
  &lt;resources&gt;
   &lt;include location=&quot;filter.qrc&quot; /&gt;
  &lt;/resources&gt;
- &lt;connections/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;rejected()&lt;/signal&gt;
+   &lt;receiver&gt;mainFilterDialog&lt;/receiver&gt;
+   &lt;slot&gt;close()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;872&lt;/x&gt;
+     &lt;y&gt;550&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;464&lt;/x&gt;
+     &lt;y&gt;300&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
 &lt;/ui&gt;

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/seekablePreview.ui (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/seekablePreview.ui)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2008-09-13 23:12:54 UTC (rev 4333)
@@ -1,11 +1,11 @@
 SET(ADM_LIB ADM_guiQt4)
 
-QT4_WRAP_UI(${ADM_LIB}_header  gui2.ui  seekablePreview.ui)
-QT4_WRAP_CPP(${ADM_LIB}_source  Q_gui2.h  T_preview.h  ADM_qtray.h  Q_seekablePreview.h)
+QT4_WRAP_UI(${ADM_LIB}_header  gui2.ui  preview.ui)
+QT4_WRAP_CPP(${ADM_LIB}_source  Q_gui2.h  T_preview.h  ADM_qtray.h  Q_preview.h)
 QT4_ADD_RESOURCES(${ADM_LIB}_resource  avidemux.qrc)
 
 SET(${ADM_LIB}_SRCS
-	Q_gui2.cpp  T_preview.cpp  file_qt4.cpp  gui_none.cpp  ADM_qslider.cpp  ADM_qtray.cpp  Q_seekablePreview.cpp
+	Q_gui2.cpp  T_preview.cpp  file_qt4.cpp  gui_none.cpp  ADM_qslider.cpp  ADM_qtray.cpp  Q_preview.cpp
 	${${ADM_LIB}_header}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource})
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR}  ${CMAKE_CURRENT_SOURCE_DIR})

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp	2008-09-09 01:00:20 UTC (rev 4320)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -0,0 +1,38 @@
+/***************************************************************************
+                                Q_preview.cpp
+                                -------------
+
+    begin                : Mon Sep 8 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;Q_preview.h&quot;
+
+Ui_previewWindow::Ui_previewWindow(QWidget *parent, int width, int height) : QDialog(parent, Qt::WindowTitleHint)
+{
+	ui.setupUi(this);
+
+	canvas = new ADM_QCanvas(ui.frame, width, height);
+	preview = new flyPreview(width, height, canvas);
+}
+
+Ui_previewWindow::~Ui_previewWindow()
+{
+	delete preview;
+	delete canvas;
+}
+
+void Ui_previewWindow::update(uint8_t *buffer)
+{
+	preview-&gt;setData(buffer);
+	preview-&gt;display();
+}

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.h (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.h	2008-09-09 01:00:20 UTC (rev 4320)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_preview.h	2008-09-13 23:12:54 UTC (rev 4333)
@@ -0,0 +1,34 @@
+/***************************************************************************
+                                Q_preview.h
+                                -----------
+
+    begin                : Mon Sep 8 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ui_preview.h&quot;
+
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;../ADM_dialog/DIA_flyPreview.h&quot;
+
+class Ui_previewWindow : public QDialog
+{
+	Q_OBJECT
+
+public:
+	ADM_QCanvas *canvas;
+	flyPreview *preview;
+	Ui_previewDialog ui;
+	Ui_previewWindow(QWidget *parent, int width, int height);
+	~Ui_previewWindow();
+	void update(uint8_t *buffer);
+};

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -1,52 +0,0 @@
-/***************************************************************************
-                           Q_seekablePreview.cpp
-                           ---------------------
-
-    begin                : Fri Sep 5 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;Q_seekablePreview.h&quot;
-
-Ui_seekablePreviewWindow::Ui_seekablePreviewWindow(AVDMGenericVideoStream *videoStream, uint32_t defaultFrame) : QDialog()
-{
-	ui.setupUi(this);
-
-	uint32_t canvasWidth = videoStream-&gt;getInfo()-&gt;width;
-	uint32_t canvasHeight = videoStream-&gt;getInfo()-&gt;height;
-
-	canvas = new ADM_QCanvas(ui.frame, canvasWidth, canvasHeight);
-	seekablePreview = new flySeekablePreview(canvasWidth, canvasHeight, videoStream, canvas, ui.horizontalSlider);
-
-	seekablePreview-&gt;process();
-	seekablePreview-&gt;sliderSet(defaultFrame);
-	seekablePreview-&gt;sliderChanged();
-
-	connect(ui.okButton, SIGNAL(clicked(bool)), this, SLOT(closeWindow()));
-	connect(ui.horizontalSlider, SIGNAL(valueChanged(int)), this, SLOT(sliderChanged(int)));
-}
-
-Ui_seekablePreviewWindow::~Ui_seekablePreviewWindow()
-{
-	delete seekablePreview;
-	delete canvas;
-}
-
-void Ui_seekablePreviewWindow::closeWindow()
-{
-	close();
-}
-
-void Ui_seekablePreviewWindow::sliderChanged(int value)
-{
-	seekablePreview-&gt;sliderChanged();
-}
\ No newline at end of file

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.h	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_seekablePreview.h	2008-09-13 23:12:54 UTC (rev 4333)
@@ -1,39 +0,0 @@
-/***************************************************************************
-                            Q_seekablePreview.h
-                            -------------------
-
-    begin                : Fri Sep 5 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;ui_seekablePreview.h&quot;
-
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;DIA_flyDialog.h&quot;
-#include &quot;../ADM_dialog/DIA_flyPreview.h&quot;
-
-class Ui_seekablePreviewWindow : public QDialog
-{
-	Q_OBJECT
-
-public:
-	ADM_QCanvas *canvas;
-	flySeekablePreview *seekablePreview;
-	Ui_seekablePreviewDialog ui;
-	Ui_seekablePreviewWindow(AVDMGenericVideoStream *videoStream, uint32_t defaultFrame = 0);
-	~Ui_seekablePreviewWindow();
-
-public slots:
-	void closeWindow();
-	void sliderChanged(int value);
-};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2008-09-13 23:12:54 UTC (rev 4333)
@@ -15,8 +15,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include &lt;QtGui/QFrame&gt;
-#include &lt;QtGui/QImage&gt;
 #include &lt;QtGui/QPainter&gt;
 
 /* Probably on unix/X11 ..*/
@@ -27,7 +25,7 @@
 #endif
 
 #include &quot;T_preview.h&quot;
-#include &quot;Q_seekablePreview.h&quot;
+#include &quot;Q_preview.h&quot;
 #include &quot;../ADM_render/GUI_render.h&quot;
 #include &quot;../ADM_render/GUI_accelRender.h&quot;
     
@@ -39,21 +37,41 @@
  
 extern void UI_purge( void );
 
-void DIA_previewInit(uint32_t width, uint32_t height) {}
-uint8_t DIA_previewUpdate(uint8_t *data) {return 1;}
-void DIA_previewEnd(void) {}
-uint8_t DIA_previewStillAlive(void) {return 1;}
+static Ui_previewWindow *previewWindow = NULL;
 
-uint8_t	DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame)
+void DIA_previewInit(uint32_t width, uint32_t height)
 {
-	ADM_assert(frame &lt;= videoStream-&gt;getInfo()-&gt;nb_frames);
+	previewWindow = new Ui_previewWindow(QuiMainWindows, width, height);
+	previewWindow-&gt;show();
+}
 
-	printf(&quot;** DIA_filterPreview %i **\n&quot;, frame);
-	Ui_seekablePreviewWindow previewDialog(videoStream, frame);
+uint8_t DIA_previewStillAlive(void)
+{
+	return (previewWindow != NULL);
+}
 
-	previewDialog.exec();
+uint8_t DIA_previewUpdate(uint8_t *buffer)
+{
+	if (previewWindow)
+	{
+		previewWindow-&gt;update(buffer);
+
+		return 1;
+	}
+
+	return 0;
 }
 
+void DIA_previewEnd(void)
+{
+	if (previewWindow)
+	{
+		delete previewWindow;
+		previewWindow = NULL;
+	}
+}
+
+
 //****************************************************************************************************
 /*
   Function to display

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/preview.ui (from rev 4320, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/preview.ui)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/seekablePreview.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/seekablePreview.ui	2008-09-13 21:20:26 UTC (rev 4332)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/seekablePreview.ui	2008-09-13 23:12:54 UTC (rev 4333)
@@ -1,79 +0,0 @@
-&lt;ui version=&quot;4.0&quot; &gt;
- &lt;class&gt;seekablePreviewDialog&lt;/class&gt;
- &lt;widget class=&quot;QDialog&quot; name=&quot;seekablePreviewDialog&quot; &gt;
-  &lt;property name=&quot;geometry&quot; &gt;
-   &lt;rect&gt;
-    &lt;x&gt;0&lt;/x&gt;
-    &lt;y&gt;0&lt;/y&gt;
-    &lt;width&gt;400&lt;/width&gt;
-    &lt;height&gt;300&lt;/height&gt;
-   &lt;/rect&gt;
-  &lt;/property&gt;
-  &lt;property name=&quot;windowTitle&quot; &gt;
-   &lt;string&gt;Preview&lt;/string&gt;
-  &lt;/property&gt;
-  &lt;property name=&quot;modal&quot; &gt;
-   &lt;bool&gt;true&lt;/bool&gt;
-  &lt;/property&gt;
-  &lt;layout class=&quot;QVBoxLayout&quot; &gt;
-   &lt;property name=&quot;margin&quot; &gt;
-    &lt;number&gt;9&lt;/number&gt;
-   &lt;/property&gt;
-   &lt;property name=&quot;spacing&quot; &gt;
-    &lt;number&gt;6&lt;/number&gt;
-   &lt;/property&gt;
-   &lt;item&gt;
-    &lt;widget class=&quot;QFrame&quot; name=&quot;frame&quot; &gt;
-     &lt;property name=&quot;frameShape&quot; &gt;
-      &lt;enum&gt;QFrame::StyledPanel&lt;/enum&gt;
-     &lt;/property&gt;
-     &lt;property name=&quot;frameShadow&quot; &gt;
-      &lt;enum&gt;QFrame::Raised&lt;/enum&gt;
-     &lt;/property&gt;
-    &lt;/widget&gt;
-   &lt;/item&gt;
-   &lt;item&gt;
-    &lt;widget class=&quot;QSlider&quot; name=&quot;horizontalSlider&quot; &gt;
-     &lt;property name=&quot;orientation&quot; &gt;
-      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-     &lt;/property&gt;
-    &lt;/widget&gt;
-   &lt;/item&gt;
-   &lt;item&gt;
-    &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-     &lt;property name=&quot;margin&quot; &gt;
-      &lt;number&gt;0&lt;/number&gt;
-     &lt;/property&gt;
-     &lt;property name=&quot;spacing&quot; &gt;
-      &lt;number&gt;6&lt;/number&gt;
-     &lt;/property&gt;
-     &lt;item&gt;
-      &lt;spacer&gt;
-       &lt;property name=&quot;orientation&quot; &gt;
-        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
-       &lt;/property&gt;
-       &lt;property name=&quot;sizeHint&quot; &gt;
-        &lt;size&gt;
-         &lt;width&gt;40&lt;/width&gt;
-         &lt;height&gt;20&lt;/height&gt;
-        &lt;/size&gt;
-       &lt;/property&gt;
-      &lt;/spacer&gt;
-     &lt;/item&gt;
-     &lt;item&gt;
-      &lt;widget class=&quot;QPushButton&quot; name=&quot;okButton&quot; &gt;
-       &lt;property name=&quot;text&quot; &gt;
-        &lt;string&gt;OK&lt;/string&gt;
-       &lt;/property&gt;
-       &lt;property name=&quot;default&quot; &gt;
-        &lt;bool&gt;true&lt;/bool&gt;
-       &lt;/property&gt;
-      &lt;/widget&gt;
-     &lt;/item&gt;
-    &lt;/layout&gt;
-   &lt;/item&gt;
-  &lt;/layout&gt;
- &lt;/widget&gt;
- &lt;resources/&gt;
- &lt;connections/&gt;
-&lt;/ui&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001572.html">[Avidemux-svn-commit] r4332 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters:	AvisynthResize/qt4 MplayerResize/qt4
</A></li>
	<LI>Next message: <A HREF="001574.html">[Avidemux-svn-commit] r4334 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_codecs	avidemux/ADM_core/include avidemux/ADM_core/src	plugins/ADM_videoEncoder/ADM_vidEnc_x264
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1573">[ date ]</a>
              <a href="thread.html#1573">[ thread ]</a>
              <a href="subject.html#1573">[ subject ]</a>
              <a href="author.html#1573">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
