<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4390 - in	branches/avidemux_2.4_branch/avidemux: . ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_QT4/ADM_ocr	ADM_userInterfaces/ADM_QT4/ADM_toolkit
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4390%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_userInterfaces/ADM_QT4%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09ADM_userInterfaces/ADM_QT4/ADM_ocr%0A%09ADM_userInterfaces/ADM_QT4/ADM_toolkit&In-Reply-To=%3C200809212135.m8LLZ7pj015840%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001629.html">
   <LINK REL="Next"  HREF="001631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4390 - in	branches/avidemux_2.4_branch/avidemux: . ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_QT4/ADM_ocr	ADM_userInterfaces/ADM_QT4/ADM_toolkit</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4390%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_userInterfaces/ADM_QT4%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_filters%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09ADM_userInterfaces/ADM_QT4/ADM_ocr%0A%09ADM_userInterfaces/ADM_QT4/ADM_toolkit&In-Reply-To=%3C200809212135.m8LLZ7pj015840%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4390 - in	branches/avidemux_2.4_branch/avidemux: . ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_filters	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_QT4/ADM_ocr	ADM_userInterfaces/ADM_QT4/ADM_toolkit">gruntster at mail.berlios.de
       </A><BR>
    <I>Sun Sep 21 23:35:07 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001629.html">[Avidemux-svn-commit] r4389 - branches/avidemux_2.4_branch/po
</A></li>
        <LI>Next message: <A HREF="001631.html">[Avidemux-svn-commit] r4391 - in	branches/avidemux_2.4_branch/avidemux: . ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_toolkit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1630">[ date ]</a>
              <a href="thread.html#1630">[ thread ]</a>
              <a href="subject.html#1630">[ subject ]</a>
              <a href="author.html#1630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2008-09-21 23:34:50 +0200 (Sun, 21 Sep 2008)
New Revision: 4390

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_about.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_calculator.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_resizing.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
Log:
[Qt] employ a similar hack to GTK+ for parenting windows. It will cause too many problems upstream to do it properly.

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h	2008-09-21 21:34:50 UTC (rev 4390)
@@ -46,7 +46,7 @@
  public:
      FLY_NAME *myCrop;
      ADM_QCanvas *canvas;
-     WINDOW_NAME(PARAM_NAME *param,AVDMGenericVideoStream *in);
+     WINDOW_NAME(QWidget *parent, PARAM_NAME *param,AVDMGenericVideoStream *in);
      ~WINDOW_NAME();
      DIALOG_NAME ui;
  public slots:
@@ -88,12 +88,17 @@
 {
         uint8_t ret=0;
         
-        WINDOW_NAME dialog(param,in);        
+        WINDOW_NAME dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_about.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_about.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_about.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -17,6 +17,7 @@
 
 #include &quot;ui_about.h&quot;
 #include &quot;default.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 extern uint8_t DIA_license(void);
 
@@ -28,13 +29,13 @@
 	Ui_aboutDialog ui;
 
 public:
-	Ui_aboutWindow();
+	Ui_aboutWindow(QWidget* parent);
 
 private slots:
 	void licenseButton_clicked(bool);
 };
 
-Ui_aboutWindow::Ui_aboutWindow()
+Ui_aboutWindow::Ui_aboutWindow(QWidget* parent) : QDialog(parent)
 {
 	Q_INIT_RESOURCE(about);
 
@@ -58,10 +59,13 @@
 }
 
 uint8_t DIA_about(void)
-{
-	Ui_aboutWindow dialog;
+{	
+	Ui_aboutWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
 
 	dialog.exec();
 
+	qtUnregisterDialog(&amp;dialog);
+
 	return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -39,6 +39,7 @@
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //
 //	Video is in YV12 Colorspace
@@ -52,7 +53,7 @@
  public:
      flyASharp *myCrop;
      ADM_QCanvas *canvas;
-     Ui_asharpWindow(ASHARP_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_asharpWindow();
      Ui_asharpDialog ui;
  public slots:
@@ -66,7 +67,7 @@
  private:
      
  };
-  Ui_asharpWindow::Ui_asharpWindow(ASHARP_PARAM *param,AVDMGenericVideoStream *in)
+Ui_asharpWindow::Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -159,12 +160,16 @@
 {
         uint8_t ret=0;
         
-        Ui_asharpWindow dialog(param,in);        
+        Ui_asharpWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_calculator.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_calculator.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_calculator.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -26,6 +26,7 @@
 #include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
 #include &quot;ADM_filter/video_filters.h&quot;
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 class calculatorDialog : public QDialog
 {
@@ -40,7 +41,7 @@
 	unsigned int getPictureSize(void);
 
 public:
-	calculatorDialog();
+	calculatorDialog(QWidget *parent);
 	~calculatorDialog();
 
 	unsigned int videoSize(void);
@@ -52,7 +53,7 @@
 	void spinBox_valueChanged(int value);
 };
 
-calculatorDialog::calculatorDialog()
+calculatorDialog::calculatorDialog(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -276,11 +277,14 @@
 	if (!avifileinfo)
 		return;
 
-	calculatorDialog dialog;
+	calculatorDialog dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
 
 	if (dialog.exec() == QDialog::Accepted)
 		videoCodecSetFinalSize(dialog.videoSize());
 
+	qtUnregisterDialog(&amp;dialog);
+
 	*sizeInMeg = dialog.videoSize();
 	*avgBitrate = dialog.videoBitrate();
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -39,6 +39,8 @@
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;DIA_flyChromaShift.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
+
 class Ui_chromaShiftWindow : public QDialog
  {
      Q_OBJECT
@@ -47,7 +49,7 @@
  public:
      flyChromaShift *myCrop;
      ADM_QCanvas *canvas;
-     Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_chromaShiftWindow(QWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_chromaShiftWindow();
      Ui_chromashiftDialog ui;
  public slots:
@@ -60,7 +62,7 @@
  private:
      
  };
-  Ui_chromaShiftWindow::Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in)
+Ui_chromaShiftWindow::Ui_chromaShiftWindow(QWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -142,12 +144,17 @@
 {
         uint8_t ret=0;
         
-        Ui_chromaShiftWindow dialog(param,in);        
+        Ui_chromaShiftWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -39,6 +39,7 @@
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;DIA_flyContrast.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //
 //	Video is in YV12 Colorspace
@@ -52,7 +53,7 @@
  public:
      flyContrast *myCrop;
      ADM_QCanvas *canvas;
-     Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_contrastWindow();
      Ui_contrastDialog ui;
  public slots:
@@ -65,7 +66,7 @@
  private:
      
  };
-  Ui_contrastWindow::Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in)
+Ui_contrastWindow::Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -155,12 +156,17 @@
 {
         uint8_t ret=0;
         
-        Ui_contrastWindow dialog(param,in);        
+        Ui_contrastWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -38,6 +38,7 @@
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;DIA_flyCrop.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //
 //	Video is in YV12 Colorspace
@@ -51,7 +52,7 @@
  public:
      flyCrop *myCrop;
      ADM_QCanvas *canvas;
-     Ui_cropWindow(CROP_PARAMS *param,AVDMGenericVideoStream *in);
+     Ui_cropWindow(QWidget* parent, CROP_PARAMS *param,AVDMGenericVideoStream *in);
      ~Ui_cropWindow();
      Ui_cropDialog ui;
  public slots:
@@ -66,7 +67,7 @@
  private:
      
  };
-  Ui_cropWindow::Ui_cropWindow(CROP_PARAMS *param,AVDMGenericVideoStream *in)
+Ui_cropWindow::Ui_cropWindow(QWidget* parent, CROP_PARAMS *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -197,12 +198,17 @@
 {
         uint8_t ret=0;
         
-        Ui_cropWindow dialog(param,in);        
+        Ui_cropWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -29,6 +29,7 @@
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_libraries/ADM_utilities/avidemutils.h&quot;
 #include &quot;ADM_gui/ADM_qtray.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 extern void UI_iconify(void);
 extern void UI_deiconify(void);
@@ -39,7 +40,7 @@
      Q_OBJECT
 
  public:
-     encodingWindow(QDialog *parent, bool useTray);
+     encodingWindow(QWidget *parent, bool useTray);
      Ui_encodingDialog ui;
 
  protected:
@@ -107,7 +108,7 @@
 };
 
 
-encodingWindow::encodingWindow(QDialog *parent, bool useTray) : QDialog(parent, Qt::WindowTitleHint | Qt::WindowSystemMenuHint | Qt::WindowMinimizeButtonHint)
+encodingWindow::encodingWindow(QWidget *parent, bool useTray) : QDialog(parent, Qt::WindowTitleHint | Qt::WindowSystemMenuHint | Qt::WindowMinimizeButtonHint)
  {
 	this-&gt;useTray = useTray;
 	ui.setupUi(this);
@@ -162,7 +163,9 @@
         _audioSize=0;
         _videoSize=0;
         _current=0;
-        window=new encodingWindow(QuiMainWindows, useTray);
+        window=new encodingWindow(qtLastRegisteredDialog(), useTray);
+		qtRegisterDialog(window);
+
         setFps(fps1000);
 		_originalPriority=getpriority(PRIO_PROCESS, 0);
         _lastTime=0;
@@ -209,7 +212,8 @@
 
 	setpriority(PRIO_PROCESS, 0, _originalPriority);
 
-	if(window) delete window;
+	qtUnregisterDialog(window);
+	delete window;
 	window=NULL;
 	UI_deiconify();
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -33,6 +33,7 @@
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 #include &quot;DIA_flyEq2.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //
 //	Video is in YV12 Colorspace
@@ -46,7 +47,7 @@
  public:
      flyEq2 *myCrop;
      ADM_QCanvas *canvas;
-     Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in);
+     Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in);
      ~Ui_eq2Window();
      Ui_DialogEq2 ui;
  public slots:
@@ -59,7 +60,7 @@
  private:
      
  };
-  Ui_eq2Window::Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in)
+Ui_eq2Window::Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -162,12 +163,18 @@
 {
         uint8_t ret=0;
         
-        Ui_eq2Window dialog(param,in);        
+        Ui_eq2Window dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -39,6 +39,7 @@
 #include &quot;DIA_flyDialogQt4.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidHue.h&quot;
 #include &quot;DIA_flyHue.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //
 //	Video is in YV12 Colorspace
@@ -52,7 +53,7 @@
  public:
      flyHue *myCrop;
      ADM_QCanvas *canvas;
-     Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in);
+     Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in);
      ~Ui_hueWindow();
      Ui_hueDialog ui;
  public slots:
@@ -65,7 +66,7 @@
  private:
      
  };
-  Ui_hueWindow::Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in)
+Ui_hueWindow::Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -141,12 +142,18 @@
 {
         uint8_t ret=0;
         
-        Ui_hueWindow dialog(param,in);        
+        Ui_hueWindow dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -20,6 +20,7 @@
 
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_assert.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 static void             updateStatus(void);
 extern bool parseECMAScript(const char *name);
@@ -72,7 +73,7 @@
         ADM_Job_Descriptor  *desc;
         void             updateRows(void);
  public:
-                    jobsWindow(uint32_t n,char **j);
+                    jobsWindow(QWidget *parent, uint32_t n,char **j);
                     ~jobsWindow();
      Ui_Jobs        ui;
  public slots:
@@ -85,7 +86,7 @@
  /**
           \fn jobsWindow
  */
-jobsWindow::jobsWindow(uint32_t n,char **j)     : QDialog()
+jobsWindow::jobsWindow(QWidget *parent, uint32_t n,char **j)     : QDialog(parent)
  {
      ui.setupUi(this);
      _nbJobs=n;
@@ -252,12 +253,17 @@
 uint8_t  DIA_job(uint32_t nb, char **name)
 {
   uint8_t r=0;
-  jobsWindow jobswindow(nb,name) ;
+  jobsWindow jobswindow(qtLastRegisteredDialog(), nb,name);
+
+  qtRegisterDialog(&amp;jobswindow);
      
      if(jobswindow.exec()==QDialog::Accepted)
      {
        r=1;
      }
+
+	 qtUnregisterDialog(&amp;jobswindow);
+
      return r;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_license.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -17,6 +17,7 @@
 
 #include &quot;ui_license.h&quot;
 #include &quot;default.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 class Ui_licenseWindow : public QDialog
 {
@@ -26,10 +27,10 @@
 	Ui_licenseDialog ui;
 
 public:
-	Ui_licenseWindow();
+	Ui_licenseWindow(QWidget *parent);
 };
 
-Ui_licenseWindow::Ui_licenseWindow()
+Ui_licenseWindow::Ui_licenseWindow(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -709,9 +710,11 @@
 
 uint8_t DIA_license(void)
 {
-	Ui_licenseWindow dialog;
+	Ui_licenseWindow dialog(qtLastRegisteredDialog());
 
+	qtRegisterDialog(&amp;dialog);
 	dialog.exec();
+	qtUnregisterDialog(&amp;dialog);
 
 	return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -23,6 +23,8 @@
 #include &quot;avidemutils.h&quot;
 #include &quot;avi_vars.h&quot;
 #include &quot;ADM_osSupport/ADM_misc.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
+
 static const char *yesno[2]={QT_TR_NOOP(&quot;No&quot;),QT_TR_NOOP(&quot;Yes&quot;)};
 extern const char *getStrFromAudioCodec( uint32_t codec);
  class propWindow : public QDialog
@@ -30,7 +32,7 @@
      Q_OBJECT
 
  public:
-     propWindow();
+     propWindow(QWidget *parent);
      Ui_Dialog ui;
  public slots:
   
@@ -42,7 +44,7 @@
  };
 
 
-propWindow::propWindow()     : QDialog()
+propWindow::propWindow(QWidget *parent)     : QDialog(parent)
  {
      ui.setupUi(this);
      uint8_t gmc, qpel,vop;
@@ -147,9 +149,10 @@
       if (!avifileinfo)
         return;
      // Fetch info
-     propWindow *propwindow=new propWindow ;
-     propwindow-&gt;exec();
-     delete propwindow;
+     propWindow propwindow(qtLastRegisteredDialog());
+	 qtRegisterDialog(&amp;propwindow);
+     propwindow.exec();
+	 qtUnregisterDialog(&amp;propwindow);
 }  
 //********************************************
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_resizing.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_resizing.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_resizing.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -26,6 +26,7 @@
 #include &quot;avi_vars.h&quot;
 #include &quot;ADM_osSupport/ADM_misc.h&quot;
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 static double aspectRatio[2][3]={
                               {1.,0.888888,1.19}, // NTSC 1:1 4:3 16:9
@@ -59,7 +60,7 @@
 	resParam *_param;
 
 public:
-	resizeWindow(resParam *param);
+	resizeWindow(QWidget *parent, resParam *param);
 	Ui_resizeDialog ui;
 
 public slots:
@@ -74,7 +75,7 @@
 	void aspectRatioChanged(int index);
 };
 
-resizeWindow::resizeWindow(resParam *param) : QDialog()
+resizeWindow::resizeWindow(QWidget *parent, resParam *param) : QDialog(parent)
  {
      ui.setupUi(this);
 	 lastPercentage = 100;
@@ -313,8 +314,10 @@
        
 
      // Fetch info
-     resizeWindow resizewindow(&amp;param) ;
-     ;
+     resizeWindow resizewindow(qtLastRegisteredDialog(), &amp;param);
+
+     qtRegisterDialog(&amp;resizewindow);
+
      if(resizewindow.exec()==QDialog::Accepted)
      {
        resizewindow.gather();
@@ -323,6 +326,9 @@
        *alg=param.algo;
        r=1;
      }
+
+	 qtUnregisterDialog(&amp;resizewindow);
+
      return r;
 }  
 //********************************************

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -33,6 +33,7 @@
 #include &quot;ADM_assert.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 //#include &quot;ADM_video/ADM_vidFont.h&quot;
 class ADMfont;
@@ -52,7 +53,7 @@
  public:
      flySrtPos *myCrop;
      ADM_QCanvas *canvas;
-     Ui_srtWindow(SRT_POS_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_srtWindow();
      Ui_srtDialog ui;
  public slots:
@@ -65,7 +66,7 @@
  private:
      
  };
-  Ui_srtWindow::Ui_srtWindow(SRT_POS_PARAM *param,AVDMGenericVideoStream *in)
+Ui_srtWindow::Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -165,7 +166,10 @@
         SRT_POS_PARAM param;
         param.fontSize=*size;
         param.position=*position;
-        Ui_srtWindow dialog(&amp;param,in);        
+        Ui_srtWindow dialog(qtLastRegisteredDialog(), &amp;param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(&amp;param);
@@ -173,6 +177,9 @@
             *position=param.position;
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -34,9 +34,9 @@
 #include &quot;ADM_videoFilter/ADM_vidVobSub.h&quot;
 
 #include &quot;ADM_assert.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 
-
 //
 //	Video is in YV12 Colorspace
 //
@@ -48,7 +48,7 @@
 	 vobSubParam *param;
 	 void  		 fillLanguage(const char *file);
  public:
-     Ui_vobsubWindow(vobSubParam *param);
+     Ui_vobsubWindow(QWidget *parent, vobSubParam *param);
      ~Ui_vobsubWindow();
      Ui_DialogVobSub ui;
      
@@ -59,7 +59,7 @@
  private:
      
  };
-  Ui_vobsubWindow::Ui_vobsubWindow(vobSubParam *parm)
+Ui_vobsubWindow::Ui_vobsubWindow(QWidget *parent, vobSubParam *parm) : QDialog(parent)
   {
     uint32_t width,height;
     	this-&gt;param=parm;
@@ -136,12 +136,18 @@
 uint8_t DIA_vobsub(vobSubParam *param)
 {
         uint8_t ret=0;
-        Ui_vobsubWindow dialog(param);        
+        Ui_vobsubWindow dialog(qtLastRegisteredDialog(), param);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
         	dialog.gather();
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -24,6 +24,7 @@
 #include &quot;ADM_assert.h&quot;
 #include &quot;ADM_osSupport/ADM_misc.h&quot;
 #include &quot;DIA_working.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
     
 extern void UI_purge(void);
 
@@ -32,7 +33,7 @@
      Q_OBJECT
 
  public:
-     workWindow();
+     workWindow(QWidget *parent);
      Ui_workDialog ui;
  public slots:
  private slots:
@@ -40,7 +41,7 @@
 };
 
 
-workWindow::workWindow()     : QDialog()
+workWindow::workWindow(QWidget *parent) : QDialog(parent)
  {
      ui.setupUi(this);
  }
@@ -49,14 +50,16 @@
 DIA_working::DIA_working( void )
 {
   workWindow *wind;
-  wind=new workWindow();
+  wind=new workWindow(qtLastRegisteredDialog());
+  qtRegisterDialog(wind);
   _priv=(void *)wind;
   postCtor();
 }
 DIA_working::DIA_working( const char *title )
 {
   workWindow *wind;
-  wind=new workWindow();
+  wind=new workWindow(qtLastRegisteredDialog());
+  qtRegisterDialog(wind);
   _priv=(void *)wind;
   wind-&gt;setWindowTitle(title);
   postCtor();
@@ -92,10 +95,10 @@
         _nextUpdate=elapsed+1000;
         lastper=percent;
 
-		uint32_t hh,mm,ss;
-		char string[9];
-
-		ms2time(elapsed,&amp;hh,&amp;mm,&amp;ss);
+		uint32_t hh,mm,ss;
+		char string[9];
+
+		ms2time(elapsed,&amp;hh,&amp;mm,&amp;ss);
 		sprintf(string,&quot;%02d:%02d:%02d&quot;,hh,mm,ss);
 
         workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
@@ -139,7 +142,8 @@
 void DIA_working::closeDialog( void )
 {
   workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
-    if(wind) delete wind;
+  qtUnregisterDialog(wind);
+    delete wind;
     wind=NULL;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -43,6 +43,7 @@
 #include &quot;ADM_encoder/adm_encoder.h&quot;
 #include &quot;DIA_idx_pg.h&quot;
 #include &quot;ADM_assert.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 extern void UI_purge( void );
 
@@ -117,7 +118,7 @@
  public:
    int abted;
    Ui_iDialog ui;
-     Ui_indexingDialog(const char *name);
+     Ui_indexingDialog(QWidget *parent, const char *name);
      ~Ui_indexingDialog();
     void setTime(const char *f);
     void setImage(const char *f);
@@ -130,29 +131,11 @@
      
  };
 static Ui_indexingDialog *dialog=NULL; 
-#if 0
-static gint on_destroy_abort(GtkObject * object, gpointer user_data)
-{
-DIA_progressIndexing *pf;
 
-        UNUSED_ARG(object);
-        UNUSED_ARG(user_data);
-
-        pf=(Ui_indexingDialog *)user_data;
-        if(!GUI_Confirmation_HIG(QT_TR_NOOP(&quot;Continue indexing&quot;),QT_TR_NOOP(&quot;Abort Requested&quot;),QT_TR_NOOP(&quot;Do you want to abort indexing ?&quot;)))
-        {
-         //       pf-&gt;abortRequest();
-                abted=1;
-        }
-
-        return TRUE;
-
-};
-#endif
-
 DIA_progressIndexing::DIA_progressIndexing(const char *name)
 {
-        dialog=new Ui_indexingDialog(name);
+        dialog=new Ui_indexingDialog(qtLastRegisteredDialog(), name);
+		qtRegisterDialog(dialog);
         clock.reset();
         aborted=0;
 	_nextUpdate=0;
@@ -163,6 +146,7 @@
 DIA_progressIndexing::~DIA_progressIndexing()
 {
         ADM_assert(dialog);
+		qtUnregisterDialog(dialog);
         delete dialog;
         dialog=NULL;
 }
@@ -220,7 +204,7 @@
         return 1;
 }
 //****************************** CLASS ***********************
-Ui_indexingDialog::Ui_indexingDialog(const char *name)
+Ui_indexingDialog::Ui_indexingDialog(QWidget *parent, const char *name) : QDialog(parent)
 {
       abted=0;
       ui.setupUi(this);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -18,6 +18,7 @@
 
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_assert.h&quot; 
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 static int beQuiet=0;
 extern QWidget *QuiMainWindows;
@@ -26,7 +27,7 @@
 void            GUI_Alert(const char *alertstring)
 {
     QMessageBox::StandardButton reply;
-              reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Alert&quot;)),
+              reply = QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Alert&quot;)),
                                         QString::fromUtf8(alertstring),
                                         QMessageBox::Ok );
 }
@@ -34,7 +35,7 @@
 void            GUI_Info(const char *alertstring)
 {
     QMessageBox::StandardButton reply;
-              reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+              reply = QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
                                         QString::fromUtf8(alertstring),
                                         QMessageBox::Ok );
 }
@@ -67,7 +68,7 @@
             va_end(ap);
          }
         QMessageBox::StandardButton reply;
-          reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+          reply = QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
                                     QString::fromUtf8(alertstring),
                                     QMessageBox::Ok );
 
@@ -100,7 +101,7 @@
             va_end(ap);
          }
           QMessageBox::StandardButton reply;
-          reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+          reply = QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
                                     QString::fromUtf8(alertstring),
                                     QMessageBox::Ok );
 }
@@ -129,7 +130,7 @@
               va_end(ap);
         }
           QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
+          reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
                                     QString::fromUtf8(alertstring),
                                     QMessageBox::Yes | QMessageBox::No );
           if(reply==QMessageBox::Yes) return 1;
@@ -160,7 +161,7 @@
               va_end(ap);
         }
           QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
+          reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
                                     QString::fromUtf8(alertstring),
                                     QMessageBox::Yes | QMessageBox::No );
           if(reply==QMessageBox::Yes) return 1;
@@ -175,7 +176,7 @@
                       printf(&quot;Question: %s\n&quot;, alertstring);
                       return 0;
               }
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Question&quot;)),
+          reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Question&quot;)),
                                     QString::fromUtf8(alertstring),
                                     QMessageBox::Yes | QMessageBox::No );
           if(reply==QMessageBox::Yes) return 1;
@@ -198,7 +199,7 @@
 
 char alertstring[1024];
 
-        box=new QMessageBox(QuiMainWindows);
+        box=new QMessageBox(qtLastRegisteredDialog());
         box-&gt;setWindowTitle(QString::fromUtf8(QT_TR_NOOP(&quot;Question ?&quot;)));
         box-&gt;addButton(choice1,QMessageBox::YesRole);
         box-&gt;addButton(choice2,QMessageBox::NoRole);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -31,6 +31,7 @@
 #include &quot;default.h&quot;
 #include &quot;ADM_commonUI/DIA_factory.h&quot;
 #include &quot;ADM_assert.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 
 static void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab);
 
@@ -42,7 +43,8 @@
 
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
 {
-  QDialog dialog;
+  QDialog dialog(qtLastRegisteredDialog());
+  qtRegisterDialog(&amp;dialog);
   
   ADM_assert(title);
   ADM_assert(nb);
@@ -89,8 +91,14 @@
         elems[i]-&gt;getMe(); 
     
       }
+
+	 qtUnregisterDialog(&amp;dialog);
+
     return 1;
   }
+
+  qtUnregisterDialog(&amp;dialog);
+
   return 0;
   
 }
@@ -109,7 +117,9 @@
 }
 uint8_t diaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs)
 {
-    QDialog dialog;
+    QDialog dialog(qtLastRegisteredDialog());
+
+	qtRegisterDialog(&amp;dialog);
   
   ADM_assert(title);
   ADM_assert(nb);
@@ -154,8 +164,13 @@
         }
     
       }
+	   qtUnregisterDialog(&amp;dialog);
+
       return 1;
   }
+
+  qtUnregisterDialog(&amp;dialog);
+
   return 0;
   
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -54,6 +54,8 @@
 #include &quot;ADM_video/ADM_vidPartial.h&quot;
 #include &quot;ADM_filter/vidVCD.h&quot;
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
+
 /*******************************************************/
 #define NB_TREE 8
 #define myFg 0xFF
@@ -784,10 +786,13 @@
 */
 int GUI_handleVFilter(void)
 {
-	filtermainWindow dialog(QuiMainWindows);
+	filtermainWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
 
 	dialog.exec();
 
+	qtUnregisterDialog(&amp;dialog);
+
 	return 0;
 }
 /** 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -31,6 +31,7 @@
 #include &lt;QtGui/QKeyEvent&gt;
 #include &lt;QtGui/QValidator&gt;
 
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
 #include &quot;ADM_qslider.h&quot;
 #include &quot;default.h&quot;
 #include &quot;ADM_osSupport/ADM_misc.h&quot;
@@ -237,6 +238,7 @@
 
 MainWindow::MainWindow() : QMainWindow()
 {
+	qtRegisterDialog(this);
 	ui.setupUi(this);
 
 	this-&gt;setStatusBar(0);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -21,6 +21,7 @@
 #include &quot;ADM_toolkit/filesel.h&quot;
 #include &quot;prefs.h&quot;
 #include &quot;ADM_assert.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
     
 static void GUI_FileSelSelect(const char *label, char **name, uint32_t access) ;
 
@@ -93,8 +94,8 @@
    options |= QFileDialog::DontUseNativeDialog;
 #endif
 
-   if(access)  fileName=QFileDialog::getSaveFileName(NULL, label, str, NULL, NULL, options);
-       else    fileName=QFileDialog::getOpenFileName(NULL, label, str, NULL, NULL, options);
+   if(access)  fileName=QFileDialog::getSaveFileName(qtLastRegisteredDialog(), label, str, NULL, NULL, options);
+       else    fileName=QFileDialog::getOpenFileName(qtLastRegisteredDialog(), label, str, NULL, NULL, options);
 
   if(!fileName.isNull() )
   {
@@ -125,7 +126,7 @@
   options |= QFileDialog::DontUseNativeDialog;
 #endif
 
-  fileName=QFileDialog::getSaveFileName(NULL, title, source, NULL, NULL, options);
+  fileName=QFileDialog::getSaveFileName(qtLastRegisteredDialog(), title, source, NULL, NULL, options);
 
   if(!fileName.isNull() )
   {
@@ -157,7 +158,7 @@
   options |= QFileDialog::DontUseNativeDialog;
 #endif
 
-  fileName = QFileDialog::getOpenFileName(NULL, title, source, NULL, NULL, options);
+  fileName = QFileDialog::getOpenFileName(qtLastRegisteredDialog(), title, source, NULL, NULL, options);
 
   if(!fileName.isNull() )
   {
@@ -191,7 +192,7 @@
    options |= QFileDialog::DontUseNativeDialog;
 #endif
 
-   fileName=QFileDialog::getExistingDirectory(NULL, title, source, options);
+   fileName=QFileDialog::getExistingDirectory(qtLastRegisteredDialog(), title, source, options);
 
   if(!fileName.isNull() )
   {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -38,6 +38,8 @@
 #include &quot;ADM_ocr/ADM_ocrInternal.h&quot;
 #include &quot;ui_ocr.h&quot;
 #include &quot;../ADM_dialog/DIA_flyDialogQt4.h&quot;
+#include &quot;../ADM_toolkit/qtToolkit.h&quot;
+
 extern void UI_purge(void);
 
 //*********************************************
@@ -47,7 +49,7 @@
  protected :
 	 
  public:
-     Ui_ocrWindow(void);
+     Ui_ocrWindow(QWidget *parent);
      ~Ui_ocrWindow();
      Ui_DialogOcr ui;
      
@@ -96,7 +98,7 @@
  private:
      
  };
-  Ui_ocrWindow::Ui_ocrWindow(void)
+Ui_ocrWindow::Ui_ocrWindow(QWidget *parent) : QDialog(parent)
   {
         ui.setupUi(this);
         ui.textEdit-&gt;setReadOnly(TRUE);
@@ -314,6 +316,7 @@
 	   Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
 	   ADM_assert(dialog==gDialog);
 		
+	   qtUnregisterDialog(dialog);
 		
 	   gDialog=NULL;
 	   delete dialog;
@@ -327,7 +330,8 @@
 void 	*ADM_ocrUiSetup(void)
 {
 	
-	   Ui_ocrWindow *dialog=new Ui_ocrWindow;
+	   Ui_ocrWindow *dialog=new Ui_ocrWindow(qtLastRegisteredDialog());
+	   qtRegisterDialog(dialog);
 	   dialog-&gt;setModal(TRUE);
 	   dialog-&gt;show();
 	   gDialog=dialog;

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/CMakeLists.txt	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/CMakeLists.txt	2008-09-21 21:34:50 UTC (rev 4390)
@@ -0,0 +1,7 @@
+SET(ADM_LIB ADM_toolkitQt4)
+SET(${ADM_LIB}_SRCS qtToolkit.cpp)
+
+include(adm_qt4)
+
+include_directories(&quot;${CMAKE_CURRENT_SOURCE_DIR}&quot;)
+include_directories(${QT_INCLUDES})

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/Makefile.am	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/Makefile.am	2008-09-21 21:34:50 UTC (rev 4390)
@@ -0,0 +1,19 @@
+
+noinst_LIBRARIES = libADM_toolitQt4.a 
+libADM_toolitQt4_a_SOURCES = qtToolkit.cpp
+
+INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
+		-I../../../ADM_libraries/ADM_utilities \
+		-I../../ADM_commonUI -I../../.. -I../../../ADM_libraries/ADM_lavutil \
+		-I../../../ADM_inputs -I../../../ADM_outputs @ADM_QTINCLUDES@
+
+libADM_toolitQt4_a_METASOURCES = AUTO
+
+
+include ../Makefile.adm
+filter_rsc.cpp : filter.qrc
+	$(RCC)  $&lt; -o $@   -name filter
+
+
+EXTRA_DIST =  
+

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.cpp	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.cpp	2008-09-21 21:34:50 UTC (rev 4390)
@@ -0,0 +1,28 @@
+#include &lt;QtCore/QStack&gt;
+
+#include &quot;qtToolkit.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+static QStack&lt;QWidget*&gt; widgetStack;
+
+void qtRegisterDialog(QWidget *dialog)
+{
+	if (widgetStack.count())
+		dialog-&gt;setParent(widgetStack.top(), Qt::Dialog);
+
+	widgetStack.push(dialog);
+}
+
+void qtUnregisterDialog(QWidget *dialog)
+{
+	ADM_assert(widgetStack.top() == dialog);
+	widgetStack.pop();
+}
+
+QWidget* qtLastRegisteredDialog()
+{
+	if (widgetStack.count())
+		return widgetStack.top();
+	else
+		return NULL;
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.h	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_toolkit/qtToolkit.h	2008-09-21 21:34:50 UTC (rev 4390)
@@ -0,0 +1,8 @@
+#ifndef QT_TOOLKIT_H
+#define QT_TOOLKIT_H
+#include &lt;QtGui/QWidget&gt;
+
+void qtRegisterDialog(QWidget *dialog);
+void qtUnregisterDialog(QWidget *dialog);
+QWidget* qtLastRegisteredDialog();
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2008-09-21 21:34:50 UTC (rev 4390)
@@ -3,6 +3,7 @@
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 include_directories(${QT_INCLUDES})
 
+add_subdirectory(ADM_toolkit)
 add_subdirectory(ADM_dialog)
 add_subdirectory(ADM_dialogFactory)
 add_subdirectory(ADM_filters)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2008-09-21 21:34:50 UTC (rev 4390)
@@ -4,7 +4,7 @@
 libADM_UI_QT4_a_SOURCES = ui_support.cpp
 
 INCLUDES = @ADM_QTINCLUDES@
-SUBDIRS = ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory ADM_ocr
+SUBDIRS = ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory ADM_ocr ADM_toolkit
 
 
 

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2008-09-21 18:05:00 UTC (rev 4389)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2008-09-21 21:34:50 UTC (rev 4390)
@@ -236,6 +236,7 @@
 	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_guiQt4)
 	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_filtersQt4)
 	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_toolkitQt4)
 endif(QT4_FOUND)
 
 add_libs_all_targets(ADM_utilities)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001629.html">[Avidemux-svn-commit] r4389 - branches/avidemux_2.4_branch/po
</A></li>
	<LI>Next message: <A HREF="001631.html">[Avidemux-svn-commit] r4391 - in	branches/avidemux_2.4_branch/avidemux: . ADM_userInterfaces/ADM_QT4	ADM_userInterfaces/ADM_QT4/ADM_toolkit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1630">[ date ]</a>
              <a href="thread.html#1630">[ thread ]</a>
              <a href="subject.html#1630">[ subject ]</a>
              <a href="author.html#1630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
