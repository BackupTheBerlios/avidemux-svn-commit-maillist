<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5746 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5746%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_libraries/ADM_utilities%20ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200912281535.nBSFZwXi026636%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002952.html">
   <LINK REL="Next"  HREF="002954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5746 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5746%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_libraries/ADM_utilities%20ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200912281535.nBSFZwXi026636%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5746 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Dec 28 16:35:58 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002952.html">[Avidemux-svn-commit] r5745 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
        <LI>Next message: <A HREF="002954.html">[Avidemux-svn-commit] r5747 - in	branches/avidemux_2.5_branch_gruntster: platforms/windows/installer	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/xml	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/xml/mpeg-1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2953">[ date ]</a>
              <a href="thread.html#2953">[ thread ]</a>
              <a href="subject.html#2953">[ subject ]</a>
              <a href="author.html#2953">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-12-28 16:35:49 +0100 (Mon, 28 Dec 2009)
New Revision: 5746

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
Log:
[qt] add a recent projects menu option to Qt interface

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2009-12-28 15:35:49 UTC (rev 5746)
@@ -107,6 +107,12 @@
 	{&quot;lastfiles.file4&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
 	{&quot;lastfiles.file5&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
 	{&quot;lastfiles.file6&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file1&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file2&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file3&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file4&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file5&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
+	{&quot;lastproject.file6&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
 	{&quot;lastdir_read&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
 	{&quot;lastdir_write&quot;,		FILENAME,&quot;&quot;,	NULL, NULL, NULL },
 	{&quot;message_level&quot;,		UINT,	&quot;2&quot;,	NULL,	&quot;0&quot;,	&quot;2&quot;	},
@@ -137,7 +143,7 @@
 	{&quot;priority.playback&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;4&quot;	}
 };
 
-int num_opts = 73;
+int num_opts = 79;
 // &lt;/prefs_gen&gt;
 
 #ifdef USE_LIBXML2
@@ -230,10 +236,12 @@
 #include &quot;prefs.h&quot;
 
 preferences::preferences(){
-	internal_lastfiles[0] = internal_lastfiles[1] = NULL;
-	internal_lastfiles[2] = internal_lastfiles[3] = NULL;
-	internal_lastfiles[4] = internal_lastfiles[5] = NULL;
-	internal_lastfiles[6] = NULL;
+	for (int index = 0; index &lt; 7; index++)
+		internal_lastfiles[index] = NULL;
+
+	for (int index = 0; index &lt; 7; index++)
+		_lastProjects[index] = NULL;
+
 	#ifdef USE_LIBXML2
 	xdoc = NULL;
 	#endif
@@ -245,6 +253,13 @@
 		if( internal_lastfiles[idx] )
 			ADM_dealloc(internal_lastfiles[idx]);
 	}
+
+	for (int idx = 0; idx &lt; 6; idx++)
+	{
+		if (_lastProjects[idx])
+			ADM_dealloc(_lastProjects[idx]);
+	}
+
 	#ifdef USE_LIBXML2
 	if( xdoc )
 		xmlFreeDoc(xdoc);
@@ -969,6 +984,129 @@
 #endif
 	return (const char**)internal_lastfiles;
 }
+
+const char **preferences::getLastProjects(void)
+{
+	for (int idx = 0; idx &lt; 6; idx++)
+	{
+		if (_lastProjects[idx])
+		{
+			ADM_dealloc(_lastProjects[idx]);
+			_lastProjects[idx] = NULL;
+		}
+	}
+
+	int firstIndex = LASTPROJECT_FILE1;
+	int lastIndex = LASTPROJECT_FILE6;
+	int counter = 0;
+
+	for (int currentIndex = firstIndex; currentIndex &lt;= lastIndex; currentIndex++)
+	{
+		if (opt_defs[currentIndex].current_val)
+			_lastProjects[counter] = ADM_strdup(opt_defs[currentIndex].current_val);
+
+		counter++;
+	}
+
+	_lastProjects[counter] = NULL;
+
+	return (const char**)_lastProjects;
+}
+
+int preferences::setLastProject(const char* file)
+{
+	if (!file)
+	{
+		fprintf(stderr, &quot;Prefs: setLastProject(NULL) called\n&quot;);
+		return RC_FAILED;
+	}
+
+	char *internal_file = ADM_PathCanonize(file);
+
+	if (!internal_file)
+	{
+		fprintf(stderr, &quot;Prefs: setLastProject: PathCanonize returns NULL\n&quot;);
+		return RC_FAILED;
+	}
+
+	int firstIndex = LASTPROJECT_FILE1;
+	int lastIndex = LASTPROJECT_FILE6;
+	list&lt;char*&gt; lastFileList;
+	int currentIndex = firstIndex;
+
+	for (int index = firstIndex; index &lt;= lastIndex; index++)
+	{
+		if (opt_defs[index].current_val &amp;&amp; strcmp(opt_defs[index].current_val, internal_file) != 0)
+			lastFileList.push_back(opt_defs[index].current_val);
+	}
+
+	lastFileList.push_front(ADM_strdup(internal_file));
+
+	while (!lastFileList.empty())
+	{
+		if (currentIndex &lt;= lastIndex)
+			opt_defs[currentIndex].current_val = lastFileList.front();
+		else
+			ADM_dealloc(lastFileList.front());
+
+		lastFileList.pop_front();
+		currentIndex++;
+	}
+
+	if(!xdoc)
+	{
+		// no .avidemuxrc file or not loaded yet
+		load();          // try to load it
+
+		if (!xdoc)
+		{    // really: no .avidemuxrc file
+			save();  // generate one from internal defaults and actual changes
+
+			if(xdoc)
+				erase_blank_nodes(xdoc-&gt;children);
+		}
+	}
+
+	if (!xdoc)
+	{
+		fprintf(stderr, &quot;Prefs: no xml document generated by load() nor save()\n&quot;);
+	}
+	else
+	{
+		// we assume a valid xml document, but maybe an older version
+		ADM_assert(xdoc-&gt;children);
+
+		xmlNodePtr p;
+		xmlNodePtr q;
+		
+		p = xdoc-&gt;children;				// -&gt;avidemux (should be there)
+		p = goto_node_with_create(p, &quot;lastfiles&quot;);	// -&gt;avidemux-&gt;lastfile
+
+		q = goto_node_with_create(p, &quot;file1&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE1].current_val ? opt_defs[LASTPROJECT_FILE1].current_val : &quot;&quot;));
+
+		q = goto_node_with_create(p, &quot;file2&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE2].current_val ? opt_defs[LASTPROJECT_FILE2].current_val : &quot;&quot;));
+
+		q = goto_node_with_create(p, &quot;file3&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE3].current_val ? opt_defs[LASTPROJECT_FILE3].current_val : &quot;&quot;));
+
+		q = goto_node_with_create(p, &quot;file4&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE4].current_val ? opt_defs[LASTPROJECT_FILE4].current_val : &quot;&quot;));
+
+		q = goto_node_with_create(p, &quot;file5&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE5].current_val ? opt_defs[LASTPROJECT_FILE5].current_val : &quot;&quot;));
+
+		q = goto_node_with_create(p, &quot;file6&quot;);
+		xmlNodeSetContent(q, (xmlChar*)(opt_defs[LASTPROJECT_FILE6].current_val ? opt_defs[LASTPROJECT_FILE6].current_val : &quot;&quot;));
+
+		save_xml_to_file();
+	}
+
+	delete[] internal_file;
+	return RC_OK;
+}
+
 int initPrefs(  void )
 {
   prefs = new preferences();

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2009-12-28 15:35:49 UTC (rev 5746)
@@ -1274,6 +1274,10 @@
         return 1;
 }
 
+void UI_updateRecentProjectsMenu(void)
+{
+}
+
 // Override arrow keys to quickly navigate
 uint8_t UI_arrow_enabled(void)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2009-12-28 15:35:49 UTC (rev 5746)
@@ -131,6 +131,10 @@
   return 1;
 }
 
+void UI_updateRecentProjectsMenu(void)
+{
+}
+
 uint8_t UI_arrow_enabled(void)
 {
   return 1;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2009-12-28 15:35:49 UTC (rev 5746)
@@ -683,6 +683,7 @@
 QWidget *QuiMainWindows=NULL;
 QGraphicsView *drawWindow=NULL;
 uint8_t UI_updateRecentMenu( void );
+void UI_updateRecentProjectsMenu(void);
 
 void UI_refreshCustomMenu(void)
 {
@@ -767,6 +768,7 @@
 
 	UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
 	UI_updateRecentMenu();
+	UI_updateRecentProjectsMenu();
 	setupMenus();
 	ADM_setCrashHook(&amp;saveCrashProject, &amp;FatalFunctionQt);
 	checkCrashFile();
@@ -825,6 +827,28 @@
 	}
 	return 1;
 }
+
+void UI_updateRecentProjectsMenu(void)
+{
+	const char **names = prefs-&gt;getLastProjects();
+	QAction *actions[6] = {WIDGET(actionRecentProject0), WIDGET(actionRecentProject1), WIDGET(actionRecentProject2),
+		WIDGET(actionRecentProject3), WIDGET(actionRecentProject4), WIDGET(actionRecentProject5)};
+
+	for(int index = 0; index &lt; 6; index++)
+		actions[index]-&gt;setVisible(false);
+
+	for (int index = 0; index &lt; 6; index++)
+	{
+		if (!names[index])
+			break;
+		else
+		{
+			actions[index]-&gt;setText(QString::fromUtf8(names[index]));
+			actions[index]-&gt;setVisible(true);
+		}
+	}
+}
+
 /** 
   \fn    setupMenus(void)
   \brief Fill in video &amp; audio co

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2009-12-28 15:35:49 UTC (rev 5746)
@@ -1410,6 +1410,17 @@
      &lt;addaction name=&quot;actionSave_jpeg&quot; /&gt;
      &lt;addaction name=&quot;actionSave_Selection&quot; /&gt;
     &lt;/widget&gt;
+    &lt;widget class=&quot;QMenu&quot; name=&quot;menuRecent_Projects&quot; &gt;
+     &lt;property name=&quot;title&quot; &gt;
+      &lt;string&gt;Recent Projects&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;addaction name=&quot;actionRecentProject0&quot; /&gt;
+     &lt;addaction name=&quot;actionRecentProject1&quot; /&gt;
+     &lt;addaction name=&quot;actionRecentProject2&quot; /&gt;
+     &lt;addaction name=&quot;actionRecentProject3&quot; /&gt;
+     &lt;addaction name=&quot;actionRecentProject4&quot; /&gt;
+     &lt;addaction name=&quot;actionRecentProject5&quot; /&gt;
+    &lt;/widget&gt;
     &lt;addaction name=&quot;actionOpen&quot; /&gt;
     &lt;addaction name=&quot;actionAppend&quot; /&gt;
     &lt;addaction name=&quot;menuSave&quot; /&gt;
@@ -1427,6 +1438,7 @@
     &lt;addaction name=&quot;actionConnect_to_AvsProxy&quot; /&gt;
     &lt;addaction name=&quot;separator&quot; /&gt;
     &lt;addaction name=&quot;menuRecent_Files&quot; /&gt;
+    &lt;addaction name=&quot;menuRecent_Projects&quot; /&gt;
     &lt;addaction name=&quot;separator&quot; /&gt;
     &lt;addaction name=&quot;actionQuit&quot; /&gt;
    &lt;/widget&gt;
@@ -2381,6 +2393,36 @@
     &lt;string&gt;Recent5&lt;/string&gt;
    &lt;/property&gt;
   &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject0&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject0&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject1&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject1&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject2&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject2&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject3&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject3&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject4&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject4&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
+  &lt;action name=&quot;actionRecentProject5&quot; &gt;
+   &lt;property name=&quot;text&quot; &gt;
+    &lt;string&gt;RecentProject5&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
  &lt;/widget&gt;
  &lt;customwidgets&gt;
   &lt;customwidget&gt;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2009-12-28 15:35:49 UTC (rev 5746)
@@ -63,6 +63,14 @@
 PROCESS(actionRecent1,ACT_RECENT1) \
 PROCESS(actionRecent2,ACT_RECENT2) \
 PROCESS(actionRecent3,ACT_RECENT3) \
+PROCESS(actionRecent4,ACT_RECENT4) \
+PROCESS(actionRecent5,ACT_RECENT5) \
+PROCESS(actionRecentProject0,ACT_RECENTPROJECT0) \
+PROCESS(actionRecentProject1,ACT_RECENTPROJECT1) \
+PROCESS(actionRecentProject2,ACT_RECENTPROJECT2) \
+PROCESS(actionRecentProject3,ACT_RECENTPROJECT3) \
+PROCESS(actionRecentProject4,ACT_RECENTPROJECT4) \
+PROCESS(actionRecentProject5,ACT_RECENTPROJECT5) \
 PROCESS(actionAdd_to_joblist,ACT_ADD_JOB) \
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2009-12-28 15:35:49 UTC (rev 5746)
@@ -44,6 +44,7 @@
 uint8_t UI_setTimeShift(int onoff,int value);
 
 uint8_t UI_updateRecentMenu( void );
+void UI_updateRecentProjectsMenu(void);
 
 uint8_t UI_arrow_enabled(void);
 uint8_t UI_arrow_disabled(void);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2009-12-28 15:35:49 UTC (rev 5746)
@@ -207,16 +207,35 @@
         case ACT_RECENT1:        
         case ACT_RECENT2:
         case ACT_RECENT3:
-                        const char **name;
-						char* fileName;
-                        int rank;
-                                name=prefs-&gt;get_lastfiles();
-                                rank=(int)action-ACT_RECENT0;
-                                ADM_assert(name[rank]);
-                                A_openAvi2 (name[rank], 0);
+		case ACT_RECENT4:
+		case ACT_RECENT5:
+		{
+			const char **name;
+			char* fileName;
+			int rank;
+			name=prefs-&gt;get_lastfiles();
+			rank=(int)action-ACT_RECENT0;
+			ADM_assert(name[rank]);
+			A_openAvi2 (name[rank], 0);
 
-                return;
-        case ACT_ViewMain: UI_toogleMain();return;
+			return;
+		}
+        case ACT_RECENTPROJECT0:
+        case ACT_RECENTPROJECT1:        
+        case ACT_RECENTPROJECT2:
+        case ACT_RECENTPROJECT3:
+		case ACT_RECENTPROJECT4:
+		case ACT_RECENTPROJECT5:
+		{
+			const char **name = prefs-&gt;getLastProjects();
+			int rank = (int)action - ACT_RECENTPROJECT0;
+
+			ADM_assert(name[rank]);
+			A_parseECMAScript(name[rank]);
+
+			return;
+		}
+		case ACT_ViewMain: UI_toogleMain();return;
         case ACT_ViewSide: UI_toogleSide();return;
         case ACT_DVB_Ocr:
         		DIA_ocrDvb();
@@ -1846,6 +1865,9 @@
       if( actual_workbench_file )
          ADM_dealloc(actual_workbench_file);
       actual_workbench_file = ADM_strdup(longname);
+
+	  prefs-&gt;setLastProject(longname);
+	  UI_updateRecentProjectsMenu();
    }
    ADM_dealloc(longname);
 }

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2009-12-28 15:35:49 UTC (rev 5746)
@@ -138,6 +138,14 @@
 ACT(RECENT1)
 ACT(RECENT2)
 ACT(RECENT3)
+ACT(RECENT4)
+ACT(RECENT5)
+ACT(RECENTPROJECT0)
+ACT(RECENTPROJECT1)
+ACT(RECENTPROJECT2)
+ACT(RECENTPROJECT3)
+ACT(RECENTPROJECT4)
+ACT(RECENTPROJECT5)
 
 ACT(AUTO_VCD)
 ACT(AUTO_SVCD)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2009-12-28 15:35:49 UTC (rev 5746)
@@ -53,6 +53,12 @@
 	LASTFILES_FILE4,
 	LASTFILES_FILE5,
 	LASTFILES_FILE6,
+	LASTPROJECT_FILE1,
+	LASTPROJECT_FILE2,
+	LASTPROJECT_FILE3,
+	LASTPROJECT_FILE4,
+	LASTPROJECT_FILE5,
+	LASTPROJECT_FILE6,
 	LASTDIR_READ,
 	LASTDIR_WRITE,
 	MESSAGE_LEVEL,
@@ -87,6 +93,8 @@
 class preferences {
 	private:
 		char *internal_lastfiles[7];
+		char *_lastProjects[7];
+
 		int save_xml_to_file();
 	public:
 		preferences();
@@ -117,6 +125,8 @@
                 int set(options option, const ADM_filename * val);
 		int set_lastfile(const char* file);
 		const char **get_lastfiles(void);
+		const char **getLastProjects(void);
+		int setLastProject(const char* file);
 };
 
 extern preferences *prefs;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2009-12-28 14:08:49 UTC (rev 5745)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2009-12-28 15:35:49 UTC (rev 5746)
@@ -67,6 +67,12 @@
 lastfiles.file4,			FILENAME,	&quot;&quot;
 lastfiles.file5,			FILENAME,	&quot;&quot;
 lastfiles.file6,			FILENAME,	&quot;&quot;
+lastproject.file1,			FILENAME,	&quot;&quot;
+lastproject.file2,			FILENAME,	&quot;&quot;
+lastproject.file3,			FILENAME,	&quot;&quot;
+lastproject.file4,			FILENAME,	&quot;&quot;
+lastproject.file5,			FILENAME,	&quot;&quot;
+lastproject.file6,			FILENAME,	&quot;&quot;
 lastdir_read,				FILENAME,	&quot;&quot;
 lastdir_write,				FILENAME,	&quot;&quot;
 # 0 - no messages, 1 - only error messages, 2 - all messages


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002952.html">[Avidemux-svn-commit] r5745 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
	<LI>Next message: <A HREF="002954.html">[Avidemux-svn-commit] r5747 - in	branches/avidemux_2.5_branch_gruntster: platforms/windows/installer	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/xml	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/xml/mpeg-1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2953">[ date ]</a>
              <a href="thread.html#2953">[ thread ]</a>
              <a href="subject.html#2953">[ subject ]</a>
              <a href="author.html#2953">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
