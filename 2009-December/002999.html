<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5792 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/src	avidemux/ADM_encoder avidemux/ADM_outputs/oplug_avi	avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpegFF avidemux/ADM_outputs/oplug_ogm	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5792%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_codecs%20avidemux/ADM_coreImage/src%0A%09avidemux/ADM_encoder%20avidemux/ADM_outputs/oplug_avi%0A%09avidemux/ADM_outputs/oplug_dummy%0A%09avidemux/ADM_outputs/oplug_flv%20avidemux/ADM_outputs/oplug_mp4%0A%09avidemux/ADM_outputs/oplug_mpegFF%20avidemux/ADM_outputs/oplug_ogm%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_avcodec&In-Reply-To=%3C200912310029.nBV0T8J0009183%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002998.html">
   <LINK REL="Next"  HREF="003000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5792 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/src	avidemux/ADM_encoder avidemux/ADM_outputs/oplug_avi	avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpegFF avidemux/ADM_outputs/oplug_ogm	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5792%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster%3A%20avidemux%0A%09avidemux/ADM_codecs%20avidemux/ADM_coreImage/src%0A%09avidemux/ADM_encoder%20avidemux/ADM_outputs/oplug_avi%0A%09avidemux/ADM_outputs/oplug_dummy%0A%09avidemux/ADM_outputs/oplug_flv%20avidemux/ADM_outputs/oplug_mp4%0A%09avidemux/ADM_outputs/oplug_mpegFF%20avidemux/ADM_outputs/oplug_ogm%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_commonUI%0A%09plugins/ADM_videoEncoder/ADM_vidEnc_avcodec&In-Reply-To=%3C200912310029.nBV0T8J0009183%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5792 - in	branches/avidemux_2.5_branch_gruntster: avidemux	avidemux/ADM_codecs avidemux/ADM_coreImage/src	avidemux/ADM_encoder avidemux/ADM_outputs/oplug_avi	avidemux/ADM_outputs/oplug_dummy	avidemux/ADM_outputs/oplug_flv avidemux/ADM_outputs/oplug_mp4	avidemux/ADM_outputs/oplug_mpegFF avidemux/ADM_outputs/oplug_ogm	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog	avidemux/ADM_userInterfaces/ADM_commonUI	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec">gruntster at mail.berlios.de
       </A><BR>
    <I>Thu Dec 31 01:29:08 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002998.html">[Avidemux-svn-commit] r5791 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
</A></li>
        <LI>Next message: <A HREF="003000.html">[Avidemux-svn-commit] r5793 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_encoder	avidemux/ADM_outputs/oplug_avi avidemux/ADM_plugin	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec	plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_xvid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2999">[ date ]</a>
              <a href="thread.html#2999">[ thread ]</a>
              <a href="subject.html#2999">[ subject ]</a>
              <a href="author.html#2999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-12-31 01:28:35 +0100 (Thu, 31 Dec 2009)
New Revision: 5792

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpegConfig.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageUtils.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encoder.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.hxx
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/Mpeg4aspParam.xsd
Log:
[mpeg4] remove old avcodec mpeg4 logic, change over smart copy and remove remaining ffmpeg plumbing

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_codecs.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -31,10 +31,7 @@
 #undef BIG_ENDIAN
 #endif
 
-//#include &quot;ADM_colorspace/colorspace.h&quot;
-
 #include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_codecs/ADM_mjpeg.h&quot;
 #include &quot;ADM_codecs/ADM_codecNull.h&quot;
 #include &quot;ADM_codecs/ADM_uyvy.h&quot;
 
@@ -44,15 +41,6 @@
 #include &quot;ADM_codecs/ADM_ffmp43.h&quot;
 #endif
 
-#ifdef USE_DIVX
-#include &quot;ADM_codecs/ADM_divx4.h&quot;
-#endif
-
-#ifdef USE_THEORA
-#include &quot;ADM_codecs/ADM_theora_dec.h&quot;
-#endif
-
-
 #include &quot;ADM_assert.h&quot;
 #include &quot;prefs.h&quot;
 

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,645 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpeg.cpp  -  description
-                             -------------------
-
-	Encoder for ffmpeg
-	Reverse enginereed from mplayer &amp; transcode
-		
-
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-
-
-#define __STDC_CONSTANT_MACROS // Lavcodec crap
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;ADM_lavcodec.h&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_assert.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-
-#include &quot;prefs.h&quot;
-
-#include &quot;ADM_video/ADM_vidMisc.h&quot;
-//#define TEST_NOB 1
-
-extern int ADM_cpu_num_processors(void);
-static char LogName[500];
-
-#define WRAP_Open(x) \
-{\
-AVCodec *codec=avcodec_find_encoder(x);\
-if(!codec) {GUI_Error_HIG(&quot;Codec&quot;,QT_TR_NOOP(&quot;Internal error opening codec&quot;#x));ADM_assert(0);} \
-  capabilities = codec-&gt;capabilities &amp; CODEC_CAP_DELAY ? ADM_ENC_REQ_NULL_FLUSH : 0; \
-  res=avcodec_open(_context, codec); \
-  if(res&lt;0) {GUI_Error_HIG(&quot;Codec&quot;,QT_TR_NOOP(&quot;Internal error with context for  codec&quot;#x&quot;.\n Did you use too low / too high target for 2 pass ?&quot;));return 0;} \
-}
-/*****************************************/
-uint8_t ffmpegEncoder::stopEncoder(void)
-{
-    printf(&quot;[lavc] stopEncoder (%x)\n&quot;,_context);
-    if (_context)
-    {
-        avcodec_close (_context);
-        av_free(_context);
-        _context = NULL;
-    }
-    return 1;
-}
-/*****************************************/
-ffmpegEncoderCQ::~ffmpegEncoderCQ ()
-  {
-    printf(&quot;[LAVCODEC]Deleting ffmpegCQencoder\n&quot;);
-    //stopEncoder ();
-    if (_statfile)
-      {
-        fflush(_statfile);
-	fclose (_statfile);
-      }
-  }
-/*****************************************/
-void ffmpegEncoder::postAmble (ADMBitstream * out, uint32_t sz)
-{
-  out-&gt;ptsFrame = _context-&gt;coded_frame-&gt;display_picture_number; //real_pict_num;;
- //printf(&quot;Out : %u\n&quot;,out-&gt;ptsFrame);
-  out-&gt;len = (uint32_t) sz;
-  out-&gt;flags = frameType ();;
-  if(!_context-&gt;coded_frame-&gt;quality)
-      out-&gt;out_quantizer=(int) floor (_frame.quality / (float) FF_QP2LAMBDA);
-  else
-      out-&gt;out_quantizer =(int) floor (_context-&gt;coded_frame-&gt;quality / (float) FF_QP2LAMBDA);
-
-}
-//static myENC_RESULT res;
-/*****************************************/
-ffmpegEncoder::ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id,PixelFormat format):encoder (width,
-	 height)
-{
-  printf (&quot;[LAVCODEC]Build: %d, colorspace :%x\n&quot;, LIBAVCODEC_BUILD,format);
-  _targetColorSpace=format;//PIX_FMT_YUV420P
-  _id = id;
-  _swap = 0;
-  _context = NULL;
-  _settingsPresence = 0;
-
-  _context = avcodec_alloc_context ();
-
-  ADM_assert (_context);
-  memset (&amp;_frame, 0, sizeof (_frame));
-  _frame.pts = AV_NOPTS_VALUE;
-  _context-&gt;width = _w;
-  _context-&gt;height = _h;
-
-  _isMT = 0;
-  encodePreamble(NULL);
-
-};
-/*****************************************/
-uint8_t   ffmpegEncoder::encode(ADMImage *in,ADMBitstream *out)
-{
-    int32_t sz = 0;
-    ADM_assert(out-&gt;bufferSize);
-	encodePreamble (in ? in-&gt;data : NULL);
-    if ((sz = avcodec_encode_video (_context, out-&gt;data, out-&gt;bufferSize, &amp;_frame)) &lt; 0)
-        return 0;
-    postAmble(out,sz);
-    return 1;
-}
-/*****************************************/
-ffmpegEncoder::~ffmpegEncoder ()
-{
-  printf (&quot;[lavc] encoder destroying..\n&quot;);
-  if (_isMT &amp;&amp; _context)
-    {
-      printf (&quot;[lavc] killing threads\n&quot;);
-      avcodec_thread_free (_context);
-      _isMT = 0;
-    }
-  stopEncoder ();
-}
-
-/*
-   	Initialize codec in Q mode
-
-*/
-
-uint8_t
-ffmpegEncoder::encodePreamble (uint8_t * in)
-{
-  _frame.key_frame = 0;
-  _frame.pict_type = 0;
-
-  if (in)
-  {
-	  switch(_targetColorSpace)
-	  {
-		case PIX_FMT_YUV420P:
-			_frame.linesize[0] = _w;
-			_frame.linesize[1] = _w &gt;&gt; 1;
-			_frame.linesize[2] = _w &gt;&gt; 1;
-			_frame.data[0] = in;
-			_frame.data[2] = in + _w * _h;
-			_frame.data[1] = in + _w * _h + ((_w * _h) &gt;&gt; 2);
-			break;
-	 case PIX_FMT_YUV422P:
-			_frame.linesize[0] = _w;
-			_frame.linesize[1] = _w &gt;&gt; 1;
-			_frame.linesize[2] = _w &gt;&gt; 1;
-			_frame.data[0] = in;
-			_frame.data[2] = in + _w * _h;
-			_frame.data[1] = in + _w * _h + ((_w * _h) &gt;&gt; 1);
-	      
-			break;
-		default:
-		  ADM_assert(0);
-	  }
-  }
-
-  return 1;
-}
-
-uint32_t
-ffmpegEncoder::frameType (void)
-{
-  int k, t;
-
-  k = _context-&gt;coded_frame-&gt;key_frame;
-  t = _context-&gt;coded_frame-&gt;pict_type;
-
-  //printf(&quot; Kf: %d type :%d \n&quot;,k,t);
-  if (k == 1)
-    return AVI_KEY_FRAME;
-  if (t == FF_B_TYPE)
-    return AVI_B_FRAME;
-  //if(t==FF_I_TYPE) return AVI_KEY_FRAME;
-  return 0;
-
-}
-
-uint8_t
-ffmpegEncoder::initContext (void)
-{
-  int res = 0;
-
-  // if (_id == FF_HUFF || _id == FF_FFV1)
-  _context-&gt;strict_std_compliance = -1;
-  
-  switch (_id)
-    {
-    case FF_MPEG4:
-      encoderMT ();
-      WRAP_Open (CODEC_ID_MPEG4);
-      break;
-    case FF_MSMP4V3:
-      WRAP_Open (CODEC_ID_MSMPEG4V3);
-      break;
-    default:
-      ADM_assert (0);
-    }
-
-  if (res &lt; 0)
-    {
-      printf (&quot;[lavc] Problem opening codec\n&quot;);
-      return 0;
-    }
-  return 1;
-
-}
-
-void ffmpegEncoder::encoderMT (void)
-{
-  uint32_t threads = 0;
-
-  prefs-&gt;get(FEATURE_THREADING_LAVC, &amp;threads);
-
-  if (threads == 0)
-	  threads = ADM_cpu_num_processors();
-
-  if (threads == 1)
-	  threads = 0;
-
-  if (threads)
-  {
-      printf (&quot;[lavc] Enabling MT encoder with %u threads\n&quot;, threads);
-
-      if (avcodec_thread_init (_context, threads) == -1)
-	      printf (&quot;[lavc] Failed!!\n&quot;);
-	  else
-          _isMT = 1;
-  }
-}
-
-/*
-		Set user selected matrices.
-
-*/
-uint8_t
-ffmpegEncoder::setCustomMatrices (uint16_t * intra, uint16_t * inter)
-{
-  _context-&gt;intra_matrix = intra;
-  _context-&gt;inter_matrix = inter;
-  return 1;
-}
-
-uint8_t
-ffmpegEncoder::setGopSize (uint32_t size)
-{
-
-  _context-&gt;gop_size = size;
-  printf (&quot;[LAVCODEC]Gop size is now %d\n&quot;, _context-&gt;gop_size);
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoder::setLogFile (const char *name)
-{
-  strcpy (LogName, name);
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoder::setConfig (FFcodecSetting * set)
-{
-  memcpy (&amp;_settings, set, sizeof (_settings));
-  _settingsPresence = 1;
-  return 1;
-
-}
-
-uint8_t
-ffmpegEncoderCQ::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
-{
-  printf (&quot;[LAVCODEC] Using Q=%u\n&quot;,val); 
-  mplayer_init ();
-  _qual = val;
-  _vbr = vbr;
-  _context-&gt;flags |= CODEC_FLAG_QSCALE;
-
-  if (_vbr)
-    {
-      _context-&gt;flags |= CODEC_FLAG_PASS1;
-      _statfile = NULL;
-
-    }
-  _context-&gt;time_base = (AVRational)  {  1000, fps1000};
-/*
-  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;
-*/
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-
-  return initContext ();
-}
-
-uint32_t ffmpegEncoder::getCodedFrame (void)
-{
-  return _last_coded_frame;
-}
-
-uint8_t ffmpegEncoderCQ::encode (ADMImage * in, ADMBitstream * out)
-{
-  int32_t    sz = 0;
-  uint32_t    f;
-  uint8_t    r=0;
-  
-  _frame.quality = (int) floor (FF_QP2LAMBDA * _qual + 0.5);
-  r=ffmpegEncoder::encode(in,out);
-  out-&gt;out_quantizer=_qual;
-  if (_vbr)			// update for lavcodec internal
-    {
-      if (!_statfile)
-	{
-	  printf (&quot;[lavc] using %s as log file\n&quot;, LogName);
-	  _statfile = fopen (LogName, &quot;wb&quot;);
-	}
-
-      if (!_statfile)
-	{
-	  printf
-	    (&quot;[lavc] cannot open log file for writing! (%s)\n&quot;,
-	     LogName);
-	  return 0;
-	}
-      if (_context-&gt;stats_out)
-	fprintf (_statfile, &quot;%s&quot;, _context-&gt;stats_out);
-    }
-
-  return 1;
-
-}
-
-/*
-_____________________________________________
-*/
-/*
-   	Initialize codec in CBR mode
-
-*/
-
-uint8_t ffmpegEncoderCBR::init (uint32_t val, uint32_t fps1000)
-{
-//       mpeg4_encoder
-  //
-//              now init our stuff
-//
-  _br = val;
-  mplayer_init ();
-/*  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;*/
-  _context-&gt;time_base = (AVRational)
-  {
-  1000, fps1000};
-
-	  _context-&gt;bit_rate = _br*1000;
-
-  printf (&quot;[LAVCODEC] Using  bitrate in context :%lu kbps&quot;,_context-&gt;bit_rate/1000);
-
-  return initContext ();
-
-}
-
-
-//------------------------------------------------------------------------------
-//              VBR
-//------------------------------------------------------------------------------
-uint8_t ffmpegEncoderVBR::encode (ADMImage * in, ADMBitstream * out)
-{
-    uint16_t q;
-    uint8_t kf;
-
-    q=out-&gt;in_quantizer;
-    _frame.quality = (int) floor (FF_QP2LAMBDA * q + 0.5);
-    return ffmpegEncoder::encode(in,out);
-
-}
-/*
-   			val is the average bitrate wanted, else it is useless
-*/
-uint8_t
-ffmpegEncoderVBR::init (uint32_t val, uint32_t fps1000)
-{
-  uint32_t statSize;
-  FILE *_statfile;
-
-  printf (&quot;[lavc] initializing in VBR mode\n&quot;);
-  _qual = val;
-  mplayer_init ();
-
-//   _context-&gt;frame_rate_base = 1000;
-//   _context-&gt;frame_rate = fps1000;
-
-  _context-&gt;time_base = (AVRational)  {  1000, fps1000};
-
-  /* If internal 2 passes mode is selected ... */
-  _context-&gt;flags |= CODEC_FLAG_PASS2;
-
-  _statfile = fopen (LogName, &quot;rb&quot;);
-  if (!_statfile)
-    {
-      printf (&quot;internal file does not exists ?\n&quot;);
-      return 0;
-    }
-
-  fseek (_statfile, 0, SEEK_END);
-  statSize = ftello (_statfile);
-  fseek (_statfile, 0, SEEK_SET);
-  _context-&gt;stats_in = (char *) ADM_alloc (statSize + 1);
-  _context-&gt;stats_in[statSize] = 0;
-  fread (_context-&gt;stats_in, statSize, 1, _statfile);
-  fclose(_statfile);
-
-  _context-&gt;bit_rate = val;	// bitrate
-
-  return initContext ();
-
-}
-
-ffmpegEncoderVBR::~ffmpegEncoderVBR ()
-{
-
-
-  ADM_dealloc (_context-&gt;stats_in);
-
-}
-
-//--------------------- FFmpeg VBR, external Qzation engine ------------------
-uint8_t
-ffmpegEncoderVBRExternal::encode (ADMImage * in, ADMBitstream * out)
-{
-    uint8_t r;
-    uint32_t q;
-  q=out-&gt;in_quantizer;
-  _frame.quality = (int) floor (FF_QP2LAMBDA * q + 0.5);
-  r= ffmpegEncoder::encode(in,out);
-  out-&gt;out_quantizer=q;
-  return r;
-}
-
-
-/**
-	This is used only for Mpeg1, so it is a bit tuned for it
-*/
-uint8_t
-ffmpegEncoderVBRExternal::init (uint32_t val, uint32_t fps1000)
-{
-
-  printf (&quot;[lavc] initializing in VBRExternal mode\n&quot;);
-  _qual = val;
-  mplayer_init ();
-
-/*  _context-&gt;frame_rate_base = 1000;
-  _context-&gt;frame_rate = fps1000;*/
-  _context-&gt;time_base = (AVRational) {  1000, fps1000};
-  _context-&gt;flags |= CODEC_FLAG_QSCALE;;
-  _context-&gt;bit_rate = 0;
-  _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-  _context-&gt;max_qdiff = 10;
-
-  // since this is used only for mpeg1 ...
-  // PAL ?
-  _context-&gt;bit_rate = 2500 * 1000 * 8;
-  _context-&gt;sample_aspect_ratio.num = 4;
-  _context-&gt;sample_aspect_ratio.den = 3;
-
-  return initContext ();;
-}
-
-ffmpegEncoderVBRExternal::~ffmpegEncoderVBRExternal ()
-{
-
-
-
-}
-
-//--------------------- FFmpeg VBR, external Qzation engine ------------------
-
-void
-ffmpegEncoder::mplayer_init (void)
-{
-  /*
-     default values : Copy/past from mplayer
-   */
-  _context-&gt;pix_fmt = _targetColorSpace;
-
-  if (!_settingsPresence)
-    {
-      printf (&quot;[lavc] using default encode settings \n&quot;);
-      _context-&gt;qmin = 2;
-      _context-&gt;qmax = 31;
-      _context-&gt;max_b_frames = 0;
-      _context-&gt;mpeg_quant = 0;
-      _context-&gt;me_method = ME_EPZS;
-      _context-&gt;flags = 0;
-      _context-&gt;max_qdiff = 3;
-      _context-&gt;luma_elim_threshold = 0;
-      _context-&gt;chroma_elim_threshold = 0;
-      _context-&gt;lumi_masking = 0.0;;
-      _context-&gt;dark_masking = 0.0;
-      _context-&gt;qcompress = 0.5;
-      _context-&gt;qblur = 0.5;
-      _context-&gt;gop_size = 250;
-    }
-  else
-    {
-	  _context-&gt;gop_size = 250;
-
-#define SETX(x) _context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %d\n&quot;,_settings.x);
-#define SETX_COND(x) if(_settings.is_##x) {_context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %d\n&quot;,_settings.x);} else\
-		{ printf(#x&quot; is not activated\n&quot;);}
-      SETX (me_method);
-      SETX (qmin);
-      SETX (qmax);
-      SETX (max_b_frames);
-      SETX (mpeg_quant);
-      SETX (max_qdiff);
-      SETX_COND (luma_elim_threshold);
-      SETX_COND (chroma_elim_threshold);
-
-#undef SETX
-#undef SETX_COND
-
-#define SETX(x)  _context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %f\n&quot;,_settings.x);
-#define SETX_COND(x)  if(_settings.is_##x) {_context-&gt;x=_settings.x; printf(&quot;[LAVCODEC]&quot;#x&quot; : %f\n&quot;,_settings.x);} else  \
-									{printf(&quot;[LAVCODEC]&quot;#x&quot; No activated\n&quot;);}
-      SETX_COND (lumi_masking);
-      SETX_COND (dark_masking);
-      SETX (qcompress);
-      SETX (qblur);
-      SETX_COND (temporal_cplx_masking);
-      SETX_COND (spatial_cplx_masking);
-
-#undef SETX
-#undef SETX_COND
-
-#define SETX(x) if(_settings.x){ _context-&gt;flags|=CODEC_FLAG##x;printf(&quot;[LAVCODEC]&quot;#x&quot; is set\n&quot;);}
-      SETX (_GMC);
-
-
-      switch (_settings.mb_eval)
-	{
-	case 0:
-	  _context-&gt;mb_decision = FF_MB_DECISION_SIMPLE;
-	  break;
-	case 1:
-	  _context-&gt;mb_decision = FF_MB_DECISION_BITS;
-	  break;
-	case 2:
-	  _context-&gt;mb_decision = FF_MB_DECISION_RD;
-	  break;
-	default:
-	  ADM_assert (0);
-
-
-	}
-      //SETX(_HQ);
-      SETX (_4MV);
-      SETX (_QPEL);
-      SETX (_NORMALIZE_AQP);
-
-      if (_settings.widescreen)
-	{
-	  _context-&gt;sample_aspect_ratio.num = 16;
-	  _context-&gt;sample_aspect_ratio.den = 9;
-	  printf (&quot;[LAVCODEC]16/9 aspect ratio is set.\n&quot;);
-
-	}
-#undef SETX
-    }
-    _context-&gt;bit_rate_tolerance = 1024 * 8 * 1000;
-
-
-  _context-&gt;b_quant_factor = 1.25;
-  _context-&gt;rc_strategy = 2;
-  _context-&gt;b_frame_strategy = 0;
-  _context-&gt;b_quant_offset = 1.25;
-  _context-&gt;rtp_payload_size = 0;
-  _context-&gt;strict_std_compliance = 0;
-  _context-&gt;i_quant_factor = 0.8;
-  _context-&gt;i_quant_offset = 0.0;
-  _context-&gt;rc_qsquish = 1.0;
-  _context-&gt;rc_qmod_amp = 0;
-  _context-&gt;rc_qmod_freq = 0;
-  _context-&gt;rc_eq = const_cast &lt; char *&gt;(&quot;tex^qComp&quot;);
-  _context-&gt;rc_max_rate = 000;
-  _context-&gt;rc_min_rate = 000;
-  _context-&gt;rc_buffer_size = 000;
-  _context-&gt;rc_buffer_aggressivity = 1.0;
-  _context-&gt;rc_initial_cplx = 0;
-  _context-&gt;dct_algo = 0;
-  _context-&gt;idct_algo = 0;
-  _context-&gt;p_masking = 0.0;
-
-  _context-&gt;bit_rate = 0;
-
-}
-
-uint8_t
-ffmpegEncoder::init (uint32_t val, uint32_t fps1000)
-{
-  UNUSED_ARG (val);
-  UNUSED_ARG (fps1000);
-  return 0;
-}
-
-uint8_t
-ffmpegEncoder::init (uint32_t val, uint32_t fps1000, uint8_t sw)
-{
-  UNUSED_ARG (sw);
-  return init (val, fps1000);
-}
-
-uint8_t
-ffmpegEncoder::getExtraData (uint32_t * l, uint8_t ** d)
-{
-  *d = (uint8_t *) _context-&gt;extradata;
-  *l = _context-&gt;extradata_size;
-  printf (&quot;[LAVCODEC]We got some extra data: %lu\n&quot;, *l);
-  if (*l)
-    return 1;
-
-  else
-    return 0;
-}
-
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,149 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpeg.h  -  description
-                             -------------------
-                             
-                             
-	Mpeg4 ****encoder******** using ffmpeg
-	                             
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef __FFMPEG_ENC__
-#define   __FFMPEG_ENC__
-#include &quot;ADM_colorspace.h&quot;
-typedef enum
-{
-  FF_MSMP4V3 = 1,
-  FF_MPEG4 = 2,
-} FF_CODEC_ID;
-
-/*
-	Some of FFmpeg internal options as encoder
-	User tunable
-*/
-
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
-
-class ffmpegEncoder:public encoder
-{
-protected:
-  void postAmble (ADMBitstream * out, uint32_t sz);
-  uint8_t _init;
-  uint8_t _swap;
-  AVCodecContext *_context;
-  AVFrame _frame;
-  FF_CODEC_ID _id;
-  uint32_t _last_coded_frame;
-  uint8_t _settingsPresence;
-  uint8_t _isMT;
-  FFcodecSetting _settings;
-  void mplayer_init (void);
-  uint8_t initContext (void);
-  uint32_t frameType (void);
-  uint8_t encodePreamble (uint8_t * in);
-  PixelFormat _targetColorSpace;
-
-public:
-	int capabilities;
-
-    uint8_t setConfig (FFcodecSetting * set);
-  uint8_t setLogFile (const char *name);
-  void encoderMT (void);
-    ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id,PixelFormat format=PIX_FMT_YUV420P);
-   virtual ~ffmpegEncoder ();
-
-  virtual uint8_t stopEncoder (void);
-  
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t sw);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual uint8_t getExtraData (uint32_t * l, uint8_t ** d);
-  virtual uint8_t setCustomMatrices (uint16_t * intra, uint16_t * inter);
-  virtual uint8_t setGopSize (uint32_t size);	// !!! IT DOES NOT WORK, DONE TOO LATE!!!!
-  uint32_t getCodedFrame (void);
-};
-
-class ffmpegEncoderCQ:public ffmpegEncoder
-{
-protected:uint32_t _qual;
-  uint8_t _vbr;
-  FILE *_statfile;
-
-public:  ffmpegEncoderCQ (uint32_t width, uint32_t height,
-		     FF_CODEC_ID id):ffmpegEncoder (width, height, id)
-  {
-    _qual = 3;
-    _vbr = 0;
-    _statfile = NULL;
-  };
-
-  virtual uint8_t init (uint32_t val, uint32_t fps1000, uint8_t vbr = 0);
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderCQ ();
-  
-};
-
-
-class ffmpegEncoderCBR:public ffmpegEncoder
-{
-protected:uint32_t _br;
-public:ffmpegEncoderCBR (uint32_t width, uint32_t height,
-		    FF_CODEC_ID id):ffmpegEncoder (width, height, id)
-  {
-    _br = 1000;
-  };
-
-  virtual ~ ffmpegEncoderCBR ()
-  {
-    stopEncoder ();
-  }
-  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-
-
-};
-
-class ffmpegEncoderVBR:public ffmpegEncoderCQ
-{
-protected:
-    uint8_t _internal;
-
-public:  virtual uint8_t init (uint32_t val, uint32_t fps1000);
-    ffmpegEncoderVBR (uint32_t width, uint32_t height,
-		      FF_CODEC_ID id):ffmpegEncoderCQ (width, height, id)
-  {
-    _internal = 1;
-  }
-  ffmpegEncoderVBR (uint32_t width, uint32_t height, uint8_t inter,
-		    FF_CODEC_ID id):ffmpegEncoderCQ (width, height, id)
-  {
-    _internal = inter;
-  }
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderVBR ();
-};
-
-
-class ffmpegEncoderVBRExternal:public ffmpegEncoderCQ
-{
-protected:
-public:
-        virtual uint8_t init (uint32_t val, uint32_t fps1000);
-                        ffmpegEncoderVBRExternal(uint32_t width,uint32_t height,FF_CODEC_ID id):
-                                ffmpegEncoderCQ (width, height,id)
-  {
-  }
-  virtual uint8_t encode (ADMImage * in, ADMBitstream * out);
-  virtual ~ ffmpegEncoderVBRExternal ();
-};
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpegConfig.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpegConfig.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,78 +0,0 @@
-/***************************************************************************
-                          ADM_ffmpegConfig -  description
-                             -------------------
-	Fine tuning for lavcodec encoder			     
-			     
-    begin                : 19-01-2003
-    copyright            : (C) 2003 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-
-   
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ADM_FFCONFIG
-#define ADM_FFCONFIG
-typedef struct FFcodecSetting
-{
-  Motion_Est_ID me_method;
-  uint32_t _GMC;
-  uint32_t _4MV;
-  uint32_t _QPEL;
-  uint32_t _TRELLIS_QUANT;
-  uint32_t qmin;			// 2-31
-  uint32_t qmax;			// 2-31
-  uint32_t max_qdiff;		// 1-31
-  uint32_t max_b_frames;		// 0-1
-  uint32_t mpeg_quant;		// 0-1
-  uint32_t is_luma_elim_threshold;
-  uint32_t luma_elim_threshold;	// -99--99
-  uint32_t is_chroma_elim_threshold;	// -99--99           
-  uint32_t chroma_elim_threshold;	// -99--99      
-
-  float lumi_masking;		// -1--1        
-  int32_t is_lumi_masking;		// -1--1
-  float dark_masking;		// -1--1        
-  int32_t is_dark_masking;		// -1--1
-  float qcompress;		// 0.0--1.0
-  float qblur;			// 0.0--1.0
-  uint32_t minBitrate;          // In kBits/s
-  uint32_t maxBitrate;          // In kBits/s
-  uint32_t user_matrix;		// 0 normal / 1 tmpgenc / 2 anime / 3 kvcd / 4 hr-tmpgenc
-  uint32_t gop_size;			// For mpeg1/2 , 12 is good
-  uint16_t *intra_matrix;
-  uint16_t *inter_matrix;
-  uint32_t interlaced;
-  uint32_t bff;			// WLA: bottom field first flag
-  uint32_t widescreen;          //0 4/3  1 16/9
-
-  // new stuff from jakub ui
-  uint32_t mb_eval;			// Replace hq 0..2
-  uint32_t vratetol;			// filesize tolerance in kb
-
-  uint32_t is_temporal_cplx_masking;	// temporal masking 0--1        
-  float temporal_cplx_masking;	// temporal masking 0--1
-
-  uint32_t is_spatial_cplx_masking;	// spatial masking 0--1
-  float spatial_cplx_masking;	// spatial masking 0--1
-  uint32_t _NORMALIZE_AQP;		// normalize adap quantiz
-
-  //
-  uint32_t use_xvid_ratecontrol;
-  uint32_t bufferSize;		// in KBYTES !!!!
-  uint32_t override_ratecontrol;
-  uint32_t dummy;
-
-} FFcodecSetting;
-
-
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,115 +0,0 @@
-#if 0
-/***************************************************************************
-                          ADM_mjpeg.cpp  -  description
-                             -------------------
-          I think i could use plain jpeg instead but....
-
-
-    begin                : Fri Apr 12 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &quot;ADM_assert.h&quot;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-#include &quot;ADM_default.h&quot;
-#include &quot;config.h&quot;
-#ifdef USE_MJPEG
-#include &quot;ADM_colorspace/colorspace.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_codecs/ADM_mjpeg.h&quot;
-extern &quot;C&quot;
-{
-#include &quot;mjpegtools/jpegutils.h&quot;
-}
-#include &quot;ADM_gui/GUI_decodersettings.h&quot;
- /*
-  * jpeg_data:       buffer with input / output jpeg
-  * len:             Length of jpeg buffer
-  * itype:           LAV_INTER_NONE: Not interlaced
-  *                  LAV_INTER_TOP_FIRST: Interlaced, top-field-first
-  *                  LAV_INTER_BOTTOM_FIRST: Interlaced, bottom-field-first
-  * ctype            Chroma format for decompression.
-  *                  Currently always 420 and hence ignored.
-  * raw0             buffer with input / output raw Y channel
-  * raw1             buffer with input / output raw U/Cb channel
-  * raw2             buffer with input / output raw V/Cr channel
-  * width            width of Y channel (width of U/V is width/2)
-  * height           height of Y channel (height of U/V is height/2)
-
-
-  int decode_jpeg_raw (unsigned char *jpeg_data, int len,
-  int itype, int ctype, int width, int height,
-  unsigned char *raw0, unsigned char *raw1,
-  unsigned char *raw2);
-
-  */
-void
-decoderMjpeg::setParam (void)
-{
-  int param;
-
-  param = _swap;
-  if (1 == getMjpegParams (&amp;param))
-    {
-      _swap = param;
-    }
-
-}
-//________________________________________________
-
-uint8_t
-  decoderMjpeg::uncompress (uint8_t * in, uint8_t * out, uint32_t len,
-			    uint32_t * flagz)
-{
-  //
-  uint32_t delta;
-  uint8_t *outu, *outv;
-  //
-  UNUSED_ARG (flagz);
-
-
-  delta = _w * _h;
-
-  outu = out + delta;
-  outv = outu + (delta &gt;&gt; 2);
-  if (!_swap)
-
-    decode_jpeg_raw (in, len, 1, 0, _w, _h, out, outu, outv);
-
-  else
-    decode_jpeg_raw (in, len, 1, 0, _w, _h, out, outv, outu);
-
-  return 1;
-
-
-}
-
-//_____________________________________________________
-
-decoderMjpeg::~decoderMjpeg ()
-{
-
-
-}
-// constructor for mjpeg, init encoder and stuff
-decoderMjpeg::decoderMjpeg (uint32_t w, uint32_t h):decoders (w, h)
-{
-  // some mjpeg are encoded with u &amp; v inverted
-  _swap = 0;
-
-}
-#endif
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_mjpeg.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,29 +0,0 @@
-/***************************************************************************
-                          ADM_mjpeg.h  -  description
-                             -------------------
-    begin                : Sat Apr 13 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-class decoderMjpeg:decoders
-{
-protected:
-  uint8_t _swap;
-
-public:
-  decoderMjpeg (uint32_t w, uint32_t h);
-  virtual ~ decoderMjpeg ();
-  virtual void setParam (void);
-  virtual uint8_t uncompress (uint8_t * in, uint8_t * out, uint32_t len,
-			      uint32_t * flag = NULL);
-};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/CMakeLists.txt	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,6 +1,5 @@
 SET(ADM_codecs_SRCS 
-	ADM_codecs.cpp  ADM_ffmpeg.cpp
-	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_uyvy.cpp)
+	ADM_codecs.cpp  ADM_ffmp43.cpp  ADM_uyvy.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageUtils.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreImage/src/ADM_imageUtils.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -27,7 +27,7 @@
 
 #include &quot;ADM_codecs/ADM_codec.h&quot;
 #include &quot;ADM_lavcodec.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
+
 #define QT_TR_NOOP(x) x // No translation in core*
 static uint8_t tinyAverage(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -22,66 +22,7 @@
   0,
   NULL
 };
-/********************** FFMPEG MPEG4*************************/
-uint8_t getFFCompressParams (COMPRES_PARAMS * incoming);
 
-FFcodecSetting ffmpeg4Extra = {
-  ME_EPZS,			//     ME
-  0,				//          GMC     
-  1,				// 4MV
-  0,				//           _QPEL;   
-  0,				//           _TREILLIS_QUANT
-  2,				//           qmin;
-  31,				//          qmax;
-  3,				//           max_qdiff;
-  0,				//           max_b_frames;
-  0,				//          mpeg_quant;
-  1,				//
-  -2,				//                 luma_elim_threshold;
-  1,				//
-  -5,				// chroma_elim_threshold;
-  0.05,				//lumi_masking;
-  1,				// is lumi
-  0.01,				//dark_masking; 
-  1,				// is dark
-  0.5,				// qcompress amount of qscale change between easy &amp; hard scenes (0.0-1.0
-  0.5,				// qblur;    amount of qscale smoothing over time (0.0-1.0) 
-  0,				// min bitrate in kB/S
-  0,				// max bitrate
-  0,				// default matrix
-  0,				// no gop size
-  NULL,
-  NULL,
-  0,				// interlaced
-  0,				// WLA: bottom-field-first
-  0,				// wide screen
-  2,				// mb eval = distortion
-  8000,				// vratetol 8Meg
-  0,				// is temporal
-  0.0,				// temporal masking
-  0,				// is spatial
-  0.0,				// spatial masking
-  0,				// NAQ
-  0				// DUMMY 
-};
-
-COMPRES_PARAMS ffmpegMpeg4 = {
-  CodecFF,
-  QT_TR_NOOP(&quot;MPEG-4 ASP (lavc)&quot;),
-  &quot;FFMpeg4&quot;,
-  &quot;Lavcodec Mpeg4&quot;,
-  COMPRESS_CQ,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR+ADM_ENC_CAP_SAME,
-  ADM_EXTRA_PARAM,
-  &amp;ffmpeg4Extra,
-  sizeof (ffmpeg4Extra),
-  getFFCompressParams
-};
-
 #include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
 // ************ Mpeg2enc VCD *************
 Mpeg2encParam VCDExtra = {
@@ -198,7 +139,6 @@
 
 COMPRES_PARAMS *internalVideoCodec[] = {
   &amp;CopyCodec,
-  &amp;ffmpegMpeg4,
   &amp;VCDCodec,
   &amp;SVCDCodec,
   &amp;DVDCodec,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2009-12-31 00:28:35 UTC (rev 5792)
@@ -20,7 +20,6 @@
 typedef enum 
 {
   CodecCopy,
-  CodecFF,
   CodecVCD,
   CodecSVCD,
   CodecDVD,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,6 +1,6 @@
 SET(ADM_encoder_SRCS 
 	adm_encConfig.cpp  adm_encoder.cpp
-	adm_encCopy.cpp    adm_encffmpeg.cpp   adm_encmpeg2enc.cpp  adm_encRequant.cpp  adm_encyv12.cpp
+	adm_encCopy.cpp    adm_encmpeg2enc.cpp  adm_encRequant.cpp  adm_encyv12.cpp
 	ADM_pluginLoad.cpp ADM_externalEncoder.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_encoder ${ADM_encoder_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -47,10 +47,6 @@
 
 #include &quot;adm_encConfig.h&quot;
 #include &quot;adm_encoder.h&quot;
-
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;adm_encffmpeg.h&quot;
-
 #include &quot;adm_encCopy.h&quot;
 #include &quot;adm_encyv12.h&quot;
 #include &quot;adm_encmpeg2enc.h&quot;
@@ -363,6 +359,16 @@
 
 int videoCodecPluginSelectByGuid(const char *guid)
 {
+	int index = videoCodecPluginGetIndexByGuid(guid);
+
+	if (index != -1)
+		videoCodecSetCodec(index);
+
+	return (index != -1);
+}
+
+int videoCodecPluginGetIndexByGuid(const char *guid)
+{
 	int encoderCount = encoderGetEncoderCount();
 
 	for (int i = 0; i &lt; encoderCount; i++)
@@ -375,14 +381,13 @@
 			if (strcmp(encoderGuid, guid) == 0)
 			{
 				printf (&quot;Codec plugin %s (%s) found\n&quot;, plugin-&gt;getEncoderName(plugin-&gt;encoderId), encoderGuid);
-				videoCodecSetCodec(i);
-
-				return 1;
+				
+				return i;
 			}
 		}
 	}
 
-	return 0;
+	return -1;
 }
 
 const char* videoCodecPluginGetGuid(void)
@@ -580,7 +585,7 @@
 	}
 }
 
-Encoder *getVideoEncoder(uint32_t w, uint32_t h, uint32_t globalHeaderFlag)
+Encoder *getVideoEncoder(uint32_t globalHeaderFlag)
 {
 	Encoder *e = NULL;
 	COMPRES_PARAMS *desc=getCodecParamFromTag(currentCodecType);
@@ -593,9 +598,6 @@
 	case CodecYV12:
 		e = new EncoderYV12 ();
 		break;
-	case CodecFF:
-		e = new EncoderFFMPEG (FF_MPEG4, desc);
-		break;
 	case CodecDVD:
 		e=new EncoderMpeg2enc(MPEG2ENC_DVD, desc);
 		printf(&quot;\n Using mpeg2enc encoder (DVD)\n&quot;);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -10,6 +10,7 @@
 const char *videoCodecGetName(void);
 int videoCodecSelectByName (const char *name);
 int videoCodecPluginSelectByGuid(const char *guid);
+int videoCodecPluginGetIndexByGuid(const char *guid);
 
 SelectCodecType videoCodecGetType(void);
 const char* videoCodecPluginGetGuid(void);

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,313 +0,0 @@
-/***************************************************************************
-                          adm_encffmpeg.cpp  -  description
-                             -------------------
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#define __STDC_LIMIT_MACROS
-
-#include &quot;config.h&quot;
-#include &quot;ADM_lavcodec.h&quot;
-
-
-#include &quot;fourcc.h&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-#include &quot;ADM_default.h&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_encoder/adm_encoder.h&quot;
-#include &quot;ADM_encoder/adm_encffmpeg.h&quot;
-
-uint32_t ADM_computeBitrate(uint32_t fps1000, uint32_t nbFrame, uint32_t sizeInMB);
-
-/*_________________________________________________*/
-EncoderFFMPEG::EncoderFFMPEG (FF_CODEC_ID id, COMPRES_PARAMS * config)
-{
-  _codec = NULL;
-  fd = NULL;
-  strcpy (_logname, &quot;&quot;);
-  _frametogo = 0;
-  memcpy (&amp;_param, config, sizeof (_param));
-  ADM_assert (sizeof (_settings) == config-&gt;extraSettingsLen);
-  memcpy (&amp;_settings, config-&gt;extraSettings, sizeof (_settings));
-  _id = id;
-};
-
-// return codec name as seen in avi header
-//
-const char *
-EncoderFFMPEG::getCodecName (void)
-{
-  switch (_id)
-    {
-    case FF_MPEG4:
-      return &quot;DX50&quot;;
-      break;
-    default:
-      ADM_assert (0);
-
-    }
-  return NULL;
-}
-//--------------------------------
-uint8_t EncoderFFMPEG::configure (AVDMGenericVideoStream * instream, int useExistingLogFile)
-{
-
-  ADM_assert (instream);
-  ADV_Info *
-    info;
-
-  uint32_t
-    flag1,
-    flag2,
-    flag3;
-  flag1 = flag2 = flag3 = 0;
-
-  info = instream-&gt;getInfo ();
-  _fps = info-&gt;fps1000;
-  _w = info-&gt;width;
-  _h = info-&gt;height;
-
-  _vbuffer = new ADMImage (_w, _h);
-  ADM_assert (_vbuffer);
-  _in = instream;
-
-
-  switch (_param.mode)
-    {
-    case COMPRESS_SAME:
-      printf (&quot;FFmpeg in follow quant mode\n&quot;);
-      _state = enc_Same;
-      _codec = new ffmpegEncoderVBRExternal (_w, _h, _id);
-      _codec-&gt;setConfig (&amp;_settings);
-      _codec-&gt;init (2, _fps, 0);
-      break;
-
-    case COMPRESS_CQ:
-      printf (&quot;ffmpeg cq mode: %ld\n&quot;, _param.qz);
-      _state = enc_CQ;
-      _codec = new ffmpegEncoderCQ (_w, _h, _id);
-      _codec-&gt;setConfig (&amp;_settings);
-      _codec-&gt;init (_param.qz, _fps, 0);
-      break;
-    case COMPRESS_CBR:
-      printf (&quot;ffmpeg cbr mode: %ld\n&quot;, _param.bitrate);
-      _state = enc_CBR;
-      _codec = new ffmpegEncoderCBR (_w, _h, _id);
-      _codec-&gt;setConfig (&amp;_settings);
-      _codec-&gt;init (_param.bitrate, _fps, flag1);
-      break;
-    case COMPRESS_2PASS:
-    case COMPRESS_2PASS_BITRATE:
-      ffmpegEncoderCQ * cdec;
-      if(_param.mode==COMPRESS_2PASS)
-        printf (&quot;\n ffmpeg dual size: %lu&quot;, _param.finalsize);
-      else
-        printf (&quot;\n ffmpeg dual bitrate: %lu&quot;, _param.avg_bitrate);
-      _state = enc_Pass1;
-      cdec = new ffmpegEncoderCQ (_w, _h, _id);	// Pass1
-      cdec-&gt;setConfig (&amp;_settings);
-      // 1+  VBR stats required
-      // no stats
-      // force internal
-      cdec-&gt;setLogFile (_logname);
-      cdec-&gt;init (2, _fps, 1);
-
-      _codec = cdec;
-      if (flag1)
-	_internal = 0;
-      else
-	_internal = 1;
-      break;
-
-      break;
-    default:
-      ADM_assert (0);
-
-    }
-  _in = instream;
-  printf (&quot;\n ffmpeg Encoder , w: %lu h:%lu mode:%d&quot;, _w, _h, _state);
-  return 1;
-
-}
-
-
-
-uint8_t EncoderFFMPEG::startPass1 (void)
-{
-  ADM_assert (_state == enc_Pass1);
-  _frametogo = 0;
-  printf (&quot;\n Starting pass 1\n&quot;);
-  printf (&quot; Creating logfile :&lt;%s&gt;\n&quot;, _logname);
-  return 1;
-}
-
-int EncoderFFMPEG::getRequirements (void) { return _codec-&gt;capabilities; }
-
-uint8_t EncoderFFMPEG::isDualPass (void)
-{
-  if ((_state == enc_Pass1) || (_state == enc_Pass2))
-    {
-      return 1;
-    }
-  return 0;
-}
-
-uint8_t EncoderFFMPEG::setLogFile (const char *lofile, uint32_t nbframe)
-{
-  strcpy (_logname, lofile);
-  _frametogo = nbframe;
-  printf(&quot;EncoderFF : using &lt;%s&gt; as logfile, for %u frames\n&quot;,lofile,nbframe);
-  return 1;
-
-}
-
-//______________________________
-uint8_t EncoderFFMPEG::encode (uint32_t frame, ADMBitstream *out)
-{
-  uint32_t l, f;
-  //ENC_RESULT enc;
-
-  ADM_assert (_codec);
-  ADM_assert (_in);
-
-  if (frame != UINT32_MAX)
-  {
-	  if (!_in-&gt;getFrameNumberNoAlloc (frame, &amp;l, _vbuffer, &amp;f))
-	  {
-		  printf (&quot;\n Error : Cannot read incoming frame !&quot;);
-		  return 0;
-	  }
-  }
-
-  switch (_state)
-    {
-    case enc_CBR:
-    case enc_CQ:
-      return _codec-&gt;encode (frame == UINT32_MAX ? NULL : _vbuffer, out );
-      break;
-    case enc_Same:
-      {
-		  if (frame != UINT32_MAX)
-		  {
-			  if (_vbuffer-&gt;flags &amp; AVI_KEY_FRAME)
-				  out-&gt;flags = AVI_KEY_FRAME;
-			  else
-				  out-&gt;flags = 0;
-
-			  int inq = _vbuffer-&gt;_Qp;
-
-			  if (inq &gt; 31)
-				  inq = 31;
-
-			  if (inq &lt; 2)
-				  inq = 2;
-
-			  out-&gt;in_quantizer = inq;
-		  }
-
-	if (!_codec-&gt;encode (frame == UINT32_MAX ? NULL : _vbuffer, out ))
-	  {
-	    printf (&quot;\n codec error on 1st pass !&quot;);
-	    return 0;
-	  }
-	//printf(&quot;Inq:%lu outq:%lu\n&quot;,inq,enc.out_quantizer);                       
-	_frametogo++;
-	return 1;
-	break;
-      }
-    case enc_Pass1:
-
-      //              ADM_assert(fd);
-      if (!_codec-&gt;encode (frame == UINT32_MAX ? NULL : _vbuffer, out ))
-	{
-	  printf (&quot;\n codec error on 1st pass !&quot;);
-	  return 0;
-	}
-      _frametogo++;
-      return 1;
-      break;
-    case enc_Pass2:
-      // Encode it !
-      if (!_codec-&gt;encode (frame == UINT32_MAX ? NULL : _vbuffer, out ))
-            return 0;
-      return 1;
-      break;
-
-    default:
-      ADM_assert (0);
-    }
-  return 0;
-}
-
-//_______________________________
-uint8_t EncoderFFMPEG::stop (void)
-{
-  if (_codec)
-    delete
-      _codec;
-  _codec = NULL;
-  return 1;
-
-}
-
-uint8_t EncoderFFMPEG::startPass2 (void)
-{
-
-  ADM_assert (_state = enc_Pass1);
-  printf (&quot;\n Starting pass 2\n&quot;);
-
-
-  printf (&quot;\n VBR paramaters computed\n&quot;);
-  _state = enc_Pass2;
-  // Delete codec and start new one
-  if (_codec)
-    {
-      delete _codec;
-      _codec = NULL;
-    }
-  _codec = new ffmpegEncoderVBR (_w, _h, _internal, _id);	//0 -&gt; external 1 -&gt; internal
-  _codec-&gt;setConfig (&amp;_settings);
-  printf (&quot;\n ready to encode in 2pass : %s\n&quot;, _logname);
-  uint32_t    vbr = 0;
-  switch(_param.mode)
-  {
-    case COMPRESS_2PASS:          
-          // compute average bitrate
-            vbr= ADM_computeBitrate(_fps, _frametogo,_param.finalsize);
-            break;
-    case COMPRESS_2PASS_BITRATE:
-            vbr=_param.avg_bitrate*1000; // in b/s
-            break;
-    default:
-          ADM_assert(0);
-  }
-
-  _codec-&gt;setLogFile (_logname);
-  if(!_codec-&gt;init (vbr, _fps))
-  {
-    printf(&quot;2 pass start failed!\n&quot;);
-    return 0;
-  }
-
-  printf (&quot;\n ** Total size     : %lu MBytes \n&quot;, _param.finalsize);
-//  printf(&quot; ** Total frame    : %lu  \n&quot;,_totalframe);   
-  printf (&quot; (using avg bitrate of %lu kbps&quot;, vbr / 1000);
-  return 1;
-}
-//-----------------------ffmpegEncoderHuff
-
-

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmpeg.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,58 +0,0 @@
-/***************************************************************************
-                          adm_encffmpeg.h  -  description
-                             -------------------
-    begin                : Tue Sep 10 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef __ADM_encoder_ff__
-#define __ADM_encoder_ff__
-
-
-
-class EncoderFFMPEG:public Encoder
-{
-
-protected:
-
-  ffmpegEncoder * _codec;
-  uint8_t _internal;
-  FF_CODEC_ID _id;
-  uint32_t _fps;
-  FFcodecSetting _settings;
-public:
-    EncoderFFMPEG (FF_CODEC_ID id, COMPRES_PARAMS * codecParam);
-   ~EncoderFFMPEG ()
-  {
-    stop ();
-  };				// can be called twice if needed ..
-  virtual int getRequirements (void);
-  virtual uint8_t isDualPass (void);
-  virtual uint8_t configure (AVDMGenericVideoStream * instream, int useExistingLogFile);
-  virtual uint8_t encode (uint32_t frame,ADMBitstream *out);
-  virtual uint8_t setLogFile (const char *p, uint32_t fr);
-  virtual uint8_t stop (void);
-  virtual uint8_t startPass2 (void);
-  virtual uint8_t startPass1 (void);
-  virtual const char *getDisplayName (void)
-  {
-    return QT_TR_NOOP(&quot;LavCodec&quot;);
-  }
-  virtual const char *getCodecName (void);	//{return &quot;DX50&quot;;}
-  virtual const char *getFCCHandler (void)
-  {
-    return &quot;divx&quot;;
-  }
-
-
-};
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encoder.h	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encoder.h	2009-12-31 00:28:35 UTC (rev 5792)
@@ -101,9 +101,8 @@
 
 
 };
-Encoder *getVideoEncoder (uint32_t w, uint32_t h, uint32_t globalHeader = 0);
+Encoder *getVideoEncoder (uint32_t globalHeader = 0);
 
-
 typedef enum
 {
   CodecFamilyAVI,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -69,7 +69,7 @@
 
 		}
 
-  _encode = getVideoEncoder (_incoming-&gt;getInfo()-&gt;width,_incoming-&gt;getInfo()-&gt;height);
+  _encode = getVideoEncoder();
   if (!_encode)
     return 0;
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -15,6 +15,9 @@
  *                                                                         *
  ***************************************************************************/
 
+#include &lt;sstream&gt;
+#include &lt;string&gt;
+
 #include &quot;config.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_threads.h&quot;
@@ -37,26 +40,25 @@
 #include &quot;ADM_videoFilter_internal.h&quot;
 
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+#include &quot;ADM_encoder/adm_encConfig.h&quot;
+#include &quot;ADM_encoder/ADM_externalEncoder.h&quot;
 
 #include &quot;op_aviwrite.hxx&quot;
 #include &quot;op_avisave.h&quot;
 #include &quot;op_savesmart.hxx&quot;
 
-#ifdef USE_FFMPEG		
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;		
-#endif
-
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME MODULE_SAVE_AVI
 #include &quot;ADM_osSupport/ADM_debug.h&quot;
 
+extern struct COMPRES_PARAMS *AllVideoCodec;
+
 GenericAviSaveSmart::GenericAviSaveSmart(uint32_t qf) : GenericAviSave()
 {
 	_cqReenc=qf;
 	ADM_assert(qf&gt;=2 &amp;&amp; qf&lt;32);
 	_nextip=0;
-	encoderReady=0;
-        _hasBframe=0;
+    _hasBframe=0;
 }
 uint8_t	GenericAviSaveSmart::setupVideo (char *name)
 {
@@ -89,9 +91,7 @@
       return 0;
     }
   compEngaged = 0;
-  encoderReady = 0;
   _encoder = NULL;
-  aImage=new ADMImage(_mainaviheader.dwWidth,_mainaviheader.dwHeight);
   _incoming = getFirstVideoFilter (frameStart,frameEnd-frameStart);
   encoding_gui-&gt;setFps(_incoming-&gt;getInfo()-&gt;fps1000);
   encoding_gui-&gt;setPhasis(QT_TR_NOOP(&quot;Smart Copy&quot;));
@@ -113,17 +113,7 @@
 GenericAviSaveSmart::~GenericAviSaveSmart ()
 {
   cleanupAudio();
-  if (encoderReady &amp;&amp; _encoder)
-    {
-      _encoder-&gt;stopEncoder ();
-    }
-  if (_encoder)
-    delete      _encoder;
- if(aImage)
- {
- 	delete aImage;
-	aImage=NULL;
- }
+  deleteEncoder();
 }
 
 // copy mode
@@ -152,22 +142,18 @@
 	  aprintf(&quot;Smart: Stopping encoder\n&quot;);
 	  // It is a kf, go back to copy mode
 	  compEngaged = 0;
-	  stopEncoder ();	// Tobias F
-	  delete	    _encoder;
-	  _encoder = NULL;
+	  deleteEncoder();
+
 	  return writeVideoChunk_copy(frame,1);
 	}
 	// Else encode it ....
-	//1-Read it
-	if (! video_body-&gt;getUncompressedFrame (frame, aImage))
-		return -1;
-	// 2-encode it
+	// 1-encode it
         bitstream.data=vbuffer;
         bitstream.cleanup(frame);
-        if (!_encoder-&gt;encode (aImage, &amp;bitstream))//vbuffer, &amp;len, &amp;_videoFlag))
+	    if (!_encoder-&gt;encode(frame, &amp;bitstream))
 		return -1;
         _videoFlag=bitstream.flags;
-	// 3-write it
+	// 2-write it
         encoding_gui-&gt;setFrame(frame-frameStart,bitstream.len,bitstream.out_quantizer,frametogo);
 	if (writter-&gt;saveVideoFrame (bitstream.len, _videoFlag, vbuffer))
 		return bitstream.len;
@@ -344,104 +330,70 @@
 	}
 	return 0;
 }
- //
- //
-uint8_t
-GenericAviSaveSmart::initEncoder (uint32_t qz)
+
+uint8_t GenericAviSaveSmart::initEncoder (uint32_t qz)
 {
-  aviInfo
-    info;
-  video_body-&gt;getVideoInfo (&amp;info);
-  ADM_assert (0 == encoderReady);
-  encoderReady = 1;
-  uint8_t ret=0;
-  FFcodecSetting myConfig=
-	 {
-	 ME_EPZS,//	ME
-	 0, // 		GMC	
-	 0,	// 4MV
-	 0,//		_QPEL;	 
-	 0,//		_TREILLIS_QUANT
-	 2,//		qmin;
-	 31,//		qmax;
-	 3,//		max_qdiff;
-	 1,//		max_b_frames;
-	 0, //		mpeg_quant;
-	 1, //
-	 -2, // 		luma_elim_threshold;
-	 1,//
-	 -5, 		// chroma_elim_threshold;
-	 0.05,		//lumi_masking;
-	 1,		// is lumi
-	 0.01,		//dark_masking; 
-	 1,		// is dark
- 	 0.5,		// qcompress amount of qscale change between easy &amp; hard scenes (0.0-1.0
-    	 0.5,		// qblur;    amount of qscale smoothing over time (0.0-1.0) 
-	0,		// min bitrate in kB/S
-	0,		// max bitrate
-	0, 		// default matrix
-	0, 		// no gop size
-	NULL,
-	NULL,
-	0,		// interlaced
-	0,		// WLA: bottom-field-first
-	0,		// wide screen
-	2,		// mb eval = distortion
-	8000,		// vratetol 8Meg
-	0,		// is temporal
-	0.0,		// temporal masking
-	0,		// is spatial
-	0.0,		// spatial masking
-	0,		// NAQ
-	0		// DUMMY 
- 	} ;
+	aviInfo info;
 
+	video_body-&gt;getVideoInfo (&amp;info);
 
-  if(  isMpeg4Compatible(info.fcc) )
-  	{
-// 	uint8_t				setConfig(FFcodecSetting *set);	
-			ffmpegEncoderCQ *tmp;		
-			tmp = new ffmpegEncoderCQ (info.width, info.height,FF_MPEG4);					
-			myConfig.max_b_frames=_hasBframe; // In fact does the original have b frame ?
-			tmp-&gt;setConfig(&amp;myConfig);
-			printf(&quot;\n init qz %ld\n&quot;,qz);
-	    		ret= tmp-&gt;init (qz,25000);
-			_encoder=tmp;
-		
-#warning 25 fps hardcoded
+	if (_encoder)
+		deleteEncoder();
 
-		 }
-		 else
-		 {
-#ifdef USE_FFMPEG			 
-			 if(isMSMpeg4Compatible(info.fcc) ) // DIV3
-			 {
-				 ffmpegEncoderCQ *tmp;
-				  tmp = new ffmpegEncoderCQ (info.width, info.height,FF_MSMP4V3);
-                                  myConfig.max_b_frames=0;
-				  tmp-&gt;setConfig(&amp;myConfig);
-			    	  ret= tmp-&gt;init (qz,25000);
-			    	  _encoder=tmp;
-				}
-				else
-					{
-				       ADM_assert(0);
-					}			
-			}
-#else
-			ADM_assert(0);
-			}			
-#endif
+	if (isMpeg4Compatible(info.fcc))
+	{
+		std::stringstream out;
 
-		return ret;
+		out &lt;&lt; &quot;&lt;?xml version='1.0'?&gt;&lt;Mpeg4aspConfig&gt;&lt;Mpeg4aspOptions&gt;&lt;motionEstimationMethod&gt;epzs&lt;/motionEstimationMethod&gt;&lt;fourMotionVector&gt;false&lt;/fourMotionVector&gt;&lt;maximumBFrames&gt;&quot;;
+		out &lt;&lt; _hasBframe;
+		out &lt;&lt; &quot;&lt;/maximumBFrames&gt;&lt;quarterPixel&gt;false&lt;/quarterPixel&gt;&lt;globalMotionCompensation&gt;false&lt;/globalMotionCompensation&gt;&lt;quantisationType&gt;h263&lt;/quantisationType&gt;&lt;macroblockDecisionMode&gt;rateDistortion&lt;/macroblockDecisionMode&gt;&lt;minimumQuantiser&gt;2&lt;/minimumQuantiser&gt;&lt;maximumQuantiser&gt;31&lt;/maximumQuantiser&gt;&lt;quantiserDifference&gt;3&lt;/quantiserDifference&gt;&lt;trellis&gt;false&lt;/trellis&gt;&lt;quantiserCompression&gt;0.5&lt;/quantiserCompression&gt;&lt;quantiserBlur&gt;0.5&lt;/quantiserBlur&gt;&lt;/Mpeg4aspOptions&gt;&lt;/Mpeg4aspConfig&gt;&quot;;
+		_encoderIndex = videoCodecPluginGetIndexByGuid(&quot;0E7C20E3-FF92-4bb2-A9A9-55B7F713C45A&quot;);
+
+		std::string settings = out.str();
+		COMPRES_PARAMS *param = &amp;AllVideoCodec[_encoderIndex];
+		ADM_vidEnc_plugin *plugin = getVideoEncoderPlugin(param-&gt;extra_param);
+		int length = plugin-&gt;getOptions(plugin-&gt;encoderId, NULL, NULL, 0);
+		vidEncOptions options;
+
+		options.structSize = sizeof(vidEncOptions);
+		options.encodeMode = ADM_VIDENC_MODE_CQP;
+		options.encodeModeParameter = qz;
+
+		_origSettings = new char[length + 1];
+		plugin-&gt;getOptions(plugin-&gt;encoderId, &amp;_origOptions, _origSettings, length);
+		plugin-&gt;setOptions(plugin-&gt;encoderId, &amp;options, (char*)settings.c_str());
+
+		if (_encoderIndex &gt; -1)
+		{
+			_encoder = new externalEncoder(param, 0);
+			_encoder-&gt;configure(_incoming, false);
+		}
+
+		return (_encoderIndex != -1);
+	}
+
+	return 1;
 }
 
+void GenericAviSaveSmart::deleteEncoder(void)
+{
+	if (_encoder)
+	{
+		COMPRES_PARAMS *param = &amp;AllVideoCodec[_encoderIndex];
+		ADM_vidEnc_plugin *plugin = getVideoEncoderPlugin(param-&gt;extra_param);
+
+		delete [] _origSettings;
+		delete _encoder;
+		_encoder = NULL;
+
+		plugin-&gt;setOptions(plugin-&gt;encoderId, &amp;_origOptions, _origSettings);
+	}
+}
+
 uint8_t
 GenericAviSaveSmart::stopEncoder (void)
 {
-  ADM_assert (1 == encoderReady);
-  encoderReady = 0;
-  return (_encoder-&gt;stopEncoder ());
+	return 1;
 }
 
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.hxx
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.hxx	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_savesmart.hxx	2009-12-31 00:28:35 UTC (rev 5792)
@@ -17,24 +17,29 @@
  #ifndef __AVI_SAVESMT__
  #define   __AVI_SAVESMT__
 
+#include &quot;ADM_encoder/ADM_pluginLoad.h&quot;
+
  class GenericAviSaveSmart : public   GenericAviSave
  {
      protected :
                                 uint32_t        _hasBframe;
-     #warning HARDCODED MAX IMAGE SIZE
-     				
-				ADMImage	*aImage;
 				uint32_t	_nextip;
 				uint8_t 	initEncoder(uint32_t qz );
 				uint8_t 	stopEncoder(void  );
-       				uint32_t 	encoderReady;
               			uint32_t 	compEngaged;
 	virtual 		uint8_t 	setupVideo( char *name  );
  	virtual 		int 	writeVideoChunk(uint32_t frame );
 				int		 writeVideoChunk_recode (uint32_t frame);
 				int		 writeVideoChunk_copy (uint32_t frame,uint32_t first=0);
-              			encoder 	*_encoder;
               			uint8_t 	_cqReenc          ;
+
+		Encoder *_encoder;
+		int _encoderIndex;
+
+		vidEncOptions _origOptions;
+		char *_origSettings;
+		
+		void deleteEncoder(void);
 				
      public:
      							

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -29,7 +29,6 @@
 };
 
 #include &quot;ADM_editor/ADM_Video.h&quot;
-//#include &quot;ADM_colorspace/colorspace.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
@@ -37,9 +36,6 @@
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
 #include &quot;ADM_codecs/ADM_codec.h&quot;
 #include &quot;ADM_encoder/adm_encoder.h&quot;
-
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_encoder/adm_encffmpeg.h&quot;
 #include &quot;../oplug_mpegFF/oplug_vcdff.h&quot;
 
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
@@ -116,7 +112,7 @@
 
            videoBuffer=new uint8_t[_incoming-&gt;getInfo()-&gt;width*_incoming-&gt;getInfo()-&gt;height*3];
                 // Set global header encoding, needed for H264
-           _encode = getVideoEncoder (_incoming-&gt;getInfo()-&gt;width,  _incoming-&gt;getInfo()-&gt;height,1);
+           _encode = getVideoEncoder(1);
            total= _incoming-&gt;getInfo()-&gt;nb_frames;
 
            info.fcc=*(uint32_t *)_encode-&gt;getCodecName(); //FIXME

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -37,8 +37,6 @@
 #include &quot;ADM_codecs/ADM_codec.h&quot;
 #include &quot;ADM_encoder/adm_encoder.h&quot;
 
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_encoder/adm_encffmpeg.h&quot;
 #include &quot;../oplug_mpegFF/oplug_vcdff.h&quot;
 
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
@@ -123,7 +121,7 @@
 
            videoBuffer=new uint8_t[_incoming-&gt;getInfo()-&gt;width*_incoming-&gt;getInfo()-&gt;height*3];
                 // Set global header encoding, needed for H264
-           _encode = getVideoEncoder (_incoming-&gt;getInfo()-&gt;width,  _incoming-&gt;getInfo()-&gt;height,1);
+           _encode = getVideoEncoder(1);
            total= _incoming-&gt;getInfo()-&gt;nb_frames;
 
            info.fcc=*(uint32_t *)_encode-&gt;getCodecName(); //FIXME

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -40,8 +40,6 @@
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
 #include &quot;ADM_encoder/adm_encoder.h&quot;
 
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_encoder/adm_encffmpeg.h&quot;
 #include &quot;../oplug_mpegFF/oplug_vcdff.h&quot;
 
 #include &quot;ADM_userInterfaces/ADM_commonUI/DIA_encoding.h&quot;
@@ -132,8 +130,7 @@
 
            videoBuffer=new uint8_t[_incoming-&gt;getInfo()-&gt;width*_incoming-&gt;getInfo()-&gt;height*3];
                 // Set global header encoding, needed for H264
-           _encode = getVideoEncoder (_incoming-&gt;getInfo()-&gt;width,
-                        _incoming-&gt;getInfo()-&gt;height,1);
+           _encode = getVideoEncoder(1);
            total= _incoming-&gt;getInfo()-&gt;nb_frames;
 
            encoding_gui=new DIA_encoding(_incoming-&gt;getInfo()-&gt;fps1000);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -170,7 +170,7 @@
             }
          }        
         // Create muxer
-       encoder = getVideoEncoder(_w, _h, 0);
+       encoder = getVideoEncoder(0);
 
 	   if (encoder == NULL)
 		   return 0;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -55,7 +55,7 @@
         _prestoring=1;
 	_incoming = getLastVideoFilter (frameStart,frameEnd-frameStart);
  	_togo=_incoming-&gt;getInfo()-&gt;nb_frames;
-  	_encode = getVideoEncoder (_incoming-&gt;getInfo()-&gt;width,_incoming-&gt;getInfo()-&gt;height);
+  	_encode = getVideoEncoder();
 	if (!_encode)
     		return 0;
  	

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -36,7 +36,6 @@
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
 #include &quot;ADM_coreAudio/include/audioencoder.h&quot;
 #include &quot;ADM_lavcodec.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
 
 #include &quot;ADM_ocr/ADM_ocr.h&quot;
 #include &quot;ADM_ocr/ADM_ocrInternal.h&quot;
@@ -48,24 +47,8 @@
 
 int SliderIsShifted = 0;
 
-
-
-
-#ifdef USE_XX_XVID 
-#include &quot;xvid.h&quot;
-int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
-		      uint32_t * br,uint32_t *fsize,xvidEncParam *param) {return 0;}
-#endif
-
-
-
-
-
 uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous) {return 0;}
-uint8_t DIA_pipe(char **cmd,char **param) {return 0;}
 uint8_t DIA_vobsub(vobSubParam *param) {return 0;}
-uint8_t DIA_XVCDParam(char *title,COMPRESSION_MODE * mode, uint32_t * qz,
-		   				   uint32_t * br,uint32_t *fsize,FFcodecSetting *conf) {return 0;}
 uint8_t DIA_quota(char *) {return 0;}
 const char * GUI_getCustomScript(uint32_t nb) {return 0;}
 uint8_t DIA_RecentFiles( char **name ) {return 0;}
@@ -78,14 +61,8 @@
 uint8_t DIA_job(uint32_t nb,char **name) {return 0;}
 uint8_t DIA_resize(uint32_t *width,uint32_t *height,uint32_t *algo,uint32_t originalw, 
                         uint32_t originalh,uint32_t fps) {return 0;}
-uint8_t DIA_d3d(double *luma,double *chroma,double *temporal) {return 0;}
-uint8_t DIA_kerneldeint(uint32_t *order, uint32_t *threshold, uint32_t *sharp, 
-                          uint32_t *twoway, uint32_t *map) {return 0;}
-uint8_t DIA_4entries(char *title,uint32_t *left,uint32_t *right,uint32_t *top,uint32_t *bottom) {return 0;}
 uint8_t DIA_videoCodec(int *codecIndex) {return 0;}
 uint8_t DIA_audioCodec( int *codec ) {return 0;}
-uint8_t DIA_dnr(uint32_t *llock,uint32_t *lthresh, uint32_t *clock,
-			uint32_t *cthresh, uint32_t *scene) {return 0;}
 uint8_t DIA_glyphEdit(void) {return 0;}
 struct THRESHOLD_PARAM;
 struct ADMVideoThreshold;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2009-12-31 00:28:35 UTC (rev 5792)
@@ -7,7 +7,6 @@
 DIA_gototime.cpp    
 DIA_postproc.cpp  
 DIA_bitrateHisto.cpp  
-DIA_lavcodec.cpp    
 DIA_prefs.cpp     
 DIA_SVCD.cpp       
 DIA_builtin.cpp       

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,113 +0,0 @@
-//
-// C++ Implementation: ADM_vidForcedPP
-//
-// Description: 
-//
-//	Force postprocessing assuming constant quant &amp; image type
-//	Uselefull on some badly authored DVD for example
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-#include &quot;config.h&quot;
-#include &quot;ADM_default.h&quot;
-
-
-#include &quot;DIA_factory.h&quot;
-#include &quot;ADM_lavcodec.h&quot;
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-/**
-      \fn getFFCompressParams
-      \brief Dialog for lavcodec mpeg4/... codec settings
-*/
-uint8_t getFFCompressParams(COMPRES_PARAMS *incoming)
-{
-int ret=0;	
-	FFcodecSetting *conf=(FFcodecSetting *)incoming-&gt;extraSettings;
-	ADM_assert(incoming-&gt;extraSettingsLen==sizeof(FFcodecSetting));
-#define PX(x) &amp;(conf-&gt;x)
-         
-         
-         
-diaMenuEntry meE[]={
-  {1,QT_TR_NOOP(&quot;None&quot;)},
-  {2,QT_TR_NOOP(&quot;Full&quot;)},
-  {3,QT_TR_NOOP(&quot;Log&quot;)},
-  {4,QT_TR_NOOP(&quot;Phods&quot;)},
-  {5,QT_TR_NOOP(&quot;EPZS&quot;)},
-  {6,QT_TR_NOOP(&quot;X1&quot;)}
-};       
-
-diaMenuEntry qzE[]={
-  {0,QT_TR_NOOP(&quot;H.263&quot;)},
-  {1,QT_TR_NOOP(&quot;MPEG&quot;)}
-};       
-
-diaMenuEntry rdE[]={
-  {0,QT_TR_NOOP(&quot;MB comparison&quot;)},
-  {1,QT_TR_NOOP(&quot;Fewest bits (vhq)&quot;)},
-  {2,QT_TR_NOOP(&quot;Rate distortion&quot;)}
-};     
-
-uint32_t me=(uint32_t)conf-&gt;me_method;  
-
-         diaElemBitrate bitrate(incoming,NULL);
-         diaElemMenu      meM(&amp;me,QT_TR_NOOP(&quot;Matrices&quot;),4,meE);
-         diaElemUInteger  qminM(PX(qmin),QT_TR_NOOP(&quot;Mi_n. quantizer:&quot;),1,31);
-         diaElemUInteger  qmaxM(PX(qmax),QT_TR_NOOP(&quot;Ma_x. quantizer:&quot;),1,31);
-         diaElemUInteger  qdiffM(PX(max_qdiff),QT_TR_NOOP(&quot;Max. quantizer _difference:&quot;),1,31);
-         
-         diaElemToggle    fourMv(PX(_4MV),QT_TR_NOOP(&quot;4_MV&quot;));
-         diaElemToggle    trellis(PX(_TRELLIS_QUANT),QT_TR_NOOP(&quot;_Trellis quantization&quot;));
-         
-         diaElemToggle    qpel(PX(_QPEL),QT_TR_NOOP(&quot;_Quarter pixel&quot;));
-         diaElemToggle    gmc(PX(_GMC),QT_TR_NOOP(&quot;_GMC&quot;));
-
-         
-         diaElemUInteger  max_b_frames(PX(max_b_frames),QT_TR_NOOP(&quot;_Number of B frames:&quot;),0,32);
-         diaElemMenu     qzM(PX(mpeg_quant),QT_TR_NOOP(&quot;_Quantization type:&quot;),2,qzE);
-         
-         diaElemMenu     rdM(PX(mb_eval),QT_TR_NOOP(&quot;_Macroblock decision:&quot;),3,rdE);
-         
-         diaElemUInteger filetol(PX(vratetol),QT_TR_NOOP(&quot;_Filesize tolerance (kb):&quot;),0,100000);
-         
-         diaElemFloat    qzComp(PX(qcompress),QT_TR_NOOP(&quot;_Quantizer compression:&quot;),0,1);
-         diaElemFloat    qzBlur(PX(qblur),QT_TR_NOOP(&quot;Quantizer _blur:&quot;),0,1);
-         
-         
-          /* First Tab : encoding mode */
-        diaElem *diamode[]={&amp;bitrate};
-        diaElemTabs tabMode(QT_TR_NOOP(&quot;User Interface&quot;),1,diamode);
-        
-        /* 2nd Tab : ME */
-        diaElemFrame frameMe(QT_TR_NOOP(&quot;Advanced Simple Profile&quot;));
-        
-        frameMe.swallow(&amp;max_b_frames);
-        frameMe.swallow(&amp;qpel);
-        frameMe.swallow(&amp;gmc);
-        
-        diaElem *diaME[]={&amp;fourMv,&amp;frameMe};
-        diaElemTabs tabME(QT_TR_NOOP(&quot;Motion Estimation&quot;),2,diaME);
-        /* 3nd Tab : Qz */
-        
-         diaElem *diaQze[]={&amp;qzM,&amp;rdM,&amp;qminM,&amp;qmaxM,&amp;qdiffM,&amp;trellis};
-        diaElemTabs tabQz(QT_TR_NOOP(&quot;Quantization&quot;),6,diaQze);
-        
-        /* 4th Tab : RControl */
-        
-         diaElem *diaRC[]={&amp;filetol,&amp;qzComp,&amp;qzBlur};
-        diaElemTabs tabRC(QT_TR_NOOP(&quot;Rate Control&quot;),3,diaRC);
-        
-         diaElemTabs *tabs[]={&amp;tabMode,&amp;tabME,&amp;tabQz,&amp;tabRC};
-        if( diaFactoryRunTabs(QT_TR_NOOP(&quot;libavcodec MPEG-4 configuration&quot;),4,tabs))
-	{
-          conf-&gt;me_method=(Motion_Est_ID)me;
-          return 1;
-        }
-         return 0;
-}
-// EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -12,7 +12,6 @@
 
 #include &quot;ADM_codecs/ADM_codec.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_codecs/ADM_ffmpegConfig.h&quot;
 
   
 #include &quot;DIA_factory.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2009-12-31 00:28:35 UTC (rev 5792)
@@ -57,7 +57,6 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
 #include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
 #include &quot;ADM_video/ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/Mpeg4aspParam.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/Mpeg4aspParam.xsd	2009-12-30 19:08:15 UTC (rev 5791)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/Mpeg4aspParam.xsd	2009-12-31 00:28:35 UTC (rev 5792)
@@ -1,6 +1,6 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
 &lt;xs:schema xmlns:xs=&quot;<A HREF="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</A>&quot; elementFormDefault=&quot;qualified&quot;&gt;
-  &lt;xs:element name=&quot;H263Config&quot;&gt;
+  &lt;xs:element name=&quot;Mpeg4aspConfig&quot;&gt;
     &lt;xs:complexType&gt;
       &lt;xs:sequence&gt;
         &lt;xs:element name=&quot;presetConfiguration&quot; minOccurs=&quot;0&quot;&gt;
@@ -35,7 +35,7 @@
             &lt;/xs:sequence&gt;
           &lt;/xs:complexType&gt;
         &lt;/xs:element&gt;
-        &lt;xs:element name=&quot;H263Options&quot;&gt;
+        &lt;xs:element name=&quot;Mpeg4aspOptions&quot;&gt;
           &lt;xs:complexType&gt;
             &lt;xs:sequence&gt;
               &lt;xs:element name=&quot;motionEstimationMethod&quot;&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002998.html">[Avidemux-svn-commit] r5791 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
</A></li>
	<LI>Next message: <A HREF="003000.html">[Avidemux-svn-commit] r5793 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_encoder	avidemux/ADM_outputs/oplug_avi avidemux/ADM_plugin	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec	plugins/ADM_videoEncoder/ADM_vidEnc_x264	plugins/ADM_videoEncoder/ADM_vidEnc_xvid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2999">[ date ]</a>
              <a href="thread.html#2999">[ thread ]</a>
              <a href="subject.html#2999">[ subject ]</a>
              <a href="author.html#2999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
