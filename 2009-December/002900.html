<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5693 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux_core/ADM_core/src	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src	avidemux_plugins/ADM_videoFilters6
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5693%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/gtk/ADM_UIs/include%20avidemux/qt4/ADM_UIs/include%0A%09avidemux/qt4/ADM_UIs/src%20avidemux_core/ADM_core/src%0A%09avidemux_core/ADM_coreVideoFilter/include%0A%09avidemux_core/ADM_coreVideoFilter/src%0A%09avidemux_plugins/ADM_videoFilters6&In-Reply-To=%3C200912211331.nBLDVwkq028381%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002899.html">
   <LINK REL="Next"  HREF="002901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5693 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux_core/ADM_core/src	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src	avidemux_plugins/ADM_videoFilters6</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5693%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/gtk/ADM_UIs/include%20avidemux/qt4/ADM_UIs/include%0A%09avidemux/qt4/ADM_UIs/src%20avidemux_core/ADM_core/src%0A%09avidemux_core/ADM_coreVideoFilter/include%0A%09avidemux_core/ADM_coreVideoFilter/src%0A%09avidemux_plugins/ADM_videoFilters6&In-Reply-To=%3C200912211331.nBLDVwkq028381%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5693 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux_core/ADM_core/src	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src	avidemux_plugins/ADM_videoFilters6">mean at mail.berlios.de
       </A><BR>
    <I>Mon Dec 21 14:31:58 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002899.html">[Avidemux-svn-commit] r5692 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:	. crop crop/cli crop/gtk crop/qt4
</A></li>
        <LI>Next message: <A HREF="002901.html">[Avidemux-svn-commit] r5694 - in branches/avidemux_2.6_branch_mean:	avidemux/cli/ADM_UIs/include avidemux/cli/ADM_UIs/src	avidemux/cli/ADM_userInterfaces/ADM_dialog	avidemux/cli/ADM_userInterfaces/ADM_gui2	avidemux/common/ADM_script avidemux/gtk/ADM_UIs/src	avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/gtk/ADM_userInterfaces/ADM_filters	avidemux/gtk/ADM_userInterfaces/ADM_ocr avidemux/qt4/ADM_UIs/include	avidemux_plugins/ADM_videoFilters6/crop cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2900">[ date ]</a>
              <a href="thread.html#2900">[ thread ]</a>
              <a href="subject.html#2900">[ subject ]</a>
              <a href="author.html#2900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-12-21 14:31:55 +0100 (Mon, 21 Dec 2009)
New Revision: 5693

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_QCanvas.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
Log:
[flyDialog] common+qt4, skeleton of the flyDialog class to ease on the fly filter preview

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/include/DIA_flyDialogGtk.h	2009-12-21 13:31:55 UTC (rev 5693)
@@ -28,7 +28,7 @@
 class ADM_flyDialogGtk : public ADM_flyDialog
 {
 public:
-  ADM_flyDialogGtk(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
+  ADM_flyDialogGtk(uint32_t width, uint32_t height, ADM_coreVideoFilter *in,
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod);
   virtual           ~ADM_flyDialogGtk(void);
   virtual uint8_t  isRgbInverted(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/include/DIA_flyDialogQt4.h	2009-12-21 13:31:55 UTC (rev 5693)
@@ -17,7 +17,7 @@
 #ifndef ADM_FLY_DIALOG_QT4H
 #define ADM_FLY_DIALOG_QT4H
 #include &quot;ADM_image.h&quot;
-#include &quot;ADM_videoFilter.h&quot;
+//#include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 
 class FlyDialogEventFilter : public QObject
@@ -35,7 +35,7 @@
 class ADM_flyDialogQt4 : public ADM_flyDialog
 {
 public:
-  ADM_flyDialogQt4(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
+  ADM_flyDialogQt4(uint32_t width, uint32_t height, ADM_coreVideoFilter *in,
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod);
 
   

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/CMakeLists.txt	2009-12-21 13:31:55 UTC (rev 5693)
@@ -7,8 +7,8 @@
 SET(${ADM_LIB}_T
 	T_bitrate.cpp  T_button.cpp  T_dialogFactory.cpp  T_filesel.cpp  T_menu.cpp
 	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp  T_notch.cpp
-        #T_flyDialogQt4.cpp 
-        #T_QCanvas.cpp
+        T_flyDialogQt4.cpp 
+        T_QCanvas.cpp
 )
 
 SET(${ADM_LIB}_SRCS
@@ -20,5 +20,4 @@
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../include)
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
 TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_coreUI6 ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} ADM_render6_qt4)
-#INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)
 ADM_INSTALL_LIB( ${ADM_LIB} )

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_QCanvas.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_QCanvas.cpp	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_QCanvas.cpp	2009-12-21 13:31:55 UTC (rev 5693)
@@ -17,8 +17,6 @@
 #include &lt;QtGui/QSlider&gt;
 
 #include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
 
 void ADM_QCanvas::changeSize(uint32_t w,uint32_t h)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_UIs/src/T_flyDialogQt4.cpp	2009-12-21 13:31:55 UTC (rev 5693)
@@ -1,6 +1,7 @@
 /***************************************************************************
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+    \file T_flyDialogQt4.cpp
+    \brief QT4 variabt of fly dialogs
+    \author mean (c) 2006, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
 ***************************************************************************/
 
 /***************************************************************************
@@ -19,19 +20,25 @@
 #include &lt;QtGui/QSlider&gt;
 
 #include &quot;ADM_default.h&quot;
-
-//#include &quot;ADM_videoFilter.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
 
 extern float UI_calcZoomToFitScreen(QWidget* window, QWidget* canvas, uint32_t imageWidth, uint32_t imageHeight);
 extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w, uint32_t *h);
+/**
+    \fn    FlyDialogEventFilter
+    \brief
+*/
 
 FlyDialogEventFilter::FlyDialogEventFilter(ADM_flyDialog *flyDialog)
 {
 	recomputed = false;
 	this-&gt;flyDialog = flyDialog;
 }
+/**
+    \fn    eventFilter
+    \brief
+*/
 
 bool FlyDialogEventFilter::eventFilter(QObject *obj, QEvent *event)
 {
@@ -49,13 +56,21 @@
 
 	return QObject::eventFilter(obj, event);
 }
+/**
+    \fn    ADM_flyDialog
+    \brief
+*/
 
-  ADM_flyDialogQt4::ADM_flyDialogQt4(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
+  ADM_flyDialogQt4::ADM_flyDialogQt4(uint32_t width, uint32_t height, ADM_coreVideoFilter *in,
                               void *canvas, void *slider, int yuv, ResizeMethod resizeMethod):
                                 ADM_flyDialog(width,height,in,canvas,slider,yuv,resizeMethod) 
 {
         EndConstructor();
 }
+/**
+    \fn    postInit
+    \brief
+*/
 
 void ADM_flyDialogQt4::postInit(uint8_t reInit)
 {
@@ -67,7 +82,7 @@
 		FlyDialogEventFilter *eventFilter = new FlyDialogEventFilter(this);
 
 		if (slider)
-			slider-&gt;setMaximum(_in-&gt;getInfo()-&gt;nb_frames);
+			slider-&gt;setMaximum(ADM_FLY_SLIDER_MAX);
 
 		graphicsView-&gt;parentWidget()-&gt;installEventFilter(eventFilter);
 	}
@@ -76,11 +91,19 @@
 	graphicsView-&gt;setMinimumSize(_zoomW, _zoomH);
 	graphicsView-&gt;resize(_zoomW, _zoomH);
 }
+/**
+    \fn    calcZoomFactor
+    \brief
+*/
 
 float ADM_flyDialogQt4::calcZoomFactor(void)
 {
 	return UI_calcZoomToFitScreen(((ADM_QCanvas*)_canvas)-&gt;parentWidget()-&gt;parentWidget(), ((ADM_QCanvas*)_canvas)-&gt;parentWidget(), _w, _h);
 }
+/**
+    \fn    display
+    \brief
+*/
 
 uint8_t  ADM_flyDialogQt4::display(void)
 {
@@ -89,11 +112,16 @@
    view-&gt;dataBuffer=_rgbBufferOut;
    if(!_rgbBufferOut)
    {
-      printf(&quot;flyDialog: No rgbuffer ??\n&quot;); 
+      ADM_info(&quot;flyDialog: No rgbuffer ??\n&quot;); 
    } 
    view-&gt;repaint();
   return 1; 
 }
+/**
+    \fn    sliderGet
+    \brief
+*/
+
 uint32_t ADM_flyDialogQt4::sliderGet(void)
 {
   QSlider  *slide=(QSlider *)_slider;
@@ -101,13 +129,23 @@
   return slide-&gt;value();
   
 }
+/**
+    \fn    sliderSet
+    \brief
+*/
+
 uint8_t     ADM_flyDialogQt4::sliderSet(uint32_t value)
 {
   QSlider  *slide=(QSlider *)_slider;
   ADM_assert(slide);
+  if(value&gt;ADM_FLY_SLIDER_MAX) value=ADM_FLY_SLIDER_MAX;
   slide-&gt;setValue(value);
   return 1; 
 }
+/**
+    \fn    isRgbInverted
+    \brief
+*/
 uint8_t  ADM_flyDialogQt4::isRgbInverted(void)
 {
   return 1; 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_fileio.cpp	2009-12-21 13:31:55 UTC (rev 5693)
@@ -22,7 +22,8 @@
 #include &lt;unistd.h&gt;
 #ifndef __WIN32
 #include &lt;fcntl.h&gt;
-#else
+#endif
+#ifdef __WIN32
 #include &lt;direct.h&gt;
 #include &lt;shlobj.h&gt;
 #elif defined(__APPLE__)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2009-12-21 13:31:55 UTC (rev 5693)
@@ -40,6 +40,9 @@
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_colorspace.h&quot;
 #include &quot;ADM_coreVideoFilter.h&quot;
+
+#define ADM_FLY_SLIDER_MAX 1000
+
 enum ResizeMethod {
     RESIZE_NONE = 0,	// No automatic resize
 	RESIZE_AUTO = 1,	// Resize image when convenient (YUV: after filter, RGB: before applying filter)
@@ -57,7 +60,10 @@
 };
 
 typedef float gfloat;
-
+/**
+    \class ADM_flyDialog
+    \brief Base class for flyDialog
+*/
 class ADM_flyDialog
 {
   protected:
@@ -120,11 +126,11 @@
   
   virtual uint8_t  isRgbInverted(void)=0;
   virtual uint8_t  display(void)=0;
-  virtual float   calcZoomFactor(void)=0;
-  virtual uint32_t sliderGet(void)=0;
-  virtual uint8_t  sliderSet(uint32_t value) =0;
-  virtual void    postInit(uint8_t reInit)=0;
-  virtual uint8_t sliderChanged(void);
+  virtual float    calcZoomFactor(void)=0;
+  virtual uint32_t sliderGet(void)=0;             // Return the slider value between 0 and ADM_FLY_SLIDER_MAX
+  virtual uint8_t  sliderSet(uint32_t value) =0;  // Set slider value between 0 and ADM_FLY_SLIDE_MAX
+  virtual void     postInit(uint8_t reInit)=0;
+  virtual uint8_t  sliderChanged(void);
 };
 #if !defined(ADM_FLY_INTERNAL)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2009-12-21 13:31:55 UTC (rev 5693)
@@ -22,7 +22,10 @@
 extern &quot;C&quot; {
 #include &quot;ADM_ffmpeg/libavcodec/avcodec.h&quot;
 }
-
+/**
+    \fn    ADM_flyDialog
+    \brief Constructor
+*/
 ADM_flyDialog::ADM_flyDialog(uint32_t width,uint32_t height,ADM_coreVideoFilter *in,
                                 void *canvas, void *slider,int yuv, ResizeMethod resizeMethod)
 {
@@ -113,6 +116,11 @@
                 }
                 postInit (false);
   }
+/**
+    \fn    recomputeSize
+    \brief recompute zoom factor
+*/
+
 void ADM_flyDialog::recomputeSize(void)
 {
     float new_zoom = calcZoomFactor();
@@ -218,7 +226,9 @@
     ADM_assert(_yuvBuffer);
     ADM_assert(_rgbBufferOut);
     ADM_assert(_in);
-    
+
+#warning    DISABLED
+
     //if(!_in-&gt;getFrameNumberNoAlloc(fn,&amp;len,_yuvBuffer,&amp;flags))
     {
       printf(&quot;[FlyDialog] Cannot get frame %u\n&quot;,fn); 
@@ -240,6 +250,10 @@
 
     return display();
 }
+/**
+    \fn    copyYuvFinalToRgb
+    \brief
+*/
 
 void ADM_flyDialog::copyYuvFinalToRgb(void)
 {
@@ -248,6 +262,10 @@
 	else
 		_rgb-&gt;scale(_yuvBufferOut-&gt;data, _rgbBufferOut);
 }
+/**
+    \fn    copyYuvScratchToRgb
+    \brief
+*/
 
 void ADM_flyDialog::copyYuvScratchToRgb(void)
 {
@@ -256,6 +274,10 @@
 	else
 		_rgb-&gt;scale(_yuvBuffer-&gt;data,_rgbBuffer);
 }
+/**
+    \fn    copyRgbFinalToDisplay
+    \brief
+*/
 
 void ADM_flyDialog::copyRgbFinalToDisplay(void)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2009-12-21 13:31:51 UTC (rev 5692)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2009-12-21 13:31:55 UTC (rev 5693)
@@ -1,3 +1,4 @@
 ADD_SUBDIRECTORY(dummy)
 ADD_SUBDIRECTORY(verticalFlip)
 ADD_SUBDIRECTORY(resize)
+ADD_SUBDIRECTORY(crop)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002899.html">[Avidemux-svn-commit] r5692 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:	. crop crop/cli crop/gtk crop/qt4
</A></li>
	<LI>Next message: <A HREF="002901.html">[Avidemux-svn-commit] r5694 - in branches/avidemux_2.6_branch_mean:	avidemux/cli/ADM_UIs/include avidemux/cli/ADM_UIs/src	avidemux/cli/ADM_userInterfaces/ADM_dialog	avidemux/cli/ADM_userInterfaces/ADM_gui2	avidemux/common/ADM_script avidemux/gtk/ADM_UIs/src	avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/gtk/ADM_userInterfaces/ADM_filters	avidemux/gtk/ADM_userInterfaces/ADM_ocr avidemux/qt4/ADM_UIs/include	avidemux_plugins/ADM_videoFilters6/crop cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2900">[ date ]</a>
              <a href="thread.html#2900">[ thread ]</a>
              <a href="subject.html#2900">[ subject ]</a>
              <a href="author.html#2900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
