<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5692 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:	. crop crop/cli crop/gtk crop/qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5692%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6%3A%0A%09.%20crop%20crop/cli%20crop/gtk%20crop/qt4&In-Reply-To=%3C200912211331.nBLDVqJJ028350%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002898.html">
   <LINK REL="Next"  HREF="002900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5692 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:	. crop crop/cli crop/gtk crop/qt4</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5692%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6%3A%0A%09.%20crop%20crop/cli%20crop/gtk%20crop/qt4&In-Reply-To=%3C200912211331.nBLDVqJJ028350%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5692 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:	. crop crop/cli crop/gtk crop/qt4">mean at mail.berlios.de
       </A><BR>
    <I>Mon Dec 21 14:31:52 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002898.html">[Avidemux-svn-commit] r5691 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
</A></li>
        <LI>Next message: <A HREF="002900.html">[Avidemux-svn-commit] r5693 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux_core/ADM_core/src	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src	avidemux_plugins/ADM_videoFilters6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2899">[ date ]</a>
              <a href="thread.html#2899">[ thread ]</a>
              <a href="subject.html#2899">[ subject ]</a>
              <a href="author.html#2899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-12-21 14:31:51 +0100 (Mon, 21 Dec 2009)
New Revision: 5692

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/ADM_vidCrop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/cli/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/cli/DIA_crop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop_desc.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/gtk/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/gtk/DIA_crop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/crop.ui
Log:
[crop] Added crop video filter as example for flyDialog

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/ADM_vidCrop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/ADM_vidCrop.cpp	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/ADM_vidCrop.cpp	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,193 @@
+/***************************************************************************
+    \file ADM_vidCrop
+    \brief Crop Filter
+    \author Mean 2002, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.Fr</A>
+
+          Crop top/left/right/bottom
+          Each one ,must be even
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_coreVideoFilterInternal.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;crop.h&quot;
+#include &quot;crop_desc.cpp&quot;
+
+/**
+    \class CropFilter
+*/
+class  CropFilter:public ADM_coreVideoFilter
+ {
+
+ protected:
+                crop           configuration;
+                ADMImage       *original;
+
+ public:
+
+                                CropFilter(  ADM_coreVideoFilter *in,CONFcouple *couples);
+        virtual                 ~CropFilter();
+
+       virtual const char   *getConfiguration(void);          /// Return  current configuration as a human readable string
+       virtual bool         getNextFrame(ADMImage *image);    /// Return the next image
+       virtual FilterInfo  *getInfo(void);                    /// Return picture parameters after this filter
+	   virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+       virtual bool         configure(void) ;                 /// Start graphical user interface
+    
+ };
+ 
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   CropFilter,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_TYPE_BUILD,         // UI
+                        VF_TRANSFORM,            // Category
+                        &quot;crop&quot;,            // internal name (must be uniq!)
+                        &quot;crop&quot;,            // Display name
+                        &quot;crop filter&quot; // Description
+                    );
+
+
+//_______________________________________________________________
+/**
+    \fn CropFilter
+*/
+CropFilter::CropFilter(ADM_coreVideoFilter *in,CONFcouple *couples) :ADM_coreVideoFilter(in,couples)
+{
+
+        original=new ADMImage(info.width,info.height);
+        if(!couples || !ADM_paramLoad(couples,crop_param,&amp;configuration))
+		{
+            // Default value
+            configuration.top=0;
+            configuration.bottom=0;
+            configuration.left=0;
+            configuration.right=0;
+        }
+        if(  in-&gt;getInfo()-&gt;width&lt;(configuration.right+configuration.left))
+                {
+                    ADM_warning(&quot;Warning Cropping too much width ! Width reseted !\n&quot;);
+                        configuration.right=configuration.left=0;
+                }
+        if(  in-&gt;getInfo()-&gt;height&lt;(configuration.bottom+configuration.top))
+                {
+                    ADM_warning(&quot;Warning Cropping too much height ! Height reseted !\n&quot;);
+                    configuration.bottom=configuration.top=0;
+                }
+
+        info.width= in-&gt;getInfo()-&gt;width- configuration.right- configuration.left;		
+        info.height=in-&gt;getInfo()-&gt;height-configuration.bottom-configuration.top;	
+}
+/**
+    \fn ~CropFilter
+*/
+CropFilter::~CropFilter()
+{
+    if(original) delete original;
+    original=NULL;
+}
+
+/**
+    \fn getNextFrame
+
+*/
+bool         CropFilter::getNextFrame(ADMImage *image)
+{
+FilterInfo  *prevInfo=previousFilter-&gt;getInfo();
+			// read uncompressed frame
+       		if(!previousFilter-&gt;getNextFrame(original)) return false;
+       		
+       		// Crop Y luma
+       		uint32_t y,x,line;
+       		uint8_t *src,*src2,*dest;
+       		
+       		y=prevInfo-&gt;height;
+       		x=prevInfo-&gt;width;
+       		line=info.width;
+       		src=YPLANE(original)+configuration.top*x+configuration.left;
+       		dest=YPLANE(image);
+       		
+       		for(uint32_t k=info.height;k&gt;0;k--)
+       			{
+       			 	    memcpy(dest,src,line);
+       			 	    src+=x;
+       			 	    dest+=line;
+       			}
+         // Crop U  &amp; V
+            src=UPLANE(original)+(x*configuration.top&gt;&gt;2)+(configuration.left&gt;&gt;1);
+            src2=VPLANE(original)+(x*configuration.top&gt;&gt;2)+(configuration.left&gt;&gt;1);
+            dest=UPLANE(image);
+            line&gt;&gt;=1;
+            x&gt;&gt;=1;       		       		 	
+            uint32_t loop=(info.height)&gt;&gt;1;
+            for(uint32_t k=loop;k&gt;0;k--)
+                {
+                        memcpy(dest,src,line);
+                        src+=x;
+                        dest+=line;
+                }
+                dest=VPLANE(image);	
+                for(uint32_t k=((info.height)&gt;&gt;1);k&gt;0;k--)
+                {
+                        memcpy(dest,src2,line);
+                        src2+=x;
+                        dest+=line;
+                }	
+            return 1;
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         CropFilter::getCoupledConf(CONFcouple **couples)
+{
+    return ADM_paramSave(couples, crop_param,&amp;configuration);
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *CropFilter::getConfiguration(void)
+{
+    static char conf[80];
+    conf[0]=0;
+    snprintf(conf,80,&quot;Crop : %&quot;LU&quot;x%&quot;LU&quot; =&gt; %&quot;LU&quot;x%&quot;LU,
+                previousFilter-&gt;getInfo()-&gt;width,
+                previousFilter-&gt;getInfo()-&gt;height,
+                info.width,info.height
+                );
+    return conf;
+}
+/**
+    \fn Configure
+*/
+//extern int DIA_getCropParams(const char *name, CROP_PARAMS *param, AVDMGenericVideoStream *in);
+bool CropFilter::configure(void)
+
+{
+#if 0
+		uint8_t r;
+		uint32_t w,h;
+    	if(r = (DIA_getCropParams(&quot;Crop Settings&quot;,_param,instream )))
+    	{
+			w=_param-&gt;left+_param-&gt;right;
+			h=_param-&gt;top+_param-&gt;bottom;
+			ADM_assert(w&lt;instream-&gt;getInfo()-&gt;width);
+			ADM_assert(h&lt;instream-&gt;getInfo()-&gt;height);
+			_info.width=instream-&gt;getInfo()-&gt;width-w;
+			_info.height=instream-&gt;getInfo()-&gt;height-h;
+		}
+		return r;
+#endif
+    return false;
+}
+// EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/CMakeLists.txt	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/CMakeLists.txt	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,25 @@
+# Crop filter
+INCLUDE(vf_plugin)
+
+SET(CropCommon_SRCS ADM_vidCrop.cpp  DIA_flyCrop.cpp)
+
+# ---------- QT4 Version ----------------
+INCLUDE(vf_plugin_qt4)
+SET(ADM_vf_cropQT4_SRCS    qt4/Q_crop.cpp)
+SET(ADM_vf_cropQT4_Headers qt4/Q_crop.h)
+SET(ADM_vf_cropQT4_UI      qt4/crop)
+INIT_VIDEO_FILTER_QT4(ADM_vf_cropQt4 ${ADM_vf_cropQT4_SRCS} ${ADM_vf_cropQT4_Headers} ${ADM_vf_cropQT4_UI} ${CropCommon_SRCS})
+# /QT4
+
+
+#------------- Gtk Version ---------------
+INCLUDE(vf_plugin_gtk)
+SET(CropGtk_SRCS gtk/DIA_crop.cpp)
+INIT_VIDEO_FILTER_GTK(ADM_vf_cropGtk ${CropGtk_SRCS} ${CropCommon_SRC})
+
+#------------ Cli Version ----------------
+INCLUDE(vf_plugin_cli)
+SET(CropCli_SRCS cli/DIA_crop.cpp)
+INIT_VIDEO_FILTER_CLI(  ADM_vf_CropCli ${CropCli_SRCS} ${CropCommon_SRCS})
+#
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.cpp	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.cpp	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,230 @@
+/***************************************************************************
+                          DIA_flyCrop.cpp  -  description
+                             -------------------
+
+        Common part of the crop dialog
+    
+    copyright            : (C) 2002/2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_image.h&quot;
+#include &quot;DIA_flyCrop.h&quot;
+
+
+static uint8_t 		Metrics( uint8_t *in, uint32_t width,uint32_t *avg, uint32_t *eqt);
+static uint8_t 		MetricsV( uint8_t *in, uint32_t width,uint32_t height,uint32_t *avg, uint32_t *eqt);
+
+uint8_t    flyCrop::process(void)
+{
+        uint32_t x,y;
+        uint8_t  *in;
+        uint32_t w=_w,h=_h;
+  
+        
+        memcpy(_rgbBufferOut,_rgbBuffer,_w*_h*4);
+        in=_rgbBufferOut;
+        for(y=0;y&lt;top;y++)
+        {
+                for(x=0;x&lt;w;x++)
+                {
+                        *in++=0;
+                        
+                        
+                        *in++=0xff;
+                        
+                        *in++=0;
+                        *in++=0;
+                }
+        }
+        // bottom
+        in=_rgbBufferOut+(w*4)*(h-bottom);
+        for(y=0;y&lt;bottom;y++)
+        {
+                for(x=0;x&lt;w;x++)
+                {
+                        *in++=0;
+                        
+                        
+                        *in++=0xff;
+                        *in++=0;
+                        *in++=0;
+                }
+        }
+        // left
+        in=_rgbBufferOut;
+        uint32_t stride=4*w-4;
+        for(y=0;y&lt;h;y++)
+        {
+                for(x=0;x&lt;left;x++)
+                {
+                        *(in+4*x)=0;
+                        
+                        
+                        *(in+4*x+1)=0xff;
+                        *(in+4*x+2)=0;
+                        *(in+4*x+3)=0;
+                }
+                for(x=0;x&lt;right;x++)
+                {
+                        *(in-4*x+stride-4)=0;
+                        
+                        
+                        *(in-4*x+stride-3)=0xff;
+                        *(in-4*x+stride-2)=0;
+                        *(in-4*x+stride-1)=0;
+                        
+                }
+                in+=4*w;
+  
+        }
+
+		copyRgbFinalToDisplay();
+}
+
+/*----------------------------------
+  autocrop
+-----------------------------------*/
+
+uint8_t  flyCrop::autocrop(void)
+{
+uint8_t *in;
+uint32_t y,avg,eqt;
+	// Top
+
+#define THRESH_AVG   30
+#define THRESH_EQT   50
+        
+        in=_yuvBuffer-&gt;data;
+        for(y=0;y&lt;((_h&gt;&gt;1)-2);y++)	
+        {
+                Metrics(in,_w,&amp;avg,&amp;eqt);
+                in+=_w;
+                //printf(&quot;LineT :%d avg: %d eqt: %d\n&quot;,y,avg,eqt);
+                if(avg&gt; THRESH_AVG || eqt &gt; THRESH_EQT)
+                        break;
+        }
+//gotcha_:	
+        if(y)
+                top=y-1;
+        else 
+                top=0;
+                
+        in=_yuvBuffer-&gt;data+_w*(_h-1);
+        for(y=0;y&lt;((_h&gt;&gt;1)-2);y++)	
+        {
+                Metrics(in,_w,&amp;avg,&amp;eqt);
+                in-=_w;
+                //printf(&quot;Line B :%d avg: %d eqt: %d\n&quot;,y,avg,eqt);
+                if(avg&gt; THRESH_AVG || eqt &gt; THRESH_EQT)
+                                break;
+        }
+//gotcha_:	
+        if(y)
+                bottom=y-1;
+        else
+                bottom=0;
+
+                
+// Left
+        in=_yuvBuffer-&gt;data;
+        for(y=0;y&lt;((_w&gt;&gt;1)-2);y++)	
+        {
+                MetricsV(in,_w,_h,&amp;avg,&amp;eqt);
+                in++;
+                //printf(&quot;Line L :%d avg: %d eqt: %d\n&quot;,y,avg,eqt);
+                if(avg&gt; THRESH_AVG || eqt &gt; THRESH_EQT)
+                                break;
+        }
+//gotcha_:	
+        if(y)
+                left=y-1;
+        else
+                left=0;		
+// Right
+        in=_yuvBuffer-&gt;data+_w-1;
+        for(y=0;y&lt;((_w&gt;&gt;1)-2);y++)	
+        {
+                MetricsV(in,_w,_h,&amp;avg,&amp;eqt);
+                in--;
+                //printf(&quot;Line R :%d avg: %d eqt: %d\n&quot;,y,avg,eqt);
+                if(avg&gt; THRESH_AVG || eqt &gt; THRESH_EQT)
+                                break;
+        }
+//gotcha_:	
+        if(y)
+                right=y-1;
+        else
+                right=0;
+  
+              
+        // Update display
+        top=top &amp; 0xfffe;
+        bottom=bottom &amp; 0xfffe;
+        upload();
+        process();
+        display();
+        return 1;
+}
+/*---------------------------------------------
+	Compute the average value of pixels
+	and eqt is the &quot;ecart type&quot;
+*/
+uint8_t Metrics( uint8_t *in, uint32_t width,uint32_t *avg, uint32_t *eqt)
+{
+
+uint32_t x;
+uint32_t sum=0,eq=0;
+uint8_t v;
+              for(x=0;x&lt;width;x++)
+              {
+                      sum+=*(in+x);
+              }
+              sum=sum/width;
+              *avg=sum;
+              for(x=0;x&lt;width;x++)
+              {
+                      v=*(in+x)-sum;
+                      eq+=v*v;
+              }
+              eq=eq/(width*width);
+              *eqt=eq;
+              return 1;
+}
+/*---------------------------------------------
+	Compute the average value of pixels
+	and eqt is the &quot;ecart type&quot;
+*/
+uint8_t MetricsV( uint8_t *in,uint32_t width, uint32_t height,uint32_t *avg, uint32_t *eqt)
+{
+
+uint32_t x;
+uint32_t sum=0,eq=0;
+uint8_t v;
+              for(x=0;x&lt;height;x++)
+              {
+                      sum+=*(in+x*width);
+              }
+              sum=sum/height;
+              *avg=sum;
+              for(x=0;x&lt;height;x++)
+              {
+                      v=*(in+x*width)-sum;
+                      eq+=v*v;
+              }
+              eq=eq/(height*height);
+              *eqt=eq;
+              return 1;
+}
+//EOF
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.h	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/DIA_flyCrop.h	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,16 @@
+#ifndef FLY_CROP_H
+#define FLY_CROP_H
+class flyCrop : public FLY_DIALOG_TYPE
+{
+  
+  public:
+   uint32_t left,right,top,bottom;
+  public:
+   uint8_t    process(void);
+   uint8_t    download(void);
+   uint8_t    upload(void);
+   uint8_t    autocrop(void);
+   flyCrop (uint32_t width,uint32_t height,ADM_coreVideoFilter *in,
+                                    void *canvas, void *slider) : FLY_DIALOG_TYPE(width, height,in,canvas, slider,0,RESIZE_LAST) {};
+};
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/cli/DIA_crop.cpp
===================================================================

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.conf	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.conf	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,4 @@
+uint32_t:top
+uint32_t:bottom
+uint32_t:left
+uint32_t:right

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.h	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop.h	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,11 @@
+// Automatically generated, do not edit!
+#ifndef ADM_crop_CONF_H
+#define ADM_crop_CONF_H
+typedef struct {
+   uint32_t top;
+   uint32_t bottom;
+   uint32_t left;
+   uint32_t right;
+}crop;
+#endif //crop
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop_desc.cpp	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/crop_desc.cpp	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,8 @@
+// Automatically generated, do not edit!
+const ADM_paramList crop_param[]={
+ {&quot;top&quot;,offsetof( crop,top),&quot;uint32_t&quot;,ADM_param_uint32_t},
+ {&quot;bottom&quot;,offsetof( crop,bottom),&quot;uint32_t&quot;,ADM_param_uint32_t},
+ {&quot;left&quot;,offsetof( crop,left),&quot;uint32_t&quot;,ADM_param_uint32_t},
+ {&quot;right&quot;,offsetof( crop,right),&quot;uint32_t&quot;,ADM_param_uint32_t},
+{NULL,0,NULL}
+};

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/gtk/DIA_crop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/gtk/DIA_crop.cpp	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/gtk/DIA_crop.cpp	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,386 @@
+/***************************************************************************
+                          DIA_crop.cpp  -  description
+                             -------------------
+
+			    GUI for cropping including autocrop
+			    +Revisted the Gtk2 way
+			     +Autocrop now in RGB space (more accurate)
+
+    begin                : Fri May 3 2002
+    copyright            : (C) 2002/2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_toolkitGtk.h&quot;
+#include &quot;ADM_image.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;DIA_flyCrop.h&quot;
+#include &quot;../crop.h&quot;
+
+#if 1
+static GtkWidget	*create_dialog1 (void);
+
+/* Link between UI and core */
+static gboolean 	ui_draw( void );
+static void 		ui_autocrop (void );
+static void 		ui_reset( void );
+static void 		ui_upload(void);
+static void  		ui_read ( void);
+static void  		ui_update ( void);
+static void 		ui_frame_changed( void );
+
+static GtkWidget *dialog=NULL;
+
+/* Prevent loop when updating value */
+
+static int lock=0;
+static flyCrop *myCrop=NULL;
+/**
+    \fn DIA_getCropParams
+
+*/
+int DIA_getCropParams(const char *name, crop *param, ADM_coreVideoFilter *in)
+{
+	uint32_t width, height;
+
+	// Allocate space for green-ised video
+	width = in-&gt;getInfo()-&gt;width;
+	height = in-&gt;getInfo()-&gt;height;
+
+	uint8_t ret=0;
+
+	dialog=create_dialog1();
+	gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
+										GTK_RESPONSE_OK,
+										GTK_RESPONSE_CANCEL,
+										GTK_RESPONSE_APPLY,
+										-1);
+	gtk_register_dialog(dialog);
+	gtk_window_set_title(GTK_WINDOW(dialog), name);
+	gtk_widget_show(dialog);
+	
+#define CONNECT(x,y,z) 	gtk_signal_connect(GTK_OBJECT(WID(x)), #y, GTK_SIGNAL_FUNC(z), NULL);
+
+	CONNECT(drawingarea1,expose_event,ui_draw);
+	CONNECT(buttonAutocrop,clicked,ui_autocrop);
+	CONNECT(buttonReset,clicked,ui_reset);
+	CONNECT(scale,value_changed,ui_frame_changed);
+
+#define CONNECT_SPIN(x) CONNECT(spinbutton##x, value_changed,ui_update)
+          
+	CONNECT_SPIN(Top);
+	CONNECT_SPIN(Left);
+	CONNECT_SPIN(Right);
+	CONNECT_SPIN(Bottom);
+
+	myCrop=new flyCrop(width, height,in,WID(drawingarea1),WID(scale));
+	myCrop-&gt;left=param-&gt;left;
+	myCrop-&gt;right=param-&gt;right;
+	myCrop-&gt;top=param-&gt;top;
+	myCrop-&gt;bottom=param-&gt;bottom;
+	myCrop-&gt;upload();	
+	myCrop-&gt;sliderChanged();	
+
+	int response;
+
+	while((response = gtk_dialog_run(GTK_DIALOG(dialog))) == GTK_RESPONSE_APPLY)
+	{
+	  ui_update();
+	}
+
+	if(response==GTK_RESPONSE_OK)
+	{
+		ui_read( );
+		param-&gt;left=myCrop-&gt;left;
+		param-&gt;right=myCrop-&gt;right;
+		param-&gt;top=myCrop-&gt;top;
+		param-&gt;bottom=myCrop-&gt;bottom;
+		ret=1;
+	}
+
+	gtk_unregister_dialog(dialog);
+	gtk_widget_destroy(dialog);
+	delete myCrop;
+	return ret;
+}
+
+/*
+      Link GTK dialog and core
+*/
+void ui_frame_changed( void )
+{
+  myCrop-&gt;sliderChanged();
+}
+void ui_update(void)
+{
+  if(lock) return;
+  myCrop-&gt;download();
+  myCrop-&gt;process();
+  myCrop-&gt;display();
+}
+/*---------------------------------------------------------------------------
+	Actually draw the working frame on screen
+*/
+gboolean ui_draw( void )
+{
+        myCrop-&gt;display();
+}
+void ui_read (void )
+{
+        myCrop-&gt;download();
+}
+void ui_upload(void)
+{
+    myCrop-&gt;upload();
+}
+void ui_autocrop( void )
+{
+  myCrop-&gt;autocrop();
+ 
+}
+void ui_reset( void )
+{
+        myCrop-&gt;left=0;
+        myCrop-&gt;right=0;
+        myCrop-&gt;bottom=0;
+        myCrop-&gt;top=0;
+        
+	myCrop-&gt;upload();
+        myCrop-&gt;process();
+        myCrop-&gt;display();
+}
+
+/*---------------------------------------------------------------------------
+	Read entried from dialog box
+*/
+
+#define SPIN_GET(x,y) {x= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(spinbutton##y))) ;}
+#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(spinbutton##y)),(gfloat)x) ;}
+
+
+//____________________________________
+uint8_t flyCrop::upload(void)
+{
+        lock++;
+        SPIN_SET(left,Left);
+        SPIN_SET(right,Right);
+        SPIN_SET(top,Top);
+        SPIN_SET(bottom,Bottom);
+        lock--;
+        return 1;
+}
+uint8_t flyCrop::download(void)
+{
+        int reject=0;
+        
+                        SPIN_GET(left,Left);
+                        SPIN_GET(right,Right);
+                        SPIN_GET(top,Top);
+                        SPIN_GET(bottom,Bottom);
+                        
+                        printf(&quot;%d %d %d %d\n&quot;,left,right,top,bottom);
+                        
+                        left&amp;=0xffffe;
+                        right&amp;=0xffffe;
+                        top&amp;=0xffffe;
+                        bottom&amp;=0xffffe;
+                        
+                        if((top+bottom)&gt;_h)
+                                {
+                                        top=bottom=0;
+                                        reject=1;
+                                }
+                        if((left+right)&gt;_w)
+                                {
+                                        left=right=0;
+                                        reject=1;
+                                }
+                        if(reject)
+                                upload();
+}
+// End common part
+//--------------------------------------------
+GtkWidget*
+create_dialog1 (void)
+{
+  GtkWidget *dialog1;
+  GtkWidget *dialog_vbox1;
+  GtkWidget *vbox1;
+  GtkWidget *drawingarea1;
+  GtkWidget *scale;
+  GtkWidget *table1;
+  GtkWidget *label1;
+  GtkWidget *label2;
+  GtkWidget *label3;
+  GtkWidget *label4;
+  GtkObject *spinbuttonRight_adj;
+  GtkWidget *spinbuttonRight;
+  GtkObject *spinbuttonLeft_adj;
+  GtkWidget *spinbuttonLeft;
+  GtkObject *spinbuttonBottom_adj;
+  GtkWidget *spinbuttonBottom;
+  GtkObject *spinbuttonTop_adj;
+  GtkWidget *spinbuttonTop;
+  GtkWidget *hbox1;
+  GtkWidget *hbox2;
+  GtkWidget *buttonAutocrop;
+  GtkWidget *buttonReset;
+  GtkWidget *dialog_action_area1;
+  GtkWidget *applybutton1;
+  GtkWidget *cancelbutton1;
+  GtkWidget *okbutton1;
+
+  dialog1 = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP(&quot;Crop Settings&quot;));
+  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
+
+  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
+  gtk_widget_show (dialog_vbox1);
+
+  vbox1 = gtk_vbox_new (FALSE, 6);
+  gtk_widget_show (vbox1);
+  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
+  gtk_container_set_border_width (GTK_CONTAINER (vbox1), 6);
+
+  drawingarea1 = gtk_drawing_area_new ();
+  gtk_widget_show (drawingarea1);
+  gtk_box_pack_start (GTK_BOX (vbox1), drawingarea1, TRUE, TRUE, 0);
+
+  scale = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 0, 0, 0, 0)));
+  gtk_widget_show (scale);
+  gtk_box_pack_start (GTK_BOX (vbox1), scale, FALSE, TRUE, 0);
+
+  table1 = gtk_table_new (2, 4, FALSE);
+  gtk_widget_show (table1);
+  gtk_box_pack_start (GTK_BOX (vbox1), table1, FALSE, FALSE, 10);
+  gtk_table_set_row_spacings (GTK_TABLE (table1), 4);
+  gtk_table_set_col_spacings (GTK_TABLE (table1), 15);
+
+  label1 = gtk_label_new (QT_TR_NOOP(&quot;Crop Left:&quot;));
+  gtk_widget_show (label1);
+  gtk_table_attach (GTK_TABLE (table1), label1, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label1), 0, 0.5);
+
+  label2 = gtk_label_new (QT_TR_NOOP(&quot;Crop Right:&quot;));
+  gtk_widget_show (label2);
+  gtk_table_attach (GTK_TABLE (table1), label2, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
+
+  label3 = gtk_label_new (QT_TR_NOOP(&quot;Crop Top:&quot;));
+  gtk_widget_show (label3);
+  gtk_table_attach (GTK_TABLE (table1), label3, 2, 3, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
+
+  label4 = gtk_label_new (QT_TR_NOOP(&quot;Crop Bottom:&quot;));
+  gtk_widget_show (label4);
+  gtk_table_attach (GTK_TABLE (table1), label4, 2, 3, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
+
+  spinbuttonRight_adj = gtk_adjustment_new (1, 0, 1000, 1, 10, 10);
+  spinbuttonRight = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonRight_adj), 1, 0);
+  gtk_widget_show (spinbuttonRight);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonRight, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  spinbuttonLeft_adj = gtk_adjustment_new (1, 0, 1000, 1, 10, 10);
+  spinbuttonLeft = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonLeft_adj), 1, 0);
+  gtk_widget_show (spinbuttonLeft);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonLeft, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  spinbuttonBottom_adj = gtk_adjustment_new (1, 0, 1000, 1, 10, 10);
+  spinbuttonBottom = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonBottom_adj), 1, 0);
+  gtk_widget_show (spinbuttonBottom);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonBottom, 3, 4, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  spinbuttonTop_adj = gtk_adjustment_new (1, 0, 1000, 1, 10, 10);
+  spinbuttonTop = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTop_adj), 1, 0);
+  gtk_widget_show (spinbuttonTop);
+  gtk_table_attach (GTK_TABLE (table1), spinbuttonTop, 3, 4, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  hbox1 = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (hbox1);
+  gtk_box_pack_start (GTK_BOX (vbox1), hbox1, FALSE, TRUE, 0);
+
+  hbox2 = gtk_hbox_new (TRUE, 6);
+  gtk_widget_show (hbox2);
+  gtk_box_pack_start (GTK_BOX (hbox1), hbox2, FALSE, TRUE, 0);
+
+  buttonAutocrop = gtk_button_new_with_mnemonic (QT_TR_NOOP(&quot;Auto Crop&quot;));
+  gtk_widget_show (buttonAutocrop);
+  gtk_box_pack_start (GTK_BOX (hbox2), buttonAutocrop, FALSE, TRUE, 0);
+
+  buttonReset = gtk_button_new_from_stock (&quot;gtk-clear&quot;);
+  gtk_widget_show (buttonReset);
+  gtk_box_pack_start (GTK_BOX (hbox2), buttonReset, FALSE, TRUE, 0);
+
+  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
+  gtk_widget_show (dialog_action_area1);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
+
+  applybutton1 = gtk_button_new_from_stock (&quot;gtk-apply&quot;);
+  gtk_widget_show (applybutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), applybutton1, GTK_RESPONSE_APPLY);
+  GTK_WIDGET_SET_FLAGS (applybutton1, GTK_CAN_DEFAULT);
+
+  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
+  gtk_widget_show (cancelbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
+
+  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
+  gtk_widget_show (okbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, vbox1, &quot;vbox1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, drawingarea1, &quot;drawingarea1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, scale, &quot;scale&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonRight, &quot;spinbuttonRight&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonLeft, &quot;spinbuttonLeft&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonBottom, &quot;spinbuttonBottom&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTop, &quot;spinbuttonTop&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, hbox1, &quot;hbox1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, hbox2, &quot;hbox2&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, buttonAutocrop, &quot;buttonAutocrop&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, buttonReset, &quot;buttonReset&quot;);
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, applybutton1, &quot;applybutton1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
+  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
+
+  return dialog1;
+}
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,171 @@
+/***************************************************************************
+                          DIA_crop.cpp  -  description
+                             -------------------
+
+			    GUI for cropping including autocrop
+			    +Revisted the Gtk2 way
+			     +Autocrop now in RGB space (more accurate)
+
+    begin                : Fri May 3 2002
+    copyright            : (C) 2002/2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#if 1
+#include &quot;Q_crop.h&quot;
+
+//
+//	Video is in YV12 Colorspace
+//
+//
+  Ui_cropWindow::Ui_cropWindow(crop *param,ADM_coreVideoFilter *in)
+  {
+    uint32_t width,height;
+        ui.setupUi(this);
+        lock=0;
+        // Allocate space for green-ised video
+        width=in-&gt;getInfo()-&gt;width;
+        height=in-&gt;getInfo()-&gt;height;
+
+        canvas=new ADM_QCanvas(ui.graphicsView,width,height);
+        
+        myCrop=new flyCrop( width, height,in,canvas,ui.horizontalSlider);
+        myCrop-&gt;left=param-&gt;left;
+        myCrop-&gt;right=param-&gt;right;
+        myCrop-&gt;top=param-&gt;top;
+        myCrop-&gt;bottom=param-&gt;bottom;
+        myCrop-&gt;_cookie=&ui;
+        myCrop-&gt;upload();
+        myCrop-&gt;sliderChanged();
+
+
+        connect( ui.horizontalSlider,SIGNAL(valueChanged(int)),this,SLOT(sliderUpdate(int)));
+        connect( ui.pushButtonAutoCrop,SIGNAL(clicked(bool)),this,SLOT(autoCrop(bool)));
+        connect( ui.pushButtonReset,SIGNAL(clicked(bool)),this,SLOT(reset(bool)));
+#define SPINNER(x) connect( ui.spinBox##x,SIGNAL(valueChanged(int)),this,SLOT(valueChanged(int))); 
+          SPINNER(Left);
+          SPINNER(Right);
+          SPINNER(Top);
+          SPINNER(Bottom);
+
+  }
+  void Ui_cropWindow::sliderUpdate(int foo)
+  {
+    myCrop-&gt;sliderChanged();
+  }
+  void Ui_cropWindow::gather(crop *param)
+  {
+    
+        myCrop-&gt;download();
+        param-&gt;left=myCrop-&gt;left;
+        param-&gt;right=myCrop-&gt;right;
+        param-&gt;top=myCrop-&gt;top;
+        param-&gt;bottom=myCrop-&gt;bottom;
+  }
+Ui_cropWindow::~Ui_cropWindow()
+{
+  if(myCrop) delete myCrop;
+  myCrop=NULL; 
+  if(canvas) delete canvas;
+  canvas=NULL;
+}
+void Ui_cropWindow::valueChanged( int f )
+{
+  if(lock) return;
+  lock++;
+  myCrop-&gt;download();
+  myCrop-&gt;process();
+  myCrop-&gt;display();
+  lock--;
+}
+
+void Ui_cropWindow::autoCrop( bool f )
+{
+  lock++;
+  myCrop-&gt;autocrop();
+  lock--;
+}
+void Ui_cropWindow::reset( bool f )
+{
+         myCrop-&gt;left=0;
+         myCrop-&gt;right=0;
+         myCrop-&gt;bottom=0;
+         myCrop-&gt;top=0;
+         lock++;
+         myCrop-&gt;upload();
+         myCrop-&gt;process();
+         myCrop-&gt;display();
+         lock--;
+}
+
+//************************
+uint8_t flyCrop::upload(void)
+{
+      Ui_cropDialog *w=(Ui_cropDialog *)_cookie;
+        
+        w-&gt;spinBoxLeft-&gt;setValue(left);
+        w-&gt;spinBoxRight-&gt;setValue(right);
+        w-&gt;spinBoxTop-&gt;setValue(top);
+        w-&gt;spinBoxBottom-&gt;setValue(bottom);
+        
+        return 1;
+}
+uint8_t flyCrop::download(void)
+{
+        int reject=0;
+Ui_cropDialog *w=(Ui_cropDialog *)_cookie;
+#define SPIN_GET(x,y) x=w-&gt;spinBox##y-&gt;value();
+                        SPIN_GET(left,Left);
+                        SPIN_GET(right,Right);
+                        SPIN_GET(top,Top);
+                        SPIN_GET(bottom,Bottom);
+                        
+                        printf(&quot;%d %d %d %d\n&quot;,left,right,top,bottom);
+                        
+                        left&amp;=0xffffe;
+                        right&amp;=0xffffe;
+                        top&amp;=0xffffe;
+                        bottom&amp;=0xffffe;
+                        
+                        if((top+bottom)&gt;_h)
+                                {
+                                        top=bottom=0;
+                                        reject=1;
+                                }
+                        if((left+right)&gt;_w)
+                                {
+                                        left=right=0;
+                                        reject=1;
+                                }
+                        if(reject)
+                                upload();
+}
+
+/**
+      \fn     DIA_getCropParams
+      \brief  Handle crop dialog
+*/
+int DIA_getCropParams(	const char *name,crop *param,ADM_coreVideoFilter *in)
+{
+        uint8_t ret=0;
+        
+        Ui_cropWindow dialog(param,in);        
+        if(dialog.exec()==QDialog::Accepted)
+        {
+            dialog.gather(param); 
+            ret=1;
+        }
+        return ret;
+}
+//____________________________________
+// EOF
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,36 @@
+#ifndef Q_crop_h
+#define Q_crop_h
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;ui_crop.h&quot;
+#include &quot;ADM_image.h&quot;
+#include &quot;DIA_flyDialogQt4.h&quot;
+#include &quot;DIA_flyCrop.h&quot;
+#include &quot;crop.h&quot;
+#if 1
+class Ui_cropWindow : public QDialog
+{
+	Q_OBJECT
+
+protected: 
+	int lock;
+
+public:
+	flyCrop *myCrop;
+	ADM_QCanvas *canvas;
+	Ui_cropWindow(crop *param,ADM_coreVideoFilter *in);
+	~Ui_cropWindow();
+	Ui_cropDialog ui;
+
+public slots:
+	void gather(crop *param);
+
+private slots:
+	void sliderUpdate(int foo);
+	void valueChanged(int foo);
+	void autoCrop(bool f);
+	void reset(bool f);
+};
+
+#endif	// Q_crop_h
+#endif
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/crop.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/crop.ui	2009-12-21 13:31:48 UTC (rev 5691)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/crop.ui	2009-12-21 13:31:51 UTC (rev 5692)
@@ -0,0 +1,231 @@
+&lt;ui version=&quot;4.0&quot; &gt;
+ &lt;class&gt;cropDialog&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;cropDialog&quot; &gt;
+  &lt;property name=&quot;geometry&quot; &gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;348&lt;/width&gt;
+    &lt;height&gt;300&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot; &gt;
+   &lt;string&gt;Crop&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QVBoxLayout&quot; &gt;
+   &lt;property name=&quot;margin&quot; &gt;
+    &lt;number&gt;9&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;spacing&quot; &gt;
+    &lt;number&gt;6&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;item&gt;
+    &lt;layout class=&quot;QGridLayout&quot; &gt;
+     &lt;property name=&quot;margin&quot; &gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;spacing&quot; &gt;
+      &lt;number&gt;6&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item row=&quot;0&quot; column=&quot;3&quot; &gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Right:&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;0&quot; &gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_4&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Top:&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;4&quot; &gt;
+      &lt;widget class=&quot;QSpinBox&quot; name=&quot;spinBoxRight&quot; &gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;2147483647&lt;/number&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;2&quot; &gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeType&quot; &gt;
+        &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;26&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;5&quot; &gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;40&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;6&quot; &gt;
+      &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButtonReset&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Reset&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;1&quot; &gt;
+      &lt;widget class=&quot;QSpinBox&quot; name=&quot;spinBoxTop&quot; &gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;2147483647&lt;/number&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;4&quot; &gt;
+      &lt;widget class=&quot;QSpinBox&quot; name=&quot;spinBoxBottom&quot; &gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;2147483647&lt;/number&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;3&quot; &gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Bottom:&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;0&quot; &gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Left:&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;5&quot; &gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeType&quot; &gt;
+        &lt;enum&gt;QSizePolicy::MinimumExpanding&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;40&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;1&quot; &gt;
+      &lt;widget class=&quot;QSpinBox&quot; name=&quot;spinBoxLeft&quot; &gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;2147483647&lt;/number&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;0&quot; column=&quot;6&quot; &gt;
+      &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButtonAutoCrop&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Auto Crop&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item row=&quot;1&quot; column=&quot;2&quot; &gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeType&quot; &gt;
+        &lt;enum&gt;QSizePolicy::Fixed&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;26&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;QSlider&quot; name=&quot;horizontalSlider&quot; &gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;QGraphicsView&quot; name=&quot;graphicsView&quot; /&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;QDialogButtonBox&quot; name=&quot;buttonBox&quot; &gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;standardButtons&quot; &gt;
+      &lt;set&gt;QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok&lt;/set&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;tabstops&gt;
+  &lt;tabstop&gt;spinBoxLeft&lt;/tabstop&gt;
+  &lt;tabstop&gt;spinBoxRight&lt;/tabstop&gt;
+  &lt;tabstop&gt;spinBoxTop&lt;/tabstop&gt;
+  &lt;tabstop&gt;spinBoxBottom&lt;/tabstop&gt;
+  &lt;tabstop&gt;pushButtonAutoCrop&lt;/tabstop&gt;
+  &lt;tabstop&gt;pushButtonReset&lt;/tabstop&gt;
+  &lt;tabstop&gt;horizontalSlider&lt;/tabstop&gt;
+  &lt;tabstop&gt;graphicsView&lt;/tabstop&gt;
+  &lt;tabstop&gt;buttonBox&lt;/tabstop&gt;
+ &lt;/tabstops&gt;
+ &lt;resources/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;accepted()&lt;/signal&gt;
+   &lt;receiver&gt;cropDialog&lt;/receiver&gt;
+   &lt;slot&gt;accept()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;248&lt;/x&gt;
+     &lt;y&gt;254&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;157&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;rejected()&lt;/signal&gt;
+   &lt;receiver&gt;cropDialog&lt;/receiver&gt;
+   &lt;slot&gt;reject()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;316&lt;/x&gt;
+     &lt;y&gt;260&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;286&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+&lt;/ui&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002898.html">[Avidemux-svn-commit] r5691 -	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
</A></li>
	<LI>Next message: <A HREF="002900.html">[Avidemux-svn-commit] r5693 - in branches/avidemux_2.6_branch_mean:	avidemux/gtk/ADM_UIs/include avidemux/qt4/ADM_UIs/include	avidemux/qt4/ADM_UIs/src avidemux_core/ADM_core/src	avidemux_core/ADM_coreVideoFilter/include	avidemux_core/ADM_coreVideoFilter/src	avidemux_plugins/ADM_videoFilters6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2899">[ date ]</a>
              <a href="thread.html#2899">[ thread ]</a>
              <a href="subject.html#2899">[ subject ]</a>
              <a href="author.html#2899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
