<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5714 - in branches/avidemux_2.6_branch_mean:	avidemux_core/ADM_coreAudioDevice/include	avidemux_plugins/ADM_audioDevices/Alsa	avidemux_plugins/ADM_audioDevices/Esd	avidemux_plugins/ADM_audioDevices/Jack	avidemux_plugins/ADM_audioDevices/Oss	avidemux_plugins/ADM_audioDevices/PulseAudioSimple	avidemux_plugins/ADM_audioDevices/Sdl	avidemux_plugins/ADM_audioDevices/Win32
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5714%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux_core/ADM_coreAudioDevice/include%0A%09avidemux_plugins/ADM_audioDevices/Alsa%0A%09avidemux_plugins/ADM_audioDevices/Esd%0A%09avidemux_plugins/ADM_audioDevices/Jack%0A%09avidemux_plugins/ADM_audioDevices/Oss%0A%09avidemux_plugins/ADM_audioDevices/PulseAudioSimple%0A%09avidemux_plugins/ADM_audioDevices/Sdl%0A%09avidemux_plugins/ADM_audioDevices/Win32&In-Reply-To=%3C200912221530.nBMFU7d2024235%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002920.html">
   <LINK REL="Next"  HREF="002922.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5714 - in branches/avidemux_2.6_branch_mean:	avidemux_core/ADM_coreAudioDevice/include	avidemux_plugins/ADM_audioDevices/Alsa	avidemux_plugins/ADM_audioDevices/Esd	avidemux_plugins/ADM_audioDevices/Jack	avidemux_plugins/ADM_audioDevices/Oss	avidemux_plugins/ADM_audioDevices/PulseAudioSimple	avidemux_plugins/ADM_audioDevices/Sdl	avidemux_plugins/ADM_audioDevices/Win32</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5714%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux_core/ADM_coreAudioDevice/include%0A%09avidemux_plugins/ADM_audioDevices/Alsa%0A%09avidemux_plugins/ADM_audioDevices/Esd%0A%09avidemux_plugins/ADM_audioDevices/Jack%0A%09avidemux_plugins/ADM_audioDevices/Oss%0A%09avidemux_plugins/ADM_audioDevices/PulseAudioSimple%0A%09avidemux_plugins/ADM_audioDevices/Sdl%0A%09avidemux_plugins/ADM_audioDevices/Win32&In-Reply-To=%3C200912221530.nBMFU7d2024235%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5714 - in branches/avidemux_2.6_branch_mean:	avidemux_core/ADM_coreAudioDevice/include	avidemux_plugins/ADM_audioDevices/Alsa	avidemux_plugins/ADM_audioDevices/Esd	avidemux_plugins/ADM_audioDevices/Jack	avidemux_plugins/ADM_audioDevices/Oss	avidemux_plugins/ADM_audioDevices/PulseAudioSimple	avidemux_plugins/ADM_audioDevices/Sdl	avidemux_plugins/ADM_audioDevices/Win32">mean at mail.berlios.de
       </A><BR>
    <I>Tue Dec 22 16:30:07 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002920.html">[Avidemux-svn-commit] r5713 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid
</A></li>
        <LI>Next message: <A HREF="002922.html">[Avidemux-svn-commit] r5715 - in	branches/avidemux_2.6_branch_mean/avidemux:	cli/ADM_userInterfaces/ADM_gui2 gtk/ADM_userInterfaces/ADM_gui2	qt4/ADM_userInterfaces/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2921">[ date ]</a>
              <a href="thread.html#2921">[ thread ]</a>
              <a href="subject.html#2921">[ subject ]</a>
              <a href="author.html#2921">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-12-22 16:30:04 +0100 (Tue, 22 Dec 2009)
New Revision: 5714

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audioDeviceInternal.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audiodevice.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/audio_out.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.h
Log:
[AudioDevice] Add interface to gather stats from next elemts in the queue to feed vumeter + ask each device what is its prefered channel mapping

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audioDeviceInternal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audioDeviceInternal.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audioDeviceInternal.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -8,7 +8,7 @@
 #ifndef ADM_audioDeviceInternal_H
 #define ADM_audioDeviceInternal_H
 
-#define ADM_AUDIO_DEVICE_API_VERSION 1
+#define ADM_AUDIO_DEVICE_API_VERSION 2
 #include &quot;ADM_dynamicLoading.h&quot;
 class ADM_AudioDevices :public ADM_LibWrapper
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audiodevice.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audiodevice.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/ADM_audiodevice.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -20,7 +20,11 @@
 #define AUDIO_DEVICE_STARTED  1
 #define AUDIO_DEVICE_STOP_REQ 2
 #define AUDIO_DEVICE_STOP_GR  3
-
+extern bool   ADM_audioReorderChannels(uint32_t channels,float *data, uint32_t nb,CHANNEL_TYPE *input,CHANNEL_TYPE *output);
+/**
+    \class audioDevice
+    \brief Base class for audioDeviceThreaded, the one actually used.
+*/
  class audioDevice
  {
         protected:
@@ -30,7 +34,7 @@
         public:
                                         audioDevice(void) {};
                         virtual         ~audioDevice() {};
-                        virtual uint8_t  init(uint32_t channel, uint32_t fq ) =0;
+                        virtual uint8_t  init(uint32_t channel, uint32_t fq ,CHANNEL_TYPE *channelMapping) =0;
                         virtual uint8_t  stop(void)=0;
                         virtual uint8_t  play(uint32_t len, float *data) =0;
                         virtual uint8_t  setVolume(int volume) {return 1;}
@@ -47,6 +51,7 @@
 class audioDeviceThreaded: public audioDevice
 {
 protected:
+            CHANNEL_TYPE incomingMapping[MAX_CHANNELS];
             uint32_t    rdIndex;
             uint32_t    wrIndex;
             uint8_t     *audioBuffer;
@@ -65,15 +70,16 @@
     //
     virtual     bool     localInit(void)=0;
     virtual     bool     localStop(void)=0;
-    virtual     void     sendData(void)=0;    
+    virtual     void     sendData(void)=0;   
+    virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels)=0;
 
 public:
     virtual     void        Loop(void);
-    virtual     uint8_t     init(uint32_t channel, uint32_t fq );
+    virtual     uint8_t     init(uint32_t channel, uint32_t fq,CHANNEL_TYPE *channelMapping );
     virtual     uint8_t     stop(void);
 
     virtual     uint8_t     play(uint32_t len, float *data);
-
+    virtual     bool        getVolumeStats(uint32_t *vol); // Vol is 6 channels between 0 and 255
 };
 
 /**
@@ -82,10 +88,12 @@
 */
 class dummyAudioDevice : public audioDeviceThreaded
 {
-		  public:
+ static const   CHANNEL_TYPE myChannelType[MAX_CHANNELS];
+		  protected:
                     virtual     bool     localInit(void);
                     virtual     bool     localStop(void);
                     virtual     void     sendData(void);    
+                    virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels){return myChannelType;}
 }   ;
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/audio_out.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/audio_out.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/include/audio_out.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -17,7 +17,7 @@
 
 #ifndef AUDIOOUPUT_H
 #define AUDIOOUPUT_H
-
+#include &quot;ADM_audiodef.h&quot;
 typedef int AUDIO_DEVICE;
 
 void 		AVDM_audioSave( void ); /// Save in Prefs the current audio Device
@@ -26,7 +26,7 @@
 void 		AVDM_switch( AUDIO_DEVICE action );
 
 uint8_t 	AVDM_AudioPlay(float *ptr, uint32_t nb);
-uint32_t 	AVDM_AudioSetup(uint32_t fq, uint8_t channel);
+uint32_t 	AVDM_AudioSetup(uint32_t fq, uint8_t channel, CHANNEL_TYPE    *channelMapping);
 void 		AVDM_AudioClose(void);
 uint32_t    AVDM_GetLayencyMs(void);
 AUDIO_DEVICE 	AVDM_getCurrentDevice( void);
@@ -35,5 +35,6 @@
 uint32_t    ADM_av_getNbDevices(void);
 bool        ADM_av_getDeviceInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
 uint32_t    AVDM_getMsFullness(void); /// Fullness in ms
+bool        AVDM_getStats(uint32_t *vol); // Retrieve volume info
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -291,6 +291,25 @@
 	return ;
 }
 /**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *alsaAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
+/**
     \fn localStop
 
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Alsa/ADM_deviceALSA.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -20,15 +20,17 @@
  class alsaAudioDevice : public audioDeviceThreaded
  {
      protected :
+            virtual     bool    localInit(void);
+            virtual     bool    localStop(void);
+            virtual     void    sendData(void); 
+            virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
             //	0-&gt; no init done
             //	1-&gt; device opened but init failed
             //	2-&gt;fully initialized
             uint32_t _init;
       public:
                                 alsaAudioDevice(void);
-            virtual     bool    localInit(void);
-            virtual     bool    localStop(void);
-            virtual     void    sendData(void); 
+          
             virtual     uint8_t setVolume(int volume);
      }     ;
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -112,4 +112,23 @@
     mutex.unlock();
 	return ;
 }
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *esdAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Esd/ADM_deviceEsd.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -25,6 +25,7 @@
          virtual     bool     localInit(void);
          virtual     bool     localStop(void);
          virtual     void     sendData(void); 
+         virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
 		  public:
 		  			esdAudioDevice(void) {esdDevice=-1;esdServer=-1;}
 		     		 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -254,4 +254,23 @@
 #endif
 	return 1;
 }
-
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *jackAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Jack/ADM_deviceJack.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -20,11 +20,13 @@
 {
 public:
 	jackAudioDevice();
+protected:
     virtual     bool     localInit(void);
     virtual     bool     localStop(void);
     virtual     void     sendData(void); 
                 uint8_t  setVolume(int volume);
                 int      process(jack_nframes_t nframes);
+    virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
 
 protected:
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -171,4 +171,23 @@
     return;
    
 }
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *ossAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Oss/ADM_deviceoss.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -23,6 +23,7 @@
     virtual     bool     localInit(void);
     virtual     bool     localStop(void);
     virtual     void     sendData(void); 
+    virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
 public:   
 			uint8_t setVolume(int volume);
 }     ;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -153,5 +153,23 @@
 	return ;
 
 }
-
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *pulseSimpleAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -24,6 +24,7 @@
          virtual     bool     localInit(void);
          virtual     bool     localStop(void);
          virtual     void     sendData(void); 
+         virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
       public:
                 pulseSimpleAudioDevice(void);
                 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -139,5 +139,23 @@
     ADM_usleep(5*1000);
 
 }
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT,ADM_CH_LFE};
+const CHANNEL_TYPE *sdlAudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
 
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Sdl/ADM_deviceSDL.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -13,13 +13,15 @@
  {
      protected :
                 bool       active;
-      public:
+
                 virtual     bool     localInit(void);
                 virtual     bool     localStop(void);
                 virtual     void     sendData(void);    
-                                     sdlAudioDevice();
+                                     
+                virtual const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
      public:
                 uint8_t callback( Uint8 *stream, int len);
+                        sdlAudioDevice();
      }     ;
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.cpp	2009-12-22 15:30:04 UTC (rev 5714)
@@ -168,6 +168,25 @@
 	return ;
 }
 
+/**
+    \fn getWantedChannelMapping
+*/
+const CHANNEL_TYPE mono[MAX_CHANNELS]={ADM_CH_MONO};
+const CHANNEL_TYPE stereo[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT};
+const CHANNEL_TYPE fiveDotOne[MAX_CHANNELS]={ADM_CH_FRONT_LEFT,ADM_CH_FRONT_RIGHT,ADM_CH_FRONT_CENTER,
+                                             ADM_CH_LFE,ADM_CH_REAR_LEFT,ADM_CH_REAR_RIGHT};
+const CHANNEL_TYPE *win32AudioDevice::getWantedChannelMapping(uint32_t channels)
+{
+    switch(channels)
+    {
+        case 1: return mono;break;
+        case 2: return stereo;break;
+        default:
+                return fiveDotOne;
+                break;
+    }
+    return NULL;
+}
 void handleMM(MMRESULT err)
 {
 #define ERMM(x) if(err==x) printf(&quot;[Win32] &quot;#x&quot;\n&quot;);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.h	2009-12-21 23:34:49 UTC (rev 5713)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDevices/Win32/ADM_deviceWin32.h	2009-12-22 15:30:04 UTC (rev 5714)
@@ -19,7 +19,7 @@
 	virtual     bool     localInit(void);
     virtual     bool     localStop(void);
     virtual     void     sendData(void); 
-
+    virtual     const CHANNEL_TYPE *getWantedChannelMapping(uint32_t channels);
 public:
     uint8_t setVolume(int volume);
 	win32AudioDevice(void);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002920.html">[Avidemux-svn-commit] r5713 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid
</A></li>
	<LI>Next message: <A HREF="002922.html">[Avidemux-svn-commit] r5715 - in	branches/avidemux_2.6_branch_mean/avidemux:	cli/ADM_userInterfaces/ADM_gui2 gtk/ADM_userInterfaces/ADM_gui2	qt4/ADM_userInterfaces/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2921">[ date ]</a>
              <a href="thread.html#2921">[ thread ]</a>
              <a href="subject.html#2921">[ subject ]</a>
              <a href="author.html#2921">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
