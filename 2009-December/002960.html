<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5753 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/src ADM_codecs
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5753%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_GTK/src%20ADM_UIs/ADM_QT4/src%20ADM_codecs&In-Reply-To=%3C200912282214.nBSMEG76010546%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002959.html">
   <LINK REL="Next"  HREF="002961.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5753 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/src ADM_codecs</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5753%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_GTK/src%20ADM_UIs/ADM_QT4/src%20ADM_codecs&In-Reply-To=%3C200912282214.nBSMEG76010546%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5753 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/src ADM_codecs">gruntster at mail.berlios.de
       </A><BR>
    <I>Mon Dec 28 23:14:16 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002959.html">[Avidemux-svn-commit] r5752 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_codecs	ADM_encoder ADM_outputs/oplug_mpegFF
</A></li>
        <LI>Next message: <A HREF="002961.html">[Avidemux-svn-commit] r5754 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2960">[ date ]</a>
              <a href="thread.html#2960">[ thread ]</a>
              <a href="subject.html#2960">[ subject ]</a>
              <a href="author.html#2960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-12-28 23:14:09 +0100 (Mon, 28 Dec 2009)
New Revision: 5753

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
Log:
[moeg] remove more remnants

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp	2009-12-28 21:53:58 UTC (rev 5752)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/FAC_bitrate.cpp	2009-12-28 22:14:09 UTC (rev 5753)
@@ -1,341 +1,341 @@
-/***************************************************************************
-  FAC_bitrate.cpp
-  Handle dialog factory element : Bitrate (encoding mode)
-  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
-***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;ADM_toolkitGtk.h&quot;
-#include &quot;DIA_factory.h&quot;
-namespace ADM_GtkFactory
-{
+/***************************************************************************
+  FAC_bitrate.cpp
+  Handle dialog factory element : Bitrate (encoding mode)
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;ADM_toolkitGtk.h&quot;
+#include &quot;DIA_factory.h&quot;
+namespace ADM_GtkFactory
+{
 struct diaElemBitrateData
-{
-	GtkWidget *label1, *label2, *combo, *spin;
-	COMPRES_PARAMS *param;
-	unsigned int maxQ, minQ;
-};
-
-class diaElemBitrate : public diaElemBitrateBase
-{
-protected:
-public:
-  
-  diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip=NULL);
-  virtual ~diaElemBitrate() ;
-  void setMe(void *dialog, void *opaque,uint32_t line);
-  void getMe(void);
-  void setMaxQz(uint32_t qz);
-  void setMinQz(uint32_t qz);
-  void updateMe(void);
-  int getRequiredLayout(void);
-};
-
-static void cb_mod(GtkWidget *widget, gpointer *data);
-/**
- * 	\fn 	readPullDown
- * \brief 	Convert the raw read of the combox into the actual compression mode
- */
-static COMPRESSION_MODE readPulldown(COMPRES_PARAMS *copy,int rank)
-{
-	int index=0;
-	COMPRESSION_MODE mode=COMPRESS_MAX;
-	
-#undef LOOKUP
-#define LOOKUP(A,B) \
-  if(copy-&gt;capabilities &amp; ADM_ENC_CAP_##A) \
-  { \
-	  if(rank==index) mode=COMPRESS_##B; \
-	  index++; \
-  } 
-  
-  LOOKUP(CBR,CBR);
-  LOOKUP(CQ,CQ);
-  LOOKUP(SAME,SAME);
-  LOOKUP(AQ,AQ);
-  LOOKUP(2PASS,2PASS);
-  LOOKUP(2PASS_BR,2PASS_BITRATE);
-  
-	ADM_assert(mode!=COMPRESS_MAX);
-	return mode;
-}
-
-static void updatePulldown(COMPRES_PARAMS *copy, GtkComboBox *combo)
-{
-	int index = 0, set = -1;
-
-#undef LOOKUP
-#define LOOKUP(A,B) \
-	if(copy-&gt;capabilities &amp; ADM_ENC_CAP_##A) \
-	{ \
-		if (copy-&gt;mode == COMPRESS_##B) set = index; \
-			index++; \
-	} \
-
-	LOOKUP(CBR, CBR);
-	LOOKUP(CQ, CQ);
-	LOOKUP(SAME, SAME);
-	LOOKUP(AQ, AQ);
-	LOOKUP(2PASS, 2PASS);
-	LOOKUP(2PASS_BR, 2PASS_BITRATE);
-
-	if (set != -1)
-		gtk_combo_box_set_active(combo, set);
-}
-
- diaElemBitrate::diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
-  : diaElemBitrateBase()
-{
-  param=(void *)p;
-  memcpy(&amp;copy,p,sizeof(copy));
-  paramTitle=toggleTitle;
-  this-&gt;tip=tip;
-  setSize(2);
-  minQ=2;
-  maxQ=31;
-}
-
-void diaElemBitrate::setMinQz(uint32_t qz)
-{
-  minQ=qz;
-}
-
-void diaElemBitrate::setMaxQz(uint32_t qz)
-{
-  maxQ=qz; 
-}
-diaElemBitrate::~diaElemBitrate()
-{
-	diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
-
-	delete data;
-	myWidget = NULL;
-}
-/**
- * \fn setMe
- * @param dialog  Pointer to father dialog
- * @param opaque  Internal, Gtk table to attach to
- * @param line Line were the widget should be displayed
- */
-void diaElemBitrate::setMe(void *dialog, void *opaque,uint32_t line)
-{
-  GtkObject *adj;
-  GtkWidget *label1;
-  GtkWidget *label2;
-  GtkWidget *combo;
-  GtkWidget *spin;
-  
-#define PUT_ARRAY(x,y,widget)  gtk_table_attach (GTK_TABLE (opaque), widget, x, x+1, line+y, line+y+1, \
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), \
-                    (GtkAttachOptions) (0), 0, 0);
-  
-  /* Add text -&gt; encoding mode */
-  label1 = gtk_label_new_with_mnemonic (QT_TR_NOOP(&quot;_Encoding mode:&quot;));
-  gtk_misc_set_alignment (GTK_MISC (label1), 0.0, 0.5);
-  gtk_widget_show(label1);
-  
-  /* put entry in hbox */
- 
-  PUT_ARRAY(0,0,label1);
-  
-  
-  /* Add text -&gt; encoding mode */
-  label2 = gtk_label_new_with_mnemonic (QT_TR_NOOP(&quot;_Bitrate (kb/s):&quot;));
-  gtk_misc_set_alignment (GTK_MISC (label2), 0.0, 0.5);
-  gtk_widget_show(label2);
-  /* put entry in hbox */
-  PUT_ARRAY(0,1,label2);
- 
-  /* Add encoding menu combo */
-  
-  
-  combo = gtk_combo_box_new_text ();
-  gtk_widget_show (combo);
-  
-  gtk_label_set_mnemonic_widget (GTK_LABEL(label1), combo);
-  if((copy.capabilities &amp; ADM_ENC_CAP_CBR)) 
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - bitrate&quot;));
-  if((copy.capabilities &amp; ADM_ENC_CAP_CQ))
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - constant quality&quot;));
-  if((copy.capabilities &amp; ADM_ENC_CAP_SAME))
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - same qz as input&quot;));
-  if((copy.capabilities &amp; ADM_ENC_CAP_AQ))
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - Average quantizer&quot;));
-
-  if((copy.capabilities &amp; ADM_ENC_CAP_2PASS))
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Two pass - video size&quot;));
-  if((copy.capabilities &amp; ADM_ENC_CAP_2PASS_BR))
-	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Two pass - average bitrate&quot;));
-  
-  /**/
-  
-   
-  
-  PUT_ARRAY(1,0,combo);
-  
-  
-  /* Now add value */
-  spin = gtk_spin_button_new_with_range(0,1,1);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON(spin),TRUE);
-  gtk_spin_button_set_digits  (GTK_SPIN_BUTTON(spin),0);
-  
-  gtk_widget_show (spin);
-  
-    PUT_ARRAY(1,1,spin);
-  /*  add button */
-   gtk_label_set_mnemonic_widget (GTK_LABEL(label1), combo);
-   gtk_label_set_mnemonic_widget (GTK_LABEL(label2), spin);
-
-   diaElemBitrateData *data = new diaElemBitrateData;
-
-   data-&gt;param = &copy;
-   data-&gt;label1 = label1;
-   data-&gt;label2 = label2;
-   data-&gt;combo = combo;
-   data-&gt;spin = spin;
-   data-&gt;maxQ = maxQ;
-   data-&gt;minQ = minQ;
-
-   myWidget = (void*)data;
-
-   gtk_signal_connect(GTK_OBJECT(data-&gt;combo), &quot;changed&quot;,
-	   G_CALLBACK(cb_mod), (void *)data);
-
-   updatePulldown(&amp;copy, GTK_COMBO_BOX(combo));
-}
-
-void diaElemBitrate::getMe(void)
-{
-  // Read current value
-  diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
-  int rank = gtk_combo_box_get_active(GTK_COMBO_BOX(data-&gt;combo));
-  data-&gt;param-&gt;mode = readPulldown(data-&gt;param,rank);
-
-#undef P
-#undef M
-#undef S
-#define P(x) 
-#define M(x,y)
-#define S(x)   x=(uint32_t)gtk_spin_button_get_value  (GTK_SPIN_BUTTON(data-&gt;spin))
-  switch(data-&gt;param-&gt;mode)
-  {
-    case COMPRESS_CBR: //CBR
-          P(_Bitrate (kb/s):);
-          M(0,20000);
-          S(data-&gt;param-&gt;bitrate);
-          break;
-    case COMPRESS_<A HREF="AQ://">AQ://</A> CQ
-          P(_Quantizer:);
-          M(2,31);
-          S(data-&gt;param-&gt;qz);
-          break;
-    case COMPRESS_<A HREF="CQ://">CQ://</A> CQ
-          P(_Quantizer:);
-          M(2,31);
-          S(data-&gt;param-&gt;qz);
-          break;
-    case  COMPRESS_2PASS: // 2pass Filesize
-          P(_Video size (MB):);
-          M(1,8000);
-          S(data-&gt;param-&gt;finalsize);
-          break;
-    case COMPRESS_2PASS_BITRATE : // 2pass Avg
-          P(_Average bitrate (kb/s):);
-          M(0,20000);
-          S(data-&gt;param-&gt;avg_bitrate);
-          break;
-    case COMPRESS_SAME : // Same Qz as input
-          P(-);
-          M(0,0);
-          break;
-    default:
-		ADM_assert(0);
-  }
-
-  memcpy(param, data-&gt;param, sizeof(COMPRES_PARAMS));
-}
-
-int diaElemBitrate::getRequiredLayout(void) { return 0; }
-
-void updateCombo(diaElemBitrateData *data)
-{
-#undef M
-#undef S
-#define M(x,y) gtk_spin_button_set_range  (GTK_SPIN_BUTTON(data-&gt;spin),x,y)
-#define S(x)   gtk_spin_button_set_value  (GTK_SPIN_BUTTON(data-&gt;spin),x)
-
-  updatePulldown(data-&gt;param, GTK_COMBO_BOX(data-&gt;combo));
-
-  switch (data-&gt;param-&gt;mode)
-  {
-    case COMPRESS_CBR:
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Bitrate (kb/s):&quot;));
-          M(0,20000);
-          S(data-&gt;param-&gt;bitrate);
-          break; 
-    case COMPRESS_CQ:
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Quantizer:&quot;));
-          M(data-&gt;minQ,data-&gt;maxQ);
-          S(data-&gt;param-&gt;qz);
-          break;
-    case COMPRESS_AQ:
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;A_vg Quantizer:&quot;));
-          M(2,64);
-          S(data-&gt;param-&gt;qz);
-          break;
-    case COMPRESS_2PASS:
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Video size (MB):&quot;));
-          M(1,8000);
-          S(data-&gt;param-&gt;finalsize);
-          break;
-    case COMPRESS_2PASS_BITRATE:
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Average bitrate (kb/s):&quot;));
-          M(0,20000);
-          S(data-&gt;param-&gt;avg_bitrate);
-          break;
-    case COMPRESS_SAME : // Same Qz as input
-          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;-&quot;));
-          M(0,0);
-          break;
-    default:
-		ADM_assert(0);
-  }
-}
-
-void diaElemBitrate::updateMe(void)
-{
-	diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
-
-	memcpy(data-&gt;param, param, sizeof(COMPRES_PARAMS));
-	updateCombo(data);
-}
-
-void cb_mod(GtkWidget *widget, gpointer *d)
-{
-	diaElemBitrateData *data = (diaElemBitrateData*)d;
-
-	data-&gt;param-&gt;mode = readPulldown(data-&gt;param, gtk_combo_box_get_active(GTK_COMBO_BOX(data-&gt;combo)));
-	updateCombo(data);
-}
-
-} // End of namespace
-//****************************Hoook*****************
-
-diaElem  *gtkCreateBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
-{
-	return new  ADM_GtkFactory::diaElemBitrate(p,toggleTitle,tip);
-}
-void gtkDestroyBitrate(diaElem *e)
-{
-	ADM_GtkFactory::diaElemBitrate *a=(ADM_GtkFactory::diaElemBitrate *)e;
-	delete a;
-}
-//EOF
+{
+	GtkWidget *label1, *label2, *combo, *spin;
+	COMPRES_PARAMS *param;
+	unsigned int maxQ, minQ;
+};
+
+class diaElemBitrate : public diaElemBitrateBase
+{
+protected:
+public:
+  
+  diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip=NULL);
+  virtual ~diaElemBitrate() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+  void setMaxQz(uint32_t qz);
+  void setMinQz(uint32_t qz);
+  void updateMe(void);
+  int getRequiredLayout(void);
+};
+
+static void cb_mod(GtkWidget *widget, gpointer *data);
+/**
+ * 	\fn 	readPullDown
+ * \brief 	Convert the raw read of the combox into the actual compression mode
+ */
+static COMPRESSION_MODE readPulldown(COMPRES_PARAMS *copy,int rank)
+{
+	int index=0;
+	COMPRESSION_MODE mode=COMPRESS_MAX;
+	
+#undef LOOKUP
+#define LOOKUP(A,B) \
+  if(copy-&gt;capabilities &amp; ADM_ENC_CAP_##A) \
+  { \
+	  if(rank==index) mode=COMPRESS_##B; \
+	  index++; \
+  } 
+  
+  LOOKUP(CBR,CBR);
+  LOOKUP(CQ,CQ);
+  LOOKUP(SAME,SAME);
+  LOOKUP(AQ,AQ);
+  LOOKUP(2PASS,2PASS);
+  LOOKUP(2PASS_BR,2PASS_BITRATE);
+  
+	ADM_assert(mode!=COMPRESS_MAX);
+	return mode;
+}
+
+static void updatePulldown(COMPRES_PARAMS *copy, GtkComboBox *combo)
+{
+	int index = 0, set = -1;
+
+#undef LOOKUP
+#define LOOKUP(A,B) \
+	if(copy-&gt;capabilities &amp; ADM_ENC_CAP_##A) \
+	{ \
+		if (copy-&gt;mode == COMPRESS_##B) set = index; \
+			index++; \
+	} \
+
+	LOOKUP(CBR, CBR);
+	LOOKUP(CQ, CQ);
+	LOOKUP(SAME, SAME);
+	LOOKUP(AQ, AQ);
+	LOOKUP(2PASS, 2PASS);
+	LOOKUP(2PASS_BR, 2PASS_BITRATE);
+
+	if (set != -1)
+		gtk_combo_box_set_active(combo, set);
+}
+
+ diaElemBitrate::diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
+  : diaElemBitrateBase()
+{
+  param=(void *)p;
+  memcpy(&amp;copy,p,sizeof(copy));
+  paramTitle=toggleTitle;
+  this-&gt;tip=tip;
+  setSize(2);
+  minQ=2;
+  maxQ=31;
+}
+
+void diaElemBitrate::setMinQz(uint32_t qz)
+{
+  minQ=qz;
+}
+
+void diaElemBitrate::setMaxQz(uint32_t qz)
+{
+  maxQ=qz; 
+}
+diaElemBitrate::~diaElemBitrate()
+{
+	diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
+
+	delete data;
+	myWidget = NULL;
+}
+/**
+ * \fn setMe
+ * @param dialog  Pointer to father dialog
+ * @param opaque  Internal, Gtk table to attach to
+ * @param line Line were the widget should be displayed
+ */
+void diaElemBitrate::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  GtkObject *adj;
+  GtkWidget *label1;
+  GtkWidget *label2;
+  GtkWidget *combo;
+  GtkWidget *spin;
+  
+#define PUT_ARRAY(x,y,widget)  gtk_table_attach (GTK_TABLE (opaque), widget, x, x+1, line+y, line+y+1, \
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), \
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  /* Add text -&gt; encoding mode */
+  label1 = gtk_label_new_with_mnemonic (QT_TR_NOOP(&quot;_Encoding mode:&quot;));
+  gtk_misc_set_alignment (GTK_MISC (label1), 0.0, 0.5);
+  gtk_widget_show(label1);
+  
+  /* put entry in hbox */
+ 
+  PUT_ARRAY(0,0,label1);
+  
+  
+  /* Add text -&gt; encoding mode */
+  label2 = gtk_label_new_with_mnemonic (QT_TR_NOOP(&quot;_Bitrate (kb/s):&quot;));
+  gtk_misc_set_alignment (GTK_MISC (label2), 0.0, 0.5);
+  gtk_widget_show(label2);
+  /* put entry in hbox */
+  PUT_ARRAY(0,1,label2);
+ 
+  /* Add encoding menu combo */
+  
+  
+  combo = gtk_combo_box_new_text ();
+  gtk_widget_show (combo);
+  
+  gtk_label_set_mnemonic_widget (GTK_LABEL(label1), combo);
+  if((copy.capabilities &amp; ADM_ENC_CAP_CBR)) 
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - bitrate&quot;));
+  if((copy.capabilities &amp; ADM_ENC_CAP_CQ))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - constant quality&quot;));
+  if((copy.capabilities &amp; ADM_ENC_CAP_SAME))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - same qz as input&quot;));
+  if((copy.capabilities &amp; ADM_ENC_CAP_AQ))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Single pass - Average quantiser&quot;));
+
+  if((copy.capabilities &amp; ADM_ENC_CAP_2PASS))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Two pass - video size&quot;));
+  if((copy.capabilities &amp; ADM_ENC_CAP_2PASS_BR))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),QT_TR_NOOP(&quot;Two pass - average bitrate&quot;));
+  
+  /**/
+  
+   
+  
+  PUT_ARRAY(1,0,combo);
+  
+  
+  /* Now add value */
+  spin = gtk_spin_button_new_with_range(0,1,1);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON(spin),TRUE);
+  gtk_spin_button_set_digits  (GTK_SPIN_BUTTON(spin),0);
+  
+  gtk_widget_show (spin);
+  
+    PUT_ARRAY(1,1,spin);
+  /*  add button */
+   gtk_label_set_mnemonic_widget (GTK_LABEL(label1), combo);
+   gtk_label_set_mnemonic_widget (GTK_LABEL(label2), spin);
+
+   diaElemBitrateData *data = new diaElemBitrateData;
+
+   data-&gt;param = &copy;
+   data-&gt;label1 = label1;
+   data-&gt;label2 = label2;
+   data-&gt;combo = combo;
+   data-&gt;spin = spin;
+   data-&gt;maxQ = maxQ;
+   data-&gt;minQ = minQ;
+
+   myWidget = (void*)data;
+
+   gtk_signal_connect(GTK_OBJECT(data-&gt;combo), &quot;changed&quot;,
+	   G_CALLBACK(cb_mod), (void *)data);
+
+   updatePulldown(&amp;copy, GTK_COMBO_BOX(combo));
+}
+
+void diaElemBitrate::getMe(void)
+{
+  // Read current value
+  diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
+  int rank = gtk_combo_box_get_active(GTK_COMBO_BOX(data-&gt;combo));
+  data-&gt;param-&gt;mode = readPulldown(data-&gt;param,rank);
+
+#undef P
+#undef M
+#undef S
+#define P(x) 
+#define M(x,y)
+#define S(x)   x=(uint32_t)gtk_spin_button_get_value  (GTK_SPIN_BUTTON(data-&gt;spin))
+  switch(data-&gt;param-&gt;mode)
+  {
+    case COMPRESS_CBR: //CBR
+          P(_Bitrate (kb/s):);
+          M(0,20000);
+          S(data-&gt;param-&gt;bitrate);
+          break;
+    case COMPRESS_<A HREF="AQ://">AQ://</A> CQ
+          P(_Quantizer:);
+          M(2,31);
+          S(data-&gt;param-&gt;qz);
+          break;
+    case COMPRESS_<A HREF="CQ://">CQ://</A> CQ
+          P(_Quantizer:);
+          M(2,31);
+          S(data-&gt;param-&gt;qz);
+          break;
+    case  COMPRESS_2PASS: // 2pass Filesize
+          P(_Video size (MB):);
+          M(1,8000);
+          S(data-&gt;param-&gt;finalsize);
+          break;
+    case COMPRESS_2PASS_BITRATE : // 2pass Avg
+          P(_Average bitrate (kb/s):);
+          M(0,20000);
+          S(data-&gt;param-&gt;avg_bitrate);
+          break;
+    case COMPRESS_SAME : // Same Qz as input
+          P(-);
+          M(0,0);
+          break;
+    default:
+		ADM_assert(0);
+  }
+
+  memcpy(param, data-&gt;param, sizeof(COMPRES_PARAMS));
+}
+
+int diaElemBitrate::getRequiredLayout(void) { return 0; }
+
+void updateCombo(diaElemBitrateData *data)
+{
+#undef M
+#undef S
+#define M(x,y) gtk_spin_button_set_range  (GTK_SPIN_BUTTON(data-&gt;spin),x,y)
+#define S(x)   gtk_spin_button_set_value  (GTK_SPIN_BUTTON(data-&gt;spin),x)
+
+  updatePulldown(data-&gt;param, GTK_COMBO_BOX(data-&gt;combo));
+
+  switch (data-&gt;param-&gt;mode)
+  {
+    case COMPRESS_CBR:
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Bitrate (kb/s):&quot;));
+          M(0,20000);
+          S(data-&gt;param-&gt;bitrate);
+          break; 
+    case COMPRESS_CQ:
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Quantiser:&quot;));
+          M(data-&gt;minQ,data-&gt;maxQ);
+          S(data-&gt;param-&gt;qz);
+          break;
+    case COMPRESS_AQ:
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;A_vg Quantiser:&quot;));
+          M(2,64);
+          S(data-&gt;param-&gt;qz);
+          break;
+    case COMPRESS_2PASS:
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Video size (MB):&quot;));
+          M(1,8000);
+          S(data-&gt;param-&gt;finalsize);
+          break;
+    case COMPRESS_2PASS_BITRATE:
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;_Average bitrate (kb/s):&quot;));
+          M(0,20000);
+          S(data-&gt;param-&gt;avg_bitrate);
+          break;
+    case COMPRESS_SAME : // Same Qz as input
+          gtk_label_set_text_with_mnemonic(GTK_LABEL(data-&gt;label2),QT_TR_NOOP(&quot;-&quot;));
+          M(0,0);
+          break;
+    default:
+		ADM_assert(0);
+  }
+}
+
+void diaElemBitrate::updateMe(void)
+{
+	diaElemBitrateData *data = (diaElemBitrateData*)myWidget;
+
+	memcpy(data-&gt;param, param, sizeof(COMPRES_PARAMS));
+	updateCombo(data);
+}
+
+void cb_mod(GtkWidget *widget, gpointer *d)
+{
+	diaElemBitrateData *data = (diaElemBitrateData*)d;
+
+	data-&gt;param-&gt;mode = readPulldown(data-&gt;param, gtk_combo_box_get_active(GTK_COMBO_BOX(data-&gt;combo)));
+	updateCombo(data);
+}
+
+} // End of namespace
+//****************************Hoook*****************
+
+diaElem  *gtkCreateBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
+{
+	return new  ADM_GtkFactory::diaElemBitrate(p,toggleTitle,tip);
+}
+void gtkDestroyBitrate(diaElem *e)
+{
+	ADM_GtkFactory::diaElemBitrate *a=(ADM_GtkFactory::diaElemBitrate *)e;
+	delete a;
+}
+//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp	2009-12-28 21:53:58 UTC (rev 5752)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_bitrate.cpp	2009-12-28 22:14:09 UTC (rev 5753)
@@ -165,7 +165,7 @@
 			S(compress-&gt;bitrate);
 			break; 
 		case COMPRESS_<A HREF="CQ://">CQ://</A> CQ
-			P(QT_TR_NOOP(&quot;Quantizer&quot;));
+			P(QT_TR_NOOP(&quot;Quantiser&quot;));
 			M(_minQ,maxQ);
 			S(compress-&gt;qz);
 			break;
@@ -184,7 +184,7 @@
 			M(0,0);
 			break;
 		case COMPRESS_AQ : // AQ
-			P(QT_TR_NOOP(&quot;Quantizer&quot;));
+			P(QT_TR_NOOP(&quot;Quantiser&quot;));
 			M(_minQ,maxQ);
 			S(compress-&gt;qz);
 			break;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-12-28 21:53:58 UTC (rev 5752)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2009-12-28 22:14:09 UTC (rev 5753)
@@ -384,9 +384,6 @@
   {
   1000, fps1000};
 
-  if(_id==FF_MPEG2 || _id==FF_MPEG1)
-	  _context-&gt;bit_rate = _br;
-  else
 	  _context-&gt;bit_rate = _br*1000;
 
   printf (&quot;[LAVCODEC] Using  bitrate in context :%lu kbps&quot;,_context-&gt;bit_rate/1000);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002959.html">[Avidemux-svn-commit] r5752 - in	branches/avidemux_2.5_branch_gruntster/avidemux: ADM_codecs	ADM_encoder ADM_outputs/oplug_mpegFF
</A></li>
	<LI>Next message: <A HREF="002961.html">[Avidemux-svn-commit] r5754 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2960">[ date ]</a>
              <a href="thread.html#2960">[ thread ]</a>
              <a href="subject.html#2960">[ subject ]</a>
              <a href="author.html#2960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
