<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5606 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_script avidemux/qt4	avidemux/qt4/ADM_userInterfaces	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_demuxers/Asf	avidemux_plugins/ADM_muxers/muxerffTS
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5606%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_script%20avidemux/qt4%0A%09avidemux/qt4/ADM_userInterfaces%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_plugins/ADM_demuxers/Asf%0A%09avidemux_plugins/ADM_muxers/muxerffTS&In-Reply-To=%3C200912021902.nB2J2Mai010785%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002814.html">
   <LINK REL="Next"  HREF="002816.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5606 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_script avidemux/qt4	avidemux/qt4/ADM_userInterfaces	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_demuxers/Asf	avidemux_plugins/ADM_muxers/muxerffTS</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5606%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common%20avidemux/common/ADM_script%20avidemux/qt4%0A%09avidemux/qt4/ADM_userInterfaces%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_plugins/ADM_demuxers/Asf%0A%09avidemux_plugins/ADM_muxers/muxerffTS&In-Reply-To=%3C200912021902.nB2J2Mai010785%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5606 - in branches/avidemux_2.6_branch_mean:	avidemux/common avidemux/common/ADM_script avidemux/qt4	avidemux/qt4/ADM_userInterfaces	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_demuxers/Asf	avidemux_plugins/ADM_muxers/muxerffTS">mean at mail.berlios.de
       </A><BR>
    <I>Wed Dec  2 20:02:22 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002814.html">[Avidemux-svn-commit] r5605 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries
</A></li>
        <LI>Next message: <A HREF="002816.html">[Avidemux-svn-commit] r5607 - in branches/avidemux_2.6_branch_mean:	avidemux/cli avidemux/cli/ADM_userInterfaces	avidemux/cli/ADM_userInterfaces/ADM_shell	avidemux/common/ADM_script avidemux/gtk	avidemux/gtk/ADM_userInterfaces	avidemux/gtk/ADM_userInterfaces/ADM_shell	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_muxers/muxerffTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2815">[ date ]</a>
              <a href="thread.html#2815">[ thread ]</a>
              <a href="subject.html#2815">[ subject ]</a>
              <a href="author.html#2815">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-12-02 20:02:21 +0100 (Wed, 02 Dec 2009)
New Revision: 5606

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_jsShell.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/shell.ui
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/ADM_asfPacket.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp
Log:
[Js] Shell + qt4 UI for shell

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -18,6 +18,7 @@
 #include &quot;ADM_JSGlobal.h&quot;
 #include &quot;ADM_JSAvidemux.h&quot;
 #include &quot;ADM_JSDirectorySearch.h&quot;
+#include &quot;ADM_jsShell.h&quot;
 
 extern uint8_t JS_AvidemuxFunction(JSContext *cx,JSObject *global);
 extern void A_Resync(void);
@@ -151,23 +152,4 @@
 	printf(&quot;[ECMA] success : %d\n&quot;, g_bJSSuccess);
 }// end JS_setSuccess
 
-bool parseECMAScript(const char *name)
-{// begin parseECMAScript
-	jsval rval;
-	uintN lineno = 0;
-	g_bJSSuccess = 0;
-	printf(&quot;Spidermonkey compiling \&quot;%s\&quot;...&quot;,name);
-	JSScript *pJSScript = JS_CompileFile(g_pCx, g_pObject, name);
-	printf(&quot;Done.\n&quot;);
-	if(pJSScript != NULL)
-	{// begin execute external file
-		printf(&quot;Spidermonkey executing \&quot;%s\&quot;...&quot;,name);
-		JSBool ok = JS_ExecuteScript(g_pCx, g_pObject, pJSScript, &amp;rval);
-		JS_DestroyScript(g_pCx,pJSScript);
-		printf(&quot;Done.\n&quot;);
-	}// end execute external file
-        // Run garbage collector now, it is safe
-        JS_GC(g_pCx);
-	A_Resync();
-	return g_bJSSuccess;
-}// end parseECMAScript
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.h	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSGlobal.h	2009-12-02 19:02:21 UTC (rev 5606)
@@ -11,6 +11,7 @@
 bool SpidermonkeyInit();
 void SpidermonkeyDestroy();
 bool parseECMAScript(const char *name);
+bool interactiveECMAScript(const char *name);
 void JS_setSuccess(bool bSuccess);
 void *StartThreadSpidermonkey(void *pData);
 

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,67 @@
+/**
+    \file ADM_JSif.cpp
+    \brief interface to js
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &lt;string.h&gt;
+#include &lt;pthread.h&gt;
+#include &quot;DIA_coreToolkit.h&quot;
+#include &quot;ADM_JSGlobal.h&quot;
+#include &quot;ADM_JSAvidemux.h&quot;
+#include &quot;ADM_jsShell.h&quot;
+void    A_Resync(void);
+
+/**
+    \fn parseECMAScript
+    \brief Compile &amp; execute ecma script
+*/
+bool parseECMAScript(const char *name)
+{// begin parseECMAScript
+	jsval rval;
+	uintN lineno = 0;
+	g_bJSSuccess = 0;
+	printf(&quot;Spidermonkey compiling \&quot;%s\&quot;...&quot;,name);
+	JSScript *pJSScript = JS_CompileFile(g_pCx, g_pObject, name);
+	printf(&quot;Done.\n&quot;);
+	if(pJSScript != NULL)
+	{// begin execute external file
+		printf(&quot;Spidermonkey executing \&quot;%s\&quot;...&quot;,name);
+		JSBool ok = JS_ExecuteScript(g_pCx, g_pObject, pJSScript, &amp;rval);
+		JS_DestroyScript(g_pCx,pJSScript);
+		printf(&quot;Done.\n&quot;);
+	}// end execute external file
+        // Run garbage collector now, it is safe
+    JS_GC(g_pCx);
+	A_Resync();
+	return g_bJSSuccess;
+}// end parseECMAScript
+/**
+    \fn jsEvaluate
+*/
+static bool jsEvaluate(const char *str)
+{
+jsval rval;
+   JS_EvaluateScript(g_pCx,g_pObject,str,strlen(str),&quot;dummy&quot;,1,&amp;rval);
+   return true; 
+}
+/**
+    \fn    interactiveECMAScript
+    \brief interprete &amp; execute ecma script (interactive)
+*/
+bool interactiveECMAScript(const char *name)
+{
+    ADM_startShell(jsEvaluate);
+    JS_GC(g_pCx);
+	A_Resync();
+    ADM_info(&quot;Ending JS shell...\n&quot;);
+	return true;
+}
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.h	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_JSif.h	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,28 @@
+/**
+    \file ADM_JSif.cpp
+    \brief interface to js
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_JS_IF_H
+#define ADM_JS_IF_H
+/**
+    \fn parseECMAScript
+    \brief Compile &amp; execute ecma script
+*/
+bool parseECMAScript(const char *name);
+
+/**
+    \fn    interactiveECMAScript
+    \brief interprete &amp; execute ecma script (interactive)
+*/
+bool interactiveECMAScript(const char *name);
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_jsShell.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_jsShell.h	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/ADM_jsShell.h	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,22 @@
+/**
+    \file ADM_jsShell.h
+    \brief Base class for js interactive shell
+    \author mean, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef ADM_JS_SHELL_H
+#define ADM_JS_SHELL_H
+
+typedef bool (jsShellEvaluate)(const char *str);
+bool ADM_startShell(jsShellEvaluate *eval);
+
+#endif // ADM_JS_SHELL_H
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/CMakeLists.txt	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script/CMakeLists.txt	2009-12-02 19:02:21 UTC (rev 5606)
@@ -1,7 +1,9 @@
 SET(ADM_script_SRCS
 	ADM_AvidemuxAudio.cpp  ADM_AvidemuxVideo.cpp    ADM_JSAvidemux.cpp       ADM_JSDirectorySearch.cpp  ADM_JSGlobal.cpp
 	ADM_Avidemux.cpp       ADM_JSAvidemuxAudio.cpp  ADM_JSAvidemuxVideo.cpp  ADM_JSFunctions.cpp        DirectorySearch.cpp
-        ADM_JSFunctionsNonRegFactory.cpp)
+        ADM_JSFunctionsNonRegFactory.cpp
+        ADM_JSif.cpp
+)
 
 ADD_LIBRARY(ADM_script6 STATIC ${ADM_script_SRCS})
 ADD_TARGET_CFLAGS(ADM_script6 &quot;-DJS_THREADSAFE -DXP_UNIX&quot;)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -40,6 +40,7 @@
 
 #include &quot;avi_vars.h&quot;
 #include &quot;prototype.h&quot; // FIXME
+#include &quot;ADM_script/ADM_JSif.h&quot;
 char * actual_workbench_file;
 renderZoom currentZoom=ZOOM_1_1;
 //***********************************
@@ -83,10 +84,6 @@
 static void cleanUp (void);
 void        updateLoaded (void);
 extern void encoderSetLogFile (char *name);
-
-//__________
-extern bool parseECMAScript(const char *name);
-
 extern void videoCodecConfigureUI(int codecIndex = -1);
 extern void audioCodecChanged(int newcodec);
 extern void videoCodecChanged(int newcodec);
@@ -123,6 +120,9 @@
   }
   switch (action)
     {
+        case ACT_JS_SHELL:
+                                interactiveECMAScript(&quot;dummy&quot;);
+                                return;
         case ACT_AVS_PROXY:
                                 GUI_avsProxy();
                                 return;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_action.names	2009-12-02 19:02:21 UTC (rev 5606)
@@ -151,3 +151,4 @@
 ACT(JOG)
 ACT(GLYPHEDIT)
 ACT(PLUGIN_INFO)
+ACT(JS_SHELL)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2009-12-02 19:02:21 UTC (rev 5606)
@@ -1333,6 +1333,7 @@
     &lt;addaction name=&quot;actionOCR&quot;/&gt;
     &lt;addaction name=&quot;actionOCR_DVB_T_TS_files&quot;/&gt;
     &lt;addaction name=&quot;actionGlyphs_Edit&quot;/&gt;
+    &lt;addaction name=&quot;actionJavaScript_shell&quot;/&gt;
    &lt;/widget&gt;
    &lt;widget class=&quot;QMenu&quot; name=&quot;menuEdit&quot;&gt;
     &lt;property name=&quot;title&quot;&gt;
@@ -2328,6 +2329,11 @@
     &lt;string&gt;Plugins&lt;/string&gt;
    &lt;/property&gt;
   &lt;/action&gt;
+  &lt;action name=&quot;actionJavaScript_shell&quot;&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;JavaScript shell&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/action&gt;
  &lt;/widget&gt;
  &lt;customwidgets&gt;
   &lt;customwidget&gt;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2009-12-02 19:02:21 UTC (rev 5606)
@@ -69,7 +69,8 @@
 PROCESS(actionIPOD,ACT_AUTO_IPOD) \
 PROCESS(actionAdd_to_joblist,ACT_ADD_JOB) \
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  \
-PROCESS(actionPlugins,ACT_PLUGIN_INFO)  
+PROCESS(actionPlugins,ACT_PLUGIN_INFO) \
+PROCESS(actionJavaScript_shell,ACT_JS_SHELL) 
 
 #if 0
 PROCESS(actionPrevious_intra_frame,ACT_PreviousKFrame) \

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/CMakeLists.txt	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/CMakeLists.txt	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,22 @@
+SET(ADM_LIB ADM_shellQt4)
+
+SET(    uiFiles
+        shell.ui  
+        )
+SET(headers
+	Q_shell.h
+)
+
+QT4_WRAP_UI(${ADM_LIB}_headers ${uiFiles})
+QT4_WRAP_CPP(${ADM_LIB}_source ${headers})
+
+SET(${ADM_LIB}_SRCS 
+	${${ADM_LIB}_headers}  ${${ADM_LIB}_source} 
+        Q_shell.cpp  
+        qt4Shell.cpp
+)
+
+INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})
+INCLUDE_DIRECTORIES(&quot;${CMAKE_SOURCE_DIR}/avidemux/ADM_UIs/ADM_QT4/include&quot;)
+INCLUDE_DIRECTORIES(&quot;${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/common/ADM_script/&quot;)
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,57 @@
+/***************************************************************************
+
+    \file Q_shell.cpp
+    \brief UI for qt4 shell interface
+    \author mean, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixount at free.fr</A> 2007/2009
+        
+    
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;vector&gt;
+#include &quot;ADM_inttype.h&quot;
+#include &lt;QtCore/QFileInfo&gt;
+#include &lt;QtCore/QUrl&gt;
+#include &lt;QtGui/QKeyEvent&gt;
+#include &lt;QtGui/QGraphicsView&gt;
+#include &quot;Q_shell.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;ui_shell.h&quot;
+
+qShell::qShell(jsShellEvaluate *s) : QDialog()
+{
+    ADM_info(&quot;Setting up JS shell..\n&quot;);
+    evaluator=s;
+    ui.setupUi(this);
+    connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
+}
+
+qShell::~qShell()
+{
+    ADM_info(&quot;Destroying JS shell..\n&quot;);
+} 
+bool qShell::run(void)
+{
+    this-&gt;exec();
+    return true;
+}
+bool            qShell::evaluate(bool x)
+{
+    ADM_info(&quot;Evaluating...\n&quot;);
+    // 1 Get text from UI
+    QString text=ui.textBrowser_2-&gt;toPlainText();
+    ui.textBrowser-&gt;append(text);
+    ui.textBrowser_2-&gt;setPlainText(&quot;&quot;);
+    evaluator(text.toAscii());
+    return true;
+}
+//EOF
+
+

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,28 @@
+/**
+    \file Q_shell.h
+*/
+#ifndef Q_SHELL_H
+#define Q_SHELL_H
+#include &quot;ADM_inttype.h&quot;
+#include &lt;QtGui/QItemDelegate&gt;
+#include &quot;ui_shell.h&quot;
+#include &quot;ADM_jsShell.h&quot;
+/**
+    \class ADM_jsQt4Shell
+*/
+
+class qShell: public QDialog
+{
+	Q_OBJECT
+protected:
+    jsShellEvaluate      *evaluator;
+    Ui_SpiderMonkeyShell ui;
+public:
+                    qShell(jsShellEvaluate *s) ;
+    virtual         ~qShell() ;
+    bool            run(void);
+public slots:
+    bool            evaluate(bool x);
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,21 @@
+/**
+        \file qt4Shell.cpp
+        \brief qt4 Specific js interactive shell
+*/
+
+#include &quot;Q_shell.h&quot;
+#include &quot;ADM_default.h&quot;
+
+/**
+        \fn ADM_createJsShell
+        \brief create the input for a js shell
+*/
+bool ADM_startShell(jsShellEvaluate eval)
+{
+        qShell *s= new qShell(eval);
+        s-&gt;run();
+        delete s;
+        return true;
+}
+//EOF
+

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/shell.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/shell.ui	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/shell.ui	2009-12-02 19:02:21 UTC (rev 5606)
@@ -0,0 +1,61 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;class&gt;SpiderMonkeyShell&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;SpiderMonkeyShell&quot;&gt;
+  &lt;property name=&quot;windowModality&quot;&gt;
+   &lt;enum&gt;Qt::ApplicationModal&lt;/enum&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;558&lt;/width&gt;
+    &lt;height&gt;336&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Shell&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;modal&quot;&gt;
+   &lt;bool&gt;true&lt;/bool&gt;
+  &lt;/property&gt;
+  &lt;widget class=&quot;QTextBrowser&quot; name=&quot;textBrowser&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;20&lt;/x&gt;
+     &lt;y&gt;0&lt;/y&gt;
+     &lt;width&gt;511&lt;/width&gt;
+     &lt;height&gt;191&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+  &lt;/widget&gt;
+  &lt;widget class=&quot;QTextBrowser&quot; name=&quot;textBrowser_2&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;20&lt;/x&gt;
+     &lt;y&gt;190&lt;/y&gt;
+     &lt;width&gt;511&lt;/width&gt;
+     &lt;height&gt;91&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;readOnly&quot;&gt;
+    &lt;bool&gt;false&lt;/bool&gt;
+   &lt;/property&gt;
+  &lt;/widget&gt;
+  &lt;widget class=&quot;QPushButton&quot; name=&quot;evalute&quot;&gt;
+   &lt;property name=&quot;geometry&quot;&gt;
+    &lt;rect&gt;
+     &lt;x&gt;430&lt;/x&gt;
+     &lt;y&gt;300&lt;/y&gt;
+     &lt;width&gt;97&lt;/width&gt;
+     &lt;height&gt;24&lt;/height&gt;
+    &lt;/rect&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;text&quot;&gt;
+    &lt;string&gt;Evaluate&lt;/string&gt;
+   &lt;/property&gt;
+  &lt;/widget&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections/&gt;
+&lt;/ui&gt;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/CMakeLists.txt	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/CMakeLists.txt	2009-12-02 19:02:21 UTC (rev 5606)
@@ -7,3 +7,4 @@
 subdirs (PREORDER ADM_filters)
 ADD_SUBDIRECTORY(ADM_dialog)
 ADD_SUBDIRECTORY(ADM_gui)
+ADD_SUBDIRECTORY(ADM_shell)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2009-12-02 19:02:21 UTC (rev 5606)
@@ -84,6 +84,7 @@
 TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_UIQT4)
 TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_guiQt4)
 TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_UI_QT4)
+TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_shellQt4)
 ###########################################
 # Construct Core libraries
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/ADM_asfPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/ADM_asfPacket.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/ADM_asfPacket.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -306,7 +306,11 @@
    // Do some sanity check
    if(_offset+paddingLen!=pakSize)
    {
-     printf(&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! %d %d\n&quot;,_offset,paddingLen);
+     ADM_warning(&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! %d+%d!=%d\n&quot;,_offset,paddingLen,pakSize);
+     if(pakSize&gt;(_offset+paddingLen))
+     {
+        skip(pakSize-_offset-paddingLen);
+      }
    }
    currentPacket++;
    return 1;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp	2009-12-01 20:47:34 UTC (rev 5605)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp	2009-12-02 19:02:21 UTC (rev 5606)
@@ -61,7 +61,7 @@
      w=s-&gt;getWidth();
      h=s-&gt;getHeight();
         
-     if(!isMpeg12Compatible(fcc))
+     if(!isMpeg12Compatible(fcc) &amp;&amp; !isH264Compatible(fcc))
      {
             printf(&quot;[ffTS] video not compatible\n&quot;);
             return false;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002814.html">[Avidemux-svn-commit] r5605 -	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries
</A></li>
	<LI>Next message: <A HREF="002816.html">[Avidemux-svn-commit] r5607 - in branches/avidemux_2.6_branch_mean:	avidemux/cli avidemux/cli/ADM_userInterfaces	avidemux/cli/ADM_userInterfaces/ADM_shell	avidemux/common/ADM_script avidemux/gtk	avidemux/gtk/ADM_userInterfaces	avidemux/gtk/ADM_userInterfaces/ADM_shell	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_muxers/muxerffTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2815">[ date ]</a>
              <a href="thread.html#2815">[ thread ]</a>
              <a href="subject.html#2815">[ subject ]</a>
              <a href="author.html#2815">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
