From mean at mail.berlios.de  Wed Aug  1 20:33:48 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 1 Aug 2007 20:33:48 +0200
Subject: [Avidemux-svn-commit] r3466 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:
	. ADM_dialog ADM_ocr
Message-ID: <200708011833.l71IXmv9024987@sheep.berlios.de>

Author: mean
Date: 2007-08-01 20:33:47 +0200 (Wed, 01 Aug 2007)
New Revision: 3466

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
Log:
[QT] More flesh on the OCR QT4 skeleton

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-07-31 19:51:36 UTC (rev 3465)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-01 18:33:47 UTC (rev 3466)
@@ -105,48 +105,7 @@
   return 0; 
 }
 
-// OCR Stubs
-#include "ADM_ocr/ADM_ocr.h"
-#include "ADM_ocr/ADM_ocrInternal.h"
-uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total)
-{
-	return 0;
-}
-uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrDrawFull(void *d,uint8_t *data)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrUiEnd(void *d)
-{
-	return 0;
-}
-;
-void 	*ADM_ocrUiSetup(void)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h)
-{
-	return 0;
-}
-;
 
-ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString)
-{
-	return ReplyOk;
-}
 
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/CMakeLists.txt	2007-07-31 19:51:36 UTC (rev 3465)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/CMakeLists.txt	2007-08-01 18:33:47 UTC (rev 3466)
@@ -2,7 +2,7 @@
 #
 ################################
 include(AdmLib)
-SET(ADM_LIB ADM_ocrQT4)
+SET(ADM_LIB ADM_ocrQt4)
 #
 SET(${ADM_LIB}_Q
 ocr

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Makefile.am (from rev 3458, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-07-29 17:16:06 UTC (rev 3458)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Makefile.am	2007-08-01 18:33:47 UTC (rev 3466)
@@ -0,0 +1,16 @@
+
+noinst_LIBRARIES = libADM_ocrQt4.a 
+libADM_ocrQt4_a_SOURCES = AQ_ocr.cpp 
+
+INCLUDES = $(all_includes)  -I../../../ADM_libraries/ADM_utilities \
+		-I../../ADM_commonUI -I../../.. -I../../../ADM_libraries/ADM_lavutil \
+		-I../../../ADM_inputs -I../../../ADM_outputs @ADM_QTINCLUDES@ ../../../ADM_ocr
+
+libADM_ocrQt4_a_METASOURCES = AUTO
+
+
+include ../Makefile.adm
+
+
+EXTRA_DIST =  
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp (from rev 3458, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp	2007-07-29 17:16:06 UTC (rev 3458)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2007-08-01 18:33:47 UTC (rev 3466)
@@ -0,0 +1,116 @@
+/***************************************************************************
+                          Q_SRT.cpp  -  description
+                             -------------------
+
+    Handle the QT specific part of the fontsize & position dialog box
+    copyright            : (C) 2002/2007 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+
+#include "ui_ocr.h"
+
+#include "default.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_toolkit/filesel.h"
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_colorspace/ADM_rgb.h"
+
+#include "ADM_video/ADM_vobsubinfo.h"
+#include "ADM_video/ADM_vidVobSub.h"
+
+#include "ADM_assert.h"
+#include "ADM_ocr/ADM_ocr.h"
+#include "ADM_ocr/ADM_ocrInternal.h"
+#include "ui_ocr.h"
+
+
+//
+//	Video is in YV12 Colorspace
+//
+//
+class Ui_ocrWindow : public QDialog
+ {
+     Q_OBJECT
+ protected :
+ public:
+     Ui_ocrWindow(void);
+     ~Ui_ocrWindow();
+     Ui_DialogOcr ui;
+     
+     void  gather(void);
+ public slots:
+ private slots:
+ private:
+     
+ };
+  Ui_ocrWindow::Ui_ocrWindow(void)
+  {
+        ui.setupUi(this);
+      
+        
+  }
+ 
+Ui_ocrWindow::~Ui_ocrWindow()
+{
+}
+
+uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total)
+{
+	return 1;
+}
+uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs)
+{
+	return 1;
+}
+uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode)
+{
+	return 1;
+}
+uint8_t ADM_ocrDrawFull(void *d,uint8_t *data)
+{
+	return 1;	
+}
+uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h)
+{
+	return 1;
+}
+
+
+uint8_t ADM_ocrUiEnd(void *d)
+{
+	   Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
+	   ADM_assert(dialog);
+	   delete dialog;
+	   return 1;	
+}
+void 	*ADM_ocrUiSetup(void)
+{
+	
+	   Ui_ocrWindow *dialog=new Ui_ocrWindow;
+	   return dialog;
+}
+
+ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString)
+{
+	return ReplyOk;
+}
+
+//____________________________________
+// EOF
+
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui (from rev 3458, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/vobsub.ui)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/vobsub.ui	2007-07-29 17:16:06 UTC (rev 3458)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui	2007-08-01 18:33:47 UTC (rev 3466)
@@ -0,0 +1,175 @@
+<ui version="4.0" >
+ <class>DialogOcr</class>
+ <widget class="QDialog" name="DialogOcr" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>559</width>
+    <height>474</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Dialog</string>
+  </property>
+  <widget class="QLabel" name="label" >
+   <property name="geometry" >
+    <rect>
+     <x>40</x>
+     <y>20</y>
+     <width>58</width>
+     <height>17</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>Nb Lines :</string>
+   </property>
+  </widget>
+  <widget class="QLabel" name="labelNbLines" >
+   <property name="geometry" >
+    <rect>
+     <x>110</x>
+     <y>20</y>
+     <width>58</width>
+     <height>17</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>0/0</string>
+   </property>
+  </widget>
+  <widget class="QLabel" name="label_2" >
+   <property name="geometry" >
+    <rect>
+     <x>40</x>
+     <y>40</y>
+     <width>58</width>
+     <height>17</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>Timecode:</string>
+   </property>
+  </widget>
+  <widget class="QLabel" name="labelTimecode" >
+   <property name="geometry" >
+    <rect>
+     <x>110</x>
+     <y>40</y>
+     <width>58</width>
+     <height>17</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>00:00:00/000</string>
+   </property>
+  </widget>
+  <widget class="QGraphicsView" name="smallView" >
+   <property name="geometry" >
+    <rect>
+     <x>30</x>
+     <y>130</y>
+     <width>104</width>
+     <height>94</height>
+    </rect>
+   </property>
+  </widget>
+  <widget class="QGraphicsView" name="bigView" >
+   <property name="geometry" >
+    <rect>
+     <x>30</x>
+     <y>220</y>
+     <width>361</width>
+     <height>201</height>
+    </rect>
+   </property>
+  </widget>
+  <widget class="QPushButton" name="pushButtonClose" >
+   <property name="geometry" >
+    <rect>
+     <x>440</x>
+     <y>440</y>
+     <width>83</width>
+     <height>27</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>Close</string>
+   </property>
+  </widget>
+  <widget class="QPushButton" name="pushButton" >
+   <property name="geometry" >
+    <rect>
+     <x>30</x>
+     <y>70</y>
+     <width>83</width>
+     <height>27</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>PushButton</string>
+   </property>
+  </widget>
+  <widget class="QPushButton" name="pushButton_2" >
+   <property name="geometry" >
+    <rect>
+     <x>120</x>
+     <y>70</y>
+     <width>83</width>
+     <height>27</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>PushButton</string>
+   </property>
+  </widget>
+  <widget class="QPushButton" name="pushButton_3" >
+   <property name="geometry" >
+    <rect>
+     <x>210</x>
+     <y>70</y>
+     <width>83</width>
+     <height>27</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>PushButton</string>
+   </property>
+  </widget>
+  <widget class="QPushButton" name="pushButton_4" >
+   <property name="geometry" >
+    <rect>
+     <x>300</x>
+     <y>70</y>
+     <width>83</width>
+     <height>27</height>
+    </rect>
+   </property>
+   <property name="text" >
+    <string>PushButton</string>
+   </property>
+  </widget>
+  <widget class="QLineEdit" name="lineEdit" >
+   <property name="geometry" >
+    <rect>
+     <x>30</x>
+     <y>100</y>
+     <width>113</width>
+     <height>25</height>
+    </rect>
+   </property>
+  </widget>
+  <widget class="QTextEdit" name="textEdit" >
+   <property name="geometry" >
+    <rect>
+     <x>160</x>
+     <y>110</y>
+     <width>104</width>
+     <height>94</height>
+    </rect>
+   </property>
+  </widget>
+ </widget>
+ <resources/>
+ <connections/>
+</ui>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2007-07-31 19:51:36 UTC (rev 3465)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2007-08-01 18:33:47 UTC (rev 3466)
@@ -2,4 +2,5 @@
 subdirs(PREORDER ADM_dialogFactory)
 subdirs(PREORDER ADM_filters)
 subdirs(PREORDER ADM_gui)
+subdirs(PREORDER ADM_ocr)
 include_directories(../ADM_commonUI)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2007-07-31 19:51:36 UTC (rev 3465)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2007-08-01 18:33:47 UTC (rev 3466)
@@ -1,4 +1,4 @@
-SUBDIRS= ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory
+SUBDIRS= ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory ADM_ocr
 #SUBDIRS= ADM_gui  
 
 qclean:



From mean at mail.berlios.de  Wed Aug  1 20:51:31 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 1 Aug 2007 20:51:31 +0200
Subject: [Avidemux-svn-commit] r3467 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200708011851.l71IpV4i026029@sheep.berlios.de>

Author: mean
Date: 2007-08-01 20:51:31 +0200 (Wed, 01 Aug 2007)
New Revision: 3467

Modified:
   branches/avidemux_2.4_branch/avidemux/Makefile.am
Log:
[Automake] Update wrt new ocr layout

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-01 18:33:47 UTC (rev 3466)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-01 18:51:31 UTC (rev 3467)
@@ -33,14 +33,14 @@
 		./ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/libADM_toolkit_gtk.a	 
 		
 user_interface_cli = \
-		./ADM_ocr/libADM_ocr.a	\
+		./ADM_toolkit/libADM_toolkit.a				\
 		./ADM_userInterfaces/ADM_NONE/ADM_gui2/libADM_gui2.a	\
 		./ADM_userInterfaces/ADM_NONE/ADM_dialog/libADM_dialog.a	\
 		./ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/libADM_dialogFactory.a	\
 		./ADM_userInterfaces/ADM_commonUI/libADM_CommonUI.a	\
+		./ADM_ocr/libADM_ocr.a	\
 		./ADM_userInterfaces/ADM_NONE/ADM_gui2/libADM_gui2.a	\
-		./ADM_userInterfaces/ADM_NONE/ADM_filters/libADM_filters.a \ 
-		./ADM_toolkit/libADM_toolkit.a				
+		./ADM_userInterfaces/ADM_NONE/ADM_filters/libADM_filters.a  
 		
 		
 user_interface_qt4 = \



From gruntster at mail.berlios.de  Thu Aug  2 21:57:25 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 2 Aug 2007 21:57:25 +0200
Subject: [Avidemux-svn-commit] r3468 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200708021957.l72JvPkC014655@sheep.berlios.de>

Author: gruntster
Date: 2007-08-02 21:57:16 +0200 (Thu, 02 Aug 2007)
New Revision: 3468

Modified:
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
Log:
[OCR] fix Qt4 CMake build

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-01 18:51:31 UTC (rev 3467)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-02 19:57:16 UTC (rev 3468)
@@ -223,8 +223,8 @@
 if(QT4_FOUND)
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI )
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocr )
+TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocrQt4 )
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogQt4 )
-
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogFactoryQt4 )
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_guiQt4 )
 TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_filtersQt4 )



From gruntster at mail.berlios.de  Fri Aug  3 02:05:11 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 3 Aug 2007 02:05:11 +0200
Subject: [Avidemux-svn-commit] r3469 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex
Message-ID: <200708030005.l7305BQi015671@sheep.berlios.de>

Author: gruntster
Date: 2007-08-03 02:04:40 +0200 (Fri, 03 Aug 2007)
New Revision: 3469

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunitbuffer.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/format_codes.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_types.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_intern.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/main_example.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_out.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ac3strm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm_out.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunit.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/dtsstrm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/lpcmstrm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpastrm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/padstrm.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stream_params.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/systems.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_in.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_out.cpp
Log:
[mplex] update mplex library to 1.8.0 to fix mem leaks

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -39,7 +39,7 @@
 class IFileBitStream : public IBitStream
 {
 public:
-        IFileBitStream( PacketQueue *inQueue, mplexStreamDescriptor *streamDesc, unsigned int buf_size = BUFFER_SIZE);
+        IFileBitStream( PacketQueue *inQueue, unsigned int buf_size = BUFFER_SIZE);
         ~IFileBitStream();
 
 private:

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -160,38 +160,19 @@
         printf("Init ok\n");
         return 1;
 }
-static uint8_t wavToStreamType(WAVHeader *hdr,mplexStreamDescriptor *desc)
-{
-    ADM_assert(hdr);
-    desc->frequency=hdr->frequency;
-    desc->channel=hdr->channels;
-    switch(hdr->encoding)
-    {
-        case WAV_LPCM:  desc->kind= LPCM_AUDIO;break;
-        case WAV_AC3:   desc->kind=  AC3_AUDIO;;break;
-        case WAV_MP2: case WAV_MP3:   desc->kind=  MPEG_AUDIO;;break;
-        case WAV_DTS:    desc->kind=  DTS_AUDIO;;break;
-        default: return 0;
-    }
-  return 1;
-}
+
 extern const char *getStrFromAudioCodec( uint32_t codec);
 int slaveThread( WAVHeader *audioheader )
 {
         MultiplexJob job;
-        mplexStreamDescriptor audioDesc;
-        mplexStreamDescriptor videoDesc;
 
         printf("[Muxer Slave Thread] Creating job & muxer\n");
-
         
         printf("output file created\n");
-        wavToStreamType(audioheader,&audioDesc);
-        audioin=new IFileBitStream(channelaudio,&audioDesc);
+        audioin=new IFileBitStream(channelaudio);
         
         printf("audio done (%s), creating video bitstream\n",getStrFromAudioCodec(audioheader->encoding));
-        videoDesc.kind=MPEG_VIDEO;
-        videoin=new IFileBitStream(channelvideo,&videoDesc);
+        videoin=new IFileBitStream(channelvideo);
         
         printf("Both stream ready\n");
          
@@ -200,14 +181,11 @@
         
         job.mux_format=mux_format;
         job.SetupInputStreams( inputs );
-        
 
-        
         Multiplexor mux(job, *outputStream);
                
         printf("[Muxer Slave Thread] Muxing\n");
         mux.Multiplex();
-		mux.Close();
 
         slaveRunning=0;
         printf("[Muxer Slave Thread] Exiting\n");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -58,9 +58,7 @@
 
 }
 
-IFileBitStream::IFileBitStream(PacketQueue *q,mplexStreamDescriptor *desc,
-                                unsigned int buf_size) :
-    IBitStream(desc)
+IFileBitStream::IFileBitStream(PacketQueue *q, unsigned int buf_size) : IBitStream()
 {
         queue=q;        
         SetBufSize(buf_size);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,17 +1,17 @@
-################################
-#
-################################
-include(AdmLib)
-SET(ADM_LIB ADM_mplex)
-#
-SET(${ADM_LIB}_SRCS 
-ac3strm_in.cpp      ADM_mplexout.cpp   audiostrm_out.cpp  dtsstrm_in.cpp  lpcmstrm_in.cpp   multiplexor.cpp   stream_params.cpp  videostrm_in.cpp   zalphastrm_out.cpp
-ADM_mplexin.cpp     ADM_mthread.cpp    bits.cpp           inputstrm.cpp   padstrm.cpp       systems.cpp        videostrm_out.cpp
-ADM_mplexmuxer.cpp  ADM_transfert.cpp  buffer.cpp         interact.cpp    mpastrm_in.cpp    stillsstream.cpp  vector.cpp         zalphastrm_in.cpp
-mpegconsts.c
-)
-ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
-################################
-include_directories(../ADM_libmpeg2enc  ../../ADM_userInterfaces/)
-
+################################
+#
+################################
+include(AdmLib)
+SET(ADM_LIB ADM_mplex)
+#
+SET(${ADM_LIB}_SRCS 
+ac3strm_in.cpp      ADM_mplexout.cpp   audiostrm_out.cpp  dtsstrm_in.cpp  lpcmstrm_in.cpp   multiplexor.cpp   stream_params.cpp  videostrm_in.cpp
+ADM_mplexin.cpp     ADM_mthread.cpp    bits.cpp           inputstrm.cpp   padstrm.cpp       systems.cpp       videostrm_out.cpp
+ADM_mplexmuxer.cpp  ADM_transfert.cpp  interact.cpp       mpastrm_in.cpp  stillsstream.cpp  mpegconsts.c      mjpeg_logging.c    decodebufmodel.cpp
+yuv4mpeg.c          cpu_accel.c
+)
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
+################################
+include_directories("${CMAKE_CURRENT_SOURCE_DIR}")
+add_definitions(-DHAVE_MEMALIGN)
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ac3strm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ac3strm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ac3strm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -66,6 +66,7 @@
 AC3Stream::AC3Stream(IBitStream &ibs, Multiplexor &into) : 
 	AudioStream( ibs, into )
 {
+num_frames = 0;
 }
 
 bool AC3Stream::Probe(IBitStream &bs )
@@ -220,7 +221,6 @@
                 bs.StreamName()
                 );
 
-	InitAUbuffer();
 	AU_start = bs.bitcount();
     if (bs.GetBits(16)==AC3_SYNCWORD)
     {
@@ -236,10 +236,10 @@
             
         header_skip = 5;        // Initially skipped past  5 bytes of header 
 
-		num_frames++;
+	num_frames++;
         access_unit.start = AU_start;
-		access_unit.length = framesize;
-        mjpeg_info( "AC3 frame size = %d\n", framesize );
+	access_unit.length = framesize;
+        mjpeg_info( "AC3 frame size = %d", framesize );
         bit_rate = ac3_bitrate_index[framesize_code>>1];
 		samples_per_second = ac3_frequency[frequency];
 
@@ -250,7 +250,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		++decoding_order;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 
     } else
     {
@@ -292,7 +292,7 @@
         {
             mjpeg_warn( "Discarding incomplete final frame AC3 stream %d!",
                        stream_num);
-            aunits.droplast();
+            aunits.DropLast();
             --decoding_order;
             break;
         }
@@ -324,7 +324,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		decoding_order++;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 		num_frames++;
 		
 		num_syncword++;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -42,12 +42,10 @@
     unsigned int num_syncword;
 
 protected:
-    virtual bool AUBufferNeedsRefill();
 	virtual void FillAUbuffer(unsigned int frames_to_buffer) = 0;
-	void InitAUbuffer();
     
 	/* State variables for scanning source bit-stream */
-    AAunit access_unit;
+    AUnit access_unit;
     unsigned int header_skip;
 }; 	
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm_out.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm_out.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/audiostrm_out.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -25,7 +25,6 @@
 #include <assert.h>
 
 #include "mjpeg_types.h"
-#include "fastintfns.h"
 #include "audiostrm.hpp"
 #include "multiplexor.hpp"
 
@@ -37,15 +36,8 @@
     FRAME_CHUNK = 24;
 }
 
-void AudioStream::InitAUbuffer()
-{
-	unsigned int i;
-	for( i = 0; i < aunits.BUF_SIZE; ++i )
-		aunits.init( new AAunit );
-}
 
 
-
 /*********************************
  * Signals when audio stream has completed mux run-out specified
  * in associated mux stream. 
@@ -57,15 +49,6 @@
 			( muxinto.running_out && RequiredPTS() >= muxinto.runout_PTS));
 }
 
-bool AudioStream::AUBufferNeedsRefill()
-{
-    return 
-        !eoscan
-        && ( aunits.current()+FRAME_CHUNK > last_buffered_AU
-             || 
-             bs.BufferedBytes() < muxinto.sector_size
-            );
-}
 
 /******************************************************************
 	Output_Audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunit.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunit.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunit.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -7,17 +7,23 @@
 typedef int64_t clockticks;		// This value *must* be signed
                                 // because we frequently compute *offsets*
 
-class Aunit
+class AUnit
 {
 public:
-	Aunit() : length(0), PTS(0), DTS(0) {}
+	AUnit() : length(0), PTS(0), DTS(0) {}
+	//
+	// How many payload bytes muxing AU will require.  Eventually will be more
+	// complex for input streams where AU are no contiguous
+	//
+	inline unsigned int PayloadSize() const { return length; }
 	void markempty() { length = 0; }
 	bitcount_t start;
 	unsigned int length;
     clockticks PTS;
     int        dorder;
-	// Used only for video AU's but otherwise
-	// you have to go crazy on templates.
+	//
+	// Remainder Used only for video AU's... 
+	//
     clockticks DTS;
     int		   porder;
     unsigned int type;
@@ -26,10 +32,5 @@
 
 };
 
-typedef Aunit *AunitPtr;
 
-typedef Aunit VAunit;
-
-typedef Aunit AAunit;
-
 #endif // __AUNIT_H__

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunitbuffer.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunitbuffer.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/aunitbuffer.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,65 @@
+#ifndef __AUNITBUFFER_H__
+#define __AUNITBUFFER_H__
+
+#include <deque>
+#include "mjpeg_logging.h"
+#include "aunit.hpp"
+
+class AUStream
+{
+public:
+	AUStream()  {}
+	~AUStream() 
+	{
+		for( std::deque<AUnit *>::iterator i = buf.begin(); i < buf.end(); ++i )
+			delete *i;
+	}
+	
+	void Append( AUnit &rec )
+	{
+		if( buf.size() >= BUF_SIZE_SANITY )
+			mjpeg_error_exit1( "INTERNAL ERROR: AU buffer overflow" );
+		buf.push_back( new AUnit(rec) );
+	}
+
+	inline AUnit *Next( ) 
+	{ 
+		if( buf.size()==0 )
+		{
+			return 0;
+		}
+	    else
+		{
+			AUnit *res = buf.front();
+			buf.pop_front();
+			return res;
+		}
+	}
+
+	inline void DropLast()
+		{
+			if( buf.empty() )
+				mjpeg_error_exit1( "INTERNAL ERROR: droplast empty AU buffer" );
+			buf.pop_back();
+			
+		}
+
+	inline AUnit *Lookahead( unsigned int n)
+	{
+		return buf.size() <= n ? 0 : buf[n];
+    }
+
+	inline unsigned int MaxAULookahead() const { return buf.size(); }
+
+private:
+	static const unsigned int BUF_SIZE_SANITY = 1000;
+
+
+	
+	std::deque<AUnit *> buf;
+};
+
+
+
+
+#endif // __AUSTREAM_H__

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -6,7 +6,7 @@
 
 typedef uint64_t bitcount_t;
 
-#include "streamType.h"
+
 class BitStreamBuffering
 {
 public:
@@ -120,12 +120,10 @@
 class IBitStream : public IBitStreamUndo 
 {
 public:
-        mplexStreamDescriptor      streamDesc;
- 	IBitStream(mplexStreamDescriptor *desc) :
+ 	IBitStream() :
 		IBitStreamUndo(),
 		streamname( "unnamed" )
 		{
-                    streamDesc=*desc;
 		}
 	virtual ~IBitStream() { Release(); }
 
@@ -154,7 +152,6 @@
 	void Flush( bitcount_t byte_position );
 
 	inline const char *StreamName() { return streamname; }
-
 protected:
 	bool ReadIntoBuffer( unsigned int to_read = BUFFER_SIZE );
 	virtual size_t ReadStreamBytes( uint8_t *buf, size_t number ) = 0;

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,124 +0,0 @@
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "buffer.hpp"
-#include <stdlib.h>
-
-/******************************************************************
- *	Remove entries from FIFO buffer list, if their DTS is less than
- *	actual SCR. These packet data have been already decoded and have
- *	been removed from the system target decoder's elementary stream
- *	buffer.
- *****************************************************************/
-
-void BufferModel::Cleaned(clockticks SCR)
-{
-    BufferQueue *pointer;
-
-    while ((first != NULL) && first->DTS < SCR)
-    {
-	  pointer = first;
-	  first = first->next;
-	  delete pointer;	
-    }
-}
-
-/******************************************************************
- * Return the SCR when there will next be some change in the
- * buffer.
- * If the buffer is empty return a zero timestamp.
- *****************************************************************/
-
-clockticks BufferModel::NextChange()
-{
-	if( first == NULL )
-		return static_cast<clockticks>(0);
-	else
-		return first->DTS;
-}
-
-
-/******************************************************************
- *
- *	Remove all entries from FIFO buffer list, if their DTS is less
- *	than actual SCR. These packet data have been already decoded and
- *	have been removed from the system target decoder's elementary
- *	stream buffer.
- *****************************************************************/
-
-void BufferModel::Flushed ()
-{
-    BufferQueue *pointer;
-
-    while (first != NULL)
-    {
-	  pointer = first;
-	  first = first->next;
-	  delete pointer;	
-    }
-}
-
-/******************************************************************
-	BufferModel::Space
-
-	returns free space in the buffer
-******************************************************************/
-
-unsigned int BufferModel::Space ()
-{
-    unsigned int used_bytes;
-    BufferQueue *pointer;
-
-    pointer=first;
-    used_bytes=0;
-
-    while (pointer != NULL)
-    {
-		used_bytes += pointer->size;
-		pointer = pointer->next;
-    }
-
-    return (max_size - used_bytes);
-
-}
-
-/******************************************************************
-	Queue_Buffer
-
-	adds entry into the buffer FIFO queue
-******************************************************************/
-
-void BufferModel::Queued (unsigned int bytes,
-					clockticks TS)
-{
-    BufferQueue *pointer;
-
-    pointer=first;
-    if (pointer==NULL)
-    {
-		first = new BufferQueue;
-		first->size = bytes;
-		first->next=NULL;
-		first->DTS = TS;
-    } 
-	else
-    {
-		while ((pointer->next)!=NULL)
-		{
-			pointer = pointer->next;
-		}
-
-		pointer->next = new BufferQueue;
-		pointer->next->size = bytes;
-		pointer->next->next = NULL;
-		pointer->next->DTS = TS;
-    }
-}
-
-
-void BufferModel::Init ( unsigned int size)
-{
-    max_size = size;
-    first = 0;
-}

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/buffer.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,65 +0,0 @@
-
-/*
- *  buffer.hpp:  Classes for decoder buffer models for mux despatch
- *
- *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
- *
- *
- *  This program is free software; you can redistribute it and/or
- *  modify it under the terms of version 2 of the GNU General Public License
- *  as published by the Free Software Foundation.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
- */
-
-
-#ifndef __BUFFER_H__
-#define __BUFFER_H__
-
-#include "aunit.hpp"
-
-class BufferQueue
-{
-public:
-	unsigned int size	;	/* als verkettete Liste implementiert	*/
-    clockticks DTS	;
-    BufferQueue *next	;
-};
-    
-
-class BufferModel
-{
-public:
-  BufferModel() : max_size(0),first(0) {}
-  void Init( unsigned int size);
-  
-  void Cleaned(  clockticks timenow);
-  clockticks NextChange();
-  void Flushed( );
-  unsigned int Space();
-  void Queued( unsigned int bytes, clockticks removaltime);
-  inline unsigned int Size() { return max_size; }
-private:
-  unsigned int max_size;
-  BufferQueue *first;
-};
-
-
-
-#endif // __BUFFER_H__
-
-
-/* 
- * Local variables:
- *  c-file-style: "gnu"
- *  tab-width: 4
- *  indent-tabs-mode: nil
- * End:
- */

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.c	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,447 @@
+/*
+* cpu_accel.c
+* Copyright (C) 1999-2000 Aaron Holtzman <aholtzma at ess.engr.uvic.ca>
+*
+* This file is part of mpeg2dec, a free MPEG-2 video stream decoder.
+*
+* mpeg2dec is free software; you can redistribute it and/or modify
+* it under the terms of the GNU General Public License as published by
+* the Free Software Foundation; either version 2 of the License, or
+* (at your option) any later version.
+*
+* mpeg2dec is distributed in the hope that it will be useful,
+* but WITHOUT ANY WARRANTY; without even the implied warranty of
+* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+* GNU General Public License for more details.
+*
+* You should have received a copy of the GNU General Public License
+* along with this program; if not, write to the Free Software
+* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <config.h>
+#include <stdio.h>
+#include <signal.h>
+#include <setjmp.h>
+#include <stdlib.h>
+#ifdef	HAVE_MALLOC_H
+#include <malloc.h>
+#endif
+#include <unistd.h>
+#include <string.h>
+#include <errno.h>
+#include "cpu_accel.h"
+#include "mjpeg_logging.h"
+
+#ifdef HAVE_ALTIVEC
+extern int altivec_copy_v0();
+#endif
+
+/*
+ * Don't add "mblocks_sub44_mests" to the list below because it does not
+ * have a C-reference code counterpart (mblocks_sub44_mests only exists as
+ * a SIMD routine).
+*/
+
+	const char *disable_simd_flags[] = {
+		"sad_00",
+		"sad_01",
+		"sad_10",
+		"sad_11",
+		"sad_sub22",
+		"sad_sub44",
+		"bsad",
+		"variance",
+		"sumsq",
+		"sumsq_sub22",
+		"bsumsq_sub22",
+		"bsumsq",
+		"build_sub22_mests",
+		"build_sub44_mests",
+		"subsample_image",
+		"find_best_one_pel",
+		"quant_nonintra",
+		"quant_weight_intra",
+		"quant_weight_nonintra",
+		"iquant_intra",
+		"iquant_nonintra",
+		NULL
+		};
+
+static char *parse_next(char **, const char *);
+
+#ifdef HAVE_X86CPU 
+
+/* Some miscelaneous stuff to allow checking whether SSE instructions cause
+   illegal instruction errors.
+*/
+
+static sigjmp_buf sigill_recover;
+
+static RETSIGTYPE sigillhandler(int sig )
+{
+	siglongjmp( sigill_recover, 1 );
+}
+
+typedef RETSIGTYPE (*__sig_t)(int);
+
+static int testsseill()
+{
+	int illegal;
+#if defined(__CYGWIN__)
+	/* SSE causes a crash on CYGWIN, apparently.
+	   Perhaps the wrong signal is being caught or something along
+	   those line ;-) or maybe SSE itself won't work...
+	*/
+	illegal = 1;
+#else
+	__sig_t old_handler = signal( SIGILL, sigillhandler);
+	if( sigsetjmp( sigill_recover, 1 ) == 0 )
+	{
+		asm ( "movups %xmm0, %xmm0" );
+		illegal = 0;
+	}
+	else
+		illegal = 1;
+	signal( SIGILL, old_handler );
+#endif
+	return illegal;
+}
+
+static int x86_accel (void)
+{
+    long eax, ebx, ecx, edx;
+    int32_t AMD;
+    int32_t caps;
+
+	/* Slightly weirdified cpuid that preserves the ebx and edi required
+	   by gcc for PIC offset table and frame pointer */
+
+#ifdef __LP64__
+#  define REG_b "rbx"
+#  define REG_S "rsi"
+#else
+#  define REG_b "ebx"
+#  define REG_S "esi"
+#endif
+	   
+#define cpuid(op,eax,ebx,ecx,edx)	\
+    asm ( "push %%"REG_b"\n" \
+	      "cpuid\n" \
+	      "mov   %%"REG_b", %%"REG_S"\n" \
+	      "pop   %%"REG_b"\n"  \
+	 : "=a" (eax),			\
+	   "=S" (ebx),			\
+	   "=c" (ecx),			\
+	   "=d" (edx)			\
+	 : "a" (op)			\
+	 : "cc", "edi")
+
+    asm ("pushf\n\t"
+	 "pop %0\n\t"
+	 "mov %0,%1\n\t"
+	 "xor $0x200000,%0\n\t"
+	 "push %0\n\t"
+	 "popf\n\t"
+	 "pushf\n\t"
+	 "pop %0"
+         : "=a" (eax),
+	       "=c" (ecx)
+	 :
+	 : "cc");
+
+
+    if (eax == ecx)		// no cpuid
+	return 0;
+
+    cpuid (0x00000000, eax, ebx, ecx, edx);
+    if (!eax)			// vendor string only
+	return 0;
+
+    AMD = (ebx == 0x68747541) && (ecx == 0x444d4163) && (edx == 0x69746e65);
+
+    cpuid (0x00000001, eax, ebx, ecx, edx);
+    if (! (edx & 0x00800000))	// no MMX
+	return 0;
+
+    caps = ACCEL_X86_MMX;
+    /* If SSE capable CPU has same MMX extensions as AMD
+	   and then some. However, to use SSE O.S. must have signalled
+	   it use of FXSAVE/FXRSTOR through CR4.OSFXSR and hence FXSR (bit 24)
+	   here
+	*/
+    if ((edx & 0x02000000))	
+		caps = ACCEL_X86_MMX | ACCEL_X86_MMXEXT;
+	if( (edx & 0x03000000) == 0x03000000 )
+	{
+		/* Check whether O.S. has SSE support... has to be done with
+		   exception 'cos those Intel morons put the relevant bit
+		   in a reg that is only accesible in ring 0... doh! 
+		*/
+		if( !testsseill() )
+			caps |= ACCEL_X86_SSE;
+	}
+
+    cpuid (0x80000000, eax, ebx, ecx, edx);
+    if (eax < 0x80000001)	// no extended capabilities
+		return caps;
+
+    cpuid (0x80000001, eax, ebx, ecx, edx);
+
+    if (edx & 0x80000000)
+	caps |= ACCEL_X86_3DNOW;
+
+    if (AMD && (edx & 0x00400000))	// AMD MMX extensions
+	{
+		caps |= ACCEL_X86_MMXEXT;
+	}
+
+    return caps;
+}
+#endif
+
+
+#ifdef HAVE_ALTIVEC
+/* AltiVec optimized library for MJPEG tools MPEG-1/2 Video Encoder
+ * Copyright (C) 2002  James Klicman <james at klicman.org>
+ *
+ * The altivec_detect() function has been moved here to workaround a bug in a
+ * released version of GCC (3.3.3). When -maltivec and -mabi=altivec are
+ * specified, the bug causes VRSAVE instructions at the beginning and end of
+ * functions which do not use AltiVec. GCC 3.3.3 also lacks support for
+ * '#pragma altivec_vrsave off' which would have been the preferred workaround.
+ *
+ * This AltiVec detection code relies on the operating system to provide an
+ * illegal instruction signal if AltiVec is not present. It is known to work
+ * on Mac OS X and Linux.
+ */
+
+static sigjmp_buf jmpbuf;
+
+static void sig_ill(int sig)
+{
+    siglongjmp(jmpbuf, 1);
+}
+
+int detect_altivec()
+{
+    volatile int detected = 0; /* volatile (modified after sigsetjmp) */
+    struct sigaction act, oact;
+
+    act.sa_handler = sig_ill;
+    sigemptyset(&act.sa_mask);
+    act.sa_flags = 0;
+
+    if (sigaction(SIGILL, &act, &oact)) {
+	perror("sigaction");
+	return 0;
+    }
+
+    if (sigsetjmp(jmpbuf, 1))
+	goto noAltiVec;
+
+    /* try to read an AltiVec register */ 
+    altivec_copy_v0();
+
+    detected = 1;
+
+noAltiVec:
+    if (sigaction(SIGILL, &oact, (struct sigaction *)0))
+	perror("sigaction");
+
+    return detected;
+}
+#endif
+
+
+int32_t cpu_accel (void)
+{
+#ifdef HAVE_X86CPU 
+    static int got_accel = 0;
+    static int accel;
+
+    if (!got_accel) {
+		got_accel = 1;
+		accel = x86_accel ();
+    }
+
+    return accel;
+#elif defined(HAVE_ALTIVEC)
+    return detect_altivec();
+#else
+    return 0;
+#endif
+}
+
+/*****************************
+ *
+ * Allocate memory aligned to suit SIMD 
+ *
+ ****************************/
+
+#define powerof2(x)     ((((x)-1)&(x))==0)
+
+#if	!defined(HAVE_POSIX_MEMALIGN)
+
+int
+posix_memalign(void **ptr, size_t alignment, size_t size)
+{
+	void *mem;
+
+	if	(alignment % sizeof (void *) != 0 || !powerof2(alignment) != 0)
+		return(EINVAL);
+	mem = malloc((size + alignment - 1) & ~(alignment - 1));
+	if	(mem != NULL)
+	{
+		*ptr = mem;
+		return(0);
+	}
+	return(ENOMEM);
+}
+#endif
+
+#if	!defined(HAVE_MEMALIGN)
+void *
+memalign(size_t alignment, size_t size)
+{
+
+	if 	(alignment % sizeof (void *) || !powerof2(alignment))
+	{
+		errno = EINVAL;
+		return(NULL);
+	}
+	return(malloc((size + alignment - 1) & ~(alignment - 1)));
+}
+#endif
+
+/***********************
+ * Implement fmax() for systems which do not have it.  Not a strictly
+ * conforming implementation - we don't bother checking for NaN which if
+ * mpeg2enc gets means big trouble I suspect ;)
+************************/
+
+#if	!defined(HAVE_FMAX)
+double
+fmax(double x, double y)
+{
+	if	(x > y)
+		return(x);
+	return(y);
+}
+#endif
+
+void *bufalloc( size_t size )
+{
+	static size_t simd_alignment = 16;
+	static int bufalloc_init = 0;
+	int  pgsize;
+	void *buf = NULL;
+
+	if( !bufalloc_init )
+	{
+#ifdef HAVE_X86CPU 
+		if( (cpu_accel() &  (ACCEL_X86_SSE|ACCEL_X86_3DNOW)) != 0 )
+		{
+			simd_alignment = 64;
+			bufalloc_init = 1;
+		}
+#endif		
+	}
+		
+#ifdef ADM_WIN32	// GRUNTSTER
+	pgsize = 4096;
+#else
+	pgsize = sysconf(_SC_PAGESIZE);
+#endif
+
+/*
+ * If posix_memalign fails it could be a broken glibc that caused the error,
+ * so try again with a page aligned memalign request
+*/
+	if (posix_memalign( &buf, simd_alignment, size))
+		buf = memalign(pgsize, size);
+	if (buf && ((size_t)buf & (simd_alignment - 1)))
+	{
+		free(buf);
+		buf = memalign(pgsize, size);
+	}
+	if (buf == NULL)
+		mjpeg_error_exit1("malloc of %d bytes failed", (int)size);
+	if ((size_t)buf & (simd_alignment - 1))
+		mjpeg_error_exit1("could not allocate %d bytes aligned on a %d byte boundary", (int)size, (int)simd_alignment);
+	return buf;
+}
+
+int
+disable_simd(char *name)
+	{
+	int	foundit;
+	char	*cp, *simd_env, *dup_backup;
+	const char **dft;
+
+	if	((cp = getenv("MJPEGTOOLS_SIMD_DISABLE")) == NULL)
+		return(0);
+
+/*
+ * Special case for "all" so that all 22 or whatever names don't have to be
+ * explicitly specified.  If "all" is seen as the only name in the environment
+ * variable then always return 1.
+*/
+	if	(strcasecmp(cp, "all") == 0)
+		return(1);
+
+/*
+ * First check that the routine being tested for disabled status exists in
+ * the list of known functions.
+*/
+	foundit = 0;
+	for	(dft = disable_simd_flags; *dft; dft++)
+		{
+		if	(strcasecmp(name, *dft) == 0)
+			{
+			foundit = 1;
+			break;
+			}
+		}
+	if	(foundit == 0)
+		return(0);
+
+/*
+ * Next compare the function name passed as input to the comma separated
+ * names in the environment variable.  If a match is found then return 1
+*/
+	dup_backup = simd_env = strdup(cp);
+	while	((cp = parse_next(&simd_env, ",")))
+		{
+		foundit = 0;
+		if	(strcasecmp(cp, name) == 0)
+			{
+			foundit = 1;
+			break;
+			}
+		}
+	free(dup_backup);
+	return(foundit);
+	}
+
+static char *parse_next(char **sptr, const char *delim)
+{
+	char *start, *ret;
+	start = ret = *sptr;
+	if ((ret == NULL) || ret == '\0') {
+	   return (NULL);
+	}
+
+	while (*ret != '\0' &&
+		   strchr(delim, *ret) == NULL) {
+		ret++;
+	}
+	if (*ret == '\0') {
+		*sptr = NULL;
+	} else {
+	    *ret = '\0';
+	    ret++;
+	    *sptr = ret;
+	}
+	return (start);
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/cpu_accel.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,58 @@
+/*
+ * cpu_accel.h
+ * Copyright (C) 1999-2000 Aaron Holtzman <aholtzma at ess.engr.uvic.ca>
+ *
+ * This file was part of mpeg2dec, a free MPEG-2 video stream decoder.
+ *
+ * mpeg2dec is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * mpeg2dec is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef _CPU_ACCEL_HH
+#define _CPU_ACCEL_HH
+
+#include <stdlib.h>
+#include "mjpeg_types.h"
+
+
+// x86 accelerations
+#define ACCEL_X86_MMX	0x80000000
+#define ACCEL_X86_3DNOW	0x40000000
+#define ACCEL_X86_MMXEXT 0x20000000
+#define ACCEL_X86_SSE   0x10000000
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+	int32_t cpu_accel (void);
+	void *bufalloc( size_t size );
+#if	!defined(HAVE_POSIX_MEMALIGN)
+	int posix_memalign(void **, size_t, size_t);
+#endif
+#if	!defined(HAVE_MEMALIGN)
+	void *memalign(size_t, size_t);
+#endif
+#if	!defined(HAVE_FMAX)
+	double fmax(double, double);
+#endif
+
+extern const char *disable_simd_flags[];
+extern int disable_simd(char *);
+
+#ifdef __cplusplus
+}
+#endif
+
+
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,83 @@
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "decodebufmodel.hpp"
+#include <stdlib.h>
+
+using std::deque;
+
+/******************************************************************
+ *	Remove entries from FIFO buffer list, if their DTS is less than
+ *	actual SCR. These packet data have been already decoded and have
+ *	been removed from the system target decoder's elementary stream
+ *	buffer.
+ *****************************************************************/
+
+void DecodeBufModel::Cleaned(clockticks SCR)
+{
+    while ( bufstate.size() != 0 && bufstate.front().DTS < SCR)
+    {
+		bufstate.pop_front();
+    }
+}
+
+/******************************************************************
+ * Return the SCR when there will next be some change in the
+ * buffer.
+ * If the buffer is empty return a zero timestamp.
+ *****************************************************************/
+
+clockticks DecodeBufModel::NextChange()
+{
+	if( bufstate.size() == 0 )
+		return static_cast<clockticks>(0);
+	else
+		return bufstate.front().DTS;
+}
+
+
+/******************************************************************
+ *
+ *	Remove all entries from FIFO buffer list.
+ *
+ *****************************************************************/
+
+void DecodeBufModel::Flushed ()
+{
+	bufstate.clear();
+}
+
+/******************************************************************
+	DecodeBufModel::Space
+
+	returns free space in the buffer
+******************************************************************/
+
+unsigned int DecodeBufModel::Space ()
+{
+	unsigned int used_bytes = 0;
+	for( std::deque<DecodeBufEntry>::iterator i = bufstate.begin(); 
+		 i < bufstate.end();
+		 ++i )
+	{
+		used_bytes += i->size;
+    }
+
+    return (buffer_size - used_bytes);
+
+}
+
+/******************************************************************
+	Queue_Buffer
+
+	adds entry into the buffer FIFO queue
+******************************************************************/
+
+void DecodeBufModel::Queued (unsigned int bytes, clockticks TS)
+{
+	DecodeBufEntry entry;
+	entry.size = bytes;
+	entry.DTS = TS;
+	bufstate.push_back( entry );
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/decodebufmodel.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,68 @@
+
+/*
+ *  buffer.hpp:  Classes for decoder buffer models for mux despatch
+ *
+ *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of version 2 of the GNU General Public License
+ *  as published by the Free Software Foundation.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ */
+
+
+#ifndef __DECODEBUFMODEL_H__
+#define __DECODEBUFMODEL_H__
+
+#include "aunit.hpp"
+#include <deque>
+
+
+struct DecodeBufEntry
+{
+	unsigned int size	;	/* als verkettete Liste implementiert	*/
+    clockticks DTS	;
+};
+    
+
+class DecodeBufModel
+{
+public:
+  DecodeBufModel() : buffer_size(0) {}
+  void Init ( unsigned int size)
+  {
+    buffer_size = size;
+  }
+  
+  void Cleaned(  clockticks timenow);
+  clockticks NextChange();
+  void Flushed( );
+  unsigned int Space();
+  void Queued( unsigned int bytes, clockticks removaltime);
+  inline unsigned int Size() { return buffer_size; }
+private:
+  unsigned int buffer_size;
+  std::deque<DecodeBufEntry> bufstate ;
+};
+
+
+
+#endif // __DECODEBUFMODEL_H__
+
+
+/* 
+ * Local variables:
+ *  c-file-style: "gnu"
+ *  tab-width: 4
+ *  indent-tabs-mode: nil
+ * End:
+ */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/dtsstrm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/dtsstrm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/dtsstrm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -51,6 +51,7 @@
 DTSStream::DTSStream(IBitStream &ibs, Multiplexor &into) : 
 	AudioStream( ibs, into )
 {
+	num_frames = 0;
 }
 
 bool DTSStream::Probe(IBitStream &bs )
@@ -136,7 +137,6 @@
                 bs.StreamName()
                 );
 
-	InitAUbuffer();
 	AU_start = bs.bitcount();
     if (bs.GetBits(32)==DTS_SYNCWORD)
     {
@@ -156,7 +156,7 @@
 		num_frames++;
         access_unit.start = AU_start;
 		access_unit.length = framesize;
-        mjpeg_info( "dts frame size = %d\n", framesize );
+        mjpeg_info( "dts frame size = %d", framesize );
 		samples_per_second = dts_frequency[frequency];
 
 		/* Presentation time-stamping  */
@@ -166,7 +166,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		++decoding_order;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 
     } else
     {
@@ -204,7 +204,7 @@
         {
             mjpeg_warn( "Discarding incomplete final frame dts stream %d!",
                        stream_num);
-            aunits.droplast();
+            aunits.DropLast();
             decoding_order--;
             break;
         }
@@ -238,7 +238,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		decoding_order++;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 		num_frames++;
 
 		num_syncword++;

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/format_codes.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/format_codes.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/format_codes.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,39 @@
+/*
+    $Id: format_codes.h,v 1.9 2002/12/17 21:54:24 wackston2 Exp $
+
+    Copyright (C) 2001 Andrew Stevens <andrew.stevens at planet-interkom.de>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#ifndef __FORMAT_CODES_H__
+#define __FORMAT_CODES_H__
+
+#define MPEG_FORMAT_MPEG1   0
+#define MPEG_FORMAT_VCD     1
+#define MPEG_FORMAT_VCD_NSR 2
+#define MPEG_FORMAT_MPEG2   3
+#define MPEG_FORMAT_SVCD     4
+#define MPEG_FORMAT_SVCD_NSR 5
+#define MPEG_FORMAT_VCD_STILL 6
+#define MPEG_FORMAT_SVCD_STILL 7
+#define MPEG_FORMAT_DVD_NAV 8
+#define MPEG_FORMAT_DVD      9
+
+#define MPEG_FORMAT_FIRST 0
+#define MPEG_FORMAT_LAST MPEG_FORMAT_DVD
+
+#define MPEG_STILLS_FORMAT(x) (x==MPEG_FORMAT_VCD_STILL||x==MPEG_FORMAT_SVCD_STILL)
+#endif /* __FORMAT_CODES_H__ */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -22,11 +22,9 @@
 
 
 #include <config.h>
-#include <limits.h>
 #include <assert.h>
 
 #include "mjpeg_types.h"
-#include "fastintfns.h"
 #include "inputstrm.hpp"
 #include "multiplexor.hpp"
 
@@ -34,14 +32,12 @@
 {
 }
 
-
 void MuxStream::Init( const int strm_id, 
-					  const unsigned int _buf_scale,
-					  const unsigned int buf_size,
-					  const unsigned int _zero_stuffing,
-					  bool bufs_in_first, 
-					  bool always_bufs
-	) 
+			const unsigned int _buf_scale,
+			const unsigned int buf_size,
+			const unsigned int _zero_stuffing,
+			bool bufs_in_first, 
+			bool always_bufs) 
 {
 	stream_id = strm_id;
 	nsec = 0;
@@ -57,7 +53,6 @@
 }
 
 
-
 unsigned int 
 MuxStream::BufferSizeCode()
 {
@@ -71,11 +66,10 @@
 }
 
 
-
 ElementaryStream::ElementaryStream( IBitStream &ibs,
-                                    Multiplexor &into, 
-									stream_kind _kind) : 
+                                    Multiplexor &into, stream_kind _kind) : 
     InputStream( ibs ),
+    au(0),
 	muxinto( into ),
 	kind(_kind),
     buffer_min(INT_MAX),
@@ -83,11 +77,43 @@
 {
 }
 
+/***********************************
+ *
+ * Scan ahead to buffer enough info on the coming Access Units to
+ * permit look-ahead of look_ahead/processing AUs forward from the
+ * current AU *and* the muxing of at least one sector.
+ *
+ **********************************/
 
+void 
+ElementaryStream::AUBufferLookaheadFill( unsigned int look_ahead)
+{
+    while( !eoscan &&
+           ( look_ahead+1 > aunits.MaxAULookahead() 
+             || bs.BufferedBytes() < muxinto.sector_size ) )
+    {
+        FillAUbuffer(FRAME_CHUNK);
+    }
+}
+
+/******************************************
+ *
+ * Move on to the next Access unit in the Elementary stream
+ *
+ *****************************************/
+
 bool 
 ElementaryStream::NextAU()
 {
-	Aunit *p_au = next();
+    // Free up no longer needed AU record
+    if( au != 0 )
+        delete au;
+
+    // Ensure we have enough in the AU buffer!
+    AUBufferLookaheadFill(1);
+
+    // Get the details of the next AU to be muxed....
+	AUnit *p_au = aunits.Next();
 	if( p_au != NULL )
 	{
 		au = p_au;
@@ -102,10 +128,11 @@
 }
 
 
-Aunit *
-ElementaryStream::Lookahead( )
+AUnit *
+ElementaryStream::Lookahead( unsigned int n)
 {
-    return aunits.lookahead();
+    AUBufferLookaheadFill(n);
+    return aunits.Lookahead( n );
 }
 
 unsigned int 
@@ -134,20 +161,21 @@
  ******************************************************************/
 
 
-
 unsigned int 
 ElementaryStream::ReadPacketPayload(uint8_t *dst, unsigned int to_read)
 {
+    //
+    // Allow for the possibility that stream sub-headers might be needed
+    // E.g. AC3, LPCM, DTS....
+    unsigned int header_size = StreamHeaderSize();
     bitcount_t read_start = bs.GetBytePos();
-    unsigned int actually_read = bs.GetBytes( dst, to_read );
+    unsigned int actually_read = bs.GetBytes( dst+header_size, to_read-header_size );
     bs.Flush( read_start );
     Muxed( actually_read );
+    ReadStreamHeader(dst, header_size);
 	return actually_read;
 }
 
-
-
-
 void ElementaryStream::Muxed (unsigned int bytes_muxed)
 {
 	clockticks   decode_time;
@@ -170,12 +198,13 @@
 	decode_time = RequiredDTS();
 	while (au_unsent < bytes_muxed)
 	{	  
-
+        AUMuxed(true);          // Update stream specific tracking 
+                                // of AUs muxed...
 		bufmodel.Queued(au_unsent, decode_time);
 		bytes_muxed -= au_unsent;
-		if( !NextAU() )
+        new_au_next_sec = NextAU();
+        if( !new_au_next_sec )
 			return;
-		new_au_next_sec = true;
 		decode_time = RequiredDTS();
 	};
 
@@ -187,17 +216,16 @@
 	
 	if (au_unsent > bytes_muxed)
 	{
-
+        AUMuxed(false);
 		bufmodel.Queued( bytes_muxed, decode_time);
 		au_unsent -= bytes_muxed;
 		new_au_next_sec = false;
 	} 
 	else //  if (au_unsent == bytes_muxed)
 	{
+        AUMuxed(false);
 		bufmodel.Queued(bytes_muxed, decode_time);
-		if( ! NextAU() )
-			return;
-		new_au_next_sec = true;
+		new_au_next_sec = NextAU();
 	}	   
 
 }
@@ -208,7 +236,6 @@
 			bufmodel.Space() > max_packet_data);
 }
 
-
 void ElementaryStream::UpdateBufferMinMax()
 {
     buffer_min =  buffer_min < bufmodel.Space() ? 
@@ -218,7 +245,6 @@
 }
 
 
-
 void ElementaryStream::AllDemuxed()
 {
 	bufmodel.Flushed();
@@ -240,41 +266,12 @@
 	timestamp_delay = sync_offset;
 }
 
-Aunit *ElementaryStream::next()
-{
-    Aunit *res;
-    while( AUBufferNeedsRefill() )
-	{
-        FillAUbuffer(FRAME_CHUNK);
-	}
-    res = aunits.next();
-	return res;
-}
-
-
-
-//
-// TODO: The buffer refilling is a mess.  We not only refull here but
-// TODO: also refill in next().  However, neither is *guaranteed* to put
-// TODO: enough data in the buffer.  What we need to ensure is that we have
-// TODO: read enough input stream into the buffer to guarantee a sectors
-// TODO: worth of payload.  A reasonable approximation would be simply to
-// TODO: try to read-ahead 2* the sector size. However, this will break for
-// TODO: streams which have big inclusions.  One example might be direct AVI
-// TODO: reading of mixed streams or reading of program streams.
-//
-
-
 void ElementaryStream::BufferAndOutputSector( )
 {
-    while( AUBufferNeedsRefill() )
-	{
-        FillAUbuffer(FRAME_CHUNK);
-	}
+    AUBufferLookaheadFill(1);   // TODO is this really needed here?
     OutputSector();
 }
 
-
 
 /* 
  * Local variables:

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/inputstrm.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -33,9 +33,8 @@
 
 #include "mplexconsts.hpp"
 #include "bits.hpp"
-#include "aunit.hpp"
-#include "vector.hpp"
-#include "buffer.hpp"
+#include "aunitbuffer.hpp"
+#include "decodebufmodel.hpp"
 
 using std::vector;
 
@@ -72,10 +71,6 @@
 
 };
 
-//
-// Abstract forward reference...
-//
-
 class Multiplexor;
 
 
@@ -126,7 +121,7 @@
 	int        stream_id;
 	unsigned int    buffer_scale;
 	unsigned int 	buffer_size;
-	BufferModel bufmodel;
+	DecodeBufModel  bufmodel;
 	unsigned int 	max_packet_data;
 	unsigned int	min_packet_data;
 	unsigned int    zero_stuffing;
@@ -171,7 +166,7 @@
 	virtual void Close() = 0;
 
 	bool NextAU();
-	Aunit *Lookahead();
+	AUnit *Lookahead( unsigned int n = 0);
 	unsigned int BytesToMuxAUEnd(unsigned int sector_transport_size);
 	bool MuxCompleted();
 	virtual bool MuxPossible(clockticks currentSCR );
@@ -183,22 +178,30 @@
     inline unsigned int BufferMax() { return buffer_max; }
     inline clockticks BaseDTS() { return au->DTS; };
     inline clockticks BasePTS() { return au->PTS; };
-    inline clockticks RequiredDTS() { return au->DTS + timestamp_delay; };
-    inline clockticks RequiredPTS() { return au->PTS + timestamp_delay; };
+
     inline int        DecodeOrder() { return au->dorder; }
+
+    inline clockticks RequiredDTS( const AUnit *unit )  
+        { return unit->DTS + timestamp_delay; };
+    inline clockticks RequiredPTS( const AUnit *unit ) 
+        { return unit->PTS + timestamp_delay; };
+    inline clockticks RequiredDTS()  
+        { return RequiredDTS(au); };
+    inline clockticks RequiredPTS() 
+        { return  RequiredPTS(au); };
     inline clockticks NextRequiredDTS()
         { 
-            Aunit *next = Lookahead();
+            AUnit *next = Lookahead();
             if( next != 0 )
-                return next->DTS + timestamp_delay; 
+                return RequiredDTS(next); 
             else
                 return 0;
         };
     inline clockticks NextRequiredPTS()
         { 
-            Aunit *next = Lookahead();
+            AUnit *next = Lookahead();
             if( next != 0 )
-                return next->PTS + timestamp_delay; 
+                return RequiredPTS(next); 
             else
                 return 0;
         };
@@ -213,21 +216,53 @@
 	virtual unsigned int NominalBitRate() = 0;
 	virtual bool RunOutComplete() = 0;
 
+
+    /******************************************************************
+     *  Reads the stream data from actual input stream, updates decode
+     *  buffer model and current access unit information from the
+     *  look-ahead scanning buffer to account for bytes_muxed bytes being
+     *  muxed out.  
+     * TODO: No longer needs to be virtual
+     *
+     ******************************************************************/
 	virtual unsigned int ReadPacketPayload(uint8_t *dst, unsigned int to_read);
 
+    /********************************************************************
+     * Update stream-specific mux state information to reflect muxing of
+     * current AU.  first_in_sector is set true if AU is first muxed into
+     * the current sector.
+     *
+     *******************************************************************/
+
+    virtual void AUMuxed( bool first_in_sector ) {}
+
+    /**************************************************************
+     * The size of the stream-specific  sub-header (if any)
+     *************************************************************/
+    virtual unsigned int StreamHeaderSize() { return 0; }
+    
+    /*****************************************************************
+     * Reads/generates the stream-specific sub-header for AUs muxed
+     * since last call AUMuxed( true );
+     ****************************************************************/
+
+    virtual void ReadStreamHeader( uint8_t *dst, unsigned int len ) {}
+
     bitcount_t bytes_read;
-protected:
+private:
+    void AUBufferLookaheadFill( unsigned int look_ahead);
+
+//protected:
+public:
 	virtual void FillAUbuffer(unsigned int frames_to_buffer) = 0;
-	virtual void InitAUbuffer() = 0;
-    virtual bool AUBufferNeedsRefill() = 0;
     virtual void OutputSector() = 0;
 	AUStream aunits;
 	void Muxed( unsigned int bytes_muxed );
-	Aunit *au;
+	AUnit *au;
 	clockticks timestamp_delay;
 
 	unsigned int au_unsent;
-	Aunit *next();
+	AUnit *OLDnext();
 	Multiplexor &muxinto;
 	stream_kind kind;
     unsigned int buffer_min;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -23,13 +23,7 @@
 #include <config.h>
 #include <stdlib.h>
 #include <ctype.h>
-#if 0
-#ifdef _WIN32
-#include <win32defs.h>
-#else
 #include <unistd.h>
-#endif
-#endif
 #include <sys/stat.h>
 #include <mjpeg_logging.h>
 #include <format_codes.h>
@@ -43,7 +37,6 @@
 #include "mplexconsts.hpp"
 #include "aunit.hpp"
 
-#define mjpeg_info mjpeg_warn
 
 static const char *KindNames[] =
 {
@@ -120,22 +113,8 @@
             res.push_back( *i );
 }
 
-static const char *kindToString(StreamKind kind)
-{
-#define KID(x)  x##_AUDIO:return #x;
-    switch(kind)
-    {
-        case KID(MPEG)
-       case  KID(AC3)
-        case KID(LPCM)
-        case KID(DTS)
-        default: 
-            printf("Kind %d\n",kind);
-            assert(0);
-    }
-  return "Oops";
-}
 
+
 void MultiplexJob::SetupInputStreams( std::vector< IBitStream *> &inputs )
 {
     IBitStream *bs;
@@ -143,36 +122,23 @@
     unsigned int i;
     bool bad_file = false;
     
-  for( i = 0; i < inputs.size(); ++i )
+	for( i = 0; i < inputs.size(); ++i )
     {
         bs = inputs[i];
         // Remember the streams initial state...
         bs->PrepareUndo( undo );
-        switch(bs->streamDesc.kind)
+        if( LPCMStream::Probe( *bs ) )
         {
-            case MPEG_AUDIO:
-            case AC3_AUDIO:
-            case LPCM_AUDIO:
-            case DTS_AUDIO:
-                mjpeg_info ("File %s looks like an %s Audio stream (fq %u, channel %u).\n", bs->StreamName() , kindToString(bs->streamDesc.kind),bs->streamDesc.frequency,bs->streamDesc.channel);
-                bs->UndoChanges( undo );
-                streams.push_back( new JobStream( bs, bs->streamDesc.kind) );
-                ++audio_tracks;
-                if(bs->streamDesc.kind==LPCM_AUDIO) 
-                    lpcm_param.push_back(LpcmParams::Checked(  bs->streamDesc.frequency,                                         
-                                                   bs->streamDesc.channel,16));//++lpcm_tracks;
-                continue;
-            case MPEG_VIDEO:
-                mjpeg_info ("File %s looks like an Video stream.", bs->StreamName() );
-                bs->UndoChanges( undo );
-                streams.push_back( new JobStream( bs,MPEG_VIDEO) );
-                ++video_tracks;
-                continue;
-            default: assert(0);
-            
+            mjpeg_info ("File %s looks like an LPCM Audio stream.",
+                        bs->StreamName());
+            bs->UndoChanges( undo );
+            streams.push_back( new JobStream( bs,  LPCM_AUDIO) );
+            ++audio_tracks;
+            ++lpcm_tracks;
+            continue;
         }
-    }
-#if 0
+
+        bs->UndoChanges( undo );
         if( MPAStream::Probe( *bs ) )
         {
             mjpeg_info ("File %s looks like an MPEG Audio stream.", 
@@ -205,9 +171,7 @@
             continue;
         }
 
-        bs->UndoChanges( undo);
-       
-
+        bs->UndoChanges( undo );
         if( VideoStream::Probe( *bs ) )
         {
             mjpeg_info ("File %s looks like an MPEG Video stream.",
@@ -231,25 +195,10 @@
             continue;
         }
 #endif
-        //if( LPCMStream::Probe( *bs ) )
-        if(1)
-        {
-            mjpeg_info ("File %s looks like an LPCM Audio stream.",
-                        bs->StreamName());
-            bs->UndoChanges( undo );
-            streams.push_back( new JobStream( bs,  LPCM_AUDIO) );
-            ++audio_tracks;
-            ++lpcm_tracks;
-            continue;
-        }
-        bs->UndoChanges( undo );
-#if 0 // MEAN: Force LPCM when not recognized
         bad_file = true;
-        delete bs;
         mjpeg_error ("File %s unrecogniseable!", bs->StreamName());
-#endif
-#endif
-
+        delete bs;
+    }
     
     if( bad_file )
     {
@@ -268,7 +217,7 @@
 	}
 	for( i = lpcm_param.size(); i < lpcm_tracks; ++i )
 	{
-		//  lpcm_param.push_back(LpcmParams::Default(mux_format));
+		lpcm_param.push_back(LpcmParams::Default(mux_format));
 	}
 
 	//

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -83,7 +83,18 @@
  *
  **********************************************************************/
 
-#include "streamType.h"
+enum StreamKind
+  {
+    MPEG_AUDIO,
+    AC3_AUDIO,
+    LPCM_AUDIO,
+    DTS_AUDIO,
+    MPEG_VIDEO
+#ifdef ZALPHA
+    ,
+    Z_ALPHA
+#endif
+  };
 
 class JobStream
 {
@@ -128,7 +139,7 @@
     Program ID
 *************************************************************************/
  
-#define MPLEX_VER    "2.2.3"
+#define MPLEX_VER    "2.2.4"
 #define MPLEX_DATE   "$Date$"
 
 #endif // __INTERACT_H__

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/lpcmstrm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/lpcmstrm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/lpcmstrm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -45,6 +45,7 @@
 	AudioStream( ibs, into ),
     parms(parms)
 {
+	num_frames = 0;
 }
 
 
@@ -89,7 +90,6 @@
                 bs.StreamName()
                 );
 
-	InitAUbuffer();
     
 	AU_start = bs.bitcount();
 
@@ -114,7 +114,7 @@
     access_unit.DTS = access_unit.PTS;
     access_unit.dorder = decoding_order;
     decoding_order++;
-    aunits.append( access_unit );
+    aunits.Append( access_unit );
     
 	OutputHdrInfo();
 }
@@ -144,7 +144,7 @@
         {
             mjpeg_warn("Discarding incomplete final frame LPCM  stream %d",
                        stream_num);
-            aunits.droplast();
+            aunits.DropLast();
             --decoding_order;
             break;
         }
@@ -160,7 +160,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		decoding_order++;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 		num_frames++;
 		
 		num_syncword++;
@@ -294,8 +294,8 @@
     // the smallest value is 1!
     dst[0] = LPCM_SUB_STR_0 + stream_num;
     dst[1] = frames;
-    dst[2] = (starting_frame_offset+1)>>8;
-    dst[3] = (starting_frame_offset+1)&0xff;
+    dst[2] = (starting_frame_offset+4)>>8;
+    dst[3] = (starting_frame_offset+4)&0xff;
     unsigned int bps_code;
     switch( bits_per_sample )
     {

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/main_example.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/main_example.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/main_example.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,621 +0,0 @@
-
-/*************************************************************************
-* @mainpage
-*  mplex - General-purpose MPEG-1/2 multiplexer.
-* (C) 2000, 2001 Andrew Stevens <andrew.stevens at philips.com>
-* 
-* Doxygen documentation and MPEG Z/Alpha multiplexing part by
-* Gernot Ziegler <gz at lysator.liu.se>
-*  Constructed using mplex - MPEG-1/SYSTEMS multiplexer as starting point
-*  Copyright (C) 1994 1995 Christoph Moar
-*  Siemens ZFE ST SN 11 / T SN 6
-*
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the GNU General Public License as published by
-*  the Free Software Foundation; either version 2 of the License, or
-*  (at your option) any later version.					 *
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  GNU General Public License for more details.	
-*
-*  You should have received a copy of the GNU General Public License
-*  along with this program; if not, write to the Free Software	
-*  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-*************************************************************************/
-
-#include <config.h>
-#include <stdio.h>
-#ifdef HAVE_GETOPT_H
-#include <getopt.h>
-#endif
-#include <string>
-#include <memory>
-#include <sys/stat.h>
-#ifndef _WIN32
-#include <sys/param.h>
-#endif
-#include <ctype.h>
-#include <math.h>
-#include "cpu_accel.h"
-#include "mjpeg_types.h"
-#include "mjpeg_logging.h"
-#include "mpegconsts.h"
-
-#include "interact.hpp"
-#include "bits.hpp"
-#include "outputstrm.hpp"
-#include "multiplexor.hpp"
-
-
-using std::auto_ptr;
-
-
-/*************************************************************************
- Command line wrapper.  Basically, all the command line and file (actually
- pipe and FIFO is what would be more normal) I/O specific sub-classes
-
- Plus the top-level entry point.  That's all!!
-
-*************************************************************************/
-
-
-#if	!defined(HAVE_LROUND)
-extern "C" {
-long
-lround(double x)
-{
-	long l = ceil(x);
-	return(l);
-}
-};
-#endif
-
-
-
-class FileOutputStream : public OutputStream
-{
-public:
-    FileOutputStream( const char *filename_pat );
-    virtual int  Open( );
-    virtual void Close();
-    virtual off_t SegmentSize( );
-    virtual void NextSegment();
-    virtual void Write(uint8_t *data, unsigned int len);
-
-private:
-    FILE *strm;
-    char filename_pat[MAXPATHLEN];
-    char cur_filename[MAXPATHLEN];
-
-};
-
-
-
-FileOutputStream::FileOutputStream( const char *name_pat ) 
-{
-	strncpy( filename_pat, name_pat, MAXPATHLEN );
-	snprintf( cur_filename, MAXPATHLEN, filename_pat, segment_num );
-}
-      
-int FileOutputStream::Open()
-{
-	strm = fopen( cur_filename, "wb" );
-	if( strm == NULL )
-	{
-		mjpeg_error_exit1( "Could not open for writing: %s", cur_filename );
-	}
-
-	return 0;
-}
-
-void FileOutputStream::Close()
-{ 
-    fclose(strm);
-}
-
-
-off_t
-FileOutputStream::SegmentSize()
-{
-	struct stat stb;
-    fstat(fileno(strm), &stb);
-	off_t written = stb.st_size;
-    return written;
-}
-
-void 
-FileOutputStream::NextSegment( )
-{
-    auto_ptr<char> prev_filename_buf( new char[strlen(cur_filename)+1] );
-    char *prev_filename = prev_filename_buf.get();
-	fclose(strm);
-	++segment_num;
-    strcpy( prev_filename, cur_filename );
-	snprintf( cur_filename, MAXPATHLEN, filename_pat, segment_num );
-	if( strcmp( prev_filename, cur_filename ) == 0 )
-	{
-		mjpeg_error_exit1( 
-			"Need to split output but there appears to be no %%d in the filename pattern %s", filename_pat );
-	}
-	strm = fopen( cur_filename, "wb" );
-	if( strm == NULL )
-	{
-		mjpeg_error_exit1( "Could not open for writing: %s", cur_filename );
-	}
-}
-
-void
-FileOutputStream::Write( uint8_t *buf, unsigned int len )
-{
-    if( fwrite( buf, 1, len, strm ) != len )
-    {
-        mjpeg_error_exit1( "Failed write: %s", cur_filename );
-    }
-}
-
-
-
-/********************************
- *
- * IFileBitStream - Input bit stream class for bit streams sourced
- * from standard file I/O (this of course *includes* network sockets,
- * fifo's, et al).
- *
- * OLAF: To hook into your PES reader/reconstructor you need to define
- * a class like this one, where 'ReadStreamBytes' calls you code to
- * generate the required number of bytes of ES data and transfer it 
- * to the specified buffer.  The logical way to do this would be to
- * inherit IBitStream as a base class of the top-level classes for the ES
- * reconstructors.
- *
- ********************************/
-
-class IFileBitStream : public IBitStream
-{
-public:
- 	IFileBitStream( const char *bs_filename, 
-					unsigned int buf_size = BUFFER_SIZE);
-	~IFileBitStream();
-
-private:
-	FILE *fileh;
-	char *filename;
-	virtual size_t ReadStreamBytes( uint8_t *buf, size_t number ) 
-		{
-			return fread(buf,sizeof(uint8_t), number, fileh ); 
-		}
-	virtual bool EndOfStream() { return feof(fileh) != 0; }
-	
-};
-
-
-
-IFileBitStream::IFileBitStream( const char *bs_filename,
-                                unsigned int buf_size) :
-    IBitStream()
-{
-	if ((fileh = fopen(bs_filename, "rb")) == NULL)
-	{
-		mjpeg_error_exit1( "Unable to open file %s for reading.", bs_filename);
-	}
-	filename = strcpy( new char[strlen(bs_filename)+1], bs_filename );
-    streamname = filename;
-
-    SetBufSize(buf_size);
-	eobs = false;
-    byteidx = 0;
-	if (!ReadIntoBuffer())
-	{
-		if (buffered==0)
-		{
-			mjpeg_error_exit1( "Unable to read from %s.", bs_filename);
-		}
-	}
-}
-
-
-/**
-   Destructor: close the device containing the bit stream after a read
-   process
-*/
-IFileBitStream::~IFileBitStream()
-{
-	if (fileh)
-	{
-		fclose(fileh);
-		delete filename;
-	}
-	fileh = 0;
-    Release();
-}
-
-
-/*******************************
- *
- * Command line job class - sets up a Multiplex Job based on command
- * line and File I/O...
- *
- ******************************/
-
-class CmdLineMultiplexJob : public MultiplexJob
-{
-public:
-	CmdLineMultiplexJob( unsigned int argc, char *argv[]);
-
-private:
-	void InputStreamsFromCmdLine (unsigned int argc, char* argv[] );
-	void Usage(char *program_name);
-	bool ParseVideoOpt( const char *optarg );
-	bool ParseLpcmOpt( const char *optarg );
-	bool ParseWorkaroundOpt( const char *optarg );
-	bool ParseTimeOffset( const char *optarg );
-	
-
-	static const char short_options[];
-
-#if defined(HAVE_GETOPT_LONG)
-	static struct option long_options[];
-#endif
-
-};
-
-const char CmdLineMultiplexJob::short_options[] =
-    "o:b:r:O:v:f:l:s:S:p:W:L:VMh";
-#if defined(HAVE_GETOPT_LONG)
-struct option CmdLineMultiplexJob::long_options[] = 
-{
-	{ "verbose",           1, 0, 'v' },
-	{ "format",            1, 0, 'f' },
-	{ "mux-bitrate",       1, 0, 'r' },
-	{ "video-buffer",      1, 0, 'b' },
-	{ "lpcm-params",       1, 0, 'L' },
-	{ "output",            1, 0, 'o' },
-	{ "sync-offset",    	1, 0, 'O' },
-	{ "vbr",      	        1, 0, 'V' },
-	{ "system-headers",    1, 0, 'h' },
-	{ "split-segment",     0, 0, 'M' },
-	{ "max-segment-size",  1, 0, 'S' },
-	{ "mux-limit",   	    1, 0, 'l' },
-	{ "packets-per-pack",  1, 0, 'p' },
-	{ "sector-size",       1, 0, 's' },
-	{ "workarounds", 1, 0, 'W' },
-	{ "help",              0, 0, '?' },
-	{ 0,                   0, 0, 0   }
-};
-#endif
-
-
-CmdLineMultiplexJob::CmdLineMultiplexJob(unsigned int argc, char *argv[]) :
-	MultiplexJob()
-{
-    int n;
-    outfile_pattern = NULL;
-
-#if defined(HAVE_GETOPT_LONG)
-	while( (n=getopt_long(argc,argv,short_options,long_options, NULL)) != -1 )
-#else
-    while( (n=getopt(argc,argv,short_options)) != -1 )
-#endif
-	{
-		switch(n)
-		{
-        case 0 :
-            break;
-		case 'o' :
-			outfile_pattern = optarg;
-			break;
-		case 'v' :
-			verbose = atoi(optarg);
-			if( verbose < 0 || verbose > 2 )
-				Usage(argv[0]);
-			break;
-
-		case 'V' :
-			VBR = true;
-			break;
-	  
-		case 'h' :
-			always_system_headers = true;
-			break;
-
-		case 'b' :
-            if( ! ParseVideoOpt( optarg ) )
-            {
-                mjpeg_error( "Illegal video decoder buffer size(s): %s", 
-                             optarg );
-                Usage(argv[0]);
-            }
-            break;
-        case 'L':
-            if( ! ParseLpcmOpt( optarg ) )
-            {
-                mjpeg_error( "Illegal LPCM option(s): %s", optarg );
-                Usage(argv[0]);
-            }
-            break;
-
-		case 'r':
-			data_rate = atoi(optarg);
-			if( data_rate < 0 )
-				Usage(argv[0]);
-			/* Convert from kbit/sec (user spec) to 50B/sec units... */
-			data_rate = (( data_rate * 1000 / 8 + 49) / 50 ) * 50;
-			break;
-
-		case 'O':
-			if( ! ParseTimeOffset(optarg) )
-			{
-				mjpeg_error( "Time offset units if specified must: ms|s|mpt" );
-				Usage(argv[0]);
-			}
-			break;
-          
-		case 'l' : 
- 			max_PTS = atoi(optarg);
-			if( max_PTS < 1  )
-				Usage(argv[0]);
-			break;
-		
-		case 'p' : 
-			packets_per_pack = atoi(optarg);
-			if( packets_per_pack < 1 || packets_per_pack > 100  )
-				Usage(argv[0]);
-			break;
-		
-	  
-		case 'f' :
-			mux_format = atoi(optarg);
-			if( mux_format < MPEG_FORMAT_MPEG1 || mux_format > MPEG_FORMAT_LAST
-                )
-				Usage(argv[0]);
-			break;
-		case 's' :
-			sector_size = atoi(optarg);
-			if( sector_size < 256 || sector_size > 16384 )
-				Usage(argv[0]);
-			break;
-		case 'S' :
-			max_segment_size = atoi(optarg);
-			if( max_segment_size < 0  )
-				Usage(argv[0]);
-			break;
-		case 'M' :
-			multifile_segment = true;
-			break;
-        case 'W' :
-            if( ! ParseWorkaroundOpt( optarg ) )
-            {
-                Usage(argv[0]);
-            }
-            break;
-		case '?' :
-		default :
-			Usage(argv[0]);
-			break;
-		}
-	}
-	if (argc - optind < 1 || outfile_pattern == NULL)
-    {	
-		Usage(argv[0]);
-    }
-	(void)mjpeg_default_handler_verbosity(verbose);
-	mjpeg_info( "mplex version %s (%s %s)",VERSION,MPLEX_VER,MPLEX_DATE );
-
-    InputStreamsFromCmdLine( argc-(optind-1), argv+optind-1);
-}
-
-/*************************************************************************
- Usage banner for the command line wrapper.
-*************************************************************************/
-
-    
-void CmdLineMultiplexJob::Usage(char *str)
-{
-    fprintf( stderr,
-	"mjpegtools mplex-2 version " VERSION " (" MPLEX_VER ")\n"
-	"Usage: %s [params] -o <output filename pattern> <input file>... \n"
-	"         %%d in the output file name is by segment count\n"
-	"  where possible params are:\n"
-	"--verbose|-v num\n"
-    "  Level of verbosity. 0 = quiet, 1 = normal 2 = verbose/debug\n"
-	"--format|-f fmt\n"
-    "  Set defaults for particular MPEG profiles\n"
-	"  [0 = Generic MPEG1, 1 = VCD, 2 = user-rate VCD, 3 = Generic MPEG2,\n"
-    "   4 = SVCD, 5 = user-rate SVCD\n"
-	"   6 = VCD Stills, 7 = SVCD Stills, 8 = DVD with NAV sectors, 9 = DVD]\n"
-    "--mux-bitrate|-r num\n"
-    "  Specify data rate of output stream in kbit/sec\n"
-	"    (default 0=Compute from source streams)\n"
-	"--video-buffer|-b num [, num...] \n"
-    "  Specifies decoder buffers size in kB.  [ 20...2000]\n"
-    "--lpcm-params | -L samppersec:chan:bits [, samppersec:chan:bits]\n"
-	"--mux-limit|-l num\n"
-    "  Multiplex only num seconds of material (default 0=multiplex all)\n"
-	"--sync-offset|-O num ms|s|mpt\n"
-    "  Specify offset of timestamps (video-audio) in mSec\n"
-	"--sector-size|-s num\n"
-    "  Specify sector size in bytes for generic formats [256..16384]\n"
-    "--vbr|-V\n"
-    "  Multiplex variable bit-rate video\n"
-	"--packets-per-pack|-p num\n"
-    "  Number of packets per pack generic formats [1..100]\n"
-	"--system-headers|-h\n"
-    "  Create System header in every pack in generic formats\n"
-	"--max-segment-size|-S size\n"
-    "  Maximum size of output file(s) in Mbyte (default: 0) (no limit)\n"
-	"--split-segment|-M\n"
-    "  Simply split a sequence across files rather than building run-out/run-in\n"
-    "--workaround|-W workaround [, workaround ]\n"
-	"--help|-?\n"
-    "  Print this lot out!\n", str);
-	exit (1);
-}
-
-
-bool CmdLineMultiplexJob::ParseLpcmOpt( const char *optarg )
-{
-    char *endptr, *startptr;
-    unsigned int samples_sec;
-    unsigned int channels;
-    unsigned int bits_sample;
-    endptr = const_cast<char *>(optarg);
-    do 
-    {
-        startptr = endptr;
-        samples_sec = static_cast<unsigned int>(strtol(startptr, &endptr, 10));
-        if( startptr == endptr || *endptr != ':' )
-            return false;
-
-
-        startptr = endptr+1;
-        channels = static_cast<unsigned int>(strtol(startptr, &endptr, 10));
-        if(startptr == endptr || *endptr != ':' )
-            return false;
-
-        startptr = endptr+1;
-        bits_sample = static_cast<unsigned int>(strtol(startptr, &endptr, 10));
-        if( startptr == endptr )
-            return false;
-
-        LpcmParams *params = LpcmParams::Checked( samples_sec,
-                                                  channels,
-                                                  bits_sample );
-        if( params == 0 )
-            return false;
-        lpcm_param.push_back(params);
-        if( *endptr == ',' )
-            ++endptr;
-    } while( *endptr != '\0' );
-    return true;
-}
-
-
-bool CmdLineMultiplexJob::ParseWorkaroundOpt( const char *optarg )
-{
-    char *endptr, *startptr;
-    endptr = const_cast<char *>(optarg);
-    struct { const char *longname; char shortname; bool *flag; } flag_table[] =
-        {
-            { 0, '\0', 0 }
-        };
-    for(;;)
-    {
-        // Find start of next flag...
-        while( isspace(*endptr) || *endptr == ',' )
-            ++endptr;
-        if( *endptr == '\0' )
-            break;
-        startptr = endptr;
-        // Find end of current flag...
-        while( *endptr != ' ' && *endptr != ',' && *endptr != '\0' )
-            ++endptr;
-            
-        size_t len = endptr - startptr;
-
-        int flag = 0;
-        while( flag_table[flag].longname != 0 )
-        {
-            if( (len == 1 && *startptr == flag_table[flag].shortname ) ||
-                strncmp( startptr, flag_table[flag].longname, len ) == 0 )
-            {
-                *flag_table[flag].flag = true;
-                break;
-            }
-            ++flag;
-        }
-
-        if( flag_table[flag].longname == 0 )
-        {
-            std::string message( "Illegal work-around option: not one of " );
-            flag = 0;
-            char sep[] = ",";
-            do
-            {
-                message += flag_table[flag].longname;
-                message += sep;
-                message += flag_table[flag].shortname;
-                ++flag;
-                if( flag_table[flag].longname != 0 )
-                    message += sep;
-            }
-            while( flag_table[flag].longname != 0 );
-            mjpeg_error( message.c_str() );
-            return false;
-        }
-
-    } 
-    return true;
-}
-
-bool CmdLineMultiplexJob::ParseVideoOpt( const char *optarg )
-{
-    char *endptr, *startptr;
-    unsigned int buffer_size;
-    endptr = const_cast<char *>(optarg);
-    do 
-    {
-        startptr = endptr;
-        buffer_size = static_cast<unsigned int>(strtol(startptr, &endptr, 10));
-        if( startptr == endptr )
-            return false;
-
-        VideoParams *params = VideoParams::Checked( buffer_size );
-        if( params == 0 )
-            return false;
-        video_param.push_back(params);
-        if( *endptr == ',' )
-            ++endptr;
-    } 
-    while( *endptr != '\0' );
-    return true;
-}
-
-bool CmdLineMultiplexJob::ParseTimeOffset(const char *optarg)
-{
-    double f;
-    double persecond=1000.0;
-    char *e;
-
-    f=strtod(optarg,&e);
-    if( e ) {
-        while(isspace(*e)) e++;
-        if(!strcmp(e,"ms")) persecond=1000.0;
-        else if(!strcmp(e,"s")) persecond=1.0;
-        else if(!strcmp(e,"mpt")) persecond=90000.0;
-		else
-			return false;
-    }
-    video_offset = lround(f*CLOCKS/(persecond));
-	if( video_offset < 0 )
-	{
-		audio_offset = - video_offset;
-		video_offset = 0;
-	}
-	return true;
-}
-
-void CmdLineMultiplexJob::InputStreamsFromCmdLine(unsigned int argc, char* argv[] )
-{
-	vector<IBitStream *> inputs;
-    unsigned int i;
-	for( i = 1; i < argc; ++i )
-    {
-		inputs.push_back( new IFileBitStream( argv[i] ) );
-	}
-	SetupInputStreams( inputs );
-}
-
-
-int main (int argc, char* argv[])
-{
-	CmdLineMultiplexJob job(argc,argv);
-	FileOutputStream output( job.outfile_pattern );
-	Multiplexor mux(job, output);
-	mux.Multiplex();
-
-    return (0);	
-}
-
-			

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.c	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.c	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,227 @@
+/*
+    $Id: mjpeg_logging.c,v 1.14 2005/05/18 17:21:47 sms00 Exp $
+
+    Copyright (C) 2000 Herbert Valerio Riedel <hvr at gnu.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+
+#ifdef HAVE_CONFIG_H
+# include <config.h>
+#endif
+
+#include <stdlib.h>
+#include <stdarg.h>
+#include <stdio.h>
+#include <assert.h>
+#include <string.h>
+
+#include "mjpeg_logging.h"
+
+#define MAX_DEFAULT_ID_SIZE 16
+#define DEFAULT_DEFAULT_ID "???"
+
+#ifdef HAVE___PROGNAME
+extern const char *__progname;
+#endif
+
+static log_level_t mjpeg_log_verbosity = LOG_NONE;
+static char default_handler_id[MAX_DEFAULT_ID_SIZE];
+static char default_handler_id_is_set = 0;
+
+static int default_mjpeg_log_filter( log_level_t level )
+{
+  int verb_from_env;
+  if( mjpeg_log_verbosity == 0 )
+    {
+      char *mjpeg_verb_env = getenv("MJPEG_VERBOSITY");
+      if( mjpeg_verb_env != NULL )
+        {
+          verb_from_env = LOG_WARN-atoi(mjpeg_verb_env);
+          if( verb_from_env >= LOG_DEBUG && verb_from_env <= LOG_ERROR )
+            mjpeg_log_verbosity = (log_level_t)verb_from_env;
+        }
+    }
+  return (level < LOG_WARN && level < mjpeg_log_verbosity);
+}
+
+static mjpeg_log_filter_t _filter = default_mjpeg_log_filter;
+
+static void
+default_mjpeg_log_handler(log_level_t level, const char message[])
+{
+  const char *ids;
+
+  if( (*_filter)( level ) )
+    return;
+  if (default_handler_id_is_set) {
+    ids = default_handler_id;
+  } else {
+#ifdef HAVE___PROGNAME
+    ids = __progname;
+#else
+    ids = DEFAULT_DEFAULT_ID;
+#endif
+  }
+  switch(level) {
+  case LOG_ERROR:
+    fprintf(stderr, "**ERROR: [%s] %s\n", ids, message);
+    break;
+  case LOG_DEBUG:
+    fprintf(stderr, "--DEBUG: [%s] %s\n", ids, message);
+    break;
+  case LOG_WARN:
+    fprintf(stderr, "++ WARN: [%s] %s\n", ids, message);
+    break;
+  case LOG_INFO:
+    fprintf(stderr, "   INFO: [%s] %s\n", ids, message);
+    break;
+  default:
+    assert(0);
+  }
+}
+
+static mjpeg_log_handler_t _handler = default_mjpeg_log_handler;
+
+
+mjpeg_log_handler_t
+mjpeg_log_set_handler(mjpeg_log_handler_t new_handler)
+{
+  mjpeg_log_handler_t old_handler = _handler;
+
+  _handler = new_handler;
+
+  return old_handler;
+}
+
+/***************
+ *
+ * Set default log handlers degree of verboseity.
+ * 0 = quiet, 1 = info, 2 = debug
+ *
+ *************/
+
+int
+mjpeg_default_handler_verbosity(int verbosity)
+{
+  int prev_verb = mjpeg_log_verbosity;
+  mjpeg_log_verbosity = (log_level_t)(LOG_WARN - verbosity);
+  return prev_verb;
+}
+
+/*
+ * Set identifier string used by default handler
+ *
+ */
+int
+mjpeg_default_handler_identifier(const char *new_id)
+{
+  const char *s;
+  if (new_id == NULL) {
+    default_handler_id_is_set = 0;
+    return 0;
+  }
+  /* find basename of new_id (remove any directory prefix) */
+  if ((s = strrchr(new_id, '/')) == NULL)
+    s = new_id;
+  else
+    s = s + 1;
+  strncpy(default_handler_id, s, MAX_DEFAULT_ID_SIZE);
+  default_handler_id[MAX_DEFAULT_ID_SIZE-1] = '\0';
+  default_handler_id_is_set = 1;
+  return 0;
+}
+
+
+static void
+mjpeg_logv(log_level_t level, const char format[], va_list args)
+{
+  char buf[1024] = { 0, };
+
+  /* TODO: Original had a re-entrancy error trap to assist bug
+     finding.  To make this work with multi-threaded applications a
+     lock is needed hence delete.
+  */
+
+  
+  vsnprintf(buf, sizeof(buf)-1, format, args);
+
+  _handler(level, buf);
+}
+
+void
+mjpeg_log(log_level_t level, const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(level, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_debug(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_DEBUG, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_info(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_INFO, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_warn(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_WARN, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_error(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_ERROR, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_error_exit1(const char format[], ...)
+{
+  va_list args;
+  va_start( args, format );
+  mjpeg_logv( LOG_ERROR, format, args);
+  va_end(args);           
+  exit(EXIT_FAILURE);
+}
+
+
+/* 
+ * Local variables:
+ *  c-file-style: "gnu"
+ *  tab-width: 8
+ *  indent-tabs-mode: nil
+ * End:
+ */

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,80 @@
+/*
+    $Id: mjpeg_logging.h,v 1.8 2004/09/01 02:55:30 sms00 Exp $
+
+    Copyright (C) 2000 Herbert Valerio Riedel <hvr at gnu.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#ifndef __MJPEG_LOGGING_H__
+#define __MJPEG_LOGGING_H__
+
+#include <mjpeg_types.h>
+
+typedef enum {
+  LOG_NONE = 0,
+  LOG_DEBUG,
+  LOG_INFO,
+  LOG_WARN,
+  LOG_ERROR
+} log_level_t;
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+void
+mjpeg_log(log_level_t level, const char format[], ...) GNUC_PRINTF(2, 3);
+
+typedef int(*mjpeg_log_filter_t)(log_level_t level);
+    
+typedef void(*mjpeg_log_handler_t)(log_level_t level, const char message[]);
+
+mjpeg_log_handler_t
+mjpeg_log_set_handler(mjpeg_log_handler_t new_handler);
+
+int
+mjpeg_default_handler_identifier(const char *new_id);
+
+int
+mjpeg_default_handler_verbosity(int verbosity);
+
+void
+mjpeg_debug(const char format[], ...) GNUC_PRINTF(1,2);
+
+void
+mjpeg_info(const char format[], ...) GNUC_PRINTF(1,2);
+
+void
+mjpeg_warn(const char format[], ...) GNUC_PRINTF(1,2);
+
+void
+mjpeg_error(const char format[], ...) GNUC_PRINTF(1,2);
+
+void
+mjpeg_error_exit1(const char format[], ...) GNUC_PRINTF(1,2);
+
+#ifdef __cplusplus
+}
+#endif
+#endif /* __MJPEG_LOGGING_H__ */
+
+
+/* 
+ * Local variables:
+ *  c-file-style: "gnu"
+ *  tab-width: 8
+ *  indent-tabs-mode: nil
+ * End:
+ */

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_types.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_types.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mjpeg_types.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,59 @@
+/*
+    $Id: mjpeg_types.h,v 1.14 2005/05/18 17:21:47 sms00 Exp $
+
+    Copyright (C) 2000 Herbert Valerio Riedel <hvr at gnu.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#ifndef __MJPEG_TYPES_H__
+#define __MJPEG_TYPES_H__
+
+#include <sys/types.h> /* FreeBSD, others - ssize_t */
+
+/*
+ * modern CYGWIN releases have stdint/inttypes so there's no need
+ * to check for it or provide typedefs/defines
+*/
+
+#if defined(HAVE_STDINT_H)
+# include <stdint.h>
+#elif defined(HAVE_INTTYPES_H)
+# include <inttypes.h>
+#else
+typedef unsigned char uint8_t;
+typedef unsigned short uint16_t;
+typedef unsigned int uint32_t;
+typedef unsigned long long uint64_t;
+typedef long long int int64_t;
+#endif /* HAVE_STDINT_H */
+
+#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ > 4)
+#define GNUC_PRINTF( format_idx, arg_idx )    \
+  __attribute__((format (printf, format_idx, arg_idx)))
+#else   /* !__GNUC__ */
+#define GNUC_PRINTF( format_idx, arg_idx )
+#endif  /* !__GNUC__ */
+
+#endif /* __MJPEG_TYPES_H__ */
+
+
+/* 
+ * Local variables:
+ *  c-file-style: "gnu"
+ *  tab-width: 8
+ *  indent-tabs-mode: nil
+ * End:
+ */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpastrm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpastrm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpastrm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -27,7 +27,6 @@
 #include "interact.hpp"
 #include "multiplexor.hpp"
 
-#define mjpeg_info mjpeg_warn
 
 static const char *mpa_audio_version[4] =
 {
@@ -125,8 +124,6 @@
                 bs.StreamName()
                 );
 
-	InitAUbuffer();
-	
 	/* A.Stevens 2000 - update to be compatible up to  MPEG2.5
 	 */
     AU_start = bs.bitcount();
@@ -151,8 +148,8 @@
 			mpa_slots[layer] *1000 /
 			mpa_freq_table[version_id][frequency];
 
-		size_frames[0] = framesize;
-		size_frames[1] = framesize+( layer == 0 ? 4 : 1);
+		size_frames[0] = framesize * ( layer == 0 ? 4 : 1);
+		size_frames[1] = (framesize+1) * ( layer == 0 ? 4 : 1);
 		num_frames[padding_bit]++;
         access_unit.start  = AU_start;
 		access_unit.length = size_frames[padding_bit];
@@ -166,7 +163,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		++decoding_order;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 
     } else
     {
@@ -186,9 +183,9 @@
 
 unsigned int MPAStream::SizeFrame( int rate_code, int padding )
 {
-	return mpa_bitrates_kbps[version_id][layer][rate_code]  * 
+	return ( mpa_bitrates_kbps[version_id][layer][rate_code]  * 
 		mpa_slots [layer] *1000 /
-		mpa_freq_table[version_id][frequency] + padding;
+		mpa_freq_table[version_id][frequency] + padding ) * ( layer == 0 ? 4 : 1);
 }
 
 void MPAStream::FillAUbuffer(unsigned int frames_to_buffer )
@@ -216,7 +213,7 @@
             mjpeg_warn("Discarding incomplete final frame MPEG audio stream %02x!",
                        stream_id
                        );
-            aunits.droplast();
+            aunits.DropLast();
             --decoding_order;
             break;
         }
@@ -248,7 +245,7 @@
 		access_unit.DTS = access_unit.PTS;
 		access_unit.dorder = decoding_order;
 		decoding_order++;
-		aunits.append( access_unit );
+		aunits.Append( access_unit );
 		num_frames[padding_bit]++;
 
 		bs.GetBits( 9);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.c	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.c	2007-08-03 00:04:40 UTC (rev 3469)
@@ -41,21 +41,21 @@
 
 
 #define MPEG_NUM_RATES (sizeof(mpeg_framerates)/sizeof(mpeg_framerates[0]))
-static const mpeg_framerate_code_t MX_mpeg_num_framerates = MPEG_NUM_RATES;
+static const mpeg_framerate_code_t mpeg_num_framerates = MPEG_NUM_RATES;
 
-static const char *
-framerate_definitions[MPEG_NUM_RATES] =
-{
-   "illegal", 
-  "24000.0/1001.0 (NTSC 3:2 pulldown converted FILM)",
-  "24.0 (NATIVE FILM)",
-  "25.0 (PAL/SECAM VIDEO / converted FILM)",
-  "30000.0/1001.0 (NTSC VIDEO)",
-  "30.0",
-  "50.0 (PAL FIELD RATE)",
-  "60000.0/1001.0 (NTSC FIELD RATE)",
-  "60.0"
-};
+//static const char *
+//framerate_definitions[MPEG_NUM_RATES] =
+//{
+//   "illegal", 
+//  "24000.0/1001.0 (NTSC 3:2 pulldown converted FILM)",
+//  "24.0 (NATIVE FILM)",
+//  "25.0 (PAL/SECAM VIDEO / converted FILM)",
+//  "30000.0/1001.0 (NTSC VIDEO)",
+//  "30.0",
+//  "50.0 (PAL FIELD RATE)",
+//  "60000.0/1001.0 (NTSC FIELD RATE)",
+//  "60.0"
+//};
 
 
 static const char *mpeg1_aspect_ratio_definitions[] =
@@ -121,13 +121,13 @@
 	mpeg2_aspect_ratio_definitions
 };
 
-static const y4m_ratio_t *mpeg_aspect_ratios[2] = 
-{
-	mpeg1_aspect_ratios,
-	mpeg2_aspect_ratios
-};
+//static const y4m_ratio_t *mpeg_aspect_ratios[2] = 
+//{
+//	mpeg1_aspect_ratios,
+//	mpeg2_aspect_ratios
+//};
 
-static const mpeg_aspect_code_t MX_mpeg_num_aspect_ratios[2] = 
+static const mpeg_aspect_code_t mpeg_num_aspect_ratios[2] = 
 {
   sizeof(mpeg1_aspect_ratios)/sizeof(mpeg1_aspect_ratios[0]),
   sizeof(mpeg2_aspect_ratios)/sizeof(mpeg2_aspect_ratios[0])
@@ -139,9 +139,9 @@
  */
 
 int
-mpeg_valid_framerate_code( mpeg_framerate_code_t code )
+MX_mpeg_valid_framerate_code( mpeg_framerate_code_t code )
 {
-    return ((code > 0) && (code < MX_mpeg_num_framerates)) ? 1 : 0;
+    return ((code > 0) && (code < mpeg_num_framerates)) ? 1 : 0;
 }
 
 
@@ -149,40 +149,61 @@
  * Convert MPEG frame-rate code to corresponding frame-rate
  */
 
-// y4m_ratio_t
-// mpeg_framerate( mpeg_framerate_code_t code )
-// {
-//     if ((code > 0) && (code < mpeg_num_framerates))
-// 		return mpeg_framerates[code];
-//     else
-// 		return y4m_fps_UNKNOWN;
-// }
+y4m_ratio_t
+MX_mpeg_framerate( mpeg_framerate_code_t code )
+{
+    if ((code > 0) && (code < mpeg_num_framerates))
+		return mpeg_framerates[code];
+    else
+		return y4m_fps_UNKNOWN;
+}
 
-/*
- * Look-up MPEG frame rate code for a (exact) frame rate.
- */
+///*
+// * Look-up MPEG frame rate code for a (exact) frame rate.
+// */
+//
+//
+//mpeg_framerate_code_t 
+//mpeg_framerate_code( y4m_ratio_t framerate )
+//{
+//	mpeg_framerate_code_t i;
+//  
+//	y4m_ratio_reduce(&framerate);
+//    /* start at '1', because 0 is unknown/illegal */
+//	for (i = 1; i < mpeg_num_framerates; ++i) {
+//		if (Y4M_RATIO_EQL(framerate, mpeg_framerates[i]))
+//			return i;
+//	}
+//	return 0;
+//}
+//
+//
+///* small enough to distinguish 1/1000 from 1/1001 */
+//#define MPEG_FPS_TOLERANCE 0.0001
+//
+//
+//y4m_ratio_t
+//mpeg_conform_framerate( double fps )
+//{
+//	mpeg_framerate_code_t i;
+//	y4m_ratio_t result;
+//
+//	/* try to match it to a standard frame rate */
+//    /* (start at '1', because 0 is unknown/illegal) */
+//	for (i = 1; i < mpeg_num_framerates; i++) 
+//	{
+//		double deviation = 1.0 - (Y4M_RATIO_DBL(mpeg_framerates[i]) / fps);
+//		if ( (deviation > -MPEG_FPS_TOLERANCE) &&
+//			 (deviation < +MPEG_FPS_TOLERANCE) )
+//			return mpeg_framerates[i];
+//	}
+//	/* no luck?  just turn it into a ratio (6 decimal place accuracy) */
+//	result.n = (int)((fps * 1000000.0) + 0.5);
+//	result.d = 1000000;
+//	y4m_ratio_reduce(&result);
+//	return result;
+//}
 
-
-// mpeg_framerate_code_t 
-// mpeg_framerate_code( y4m_ratio_t framerate )
-// {
-// 	mpeg_framerate_code_t i;
-//   
-// 	y4m_ratio_reduce(&framerate);
-//     /* start at '1', because 0 is unknown/illegal */
-// 	for (i = 1; i < mpeg_num_framerates; ++i) {
-// 		if (Y4M_RATIO_EQL(framerate, mpeg_framerates[i]))
-// 			return i;
-// 	}
-// 	return 0;
-// }
-
-
-/* small enough to distinguish 1/1000 from 1/1001 */
-#define MPEG_FPS_TOLERANCE 0.0001
-
-
-
   
 
 /*
@@ -190,270 +211,270 @@
  */
 
 int
-mpeg_valid_aspect_code( int version, mpeg_framerate_code_t c )
+MX_mpeg_valid_aspect_code( int version, mpeg_framerate_code_t c )
 {
 	if ((version == 1) || (version == 2))
-        return ((c > 0) && (c < MX_mpeg_num_aspect_ratios[version-1])) ? 1 : 0;
+        return ((c > 0) && (c < mpeg_num_aspect_ratios[version-1])) ? 1 : 0;
     else
         return 0;
 }
 
 
-/*
- * Convert MPEG aspect-ratio code to corresponding aspect-ratio
- */
+///*
+// * Convert MPEG aspect-ratio code to corresponding aspect-ratio
+// */
+//
+//y4m_ratio_t 
+//mpeg_aspect_ratio( int mpeg_version,  mpeg_aspect_code_t code )
+//{
+//	y4m_ratio_t ratio;
+//    if ((mpeg_version >= 1) && (mpeg_version <= 2) &&
+//        (code > 0) && (code < mpeg_num_aspect_ratios[mpeg_version-1]))
+//	{
+//		ratio = mpeg_aspect_ratios[mpeg_version-1][code];
+//		y4m_ratio_reduce(&ratio);
+//		return ratio;
+//	}
+//    else
+//		return y4m_sar_UNKNOWN;
+//}
+//
+//
+//
+///*
+// * Look-up corresponding MPEG aspect ratio code given an exact aspect ratio.
+// *
+// * WARNING: The semantics of aspect ratio coding *changed* between
+// * MPEG1 and MPEG2.  In MPEG1 it is the *pixel* aspect ratio. In
+// * MPEG2 it is the (far more sensible) aspect ratio of the eventual
+// * display.
+// *
+// */
+//
+//mpeg_aspect_code_t 
+//mpeg_frame_aspect_code( int mpeg_version, y4m_ratio_t aspect_ratio )
+//{
+//	mpeg_aspect_code_t i;
+//	y4m_ratio_t red_ratio = aspect_ratio;
+//	y4m_ratio_reduce( &red_ratio );
+//	if( mpeg_version < 1 || mpeg_version > 2 )
+//		return 0;
+//    /* (start at '1', because 0 is unknown/illegal) */
+//	for( i = 1; i < mpeg_num_aspect_ratios[mpeg_version-1]; ++i )
+//	{
+//		y4m_ratio_t red_entry =  mpeg_aspect_ratios[mpeg_version-1][i];
+//		y4m_ratio_reduce( &red_entry );
+//		if(  Y4M_RATIO_EQL( red_entry, red_ratio) )
+//			return i;
+//	}
+//
+//	return 0;
+//			
+//}
+//
+//
+//
+///*
+// * Guess the correct MPEG aspect ratio code,
+// *  given the true sample aspect ratio and frame size of a video stream
+// *  (and the MPEG version, 1 or 2).
+// *
+// * Returns 0 if it has no good guess.
+// *
+// */
+//
+//
+///* this is big enough to accommodate the difference between 720 and 704 */
+//#define GUESS_ASPECT_TOLERANCE 0.03
+//
+//mpeg_aspect_code_t 
+//mpeg_guess_mpeg_aspect_code(int mpeg_version, y4m_ratio_t sampleaspect,
+//							int frame_width, int frame_height)
+//{
+//	if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_UNKNOWN))
+//    {
+//		return 0;
+//    }
+//	switch (mpeg_version) {
+//	case 1:
+//		if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_SQUARE))
+//		{
+//			return 1;
+//		} 
+//		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_NTSC_CCIR601))
+//		{
+//			return 12;
+//		} 
+//		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_NTSC_16_9))
+//		{
+//			return 6;
+//		} 
+//		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_PAL_CCIR601))
+//		{
+//			return 8;
+//		} 
+//		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_PAL_16_9))
+//		{
+//			return 3;
+//		} 
+//		return 0;
+//		break;
+//	case 2:
+//		if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_SQUARE))
+//		{
+//			return 1;  /* '1' means square *pixels* in MPEG-2; go figure. */
+//		}
+//		else
+//		{
+//			int i;
+//			double true_far;  /* true frame aspect ratio */
+//			true_far = 
+//				(double)(sampleaspect.n * frame_width) /
+//				(double)(sampleaspect.d * frame_height);
+//			/* start at '2'... */
+//			for (i = 2; i < (int)(mpeg_num_aspect_ratios[mpeg_version-1]); i++) 
+//			{
+//				double ratio = 
+//					true_far / Y4M_RATIO_DBL(mpeg_aspect_ratios[mpeg_version-1][i]);
+//				if ( (ratio > (1.0 - GUESS_ASPECT_TOLERANCE)) &&
+//					 (ratio < (1.0 + GUESS_ASPECT_TOLERANCE)) )
+//					return i;
+//			}
+//			return 0;
+//		}
+//		break;
+//	default:
+//		return 0;
+//		break;
+//	}
+//}
+//
+//
+//
+//
+///*
+// * Guess the true sample aspect ratio of a video stream,
+// *  given the MPEG aspect ratio code and the actual frame size
+// *  (and the MPEG version, 1 or 2).
+// *
+// * Returns y4m_sar_UNKNOWN if it has no good guess.
+// *
+// */
+//y4m_ratio_t 
+//mpeg_guess_sample_aspect_ratio(int mpeg_version,
+//							   mpeg_aspect_code_t code,
+//							   int frame_width, int frame_height)
+//{
+//	switch (mpeg_version) 
+//	{
+//	case 1:
+//		/* MPEG-1 codes turn into SAR's, just not quite the right ones.
+//		   For the common/known values, we provide the ratio used in practice,
+//		   otherwise say we don't know.*/
+//		switch (code)
+//		{
+//		case 1:  return y4m_sar_SQUARE;        break;
+//		case 3:  return y4m_sar_PAL_16_9;      break;
+//		case 6:  return y4m_sar_NTSC_16_9;     break;
+//		case 8:  return y4m_sar_PAL_CCIR601;   break;
+//		case 12: return y4m_sar_NTSC_CCIR601;  break;
+//		default:
+//			return y4m_sar_UNKNOWN;       break;
+//		}
+//		break;
+//	case 2:
+//		/* MPEG-2 codes turn into Display Aspect Ratios, though not exactly the
+//		   DAR's used in practice.  For common/standard frame sizes, we provide
+//		   the original SAR; otherwise, we say we don't know. */
+//		if (code == 1) 
+//		{
+//			return y4m_sar_SQUARE; /* '1' means square *pixels* in MPEG-2 */
+//		}
+//		else if ((code >= 2) && (code <= 4))
+//		{
+//            return y4m_guess_sar(frame_width, frame_height,
+//                                 mpeg2_aspect_ratios[code]);
+//		} 
+//		else
+//		{
+//			return y4m_sar_UNKNOWN;
+//		}
+//		break;
+//	default:
+//		return y4m_sar_UNKNOWN;
+//		break;
+//	}
+//}
+//
+//
+//
+//
+//
+///*
+// * Look-up MPEG explanatory definition string for frame rate code
+// *
+// */
+//
+//
+//const char *
+//mpeg_framerate_code_definition(   mpeg_framerate_code_t code  )
+//{
+//	if( code == 0 || code >=  mpeg_num_framerates )
+//		return "UNDEFINED: illegal/reserved frame-rate ratio code";
+//
+//	return framerate_definitions[code];
+//}
 
-// y4m_ratio_t 
-// mpeg_aspect_ratio( int mpeg_version,  mpeg_aspect_code_t code )
-// {
-// 	y4m_ratio_t ratio;
-//     if ((mpeg_version >= 1) && (mpeg_version <= 2) &&
-//         (code > 0) && (code < mpeg_num_aspect_ratios[mpeg_version-1]))
-// 	{
-// 		ratio = mpeg_aspect_ratios[mpeg_version-1][code];
-// 		y4m_ratio_reduce(&ratio);
-// 		return ratio;
-// 	}
-//     else
-// 		return y4m_sar_UNKNOWN;
-// }
-// 
-// 
-
 /*
- * Look-up corresponding MPEG aspect ratio code given an exact aspect ratio.
+ * Look-up MPEG explanatory definition string aspect ratio code for an
+ * aspect ratio code
  *
- * WARNING: The semantics of aspect ratio coding *changed* between
- * MPEG1 and MPEG2.  In MPEG1 it is the *pixel* aspect ratio. In
- * MPEG2 it is the (far more sensible) aspect ratio of the eventual
- * display.
- *
  */
-// 
-// mpeg_aspect_code_t 
-// mpeg_frame_aspect_code( int mpeg_version, y4m_ratio_t aspect_ratio )
-// {
-// 	mpeg_aspect_code_t i;
-// 	y4m_ratio_t red_ratio = aspect_ratio;
-// 	y4m_ratio_reduce( &red_ratio );
-// 	if( mpeg_version < 1 || mpeg_version > 2 )
-// 		return 0;
-//     /* (start at '1', because 0 is unknown/illegal) */
-// 	for( i = 1; i < mpeg_num_aspect_ratios[mpeg_version-1]; ++i )
-// 	{
-// 		y4m_ratio_t red_entry =  mpeg_aspect_ratios[mpeg_version-1][i];
-// 		y4m_ratio_reduce( &red_entry );
-// 		if(  Y4M_RATIO_EQL( red_entry, red_ratio) )
-// 			return i;
-// 	}
-// 
-// 	return 0;
-// 			
-// }
 
+const char *
+MX_mpeg_aspect_code_definition( int mpeg_version,  mpeg_aspect_code_t code  )
+{
+	if( mpeg_version < 1 || mpeg_version > 2 )
+		return "UNDEFINED: illegal MPEG version";
+	
+	if( code < 1 || code >=  mpeg_num_aspect_ratios[mpeg_version-1] )
+		return "UNDEFINED: illegal aspect ratio code";
 
+	return aspect_ratio_definitions[mpeg_version-1][code];
+}
 
-/*
- * Guess the correct MPEG aspect ratio code,
- *  given the true sample aspect ratio and frame size of a video stream
- *  (and the MPEG version, 1 or 2).
- *
- * Returns 0 if it has no good guess.
- *
- */
 
+///*
+// * Look-up explanatory definition of interlace field order code
+// *
+// */
+//
+//const char *
+//mpeg_interlace_code_definition( int yuv4m_interlace_code )
+//{
+//	const char *def;
+//	switch( yuv4m_interlace_code )
+//	{
+//	case Y4M_UNKNOWN :
+//		def = "unknown";
+//		break;
+//	case Y4M_ILACE_NONE :
+//		def = "none/progressive";
+//		break;
+//	case Y4M_ILACE_TOP_FIRST :
+//		def = "top-field-first";
+//		break;
+//	case Y4M_ILACE_BOTTOM_FIRST :
+//		def = "bottom-field-first";
+//		break;
+//	default :
+//		def = "UNDEFINED: illegal video interlacing type-code!";
+//		break;
+//	}
+//	return def;
+//}
 
-/* this is big enough to accommodate the difference between 720 and 704 */
-#define GUESS_ASPECT_TOLERANCE 0.03
-
-// mpeg_aspect_code_t 
-// mpeg_guess_mpeg_aspect_code(int mpeg_version, y4m_ratio_t sampleaspect,
-// 							int frame_width, int frame_height)
-// {
-// 	if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_UNKNOWN))
-//     {
-// 		return 0;
-//     }
-// 	switch (mpeg_version) {
-// 	case 1:
-// 		if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_SQUARE))
-// 		{
-// 			return 1;
-// 		} 
-// 		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_NTSC_CCIR601))
-// 		{
-// 			return 12;
-// 		} 
-// 		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_NTSC_16_9))
-// 		{
-// 			return 6;
-// 		} 
-// 		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_PAL_CCIR601))
-// 		{
-// 			return 8;
-// 		} 
-// 		else if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_PAL_16_9))
-// 		{
-// 			return 3;
-// 		} 
-// 		return 0;
-// 		break;
-// 	case 2:
-// 		if (Y4M_RATIO_EQL(sampleaspect, y4m_sar_SQUARE))
-// 		{
-// 			return 1;  /* '1' means square *pixels* in MPEG-2; go figure. */
-// 		}
-// 		else
-// 		{
-// 			int i;
-// 			double true_far;  /* true frame aspect ratio */
-// 			true_far = 
-// 				(double)(sampleaspect.n * frame_width) /
-// 				(double)(sampleaspect.d * frame_height);
-// 			/* start at '2'... */
-// 			for (i = 2; i < (int)(mpeg_num_aspect_ratios[mpeg_version-1]); i++) 
-// 			{
-// 				double ratio = 
-// 					true_far / Y4M_RATIO_DBL(mpeg_aspect_ratios[mpeg_version-1][i]);
-// 				if ( (ratio > (1.0 - GUESS_ASPECT_TOLERANCE)) &&
-// 					 (ratio < (1.0 + GUESS_ASPECT_TOLERANCE)) )
-// 					return i;
-// 			}
-// 			return 0;
-// 		}
-// 		break;
-// 	default:
-// 		return 0;
-// 		break;
-// 	}
-// }
-// 
-// 
-// 
-// 
-// /*
-//  * Guess the true sample aspect ratio of a video stream,
-//  *  given the MPEG aspect ratio code and the actual frame size
-//  *  (and the MPEG version, 1 or 2).
-//  *
-//  * Returns y4m_sar_UNKNOWN if it has no good guess.
-//  *
-//  */
-// y4m_ratio_t 
-// mpeg_guess_sample_aspect_ratio(int mpeg_version,
-// 							   mpeg_aspect_code_t code,
-// 							   int frame_width, int frame_height)
-// {
-// 	switch (mpeg_version) 
-// 	{
-// 	case 1:
-// 		/* MPEG-1 codes turn into SAR's, just not quite the right ones.
-// 		   For the common/known values, we provide the ratio used in practice,
-// 		   otherwise say we don't know.*/
-// 		switch (code)
-// 		{
-// 		case 1:  return y4m_sar_SQUARE;        break;
-// 		case 3:  return y4m_sar_PAL_16_9;      break;
-// 		case 6:  return y4m_sar_NTSC_16_9;     break;
-// 		case 8:  return y4m_sar_PAL_CCIR601;   break;
-// 		case 12: return y4m_sar_NTSC_CCIR601;  break;
-// 		default:
-// 			return y4m_sar_UNKNOWN;       break;
-// 		}
-// 		break;
-// 	case 2:
-// 		/* MPEG-2 codes turn into Display Aspect Ratios, though not exactly the
-// 		   DAR's used in practice.  For common/standard frame sizes, we provide
-// 		   the original SAR; otherwise, we say we don't know. */
-// 		if (code == 1) 
-// 		{
-// 			return y4m_sar_SQUARE; /* '1' means square *pixels* in MPEG-2 */
-// 		}
-// 		else if ((code >= 2) && (code <= 4))
-// 		{
-//             return y4m_guess_sar(frame_width, frame_height,
-//                                  mpeg2_aspect_ratios[code]);
-// 		} 
-// 		else
-// 		{
-// 			return y4m_sar_UNKNOWN;
-// 		}
-// 		break;
-// 	default:
-// 		return y4m_sar_UNKNOWN;
-// 		break;
-// 	}
-// }
-// 
-// 
-// 
-// 
-// 
-// /*
-//  * Look-up MPEG explanatory definition string for frame rate code
-//  *
-//  */
-// 
-// 
-// const char *
-// mpeg_framerate_code_definition(   mpeg_framerate_code_t code  )
-// {
-// 	if( code == 0 || code >=  mpeg_num_framerates )
-// 		return "UNDEFINED: illegal/reserved frame-rate ratio code";
-// 
-// 	return framerate_definitions[code];
-// }
-// 
-// /*
-//  * Look-up MPEG explanatory definition string aspect ratio code for an
-//  * aspect ratio code
-//  *
-//  */
-// 
-// const char *
-// mpeg_aspect_code_definition( int mpeg_version,  mpeg_aspect_code_t code  )
-// {
-// 	if( mpeg_version < 1 || mpeg_version > 2 )
-// 		return "UNDEFINED: illegal MPEG version";
-// 	
-// 	if( code < 1 || code >=  mpeg_num_aspect_ratios[mpeg_version-1] )
-// 		return "UNDEFINED: illegal aspect ratio code";
-// 
-// 	return aspect_ratio_definitions[mpeg_version-1][code];
-// }
-// 
-// 
-// /*
-//  * Look-up explanatory definition of interlace field order code
-//  *
-//  */
-// 
-// const char *
-// mpeg_interlace_code_definition( int yuv4m_interlace_code )
-// {
-// 	const char *def;
-// 	switch( yuv4m_interlace_code )
-// 	{
-// 	case Y4M_UNKNOWN :
-// 		def = "unknown";
-// 		break;
-// 	case Y4M_ILACE_NONE :
-// 		def = "none/progressive";
-// 		break;
-// 	case Y4M_ILACE_TOP_FIRST :
-// 		def = "top-field-first";
-// 		break;
-// 	case Y4M_ILACE_BOTTOM_FIRST :
-// 		def = "bottom-field-first";
-// 		break;
-// 	default :
-// 		def = "UNDEFINED: illegal video interlacing type-code!";
-// 		break;
-// 	}
-// 	return def;
-// }
-// 
-// 
+
 /* 
  * Local variables:
  *  c-file-style: "stroustrup"

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/mpegconsts.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,165 @@
+
+/*
+ *  mpegconsts.c:  Video format constants for MPEG and utilities for display
+ *                 and conversion to format used for yuv4mpeg
+ *
+ *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of version 2 of the GNU General Public License
+ *  as published by the Free Software Foundation.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ */
+
+#ifndef __MPEGCONSTS_H__
+#define __MPEGCONSTS_H__
+
+#include <yuv4mpeg.h>
+
+typedef unsigned int mpeg_framerate_code_t;
+typedef unsigned int mpeg_aspect_code_t;
+
+#ifdef __cplusplus
+#define START_CPP_WRAP extern "C" {
+#define END_CPP_WRAP };
+#else
+#define START_CPP_WRAP
+#define END_CPP_WRAP
+#endif
+
+START_CPP_WRAP
+
+
+/*
+ * Convert MPEG frame-rate code to corresponding frame-rate
+ *  y4m_fps_UNKNOWN = { 0, 0 } = Undefined/resrerved code.
+ */
+
+y4m_ratio_t
+MX_mpeg_framerate( mpeg_framerate_code_t code );
+
+
+/*
+ * Is code a valid MPEG frame-rate code?
+ * Return 1 if true; 0 otherwise.
+ */
+
+int
+MX_mpeg_valid_framerate_code( mpeg_framerate_code_t code );
+
+
+///*
+// * Look-up MPEG frame rate code for a (exact) frame rate.
+// *  0 = No MPEG code defined for frame-rate
+// */
+//
+//mpeg_framerate_code_t 
+//mpeg_framerate_code( y4m_ratio_t framerate );
+//
+//
+///*
+// * Convert floating-point framerate to an exact ratio.
+// *  Uses a standard MPEG rate, if it finds one within MPEG_FPS_TOLERANCE
+// *  (see mpegconsts.c), otherwise uses "fps:1000000" as the ratio.
+// */
+//
+//y4m_ratio_t
+//mpeg_conform_framerate( double fps );
+//
+//
+///*
+// * Convert MPEG aspect ratio code to corresponding aspect ratio
+// *
+// * WARNING: The semantics of aspect ratio coding *changed* between
+// * MPEG1 and MPEG2.  In MPEG1 it is the *pixel* aspect ratio. In
+// * MPEG2 it is the (far more sensible) aspect ratio of the eventual
+// * display.
+// *
+// */
+//
+//y4m_ratio_t
+//mpeg_aspect_ratio( int mpeg_version,  mpeg_aspect_code_t code );
+
+
+/*
+ * Is code a valid MPEG(1,2) aspect-ratio code?
+ * Return 1 if true; 0 otherwise.
+ */
+
+int
+MX_mpeg_valid_aspect_code( int mpeg_version, mpeg_aspect_code_t code );
+
+
+///*
+// * Look-up MPEG aspect ratio code for an aspect ratio - tolerance
+// * is Y4M_ASPECT_MULT used by YUV4MPEG (see yuv4mpeg_intern.h)
+// *
+// * WARNING: The semantics of aspect ratio coding *changed* between
+// * MPEG1 and MPEG2.  In MPEG1 it is the *pixel* aspect ratio. In
+// * MPEG2 it is the (far more sensible) aspect ratio of the eventual
+// * display.
+// *
+// */
+//
+//mpeg_aspect_code_t 
+//mpeg_frame_aspect_code( int mpeg_version, y4m_ratio_t aspect_ratio );
+
+/*
+ * Look-up MPEG explanatory definition string aspect ratio code for an
+ * aspect ratio code
+ *
+ */
+
+const char *
+MX_mpeg_aspect_code_definition( int mpeg_version,  mpeg_aspect_code_t code  );
+
+///*
+// * Look-up MPEG explanatory definition string aspect ratio code for an
+// * frame rate code
+// *
+// */
+//
+//const char *
+//mpeg_framerate_code_definition( mpeg_framerate_code_t code  );
+//
+//const char *
+//mpeg_interlace_code_definition( int yuv4m_interlace_code );
+//
+//
+///*
+// * Guess the correct MPEG aspect ratio code,
+// *  given the true sample aspect ratio and frame size of a video stream
+// *  (and the MPEG version, 1 or 2).
+// *
+// * Returns 0 if it has no good answer.
+// *
+// */
+//mpeg_aspect_code_t 
+//mpeg_guess_mpeg_aspect_code(int mpeg_version, y4m_ratio_t sampleaspect,
+//			    int frame_width, int frame_height);
+//
+///*
+// * Guess the true sample aspect ratio of a video stream,
+// *  given the MPEG aspect ratio code and the actual frame size
+// *  (and the MPEG version, 1 or 2).
+// *
+// * Returns y4m_sar_UNKNOWN if it has no good answer.
+// *
+// */
+//y4m_ratio_t 
+//mpeg_guess_sample_aspect_ratio(int mpeg_version,
+//			       mpeg_aspect_code_t code,
+//			       int frame_width, int frame_height);
+
+END_CPP_WRAP
+
+#endif /* __MPEGCONSTS_H__ */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -18,7 +18,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-
+#define STREAM_LOGGING
 #include <config.h>
 #include <math.h>
 #include <stdlib.h>
@@ -36,9 +36,6 @@
 #endif
 #include "multiplexor.hpp"
 
-#define MAX_UNDERRUN 10
-//#define mjpeg_info mjpeg_warn
-//#define STREAM_LOGGING 1
 
 /****************
  *
@@ -50,9 +47,6 @@
 
 Multiplexor::Multiplexor(MultiplexJob &job, OutputStream &output)
 {
-
-        
-
     underrun_ignore = 0;
     underruns = 0;
 	start_of_new_pack = false;
@@ -63,15 +57,7 @@
 
 }
 
-void Multiplexor::Close(void)
-{
-	std::vector<ElementaryStream *>::iterator str;
 
-	for( str = estreams.begin(); str < estreams.end(); ++str )
-		delete (*str);
-}
-
-
 /******************************************************************
  *
  * Initialisation of stream syntax paramters based on selected user
@@ -105,10 +91,9 @@
 	{
 	case MPEG_FORMAT_VCD :
 		data_rate = 75*2352;  			 /* 75 raw CD sectors/sec */ 
-	  	vbr = false;
- 
 	case MPEG_FORMAT_VCD_NSR : /* VCD format, non-standard rate */
 		mjpeg_info( "Selecting VCD output profile");
+		video_buffers_iframe_only = false;
 		mpeg = 1;
 	 	packets_per_pack = 1;
 	  	sys_header_in_pack1 = 0;
@@ -127,6 +112,11 @@
 		sector_align_iframeAUs = false;
         timestamp_iframe_only = false;
 		seg_starts_with_video = true;
+        if( job.video_tracks == 0 )
+        {
+            mjpeg_info( "Audio-only VCD track - variable-bit-rate (VCD2.0)");
+            vbr = true;
+        }
 		break;
 		
 	case  MPEG_FORMAT_MPEG2 : 
@@ -143,9 +133,10 @@
 		buffers_in_audio = 1;
 		always_buffers_in_audio = 1;
 		vcd_zero_stuffing = 0;
-        dtspts_for_all_vau = 0;
-        timestamp_iframe_only = false;
-        video_buffers_iframe_only = false;
+		vbr = true;
+        	dtspts_for_all_vau = 0;
+        	timestamp_iframe_only = false;
+        	video_buffers_iframe_only = false;
 		break;
 
 	case MPEG_FORMAT_SVCD :
@@ -281,7 +272,6 @@
         video_buffers_iframe_only = false;
 		break;
 	}
-	
 }
 
 /**************************************
@@ -387,10 +377,6 @@
 	std::vector<VideoParams *>::iterator vidparm = job.video_param.begin();
 	std::vector<LpcmParams *>::iterator lpcmparm = job.lpcm_param.begin();
 
-    if( job.video_tracks < 1 && job.mux_format == MPEG_FORMAT_VCD )
-    {
-        mjpeg_warn( "Multiplexing audio-only for a standard VCD is very inefficient");
-    }
 
     std::vector<JobStream *>::iterator i;
     for( i = job.streams.begin() ; i < job.streams.end() ; ++i )
@@ -760,7 +746,7 @@
 			mjpeg_log( level,
 					   "Video %02x: buf=%7d frame=%06d sector=%08d",
 					   (*str)->stream_id,
-					   (*str)->bufmodel.Space(),
+					   (*str)->BufferSize()-(*str)->bufmodel.Space(),
 					   (*str)->DecodeOrder(),
 					   (*str)->nsec
 				);
@@ -769,7 +755,7 @@
 			mjpeg_log( level,
 					   "Audio %02x: buf=%7d frame=%06d sector=%08d",
 					   (*str)->stream_id,
-					   (*str)->bufmodel.Space(),
+					   (*str)->BufferSize()-(*str)->bufmodel.Space(),
 					   (*str)->DecodeOrder(),
 					   (*str)->nsec
 				);
@@ -839,6 +825,9 @@
 		{
 				mjpeg_error_exit1("VCD man only have max. 1 audio and 1 video stream");
 		}
+
+        if( vstreams.size() > 0 )
+        {
 		/* First packet carries video-info-only sys_header */
 		psstrm->CreateSysHeader (&sys_header, mux_rate, 
 								 false, true, 
@@ -846,15 +835,20 @@
 		sys_header_ptr = &sys_header;
 		pack_header_ptr = &pack_header;
 	  	OutputPadding( false);		
+        }
 
-		/* Second packet carries audio-info-only sys_header */
-		psstrm->CreateSysHeader (&sys_header, mux_rate,  
-                                 false, true, 
-								 true, true, amux );
-		sys_header_ptr = &sys_header;
-		pack_header_ptr = &pack_header;
-	  	OutputPadding( true );
-		break;
+        if( astreams.size() > 0 )
+        {
+
+            /* Second packet carries audio-info-only sys_header */
+            psstrm->CreateSysHeader (&sys_header, mux_rate,  
+                                     false, true, 
+                                     true, true, amux );
+            sys_header_ptr = &sys_header;
+            pack_header_ptr = &pack_header;
+            OutputPadding( true );
+        }
+        break;
 		
 	case MPEG_FORMAT_SVCD :
 	case MPEG_FORMAT_SVCD_NSR :
@@ -1134,25 +1128,25 @@
                 mjpeg_info( "Starting new output file...");
                 psstrm->NextSegment();
 			}
-			else if( master != 0 && master->EndSeq() )
+			else if( master != 0 && master->SeqEndRunOut() )
 			{
-				if(  split_at_seq_end && master->Lookahead( ) != 0 )
+                const AUnit *nextIframe = master->NextIFrame();
+				if(  split_at_seq_end && nextIframe != 0)
 				{
-					if( ! master->SeqHdrNext() || 
-						master->NextAUType() != IFRAME)
-					{
-						mjpeg_error_exit1( "Sequence split detected %d but no following sequence found...", master->NextAUType());
-					}
-						
-					runout_PTS = master->NextRequiredPTS();
-                    mjpeg_info( "Running out...");
-                    mjpeg_debug("Run out PTS limit to %lld SCR=%lld", 
-                                runout_PTS/300, 
-                                current_SCR/300 );
+					runout_PTS = master->RequiredPTS(nextIframe);
+                    mjpeg_info( "Sequence end marker! Running out...");
+                    mjpeg_info("Run out PTS limit to AU %d %lld SCR=%lld", 
+                               nextIframe->dorder,
+                               runout_PTS/300, 
+                               current_SCR/300 );
                     MuxStatus( LOG_INFO );
 					running_out = true;
 					seg_state = runout_segment;
 				}
+                else
+                {
+                    mjpeg_warn( "Sequence end without following I-frame!" );
+                }
 			}
 			break;
 			
@@ -1176,11 +1170,14 @@
 		for( str = estreams.begin(); str < estreams.end(); ++str )
 		{
 #ifdef STREAM_LOGGING
-            mjpeg_warn("STREAM %02x: SCR=%lld mux=%d reqDTS=%lld", 
+            mjpeg_debug("%02x: SCR=%lld (%.3f) mux=%d %d reqDTS=%lld ", 
                         (*str)->stream_id,
-                        current_SCR /300,
+                        current_SCR,
+                        static_cast<double>(current_SCR) /(90.0*300.0),
                         (*str)->MuxPossible(current_SCR),
+                        (*str)->BufferSize()-(*str)->bufmodel.Space(),
                         (*str)->RequiredDTS()/300
+                        
 				);
 #endif
 			if( (*str)->MuxPossible(current_SCR) && 
@@ -1202,22 +1199,19 @@
 		{
 			despatch->BufferAndOutputSector();
 			video_first = false;
-#if 0                        
+			if( current_SCR >=  earliest && underrun_ignore == 0)
+			{
 				mjpeg_warn( "Stream %02x: data will arrive too late sent(SCR)=%lld required(DTS)=%lld", 
 							despatch->stream_id, 
 							current_SCR/300, 
 							earliest/300 );
-#endif                                                        
 				MuxStatus( LOG_WARN );
-                        if( current_SCR >=  earliest && underrun_ignore == 0)
-                        {
-                                                        
 				// Give the stream a chance to recover
 				underrun_ignore = 300;
 				++underruns;
-				if( underruns > MAX_UNDERRUN  )
+				if( underruns > 10  )
 				{
-					//mjpeg_error_exit1("Too many frame drops -exiting" );
+					mjpeg_error_exit1("Too many frame drops -exiting" );
 				}
 			}
             if( despatch->nsec > 50 &&
@@ -1245,8 +1239,11 @@
                 {
                     clockticks change_time = (*str)->bufmodel.NextChange();
                     if( next_change == 0 || change_time < next_change )
+                    {
                         next_change = change_time;
+                    }
                 }
+
                 unsigned int bumps = 5;
                 while( bumps > 0 
                        && next_change > current_SCR + ticks_per_sector)
@@ -1254,6 +1251,7 @@
                     NextPosAndSCR();
                     --bumps;
                 }
+                            
             }
             else
             {
@@ -1312,11 +1310,11 @@
 
     if( underruns> 0 )
 	{
-		mjpeg_warn( "MUX STATUS: Frame data under-runs detected!" );
+		mjpeg_error_exit1( "MUX STATUS: Frame data under-runs detected!" );
 	}
 	else
 	{
-		mjpeg_warn( "MUX STATUS: no under-runs detected.");
+		mjpeg_info( "MUX STATUS: no under-runs detected.");
 	}
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/multiplexor.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -13,11 +13,14 @@
 class Multiplexor
 {
 public:
-	Multiplexor(MultiplexJob &job, OutputStream &output);	
-	void Close(void);
+	Multiplexor(MultiplexJob &job, OutputStream &output);
 	void Multiplex ();
-	void ByteposTimecode( bitcount_t bytepos, clockticks &ts );	
+
+
+	void ByteposTimecode( bitcount_t bytepos, clockticks &ts );
+	
 	inline Sys_header_struc *SystemHeader() { return &sys_header; }
+
 	unsigned int PacketPayload(	MuxStream &strm,
 								bool buffers, bool PTSstamp, bool DTSstamp );
 	unsigned int WritePacket( unsigned int     max_packet_data_size,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/padstrm.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/padstrm.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/padstrm.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -35,7 +35,7 @@
 
 unsigned int PaddingStream::ReadPacketPayload(uint8_t *dst, unsigned int to_read)
 {
-	memset( dst, 0, to_read );
+	memset( dst, STUFFING_BYTE, to_read );
 	return to_read;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -37,7 +37,6 @@
 	int buffer_size = -1;
 
 	SetBufSize( 4*1024*1024 );
-	InitAUbuffer();
 	ScanFirstSeqHeader();
 
 	mjpeg_debug( "Stills: Video buffer suggestion ignored!" );
@@ -110,7 +109,7 @@
  *
  */
 
-void StillsStream::NextDTSPTS( clockticks &DTS, clockticks &PTS )
+void StillsStream::NextDTSPTS( )
 {
     StillsParams *sparms = static_cast<StillsParams*>(parms);
 
@@ -119,11 +118,11 @@
 	clockticks time_for_xfer;
 	muxinto.ByteposTimecode( BufferSize(), time_for_xfer );
 		
-	DTS = current_PTS + time_for_xfer;	// This frame decoded just after
+	access_unit.DTS = current_PTS + time_for_xfer;	// This frame decoded just after
 	                                    // Predecessor completed.
-	PTS = current_PTS + time_for_xfer + interval;
-	current_PTS = PTS;
-	current_DTS = DTS;
+	access_unit.PTS = current_PTS + time_for_xfer + interval;
+	current_PTS = access_unit.PTS;
+	current_DTS = access_unit.DTS;
     fields_presented += 2;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stillsstream.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -40,7 +40,7 @@
 		{}
 	void Init( );
 private:
-	virtual void NextDTSPTS( clockticks &DTS, clockticks &PTS );
+	virtual void NextDTSPTS( );
 	clockticks current_PTS;
 	clockticks current_DTS;
 };

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,22 +0,0 @@
-#ifndef STREAM_TYPE_H
-#define STREAM_TYPE_H
-enum StreamKind
-  {
-      MPEG_AUDIO=1,
-      AC3_AUDIO,
-      LPCM_AUDIO,
-      DTS_AUDIO,
-      MPEG_VIDEO
-#ifdef ZALPHA
-        ,
-      Z_ALPHA
-#endif
-  };
-
-typedef struct mplexStreamDescriptor
-{
-  int channel;
-  int frequency;
-  StreamKind kind;
-}mplexStreamDescriptor;
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stream_params.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stream_params.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/stream_params.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,5 +1,5 @@
 /*
- * params.hpp:  User specifiable parameter classes for various types of stream
+ * streamparams.hpp:  User specifiable parameter classes for various types of stream
  *
  * The class constructors etc are defined so that it is impossible to build
  * objects with illegal combinations of constructors.

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/systems.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/systems.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/systems.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -25,17 +25,11 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#if 0
-#ifdef _WIN32
-#include <win32defs.h>
-#else
+
 #include <sys/param.h>
-#endif
-#endif
 #include "systems.hpp"
 #include "mplexconsts.hpp"
 
-
 PS_Stream:: PS_Stream( unsigned _mpeg,
                        unsigned int _sector_size,
                        OutputStream &_output_strm, 
@@ -59,13 +53,7 @@
 PS_Stream::SegmentLimReached()
 {
 	off_t written = output_strm.SegmentSize();
-	if(!max_segment_size) return false;
-	if(written > max_segment_size)
-	{
-        printf("Mplex: current:%d max:%d, switching seg\n",written,max_segment_size);
-        return true;	
-	}
-	return false;
+	return max_segment_size != 0 && written > max_segment_size;
 }
 
 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,24 +0,0 @@
-#include <config.h>
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#include "mjpeg_types.h"
-#include "vector.hpp"
-
-
-const unsigned int AUStream::BUF_SIZE = 128;
-
-AUStream::AUStream() : 
-	cur_rd( 0 ), cur_wr(0), totalctr(0), size(0), 
-	buf(AUStream::BUF_SIZE)
-{
-}
-
-
-void AUStream::init( Aunit *rec )
-{
-	buf[cur_wr] = rec;
-	++cur_wr;
-	cur_wr = cur_wr >= AUStream::BUF_SIZE ? 0 : cur_wr;
-	cur_rd = cur_wr;
-}

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/vector.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,78 +0,0 @@
-#ifndef __AUSTREAM_H__
-#define __AUSTREAM_H__
-
-#include <vector>
-#include "mjpeg_logging.h"
-#include "aunit.hpp"
-
-class AUStream
-{
-public:
-	// TODO The buffer should be delete-ed on destruction...
-	AUStream();
-	void init( Aunit *rec );
-
-	void append( Aunit &rec )
-	{
-		if( size == BUF_SIZE )
-			mjpeg_error_exit1( "INTERNAL ERROR: AU buffer overflow" );
-		*buf[cur_wr] = rec;
-		++size;
-		++cur_wr;
-		cur_wr = cur_wr >= BUF_SIZE ? 0 : cur_wr;
-	}
-
-	inline Aunit *next( ) 
-	{ 
-		if( size==0 )
-		{
-			return 0;
-		}
-	    else
-		{
-			Aunit *ret;
-			ret = buf[cur_rd];
-			++cur_rd;
-			++totalctr;
-			--size;
-			cur_rd = cur_rd >= BUF_SIZE ? 0 : cur_rd;
-			return ret;
-		}
-	}
-
-	inline void droplast()
-		{
-			if( size == 0 )
-				mjpeg_error_exit1( "INTERNAL ERROR: droplast empty AU buffer" );
-			--size;
-			if( cur_wr == 0 )
-				cur_wr = BUF_SIZE ;
-			--cur_wr;
-		}
-
-	inline Aunit *lookahead( )
-	{
-		return size == 0 ? 0 : buf[cur_rd];
-    }
-
-	inline Aunit *last()
-		{
-			int i = cur_wr < 1 ? BUF_SIZE-1 : cur_wr-1;
-			return buf[i];
-		}
-
-	static const unsigned int BUF_SIZE;
-
-	inline unsigned int current() { return totalctr; }
-private:
-	unsigned int cur_rd;
-	unsigned int cur_wr;
-	unsigned int totalctr;
-	unsigned int size;
-	std::vector<AunitPtr> buf;
-};
-
-
-
-
-#endif // __AUSTREAM_H__

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -32,34 +32,28 @@
 	VideoStream(IBitStream &ibs, VideoParams *parms, 
                 Multiplexor &into);
 	void Init( const int stream_num );
+
     static bool Probe(IBitStream &bs );
 
 	void Close();
 
-	inline int AUType()
-		{
-			return au->type;
-		}
+    inline int DecoderOrder() { return au->dorder; }
+	inline int AUType()	{ return au->type; }
 
-	inline bool EndSeq()
-		{
-			return au->end_seq;
-		}
+    bool SeqEndRunOut();
 
+    const AUnit *NextIFrame();
+
+
 	inline int NextAUType()
 		{
-			VAunit *p_au = Lookahead();
-			if( p_au != NULL )
+			AUnit *p_au = Lookahead();
+			if( p_au != 0 )
 				return p_au->type;
 			else
 				return NOFRAME;
 		}
 
-	inline bool SeqHdrNext()
-		{
-			VAunit *p_au = Lookahead();
-			return  p_au != NULL && p_au->seq_header;
-		}
 
 	virtual unsigned int NominalBitRate() 
 		{ 
@@ -69,26 +63,30 @@
     virtual void OutputGOPControlSector();
 	bool RunOutComplete();
 	virtual bool MuxPossible(clockticks currentSCR);
+    virtual void AUMuxed( bool first_in_sector ) ;
+
     void SetMaxStdBufferDelay( unsigned int demux_rate );
 	void OutputSector();
 
+
 protected:
+    static const unsigned int MAX_GOP_LENGTH = 128;
 	void OutputSeqhdrInfo();
-    virtual bool AUBufferNeedsRefill();
 	virtual void FillAUbuffer(unsigned int frames_to_buffer);
-	virtual void InitAUbuffer();
-	virtual void NextDTSPTS( clockticks &DTS, clockticks &PTS );
+	virtual void NextDTSPTS(  );
 	void ScanFirstSeqHeader();
     uint8_t NewAUTimestamps( int AUtype );
     bool NewAUBuffers( int AUtype );
 
+    unsigned int ExcludeNextIFramePayload();
+
 public:	
     unsigned int num_sequence 	;
     unsigned int num_seq_end	;
     unsigned int num_pictures 	;
     unsigned int num_groups 	;
     unsigned int num_frames[4] 	;
-    unsigned int avg_frames[4]  ;
+         int64_t avg_frames[4]  ;
     
     unsigned int horizontal_size;
     unsigned int vertical_size 	;
@@ -106,8 +104,9 @@
 
 protected:
 
+
 	/* State variables for scanning source bit-stream */
-    VAunit access_unit;
+    AUnit access_unit;
 	int fields_presented;
     int group_start_pic;
 	int group_start_field;
@@ -117,6 +116,8 @@
 	int pulldown_32;
 	int repeat_first_field;
 	int prev_temp_ref;
+    int ref_present;
+    int prev_ref_present;
     double frame_rate;
 	double max_bits_persec;
 	int AU_pict_data;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -27,8 +27,8 @@
 #include "interact.hpp"
 #include "multiplexor.hpp"
 
-#define mjpeg_info mjpeg_warn
 
+
 static void marker_bit (IBitStream &bs, unsigned int what)
 {
     if (what != bs.Get1Bit())
@@ -59,9 +59,9 @@
 		exit (1);
     }
 
-	if (mpeg_valid_framerate_code(picture_rate))
+	if (MX_mpeg_valid_framerate_code(picture_rate))
     {
-		frame_rate = Y4M_RATIO_DBL(mpeg_framerate(picture_rate));
+		frame_rate = Y4M_RATIO_DBL(MX_mpeg_framerate(picture_rate));
 	}
     else
     {
@@ -86,7 +86,6 @@
                 VIDEO_STR_0+stream_num,
                 bs.StreamName()
                 );
-	InitAUbuffer();
 
 	SetBufSize( 4*1024*1024 );
 	ScanFirstSeqHeader();
@@ -97,6 +96,9 @@
 	AU_pict_data = 0;
 	AU_start = 0;
     
+    fields_presented = 0;
+    group_start_pic = 0;
+    group_start_field = 0;
     OutputSeqhdrInfo();
 }
 
@@ -128,23 +130,7 @@
 
 }
 
-//
-// Return whether AU buffer needs refilling.  There are two cases:
-// 1. We have less than our look-ahead "FRAME_CHUNK" buffer AU's
-// buffered 2. AU's are very small and we could have less than 1
-// sector's worth of data buffered.
-//
 
-bool VideoStream::AUBufferNeedsRefill()
-{
-    return 
-        !eoscan
-        && ( aunits.current()+FRAME_CHUNK > last_buffered_AU
-             ||
-             bs.BufferedBytes() < muxinto.sector_size 
-            );
-}
-
 //
 // Refill the AU unit buffer setting  AU PTS DTS from the scanned
 // header information...
@@ -186,19 +172,24 @@
 			switch (syncword) 
 			{
 			case SEQUENCE_HEADER :
+                mjpeg_debug( "Seq hdr @ %lld", bs.bitcount() / 8-4 );
 			case GROUP_START :
+                mjpeg_debug( "Group hdr @ %lld", bs.bitcount() / 8-4 );
 			case PICTURE_START :
 				access_unit.start = AU_start;
 				access_unit.length = static_cast<int>(stream_length - AU_start)>>3;
 				access_unit.end_seq = 0;
 				avg_frames[access_unit.type-1]+=access_unit.length;
-				aunits.append( access_unit );					
-                decoding_order++;
-				mjpeg_debug( "Found start AU %d @ %lld: DTS=%ud", 
+				mjpeg_debug( "AU %d %d %d @ %lld: DTS=%ud", 
                              decoding_order,
+                             access_unit.type,
+                             access_unit.length,
                              bs.bitcount() / 8-4,
 							 static_cast<unsigned int>(access_unit.DTS/300) );
 
+
+				aunits.Append( access_unit );					
+                decoding_order++;
 				AU_hdr = syncword;
 				AU_start = stream_length;
 				AU_pict_data = 0;
@@ -206,7 +197,7 @@
 			case SEQUENCE_END:
 				access_unit.length = ((stream_length - AU_start)>>3)+4;
 				access_unit.end_seq = 1;
-				aunits.append( access_unit );
+				aunits.Append( access_unit );
 				mjpeg_info( "Scanned to end AU %d", access_unit.dorder );
 				avg_frames[access_unit.type-1]+=access_unit.length;
 
@@ -226,7 +217,7 @@
 					if( !bs.eos() && muxinto.split_at_seq_end )
 						mjpeg_warn("No seq. header starting new sequence after seq. end!");
 				}
-					
+                decoding_order++;
 				num_seq_end++;
 				break;
 			}
@@ -248,6 +239,7 @@
 		case PICTURE_START:
 			/* We have reached AU's picture data... */
 			AU_pict_data = 1;
+            mjpeg_debug( "Picture start @ %lld", bs.bitcount() / 8-4 );
 			
             prev_temp_ref = temporal_reference;
 			temporal_reference = bs.GetBits( 10);
@@ -294,10 +286,11 @@
 				group_start_field = fields_presented;
 			}
 
-			NextDTSPTS( access_unit.DTS, access_unit.PTS );
+			NextDTSPTS( );
 
 			access_unit.dorder = decoding_order;
 			access_unit.porder = temporal_reference + group_start_pic;
+
 			access_unit.seq_header = ( AU_hdr == SEQUENCE_HEADER);
 
 			if ((access_unit.type>0) && (access_unit.type<5))
@@ -348,11 +341,11 @@
     mjpeg_info ("No. Pictures    : %8u",num_pictures);
     mjpeg_info ("No. Groups      : %8u",num_groups);
     mjpeg_info ("No. I Frames    : %8u avg. size%6u bytes",
-			  num_frames[0],avg_frames[0]);
+			  num_frames[0], (uint32_t)avg_frames[0]);
     mjpeg_info ("No. P Frames    : %8u avg. size%6u bytes",
-			  num_frames[1],avg_frames[1]);
+			  num_frames[1], (uint32_t)avg_frames[1]);
     mjpeg_info ("No. B Frames    : %8u avg. size%6u bytes",
-			  num_frames[2],avg_frames[2]);
+			  num_frames[2], (uint32_t)avg_frames[2]);
     mjpeg_info("Average bit-rate : %8u bits/sec",comp_bit_rate*400);
     mjpeg_info("Peak bit-rate    : %8u  bits/sec",peak_bit_rate*400);
 	
@@ -373,8 +366,8 @@
 
     mjpeg_info ("Frame width     : %u",horizontal_size);
     mjpeg_info ("Frame height    : %u",vertical_size);
-	if (mpeg_valid_aspect_code(muxinto.mpeg, aspect_ratio))
-		str =  mpeg_aspect_code_definition(muxinto.mpeg,aspect_ratio);
+	if (MX_mpeg_valid_aspect_code(muxinto.mpeg, aspect_ratio))
+		str =  MX_mpeg_aspect_code_definition(muxinto.mpeg,aspect_ratio);
 	else
 		str = "forbidden";
     mjpeg_info ("Aspect ratio    : %s", str );
@@ -382,9 +375,9 @@
 
     if (picture_rate == 0)
 		mjpeg_info( "Picture rate    : forbidden");
-    else if (mpeg_valid_framerate_code(picture_rate))
+    else if (MX_mpeg_valid_framerate_code(picture_rate))
 		mjpeg_info( "Picture rate    : %2.3f frames/sec",
-					Y4M_RATIO_DBL(mpeg_framerate(picture_rate)) );
+					Y4M_RATIO_DBL(MX_mpeg_framerate(picture_rate)) );
     else
 		mjpeg_info( "Picture rate    : %x reserved",picture_rate);
 
@@ -410,51 +403,86 @@
 // etc!).
 //
 
-void VideoStream::NextDTSPTS( clockticks &DTS, clockticks &PTS )
+int gopfields_32pd( int temporal_ref, bool repeat_first_field )
 {
+    int frames2field;
+    int frames3field;
+    //
+    // Assume first presented frame of GOP has temporal ref 0
+    if( repeat_first_field )
+    {
+        frames2field = (temporal_ref+1) / 2;
+        frames3field = temporal_ref / 2;
+    }
+    else
+    {
+        frames2field = (temporal_ref) / 2;
+        frames3field = (temporal_ref+1) / 2;
+    }
+
+    return frames2field*2 + frames3field*3;
+
+}
+
+/****************************************************
+ *
+ * Work out DTS PTS stamps for the current AU.
+ * Note: Current strategy assumes decoders model 'ideal'
+ * timing with instantaneous decoding.
+ * This makes sense it is what is assumed for B-frames anyway
+ * (no seperate DTS).
+ *
+ ******************************************************/
+
+void VideoStream::NextDTSPTS()
+{
+    const int decode_delay = 0;
+    int startup_skew = 2;
+    int decode_fields, present_fields;
     if( pict_struct != PIC_FRAME )
     {
-		DTS = static_cast<clockticks>
-			(fields_presented * (double)(CLOCKS/2) / frame_rate);
-        int dts_fields = temporal_reference*2 + group_start_field+1;
+		decode_fields = fields_presented;
+        present_fields = temporal_reference*2 + group_start_field+decode_delay/2;
         if( temporal_reference == prev_temp_ref )
-            dts_fields += 1;
-        PTS =
-            static_cast<clockticks>(dts_fields* (double)(CLOCKS/2) / frame_rate);
-		access_unit.porder = temporal_reference + group_start_pic;
+            present_fields += 1;
         fields_presented += 1;
     }	
     else if( pulldown_32 )
 	{
-		int frames2field;
-		int frames3field;
-		DTS = static_cast<clockticks>
-			(fields_presented * (double)(CLOCKS/2) / frame_rate);
-		if( repeat_first_field )
-		{
-			frames2field = (temporal_reference+1) / 2;
-			frames3field = temporal_reference / 2;
-			fields_presented += 3;
-		}
-		else
-		{
-			frames2field = (temporal_reference) / 2;
-			frames3field = (temporal_reference+1) / 2;
-			fields_presented += 2;
-		}
-		PTS = static_cast<clockticks>
-			((frames2field*2 + frames3field*3 + group_start_field+1) * (double)(CLOCKS/2) / frame_rate);
-		access_unit.porder = temporal_reference + group_start_pic;
+        present_fields = group_start_field  + startup_skew + decode_delay +
+            gopfields_32pd( temporal_reference, repeat_first_field );
+        
+        if( decoding_order == 0 )
+        {
+            // Special case... first IFRAME is not decoded during presentation
+            // of previous ref frame but immediately at start
+            decode_fields = 0;
+            prev_ref_present = present_fields ;
+        }
+        else if( access_unit.type == IFRAME || access_unit.type == PFRAME )
+        {
+            decode_fields = prev_ref_present-decode_delay;
+            prev_ref_present = present_fields;
+        }
+        else
+        {
+            decode_fields = present_fields - decode_delay;
+        }
+        fields_presented += repeat_first_field ? 3 : 2;
 	}
     else
 	{
-		DTS = static_cast<clockticks> 
-			(decoding_order * (double)CLOCKS / frame_rate);
-		PTS = static_cast<clockticks>
-			((temporal_reference + group_start_pic+1) * (double)CLOCKS / frame_rate);
+        decode_fields = decoding_order*2;
+        present_fields = (temporal_reference + group_start_pic)*2
+            + startup_skew + decode_delay;
 		fields_presented += 2;
 	}
 
+    access_unit.DTS = static_cast<clockticks>
+        (decode_fields * (double)(CLOCKS/2) / frame_rate);
+    
+    access_unit.PTS = static_cast<clockticks>
+        (present_fields * (double)(CLOCKS/2) / frame_rate);
 }
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_out.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_out.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/videostrm_out.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -25,11 +25,9 @@
 #include <assert.h>
 
 #include "mjpeg_types.h"
-#include "fastintfns.h"
 #include "videostrm.hpp"
 #include "multiplexor.hpp"
 
-
 VideoStream::VideoStream(IBitStream &ibs, VideoParams *parms, 
                          Multiplexor &into ) :
 	ElementaryStream( ibs, into, ElementaryStream::video ),
@@ -64,14 +62,6 @@
     return bs.GetBits( 32)  == 0x1b3;
 }
 
-void VideoStream::InitAUbuffer()
-{
-	unsigned int i;
-	for( i = 0; i < aunits.BUF_SIZE; ++i )
-		aunits.init( new VAunit );
-}
-
-
 /*********************************
  * Signals when video stream has completed mux run-out specified
  * in associated mux stream.   Run-out is always to complete GOP's.
@@ -94,14 +84,20 @@
  * where long delays mess up random access.
  *******************************/
 
-
 bool VideoStream::MuxPossible( clockticks currentSCR )
 {
-
 	return ( ElementaryStream::MuxPossible(currentSCR) && 
              RequiredDTS() < currentSCR + max_STD_buffer_delay );
 }
 
+
+void VideoStream::AUMuxed( bool first_in_sector )
+{
+    //DEBUG
+    //mjpeg_info( "VidMuxed: %d %lld ", au->dorder, RequiredDTS()/300 );
+}
+
+
 /*********************************
  * Work out the timestamps to be set in the header of sectors starting
  * new AU's.
@@ -131,6 +127,81 @@
         !(muxinto.video_buffers_iframe_only && AUtype != IFRAME);
 }
 
+/********************************
+ *
+ * Check if the next sector could potentially include parts of AUs
+ * following a sequence end marker... in this case a run-out may be needed
+ *
+ *******************************/
+
+bool VideoStream::SeqEndRunOut()
+{
+    unsigned int payload = au_unsent;
+    unsigned int ahead = 0;
+    AUnit *next_au = au;
+    for(;;)
+    {
+        if( next_au->end_seq || payload >= muxinto.sector_size)
+            break;  
+        ++ahead;
+        next_au = Lookahead(ahead);
+        if( next_au == 0 )
+            break;
+        payload += next_au->PayloadSize();
+    }
+    
+    // We don't need to start run-out if the next sector cannot contain
+    // next sequence or there is no next sequence (no AU after the one with
+    // the sequence end marker
+    return next_au != 0 && next_au->end_seq 
+        && payload < muxinto.sector_size
+        && Lookahead(ahead+1) != 0;
+
+}
+
+/********************************
+ *
+ * Check if the next sector could potentially include a seq_end marker
+ *
+ *******************************/
+
+const AUnit *VideoStream::NextIFrame()
+{
+    unsigned int ahead = 0;
+    AUnit *au_ahead = Lookahead(ahead);
+    while( au_ahead != 0 && au_ahead->type != IFRAME 
+           && ahead < MAX_GOP_LENGTH )
+    {
+        ++ahead;
+        au_ahead = Lookahead(ahead);
+    }
+    return au_ahead;
+}
+
+/********************************
+ *
+ * Calculate how much payload can be muxed next sector without
+ * including the next IFRAME.
+ *
+ *******************************/
+
+unsigned int VideoStream::ExcludeNextIFramePayload()
+{
+    unsigned int payload = au_unsent;
+    unsigned int ahead = 0;
+    AUnit *au_ahead;
+    for(;;)
+    {
+        au_ahead = Lookahead(ahead);
+        if( au_ahead == 0 || payload >= muxinto.sector_size || au_ahead->type == IFRAME )
+            break;
+        payload += au_ahead->PayloadSize();
+        ++ahead;
+    }
+    assert( eoscan || au_ahead != 0 );
+    return payload;
+}
+
 /******************************************************************
 	Output_Video
 	generiert Pack/Sys_Header/Packet Informationen aus dem
@@ -143,7 +214,6 @@
 void VideoStream::OutputSector ( )
 
 {
-
 	unsigned int max_packet_payload; 	 
 	unsigned int actual_payload;
 	unsigned int old_au_then_new_payload;
@@ -152,21 +222,25 @@
 
 	max_packet_payload = 0;	/* 0 = Fill sector */
   	/* 	
- 	   We're now in the last AU of a segment.  So we don't want to go
- 	   beyond it's end when filling sectors. Hence we limit packet
- 	   payload size to (remaining) AU length.  The same applies when
- 	   we wish to ensure sequence headers starting ACCESS-POINT AU's
- 	   in (S)VCD's etc are sector-aligned.  
+       I-frame aligning.  For the last AU of segment or for formats
+       with ACCESS-POINT sectors where I-frame (and preceding headers)
+       are sector aligned.
 
-       N.b.runout_PTS is the PTS of the first I picture following the
-       run-out is recorded.
+       We need to look ahead to see how much we may put into the current packet
+       without without touching the next I-frame (which is supposed to be
+       placed at the start of its own sector).
+
+       N.b.runout_PTS is the PTS of the after which the next I frame
+       marks the start of the next sequence.
 	*/
-	int nextAU = NextAUType();
-	if( ( muxinto.running_out && nextAU == IFRAME && NextRequiredPTS() >= muxinto.runout_PTS) 
-        || (muxinto.sector_align_iframeAUs && nextAU == IFRAME  )
-		) 
+    
+    /* TODO finish this: Need to look-ahead sufficiently far to
+       guarantee finding an I-FRAME even if its predecessors are very
+       small.  
+    */
+	if( muxinto.sector_align_iframeAUs || muxinto.running_out )
 	{
-		max_packet_payload = au_unsent;
+		max_packet_payload = ExcludeNextIFramePayload();
 	}
 
 	/* Figure out the threshold payload size below which we can fit more
@@ -177,8 +251,8 @@
 	   of the last packet...  */
 
 	old_au_then_new_payload = muxinto.PacketPayload( *this,
-													 buffers_in_header, 
-													 true, true);
+					buffers_in_header, 
+					true, true);
 
 	/* CASE: Packet starts with new access unit			*/
 	if (new_au_next_sec  )
@@ -205,10 +279,10 @@
         DTS = RequiredDTS();
 		actual_payload =
 			muxinto.WritePacket ( max_packet_payload,
-								  *this,
-								  NewAUBuffers(autype), 
-                                  PTS, DTS,
-								  NewAUTimestamps(autype) );
+						*this,
+						NewAUBuffers(autype), 
+                                  		PTS, DTS,
+						NewAUTimestamps(autype) );
 
 	}
 
@@ -220,9 +294,9 @@
 	{
 		actual_payload = 
 			muxinto.WritePacket( au_unsent,
-								  *this,
-								  false, 0, 0,
-								  TIMESTAMPBITS_NO );
+							*this,
+							false, 0, 0,
+							TIMESTAMPBITS_NO );
 	}
 
 	/* CASE: Packet begins with old access unit, a new one	*/
@@ -242,19 +316,17 @@
 
 			actual_payload = 
 				muxinto.WritePacket ( max_packet_payload,
-									  *this,
-									  NewAUBuffers(autype), 
-                                      PTS, DTS,
-									  NewAUTimestamps(autype) );
+						*this,
+						NewAUBuffers(autype), 
+                                      		PTS, DTS,
+						NewAUTimestamps(autype) );
 		} 
 		else
 		{
-			actual_payload = muxinto.WritePacket ( au_unsent,
-										 *this,
-										 false, 0, 0,
-										 TIMESTAMPBITS_NO);
+			actual_payload = muxinto.WritePacket ( au_unsent, 
+							*this, false, 0, 0,
+							TIMESTAMPBITS_NO);
 		}
-
 	}
 	++nsec;
 	buffers_in_header = always_buffers_in_header;

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.c	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.c	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,1339 @@
+/*
+ *  yuv4mpeg.c:  Functions for reading and writing "new" YUV4MPEG streams
+ *
+ *  Copyright (C) 2001 Matthew J. Marjanovic <maddog at mir.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version 2
+ *  of the License, or (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ *
+ */
+
+#include <config.h>
+
+#include <unistd.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#define INTERNAL_Y4M_LIBCODE_STUFF_QPX
+#include "yuv4mpeg.h"
+#include "yuv4mpeg_intern.h"
+#include "mjpeg_logging.h"
+
+
+static int _y4mparam_allow_unknown_tags = 1;  /* default is forgiveness */
+static int _y4mparam_feature_level = 0;       /* default is ol YUV4MPEG2 */
+
+static void *(*_y4m_alloc)(size_t bytes) = malloc;
+static void (*_y4m_free)(void *ptr) = free;
+
+
+
+int y4m_allow_unknown_tags(int yn)
+{
+  int old = _y4mparam_allow_unknown_tags;
+  if (yn >= 0)
+    _y4mparam_allow_unknown_tags = (yn) ? 1 : 0;
+  return old;
+}
+
+
+int y4m_accept_extensions(int level)
+{
+  int old = _y4mparam_feature_level;
+  if (level >= 0)
+    _y4mparam_feature_level = level;
+  return old;
+}
+
+
+
+/*************************************************************************
+ *
+ * Convenience functions for fd read/write
+ *
+ *   - guaranteed to transfer entire payload (or fail)
+ *   - returns:
+ *               0 on complete success
+ *               +(# of remaining bytes) on eof (for y4m_read)
+ *               -(# of rem. bytes) on error (and ERRNO should be set)
+ *     
+ *************************************************************************/
+
+
+ssize_t y4m_read(int fd, void *buf, size_t len)
+{
+   ssize_t n;
+   uint8_t *ptr = (uint8_t *)buf;
+
+   while (len > 0) {
+     n = read(fd, ptr, len);
+     if (n <= 0) {
+       /* return amount left to read */
+       if (n == 0)
+	 return len;  /* n == 0 --> eof */
+       else
+	 return -len; /* n < 0 --> error */
+     }
+     ptr += n;
+     len -= n;
+   }
+   return 0;
+}
+
+
+ssize_t y4m_write(int fd, const void *buf, size_t len)
+{
+   ssize_t n;
+   const uint8_t *ptr = (const uint8_t *)buf;
+
+   while (len > 0) {
+     n = write(fd, ptr, len);
+     if (n <= 0) return -len;  /* return amount left to write */
+     ptr += n;
+     len -= n;
+   }
+   return 0;
+}
+
+
+
+
+/*************************************************************************
+ *
+ * "Extra tags" handling
+ *
+ *************************************************************************/
+
+
+static char *y4m_new_xtag(void)
+{
+  return _y4m_alloc(Y4M_MAX_XTAG_SIZE * sizeof(char));
+}
+
+
+void y4m_init_xtag_list(y4m_xtag_list_t *xtags)
+{
+  int i;
+  xtags->count = 0;
+  for (i = 0; i < Y4M_MAX_XTAGS; i++) {
+    xtags->tags[i] = NULL;
+  }
+}
+
+
+void y4m_fini_xtag_list(y4m_xtag_list_t *xtags)
+{
+  int i;
+  for (i = 0; i < Y4M_MAX_XTAGS; i++) {
+    if (xtags->tags[i] != NULL) {
+      _y4m_free(xtags->tags[i]);
+      xtags->tags[i] = NULL;
+    }
+  }
+  xtags->count = 0;
+}
+
+
+void y4m_copy_xtag_list(y4m_xtag_list_t *dest, const y4m_xtag_list_t *src)
+{
+  int i;
+  for (i = 0; i < src->count; i++) {
+    if (dest->tags[i] == NULL) 
+      dest->tags[i] = y4m_new_xtag();
+    strncpy(dest->tags[i], src->tags[i], Y4M_MAX_XTAG_SIZE);
+  }
+  dest->count = src->count;
+}
+
+
+
+static int y4m_snprint_xtags(char *s, int maxn, const y4m_xtag_list_t *xtags)
+{
+  int i, room;
+  
+  for (i = 0, room = maxn - 1; i < xtags->count; i++) {
+    int n = snprintf(s, room + 1, " %s", xtags->tags[i]);
+    if ((n < 0) || (n > room)) return Y4M_ERR_HEADER;
+    s += n;
+    room -= n;
+  }
+  s[0] = '\n';  /* finish off header with newline */
+  s[1] = '\0';  /* ...and end-of-string           */
+  return Y4M_OK;
+}
+
+
+int y4m_xtag_count(const y4m_xtag_list_t *xtags)
+{
+  return xtags->count;
+}
+
+
+const char *y4m_xtag_get(const y4m_xtag_list_t *xtags, int n)
+{
+  if (n >= xtags->count)
+    return NULL;
+  else
+    return xtags->tags[n];
+}
+
+
+int y4m_xtag_add(y4m_xtag_list_t *xtags, const char *tag)
+{
+  if (xtags->count >= Y4M_MAX_XTAGS) return Y4M_ERR_XXTAGS;
+  if (xtags->tags[xtags->count] == NULL) 
+    xtags->tags[xtags->count] = y4m_new_xtag();
+  strncpy(xtags->tags[xtags->count], tag, Y4M_MAX_XTAG_SIZE);
+  (xtags->count)++;
+  return Y4M_OK;
+}
+
+
+int y4m_xtag_remove(y4m_xtag_list_t *xtags, int n)
+{
+  int i;
+  char *q;
+
+  if ((n < 0) || (n >= xtags->count)) return Y4M_ERR_RANGE;
+  q = xtags->tags[n];
+  for (i = n; i < (xtags->count - 1); i++)
+    xtags->tags[i] = xtags->tags[i+1];
+  xtags->tags[i] = q;
+  (xtags->count)--;
+  return Y4M_OK;
+}
+
+
+int y4m_xtag_clearlist(y4m_xtag_list_t *xtags)
+{
+  xtags->count = 0;
+  return Y4M_OK;
+}
+
+
+int y4m_xtag_addlist(y4m_xtag_list_t *dest, const y4m_xtag_list_t *src)
+{
+  int i, j;
+
+  if ((dest->count + src->count) > Y4M_MAX_XTAGS) return Y4M_ERR_XXTAGS;
+  for (i = dest->count, j = 0;
+       j < src->count;
+       i++, j++) {
+    if (dest->tags[i] == NULL) 
+      dest->tags[i] = y4m_new_xtag();
+    strncpy(dest->tags[i], src->tags[i], Y4M_MAX_XTAG_SIZE);
+  }
+  dest->count += src->count;
+  return Y4M_OK;
+}  
+
+
+/*************************************************************************
+ *
+ * Creators/destructors for y4m_*_info_t structures
+ *
+ *************************************************************************/
+
+
+void y4m_init_stream_info(y4m_stream_info_t *info)
+{
+  if (info == NULL) return;
+  /* init substructures */
+  y4m_init_xtag_list(&(info->x_tags));
+  /* set defaults */
+  y4m_clear_stream_info(info);
+}
+
+
+void y4m_clear_stream_info(y4m_stream_info_t *info)
+{
+  if (info == NULL) return;
+  /* clear/initialize info */
+  info->width = Y4M_UNKNOWN;
+  info->height = Y4M_UNKNOWN;
+  info->interlace = Y4M_UNKNOWN;
+  info->framerate = y4m_fps_UNKNOWN;
+  info->sampleaspect = y4m_sar_UNKNOWN;
+  if (_y4mparam_feature_level < 1) {
+    info->chroma = Y4M_CHROMA_420JPEG;
+  } else {
+    info->chroma = Y4M_UNKNOWN;
+  }
+  y4m_xtag_clearlist(&(info->x_tags));
+}
+
+
+void y4m_copy_stream_info(y4m_stream_info_t *dest,
+			  const y4m_stream_info_t *src)
+{
+  if ((dest == NULL) || (src == NULL)) return;
+  /* copy info */
+  dest->width = src->width;
+  dest->height = src->height;
+  dest->interlace = src->interlace;
+  dest->framerate = src->framerate;
+  dest->sampleaspect = src->sampleaspect;
+  dest->chroma = src->chroma;
+  y4m_copy_xtag_list(&(dest->x_tags), &(src->x_tags));
+}
+
+
+void y4m_fini_stream_info(y4m_stream_info_t *info)
+{
+  if (info == NULL) return;
+  y4m_fini_xtag_list(&(info->x_tags));
+}
+
+
+void y4m_si_set_width(y4m_stream_info_t *si, int width)
+{
+  si->width = width;
+}
+
+int y4m_si_get_width(const y4m_stream_info_t *si)
+{ return si->width; }
+
+void y4m_si_set_height(y4m_stream_info_t *si, int height)
+{
+  si->height = height; 
+}
+
+int y4m_si_get_height(const y4m_stream_info_t *si)
+{ return si->height; }
+
+void y4m_si_set_interlace(y4m_stream_info_t *si, int interlace)
+{ si->interlace = interlace; }
+
+int y4m_si_get_interlace(const y4m_stream_info_t *si)
+{ return si->interlace; }
+
+void y4m_si_set_framerate(y4m_stream_info_t *si, y4m_ratio_t framerate)
+{ si->framerate = framerate; }
+
+y4m_ratio_t y4m_si_get_framerate(const y4m_stream_info_t *si)
+{ return si->framerate; }
+
+void y4m_si_set_sampleaspect(y4m_stream_info_t *si, y4m_ratio_t sar)
+{ si->sampleaspect = sar; }
+
+y4m_ratio_t y4m_si_get_sampleaspect(const y4m_stream_info_t *si)
+{ return si->sampleaspect; }
+
+void y4m_si_set_chroma(y4m_stream_info_t *si, int chroma_mode)
+{ si->chroma = chroma_mode; }
+
+int y4m_si_get_chroma(const y4m_stream_info_t *si)
+{ return si->chroma; }
+
+
+int y4m_si_get_plane_count(const y4m_stream_info_t *si)
+{
+  switch (si->chroma) {
+  case Y4M_CHROMA_420JPEG:
+  case Y4M_CHROMA_420MPEG2:
+  case Y4M_CHROMA_420PALDV:
+  case Y4M_CHROMA_444:
+  case Y4M_CHROMA_422:
+  case Y4M_CHROMA_411:
+    return 3;
+  case Y4M_CHROMA_MONO:
+    return 1;
+  case Y4M_CHROMA_444ALPHA:
+    return 4;
+  default:
+    return Y4M_UNKNOWN;
+  }
+}
+
+int y4m_si_get_plane_width(const y4m_stream_info_t *si, int plane)
+{
+  switch (plane) {
+  case 0:
+    return (si->width);
+  case 1:
+  case 2:
+    switch (si->chroma) {
+    case Y4M_CHROMA_420JPEG: 
+    case Y4M_CHROMA_420MPEG2:
+    case Y4M_CHROMA_420PALDV:
+      return (si->width) / 2;
+    case Y4M_CHROMA_444:
+    case Y4M_CHROMA_444ALPHA:
+      return (si->width);
+    case Y4M_CHROMA_422:
+      return (si->width) / 2;
+    case Y4M_CHROMA_411:
+      return (si->width) / 4;
+    default:
+      return Y4M_UNKNOWN;
+    }
+  case 3:
+    switch (si->chroma) {
+    case Y4M_CHROMA_444ALPHA:
+      return (si->width);
+    default:
+      return Y4M_UNKNOWN;
+    }
+  default:
+    return Y4M_UNKNOWN;
+  }
+}
+
+int y4m_si_get_plane_height(const y4m_stream_info_t *si, int plane)
+{
+  switch (plane) {
+  case 0:
+    return (si->height);
+  case 1:
+  case 2:
+    switch (si->chroma) {
+    case Y4M_CHROMA_420JPEG: 
+    case Y4M_CHROMA_420MPEG2:
+    case Y4M_CHROMA_420PALDV:
+      return (si->height) / 2;
+    case Y4M_CHROMA_444:
+    case Y4M_CHROMA_444ALPHA:
+    case Y4M_CHROMA_422:
+    case Y4M_CHROMA_411:
+      return (si->height);
+    default:
+      return Y4M_UNKNOWN;
+    }
+  case 3:
+    switch (si->chroma) {
+    case Y4M_CHROMA_444ALPHA:
+      return (si->height);
+    default:
+      return Y4M_UNKNOWN;
+    }
+  default:
+    return Y4M_UNKNOWN;
+  }
+}
+
+int y4m_si_get_plane_length(const y4m_stream_info_t *si, int plane)
+{
+  int w = y4m_si_get_plane_width(si, plane);
+  int h = y4m_si_get_plane_height(si, plane);
+  if ((w != Y4M_UNKNOWN) && (h != Y4M_UNKNOWN))
+    return (w * h);
+  else
+    return Y4M_UNKNOWN;
+}
+
+int y4m_si_get_framelength(const y4m_stream_info_t *si)
+{
+  int total = 0;
+  int planes = y4m_si_get_plane_count(si);
+  int p;
+  for (p = 0; p < planes; p++) {
+    int plen = y4m_si_get_plane_length(si, p);
+    if (plen == Y4M_UNKNOWN) return Y4M_UNKNOWN;
+    total += plen;
+  }
+  return total;
+}
+
+
+y4m_xtag_list_t *y4m_si_xtags(y4m_stream_info_t *si)
+{ return &(si->x_tags); }
+
+
+
+void y4m_init_frame_info(y4m_frame_info_t *info)
+{
+  if (info == NULL) return;
+  /* init substructures */
+  y4m_init_xtag_list(&(info->x_tags));
+  /* set defaults */
+  y4m_clear_frame_info(info);
+}
+
+
+void y4m_clear_frame_info(y4m_frame_info_t *info)
+{
+  if (info == NULL) return;
+  /* clear/initialize info */
+  info->spatial = Y4M_UNKNOWN;
+  info->temporal = Y4M_UNKNOWN;
+  info->presentation = Y4M_UNKNOWN;
+  y4m_xtag_clearlist(&(info->x_tags));
+}
+
+
+void y4m_copy_frame_info(y4m_frame_info_t *dest, const y4m_frame_info_t *src)
+{
+  if ((dest == NULL) || (src == NULL)) return;
+  /* copy info */
+  dest->spatial = src->spatial;
+  dest->temporal = src->temporal;
+  dest->presentation = src->presentation;
+  y4m_copy_xtag_list(&(dest->x_tags), &(src->x_tags));
+}
+
+void y4m_fini_frame_info(y4m_frame_info_t *info)
+{
+  if (info == NULL) return;
+  y4m_fini_xtag_list(&(info->x_tags));
+}
+
+
+void y4m_fi_set_presentation(y4m_frame_info_t *fi, int pres)
+{ fi->presentation = pres; }
+
+int y4m_fi_get_presentation(const y4m_frame_info_t *fi)
+{ return fi->presentation; }
+
+void y4m_fi_set_temporal(y4m_frame_info_t *fi, int sampling)
+{ fi->temporal = sampling; }
+
+int y4m_fi_get_temporal(const y4m_frame_info_t *fi)
+{ return fi->temporal; }
+
+void y4m_fi_set_spatial(y4m_frame_info_t *fi, int sampling)
+{ fi->spatial = sampling; }
+
+int y4m_fi_get_spatial(const y4m_frame_info_t *fi)
+{ return fi->spatial; }
+
+
+
+y4m_xtag_list_t *y4m_fi_xtags(y4m_frame_info_t *fi)
+{ return &(fi->x_tags); }
+
+
+/*************************************************************************
+ *
+ * Tag parsing 
+ *
+ *************************************************************************/
+
+
+/* Parse (the first) old, unofficial X-tag chroma specification,
+   and then remove that tag from the X-tag list. */
+static int
+handle_old_chroma_xtag(y4m_stream_info_t *si)
+{
+  y4m_xtag_list_t *xtags = y4m_si_xtags(si);
+  const char *tag = NULL;
+  int n, chroma;
+
+  for (n = y4m_xtag_count(xtags) - 1; n >= 0; n--) {
+    tag = y4m_xtag_get(xtags, n);
+    if (!strncmp("XYSCSS=", tag, 7)) break;
+  }
+  if ((tag == NULL) || (n < 0)) return Y4M_UNKNOWN;
+  mjpeg_warn("Deprecated X-tag for chroma found in a stream header...");
+  mjpeg_warn("...pester someone to upgrade the source's program!");
+  /* parse the tag */
+  tag += 7;
+  if (!strcmp("411", tag))           chroma = Y4M_CHROMA_411;
+  else if (!strcmp(tag, "420"))      chroma = Y4M_CHROMA_420JPEG;
+  else if (!strcmp(tag, "420MPEG2")) chroma = Y4M_CHROMA_420MPEG2;
+  else if (!strcmp(tag, "420PALDV")) chroma = Y4M_CHROMA_420PALDV;
+  else if (!strcmp(tag, "420JPEG"))  chroma = Y4M_CHROMA_420JPEG;
+  else if (!strcmp(tag, "444"))      chroma = Y4M_CHROMA_444;
+  else chroma = Y4M_UNKNOWN;
+  /* Remove the 'X' tag so that no one has to worry about it any more. */
+  y4m_xtag_remove(xtags, n);
+  /* Hmm... what if there are more XYSCSS tags?  Broken is as broken does;
+     thank goodness this is temporary code. */
+  return chroma;
+}
+
+
+
+
+int y4m_parse_stream_tags(char *s, y4m_stream_info_t *i)
+{
+  char *token, *value;
+  char tag;
+  int err;
+
+  /* parse fields */
+  for (token = strtok(s, Y4M_DELIM); 
+       token != NULL; 
+       token = strtok(NULL, Y4M_DELIM)) {
+    if (token[0] == '\0') continue;   /* skip empty strings */
+    tag = token[0];
+    value = token + 1;
+    switch (tag) {
+    case 'W':  /* width */
+      i->width = atoi(value);
+      if (i->width <= 0) return Y4M_ERR_RANGE;
+      break;
+    case 'H':  /* height */
+      i->height = atoi(value); 
+      if (i->height <= 0) return Y4M_ERR_RANGE;
+      break;
+    case 'F':  /* frame rate (fps) */
+      if ((err = y4m_parse_ratio(&(i->framerate), value)) != Y4M_OK)
+	return err;
+      if (i->framerate.n < 0) return Y4M_ERR_RANGE;
+      break;
+    case 'I':  /* interlacing */
+      switch (value[0]) {
+      case 'p':  i->interlace = Y4M_ILACE_NONE; break;
+      case 't':  i->interlace = Y4M_ILACE_TOP_FIRST; break;
+      case 'b':  i->interlace = Y4M_ILACE_BOTTOM_FIRST; break;
+      case 'm':  i->interlace = Y4M_ILACE_MIXED; break;
+      case '?':
+      default:
+	i->interlace = Y4M_UNKNOWN; break;
+      }
+      break;
+    case 'A':  /* sample (pixel) aspect ratio */
+      if ((err = y4m_parse_ratio(&(i->sampleaspect), value)) != Y4M_OK)
+	return err;
+      if (i->sampleaspect.n < 0) return Y4M_ERR_RANGE;
+      break;
+    case 'C':
+      i->chroma = y4m_chroma_parse_keyword(value);
+      if (i->chroma == Y4M_UNKNOWN)
+	return Y4M_ERR_HEADER;
+      break;
+    case 'X':  /* 'X' meta-tag */
+      if ((err = y4m_xtag_add(&(i->x_tags), token)) != Y4M_OK) return err;
+      break;
+    default:
+      /* possible error on unknown options */
+      if (_y4mparam_allow_unknown_tags) {
+	/* unknown tags ok:  store in xtag list and warn... */
+	if ((err = y4m_xtag_add(&(i->x_tags), token)) != Y4M_OK) return err;
+	mjpeg_warn("Unknown stream tag encountered:  '%s'", token);
+      } else {
+	/* unknown tags are *not* ok */
+	return Y4M_ERR_BADTAG;
+      }
+      break;
+    }
+  }
+
+  /* If feature_level > 0, then handle and/or remove any old-style XYSCSS
+     chroma tags.  The new-style 'C' tag takes precedence, however. */
+  if (_y4mparam_feature_level > 0) {
+    int xt_chroma = handle_old_chroma_xtag(i);
+
+    if (i->chroma == Y4M_UNKNOWN)
+      i->chroma = xt_chroma;
+    else if ((xt_chroma != Y4M_UNKNOWN) &&
+             (xt_chroma != i->chroma))
+      mjpeg_warn("Old chroma X-tag (ignored) does not match new chroma tag.");
+  }
+
+  /* Without 'C' tag or any other chroma spec, default to 420jpeg */
+  if (i->chroma == Y4M_UNKNOWN) 
+    i->chroma = Y4M_CHROMA_420JPEG;
+
+  /* Error checking... */
+  /*      - Width and Height are required. */
+  if ((i->width == Y4M_UNKNOWN) || (i->height == Y4M_UNKNOWN))
+    return Y4M_ERR_HEADER;
+  /*      - Non-420 chroma and mixed interlace require level >= 1 */
+  if (_y4mparam_feature_level < 1) {
+    if ((i->chroma != Y4M_CHROMA_420JPEG) &&
+	(i->chroma != Y4M_CHROMA_420MPEG2) &&
+	(i->chroma != Y4M_CHROMA_420PALDV))
+      return Y4M_ERR_FEATURE;
+    if (i->interlace == Y4M_ILACE_MIXED)
+      return Y4M_ERR_FEATURE;
+  }
+
+  /* ta da!  done. */
+  return Y4M_OK;
+}
+
+
+
+static int y4m_parse_frame_tags(char *s, const y4m_stream_info_t *si,
+				y4m_frame_info_t *fi)
+{
+  char *token, *value;
+  char tag;
+  int err;
+
+  /* parse fields */
+  for (token = strtok(s, Y4M_DELIM); 
+       token != NULL; 
+       token = strtok(NULL, Y4M_DELIM)) {
+    if (token[0] == '\0') continue;   /* skip empty strings */
+    tag = token[0];
+    value = token + 1;
+    switch (tag) {
+    case 'I':
+      /* frame 'I' tag requires feature level >= 1 */
+      if (_y4mparam_feature_level < 1) return Y4M_ERR_FEATURE;
+      if (si->interlace != Y4M_ILACE_MIXED) return Y4M_ERR_BADTAG;
+      switch (value[0]) {
+      case 't':  fi->presentation = Y4M_PRESENT_TOP_FIRST;        break;
+      case 'T':  fi->presentation = Y4M_PRESENT_TOP_FIRST_RPT;    break;
+      case 'b':  fi->presentation = Y4M_PRESENT_BOTTOM_FIRST;     break;
+      case 'B':  fi->presentation = Y4M_PRESENT_BOTTOM_FIRST_RPT; break;
+      case '1':  fi->presentation = Y4M_PRESENT_PROG_SINGLE;      break;
+      case '2':  fi->presentation = Y4M_PRESENT_PROG_DOUBLE;      break;
+      case '3':  fi->presentation = Y4M_PRESENT_PROG_TRIPLE;      break;
+      default: 
+	return Y4M_ERR_BADTAG;
+      }
+      switch (value[1]) {
+      case 'p':  fi->temporal = Y4M_SAMPLING_PROGRESSIVE; break;
+      case 'i':  fi->temporal = Y4M_SAMPLING_INTERLACED;  break;
+      default: 
+	return Y4M_ERR_BADTAG;
+      }
+      switch (value[2]) {
+      case 'p':  fi->spatial = Y4M_SAMPLING_PROGRESSIVE; break;
+      case 'i':  fi->spatial = Y4M_SAMPLING_INTERLACED;  break;
+      case '?':  fi->spatial = Y4M_UNKNOWN;              break;
+      default: 
+	return Y4M_ERR_BADTAG;
+      }
+      break;
+    case 'X':  /* 'X' meta-tag */
+      if ((err = y4m_xtag_add(&(fi->x_tags), token)) != Y4M_OK) return err;
+      break;
+    default:
+      /* possible error on unknown options */
+      if (_y4mparam_allow_unknown_tags) {
+	/* unknown tags ok:  store in xtag list and warn... */
+	if ((err = y4m_xtag_add(&(fi->x_tags), token)) != Y4M_OK) return err;
+	mjpeg_warn("Unknown frame tag encountered:  '%s'", token);
+      } else {
+	/* unknown tags are *not* ok */
+	return Y4M_ERR_BADTAG;
+      }
+      break;
+    }
+  }
+  /* error-checking and/or non-mixed defaults */
+  switch (si->interlace) {
+  case Y4M_ILACE_MIXED:
+    /* T and P are required if stream "Im" */
+    if ((fi->presentation == Y4M_UNKNOWN) || (fi->temporal == Y4M_UNKNOWN))
+      return Y4M_ERR_HEADER;
+    /* and S is required if stream is also 4:2:0 */
+    if ( ((si->chroma == Y4M_CHROMA_420JPEG) ||
+          (si->chroma == Y4M_CHROMA_420MPEG2) ||
+          (si->chroma == Y4M_CHROMA_420PALDV)) &&
+         (fi->spatial == Y4M_UNKNOWN) )
+      return Y4M_ERR_HEADER;
+    break;
+  case Y4M_ILACE_NONE:
+    /* stream "Ip" --> equivalent to frame "I1pp" */
+    fi->spatial = Y4M_SAMPLING_PROGRESSIVE;
+    fi->temporal = Y4M_SAMPLING_PROGRESSIVE;
+    fi->presentation = Y4M_PRESENT_PROG_SINGLE;
+    break;
+  case Y4M_ILACE_TOP_FIRST:
+    /* stream "It" --> equivalent to frame "Itii" */
+    fi->spatial = Y4M_SAMPLING_INTERLACED;
+    fi->temporal = Y4M_SAMPLING_INTERLACED;
+    fi->presentation = Y4M_PRESENT_TOP_FIRST;
+    break;
+  case Y4M_ILACE_BOTTOM_FIRST:
+    /* stream "Ib" --> equivalent to frame "Ibii" */
+    fi->spatial = Y4M_SAMPLING_INTERLACED;
+    fi->temporal = Y4M_SAMPLING_INTERLACED;
+    fi->presentation = Y4M_PRESENT_BOTTOM_FIRST;
+    break;
+  default:
+    /* stream unknown:  then, whatever */
+    break;
+  }
+  /* ta da!  done. */
+  return Y4M_OK;
+}
+
+
+
+
+
+/*************************************************************************
+ *
+ * Read/Write stream header
+ *
+ *************************************************************************/
+
+
+int y4m_read_stream_header(int fd, y4m_stream_info_t *i)
+{
+   char line[Y4M_LINE_MAX];
+   char *p;
+   int n;
+   int err;
+
+  /* start with a clean slate */
+  y4m_clear_stream_info(i);
+   /* read the header line */
+   for (n = 0, p = line; n < Y4M_LINE_MAX; n++, p++) {
+     if (read(fd, p, 1) < 1) 
+       return Y4M_ERR_SYSTEM;
+     if (*p == '\n') {
+       *p = '\0';           /* Replace linefeed by end of string */
+       break;
+     }
+   }
+   if (n >= Y4M_LINE_MAX)
+      return Y4M_ERR_HEADER;
+   /* look for keyword in header */
+   if (strncmp(line, Y4M_MAGIC, strlen(Y4M_MAGIC)))
+    return Y4M_ERR_MAGIC;
+   if ((err = y4m_parse_stream_tags(line + strlen(Y4M_MAGIC), i)) != Y4M_OK)
+     return err;
+
+   return Y4M_OK;
+}
+
+
+
+int y4m_write_stream_header(int fd, const y4m_stream_info_t *i)
+{
+  char s[Y4M_LINE_MAX+1];
+  int n;
+  int err;
+  y4m_ratio_t rate = i->framerate;
+  y4m_ratio_t aspect = i->sampleaspect;
+  const char *chroma_keyword = y4m_chroma_keyword(i->chroma);
+
+  if ((i->chroma == Y4M_UNKNOWN) || (chroma_keyword == NULL))
+    return Y4M_ERR_HEADER;
+  if (_y4mparam_feature_level < 1) {
+    if ((i->chroma != Y4M_CHROMA_420JPEG) &&
+	(i->chroma != Y4M_CHROMA_420MPEG2) &&
+	(i->chroma != Y4M_CHROMA_420PALDV))
+      return Y4M_ERR_FEATURE;
+    if (i->interlace == Y4M_ILACE_MIXED)
+      return Y4M_ERR_FEATURE;
+  }
+  y4m_ratio_reduce(&rate);
+  y4m_ratio_reduce(&aspect);
+  n = snprintf(s, sizeof(s), "%s W%d H%d F%d:%d I%s A%d:%d C%s",
+	       Y4M_MAGIC,
+	       i->width,
+	       i->height,
+	       rate.n, rate.d,
+	       (i->interlace == Y4M_ILACE_NONE) ? "p" :
+	       (i->interlace == Y4M_ILACE_TOP_FIRST) ? "t" :
+	       (i->interlace == Y4M_ILACE_BOTTOM_FIRST) ? "b" :
+	       (i->interlace == Y4M_ILACE_MIXED) ? "m" : "?",
+	       aspect.n, aspect.d,
+	       chroma_keyword
+	       );
+  if ((n < 0) || (n > Y4M_LINE_MAX)) return Y4M_ERR_HEADER;
+  if ((err = y4m_snprint_xtags(s + n, sizeof(s) - n - 1, &(i->x_tags))) 
+      != Y4M_OK) 
+    return err;
+  /* non-zero on error */
+  return (y4m_write(fd, s, strlen(s)) ? Y4M_ERR_SYSTEM : Y4M_OK);
+}
+
+
+
+
+
+/*************************************************************************
+ *
+ * Read/Write frame header
+ *
+ *************************************************************************/
+
+int y4m_read_frame_header(int fd,
+			  const y4m_stream_info_t *si,
+			  y4m_frame_info_t *fi)
+{
+  char line[Y4M_LINE_MAX];
+  char *p;
+  int n;
+  ssize_t remain;
+  
+  /* start with a clean slate */
+  y4m_clear_frame_info(fi);
+  /* This is more clever than read_stream_header...
+     Try to read "FRAME\n" all at once, and don't try to parse
+     if nothing else is there...
+  */
+  remain = y4m_read(fd, line, sizeof(Y4M_FRAME_MAGIC)-1+1); /* -'\0', +'\n' */
+  if (remain < 0) return Y4M_ERR_SYSTEM;
+  if (remain > 0) {
+    /* A clean EOF should end exactly at a frame-boundary */
+    if (remain == sizeof(Y4M_FRAME_MAGIC))
+      return Y4M_ERR_EOF;
+    else
+      return Y4M_ERR_BADEOF;
+  }
+  if (strncmp(line, Y4M_FRAME_MAGIC, sizeof(Y4M_FRAME_MAGIC)-1))
+    return Y4M_ERR_MAGIC;
+  if (line[sizeof(Y4M_FRAME_MAGIC)-1] == '\n')
+    return Y4M_OK; /* done -- no tags:  that was the end-of-line. */
+
+  if (line[sizeof(Y4M_FRAME_MAGIC)-1] != Y4M_DELIM[0]) {
+    return Y4M_ERR_MAGIC; /* wasn't a space -- what was it? */
+  }
+
+  /* proceed to get the tags... (overwrite the magic) */
+  for (n = 0, p = line; n < Y4M_LINE_MAX; n++, p++) {
+    if (y4m_read(fd, p, 1))
+      return Y4M_ERR_SYSTEM;
+    if (*p == '\n') {
+      *p = '\0';           /* Replace linefeed by end of string */
+      break;
+    }
+  }
+  if (n >= Y4M_LINE_MAX) return Y4M_ERR_HEADER;
+  /* non-zero on error */
+  return y4m_parse_frame_tags(line, si, fi);
+}
+
+
+int y4m_write_frame_header(int fd,
+			   const y4m_stream_info_t *si,
+			   const y4m_frame_info_t *fi)
+{
+  char s[Y4M_LINE_MAX+1];
+  int n, err;
+
+  if (si->interlace == Y4M_ILACE_MIXED) {
+    if (_y4mparam_feature_level < 1) return Y4M_ERR_FEATURE;
+    n = snprintf(s, sizeof(s), "%s I%c%c%c", Y4M_FRAME_MAGIC,
+		 (fi->presentation == Y4M_PRESENT_TOP_FIRST)        ? 't' :
+		 (fi->presentation == Y4M_PRESENT_TOP_FIRST_RPT)    ? 'T' :
+		 (fi->presentation == Y4M_PRESENT_BOTTOM_FIRST)     ? 'b' :
+		 (fi->presentation == Y4M_PRESENT_BOTTOM_FIRST_RPT) ? 'B' :
+		 (fi->presentation == Y4M_PRESENT_PROG_SINGLE) ? '1' :
+		 (fi->presentation == Y4M_PRESENT_PROG_DOUBLE) ? '2' :
+		 (fi->presentation == Y4M_PRESENT_PROG_TRIPLE) ? '3' :
+		 '?',
+		 (fi->temporal == Y4M_SAMPLING_PROGRESSIVE) ? 'p' :
+		 (fi->temporal == Y4M_SAMPLING_INTERLACED)  ? 'i' :
+		 '?',
+		 (fi->spatial == Y4M_SAMPLING_PROGRESSIVE) ? 'p' :
+		 (fi->spatial == Y4M_SAMPLING_INTERLACED)  ? 'i' :
+		 '?'
+		 );
+  } else {
+    n = snprintf(s, sizeof(s), "%s", Y4M_FRAME_MAGIC);
+  }
+  
+  if ((n < 0) || (n > Y4M_LINE_MAX)) return Y4M_ERR_HEADER;
+  if ((err = y4m_snprint_xtags(s + n, sizeof(s) - n - 1, &(fi->x_tags))) 
+      != Y4M_OK) 
+    return err;
+  /* non-zero on error */
+  return (y4m_write(fd, s, strlen(s)) ? Y4M_ERR_SYSTEM : Y4M_OK);
+}
+
+
+
+/*************************************************************************
+ *
+ * Read/Write entire frame
+ *
+ *************************************************************************/
+
+int y4m_read_frame_data(int fd, const y4m_stream_info_t *si, 
+                        y4m_frame_info_t *fi, uint8_t * const *frame)
+{
+  int planes = y4m_si_get_plane_count(si);
+  int p;
+  
+  /* Read each plane */
+  for (p = 0; p < planes; p++) {
+    int w = y4m_si_get_plane_width(si, p);
+    int h = y4m_si_get_plane_height(si, p);
+    if (y4m_read(fd, frame[p], w*h)) return Y4M_ERR_SYSTEM;
+  }
+  return Y4M_OK;
+}
+
+
+
+int y4m_read_frame(int fd, const y4m_stream_info_t *si, 
+		   y4m_frame_info_t *fi, uint8_t * const *frame)
+{
+  int err;
+  
+  /* Read frame header */
+  if ((err = y4m_read_frame_header(fd, si, fi)) != Y4M_OK) return err;
+  /* Read date */
+  return y4m_read_frame_data(fd, si, fi, frame);
+}
+
+
+
+
+int y4m_write_frame(int fd, const y4m_stream_info_t *si, 
+		    const y4m_frame_info_t *fi, uint8_t * const *frame)
+{
+  int planes = y4m_si_get_plane_count(si);
+  int err, p;
+
+  /* Write frame header */
+  if ((err = y4m_write_frame_header(fd, si, fi)) != Y4M_OK) return err;
+  /* Write each plane */
+  for (p = 0; p < planes; p++) {
+    int w = y4m_si_get_plane_width(si, p);
+    int h = y4m_si_get_plane_height(si, p);
+    if (y4m_write(fd, frame[p], w*h)) return Y4M_ERR_SYSTEM;
+  }
+  return Y4M_OK;
+}
+
+
+
+/*************************************************************************
+ *
+ * Read/Write entire frame, (de)interleaved (to)from two separate fields
+ *
+ *************************************************************************/
+
+
+int y4m_read_fields_data(int fd, const y4m_stream_info_t *si,
+                         y4m_frame_info_t *fi,
+                         uint8_t * const *upper_field, 
+                         uint8_t * const *lower_field)
+{
+  int p;
+  int planes = y4m_si_get_plane_count(si);
+  const int maxrbuf=32*1024;
+  uint8_t *rbuf=_y4m_alloc(maxrbuf);
+  int rbufpos=0,rbuflen=0;
+  
+  /* Read each plane */
+  for (p = 0; p < planes; p++) {
+    uint8_t *dsttop = upper_field[p];
+    uint8_t *dstbot = lower_field[p];
+    int height = y4m_si_get_plane_height(si, p);
+    int width = y4m_si_get_plane_width(si, p);
+    int y;
+    /* alternately read one line into each field */
+    for (y = 0; y < height; y += 2) {
+      if( width*2 >= maxrbuf ) {
+        if (y4m_read(fd, dsttop, width)) goto y4merr;
+        if (y4m_read(fd, dstbot, width)) goto y4merr;
+      } else {
+        if( rbufpos==rbuflen ) {
+          rbuflen=(height-y)*width;
+          if( rbuflen>maxrbuf )
+            rbuflen=maxrbuf-maxrbuf%(2*width);
+          if( y4m_read(fd,rbuf,rbuflen) )
+            goto y4merr;
+          rbufpos=0;
+        }
+            
+        memcpy(dsttop,rbuf+rbufpos,width); rbufpos+=width;
+        memcpy(dstbot,rbuf+rbufpos,width); rbufpos+=width;
+      }
+      dsttop+=width;
+      dstbot+=width;
+    }
+  }
+  _y4m_free(rbuf);
+  return Y4M_OK;
+
+ y4merr:
+  _y4m_free(rbuf);
+  return Y4M_ERR_SYSTEM;
+}
+
+
+int y4m_read_fields(int fd, const y4m_stream_info_t *si, y4m_frame_info_t *fi,
+                    uint8_t * const *upper_field, 
+                    uint8_t * const *lower_field)
+{
+  int err;
+  /* Read frame header */
+  if ((err = y4m_read_frame_header(fd, si, fi)) != Y4M_OK) return err;
+  /* Read data */
+  return y4m_read_fields_data(fd, si, fi, upper_field, lower_field);
+}
+
+
+
+int y4m_write_fields(int fd, const y4m_stream_info_t *si,
+		     const y4m_frame_info_t *fi,
+		     uint8_t * const *upper_field, 
+		     uint8_t * const *lower_field)
+{
+  int p, err;
+  int planes = y4m_si_get_plane_count(si);
+  int numwbuf=0;
+  const int maxwbuf=32*1024;
+  uint8_t *wbuf;
+  
+  /* Write frame header */
+  if ((err = y4m_write_frame_header(fd, si, fi)) != Y4M_OK) return err;
+  /* Write each plane */
+  wbuf=_y4m_alloc(maxwbuf);
+  for (p = 0; p < planes; p++) {
+    uint8_t *srctop = upper_field[p];
+    uint8_t *srcbot = lower_field[p];
+    int height = y4m_si_get_plane_height(si, p);
+    int width = y4m_si_get_plane_width(si, p);
+    int y;
+    /* alternately write one line from each field */
+    for (y = 0; y < height; y += 2) {
+      if( width*2 >= maxwbuf ) {
+        if (y4m_write(fd, srctop, width)) goto y4merr;
+        if (y4m_write(fd, srcbot, width)) goto y4merr;
+      } else {
+        if (numwbuf + 2 * width > maxwbuf) {
+          if(y4m_write(fd, wbuf, numwbuf)) goto y4merr;
+          numwbuf=0;
+        }
+
+        memcpy(wbuf+numwbuf,srctop,width); numwbuf += width;
+        memcpy(wbuf+numwbuf,srcbot,width); numwbuf += width;
+      }
+      srctop  += width;
+      srcbot  += width;
+    }
+  }
+  if( numwbuf )
+    if( y4m_write(fd, wbuf, numwbuf) )
+      goto y4merr;
+  _y4m_free(wbuf);
+  return Y4M_OK;
+
+ y4merr:
+  _y4m_free(wbuf);
+  return Y4M_ERR_SYSTEM;
+}
+
+
+/*************************************************************************
+ *
+ * Handy logging of stream info
+ *
+ *************************************************************************/
+
+void y4m_log_stream_info(log_level_t level, const char *prefix,
+			 const y4m_stream_info_t *i)
+{
+  char s[256];
+
+  snprintf(s, sizeof(s), "  frame size:  ");
+  if (i->width == Y4M_UNKNOWN)
+    snprintf(s+strlen(s), sizeof(s)-strlen(s), "(?)x");
+  else
+    snprintf(s+strlen(s), sizeof(s)-strlen(s), "%dx", i->width);
+  if (i->height == Y4M_UNKNOWN)
+    snprintf(s+strlen(s), sizeof(s)-strlen(s), "(?) pixels ");
+  else
+    snprintf(s+strlen(s), sizeof(s)-strlen(s), "%d pixels ", i->height);
+  {
+    int framelength = y4m_si_get_framelength(i);
+    if (framelength == Y4M_UNKNOWN)
+      snprintf(s+strlen(s), sizeof(s)-strlen(s), "(? bytes)");
+    else
+      snprintf(s+strlen(s), sizeof(s)-strlen(s), "(%d bytes)", framelength);
+    mjpeg_log(level, "%s%s", prefix, s);
+  }
+  {
+    const char *desc = y4m_chroma_description(i->chroma);
+    if (desc == NULL) desc = "unknown!";
+    mjpeg_log(level, "%s      chroma:  %s", prefix, desc);
+  }
+  if ((i->framerate.n == 0) && (i->framerate.d == 0))
+    mjpeg_log(level, "%s  frame rate:  ??? fps", prefix);
+  else
+    mjpeg_log(level, "%s  frame rate:  %d/%d fps (~%f)", prefix,
+	      i->framerate.n, i->framerate.d, 
+	      (double) i->framerate.n / (double) i->framerate.d);
+  mjpeg_log(level, "%s   interlace:  %s", prefix,
+	  (i->interlace == Y4M_ILACE_NONE) ? "none/progressive" :
+	  (i->interlace == Y4M_ILACE_TOP_FIRST) ? "top-field-first" :
+	  (i->interlace == Y4M_ILACE_BOTTOM_FIRST) ? "bottom-field-first" :
+	  (i->interlace == Y4M_ILACE_MIXED) ? "mixed-mode" :
+	  "anyone's guess");
+  if ((i->sampleaspect.n == 0) && (i->sampleaspect.d == 0))
+    mjpeg_log(level, "%ssample aspect ratio:  ?:?", prefix);
+  else
+    mjpeg_log(level, "%ssample aspect ratio:  %d:%d", prefix,
+	      i->sampleaspect.n, i->sampleaspect.d);
+}
+
+
+/*************************************************************************
+ *
+ * Convert error code to string
+ *
+ *************************************************************************/
+
+const char *y4m_strerr(int err)
+{
+  switch (err) {
+  case Y4M_OK:          return "no error";
+  case Y4M_ERR_RANGE:   return "parameter out of range";
+  case Y4M_ERR_SYSTEM:  return "system error (failed read/write)";
+  case Y4M_ERR_HEADER:  return "bad stream or frame header";
+  case Y4M_ERR_BADTAG:  return "unknown header tag";
+  case Y4M_ERR_MAGIC:   return "bad header magic";
+  case Y4M_ERR_XXTAGS:  return "too many xtags";
+  case Y4M_ERR_EOF:     return "end-of-file";
+  case Y4M_ERR_BADEOF:  return "stream ended unexpectedly (EOF)";
+  case Y4M_ERR_FEATURE: return "stream requires unsupported features";
+  default: 
+    return "unknown error code";
+  }
+}
+
+
+/*************************************************************************
+ *
+ * Chroma subsampling stuff
+ *
+ *************************************************************************/
+
+y4m_ratio_t y4m_chroma_ss_x_ratio(int chroma_mode)
+{
+  y4m_ratio_t r;
+  switch (chroma_mode) {
+  case Y4M_CHROMA_444ALPHA:
+  case Y4M_CHROMA_444:
+  case Y4M_CHROMA_MONO:
+    r.n = 1; r.d = 1; break;
+  case Y4M_CHROMA_420JPEG:
+  case Y4M_CHROMA_420MPEG2:
+  case Y4M_CHROMA_420PALDV:
+  case Y4M_CHROMA_422:
+    r.n = 1; r.d = 2; break;
+  case Y4M_CHROMA_411:
+    r.n = 1; r.d = 4; break;
+  default:
+    r.n = 0; r.d = 0;
+  }
+  return r;
+}
+
+y4m_ratio_t y4m_chroma_ss_y_ratio(int chroma_mode)
+{
+  y4m_ratio_t r;
+  switch (chroma_mode) {
+  case Y4M_CHROMA_444ALPHA:
+  case Y4M_CHROMA_444:
+  case Y4M_CHROMA_MONO:
+  case Y4M_CHROMA_422:
+  case Y4M_CHROMA_411:
+    r.n = 1; r.d = 1; break;
+  case Y4M_CHROMA_420JPEG:
+  case Y4M_CHROMA_420MPEG2:
+  case Y4M_CHROMA_420PALDV:
+    r.n = 1; r.d = 2; break;
+  default:
+    r.n = 0; r.d = 0;
+  }
+  return r;
+}
+
+
+#if 0  /* unfinished work here */
+y4m_ratio_t y4m_chroma_ss_x_offset(int chroma_mode, int field, int plane)
+{
+  y4m_ratio_t r;
+  switch (chroma_mode) {
+  case Y4M_CHROMA_444ALPHA:
+  case Y4M_CHROMA_444:
+  case Y4M_CHROMA_MONO:
+  case Y4M_CHROMA_422:
+  case Y4M_CHROMA_411:
+    r.n = 0; r.d = 1; break;
+  case Y4M_CHROMA_420JPEG:
+  case Y4M_CHROMA_420MPEG2:
+  case Y4M_CHROMA_420PALDV:
+    r.n = 1; r.d = 2; break;
+  default:
+    r.n = 0; r.d = 0;
+  }
+  return r;
+}
+
+y4m_ratio_t y4m_chroma_ss_y_offset(int chroma_mode, int field, int plane);
+{
+  y4m_ratio_t r;
+  switch (chroma_mode) {
+  case Y4M_CHROMA_444ALPHA:
+  case Y4M_CHROMA_444:
+  case Y4M_CHROMA_MONO:
+  case Y4M_CHROMA_422:
+  case Y4M_CHROMA_411:
+    r.n = 0; r.d = 1; break;
+  case Y4M_CHROMA_420JPEG:
+  case Y4M_CHROMA_420MPEG2:
+  case Y4M_CHROMA_420PALDV:
+    r.n = 1; r.d = 2; break;
+  default:
+    r.n = 0; r.d = 0;
+  }
+  return r;
+}
+#endif
+
+
+
+int y4m_chroma_parse_keyword(const char *s)
+{
+  if (!strcasecmp("420jpeg", s))
+    return Y4M_CHROMA_420JPEG;
+  else if (!strcasecmp("420mpeg2", s))
+    return Y4M_CHROMA_420MPEG2;
+  else if (!strcasecmp("420paldv", s))
+    return Y4M_CHROMA_420PALDV;
+  else if (!strcasecmp("444", s))
+    return Y4M_CHROMA_444;
+  else if (!strcasecmp("422", s))
+    return Y4M_CHROMA_422;
+  else if (!strcasecmp("411", s))
+    return Y4M_CHROMA_411;
+  else if (!strcasecmp("mono", s))
+    return Y4M_CHROMA_MONO;
+  else if (!strcasecmp("444alpha", s))
+    return Y4M_CHROMA_444ALPHA;
+  else
+    return Y4M_UNKNOWN;
+}
+
+
+const char *y4m_chroma_keyword(int chroma_mode)
+{
+  switch (chroma_mode) {
+  case Y4M_CHROMA_420JPEG:  return "420jpeg";
+  case Y4M_CHROMA_420MPEG2: return "420mpeg2";
+  case Y4M_CHROMA_420PALDV: return "420paldv";
+  case Y4M_CHROMA_444:      return "444";
+  case Y4M_CHROMA_422:      return "422";
+  case Y4M_CHROMA_411:      return "411";
+  case Y4M_CHROMA_MONO:     return "mono";
+  case Y4M_CHROMA_444ALPHA: return "444alpha";
+  default:
+    return NULL;
+  }
+}  
+
+
+const char *y4m_chroma_description(int chroma_mode)
+{           
+  switch (chroma_mode) {
+  case Y4M_CHROMA_420JPEG:  return "4:2:0 JPEG/MPEG-1 (interstitial)";
+  case Y4M_CHROMA_420MPEG2: return "4:2:0 MPEG-2 (horiz. cositing)";
+  case Y4M_CHROMA_420PALDV: return "4:2:0 PAL-DV (altern. siting)";
+  case Y4M_CHROMA_444:      return "4:4:4 (no subsampling)";
+  case Y4M_CHROMA_422:      return "4:2:2 (horiz. cositing)";
+  case Y4M_CHROMA_411:      return "4:1:1 (horiz. cositing)";
+  case Y4M_CHROMA_MONO:     return "luma plane only";
+  case Y4M_CHROMA_444ALPHA: return "4:4:4 with alpha channel";
+  default:
+    return NULL;
+  }
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,666 @@
+/*
+ *  yuv4mpeg.h:  Functions for reading and writing "new" YUV4MPEG2 streams.
+ *
+ *               Stream format is described at the end of this file.
+ *
+ *
+ *  Copyright (C) 2004 Matthew J. Marjanovic <maddog at mir.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version 2
+ *  of the License, or (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ */
+
+#ifndef __YUV4MPEG_H__
+#define __YUV4MPEG_H__
+
+#include <stdlib.h>
+#include <mjpeg_types.h>
+#ifndef _WIN32
+#include <unistd.h>
+#endif
+#include <mjpeg_logging.h>
+
+
+/************************************************************************
+ *  error codes returned by y4m_* functions
+ ************************************************************************/
+#define Y4M_OK          0
+#define Y4M_ERR_RANGE   1  /* argument or tag value out of range */
+#define Y4M_ERR_SYSTEM  2  /* failed system call, check errno */
+#define Y4M_ERR_HEADER  3  /* illegal/malformed header */
+#define Y4M_ERR_BADTAG  4  /* illegal tag character */
+#define Y4M_ERR_MAGIC   5  /* bad header magic */
+#define Y4M_ERR_EOF     6  /* end-of-file (clean) */
+#define Y4M_ERR_XXTAGS  7  /* too many xtags */
+#define Y4M_ERR_BADEOF  8  /* unexpected end-of-file */
+#define Y4M_ERR_FEATURE 9  /* stream requires features beyond allowed level */
+
+
+/* generic 'unknown' value for integer parameters (e.g. interlace, height) */
+#define Y4M_UNKNOWN -1
+
+/************************************************************************
+ * values for the "interlace" parameter [y4m_*_interlace()]
+ ************************************************************************/
+#define Y4M_ILACE_NONE          0   /* non-interlaced, progressive frame */
+#define Y4M_ILACE_TOP_FIRST     1   /* interlaced, top-field first       */
+#define Y4M_ILACE_BOTTOM_FIRST  2   /* interlaced, bottom-field first    */
+#define Y4M_ILACE_MIXED         3   /* mixed, "refer to frame header"    */
+
+/************************************************************************
+ * values for the "chroma" parameter [y4m_*_chroma()]
+ ************************************************************************/
+#define Y4M_CHROMA_420JPEG     0  /* 4:2:0, H/V centered, for JPEG/MPEG-1 */
+#define Y4M_CHROMA_420MPEG2    1  /* 4:2:0, H cosited, for MPEG-2         */
+#define Y4M_CHROMA_420PALDV    2  /* 4:2:0, alternating Cb/Cr, for PAL-DV */
+#define Y4M_CHROMA_444         3  /* 4:4:4, no subsampling, phew.         */
+#define Y4M_CHROMA_422         4  /* 4:2:2, H cosited                     */
+#define Y4M_CHROMA_411         5  /* 4:1:1, H cosited                     */
+#define Y4M_CHROMA_MONO        6  /* luma plane only                      */
+#define Y4M_CHROMA_444ALPHA    7  /* 4:4:4 with an alpha channel          */
+
+/************************************************************************
+ * values for sampling parameters [y4m_*_spatial(), y4m_*_temporal()]
+ ************************************************************************/
+#define Y4M_SAMPLING_PROGRESSIVE 0
+#define Y4M_SAMPLING_INTERLACED  1
+
+/************************************************************************
+ * values for "presentation" parameter [y4m_*_presentation()]
+ ************************************************************************/
+#define Y4M_PRESENT_TOP_FIRST         0  /* top-field-first                 */
+#define Y4M_PRESENT_TOP_FIRST_RPT     1  /* top-first, repeat top           */
+#define Y4M_PRESENT_BOTTOM_FIRST      2  /* bottom-field-first              */
+#define Y4M_PRESENT_BOTTOM_FIRST_RPT  3  /* bottom-first, repeat bottom     */
+#define Y4M_PRESENT_PROG_SINGLE       4  /* single progressive frame        */
+#define Y4M_PRESENT_PROG_DOUBLE       5  /* progressive frame, repeat once  */
+#define Y4M_PRESENT_PROG_TRIPLE       6  /* progressive frame, repeat twice */
+
+#define Y4M_MAX_NUM_PLANES 4
+
+/************************************************************************
+ *  'ratio' datatype, for rational numbers
+ *                                     (see 'ratio' functions down below)
+ ************************************************************************/
+typedef struct _y4m_ratio {
+  int n;  /* numerator   */
+  int d;  /* denominator */
+} y4m_ratio_t;
+
+
+/************************************************************************
+ *  useful standard framerates (as ratios)
+ ************************************************************************/
+extern const y4m_ratio_t y4m_fps_UNKNOWN;
+extern const y4m_ratio_t y4m_fps_NTSC_FILM;  /* 24000/1001 film (in NTSC)  */
+extern const y4m_ratio_t y4m_fps_FILM;       /* 24fps film                 */
+extern const y4m_ratio_t y4m_fps_PAL;        /* 25fps PAL                  */
+extern const y4m_ratio_t y4m_fps_NTSC;       /* 30000/1001 NTSC            */
+extern const y4m_ratio_t y4m_fps_30;         /* 30fps                      */
+extern const y4m_ratio_t y4m_fps_PAL_FIELD;  /* 50fps PAL field rate       */
+extern const y4m_ratio_t y4m_fps_NTSC_FIELD; /* 60000/1001 NTSC field rate */
+extern const y4m_ratio_t y4m_fps_60;         /* 60fps                      */
+
+/************************************************************************
+ *  useful standard sample (pixel) aspect ratios (W:H)
+ ************************************************************************/
+extern const y4m_ratio_t y4m_sar_UNKNOWN; 
+extern const y4m_ratio_t y4m_sar_SQUARE;        /* square pixels */
+extern const y4m_ratio_t y4m_sar_NTSC_CCIR601;  /* 525-line (NTSC) Rec.601 */
+extern const y4m_ratio_t y4m_sar_NTSC_16_9;     /* 16:9 NTSC/Rec.601       */
+extern const y4m_ratio_t y4m_sar_NTSC_SVCD_4_3; /* NTSC SVCD 4:3           */
+extern const y4m_ratio_t y4m_sar_NTSC_SVCD_16_9;/* NTSC SVCD 16:9          */
+extern const y4m_ratio_t y4m_sar_PAL_CCIR601;   /* 625-line (PAL) Rec.601  */
+extern const y4m_ratio_t y4m_sar_PAL_16_9;      /* 16:9 PAL/Rec.601        */
+extern const y4m_ratio_t y4m_sar_PAL_SVCD_4_3;  /* PAL SVCD 4:3            */
+extern const y4m_ratio_t y4m_sar_PAL_SVCD_16_9; /* PAL SVCD 16:9           */
+extern const y4m_ratio_t y4m_sar_SQR_ANA16_9;   /* anamorphic 16:9 sampled */
+                                            /* from 4:3 with square pixels */
+
+/************************************************************************
+ *  useful standard display aspect ratios (W:H)
+ ************************************************************************/
+extern const y4m_ratio_t y4m_dar_UNKNOWN; 
+extern const y4m_ratio_t y4m_dar_4_3;     /* standard TV   */
+extern const y4m_ratio_t y4m_dar_16_9;    /* widescreen TV */
+extern const y4m_ratio_t y4m_dar_221_100; /* word-to-your-mother TV */
+
+
+#define Y4M_MAX_XTAGS 32        /* maximum number of xtags in list       */
+#define Y4M_MAX_XTAG_SIZE 32    /* max length of an xtag (including 'X') */
+
+typedef struct _y4m_xtag_list y4m_xtag_list_t;
+typedef struct _y4m_stream_info y4m_stream_info_t;
+typedef struct _y4m_frame_info y4m_frame_info_t;
+
+
+#ifdef __cplusplus
+#define BEGIN_CDECLS extern "C" {
+#define END_CDECLS   }
+#else
+#define BEGIN_CDECLS 
+#define END_CDECLS   
+#endif
+
+BEGIN_CDECLS
+
+/************************************************************************
+ *  'ratio' functions
+ ************************************************************************/
+
+/* 'normalize' a ratio (remove common factors) */
+void y4m_ratio_reduce(y4m_ratio_t *r);
+
+/* parse "nnn:ddd" into a ratio (returns Y4M_OK or Y4M_ERR_RANGE) */
+int y4m_parse_ratio(y4m_ratio_t *r, const char *s);
+
+/* quick test of two ratios for equality (i.e. identical components) */
+#define Y4M_RATIO_EQL(a,b) ( ((a).n == (b).n) && ((a).d == (b).d) )
+
+/* quick conversion of a ratio to a double (no divide-by-zero check!) */
+#define Y4M_RATIO_DBL(r) ((double)(r).n / (double)(r).d)
+
+/*************************************************************************
+ *
+ * Guess the true SAR (sample aspect ratio) from a list of commonly 
+ * encountered values, given the "suggested" display aspect ratio (DAR),
+ * and the true frame width and height.
+ *
+ * Returns y4m_sar_UNKNOWN if no match is found.
+ *
+ *************************************************************************/
+y4m_ratio_t y4m_guess_sar(int width, int height, y4m_ratio_t dar);
+
+
+/*************************************************************************
+ *
+ * Chroma Subsampling Mode information
+ *
+ *  x_ratio, y_ratio  -  subsampling of chroma planes
+ *  x_offset, y_offset - offset of chroma sample grid,
+ *                        relative to luma (0,0) sample
+ *
+ *************************************************************************/
+
+y4m_ratio_t y4m_chroma_ss_x_ratio(int chroma_mode);
+y4m_ratio_t y4m_chroma_ss_y_ratio(int chroma_mode);
+#if 0
+y4m_ratio_t y4m_chroma_ss_x_offset(int chroma_mode, int field, int plane);
+y4m_ratio_t y4m_chroma_ss_y_offset(int chroma_mode, int field, int plane);
+#endif
+
+/* Given a string containing a (case-insensitive) chroma-tag keyword,
+   return appropriate chroma mode (or Y4M_UNKNOWN) */
+int y4m_chroma_parse_keyword(const char *s);
+
+/* Given a Y4M_CHROMA_* mode, return appropriate chroma-tag keyword,
+   or NULL if there is none. */
+const char *y4m_chroma_keyword(int chroma_mode);
+
+/* Given a Y4M_CHROMA_* mode, return appropriate chroma mode description,
+   or NULL if there is none. */
+const char *y4m_chroma_description(int chroma_mode);
+
+
+
+/************************************************************************
+ *  'xtag' functions
+ *
+ * o Before using an xtag_list (but after the structure/memory has been
+ *    allocated), you must initialize it via y4m_init_xtag_list().
+ * o After using an xtag_list (but before the structure is released),
+ *    call y4m_fini_xtag_list() to free internal memory.
+ *
+ ************************************************************************/
+
+/* initialize an xtag_list structure */
+void y4m_init_xtag_list(y4m_xtag_list_t *xtags);
+
+/* finalize an xtag_list structure */
+void y4m_fini_xtag_list(y4m_xtag_list_t *xtags);
+
+/* make one xtag_list into a copy of another */
+void y4m_copy_xtag_list(y4m_xtag_list_t *dest, const y4m_xtag_list_t *src);
+
+/* return number of tags in an xtag_list */
+int y4m_xtag_count(const y4m_xtag_list_t *xtags);
+
+/* access n'th tag in an xtag_list */
+const char *y4m_xtag_get(const y4m_xtag_list_t *xtags, int n);
+
+/* append a new tag to an xtag_list
+    returns:          Y4M_OK - success
+              Y4M_ERR_XXTAGS - list is already full */
+int y4m_xtag_add(y4m_xtag_list_t *xtags, const char *tag);
+
+/* remove a tag from an xtag_list 
+    returns:         Y4M_OK - success
+              Y4M_ERR_RANGE - n is out of range */
+int y4m_xtag_remove(y4m_xtag_list_t *xtags, int n);
+
+/* remove all tags from an xtag_list 
+    returns:   Y4M_OK - success       */
+int y4m_xtag_clearlist(y4m_xtag_list_t *xtags);
+
+/* append copies of tags from src list to dest list
+    returns:          Y4M_OK - success
+              Y4M_ERR_XXTAGS - operation would overfill dest list */
+int y4m_xtag_addlist(y4m_xtag_list_t *dest, const y4m_xtag_list_t *src);
+
+
+
+/************************************************************************
+ *  '*_info' functions
+ *
+ * o Before using a *_info structure (but after the structure/memory has
+ *    been allocated), you must initialize it via y4m_init_*_info().
+ * o After using a *_info structure (but before the structure is released),
+ *    call y4m_fini_*_info() to free internal memory.
+ * o Use the 'set' and 'get' accessors to modify or access the fields in
+ *    the structures; don't touch the structure directly.  (Ok, so there
+ *    is no really convenient C syntax to prevent you from doing this,
+ *    but we are all responsible programmers here, so just don't do it!)
+ *
+ ************************************************************************/
+
+/* initialize a stream_info structure */
+void y4m_init_stream_info(y4m_stream_info_t *i);
+
+/* finalize a stream_info structure */
+void y4m_fini_stream_info(y4m_stream_info_t *i);
+
+/* reset stream_info back to default/unknown values */
+void y4m_clear_stream_info(y4m_stream_info_t *info);
+
+/* make one stream_info into a copy of another */
+void y4m_copy_stream_info(y4m_stream_info_t *dest,
+			  const y4m_stream_info_t *src);
+
+/* access or set stream_info fields */
+/*      level 0                   */
+int y4m_si_get_width(const y4m_stream_info_t *si);
+int y4m_si_get_height(const y4m_stream_info_t *si);
+int y4m_si_get_interlace(const y4m_stream_info_t *si);
+y4m_ratio_t y4m_si_get_framerate(const y4m_stream_info_t *si);
+y4m_ratio_t y4m_si_get_sampleaspect(const y4m_stream_info_t *si);
+void y4m_si_set_width(y4m_stream_info_t *si, int width);
+void y4m_si_set_height(y4m_stream_info_t *si, int height);
+void y4m_si_set_interlace(y4m_stream_info_t *si, int interlace);
+void y4m_si_set_framerate(y4m_stream_info_t *si, y4m_ratio_t framerate);
+void y4m_si_set_sampleaspect(y4m_stream_info_t *si, y4m_ratio_t sar);
+/*      level 1                   */
+void y4m_si_set_chroma(y4m_stream_info_t *si, int chroma_mode);
+int y4m_si_get_chroma(const y4m_stream_info_t *si);
+
+/* derived quantities (no setter) */
+/*      level 0                   */
+int y4m_si_get_framelength(const y4m_stream_info_t *si);
+/*      level 1                   */
+int y4m_si_get_plane_count(const y4m_stream_info_t *si);
+int y4m_si_get_plane_width(const y4m_stream_info_t *si, int plane);
+int y4m_si_get_plane_height(const y4m_stream_info_t *si, int plane);
+int y4m_si_get_plane_length(const y4m_stream_info_t *si, int plane);
+
+
+/* access stream_info xtag_list */
+y4m_xtag_list_t *y4m_si_xtags(y4m_stream_info_t *si);
+
+
+/* initialize a frame_info structure */
+void y4m_init_frame_info(y4m_frame_info_t *i);
+
+/* finalize a frame_info structure */
+void y4m_fini_frame_info(y4m_frame_info_t *i);
+
+/* reset frame_info back to default/unknown values */
+void y4m_clear_frame_info(y4m_frame_info_t *info);
+
+/* make one frame_info into a copy of another */
+void y4m_copy_frame_info(y4m_frame_info_t *dest,
+			 const y4m_frame_info_t *src);
+
+
+/* access or set frame_info fields (level 1) */
+int y4m_fi_get_presentation(const y4m_frame_info_t *fi);
+int y4m_fi_get_temporal(const y4m_frame_info_t *fi);
+int y4m_fi_get_spatial(const y4m_frame_info_t *fi);
+
+void y4m_fi_set_presentation(y4m_frame_info_t *fi, int pres);
+void y4m_fi_set_temporal(y4m_frame_info_t *fi, int sampling);
+void y4m_fi_set_spatial(y4m_frame_info_t *fi, int sampling);
+
+
+/* access frame_info xtag_list */
+y4m_xtag_list_t *y4m_fi_xtags(y4m_frame_info_t *fi);
+
+
+
+/************************************************************************
+ *  blocking read and write functions
+ *
+ *  o guaranteed to transfer entire payload (or fail)
+ *  o return values:
+ *                         0 (zero)   complete success
+ *          -(# of remaining bytes)   error (and errno left set)
+ *          +(# of remaining bytes)   EOF (for y4m_read only)
+ *
+ ************************************************************************/
+
+/* read len bytes from fd into buf */
+ssize_t y4m_read(int fd, void *buf, size_t len);
+
+/* write len bytes from fd into buf */
+ssize_t y4m_write(int fd, const void *buf, size_t len);
+
+
+
+/************************************************************************
+ *  stream header processing functions
+ *  
+ *  o return values:
+ *                   Y4M_OK - success
+ *                Y4M_ERR_* - error (see y4m_strerr() for descriptions)
+ *
+ ************************************************************************/
+
+/* parse a string of stream header tags */
+int y4m_parse_stream_tags(char *s, y4m_stream_info_t *i);
+
+/* read a stream header from file descriptor fd
+   (the current contents of stream_info are erased first) */
+int y4m_read_stream_header(int fd, y4m_stream_info_t *i);
+
+/* write a stream header to file descriptor fd */
+int y4m_write_stream_header(int fd, const y4m_stream_info_t *i);
+
+
+
+/************************************************************************
+ *  frame processing functions
+ *  
+ *  o return values:
+ *                   Y4M_OK - success
+ *                Y4M_ERR_* - error (see y4m_strerr() for descriptions)
+ *
+ ************************************************************************/
+
+/* write a frame header to file descriptor fd */
+int y4m_write_frame_header(int fd,
+			   const y4m_stream_info_t *si,
+			   const y4m_frame_info_t *fi);
+
+/* write a complete frame (header + data)
+   o planes[] points to 1-4 buffers, one each for image plane */
+int y4m_write_frame(int fd, const y4m_stream_info_t *si, 
+		    const y4m_frame_info_t *fi, uint8_t * const *planes);
+
+
+/* write a complete frame (header + data), but interleave fields
+    from two separate buffers
+   o upper_field[] same as planes[] above, but for upper field only
+   o lower_field[] same as planes[] above, but for lower field only
+*/
+int y4m_write_fields(int fd, const y4m_stream_info_t *si, 
+		     const y4m_frame_info_t *fi,
+		     uint8_t * const *upper_field, 
+		     uint8_t * const *lower_field);
+
+
+/* read a frame header from file descriptor fd 
+   (the current contents of frame_info are erased first) */
+int y4m_read_frame_header(int fd,
+			  const y4m_stream_info_t *si,
+			  y4m_frame_info_t *fi);
+
+/* read frame data [to be called after y4m_read_frame_header()]
+   o planes[] points to 1-4 buffers, one each for image plane */
+int y4m_read_frame_data(int fd, const y4m_stream_info_t *si, 
+                        y4m_frame_info_t *fi, uint8_t * const *planes);
+
+/* read frame data, but de-interleave fields into two separate buffers
+    [to be called after y4m_read_frame_header()]
+   o upper_field[] same as planes[] above, but for upper field only
+   o lower_field[] same as planes[] above, but for lower field only
+*/
+int y4m_read_fields_data(int fd, const y4m_stream_info_t *si, 
+                         y4m_frame_info_t *fi,
+                         uint8_t * const *upper_field, 
+                         uint8_t * const *lower_field);
+
+/* read a complete frame (header + data)
+   o planes[] points to 1-4 buffers, one each for image plane */
+int y4m_read_frame(int fd, const y4m_stream_info_t *si, 
+		   y4m_frame_info_t *fi, uint8_t * const *planes);
+
+/* read a complete frame (header + data), but de-interleave fields
+    into two separate buffers
+   o upper_field[] same as planes[] above, but for upper field only
+   o lower_field[] same as planes[] above, but for lower field only
+*/
+int y4m_read_fields(int fd, const y4m_stream_info_t *si, 
+		    y4m_frame_info_t *fi,
+		    uint8_t * const *upper_field, 
+		    uint8_t * const *lower_field);
+
+
+/************************************************************************
+ *  miscellaneous functions
+ ************************************************************************/
+
+/* convenient dump of stream header info via mjpeg_log facility
+ *  - each logged/printed line is prefixed by 'prefix'
+ */
+void y4m_log_stream_info(log_level_t level, const char *prefix,
+			 const y4m_stream_info_t *i);
+
+/* convert a Y4M_ERR_* error code into mildly explanatory string */
+const char *y4m_strerr(int err);
+
+/* set 'allow_unknown_tag' flag for library...
+    o yn = 0 :  unknown header tags will produce a parsing error
+    o yn = 1 :  unknown header tags/values will produce a warning, but
+                 are otherwise passed along via the xtags list
+    o yn = -1:  don't change, just return current setting
+
+   return value:  previous setting of flag
+*/
+int y4m_allow_unknown_tags(int yn);
+
+
+/* set level of "accepted extensions" for the library...
+    o level = 0:  default - conform to original YUV4MPEG2 spec; yield errors
+                   when reading or writing a stream which exceeds it.
+    o level = 1:  allow reading/writing streams which contain non-420jpeg
+                   chroma and/or mixed-mode interlacing
+    o level = -1: don't change, just return current setting
+
+   return value:  previous setting of level
+ */
+int y4m_accept_extensions(int level);
+
+
+END_CDECLS
+
+
+/************************************************************************
+ ************************************************************************
+
+  Description of the (new!, forever?) YUV4MPEG2 stream format:
+
+  STREAM consists of
+    o one '\n' terminated STREAM-HEADER
+    o unlimited number of FRAMEs
+
+  FRAME consists of
+    o one '\n' terminated FRAME-HEADER
+    o "length" octets of planar YCrCb 4:2:0 image data
+        (if frame is interlaced, then the two fields are interleaved)
+
+
+  STREAM-HEADER consists of
+     o string "YUV4MPEG2"
+     o unlimited number TAGGED-FIELDs, each preceded by ' ' separator
+     o '\n' line terminator
+
+  FRAME-HEADER consists of
+     o string "FRAME"
+     o unlimited number of TAGGED-FIELDs, each preceded by ' ' separator
+     o '\n' line terminator
+
+
+  TAGGED-FIELD consists of
+     o single ascii character tag
+     o VALUE (which does not contain whitespace)
+
+  VALUE consists of
+     o integer (base 10 ascii representation)
+  or o RATIO
+  or o single ascii character
+  or o non-whitespace ascii string
+
+  RATIO consists of
+     o numerator (integer)
+     o ':' (a colon)
+     o denominator (integer)
+
+
+  The currently supported tags for the STREAM-HEADER:
+     W - [integer] frame width, pixels, should be > 0
+     H - [integer] frame height, pixels, should be > 0
+     C - [string]  chroma-subsampling/data format
+           420jpeg   (default)
+           420mpeg2
+           420paldv
+           411
+           422
+           444       - non-subsampled Y'CbCr
+	   444alpha  - Y'CbCr with alpha channel (with Y' black/white point)
+           mono      - Y' plane only
+     I - [char] interlacing:  p - progressive (none)
+                              t - top-field-first
+                              b - bottom-field-first
+                              m - mixed -- see 'I' tag in frame header
+                              ? - unknown
+     F - [ratio] frame-rate, 0:0 == unknown
+     A - [ratio] sample (pixel) aspect ratio, 0:0 == unknown
+     X - [character string] 'metadata' (unparsed, but passed around)
+
+  The currently supported tags for the FRAME-HEADER:
+     Ixyz - framing/sampling (required if-and-only-if stream is "Im")
+          x:  t - top-field-first
+              T - top-field-first and repeat
+	      b - bottom-field-first
+              B - bottom-field-first and repeat
+              1 - single progressive frame
+              2 - double progressive frame (repeat)
+              3 - triple progressive frame (repeat twice)
+
+          y:  p - progressive:  fields sampled at same time
+              i - interlaced:   fields sampled at different times
+
+          z:  p - progressive:  subsampling over whole frame
+              i - interlaced:   each field subsampled independently
+              ? - unknown (allowed only for non-4:2:0 subsampling)           
+       
+     X - character string 'metadata' (unparsed, but passed around)
+
+ ************************************************************************
+ ************************************************************************/
+
+
+/*
+
+   THAT'S ALL FOLKS!
+
+   Thank you for reading the source code.  We hope you have thoroughly
+   enjoyed the experience.
+
+*/
+
+
+
+
+
+#ifdef INTERNAL_Y4M_LIBCODE_STUFF_QPX
+#define Y4MPRIVATIZE(identifier) identifier
+#else
+#define Y4MPRIVATIZE(identifier) PRIVATE##identifier
+#endif
+
+/* 
+ * Actual structure definitions of structures which you shouldn't touch.
+ *
+ */
+
+/************************************************************************
+ *  'xtag_list' --- list of unparsed and/or meta/X header tags
+ *
+ *     Do not touch this structure directly!
+ *
+ *     Use the y4m_xtag_*() functions (see below).
+ *     You must initialize/finalize this structure before/after use.
+ ************************************************************************/
+struct _y4m_xtag_list {
+  int Y4MPRIVATIZE(count);
+  char *Y4MPRIVATIZE(tags)[Y4M_MAX_XTAGS];
+};
+
+
+/************************************************************************
+ *  'stream_info' --- stream header information
+ *
+ *     Do not touch this structure directly!
+ *
+ *     Use the y4m_si_*() functions (see below).
+ *     You must initialize/finalize this structure before/after use.
+ ************************************************************************/
+struct _y4m_stream_info {
+  /* values from header/setters */
+  int Y4MPRIVATIZE(width);
+  int Y4MPRIVATIZE(height);
+  int Y4MPRIVATIZE(interlace);            /* see Y4M_ILACE_* definitions  */
+  y4m_ratio_t Y4MPRIVATIZE(framerate);    /* see Y4M_FPS_* definitions    */
+  y4m_ratio_t Y4MPRIVATIZE(sampleaspect); /* see Y4M_SAR_* definitions    */
+  int Y4MPRIVATIZE(chroma);               /* see Y4M_CHROMA_* definitions */
+
+  /* mystical X tags */
+  y4m_xtag_list_t Y4MPRIVATIZE(x_tags);
+};
+
+
+/************************************************************************
+ *  'frame_info' --- frame header information
+ *
+ *     Do not touch this structure directly!
+ *
+ *     Use the y4m_fi_*() functions (see below).
+ *     You must initialize/finalize this structure before/after use.
+ ************************************************************************/
+
+struct _y4m_frame_info {
+  int Y4MPRIVATIZE(spatial);      /* see Y4M_SAMPLING_* definitions */
+  int Y4MPRIVATIZE(temporal);     /* see Y4M_SAMPLING_* definitions */
+  int Y4MPRIVATIZE(presentation); /* see Y4M_PRESENT_* definitions  */
+  /* mystical X tags */
+  y4m_xtag_list_t Y4MPRIVATIZE(x_tags);
+};
+
+
+#undef Y4MPRIVATIZE
+
+
+#endif /* __YUV4MPEG_H__ */
+
+

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_intern.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_intern.h	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_intern.h	2007-08-03 00:04:40 UTC (rev 3469)
@@ -0,0 +1,85 @@
+/*
+ *  yuv4mpeg_intern.h:  Internal constants for "new" YUV4MPEG streams
+ *
+ *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
+ *  Copyright (C) 2001 Matthew J. Marjanovic <maddog at mir.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of version 2 of the GNU General Public License
+ *  as published by the Free Software Foundation.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ */
+
+#ifndef __YUV4MPEG_INTERN_H__
+#define __YUV4MPEG_INTERN_H__
+
+
+#define Y4M_MAGIC "YUV4MPEG2"
+#define Y4M_FRAME_MAGIC "FRAME"
+
+#define Y4M_DELIM " "  /* single-character(space) separating tagged fields */
+
+#define Y4M_LINE_MAX 256   /* max number of characters in a header line
+                               (including the '\n', but not the '\0') */
+
+
+/* standard framerate ratios */
+#define Y4M_FPS_UNKNOWN    { 0, 0 }
+#define Y4M_FPS_NTSC_FILM  { 24000, 1001 }
+#define Y4M_FPS_FILM       { 24, 1 }
+#define Y4M_FPS_PAL        { 25, 1 }
+#define Y4M_FPS_NTSC       { 30000, 1001 }
+#define Y4M_FPS_30         { 30, 1 }
+#define Y4M_FPS_PAL_FIELD  { 50, 1 }
+#define Y4M_FPS_NTSC_FIELD { 60000, 1001 }
+#define Y4M_FPS_60         { 60, 1 }
+
+/* standard sample/pixel aspect ratios */
+#define Y4M_SAR_UNKNOWN        {   0, 0  }
+#define Y4M_SAR_SQUARE         {   1, 1  }
+#define Y4M_SAR_SQR_ANA_16_9   {   4, 3  }
+#define Y4M_SAR_NTSC_CCIR601   {  10, 11 }
+#define Y4M_SAR_NTSC_16_9      {  40, 33 }
+#define Y4M_SAR_NTSC_SVCD_4_3  {  15, 11 }
+#define Y4M_SAR_NTSC_SVCD_16_9 {  20, 11 }
+#define Y4M_SAR_PAL_CCIR601    {  59, 54 }
+#define Y4M_SAR_PAL_16_9       { 118, 81 }
+#define Y4M_SAR_PAL_SVCD_4_3   {  59, 36 }
+#define Y4M_SAR_PAL_SVCD_16_9  {  59, 27 }
+
+#define Y4M_SAR_MPEG1_1  Y4M_SAR_SQUARE
+#define Y4M_SAR_MPEG1_2  { 10000, 6735 }
+#define Y4M_SAR_MPEG1_3  { 10000, 7031 } /* Anamorphic 16:9 PAL */
+#define Y4M_SAR_MPEG1_4  { 10000, 7615 }
+#define Y4M_SAR_MPEG1_5  { 10000, 8055 }
+#define Y4M_SAR_MPEG1_6  { 10000, 8437 } /* Anamorphic 16:9 NTSC */
+#define Y4M_SAR_MPEG1_7  { 10000, 8935 } 
+#define Y4M_SAR_MPEG1_8  { 10000, 9375 } /* PAL/SECAM 4:3 */
+#define Y4M_SAR_MPEG1_9  { 10000, 9815 }
+#define Y4M_SAR_MPEG1_10 { 10000, 10255 }
+#define Y4M_SAR_MPEG1_11 { 10000, 10695 }
+#define Y4M_SAR_MPEG1_12 { 10000, 11250 } /* NTSC 4:3 */
+#define Y4M_SAR_MPEG1_13 { 10000, 11575 }
+#define Y4M_SAR_MPEG1_14 { 10000, 12015 }
+
+#define Y4M_DAR_UNKNOWN  {   0, 0   }
+#define Y4M_DAR_4_3      {   4, 3   }
+#define Y4M_DAR_16_9     {  16, 9   }
+#define Y4M_DAR_221_100  { 221, 100 }
+
+#define Y4M_DAR_MPEG2_1 {   1, 1   }
+#define Y4M_DAR_MPEG2_2 {   4, 3   }
+#define Y4M_DAR_MPEG2_3 {  16, 9   }
+#define Y4M_DAR_MPEG2_4 { 221, 100 }
+
+#endif /* __YUV4MPEG_INTERN_H__ */
+

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm.hpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm.hpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,68 +0,0 @@
-
-/*
- *  zalphastrm.hpp:  Z/Alpha video elementary input stream
- *
- *  Copyright (C) 2002 Gernot Ziegler <gz at lysator.liu.se>
- *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
- *
- *
- *  This program is free software; you can redistribute it and/or
- *  modify it under the terms of version 2 of the GNU General Public License
- *  as published by the Free Software Foundation.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
- */
-
-#ifndef __ZALPHASTRM_H__
-#define __ZALPHASTRM_H__
-
-#include "videostrm.hpp"
-
-class ZAlphaStream : public VideoStream
-{
-public:
-	//ZAlphaStream(IBitStream &ibs, OutputStream &into);
-	ZAlphaStream(IBitStream &ibs, VideoParams *parms, 
-                Multiplexor &into);
-	void Init( const int stream_num );
-    static bool Probe(IBitStream &bs );
-
-	void Close();
-
-	virtual bool MuxPossible(clockticks currentSCR);
-    void SetMaxStdBufferDelay( unsigned int demux_rate );
-	void OutputSector();
-protected:
-	void OutputSeqhdrInfo();
-    void FillAUbuffer(unsigned int frames_to_buffer);
-    virtual bool AUBufferNeedsRefill();
-	virtual void NextDTSPTS( clockticks &DTS, clockticks &PTS);
-	virtual void ScanFirstSeqHeader();
-    bool RunOutComplete();
-
-private:
-    float z_min; 
-    float z_max;	
-    int z_format;
-    int alpha_depth, z_depth;
-}; 	
-
-
-
-#endif // __INPUTSTRM_H__
-
-
-/* 
- * Local variables:
- *  c-file-style: "stroustrup"
- *  tab-width: 4
- *  indent-tabs-mode: nil
- * End:
- */

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_in.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_in.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_in.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,492 +0,0 @@
-/*
- *  zalphastrm_in.cpp:  Members of Z/Alpha stream class related to raw stream
- *               scanning and buffering.
- *
- *  Copyright (C) 2001 Gernot Ziegler <gz at lysator.liu.se>
- *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
- *
- *
- *  This program is free software; you can redistribute it and/or
- *  modify it under the terms of version 2 of the GNU General Public License
- *  as published by the Free Software Foundation.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
- */
-
-#include <config.h>
-#include <math.h>
-#include <stdlib.h>
-
-#include "zalphastrm.hpp"
-#include "interact.hpp"
-#include "multiplexor.hpp"
-
-
-
-static void marker_bit (IBitStream &bs, unsigned int what)
-{
-    if (what != bs.Get1Bit())
-    {
-        mjpeg_error ("Illegal MPEG stream at offset (bits) %lld: supposed marker bit not found.",bs.bitcount());
-        exit (1);
-    }
-}
-
-
-void ZAlphaStream::ScanFirstSeqHeader()
-{
-    if (bs.GetBits( 32)==ZA_SEQUENCE_HEADER)
-    {
-        mjpeg_debug("Reading Z/Alpha sequence header ... ");
-		num_sequence++;
-        
-        int headerlen = bs.GetBits(16);
-        mjpeg_info("Header frame length is %d", headerlen);
-
-        int frame_num = bs.GetBits(8);
-        mjpeg_info("Header frame number is %d", frame_num);
-		horizontal_size	= bs.GetBits( 12);
-		vertical_size	= bs.GetBits( 12);
-
-#if 0 
-		aspect_ratio	= bs.GetBits(  4);
-		picture_rate 	= bs.GetBits(  4);
-		bit_rate		= bs.GetBits( 18);
-		marker_bit( bs, 1);
-		vbv_buffer_size	= bs.GetBits( 10);
-		CSPF		= bs.get1bit();
-#else
-        // hardcoded here, but should really be copied from the video stream... 
-		aspect_ratio	= 2;
-		picture_rate	= 3;
-		bit_rate		= 3000;
-        //bit_rate = 0x3ffff;
-		//marker_bit( bs, 1);
-		vbv_buffer_size	= 50;
-		CSPF		= 0;
-#endif
-        uint8_t conv[4];
-
-        conv[0] = bs.GetBits(8);
-        conv[1] = bs.GetBits(8);
-        conv[2] = bs.GetBits(8);
-        conv[3] = bs.GetBits(8);
-
-        memcpy(&z_min, conv, 4);
-
-        conv[0] = bs.GetBits(8);
-        conv[1] = bs.GetBits(8);
-        conv[2] = bs.GetBits(8);
-        conv[3] = bs.GetBits(8);
-
-        memcpy(&z_max, conv, 4);
-
-        z_format = bs.GetBits(8);
-        printf("Z format byte is set to 0x%x\n", z_format);
-        z_depth = bs.GetBits(8);
-        alpha_depth = bs.GetBits(8);
-    } 
-    else
-    {
-		mjpeg_error ("Invalid MPEG ZAlpha stream header.");
-		exit (1);
-    }
-
-	if (mpeg_valid_framerate_code(picture_rate))
-    {
-		frame_rate = Y4M_RATIO_DBL(mpeg_framerate(picture_rate));
-	}
-    else
-    {
-		frame_rate = 25.0;
-	}
-
-}
-
-
-
-
-void ZAlphaStream::Init ( const int stream_num )
-{
-	mjpeg_debug( "SETTING video buffer to %d", parms->DecodeBufferSize() );
-	MuxStream::Init( ZALPHA_STR_0+stream_num,
-					 1,  // Buffer scale
-					 parms->DecodeBufferSize()*1024,
-					 0,  // Zero stuffing
-					 muxinto.buffers_in_video,
-					 muxinto.always_buffers_in_video);
-    mjpeg_debug( "Scanning for header info: Z/Alpha stream %02x (%s)",
-                ZALPHA_STR_0+stream_num,
-                bs.StreamName()
-                );
-	InitAUbuffer();
-
-	SetBufSize( 4*1024*1024 );
-	ScanFirstSeqHeader();
-
-	/* Skip to the end of the 1st AU (*2nd* Picture start!)
-	*/
-	AU_hdr = ZA_SEQUENCE_HEADER;
-	AU_pict_data = 1;
-	AU_start = 0LL;
-    
-    OutputSeqhdrInfo();
-}
-
-//
-// Set the Maximum STD buffer delay for this video stream.
-// By default we set 1 second but if we have specified a video
-// buffer that can hold more than 1.0 seconds demuxed data we
-// set the delay to the time to fill the buffer.
-//
-
-void ZAlphaStream::SetMaxStdBufferDelay( unsigned int dmux_rate )
-{
-    double max_delay = CLOCKS;
-    if( static_cast<double>(BufferSize()) / dmux_rate > 1.0 )
-        max_delay *= static_cast<double>(BufferSize()) / dmux_rate;
-
-    //
-    // To enforce a maximum STD buffer residency the
-    // calculation is a bit tricky as when we decide to mux we may
-    // (but not always) have some of the *previous* picture left to
-    // mux in which case it is the timestamp of the next picture that counts.
-    // For simplicity we simply reduce the limit by 1.5 frame intervals
-    // and use the timestamp for the current picture.
-    //
-    if( frame_rate > 10.0 )
-        max_STD_buffer_delay = static_cast<clockticks>(max_delay * (frame_rate-1.5)/frame_rate);
-    else
-        max_STD_buffer_delay = static_cast<clockticks>(10.0 * max_delay / frame_rate);
-
-    mjpeg_error_exit1("dmux_rate is %d max_delay %g", dmux_rate, max_delay);
-
-}
-
-//
-// Return whether AU buffer needs refilling.  There are two cases:
-// 1. We have less than our look-ahead "FRAME_CHUNK" buffer AU's
-// buffered 2. AU's are very small and we could have less than 1
-// sector's worth of data buffered.
-//
-
-bool ZAlphaStream::AUBufferNeedsRefill()
-{
-    int retval = 
-        !eoscan
-        && ( aunits.current()+FRAME_CHUNK > last_buffered_AU
-             ||
-             bs.BufferedBytes() < muxinto.sector_size 
-            );
-
-    //mjpeg_info("Z/A needs %s refill.\n", retval ? "a":"no");
-    return retval;
-}
-
-//
-// Refill the AU unit buffer setting  AU PTS DTS from the scanned
-// header information...
-//
-
-void ZAlphaStream::FillAUbuffer(unsigned int frames_to_buffer)
-{
-    int frame_num;
-    unsigned int bits_persec;
-    int headerlen;
-
-    if( eoscan )
-        return;
-
-	last_buffered_AU += frames_to_buffer;
-	mjpeg_debug( "Scanning %d Z/A video frames to frame %d", 
-				 frames_to_buffer, last_buffered_AU );
-
-    // We set a limit of 2M to seek before we give up.
-    // This is intentionally very high because some heavily
-    // padded still frames may have a loooong gap before
-    // a following sequence end marker.
-	while(!bs.eos() 
-          && decoding_order < last_buffered_AU 
-          && !muxinto.AfterMaxPTS(access_unit.PTS)
-          && bs.SeekSync( SYNCWORD_START, 24, 2*1024*1024)
-		)
-	{
-		syncword = (SYNCWORD_START<<8) + bs.GetBits( 8);
-        //mjpeg_info( "Traversing ... syncword 0x%x ", syncword); 
-		if( AU_pict_data )
-		{
-			
-			/* Handle the header *ending* an AU...
-			   If we have the AU picture data an AU and have now
-			   reached a header marking the end of an AU fill in the
-			   the AU length and append it to the list of AU's and
-			   start a new AU.  I.e. sequence and gop headers count as
-			   part of the AU of the corresponding picture
-			*/
-			stream_length = bs.bitcount()-32LL;
-			switch (syncword) 
-			{
-            // note: there are currently _no_ sequence distinctions in Z/Alpha ! 
-			case ZA_SEQUENCE_HEADER :
-				access_unit.start = AU_start;
-				access_unit.length = (int) (stream_length - AU_start)>>3;
-				access_unit.end_seq = 0;
-                access_unit.type = IFRAME;
-				avg_frames[access_unit.type-1]+=access_unit.length;
-                access_unit.dorder = decoding_order;
-                access_unit.seq_header = 1; //( AU_hdr == SEQUENCE_HEADER);
-
-                
-                bits_persec = 
-					(unsigned int) ( ((double)(stream_length - prev_offset)) *
-									 2*frame_rate / ((double)(2 /*+ fields_presented- group_start_field*/)));
-				
-                //mjpeg_info("New bits_persec is %d bits/second.", bits_persec);
-                
-				if( bits_persec > max_bits_persec )
-				{
-					max_bits_persec = bits_persec;
-				}
-
-				prev_offset = stream_length;
-
-                headerlen = bs.GetBits(16);
-                frame_num = bs.GetBits(8);
-                //mjpeg_info("Header frame number is %d", frame_num);
-
-				mjpeg_debug( "Found Z/Alpha AU %d (real: %d): DTS=%d", access_unit.dorder, frame_num,
-							 access_unit.DTS/300);
-                
-                if ( decoding_order >= old_frames+1000 )
-                {
-                    mjpeg_debug("Got %d picture headers.", decoding_order);
-                    old_frames = decoding_order;
-                }
-
-                decoding_order++;
-                //mjpeg_info("Decoding order is now %d", decoding_order);
-
-                NextDTSPTS( access_unit.DTS, access_unit.PTS);
-				aunits.append( access_unit ); // INSERTING NEW AUNIT ! 
-
-                
-                if ((access_unit.type>0) && (access_unit.type<5))
-                {
-                    num_frames[access_unit.type-1]++; // counts the frames in this Z/Alpha stream
-                }                
-                
-				AU_hdr = syncword;
-				AU_start = stream_length;
-				AU_pict_data = 1;
-
-                if (decoding_order >= last_buffered_AU)
-                {
-                    mjpeg_debug("Reached end of buffer ...");
-                    break;
-                }
-
-				break;
-
-			case SEQUENCE_END: // still using the MPEG sequence end, so that we don't have to use another SYNCWORD
-				access_unit.start = AU_start;
-				access_unit.length = (int) ((stream_length - AU_start)>>3)+4;
-				access_unit.end_seq = 1;
-				avg_frames[access_unit.type-1]+=access_unit.length;
-                access_unit.dorder = decoding_order;
-                access_unit.seq_header = 1; //( AU_hdr == SEQUENCE_HEADER);
-
-                access_unit.type = IFRAME;
-				mjpeg_debug( "Adding final AU %d (real: %d): DTS=%d", access_unit.dorder, frame_num,
-							 access_unit.DTS/300);
-                NextDTSPTS( access_unit.DTS, access_unit.PTS);
-				aunits.append( access_unit ); // INSERTING NEW AUNIT ! 
-
-
-				//access_unit.length = ((stream_length - AU_start)>>3)+4;
-				//access_unit.end_seq = 1;
-				//aunits.append( access_unit );
-				mjpeg_debug( "Z/Alpha: Scanned to end AU %d at %d", access_unit.dorder, stream_length/8 );
-				avg_frames[access_unit.type-1]+=access_unit.length;
-
-				/* Do we have a sequence split in the video stream? */
-				if( !bs.eos() && 
-					bs.GetBits( 32) ==SEQUENCE_HEADER )
-				{
-					stream_length = bs.bitcount()-32LL;
-					AU_start = stream_length;
-					syncword  = AU_hdr = SEQUENCE_HEADER;
-					AU_pict_data = 0;
-					if( !muxinto.split_at_seq_end )
-						mjpeg_warn("Sequence end marker found in video stream but single-segment splitting specified!" );
-				}
-				else
-				{
-					if( !bs.eos() && muxinto.split_at_seq_end )
-						mjpeg_warn("No seq. header starting new sequence after seq. end!");
-				}
-					
-				num_seq_end++;
-				break;
-			}
-		}
-	}
-	last_buffered_AU = decoding_order;
-	num_pictures = decoding_order;	
-	eoscan = bs.eos() || muxinto.AfterMaxPTS(access_unit.PTS);
-}
-
-void ZAlphaStream::Close()
-{
-    unsigned int comp_bit_rate	;
-    unsigned int peak_bit_rate  ;
-
-    stream_length = (unsigned int)(bs.bitcount() / 8);
-    for (int i=0; i<4; i++)
-	{
-		avg_frames[i] /= num_frames[i] == 0 ? 1 : num_frames[i];
-	}
-
-    comp_bit_rate = (unsigned int)
-		(
-			(((double)stream_length) / ((double)fields_presented)) * 2.0
-			* ((double)frame_rate)  + 25.0
-			) / 50;
-	
-	/* Peak bit rate in 50B/sec units... */
-	peak_bit_rate = ((max_bits_persec / 8) / 50);
-	mjpeg_info ("VIDEO_STATISTICS: %02x", stream_id); 
-    mjpeg_info ("Video Stream length: %11llu bytes",stream_length);
-    mjpeg_info ("Sequence headers: %8u",num_sequence);
-    mjpeg_info ("Sequence ends   : %8u",num_seq_end);
-    mjpeg_info ("No. Pictures    : %8u",num_pictures);
-    mjpeg_info ("No. I Frames    : %8u avg. size%6u bytes",
-			  num_frames[0],avg_frames[0]);
-    mjpeg_info("Average bit-rate : %8u bits/sec",comp_bit_rate*400);
-    mjpeg_info("Peak bit-rate    : %8u  bits/sec",peak_bit_rate*400);
-
-	
-}
-	
-
-
-
-/*************************************************************************
-	OutputSeqHdrInfo
-     Display sequence header parameters
-*************************************************************************/
-
-void ZAlphaStream::OutputSeqhdrInfo ()
-{
-	const char *str;
-	mjpeg_info("Z/Alpha STREAM: %02x", stream_id);
-
-    mjpeg_info ("Frame width     : %u\n",horizontal_size);
-    mjpeg_info ("Frame height    : %u\n",vertical_size);
-
-    mjpeg_info ("Z min    : %f\n", z_min);
-    mjpeg_info ("Z max    : %f\n", z_max);
-
-    mjpeg_info ("Z format 0x%x, depth    : %d", z_format, z_depth);
-    mjpeg_info ("Alpha depth   : %d", alpha_depth);
-
-	if (mpeg_valid_aspect_code(muxinto.mpeg, aspect_ratio))
-		str =  mpeg_aspect_code_definition(muxinto.mpeg,aspect_ratio);
-	else
-		str = "forbidden";
-    mjpeg_info ("Aspect ratio    : %s", str );
-
-    if (picture_rate == 0)
-		mjpeg_info( "Picture rate    : forbidden");
-    else if (mpeg_valid_framerate_code(picture_rate))
-		mjpeg_info( "Picture rate    : %2.3f frames/sec",
-					Y4M_RATIO_DBL(mpeg_framerate(picture_rate)) );
-    else
-		mjpeg_info( "Picture rate    : %x reserved",picture_rate);
-				
-    if (bit_rate == 0x3ffff)
-		{
-			bit_rate = 0;
-			mjpeg_info( "Bit rate        : variable"); 
-		}
-    else if (bit_rate == 0)
-		mjpeg_info( "Bit rate       : forbidden");
-    else
-		mjpeg_info( "Bit rate        : %u bits/sec",
-					bit_rate*400);
-
-
-    mjpeg_info("Vbv buffer size : %u bytes",vbv_buffer_size*2048);
-    mjpeg_info("CSPF            : %u",CSPF);
-}
-
-//
-// Compute DTS of current AU in the Z/alpha sequence being
-// scanned.  
-//
-
-void ZAlphaStream::NextDTSPTS( clockticks &DTS, clockticks &PTS)
-{
-#if 0  // ZAlpha can't currently handle interlaced or 3:2 pulldown
-    if( pict_struct != PIC_FRAME )
-    {
-		DTS = static_cast<clockticks>
-			(fields_presented * (double)(CLOCKS/2) / frame_rate);
-        int dts_fields = temporal_reference*2 + group_start_field+1;
-        if( temporal_reference == prev_temp_ref )
-            dts_fields += 1;
-        PTS =
-            static_cast<clockticks>(dts_fields* (double)(CLOCKS/2) / frame_rate);
-		access_unit.porder = temporal_reference /*+ group_start_pic*/;
-        fields_presented += 1;
-    }	
-    else if( pulldown_32 )
-	{
-		int frames2field;
-		int frames3field;
-		DTS = static_cast<clockticks>
-			(fields_presented * (double)(CLOCKS/2) / frame_rate);
-		if( repeat_first_field )
-		{
-			frames2field = (temporal_reference+1) / 2;
-			frames3field = temporal_reference / 2;
-			fields_presented += 3;
-		}
-		else
-		{
-			frames2field = (temporal_reference) / 2;
-			frames3field = (temporal_reference+1) / 2;
-			fields_presented += 2;
-		}
-		PTS = static_cast<clockticks>
-			((frames2field*2 + frames3field*3 + group_start_field+1) * (double)(CLOCKS/2) / frame_rate);
-		access_unit.porder = temporal_reference + group_start_pic;
-	}
-    else
-#endif
-	{
-		DTS = static_cast<clockticks> 
-			(decoding_order * (double)CLOCKS / frame_rate);
-        PTS=DTS;
-		fields_presented += 2;
-	}
-}
-
-
-
-
-
-/* 
- * Local variables:
- *  c-file-style: "stroustrup"
- *  tab-width: 4
- *  indent-tabs-mode: nil
- * End:
- */
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_out.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_out.cpp	2007-08-02 19:57:16 UTC (rev 3468)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/zalphastrm_out.cpp	2007-08-03 00:04:40 UTC (rev 3469)
@@ -1,343 +0,0 @@
-
-/*
- *  zalphastrm_out.cpp:  Members of input stream classes related to muxing out into
- *               the output stream.
- *
- *  Copyright (C) 2001 Gernot Ziegler <gz at lysator.liu.se>
- *  Copyright (C) 2001 Andrew Stevens <andrew.stevens at philips.com>
- *
- *
- *  This program is free software; you can redistribute it and/or
- *  modify it under the terms of version 2 of the GNU General Public License
- *  as published by the Free Software Foundation.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
- */
-
-
-#include <config.h>
-#include <assert.h>
-#include "fastintfns.h"
-#include "zalphastrm.hpp"
-#include "multiplexor.hpp"
-
-
-ZAlphaStream::ZAlphaStream(IBitStream &ibs, VideoParams *parms, 
-                         Multiplexor &into ) :
-	VideoStream( ibs, parms, into)
-//ZAlphaStream::ZAlphaStream(IBitStream &ibs, OutputStream &into )	:
-//	VideoStream( ibs, into)
-{
-	prev_offset=0;
-    decoding_order=0;
-	fields_presented=0;
-    temporal_reference=0;
-	pulldown_32 = 0;
-    temporal_reference = -1;   // Needed to recognise 2nd field of 1st
-                               // frame in a field pic sequence
-	last_buffered_AU=0;
-	max_bits_persec = 0;
-	AU_hdr = ZA_SEQUENCE_HEADER;  /* GOP or SEQ Header starting AU? */
-	for( int i =0; i<4; ++i )
-		num_frames[i] = avg_frames[i] = 0;
-    FRAME_CHUNK = 6;
-		
-}
-
-bool ZAlphaStream::Probe(IBitStream &bs )
-{
-    return bs.GetBits( 32)  == ZA_SEQUENCE_HEADER;
-}
-
-
-/*********************************
- * Signals if it is permissible/possible to Mux out a sector from the Stream.
- * The universal constraints that muxing should not be complete and that
- * that the reciever buffer should have sufficient it also insists that
- * the muxed data won't hang around in the receiver buffer for more than
- * one second.  This is mainly for the benefit of (S)VCD and DVD applications
- * where long delays mess up random access.
- *******************************/
-
-
-bool ZAlphaStream::MuxPossible( clockticks currentSCR )
-{
-    bool a = ElementaryStream::MuxPossible(currentSCR);
-    bool b = (RequiredDTS() < (currentSCR + max_STD_buffer_delay));
-
-    //mjpeg_info("Z/A max_STD_buffer_delay %d", max_STD_buffer_delay); 
-
-    //mjpeg_info("Z/A Mux Possible %d, %d ", a, b);
-    //mjpeg_info("RequiredDTS %ld",RequiredDTS());
-    //mjpeg_info("currentSCR %ld", currentSCR);
-    //mjpeg_info("max_STD_buffer_delay %ld", max_STD_buffer_delay);
-
-	return (  a && b );
-}
-
-
-
-/******************************************************************
-	Output_Video
-	generates Pack/Sys_Header/Packet information from the
-	video stream and writes out the new sector
-******************************************************************/
-
-void ZAlphaStream::OutputSector ( )
-
-#if 1
-{
-
-	unsigned int max_packet_payload; 	 
-	unsigned int actual_payload;
-	unsigned int old_au_then_new_payload;
-	clockticks  DTS,PTS;
-    int autype;
-
-	max_packet_payload = 0;	/* 0 = Fill sector */
-  	/* 	
- 	   We're now in the last AU of a segment.  So we don't want to go
- 	   beyond it's end when filling sectors. Hence we limit packet
- 	   payload size to (remaining) AU length.  The same applies when
- 	   we wish to ensure sequence headers starting ACCESS-POINT AU's
- 	   in (S)VCD's etc are sector-aligned.  
-
-       N.b.runout_PTS is the PTS of the first I picture following the
-       run-out is recorded.
-	*/
-	int nextAU = NextAUType();
-	if( ( muxinto.running_out && nextAU == IFRAME && NextRequiredPTS() >= muxinto.runout_PTS) 
-        || (muxinto.sector_align_iframeAUs && nextAU == IFRAME  )
-		) 
-	{
-		max_packet_payload = au_unsent;
-	}
-
-	/* Figure out the threshold payload size below which we can fit more
-	   than one AU into a packet N.b. because fitting more than one in
-	   imposses an overhead of additional header fields so there is a
-	   dead spot where we *have* to stuff the packet rather than start
-	   fitting in an extra AU.  Slightly over-conservative in the case
-	   of the last packet...  */
-
-	old_au_then_new_payload = muxinto.PacketPayload( *this,
-													 buffers_in_header, 
-													 true, true);
-
-	/* CASE: Packet starts with new access unit			*/
-	if (new_au_next_sec  )
-	{
-        autype = AUType();
-        //
-        // Some types of output format (e.g. DVD) require special
-        // control sectors before the sector starting a new GOP
-        // N.b. this implies muxinto.sector_align_iframeAUs
-        //
-        if( gop_control_packet && autype == IFRAME )
-        {
-            OutputGOPControlSector();
-        }
-
-        if(  dtspts_for_all_au  && max_packet_payload == 0 )
-            max_packet_payload = au_unsent;
-
-        PTS = RequiredPTS();
-        DTS = RequiredDTS();
-		actual_payload =
-			muxinto.WritePacket ( max_packet_payload,
-								  *this,
-								  NewAUBuffers(autype), 
-                                  PTS, DTS,
-								  NewAUTimestamps(autype) );
-
-	}
-
-	/* CASE: Packet begins with old access unit, no new one	*/
-	/*	     can begin in the very same packet					*/
-
-	else if ( au_unsent >= old_au_then_new_payload ||
-              (max_packet_payload != 0 && au_unsent >= max_packet_payload) )
-	{
-		actual_payload = 
-			muxinto.WritePacket( au_unsent,
-								  *this,
-								  false, 0, 0,
-								  TIMESTAMPBITS_NO );
-	}
-
-	/* CASE: Packet begins with old access unit, a new one	*/
-	/*	     could begin in the very same packet			*/
-	else /* if ( !new_au_next_sec  && 
-			(au_unsent < old_au_then_new_payload)) */
-	{
-		/* Is there a new access unit ? */
-		if( Lookahead() != 0 )
-		{
-            autype = NextAUType();
-			if(  dtspts_for_all_au  && max_packet_payload == 0 )
-				max_packet_payload = au_unsent + Lookahead()->length;
-
-			PTS = NextRequiredPTS();
-			DTS = NextRequiredDTS();
-
-			actual_payload = 
-				muxinto.WritePacket ( max_packet_payload,
-									  *this,
-									  NewAUBuffers(autype), 
-                                      PTS, DTS,
-									  NewAUTimestamps(autype) );
-		} 
-		else
-		{
-			actual_payload = muxinto.WritePacket ( au_unsent,
-										 *this,
-										 false, 0, 0,
-										 TIMESTAMPBITS_NO);
-		}
-
-	}
-	++nsec;
-	buffers_in_header = always_buffers_in_header;
-}
-
-#else
-{
-
-	unsigned int max_packet_payload; 	 
-	unsigned int actual_payload;
-	unsigned int prev_au_tail;
-	VAunit *vau;
-	unsigned int old_au_then_new_payload;
-	clockticks  DTS,PTS;
-    int autype;
-
-	max_packet_payload = 0;	/* 0 = Fill sector */
-  	/* 	
- 	   We're now in the last AU of a segment. 
-		So we don't want to go beyond it's end when filling
-		sectors. Hence we limit packet payload size to (remaining) AU length.
-		The same applies when we wish to ensure sequence headers starting
-		ACCESS-POINT AU's in (S)VCD's etc are sector-aligned.
-	*/
-	int nextAU = NextAUType();
-	if( (muxinto.running_out && nextAU == IFRAME && 
-		 NextRequiredPTS() > muxinto.runout_PTS) ||
-		(muxinto.sector_align_iframeAUs && nextAU == IFRAME )
-		) 
-	{
-		max_packet_payload = au_unsent;
-	}
-
-	/* Figure out the threshold payload size below which we can fit more
-	   than one AU into a packet N.b. because fitting more than one in
-	   imposses an overhead of additional header fields so there is a
-	   dead spot where we *have* to stuff the packet rather than start
-	   fitting in an extra AU.  Slightly over-conservative in the case
-	   of the last packet...  */
-
-	old_au_then_new_payload = muxinto.PacketPayload( *this,
-													 buffers_in_header, 
-													 true, true);
-
-	/* CASE: Packet starts with new access unit			*/
-	if (new_au_next_sec  )
-	{
-        autype = AUType();
-        //
-        // Some types of output format (e.g. DVD) require special
-        // control sectors before the sector starting a new GOP
-        // N.b. this implies muxinto.sector_align_iframeAUs
-        //
-        if( gop_control_packet && autype == IFRAME )
-        {
-            OutputGOPControlSector();
-        }
-
-        if(  dtspts_for_all_au  && max_packet_payload == 0 )
-            max_packet_payload = au_unsent;
-
-        PTS = RequiredPTS();
-        DTS = RequiredDTS();
-		actual_payload =
-			muxinto.WritePacket ( max_packet_payload,
-								  *this,
-								  NewAUBuffers(autype), 
-                                  PTS, DTS,
-								  NewAUTimestamps(autype) );
-
-	}
-
-	/* CASE: Packet begins with old access unit, no new one	*/
-	/*	     can begin in the very same packet					*/
-
-	else if ( au_unsent >= old_au_then_new_payload ||
-              (max_packet_payload != 0 && au_unsent >= max_packet_payload) )
-	{
-		actual_payload = 
-			muxinto.WritePacket( au_unsent,
-								  *this,
-								  false, 0, 0,
-								  TIMESTAMPBITS_NO );
-	}
-
-	/* CASE: Packet begins with old access unit, a new one	*/
-	/*	     could begin in the very same packet			*/
-	else /* if ( !new_au_next_sec  && 
-			(au_unsent < old_au_then_new_payload)) */
-	{
-		/* Is there a new access unit ? */
-		if( Lookahead() != 0 )
-		{
-            autype = NextAUType();
-			if(  dtspts_for_all_au  && max_packet_payload == 0 )
-				max_packet_payload = au_unsent + Lookahead()->length;
-
-			PTS = NextRequiredPTS();
-			DTS = NextRequiredDTS();
-
-			actual_payload = 
-				muxinto.WritePacket ( max_packet_payload,
-									  *this,
-									  NewAUBuffers(autype), 
-                                      PTS, DTS,
-									  NewAUTimestamps(autype) );
-		} 
-		else
-		{
-			actual_payload = muxinto.WritePacket ( 0,
-										 *this,
-										 false, 0, 0,
-										 TIMESTAMPBITS_NO);
-		}
-
-	}
-	++nsec;
-	buffers_in_header = always_buffers_in_header;
-}
-#endif
-
-
-bool ZAlphaStream::RunOutComplete()
-{
- 
-	return (au_unsent == 0);
-// || 
-//			( muxinto.running_out &&
-//			  au->type == IFRAME && RequiredPTS() >= muxinto.runout_PTS));
-}
-
-
-/* 
- * Local variables:
- *  c-file-style: "stroustrup"
- *  tab-width: 4
- *  indent-tabs-mode: nil
- * End:
- */



From mean at mail.berlios.de  Fri Aug  3 17:15:12 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 3 Aug 2007 17:15:12 +0200
Subject: [Avidemux-svn-commit] r3470 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr
Message-ID: <200708031515.l73FFC4E003946@sheep.berlios.de>

Author: mean
Date: 2007-08-03 17:15:08 +0200 (Fri, 03 Aug 2007)
New Revision: 3470

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui
Log:
[QT] Mostly working OCR for QT

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2007-08-03 00:04:40 UTC (rev 3469)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2007-08-03 15:15:08 UTC (rev 3470)
@@ -37,23 +37,61 @@
 #include "ADM_ocr/ADM_ocr.h"
 #include "ADM_ocr/ADM_ocrInternal.h"
 #include "ui_ocr.h"
+#include "../ADM_dialog/DIA_flyDialogQt4.h"
+extern void UI_purge(void);
 
-
-//
-//	Video is in YV12 Colorspace
-//
-//
+//*********************************************
 class Ui_ocrWindow : public QDialog
  {
      Q_OBJECT
  protected :
+	 
  public:
      Ui_ocrWindow(void);
      ~Ui_ocrWindow();
      Ui_DialogOcr ui;
      
-     void  gather(void);
+     uint32_t _w,_h;
+     uint8_t *data;
+     ADM_QCanvas *canvas;
+     admGlyph *_glyph,*_head;
+     char *_decodedString;
+     
+     ADM_QCanvas *smallCanvas;
+     ReplyType _reply;
+     
+     void setGlyph(admGlyph *glyph,admGlyph *head,char *decodedString)
+     {
+    	 		_glyph=glyph;
+    	 		_head=head;
+    	 		_decodedString=decodedString;
+     }
+     void dialogReturn(ReplyType r)
+     {
+    	 _reply=r;
+    	 accept();
+     }
+     
+     void resizeSmall(uint32_t w,uint32_t h,uint8_t *smallData)
+     {
+    	 	smallCanvas->changeSize(w*2,h*2);
+    		smallCanvas->dataBuffer=smallData;
+    		QGraphicsView *graphicsView=ui.smallView;
+    		
+    		graphicsView->resize(w*2, h*2);
+    		smallCanvas->setMinimumSize(w*2,h*2);
+    		smallCanvas->resize(w*2, h*2); 
+     }
+     
  public slots:
+ 		void pushButtonCalibrate(bool i);
+ 		void pushButtonSkipAll(bool i);
+ 		void pushButtonSkip(bool i);
+ 		void pushButtonIgnore(bool i);
+ 		
+ 		void pushButtonOk(bool i);
+ 		void pushButtonClose(bool i);
+
  private slots:
  private:
      
@@ -61,56 +99,299 @@
   Ui_ocrWindow::Ui_ocrWindow(void)
   {
         ui.setupUi(this);
-      
+        ui.textEdit->setReadOnly(TRUE);
+        data=NULL;
+        _w=_h=100;
+        canvas=new ADM_QCanvas(ui.bigView,_w,_h);
+        smallCanvas= new ADM_QCanvas(ui.smallView,_w,_h);
+#define BUTTON(x)   connect(ui.x,SIGNAL(clicked(bool)),this,SLOT(x(bool)))
+        BUTTON(pushButtonCalibrate);
+        BUTTON(pushButtonSkipAll);
+        BUTTON(pushButtonSkip);
+        BUTTON(pushButtonIgnore);
+        BUTTON(pushButtonOk);
+        BUTTON(pushButtonClose);
+        _glyph=_head=NULL;
+        _decodedString=NULL;
+        //ui.lineEdit->setBuddy(ui.pushButtonOk);
         
+
   }
- 
+//***********************************************
+
+void  Ui_ocrWindow::pushButtonSkip(bool i)
+  {
+	  	dialogReturn(ReplySkip);
+  }
+void    Ui_ocrWindow::pushButtonSkipAll(bool i)
+  {
+	  	dialogReturn(ReplySkipAll);
+  }
+void  Ui_ocrWindow::pushButtonIgnore(bool i)
+  {
+	  	ADM_assert(_glyph);
+	  	ADM_assert(_head);
+	  	_glyph->code=NULL;
+	  	insertInGlyphTree(_head,_glyph);
+	  	dialogReturn(ReplyOk);
+  }
+void    Ui_ocrWindow::pushButtonClose(bool i)
+  {
+	  	dialogReturn(ReplyClose);
+  }
+void    Ui_ocrWindow::pushButtonCalibrate(bool i)
+  {
+	  	dialogReturn(ReplyCalibrate);
+  }
+void    Ui_ocrWindow::pushButtonOk(bool i)
+  {
+		// Retrieve content typed
+	 		char *data=(ui.lineEdit->text()).toAscii().data(); // Memleak ??
+	 		if(data&& strlen(data))
+	                     {
+	                         _glyph->code=ADM_strdup(data);
+	                         insertInGlyphTree(_head,_glyph);
+	                         strcat(_decodedString,_glyph->code);
+	                     }
+	  	dialogReturn(ReplyOk);
+  }
+//***********************************************
 Ui_ocrWindow::~Ui_ocrWindow()
 {
+	delete canvas;
+	canvas=NULL;
+	
+	delete smallCanvas;
+	smallCanvas=NULL;
+	
+	if(data) delete [] data;
+	data=NULL;	   
 }
 
+Ui_ocrWindow *gDialog=NULL;
+/**
+ * 	\fn ADM_ocrUpdateNbLines
+ *  \brief Update the number of lines ocr'ed
+ */
 uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total)
 {
 	return 1;
 }
+/**
+ * 	\fn ADM_ocrUpdateNbGlyphs
+ *  \brief Update the number of glyphs learnt (not used ATM)
+ */
+
 uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs)
 {
 	return 1;
 }
+/**
+ * 	\fn ADM_ocrUpdateTextAndTime
+ *  \brief Update the currently ocr'ed text from the current image
+ */
+
 uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode)
 {
+	Ui_ocrWindow *dialog=( Ui_ocrWindow *)ui;
+	 ADM_assert(dialog==gDialog);
+	 if(timeCode)
+	 {
+		 QLabel *labelTimecode=dialog->ui.labelTimecode;
+		 labelTimecode->setText(timeCode);
+	 }
+	 if(decodedString)
+	 {
+		 QTextEdit *textedit=dialog->ui.textEdit;
+		 textedit->clear();
+		 textedit->textCursor().insertText(decodedString);
+	 }
+	 UI_purge();
 	return 1;
 }
+
+static void convertBWtoRGB32(uint32_t w,uint32_t h,uint8_t *in,uint8_t *out)
+{
+	for(int y=0;y<h;y++)
+		for(int x=0;x<w;x++)
+		{
+			uint8_t a=*in++;
+			*(out+0)=a;
+			*(out+1)=a;
+			*(out+2)=a;
+			*(out+3)=255; // alpha
+			out+=4;
+		}
+}
+static void convertBWtoRGB32Zoom(uint32_t w,uint32_t h,uint32_t strideW,uint32_t strideH,uint8_t *in,uint8_t *out)
+{
+	ADM_assert(strideW>=w);
+	memset(out,0,strideW*strideH*4*4);
+	for(int y=0;y<h;y++)
+	{
+		for(int x=0;x<w;x++)
+		{
+			uint8_t a=*in++;
+			*(out+0)=a;
+			*(out+1)=a;
+			*(out+2)=a;
+			*(out+3)=255; // alpha
+			*(out+4)=a;
+			*(out+5)=a;
+			*(out+6)=a;
+			*(out+7)=255; // alpha
+			out+=8;
+		}
+		out+=(strideW-w)*8;
+		memcpy(out,out-8*strideW,8*w);
+		out+=8*strideW;
+			
+	}
+}
+/**
+ * 	\fn ADM_ocrDrawFull
+ *  \brief Redraw the full image
+ *  @param data : uin8_t image to redraw (1 byte per pixel)
+ */
+
 uint8_t ADM_ocrDrawFull(void *d,uint8_t *data)
 {
+	Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
+	ADM_assert(dialog==gDialog);
+	uint8_t *out=dialog->data;
+	uint8_t *in=data;
+	uint32_t w=dialog->_w,h=dialog->_h;
+	
+	convertBWtoRGB32(w,h,in,out);
+	
+	// Paint!
+	
+	dialog->canvas->dataBuffer=dialog->data;
+	
+	
+	QGraphicsView *graphicsView=dialog->ui.bigView;
+	
+	graphicsView->resize(w, h);
+	dialog->canvas->setMinimumSize(w,h);
+	dialog->canvas->resize(w, h);
+	
+	
+	
+	dialog->canvas->repaint();
 	return 1;	
 }
-uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h)
+/**
+ * 	\fn ADM_ocrSetRedrawSize
+ *  \brief Set the new image dimensions. Redraw is disabled until ocrDrawFull is called with new datas
+ *  @param w New image width
+ *  @param h New image height
+ */
+
+uint8_t ADM_ocrSetRedrawSize(void *d,uint32_t w,uint32_t h)
 {
+	Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
+	ADM_assert(dialog==gDialog);
+	dialog->_w=w;
+	dialog->_h=h;
+	
+	dialog->canvas->changeSize(w,h);
+	
+	if(dialog->data) delete [] dialog->data;
+	dialog->data=NULL;
+	dialog->data=new uint8_t[w*h*4];
+	
+
 	return 1;
 }
+/**
+ * 	\fn ADM_ocrUiEnd
+ *  \brief Destroy the UI for OCR
+ */
 
 
 uint8_t ADM_ocrUiEnd(void *d)
 {
 	   Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
-	   ADM_assert(dialog);
+	   ADM_assert(dialog==gDialog);
+		
+		
+	   gDialog=NULL;
 	   delete dialog;
 	   return 1;	
 }
+/**
+ * 	\fn ADM_ocrUiSetup
+ *  \brief Create OCR UI
+ */
+
 void 	*ADM_ocrUiSetup(void)
 {
 	
 	   Ui_ocrWindow *dialog=new Ui_ocrWindow;
+	   dialog->setModal(TRUE);
+	   dialog->show();
+	   gDialog=dialog;
 	   return dialog;
 }
+/**
+ * 	\fn glyphToText
+ *  \brief OCR one gluph
+ *  @param glyph : Glyph to OCR
+ *  @param head  : Pointer to the head of known glyph
+ *  @param decodedString : String containing the current ocred text so far
+ *  FIXME : Add ui as parameter!!
+ */
+#define MAX_W 32
+#define MAX_H 32
 
 ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString)
 {
-	return ReplyOk;
+	// First draw small glyph
+	uint32_t w,h,clipW,clipH;
+	w=glyph->width;
+	h=glyph->height;
+	
+	// Known glyph ?
+	  if(glyph->width<2 && glyph->height<2)
+	  {
+	         // ????delete glyph;
+	         return ReplyOk;
+	   }
+	  admGlyph *cand=NULL;
+	  cand=searchGlyph(head,glyph);
+	  if(cand) // New glyph?
+	  {
+		   if(cand->code)
+			   		strcat(decodedString,cand->code);
+		   	delete glyph;
+		   	return ReplyOk;
+	  }
+	  // Yes, it is a new one
+	//
+#ifndef MAX
+        #define MAX(a,b) a>b?a:b
+#endif
+	 clipW=MAX(MAX_W,w);
+	 clipH=MAX(MAX_H,h);
+	// Set datas too
+	uint8_t smallData[clipW*clipH*4*4];
+	// upscale & convert to RGB32 for display
+	convertBWtoRGB32Zoom(w,h,clipW,clipH,glyph->data,smallData);
+	//
+	gDialog->resizeSmall(clipW,clipH,smallData);
+	//
+	gDialog->setGlyph(glyph,head,decodedString);
+	//
+	gDialog->ui.lineEdit->clear();
+	gDialog->ui.lineEdit->setFocus(Qt::OtherFocusReason);
+	ADM_ocrUpdateTextAndTime(gDialog,decodedString,NULL); // put ocred text so far
+	//
+    gDialog->exec();
+    
+    gDialog->smallCanvas->dataBuffer=NULL;
+    // ???delete glyph;
+	return gDialog->_reply;
 }
 
 //____________________________________
 // EOF
-
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui	2007-08-03 00:04:40 UTC (rev 3469)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui	2007-08-03 15:15:08 UTC (rev 3470)
@@ -12,164 +12,137 @@
   <property name="windowTitle" >
    <string>Dialog</string>
   </property>
-  <widget class="QLabel" name="label" >
-   <property name="geometry" >
-    <rect>
-     <x>40</x>
-     <y>20</y>
-     <width>58</width>
-     <height>17</height>
-    </rect>
+  <layout class="QGridLayout" >
+   <property name="margin" >
+    <number>9</number>
    </property>
-   <property name="text" >
-    <string>Nb Lines :</string>
+   <property name="spacing" >
+    <number>6</number>
    </property>
-  </widget>
-  <widget class="QLabel" name="labelNbLines" >
-   <property name="geometry" >
-    <rect>
-     <x>110</x>
-     <y>20</y>
-     <width>58</width>
-     <height>17</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>0/0</string>
-   </property>
-  </widget>
-  <widget class="QLabel" name="label_2" >
-   <property name="geometry" >
-    <rect>
-     <x>40</x>
-     <y>40</y>
-     <width>58</width>
-     <height>17</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>Timecode:</string>
-   </property>
-  </widget>
-  <widget class="QLabel" name="labelTimecode" >
-   <property name="geometry" >
-    <rect>
-     <x>110</x>
-     <y>40</y>
-     <width>58</width>
-     <height>17</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>00:00:00/000</string>
-   </property>
-  </widget>
-  <widget class="QGraphicsView" name="smallView" >
-   <property name="geometry" >
-    <rect>
-     <x>30</x>
-     <y>130</y>
-     <width>104</width>
-     <height>94</height>
-    </rect>
-   </property>
-  </widget>
-  <widget class="QGraphicsView" name="bigView" >
-   <property name="geometry" >
-    <rect>
-     <x>30</x>
-     <y>220</y>
-     <width>361</width>
-     <height>201</height>
-    </rect>
-   </property>
-  </widget>
-  <widget class="QPushButton" name="pushButtonClose" >
-   <property name="geometry" >
-    <rect>
-     <x>440</x>
-     <y>440</y>
-     <width>83</width>
-     <height>27</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>Close</string>
-   </property>
-  </widget>
-  <widget class="QPushButton" name="pushButton" >
-   <property name="geometry" >
-    <rect>
-     <x>30</x>
-     <y>70</y>
-     <width>83</width>
-     <height>27</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>PushButton</string>
-   </property>
-  </widget>
-  <widget class="QPushButton" name="pushButton_2" >
-   <property name="geometry" >
-    <rect>
-     <x>120</x>
-     <y>70</y>
-     <width>83</width>
-     <height>27</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>PushButton</string>
-   </property>
-  </widget>
-  <widget class="QPushButton" name="pushButton_3" >
-   <property name="geometry" >
-    <rect>
-     <x>210</x>
-     <y>70</y>
-     <width>83</width>
-     <height>27</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>PushButton</string>
-   </property>
-  </widget>
-  <widget class="QPushButton" name="pushButton_4" >
-   <property name="geometry" >
-    <rect>
-     <x>300</x>
-     <y>70</y>
-     <width>83</width>
-     <height>27</height>
-    </rect>
-   </property>
-   <property name="text" >
-    <string>PushButton</string>
-   </property>
-  </widget>
-  <widget class="QLineEdit" name="lineEdit" >
-   <property name="geometry" >
-    <rect>
-     <x>30</x>
-     <y>100</y>
-     <width>113</width>
-     <height>25</height>
-    </rect>
-   </property>
-  </widget>
-  <widget class="QTextEdit" name="textEdit" >
-   <property name="geometry" >
-    <rect>
-     <x>160</x>
-     <y>110</y>
-     <width>104</width>
-     <height>94</height>
-    </rect>
-   </property>
-  </widget>
+   <item row="2" column="0" colspan="5" >
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QPushButton" name="pushButtonCalibrate" >
+       <property name="text" >
+        <string>Calibrate</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="pushButtonSkipAll" >
+       <property name="text" >
+        <string>Skip All</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="pushButtonSkip" >
+       <property name="text" >
+        <string>Skip Glyph</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QPushButton" name="pushButtonIgnore" >
+       <property name="text" >
+        <string>Ignore</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QPushButton" name="pushButtonOk" >
+       <property name="text" >
+        <string>Ok</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+   <item rowspan="2" row="3" column="3" colspan="2" >
+    <widget class="QTextEdit" name="textEdit" />
+   </item>
+   <item row="6" column="0" colspan="5" >
+    <widget class="QGraphicsView" name="bigView" />
+   </item>
+   <item row="3" column="0" colspan="3" >
+    <widget class="QLineEdit" name="lineEdit" />
+   </item>
+   <item row="7" column="4" >
+    <widget class="QPushButton" name="pushButtonClose" >
+     <property name="text" >
+      <string>Close</string>
+     </property>
+    </widget>
+   </item>
+   <item rowspan="2" row="4" column="0" colspan="2" >
+    <widget class="QGraphicsView" name="smallView" />
+   </item>
+   <item row="1" column="1" colspan="3" >
+    <widget class="QLabel" name="labelTimecode" >
+     <property name="text" >
+      <string>00:00:00/000</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0" >
+    <widget class="QLabel" name="label_2" >
+     <property name="text" >
+      <string>Timecode:</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="1" colspan="3" >
+    <widget class="QLabel" name="labelNbLines" >
+     <property name="text" >
+      <string>0/0</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="0" >
+    <widget class="QLabel" name="label" >
+     <property name="text" >
+      <string>Nb Lines :</string>
+     </property>
+    </widget>
+   </item>
+  </layout>
  </widget>
  <resources/>
- <connections/>
+ <connections>
+  <connection>
+   <sender>lineEdit</sender>
+   <signal>returnPressed()</signal>
+   <receiver>pushButtonOk</receiver>
+   <slot>click()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>61</x>
+     <y>115</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>420</x>
+     <y>88</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
 </ui>



From mean at mail.berlios.de  Fri Aug  3 17:39:03 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 3 Aug 2007 17:39:03 +0200
Subject: [Avidemux-svn-commit] r3471 - in
	branches/avidemux_2.4_branch/avidemux: ADM_ocr
	ADM_userInterfaces/ADM_GTK/ADM_ocr
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708031539.l73Fd39M005158@sheep.berlios.de>

Author: mean
Date: 2007-08-03 17:39:02 +0200 (Fri, 03 Aug 2007)
New Revision: 3471

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocrEngine.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_flyDialogQt4.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
Log:
[GUI] Update QT4 user interface + OCR sync

Modified: branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocrEngine.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocrEngine.cpp	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocrEngine.cpp	2007-08-03 15:39:02 UTC (rev 3471)
@@ -35,7 +35,7 @@
 uint8_t ADM_ocrDrawFull(void *d,uint8_t *data);
 uint8_t ADM_ocrUiEnd(void *d);
 void 	*ADM_ocrUiSetup(void);
-uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h);
+uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h);
 
 extern void UI_purge(void);
 /* +++++++++++++++++++++++++++++++++++++++++++++++++++++++
@@ -142,7 +142,7 @@
            w=bitmap->_width;
            h=last-first+1;
            
-           ADM_ocrSetRedrawSize(w,h);
+           ADM_ocrSetRedrawSize(ui,w,h);
            //**
            
            // Build

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp	2007-08-03 15:39:02 UTC (rev 3471)
@@ -201,7 +201,7 @@
 static int redraw_x=0,redraw_y=0;
 static uint8_t *drawing=NULL;
 static uint8_t *sdata=NULL;
-uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h)
+uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h)
 {
 		redraw_x=w;
 		redraw_y=h;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-03 15:39:02 UTC (rev 3471)
@@ -194,7 +194,7 @@
 	return 0;
 }
 ;
-uint8_t ADM_ocrSetRedrawSize(uint32_t w,uint32_t h)
+uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h)
 {
 	return 0;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_flyDialogQt4.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_flyDialogQt4.h	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_flyDialogQt4.h	2007-08-03 15:39:02 UTC (rev 3471)
@@ -15,6 +15,7 @@
         ADM_QCanvas(QWidget *z,uint32_t w,uint32_t h)  ;
         ~ADM_QCanvas() ;
         void paintEvent(QPaintEvent *ev);
+        void changeSize(uint32_t w,uint32_t h);
 };
 #endif
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp	2007-08-03 15:39:02 UTC (rev 3471)
@@ -39,10 +39,17 @@
         ADM_QCanvas(QWidget *z,uint32_t w,uint32_t h)  ;
         ~ADM_QCanvas() ;
         void paintEvent(QPaintEvent *ev);
+        void changeSize(uint32_t w,uint32_t h);
 };
 
+void ADM_QCanvas::changeSize(uint32_t w,uint32_t h)
+{
+	_w=w;
+	_h=h;
+	dataBuffer=NULL;
+    resize(w,h);
+}
 
-
 ADM_QCanvas::ADM_QCanvas(QWidget *z,uint32_t w,uint32_t h) : QWidget(z) 
 {
         _w=w;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-03 15:39:02 UTC (rev 3471)
@@ -838,10 +838,58 @@
      <height>29</height>
     </rect>
    </property>
+   <widget class="QMenu" name="menuHelp" >
+    <property name="title" >
+     <string>Help</string>
+    </property>
+    <addaction name="actionShow_built_in_support" />
+    <addaction name="actionAbout_avidemux" />
+   </widget>
+   <widget class="QMenu" name="menuFile" >
+    <property name="title" >
+     <string>File</string>
+    </property>
+    <widget class="QMenu" name="menuSave" >
+     <property name="title" >
+      <string>Save</string>
+     </property>
+     <addaction name="actionSave_video" />
+     <addaction name="actionSave_BMP" />
+     <addaction name="actionSave_jpeg" />
+    </widget>
+    <widget class="QMenu" name="menuRecent_Files" >
+     <property name="title" >
+      <string>Recent Files</string>
+     </property>
+     <addaction name="actionRecent0" />
+     <addaction name="actionRecent1" />
+     <addaction name="actionRecent2" />
+     <addaction name="actionRecent3" />
+    </widget>
+    <addaction name="actionOpen" />
+    <addaction name="menuRecent_Files" />
+    <addaction name="actionAppend" />
+    <addaction name="menuSave" />
+    <addaction name="separator" />
+    <addaction name="actionProperties" />
+    <addaction name="separator" />
+    <addaction name="actionLoad_run_project" />
+    <addaction name="actionSave_project" />
+    <addaction name="actionSave_project_as" />
+    <addaction name="separator" />
+    <addaction name="actionConnect_to_AvsProxy" />
+    <addaction name="separator" />
+    <addaction name="actionAdd_to_joblist" />
+    <addaction name="actionShow_Joblist" />
+    <addaction name="actionQuit" />
+    <addaction name="separator" />
+   </widget>
    <widget class="QMenu" name="menuEdit" >
     <property name="title" >
      <string>Edit</string>
     </property>
+    <addaction name="actionReset_Edits" />
+    <addaction name="separator" />
     <addaction name="actionCut" />
     <addaction name="actionCopy" />
     <addaction name="actionPaste" />
@@ -852,35 +900,35 @@
     <addaction name="separator" />
     <addaction name="actionPreferences" />
    </widget>
-   <widget class="QMenu" name="menuView" >
+   <widget class="QMenu" name="menuVideo" >
     <property name="title" >
-     <string>View</string>
+     <string>Video</string>
     </property>
-    <addaction name="actionMain_toolbar" />
-    <addaction name="actionA_V_toolbar" />
-    <addaction name="actionZoom_1_4" />
-    <addaction name="actionZoom_1_2" />
-    <addaction name="actionZoom_1_1" />
-    <addaction name="actionZoom_2_1" />
-    <addaction name="actionZoom_4_1" />
+    <addaction name="actionDecoder_options" />
+    <addaction name="actionPostprocessing" />
+    <addaction name="separator" />
+    <addaction name="actionFilters" />
+    <addaction name="actionFrame_rate" />
    </widget>
-   <widget class="QMenu" name="menuTools" >
+   <widget class="QMenu" name="menuAudio" >
     <property name="title" >
-     <string>Tools</string>
+     <string>Audio</string>
     </property>
-    <addaction name="actionCalculator" />
-    <addaction name="separator" />
-    <addaction name="actionRebuild_I_B_Frames" />
-    <addaction name="actionBitrate_histogram" />
-    <addaction name="actionScan_for_black_frames" />
-    <addaction name="separator" />
-    <addaction name="actionVob_to_vobsub" />
-    <addaction name="actionOCR" />
+    <addaction name="actionMain_Track" />
+    <addaction name="actionSecondary_Track" />
+    <addaction name="actionBuild_VBR_time_map" />
+    <addaction name="actionSave_2" />
+    <addaction name="actionFilters_2" />
    </widget>
-   <widget class="QMenu" name="menuCustom" >
+   <widget class="QMenu" name="menuAuto" >
     <property name="title" >
-     <string>Custom</string>
+     <string>Auto</string>
     </property>
+    <addaction name="actionVCD" />
+    <addaction name="actionSVCD" />
+    <addaction name="actionDVD" />
+    <addaction name="actionPSP" />
+    <addaction name="actionPSP_H264" />
    </widget>
    <widget class="QMenu" name="menuGo" >
     <property name="title" >
@@ -900,80 +948,34 @@
     <addaction name="actionJump_to_Frame" />
     <addaction name="actionJump_to_Time" />
    </widget>
-   <widget class="QMenu" name="menuHelp" >
+   <widget class="QMenu" name="menuCustom" >
     <property name="title" >
-     <string>Help</string>
+     <string>Custom</string>
     </property>
-    <addaction name="actionShow_built_in_support" />
-    <addaction name="actionAbout_avidemux" />
    </widget>
-   <widget class="QMenu" name="menuAuto" >
+   <widget class="QMenu" name="menuTools" >
     <property name="title" >
-     <string>Auto</string>
+     <string>Tools</string>
     </property>
-    <addaction name="actionVCD" />
-    <addaction name="actionSVCD" />
-    <addaction name="actionDVD" />
-    <addaction name="actionPSP" />
-    <addaction name="actionPSP_H264" />
-   </widget>
-   <widget class="QMenu" name="menuAudio" >
-    <property name="title" >
-     <string>Audio</string>
-    </property>
-    <addaction name="actionMain_Track" />
-    <addaction name="actionSecondary_Track" />
-    <addaction name="actionBuild_VBR_time_map" />
-    <addaction name="actionSave_2" />
-    <addaction name="actionFilters_2" />
-   </widget>
-   <widget class="QMenu" name="menuVideo" >
-    <property name="title" >
-     <string>Video</string>
-    </property>
-    <addaction name="actionDecoder_options" />
-    <addaction name="actionPostprocessing" />
+    <addaction name="actionCalculator" />
     <addaction name="separator" />
+    <addaction name="actionRebuild_I_B_Frames" />
+    <addaction name="actionBitrate_histogram" />
+    <addaction name="actionScan_for_black_frames" />
     <addaction name="separator" />
-    <addaction name="actionFilters" />
-    <addaction name="actionFrame_rate" />
+    <addaction name="actionVob_to_vobsub" />
+    <addaction name="actionOCR" />
+    <addaction name="actionOCR_DVB_T_TS_files" />
+    <addaction name="actionGlyphs_Edit" />
    </widget>
-   <widget class="QMenu" name="menuFile" >
+   <widget class="QMenu" name="menuView" >
     <property name="title" >
-     <string>File</string>
+     <string>View</string>
     </property>
-    <widget class="QMenu" name="menuSave" >
-     <property name="title" >
-      <string>Save</string>
-     </property>
-     <addaction name="actionSave_video" />
-     <addaction name="actionSave_BMP" />
-     <addaction name="actionSave_jpeg" />
-    </widget>
-    <widget class="QMenu" name="menuRecent_Files" >
-     <property name="title" >
-      <string>Recent Files</string>
-     </property>
-     <addaction name="actionRecent0" />
-     <addaction name="actionRecent1" />
-     <addaction name="actionRecent2" />
-     <addaction name="actionRecent3" />
-    </widget>
-    <addaction name="actionOpen" />
-    <addaction name="menuRecent_Files" />
-    <addaction name="actionAppend" />
-    <addaction name="menuSave" />
-    <addaction name="separator" />
-    <addaction name="actionProperties" />
-    <addaction name="separator" />
-    <addaction name="actionLoad_run_project" />
-    <addaction name="actionSave_project" />
-    <addaction name="actionSave_project_as" />
-    <addaction name="separator" />
-    <addaction name="actionAdd_to_joblist" />
-    <addaction name="actionShow_Joblist" />
-    <addaction name="separator" />
-    <addaction name="actionQuit" />
+    <addaction name="actionZoom_1_4" />
+    <addaction name="actionZoom_1_2" />
+    <addaction name="actionZoom_1_1" />
+    <addaction name="actionZoom_2_1" />
    </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
@@ -1250,7 +1252,7 @@
   </action>
   <action name="actionOCR" >
    <property name="text" >
-    <string>OCR</string>
+    <string>OCR (Vobsub Files)</string>
    </property>
   </action>
   <action name="actionPlay_Stop" >
@@ -1424,6 +1426,31 @@
     <string>Show Joblist</string>
    </property>
   </action>
+  <action name="actionConnect_to_AvsProxy" >
+   <property name="text" >
+    <string>Connect to AvsProxy</string>
+   </property>
+  </action>
+  <action name="actionReset_Edits" >
+   <property name="text" >
+    <string>Reset Edits</string>
+   </property>
+  </action>
+  <action name="actionSave" >
+   <property name="text" >
+    <string>Save</string>
+   </property>
+  </action>
+  <action name="actionOCR_DVB_T_TS_files" >
+   <property name="text" >
+    <string>OCR (DVB-T TS files)</string>
+   </property>
+  </action>
+  <action name="actionGlyphs_Edit" >
+   <property name="text" >
+    <string>Glyphs Edit</string>
+   </property>
+  </action>
  </widget>
  <customwidgets>
   <customwidget>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-03 15:15:08 UTC (rev 3470)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-03 15:39:02 UTC (rev 3471)
@@ -16,13 +16,14 @@
 PROCESS(actionLoad_run_project,ACT_RunScript) \
 PROCESS(actionSave_project,ACT_DUMMY) \
 PROCESS(actionSave_project_as,ACT_SaveWork) \
-PROCESS(actionMain_toolbar,ACT_SaveCurrentWork) \
-PROCESS(actionA_V_toolbar,ACT_DUMMY) \
+PROCESS(actionConnect_to_AvsProxy,ACT_AVS_PROXY) \
+PROCESS(actionReset_Edits,ACT_ResetSegments) \	
+PROCESS(actionOCR_DVB_T_TS_files,ACT_DVB_Ocr) \
+PROCESS(actionGlyphs_Edit,ACT_GLYPHEDIT) \
 PROCESS(actionZoom_1_4,ACT_ZOOM_1_4) \
 PROCESS(actionZoom_1_2,ACT_ZOOM_1_2) \
 PROCESS(actionZoom_1_1,ACT_ZOOM_1_1) \
 PROCESS(actionZoom_2_1,ACT_ZOOM_2_1) \
-PROCESS(actionZoom_4_1,ACT_ZOOM_4_1) \
 PROCESS(actionDecoder_options,ACT_DecoderOption) \
 PROCESS(actionPostprocessing,ACT_SetPostProcessing) \
 PROCESS(actionPreview,ACT_PreviewToggle) \
@@ -70,8 +71,13 @@
 PROCESS(actionAdd_to_joblist,ACT_ADD_JOB) \
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  
 
+#if 0
+// PROCESS(actionZoom_4_1,ACT_ZOOM_4_1) \
+PROCESS(actionMain_toolbar,ACT_SaveCurrentWork) \
+PROCESS(actionA_V_toolbar,ACT_DUMMY) \
 
 
+#endif
 #define LIST_OF_BUTTONS     \
 PROCESS(pushButtonVideoConf ,ACT_VideoCodec)  \
 PROCESS(pushButtonVideoFilter , ACT_VideoParameter  ) \



From gruntster at mail.berlios.de  Fri Aug  3 18:09:29 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 3 Aug 2007 18:09:29 +0200
Subject: [Avidemux-svn-commit] r3472 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex
Message-ID: <200708031609.l73G9TxF007266@sheep.berlios.de>

Author: gruntster
Date: 2007-08-03 18:09:22 +0200 (Fri, 03 Aug 2007)
New Revision: 3472

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/Makefile.am
Log:
[mplex] update automake

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/Makefile.am	2007-08-03 15:39:02 UTC (rev 3471)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/Makefile.am	2007-08-03 16:09:22 UTC (rev 3472)
@@ -4,25 +4,11 @@
 ## INCLUDES were found outside kdevelop specific part
 
 libADM_mplex_a_METASOURCES = AUTO
-#INCLUDES = $(all_includes) 
+libADM_mplex_a_SOURCES = ac3strm_in.cpp ADM_mplexout.cpp audiostrm_out.cpp dtsstrm_in.cpp lpcmstrm_in.cpp multiplexor.cpp stream_params.cpp \
+videostrm_in.cpp ADM_mplexin.cpp ADM_mthread.cpp bits.cpp inputstrm.cpp padstrm.cpp systems.cpp videostrm_out.cpp ADM_mplexmuxer.cpp \
+ADM_transfert.cpp interact.cpp mpastrm_in.cpp stillsstream.cpp mpegconsts.c mjpeg_logging.c decodebufmodel.cpp yuv4mpeg.c cpu_accel.c
 
-libADM_mplex_a_SOURCES = ac3strm_in.cpp audiostrm.hpp audiostrm_out.cpp \
-	aunit.hpp bits.cpp bits.hpp buffer.cpp buffer.hpp dtsstrm_in.cpp inputstrm.cpp \
-	inputstrm.hpp interact.cpp interact.hpp lpcmstrm_in.cpp mpastrm_in.cpp \
-	mplexconsts.hpp multiplexor.cpp multiplexor.hpp outputstrm.hpp padstrm.cpp padstrm.hpp \
-	stillsstream.cpp stillsstream.hpp stream_params.cpp stream_params.hpp systems.cpp \
-	systems.hpp vector.cpp vector.hpp videostrm.hpp videostrm_in.cpp videostrm_out.cpp \
-	mpegconsts.c ADM_mplexmuxer.cpp ADM_mplexin.cpp ADM_mplexout.cpp ADM_transfert.cpp \
-	ADM_mthread.cpp
 
 ####### kdevelop will overwrite this part!!! (end)############
-INCLUDES= $(all_includes) -I../ADM_libmpeg2enc  -I../../ADM_userInterfaces/
-noinst_HEADERS = ADM_inout.h ADM_transfert.h
-EXTRA_DIST=ADM_inout.h         ADM_transfert.cpp  dtsstrm_in.cpp    multiplexor.cpp  \
-vector.cpp \
-ADM_mplexin.cpp     ADM_transfert.h    inputstrm.cpp     padstrm.cpp        videostrm_in.cpp \
-ADM_mplexmuxer.cpp  ac3strm_in.cpp     interact.cpp      stillsstream.cpp   videostrm_out.cpp \
-ADM_mplexout.cpp    audiostrm_out.cpp  lpcmstrm_in.cpp   streamType.h       zalphastrm_in.cpp \
-ADM_mthread.cpp     bits.cpp           main_example.cpp  stream_params.cpp  zalphastrm_out.cpp \
-ADM_mthread.h       buffer.cpp         mpastrm_in.cpp    systems.cpp
-
+INCLUDES= $(all_includes) -DHAVE_MEMALIGN
+noinst_HEADERS = ADM_inout.h ADM_transfert.h
\ No newline at end of file



From mean at mail.berlios.de  Fri Aug  3 18:48:57 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 3 Aug 2007 18:48:57 +0200
Subject: [Avidemux-svn-commit] r3473 - in
	branches/avidemux_2.4_branch/avidemux: ADM_audiocodec
	ADM_inputs/ADM_mp4 ADM_libraries/ADM_libwrapper
	ADM_outputs/oplug_avi ADM_userInterfaces/ADM_QT4/ADM_gui
	ADM_videoFilter
Message-ID: <200708031648.l73Gmv22004614@sheep.berlios.de>

Author: mean
Date: 2007-08-03 18:48:46 +0200 (Fri, 03 Aug 2007)
New Revision: 3473

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecwma.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp
Log:
[Warnings] Remove some warnings

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecwma.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecwma.cpp	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_codecwma.cpp	2007-08-03 16:48:46 UTC (rev 3473)
@@ -121,7 +121,7 @@
         {
           nbChunk=(_tail-_head)/_blockalign;
           pout=SCRATCH_PAD_SIZE;
-          out=avcodec_decode_audio(_context,(int16_t *)scratchPad,
+          out=avcodec_decode_audio2(_context,(int16_t *)scratchPad,
                                    &pout,_buffer+_head,nbChunk*_blockalign);
                 
           if(out<0)
@@ -218,7 +218,7 @@
         _tail+=nbIn;
         while(_tail-_head>AMR_PACKET)
         {
-          out=avcodec_decode_audio(_context,(int16_t *)scratchPad,
+          out=avcodec_decode_audio2(_context,(int16_t *)scratchPad,
                                    &pout,_buffer+_head,_tail-_head);
                 
                 if(out<0)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.h	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.h	2007-08-03 16:48:46 UTC (rev 3473)
@@ -11,7 +11,8 @@
 #ifndef ADMMP4_TAB_LEAF
 #define MKMP4LEAF(a,b,c) ADM_MP4_##b
 #else
-#define MKMP4LEAF(a,b,c) {a,ADM_MP4_##b,c}
+#undef MKMP4LEAF
+#define MKMP4LEAF(a,b,c) {(uint32_t)a,ADM_MP4_##b,c}
 #endif
 
 /* Container atom */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp	2007-08-03 16:48:46 UTC (rev 3473)
@@ -27,4 +27,5 @@
 { 
 	return amrnb;
 }
-#endif
\ No newline at end of file
+#endif
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2007-08-03 16:48:46 UTC (rev 3473)
@@ -2,6 +2,14 @@
 #define LIBWRAPPER_GLOBAL
 
 #include "config.h"
+//
+#if defined(__DECLARE__)
+#define ZZ_PREFIX
+#define ZZ_POSTFIX =NULL
+#else
+#define ZZ_PREFIX extern
+#define ZZ_POSTFIX 
+#endif //__DECLARE__
 
 // AMRNB
 #ifdef USE_AMR_NB
@@ -10,11 +18,7 @@
 #include "libwrapper_amrnb.h"
 
 #if defined(__cplusplus)
-extern ADM_LibWrapperAmrnb* amrnb
-#if defined(__DECLARE__)
-=NULL
-#endif	// __DECLARE__
-;
+ZZ_PREFIX ADM_LibWrapperAmrnb  *amrnb ZZ_POSTFIX;
 #else
 struct ADM_LibWrapperAmrnb* getAmrnbWrapper(void);
 #endif	// __cplusplus
@@ -24,15 +28,10 @@
 #if defined(USE_LIBDCA) && defined(__cplusplus)
 #include "libwrapper_dca.h"
 
-extern ADM_LibWrapperDca* dca
-#ifdef __DECLARE__
-=NULL
-#endif
-;
-#endif
+ZZ_PREFIX ADM_LibWrapperDca* dca ZZ_POSTFIX;
 
 // funcs
 void initLibWrappers();
 void destroyLibWrappers();
-
-#endif
+#endif // USE LIBDCA
+#endif // LIBWRAPPER

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2007-08-03 16:48:46 UTC (rev 3473)
@@ -556,7 +556,7 @@
 
                         aprintf("Fps1000:%f\n",fps);
                         fps=600*fps; // 10 mn worth;
-                odml_index_size=floor(fps);
+                odml_index_size=(int)floor(fps);
 
 		aprintf("\nnumber of frames per index: %lu\n",odml_index_size);
 		// get number or indexes per stream

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-03 16:48:46 UTC (rev 3473)
@@ -17,7 +17,7 @@
 PROCESS(actionSave_project,ACT_DUMMY) \
 PROCESS(actionSave_project_as,ACT_SaveWork) \
 PROCESS(actionConnect_to_AvsProxy,ACT_AVS_PROXY) \
-PROCESS(actionReset_Edits,ACT_ResetSegments) \	
+PROCESS(actionReset_Edits,ACT_ResetSegments) \
 PROCESS(actionOCR_DVB_T_TS_files,ACT_DVB_Ocr) \
 PROCESS(actionGlyphs_Edit,ACT_GLYPHEDIT) \
 PROCESS(actionZoom_1_4,ACT_ZOOM_1_4) \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp	2007-08-03 16:09:22 UTC (rev 3472)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp	2007-08-03 16:48:46 UTC (rev 3473)
@@ -1024,9 +1024,9 @@
                         {
                                 for (x = 0; x < w; x++)
                                 {
-                                        v1 = (int) dstp[x] - dthresh;
+                                        v1 = (int)(dstp[x] - dthresh);
                                         if (v1 < 0) v1 = 0; 
-                                        v2 = (int) dstp[x] + dthresh;
+                                        v2 = (int) (dstp[x] + dthresh);
                                         if (v2 > 235) v2 = 235; 
                                         if ((v1 > dstpp[x] && v1 > dstpn[x]) || (v2 < dstpp[x] && v2 < dstpn[x]))
                                         {
@@ -1106,9 +1106,9 @@
                                         {
                                                 for (x = 0; x < wover2; x++)
                                                 {
-                                                        v1 = (int) dstp[x] - dthresh;
+                                                        v1 = (int)( dstp[x] - dthresh);
                                                         if (v1 < 0) v1 = 0; 
-                                                        v2 = (int) dstp[x] + dthresh;
+                                                        v2 = (int)( dstp[x] + dthresh);
                                                         if (v2 > 235) v2 = 235; 
                                                         if ((v1 > dstpp[x] && v1 > dstpn[x]) || (v2 < dstpp[x] && v2 < dstpn[x]))
                                                         {
@@ -1145,7 +1145,7 @@
                 {
                         for (x = 0; x < w; x++)
                         {
-                                v1 = (int) dstp[x] - dthresh;
+                                v1 = (int) (dstp[x] - dthresh);
                                 if (v1 < 0) v1 = 0; 
                                 v2 = (int) dstp[x] + dthresh;
                                 if (v2 > 235) v2 = 235; 



From mean at mail.berlios.de  Sat Aug  4 12:50:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 4 Aug 2007 12:50:55 +0200
Subject: [Avidemux-svn-commit] r3474 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex
Message-ID: <200708041050.l74Aot0N015007@sheep.berlios.de>

Author: mean
Date: 2007-08-04 12:50:49 +0200 (Sat, 04 Aug 2007)
New Revision: 3474

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp
Log:
[MPLEX] Put back the guided detection of streams, needed for LPCM and DTS

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_inout.h	2007-08-04 10:50:49 UTC (rev 3474)
@@ -39,7 +39,7 @@
 class IFileBitStream : public IBitStream
 {
 public:
-        IFileBitStream( PacketQueue *inQueue, unsigned int buf_size = BUFFER_SIZE);
+        IFileBitStream( PacketQueue *inQueue, mplexStreamDescriptor *streamDesc,unsigned int buf_size = BUFFER_SIZE);
         ~IFileBitStream();
 
 private:

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-04 10:50:49 UTC (rev 3474)
@@ -162,17 +162,38 @@
 }
 
 extern const char *getStrFromAudioCodec( uint32_t codec);
+static uint8_t wavToStreamType(WAVHeader *hdr,mplexStreamDescriptor *desc)
+{
+    ADM_assert(hdr);
+    desc->frequency=hdr->frequency;
+    desc->channel=hdr->channels;
+    switch(hdr->encoding)
+    {
+        case WAV_LPCM:  desc->kind= LPCM_AUDIO;break;
+        case WAV_AC3:   desc->kind=  AC3_AUDIO;;break;
+        case WAV_MP2: case WAV_MP3:   desc->kind=  MPEG_AUDIO;;break;
+        case WAV_DTS:    desc->kind=  DTS_AUDIO;;break;
+        default: return 0;
+    }
+  return 1;
+}
+
 int slaveThread( WAVHeader *audioheader )
 {
         MultiplexJob job;
+        mplexStreamDescriptor audioDesc;
+        mplexStreamDescriptor videoDesc;
 
         printf("[Muxer Slave Thread] Creating job & muxer\n");
-        
+        wavToStreamType(audioheader,&audioDesc);
+
         printf("output file created\n");
-        audioin=new IFileBitStream(channelaudio);
+        audioin=new IFileBitStream(channelaudio,&audioDesc);
         
         printf("audio done (%s), creating video bitstream\n",getStrFromAudioCodec(audioheader->encoding));
-        videoin=new IFileBitStream(channelvideo);
+        videoDesc.kind=MPEG_VIDEO;
+
+        videoin=new IFileBitStream(channelvideo,&videoDesc);
         
         printf("Both stream ready\n");
          

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp	2007-08-04 10:50:49 UTC (rev 3474)
@@ -58,7 +58,7 @@
 
 }
 
-IFileBitStream::IFileBitStream(PacketQueue *q, unsigned int buf_size) : IBitStream()
+IFileBitStream::IFileBitStream(PacketQueue *q, mplexStreamDescriptor *desc, unsigned int buf_size) : IBitStream(desc) //MEANX
 {
         queue=q;        
         SetBufSize(buf_size);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.hpp	2007-08-04 10:50:49 UTC (rev 3474)
@@ -3,6 +3,9 @@
 
 #include <stdio.h>
 #include <assert.h>
+// MEANX
+#include "streamType.h"
+// /MEANX
 
 typedef uint64_t bitcount_t;
 
@@ -120,10 +123,13 @@
 class IBitStream : public IBitStreamUndo 
 {
 public:
- 	IBitStream() :
+           mplexStreamDescriptor      streamDesc; //MEANX
+
+ 	IBitStream(mplexStreamDescriptor *desc) :
 		IBitStreamUndo(),
 		streamname( "unnamed" )
 		{
+                streamDesc=*desc; // MEANX
 		}
 	virtual ~IBitStream() { Release(); }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.cpp	2007-08-04 10:50:49 UTC (rev 3474)
@@ -114,7 +114,24 @@
 }
 
 
+// MEANX
+static const char *kindToString(StreamKind kind)
+{
+#define KID(x)  x##_AUDIO:return #x;
+    switch(kind)
+    {
+        case KID(MPEG)
+       case  KID(AC3)
+        case KID(LPCM)
+        case KID(DTS)
+        default: 
+            printf("Kind %d\n",kind);
+            assert(0);
+    }
+  return "Oops";
+}
 
+// /MEANS
 void MultiplexJob::SetupInputStreams( std::vector< IBitStream *> &inputs )
 {
     IBitStream *bs;
@@ -127,6 +144,34 @@
         bs = inputs[i];
         // Remember the streams initial state...
         bs->PrepareUndo( undo );
+// MEANX : Use the info we have to be sure of the stream type
+// Else we cannot detect safly LPCM/PCM/DTS
+        switch(bs->streamDesc.kind)
+        {
+            case MPEG_AUDIO:
+            case AC3_AUDIO:
+            case LPCM_AUDIO:
+            case DTS_AUDIO:
+                mjpeg_info ("File %s looks like an %s Audio stream (fq %u, channel %u).\n", bs->StreamName() , kindToString(bs->streamDesc.kind),bs->streamDesc.frequency,bs->streamDesc.channel);
+                bs->UndoChanges( undo );
+                streams.push_back( new JobStream( bs, bs->streamDesc.kind) );
+                ++audio_tracks;
+                if(bs->streamDesc.kind==LPCM_AUDIO) 
+                    lpcm_param.push_back(LpcmParams::Checked(  bs->streamDesc.frequency,                                         
+                                                   bs->streamDesc.channel,16));//++lpcm_tracks;
+                continue;
+            case MPEG_VIDEO:
+                mjpeg_info ("File %s looks like an Video stream.", bs->StreamName() );
+                bs->UndoChanges( undo );
+                streams.push_back( new JobStream( bs,MPEG_VIDEO) );
+                ++video_tracks;
+                continue;
+            default: assert(0);
+            
+        }
+    }
+
+#if 0 //MEANX
         if( LPCMStream::Probe( *bs ) )
         {
             mjpeg_info ("File %s looks like an LPCM Audio stream.",
@@ -199,7 +244,7 @@
         mjpeg_error ("File %s unrecogniseable!", bs->StreamName());
         delete bs;
     }
-    
+#endif // MEANX IF 0 
     if( bad_file )
     {
         mjpeg_error_exit1( "Unrecogniseable file(s)... exiting.");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/interact.hpp	2007-08-04 10:50:49 UTC (rev 3474)
@@ -30,6 +30,9 @@
 #include "stream_params.hpp"
 #include "systems.hpp"
 
+// MEANX
+#include "streamType.h"
+// /MEANX
 class IBitStream;
 
 using std::vector;
@@ -82,7 +85,8 @@
  *
  *
  **********************************************************************/
-
+// MEANX MOVED TO STREAMTYPE.H
+#if 0
 enum StreamKind
   {
     MPEG_AUDIO,
@@ -95,6 +99,8 @@
     Z_ALPHA
 #endif
   };
+#endif
+// MEANX MOVED TO STREAMTYPE.H
 
 class JobStream
 {

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h	2007-08-03 16:48:46 UTC (rev 3473)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/streamType.h	2007-08-04 10:50:49 UTC (rev 3474)
@@ -0,0 +1,22 @@
+#ifndef STREAM_TYPE_H
+#define STREAM_TYPE_H
+enum StreamKind
+  {
+      MPEG_AUDIO=1,
+      AC3_AUDIO,
+      LPCM_AUDIO,
+      DTS_AUDIO,
+      MPEG_VIDEO
+#ifdef ZALPHA
+        ,
+      Z_ALPHA
+#endif
+  };
+
+typedef struct mplexStreamDescriptor
+{
+  int channel;
+  int frequency;
+  StreamKind kind;
+}mplexStreamDescriptor;
+#endif



From mean at mail.berlios.de  Sat Aug  4 17:45:24 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 4 Aug 2007 17:45:24 +0200
Subject: [Avidemux-svn-commit] r3475 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK:
	ADM_gui2 glade
Message-ID: <200708041545.l74FjOeS016907@sheep.berlios.de>

Author: mean
Date: 2007-08-04 17:45:24 +0200 (Sat, 04 Aug 2007)
New Revision: 3475

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
Log:
[GTK] Change shortcut key for zoom

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-08-04 10:50:49 UTC (rev 3474)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-08-04 15:45:24 UTC (rev 3475)
@@ -36,11 +36,11 @@
   GtkWidget *menuitem1;
   GtkWidget *menuitem1_menu;
   GtkWidget *open_video1;
-  GtkWidget *image8373;
+  GtkWidget *image8423;
   GtkWidget *append_video1;
-  GtkWidget *image8374;
+  GtkWidget *image8424;
   GtkWidget *save_stuff;
-  GtkWidget *image8375;
+  GtkWidget *image8425;
   GtkWidget *save_stuff_menu;
   GtkWidget *save_as_avi1;
   GtkWidget *separator1;
@@ -50,41 +50,41 @@
   GtkWidget *close1;
   GtkWidget *separator3;
   GtkWidget *save_project1;
-  GtkWidget *image8376;
+  GtkWidget *image8426;
   GtkWidget *save_project_as1;
-  GtkWidget *image8377;
+  GtkWidget *image8427;
   GtkWidget *run_script1;
-  GtkWidget *image8378;
+  GtkWidget *image8428;
   GtkWidget *add_to_joblist1;
   GtkWidget *joblist1;
   GtkWidget *separator16;
   GtkWidget *connect_to_avsproxy1;
   GtkWidget *separator18;
   GtkWidget *video_informations1;
-  GtkWidget *image8379;
+  GtkWidget *image8429;
   GtkWidget *avi_muxer_options1;
   GtkWidget *separator4;
   GtkWidget *quit1;
-  GtkWidget *image8380;
+  GtkWidget *image8430;
   GtkWidget *menuitem2;
   GtkWidget *menuitem2_menu;
   GtkWidget *reset_edits1;
-  GtkWidget *image8381;
+  GtkWidget *image8431;
   GtkWidget *separator5;
   GtkWidget *cut1;
-  GtkWidget *image8382;
+  GtkWidget *image8432;
   GtkWidget *copy1;
-  GtkWidget *image8383;
+  GtkWidget *image8433;
   GtkWidget *paste1;
-  GtkWidget *image8384;
+  GtkWidget *image8434;
   GtkWidget *delete1;
-  GtkWidget *image8385;
+  GtkWidget *image8435;
   GtkWidget *separator6;
   GtkWidget *set_marker_a1;
   GtkWidget *set_marker_b1;
   GtkWidget *separator7;
   GtkWidget *preferences1;
-  GtkWidget *image8386;
+  GtkWidget *image8436;
   GtkWidget *view1;
   GtkWidget *view1_menu;
   GtkWidget *toolbar1;
@@ -94,7 +94,6 @@
   GtkWidget *zoom_1_2;
   GtkWidget *zoom_1_1;
   GtkWidget *zoom_2_1;
-  GtkWidget *zoom_4_1;
   GtkWidget *video_1;
   GtkWidget *video_1_menu;
   GtkWidget *decoder_options1;
@@ -113,13 +112,13 @@
   GtkWidget *build_vbr_time_map1;
   GtkWidget *separator11;
   GtkWidget *save_audio1;
-  GtkWidget *image8387;
+  GtkWidget *image8437;
   GtkWidget *audio_encoder1;
   GtkWidget *filters2;
   GtkWidget *tools1;
   GtkWidget *tools1_menu;
   GtkWidget *calculator1;
-  GtkWidget *image8388;
+  GtkWidget *image8438;
   GtkWidget *separator12;
   GtkWidget *rebuild_frames;
   GtkWidget *check_frames;
@@ -142,35 +141,35 @@
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
-  GtkWidget *image8389;
+  GtkWidget *image8439;
   GtkWidget *previous_frame1;
-  GtkWidget *image8390;
+  GtkWidget *image8440;
   GtkWidget *next_frame1;
-  GtkWidget *image8391;
+  GtkWidget *image8441;
   GtkWidget *previous_intra_frame1;
-  GtkWidget *image8392;
+  GtkWidget *image8442;
   GtkWidget *next_intra_frame1;
-  GtkWidget *image8393;
+  GtkWidget *image8443;
   GtkWidget *search_previous_black_frame1;
   GtkWidget *search_next_black_frame1;
   GtkWidget *first_frame1;
-  GtkWidget *image8394;
+  GtkWidget *image8444;
   GtkWidget *last_frame1;
-  GtkWidget *image8395;
+  GtkWidget *image8445;
   GtkWidget *separator14;
   GtkWidget *go_to_marker_a1;
   GtkWidget *go_to_marker_b1;
   GtkWidget *separator15;
   GtkWidget *jum_to_frame1;
-  GtkWidget *image8396;
+  GtkWidget *image8446;
   GtkWidget *jump_to_time1;
-  GtkWidget *image8397;
+  GtkWidget *image8447;
   GtkWidget *custom1;
   GtkWidget *help2;
   GtkWidget *help2_menu;
   GtkWidget *show_builtin_support1;
   GtkWidget *about1;
-  GtkWidget *image8398;
+  GtkWidget *image8448;
   GtkWidget *toolbar2;
   GtkIconSize tmp_toolbar_icon_size;
   GtkWidget *menutoolbuttonOpen;
@@ -301,9 +300,9 @@
                               GDK_O, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8373 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8373);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8373);
+  image8423 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8423);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8423);
 
   append_video1 = gtk_image_menu_item_new_with_mnemonic (_("_Append..."));
   gtk_widget_show (append_video1);
@@ -312,17 +311,17 @@
                               GDK_A, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8374 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8374);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8374);
+  image8424 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8424);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8424);
 
   save_stuff = gtk_image_menu_item_new_with_mnemonic (_("_Save"));
   gtk_widget_show (save_stuff);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_stuff);
 
-  image8375 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8375);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8375);
+  image8425 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8425);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8425);
 
   save_stuff_menu = gtk_menu_new ();
   gtk_menu_item_set_submenu (GTK_MENU_ITEM (save_stuff), save_stuff_menu);
@@ -364,25 +363,25 @@
   gtk_widget_show (save_project1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project1);
 
-  image8376 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8376);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8376);
+  image8426 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8426);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8426);
 
   save_project_as1 = gtk_image_menu_item_new_with_mnemonic (_("Save P_roject As..."));
   gtk_widget_show (save_project_as1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project_as1);
 
-  image8377 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8377);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8377);
+  image8427 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8427);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8427);
 
   run_script1 = gtk_image_menu_item_new_with_mnemonic (_("_Load/Run Project..."));
   gtk_widget_show (run_script1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), run_script1);
 
-  image8378 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8378);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8378);
+  image8428 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8428);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8428);
 
   add_to_joblist1 = gtk_menu_item_new_with_mnemonic (_("A_dd to Joblist..."));
   gtk_widget_show (add_to_joblist1);
@@ -416,9 +415,9 @@
                               GDK_Return, (GdkModifierType)( GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8379 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8379);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8379);
+  image8429 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8429);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8429);
 
   avi_muxer_options1 = gtk_menu_item_new_with_mnemonic (_("AVI _Muxer Options"));
   gtk_widget_show (avi_muxer_options1);
@@ -436,9 +435,9 @@
                               GDK_Q, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8380 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8380);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8380);
+  image8430 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8430);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8430);
 
   menuitem2 = gtk_menu_item_new_with_mnemonic (_("_Edit"));
   gtk_widget_show (menuitem2);
@@ -451,9 +450,9 @@
   gtk_widget_show (reset_edits1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), reset_edits1);
 
-  image8381 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8381);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8381);
+  image8431 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8431);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8431);
 
   separator5 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator5);
@@ -467,9 +466,9 @@
                               GDK_X, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8382 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8382);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8382);
+  image8432 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8432);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8432);
 
   copy1 = gtk_image_menu_item_new_with_mnemonic (_("_Copy"));
   gtk_widget_show (copy1);
@@ -478,9 +477,9 @@
                               GDK_C, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8383 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8383);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8383);
+  image8433 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8433);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8433);
 
   paste1 = gtk_image_menu_item_new_with_mnemonic (_("_Paste"));
   gtk_widget_show (paste1);
@@ -489,9 +488,9 @@
                               GDK_V, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8384 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8384);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8384);
+  image8434 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8434);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8434);
 
   delete1 = gtk_image_menu_item_new_with_mnemonic (_("_Delete"));
   gtk_widget_show (delete1);
@@ -500,9 +499,9 @@
                               GDK_Delete, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8385 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8385);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8385);
+  image8435 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8435);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8435);
 
   separator6 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator6);
@@ -532,9 +531,9 @@
   gtk_widget_show (preferences1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), preferences1);
 
-  image8386 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8386);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8386);
+  image8436 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8436);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8436);
 
   view1 = gtk_menu_item_new_with_mnemonic (_("_View"));
   gtk_widget_show (view1);
@@ -576,23 +575,16 @@
   gtk_widget_show (zoom_1_1);
   gtk_container_add (GTK_CONTAINER (view1_menu), zoom_1_1);
   gtk_widget_add_accelerator (zoom_1_1, "activate", accel_group,
-                              GDK_1, (GdkModifierType)( GDK_CONTROL_MASK),
+                              GDK_1, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
   zoom_2_1 = gtk_menu_item_new_with_mnemonic (_("Zoom _2:1"));
   gtk_widget_show (zoom_2_1);
   gtk_container_add (GTK_CONTAINER (view1_menu), zoom_2_1);
   gtk_widget_add_accelerator (zoom_2_1, "activate", accel_group,
-                              GDK_2, (GdkModifierType)( GDK_CONTROL_MASK),
+                              GDK_2, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  zoom_4_1 = gtk_menu_item_new_with_mnemonic (_("Zoom _4:1"));
-  gtk_widget_show (zoom_4_1);
-  gtk_container_add (GTK_CONTAINER (view1_menu), zoom_4_1);
-  gtk_widget_add_accelerator (zoom_4_1, "activate", accel_group,
-                              GDK_4, (GdkModifierType)( GDK_CONTROL_MASK),
-                              GTK_ACCEL_VISIBLE);
-
   video_1 = gtk_menu_item_new_with_mnemonic (_("Vi_deo"));
   gtk_widget_show (video_1);
   gtk_container_add (GTK_CONTAINER (menuBar), video_1);
@@ -688,9 +680,9 @@
                               GDK_S, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8387 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8387);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8387);
+  image8437 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8437);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8437);
 
   audio_encoder1 = gtk_menu_item_new_with_mnemonic (_("_Encoder"));
   gtk_widget_show (audio_encoder1);
@@ -717,9 +709,9 @@
                               GDK_F7, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8388 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
-  gtk_widget_show (image8388);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8388);
+  image8438 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
+  gtk_widget_show (image8438);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8438);
 
   separator12 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator12);
@@ -813,9 +805,9 @@
                               GDK_P, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8389 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8389);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8389);
+  image8439 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8439);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8439);
 
   previous_frame1 = gtk_image_menu_item_new_with_mnemonic (_("P_revious Frame"));
   gtk_widget_show (previous_frame1);
@@ -824,9 +816,9 @@
                               GDK_KP_4, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8390 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8390);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8390);
+  image8440 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8440);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8440);
 
   next_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Next Frame"));
   gtk_widget_show (next_frame1);
@@ -835,9 +827,9 @@
                               GDK_KP_6, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8391 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8391);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8391);
+  image8441 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8441);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8441);
 
   previous_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Pr_evious Intra Frame"));
   gtk_widget_show (previous_intra_frame1);
@@ -846,9 +838,9 @@
                               GDK_KP_2, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8392 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8392);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8392);
+  image8442 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8442);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8442);
 
   next_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Next _Intra Frame"));
   gtk_widget_show (next_intra_frame1);
@@ -857,9 +849,9 @@
                               GDK_KP_8, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8393 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8393);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8393);
+  image8443 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8443);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8443);
 
   search_previous_black_frame1 = gtk_menu_item_new_with_mnemonic (_("Previou_s Black Frame"));
   gtk_widget_show (search_previous_black_frame1);
@@ -876,9 +868,9 @@
                               GDK_Home, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8394 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8394);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8394);
+  image8444 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8444);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8444);
 
   last_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Last Frame"));
   gtk_widget_show (last_frame1);
@@ -887,9 +879,9 @@
                               GDK_End, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8395 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8395);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8395);
+  image8445 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8445);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8445);
 
   separator14 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator14);
@@ -922,9 +914,9 @@
                               GDK_F, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8396 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8396);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8396);
+  image8446 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8446);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8446);
 
   jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_("Go to _Time..."));
   gtk_widget_show (jump_to_time1);
@@ -933,9 +925,9 @@
                               GDK_T, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8397 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8397);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8397);
+  image8447 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8447);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8447);
 
   custom1 = gtk_menu_item_new_with_mnemonic (_("_Custom"));
   gtk_widget_show (custom1);
@@ -956,9 +948,9 @@
   gtk_widget_show (about1);
   gtk_container_add (GTK_CONTAINER (help2_menu), about1);
 
-  image8398 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8398);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8398);
+  image8448 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8448);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8448);
 
   toolbar2 = gtk_toolbar_new ();
   gtk_widget_show (toolbar2);
@@ -1480,11 +1472,11 @@
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1, "menuitem1");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1_menu, "menuitem1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, open_video1, "open_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8373, "image8373");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8423, "image8423");
   GLADE_HOOKUP_OBJECT (mainWindow, append_video1, "append_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8374, "image8374");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8424, "image8424");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff, "save_stuff");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8375, "image8375");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8425, "image8425");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff_menu, "save_stuff_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, save_as_avi1, "save_as_avi1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator1, "separator1");
@@ -1494,41 +1486,41 @@
   GLADE_HOOKUP_OBJECT (mainWindow, close1, "close1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator3, "separator3");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project1, "save_project1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8376, "image8376");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8426, "image8426");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project_as1, "save_project_as1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8377, "image8377");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8427, "image8427");
   GLADE_HOOKUP_OBJECT (mainWindow, run_script1, "run_script1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8378, "image8378");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8428, "image8428");
   GLADE_HOOKUP_OBJECT (mainWindow, add_to_joblist1, "add_to_joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, joblist1, "joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator16, "separator16");
   GLADE_HOOKUP_OBJECT (mainWindow, connect_to_avsproxy1, "connect_to_avsproxy1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator18, "separator18");
   GLADE_HOOKUP_OBJECT (mainWindow, video_informations1, "video_informations1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8379, "image8379");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8429, "image8429");
   GLADE_HOOKUP_OBJECT (mainWindow, avi_muxer_options1, "avi_muxer_options1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator4, "separator4");
   GLADE_HOOKUP_OBJECT (mainWindow, quit1, "quit1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8380, "image8380");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8430, "image8430");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2, "menuitem2");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2_menu, "menuitem2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, reset_edits1, "reset_edits1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8381, "image8381");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8431, "image8431");
   GLADE_HOOKUP_OBJECT (mainWindow, separator5, "separator5");
   GLADE_HOOKUP_OBJECT (mainWindow, cut1, "cut1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8382, "image8382");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8432, "image8432");
   GLADE_HOOKUP_OBJECT (mainWindow, copy1, "copy1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8383, "image8383");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8433, "image8433");
   GLADE_HOOKUP_OBJECT (mainWindow, paste1, "paste1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8384, "image8384");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8434, "image8434");
   GLADE_HOOKUP_OBJECT (mainWindow, delete1, "delete1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8385, "image8385");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8435, "image8435");
   GLADE_HOOKUP_OBJECT (mainWindow, separator6, "separator6");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_a1, "set_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_b1, "set_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator7, "separator7");
   GLADE_HOOKUP_OBJECT (mainWindow, preferences1, "preferences1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8386, "image8386");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8436, "image8436");
   GLADE_HOOKUP_OBJECT (mainWindow, view1, "view1");
   GLADE_HOOKUP_OBJECT (mainWindow, view1_menu, "view1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar1, "toolbar1");
@@ -1538,7 +1530,6 @@
   GLADE_HOOKUP_OBJECT (mainWindow, zoom_1_2, "zoom_1_2");
   GLADE_HOOKUP_OBJECT (mainWindow, zoom_1_1, "zoom_1_1");
   GLADE_HOOKUP_OBJECT (mainWindow, zoom_2_1, "zoom_2_1");
-  GLADE_HOOKUP_OBJECT (mainWindow, zoom_4_1, "zoom_4_1");
   GLADE_HOOKUP_OBJECT (mainWindow, video_1, "video_1");
   GLADE_HOOKUP_OBJECT (mainWindow, video_1_menu, "video_1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, decoder_options1, "decoder_options1");
@@ -1557,13 +1548,13 @@
   GLADE_HOOKUP_OBJECT (mainWindow, build_vbr_time_map1, "build_vbr_time_map1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator11, "separator11");
   GLADE_HOOKUP_OBJECT (mainWindow, save_audio1, "save_audio1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8387, "image8387");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8437, "image8437");
   GLADE_HOOKUP_OBJECT (mainWindow, audio_encoder1, "audio_encoder1");
   GLADE_HOOKUP_OBJECT (mainWindow, filters2, "filters2");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1, "tools1");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1_menu, "tools1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, calculator1, "calculator1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8388, "image8388");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8438, "image8438");
   GLADE_HOOKUP_OBJECT (mainWindow, separator12, "separator12");
   GLADE_HOOKUP_OBJECT (mainWindow, rebuild_frames, "rebuild_frames");
   GLADE_HOOKUP_OBJECT (mainWindow, check_frames, "check_frames");
@@ -1586,35 +1577,35 @@
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8389, "image8389");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8439, "image8439");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_frame1, "previous_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8390, "image8390");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8440, "image8440");
   GLADE_HOOKUP_OBJECT (mainWindow, next_frame1, "next_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8391, "image8391");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8441, "image8441");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_intra_frame1, "previous_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8392, "image8392");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8442, "image8442");
   GLADE_HOOKUP_OBJECT (mainWindow, next_intra_frame1, "next_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8393, "image8393");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8443, "image8443");
   GLADE_HOOKUP_OBJECT (mainWindow, search_previous_black_frame1, "search_previous_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, search_next_black_frame1, "search_next_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, first_frame1, "first_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8394, "image8394");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8444, "image8444");
   GLADE_HOOKUP_OBJECT (mainWindow, last_frame1, "last_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8395, "image8395");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8445, "image8445");
   GLADE_HOOKUP_OBJECT (mainWindow, separator14, "separator14");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_a1, "go_to_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_b1, "go_to_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator15, "separator15");
   GLADE_HOOKUP_OBJECT (mainWindow, jum_to_frame1, "jum_to_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8396, "image8396");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8446, "image8446");
   GLADE_HOOKUP_OBJECT (mainWindow, jump_to_time1, "jump_to_time1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8397, "image8397");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8447, "image8447");
   GLADE_HOOKUP_OBJECT (mainWindow, custom1, "custom1");
   GLADE_HOOKUP_OBJECT (mainWindow, help2, "help2");
   GLADE_HOOKUP_OBJECT (mainWindow, help2_menu, "help2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, show_builtin_support1, "show_builtin_support1");
   GLADE_HOOKUP_OBJECT (mainWindow, about1, "about1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8398, "image8398");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8448, "image8448");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar2, "toolbar2");
   GLADE_HOOKUP_OBJECT (mainWindow, menutoolbuttonOpen, "menutoolbuttonOpen");
   GLADE_HOOKUP_OBJECT (mainWindow, toolitem11, "toolitem11");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2007-08-04 10:50:49 UTC (rev 3474)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2007-08-04 15:45:24 UTC (rev 3475)
@@ -50,7 +50,7 @@
 		      <accelerator key="O" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8246">
+			<widget class="GtkImage" id="image8423">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-open</property>
 			  <property name="icon_size">1</property>
@@ -71,7 +71,7 @@
 		      <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8247">
+			<widget class="GtkImage" id="image8424">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-add</property>
 			  <property name="icon_size">1</property>
@@ -91,7 +91,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8248">
+			<widget class="GtkImage" id="image8425">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save</property>
 			  <property name="icon_size">1</property>
@@ -169,7 +169,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8249">
+			<widget class="GtkImage" id="image8426">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save</property>
 			  <property name="icon_size">1</property>
@@ -189,7 +189,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8250">
+			<widget class="GtkImage" id="image8427">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save-as</property>
 			  <property name="icon_size">1</property>
@@ -209,7 +209,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8251">
+			<widget class="GtkImage" id="image8428">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-execute</property>
 			  <property name="icon_size">1</property>
@@ -267,7 +267,7 @@
 		      <accelerator key="Return" modifiers="GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8252">
+			<widget class="GtkImage" id="image8429">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-properties</property>
 			  <property name="icon_size">1</property>
@@ -302,7 +302,7 @@
 		      <accelerator key="Q" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8253">
+			<widget class="GtkImage" id="image8430">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-quit</property>
 			  <property name="icon_size">1</property>
@@ -335,7 +335,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8254">
+			<widget class="GtkImage" id="image8431">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-undo</property>
 			  <property name="icon_size">1</property>
@@ -362,7 +362,7 @@
 		      <accelerator key="X" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8255">
+			<widget class="GtkImage" id="image8432">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-cut</property>
 			  <property name="icon_size">1</property>
@@ -383,7 +383,7 @@
 		      <accelerator key="C" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8256">
+			<widget class="GtkImage" id="image8433">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-copy</property>
 			  <property name="icon_size">1</property>
@@ -404,7 +404,7 @@
 		      <accelerator key="V" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8257">
+			<widget class="GtkImage" id="image8434">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-paste</property>
 			  <property name="icon_size">1</property>
@@ -425,7 +425,7 @@
 		      <accelerator key="Delete" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8258">
+			<widget class="GtkImage" id="image8435">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-remove</property>
 			  <property name="icon_size">1</property>
@@ -475,7 +475,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8259">
+			<widget class="GtkImage" id="image8436">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-preferences</property>
 			  <property name="icon_size">1</property>
@@ -548,7 +548,7 @@
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">Zoom _1:1</property>
 		      <property name="use_underline">True</property>
-		      <accelerator key="1" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+		      <accelerator key="1" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 		    </widget>
 		  </child>
 
@@ -557,18 +557,9 @@
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">Zoom _2:1</property>
 		      <property name="use_underline">True</property>
-		      <accelerator key="2" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+		      <accelerator key="2" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 		    </widget>
 		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="zoom_4_1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Zoom _4:1</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="4" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-		    </widget>
-		  </child>
 		</widget>
 	      </child>
 	    </widget>
@@ -711,7 +702,7 @@
 		      <accelerator key="S" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8260">
+			<widget class="GtkImage" id="image8437">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-save-as</property>
 			  <property name="icon_size">1</property>
@@ -762,7 +753,7 @@
 		      <accelerator key="F7" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8261">
+			<widget class="GtkImage" id="image8438">
 			  <property name="visible">True</property>
 			  <property name="pixbuf">gnome-calculator_small.xpm</property>
 			  <property name="xalign">0.5</property>
@@ -835,9 +826,17 @@
 		  </child>
 
 		  <child>
+		    <widget class="GtkMenuItem" id="ocr_dvb">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">OCR (TS-&gt;srt)</property>
+		      <property name="use_underline">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
 		    <widget class="GtkMenuItem" id="edit_glyph1">
 		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Edit glyph</property>
+		      <property name="label" translatable="yes">_Edit Glyph</property>
 		      <property name="use_underline">True</property>
 		    </widget>
 		  </child>
@@ -930,7 +929,7 @@
 		      <accelerator key="P" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8262">
+			<widget class="GtkImage" id="image8439">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-play</property>
 			  <property name="icon_size">1</property>
@@ -951,7 +950,7 @@
 		      <accelerator key="KP_4" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8263">
+			<widget class="GtkImage" id="image8440">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-previous</property>
 			  <property name="icon_size">1</property>
@@ -972,7 +971,7 @@
 		      <accelerator key="KP_6" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8264">
+			<widget class="GtkImage" id="image8441">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-next</property>
 			  <property name="icon_size">1</property>
@@ -993,7 +992,7 @@
 		      <accelerator key="KP_2" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8265">
+			<widget class="GtkImage" id="image8442">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-rewind</property>
 			  <property name="icon_size">1</property>
@@ -1014,7 +1013,7 @@
 		      <accelerator key="KP_8" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8266">
+			<widget class="GtkImage" id="image8443">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-media-forward</property>
 			  <property name="icon_size">1</property>
@@ -1051,7 +1050,7 @@
 		      <accelerator key="Home" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8267">
+			<widget class="GtkImage" id="image8444">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-goto-first</property>
 			  <property name="icon_size">1</property>
@@ -1072,7 +1071,7 @@
 		      <accelerator key="End" modifiers="0" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8268">
+			<widget class="GtkImage" id="image8445">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-goto-last</property>
 			  <property name="icon_size">1</property>
@@ -1118,12 +1117,12 @@
 		  <child>
 		    <widget class="GtkImageMenuItem" id="jum_to_frame1">
 		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Jump to Frame...</property>
+		      <property name="label" translatable="yes">Go to Fra_me...</property>
 		      <property name="use_underline">True</property>
 		      <accelerator key="F" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8269">
+			<widget class="GtkImage" id="image8446">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-jump-to</property>
 			  <property name="icon_size">1</property>
@@ -1139,12 +1138,12 @@
 		  <child>
 		    <widget class="GtkImageMenuItem" id="jump_to_time1">
 		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Jump to _Time...</property>
+		      <property name="label" translatable="yes">Go to _Time...</property>
 		      <property name="use_underline">True</property>
 		      <accelerator key="T" modifiers="GDK_CONTROL_MASK" signal="activate"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8270">
+			<widget class="GtkImage" id="image8447">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-jump-to</property>
 			  <property name="icon_size">1</property>
@@ -1193,7 +1192,7 @@
 		      <property name="use_underline">True</property>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image8271">
+			<widget class="GtkImage" id="image8448">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-about</property>
 			  <property name="icon_size">1</property>
@@ -1218,169 +1217,158 @@
       </child>
 
       <child>
-	<widget class="GtkHBox" id="hbox20">
+	<widget class="GtkToolbar" id="toolbar2">
 	  <property name="visible">True</property>
-	  <property name="homogeneous">False</property>
-	  <property name="spacing">0</property>
+	  <property name="orientation">GTK_ORIENTATION_HORIZONTAL</property>
+	  <property name="toolbar_style">GTK_TOOLBAR_BOTH_HORIZ</property>
+	  <property name="tooltips">True</property>
+	  <property name="show_arrow">True</property>
 
 	  <child>
-	    <widget class="GtkToolbar" id="toolbar2">
+	    <widget class="GtkMenuToolButton" id="menutoolbuttonOpen">
 	      <property name="visible">True</property>
-	      <property name="orientation">GTK_ORIENTATION_HORIZONTAL</property>
-	      <property name="toolbar_style">GTK_TOOLBAR_BOTH_HORIZ</property>
-	      <property name="tooltips">True</property>
-	      <property name="show_arrow">True</property>
+	      <property name="tooltip" translatable="yes">Open a file</property>
+	      <property name="stock_id">gtk-open</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">True</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkMenuToolButton" id="menutoolbuttonOpen">
-		  <property name="visible">True</property>
-		  <property name="tooltip" translatable="yes">Open a file</property>
-		  <property name="stock_id">gtk-open</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">True</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">False</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkToolItem" id="toolitem11">
+	      <property name="visible">True</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">False</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkToolItem" id="toolitem11">
-		  <property name="visible">True</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">False</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">False</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkToolButton" id="toolbuttonSave">
+	      <property name="visible">True</property>
+	      <property name="tooltip" translatable="yes">Save the file</property>
+	      <property name="stock_id">gtk-save</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">True</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">True</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkToolButton" id="toolbuttonSave">
-		  <property name="visible">True</property>
-		  <property name="tooltip" translatable="yes">Save the file</property>
-		  <property name="stock_id">gtk-save</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">True</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">True</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkToolButton" id="toolbuttonInfo">
+	      <property name="visible">True</property>
+	      <property name="tooltip" translatable="yes">Audio/video file information</property>
+	      <property name="stock_id">gtk-properties</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">False</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">True</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkToolButton" id="toolbuttonInfo">
-		  <property name="visible">True</property>
-		  <property name="tooltip" translatable="yes">Audio/video file information</property>
-		  <property name="stock_id">gtk-properties</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">False</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">True</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkSeparatorToolItem" id="separatortoolitem1">
+	      <property name="visible">True</property>
+	      <property name="draw">True</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkSeparatorToolItem" id="separatortoolitem1">
-		  <property name="visible">True</property>
-		  <property name="draw">True</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">False</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkToolButton" id="toolbuttonCalc">
+	      <property name="visible">True</property>
+	      <property name="tooltip" translatable="yes">Bitrate/size calculator</property>
+	      <property name="label" translatable="yes">Calculator</property>
+	      <property name="use_underline">True</property>
+	      <property name="icon">gnome-calculator.xpm</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">True</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">True</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkToolButton" id="toolbuttonCalc">
-		  <property name="visible">True</property>
-		  <property name="tooltip" translatable="yes">Bitrate/size calculator</property>
-		  <property name="label" translatable="yes">Calculator</property>
-		  <property name="use_underline">True</property>
-		  <property name="icon">gnome-calculator.xpm</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">True</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">True</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkSeparatorToolItem" id="separatortoolitem2">
+	      <property name="visible">True</property>
+	      <property name="draw">True</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
+	    </packing>
+	  </child>
 
-	      <child>
-		<widget class="GtkSeparatorToolItem" id="separatortoolitem2">
-		  <property name="visible">True</property>
-		  <property name="draw">True</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">False</property>
-		</packing>
-	      </child>
+	  <child>
+	    <widget class="GtkToolItem" id="toolitem12">
+	      <property name="visible">True</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">False</property>
 
 	      <child>
-		<widget class="GtkToolItem" id="toolitem12">
+		<widget class="GtkComboBox" id="comboboxPreview">
 		  <property name="visible">True</property>
-		  <property name="visible_horizontal">True</property>
-		  <property name="visible_vertical">True</property>
-		  <property name="is_important">False</property>
-
-		  <child>
-		    <widget class="GtkComboBox" id="comboboxPreview">
-		      <property name="visible">True</property>
-		      <property name="items" translatable="yes"></property>
-		      <property name="add_tearoffs">False</property>
-		      <property name="focus_on_click">True</property>
-		    </widget>
-		  </child>
+		  <property name="items" translatable="yes"></property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
 		</widget>
-		<packing>
-		  <property name="expand">False</property>
-		  <property name="homogeneous">False</property>
-		</packing>
 	      </child>
 	    </widget>
 	    <packing>
-	      <property name="padding">0</property>
-	      <property name="expand">True</property>
-	      <property name="fill">True</property>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
 	    </packing>
 	  </child>
 
 	  <child>
-	    <widget class="GtkHBox" id="hbox21">
+	    <widget class="GtkToolItem" id="toolitem13">
 	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">0</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">False</property>
 
 	      <child>
 		<widget class="GtkToggleButton" id="togglebutton1">
 		  <property name="visible">True</property>
 		  <property name="can_focus">True</property>
-		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="relief">GTK_RELIEF_NONE</property>
 		  <property name="focus_on_click">True</property>
 		  <property name="active">False</property>
 		  <property name="inconsistent">False</property>
 
 		  <child>
 		    <widget class="GtkImage" id="image8272">
+		      <property name="width_request">17</property>
+		      <property name="height_request">16</property>
 		      <property name="visible">True</property>
-		      <property name="stock">gtk-connect</property>
-		      <property name="icon_size">1</property>
+		      <property name="pixbuf">audio-volume-medium.png</property>
 		      <property name="xalign">0.5</property>
 		      <property name="yalign">0.5</property>
 		      <property name="xpad">0</property>
@@ -1388,15 +1376,24 @@
 		    </widget>
 		  </child>
 		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
 	      </child>
+	    </widget>
+	    <packing>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
+	    </packing>
+	  </child>
 
+	  <child>
+	    <widget class="GtkToolItem" id="toolitem14">
+	      <property name="visible">True</property>
+	      <property name="visible_horizontal">True</property>
+	      <property name="visible_vertical">True</property>
+	      <property name="is_important">False</property>
+
 	      <child>
 		<widget class="GtkHScale" id="hscalVolume">
+		  <property name="width_request">100</property>
 		  <property name="visible">True</property>
 		  <property name="can_focus">True</property>
 		  <property name="draw_value">False</property>
@@ -1406,24 +1403,18 @@
 		  <property name="inverted">False</property>
 		  <property name="adjustment">99 0 100 1 1 1</property>
 		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">True</property>
-		  <property name="fill">True</property>
-		</packing>
 	      </child>
 	    </widget>
 	    <packing>
-	      <property name="padding">0</property>
-	      <property name="expand">True</property>
-	      <property name="fill">True</property>
+	      <property name="expand">False</property>
+	      <property name="homogeneous">False</property>
 	    </packing>
 	  </child>
 	</widget>
 	<packing>
 	  <property name="padding">0</property>
-	  <property name="expand">True</property>
-	  <property name="fill">True</property>
+	  <property name="expand">False</property>
+	  <property name="fill">False</property>
 	</packing>
       </child>
 
@@ -1753,7 +1744,7 @@
 					  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
 					  <property name="snap_to_ticks">False</property>
 					  <property name="wrap">False</property>
-					  <property name="adjustment">0 -9999 9999 1 10 10</property>
+					  <property name="adjustment">0 -99999 99999 1 10 10</property>
 					</widget>
 					<packing>
 					  <property name="padding">0</property>
@@ -2459,7 +2450,7 @@
 		    <widget class="GtkLabel" id="labelTotalFrame">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">/0000000</property>
+		      <property name="label" translatable="yes">/ 0000000</property>
 		      <property name="use_underline">False</property>
 		      <property name="use_markup">False</property>
 		      <property name="justify">GTK_JUSTIFY_LEFT</property>
@@ -2531,7 +2522,7 @@
 		    <widget class="GtkLabel" id="labelTotalTime">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">/00:00:00,000</property>
+		      <property name="label" translatable="yes">/ 00:00:00,000</property>
 		      <property name="use_underline">False</property>
 		      <property name="use_markup">False</property>
 		      <property name="justify">GTK_JUSTIFY_LEFT</property>



From mean at mail.berlios.de  Sun Aug  5 09:58:14 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 5 Aug 2007 09:58:14 +0200
Subject: [Avidemux-svn-commit] r3476 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper
Message-ID: <200708050758.l757wEJP008864@sheep.berlios.de>

Author: mean
Date: 2007-08-05 09:58:14 +0200 (Sun, 05 Aug 2007)
New Revision: 3476

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
Log:
OOPS

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2007-08-04 15:45:24 UTC (rev 3475)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h	2007-08-05 07:58:14 UTC (rev 3476)
@@ -29,9 +29,9 @@
 #include "libwrapper_dca.h"
 
 ZZ_PREFIX ADM_LibWrapperDca* dca ZZ_POSTFIX;
+#endif // USE LIBDCA
 
 // funcs
 void initLibWrappers();
 void destroyLibWrappers();
-#endif // USE LIBDCA
 #endif // LIBWRAPPER



From mean at mail.berlios.de  Sun Aug  5 17:09:51 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 5 Aug 2007 17:09:51 +0200
Subject: [Avidemux-svn-commit] r3477 - in
	branches/avidemux_2.4_branch/avidemux: ADM_audiocodec
	ADM_libraries/ADM_lavcodec
Message-ID: <200708051509.l75F9pV2026356@sheep.berlios.de>

Author: mean
Date: 2007-08-05 17:09:50 +0200 (Sun, 05 Aug 2007)
New Revision: 3477

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodec.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
Log:
[AUDIO] Increase buffer+remove check when using lavcodec as audio decoder

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodec.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodec.h	2007-08-05 07:58:14 UTC (rev 3476)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodec.h	2007-08-05 15:09:50 UTC (rev 3477)
@@ -16,7 +16,7 @@
  ***************************************************************************/
 #ifndef ADMAUDIOCODEC
 #define ADMAUDIOCODEC
-#define SCRATCH_PAD_SIZE (80000*2)
+#define SCRATCH_PAD_SIZE (100*1000*2)
 extern uint8_t scratchPad[];
 #define  ADMAC_BUFFER (48000*4)
 class ADM_Audiocodec

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-08-05 07:58:14 UTC (rev 3476)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-08-05 15:09:50 UTC (rev 3477)
@@ -938,10 +938,12 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
+#if 0 // MEANX SILENCE!
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
         }
+#endif
         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t) ||
         *frame_size_ptr < buf_size){



From mean at mail.berlios.de  Sun Aug  5 17:38:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 5 Aug 2007 17:38:55 +0200
Subject: [Avidemux-svn-commit] r3478 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708051538.l75FctW9028216@sheep.berlios.de>

Author: mean
Date: 2007-08-05 17:38:54 +0200 (Sun, 05 Aug 2007)
New Revision: 3478

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[QT4] Connect volume slider

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-05 15:09:50 UTC (rev 3477)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-05 15:38:54 UTC (rev 3478)
@@ -63,8 +63,10 @@
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
 static QAction  *customActions[ADM_MAC_CUSTOM_SCRIPT];
 static uint32_t ADM_nbCustom=0;
+#ifdef HAVE_AUDIO
+extern uint8_t AVDM_setVolume(int volume);
+#endif
 
-
 #include "ui_gui2.h"
 
 #define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
@@ -149,6 +151,18 @@
             HandleAction (ACT_Scale) ;
           }
         }
+      void volumeChange( int u )
+      {
+      #ifdef HAVE_AUDIO
+      
+      if(_upd_in_progres) return;
+       _upd_in_progres++;
+       int vol;
+              vol=ui.horizontalSlider_2->value();
+              AVDM_setVolume( vol);
+       _upd_in_progres--;
+      #endif
+      }
  private slots:
    
 
@@ -182,8 +196,12 @@
           slider->setMinimum(0);
           slider->setMaximum(1000);
           connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
-          //connect( slider,SIGNAL(sliderMoved()),this,SLOT(sliderMoved()));
-  
+          // Volume slider
+          QSlider *volSlider=ui.horizontalSlider_2;
+          
+          volSlider->setMinimum(0);
+          volSlider->setMaximum(100);
+          connect( volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
           // Add a second toolbar
           QToolBar *toolBarMove;
             toolBarMove = new QToolBar(this);



From mean at mail.berlios.de  Sun Aug  5 19:11:55 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 5 Aug 2007 19:11:55 +0200
Subject: [Avidemux-svn-commit] r3479 - in
	branches/avidemux_2.4_branch/avidemux: ADM_filter
	ADM_libraries/ADM_utilities ADM_videoFilter
Message-ID: <200708051711.l75HBt2u020525@sheep.berlios.de>

Author: mean
Date: 2007-08-05 19:11:52 +0200 (Sun, 05 Aug 2007)
New Revision: 3479

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filters] Skeleton for logo and imageLoader, not complete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-05 17:11:52 UTC (rev 3479)
@@ -152,8 +152,9 @@
 	REGISTERX("ass","ASS","Add ASS/SSA subtitles to the picture.",VF_ASS,1,ass_create,ass_script);
 #endif
         REGISTERX("vobsub","VobSub","Embed VobSub subtitles into picture.",VF_VOBSUB,1,vobsub_create,vobsub_script);
+#ifdef ADM_DEBUG
         REGISTERX("dvbsub","DVB sub","Embed DVB-T subtitle.",VF_DVBSUB,1,dvbsub_create,dvbsub_script);
-        
+#endif
 
         //*********************
  registerFilter("-------- Deblender ---------",VF_INVALID,2,NULL,NULL);
@@ -163,6 +164,7 @@
         REGISTERX("whirl","Whirl","Useless whirlwind effect.",VF_WHIRL,1,whirl_create,whirl_script);
         REGISTERX("mosaic","Mosaic","Split the picture into tiny thumbnails.",VF_MOSAIC,1,     mosaic_create,mosaic_script);
         REGISTERX("mpdelogo","MPlayer delogo","Blend a logo by interpolating its surrounding box.",VF_MPDELOGO,1,mpdelogo_create,mpdelogo_script);
+        REGISTERX("logo","Logo","Add a png as logo.",VF_LOGO,1,logo_create,logo_script);
         REGISTERX("animatedmenu","Animated Menu",
             "Create a video made of 6 mini windows, very useful to do DVD menus.",
             VF_ANIMATED,1,animated_create,animated_script);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-05 17:11:52 UTC (rev 3479)
@@ -99,6 +99,7 @@
                 VF_ASS,
                 VF_YADIF,
                 VF_DVBSUB,
+                VF_LOGO,
                 VF_DUMMY,
                 VF_EXTERNAL_START=0xF0000000
           }VF_FILTERS;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-05 17:11:52 UTC (rev 3479)
@@ -172,5 +172,5 @@
 
 // Misc utilities
 uint8_t BitBlit(uint8_t *dst, uint32_t pitchDest,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height);
-
+ADMImage *createImageFromFile(const char *filename);
 #endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp (from rev 3469, branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp	2007-08-03 00:04:40 UTC (rev 3469)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-05 17:11:52 UTC (rev 3479)
@@ -0,0 +1,156 @@
+/***************************************************************************
+    copyright            : (C) 2003-2005 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+#include "ADM_assert.h"
+#include "default.h"
+
+#include "ADM_lavcodec.h"
+#include "ADM_utilities/default.h"
+
+#include "ADM_colorspace/colorspace.h"
+
+#include "ADM_image.h"
+#include "ADM_osSupport/ADM_cpuCap.h"
+
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_codecs/ADM_ffmp43.h"
+
+
+/*
+ * 	\fn 	createImageFromFile
+ *  \brief 	Create an image from a file. Only jpg supporter ATM
+ * 
+ */
+static uint8_t read8(FILE *fd)
+{
+	return fgetc(fd);
+}
+static uint32_t read16(FILE *fd)
+{
+	uint32_t a,b;
+	
+	a=fgetc(fd);
+	b=fgetc(fd);
+	return (a<<8)+b;
+		
+}
+
+ADMImage *createImageFromFile(const char *filename)
+{
+		int32_t nnum;
+	    uint32_t *fcc;
+	    uint8_t fcc_tab[4];
+	    FILE *fd;
+	    uint32_t _imgSize;
+	    uint32_t w = 0, h = 0;
+
+	    // 1- identity the file type
+	    //
+	    fcc = (uint32_t *) fcc_tab;
+	    fd = fopen(filename, "rb");
+	    if (!fd) 
+	    {
+	    	printf("[imageLoader] Cannot open that file!\n");
+	    	return NULL;
+	    }
+	    fread(fcc_tab, 4, 1, fd);
+	    fclose(fd);
+	   if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
+	   {
+		
+		} else {
+			printf("[imageLoader] Unrecognized file!\n");
+			return NULL;
+		    }
+		fd = fopen(filename, "rb");
+		fseek(fd, 0, SEEK_END);
+		_imgSize = ftell(fd);
+		fseek(fd, 0, SEEK_SET);
+
+		//Retrieve width & height
+		//_______________________
+		    uint16_t tag = 0, count = 0, off;
+
+		    
+		    fseek(fd, 0, SEEK_SET);
+		    read16(fd);	// skip jpeg ffd8
+		    while (count < 10 && tag != 0xFFC0) 
+		    {
+
+		    	tag = read16(fd);
+		    	if ((tag >> 8) != 0xff) 
+		    	{
+		    		printf("[imageLoader]invalid jpeg tag found (%x)\n", tag);
+		    	}
+		    	if (tag == 0xFFC0) 
+		    	{
+		    		read16(fd);	// size
+		    		read8(fd);	// precision
+		    		h = read16(fd);
+		    		w = read16(fd);
+	                if(w&1) w++;
+	                if(h&1) h++;
+		    	} 
+		    	else 
+		    	{
+		    		off = read16(fd);
+		    		if (off < 2) 
+		    		{
+		    			printf("[imageLoader]Offset too short!\n");
+		    		    fclose(fd);
+		    		    return NULL;
+		    		}
+		    		fseek(fd, off - 2, SEEK_CUR);
+		    	}
+			count++;
+		    }
+		    if (tag != 0xffc0) 
+		    {
+		    	printf("[imageLoader]Cannot fint start of frame\n");
+				fclose(fd);
+				return NULL;
+		    }
+		    printf("[imageLoader] %lu x %lu.., total Size : %u, offset %u\n", w, h,_imgSize,off);
+		    
+		// Load the binary coded image
+		    uint8_t *data=new uint8_t[_imgSize];
+		    fseek(fd, 0, SEEK_SET);
+		    fread(data,_imgSize,1,fd);
+		    fclose(fd);
+		  //
+		    ADMImage *image=new ADMImage(w,h);
+		    ADMImage tmpImage(w,h);
+		    // Now unpack it ...
+		    decoderFFMJPEG *decoder=new decoderFFMJPEG(w,h);
+		    ADMCompressedImage bin;
+		    bin.data=data;
+		    bin.dataLength=_imgSize; // This is more than actually, but who cares...
+		    
+		    decoder->uncompress (&bin, &tmpImage);
+		    
+		    delete decoder;
+		    decoder=NULL;
+		    //
+		    image->duplicate(&tmpImage);
+		   // 
+		    delete [] data;
+		    return image;
+		
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt	2007-08-05 17:11:52 UTC (rev 3479)
@@ -7,6 +7,7 @@
 SET(${ADM_LIB}_SRCS 
 ADM_bitstream.cpp  ADM_image.cpp         ADM_imageUtils.cpp  ADM_print.cpp    aviframe.cpp    aviio.cpp   fourcc.cpp  subchunk.cpp
 ADM_fileio.cpp     ADM_imageResizer.cpp  ADM_pp.cpp          avidemutils.cpp  aviindexer.cpp  broken.cpp  prefs.cpp
+ADM_imageLoader.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-08-05 17:11:52 UTC (rev 3479)
@@ -8,7 +8,7 @@
 libADM_library_a_SOURCES = subchunk.cpp  fourcc.cpp broken.cpp \
 		aviio.cpp aviindexer.cpp aviframe.cpp avidemutils.cpp ADM_image.cpp \
 	ADM_fileio.cpp ADM_print.cpp ADM_imageUtils.cpp ADM_bitstream.cpp \
-	ADM_imageResizer.cpp ADM_pp.cpp prefs.cpp
+	ADM_imageResizer.cpp ADM_pp.cpp prefs.cpp ADM_imageLoader.cpp
 
 
 EXTRA_DIST =  ADM_bitstream.cpp  ADM_image.cpp     \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp (from rev 3469, branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-08-03 00:04:40 UTC (rev 3469)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp	2007-08-05 17:11:52 UTC (rev 3479)
@@ -0,0 +1,191 @@
+/***************************************************************************
+
+		Put a logon on video
+
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+/*
+  Initial port from MPlayer by Moonz
+
+*/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include "ADM_assert.h"
+
+#include "default.h"
+
+
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_video/ADM_vidCommonFilter.h"
+#include "ADM_filter/video_filters.h"
+#include "ADM_colorspace/ADM_rgb.h"
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
+static FILTER_PARAM logoParam={4,
+        { /* float */ "image",
+          /*float*/ "x",
+          /* int */ "y",
+          /* int */ "alpha"}};
+
+
+typedef struct 
+{
+		char *image;
+		uint32_t x,y;
+		uint32_t alpha;
+}PARAM_LOGO;
+
+
+class ADMVideoLogo : public AVDMGenericVideoStream
+{
+  
+	PARAM_LOGO   *_param;
+	ADMImage	 *_image;
+	uint32_t	 _inited;
+	uint8_t		 init(void);
+	uint8_t		 cleanup(void);
+  public:
+                                
+	  				ADMVideoLogo(AVDMGenericVideoStream *in,CONFcouple *couples);    
+                    ~ADMVideoLogo(void);
+    uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                          ADMImage *data,uint32_t *flags);
+        
+    char            *printConf( void );
+    uint8_t         configure(AVDMGenericVideoStream *in);
+    uint8_t         getCoupledConf( CONFcouple **couples);
+};
+SCRIPT_CREATE(logo_script,ADMVideoLogo,logoParam);
+BUILD_CREATE(logo_create,ADMVideoLogo);
+
+//***********************************
+char *ADMVideoLogo::printConf() 
+{
+      static char buf[50];
+      snprintf((char *)buf,50,"Logo at %u %u, alpha %u",_param->x,_param->y);;
+      return buf;
+}
+
+
+uint8_t ADMVideoLogo::configure(AVDMGenericVideoStream * instream)
+{
+ 
+
+     return 1;
+}
+
+//_______________________________________________________________
+
+ADMVideoLogo::ADMVideoLogo(AVDMGenericVideoStream *in, CONFcouple *couples) 
+{
+        _in=in;		
+        memcpy(&_info,_in->getInfo(),sizeof(_info));
+        _param = new PARAM_LOGO;
+        ADM_assert(_param);
+        
+        
+        if(couples) {
+        
+                GET(image)
+                GET(x)
+                GET(y)
+                GET(alpha)
+        }	
+        else {
+        	 		_param->image=ADM_strdup("/work/samples/r01.jpg");
+        	 		_param->x=0;
+        	 		_param->y=0;
+        	 		_param->alpha=255;
+        }
+        _image=NULL;
+        _inited=init();
+        
+        
+        _info.encoding=1;
+
+}
+// **********************************
+uint8_t ADMVideoLogo::init(void)
+{
+		cleanup();
+		_image=createImageFromFile(_param->image);
+		if(_image) return 1;
+        return 0;
+} 
+// **********************************
+uint8_t ADMVideoLogo::cleanup(void)
+{
+	if(_image) delete _image;
+	_image=NULL;
+	
+	return 1;
+} 
+
+//*******************************************
+ADMVideoLogo::~ADMVideoLogo() 
+{
+    
+      
+      if(_param) 
+      {
+    	 if(_param->image) delete _param->image;
+    	 _param->image=NULL;
+    	 delete _param;
+    	 _param=NULL;
+      }
+      cleanup();
+
+}
+//*******************************************
+uint8_t ADMVideoLogo::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data, uint32_t *flags) 
+{
+       
+
+        if(frame>=_info.nb_frames)
+        {
+          printf("[Logo] out of bound %u/%u\n",frame,_info.nb_frames); 
+          return 0;
+        }
+        ADM_assert(_param);
+
+        if(!_in->getFrameNumberNoAlloc(frame, len, data, flags))
+                return 0;
+
+        if(!_image)
+        {
+        	printf("[LOGO] No image to put\n");
+        	return 1;
+        }
+        // No alpha ATM
+        _image->copyTo(data,_param->x,_param->y);
+        return 1;
+}
+
+uint8_t	ADMVideoLogo::getCoupledConf(CONFcouple **couples) 
+{
+        *couples=new CONFcouple(4);
+
+#define COUPLE_SET(x) (*couples)->setCouple((char *)#x,(_param->x));
+        COUPLE_SET(image)
+        COUPLE_SET(x)
+        COUPLE_SET(y)
+        COUPLE_SET(alpha)
+        return 1;
+}
+/************************************************/
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-05 17:11:52 UTC (rev 3479)
@@ -24,5 +24,6 @@
 ADM_vidChromaShift.cpp  
 ADM_vidAnimated.cpp
 ADM_vidDvbSub.cpp
+ADM_vidLogo.cpp
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-05 15:38:54 UTC (rev 3478)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-05 17:11:52 UTC (rev 3479)
@@ -62,7 +62,8 @@
  ADM_vidYadif.cpp \
  ADM_vidYadif_asm.c \
  ADM_vidAnimated.cpp \
- ADM_vidDvbSub.cpp
+ ADM_vidDvbSub.cpp \
+ ADM_vidLogo.cpp
 			
 
 



From mean at mail.berlios.de  Sun Aug  5 19:29:01 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 5 Aug 2007 19:29:01 +0200
Subject: [Avidemux-svn-commit] r3480 -
	branches/avidemux_2.4_branch/avidemux/ADM_filter
Message-ID: <200708051729.l75HT1o9018024@sheep.berlios.de>

Author: mean
Date: 2007-08-05 19:29:01 +0200 (Sun, 05 Aug 2007)
New Revision: 3480

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
Log:
Make it compile in release mode

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-05 17:11:52 UTC (rev 3479)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-05 17:29:01 UTC (rev 3480)
@@ -152,7 +152,7 @@
 	REGISTERX("ass","ASS","Add ASS/SSA subtitles to the picture.",VF_ASS,1,ass_create,ass_script);
 #endif
         REGISTERX("vobsub","VobSub","Embed VobSub subtitles into picture.",VF_VOBSUB,1,vobsub_create,vobsub_script);
-#ifdef ADM_DEBUG
+#if 1 //def ADM_DEBUG
         REGISTERX("dvbsub","DVB sub","Embed DVB-T subtitle.",VF_DVBSUB,1,dvbsub_create,dvbsub_script);
 #endif
 



From mean at mail.berlios.de  Mon Aug  6 20:03:05 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 6 Aug 2007 20:03:05 +0200
Subject: [Avidemux-svn-commit] r3481 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200708061803.l76I35iC019181@sheep.berlios.de>

Author: mean
Date: 2007-08-06 20:03:05 +0200 (Mon, 06 Aug 2007)
New Revision: 3481

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
Log:
[Codec] Add an assert when using non isRef image

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-05 17:29:01 UTC (rev 3480)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-06 18:03:05 UTC (rev 3481)
@@ -24,7 +24,7 @@
 #include <string.h>
 #include <math.h>
 
-#ifdef USE_FFMPEG
+
 #include <ADM_assert.h>
 
 #include "ADM_lavcodec.h"
@@ -75,6 +75,7 @@
 uint8_t decoderFF::clonePic (AVFrame * src, ADMImage * out)
 {
   uint32_t    u,v;
+  ADM_assert(out->_isRef);
   out->_planes[0] = (uint8_t *) src->data[0];
   out->_planeStride[0] = src->linesize[0];
   if (_swapUV)
@@ -713,6 +714,4 @@
     vsnprintf(buf, sizeof(buf), fmt, list);
     printf("[LAV] %s\n",buf);
 }
-
-
-#endif
+// EOF



From mean at mail.berlios.de  Mon Aug  6 20:03:38 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 6 Aug 2007 20:03:38 +0200
Subject: [Avidemux-svn-commit] r3482 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_libraries/ADM_utilities ADM_videoFilter
Message-ID: <200708061803.l76I3c8a019281@sheep.berlios.de>

Author: mean
Date: 2007-08-06 20:03:37 +0200 (Mon, 06 Aug 2007)
New Revision: 3482

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp
Log:
[Filter] More on imageLoader and logo filter

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-06 18:03:05 UTC (rev 3481)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-06 18:03:37 UTC (rev 3482)
@@ -1,5 +1,5 @@
 /***************************************************************************
-    copyright            : (C) 2003-2005 by mean
+    copyright            : (C) 2007 by mean
     email                : fixounet at free.fr
  ***************************************************************************/
 
@@ -29,13 +29,10 @@
 
 #include "ADM_codecs/ADM_codec.h"
 #include "ADM_codecs/ADM_ffmp43.h"
+#include "ADM_toolkit/toolkit.hxx"
 
 
-/*
- * 	\fn 	createImageFromFile
- *  \brief 	Create an image from a file. Only jpg supporter ATM
- * 
- */
+
 static uint8_t read8(FILE *fd)
 {
 	return fgetc(fd);
@@ -49,7 +46,11 @@
 	return (a<<8)+b;
 		
 }
+/*
+		\fn 	createImageFromFile
+		\brief 	Create and returns an ADMImage from a file, only YV12 jpg supported ATM
 
+*/
 ADMImage *createImageFromFile(const char *filename)
 {
 		int32_t nnum;
@@ -133,8 +134,8 @@
 		    fread(data,_imgSize,1,fd);
 		    fclose(fd);
 		  //
-		    ADMImage *image=new ADMImage(w,h);
-		    ADMImage tmpImage(w,h);
+		    
+		    ADMImage tmpImage(w,h,1); // It is a reference image
 		    // Now unpack it ...
 		    decoderFFMJPEG *decoder=new decoderFFMJPEG(w,h);
 		    ADMCompressedImage bin;
@@ -142,15 +143,21 @@
 		    bin.dataLength=_imgSize; // This is more than actually, but who cares...
 		    
 		    decoder->uncompress (&bin, &tmpImage);
-		    
+		    //
+		    ADMImage *image=NULL;
+		    if(tmpImage._colorspace==ADM_COLOR_YV12)
+		    {
+		    	GUI_Error_HIG(_("Wrong Colorspace"),_("Only YV12/I420 JPegs are supported"));
+		    }else
+		    {		    
+		    		image=new ADMImage(w,h);
+		    		image->duplicate(&tmpImage);
+		    }
+		    // Cannot destroy decoder earlier as tmpImage has pointers to its internals
 		    delete decoder;
 		    decoder=NULL;
-		    //
-		    image->duplicate(&tmpImage);
-		   // 
 		    delete [] data;
-		    return image;
-		
+		    return image;		
 }
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp	2007-08-06 18:03:05 UTC (rev 3481)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp	2007-08-06 18:03:37 UTC (rev 3482)
@@ -84,9 +84,20 @@
 
 uint8_t ADMVideoLogo::configure(AVDMGenericVideoStream * instream)
 {
- 
-
-     return 1;
+#define PX(x) &(_param->x)
+	   diaElemFile       file(0,(char **)PX(image),_("_Logo (jpg file):"));
+	   diaElemUInteger   positionX(PX(x),_("_X Position:"),0,_info.width);
+	   diaElemUInteger   positionY(PX(y),_("_Y Position:"),0,_info.height);
+	   diaElemUInteger   alpha(PX(alpha),_("_Alpha:"),0,255);
+	    
+	   diaElem *elems[4]={&file,&positionX,&positionY,&alpha};
+	  
+	   if( diaFactoryRun("Logo",4,elems))
+	   {
+		   init();
+		   return 1;
+	   }
+	   return 0;
 }
 
 //_______________________________________________________________



From gruntster at mail.berlios.de  Tue Aug  7 15:46:57 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 7 Aug 2007 15:46:57 +0200
Subject: [Avidemux-svn-commit] r3483 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200708071346.l77Dkvk1004552@sheep.berlios.de>

Author: gruntster
Date: 2007-08-07 15:46:46 +0200 (Tue, 07 Aug 2007)
New Revision: 3483

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
[Win32] permit compilation without SDL

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-06 18:03:37 UTC (rev 3482)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-07 13:46:46 UTC (rev 3483)
@@ -423,7 +423,7 @@
                 // Alternate mp3 tag (haali)
                 prefs->set(FEATURE_ALTERNATE_MP3_TAG,alternate_mp3_tag);
 
-			#ifdef ADM_WIN32
+			#if defined(ADM_WIN32) && defined(USE_SDL)
 				// Initialise SDL again as driver may have changed
 				initSdl();
 			#endif



From mean at mail.berlios.de  Tue Aug  7 19:01:48 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 7 Aug 2007 19:01:48 +0200
Subject: [Avidemux-svn-commit] r3485 - branches/avidemux_2.4_branch/po
Message-ID: <200708071701.l77H1moa028365@sheep.berlios.de>

Author: mean
Date: 2007-08-07 19:01:37 +0200 (Tue, 07 Aug 2007)
New Revision: 3485

Modified:
   branches/avidemux_2.4_branch/po/ca.po
Log:
[I18N] ca translation by Joan F

Modified: branches/avidemux_2.4_branch/po/ca.po
===================================================================
--- branches/avidemux_2.4_branch/po/ca.po	2007-08-07 17:00:09 UTC (rev 3484)
+++ branches/avidemux_2.4_branch/po/ca.po	2007-08-07 17:01:37 UTC (rev 3485)
@@ -4,8 +4,8 @@
 msgstr ""
 "Project-Id-Version: ca\n"
 "POT-Creation-Date: \n"
-"PO-Revision-Date: 2007-06-23 22:25+0000\n"
-"Last-Translator: Joan Farrerons <jfarrerons at economistes.com>\n"
+"PO-Revision-Date: 2007-08-06 22:40+0100\n"
+"Last-Translator: Joan Farrerons i Herrero <jfarrerons at economistes.com>\n"
 "Language-Team: catal? <ca at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
@@ -14,9 +14,10 @@
 "X-Poedit-Country: SPAIN\n"
 "X-Poedit-SourceCharset: iso-8859-1\n"
 "X-Generator: KBabel 1.11.4\n"
+"Plural-Forms: nplurals = 2; plural = (n != 1);\n"
 
 #: avidemux/ADM_audiocodec/ADM_codecwma.cpp:75
-#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:182
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:183
 msgid "Internal error"
 msgstr "S'ha produ?t un error intern"
 
@@ -24,36 +25,34 @@
 msgid "Cannot open WMA2 codec."
 msgstr "No es pot obrir el c?dec WMA2."
 
-#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:182
+#: avidemux/ADM_audiocodec/ADM_codecwma.cpp:183
 msgid "Cannot open AMR codec."
 msgstr "No es pot obrir el c?dec AMR."
 
-#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:118
-msgid "Could not open OSS audio device"
-msgstr "No es pot obrir el dispositiu d'?udio OSS"
-
-#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:118
-msgid "Check the permissions for /dev/dsp."
-msgstr "Comproveu els permisos per a /dev/dsp."
-
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:215
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:199
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:371
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:110
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:236
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:104
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:101
+#, c-format
 msgid "Stereo"
-msgstr "Stereo"
+msgstr "Est?reo"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:216
 msgid "Joint stereo"
-msgstr "Joint stereo"
+msgstr "Joint est?reo"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:217
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:370
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:107
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:103
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:98
+#, c-format
 msgid "Mono"
 msgstr "Mono"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:219
-msgid "Channel Mode"
-msgstr "Mode canal"
+msgid "C_hannel mode:"
+msgstr "Mode _canal: "
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:222
 msgid "CBR"
@@ -68,40 +67,27 @@
 msgstr "Extrema"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:228
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:273
-#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:203
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:181
-msgid "Mode"
-msgstr "Mode"
+msgid "Bit_rate mode:"
+msgstr "Mode _taxa bits: "
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:241
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:287
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:288
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp:59
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:624
-msgid "Bitrate"
-msgstr "Taxa bits"
+msgid "_Bitrate:"
+msgstr "Taxa _bits: "
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:246
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:289
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mjpeg.cpp:82
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:290
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp:40
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:204
-msgid "Quality"
-msgstr "Qualitat"
+msgid "_Quality:"
+msgstr "_Qualitat: "
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:270
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:469
-msgid "VBR"
-msgstr "VBR"
-
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
-msgid "Quality Based"
-msgstr "Qualitatiu "
-
 #: avidemux/ADM_audiofilter/audiofilter_buildchain.cpp:322
 #: avidemux/gui_autodrive.cpp:82
 #: avidemux/gui_autodrive.cpp:116
 msgid "Codec Error"
-msgstr "S'ha produ?t un error de c?dec"
+msgstr "S'ha produ?t un error de c?dec."
 
 #: avidemux/ADM_audiofilter/audiofilter_buildchain.cpp:322
 msgid ""
@@ -111,1092 +97,2228 @@
 "El nombre de canals ?s m?s gran que el que pot tractar el c?dec d'?udio seleccionat.\n"
 "Canvieu el c?dec o utilitzeu el filtre mesclador per tenir menys canals."
 
-#: avidemux/ADM_codecs/ADM_ffmp43.cpp:51
-msgid "Internal error finding codec"
-msgstr "S'ha produ?t un error intern en la cerca del c?dec"
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
+msgid "VBR"
+msgstr "VBR"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:51
-msgid "Internal error opening codec"
-msgstr "S'ha produ?t un error intern en l'obertura del c?dec"
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:272
+msgid "Quality based"
+msgstr "Qualitatiu"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
-msgid "Internal error with context for  codec"
-msgstr "S'ha produ?t un error intern amb el context per al c?dec"
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:274
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:113
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:91
+#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:203
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:181
+msgid "_Mode:"
+msgstr "_Mode:"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
-msgid ""
-".\n"
-" Did you use too low / too high target for 2 pass ?"
-msgstr ""
-".\n"
-" Heu usat un objectiu massa baix/alt per a 2 passos?"
+#: avidemux/ADM_encoder/adm_encffmpeg.cpp:261
+msgid "Incompatible settings"
+msgstr "La configuraci? ?s incompatible."
 
-#: avidemux/ADM_editor/ADM_edFrameType.cpp:56
-msgid "No video loaded"
-msgstr "No hi ha cap v?deo carregat"
+#: avidemux/ADM_encoder/adm_encffmpeg.cpp:261
+msgid "At the moment, the DV codec only accepts 720*576 at 25"
+msgstr "Per ara, el c?dec DV nom?s accepta 720*576 at 25."
 
-#: avidemux/ADM_editor/ADM_edFrameType.cpp:61
-msgid "Not indexable"
-msgstr "No ?s indexable"
+#: avidemux/ADM_encoder/adm_encConfig.cpp:192
+msgid "Wrong output format"
+msgstr "El format de sortida ?s erroni."
 
-#: avidemux/ADM_editor/ADM_edFrameType.cpp:61
-msgid "DivX 5 + packed?"
-msgstr "?s de tipus DivX 5 + empaquetat?"
+#: avidemux/ADM_encoder/adm_encConfig.cpp:192
+msgid "Select MPEG as the output."
+msgstr "Seleccioneu MPEG com a sortida."
 
-#: avidemux/ADM_editor/ADM_edFrameType.cpp:119
-msgid "Aborted"
-msgstr "S'ha cancel?lat"
+#: avidemux/ADM_encoder/adm_encConfig.cpp:197
+msgid "Wrong video codec"
+msgstr "El c?dec de v?deo ?s erroni."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:389
-msgid "File type identified but no loader support detected..."
-msgstr "S'ha identificar el tipus de fitxer per? no se n'ha detectat suport de carregador..."
+#: avidemux/ADM_encoder/adm_encConfig.cpp:198
+msgid "Select DVD as the video codec for MPEG TS output."
+msgstr "Seleccioneu \"DVD\" com a c?dec de v?deo per a la sortida de MPEG TS."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:390
-msgid "May be related to an old index file."
-msgstr "Potser es refereix a un antic fitxer d'?ndex"
+#: avidemux/ADM_encoder/adm_encConfig.cpp:715
+msgid "Only QCIF and subQCIF are allowed for H.263"
+msgstr "Nom?s es permet QCIF i subQCIF per a l'H.263."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:397
+#: avidemux/ADM_encoder/adm_encConfig.cpp:907
+msgid "Fatal error"
+msgstr "S'ha produ?t un error fatal."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:437
+msgid "Input"
+msgstr "L'entrada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:438
+msgid "Output"
+msgstr "La sortida"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:439
+msgid "Side"
+msgstr "Una al costat de..."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:440
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:109
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:87
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:81
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:90
+msgid "Top"
+msgstr "Una al damunt de..."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:441
+msgid "Separate"
+msgstr "Separades"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:615
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:499
 #, c-format
-msgid "Attempt to open %s failed!"
-msgstr "Ha fallat l'intent d'obrir %s"
+msgid "Frame:%c(%02d)"
+msgstr "Fotogr.: %c(%02d)"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:421
-msgid ""
-"You cannot mix different video dimensions yet. Using the partial video filter later, will not work around this problem. The workaround is:\n"
-"1.) \"resize\" / \"add border\" / \"crop\" each stream to the same resolution\n"
-"2.) concatinate them together"
-msgstr ""
-"Encara no es poden barrejar diferents mides de v?deo. L'?s posterior del filtre parcial de v?deo no evitar? aquest problema. El remei ?s:\n"
-"1.) \"redimensionar\" / \"afegir vora\" / \"retallar\" cada flux a la mateixa resoluci?\n"
-"2.) concatenar-los"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:272
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:69
+msgid "Avidemux"
+msgstr "Avidemux"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:520
-msgid "Build Time Map"
-msgstr "Construeix mapa temps"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:289
+#: avidemux/main.cpp:199
+msgid "_File"
+msgstr "_Fitxer"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:520
-msgid "Build VBR time map?"
-msgstr "Voleu construir el mapa de temps VBR?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:296
+msgid "_Open..."
+msgstr "_Obre"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:554
-msgid "Use that mode"
-msgstr "Utilitzeu aquell mode"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:307
+msgid "_Append..."
+msgstr "_Afegeix"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:554
-msgid "H264 detected"
-msgstr "Detectat H264"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:318
+msgid "_Save"
+msgstr "_Desa"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:554
-msgid ""
-"If the file is using bframe as reference, it can lead to crash or stutteting.\n"
-"Avidemux can use another mode which is safed but <b>YOU WILL LOOSE FRAME ACCURACY</b>.\n"
-"Do you want to use that mode ?"
-msgstr ""
-"El fet que el fitxer utilitzi fotogrames-B com a refer?ncia pot ocasionar una penjada o b? una tremolor.\n"
-"L'Avidemux pot usar un altre mode m?s segur, per? <b>PERDREU PRECISI? DE FOTOGRAMA</b>.\n"
-"Voleu utilitzar aquell m?tode ?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:329
+msgid "Save _Video..."
+msgstr "Desa _v?deo"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:681
-msgid "Packed Bitstream detected"
-msgstr "S'ha detectat un flux de bits empaquetat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:341
+msgid "Save _BMP Image..."
+msgstr "Desa com a imatge _BMP"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:682
-msgid "Do you want me to unpack it ?"
-msgstr "Voleu que el desempaqueti?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:345
+msgid "Save _JPEG Image..."
+msgstr "Desa com a imatge _JPEG"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:702
-msgid "Could not unpack the video"
-msgstr "No s'ha pogut desempaquetar el v?deo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:349
+msgid "Save _Selection as JPEG Images..."
+msgstr "Desa _selecci? com a imatges JPEG"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:702
-msgid "Using backup decoder - not frame accurate."
-msgstr "S'est? usant 'backup decoder' - no ?s acurat pel que fa als fotogrames"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:362
+msgid "Save _Project"
+msgstr "Desa p_rojecte"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:707
-msgid "Weird"
-msgstr "?s estrany"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:370
+msgid "Save P_roject As..."
+msgstr "Desa projecte _com"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:707
-msgid "The unpacking succeedeed but the index is still not up to date."
-msgstr "El desempaquetat ha anat b? per? l'?ndex encara no est? actualitzat."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:378
+msgid "_Load/Run Project..."
+msgstr "_Carrega / Executa projecte"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:713
-msgid "Troubles ahead"
-msgstr "Hi ha problemes a la vista"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:386
+msgid "A_dd to Joblist..."
+msgstr "Afegeix a _tasques"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:713
-msgid "This a VOP packed AVI."
-msgstr "?s un AVI empaquetat com a VOP."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:390
+msgid "Show _Joblist"
+msgstr "_Mostra tasques"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:724
-msgid "Index is not up to date"
-msgstr "L'?ndex no est? actualitzat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:402
+msgid "Co_nnect to avsproxy"
+msgstr "Con_necta a l'avsproxy"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:724
-msgid "You should use Tool->Rebuild frame. Do it now ?"
-msgstr "Heu d'usar 'Eines->Reconstr. fotogr.'. Ho voleu fer ara ?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:411
+msgid "Proper_ties"
+msgstr "_Propietats"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:1479
-msgid ""
-"This looks like mpeg\n"
-" Do you want to index it?"
-msgstr ""
-"Sembla que sigui del tipus MPEG\n"
-" Voleu indexar-lo?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:422
+msgid "AVI _Muxer Options"
+msgstr "Opcions multiplexor A_VI"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:1531
-msgid "Indexing failed"
-msgstr "Ha fallat la indexaci?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:431
+msgid "_Quit"
+msgstr "_Surt"
 
-#: avidemux/ADM_editor/ADM_edLoadSave.cpp:75
-msgid "Unsupported"
-msgstr "No est? suportat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:442
+msgid "_Edit"
+msgstr "_Edita"
 
-#: avidemux/ADM_editor/ADM_edLoadSave.cpp:301
-msgid "Old format project file"
-msgstr "Format de projecte antic"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:449
+msgid "_Reset Edits"
+msgstr "_Reinicia edici?"
 
-#: avidemux/ADM_editor/ADM_edLoadSave.cpp:301
-msgid "No more supported."
-msgstr "Ja no est? suportat/da."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:462
+msgid "Cu_t"
+msgstr "_Talla"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:38
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:501
-msgid "AVI"
-msgstr "AVI"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:473
+msgid "_Copy"
+msgstr "_Copia"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:39
-msgid "AVI, unp. VOP"
-msgstr "AVI, VOP desem."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:484
+msgid "_Paste"
+msgstr "_Enganxa"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:40
-msgid "AVI, pack VOP"
-msgstr "AVI, VOP empaq."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:495
+msgid "_Delete"
+msgstr "Es_borra"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:41
-msgid "AVI, dual audio"
-msgstr "AVI, ?udio dual"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:511
+msgid "Set Marker _A"
+msgstr "Posa marcador _A"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:42
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:505
-msgid "OGM"
-msgstr "OGM"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:518
+msgid "Set Marker _B"
+msgstr "Posa marcador _B"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:43
-msgid "MPEG Video"
-msgstr "MPEG v?deo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:530
+msgid "Pre_ferences"
+msgstr "_Prefer?ncies"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:44
-msgid "MPEG-PS (A+V)"
-msgstr "MPEG-PS (A+V)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:538
+msgid "_View"
+msgstr "Visua_litza"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:45
-msgid "MPEG-TS (A+V)"
-msgstr "MPEG-TS (A+V)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:545
+msgid "_Main Toolbar"
+msgstr "_Barra principal"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:46
-msgid "MP4"
-msgstr "MP4"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:550
+msgid "_A/V Sidebar"
+msgstr "Barra _lateral d'A/V"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:47
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:756
-msgid "PSP"
-msgstr "PSP"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:560
+msgid "_Zoom 1:4"
+msgstr "_Zoom 1:4"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:192
-msgid "Wrong output format"
-msgstr "El format de sortida ?s erroni"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:567
+msgid "Z_oom 1:2"
+msgstr "Z_oom 1:2"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:192
-msgid "Select MPEG as the output."
-msgstr "Seleccioneu MPEG com a sortida."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:574
+msgid "Zoom _1:1"
+msgstr "Zoom _1:1"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:197
-msgid "Wrong video codec"
-msgstr "El c?dec de v?deo ?s erroni"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:581
+msgid "Zoom _2:1"
+msgstr "Zoom _2:1"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:198
-msgid "Select DVD as the video codec for MPEG TS output."
-msgstr "Seleccioneu DVD com a c?dec de v?deo per a la sortida de MPEG TS."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:588
+msgid "Zoom _4:1"
+msgstr "Zoom _4:1"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:715
-msgid "Only QCIF and subQCIF are allowed for H.263"
-msgstr "Nom?s es permet QCIF i subQCIF per a H.263"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:595
+msgid "Vi_deo"
+msgstr "_V?deo"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:907
-msgid "Fatal error"
-msgstr "S'ha produ?t un error fatal"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:602
+msgid "_Decoder Options"
+msgstr "_Opcions descodificador"
 
-#: avidemux/ADM_encoder/adm_encffmpeg.cpp:261
-msgid "Incompatible settings"
-msgstr "La configuraci? ?s incompatible"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:609
+msgid "_Postprocessing"
+msgstr "_Postprocessament"
 
-#: avidemux/ADM_encoder/adm_encffmpeg.cpp:261
-msgid "At the moment, the DV codec only accepts 720*576 at 25"
-msgstr "Per ara, el c?dec DV nom?s accepta 720*576 at 25"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:612
+msgid "Select postprocessing level"
+msgstr "Seleccioneu el nivell de postprocessament."
 
-#: avidemux/ADM_filter/filter_saveload.cpp:156
-msgid "Problem reading XML filters"
-msgstr "Hi ha hagut un problema en llegir filtres d'XML"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:622
+msgid "P_review"
+msgstr "P_revisualitzaci?"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:164
-msgid "No filter found"
-msgstr "No s'ha trobat cap filtre"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:629
+msgid "Display _Output"
+msgstr "_Mostra sortida"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:200
-msgid "Could not find a filter"
-msgstr "No s'ha pogut trobar un filtre"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:641
+msgid "_Frame Rate"
+msgstr "_Velocitat d'imatge"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:208
-msgid "No tag found"
-msgstr "No s'ha trobat l'etiqueta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:645
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:694
+msgid "_Encoder"
+msgstr "_Codificador"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:288
-msgid "Node not found"
-msgstr "No s'ha trobat el node"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:652
+msgid "Fil_ters"
+msgstr "_Filtres"
 
-#: avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp:484
-msgid "Expect troubles"
-msgstr "Heu d'esperar problemes"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:659
+msgid "_Audio"
+msgstr "_?udio"
 
-#: avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp:971
-msgid "Problem reading SVQ3 headers"
-msgstr "Hi ha hagut un problema en la lectura d'encap?alements de SVQ3"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:666
+msgid "_Main Track"
+msgstr "_Pista principal"
 
-#: avidemux/ADM_inputs/ADM_3gp/ADM_3gp.cpp:1527
-msgid "No stts table"
-msgstr "No hi ha taula stts"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:670
+msgid "_Second Track"
+msgstr "_Segona pista"
 
-#: avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp:257
-msgid "Size is not (s)QCIF"
-msgstr "La mida no ?s (s)QCIF"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:674
+msgid "_Build VBR Time Map"
+msgstr "Construeix _mapa temps VBR"
 
-#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp:148
-msgid "There is several mpeg file, append them ?"
-msgstr "Hi ha diversos fitxers de MPEG. Els voleu afegir?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:683
+msgid "S_ave..."
+msgstr "_Desa"
 
-#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp:245
-msgid "Can't determine aspect ratio"
-msgstr "No es pot determinar la relaci? d'aspecte"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:701
+msgid "_Filters"
+msgstr "_Filtres"
 
-#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp:363
-msgid "Out of memory"
-msgstr "S'ha ultrapassat l'?rea de mem?ria"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:705
+msgid "_Tools"
+msgstr "E_ines"
 
-#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp:547
-msgid "MPEG renumbering error"
-msgstr "Error en la renumeraci? de MPEG"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:712
+msgid "_Calculator"
+msgstr "_Calculadora"
 
-#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:560
-msgid "Sure you want to abort ?"
-msgstr "Esteu segur que voleu cancel?lar?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:728
+msgid "_Rebuild Frames (I & B)"
+msgstr "_Reconstrueix fotogrames (I & B)"
 
-#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:771
-msgid "Size mismatch"
-msgstr "La mida no correspon"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:732
+msgid "C_heck Frames (slow)"
+msgstr "C_omprova fotogrames (lent)"
 
-#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:771
-msgid "Expect a crash."
-msgstr "S'espera una penjada."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:736
+msgid "_Bitrate Histogram"
+msgstr "_Histograma taxa de bits"
 
-#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:1063
-msgid "Do you want to save an index ?"
-msgstr "Voleu desar un ?ndex?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:740
+msgid "_Scan for Black Frames..."
+msgstr "Cerca fotogrames _negres"
 
-#: avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp:355
-msgid "Take second track ?"
-msgstr "Voleu agafar una segona pista?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:749
+msgid "_VOB -> VobSub"
+msgstr "_VOB -> VobSub"
 
-#: avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp:435
-msgid "Scanning OGM"
-msgstr "S'est? escanejant l'OGM"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:753
+msgid "_OCR (VobSub -> srt)"
+msgstr "_OCR (VobSub -> srt)"
 
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:285
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:370
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:505
-msgid "Malformed header"
-msgstr "L'encap?alament ?s malformat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:757
+msgid "_Edit Glyph"
+msgstr "_Edita glif"
 
-#: avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp:308
-msgid "Incompatible frame rate"
-msgstr "La velocitat d'imatge ?s incompatible"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:766
+msgid "_Frame Hex Dump"
+msgstr "_Bolcat hexadecimal fotograma"
 
-#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:209
-msgid "Incompatible audio"
-msgstr "El format d'?udio ?s incompatible"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:770
+msgid "A_uto"
+msgstr "Au_to"
 
-#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
-msgid "For DVD, audio must be MP2 or AC3."
-msgstr "Per a DVD l'?udio ha de ser MP2 o b? AC3."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:777
+msgid "_VCD"
+msgstr "_VCD"
 
-#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:92
-msgid "lvemux init failed"
-msgstr "Ha fallat la inicialitzaci? del lvemux"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:781
+msgid "_SVCD"
+msgstr "_SVCD"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:403
-msgid "Memory error"
-msgstr "S'ha produ?t un error de mem?ria"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:785
+msgid "_DVD"
+msgstr "_DVD"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:410
-msgid "Error converting to BMP"
-msgstr "S'ha produ?t un error en la conversi? a BMP"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:789
+msgid "_PSP"
+msgstr "_PSP"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:417
-#: avidemux/gtk_gui.cpp:1925
-msgid "Something bad happened"
-msgstr "Alguna cosa no ha funcionat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:793
+msgid "PSP (_H.264)"
+msgstr "PSP (_H.264)"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:472
-msgid "Cannot encode the frame"
-msgstr "No es pot codificar el fotograma"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:797
+msgid "_Go"
+msgstr "Ve_s"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
-#: avidemux/ADM_ocr/ADM_ocrLoadSave.h:71
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:393
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:252
-#: avidemux/gtk_gui.cpp:880
-#: avidemux/gtk_gui.cpp:1530
-msgid "File error"
-msgstr "S'ha produ?t un error de fitxer"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:804
+msgid "_Play/Stop"
+msgstr "_Reprodueix / Atura"
 
-#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:393
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/gtk_gui.cpp:1530
-#, c-format
-msgid "Cannot open \"%s\" for writing."
-msgstr "No es pot obrir  \"%s\" per a lectura."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:815
+msgid "P_revious Frame"
+msgstr "Fotograma _anterior"
 
-#: avidemux/ADM_ocr/ADM_ocrLoadSave.h:22
-msgid "Select Glyphfile to save to"
-msgstr "Seleccioneu un fitxer de glif per desar"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:826
+msgid "_Next Frame"
+msgstr "Fotograma _seg?ent"
 
-#: avidemux/ADM_ocr/ADM_ocrLoadSave.h:30
-msgid "Could not write the file"
-msgstr "No s'ha pogut escriure el fitxer"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:837
+msgid "Pr_evious Intra Frame"
+msgstr "Fotog. _clau anterior"
 
-#: avidemux/ADM_ocr/ADM_ocrLoadSave.h:62
-msgid "Erase current glyphs ?"
-msgstr "Voleu esborrar el glif actual?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:848
+msgid "Next _Intra Frame"
+msgstr "Fotog. clau s_eg?ent"
 
-#: avidemux/ADM_ocr/ADM_ocrLoadSave.h:71
-#, c-format
-msgid "Could not read \"%s\"."
-msgstr "No es pot llegir \"%s\" ."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:859
+msgid "Previou_s Black Frame"
+msgstr "Fotogr. _negre anterior"
 
-#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:244
-msgid "Ifo error"
-msgstr "S'ha produ?t un error de fitxer IFO"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:863
+msgid "Ne_xt Black Frame"
+msgstr "Fotogr. negre seg_?ent"
 
-#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:244
-msgid "Error reading ifo file, aborting."
-msgstr "S'ha produ?t un error en llegir el fitxer IFO. S'est? cancel?lant."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:867
+msgid "_First Frame"
+msgstr "_Primer fotograma"
 
-#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:252
-msgid "Cannot write .idx"
-msgstr "No es pot escriure el fitxer .IDX"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:878
+msgid "_Last Frame"
+msgstr "_Darrer fotograma"
 
-#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:265
-msgid "Cannot write .sub"
-msgstr "No es pot escriure el fitxer .SUB"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:894
+msgid "Go to Marker _A"
+msgstr "Ves al marcador _A"
 
-#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:277
-msgid "Problem opening the mpeg files"
-msgstr "S'ha produ?t un problema en obrir els fitxers de mpeg"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:901
+msgid "Go to Marker _B"
+msgstr "Ves al marcador _B"
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:102
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:126
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:146
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:153
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:164
-#: avidemux/GUI_jobs.cpp:37
-msgid "Oops"
-msgstr "Oops"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:913
+msgid "Go to Fra_me..."
+msgstr "Salta al _fotograma..."
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:102
-#, c-format
-msgid "can't create custom directory (%s)."
-msgstr "No es pot crear el directori personal (%s)."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:924
+msgid "Go to _Time..."
+msgstr "Salta al _temps..."
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:126
-#, c-format
-msgid "can't create job directory (%s)."
-msgstr "No es pot crear el directori de treball (%s)."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:935
+msgid "_Custom"
+msgstr "_Personal."
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:146
-msgid "can't determine $USERPROFILE."
-msgstr "No es pot determinar $USERPROFILE."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:939
+msgid "_Help"
+msgstr "Aj_uda"
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:153
-msgid "can't determine $HOME."
-msgstr "No es pot determinar $HOME."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:946
+msgid "_Built-in Support"
+msgstr "_Mostra suport incorporat"
 
-#: avidemux/ADM_osSupport/ADM_fileio.cpp:164
-msgid "Cannot create the .avidemux directory"
-msgstr "No es pot crear el directori .avidemux"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:950
+msgid "_About"
+msgstr "_Pel que fa a l'Avidemux"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:74
-msgid "Normal"
-msgstr "Normal"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:968
+msgid "Open a file"
+msgstr "Obre un fitxer"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:75
-msgid "Mux every N video frames"
-msgstr "Mult. cada N fotogrames"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:978
+msgid "Save the file"
+msgstr "Desa el fitxer"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:76
-msgid "Mux by packet size"
-msgstr "Mult. per mida paquet"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:984
+msgid "Audio/video file information"
+msgstr "Informaci? sobre el fitxer d'?udio o v?deo."
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:79
-msgid "Muxing Type"
-msgstr "Tipus multiplexi? "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:992
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:401
+msgid "Calculator"
+msgstr "Calculadora"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:80
-msgid "Split every MBytes"
-msgstr "Divid. cada MBytes"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:995
+msgid "Bitrate/size calculator"
+msgstr "Calculadora de la taxa de bits o de la mida."
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:82
-msgid "Mux Every x video frames"
-msgstr "Mult. cada x fotogrames"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1056
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:318
+msgid "<b>Video</b>"
+msgstr "<b>V?deo</b>"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:83
-msgid "Mux with block of size"
-msgstr "Mult. per mida bloc"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1074
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1114
+msgid "Copy"
+msgstr "Copiat"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:90
-msgid "Avi Muxer Option"
-msgstr "Opcions 'muxer' AVI"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1076
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1116
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:118
+msgid "Configure"
+msgstr "Configura"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:188
-msgid "Error initalizing audio filters"
-msgstr "S'ha produ?t un error en inicialitzar els filtres d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1079
+msgid "Configure video encoder"
+msgstr "Configura el codificador de v?deo."
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:197
-msgid "Error initalizing video filters"
-msgstr "S'ha produ?t un error en inicialitzar els filtres de v?deo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1084
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1140
+msgid "Filters"
+msgstr "Filtres"
 
-#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:446
-#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy.cpp:96
-#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp:121
-#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy_unpack.cpp:98
-msgid "Cannot initiate save"
-msgstr "No es pot iniciar el desament"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1087
+msgid "Video filters"
+msgstr "Filtres de v?deo."
 
-#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:73
-msgid ""
-"Width is not a multiple of 8\n"
-" continue anyway ?"
-msgstr ""
-"L'amplada no ?s un m?ltiple de 8.\n"
-"Voleu continuar de totes formes?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1096
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:496
+msgid "<b>Audio</b>"
+msgstr "<b>?udio</b>"
 
-#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:93
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:170
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:76
-msgid "Filter init failed"
-msgstr "Ha fallat la inicialitzaci? del filtre"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1119
+msgid "Configure audio encoder"
+msgstr "Configura el codificador d'?udio."
 
-#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:127
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:395
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:100
-msgid ""
-"\n"
-" Reuse the existing log-file ?"
-msgstr ""
-"\n"
-"Voleu reutilitzar el fitxer de bit?cola existent?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1127
+msgid "Audio filters"
+msgstr "Filtres d'?udio."
 
-#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:152
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:431
-msgid "Aborting"
-msgstr "S'est? cancel?lant"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1148
+msgid "Shift:"
+msgstr "Despl.:"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:152
-msgid "Cannot initialize the video stream"
-msgstr "No es pot inicialitzar el flux de v?deo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1151
+msgid "Enable time shift"
+msgstr "Habilita el despla?ament de temps."
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:208
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:331
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:415
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:352
-msgid "Error while encoding"
-msgstr "S'ha produ?t un error en codificar"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1157
+msgid "Audio/video time shift (ms)"
+msgstr "Despla?ament de temps ?udio/v?deo (ms)."
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
-msgid "KeyFrame error"
-msgstr "S'ha produ?t un error en el fotograma clau"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1164
+msgid "<b>Format</b>"
+msgstr "<b>Format</b>"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
-msgid ""
-"The beginning frame is not a key frame.\n"
-"Please move the A marker."
-msgstr ""
-"El fotograma d'inici no ?s un fotograma clau.\n"
-"Canvieu el marcador A."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1197
+msgid "<b>Selection</b>"
+msgstr "<b>Selecci?</b>"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:247
-msgid "Cannot initialize the audio stream"
-msgstr "No es pot inicialitzar el flux d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1214
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1222
+msgid " 0000000"
+msgstr " 0000000"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:89
-msgid "This is not MPEG compatible"
-msgstr "No ?s compatible amb MPEG"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1230
+msgid "A:"
+msgstr "A:"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:89
-msgid "You can't use the Copy codec."
-msgstr "No podeu usar el c?dec 'Copiat'"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1237
+msgid "Go to marker A"
+msgstr "Ves al marcador A"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:94
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:156
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:167
-msgid "There is no audio track"
-msgstr "No hi ha pista d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1239
+msgid "B:"
+msgstr "B:"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:101
-msgid "The first frame is not intra frame"
-msgstr "El primer fotograma no ?s un fotograma-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1246
+msgid "Go to marker B"
+msgstr "Ves al marcador B"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:101
-msgid "Use the &lt;&lt; and the &gt;&gt; buttons to move using Intra frames."
-msgstr "Useu els botons de &lt;&lt; i els de &gt;&gt; per moure usant fotogrames-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1258
+msgid "Play"
+msgstr "Reprodueix"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:113
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:177
-msgid "Audio track is not suitable"
-msgstr "La pista d'?udio no ?st? disponible"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1272
+msgid "Stop"
+msgstr "Atura"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:187
-msgid "For VCD, audio must be 44.1 kHz MP2."
-msgstr "Per a VCD l'?udio ha de ser 44.1 kHz MP2."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1284
+msgid "Previous frame"
+msgstr "Fotogr. anterior"
 
-#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:182
-msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
-msgstr "Per a DVD l'?udio ha de ser 48 kHz MP2(stereo), AC3, DTS o b? LPCM (stereo)."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1299
+msgid "Next frame"
+msgstr "Fotogr. seg?ent"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:209
-msgid "For DVD, audio must be 48 kHz MP2, AC3 or LPCM."
-msgstr "Per a DVD l'?udio ha de ser 48 kHz MP2, AC3 o b? LPCM."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1314
+msgid "Previous keyframe"
+msgstr "Fotog. clau anterior"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:326
-msgid "Reuse log file ?"
-msgstr "Voleu reutilitzar el fitxer de bit?cola?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1329
+msgid "Next keyframe"
+msgstr "Fotog. clau seg?ent"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:341
-msgid "Error in pass 1"
-msgstr "S'ha produ?t un error en el pas 1"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1343
+msgid "Selection: start"
+msgstr "Selecci?: inici"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:491
-msgid "Error in pass 2"
-msgstr "S'ha produ?t un error en el pas 2"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1354
+msgid "Selection: end"
+msgstr "Selecci?: final"
 
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:126
-msgid "Could not initialize video"
-msgstr "No es pot inicialitzar el v?deo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1365
+msgid "Previous black frame"
+msgstr "Fotogr. negre anterior"
 
-#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:134
-msgid "Could not initialize audio"
-msgstr "No es pot inicialitzar l'?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1376
+msgid "Next black frame"
+msgstr "Fotogr. negre seg?ent"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:230
-msgid "Select a directory"
-msgstr "Seleccioneu un directori"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1387
+msgid "First frame"
+msgstr "Primer fotograma"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:496
-msgid "Uinteger"
-msgstr "Uinteger"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1398
+msgid "Last frame"
+msgstr "?ltim fotograma"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:511
-msgid "Float"
-msgstr "Float"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1420
+msgid "Frame: "
+msgstr "Fotogr.: "
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:528
-msgid "Toggle"
-msgstr "Toggle"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1427
+msgid "Current frame"
+msgstr "Fotogr. actual"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:545
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:83
-msgid "No Strategy"
-msgstr "Sense estrat?gia"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1429
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:661
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:668
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:675
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:788
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:89
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:96
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:166
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:206
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:632
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:648
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:664
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:694
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:419
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:433
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:82
+msgid "0"
+msgstr "0"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:546
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:84
-msgid "3:2 Pulldown"
-msgstr "3:2 Pulldown"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1432
+msgid "/ 0000000"
+msgstr "/ 0000000"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:547
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:85
-msgid "Pal/Secam"
-msgstr "Pal/Secam"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1439
+msgid "Time: "
+msgstr "Temps:"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:548
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:86
-msgid "NTSC converted from PAL"
-msgstr "NTSC convertit des de PAL"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1446
+msgid "Current time"
+msgstr "Temps actual"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:550
-msgid "menu"
-msgstr "men?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1447
+msgid "00:00:00.000"
+msgstr "00:00:00.000"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:59
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:128
-msgid "No data"
-msgstr "No hi ha dades"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1450
+msgid "/ 00:00:00,000"
+msgstr "/ 00:00:00,000"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:232
-msgid "Bitrate Histogram"
-msgstr "Histograma taxa bits"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1457
+msgid "Frame: ?"
+msgstr "Fotogr.: ?"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:95
-msgid "Option "
-msgstr "Opci?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:378
+msgid "Mplayer Delogo"
+msgstr "Delogo Mplayer"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:52
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:42
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:380
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:402
-msgid "4:3"
-msgstr "4:3"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:396
+msgid "X"
+msgstr "X"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:53
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:43
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:384
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:406
-msgid "16:9"
-msgstr "16:9"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:403
+msgid "Y"
+msgstr "Y"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:55
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:45
-msgid "Default"
-msgstr "Predeterminat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:410
+msgid "W"
+msgstr "W"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:56
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:46
-msgid "Tmpgenc"
-msgstr "Tmpgenc"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:417
+msgid "H"
+msgstr "H"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:57
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:47
-msgid "Anime"
-msgstr "Anim?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:424
+msgid "Band"
+msgstr "Banda"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:58
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:48
-msgid "KVCD"
-msgstr "KVCD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:273
+msgid "Crop Settings"
+msgstr "Configs. tall"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:61
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:51
-msgid "Progressive"
-msgstr "Progressiu"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:307
+msgid "AutoCrop"
+msgstr "Tall autom."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:62
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:52
-msgid "Int. TFF"
-msgstr "TFF entrella?."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:329
+msgid "Reset"
+msgstr "Reinicia"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:63
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:53
-msgid "Int. BFF"
-msgstr "BFF entrella?."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:338
+msgid "Crop Left :"
+msgstr "Tall Esq.:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:74
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:60
-msgid "Max Bitrate"
-msgstr "Taxa bits m?x."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:346
+msgid "Crop Top:"
+msgstr "Tall Amunt:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:75
-msgid "Min Bitrate"
-msgstr "Taxa bits m?x."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:354
+msgid "Crop Right:"
+msgstr "Tall Dreta:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:76
-msgid "Use Xvid Rate Control"
-msgstr "Usa control de ritme d'Xvid"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:362
+msgid "Crop Bottom:"
+msgstr "Tall Avall:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:78
-msgid "Buffer Size"
-msgstr "Mida buffer"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:90
+msgid "Filesystem full / quota exceeded"
+msgstr "El sistema de fitxers ?s ple / s'ha superat la quota."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:80
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:57
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:299
-msgid "Aspect Ratio"
-msgstr "Rel. aspecte "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:133
+msgid "Ignore"
+msgstr "Ignora"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:81
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:73
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:58
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:265
-msgid "Matrices"
-msgstr "Matrius"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:155
+msgid "Retry"
+msgstr "Reintenta"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:82
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:59
-msgid "Gop Size"
-msgstr "Mida GOP"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:155
+msgid "ColorYuv (From avisynth)"
+msgstr "ColorYuv (d'avisynth)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:88
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:66
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:123
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:285
-msgid "Interlacing"
-msgstr "Entrella?at"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:179
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:210
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:228
+msgid "Contrast"
+msgstr "Contrast"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:27
-msgid "Hour"
-msgstr "Hora"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:237
+msgid "Brightness"
+msgstr "Lluminositat"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:28
-msgid "Minutes"
-msgstr "Minuts"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:193
+msgid "Gamma"
+msgstr "Gamma"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:29
-msgid "Seconds"
-msgstr "Segons"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:200
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:97
+msgid "Gain"
+msgstr "Guany"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:51
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:257
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:290
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:207
+msgid "Luma Y"
+msgstr "Luma Y"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:214
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:255
+msgid "Chroma U"
+msgstr "Croma U"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:221
+msgid "Chroma V"
+msgstr "Croma V"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:324
+msgid "<b>Color Correction Matrix</b>"
+msgstr "<b>Matriu correcci? color</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:347
+msgid "Matrix"
+msgstr "Matriu"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:354
+msgid "Opt"
+msgstr "Opt"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:361
+msgid "Level"
+msgstr "Nivell"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:373
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:381
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:389
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:420
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:518
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:526
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:612
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:553
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:568
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:583
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp:219
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1095
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1124
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:80
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:89
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:51
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:57
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:105
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:264
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:101
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:264
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:2011
+#: avidemux/gtk_gui.cpp:2110
 msgid "None"
 msgstr "Cap"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:52
-msgid "Full"
-msgstr "Full"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:374
+msgid "Rec.709"
+msgstr "Rec.709"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:53
-msgid "Log"
-msgstr "Log"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:382
+msgid "Coring"
+msgstr "Coring"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:54
-msgid "Phods"
-msgstr "Phods"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:390
+msgid "TV->PC"
+msgstr "TV->PC"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:55
-msgid "EPZS"
-msgstr "EPZS"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:391
+msgid "PC->TV"
+msgstr "PC->TV"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:56
-msgid "X1"
-msgstr "X1"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:392
+msgid "PC->TV.Y"
+msgstr "PC->TV.Y"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:60
-msgid "H263"
-msgstr "H263"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:398
+msgid ""
+"<b>Matrix Warning :</b>\n"
+"all above values are normalized to 256!"
+msgstr ""
+"<b>Av?s sobre la matriu:</b>\n"
+"tots els valors m?s alts es normalitzaran a 256"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:61
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:509
-msgid "MPEG"
-msgstr "MPEG"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:404
+msgid "AutoGain"
+msgstr "Guany autom. "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:65
-msgid "MB Comparison"
-msgstr "Comparaci? MB"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:408
+msgid "Display Stats"
+msgstr "Mostra estad. "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:66
-msgid "Fewest bits (vhq)"
-msgstr "Bits m?nims (vhq)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:412
+msgid "AutoWhite"
+msgstr "Blanc autom. "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:67
-msgid "Rate distortion"
-msgstr "Distorsi? ritme"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:416
+msgid "<b>frame2</b>"
+msgstr "<b>Fotog. 2</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:74
-msgid "Min Qz"
-msgstr "Quant. m?n."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:192
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:334
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:150
+msgid "Preview"
+msgstr "Previsualitza"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:75
-msgid "Max Qz"
-msgstr "Quant. m?x."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:161
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:183
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp:53
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp:71
+msgid "Privileges Required"
+msgstr "Calen privilegis"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:76
-msgid "Max QDiff"
-msgstr "QDiff m?x."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:161
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:183
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp:53
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp:71
+msgid "Root privileges are required to perform this operation."
+msgstr "Calen privilegis de root per realitzar aquesta operaci?."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:78
-msgid "4MV"
-msgstr "4MV"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:204
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp:177
+msgid "Shutting down"
+msgstr "En proc?s d'apagada"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:79
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:855
-msgid "Trellis"
-msgstr "Trellis"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:381
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:150
+#, c-format
+msgid "%d%%"
+msgstr "%d%%"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:81
-msgid "Quarter Pel"
-msgstr "Quart p?xel  "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:404
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:411
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:418
+#, c-format
+msgid "%lu MB"
+msgstr "%lu MB"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:82
-msgid "GMC"
-msgstr "GMC"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:514
+msgid "Encoding..."
+msgstr "S'est? codificant..."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:85
-msgid "Number of BFrames"
-msgstr "Nombre fotogr-B "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:545
+msgid "<b>Phase:</b>"
+msgstr "<b>Fase: </b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:86
-msgid "Quantization type"
-msgstr "Tipus quantificaci? "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:560
+msgid "<b>Video Codec:</b>"
+msgstr "<b>C?dec de v?deo:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:88
-msgid "Macroblock decision"
-msgstr "Decisi? macrobloc "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:575
+msgid "<b>Audio Codec:</b>"
+msgstr "<b>C?dec d'?udio:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:90
-msgid "Filesize tolerance (kb"
-msgstr "Toler?n. mida fitxer (kb) "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:590
+msgid "<b>Container:</b>"
+msgstr "<b>Contenidor:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:92
-msgid "Quantize compression"
-msgstr "Quantif. compressi?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:598
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:795
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:331
+msgid "Unknown"
+msgstr "Desconegut"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:93
-msgid "Quantize blur"
-msgstr "Quantif. desenfoc."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:622
+msgid "<b>Processed Frames:</b>"
+msgstr "<b>Fotogrames processats: </b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:98
-msgid "User Interface"
-msgstr "Interf?cie usuari"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:630
+msgid "<b>Total Frames:</b>"
+msgstr "<b>Total fotogrames: </b>"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:638
+msgid "<b>Quantiser:</b>"
+msgstr "<b>Quantificador: </b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:646
+msgid "<b>Average Bitrate:</b>"
+msgstr "<b>Taxa bits mitjana: </b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:654
+msgid "0 kB/s"
+msgstr "0 kB/s"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:699
+msgid "<b>Video Size:</b>"
+msgstr "<b>Mida v?deo:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:707
+msgid "<b>Audio Size:</b>"
+msgstr "<b>Mida ?udio:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:715
+msgid "<b>Total Size:</b>"
+msgstr "<b>Mida total:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:723
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:731
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:739
+msgid "0 MB"
+msgstr "0 MB"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:764
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:244
+msgid "<b>Elapsed:</b>"
+msgstr "<b>Transcorregut:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:772
+msgid "<b>Time Remaining:</b>"
+msgstr "<b>Temps restant: </b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:780
+msgid "<b>Frames/sec:</b>"
+msgstr "<b>Fotogr./s: </b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:802
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:198
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:447
+msgid "00:00:00"
+msgstr "00:00:00"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:826
+msgid "Shut down computer when finished"
+msgstr "Apaga l'ordinador en acabar"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:834
+msgid "Priority:"
+msgstr "Prioritat: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:843
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:105
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:61
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:108
+msgid "High"
+msgstr "Alta"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:844
+msgid "Above Normal"
+msgstr "Per sobre del normal"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:845
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:188
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:74
+msgid "Normal"
+msgstr "Normal"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:846
+msgid "Below Normal"
+msgstr "Per sota del normal"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:847
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:190
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:104
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:59
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:107
+msgid "Low"
+msgstr "Baixa"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:884
+msgid "Pause / Abort"
+msgstr "Atura / Cancel?la"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:76
+msgid "Hue"
+msgstr "Mat?s"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:186
+msgid "Hue/Saturation"
+msgstr "Mat?s/Saturaci?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:200
+msgid "<b>Hue:</b>"
+msgstr "<b>Mat?s:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:208
+msgid "<b>Saturation:</b>"
+msgstr "<b>Saturaci?:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
+msgid "Ready"
+msgstr "Preparat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
+msgid "Succeeded"
+msgstr "Ha tingut ?xit"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
+#: avidemux/gtk_gui.cpp:2288
+msgid "Failed"
+msgstr "Ha fallat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
+msgid "Deleted"
+msgstr "S'ha esborrat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
+msgid "Running"
+msgstr "Processant"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:98
+msgid "  Job Name  "
+msgstr "Nom de la tasca"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:103
+msgid "Started at"
+msgstr "Comen?at a"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:107
+msgid "Finished at"
+msgstr "Acabat a"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:183
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:196
+msgid "Sure!"
+msgstr "?s clar!"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
+msgid "Delete ALL jobs"
+msgstr "Esborra TOTES les tasques"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
+msgid "Are you sure you want to delete all jobs ?"
+msgstr "Esteu segur que voleu esborrar totes les tasques?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:183
+msgid "Delete job"
+msgstr "Esborra tasca"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:183
+#, c-format
+msgid "Are you sure you want to delete %s job ?"
+msgstr "Esteu segur que voleu esborrar la tasca %s ?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:181
+msgid "Unknown event"
+msgstr "Esdeveniment desconegut"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:261
+msgid "Jobs"
+msgstr "Tasques"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:287
+msgid "Delete All Jobs"
+msgstr "Esborra totes les tasques"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:292
+msgid "Delete Job"
+msgstr "Esborra tasca"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:297
+msgid "Run all jobs"
+msgstr "Executa totes les tasques"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:302
+msgid "Run Job"
+msgstr "Executa tasca"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:74
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:68
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:73
+msgid "ASHARP"
+msgstr "ASHARP"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:251
+msgid "Luma"
+msgstr "Luma"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:259
+msgid "Chroma v"
+msgstr "Croma v"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:109
+msgid "Select Xvid matrix file to load"
+msgstr "Seleccioneu la matriu d'Xvid per carregar."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:121
+msgid "Error Loading"
+msgstr "S'ha produ?t un error en la c?rrega."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:121
+msgid "Error loadind the custom matrix file."
+msgstr "S'ha produ?t un error en carregar el fitxer de la matriu personalitzada."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:139
+msgid "Matrix Loaded"
+msgstr "S'ha carregat la matriu."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:139
+msgid "The custom matrix file has been successfully loaded."
+msgstr "El fitxer de matriu personalitzada s'ha carregat satisfact?riament."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:179
+msgid "Size (MBytes):"
+msgstr "Mida (MBytes): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:185
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:369
+msgid "Average bitrate (kb/s):"
+msgstr "Taxa bits mitjana (kb/s): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:354
+msgid "Target bitrate (kb/s):"
+msgstr "Taxa bits sortida (kbps): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:362
+msgid "Target size (MBytes):"
+msgstr "Mida sortida (MBytes): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:479
+msgid "Select Custom Matrix File to write"
+msgstr "Seleccioneu el fitxer de matriu personalitzada per escriure."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:484
+msgid "Error Writing"
+msgstr "S'ha produ?t un error d'escriptura."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:484
+msgid "Error writing the custom matrix file."
+msgstr "S'ha produ?t un error en escriure el fitxer de matriu personalitzada."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:700
+msgid "XviD encoding options"
+msgstr "Opcions de codificaci? de l'XviD"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:734
+msgid "Encoding type:"
+msgstr "Tipus de codificaci?: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:739
+msgid "Bitrate (kb/s):"
+msgstr "Taxa de bits (kb/s): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:744
+msgid "Quantizer:"
+msgstr "Quantificador: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:756
+msgid "Select 1-pass or 2-pass encoding"
+msgstr "Seleccioneu codificaci? en 1 o en 2 passades"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:760
+msgid "Single pass - bitrate"
+msgstr "Passada ?nica - taxa de bits"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:764
+msgid "Single pass - quantizer"
+msgstr "Passada ?nica - quantificador"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:768
+msgid "Two pass, final size"
+msgstr "2 Passades - mida final"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:772
+msgid "Two pass, average bitrate"
+msgstr "2 Passades - taxa de bits mitjana"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:776
+msgid "Same Qz as input"
+msgstr "Mateix quantificador que l'entrada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:785
+msgid "Target video bitrate"
+msgstr "Taxa bits v?deo sortida"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:792
+msgid "Constant quantizer - each frame will get the same compression"
+msgstr "Quantificador constant - cada fotograma se sotmetr? a la mateixa compressi?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:794
+msgid "Variable bitrate mode"
+msgstr "Mode taxa de bits variable"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:806
+msgid "_Interlaced"
+msgstr "Entrella?at"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:809
+msgid "Enables interlaced frame support - use only if your source contains interlacing artifacts (i.e. fields instead of progressive frames)"
+msgstr "Habilita el suport de fotograma entrella?at. Utilitzeu-lo nom?s si la font cont? entrella?aments (com per ex.,  marcs en comptes de fotogrames progressius)."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:811
+msgid "_Greyscale"
+msgstr "Escala de grisos"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:814
+msgid "Encode in black & white"
+msgstr "Codifica en blanc i negre"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:820
+msgid "Ca_rtoon mode"
+msgstr "Mode dibuixos animats "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:823
+msgid "Enables special motion estimation features for cartoons/anime"
+msgstr "Habilita les caracter?stiques especials d'estimaci? de moviment per a caricatures/animacions."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:825
+msgid "C_hroma optimizer"
+msgstr "Optimitzador de croma"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:828
+msgid "Enables a chroma optimizer prefilter"
+msgstr "Habilita un prefiltre optimitzador croma"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:834
+msgid "Turbo Mode"
+msgstr "Mode turbo"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:837
+msgid "Enables fast 1st pass encoding"
+msgstr "Habilita la codificaci? r?pida en la primera passada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:839
+msgid "Packed bitstream"
+msgstr "Flux bits empaquetat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:842
+msgid "Enables Divx like packed vop, DO NOT SET, it is ugly"
+msgstr "Habilita el vop empaquetat com a Divx. No seleccioneu aquesta opci?: queda lleig."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:844
+msgid "Main"
+msgstr "Principals"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:863
+msgid "Motion search precision:"
+msgstr "Precisi? de cerca de moviment:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:867
+msgid "VHQ mode:"
+msgstr "Mode VHQ:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:880
+msgid "Higher settings give higher quality results, at the cost of slower encoding"
+msgstr "Uns valors m?s elevats donen millor qualitat, per? a canvi d'una descodificaci? m?s lenta."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:884
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:357
+msgid "0 - None"
+msgstr "0 - Cap"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:888
+msgid "1 - Very low"
+msgstr "1 - Molt baixa"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:892
+msgid "2 - Low"
+msgstr "2 - Baixa"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:896
+msgid "3 - Medium"
+msgstr "3 - Mitjana"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:900
+msgid "4 - High"
+msgstr "4 - Alta"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:904
+msgid "5 - Very high"
+msgstr "5 - Molt alta"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:908
+msgid "6 - Ultra high"
+msgstr "6 - Ultra alta"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:917
+msgid "VHQ enables an additional search process to increase quality"
+msgstr "El VHQ habilita un proc?s de cerca addicional per augmentar la qualitat."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:921
+msgid "0 - Off"
+msgstr "0 - Deshabilitat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:925
+msgid "1 - Mode decision"
+msgstr "1 - Mode decisi?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:929
+msgid "2 - Limited search"
+msgstr "2 - Cerca limitada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:933
+msgid "3 - Medium search"
+msgstr "3 - Cerca mitjana"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:937
+msgid "4 - Wide search"
+msgstr "4 - Cerca ?mplia"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:947
+msgid "C_hroma motion"
+msgstr "Moviment c_roma"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:950
+msgid "Use chroma information to estimate motion"
+msgstr "Usa la informaci? de croma per estimar el moviment"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:952
+msgid "_4MV"
+msgstr "x _MV"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:955
+msgid "Use 4 motion vectors per macroblock, might give better compression"
+msgstr "Usa vectors de moviment per macrobloc, pot ser que doni millor compressi?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:957
+msgid "HQ _AC"
+msgstr "HQ _AC"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:960
+msgid "Enable a better prediction of AC component. Turns on Lumi masking - applies more compression to dark/light areas that the eye cannot notice easily"
+msgstr "Permet una predicci? m?s acurada dels components AC. Activa la m?scara Lumi - aplica m?s compressi? als sectors clarobscurs que l'ull no pot apreciar f?cilment."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:966
+msgid "I-frame interval - Min:"
+msgstr "Interval Fotog-I - m?n:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:974
+msgid "Minimum space between I-frames, 1 will disable forced I-frame spacing"
+msgstr "M?nim espai entre fotogrames-I. El valor 1 deshabilitar? l'espaiat for?at de fotograma-I."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:976
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1194
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1199
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1204
+msgid "Max:"
+msgstr "m?x.:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:984
+msgid "Maximum number of frames allowed between I-frames"
+msgstr "M?xim nombre de fotogrames perm?s entre fotogrames-I."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:999
+msgid "Number of B-frames:"
+msgstr "Nombre de fotog-B:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1007
+msgid "Maximum number of sequential B-frames (when set to 0, the original I/P encoder is used)"
+msgstr "M?xim nombre de fotogrames-B seq?encials. Quan es fixa a 0, s'utilitza el codificador original d'I/P."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1013
+msgid "_Qpel"
+msgstr "_Qpel"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1016
+msgid "Use Quarter pixel resolution for a more precise motion estimation"
+msgstr "Usa la resoluci? de quart de p?xel per a una estimaci? del moviment m?s precisa."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1018
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:82
+msgid "_GMC"
+msgstr "_GMC (compensaci? global de moviment)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1021
+msgid "Global Motion Compensation can save bits on camera pans, zooming and rotation"
+msgstr "La Compensaci? Global de Moviment pot estalviar bits en panor?miques de c?mera, zooming i rotaci?."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1023
+msgid "_BVHQ"
+msgstr "_BVHQ"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1026
+msgid "Produces nicer-looking B-frames"
+msgstr "Produeix fotogrames-B m?s vistosos."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1028
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:101
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1028
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:80
 msgid "Advanced Simple Profile"
 msgstr "Perfil simple avan?at"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:108
-msgid "Motion Estimation"
-msgstr "Estimac. moviment"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1040
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:827
+msgid "As input"
+msgstr "Com a l'entrada"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1043
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:832
+msgid "Get PAR from input video file"
+msgstr "Obt? lal PAR (relaci? d'aspecte de p?xel) a partir d'un fitxer d'entrada de v?deo."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1049
+msgid "Pixel Width"
+msgstr "Amplada p?xel"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1051
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:796
+msgid ":"
+msgstr ":"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1060
+msgid "Pixel Height"
+msgstr "Al??ria p?xel"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1061
+msgid "Pixel Aspect Ratio"
+msgstr "Relaci? aspecte p?xel"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1066
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:965
+msgid "Motion & Misc"
+msgstr "Moviment i altres"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1079
+msgid "Quantization type:"
+msgstr "Tipus quantificaci?: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1083
+msgid "_H.263"
+msgstr "_H.263"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1086
+msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
+msgstr "Els quantificadors d'H.263 suavitzen el quadre. S?n ?tils en els sup?sits de les taxes de bit m?s baixes."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1090
+msgid "_MPEG"
+msgstr "_MPEG"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1093
+msgid "MPEG quantizers (slightly slower) produce sharper picture (useful at higher bitrates)"
+msgstr "Quantificadors MPEG: (lleugerament m?s lents) produeixen un quadre m?s n?tid. S?n ?tils quan les taxes de bits s?n m?s altes."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1097
+msgid "_Custom Matrix"
+msgstr "_Matriu personalitzada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1107
+msgid "Load Custom Matrix:  "
+msgstr "Carrega matriu personalitzada: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1128
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1581
+msgid "Open CQM file"
+msgstr "Obre fitxer de CQM"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1136
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1568
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1604
+msgid "Edit Custom Matrix"
+msgstr "Edita matriu personalitzada"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1153
+msgid "I-frame quantizer - Min:"
+msgstr "Quantificador fotog-I - m?n.:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1158
+msgid "P-frame quantizer - Min:"
+msgstr "Quantificador fotog-P - m?n.:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1163
+msgid "B-frame quantizer - Min:"
+msgstr "Quantificador fotog-B - m?n.:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1176
+msgid "Minimum quantizer allowed for I-frames"
+msgstr "Quantificador m?nim perm?s per a fotog-I"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1182
+msgid "Minimum quantizer allowed for P-frames"
+msgstr "Quantificador m?nim perm?s per a fotog-P"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1188
+msgid "Minimum quantizer allowed for B-frames"
+msgstr "Quantificador m?nim perm?s per a fotog-B"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1217
+msgid "Maximum quantizer allowed for I-frames"
+msgstr "Quantificador m?xim perm?s per a fotog-I"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1223
+msgid "Maximum quantizer allowed for P-frames"
+msgstr "Quantificador m?xim perm?s per a fotog-P"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1229
+msgid "Maximum quantizer allowed for B-frames"
+msgstr "Quantificador m?xim perm?s per a fotog-B"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1231
+msgid "Quantizer restrictions"
+msgstr "Restriccions quantificador"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1235
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:79
+msgid "_Trellis quantization"
+msgstr "Quantificaci? de _Trellis"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1238
+msgid "Rate distortion quantization, will find optimal encoding for each block"
+msgstr "Quantificaci? de l'alteraci? de la taxa. Trobar? la codificaci? ?ptima per a cada bloc."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1240
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:309
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:112
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:309
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1240
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:113
 msgid "Quantization"
 msgstr "Quantificaci?"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:117
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1374
-msgid "Rate Control"
-msgstr "Control ritme"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1268
+msgid "I-frame boost (%):"
+msgstr "Millora fotogrames-I (%): "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:120
-msgid "Lavcodec Mpeg4 configuration"
-msgstr "Configuraci? lavcodec mpeg4"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1273
+msgid "I-frames closer than ... frames..."
+msgstr "Es consid. consecutius els fotog-I m?s propers que: "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:40
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:60
-msgid "_Filter strength:"
-msgstr "_For?a filtre:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1278
+msgid "...are reduced by (%):"
+msgstr "... i es reduiran en un (%):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:41
-msgid "Swap U&V"
-msgstr "Intercanvia U&V"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1283
+msgid "Max overflow improvement (%):"
+msgstr "Millora desbordament m?xim (%):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:51
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:72
-msgid "_Horizontal deblocking"
-msgstr "Desbloqueig _horitzontal"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1288
+msgid "Max overflow degradation (%):"
+msgstr "Degradaci? desbordament m?x. (%):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:52
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:73
-msgid "_Vertical deblocking"
-msgstr "Desbloqueig _vertical"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1300
+#, c-format
+msgid "A value of 20 will give 20% more bits to every I-frame"
+msgstr "Un valor de 20 aportar? un 20% m?s de bits a cada fotograma-I."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:53
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:74
-msgid "_Deringing"
-msgstr "Eliminac. oscil?lac. par?sit. (_D)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1306
+msgid "I-frames appearing in the range below this value will be treated as consecutive keyframes"
+msgstr "Els fotogrames-I que apareguin en el rang per sota d'aquest valor es tractaran com a fotogrames clau consecutius."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:149
-msgid "Use systray while encoding"
-msgstr "Usa safata de sistema en codificar"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1311
+msgid "Reduction of bitrate for the first consecutive I-frames. The last I-frame will get treated normally"
+msgstr "Reducci? de la taxa de bits per als primers fotogrames-I consecutius. L'?ltim fotograma-I es tractar? normalment."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:150
-msgid "Accept non standard audio frequency for DVD"
-msgstr "Permet freq. d'?udio no est?nd. per a DVD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1316
+msgid "How much of the overflow the codec can eat into during undersized sections - larger values will bridge the gap faster"
+msgstr "Valor del desbordament que el c?dec pot tractar en les seccions sotadimensionades. Els valors m?s elevats tancaran l'escletxa m?s r?pidament."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:151
-msgid "Use lavcodec mpeg2 decoder"
-msgstr "Usa descodificador lavcodec mpeg2"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1321
+msgid "How much of the overflow the codec can eat into during oversized sections - larger values will bridge the gap faster"
+msgstr "Valor del desbordament que el c?dec pot tractar en les seccions sobredimensionades. Els valors m?s elevats tancaran l'escletxa m?s r?pidament."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:152
-msgid "Create openDML file"
-msgstr "Crea fitxer openDML"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1323
+msgid "Two pass tuning"
+msgstr "Personalitzaci? segona passada"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:153
-msgid "Automatically index mpeg files"
-msgstr "Indexa autom?tic. fitxers mpeg"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1340
+msgid "High bitrate scenes (%):"
+msgstr "Escenes taxa bits alta (%):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:154
-msgid "Automatically swap A and B if A>B"
-msgstr "Intercanvia autom. A i B si A > B"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1345
+msgid "Low bitrate scenes (%):"
+msgstr "Escenes taxa bits baixa (%):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:155
-msgid "Disable NUV audio sync"
-msgstr "Deshab. sincr. ?udio NUV"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1350
+msgid "Overflow control strength (%):"
+msgstr "Poder control desbordament (%): "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:156
-msgid "Load external filters"
-msgstr "Carrega filtres externs"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1362
+msgid "The higher this value, the more bits get taken from frames larger than the average size, and redistributed to others"
+msgstr "Com m?s alt sigui aquest valor, m?s bits es prendran dels fotogrames amb mida superior a la mitjana i es distribuiran cap als altres."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:158
-msgid "Automatically build VBR map"
-msgstr "Constr. autom?tic. mapa VBR"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1367
+msgid "The higher this value, the more bits get assigned to frames below the average frame size"
+msgstr "Com m?s alt sigui aquest valor, m?s bits s'assignaran als fotogrames amb mida inferior a la mitjana."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:159
-msgid "Automatically rebuild index"
-msgstr "Reindexa autom?ticament"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1372
+msgid "0 = default from core (let XviD decide), else overflow payback percent per frame"
+msgstr "El valor 0 (predeterminat) suposa deixar que l'XviD decideixi. Altrament, aquest valor ?s el del percentatge de desbordament per fotograma."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:160
-msgid "Automatically remove packed bitstream"
-msgstr "Treu autom. flux de bits empaquetat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1374
+msgid "Curve compression"
+msgstr "Corba compressi?"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:163
-msgid "Number of threads"
-msgstr "Nombre de threads"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1378
+msgid "Second Pass"
+msgstr "Segona passada"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:164
-msgid "Split mpegs every (MB)"
-msgstr "Divid. mpegs cada (MB)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1591
+msgid "<b>Intra Matrix</b>"
+msgstr "<b>Matriu Intra</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:166
-msgid "Use alternative tag for mp3 in .mp4"
-msgstr "Usa tag alternativa per a mp3 en .mp4"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1609
+msgid "<b>Inter Matrix</b>"
+msgstr "<b>Matriu Inter</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:169
-msgid "Gtk (Slow)"
-msgstr "Gtk (lent)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:95
+msgid "Pipe to"
+msgstr "Canalitza a"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:171
-msgid "Xv (Best)"
-msgstr "Xv (millor)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:104
+msgid "Application path/name (/usr/bin/sox...)"
+msgstr "Cam? ubic. aplicaci? (/usr/bin/sox...)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:174
-msgid "SDL (Good)"
-msgstr "SDL (bo)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:113
+msgid "Full parameter line"
+msgstr "L?nia param. sencera"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:177
-msgid "Video Display"
-msgstr "Visualit. v?deo "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:57
+msgid "Mini OCR"
+msgstr "Mini OCR"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:182
-msgid "No alerts"
-msgstr "No mostris cap av?s"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:75
+msgid "# of Glyphs :"
+msgstr "# Glifos:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:183
-msgid "Display only error alerts"
-msgstr "Mostra nom?s avisos d'error"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:82
+msgid "# of lines"
+msgstr "# L?nies: "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:184
-msgid "Display all alerts"
-msgstr "Mostra tots els avisos"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:103
+msgid "<b>Stats</b>"
+msgstr "<b>Estad?stiques</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:186
-msgid "Message level"
-msgstr "Nivell  missatge"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:125
+msgid "Current Glyph"
+msgstr "Glif actual"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:191
-msgid "PCM"
-msgstr "PCM"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:138
+msgid " Text:"
+msgstr " Text:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
-msgid "Master"
-msgstr "Master"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:145
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:262
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:283
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:268
+msgid " "
+msgstr " "
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
-msgid "Volume control"
-msgstr "Control volum"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:160
+msgid "Calibrate"
+msgstr "Calibra"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
-msgid "No downmixing"
-msgstr "No reduir pistes"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:165
+msgid "Skip all"
+msgstr "Salta-ho tot"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:200
-msgid "Prologic"
-msgstr "Prologic"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:170
+msgid "Skip Glyph"
+msgstr "Salta glif"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:201
-msgid "Prologic II"
-msgstr "Prologic II"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:175
+msgid "Ignore glyph"
+msgstr "Ignora glif"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
-msgid "Local Playback Downmixing"
-msgstr "Reduc. pistes reproduc. local "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:180
+msgid "Ok"
+msgstr "Accepta"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:232
-msgid "Audio output"
-msgstr "Sortida d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:189
+msgid "<b>Bitmap</b>"
+msgstr "<b>Bitmap</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:245
-msgid "Horizontal deblocking"
-msgstr "Desbloqueig horitzont."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:199
+msgid "ChromaShift"
+msgstr "Despla?ament Croma"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:246
-msgid "Vertical deblocking"
-msgstr "Desbloqueig vertical"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:213
+msgid "U Shift :"
+msgstr "Despl. U:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:247
-msgid "Deringing"
-msgstr "Eliminac. oscil?lacions par?sites"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:220
+msgid "V Shift :"
+msgstr "Despl. V:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:248
-msgid "Strength:"
-msgstr "For?a:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:262
+msgid "<b>Preview</b>"
+msgstr "<b>Vista pr?via</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:249
-msgid "Default Postprocessing"
-msgstr "Postprocessam. predet."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:49
+msgid "Select Video to Write"
+msgstr "Seleccioneu el fitxer de v?deo per escriure."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:263
-msgid "Filter directory"
-msgstr "Directori filtre"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:63
+msgid "Invalid filename"
+msgstr "El nom de fitxer no ?s v?lid"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:301
-msgid "Preferences"
-msgstr "Prefer?ncies"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:63
+msgid "Please select or enter a valid filename."
+msgstr "Seleccioneu o introdu?u un nom v?lid de fitxer."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:59
-msgid "Target type"
-msgstr "Tipus destinaci?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:69
+msgid "Invalid jobname"
+msgstr "El nom de la tasca no ?s v?lid"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:60
-msgid "Source aspect ratio"
-msgstr "Relac. aspecte origen"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:69
+msgid "Please select or enter a valid jobname."
+msgstr "Seleccioneu o introdu?u un nom v?lid de tasca."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:61
-msgid "Dest. aspect ratio"
-msgstr "Relac. aspecte dest."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:110
+msgid "Save Job"
+msgstr "Desa la tasca"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:131
+msgid "Select the output file"
+msgstr "Seleccioneu el fitxer de sortida."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:145
+msgid "_Browse..."
+msgstr "_Navega..."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:154
+msgid "Job name displayed in the job list and used as the script filename"
+msgstr "Nom de tasca que es mostra en la llista de tasques i que s'usa tamb? com a nom del fitxer d'script"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:163
+msgid "Filename of the audio/video output"
+msgstr "Nom del fitxer d'?udio o de v?deo de sortida"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:166
+msgid "_Job name:"
+msgstr "Nom de la _tasca: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:173
+msgid "Output _file:"
+msgstr "_Fitxer de sortida:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:142
+msgid "Continue indexing"
+msgstr "Continua indexant"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:142
+msgid "Abort Requested"
+msgstr "Cancel?laci? requerida"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:142
+msgid "Do you want to abort indexing ?"
+msgstr "Voleu cancel?lar la indexaci??"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:153
+msgid "Indexing..."
+msgstr "S'est? indexant..."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:174
+msgid "Time left :"
+msgstr "Temps restant: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:182
+msgid "Timecode :"
+msgstr "Temps reprod.: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:190
+msgid "Nb pictures seen :"
+msgstr "# Quadres vistos: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:214
+msgid "Indexing :"
+msgstr "Indexaci? de: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:222
+msgid "/dev/null"
+msgstr "/dev/null"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_exLame.cpp:80
+msgid "Lame command"
+msgstr "Ordre Lame"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_exLame.cpp:89
+msgid "Enter parameters (i.e. -b 192 -m s ...)"
+msgstr "Introdu?u par?metres (i.e. -b 192 -m s ...)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:343
+msgid "MPlayer eq2"
+msgstr "MPlayer eq2"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:369
+msgid "Brigh_tness:"
+msgstr "Lluminosi_tat: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:377
+msgid "_Saturation:"
+msgstr "_Saturaci?: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:412
+msgid "_Contrast:"
+msgstr "_Contrast: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:438
+msgid "_Initial:"
+msgstr "_Inicial: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:464
+msgid "_Red:"
+msgstr "_Roig: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:481
+msgid "_Green:"
+msgstr "_Verd: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:489
+msgid "_Blue:"
+msgstr "_Blau: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:497
+msgid "_Weight:"
+msgstr "_Ponderaci?: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:523
+msgid "<b>Gamma</b>"
+msgstr "<b>Gamma</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp:138
+msgid "AudioCodec"
+msgstr "C?dec ?udio"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp:163
+msgid "Configure codec"
+msgstr "Configura C?dec"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:123
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:144
+msgid "Partial"
+msgstr "Parcial"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:137
+msgid "Start frame for partial :"
+msgstr "Fotogr. inicial per a parcial: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:144
+msgid "End frame for partial :"
+msgstr "Fotogr. final per a parcial: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:167
+msgid "Configure partialized filter"
+msgstr "Configura filtre parcial"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_recent.cpp:96
+msgid "Recent files"
+msgstr "Fitxers recents"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:223
+msgid "Processing"
+msgstr "Processament"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:259
+msgid "<b>Time remaining:</b>"
+msgstr "<b>Temps restant:</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:414
+msgid "<b>Target</b>"
+msgstr "<b>Objectiu</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:441
+msgid "Duration:"
+msgstr "Durada:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:461
+msgid "_Medium:"
+msgstr "_Medi:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:472
+msgid "_Format:"
+msgstr "_Format:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:483
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:541
+msgid "Total size (custom)"
+msgstr "Mida total (person.)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:493
+msgid "_Custom size (MB):"
+msgstr "_Mida person. (MB): "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:507
+msgid "Output container format"
+msgstr "Format del contenidor de sortida"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:511
+#: avidemux/ADM_editor/ADM_outputfmt.h:38
+msgid "AVI"
+msgstr "AVI"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:515
+#: avidemux/ADM_editor/ADM_outputfmt.h:46
+msgid "OGM"
+msgstr "OGM"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:519
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:61
+msgid "MPEG"
+msgstr "MPEG"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:534
+msgid "Total size"
+msgstr "Mida total"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:538
+msgid "1x 80 min. CD"
+msgstr "CD 1x 80 min."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:543
+msgid "2x 80 min. CD"
+msgstr "CD 2x 80 min."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:547
+msgid "1x 74 min. CD"
+msgstr "CD 1x 74 min."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:551
+msgid "2x 74 min. CD"
+msgstr "CD 2x 74 min."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:555
+msgid "DVD5"
+msgstr "DVD5"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:559
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:808
+msgid "Custom"
+msgstr "Personal."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:571
+msgid "Track _1:"
+msgstr "Pista _1: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:579
+msgid "Audio bitrate in kb/s for track 1 (0 for no audio)"
+msgstr "Taxa de bits d'?udio en kb/s per a la pista 1. El valor 0 indica que no hi ha ?udio."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:586
+msgid "Track _2: "
+msgstr "Pista _2: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:594
+msgid "Audio bitrate in kb/s for track 2 (optional)"
+msgstr "Taxa de bits d'?udio en kb/s per a la pista 2 (opcional)."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:598
+msgid "<b>Audio Bitrate</b>"
+msgstr "<b>Taxa bits ?udio</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:624
+msgid "Audio size (MB):"
+msgstr "Mida ?udio (MB):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:640
+msgid "Video size (MB):"
+msgstr "Mida v?deo (MB):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:656
+msgid "Total size (MB):"
+msgstr "Mida total (MB):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:678
+msgid "Video bitrate:"
+msgstr "Taxa bits v?deo:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:686
+msgid "Bits per pixel:"
+msgstr "Bits per p?xel:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:702
+msgid "0.0"
+msgstr "0.0"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:710
+msgid "<b>Result</b>"
+msgstr "<b>Resultat</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_busy.cpp:120
+msgid "Busy"
+msgstr "Ocupat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:137
+msgid "Chroma Noise Reduction 2"
+msgstr "Chroma Noise Reduction 2"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:162
+msgid "<b>Scene change Treshold</b>"
+msgstr "<b>Llindar canvi escena</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:181
+msgid "Sensibility"
+msgstr "Sensibilitat"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:189
+msgid "Max"
+msgstr "m?x."
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:204
+msgid "Luma :"
+msgstr "Luma :"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:211
+msgid "Chroma U :"
+msgstr "Croma U :"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:218
+msgid "Chroma V :"
+msgstr "Croma V :"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:261
+msgid "Narrow"
+msgstr "Estreta"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:286
+msgid "<b>Settings</b>"
+msgstr "<b>Configuraci?</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:305
+msgid "Use also chroma to detect scene change"
+msgstr "Usa tamb? croma per detectar un canvi d'escena"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:309
+msgid "<b>Mode</b>"
+msgstr "<b>Mode</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:312
+msgid "Resize"
+msgstr "Redimensiona"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:326
+msgid " Width "
+msgstr "Amplada: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:333
+msgid " Height "
+msgstr "Al??ria: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:356
+msgid "Source :"
+msgstr "Origen: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:362
+msgid "Destination"
+msgstr "Destinaci?: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:376
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:398
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:329
+msgid "1:1"
+msgstr "1:1"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:380
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:402
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:52
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:42
+msgid "4:3"
+msgstr "4:3"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:384
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:406
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:53
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:43
+msgid "16:9"
+msgstr "16:9"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:412
+msgid " Error X:"
+msgstr "Error X: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:426
+msgid " Error Y:"
+msgstr "Error Y: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:440
+msgid "16 round up"
+msgstr "16 round up"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:454
+msgid "Bilinear"
+msgstr "Bilinear"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:458
+msgid "Bicubic"
+msgstr "Bicubic"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:462
+msgid "Lanczos3"
+msgstr "Lanczos3"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:306
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
+msgid "No"
+msgstr "No"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:307
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
+msgid "Yes"
+msgstr "S?"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:67
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:69
+#, c-format
+msgid "%lu x %lu"
+msgstr "%lu x %lu"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:70
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:70
+#, c-format
+msgid "%2.3f fps"
+msgstr "%2.3f fps"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:73
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:71
+#, c-format
+msgid "%ld frames"
+msgstr "%ld fotogrames"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:83
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:133
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:77
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:125
+#, c-format
+msgid "%02d:%02d:%02d.%03d"
+msgstr "%02d:%02d:%02d.%03d"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:96
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:83
+#, c-format
+msgid "%s (%u:%u)"
+msgstr "%s (%u:%u)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:118
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:109
+#, c-format
+msgid "%lu Hz"
+msgstr "%lu Hz"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:110
+#, c-format
+msgid "%lu Bps / %lu kbps"
+msgstr "%lu Bps / %lu kbps"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:136
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:128
+#, c-format
+msgid "%.2f MB"
+msgstr "%.2f MB"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:205
+msgid "Properties"
+msgstr "Propietats"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:234
+msgid "Frame Rate:"
+msgstr "Veloc. imatge: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:241
+msgid "Frame Count:"
+msgstr "Nombre fotog.: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:248
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:426
+msgid "Total Duration:"
+msgstr "Durada total: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:269
+msgid "Image Size:"
+msgstr "Mida imatge: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:290
+msgid "Codec 4CC:"
+msgstr "C?dec 4CC: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:304
+msgid "Aspect Ratio:"
+msgstr "Rel. aspecte: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:337
+msgid "Global Motion Compensation:"
+msgstr "Compensaci? global de moviment: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:351
+msgid "Packed Bitstream:"
+msgstr "Flux de bits empaquetat: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:365
+msgid "Quarter Pixel:"
+msgstr "Quart de p?xel:  "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:379
+msgid "<b>Extra Video Properties</b>"
+msgstr "<b>Altres propietats del v?deo</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:398
+msgid "Codec:"
+msgstr "C?dec:  "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:405
+msgid "Channels:"
+msgstr "Canals: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:412
+msgid "Bitrate:"
+msgstr "Taxa de bits: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:419
+msgid "Frequency:"
+msgstr "Freq??ncia:  "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:468
+msgid "File Size:"
+msgstr "Mida fitxer: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:482
+msgid "Variable Bitrate:"
+msgstr "Taxa bits variable: "
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:54
 msgid "translator-credits"
 msgstr ""
 "Joan Farrerons i Herrero.\n"
-"jfarrerons at economistes.com"
+"<jfarrerons at economistes.com>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:69
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:265
-msgid "Avidemux"
-msgstr "Avidemux"
-
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:70
 msgid "? 2001-2006 Mean"
-msgstr "? 2001-2006 Els desenvolupadors"
+msgstr "? 2001-2006 Mean"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:71
 msgid "Multiplatform video editor"
@@ -1898,1462 +3020,104 @@
 msgid "http://www.avidemux.org"
 msgstr "http://www.avidemux.org"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp:138
-msgid "AudioCodec"
-msgstr "C?dec ?udio"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:237
+msgid "Xvid Encoder"
+msgstr "Codificador Xvid"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp:163
-msgid "Configure codec"
-msgstr "Configura C?dec"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:250
+msgid "Constant Quantizer"
+msgstr "Quantificador constant"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:83
-msgid "Select background picture"
-msgstr "Selecciona quadre fons"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:258
+msgid "Constant Bitrate (kbps)"
+msgstr "Taxa bits constant (kbps)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:169
-msgid "Animated Menu"
-msgstr "Men? Animat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:266
+msgid "Dual pass (MBytes)"
+msgstr "2 Passades (MBytes)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:193
-msgid "BackGround Image :"
-msgstr "Imatge Fons:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:292
+msgid "Basic"
+msgstr "B?sica"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:200
-msgid "Standard"
-msgstr "Standard"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:301
+msgid "Motion Search"
+msgstr "Cerca moviment"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:207
-msgid "NTSC (default is PAL)"
-msgstr "NTSC (PAL ?s el predeterminat)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:317
+msgid "Max I frame interval "
+msgstr "M?x. interval fotog-I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:227
-msgid "Vignette Width"
-msgstr "Amplada Vinyeta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:333
+msgid "Min I frame interval"
+msgstr "Min. interval fotog-I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:234
-msgid "Vignette Height"
-msgstr "Al??ria Vinyeta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:361
+msgid "1- Very low"
+msgstr "1- Molt baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:257
-msgid "<b>General</b>"
-msgstr "<b>General</b>"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:365
+msgid "2- Low"
+msgstr "2- Baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:276
-msgid "Chapter 1"
-msgstr "Cap?tol 1"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:369
+msgid "3- Medium"
+msgstr "3- Mitjana"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:283
-msgid "Chapter 2"
-msgstr "Cap?tol 2"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:373
+msgid "4- High"
+msgstr "4- Alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:290
-msgid "Chapter 3"
-msgstr "Cap?tol 3"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:377
+msgid "5- Very High"
+msgstr "5- Molt alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:297
-msgid "Chapter 4"
-msgstr "Cap?tol 4"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:381
+msgid "6- Ultra High"
+msgstr "6- Ultra alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:304
-msgid "Chapter 5"
-msgstr "Cap?tol 5"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:395
+msgid "H263 Quantizer"
+msgstr "Quantificador H263"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:311
-msgid "Chapter 6"
-msgstr "Cap?tol 6"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:400
+msgid "MPEG Quantizer"
+msgstr "Quantificador MPEG"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:324
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:333
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:342
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:351
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:360
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:369
-msgid "Start frame for this vignette."
-msgstr "Fotograma inicial per a aquesta vinyeta."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:407
+msgid "Advanced"
+msgstr "Avan?at"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp:372
-msgid "<b>TimeCode</b>"
-msgstr "<b>Compt. temps</b>"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:416
+msgid "Min I Frame Qzer"
+msgstr "M?n. qfic. fotog-I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:282
-msgid "ASharp by MarcFD"
-msgstr "ASharp per MarcFD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:424
+msgid "Max I Frame Qzer"
+msgstr "M?x. qfic. fotog-I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:295
-msgid "Threshold :"
-msgstr "Llindar:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:432
+msgid "Min P Frame Qzer"
+msgstr "M?n. qfic. fotog-P"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:303
-msgid "Strength :"
-msgstr "For?a:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:440
+msgid "Max P Frame Qzer"
+msgstr "M?x. qfic. fotog-P"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:311
-msgid "Block Adaptative :"
-msgstr "Adaptativa bloc:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:480
+msgid "Quantizer"
+msgstr "Quantificador"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:319
-msgid "Unknown flag :"
-msgstr "Indicador desc.:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:485
+msgid "Not Yet!"
+msgstr "Encara no!"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:351
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:208
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:271
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:264
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:292
-msgid " "
-msgstr " "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:490
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:144
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:147
+msgid "B Frames"
+msgstr "Fotogrames-B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:209
-msgid "Audio Processing"
-msgstr "Processament ?udio"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:227
-msgid "DRC"
-msgstr "DRC"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:235
-msgid "Timeshift"
-msgstr "Despl. temps"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:244
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1459
-msgid "<b>Misc</b>"
-msgstr "<b>Diverses</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:267
-msgid "Resample to hz"
-msgstr "Remostreja a hz"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:277
-msgid "<b>Resampling</b>"
-msgstr "<b>Remostrejat</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:296
-msgid "Film -> PAL"
-msgstr "Film -> PAL"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:302
-msgid "PAL->Film"
-msgstr "PAL -> Film"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:308
-msgid "<b>Fps convert</b>"
-msgstr "<b>Conversi? Fps</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:327
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:200
-msgid "Gain"
-msgstr "Guany"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:335
-msgid "Automatic ( max is -3dB)"
-msgstr "Automatic (m?x.: -3dB)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:345
-msgid "Manual (db) : "
-msgstr "Manual (db) : "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:357
-msgid "<b>Gain</b>"
-msgstr "<b>Guany</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:369
-msgid "No change"
-msgstr "Sense canvi"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:372
-msgid "Stereo+Surround"
-msgstr "Stereo+Surround"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:373
-msgid "Stereo+Center"
-msgstr "Stereo+Center"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:374
-msgid "Stereo+Center+Surround"
-msgstr "Stereo+Center+Surround"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:375
-msgid "Stereo Front+Stero Rear"
-msgstr "Stereo Front+Stero Rear"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:376
-msgid "5 channels"
-msgstr "5 canals"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:377
-msgid "5.1"
-msgstr "5.1"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:378
-msgid "Dolby Prologic"
-msgstr "Dolby Prologic"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:379
-msgid "Dolby Prologic 2"
-msgstr "Dolby Prologic 2"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audio.cpp:381
-msgid "<b>Mixer</b>"
-msgstr "<b>Mesclador</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_busy.cpp:120
-msgid "Busy"
-msgstr "Ocupat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:403
-msgid "Bitrate Calculator"
-msgstr "Calculad. taxa bits"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:431
-msgid "Duration:"
-msgstr "Durada:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:437
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:198
-msgid "00:00:00"
-msgstr "00:00:00"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:451
-msgid "_Medium:"
-msgstr "_Medi:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:462
-msgid "_Format:"
-msgstr "_Format:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:473
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:531
-msgid "Total size (custom)"
-msgstr "Mida total (person.)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:483
-msgid "_Custom size (MB):"
-msgstr "_Mida person. (MB)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:497
-msgid "Output container format"
-msgstr "Format contenidor sortida"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:524
-msgid "Total size"
-msgstr "Mida total"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:528
-msgid "1x 80 min. CD"
-msgstr "CD 1x 80 min."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:533
-msgid "2x 80 min. CD"
-msgstr "CD 2x 80 min."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:537
-msgid "1x 74 min. CD"
-msgstr "CD 1x 74 min."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:541
-msgid "2x 74 min. CD"
-msgstr "CD 2x 74 min."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:545
-msgid "DVD5"
-msgstr "DVD5"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:549
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:802
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:902
-msgid "Custom"
-msgstr "Personal."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:555
-msgid "<b>Target</b>"
-msgstr "<b>Objectiu</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:575
-msgid "Track _1:"
-msgstr "Pista_1:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:583
-msgid "Audio bitrate in kb/s for track 1 (0 for no audio)"
-msgstr "Taxa de bits ?udio en kb/s per a la pista 1 (0: sense ?udio)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:591
-msgid "Track _2: "
-msgstr "Pista_2:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:599
-msgid "Audio bitrate in kb/s for track 2 (optional)"
-msgstr "Taxa de bits ?udio en kb/s per a la pista 2 (opcioinal)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:603
-msgid "<b>Audio Bitrate</b>"
-msgstr "<b>Taxa bits ?udio</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:625
-msgid "Audio size (MB):"
-msgstr "Mida ?udio (MB):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:633
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:649
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:665
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:695
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:534
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:542
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:558
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:566
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:574
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:166
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:206
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:148
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:156
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:419
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:433
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:622
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1380
-msgid "0"
-msgstr "0"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:641
-msgid "Video size (MB):"
-msgstr "Mida v?deo (MB):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:657
-msgid "Total size (MB):"
-msgstr "Mida total (MB):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:679
-msgid "Video bitrate:"
-msgstr "Taxa bits v?deo:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:687
-msgid "Bits per pixel:"
-msgstr "Bits per p?xel:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:703
-msgid "0.0"
-msgstr "0.0"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:711
-msgid "<b>Result</b>"
-msgstr "<b>Resultat</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:264
-msgid "ChromaShift"
-msgstr "Despla?ament Croma"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:278
-msgid "U Shift :"
-msgstr "Despl. U:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:285
-msgid "V Shift :"
-msgstr "Despl. V:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:327
-msgid "<b>Preview</b>"
-msgstr "<b>Vista pr?via</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:137
-msgid "Chroma Noise Reduction 2"
-msgstr "Chroma Noise Reduction 2"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:162
-msgid "<b>Scene change Treshold</b>"
-msgstr "<b>Llindar canvi escena</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:181
-msgid "Sensibility"
-msgstr "Sensibilitat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:189
-msgid "Max"
-msgstr "m?x."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:204
-msgid "Luma :"
-msgstr "Luma :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:211
-msgid "Chroma U :"
-msgstr "Croma U :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:218
-msgid "Chroma V :"
-msgstr "Croma V :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:261
-msgid "Narrow"
-msgstr "Estreta"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:286
-msgid "<b>Settings</b>"
-msgstr "<b>Configuraci?</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:305
-msgid "Use also chroma to detect scene change"
-msgstr "Usa tamb? croma per detectar un canvi d'escena"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_cnr2.cpp:309
-msgid "<b>Mode</b>"
-msgstr "<b>Mode</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_color.cpp:71
-msgid "Select Color"
-msgstr "Selecciona color"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:155
-msgid "ColorYuv (From avisynth)"
-msgstr "ColorYuv (d'avisynth)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:179
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:246
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:263
-msgid "Contrast"
-msgstr "Contrast"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:186
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:276
-msgid "Brightness"
-msgstr "Lluminositat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:193
-msgid "Gamma"
-msgstr "Gamma"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:207
-msgid "Luma Y"
-msgstr "Luma Y"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:214
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:297
-msgid "Chroma U"
-msgstr "Croma U"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:221
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:301
-msgid "Chroma V"
-msgstr "Croma V"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:324
-msgid "<b>Color Correction Matrix</b>"
-msgstr "<b>Matriu Correcci? Color</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:347
-msgid "Matrix"
-msgstr "Matriu"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:354
-msgid "Opt"
-msgstr "Opt"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:361
-msgid "Level"
-msgstr "Nivell"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:374
-msgid "Rec.709"
-msgstr "Rec.709"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:382
-msgid "Coring"
-msgstr "Coring"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:390
-msgid "TV->PC"
-msgstr "TV->PC"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:391
-msgid "PC->TV"
-msgstr "PC->TV"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:392
-msgid "PC->TV.Y"
-msgstr "PC->TV.Y"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:398
-msgid ""
-"<b>Matrix Warning :</b>\n"
-"all above values are normalized to 256!"
-msgstr ""
-"<b>Av?s sobre la matriu:</b>\n"
-"tots els valors m?s alts s?n normalitzats a 256"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:404
-msgid "AutoGain"
-msgstr "Auto Guany"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:408
-msgid "Display Stats"
-msgstr "Mostra Stats"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:412
-msgid "AutoWhite"
-msgstr "Blanc Auto"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:416
-msgid "<b>frame2</b>"
-msgstr "<b>Fotog. 2</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:293
-msgid "Luma"
-msgstr "Luma"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:544
-msgid "Crop Settings"
-msgstr "Configs. Tall"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:578
-msgid "AutoCrop"
-msgstr "Tall Auto"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:600
-msgid "Reset"
-msgstr "Reinicia"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:609
-msgid "Crop Left :"
-msgstr "Tall Esq.:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:617
-msgid "Crop Top:"
-msgstr "Tall Amunt:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:625
-msgid "Crop Right:"
-msgstr "Tall Dreta:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:633
-msgid "Crop Bottom:"
-msgstr "Tall Avall:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:269
-#, c-format
-msgid "Done : %02d%%"
-msgstr "Fet: %02d%%"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:377
-msgid "Encoding in Progress"
-msgstr "S'est? codificant"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:387
-msgid "<b><big>Encoding files</big></b>"
-msgstr "<b><big>Codificaci? de fitxers</big></b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:400
-msgid "<b>Phasis:</b>"
-msgstr "<b>Fase:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:410
-msgid "<b>Frame:</b>"
-msgstr "<b>Fotograma:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:428
-msgid "00000/00000"
-msgstr "00000/00000"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:436
-msgid "<b>Vid codec:</b>"
-msgstr "<b>C?dec v?deo:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:447
-msgid "<b>Aud Codec:</b>"
-msgstr "<b>C?dec ?udio:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:457
-msgid "<b>FPS:</b>"
-msgstr "<b>FPS:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:467
-msgid "<b>Vid Bitrate:</b>"
-msgstr "<b>Taxa bits v?d.:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:477
-msgid "<b>Quantizer:</b>"
-msgstr "<b>Quantificador:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:487
-msgid "<b>Video Size:</b>"
-msgstr "<b>Mida v?deo:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:498
-msgid "<b>Audio Size:</b>"
-msgstr "<b>Mida ?udio:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:508
-msgid "<b>Total Size:</b>"
-msgstr "<b>Mida total:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:550
-msgid "31"
-msgstr "31"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:582
-msgid "<b>ETA:</b>"
-msgstr "<b>Tps. rest. est.:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:592
-msgid "0 h 0 mn 0 s"
-msgstr "0 h 0 mn 0 s"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:602
-msgid "<b>Container:</b>"
-msgstr "<b>Contenidor:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:649
-msgid "Pause / Abort"
-msgstr "Atura / Cancel?la"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:330
-msgid "MPlayer eq2"
-msgstr "MPlayer eq2"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:356
-msgid "Brigh_tness:"
-msgstr "Lluminosi_tat:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:364
-msgid "_Saturation:"
-msgstr "_Saturaci?:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:399
-msgid "_Contrast:"
-msgstr "_Contrast:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:425
-msgid "_Initial:"
-msgstr "_Inicial:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:451
-msgid "_Red:"
-msgstr "_Roig"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:468
-msgid "_Green:"
-msgstr "Verd (_G):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:476
-msgid "_Blue:"
-msgstr "_Blau:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:484
-msgid "_Weight:"
-msgstr "Ponderaci? (_W):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:510
-msgid "<b>Gamma</b>"
-msgstr "<b>Gamma</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:433
-msgid "Equalizer"
-msgstr "Equalitzador"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_exLame.cpp:80
-msgid "Lame command"
-msgstr "Mandat Lame"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_exLame.cpp:89
-msgid "Enter parameters (i.e. -b 192 -m s ...)"
-msgstr "Introdu?u par?metres (i.e. -b 192 -m s ...)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:246
-msgid "Hue/Saturation"
-msgstr "Mat?s/Saturaci?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:260
-msgid "<b>Hue:</b>"
-msgstr "<b>Mat?s:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:268
-msgid "<b>Saturation:</b>"
-msgstr "<b>Saturaci?:</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
-msgid "Continue indexing"
-msgstr "Continua indexant"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
-msgid "Abort Requested"
-msgstr "Cancel?laci? requerida"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:51
-msgid "Do you want to abort indexing ?"
-msgstr "Voleu cancel?lar la indexaci??"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:153
-msgid "Indexing..."
-msgstr "S'est? indexant..."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:174
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:259
-msgid "Time left :"
-msgstr "Temps restant:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:182
-msgid "Timecode :"
-msgstr "Comptador temps: "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:190
-msgid "Nb pictures seen :"
-msgstr "# Quadres vistos: "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:214
-msgid "Indexing :"
-msgstr "Indexaci? de: "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:222
-msgid "/dev/null"
-msgstr "/dev/null"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
-msgid "Ready"
-msgstr "Preparat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
-msgid "Succeeded"
-msgstr "Ha tingut ?xit"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
-#: avidemux/gtk_gui.cpp:2280
-msgid "Failed"
-msgstr "Ha fallat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
-msgid "Deleted"
-msgstr "S'ha esborrat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
-msgid "Running"
-msgstr "Processant"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:98
-msgid "  Job Name  "
-msgstr " Nom Tasca"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:103
-msgid "Started at"
-msgstr "Comen?at a"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:107
-msgid "Finished at"
-msgstr "Acabat a"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
-msgid "Sure!"
-msgstr "?s clar!"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
-msgid "Delete ALL jobs"
-msgstr "Esborra TOTES les tasques"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:134
-msgid "Are you sure you want to delete all jobs ?"
-msgstr "Esteu segur que voleu esborrar totes les tasques?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
-msgid "Delete job"
-msgstr "Esborra tasca"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:172
-#, c-format
-msgid "Are you sure you want to delete %s job ?"
-msgstr "Esteu segur que voleu esborrar la tasca %s ?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:181
-msgid "Unknown event"
-msgstr "Esdeveniment desconegut"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:261
-msgid "Jobs"
-msgstr "Tasques"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:287
-msgid "Delete All Jobs"
-msgstr "Esborra Totes Tasques"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:292
-msgid "Delete Job"
-msgstr "Esborra Tasca"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:297
-msgid "Run all jobs"
-msgstr "Executa Totes Tasques"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:302
-msgid "Run Job"
-msgstr "Executa Tasca"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:49
-msgid "Select video to write"
-msgstr "Seleccioneu el v?deo per escriure"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:63
-msgid "Invalid filename"
-msgstr "El nom de fitxer no ?s v?lid"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:63
-msgid "Please select or enter a valid filename"
-msgstr "Seleccioneu o introdu?u un nom v?lid de fitxer"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:69
-msgid "Invalid jobname"
-msgstr "El nom de la tasca no ?s v?lid"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:69
-msgid "Please select or enter a valid jobname"
-msgstr "Seleccioneu o introdu?u un nom de tasca v?lid"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:111
-msgid "Save Job"
-msgstr "Desa tasca"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:130
-msgid "Select the output file"
-msgstr "Selecciona el fitxer de sortida"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:144
-msgid "_Browse..."
-msgstr "Fulleja (b)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:153
-msgid "Job name displayed in the job list and used as the script filename"
-msgstr "Nom de tasca mostrat en la llista de tasques i usat com a nom del fitxer d'script"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:162
-msgid "Filename of the audio/video output"
-msgstr "Nom del fitxer d'?udio/v?deo de sortida"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:165
-msgid "_Job name:"
-msgstr "Nom tasca (_J):"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs_save.cpp:172
-msgid "Output _file:"
-msgstr "_Fitxer de sortida:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavdecoder.cpp:79
-msgid "Libavcodec Decoder Option"
-msgstr "Opci? descodific. libavcodec"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavdecoder.cpp:88
-msgid "Swap UV"
-msgstr "Intercanvia UV"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_lavdecoder.cpp:92
-msgid "Show motion Vectors"
-msgstr "Mostra vectors movim."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mjpeg.cpp:73
-msgid "Mjpeg Codec settings"
-msgstr "Config. C?dec Mjpeg"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mjpeg.cpp:93
-msgid "Swap U & V"
-msgstr "Interc. U & V"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:356
-msgid "Mplayer Delogo"
-msgstr "Delogo Mplayer"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:374
-msgid "X"
-msgstr "X"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:381
-msgid "Y"
-msgstr "Y"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:388
-msgid "W"
-msgstr "W"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:395
-msgid "H"
-msgstr "H"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:402
-msgid "Band"
-msgstr "Banda"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpeg2opt.cpp:104
-msgid "Mpeg2 options"
-msgstr "Opcions Mpeg2"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpeg2opt.cpp:113
-msgid "Other arg"
-msgstr "Altres arg."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpeg2opt.cpp:121
-msgid "Quantisation (2-31)"
-msgstr "Quantificaci? (2-31)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpeg2opt.cpp:129
-msgid "Maximum bitrate (kbps)"
-msgstr "Taxa bits m?x. (kbps)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:85
-msgid "Mini OCR"
-msgstr "Mini OCR"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:118
-msgid "<b>Glyphs</b>"
-msgstr "<b>Glifos</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:132
-msgid "# of Glyphs :"
-msgstr "# Glifos:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:140
-msgid "# of lines"
-msgstr "# L?nies"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:164
-msgid "<b>Stats</b>"
-msgstr "<b>Estad?stiques</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:186
-msgid "  "
-msgstr "  "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:195
-msgid "VobSub"
-msgstr "VobSub"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:217
-msgid "Output Srt"
-msgstr "SRT Sortida"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:222
-msgid "<b>Files</b>"
-msgstr "<b>Fitxers</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:228
-msgid "StartOcr"
-msgstr "Inicia OCR"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:249
-msgid "Current Glyph"
-msgstr "Glif actual"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:263
-msgid " Text:"
-msgstr " Text:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:287
-msgid "Calibrate"
-msgstr "Calibra"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:292
-msgid "Skip all"
-msgstr "Salta-ho tot"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:297
-msgid "Skip Glyph"
-msgstr "Salta glif"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:302
-msgid "Ignore glyph"
-msgstr "Ignora glif"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:307
-msgid "Ok"
-msgstr "B?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:316
-msgid "<b>Bitmap</b>"
-msgstr "<b>Bitmap</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:123
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:144
-msgid "Partial"
-msgstr "Parcial"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:137
-msgid "Start frame for partial :"
-msgstr "Fotogr. inicial per a parcial:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:144
-msgid "End frame for partial :"
-msgstr "Fotogr. final per a parcial:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_partial.cpp:167
-msgid "Configure partialized filter"
-msgstr "Configura filtre parcial"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:93
-msgid "Paused"
-msgstr "Atura"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:109
-msgid ""
-"<b>Encoding is paused.</b>\n"
-"\n"
-"You can either resume or Abort it."
-msgstr ""
-"<b>S'ha aturat la codificaci?.</b>\n"
-"\n"
-"Podeu reprendre-la o b? cancel?lar-la."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:136
-msgid "Abort"
-msgstr "Cancel?la"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:158
-msgid "Resume"
-msgstr "Repr?n"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:95
-msgid "Pipe to"
-msgstr "Canalitza a"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:104
-msgid "Application path/name (/usr/bin/sox...)"
-msgstr "Cam? ubic. aplicaci? (/usr/bin/sox...)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pipe.cpp:113
-msgid "Full parameter line"
-msgstr "L?nia param. sencer"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:280
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:150
-msgid "Preview"
-msgstr "Previsualitza"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:316
-msgid "Stack Field"
-msgstr "Empila Marc"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
-msgid " No"
-msgstr "No"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
-msgid " Yes"
-msgstr "S?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:141
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:132
-#, c-format
-msgid "NONE"
-msgstr "CAP"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:207
-msgid "Informations"
-msgstr "Informacions"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:229
-msgid "Frame Rate"
-msgstr "Veloc. imatge "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:236
-msgid "# of frames"
-msgstr "# Fotogram. "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:243
-msgid "Codec 4CC"
-msgstr "C?dec x CC "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:250
-msgid "Video Duration  "
-msgstr "Durada v?deo "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:271
-msgid "Image size"
-msgstr "Mida imatge "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:306
-msgid "-/-"
-msgstr "-/-"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:339
-msgid "Packed Bistream"
-msgstr "Flux empaq."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:346
-msgid "Quarter Pixel"
-msgstr "Quart de p?xel "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:353
-msgid "GMC "
-msgstr "GMC "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:381
-msgid "<b>Extra Properties</b>"
-msgstr "<b>Altres propietats</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:386
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:998
-msgid "<b>Video</b>"
-msgstr "<b>V?deo</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:399
-msgid "Codec "
-msgstr "C?dec "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:406
-msgid "Channels  "
-msgstr "Canals "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:413
-msgid "Bitrate "
-msgstr "Taxa bits "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:420
-msgid "Frequency"
-msgstr "Freq??nc. "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:427
-msgid "Audio duration  "
-msgstr "Dur. ?udio  "
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:482
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1038
-msgid "<b>Audio</b>"
-msgstr "<b>?udio</b>"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:90
-msgid "Filesystem full / quota exceeded"
-msgstr "El sistems de fitxers ?s ple / s'ha superart la quota"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:133
-msgid "Ignore"
-msgstr "Ignora"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_quota.cpp:155
-msgid "Retry"
-msgstr "Reintenta"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_recent.cpp:96
-msgid "Recent files"
-msgstr "Fitxers recents"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_requant.cpp:85
-msgid "Requantize Option"
-msgstr "Opci? Requantifica"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_requant.cpp:95
-msgid "Shrink factor"
-msgstr "Factor reduc."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:312
-msgid "Resize"
-msgstr "Redimensiona"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:326
-msgid " Width "
-msgstr " Amplada"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:333
-msgid " Height "
-msgstr " Al??ria"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:356
-msgid "Source :"
-msgstr "Origen:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:362
-msgid "Destination"
-msgstr "Destinaci?:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:376
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:398
-msgid "1:1"
-msgstr "1:1"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:412
-msgid " Error X:"
-msgstr " Error X:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:426
-msgid " Error Y:"
-msgstr " Error Y:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:440
-msgid "16 round up"
-msgstr "16 round up"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:454
-msgid "Bilinear"
-msgstr "Bilinear"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:458
-msgid "Bicubic"
-msgstr "Bicubic"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:462
-msgid "Lanczos3"
-msgstr "Lanczos3"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:348
-msgid "Subtitle to load"
-msgstr "Subt?tol per carregar"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:358
-msgid "TTF font to use"
-msgstr "Lletra TTF per usar"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:475
-msgid "Subtitle selector"
-msgstr "Selector subt?tols"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:488
-msgid "Subtitle file "
-msgstr "Fitxer  de subt?tols"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:495
-msgid "Font (TTF)"
-msgstr "Lletra (TTF)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:502
-msgid "Encoding "
-msgstr "Codificaci?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:509
-msgid "Font Size"
-msgstr "Mida lletra"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:522
-msgid "sub"
-msgstr "sub"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:540
-msgid "font"
-msgstr "Lletra"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:560
-msgid "Ascii"
-msgstr "Ascii"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:586
-msgid "Select color"
-msgstr "Selecciona color"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:599
-msgid "Select"
-msgstr "Selecciona"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:603
-msgid "Auto split"
-msgstr "Autodivisi?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:609
-msgid "Delay in ms"
-msgstr "Retard en ms"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:624
-msgid "Force background"
-msgstr "For?a el fons"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:159
-msgid "TDeint param"
-msgstr "Param. TDeint"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:173
-msgid "Field Order :"
-msgstr "Ordre Marcs:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:185
-msgid "Bottom Field First"
-msgstr "Marc baix primer"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:186
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:178
-msgid "Top Field First"
-msgstr "Marc alt primer"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:188
-msgid "Interpolate :"
-msgstr "Interpola:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:200
-msgid "Top field (keep bottom)"
-msgstr "Marc alt (deixa avall)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:201
-msgid "Bottom field (keep top)"
-msgstr "Marc baix (deixa amunt)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:203
-msgid "Type"
-msgstr "Tipus"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:215
-msgid "Cubic Interpolation"
-msgstr "Interpolaci? c?bica"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:216
-msgid "Modified ELA"
-msgstr "ELA modificada"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:217
-msgid "Kernerl interpolation"
-msgstr "Interpolaci? Kernerl"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:218
-msgid "Modified ELA-2"
-msgstr "ELA-2 modificada"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:220
-msgid "MntMode"
-msgstr "MntMode"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:232
-msgid "4 field check"
-msgstr "Controla 4 marcs"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:233
-msgid "5 field check"
-msgstr "Controla 5 marcs"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:234
-msgid "4 field check (no average)"
-msgstr "Controla 4 marcs (sense mitjana)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:235
-msgid "5 field check (no average)"
-msgstr "Controla 5 marcs (sense mitjana)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:237
-msgid "Use Chroma to evalute"
-msgstr "Usa croma per avaluar"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:250
-msgid "Try weave "
-msgstr "Prova entreteixir"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:263
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:173
-msgid "Denoise"
-msgstr "Filtra soroll"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:276
-msgid "Link"
-msgstr "Enlla?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:288
-msgid "No link"
-msgstr "Sense enlla?"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:289
-msgid "Full linking"
-msgstr "Enlla? complet"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:290
-msgid "Y to UV link"
-msgstr "Enlla? Y a UV"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:291
-msgid "UV to Y link"
-msgstr "Enlla? UV a Y"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:293
-msgid "Sharp :"
-msgstr "Nitideja:"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:306
-msgid "AP type"
-msgstr "Tipus AP"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:319
-msgid "Evaluate ALL frames"
-msgstr "Avalua TOTS fotogr."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:331
-msgid "0 (read manual)"
-msgstr "0 (vegeu manual)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:332
-msgid "1 (read manual)"
-msgstr "1 (vegeu manual)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:333
-msgid "2 (read manual)"
-msgstr "2 (vegeu manual)"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:339
-msgid "motion Threshold, Luma"
-msgstr "Llindar movim., Luma"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:346
-msgid "motion Threshold, Chroma"
-msgstr "Llindar movim., Croma"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:369
-msgid "Area Combing Threshold"
-msgstr "Llindar zona pentinat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:383
-msgid "Combed Treshold"
-msgstr "Llindar pentinat"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_tdeint.cpp:398
-msgid "Artefact Protection threshold "
-msgstr "Llindar protecci? artefactes"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:56
-msgid "Select Vob file to scan"
-msgstr "Seleccioneu el fitxer VOB per escanejar"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:67
-msgid "Select ifo file to use"
-msgstr "Seleccioneu el fitxer IFO per usar"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:78
-msgid "Select vobsub to write"
-msgstr "Seleccioneu el fitxer VOBSUB per escriure"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:92
-msgid "Invalid vobname"
-msgstr "Nom inv?lid de fitxer VOB"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:92
-msgid "Please select or enter a valid vob name"
-msgstr "Seleccioneu o introdu?u un nom v?lid de fitxer VOB"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:98
-msgid "Invalid ifo"
-msgstr "Nom inv?lid de fitxer IFO"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:98
-msgid "Please select or enter a valid ifo file"
-msgstr "Seleccioneu o introdu?u un nom v?lid de fitxer IFO"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:104
-msgid "Invalid vobsubname"
-msgstr "Nom inv?lid de fitxer VOBSUB"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:104
-msgid "Please select or enter a valid vobsub file"
-msgstr "Seleccioneu o introdu?u un fitxer VOBSUB v?lid"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:152
-msgid "Vob to Vobsub"
-msgstr "Vob a Vobsub"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:162
-msgid "Vob :"
-msgstr "Vob :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:169
-msgid "Ifo :"
-msgstr "Ifo :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp:176
-msgid "Output vobsub (.idx) :"
-msgstr "Vobsub sortida (.idx) :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:104
-msgid "Video encoder"
-msgstr "Codificador v?deo"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:118
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1018
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1058
-msgid "Configure"
-msgstr "Configura"
-
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp:98
 msgid "Select .idx file"
 msgstr "Seleccioneu el fitxer .IDX"
@@ -3376,7 +3140,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp:254
 msgid "Extra Shrink Factor :"
-msgstr "Factor Reducc. Extra:"
+msgstr "Factor reducc. extra: "
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp:269
 msgid "Shift (ms) :"
@@ -3386,2003 +3150,2331 @@
 msgid "Extra Settings"
 msgstr "Altres Configs."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:246
-msgid "dialog1"
-msgstr "di?leg1"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:449
+msgid "Equalizer"
+msgstr "Equalitzador"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp:264
-msgid "0:0:0"
-msgstr "0:0:0"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:104
+msgid "Video encoder"
+msgstr "Codificador v?deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:554
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:199
+msgid "ASharp by MarcFD"
+msgstr "ASharp per MarcFD"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:212
+msgid "Threshold :"
+msgstr "Llindar:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:220
+msgid "Strength :"
+msgstr "For?a: "
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:228
+msgid "Block Adaptative :"
+msgstr "Adaptativa bloc:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:236
+msgid "Unknown flag :"
+msgstr "Indicador desc.:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:560
 msgid "X264 configuration"
 msgstr "Configuraci? X264"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:569
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:575
 msgid "Encoding Mode:"
-msgstr "Mode codificaci?:"
+msgstr "Mode de codificaci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:581
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:587
 msgid "Entry input for target file size or bitrate"
 msgstr "Dades d'entrada per a fitxer destinaci? o taxa de bits"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:583
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:589
 msgid "Quantizer (0-51):"
 msgstr "Quantificador (0-51):"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:596
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:602
 msgid "Constant Quantizer - Each frame will the same compression. Low numbers equal higher quality while high numbers equal lower quality"
 msgstr "Quantificador constant - Cada fotograma tindr? la mateixa compressi?. Nombres baixos comporten qualitat m?s alta mentre que nombres alts comporten qualitat m?s baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:606
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:612
 msgid "Target Size:"
 msgstr "Mida a obtenir:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:618
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:624
 msgid "Single Pass - Quality Quantizer (Average)"
-msgstr "1 Pass. - Qualitat quantificador (mitjana)"
+msgstr "1 Pass. - Quantificador qualitat (mitjana)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:619
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:625
 msgid "Single Pass - Quality Quantizer (Constant)"
-msgstr "1 Pass. - Qualitat quantificador (constant)"
+msgstr "1 Pass. - Quantificador qualitat (constant)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:620
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:626
 msgid "Single Pass - Bitrate (Average)"
 msgstr "1 Pass. - Taxa de bits (mitjana)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:621
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:627
 msgid "Two Pass - File Size"
 msgstr "2 Passades - Mida del fitxer"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:622
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:628
 msgid "Two Pass - Average bitrate"
 msgstr "2 Passades - Taxa de bits mitjana"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:650
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:630
+msgid "Bitrate"
+msgstr "Taxa bits"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:656
 msgid "Partition decision"
 msgstr "Decisi? de partici?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:657
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:663
 msgid "Method"
 msgstr "M?tode"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:669
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:675
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:58
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:61
 msgid "1  - Extremely Low (Fastest)"
 msgstr "1  - Extremadament baixa (m?s r?pid)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:670
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:676
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:59
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:62
 msgid "2  - Very Low"
 msgstr "2  - Molt baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:671
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:677
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:60
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:63
 msgid "3  - Low"
 msgstr "3  - Baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:672
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:678
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:61
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:64
 msgid "4  - Medium"
 msgstr "4  - Mitjana"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:673
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:679
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:62
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:65
 msgid "5  - High (Default)"
 msgstr "5  - Alta (predeterminat)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:674
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:680
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:63
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:66
 msgid "6  - Very High"
 msgstr "6  - Molt alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:675
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:681
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:64
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:67
 msgid "6B - Very High (RDO on Bframes)"
 msgstr "6B - Molt alta (RDO sobre fotog-B)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:676
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:682
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:65
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:68
 msgid "7 - Ultra High"
 msgstr "7 - Ultra alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:677
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:683
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:66
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:69
 msgid "7B - Ultra High (RDO on Bframes)"
 msgstr "7B - Ultra alta (RDO sobre fotog-B)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:684
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:690
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:72
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:75
 msgid "Diamond search"
 msgstr "Cerca en diamant"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:685
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:691
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:73
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:76
 msgid "Hexagonal search"
 msgstr "Cerca hexagonal"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:686
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:692
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:74
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:77
 msgid "Uneven multi hexagon"
 msgstr "Multi hex?gon irregular"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:687
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:693
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:75
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:78
 msgid "Exhaustive search"
 msgstr "Cerca exhaustiva"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:699
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:705
 msgid "Set how many previous frames can be referenced by a P/B-frame. Numbers above 5 do not seem to improve quality greatly. Numbers are 3 to 5 are recommended"
 msgstr "Estableix quants fotogrames previs es poden referenciar per un fotograma-P/B. Els valors superiors a 5 no semblen millorar molt la qualitat. Es recomanen els valors de 3 a 5"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:702
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:708
 msgid "Max. Ref. frames"
 msgstr "M?x. fotog. de ref."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:709
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:715
 msgid "Range"
 msgstr "Rang"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:722
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:728
 msgid "Define how many pixels are analysised. The higher the range the more accurate the analysis but the slower the encoding time"
-msgstr "Defineix quans p?xels s'analitzen. Com m?s alt ?s el rang, m?s acurada ?s l'an?lisi, per? m?s lenta ?s la descodificac?"
+msgstr "Defineix quans p?xels s'analitzen. Com m?s alt ?s el rang, m?s acurada ?s l'an?lisi, per? m?s lenta ?s la codificaci?."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:725
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:731
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:80
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:89
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:83
 msgid "Chroma ME"
 msgstr "EM Croma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:730
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:736
 msgid "Uses chroma (color) components for motion for compression and helps the quality"
-msgstr "Usa els components croma (color)' per al moviment en la compressi? i afavoreix la qualitat"
+msgstr "Utilitza els components croma (color) per al moviment en la compressi?, tot afavorint aix? la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:733
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:739
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:81
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:84
 msgid "Mixed Refs"
 msgstr "Refs. m?ltiples"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:738
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:744
 msgid "Calculate referencing individually based on each partition"
-msgstr "Calcula les refer?ncies individualment per a cada partici?"
+msgstr "Calcula les refer?ncies individualment per a cada partici?."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:744
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:750
 msgid "Fast P-Skip"
 msgstr "Fast P-Skip"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:747
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:753
 msgid "Uncheck to enable fast p-skip"
-msgstr "Desmarqueu per habilitar fast p-skip"
+msgstr "Desmarqueu per habilitar fast p-skip."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:750
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:756
 msgid "DCT decimate"
 msgstr "DCT decimate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:754
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:760
 msgid "Interlace"
 msgstr "Entrella?a"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:757
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:763
 msgid "Encode interlaced"
 msgstr "Codif. entrella?ada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:759
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:765
 msgid "<b>Motion Estimation</b>"
 msgstr "<b>Estimaci? movim.</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:786
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:798
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:792
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:804
 msgid "Enforce the size of a decoded pixel decoded to a certain value. Leave this at 1:1 for non-anamorphic video"
-msgstr "For?a un valor per a la mida d'un determinat pixel descodificat. Deixa aquest valor a 1:1 per a v?deo 'non-anamorphic'"
+msgstr "For?a un valor per a la mida d'un determinat p?xel descodificat. Deixeu aquest valor a 1:1 per a v?deo \"no anam?rfic\"."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:787
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:799
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:793
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:805
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:83
 msgid "1"
 msgstr "1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:790
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1051
-msgid ":"
-msgstr ":"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:807
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:813
 msgid "Set a custom aspect ratio. Default 1:1 is recommended for most video."
-msgstr "Estableix una relaci? d'aspecte personalitzada. El valor predeterminat 1:1 ?s el recomanat per a  la majoria dels v?deos."
+msgstr "Estableix una relaci? d'aspecte personalitzada. El valor predeterminat (1:1) ?s el que es recomana per a  la majoria dels v?deos."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:812
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:818
 msgid "Predefined Aspect Ratios"
-msgstr "Relac. aspecte predefin."
+msgstr "Relac. aspecte predefin. "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:817
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:823
 msgid "Set a common predefined aspect ratio"
-msgstr "Estableix una relaci? d'aspecte predefinida"
+msgstr "Estableix una relaci? d'aspecte predefinida."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:827
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:856
 msgid "<b>Sample Aspect Ratio (A/R)</b>"
 msgstr "<b>Relac. aspecte mostra</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:849
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:878
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:108
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:111
 msgid "CABAC"
 msgstr "CABAC"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:852
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:881
 msgid "Lossless compression method which usually improves the bitrate usage by 15% (especially on high bitrate). Helps the quality a lot but is slower. "
-msgstr "M?tode de compressi? sense p?rdua que generalment millora l'?s de la taxa de bits en un 15% (especialment en cas de taxa de bits alta). Afavoreix molt la qualitat per? es m?s lent."
+msgstr "M?tode de compressi? sense p?rdua que generalment millora l'?s de la taxa de bits en un 15% (especialment en cas de taxa de bits alta). Afavoreix molt la qualitat, per? ?s m?s lent."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:864
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:884
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:107
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:110
+msgid "Trellis"
+msgstr "Trellis"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:893
 msgid "Use rate distortion quantization to find optimal encoding for each block. Level 0 equals disabled, level 1 equals normal and level 2 equals high"
-msgstr "Usa la quantificaci? de l'alteraci? de la velocitat per trobar la codificaci? ?ptima per a cada bloc. El nivell 0 significa deshabilitat, el nivell 1 significa normal i el nivell 2 significa alt"
+msgstr "Utilitza la quantificaci? de l'alteraci? de la taxa per trobar la codificaci? ?ptima per a cada bloc. El nivell 0 significa deshabilitat, el nivell 1 significa normal i el nivell 2 significa alt."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:871
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:900
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:109
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:112
 msgid "Noise Reduction"
 msgstr "Reducci? soroll"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:880
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:909
 msgid "Set the amount of noise reduction"
-msgstr "Estableix el nivell de reducci? de soroll"
+msgstr "Estableix el nivell de reducci? de soroll."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:887
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:916
 msgid "Deblocking Filter :"
 msgstr "Filtre desbloqueig:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:890
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:919
 msgid "Enable in-loop deblocking to filter the video"
-msgstr "Permet el desbloqueig 'in-loop' per filtrar el v?deo"
+msgstr "Permet el desbloqueig \"in-loop\" per filtrar el v?deo."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:903
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:932
 msgid "Set the amount of blurring to use for block edges when they are found"
-msgstr "Estableix el nivell de desenfocament que s'utilitzar? en les vores dels blocs quan es trobin"
+msgstr "Estableix el nivell de desenfocament que s'utilitzar? en les vores dels blocs quan es trobin."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:912
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:941
 msgid "Define the level for when deblocking is applied"
-msgstr "Defineix el nivell per al qual s'aplica el desbloqueig"
+msgstr "Defineix el nivell per al qual s'aplica el desbloqueig."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:915
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:944
 msgid "<i>Threshold</i>"
 msgstr "<i>Llindar</i>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:923
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:952
 msgid "<i>Strength</i>"
 msgstr "<i>For?a</i>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:931
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:960
 msgid "<b>Misc. Options</b>"
 msgstr "<b>Opcions diverses</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:936
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1066
-msgid "Motion & Misc"
-msgstr "Movim. i altres"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:957
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:986
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:129
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:132
 msgid "8x8 Transform"
 msgstr "Transformaci? 8x8"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:960
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:989
 msgid "General block breakdown transformation"
-msgstr "Transformaci? an?lisi general bloc"
+msgstr "Transformaci? per an?lisi general de bloc."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:963
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:992
 msgid "8x8, 8x16 and 16x8 P-frame search"
 msgstr "Cerca fotog-P 8x8, 8x16 i 16x8"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:966
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:995
 msgid "Improve the P-frame quality"
-msgstr "Millora la qualitat del fotog-P"
+msgstr "Millora la qualitat del fotograma-P."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:969
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:998
 msgid "8x8, 8x16 and 16x8 B-frame search"
 msgstr "Cerca fotog-B 8x8, 8x16 i 16x8"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:972
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1001
 msgid "Improve the B-frame quality"
-msgstr "Millora la qualitat del fotograma-B"
+msgstr "Millora la qualitat del fotograma-B."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:975
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1004
 msgid "4x4, 4x8 and 8x4 P-frame search"
 msgstr "Cerca fotog-P 4x4, 4x8 i 8x4"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:978
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1007
 msgid "Further improve the P-frame quality"
-msgstr "Millora addicional qualitat del fotog-P"
+msgstr "Millora encara m?s la qualitat del fotograma-P."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:980
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1009
 msgid "8x8 Intra search"
 msgstr "Cerca fotog-I 8x8"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:983
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1012
 msgid "Enable DCT Intra block search to improve quality"
-msgstr "Habilita la cerca de fotog-I per DCT per tal de millorar la qualitat"
+msgstr "Habilita la cerca de fotogrames-I per DCT per tal de millorar la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:986
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1015
 msgid "4x4 Intra search"
 msgstr "Cerca fotog-I 4x4"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:989
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1018
 msgid "Further enable DCT Intra block search to improve quality"
-msgstr "Habilitaci? addicional de la cerca de fotog-I per DCT per tal de millorar qualitat"
+msgstr "Habilitaci? addicional de la cerca de fotogrames-I per DCT per tal de millorar encara m?s la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:992
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1021
 msgid "<b>Partition Macroblocks</b>"
 msgstr "<b>Macroblocs de partici?</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1014
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1043
 msgid "Bias"
 msgstr "Biaix"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1027
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1056
 msgid "Increase / decrease probability for how often B-frames are used. Will not violate the maximum consecutive frame limit"
-msgstr "Augmenta / disminueix la probabilitat d'?s freq?ent dels fotogrames-B. No vulnerar? el l?mit de m?xims fotogrames consecutius"
+msgstr "Augmenta / disminueix la probabilitat d'?s freq?ent dels fotogrames-B. No vulnerar? el l?mit m?xim de fotogrames consecutius."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1036
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1065
 msgid "Set the maximum number of consecutive B-frames. This defines how many duplicate frames can be droped. Numbers 2 to 5 are recommended. This greatly improves the use of bitrate and quality"
-msgstr "Estableix el nombre m?xim de fotogrames-B consecutius. Defineix quants fotogrames duplicats es poden descartar. Es recomanen els valors de 2 to 5. Millora enormement l'?s de la taxa de bits aix? com la qualitat"
+msgstr "Estableix el nombre m?xim de fotogrames-B consecutius. Defineix quants fotogrames duplicats es poden descartar. Es recomanen els valors de 2 a 5. Millora enormement tant l'?s de la taxa de bits com la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1039
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1068
 msgid "Max Consecutive"
 msgstr "M?x. consecutius"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1050
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1079
 msgid "Bidirectional ME"
 msgstr "EM bidireccional"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1055
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1084
 msgid "Jointly optimize both Motion Vector's in B-frames. This will improve quality but take more time for encoding"
-msgstr "Optimitza tamb? el Vector de Moviment en fotogrames-B. Aix? probablement millorar? la qualitat per? requerir? m?s temps per a la codificaci?"
+msgstr "Optimitza tamb? el vector de moviment en fotogrames-B. Aix? probablement millorar? la qualitat, per? requerir? m?s temps per a la codificaci?."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1057
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1086
 msgid "Weighted biprediction"
 msgstr "Predicci? ponderada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1062
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1091
 msgid "Enables weighting of B-frames to help fades"
-msgstr "Habilita la ponderaci? de fotogrames-B per facilitar les difuminacions"
+msgstr "Habilita la ponderaci? de fotogrames-B per facilitar les fusions (\"fades\")."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1065
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1094
 msgid "Adaptative DCT"
 msgstr "DCT adaptativa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1070
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1099
 msgid "Use fewer B-frame if needed. This is always recommended. If not enabled, the codec will always use the maximum number of consecutive B-frames"
-msgstr "Usa menys fotogrames-B si cal. Aix? sempre es recomana. Si no s'habilita, el c?dec sempre usar? el m?xim nombre de fotogrames-B consecutius"
+msgstr "Usa menys fotogrames-B si cal. Aix? sempre ?s recomanable. Si no s'habilita, el c?dec sempre usar? el m?xim nombre de fotogrames-B consecutius."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1073
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1102
 msgid "Use as reference"
 msgstr "Usa com a refer?ncia"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1078
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1107
 msgid "Allow B-frames to make references non-linearly to another B-frame (instead of creating a duplicate copy)"
-msgstr "Permet als fotogrames-B fer refer?ncies no linealment a un altre fotograma-B (en comptes de crear un duplicat)"
+msgstr "Permet als fotogrames-B fer refer?ncies no linealment a un altre fotograma-B (en comptes de crear-ne un duplicat)."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1084
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1113
 msgid "B-Frame Direct Mode:  "
-msgstr "Mode directe fotog-B:"
+msgstr "Mode adre?ament fotog-B:  "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1092
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1121
 msgid "Auto"
 msgstr "Auto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1093
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1122
 msgid "Temporal"
 msgstr "Temporal"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1094
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1123
 msgid "Spatial"
 msgstr "Espacial"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1097
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1126
 msgid "<b>B-Frames</b>"
 msgstr "<b>Fotogr.-B</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1102
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1131
 msgid "Partitions & Frames"
 msgstr "Particions i fotogr."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1130
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1159
 msgid "Set how much \"bitrate bonus\" a keyframe can get"
-msgstr "Estableix quants \"bons de taxa de bits\" pot obtenir un fotograma clau"
+msgstr "Estableix quants \"bons de taxa de bits\" pot obtenir un fotograma clau."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1133
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1162
 msgid "Keyframe boost (%)"
 msgstr "Millora fotog. clau (%) "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1140
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1169
 msgid "B-frame reduction (%)"
 msgstr "Reducci? fotog-B (%)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1147
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1176
 msgid "Bitrate variability (%)"
 msgstr "Variabilitat taxa bits (%)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1160
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1189
 msgid "Set how much bitrate is deducted from a B-frame as compared to the previous P-frame"
-msgstr "Estableix quina taxa de bits es resta d'un fotograma-B amb comparaci? amb el fotograma-P anterior"
+msgstr "Estableix quina taxa de bits es resta d'un fotograma-B amb comparaci? amb el fotograma-P anterior."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1169
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1198
 msgid "Define how much the bitrate can fluctuate over the entire video. 0% results in a constant bitrate stream, while 100% results in a pure quality based bitrate stream"
 msgstr "Defineix en quina mesura la taxa de bits pot fluctuar al llarg de tot el v?deo. Un 0% suposa un flux constant, mentre que un 100% suposa una taxa de bits basada ?nicament en la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1172
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1201
 msgid "<b>Bitrate</b>"
 msgstr "<b>Taxa de bits</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1190
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1219
 msgid "Min Qp"
 msgstr "QP m?n."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1197
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1226
 msgid "Max Qp"
 msgstr "QP m?x."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1204
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1233
 msgid "Max QP Step"
 msgstr "Salt m?x. QP"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1218
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1247
 msgid "Enforce a minimum quantizer level"
-msgstr "For?a un nivell m?nim de quantificador"
+msgstr "For?a un nivell m?nim de quantificador."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1227
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1256
 msgid "Enforce a maximum quantizer level"
-msgstr "For?a un nivell m?xim de quantificador"
+msgstr "For?a un nivell m?xim de quantificador."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1236
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1265
 msgid "Define how much the quantizer rate can change between two consecutive frames"
-msgstr "Defineix en quina mesura la velocitat del quantificador pot canviar entre dos fotogrames consecutius"
+msgstr "Defineix en quina mesura la taxa del quantificador pot canviar entre dos fotogrames consecutius."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1239
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1268
 msgid "<b>Quantization Limits</b>"
 msgstr "<b>L?mits quantificaci?</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1257
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1286
 msgid "Scene Cut Threshold"
 msgstr "Llindar tall escena"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1271
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1300
 msgid "Increase / decrease sensitivity for detecting Scene Changes to compensate for. Improves I-frame usage and helps quality"
-msgstr "L'increment/decrement de la sensibilitat per detectar Canvis d'escena a compensar. Millora l'?s dels fotogrames-I i afavoreix la qualitat"
+msgstr "?s l'increment o decrement de la sensibilitat per detectar canvis d'escena a compensar. Millora l'?s dels fotogrames-I i afavoreix la qualitat."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1274
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1303
 msgid "Min IDR frame interval"
 msgstr "Interval m?n. fotog. IDR"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1287
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1316
 msgid "Set minimum frame interval between IDR frames. Defines the minimum amount a frame can be reused and referenced by other frames before a new clean one is established"
-msgstr "Estableix l'interval m?nim entre els fotogrames IDR. Defineix el m?nim de cops que es pot reutilitzar i referenciar un fotograma per altres fotogrames abans que se n'estableixi un de net."
+msgstr "Estableix l'interval m?nim entre els fotogrames IDR. Defineix el m?nim de cops que es pot reutilitzar i referenciar un fotograma per altres fotogrames abans que se n'estableixi un de nou."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1296
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1325
 msgid "Set maximum frame interval between IDR frames. Defines the maximum amount a frame can be reused and referenced by other frames before a new clean one is established"
-msgstr "Estableix l'interval m?xim entre fotogrames IDR. Defineix el m?xim nombre de cops que es pot reusar i referenciar un fotograma per altres fotogrames abans que es fixi un altre fotograma net de refer?ncia."
+msgstr "Estableix l'interval m?xim entre fotogrames IDR. Defineix el m?xim nombre de cops que es pot reusar i referenciar un fotograma per altres fotogrames abans que se n'estableixi un altre de nou."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1299
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1328
 msgid "Max IDR frame interval"
 msgstr "Interval m?x. fotog. IDR"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1306
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1335
 msgid "<b>More Rate Settings</b>"
-msgstr "<b>M?s configs. ritme</b>"
+msgstr "<b>M?s configs. taxa</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1324
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1353
 msgid "VBV buffer size"
 msgstr "Mida buffer VBV"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1331
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1360
 msgid "Initial VBV buffer (%)"
 msgstr "Buffer VBV inicial (%)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1338
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1367
 msgid "Maximum local bitrate"
 msgstr "Taxa de bits local m?x. "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1369
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1398
 msgid "<b>Video Buffer Verifier</b>"
 msgstr "<b>Verific. mida v?deo:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1401
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1403
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:117
+msgid "Rate Control"
+msgstr "Control taxa"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1430
 msgid "Allowed variance of average bitrate. Lower values mean less variance. Higher values mean more variance."
 msgstr "Vari?ncia permesa de la mitjana de la taxa de bits. Els valors baixos suposen menys vari?ncia, i els alts suposen m?s vari?ncia."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1404
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1433
 msgid "Bitrate Variance"
 msgstr "Vari?ncia taxa bits "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1417
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1446
 msgid "Allowed variance of average quantizer or quality. Lower values mean less variance. Higher values mean more variance. Note that 0 means constant quality while 1 means constant fluctuation. Recommended 0.6."
 msgstr "Vari?ncia permesa de la mitjana del quantificador o de la qualitat. Els valors baixos suposen menys vari?ncia, i els alts m?s vari?ncia. Noteu que 0 suposa una qualitat constant, mentre que 1 suposa fluctuaci? constant. El valor recomanat ?s 0.6."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1426
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1455
 msgid "Reduced fluctuations in Quantizer (before curve compression)"
 msgstr "Fluctuacions redu?des en el quantificador (abans de la corba de compressi?)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1435
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1464
 msgid "Reduce fluctuations in QP (after curve compression)"
-msgstr "Redueix les fluctuacions en el QP (despr?s de la corba de compressi?)"
+msgstr "Fluctuacions redu?des en el QP (despr?s de la corba de compressi?)."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1438
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1467
 msgid "Quantizer Compression"
 msgstr "Compressi? quantificador "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1445
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1474
 msgid "Temp. Blur of est Frame Complexity"
 msgstr "Fluctuac. temp. complexitat fotog. est."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1452
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1481
 msgid "Temp. Blur of Quant after CC"
 msgstr "Fluctuac. temp. del quantif. despr?s CC "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1483
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1488
+msgid "<b>Misc</b>"
+msgstr "<b>Diverses</b>"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1512
 msgid "Quantization factors used between I- and P- frames"
-msgstr "Factors quantificaci? usats entre fotog-I i P"
+msgstr "Factors de quantificaci? usats entre fotog-I i fotog-P."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1492
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1521
 msgid "Quantization used between P- and B- frames"
 msgstr "Quantificaci? usada entre fotog-P i B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1501
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1530
 msgid "Quantization difference between chroma (color) and luma (brightness)"
-msgstr "Difer?ncia de quantificaci? entre croma (color) i luma (lluminositat) "
+msgstr "Difer?ncia de quantificaci? entre croma (color) i luma (lluminositat). "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1504
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1533
 msgid "Factor between I and P frame Quants"
 msgstr "Factor entre quantifics. fotog-I i P"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1511
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1540
 msgid "Factor between P and B frame Quants"
 msgstr "Factor entre quantifics. fotog-P i B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1518
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1547
 msgid "Chroma QP Offset"
-msgstr "Offset QP croma "
+msgstr "Despla?. QP croma "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1525
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1554
 msgid "<b>Quantizers</b>"
 msgstr "<b>Quantificadors</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1543
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1572
 msgid "Custom matrix"
 msgstr "Matriu personal."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1552
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1128
-msgid "Open CQM file"
-msgstr "Obre fitxer de CQM"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1558
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1587
 msgid "JVT matrix"
 msgstr "Matriu JVT"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1566
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1595
 msgid "Flat matrix"
 msgstr "Matriu plana "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1575
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1136
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1568
-msgid "Edit Custom Matrix"
-msgstr "Edita matriu personalitzada"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1580
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1609
 msgid "Edit a loaded custom quantization matrix file"
 msgstr "Edita un fitxer de matriu de quantificaci? personalitzada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1588
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1617
 msgid "<b>Quantization Matrices</b>"
 msgstr "<b>Matrius quantificaci?</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1593
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1622
 msgid "More"
 msgstr "M?s"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1601
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1630
 msgid "Defaults"
-msgstr "Vals. predet."
+msgstr "Valors predet."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:186
-msgid "XVCD encoding"
-msgstr "Codificaci? XVCD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:93
+msgid "Paused"
+msgstr "Atura"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:195
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:250
-msgid "Constant Quantizer"
-msgstr "Quantificador constant"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:109
+msgid ""
+"<b>Encoding is paused.</b>\n"
+"\n"
+"You can either resume or Abort it."
+msgstr ""
+"<b>S'ha aturat la codificaci?.</b>\n"
+"\n"
+"Podeu reprendre-la o b? cancel?lar-la."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:209
-msgid "Constant Bitrate"
-msgstr "Taxa bits constant"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:136
+msgid "Abort"
+msgstr "Cancel?la"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:223
-msgid "Dual pass"
-msgstr "Pass. dual"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_pause.cpp:158
+msgid "Resume"
+msgstr "Repr?n"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:237
-msgid "Min bitrate (kbps) :"
-msgstr "Taxa bits m?n. (kbps) :"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:92
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:237
+msgid "Subtitle Size and Position"
+msgstr "Mida i posici? subt?tols"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:245
-msgid "Max bitrate (kbps) :"
-msgstr "Taxa bits m?x. (kbps):"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:251
+msgid "Font Size:"
+msgstr "Mida lletra: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:281
-msgid "Default mpeg"
-msgstr "Mpeg predeterminat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:585
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:657
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:719
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:779
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:842
+msgid "label1"
+msgstr "etiqueta1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:285
-msgid "Tmpeng "
-msgstr "Tmpeng "
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:706
+msgid "Alert"
+msgstr "Av?s"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:289
-msgid "Anim?"
-msgstr "Anim?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:121
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:211
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:474
+msgid "Cannot open directory as a file"
+msgstr "No es pot obrir un directori com un fitxer"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:293
-msgid "K-VCD"
-msgstr "K-VCD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:335
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
+#: avidemux/ADM_ocr/adm_glyph.cpp:221
+#: avidemux/gtk_gui.cpp:894
+#: avidemux/gtk_gui.cpp:1523
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
+msgid "File error"
+msgstr "S'ha produ?t un error de fitxer"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:299
-msgid "Gop Size  (12):"
-msgstr "Mida GOP  (12):"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:335
+#: avidemux/gtk_gui.cpp:891
+#, c-format
+msgid "Cannot open \"%s\"."
+msgstr "No es pot obrir \"%s\"."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvcd.cpp:315
-msgid "Use Xvid ratecontrol"
-msgstr "Usa el control de velocitat de Xvid"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:345
+msgid "Overwrite file ?"
+msgstr "Voleu sobreescriure el fitxer?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:237
-msgid "Xvid Encoder"
-msgstr "Codificador Xvid"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:370
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:384
+msgid "It could be possible that you try to overwrite an input file!"
+msgstr "Podria ser que intent?ssiu sobreescriure un fitxer d'entrada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:258
-msgid "Constant Bitrate (kbps)"
-msgstr "Taxa bits constant (kbps)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:395
+msgid "Cannot write the file"
+msgstr "No es pot escriure el fitxer"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:266
-msgid "Dual pass (MBytes)"
-msgstr "2 Passades (MBytes)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:395
+#, c-format
+msgid "No write access to \"%s\"."
+msgstr "No teniu acc?s d'escriptura a \"%s\"."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:292
-msgid "Basic"
-msgstr "B?sica"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:529
+msgid "Images"
+msgstr "Imatges"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:301
-msgid "Motion Search"
-msgstr "Cerca moviment"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:541
+msgid "All"
+msgstr "Tot tipus"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:317
-msgid "Max I frame interval "
-msgstr "M?x. interval fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_gladeSupport.cpp:252
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_gladeSupport.cpp:276
+#, c-format
+msgid "Couldn't find pixmap file: %s"
+msgstr "No s'ha pogut trobar el fitxer de pixmap: %s"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:333
-msgid "Min I frame interval"
-msgstr "Min. interval fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:64
+msgid "Add Video Filter"
+msgstr "Afegeix Filtre de V?deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:357
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:884
-msgid "0 - None"
-msgstr "0 - Cap"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:98
+msgid "Transformation"
+msgstr "Transformaci?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:361
-msgid "1- Very low"
-msgstr "1- Molt baixa"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:123
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:285
+msgid "Interlacing"
+msgstr "Entrella?at"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:365
-msgid "2- Low"
-msgstr "2- Baixa"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:148
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:309
+msgid "Colors"
+msgstr "Colors"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:369
-msgid "3- Medium"
-msgstr "3- Mitjana"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:173
+msgid "Denoise"
+msgstr "Filtra soroll"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:373
-msgid "4- High"
-msgstr "4- Alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:198
+msgid "Sharpen/Blur"
+msgstr "Enfoca/Desenfoca"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:377
-msgid "5- Very High"
-msgstr "5- Molt alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:223
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:381
+msgid "Subtitles"
+msgstr "Subt?tols"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:381
-msgid "6- Ultra High"
-msgstr "6- Ultra alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:248
+msgid "Miscellaneous"
+msgstr "Miscel?l?nia"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:395
-msgid "H263 Quantizer"
-msgstr "Quantificador H263"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:242
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:413
+msgid "The filter is already partial"
+msgstr "El filtre ja ?s parcial"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:400
-msgid "MPEG Quantizer"
-msgstr "Quantificador MPEG"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:340
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:342
+msgid "Load set of filters"
+msgstr "Carrega grup de filtres"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:407
-msgid "Advanced"
-msgstr "Avan?at"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:355
+msgid "Nothing to save"
+msgstr "No hi ha res per desar"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:416
-msgid "Min I Frame Qzer"
-msgstr "M?n. qfic. fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:359
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:361
+msgid "Save set of filters"
+msgstr "Desa grup de filtres"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:424
-msgid "Max I Frame Qzer"
-msgstr "M?x. qfic. fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:52
+msgid "Video Filters"
+msgstr "Filtres V?deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:432
-msgid "Min P Frame Qzer"
-msgstr "M?n. qfic. fotog-P"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:112
+msgid "VCD res"
+msgstr "Res. VCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:440
-msgid "Max P Frame Qzer"
-msgstr "M?x. qfic. fotog-P"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:118
+msgid "SVCD res"
+msgstr "Res. SVCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:480
-msgid "Quantizer"
-msgstr "Quantificador"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:124
+msgid "DVD res"
+msgstr "Res. DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:485
-msgid "Not Yet!"
-msgstr "Encara no!"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:130
+msgid "Half D1 res"
+msgstr "Res. mig D1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid.cpp:490
-msgid "B Frames"
-msgstr "Fotogrames-B"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:156
+msgid "Save as script"
+msgstr "Desa-ho com a script"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:109
-msgid "Select Xvid matrix file to load"
-msgstr "Seleccioneu la matriu Xvid per carregar"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:123
+msgid "Video Filter Manager"
+msgstr "Gestor de Filtres de V?deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:121
-msgid "Error Loading"
-msgstr "S'ha produ?t un error en la c?rrega"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:145
+msgid "Open filter list [Ctrl-O]"
+msgstr "Obre llista filtres [Ctrl-O]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:121
-msgid "Error loadind the custom matrix file."
-msgstr "S'ha produ?t un error en carregar el fitxer de la matriu personalitzada"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:154
+msgid "Save filter list [Ctrl-S]"
+msgstr "Desa llista filtres [Ctrl-S]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:139
-msgid "Matrix Loaded"
-msgstr "S'ha carregat la matriu"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:162
+msgid "Save Script"
+msgstr "Desa script"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:139
-msgid "The custom matrix file has been successfully loaded."
-msgstr "El fitxer de matriu personalitzada s'ha carregat satisfact?riament"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:165
+msgid "Save as script [Ctrl-J]"
+msgstr "Desa com a script [Ctrl-J]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:479
-msgid "Select Custom Matrix File to write"
-msgstr "Seleccioneu el fitxer de matriu personalitzada per escriure"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:173
+msgid "DVD Res"
+msgstr "Res. DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:484
-msgid "Error Writing"
-msgstr "S'ha produ?t un error d'escriptura"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:176
+msgid "DVD resolution [Ctrl-1]"
+msgstr "Resoluci? DVD [Ctrl-1]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:484
-msgid "Error writing the custom matrix file."
-msgstr "S'ha produ?t un error en escriure el fitxer de matriu personalitzada"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:184
+msgid "Half D1 Res"
+msgstr "Res. mig D1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:700
-msgid "XviD encoding options"
-msgstr "Opcions de codificaci? de l'XviD"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:187
+msgid "Half D1 resolution [Ctrl-2]"
+msgstr "Resoluci? mig D1 [Ctrl-2]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:734
-msgid "Encoding type:"
-msgstr "Tipus de codificaci?:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:195
+msgid "SVCD Res"
+msgstr "Res. SVCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:739
-msgid "Bitrate (kb/s):"
-msgstr "Taxa de bits (kb/s):"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:198
+msgid "SVCD resolution [Ctrl-3]"
+msgstr "Resoluci? SVCD [Ctrl-3]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:744
-msgid "Quantizer:"
-msgstr "Quantificador:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:206
+msgid "VCD Res"
+msgstr "Res. VCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:756
-msgid "Select 1-pass or 2-pass encoding"
-msgstr "Seleccioneu descodificaci? en 1 o en 2 passades"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:209
+msgid "VCD resolution [Ctrl-4]"
+msgstr "Resoluci? VCD [Ctrl-4]"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:760
-msgid "Single pass - bitrate"
-msgstr "Passada ?nica - taxa de bits"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:260
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:135
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:148
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:138
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:151
+msgid "Transform"
+msgstr "Transforma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:764
-msgid "Single pass - quantizer"
-msgstr "Passada ?nica - quantificador"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:333
+msgid "Noise"
+msgstr "Soroll"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:768
-msgid "Two pass, final size"
-msgstr "2 Passades - mida final"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:357
+msgid "Sharpness"
+msgstr "Nitidesa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:772
-msgid "Two pass, average bitrate"
-msgstr "2 Passades - taxa de bits mitjana"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:405
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:117
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:120
+msgid "Misc"
+msgstr "Diversos"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:776
-msgid "Same Qz as input"
-msgstr "Mateix quantif. que l'entrada"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:416
+msgid "External"
+msgstr "Externs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:785
-msgid "Target video bitrate"
-msgstr "Taxa bits v?deo sortida"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:427
+msgid "Add selected filter to the Active Filters list"
+msgstr "Afegeix filtre seleccionat a llista de filtres actius"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:792
-msgid "Constant quantizer - each frame will get the same compression"
-msgstr "Quantificador constant - cada fotograma se sotmetr? a la mateixa compressi?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:433
+msgid "<b>Available Filters</b>"
+msgstr "<b>Filtres Disponibles</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:794
-msgid "Variable bitrate mode"
-msgstr "Mode taxa de bits variable"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:478
+msgid "Remove filter"
+msgstr "Treu filtre"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:806
-msgid "_Interlaced"
-msgstr "Entrella?at"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:487
+msgid "Move filter down"
+msgstr "Mou filtre avall"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:809
-msgid "Enables interlaced frame support - use only if your source contains interlacing artifacts (i.e. fields instead of progressive frames)"
-msgstr "Habilita el suport de fotograma entrella?at. Utilitzeu-lo nom?s si la vostra font cont? entrella?aments (p.e. marcs en comptes de fotogrames progressius)"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:496
+msgid "Move filter up"
+msgstr "Mou filtre amunt"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:811
-msgid "_Greyscale"
-msgstr "Escala de grisos"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:502
+msgid "P_artial"
+msgstr "P_arcial"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:814
-msgid "Encode in black & white"
-msgstr "Codifica en blanc i negre"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:505
+msgid "Apply the current filter only to a part of the file"
+msgstr "Aplica el filtre actual nom?s a una part del fitxer"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:820
-msgid "Ca_rtoon mode"
-msgstr "Mode dibuixos anim."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:510
+msgid "Configure filter"
+msgstr "Configura filtre"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:823
-msgid "Enables special motion estimation features for cartoons/anime"
-msgstr "Habilita les caracter?stiques especials d'estimaci? de moviment per a caricatures/animacions"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:520
+msgid "C_onfigure"
+msgstr "C_onfigura"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:825
-msgid "C_hroma optimizer"
-msgstr "Optimitzador de croma"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:524
+msgid "<b >Active Filters</b>"
+msgstr "<b >Filtres Actius</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:828
-msgid "Enables a chroma optimizer prefilter"
-msgstr "Habilita prefiltre optimitzador croma"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:551
+msgid "_Preview"
+msgstr "_Previsualitza"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:834
-msgid "Turbo Mode"
-msgstr "Mode turbo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_color.cpp:71
+msgid "Select Color"
+msgstr "Selecciona color"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:837
-msgid "Enables fast 1st pass encoding"
-msgstr "Habilita la codificaci? r?pida en la primera passada"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:73
+msgid "_Encoding mode:"
+msgstr "Mode de _codificaci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:839
-msgid "Packed bitstream"
-msgstr "Flux bits empaquetat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:100
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:134
+msgid "_Previous"
+msgstr "_Anterior"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:842
-msgid "Enables Divx like packed vop, DO NOT SET, it is ugly"
-msgstr "Habilita el vop empaquetat com a Divx. No el seleccioneu, queda lleig."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:108
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:164
+msgid "_Next"
+msgstr "_Seg?ent"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:844
-msgid "Main"
-msgstr "Principals"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
+msgid "Output file error"
+msgstr "S'ha produ?t un error en el fitxer de sortida"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:863
-msgid "Motion search precision:"
-msgstr "Precisi? de cerca de moviment:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
+#, c-format
+msgid "Could not open \"%s\" for writing."
+msgstr "No es pot obrir el fitxer \"%s\" per a escriptura"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:867
-msgid "VHQ mode:"
-msgstr "Mode VHQ:"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:189
+msgid "Problem loading sub"
+msgstr "S'ha produ?t un problema en carregar el fitxer de SUB"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:880
-msgid "Higher settings give higher quality results, at the cost of slower encoding"
-msgstr "Uns valors m?s elevats donen millor qualitat, per? a canvi d'una descodificaci? m?s lenta."
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:295
+msgid "Select Glyphfile to save to"
+msgstr "Seleccioneu un fitxer de glif per desar."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:888
-msgid "1 - Very low"
-msgstr "1 - Molt baixa"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:362
+msgid "Sure ?"
+msgstr "N'esteu segur?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:892
-msgid "2 - Low"
-msgstr "2 - Baixa"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:53
+msgid "Select GlyphFile to edit"
+msgstr "Seleccioneu un fitxer de glif per editar."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:896
-msgid "3 - Medium"
-msgstr "3 - Mitjana"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:121
+msgid "String"
+msgstr "Cadena"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:900
-msgid "4 - High"
-msgstr "4 - Alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:123
+msgid "Search string"
+msgstr "Cerca cadena"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:904
-msgid "5 - Very high"
-msgstr "5 - Molt alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:149
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:192
+msgid "End reached"
+msgstr "S'ha arribat al final"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:908
-msgid "6 - Ultra high"
-msgstr "6 - Ultra alta"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:149
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:192
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:216
+msgid "No more glyphs"
+msgstr "No hi ha m?s glifos"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:917
-msgid "VHQ enables an additional search process to increase quality"
-msgstr "VHQ habilita un proc?s de cerca addicional per augmentar la qualitat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:216
+msgid "Head reached"
+msgstr "S'ha arribat al principi"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:921
-msgid "0 - Off"
-msgstr "0 - Deshabilitat"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:344
+msgid "dialog1"
+msgstr "di?leg1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:925
-msgid "1 - Mode decision"
-msgstr "1 - Mode decisi?"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:396
+msgid "Prev. Empty"
+msgstr "Anterior buida"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:929
-msgid "2 - Limited search"
-msgstr "2 - Cerca limitada"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_editglyph.cpp:418
+msgid "Next Empty"
+msgstr "Seg?ent buida"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:933
-msgid "3 - Medium search"
-msgstr "3 - Cerca mitjana"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:45
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:51
+msgid "Auto (might not work)"
+msgstr "Auto (potser no funcionar?)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:937
-msgid "4 - Wide search"
-msgstr "4 - Cerca ?mplia"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:46
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:178
+msgid "Top field first"
+msgstr "Marc alt abans"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:947
-msgid "C_hroma motion"
-msgstr "Moviment c_roma"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:47
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:177
+msgid "Bottom field first"
+msgstr "Marc baix abans"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:950
-msgid "Use chroma information to estimate motion"
-msgstr "Usa la informaci? de croma per estimar el moviment"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:52
+msgid "Bottom field (keep top)"
+msgstr "Marc baix (deixa amunt)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:952
-msgid "_4MV"
-msgstr "_4MV"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:53
+msgid "Top field (keep bottom)"
+msgstr "Marc alt (deixa avall)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:955
-msgid "Use 4 motion vectors per macroblock, might give better compression"
-msgstr "Usa vectors de moviment per macrobloc, pot ser que doni millor compressi?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:58
+msgid "Cubic interpolation"
+msgstr "Interpolaci? c?bica"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:957
-msgid "HQ _AC"
-msgstr "HQ _AC"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:59
+msgid "Modified ELA"
+msgstr "ELA modificada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:960
-msgid "Enable a better prediction of AC component. Turns on Lumi masking - applies more compression to dark/light areas that the eye cannot notice easily"
-msgstr "Permet una predicci? m?s acurada dels components AC. Posa la m?scara Lumi - aplica m?s compressi? als sectors clarobscurs que l'ull no pot apreciar f?cilment"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:60
+msgid "Kernel interpolation"
+msgstr "Interpolaci? Kernel"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:966
-msgid "I-frame interval - Min:"
-msgstr "Interval Fotog-I - m?n:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:61
+msgid "Modified ELA-2"
+msgstr "ELA-2 modificada"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:974
-msgid "Minimum space between I-frames, 1 will disable forced I-frame spacing"
-msgstr "M?nim espai entre fotogrames-I, 1 deshabilitar? l'espaiat for?at de fotograma-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:66
+msgid "4 fields check"
+msgstr "Controla 4 marcs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:976
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1194
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1199
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1204
-msgid "Max:"
-msgstr "m?x.:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:67
+msgid "5 fields check"
+msgstr "Controla 5 marcs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:984
-msgid "Maximum number of frames allowed between I-frames"
-msgstr "M?xim nombre de fotogrames perm?s entre fotogrames-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:68
+msgid "4 fields check (no avg)"
+msgstr "Controla 4 marcs (sense mitjana)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:999
-msgid "Number of B-frames:"
-msgstr "Nombre de fotog-B:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:69
+msgid "5 fields check (no avg)"
+msgstr "Controla 5 marcs (sense mitjana)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1007
-msgid "Maximum number of sequential B-frames (when set to 0, the original I/P encoder is used)"
-msgstr "M?xim nombre de fotogrames-B seq?encials (quan es fixa a 0, s'utilitza el codificador original I/P)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:75
+msgid "No link"
+msgstr "Sense enlla?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1013
-msgid "_Qpel"
-msgstr "_Qpel"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:76
+msgid "Full link"
+msgstr "Enlla? complet"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1016
-msgid "Use Quarter pixel resolution for a more precise motion estimation"
-msgstr "Usa la resoluci? de quart de p?xel per una estimaci? del moviment m?s precisa"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:77
+msgid "Y to UV"
+msgstr "Y a UV"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1018
-msgid "_GMC"
-msgstr "_GMC"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:78
+msgid "UV to Y"
+msgstr "UV a Y"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1021
-msgid "Global Motion Compensation can save bits on camera pans, zooming and rotation"
-msgstr "La Compensaci? Global de Moviment pot estalviar bits en panor?miques de c?mera, zooming i rotaci?."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:84
+msgid "2"
+msgstr "2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1023
-msgid "_BVHQ"
-msgstr "_BVHQ"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:91
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:92
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:90
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:111
+msgid "_Field order:"
+msgstr "_Ordre marcs: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1026
-msgid "Produces nicer-looking B-frames"
-msgstr "Produeix fotogrames-B m?s vistosos"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:92
+msgid "_Interpolate:"
+msgstr "_Interpola: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1040
-msgid "As input"
-msgstr "Com a l'entrada"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:94
+msgid "_Type:"
+msgstr "_Tipus: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1043
-msgid "Get PAR from input video file"
-msgstr "Obt? el PAR a partir d'un fitxer d'entrada de v?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:95
+msgid "_MntMode:"
+msgstr "_MntMode: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1049
-msgid "Pixel Width"
-msgstr "Ampl. Pixel"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:96
+msgid "_Link:"
+msgstr "_Enlla?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1060
-msgid "Pixel Height"
-msgstr "Al?. Pixel"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:97
+msgid "_AP type:"
+msgstr "Tipus _AP: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1061
-msgid "Pixel Aspect Ratio"
-msgstr "Relaci? aspecte p?xel"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:100
+msgid "Use ch_roma to evalute"
+msgstr "Usa c_roma per avaluar"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1079
-msgid "Quantization type:"
-msgstr "Tipus quantificaci?:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:101
+msgid "Try _weave"
+msgstr "Prova entretei_xir"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1083
-msgid "_H.263"
-msgstr "_H.263"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:102
+msgid "_Denoise"
+msgstr "Filtra _soroll"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1086
-msgid "H.263 quantizers smooth the picture (useful at lower bitrates)"
-msgstr "Els quantificadors H.263 suavitzen el quadre (s?n ?tils en els casos de les taxes de bit m?s baixes)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:103
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:94
+msgid "_Sharp"
+msgstr "_Nitideja"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1090
-msgid "_MPEG"
-msgstr "_MPEG"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:104
+msgid "_Evalute all frames"
+msgstr "_Avalua TOTS fotogr."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1093
-msgid "MPEG quantizers (slightly slower) produce sharper picture (useful at higher bitrates)"
-msgstr "Quantificadors MPEG: (lleugerament m?s lents) produeixen un quadre m?s n?tid (s?n ?tils en els casos de les taxes de bits m?s altes)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:107
+msgid "Motion threshold, l_uma:"
+msgstr "Llindar movim., _luma: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1097
-msgid "_Custom Matrix"
-msgstr "_Matriu personalitzada"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:108
+msgid "Motion threshold, c_hroma:"
+msgstr "Llindar movim., _croma: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1107
-msgid "Load Custom Matrix:  "
-msgstr "Carrega matriu personalitzada:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:109
+msgid "Area com_bing threshold:"
+msgstr "Llindar zona pe_ntinat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1153
-msgid "I-frame quantizer - Min:"
-msgstr "Quantificador fotog-I - m?n.:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:110
+msgid "Combe_d threshold:"
+msgstr "Llindar pen_tinat:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1158
-msgid "P-frame quantizer - Min:"
-msgstr "Quantificador fotog-P - m?n.:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:111
+msgid "Artefact _protection threshold:"
+msgstr "Llindar protecci? fen?mens: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1163
-msgid "B-frame quantizer - Min:"
-msgstr "Quantificador fotog-B - m?n.:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:120
+msgid "TDeint"
+msgstr "TDeint"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1176
-msgid "Minimum quantizer allowed for I-frames"
-msgstr "Quantificador m?nim perm?s per a fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:27
+msgid "_Hours:"
+msgstr "_Hores: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1182
-msgid "Minimum quantizer allowed for P-frames"
-msgstr "Quantificador m?nim perm?s per a fotog-P"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:28
+msgid "_Minutes:"
+msgstr "_Minuts: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1188
-msgid "Minimum quantizer allowed for B-frames"
-msgstr "Quantificador m?nim perm?s per a fotog-B"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:29
+msgid "_Seconds:"
+msgstr "_Segons: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1217
-msgid "Maximum quantizer allowed for I-frames"
-msgstr "Quantificador m?xim perm?s per a fotog-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:88
+msgid "_Subtitle file:"
+msgstr "Fitxer de _subt?tols: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1223
-msgid "Maximum quantizer allowed for P-frames"
-msgstr "Quantificador m?xim perm?s per a fotog-P"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:89
+msgid "_Font (TTF):"
+msgstr "_Lletra (TTF)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1229
-msgid "Maximum quantizer allowed for B-frames"
-msgstr "Quantificador m?xim perm?s per a fotog-B"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:104
+msgid "_Encoding:"
+msgstr "_Codificaci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1231
-msgid "Quantizer restrictions"
-msgstr "Restriccions quantificador"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:106
+msgid "S_elect C_olor"
+msgstr "Selecciona _color"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1235
-msgid "_Trellis quantization"
-msgstr "Quantificaci? de _Trellis"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:107
+msgid "Set Size and _Position"
+msgstr "Estableix mida i posici?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1238
-msgid "Rate distortion quantization, will find optimal encoding for each block"
-msgstr "Quantificaci? de l'alteraci? de la velocitat. Trobar? la codificaci? ?ptima per a cada bloc"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:108
+msgid "_Auto split"
+msgstr "_Autodivisi?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1268
-msgid "I-frame boost (%):"
-msgstr "Millora fotog-I (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:109
+msgid "_Delay (ms):"
+msgstr "_Retard (ms): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1273
-msgid "I-frames closer than ... frames..."
-msgstr "Fotogrames-I m?s n?tids que... fotogrames..."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp:112
+msgid "Subtitler"
+msgstr "Subtitler"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1278
-msgid "...are reduced by (%):"
-msgstr "...s'han redu?t en un (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:170
+msgid "_Use systray while encoding"
+msgstr "_Usa la safata de sistema en codificar"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1283
-msgid "Max overflow improvement (%):"
-msgstr "Millora desbordament m?x. (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:171
+msgid "_Accept non-standard audio frequency for DVD"
+msgstr "_Permet freq. d'?udio no est?ndard per a DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1288
-msgid "Max overflow degradation (%):"
-msgstr "Degradaci? desbord. m?x. (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:172
+msgid "_Use libavcodec MPEG-2 decoder"
+msgstr "_Usa el descodificador d'MPEG-2 libavcodec"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1300
-#, c-format
-msgid "A value of 20 will give 20% more bits to every I-frame"
-msgstr "Un valor de 20 aportar? un 20% m?s de bits a cada fotograma-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:173
+msgid "Create _OpenDML files"
+msgstr "Crea fitxers d'_OpenDML"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1306
-msgid "I-frames appearing in the range below this value will be treated as consecutive keyframes"
-msgstr "Els fotogrames-I que apareixen en el rang per sota d'aquest valor es tractaran com a fotogrames clau consecutius"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:174
+msgid "Automatically _index MPEG files"
+msgstr "_Indexa autom?ticament els fitxers d'MPEG"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1311
-msgid "Reduction of bitrate for the first consecutive I-frames. The last I-frame will get treated normally"
-msgstr "Reducci? de la taxa de bits pels primers fotogrames-I consecutius. Es tractar? normalment l'?ltim fotograma-I"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:175
+msgid "Automatically _swap A and B if A>B"
+msgstr "Inter_canvia autom?ticament A i B si A > B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1316
-msgid "How much of the overflow the codec can eat into during undersized sections - larger values will bridge the gap faster"
-msgstr "Valor del desbordament que el c?dec pot tractar en les seccions sotadimensionades - els valors m?s elevats tancaran l'escletxa m?s r?pidament"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:176
+msgid "_Disable NUV audio sync"
+msgstr "_Desactiva la sincronitzaci? d'?udio NUV"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1321
-msgid "How much of the overflow the codec can eat into during oversized sections - larger values will bridge the gap faster"
-msgstr "Valor del desbordament que el c?dec pot tractar en les seccions sobredimensionades - els valors m?s elevats tancaran l'escletxa m?s r?pidament"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:177
+msgid "_Load external filters"
+msgstr "_Carrega filtres externs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1323
-msgid "Two pass tuning"
-msgstr "Personalit. 2 passades"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:179
+msgid "Automatically _build VBR map"
+msgstr "Construeix autom?ticament el _mapa VBR"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1340
-msgid "High bitrate scenes (%):"
-msgstr "Escenes taxa bits alta (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:180
+msgid "Automatically _rebuild index"
+msgstr "_Reconstrueix l'?ndex autom?ticament"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1345
-msgid "Low bitrate scenes (%):"
-msgstr "Escenes taxa bits baixa (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:181
+msgid "Automatically remove _packed bitstream"
+msgstr "_Treu autom?ticament el flux de bits empaquetat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1350
-msgid "Overflow control strength (%):"
-msgstr "Poder control desbordam. (%):"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:183
+msgid "_Number of threads:"
+msgstr "_Nombre de camins: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1362
-msgid "The higher this value, the more bits get taken from frames larger than the average size, and redistributed to others"
-msgstr "Com m?s alt ?s aquest valor, m?s bits es prenen dels fotogrames amb mida superior a la mida mitjana i es distribueixen cap als altres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:187
+msgid "Above normal"
+msgstr "Per sobre del normal"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1367
-msgid "The higher this value, the more bits get assigned to frames below the average frame size"
-msgstr "Com m?s alt ?s aquest valor, m?s bits s'assignen als fotogrames amb mida inferior a la mitjana"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:189
+msgid "Below normal"
+msgstr "Per sota del normal"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1372
-msgid "0 = default from core (let XviD decide), else overflow payback percent per frame"
-msgstr "0 = predeterm. (deixar que XviD decideixi), sin? valor del percentatge de desbordament per fotograma"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
+msgid "_Encoding priority:"
+msgstr "Prioritat de _codificaci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1374
-msgid "Curve compression"
-msgstr "Corba compressi?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
+msgid "_Indexing/unpacking priority:"
+msgstr "Prioritat _indexaci?/desempaquet.:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1378
-msgid "Second Pass"
-msgstr "Segona passada"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:194
+msgid "_Playback priority:"
+msgstr "_Prioritat de playback: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1591
-msgid "<b>Intra Matrix</b>"
-msgstr "<b>Matriu Intra</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:196
+msgid "_Split MPEG files every (MB):"
+msgstr "_Divideix els fitxers d'MPEG cada n MB: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:1609
-msgid "<b>Inter Matrix</b>"
-msgstr "<b>Matriu Inter</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
+msgid "_Use alternative tag for MP3 in .mp4"
+msgstr "_Usa etiqueta (tag) alternativa per a MP3 en .mp4."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:327
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:241
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:396
-msgid "The filter is already partial"
-msgstr "El filtre ja ?s parcial"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:201
+msgid "GTK+ (slow)"
+msgstr "Gtk (lenta)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:455
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:457
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:347
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:349
-msgid "Load set of filters"
-msgstr "Carrega grup de filtres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
+msgid "XVideo (best)"
+msgstr "Xv (millor)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:464
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:362
-msgid "Nothing to save"
-msgstr "No res per desar"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:207
+msgid "SDL (GDI)"
+msgstr "SDL (bona)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:468
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:470
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:366
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:368
-msgid "Save set of filters"
-msgstr "Desa grup de filtres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:208
+msgid "SDL (DirectX)"
+msgstr "SDL (DirectX)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:64
-msgid "Add Video Filter"
-msgstr "Afegeix Filtre de V?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:210
+msgid "SDL (good)"
+msgstr "SDL (bona)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:98
-msgid "Transformation"
-msgstr "Transformaci?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:214
+msgid "Video _display:"
+msgstr "_Visualitzaci? v?deo: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:148
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:309
-msgid "Colors"
-msgstr "Colors"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:219
+msgid "No alerts"
+msgstr "No mostris cap av?s"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:198
-msgid "Sharpen/Blur"
-msgstr "Enfoca/Desenfoca"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:220
+msgid "Display only error alerts"
+msgstr "Mostra nom?s els avisos d'error"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:223
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:381
-msgid "Subtitles"
-msgstr "Subt?tols"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:221
+msgid "Display all alerts"
+msgstr "Mostra tots els avisos"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:248
-msgid "Miscellaneous"
-msgstr "Miscel?l?nia"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:223
+msgid "_Message level:"
+msgstr "_Missatges a mostrar"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:123
-msgid "Video Filter Manager"
-msgstr "Gestor de Filtres de V?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:228
+msgid "PCM"
+msgstr "PCM"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:145
-msgid "Open filter list [Ctrl-O]"
-msgstr "Obre llista filtres [Ctrl-O]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:229
+msgid "Master"
+msgstr "Master"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:154
-msgid "Save filter list [Ctrl-S]"
-msgstr "Desa llista filtres [Ctrl-S]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:230
+msgid "_Volume control:"
+msgstr "_Control de volum: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:162
-msgid "Save Script"
-msgstr "Desa script"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:235
+msgid "No downmixing"
+msgstr "Sense reduir pistes"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:165
-msgid "Save as script [Ctrl-J]"
-msgstr "Desa com a script [Ctrl-J]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:237
+msgid "Pro Logic"
+msgstr "Pro Logic"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:173
-msgid "DVD Res"
-msgstr "Res. DVD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:238
+msgid "Pro Logic II"
+msgstr "Pro Logic II"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:176
-msgid "DVD resolution [Ctrl-1]"
-msgstr "Resoluci? DVD [Ctrl-1]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:240
+msgid "_Local playback downmixing:"
+msgstr "_Reduc. pistes en reproduc. local: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:184
-msgid "Half D1 Res"
-msgstr "Res. mig D1"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:272
+msgid "_Audio output:"
+msgstr "Sortida d'_?udio:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:187
-msgid "Half D1 resolution [Ctrl-2]"
-msgstr "Resoluci? mig D1 [Ctrl-2]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:274
+msgid "ALSA _device:"
+msgstr "_Dispositiu ALSA: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:195
-msgid "SVCD Res"
-msgstr "Res. SVCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:285
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:51
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:72
+msgid "_Horizontal deblocking"
+msgstr "Desbloqueig _horitzontal"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:198
-msgid "SVCD resolution [Ctrl-3]"
-msgstr "Resoluci? SVCD [Ctrl-3]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:286
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:52
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:73
+msgid "_Vertical deblocking"
+msgstr "Desbloqueig _vertical"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:206
-msgid "VCD Res"
-msgstr "Res. VCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:287
+msgid "De_ringing"
+msgstr "_Eliminaci? oscil?lacions par?sites"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:209
-msgid "VCD resolution [Ctrl-4]"
-msgstr "Resoluci? VCD [Ctrl-4]"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:288
+#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:167
+msgid "_Strength:"
+msgstr "_For?a: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:260
-msgid "Transform"
-msgstr "Transforma"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:289
+msgid "Default Postprocessing"
+msgstr "Postprocessament predeterminat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:333
-msgid "Noise"
-msgstr "Soroll"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:303
+msgid "_Filter directory:"
+msgstr "Directori dels _filtres: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:357
-msgid "Sharpness"
-msgstr "Nitidesa"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:308
+msgid "Use _Global GlyphSet:"
+msgstr "Usa un glifset _global: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:405
-msgid "Misc"
-msgstr "Diversos"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:309
+msgid "Gl_yphSet:"
+msgstr "Gl_ifset: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:416
-msgid "External"
-msgstr "Extern"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:343
+msgid "Global Glyphset"
+msgstr "Glifset global"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:427
-msgid "Add selected filter to the Active Filters list"
-msgstr "Afegeix filtre seleccionat a llista de filtres actius"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:348
+msgid "External Filters"
+msgstr "Filtres externs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:433
-msgid "<b>Available Filters</b>"
-msgstr "<b>Filtres Disponibles</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:352
+msgid "Preferences"
+msgstr "Prefer?ncies"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:478
-msgid "Remove filter"
-msgstr "Treu filtre"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:55
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:45
+msgid "Default"
+msgstr "Predetermin."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:487
-msgid "Move filter down"
-msgstr "Mou filtre avall"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:56
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:46
+msgid "TMPGEnc"
+msgstr "TMPGEnc"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:496
-msgid "Move filter up"
-msgstr "Mou filtre amunt"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:57
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:47
+msgid "Anime"
+msgstr "Anim?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:502
-msgid "P_artial"
-msgstr "P_arcial"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:58
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:48
+msgid "KVCD"
+msgstr "KVCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:505
-msgid "Apply the current filter only to a part of the file"
-msgstr "Aplica el filtre actual nom?s a una part del fitxer"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:61
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:51
+msgid "Progressive"
+msgstr "Progressiu"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:510
-msgid "Configure filter"
-msgstr "Configura filtre"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:62
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:52
+msgid "Interlaced TFF"
+msgstr "Entrella?at TFF"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:520
-msgid "C_onfigure"
-msgstr "C_onfigura"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:63
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:53
+msgid "Interlaced BFF"
+msgstr "Entrella?at BFF"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:524
-msgid "<b >Active Filters</b>"
-msgstr "<b >Filtres Actius</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:74
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:60
+msgid "Ma_x. bitrate:"
+msgstr "Taxa bits m?_x.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:551
-msgid "_Preview"
-msgstr "_Previsualitza"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:75
+msgid "Mi_n. bitrate:"
+msgstr "Taxa bits m?_n.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:52
-msgid "Video Filters"
-msgstr "Filtres V?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:76
+msgid "_Use Xvid rate control"
+msgstr "_Usa el control de taxa de l'Xvid"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:112
-msgid "VCD res"
-msgstr "Res. VCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:78
+msgid "_Buffer size:"
+msgstr "Mida _buffer: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:118
-msgid "SVCD res"
-msgstr "Res. SVCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:80
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:57
+msgid "Aspect _ratio:"
+msgstr "_Rel. aspecte:  "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:124
-msgid "DVD res"
-msgstr "Res. DVD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:81
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:58
+msgid "_Matrices:"
+msgstr "_Matrius: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:130
-msgid "Half D1 res"
-msgstr "Res. mig D1"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:59
+msgid "_GOP size:"
+msgstr "Mida _GOP: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:156
-msgid "Save as script"
-msgstr "Desa-ho com a script"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:88
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:66
+msgid "_Interlacing:"
+msgstr "_Entrella?at: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:425
-msgid "Input"
-msgstr "Entrada"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:41
+msgid "_VOB file(s):"
+msgstr "Fitxer(s) _VOB: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:426
-msgid "Output"
-msgstr "Sortida"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:42
+msgid "_IFO file:"
+msgstr "Fitxer _IFO: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:427
-msgid "Side"
-msgstr "Cara"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:43
+msgid "Vob_Sub file:"
+msgstr "Fitxer Vob_Sub: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:428
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:90
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:81
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:87
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:109
-msgid "Top"
-msgstr "Capdamunt"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:48
+msgid "VOB to VobSub"
+msgstr "VOB a VobSub"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:429
-msgid "Separate"
-msgstr "Separa "
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:52
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:57
+msgid "The selected vobfile does not exist"
+msgstr "El fitxer de VOB selecionat no existeix."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:605
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:429
-#, c-format
-msgid "Frame:%c(%02d)"
-msgstr "Fotogr.: %c(%02d)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp:62
+msgid "Please select a correct VobSub path/dir"
+msgstr "Seleccioneu un cam? o directori v?lid d'un fitxer VobSub"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:282
-#: avidemux/main.cpp:167
-msgid "_File"
-msgstr "_Fitxer"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:59
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:128
+msgid "No data"
+msgstr "No hi ha dades"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:289
-msgid "_Open..."
-msgstr "_Obre..."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp:232
+msgid "Bitrate Histogram"
+msgstr "Histograma taxa de bits"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:300
-msgid "_Append..."
-msgstr "_Afegeix..."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:128
+msgid "Video Codecs"
+msgstr "C?decs de v?deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:311
-msgid "_Save"
-msgstr "Desa (_S)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:129
+msgid "Xvid"
+msgstr "Xvid"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:322
-msgid "Save _Video..."
-msgstr "Desa _v?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:130
+msgid "x264"
+msgstr "x264"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:334
-msgid "Save _BMP Image..."
-msgstr "Desa com a imatge _BMP"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:135
+msgid "Audio Codecs"
+msgstr "C?decs d'?udio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:338
-msgid "Save _JPEG Image..."
-msgstr "Desa com a imatge _JPEG"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:136
+msgid "Aften"
+msgstr "Aften"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:342
-msgid "Save _Selection as JPEG images..."
-msgstr "Desa _selecci? com a imatges JPEG"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:137
+msgid "amrnb"
+msgstr "amrnb"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:351
-msgid "Save _Project"
-msgstr "Desa _projecte"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:138
+msgid "FAAC"
+msgstr "FAAC"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:359
-msgid "Save P_roject As..."
-msgstr "Desa projecte com (_R)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:139
+msgid "FAAD2"
+msgstr "FAAD2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:367
-msgid "_Load/Run Project..."
-msgstr "Carrega / Executa projecte (_L)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:140
+msgid "LAME"
+msgstr "LAME"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:375
-msgid "A_dd to Joblist..."
-msgstr "Afegeix a tasques (_D)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:141
+msgid "liba52"
+msgstr "liba52"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:379
-msgid "Show _Joblist"
-msgstr "Mostra tasques (_J)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:142
+msgid "libdca"
+msgstr "libdca"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:391
-msgid "Proper_ties"
-msgstr "Propietats (_T)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:143
+msgid "MAD"
+msgstr "MAD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:402
-msgid "AVI _Muxer Options"
-msgstr "Opcions '_muxer' AVI"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:144
+msgid "Vorbis"
+msgstr "Vorbis"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:411
-msgid "_Quit"
-msgstr "Surt (_Q)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:156
+msgid "aRts"
+msgstr "aRts"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:422
-msgid "_Edit"
-msgstr "_Edita"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:157
+msgid "ESD"
+msgstr "ESD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:429
-msgid "_Reset Edits"
-msgstr "_Reinicia edici?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:158
+msgid "Fontconfig"
+msgstr "Fontconfig"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:442
-msgid "Cu_t"
-msgstr "_Talla"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:159
+msgid "FreeType 2"
+msgstr "FreeType 2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:453
-msgid "_Copy"
-msgstr "_Copia"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:160
+msgid "gettext"
+msgstr "gettext"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:464
-msgid "_Paste"
-msgstr "Enganxa (_P)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:161
+msgid "ALSA"
+msgstr "ALSA"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:475
-msgid "_Delete"
-msgstr "Esborra (_D)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:162
+msgid "OSS"
+msgstr "OSS"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:491
-msgid "Set Marker _A"
-msgstr "Posa marcador _A"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:163
+msgid "SDL"
+msgstr "SDL"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:498
-msgid "Set Marker _B"
-msgstr "Posa marcador _B"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:164
+msgid "XVideo"
+msgstr "XVideo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:510
-msgid "Pre_ferences"
-msgstr "Prefer?ncies (_F)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:166
+msgid "AltiVec"
+msgstr "AltiVec"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:518
-msgid "_View"
-msgstr "_Visualitza"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:167
+msgid "PowerPC"
+msgstr "PowerPC"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:525
-msgid "_Main Toolbar"
-msgstr "Barra principal (_M)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:168
+msgid "x86"
+msgstr "x86"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:530
-msgid "_A/V Sidebar"
-msgstr "Barra lateral d'A/V (_A)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:169
+msgid "x86-64"
+msgstr "x86-64"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:540
-msgid "_Zoom 1:4"
-msgstr "_Zoom 1:4"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:176
+msgid "Codecs"
+msgstr "C?decs"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:547
-msgid "Z_oom 1:2"
-msgstr "Z_oom 1:2"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:177
+msgid "Libraries"
+msgstr "Biblioteques"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:554
-msgid "Zoom _1:1"
-msgstr "Zoom _1:1"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:178
+msgid "CPU"
+msgstr "CPU"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:561
-msgid "Zoom _2:1"
-msgstr "Zoom _2:1"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:182
+msgid "Built-in Support"
+msgstr "Suport incorporat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:568
-msgid "Zoom _4:1"
-msgstr "Zoom _4:1"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:62
+msgid "_Dynamic range compression"
+msgstr "Compressi? _din?mica de rang"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:575
-msgid "Vi_deo"
-msgstr "V?_deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:64
+msgid "_Time shift (ms):"
+msgstr "Despl. _temps (ms): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:582
-msgid "_Decoder Options"
-msgstr "Opcions _descodificador"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:64
+msgid "Time shift value (ms)"
+msgstr "Despla?. temps (ms)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:589
-msgid "_Postprocessing"
-msgstr "_Postprocessament"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:72
+msgid "R_esampling (Hz):"
+msgstr "R_emostreig (Hz): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:592
-msgid "Select postprocessing level"
-msgstr "Selecciona nivell postprocessament"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:72
+msgid "Resampling frequency (Hz)"
+msgstr "Freq??ncia remostreig (Hz)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:602
-msgid "P_review"
-msgstr "P_revisualitzaci?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:81
+msgid "Film to PAL"
+msgstr "Film a PAL"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:609
-msgid "Display _Output"
-msgstr "Mostra sortida (_O)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:82
+msgid "PAL to Film"
+msgstr "PAL a Film"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:621
-msgid "_Frame Rate"
-msgstr "Veloc. d'imatge (_F)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:85
+msgid "_Frame rate change:"
+msgstr "_Canvi veloc. d'imatge: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:625
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:674
-msgid "_Encoder"
-msgstr "Codificador (_E)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:90
+msgid "Automatic (max -3 dB)"
+msgstr "Autom?tic (m?x.: -3dB)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:632
-msgid "Fil_ters"
-msgstr "Filtres (_T)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:91
+msgid "Manual"
+msgstr "Manual"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:639
-msgid "_Audio"
-msgstr "_?udio"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:93
+msgid "_Gain mode:"
+msgstr "Mode _guany: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:646
-msgid "_Main Track"
-msgstr "Pista principal (_M)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:95
+msgid "G_ain value:"
+msgstr "Valor gu_any: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:650
-msgid "_Second Track"
-msgstr "_Segona pista"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:102
+msgid "No change"
+msgstr "Sense canvi"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:654
-msgid "_Build VBR Time Map"
-msgstr "Construeix mapa temps V_BR"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:105
+msgid "Stereo+surround"
+msgstr "Est?reo+Surround"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:663
-msgid "S_ave..."
-msgstr "Des_a..."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:106
+msgid "Stereo+center"
+msgstr "Est?reo+center"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:681
-msgid "_Filters"
-msgstr "_Filtres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:107
+msgid "Stereo+center+surround"
+msgstr "Est?reo+center+surround"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:685
-msgid "_Tools"
-msgstr "_Eines"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:108
+msgid "Stereo front+stereo rear"
+msgstr "Est?reo front+est?reo rear"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:692
-msgid "_Calculator"
-msgstr "_Calculadora"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:109
+msgid "5 channels"
+msgstr "5 canals"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:708
-msgid "_Rebuild Frames (I & B)"
-msgstr "_Reconstrueix fotogr. (I & B)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:110
+msgid "5.1"
+msgstr "5.1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:712
-msgid "C_heck Frames (slow)"
-msgstr "C_omprova fotogr. (lent)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:111
+msgid "Dolby Pro Logic"
+msgstr "Dolby Pro Logic"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:716
-msgid "_Bitrate Histogram"
-msgstr "Histograma taxa _bits"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:112
+msgid "Dolby Pro Logic II"
+msgstr "Dolby Pro Logic II"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:720
-msgid "_Scan for Black Frames..."
-msgstr "Bu_sca fotogrames negres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:115
+msgid "_Mixer:"
+msgstr "_Mesclador: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:729
-msgid "_VOB -> VobSub"
-msgstr "_VOB -> VobSub"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:119
+msgid "Audio Filters"
+msgstr "Filtres d'?udio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:733
-msgid "_OCR (VobSub -> srt)"
-msgstr "_OCR (VobSub -> srt)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:52
+msgid "Full"
+msgstr "Full"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:737
-msgid "A_uto"
-msgstr "A_uto"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:53
+msgid "Log"
+msgstr "Log"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:744
-msgid "_VCD"
-msgstr "_VCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:54
+msgid "Phods"
+msgstr "Phods"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:748
-msgid "_SVCD"
-msgstr "_SVCD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:55
+msgid "EPZS"
+msgstr "EPZS"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:752
-msgid "_DVD"
-msgstr "_DVD"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:56
+msgid "X1"
+msgstr "X1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:760
-msgid "PSP (H264)"
-msgstr "PSP (H264)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:60
+msgid "H.263"
+msgstr "H.263"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:764
-msgid "_Go"
-msgstr "Ves (_G)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:65
+msgid "MB comparison"
+msgstr "Comparaci? de MB"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:771
-msgid "_Play/Stop"
-msgstr "Reprodueix / Atura (_P)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:66
+msgid "Fewest bits (vhq)"
+msgstr "Bits m?nims (vhq)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:782
-msgid "P_revious Frame"
-msgstr "Fotograma anterior (_R)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:67
+msgid "Rate distortion"
+msgstr "Distorsi? de taxa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:793
-msgid "_Next Frame"
-msgstr "Fotograma seg?ent (_N)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:73
+msgid "Matrices"
+msgstr "Matrius"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:804
-msgid "Pr_evious Intra Frame"
-msgstr "Fotog. clau anterior (_E)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:74
+msgid "Mi_n. quantizer:"
+msgstr "Quantificador m?_n.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:815
-msgid "Next _Intra Frame"
-msgstr "Fotog. clau seg?ent (_I)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:75
+msgid "Ma_x. quantizer:"
+msgstr "Quantificador m?_x.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:826
-msgid "Previou_s Black Frame"
-msgstr "Fotogr. negre anterior (_S)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:76
+msgid "Max. quantizer _difference:"
+msgstr "_Difer. m?x. quantificador: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:830
-msgid "Ne_xt Black Frame"
-msgstr "Fotogr. negre seg?ent (_X)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:78
+msgid "4_MV"
+msgstr "x _MV"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:834
-msgid "_First Frame"
-msgstr "Primer fotograma (_F)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:81
+msgid "_Quarter pixel"
+msgstr "_Quart de p?xel"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:845
-msgid "_Last Frame"
-msgstr "?ltim fotograma (_L)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:85
+msgid "_Number of B frames:"
+msgstr "_Nombre de fotog-B: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:861
-msgid "Go to Marker _A"
-msgstr "Ves al marcador _A"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:86
+msgid "_Quantization type:"
+msgstr "Tipus _quantificaci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:868
-msgid "Go to Marker _B"
-msgstr "Ves al marcador _B"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:88
+msgid "_Macroblock decision:"
+msgstr "Decisi? de _macrobloc: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:880
-msgid "_Jump to Frame..."
-msgstr "Salta al fotograma... (_J)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:90
+msgid "_Filesize tolerance (kb):"
+msgstr "Toler?n. mida _fitxer (kb): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:891
-msgid "Jump to _Time..."
-msgstr "Salta al temps... (_T)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:92
+msgid "_Quantizer compression:"
+msgstr "Quantific. _compressi?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:906
-msgid "_Help"
-msgstr "Ajuda (_H)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:93
+msgid "Quantizer _blur:"
+msgstr "Quantific. _desenfocam.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:913
-msgid "_About"
-msgstr "Quant a l'Avidemux (_A)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:98
+msgid "User Interface"
+msgstr "Interf?cie d'usuari"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:921
-msgid "Show builtin support"
-msgstr "Mostra suport incorporat"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:108
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:86
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:89
+msgid "Motion Estimation"
+msgstr "Estimac. moviment"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:935
-msgid "Open a file"
-msgstr "Obre un fitxer"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:120
+msgid "libavcodec MPEG-4 configuration"
+msgstr "Configuraci? del libavcodec d'MPEG-4"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:945
-msgid "Save the file"
-msgstr "Desa el fitxer"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:59
+msgid "_Target type:"
+msgstr "_Tipus a obtenir: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:951
-msgid "Audio/video file information"
-msgstr "Info fitxer ?udio/v?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:60
+msgid "_Source aspect ratio:"
+msgstr "Relac. a_specte origen: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:959
-msgid "Calculator"
-msgstr "Calculad."
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp:61
+msgid "_Destination aspect ratio:"
+msgstr "Relac. aspecte a _obtenir: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:962
-msgid "Bitrate/size calculator"
-msgstr "Calcula taxa bits/mida"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:40
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:60
+msgid "_Filter strength:"
+msgstr "_For?a filtre:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1016
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1056
-msgid "Copy"
-msgstr "Copiat"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:41
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp:45
+msgid "_Swap U and V"
+msgstr "_Interc. U & V"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1021
-msgid "Configure video encoder"
-msgstr "Configura codificador de v?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:53
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:74
+msgid "_Deringing"
+msgstr "Eliminac. _oscil?lac. par?sit."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1026
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1082
-msgid "Filters"
-msgstr "Filtres"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:82
+msgid "Select idx file:"
+msgstr "Seleccioneu el fitxer d'IDX: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1029
-msgid "Video filters"
-msgstr "Filtres de v?deo"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:83
+msgid "Use glyphset (optional):"
+msgstr "Usa glifset (opcional): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1061
-msgid "Configure audio encoder"
-msgstr "Configura codificador d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:84
+msgid "Output SRT file"
+msgstr "Fitxer de sortida d'SRT"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1069
-msgid "Audio filters"
-msgstr "Filtres d'?udio"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:95
+msgid "Select input and ouput files"
+msgstr "Seleccioneu un fitxer d'entrada i un de sortida."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1090
-msgid "Shift:"
-msgstr "Despl.:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
+msgid "The idx/sub file does not exist."
+msgstr "El fitxer seleccionat d'IDX o de SUB no existeix."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1093
-msgid "Enable time shift"
-msgstr "Habilita despla?. temps"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
+msgid "Please Select a valid output SRT file."
+msgstr "Seleccioneu un nom v?lid de fitxer d'SRT de sortida."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1099
-msgid "Audio/video time shift (ms)"
-msgstr "Despla?. temps ?udio/v?deo (ms)"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
+msgid "Cannot load the glyphset file."
+msgstr "No es pot carregar el fitxer de glifset."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1106
-msgid "<b>Format</b>"
-msgstr "<b>Format</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:144
+msgid "Glyphset filename"
+msgstr "Nom de fitxer de glifset"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1139
-msgid "<b>Selection</b>"
-msgstr "<b>Selecci?</b>"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:146
+msgid "Save Glyph"
+msgstr "Desa glif"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1156
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1164
-msgid " 0000000"
-msgstr " 0000000"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp:41
+msgid "_Swap U&V:"
+msgstr "_Intercanvia U&V: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1172
-msgid "A:"
-msgstr "A:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp:48
+msgid "_Shrink Factor:"
+msgstr "_Factor reducci?: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1179
-msgid "Go to marker A"
-msgstr "Ves al marcador A"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp:46
+msgid "Show motion _vectors"
+msgstr "Mostra _vectors moviment"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1181
-msgid "B:"
-msgstr "B:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp:48
+msgid "Decoder Options"
+msgstr "Opcions descodificador"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1188
-msgid "Go to marker B"
-msgstr "Ves al marcador B"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:36
+msgid "_Background Image:"
+msgstr "_Imatge de fons: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1200
-msgid "Play"
-msgstr "Reprodueix"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:37
+msgid "_NTSC(default is Pal):"
+msgstr "_NTSC (PAL ?s el predet.): "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1214
-msgid "Stop"
-msgstr "Atura"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:38
+msgid "Vignette _Width:"
+msgstr "A_mplada vinyeta: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1226
-msgid "Previous frame"
-msgstr "Fotogr. anterior"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:39
+msgid "Vignette _Height:"
+msgstr "A_l??ria vinyeta: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1241
-msgid "Next frame"
-msgstr "Fotogr. seg?ent"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:42
+msgid "Vignette frame number"
+msgstr "N?m. fotogr. vinyeta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1256
-msgid "Previous keyframe"
-msgstr "Fotog. clau anterior"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp:46
+msgid "Timecode:"
+msgstr "Temps reprod.: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1271
-msgid "Next keyframe"
-msgstr "Fotog. clau seg?ent"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:69
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:72
+msgid "Partition Decision"
+msgstr "Decisi? de partici?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1285
-msgid "Selection: start"
-msgstr "Selecci?: inici"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:77
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:72
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:80
+msgid "VHQ Mode"
+msgstr "Mode VHQ"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1296
-msgid "Selection: end"
-msgstr "Selecci?: final"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:78
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:81
+msgid "Max Ref Frames"
+msgstr "M?x. fotogs. de ref."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1307
-msgid "Previous black frame"
-msgstr "Fotogr. negre anterior"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:79
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:143
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:76
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:146
+msgid "Max B Frames"
+msgstr "M?x. fotogrames-B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1318
-msgid "Next black frame"
-msgstr "Fotogr. negre seg?ent"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:85
+msgid "Fast P Skip"
+msgstr "Fast P Skip"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1329
-msgid "First frame"
-msgstr "Primer fotograma"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:83
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:86
+msgid "DCT Decimate"
+msgstr "DCT Decimate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1340
-msgid "Last frame"
-msgstr "?ltim fotograma"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:84
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:87
+msgid "Interlaced"
+msgstr "Entrella?at"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1371
-msgid "Frame: "
-msgstr "Fotogr.: "
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:103
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:106
+msgid "Disabled"
+msgstr "Desactivat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1378
-msgid "Current frame"
-msgstr "Fotogr. actual"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:110
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:113
+msgid "Deblocking Filter"
+msgstr "Filtre desbloqueig"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1383
-msgid "/0000000"
-msgstr "/0000000"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:111
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:114
+msgid "Strength"
+msgstr "For?a "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1390
-msgid "Time: "
-msgstr "Temps:"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:112
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:115
+msgid "Threshold"
+msgstr "Llindar"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1397
-msgid "Current time"
-msgstr "Temps actual"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:130
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:133
+msgid "8x8P Transform"
+msgstr "Transformaci? 8x8P"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1398
-msgid "00:00:00.000"
-msgstr "00:00:00.000"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:131
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:134
+msgid "8x8B Transform"
+msgstr "Transformaci? 8x8B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1401
-msgid "/00:00:00,000"
-msgstr "/00:00:00,000"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:132
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:135
+msgid "_4x4 Transform"
+msgstr "Transformaci? _4x4"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1408
-msgid "Frame: ?"
-msgstr "Fotogr.: ?"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:133
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:136
+msgid "_8x8I Transform"
+msgstr "Transformaci? _8x8I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:209
-msgid "Incorrect output file"
-msgstr "El fitxer de sortida ?s incorrecte"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:134
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:137
+msgid "_4x4I Transform"
+msgstr "Transformaci? 4_x4I"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:215
-msgid "Output file error"
-msgstr "S'ha produ?t un error en el fitxer de sortida"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:152
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:155
+msgid "X264 Configuration"
+msgstr "Configuraci? de l'X264"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:215
-#, c-format
-msgid "Could not open \"%s\" for writing."
-msgstr "No es pot obrir el fitxer \"%s\" per a escriptura"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:106
+msgid "Job Name"
+msgstr " Nom de la tasca"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:224
-msgid "Problem loading sub"
-msgstr "S'ha produ?t un problema en carregar el fitxer de SUB"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:106
+msgid "Status"
+msgstr "Estat"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:589
-msgid "Sure ?"
-msgstr "N'esteu segur?"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:106
+msgid "Start Time"
+msgstr "Temps d'inici"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:752
-msgid "Select SRT to save"
-msgstr "Seleccioneu STR per desar"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:106
+msgid "End Time"
+msgstr "Temps de final"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:764
-msgid "Select Glyoh to save"
-msgstr "Seleccioneu GLYPH per desar"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:196
+msgid "Delete *all* job"
+msgstr "Esborra totes les tasques"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/adm_ocr.cpp:778
-msgid "No glyphs to save"
-msgstr "No hi ha glyphs per desar"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:196
+msgid "Are you sure you want to delete ALL jobs ?"
+msgstr "Esteu segur que voleu esborrar TOTES les tasques?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_gladeSupport.cpp:251
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/ADM_gladeSupport.cpp:275
-#, c-format
-msgid "Couldn't find pixmap file: %s"
-msgstr "No s'ha pogut trobar el fitxer de pixmap: %s"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:222
+msgid "Already done"
+msgstr "Ja s'ha fet"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:121
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:391
-msgid "Cannot open directory as a file"
-msgstr "No es pot obrir un directori com un fitxer"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:222
+msgid "This script has already been successfully executed."
+msgstr "El fitxer d'script s'ha executat satisfact?riament."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:252
-#: avidemux/gtk_gui.cpp:877
-#, c-format
-msgid "Cannot open \"%s\"."
-msgstr "No es pot obrir \"%s\"."
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:58
+msgid "Very Low"
+msgstr "Molt baixa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:262
-msgid "Overwrite file ?"
-msgstr "Voleu sobreescriure el fitxer?"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:60
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:105
+msgid "Medium"
+msgstr "Mitj?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:287
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:301
-msgid "It could be possible that you try to overwrite an input file!"
-msgstr "Podria ser que intent?ssiu sobreescriure un fitxer d'entrada"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:62
+msgid "Very High"
+msgstr "Molt alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:312
-msgid "Cannot write the file"
-msgstr "No es pot escriure el fitxer"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:63
+msgid "Ultra High"
+msgstr "Ultra alta"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:312
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:64
+msgid "Motion Search Precision"
+msgstr "Precisi? de cerca de moviment"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:67
+msgid "Off"
+msgstr "Sense"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:68
+msgid "Mode Decision"
+msgstr "Mode decisi?"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:69
+msgid "Limited Search"
+msgstr "Cerca limitada"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:70
+msgid "Medium Search"
+msgstr "Cerca mitjana"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:71
+msgid "Wide Search"
+msgstr "Cerca ?mplia"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:77
+msgid "Quarter Pixel"
+msgstr "Quart de p?xel "
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:78
+msgid "GMC"
+msgstr "GMC"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:79
+msgid "BVHQ"
+msgstr "BVHQ"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:88
+msgid "4MV"
+msgstr "MV"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:90
+msgid "HQ AC"
+msgstr "HQ AC"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:91
+msgid "More Search"
+msgstr "M?s cerca"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:96
+msgid "Min Gop Size"
+msgstr "Mida GOP m?n. "
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:97
+msgid "Max Gop Size"
+msgstr "Mida GOP m?x."
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:98
+msgid "GOP Size"
+msgstr "Mida GOP"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:106
+msgid "H263"
+msgstr "H263"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:107
+msgid "Mpeg"
+msgstr "Mpeg"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:108
+msgid "Quantization Matrix"
+msgstr "Matriu de quantificaci? "
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:109
+msgid "Trellis Quantization"
+msgstr "Quantificaci? de Trellis"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:117
+msgid "Two Pass Tuning"
+msgstr "Personalitzaci? 2 passades"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:128
+msgid "Curve Compression"
+msgstr "Corba de compressi?"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:142
+msgid "Xvid4 Configuration"
+msgstr "Configuraci? de l'Xvid4"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:198
 #, c-format
-msgid "No write access to \"%s\"."
-msgstr "No tenia acc?s d'escriptura a  \"%s\"."
+msgid "# Images :%0lu"
+msgstr "# Fotogr.: %0lu"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:445
-msgid "Images"
-msgstr "Imatges"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:216
+#, c-format
+msgid "Time Left :%02d:%02d:%02d"
+msgstr "Temps rest. est.: %02d:%02d:%02d"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:457
-msgid "All"
-msgstr "Tot"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:580
+msgid "Partial Start Frame:"
+msgstr "Fotogr. inicial del parcial: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:585
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:657
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:719
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:779
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:842
-msgid "label1"
-msgstr "etiqueta1"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:581
+msgid "Partial End Frame:"
+msgstr "Fotogr. final del parcial: "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit_dialog.cpp:706
-msgid "Alert"
-msgstr "Av?s"
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:582
+msgid "Configure child"
+msgstr "Configura fill"
 
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:52
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:585
+msgid "Partial Video Filter"
+msgstr "Filtre parcial de v?deo"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:62
+msgid "Select File to Read"
+msgstr "Seleccioneu un fitxer per llegir."
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:65
+msgid "Select File to Write"
+msgstr "Seleccioneu un fitxer per escriure."
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:69
 msgid "Select Directory"
 msgstr "Selecciona directori"
 
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:54
-msgid "Select File"
-msgstr "Selecciona fitxer"
+#: avidemux/ADM_videoFilter/ADM_vidVlad.cpp:101
+msgid "_Luma temporal threshold:"
+msgstr "Llindar temporal _luma: "
 
-#: avidemux/ADM_video/ADM_guiResize.cpp:96
-#: avidemux/ADM_video/ADM_vidMPLResize.cpp:143
-msgid "Width and height cannot be 0"
-msgstr "Ni l'amplada ni l'al??ria no poder ser 0"
+#: avidemux/ADM_videoFilter/ADM_vidVlad.cpp:102
+msgid "Ch_roma temporal threshold:"
+msgstr "Llindar temporal c_roma: "
 
-#: avidemux/ADM_video/ADM_guiResize.cpp:98
-#: avidemux/ADM_video/ADM_vidMPLResize.cpp:145
-msgid "Width and height cannot be odd"
-msgstr "Ni l'amplada ni l'al??ria no poden ser senars"
+#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:163
+msgid "_Mask"
+msgstr "_M?scara"
 
-#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
-msgid "Metrics"
-msgstr "Mesuraments"
+#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:164
+msgid "_High Q"
+msgstr "_High Q"
 
-#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
-msgid "Do you want to print metrics on screen ?"
-msgstr "Voleu mostrar els mesuraments en pantalla?"
+#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:166
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:93
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:92
+#: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:82
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:87
+msgid "_Threshold:"
+msgstr "_Llindar: "
 
-#: avidemux/ADM_video/ADM_vidSRT.cpp:215
-msgid "Could not open subtitle file"
-msgstr "No es pot obrir el fitxer de subt?tols"
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:104
+msgid "Fast"
+msgstr "R?pid"
 
-#: avidemux/ADM_video/ADM_vidSRT.cpp:238
-msgid "Cannot identify subtitle format"
-msgstr "No es pot identificar el format de subt?tol"
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:106
+msgid "Slow iterative motion search"
+msgstr "Lent, estimaci? iterativa movim."
 
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:107
+msgid "Extra slow (same as 3+multiple reference frames)"
+msgstr "Extra lent (com [3] + fotogr. refer?n. m?ltiple)"
+
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:110
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:88
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:82
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:91
+msgid "Bottom"
+msgstr "Baix"
+
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:114
+msgid "_Field dominance:"
+msgstr "_Domin?ncia marc: "
+
+#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:115
+msgid "_Qp:"
+msgstr "_QP:"
+
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
+msgid "_Quantizer:"
+msgstr "_Quantificador:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:68
+msgid "_Luma threshold:"
+msgstr "Llindar _Luma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:69
+msgid "C_hroma threshold:"
+msgstr "Llindar _Croma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:70
+msgid "_Radius:"
+msgstr "_Radi:"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
+msgid "Out"
+msgstr "Out"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
+msgid "Fade out"
+msgstr "Fusi? sortint "
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
+msgid "In"
+msgstr "In"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
+msgid "Fade in"
+msgstr "Fusi? entrant"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:71
+msgid "_Fade type:"
+msgstr "Tipus _fusi?: "
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:72
+msgid "_Start frame:"
+msgstr "Fotogr. _inicial: "
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:73
+msgid "_End frame:"
+msgstr "Fotogr. _final: "
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:74
+msgid "Fade to _black"
+msgstr "Fusi? al _negre"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:83
+msgid "Parameter Error"
+msgstr "S'ha produ?t un error de par?metre"
+
+#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:83
+msgid "Start must be before end, and both within video # of frames."
+msgstr "L'inici ha d'estar abans del final, i ambd?s dins del # de fotogr. del v?deo."
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:93
+msgid "Smaller means more deinterlacing"
+msgstr "M?s petit suposa m?s desentrella?ament"
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:94
+msgid "_Sharper engine:"
+msgstr "Nitidejador: "
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:95
+msgid "T_woway"
+msgstr "Dues _Vies"
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:95
+msgid "Extrapolate better (better not to use it)"
+msgstr "Extrapola millor (m?s val no fer-la servir)"
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:96
+msgid "_Map"
+msgstr "_Mapeja"
+
+#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:96
+msgid "Show interlaced areas (for test!)"
+msgstr "Mostra ?rees entrella?ades (nom?s prova!)"
+
+#: avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp:85
+msgid "_New frame rate:"
+msgstr "_Nova veloc. imatge:"
+
+#: avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp:86
+msgid "_Blend"
+msgstr "_Fusiona "
+
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:106
 msgid "Linear blend"
 msgstr "Fusi? lineal "
@@ -5405,52 +5497,170 @@
 
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:114
 msgid "_Deinterlacing:"
-msgstr "_Desentrella?at:"
+msgstr "_Desentrella?at: "
 
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:115
 msgid "_Autolevel"
 msgstr "Niv. _auto:"
 
-#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:85
-msgid "_Subtitle file (ass/ssa)"
-msgstr "Fitxer _subt?tols (ass/ssa) "
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:74
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:74
+msgid "_Spatial luma strength:"
+msgstr "For?a e_spacial luma:"
 
-#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:86
-msgid "_Line spacing"
-msgstr "Espaiat _l?nia"
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:75
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:75
+msgid "S_patial chroma strength:"
+msgstr "For?a e_spacial croma:"
 
-#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:87
-msgid "_Font scale"
-msgstr "Mida lletra (_F):"
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:76
+#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:76
+msgid "_Temporal strength:"
+msgstr "For?a _temporal:"
 
-#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:88
-msgid "_Top margin"
-msgstr "Marge sup. (_T)"
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:190
+msgid "Discard Closer"
+msgstr "Descarta proper"
 
-#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:89
-msgid "_Bottom margin"
-msgstr "Marge inf. (_B)"
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:191
+#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:191
+msgid "Replace (interpolate)"
+msgstr "Substitueix (interpola)"
 
-#: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:82
-msgid "threshold"
-msgstr "llindar"
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:192
+#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:192
+msgid "Discard longer dupe (anim?s)"
+msgstr "Descarta dupls. grans (anim?s)"
 
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:193
+msgid "PullDown dupe removal"
+msgstr "Elim. duplic. pulldown"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:196
+#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:196
+msgid "Fastest (no chroma, partial luma)"
+msgstr "M?s r?pida (sense chroma, luma parcial)"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:197
+msgid "Fast (parial luma and chroma)"
+msgstr "R?pida (luma i croma parcials)"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:198
+msgid "Medium (full luma no chroma)"
+msgstr "Mitjana (luma complet, sense chroma)"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:199
+#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:199
+msgid "Slow (full luma and chroma)"
+msgstr "Lenta (luma i croma complets)"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:203
+msgid "Mode"
+msgstr "Mode"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:204
+msgid "Quality"
+msgstr "Qualitat"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:205
+msgid "Threshold 1"
+msgstr "Llindar 1"
+
+#: /home/fx/avidemux/avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:206
+msgid "Threshold 2"
+msgstr "Llindar 2"
+
+#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:90
+msgid "_Horizontal stacking:"
+msgstr "Empilament _horitz.:"
+
+#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:91
+msgid "_Vertical stacking:"
+msgstr "Empilament _vertic.:"
+
+#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:92
+msgid "_Shrink factor:"
+msgstr "Factor _reduc.: "
+
+#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:93
+msgid "Show _frame"
+msgstr "Mostra _fotogr."
+
+#: avidemux/ADM_videoFilter/ADM_vidStabilize.cpp:63
+msgid "Stabilize Threshold"
+msgstr "Estabilitza llindar"
+
+#: avidemux/ADM_videoFilter/ADM_vidDropOut.cpp:63
+msgid "DropOut Threshold"
+msgstr "Llindar p?rdua "
+
+#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:386
+msgid "_Luma lock:"
+msgstr "Bloqueig _luma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:387
+msgid "C_hroma lock:"
+msgstr "Bloqueig _croma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:388
+msgid "L_uma threshold:"
+msgstr "Llindar _luma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:389
+msgid "Ch_roma threshold:"
+msgstr "Llindar _croma:"
+
+#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:391
+msgid "_Scene change:"
+msgstr "Canvi e_scena:"
+
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:85
+msgid "Keep nb of frames and fps"
+msgstr "Mant? # fotogr. i FPS"
+
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:86
+msgid "Double nb of frames and fps"
+msgstr "Dobla # fotog. i fps "
+
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:87
+msgid "Double nb of frames (slow motion)"
+msgstr "Dobla # fotog. (ralent?)"
+
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:93
+msgid "_Extra"
+msgstr "_Extra"
+
+#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:93
+msgid "Extra check, avoid using it"
+msgstr "Compr. extra (s'ha d'evitar el seu ?s) "
+
+#: avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp:143
+#: avidemux/ADM_videoFilter/ADM_guiResize.cpp:96
+msgid "Width and height cannot be 0"
+msgstr "Ni l'amplada ni l'al??ria no poder ser 0"
+
+#: avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp:145
+#: avidemux/ADM_videoFilter/ADM_guiResize.cpp:98
+msgid "Width and height cannot be odd"
+msgstr "Ni l'amplada ni l'al??ria no poden ser senars"
+
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:83
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:88
-msgid "If value is smaller than threshold it is considered valid. Smaller value might mean more false positive"
-msgstr "Si el valor ?s m?s petit que el llindar es considera v?lid. Valors m?s baixos del llindar suposen m?s deteccions falses"
+msgid "If value is smaller than threshold it is considered valid.Smaller value might mean more false positive."
+msgstr "Si el valor ?s m?s petit que el llindar es considera v?lid. Valors m?s baixos del llindar suposen m?s deteccions falses."
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:85
-msgid "noise"
-msgstr "soroll"
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:90
+msgid "_Noise:"
+msgstr "Soroll _(N):"
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:85
-msgid "If pixel are closer than noise, they are considered to be the same"
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:90
+msgid "If pixels are closer than noise, they are considered to be the same"
 msgstr "Si els p?xels s?n m?s propers que el llindar de soroll es consideren id?ntics"
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:86
-msgid "identical"
-msgstr "id?ntics "
+msgid "I_dentical:"
+msgstr "_Id?ntic: "
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:86
 #: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:91
@@ -5458,8 +5668,9 @@
 msgstr "Si els mesuraments difereixen menys que el llindar d'identitat, els fotogrames es consideren id?ntics"
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:87
-msgid "show"
-msgstr "mostra"
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:92
+msgid "_Show metrics"
+msgstr "_Mostra mesuram."
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:87
 #: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:92
@@ -5467,52 +5678,102 @@
 msgstr "Mostra mesuraments en imatge (debug)"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:190
-msgid "Discard Closer"
+msgid "Discard closer"
 msgstr "Descarta proper"
 
-#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:191
-msgid "Replace (interpolate)"
-msgstr "Substitueix (interpola)"
-
-#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:192
-msgid "Discard longer dupe (anim?s)"
-msgstr "Descarta dupls. grans (anim?s)"
-
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:193
-msgid "PullDown dupe removal"
-msgstr "Elim. duplic. pulldown"
+msgid "Pulldown dupe removal"
+msgstr "Elimina duplic. pulldown"
 
-#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:196
-msgid "Fastest (no chroma, partial luma)"
-msgstr "M?s r?pida (sense chroma, luma parcial)"
-
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:197
-msgid "Fast (parial luma and chroma)"
+msgid "Fast (partial luma and chroma)"
 msgstr "R?pida (luma i croma parcials)"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:198
-msgid "Medium (full luma no chroma)"
+msgid "Medium (full luma, no chroma)"
 msgstr "Mitjana (luma complet, sense chroma)"
 
-#: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:199
-msgid "Slow (full luma and chroma)"
-msgstr "Lenta (luma i croma complets)"
-
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:205
-msgid "Threshold 1"
-msgstr "Llindar 1"
+msgid "_Threshold 1:"
+msgstr "Llindar _1: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:206
-msgid "Threshold 2"
-msgstr "Llindar 2"
+msgid "T_hreshold 2:"
+msgstr "Llindar _2: "
 
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:91
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:82
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:88
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:110
-msgid "Bottom"
-msgstr "Baix"
+#: avidemux/ADM_videoFilter/ADM_vidPalShift.cpp:76
+msgid "_Try reverse"
+msgstr "In_tenta reversi?"
 
+#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:87
+msgid "_Subtitle file (ASS/SSA):"
+msgstr "Fitxer de _subt?tols (ASS/SSA): "
+
+#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:88
+msgid "_Line spacing:"
+msgstr "_Espaiat l?nia: "
+
+#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:89
+msgid "_Font scale:"
+msgstr "Mida _lletra: "
+
+#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:90
+msgid "_Top margin:"
+msgstr "Marge _super."
+
+#: avidemux/ADM_videoFilter/ADM_vidASS.cpp:91
+msgid "Botto_m margin"
+msgstr "Marge _infer."
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:265
+msgid "90 degrees"
+msgstr "90 graus"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:265
+msgid "90?"
+msgstr "90?"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:266
+msgid "180 degrees"
+msgstr "180 graus"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:266
+msgid "180?"
+msgstr "180?"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:267
+msgid "270 degrees"
+msgstr "270 graus"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:267
+msgid "270?"
+msgstr "270?"
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:269
+msgid "_Angle:"
+msgstr "_Angle: "
+
+#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:271
+msgid "Rotate"
+msgstr "Rota"
+
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:83
+msgid "No strategy"
+msgstr "Sense estrat?gia"
+
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:84
+msgid "3:2 pulldown"
+msgstr "3:2 pulldown"
+
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:85
+msgid "PAL/SECAM"
+msgstr "PAL/SECAM"
+
+#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:86
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:559
+msgid "NTSC converted from PAL"
+msgstr "NTSC convertit des de PAL"
+
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:95
 msgid "Never"
 msgstr "Mai"
@@ -5534,7 +5795,7 @@
 msgstr "Postproc. sobre la millor correspond?ncia"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:104
-msgid "Postproc and show zones(debug)"
+msgid "Postproc and show zones (debug)"
 msgstr "Postproc. i mostra zones (debug) "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:105
@@ -5542,627 +5803,760 @@
 msgstr "Processa fotog. (no marcs)"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:106
-msgid "Process image (not fields),debug"
-msgstr "Processa fotogr. (no marcs, debug)"
+msgid "Process image (not fields), debug"
+msgstr "Processa fotogrames, no marcs (debug)"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:110
-msgid "Strategy"
-msgstr "Estrat?gia"
+msgid "_Strategy:"
+msgstr "E_strat?gia: "
 
-#: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:111
-msgid "Field Order"
-msgstr "Ordre Marcs"
-
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:112
-msgid "Post Processing"
-msgstr "Postprocessament"
+msgid "_Postprocessing:"
+msgstr "_Postprocessament:"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:113
-msgid "Try backward"
-msgstr "Prova enrere"
+msgid "_Try backward:"
+msgstr "_Prova enrere: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:115
-msgid "Direct Threshold"
-msgstr "Lllindar directe"
+msgid "_Direct threshold:"
+msgstr "Lllindar _directe: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:116
-msgid "Backward Threshold"
-msgstr "Llindar enrere"
+msgid "_Backward threshold:"
+msgstr "Llindar _enrere: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:117
-msgid "Noise Threshold"
-msgstr "Llindar soroll"
+msgid "_Noise threshold:"
+msgstr "Llindar _soroll: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:118
-msgid "Post Proc Threshold"
-msgstr "Llindar postproc."
+msgid "Postp_rocessing threshold:"
+msgstr "Llindar postp_rocessament: "
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:120
-msgid "Use Chroma to decide"
-msgstr "Usa croma per decidir"
+msgid "_Use chroma to decide"
+msgstr "_Usa croma per decidir"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:121
-msgid "Show info"
-msgstr "Mostra info"
+msgid "Sho_w info"
+msgstr "_Mostra informaci?"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:122
-msgid "Debug"
-msgstr "Depura"
+msgid "Debu_g"
+msgstr "Depu_ra"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:123
-msgid "Blend"
-msgstr "Fusiona"
+msgid "Bl_end"
+msgstr "Fus_iona"
 
-#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:386
-msgid "_Luma lock:"
-msgstr "Bloqueig _luma:"
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:171
+msgid "Temporal & spatial check"
+msgstr "Comprov. temp. i espacial"
 
-#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:387
-msgid "C_hroma lock:"
-msgstr "Bloqueig _croma:"
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:172
+msgid "Bob, temporal & spatial check"
+msgstr "Bob, comprov. temp. i espacial "
 
-#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:388
-msgid "L_uma threshold:"
-msgstr "Llindar _luma:"
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:173
+msgid "Skip spatial temporal check"
+msgstr "Salta compr. temp. espacial "
 
-#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:389
-msgid "Ch_roma threshold:"
-msgstr "Llindar _croma:"
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:174
+msgid "Bob, skip spatial temporal check"
+msgstr "Bob, salta compr. temp. espac."
 
-#: avidemux/ADM_videoFilter/ADM_vidDenoise.cpp:391
-msgid "_Scene change:"
-msgstr "Canvi e_scena:"
+#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:182
+msgid "_Order:"
+msgstr "_Ordre: "
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:85
-msgid "Keep nb of frames and fps"
-msgstr "Mant? # fotogr. i FPS"
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:88
+msgid "If value is smaller than threshold it is considered valid. Smaller value might mean more false positive"
+msgstr "Si el valor ?s m?s petit que el llindar es considera v?lid. Valors m?s baixos del llindar suposen m?s deteccions falses."
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:86
-msgid "Double nb of frames and fps"
-msgstr "Dobla # fotog. i fps "
+#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:91
+msgid "_Identical:"
+msgstr "_Id?ntic:"
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:87
-msgid "Double nb of frames (slow motion)"
-msgstr "Dobla # fotog. (ralent?)"
+#: avidemux/ADM_filter/filter_saveload.cpp:157
+msgid "Problem reading XML filters"
+msgstr "Hi ha hagut un problema en llegir filtres d'XML."
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:90
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:92
-msgid "_Field order:"
-msgstr "Ordre marcs (_F):"
+#: avidemux/ADM_filter/filter_saveload.cpp:165
+msgid "No filter found"
+msgstr "No s'ha trobat cap filtre"
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:91
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:113
-msgid "_Mode:"
-msgstr "_Mode:"
+#: avidemux/ADM_filter/filter_saveload.cpp:201
+msgid "Could not find a filter"
+msgstr "No s'ha pogut trobar un filtre"
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:92
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:87
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:93
-#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:166
-msgid "_Threshold:"
-msgstr "Llindar (_T):"
+#: avidemux/ADM_filter/filter_saveload.cpp:209
+msgid "No tag found"
+msgstr "No s'ha trobat l'etiqueta (tag)."
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:93
-msgid "_Extra"
-msgstr "_Extra"
+#: avidemux/ADM_filter/filter_saveload.cpp:289
+msgid "Node not found"
+msgstr "No s'ha trobat el node"
 
-#: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:93
-msgid "Extra check, avoid using it"
-msgstr "Compr. extra (s'ha d'evitar el seu ?s) "
+#: avidemux/ADM_editor/ADM_edit.cpp:407
+msgid "File type identified but no loader support detected..."
+msgstr "S'ha identificar el tipus de fitxer per? no se n'ha detectat suport de carregador..."
 
-#: avidemux/ADM_videoFilter/ADM_vidDropOut.cpp:63
-msgid "DropOut Threshold"
-msgstr "Llindar p?rdua "
+#: avidemux/ADM_editor/ADM_edit.cpp:408
+msgid "May be related to an old index file."
+msgstr "Potser es refereix a un antic fitxer d'?ndex"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
-msgid "Out"
-msgstr "Out"
+#: avidemux/ADM_editor/ADM_edit.cpp:415
+#, c-format
+msgid "Attempt to open %s failed!"
+msgstr "Ha fallat l'intent d'obrir %s"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
-msgid "Fade out"
-msgstr "Desaparici?"
+#: avidemux/ADM_editor/ADM_edit.cpp:439
+msgid ""
+"You cannot mix different video dimensions yet. Using the partial video filter later, will not work around this problem. The workaround is:\n"
+"1.) \"resize\" / \"add border\" / \"crop\" each stream to the same resolution\n"
+"2.) concatinate them together"
+msgstr ""
+"Encara no es poden barrejar diferents mides de v?deo. L'?s posterior del filtre parcial de v?deo no evitar? aquest problema. El remei ?s:\n"
+"1.) \"redimensionar\" / \"afegir vora\" / \"retallar\" cada flux a la mateixa resoluci?\n"
+"2.) concatenar-los"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
-msgid "In"
-msgstr "In"
+#: avidemux/ADM_editor/ADM_edit.cpp:551
+msgid "Build Time Map"
+msgstr "Construeix mapa temps"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:65
-msgid "Fade in"
-msgstr "Aparici?"
+#: avidemux/ADM_editor/ADM_edit.cpp:551
+msgid "Build VBR time map?"
+msgstr "Voleu construir el mapa de temps VBR?"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:71
-msgid "_Fade type:"
-msgstr "Tipus di_fumin.: "
+#: avidemux/ADM_editor/ADM_edit.cpp:585
+msgid "Use that mode"
+msgstr "Utilitzeu aquell mode"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:72
-msgid "_Start frame:"
-msgstr "Fotogr. inicial _(S):"
+#: avidemux/ADM_editor/ADM_edit.cpp:585
+msgid "H264 detected"
+msgstr "Detectat H264"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:73
-msgid "_End frame:"
-msgstr "Fotogr. final _(E):"
+#: avidemux/ADM_editor/ADM_edit.cpp:585
+msgid ""
+"If the file is using bframe as reference, it can lead to crash or stutteting.\n"
+"Avidemux can use another mode which is safed but <b>YOU WILL LOOSE FRAME ACCURACY</b>.\n"
+"Do you want to use that mode ?"
+msgstr ""
+"El fet que el fitxer utilitzi fotogrames-B com a refer?ncia pot ocasionar una penjada o b? una tremolor.\n"
+"L'Avidemux pot usar un altre mode m?s segur, per? <b>PERDREU PRECISI? DE FOTOGRAMA</b>.\n"
+"Voleu utilitzar aquell m?tode ?"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:74
-msgid "Fade to _black"
-msgstr "Fosa al negre"
+#: avidemux/ADM_editor/ADM_edit.cpp:712
+msgid "Packed Bitstream detected"
+msgstr "S'ha detectat un flux de bits empaquetat"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:83
-msgid "Parameter Error"
-msgstr "S'ha produ?t un error de par?metre"
+#: avidemux/ADM_editor/ADM_edit.cpp:713
+msgid "Do you want me to unpack it ?"
+msgstr "Voleu que el desempaqueti?"
 
-#: avidemux/ADM_videoFilter/ADM_vidFade.cpp:83
-msgid "Start must be before end, and both within video # of frames."
-msgstr "L'inici ha d'estar abans del final, i ambd?s dins del # de fotogr. del v?deo."
+#: avidemux/ADM_editor/ADM_edit.cpp:733
+msgid "Could not unpack the video"
+msgstr "No s'ha pogut desempaquetar el v?deo"
 
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
-msgid "_Quantizer:"
-msgstr "_Quantificador:"
+#: avidemux/ADM_editor/ADM_edit.cpp:733
+msgid "Using backup decoder - not frame accurate."
+msgstr "S'est? usant 'backup decoder' - no ?s acurat pel que fa als fotogrames."
 
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:90
-msgid "_Noise:"
-msgstr "Soroll _(N):"
+#: avidemux/ADM_editor/ADM_edit.cpp:738
+msgid "Weird"
+msgstr "?s estrany"
 
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:90
-msgid "If pixels are closer than noise, they are considered to be the same"
-msgstr "Si els p?xels s?n m?s propers que el llindar de soroll es consideren id?ntics"
+#: avidemux/ADM_editor/ADM_edit.cpp:738
+msgid "The unpacking succeedeed but the index is still not up to date."
+msgstr "El desempaquetat ha anat b? per? l'?ndex encara no est? actualitzat."
 
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:91
-msgid "_Identical:"
-msgstr "_Id?ntic:"
+#: avidemux/ADM_editor/ADM_edit.cpp:744
+msgid "Troubles ahead"
+msgstr "Hi ha problemes a la vista"
 
-#: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:92
-msgid "_Show metrics"
-msgstr "Mostra mesuram. (_S)"
+#: avidemux/ADM_editor/ADM_edit.cpp:744
+msgid "This a VOP packed AVI."
+msgstr "?s un AVI empaquetat com a VOP."
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:93
-msgid "Smaller means more deinterlacing"
-msgstr "M?s petit suposa m?s desentrella?ament"
+#: avidemux/ADM_editor/ADM_edit.cpp:755
+msgid "Index is not up to date"
+msgstr "L'?ndex no est? actualitzat"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:94
-msgid "_Sharp"
-msgstr "_Nitideja"
+#: avidemux/ADM_editor/ADM_edit.cpp:755
+msgid "You should use Tool->Rebuild frame. Do it now ?"
+msgstr "Heu d'usar \"Eines -> Reconstrueix fotogrames\". Ho voleu fer ara?"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:94
-msgid "_Sharper engine:"
-msgstr "Nitidejador:"
+#: avidemux/ADM_editor/ADM_edit.cpp:1510
+msgid ""
+"This looks like mpeg\n"
+" Do you want to index it?"
+msgstr ""
+"Sembla que sigui del tipus MPEG\n"
+" Voleu indexar-lo?"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:95
-msgid "T_woway"
-msgstr "Dues Vies (_W)"
+#: avidemux/ADM_editor/ADM_edit.cpp:1562
+msgid "Indexing failed"
+msgstr "Ha fallat la indexaci?"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:95
-msgid "Extrapolate better (better not to use it)"
-msgstr "Extrapola millor (m?s val no fer-la servir)"
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:75
+msgid "Unsupported"
+msgstr "No est? suportat"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:96
-msgid "_Map"
-msgstr "_Mapeja"
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:301
+msgid "Old format project file"
+msgstr "Format de projecte antic"
 
-#: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:96
-msgid "Show interlaced areas (for test!)"
-msgstr "Mostra ?rees entrella?ades (nom?s prova!)"
+#: avidemux/ADM_editor/ADM_edLoadSave.cpp:301
+msgid "No more supported."
+msgstr "Ja no est? suportat/da."
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:104
-msgid "Fast"
-msgstr "R?pid"
+#: avidemux/ADM_editor/ADM_outputfmt.h:39
+msgid "AVI, dual audio"
+msgstr "AVI, ?udio dual"
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:105
-msgid "Medium"
-msgstr "Mitj?"
+#: avidemux/ADM_editor/ADM_outputfmt.h:40
+msgid "AVI, pack VOP"
+msgstr "AVI, VOP empaq."
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:106
-msgid "Slow iterative motion search"
-msgstr "Lent, estimaci? iterativa movim."
+#: avidemux/ADM_editor/ADM_outputfmt.h:41
+msgid "AVI, unpack VOP"
+msgstr "AVI, VOP desemp."
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:107
-msgid "Extra slow (same as 3+multiple reference frames)"
-msgstr "Extra lent (com [3] + fotogr. refer?n. m?ltiple)"
+#: avidemux/ADM_editor/ADM_outputfmt.h:42
+msgid "MPEG-PS (A+V)"
+msgstr "MPEG-PS (A+V)"
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:114
-msgid "_Field dominance:"
-msgstr "Domin?ncia marc (_F):"
+#: avidemux/ADM_editor/ADM_outputfmt.h:43
+msgid "MPEG-TS (A+V)"
+msgstr "MPEG-TS (A+V)"
 
-#: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:115
-msgid "_Qp:"
-msgstr "_QP:"
+#: avidemux/ADM_editor/ADM_outputfmt.h:44
+msgid "MPEG video"
+msgstr "V?deo MPEG"
 
-#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:90
-msgid "_Horizontal stacking:"
-msgstr "Empilament _horitz.:"
+#: avidemux/ADM_editor/ADM_outputfmt.h:45
+msgid "MP4"
+msgstr "MP4"
 
-#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:91
-msgid "_Vertical stacking:"
-msgstr "Empilament _vertic.:"
+#: avidemux/ADM_editor/ADM_outputfmt.h:47
+msgid "PSP"
+msgstr "PSP"
 
-#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:92
-msgid "_Shrink factor:"
-msgstr "Factor reduc. (_S):"
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:58
+msgid "No video loaded"
+msgstr "No hi ha cap v?deo carregat"
 
-#: avidemux/ADM_videoFilter/ADM_vidMosaic.cpp:93
-msgid "Show _frame"
-msgstr "Mostra _fotogr."
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:63
+msgid "Not indexable"
+msgstr "No ?s indexable"
 
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:74
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:74
-msgid "_Spatial luma strength:"
-msgstr "For?a e_spacial luma:"
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:63
+msgid "DivX 5 + packed?"
+msgstr "?s de tipus DivX 5 + empaquetat?"
 
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:75
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:75
-msgid "S_patial chroma strength:"
-msgstr "For?a e_spacial croma:"
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:93
+msgid "Rebuilding Frames"
+msgstr "S'estan reconstruint els fotogrames"
 
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp:76
-#: avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp:76
-msgid "_Temporal strength:"
-msgstr "For?a _temporal:"
+#: avidemux/ADM_editor/ADM_edFrameType.cpp:129
+msgid "Aborted"
+msgstr "S'ha cancel?lat"
 
-#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:163
-msgid "_Mask"
-msgstr "_M?scara"
+#: avidemux/ADM_codecs/ADM_ffmp43.cpp:52
+msgid "Internal error finding codec"
+msgstr "S'ha produ?t un error intern en la cerca del c?dec"
 
-#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:164
-msgid "_High Q"
-msgstr "_High Q"
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+msgid "Internal error opening codec"
+msgstr "S'ha produ?t un error intern en l'obertura del c?dec"
 
-#: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:167
-msgid "_Strength:"
-msgstr "For?a (_S):"
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:55
+msgid "Internal error with context for  codec"
+msgstr "S'ha produ?t un error intern amb el context per al c?dec"
 
-#: avidemux/ADM_videoFilter/ADM_vidPalShift.cpp:76
-msgid "Try reverse"
-msgstr "Intenta reversi?"
+#: avidemux/ADM_audio/audiotimeline.cpp:83
+#: avidemux/ADM_audio/audiotimeline.cpp:94
+msgid "Building VBR map"
+msgstr "S'est? construint el mapa de VBR"
 
-#: avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp:85
-msgid "_New frame rate:"
-msgstr "_Nova veloc. imatge:"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:236
+msgid "Select a directory"
+msgstr "Seleccioneu un directori"
 
-#: avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp:86
-msgid "_Blend"
-msgstr "Fusiona (_B)"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:502
+msgid "Uinteger"
+msgstr "Uinteger"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:265
-msgid "90 degrees"
-msgstr "90 graus"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:517
+msgid "Float"
+msgstr "Float"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:265
-msgid "90?"
-msgstr "90?"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:535
+msgid "Toggle"
+msgstr "Toggle"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:266
-msgid "180 degrees"
-msgstr "180 graus"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:556
+msgid "No Strategy"
+msgstr "Sense estrat?gia"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:266
-msgid "180?"
-msgstr "180?"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:557
+msgid "3:2 Pulldown"
+msgstr "3:2 Pulldown"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:267
-msgid "270 degrees"
-msgstr "270 graus"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:558
+msgid "Pal/Secam"
+msgstr "Pal/Secam"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:267
-msgid "270?"
-msgstr "270?"
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:561
+msgid "menu"
+msgstr "men?"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:269
-msgid "Angle"
-msgstr "Angle"
+#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
+msgid "Metrics"
+msgstr "Mesuraments"
 
-#: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:271
-msgid "Rotate Params"
-msgstr "Params. rotaci?"
+#: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
+msgid "Do you want to print metrics on screen ?"
+msgstr "Voleu mostrar els mesuraments en pantalla?"
 
-#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:68
-msgid "_Luma threshold:"
-msgstr "Llindar _Luma:"
+#: avidemux/ADM_video/ADM_vidSRT.cpp:215
+msgid "Could not open subtitle file"
+msgstr "No es pot obrir el fitxer de subt?tols"
 
-#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:69
-msgid "C_hroma threshold:"
-msgstr "Llindar _Croma:"
+#: avidemux/ADM_video/ADM_vidSRT.cpp:235
+msgid "Cannot identify subtitle format"
+msgstr "No es pot identificar el format de subt?tol"
 
-#: avidemux/ADM_videoFilter/ADM_vidSoften.cpp:70
-msgid "_Radius:"
-msgstr "_Radi:"
+#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:118
+msgid "Could not open OSS audio device"
+msgstr "No es pot obrir el dispositiu d'?udio OSS"
 
-#: avidemux/ADM_videoFilter/ADM_vidStabilize.cpp:63
-msgid "Stabilize Threshold"
-msgstr "Estabilitza llindar"
+#: avidemux/ADM_audiodevice/ADM_deviceoss.cpp:118
+msgid "Check the permissions for /dev/dsp."
+msgstr "Comproveu els permisos per a /dev/dsp."
 
-#: avidemux/ADM_videoFilter/ADM_vidVlad.cpp:101
-msgid "Luma Temporal Threshold"
-msgstr "Llindar temporal luma"
+#: avidemux/ADM_ocr/adm_glyph.cpp:173
+msgid "Could not write the file"
+msgstr "No s'ha pogut escriure el fitxer"
 
-#: avidemux/ADM_videoFilter/ADM_vidVlad.cpp:102
-msgid "Chroma Temporal Threshold"
-msgstr "Llindar tempora croma"
+#: avidemux/ADM_ocr/adm_glyph.cpp:221
+#, c-format
+msgid "Could not read \"%s\"."
+msgstr "No es pot llegir \"%s\" ."
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:171
-msgid "Temporal & Spatial check"
-msgstr "Comprov. temp. i espacial "
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:254
+msgid "Ifo error"
+msgstr "S'ha produ?t un error de fitxer IFO"
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:172
-msgid "Bob, T+S check"
-msgstr "Bob, compr. temp. i espac."
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:254
+msgid "Error reading ifo file, aborting."
+msgstr "S'ha produ?t un error en llegir el fitxer IFO. S'est? cancel?lant."
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:173
-msgid "Skip spatial temporal check"
-msgstr "Salta compr. temp. espacial "
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:262
+msgid "Cannot write .idx"
+msgstr "No es pot escriure el fitxer .IDX"
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:174
-msgid "Bob, Skip spatial temporal check"
-msgstr "Bob, salta compr. temp. espac."
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:275
+msgid "Cannot write .sub"
+msgstr "No es pot escriure el fitxer .SUB"
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:177
-msgid "Bottom Field first"
-msgstr "Marc baix abans"
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:287
+msgid "Problem opening the mpeg files"
+msgstr "S'ha produ?t un problema en obrir els fitxers de mpeg"
 
-#: avidemux/ADM_videoFilter/ADM_vidYadif.cpp:182
-msgid "Order"
-msgstr "Ordre"
+#: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:300
+msgid "Generating VobSub file"
+msgstr "S'est? generant el fitxer de VobSub"
 
-#: avidemux/gtk_gui.cpp:243
-msgid "Select ecmascript to run "
-msgstr "Seleccioneu un ecmascript per executar"
+#: avidemux/GUI_jobs.cpp:37
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:102
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:126
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:146
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:153
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:164
+msgid "Oops"
+msgstr "Oops"
 
-#: avidemux/gtk_gui.cpp:290
-#: avidemux/gtk_gui.cpp:329
+#: avidemux/GUI_jobs.cpp:37
+msgid "Something very wrong happened when building joblist."
+msgstr "S'ha produ?t un error molt greu en construir la llista de tasques."
+
+#: avidemux/GUI_jobs.cpp:42
+msgid "There are no jobs stored"
+msgstr "No hi ha cap tasca desada"
+
+#: avidemux/gui_navigate.cpp:76
+#: avidemux/gui_navigate.cpp:114
+#: avidemux/gui_navigate.cpp:390
+#: avidemux/gui_navigate.cpp:426
+msgid "Decompressing error"
+msgstr "S'ha produ?t un error en descomprimir"
+
+#: avidemux/gui_navigate.cpp:76
+msgid "Cannot decode next frame."
+msgstr "No es pot descodificar el seg?ent fotograma"
+
+#: avidemux/gui_navigate.cpp:114
+#: avidemux/gui_navigate.cpp:426
+msgid "Cannot decode keyframe."
+msgstr "No es pot descodificar el seg?ent fotograma clau"
+
+#: avidemux/gui_navigate.cpp:237
+msgid "Seeking"
+msgstr "S'est? cercant"
+
+#: avidemux/gui_navigate.cpp:315
+msgid "Finding black frames"
+msgstr "S'estan cercant fotogrames negres"
+
+#: avidemux/gui_navigate.cpp:390
+msgid "Cannot decode the frame."
+msgstr "No es pot descodificar el fotograma"
+
+#: avidemux/gui_autodrive.cpp:52
+msgid "No audio track"
+msgstr "No hi ha pista d'?udio"
+
+#: avidemux/gui_autodrive.cpp:52
+msgid "An audio track is necessary to create such file"
+msgstr "Cal una pista d'?udio per crear un fitxer com aquest"
+
+#: avidemux/gui_autodrive.cpp:82
+msgid "Cannot select mpeg4 sp codec."
+msgstr "No es pot seleccionar el c?dec\"'mpeg4 sp\"."
+
+#: avidemux/gui_autodrive.cpp:117
+msgid ""
+"You don't have FAAC!.\n"
+"It is needed to create PSP compatible video."
+msgstr ""
+"No disposeu de FACC.\n"
+"El necessiteu per crear un v?deo compatible amb PSP."
+
+#: avidemux/gui_savenew.cpp:87
+msgid "Dual audio can only be used in copy mode"
+msgstr "L'?udio dual nom?s es pot utilitzar en mode de c?pia"
+
+#: avidemux/gui_savenew.cpp:87
+msgid "Select Copy as the video codec."
+msgstr "Seleccioneu \"Copiat\" com a c?dec de v?deo."
+
+#: avidemux/gui_savenew.cpp:197
+#: avidemux/gui_savenew.cpp:213
+#: avidemux/gui_savenew.cpp:226
+msgid "Incompatible output format"
+msgstr "El format de sortida ?s incompatible"
+
+#: avidemux/gui_savenew.cpp:244
+msgid "There is no second track"
+msgstr "No hi ha una segona pista"
+
+#: avidemux/gui_savenew.cpp:244
+msgid "Select a second audio track in the Audio menu."
+msgstr "Seleccioneu una segona pista d'?udio al men? d'?udio."
+
+#: avidemux/gui_savenew.cpp:248
+msgid "Select dual audio AVI to write"
+msgstr "Seleccioneu ?udio dual AVI per escriure."
+
+#: avidemux/gui_savenew.cpp:270
+#: avidemux/gui_savenew.cpp:288
+msgid "This cannot have packed VOP"
+msgstr "No pot ser que tingui empaquetat un VOP"
+
+#: avidemux/gui_savenew.cpp:270
+#: avidemux/gui_savenew.cpp:288
+msgid "It is not MPEG-4 video. File will not be saved."
+msgstr "No ?s un v?deo MPEG-4. El fitxer no es pot desar."
+
+#: avidemux/gui_savenew.cpp:334
+msgid ""
+"You may need smart copy.\n"
+" Enable it ?"
+msgstr ""
+"Pot ser que necessiteu una c?pia intel?ligent.\n"
+"La voleu habilitar?"
+
+#: avidemux/guiplay.cpp:361
+msgid "Trouble initializing audio device"
+msgstr "S'ha produ?t un problema en inicialitzar el dispositiu d'?udio"
+
+#: avidemux/gtk_gui.cpp:252
+msgid "Select ECMAScript to Run"
+msgstr "Seleccioneu un ECMAScript per executar."
+
+#: avidemux/gtk_gui.cpp:299
+#: avidemux/gtk_gui.cpp:338
 msgid "Obsolete"
 msgstr "?s obsolet"
 
-#: avidemux/gtk_gui.cpp:357
+#: avidemux/gtk_gui.cpp:366
 msgid "Not coded in this version"
 msgstr "No s'ha codificat en aquesta versi?"
 
-#: avidemux/gtk_gui.cpp:370
-#: avidemux/gtk_gui.cpp:375
-#: avidemux/gtk_gui.cpp:487
-#: avidemux/gtk_gui.cpp:490
-msgid "Select AVI file..."
-msgstr "Seleccioneu un fitxer AVI..."
+#: avidemux/gtk_gui.cpp:381
+#: avidemux/gtk_gui.cpp:386
+#: avidemux/gtk_gui.cpp:505
+#: avidemux/gtk_gui.cpp:508
+msgid "Select AVI File..."
+msgstr "Selecciona fitxer AVI"
 
-#: avidemux/gtk_gui.cpp:423
+#: avidemux/gtk_gui.cpp:441
 msgid ""
-"This is to be used to undo packed vop on mpeg4.\n"
+"This is to be used to undo packed VOP on MPEG-4.\n"
 "Continue ?"
 msgstr ""
 "Aix? ?s per desfer un empaquetament de VOP sobre MPEG4.\n"
 "Voleu continuar?"
 
-#: avidemux/gtk_gui.cpp:425
-msgid "Select Avi file to write"
-msgstr "Seleccioneu el fitxer d'AVI per escriure"
+#: avidemux/gtk_gui.cpp:443
+msgid "Select AVI File to Write"
+msgstr "Seleccioneu un fitxer d'AVI per escriure."
 
-#: avidemux/gtk_gui.cpp:431
-msgid "Select OGM file to write"
-msgstr "Seleccioneu el fitxer d'OGM per escriure"
+#: avidemux/gtk_gui.cpp:449
+msgid "Select OGM File to Write"
+msgstr "Seleccioneu un fitxer d'OGM per escriure."
 
-#: avidemux/gtk_gui.cpp:442
-#: avidemux/gtk_gui.cpp:453
-msgid "Select workbench to save "
-msgstr "Seleccioneu el banc de treball per desar"
+#: avidemux/gtk_gui.cpp:460
+#: avidemux/gtk_gui.cpp:471
+msgid "Select Workbench to Save"
+msgstr "Seleccioneu una tasca per desar."
 
-#: avidemux/gtk_gui.cpp:477
-msgid "Select raw file to save "
-msgstr "Seleccioneu el fitxer de cru per desar"
+#: avidemux/gtk_gui.cpp:495
+msgid "Select Raw File to Save"
+msgstr "Seleccioneu un fitxer de \"cru\" per desar."
 
-#: avidemux/gtk_gui.cpp:493
-msgid "Select AVI file to append..."
-msgstr "Seleccioneu el fitxer d'AVI per afegir..."
+#: avidemux/gtk_gui.cpp:511
+msgid "Select AVI File to Append..."
+msgstr "Seleccioneu un fitxer d'AVI per afegir."
 
-#: avidemux/gtk_gui.cpp:497
-msgid "Select file to save audio"
-msgstr "Seleccioneu el fitxer per desar l'?udio"
+#: avidemux/gtk_gui.cpp:515
+msgid "Select File to Save Audio"
+msgstr "Seleccioneu un fitxer per desar l'?udio."
 
-#: avidemux/gtk_gui.cpp:531
-msgid "Select Jpeg sequence to save "
-msgstr "Seleccioneu un seguit de fitxers JPEG per desar"
+#: avidemux/gtk_gui.cpp:549
+msgid "Select JPEG Sequence to Save"
+msgstr "Seleccioneu un seguit de fitxers de JPEG per desar."
 
-#: avidemux/gtk_gui.cpp:534
-msgid "Select BMP to save "
-msgstr "Seleccioneu un fitxer BMP per desar"
+#: avidemux/gtk_gui.cpp:552
+msgid "Select BMP to Save"
+msgstr "Seleccioneu un fitxer de BMP per desar."
 
-#: avidemux/gtk_gui.cpp:538
-msgid "Select Jpeg to save "
-msgstr "Seleccioneu un fitxer JPEG per desar"
+#: avidemux/gtk_gui.cpp:556
+msgid "Select JPEG to Save"
+msgstr "Seleccioneu un fitxer de JPEG per desar."
 
-#: avidemux/gtk_gui.cpp:591
-msgid "Select file to save"
-msgstr "Seleccioneu un fitxer per desar"
+#: avidemux/gtk_gui.cpp:609
+#: avidemux/gtk_gui.cpp:713
+msgid "Select File to Save"
+msgstr "Seleccioneu un fitxer per desar."
 
-#: avidemux/gtk_gui.cpp:643
-msgid "Select MP3 to load "
-msgstr "Seleccioneu un fitxer de MP3 per carregar"
+#: avidemux/gtk_gui.cpp:653
+msgid "Select MP3 to Load"
+msgstr "Seleccioneu un fitxer d'MP3 per carregar."
 
-#: avidemux/gtk_gui.cpp:646
-msgid "Select AC3 to load "
-msgstr "Seleccioneu un fitxer d'AC3 per carregar"
+#: avidemux/gtk_gui.cpp:656
+msgid "Select AC3 to Load"
+msgstr "Seleccioneu un fitxer d'AC3 per carregar."
 
-#: avidemux/gtk_gui.cpp:649
-msgid "Select WAV to load "
-msgstr "Seleccioneu un fitxer de WAV per carregar"
+#: avidemux/gtk_gui.cpp:659
+msgid "Select WAV to Load"
+msgstr "Seleccioneu un fitxer de WAV per carregar."
 
-#: avidemux/gtk_gui.cpp:697
+#: avidemux/gtk_gui.cpp:707
 msgid "Out of bounds"
 msgstr "S'ha produ?t una sortida dels l?mits"
 
-#: avidemux/gtk_gui.cpp:703
-msgid "Select  file to save "
-msgstr "Seleccioneu un fitxer per desar"
-
-#: avidemux/gtk_gui.cpp:708
-#: avidemux/gtk_gui.cpp:1913
+#: avidemux/gtk_gui.cpp:718
+#: avidemux/gtk_gui.cpp:1921
 msgid "Marker A > B"
 msgstr "Marcador A > B"
 
-#: avidemux/gtk_gui.cpp:708
+#: avidemux/gtk_gui.cpp:718
 msgid "Cannot copy."
 msgstr "No es pot efectuar la c?pia."
 
-#: avidemux/gtk_gui.cpp:720
+#: avidemux/gtk_gui.cpp:730
 msgid "Something bad happened (II))"
 msgstr "Alguna cosa ha anat malament (II)"
 
-#: avidemux/gtk_gui.cpp:734
-msgid "Are you sure ?"
+#: avidemux/gtk_gui.cpp:744
+msgid "Are you sure?"
 msgstr "N'esteu segur?"
 
-#: avidemux/gtk_gui.cpp:812
+#: avidemux/gtk_gui.cpp:799
+msgid "Frame Rate"
+msgstr "Veloc. imatge "
+
+#: avidemux/gtk_gui.cpp:799
+msgid "_Frames per second:"
+msgstr "_Fotogr. per segon: "
+
+#: avidemux/gtk_gui.cpp:822
 msgid "Width is not a multiple of 8"
 msgstr "L'amplada no ?s un m?ltiple de 8"
 
-#: avidemux/gtk_gui.cpp:813
-msgid "This will make trouble for avi files."
-msgstr "Aix? suposar? un problema per al fitxers d'AVI"
+#: avidemux/gtk_gui.cpp:823
+msgid "This will make trouble for AVI files."
+msgstr "Aix? suposar? un problema per al fitxers d'AVI."
 
-#: avidemux/gtk_gui.cpp:823
+#: avidemux/gtk_gui.cpp:833
 msgid "Rebuild all Keyframes?"
 msgstr "Voleu reconstruir tots els fotogrames clau?"
 
-#: avidemux/gtk_gui.cpp:877
+#: avidemux/gtk_gui.cpp:891
 msgid "Permission error"
 msgstr "S'ha produ?t un error sobre permisos"
 
-#: avidemux/gtk_gui.cpp:880
+#: avidemux/gtk_gui.cpp:894
 #, c-format
 msgid "\"%s\" does not exist."
 msgstr "\"%s\" no existeix."
 
-#: avidemux/gtk_gui.cpp:940
+#: avidemux/gtk_gui.cpp:936
 msgid "Cannot open project using the video loader."
 msgstr "No es pot obrir el projecte utilitzant el carregador de v?deo."
 
-#: avidemux/gtk_gui.cpp:941
+#: avidemux/gtk_gui.cpp:937
 msgid "Try 'File' -> 'Load/Run Project...'"
 msgstr "Proveu amb  'Fitxer' -> 'Carr/Exec Projecte...'"
 
-#: avidemux/gtk_gui.cpp:943
+#: avidemux/gtk_gui.cpp:939
 msgid "Could not open the file"
-msgstr "No s'ha pogut obrir el fitxer"
+msgstr "No s'ha pogut obrir el fitxer."
 
-#: avidemux/gtk_gui.cpp:978
+#: avidemux/gtk_gui.cpp:974
 msgid "Multiple Audio Tracks"
 msgstr "Pistes d'?udio m?ltiples"
 
-#: avidemux/gtk_gui.cpp:978
+#: avidemux/gtk_gui.cpp:974
 msgid ""
 "The file you just loaded contains several audio tracks.\n"
 "Go to Audio->MainTrack to select the active one."
 msgstr ""
 "El fitxer que acabeu de carregar cont? diverses pistes d'?udio.\n"
-"Aneu a '?udio->Pista Princ.' per seleccionar la pista activa."
+"Aneu a \"?udio -> Pista Principal\" per seleccionar la pista activa."
 
-#: avidemux/gtk_gui.cpp:1068
+#: avidemux/gtk_gui.cpp:1064
 msgid "No audio decoder found for this file"
-msgstr "No s'ha trobat descodificador d'?udio per a aquest fitxer"
+msgstr "No s'ha trobat descodificador d'?udio per a aquest fitxer."
 
-#: avidemux/gtk_gui.cpp:1069
+#: avidemux/gtk_gui.cpp:1065
 msgid "Save (A+V) will generate bad AVI. Save audio will work."
-msgstr "El desament de (A+V) generar? un AVI dolent. El desament d'?udio anir? b?."
+msgstr "El desament de (A+V) generar? un AVI defectu?s. El desament d'?udio anir? b?."
 
-#: avidemux/gtk_gui.cpp:1125
+#: avidemux/gtk_gui.cpp:1121
 msgid "Something failed when appending"
-msgstr "Alguna cosa ha fallat en afegir"
+msgstr "Alguna cosa ha fallat en afegir."
 
-#: avidemux/gtk_gui.cpp:1134
-#: avidemux/gtk_gui.cpp:1932
+#: avidemux/gtk_gui.cpp:1130
+#: avidemux/gtk_gui.cpp:1940
 msgid "Something bad happened (II)"
-msgstr "Alguna cosa ha falalt (II)"
+msgstr "Alguna cosa ha falalt (II)."
 
-#: avidemux/gtk_gui.cpp:1198
+#: avidemux/gtk_gui.cpp:1194
 msgid "Cannot save the audio in copy mode"
-msgstr "No es pot desar l'?udio en mode de c?pia"
+msgstr "No es pot desar l'?udio en mode de \"Copiat\"."
 
-#: avidemux/gtk_gui.cpp:1198
+#: avidemux/gtk_gui.cpp:1194
 msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "Seleccioneu WAV PCM com a c?dec d'?udio. Altrament el fitxer d'?udio ser? de PCM cru."
 
-#: avidemux/gtk_gui.cpp:1206
+#: avidemux/gtk_gui.cpp:1202
 #: avidemux/gtk_gui.cpp:1562
 msgid "Saving audio"
-msgstr "S'est? desant l'?udio"
+msgstr "S'est? desant l'?udio."
 
-#: avidemux/gtk_gui.cpp:1283
+#: avidemux/gtk_gui.cpp:1279
 msgid "Get Frame"
 msgstr "Obt? fotograma"
 
-#: avidemux/gtk_gui.cpp:1283
+#: avidemux/gtk_gui.cpp:1279
 msgid "Cannot get this frame to save"
-msgstr "No es pot desar aquest fotograma"
+msgstr "No es pot obtenir aquest fotograma per desar."
 
-#: avidemux/gtk_gui.cpp:1320
+#: avidemux/gtk_gui.cpp:1316
 msgid "Mark A > B"
 msgstr "Marca A > B"
 
-#: avidemux/gtk_gui.cpp:1320
+#: avidemux/gtk_gui.cpp:1316
 msgid "Set your markers correctly."
 msgstr "Fixeu els marcadors correctament."
 
-#: avidemux/gtk_gui.cpp:1329
+#: avidemux/gtk_gui.cpp:1325
 msgid "Saving as set of jpegs"
-msgstr "S'estan desant com a grup de JPEG"
+msgstr "S'estan desant com a grup de JPEG."
 
-#: avidemux/gtk_gui.cpp:1335
+#: avidemux/gtk_gui.cpp:1331
 msgid "Cannot decode frame"
-msgstr "No es pot descodificar el fotograma"
+msgstr "No es pot descodificar el fotograma."
 
-#: avidemux/gtk_gui.cpp:1335
+#: avidemux/gtk_gui.cpp:1331
 msgid "Aborting."
 msgstr "S'est? cancel?lant."
 
-#: avidemux/gtk_gui.cpp:1346
-#: avidemux/gtk_gui.cpp:1365
-#: avidemux/gtk_gui.cpp:2276
+#: avidemux/gtk_gui.cpp:1342
+#: avidemux/gtk_gui.cpp:1361
+#: avidemux/gtk_gui.cpp:2284
 msgid "Done"
 msgstr "Fet"
 
-#: avidemux/gtk_gui.cpp:1346
+#: avidemux/gtk_gui.cpp:1342
 #, c-format
 msgid "Saved %d images."
 msgstr "S'han desat %d imatges."
 
-#: avidemux/gtk_gui.cpp:1348
+#: avidemux/gtk_gui.cpp:1344
 msgid "Error"
-msgstr " Error"
+msgstr "Error"
 
-#: avidemux/gtk_gui.cpp:1348
+#: avidemux/gtk_gui.cpp:1344
 msgid "Could not save all images."
-msgstr "No s'han pogut desar tots els fotogrames"
+msgstr "No s'han pogut desar totes les imatges."
 
-#: avidemux/gtk_gui.cpp:1365
+#: avidemux/gtk_gui.cpp:1361
 #, c-format
 msgid "Saved \"%s\"."
 msgstr "S'ha desat el fitxer \"%s\"."
 
-#: avidemux/gtk_gui.cpp:1367
+#: avidemux/gtk_gui.cpp:1363
 msgid "BMP op failed"
-msgstr "Op. BMP fallida"
+msgstr "Ha fallat l'operaci? de BMP."
 
-#: avidemux/gtk_gui.cpp:1367
+#: avidemux/gtk_gui.cpp:1363
 #, c-format
 msgid "Saving %s as a BMP file failed."
 msgstr "El desament de %s com a fitxer de BMP ha fallat."
 
-#: avidemux/gtk_gui.cpp:1387
-#: avidemux/gtk_gui.cpp:1453
+#: avidemux/gtk_gui.cpp:1383
+#: avidemux/gtk_gui.cpp:1449
 msgid "Failed to open the file"
-msgstr "Ha fallat l'obertura del fitxer"
+msgstr "Ha fallat l'obertura del fitxer."
 
-#: avidemux/gtk_gui.cpp:1387
-#: avidemux/gtk_gui.cpp:1453
+#: avidemux/gtk_gui.cpp:1383
+#: avidemux/gtk_gui.cpp:1449
 msgid "Not a WAV file?"
 msgstr "No ?s un fitxer de WAV?"
 
-#: avidemux/gtk_gui.cpp:1388
+#: avidemux/gtk_gui.cpp:1384
 #, c-format
 msgid "WAV open file failed..."
-msgstr "Ha fallat l'obertura del fitxer de WAV"
+msgstr "Ha fallat l'obertura del fitxer de WAV."
 
-#: avidemux/gtk_gui.cpp:1523
+#: avidemux/gtk_gui.cpp:1516
 msgid "Cannot decompress audio frame"
-msgstr "No es pot descomprimir el segment sonor"
+msgstr "No es pot descomprimir el segment sonor."
 
-#: avidemux/gtk_gui.cpp:1537
+#: avidemux/gtk_gui.cpp:1523
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
+#, c-format
+msgid "Cannot open \"%s\" for writing."
+msgstr "No es pot obrir  \"%s\" per a lectura."
+
+#: avidemux/gtk_gui.cpp:1530
 msgid "Memory Error"
 msgstr "S'ha produ?t un error de mem?ria"
 
@@ -6174,247 +6568,542 @@
 msgid "Please check markers. Is \"A>\" == \">B\"?"
 msgstr "Comproveu els marcadors. ?s \"A>\" == \">B\"?"
 
-#: avidemux/gtk_gui.cpp:1702
+#: avidemux/gtk_gui.cpp:1710
 msgid "Saving raw video stream"
-msgstr "S'est? desant el flux de v?deo cru"
+msgstr "S'est? desant el flux de v?deo cru."
 
-#: avidemux/gtk_gui.cpp:1864
+#: avidemux/gtk_gui.cpp:1856
+msgid "Checking video"
+msgstr "S'est? comprovant el v?deo."
+
+#: avidemux/gtk_gui.cpp:1872
 msgid "No error found"
 msgstr "No s'ha trobat cap error"
 
-#: avidemux/gtk_gui.cpp:1868
+#: avidemux/gtk_gui.cpp:1876
 #, c-format
 msgid "Errors found in %u frames"
-msgstr "S'han trobat errors en %u fotogrames"
+msgstr "S'han trobat errors en %u fotogrames."
 
-#: avidemux/gtk_gui.cpp:1886
+#: avidemux/gtk_gui.cpp:1894
 msgid "Cannot decompress the audio stream"
-msgstr "No podeu descomprimir el flux d'?udio"
+msgstr "No podeu descomprimir el flux d'?udio."
 
-#: avidemux/gtk_gui.cpp:1886
+#: avidemux/gtk_gui.cpp:1894
 msgid "Switch audio codec to Copy."
-msgstr "Canvieu el c?dec d'?udio a 'Copiat'"
+msgstr "Canvieu el c?dec d'?udio a \"Copiat\"."
 
-#: avidemux/gtk_gui.cpp:1913
+#: avidemux/gtk_gui.cpp:1921
 msgid "Cannot delete the selection."
 msgstr "No podeu esborrar la selecci?"
 
-#: avidemux/gtk_gui.cpp:1918
+#: avidemux/gtk_gui.cpp:1926
 msgid "You can't remove all frames"
-msgstr "No podeu esborrar tots els fotogrames"
+msgstr "No podeu esborrar tots els fotogrames."
 
-#: avidemux/gtk_gui.cpp:1994
+#: avidemux/gtk_gui.cpp:1933
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:417
+msgid "Something bad happened"
+msgstr "Alguna cosa no ha funcionat"
+
+#: avidemux/gtk_gui.cpp:2002
 msgid "Could not get tracks info"
-msgstr "No s'ha pogut obtenir informaci? sobre les pistes"
+msgstr "No s'ha pogut obtenir informaci? sobre les pistes."
 
-#: avidemux/gtk_gui.cpp:2002
+#: avidemux/gtk_gui.cpp:2010
 msgid "Video"
 msgstr "V?deo"
 
-#: avidemux/gtk_gui.cpp:2002
+#: avidemux/gtk_gui.cpp:2010
 msgid "Take audio from video file"
 msgstr "Pren l'?udio del fitxer de v?deo"
 
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:2011
+#: avidemux/gtk_gui.cpp:2110
 msgid "No audio"
 msgstr "No hi ha ?udio"
 
-#: avidemux/gtk_gui.cpp:2004
-#: avidemux/gtk_gui.cpp:2103
+#: avidemux/gtk_gui.cpp:2012
+#: avidemux/gtk_gui.cpp:2111
 msgid "External AC3"
 msgstr "AC3 extern"
 
-#: avidemux/gtk_gui.cpp:2004
-#: avidemux/gtk_gui.cpp:2103
+#: avidemux/gtk_gui.cpp:2012
+#: avidemux/gtk_gui.cpp:2111
 msgid "Take audio from external AC3 file"
-msgstr "Pren ?udio de fitxer AC3 extern"
+msgstr "Pren l'?udio de fitxer d'AC3 extern."
 
-#: avidemux/gtk_gui.cpp:2005
-#: avidemux/gtk_gui.cpp:2104
+#: avidemux/gtk_gui.cpp:2013
+#: avidemux/gtk_gui.cpp:2112
 msgid "External MP3"
 msgstr "MP3 extern"
 
-#: avidemux/gtk_gui.cpp:2005
-#: avidemux/gtk_gui.cpp:2104
+#: avidemux/gtk_gui.cpp:2013
+#: avidemux/gtk_gui.cpp:2112
 msgid "Take audio from external MP3 file"
-msgstr "Pren ?udio de fitxer MP3 extern"
+msgstr "Pren l'?udio de fitxer d'MP3 extern."
 
-#: avidemux/gtk_gui.cpp:2006
-#: avidemux/gtk_gui.cpp:2105
-msgid "External Wav"
+#: avidemux/gtk_gui.cpp:2014
+#: avidemux/gtk_gui.cpp:2113
+msgid "External WAV"
 msgstr "WAV extern"
 
-#: avidemux/gtk_gui.cpp:2006
-#: avidemux/gtk_gui.cpp:2105
+#: avidemux/gtk_gui.cpp:2014
+#: avidemux/gtk_gui.cpp:2113
 msgid "Take audio from external WAV file"
-msgstr "Pren ?udio de fitxer WAV extern"
+msgstr "Pren l'?udio de fitxer de WAV extern."
 
-#: avidemux/gtk_gui.cpp:2010
-#: avidemux/gtk_gui.cpp:2110
-msgid "Audio source"
-msgstr "Font d'?udio"
+#: avidemux/gtk_gui.cpp:2018
+#: avidemux/gtk_gui.cpp:2118
+msgid "_Audio source:"
+msgstr "Font d'_?udio: "
 
-#: avidemux/gtk_gui.cpp:2014
-msgid "External filename"
-msgstr "Nom de fitxer extern"
+#: avidemux/gtk_gui.cpp:2022
+#: avidemux/gtk_gui.cpp:2119
+msgid "_External file:"
+msgstr "Nom del fitxer _extern: "
 
-#: avidemux/gtk_gui.cpp:2045
-#: avidemux/gtk_gui.cpp:2123
+#: avidemux/gtk_gui.cpp:2037
+msgid "_Track from video:"
+msgstr "_Pista des del v?deo: "
+
+#: avidemux/gtk_gui.cpp:2047
+msgid "Main Audio Track"
+msgstr "Pista principal d'?udio"
+
+#: avidemux/gtk_gui.cpp:2053
+#: avidemux/gtk_gui.cpp:2131
 msgid "Cannot load"
-msgstr "No es pot carregar"
+msgstr "No es pot carregar."
 
-#: avidemux/gtk_gui.cpp:2045
-#: avidemux/gtk_gui.cpp:2123
+#: avidemux/gtk_gui.cpp:2053
+#: avidemux/gtk_gui.cpp:2131
 msgid "The selected audio file does not exist."
 msgstr "El fitxer d'?udio seleccionat no existeix."
 
-#: avidemux/gtk_gui.cpp:2111
-msgid "Filename"
-msgstr "Nom de fitxer"
+#: avidemux/gtk_gui.cpp:2128
+msgid "Second Audio Track"
+msgstr "Pista secund?ria d'?udio"
 
-#: avidemux/gtk_gui.cpp:2120
-msgid "Select 2nd audio Track"
-msgstr "Selecciona 2a pista d'?udio"
-
-#: avidemux/gtk_gui.cpp:2152
+#: avidemux/gtk_gui.cpp:2160
 msgid "Error loading the MP3 file"
-msgstr "S'ha produ?t un error en carregar el fitxer de MP3"
+msgstr "S'ha produ?t un error en carregar el fitxer de MP3."
 
-#: avidemux/gtk_gui.cpp:2161
-#: avidemux/gtk_gui.cpp:2183
-#: avidemux/gtk_gui.cpp:2205
+#: avidemux/gtk_gui.cpp:2169
+#: avidemux/gtk_gui.cpp:2191
+#: avidemux/gtk_gui.cpp:2213
 msgid "Second track loaded"
-msgstr "S'ha carregar la segona pista"
+msgstr "S'ha carregat la segona pista."
 
-#: avidemux/gtk_gui.cpp:2175
+#: avidemux/gtk_gui.cpp:2183
 msgid "Error loading the AC3 file"
-msgstr "S'ha produ?t un error en carregar el fitxer d'AC3"
+msgstr "S'ha produ?t un error en carregar el fitxer d'AC3."
 
-#: avidemux/gtk_gui.cpp:2197
+#: avidemux/gtk_gui.cpp:2205
 msgid "Error loading the WAV file"
-msgstr "S'ha produ?t un error en carregar el fitxer de WAV"
+msgstr "S'ha produ?t un error en carregar el fitxer de WAV."
 
-#: avidemux/gtk_gui.cpp:2264
+#: avidemux/gtk_gui.cpp:2272
 msgid "Saving failed"
-msgstr "Ha fallat el desament"
+msgstr "Ha fallat el desament."
 
-#: avidemux/gtk_gui.cpp:2264
+#: avidemux/gtk_gui.cpp:2272
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
 msgstr "S'est? desant la tasca fallida. Potser teniu un problema de permisos amb ~/.avidemux "
 
-#: avidemux/gtk_gui.cpp:2276
+#: avidemux/gtk_gui.cpp:2284
 #, c-format
 msgid "File %s has been successfully saved."
-msgstr "El fitxer %s s'ha desat satisfact?riament"
+msgstr "El fitxer %s s'ha desat satisfact?riament."
 
-#: avidemux/gtk_gui.cpp:2280
+#: avidemux/gtk_gui.cpp:2288
 #, c-format
 msgid "File %s was NOT saved correctly."
-msgstr "El fitxer %s no s'ha desat correctament"
+msgstr "El fitxer %s no s'ha desat correctament."
 
-#: avidemux/guiplay.cpp:356
-msgid "Trouble initializing audio device"
-msgstr "S'ha produ?t un problema en inicialitzar el dispositiu d'?udio"
+#: avidemux/gtk_gui.cpp:2442
+msgid "AvsProxy"
+msgstr "AvsProxy"
 
-#: avidemux/gui_autodrive.cpp:52
-msgid "No audio track"
-msgstr "No hi ha pista d'?udio"
+#: avidemux/gtk_gui.cpp:2442
+msgid ""
+"Failed to connect to avsproxy.\n"
+"Is it running ?"
+msgstr ""
+"Ha fallar la connexi? a l'avsproxy.\n"
+"Segur que est? funcionant?"
 
-#: avidemux/gui_autodrive.cpp:52
-msgid "An audio track is necessary to create such file"
-msgstr "Cal una pista d'?udio per crear un fitxer com aquest"
+#: avidemux/gtk_gui.cpp:2447
+msgid "avsproxy"
+msgstr "avsproxy"
 
-#: avidemux/gui_autodrive.cpp:82
-msgid "Cannot select mpeg4 sp codec."
-msgstr "No es pot seleccionar el c?dec 'mpeg4 sp'"
+#: avidemux/gtk_gui.cpp:2475
+msgid "Frame type:"
+msgstr "Tipus fotograma: "
 
-#: avidemux/gui_autodrive.cpp:117
+#: avidemux/gtk_gui.cpp:2476
+msgid "Frame size:"
+msgstr "Mida fotograma: "
+
+#: avidemux/gtk_gui.cpp:2478
+msgid "Frame Hex Dump"
+msgstr "Bolcat hexadecimal fotograma"
+
+#: avidemux/ADM_osSupport/ADM_misc.cpp:215
+#, c-format
+msgid "%lu minutes"
+msgstr "%lu minuts"
+
+#: avidemux/ADM_osSupport/ADM_misc.cpp:219
+#, c-format
+msgid "%lu minute"
+msgstr "%lu minut"
+
+#: avidemux/ADM_osSupport/ADM_misc.cpp:227
+#, c-format
+msgid "%lu second"
+msgstr "%lu segon"
+
+#: avidemux/ADM_osSupport/ADM_misc.cpp:231
+#, c-format
+msgid "%lu seconds"
+msgstr "%lu segons"
+
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
+msgid "Fatal Error"
+msgstr "S'ha produ?t un error fatal "
+
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
 msgid ""
-"You don't have FAAC!.\n"
-"It is needed to create PSP compatible video."
+"A fatal error has occurred.\n"
+"\n"
+"Click OK to generate debug information. This may take a few minutes to complete."
 msgstr ""
-"No disposeu de FACC.\n"
-" El necessiteu per crear  v?deo compatible amb PSP."
+"S'ha produ?t un error fatal.\n"
+"\n"
+"Cliqueu \"Accepta\" per generar la informaci? de debug. Aix? trigar? uns minuts en portar-se a terme."
 
-#: avidemux/GUI_jobs.cpp:37
-msgid "Something very wrong happened when buildint joblist"
-msgstr "S'ha produ?t un error molt greu en construir la llista de tasques"
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+msgid "Load it"
+msgstr "Carrega'l"
 
-#: avidemux/GUI_jobs.cpp:42
-msgid "Nothing to do."
-msgstr "No hi ha res per fer"
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+msgid "Crash file"
+msgstr "Fitxer de recuperaci? de petada"
 
-#: avidemux/GUI_jobs.cpp:42
-msgid "There is no jobs stored, nothing to do"
-msgstr "No hi ha tasques emmagatzemades. No hi ha res per fer"
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:424
+msgid ""
+"I have detected a crash file. \n"
+"Do you want to load it  ?\n"
+"(It will be deleted in all cases, you should save it if you want to keep it)"
+msgstr ""
+"S'ha trobat un fitxer de recuperaci? de petada. \n"
+"El voleu carregar?\n"
+"(Sigui com sigui s'esborrar?, i si el voleu conservar l'haureu de desar)."
 
-#: avidemux/gui_navigate.cpp:75
-#: avidemux/gui_navigate.cpp:113
-#: avidemux/gui_navigate.cpp:389
-#: avidemux/gui_navigate.cpp:425
-msgid "Decompressing error"
-msgstr "S'ha produ?t un error en descomprimir"
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:102
+#, c-format
+msgid "can't create custom directory (%s)."
+msgstr "No es pot crear el directori personal (%s)."
 
-#: avidemux/gui_navigate.cpp:75
-msgid "Cannot decode next frame."
-msgstr "No es pot descodificar el seg?ent fotograma"
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:126
+#, c-format
+msgid "can't create job directory (%s)."
+msgstr "No es pot crear el directori de treball (%s)."
 
-#: avidemux/gui_navigate.cpp:113
-#: avidemux/gui_navigate.cpp:425
-msgid "Cannot decode keyframe."
-msgstr "No es pot descodificar el seg?ent fotograma clau"
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:146
+msgid "can't determine $USERPROFILE."
+msgstr "No es pot determinar $USERPROFILE."
 
-#: avidemux/gui_navigate.cpp:236
-msgid "Seeking"
-msgstr "S'est? cercant"
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:153
+msgid "can't determine $HOME."
+msgstr "No es pot determinar $HOME."
 
-#: avidemux/gui_navigate.cpp:389
-msgid "Cannot decode the frame."
-msgstr "No es pot descodificar el fotograma"
+#: avidemux/ADM_osSupport/ADM_fileio.cpp:164
+msgid "Cannot create the .avidemux directory"
+msgstr "No es pot crear el directori .avidemux."
 
-#: avidemux/gui_savenew.cpp:87
-msgid "Dual audio can only be used in copy mode"
-msgstr "L'?udio dual nom?s es pot utilitzar en mode de c?pia"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:152
+msgid "Cannot initialize the video stream"
+msgstr "No es pot inicialitzar el flux de v?deo."
 
-#: avidemux/gui_savenew.cpp:87
-msgid "Select Copy as the video codec."
-msgstr "Seleccioneu 'Copiat' com a c?dec de v?deo"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:170
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:76
+#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:93
+msgid "Filter init failed"
+msgstr "Ha fallat la inicialitzaci? del filtre."
 
-#: avidemux/gui_savenew.cpp:197
-#: avidemux/gui_savenew.cpp:213
-#: avidemux/gui_savenew.cpp:226
-msgid "Incompatible output format"
-msgstr "El format de sortida ?s incompatible"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:208
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:331
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:415
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:352
+msgid "Error while encoding"
+msgstr "S'ha produ?t un error en codificar."
 
-#: avidemux/gui_savenew.cpp:244
-msgid "There is no second track"
-msgstr "No hi ha una segona pista"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
+msgid "KeyFrame error"
+msgstr "S'ha produ?t un error en el fotograma clau"
 
-#: avidemux/gui_savenew.cpp:244
-msgid "Select a second audio track in the Audio menu."
-msgstr "Seleccioneu una segona pista d'?udio al men? d'?udio"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
+msgid ""
+"The beginning frame is not a key frame.\n"
+"Please move the A marker."
+msgstr ""
+"El fotograma d'inici no ?s un fotograma clau.\n"
+"Canvieu el marcador A."
 
-#: avidemux/gui_savenew.cpp:248
-msgid "Select dual audio AVI to write"
-msgstr "Seleccioneu ?udio dual AVI per escriure"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:247
+msgid "Cannot initialize the audio stream"
+msgstr "No es pot inicialitzar el flux d'?udio"
 
-#: avidemux/gui_savenew.cpp:270
-#: avidemux/gui_savenew.cpp:288
-msgid "This cannot have packed VOP"
-msgstr "No pot ser que tingui empaquetat un VOP"
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:395
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:100
+#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:127
+msgid ""
+"\n"
+" Reuse the existing log-file ?"
+msgstr ""
+"\n"
+"Voleu reutilitzar el fitxer de bit?cola existent?"
 
-#: avidemux/gui_savenew.cpp:270
-#: avidemux/gui_savenew.cpp:288
-msgid "It is not MPEG-4 video. File will not be saved."
-msgstr "No ?s un v?deo MPEG-4. El fitxer no es pot desar."
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:431
+#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:152
+msgid "Aborting"
+msgstr "S'est? cancel?lant"
 
-#: avidemux/gui_savenew.cpp:334
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:89
+msgid "This is not MPEG compatible"
+msgstr "No ?s compatible amb MPEG."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:89
+msgid "You can't use the Copy codec."
+msgstr "No podeu usar el c?dec \"Copiat\"."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:94
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:143
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:154
+msgid "There is no audio track"
+msgstr "No hi ha pista d'?udio."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:101
+msgid "The first frame is not intra frame"
+msgstr "El primer fotograma no ?s un fotograma-I."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:101
+msgid "Use the &lt;&lt; and the &gt;&gt; buttons to move using Intra frames."
+msgstr "Useu els botons de &lt;&lt; i els de &gt;&gt; per moure-us a trav?s de fotogrames-I."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:113
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:164
+msgid "Audio track is not suitable"
+msgstr "La pista d'?udio no ?st? disponible."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
+msgid "Incompatible audio"
+msgstr "El format d'?udio ?s incompatible."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:174
+msgid "For VCD, audio must be 44.1 kHz MP2."
+msgstr "Per a VCD l'?udio ha de ser 44.1 kHz MP2."
+
+#: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:182
+msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
+msgstr "Per a DVD l'?udio ha de ser 48 kHz MP2 (est?reo), AC3, DTS o b? LPCM (est?reo)."
+
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+msgid "For DVD, audio must be 48 kHz MP2, AC3 or LPCM."
+msgstr "Per a DVD l'?udio ha de ser 48 kHz MP2, AC3 o b? LPCM."
+
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:313
+msgid "Reuse log file ?"
+msgstr "Voleu reutilitzar el fitxer de bit?cola?"
+
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:328
+msgid "Error in pass 1"
+msgstr "S'ha produ?t un error en la passada 1."
+
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:478
+msgid "Error in pass 2"
+msgstr "S'ha produ?t un error en la passada 2."
+
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:126
+msgid "Could not initialize video"
+msgstr "No es pot inicialitzar el v?deo."
+
+#: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:134
+msgid "Could not initialize audio"
+msgstr "No es pot inicialitzar l'?udio."
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy.cpp:96
+#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy_unpack.cpp:98
+#: avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp:121
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:446
+msgid "Cannot initiate save"
+msgstr "No es pot iniciar el desament"
+
+#: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:73
 msgid ""
-"You may need smart copy.\n"
-" Enable it ?"
+"Width is not a multiple of 8\n"
+" continue anyway ?"
 msgstr ""
-"Pot ser que necessiteu una c?pia intel?ligent.\n"
-"La voleu habilitar?"
+"L'amplada no ?s un m?ltiple de 8.\n"
+"Voleu continuar de totes formes?"
 
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:75
+msgid "Mux every N video frames"
+msgstr "Mult. cada N fotogrames"
 
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:76
+msgid "Mux by packet size"
+msgstr "Mult. per mida paquet"
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:79
+msgid "Muxing _type:"
+msgstr "_Tipus de multiplexi?: "
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:80
+msgid "_Split every MB:"
+msgstr "_Divideix cada n MBytes: "
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:82
+msgid "Mux _every x video frames:"
+msgstr "Multip. _cada n fotogrames: "
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:83
+msgid "Mux in _blocks of x bytes:"
+msgstr "Multip. en _blocs d'n bytes: "
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:90
+msgid "AVI Muxer Options"
+msgstr "Opcions multiplexor AVI"
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:188
+msgid "Error initalizing audio filters"
+msgstr "S'ha produ?t un error en inicialitzar els filtres d'?udio."
+
+#: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:197
+msgid "Error initalizing video filters"
+msgstr "S'ha produ?t un error en inicialitzar els filtres de v?deo."
+
+#: avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp:258
+msgid "Size is not (s)QCIF"
+msgstr "La mida no ?s (s)QCIF."
+
+#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp:149
+msgid "There is several mpeg file, append them ?"
+msgstr "Hi ha diversos fitxers de MPEG. Els voleu afegir?"
+
+#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp:250
+msgid "Can't determine aspect ratio"
+msgstr "No es pot determinar la relaci? d'aspecte."
+
+#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp:355
+msgid "Out of memory"
+msgstr "S'ha ultrapassat l'?rea de mem?ria"
+
+#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp:370
+msgid "Opening MPEG"
+msgstr "S'est? obrint el fitxer d'MPEG."
+
+#: avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp:539
+msgid "MPEG renumbering error"
+msgstr "S'ha produ?t un error en la renumeraci? dels MPEG."
+
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:542
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:571
+msgid "Opening Nuppel video"
+msgstr "S'est? obrint el fitxer de v?deo Nuppel."
+
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:547
+msgid "Sure you want to abort ?"
+msgstr "Esteu segur que voleu cancel?lar?"
+
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:758
+msgid "Size mismatch"
+msgstr "La mida no correspon."
+
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:758
+msgid "Expect a crash."
+msgstr "S'espera una fallada general."
+
+#: avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp:1050
+msgid "Do you want to save an index ?"
+msgstr "Voleu desar un ?ndex?"
+
+#: avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp:346
+msgid "Take second track ?"
+msgstr "Voleu agafar una segona pista?"
+
+#: avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp:426
+msgid "Scanning OGM"
+msgstr "S'est? escanejant l'OGM."
+
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:281
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:366
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:501
+msgid "Malformed header"
+msgstr "L'encap?alament ?s malformat."
+
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDMLDepack.cpp:93
+msgid "Unpacking bitstream"
+msgstr "S'est? desempaquetant el flux de bits."
+
+#: avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reindex.cpp:68
+msgid "Indexing"
+msgstr "S'est? indexant."
+
+#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp:583
+msgid "Problem reading SVQ3 headers"
+msgstr "Hi ha hagut un problema en la lectura d'encap?alaments d'SVQ3."
+
+#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Indexer.cpp:346
+msgid "No stts table"
+msgstr "No hi ha taula stts."
+
+#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
+msgid "For DVD, audio must be MP2 or AC3."
+msgstr "Per a DVD l'?udio ha de ser MP2 o b? AC3."
+
+#: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:92
+msgid "lvemux init failed"
+msgstr "Ha fallat la inicialitzaci? del lvemux."
+
+#: avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp:308
+msgid "Incompatible frame rate"
+msgstr "La velocitat d'imatge ?s incompatible."
+
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:324
+msgid "NTSC 4:3"
+msgstr "NTSC 4:3"
+
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:325
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:326
+msgid "NTSC 16:9"
+msgstr "NTSC 16:9"
+
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:327
+msgid "PAL 4:3"
+msgstr "PAL 4:3"
+
+#: avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp:328
+msgid "PAL 16:9"
+msgstr "PAL 16:9"
+
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:403
+msgid "Memory error"
+msgstr "S'ha produ?t un error de mem?ria."
+
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:410
+msgid "Error converting to BMP"
+msgstr "S'ha produ?t un error en la conversi? a BMP."
+
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:472
+msgid "Cannot encode the frame"
+msgstr "No es pot codificar el fotograma."
+
+



From mean at mail.berlios.de  Tue Aug  7 19:23:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 7 Aug 2007 19:23:58 +0200
Subject: [Avidemux-svn-commit] r3486 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_libraries/ADM_utilities ADM_videoFilter
Message-ID: <200708071723.l77HNwc8005817@sheep.berlios.de>

Author: mean
Date: 2007-08-07 19:23:58 +0200 (Tue, 07 Aug 2007)
New Revision: 3486

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp
Log:
[Filter] LOGO Handles alpha channel

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp	2007-08-07 17:01:37 UTC (rev 3485)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp	2007-08-07 17:23:58 UTC (rev 3486)
@@ -319,6 +319,66 @@
     return 1;
 
 }
+/*
+    \fn    copyToAlpha
+    \brief Copy "this" image into dest image at x,y position using alpha alpha
+    @param alpha alpha value (0--255)
+
+*/
+uint8_t ADMImage::copyToAlpha(ADMImage *dest, uint32_t x,uint32_t y,uint32_t alpha)
+{
+      
+    uint32_t box_w=_width, box_h=_height;
+    // Clip if needed
+    if(y>dest->_height)
+    {
+        printf("Y out : %u %u\n",y,dest->_height);
+         return 1;
+    }
+    if(x>dest->_width) 
+    {
+        printf("X out : %u %u\n",x,dest->_width);
+         return 1;
+    }
+    
+    if(x+box_w>dest->_width) box_w=dest->_width-x;
+    if(y+box_h>dest->_height) box_h=dest->_height-y;
+
+    // do y
+    BitBlitAlpha(YPLANE(dest)+x+dest->_width*y,dest->_width,         data,_width,            box_w,box_h,alpha);
+    // Do u
+    BitBlitAlpha(UPLANE(dest)+x/2+(dest->_width*y)/4,dest->_width/2,   UPLANE(this),_width>>1,  box_w>>1,box_h>>1,alpha);
+    // and V
+    BitBlitAlpha(VPLANE(dest)+x/2+(dest->_width*y)/4,dest->_width/2, VPLANE(this),_width>>1, box_w>>1,box_h>>1,alpha);
+
+
+    return 1;
+
+}
+/**
+ * 		\fn BitBlitAlpha
+ * 		\brief Alpha blit from dst to src
+ */
+uint8_t BitBlitAlpha(uint8_t *dst, uint32_t pitchDst,uint8_t *src,uint32_t pitchSrc,
+		uint32_t width, uint32_t height,uint32_t alpha)
+{
+    
+    for(int y=0;y<height;y++)
+    {
+    	for(int x=0;x<width;x++)
+    	{
+    		uint32_t s=src[x],d=dst[x];
+    		
+    		d=s*alpha+(255-alpha)*d;
+    		d>>=8;
+    		dst[x]=d;
+    	}
+        src+=pitchSrc;
+        dst+=pitchDst;   
+    }
+    return 1;
+}
+
 uint8_t BitBlit(uint8_t *dst, uint32_t pitchDst,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height)
 {
     

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-07 17:01:37 UTC (rev 3485)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-07 17:23:58 UTC (rev 3486)
@@ -133,6 +133,7 @@
         uint8_t substract(ADMImage *src1,ADMImage *src2);
         uint8_t blacken(void);
         uint8_t copyTo(ADMImage *target, uint32_t x, uint32_t y);
+        uint8_t copyToAlpha(ADMImage *target, uint32_t x, uint32_t y,uint32_t alpha);
         uint8_t pack(uint8_t invertChroma);     /// Transfer data from planes to regular packed space
         
         /* Some utilitarian functions */
@@ -172,5 +173,7 @@
 
 // Misc utilities
 uint8_t BitBlit(uint8_t *dst, uint32_t pitchDest,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height);
+uint8_t BitBlitAlpha(uint8_t *dst, uint32_t pitchDst,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height,uint32_t alpha);
+
 ADMImage *createImageFromFile(const char *filename);
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-07 17:01:37 UTC (rev 3485)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-07 17:23:58 UTC (rev 3486)
@@ -145,7 +145,7 @@
 		    decoder->uncompress (&bin, &tmpImage);
 		    //
 		    ADMImage *image=NULL;
-		    if(tmpImage._colorspace==ADM_COLOR_YV12)
+		    if(tmpImage._colorspace!=ADM_COLOR_YV12)
 		    {
 		    	GUI_Error_HIG(_("Wrong Colorspace"),_("Only YV12/I420 JPegs are supported"));
 		    }else

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp	2007-08-07 17:01:37 UTC (rev 3485)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidLogo.cpp	2007-08-07 17:23:58 UTC (rev 3486)
@@ -183,7 +183,7 @@
         	return 1;
         }
         // No alpha ATM
-        _image->copyTo(data,_param->x,_param->y);
+        _image->copyToAlpha(data,_param->x,_param->y,_param->alpha);
         return 1;
 }
 



From mean at mail.berlios.de  Tue Aug  7 19:56:52 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 7 Aug 2007 19:56:52 +0200
Subject: [Avidemux-svn-commit] r3487 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_libraries/ADM_utilities
Message-ID: <200708071756.l77HuqL9009690@sheep.berlios.de>

Author: mean
Date: 2007-08-07 19:56:51 +0200 (Tue, 07 Aug 2007)
New Revision: 3487

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
Log:
[Filter] Add yuy2 jpg support

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-07 17:23:58 UTC (rev 3486)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-07 17:56:51 UTC (rev 3487)
@@ -30,9 +30,9 @@
 #include "ADM_codecs/ADM_codec.h"
 #include "ADM_codecs/ADM_ffmp43.h"
 #include "ADM_toolkit/toolkit.hxx"
-
-
-
+//**********************************
+static ADMImage *createImageFromFile_jpeg(const char *filename);
+//***********************************
 static uint8_t read8(FILE *fd)
 {
 	return fgetc(fd);
@@ -53,12 +53,9 @@
 */
 ADMImage *createImageFromFile(const char *filename)
 {
-		int32_t nnum;
 	    uint32_t *fcc;
 	    uint8_t fcc_tab[4];
 	    FILE *fd;
-	    uint32_t _imgSize;
-	    uint32_t w = 0, h = 0;
 
 	    // 1- identity the file type
 	    //
@@ -71,13 +68,25 @@
 	    }
 	    fread(fcc_tab, 4, 1, fd);
 	    fclose(fd);
-	   if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
-	   {
-		
-		} else {
-			printf("[imageLoader] Unrecognized file!\n");
-			return NULL;
-		    }
+	    if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
+	    {
+		   	return createImageFromFile_jpeg(filename);
+		} 
+	    printf("[imageLoader] Unrecognized file!\n");
+	    return NULL;
+}
+/**
+ * 	\fn createImageFromFile_jpeg
+ *  \brief Create image from jpeg file
+ */
+ADMImage *createImageFromFile_jpeg(const char *filename)
+{
+	
+	FILE *fd;
+	uint32_t _imgSize;
+	uint32_t w = 0, h = 0;
+	   
+
 		fd = fopen(filename, "rb");
 		fseek(fd, 0, SEEK_END);
 		_imgSize = ftell(fd);
@@ -145,14 +154,25 @@
 		    decoder->uncompress (&bin, &tmpImage);
 		    //
 		    ADMImage *image=NULL;
-		    if(tmpImage._colorspace!=ADM_COLOR_YV12)
+		    switch(tmpImage._colorspace)
 		    {
-		    	GUI_Error_HIG(_("Wrong Colorspace"),_("Only YV12/I420 JPegs are supported"));
-		    }else
-		    {		    
-		    		image=new ADMImage(w,h);
-		    		image->duplicate(&tmpImage);
+		    case ADM_COLOR_YV12:
+		    {
+		    	printf("[imageLoader] YV12\n");
+	    		image=new ADMImage(w,h);
+	    		image->duplicate(&tmpImage);
+	    		break;
 		    }
+		    case ADM_COLOR_YUV422:
+		    {
+		    	printf("[imageLoader] YUY2\n");
+		    	image=new ADMImage(w,h);
+		    	COL_422_YV12(tmpImage._planes, tmpImage._planeStride,  image->data,w,h);
+		    	break;
+		    }
+		    default:
+		    	GUI_Error_HIG(_("Wrong Colorspace"),_("Only YV12/I420 or YUY2/I422 JPegs are supported"));
+		    }
 		    // Cannot destroy decoder earlier as tmpImage has pointers to its internals
 		    delete decoder;
 		    decoder=NULL;

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-07 17:23:58 UTC (rev 3486)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-07 17:56:51 UTC (rev 3487)
@@ -71,13 +71,12 @@
 ADM_audiocodec 
 ADM_audio
 ADM_script 
-
 ADM_videoFilter
 ADM_filter
 ADM_video 
-ADM_colorspace 
 ADM_audiodevice
 ADM_ocr  
+ADM_colorspace 
 )
 
 
@@ -181,6 +180,7 @@
 ADM_lvemux
 ADM_smjs
 ADM_utilities
+ADM_colorspace 
 ADM_xvidratectl
 ADM_libpostproc
 )



From gruntster at mail.berlios.de  Tue Aug  7 23:53:24 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 7 Aug 2007 23:53:24 +0200
Subject: [Avidemux-svn-commit] r3488 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200708072153.l77LrOUl029164@sheep.berlios.de>

Author: gruntster
Date: 2007-08-07 23:53:17 +0200 (Tue, 07 Aug 2007)
New Revision: 3488

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
Log:
[x264] enable all CPU extensions

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-07 17:56:51 UTC (rev 3487)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-07 21:53:17 UTC (rev 3488)
@@ -61,14 +61,6 @@
 
   printf ("Opening X264 for %lu x %lu\n", _w, _h);
 
-  param.cpu = 0;
-#define ADX_CHECK(x)  if(CpuCaps::has##x()) param.cpu|=X264_CPU_##x;
-  ADX_CHECK (MMX);
-  ADX_CHECK (SSE);
-  ADX_CHECK (SSE2);
-  ADX_CHECK (MMXEXT);
-  ADX_CHECK (3DNOW);
-
   param.i_threads = zparam->nbThreads;
   param.i_width = _w;
   param.i_height = _h;



From gruntster at mail.berlios.de  Wed Aug  8 03:37:02 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 8 Aug 2007 03:37:02 +0200
Subject: [Avidemux-svn-commit] r3489 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200708080137.l781b2PZ031317@sheep.berlios.de>

Author: gruntster
Date: 2007-08-08 03:36:55 +0200 (Wed, 08 Aug 2007)
New Revision: 3489

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
Log:
[GTK] remove zoom_4_1 runtime warning

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-08-07 21:53:17 UTC (rev 3488)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-08-08 01:36:55 UTC (rev 3489)
@@ -104,7 +104,7 @@
 CALLBACK(zoom_1_2                                   ,ACT_ZOOM_1_2);
 CALLBACK(zoom_1_1                                   ,ACT_ZOOM_1_1);
 CALLBACK(zoom_2_1                                   ,ACT_ZOOM_2_1);
-CALLBACK(zoom_4_1                                   ,ACT_ZOOM_4_1);
+//CALLBACK(zoom_4_1                                   ,ACT_ZOOM_4_1);
 CALLBACK(edit_glyph1                                ,ACT_GLYPHEDIT);
 //CALLBACK(hscalVolume                                ,ACT_VOLUME);
 



From gruntster at mail.berlios.de  Wed Aug  8 19:23:11 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 8 Aug 2007 19:23:11 +0200
Subject: [Avidemux-svn-commit] r3490 - branches/avidemux_2.4_branch/cmake
Message-ID: <200708081723.l78HNBhY020654@sheep.berlios.de>

Author: gruntster
Date: 2007-08-08 19:23:05 +0200 (Wed, 08 Aug 2007)
New Revision: 3490

Modified:
   branches/avidemux_2.4_branch/cmake/adm_qt4.cmake
Log:
[CMake] Cygwin/MSYS/MinGW compatibility tweak for Win32

Modified: branches/avidemux_2.4_branch/cmake/adm_qt4.cmake
===================================================================
--- branches/avidemux_2.4_branch/cmake/adm_qt4.cmake	2007-08-08 01:36:55 UTC (rev 3489)
+++ branches/avidemux_2.4_branch/cmake/adm_qt4.cmake	2007-08-08 17:23:05 UTC (rev 3490)
@@ -1,65 +1,73 @@
-##############################################################"
-# FOR AQ
-# Q_foo.cpp and foo.ui => AQ_foo.cpp, ui_foo.h and Q_foo.moc
-##############################################################"
-IF(WIN32)
-	SET(VERBATIM "")
-ELSE(WIN32)
-	SET(VERBATIM "VERBATIM")
-ENDIF(WIN32)
-
-MACRO(Q_UIMOCIFY _source)
-  ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/AQ_${_source}.cpp
-                     COMMAND  ${QT_UIC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.ui -o ui_${_source}.h
-                     COMMAND  ${QT_MOC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/Q_${_source}.cpp -o Q_${_source}.moc
-                     COMMAND  echo "#include \"Q_${_source}.cpp\"" > AQ_${_source}.cpp
-                     COMMAND  echo "#include \"Q_${_source}.moc\"" >> AQ_${_source}.cpp
-                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.ui  ${CMAKE_CURRENT_SOURCE_DIR}/Q_${_source}.cpp
-                     ${VERBATIM}
-                )
-ENDMACRO(Q_UIMOCIFY _source)
-
-##############################################################"
-# FOR 
-# foo.qrc->foo_rsc.cpp
-##############################################################"
-# $(RCC)  $< -o $@   -name filter
-MACRO(Q_RCC _source)
-  ADD_CUSTOM_COMMAND(OUTPUT   ${CMAKE_CURRENT_BINARY_DIR}/${_source}_rsc.cpp
-                     COMMAND  ${QT_RCC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.qrc -o ${_source}_rsc.cpp -name ${_source}
-                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.qrc
-                     ${VERBATIM}
-                )
-ENDMACRO(Q_RCC _source)
-
-##############################################################"
-# FOR AT
-# T_foo.cpp i => AT_foo.cpp and T_foo.moc
-##############################################################"
-MACRO(Q_MOCIFY _source)
-  ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/AT_${_source}.cpp
-                     COMMAND  ${QT_MOC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/T_${_source}.cpp -o T_${_source}.moc 
-                     COMMAND  echo "#include \"T_${_source}.cpp\"" > AT_${_source}.cpp
-                     COMMAND  echo "#include \"T_${_source}.moc\"" >> AT_${_source}.cpp
-                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/T_${_source}.cpp
-                     ${VERBATIM}
-                )
-ENDMACRO(Q_MOCIFY _source)
-
-# Add to our Targets..
-FOREACH(_current ${${ADM_LIB}_Q})
- Q_UIMOCIFY(${_current})
- SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} ${CMAKE_CURRENT_BINARY_DIR}/AQ_${_current}.cpp)
-ENDFOREACH(_current ${${ADM_LIB}_Q})
-
-FOREACH(_current ${${ADM_LIB}_T})
- Q_MOCIFY(${_current})
- SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} ${CMAKE_CURRENT_BINARY_DIR}/AT_${_current}.cpp)
-ENDFOREACH(_current ${${ADM_LIB}_T})
-
-include_directories(${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR})
-
-ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
-
-# EOF
+SET(VERBATIM "VERBATIM")
+
+# Cygwin and MSYS require escaping but standalone MinGW doesn't.
+# Since CMake doesn't provide a way of detecting MSYS, check for
+# sh.exe in the path.  MinGW makefiles can't be genereated if sh
+# is in the path.
+IF(MINGW)
+	FIND_PROGRAM(SH_EXECUTABLE NAMES sh)
+	
+	IF(NOT SH_EXECUTABLE)   # if not Cygwin or MSYS
+		SET(VERBATIM "")
+	ENDIF(NOT SH_EXECUTABLE)
+ENDIF(MINGW)
+
+##############################################################"
+# FOR AQ
+# Q_foo.cpp and foo.ui => AQ_foo.cpp, ui_foo.h and Q_foo.moc
+##############################################################"
+MACRO(Q_UIMOCIFY _source)
+  ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/AQ_${_source}.cpp
+                     COMMAND  ${QT_UIC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.ui -o ui_${_source}.h
+                     COMMAND  ${QT_MOC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/Q_${_source}.cpp -o Q_${_source}.moc
+                     COMMAND  echo "#include \"Q_${_source}.cpp\"" > AQ_${_source}.cpp
+                     COMMAND  echo "#include \"Q_${_source}.moc\"" >> AQ_${_source}.cpp
+                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.ui  ${CMAKE_CURRENT_SOURCE_DIR}/Q_${_source}.cpp
+                     ${VERBATIM}
+                )
+ENDMACRO(Q_UIMOCIFY _source)
+
+##############################################################"
+# FOR 
+# foo.qrc->foo_rsc.cpp
+##############################################################"
+# $(RCC)  $< -o $@   -name filter
+MACRO(Q_RCC _source)
+  ADD_CUSTOM_COMMAND(OUTPUT   ${CMAKE_CURRENT_BINARY_DIR}/${_source}_rsc.cpp
+                     COMMAND  ${QT_RCC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.qrc -o ${_source}_rsc.cpp -name ${_source}
+                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/${_source}.qrc
+                     ${VERBATIM}
+                )
+ENDMACRO(Q_RCC _source)
+
+##############################################################"
+# FOR AT
+# T_foo.cpp i => AT_foo.cpp and T_foo.moc
+##############################################################"
+MACRO(Q_MOCIFY _source)
+  ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/AT_${_source}.cpp
+                     COMMAND  ${QT_MOC_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/T_${_source}.cpp -o T_${_source}.moc 
+                     COMMAND  echo "#include \"T_${_source}.cpp\"" > AT_${_source}.cpp
+                     COMMAND  echo "#include \"T_${_source}.moc\"" >> AT_${_source}.cpp
+                     DEPENDS  ${CMAKE_CURRENT_SOURCE_DIR}/T_${_source}.cpp
+                     ${VERBATIM}
+                )
+ENDMACRO(Q_MOCIFY _source)
+
+# Add to our Targets..
+FOREACH(_current ${${ADM_LIB}_Q})
+ Q_UIMOCIFY(${_current})
+ SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} ${CMAKE_CURRENT_BINARY_DIR}/AQ_${_current}.cpp)
+ENDFOREACH(_current ${${ADM_LIB}_Q})
+
+FOREACH(_current ${${ADM_LIB}_T})
+ Q_MOCIFY(${_current})
+ SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} ${CMAKE_CURRENT_BINARY_DIR}/AT_${_current}.cpp)
+ENDFOREACH(_current ${${ADM_LIB}_T})
+
+include_directories(${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR})
+
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
+
+# EOF



From mean at mail.berlios.de  Wed Aug  8 20:04:25 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 8 Aug 2007 20:04:25 +0200
Subject: [Avidemux-svn-commit] r3491 - in
	branches/avidemux_2.4_branch/avidemux: ADM_colorspace
	ADM_libraries/ADM_utilities
Message-ID: <200708081804.l78I4PAA007742@sheep.berlios.de>

Author: mean
Date: 2007-08-08 20:04:24 +0200 (Wed, 08 Aug 2007)
New Revision: 3491

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_colorspace/colorspace.h
   branches/avidemux_2.4_branch/avidemux/ADM_colorspace/rgb2yuv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
Log:
[Filter] Add bmp and png support to imageloader

Modified: branches/avidemux_2.4_branch/avidemux/ADM_colorspace/colorspace.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_colorspace/colorspace.h	2007-08-08 17:23:05 UTC (rev 3490)
+++ branches/avidemux_2.4_branch/avidemux/ADM_colorspace/colorspace.h	2007-08-08 18:04:24 UTC (rev 3491)
@@ -35,3 +35,6 @@
 
 uint8_t COL_RawRGB32toYV12(uint8_t *data1,uint8_t *data2, uint8_t *oy,uint8_t *oy2, 
 				uint8_t *u, uint8_t *v,uint32_t lineSize,uint32_t height,uint32_t stride);
+
+uint8_t COL_RGB24_to_YV12(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv);
+uint8_t COL_RGB24_to_YV12_revert(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_colorspace/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_colorspace/rgb2yuv.cpp	2007-08-08 17:23:05 UTC (rev 3490)
+++ branches/avidemux_2.4_branch/avidemux/ADM_colorspace/rgb2yuv.cpp	2007-08-08 18:04:24 UTC (rev 3491)
@@ -26,6 +26,13 @@
 #include <math.h>
 
 #include "ADM_utilities/default.h"
+#include "ADM_osSupport/ADM_cpuCap.h"
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+extern "C" {
+#include "ADM_lavcodec/avcodec.h"
+}
+#endif
+#include "ADM_libswscale/swscale.h"
 
 
 #include "colorspace.h"
@@ -200,4 +207,78 @@
 	return 1;
 
 }
+/**
+ * 		\fn COL_RGB24_to_YV12
+ *		\brief Convert RGB to YV12 using swscale
+ */
+uint8_t COL_RGB24_to_YV12_revert(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv)
+{
+	int flags = SWS_SPLINE;
+	struct SwsContext *context=NULL;
+	
+	#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
 
+		ADD(MMX,MMX);
+		ADD(3DNOW,3DNOW);
+		ADD(MMXEXT,MMX2);
+	#endif
+
+	#ifdef USE_ALTIVEC
+	    flags |= SWS_CPU_CAPS_ALTIVEC;
+	#endif
+	    context = sws_getContext(w, h,
+	    									  PIX_FMT_RGB24,
+	    									  w, h,
+	    									  PIX_FMT_YUV420P,
+	    									  flags, NULL, NULL,NULL);
+	    ADM_assert(context);
+	
+	    uint8_t *src[3]={rgb+w*h*3-w*3,NULL,NULL};
+	    int srcStride[3]={-w*3,0,0};
+	    int dstStride[3]={w,w>>1,w>>1};
+	    uint8_t *dst[3]={yuv,yuv+w*h,yuv+((w*h*5)>>2)};
+//	    int sws_scale(struct SwsContext *context, uint8_t* src[], int srcStride[], int srcSliceY,
+//	                  int srcSliceH, uint8_t* dst[], int dstStride[]);	    
+	    sws_scale(context, src, srcStride, 0, h, dst, dstStride);
+	    
+		sws_freeContext(context);
+}
+/**
+ * 		\fn COL_RGB24_to_YV12
+ *		\brief Convert RGB to YV12 using swscale
+ */
+uint8_t COL_RGB24_to_YV12(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv)
+{
+	int flags = SWS_SPLINE;
+	struct SwsContext *context=NULL;
+	
+	#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
+
+		ADD(MMX,MMX);
+		ADD(3DNOW,3DNOW);
+		ADD(MMXEXT,MMX2);
+	#endif
+
+	#ifdef USE_ALTIVEC
+	    flags |= SWS_CPU_CAPS_ALTIVEC;
+	#endif
+	    context = sws_getContext(w, h,
+	    									  PIX_FMT_RGB24,
+	    									  w, h,
+	    									  PIX_FMT_YUV420P,
+	    									  flags, NULL, NULL,NULL);
+	    ADM_assert(context);
+	
+	    uint8_t *src[3]={rgb,NULL,NULL};
+	    int srcStride[3]={w*3,0,0};
+	    int dstStride[3]={w,w>>1,w>>1};
+	    uint8_t *dst[3]={yuv,yuv+((w*h*5)>>2),yuv+w*h};
+//	    int sws_scale(struct SwsContext *context, uint8_t* src[], int srcStride[], int srcSliceY,
+//	                  int srcSliceH, uint8_t* dst[], int dstStride[]);	    
+	    sws_scale(context, src, srcStride, 0, h, dst, dstStride);
+	    
+		sws_freeContext(context);
+}
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-08 17:23:05 UTC (rev 3490)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-08 18:04:24 UTC (rev 3491)
@@ -21,6 +21,7 @@
 
 #include "ADM_lavcodec.h"
 #include "ADM_utilities/default.h"
+#include "ADM_utilities/fourcc.h"
 
 #include "ADM_colorspace/colorspace.h"
 
@@ -29,9 +30,14 @@
 
 #include "ADM_codecs/ADM_codec.h"
 #include "ADM_codecs/ADM_ffmp43.h"
+#include "ADM_codecs/ADM_png.h"
 #include "ADM_toolkit/toolkit.hxx"
+#include "ADM_toolkit/bitmap.h"
 //**********************************
 static ADMImage *createImageFromFile_jpeg(const char *filename);
+static ADMImage *createImageFromFile_Bmp(const char *filename);
+static ADMImage *createImageFromFile_Bmp2(const char *filename);
+static ADMImage *createImageFromFile_png(const char *filename);
 //***********************************
 static uint8_t read8(FILE *fd)
 {
@@ -46,6 +52,18 @@
 	return (a<<8)+b;
 		
 }
+static uint32_t read32(FILE *fd)
+{
+	uint32_t a,b,c,d;
+	
+	a=fgetc(fd);
+	b=fgetc(fd);
+	c=fgetc(fd);
+	d=fgetc(fd);
+	return (a<<24)+(b<<16)+(c<<8)+d;
+		
+}
+
 /*
 		\fn 	createImageFromFile
 		\brief 	Create and returns an ADMImage from a file, only YV12 jpg supported ATM
@@ -67,11 +85,28 @@
 	    	return NULL;
 	    }
 	    fread(fcc_tab, 4, 1, fd);
+	    fcc = (uint32_t *) fcc_tab;
 	    fclose(fd);
 	    if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
 	    {
 		   	return createImageFromFile_jpeg(filename);
 		} 
+	    if (fourCC::check(*fcc, (uint8_t *) "RIFF")) 
+	    {
+	    	printf("[imageLoader] It looks like BMP (RIFF)...\n");
+	    	return createImageFromFile_Bmp(filename);
+	     }
+	    if (fcc_tab[0] == 'B' && fcc_tab[1] == 'M') 
+	    {
+	    	printf("[imageLoader] It looks like BMP2 (BM)...\n");
+	    	return createImageFromFile_Bmp2(filename);
+
+	    	} 
+	    if (fcc_tab[1] == 'P' && fcc_tab[2] == 'N' && fcc_tab[3] == 'G') 
+	    {
+	    	printf("[imageLoader] It looks like PNG...\n");
+	    	return createImageFromFile_png(filename);	    	
+	    }
 	    printf("[imageLoader] Unrecognized file!\n");
 	    return NULL;
 }
@@ -179,5 +214,158 @@
 		    delete [] data;
 		    return image;		
 }
+/**
+ * 	\fn createImageFromFile_jpeg
+ *  \brief Create image from Bmp
+ */
+ADMImage *createImageFromFile_Bmp(const char *filename)
+{
+	
+	FILE *fd;
+	uint32_t _imgSize;
+	uint32_t w = 0, h = 0;
+    uint16_t  s16;
+    uint32_t s32;
 
+		fd = fopen(filename, "rb");
+		fseek(fd, 0, SEEK_END);
+		_imgSize = ftell(fd);
+		fseek(fd, 0, SEEK_SET);
+
+		//Retrieve width & height
+		//_______________________
+		   		BITMAPHEADER bmph;
+
+			    fread(&s16, 2, 1, fd);
+			    if (s16 != 0x4D42) 
+			    {
+			    	printf("[imageLoader] incorrect bmp sig.\n");
+			    	fclose(fd);
+			    	return NULL;
+			    }
+			    fread(&s32, 4, 1, fd);
+			    fread(&s32, 4, 1, fd);
+			    fread(&s32, 4, 1, fd);
+			    fread(&bmph, sizeof(bmph), 1, fd);
+			    if (bmph.compressionScheme != 0) 
+			    {
+			    	printf("[imageLoader]cannot handle compressed bmp\n");
+			    	fclose(fd);
+			    	return NULL;
+			    }
+			    
+			    w = bmph.width;
+			    h = bmph.height;
+			    
+			    
+			    printf("[ImageLoader] BMP %u * %u\n",w,h);
+
+		// Load the binary coded image
+		    uint8_t *data=new uint8_t[w*h*3];
+		    fread(data,w*h*3,1,fd);
+		    fclose(fd);
+		    
+		  // Colorconversion
+		    
+		    	ADMImage *image=new ADMImage(w,h);
+		    	COL_RGB24_to_YV12( w, h,data,image->data);
+		    
+		    delete [] data;
+		    return image;		
+}
+/**
+ * 	\fn createImageFromFile_bmp2
+ *  \brief Create image from Bmp2 (BM6)
+ */
+ADMImage *createImageFromFile_Bmp2(const char *filename)
+{
+    
+	BITMAPHEADER bmph;
+    uint8_t fcc_tab[4];
+    uint32_t offset;
+    FILE *fd=NULL;
+    uint32_t w,h;
+
+		fd = fopen(filename, "rb");
+ 	    fseek(fd, 10, SEEK_SET);
+
+ #define MK32() (fcc_tab[0]+(fcc_tab[1]<<8)+(fcc_tab[2]<<16)+ \
+ 						(fcc_tab[3]<<24))
+
+ 	    fread(fcc_tab, 4, 1, fd);
+ 	    offset = MK32();
+ 	    // size, width height follow as int32 
+ 	    fread(&bmph, sizeof(bmph), 1, fd);
+ #ifdef ADM_BIG_ENDIAN
+ 	    Endian_BitMapInfo(&bmph);
+ #endif
+ 	    if (bmph.compressionScheme != 0) 
+ 	    {
+ 	    	printf("[imageLoader] BMP2:Cannot handle compressed bmp\n");
+ 	    	fclose(fd);
+ 	    	return NULL;
+ 	    }
+ 	    w = bmph.width;
+ 	    h = bmph.height;
+ 	    printf("[imageLoader] BMP2 W: %d H: %d offset : %d\n", w, h, offset);
+// Load the binary coded image
+ 	fseek(fd,offset,SEEK_SET);
+    uint8_t *data=new uint8_t[w*h*3];
+    fread(data,w*h*3,1,fd);
+    fclose(fd);
+    
+  // Colorconversion
+    
+    	ADMImage *image=new ADMImage(w,h);
+    	COL_RGB24_to_YV12_revert( w, h,data,image->data);
+    
+    	delete [] data;
+    	return image;		
+}
+/**
+ * 	\fn createImageFromFile_png
+ *  \brief Create image from PNG
+ */
+ADMImage *createImageFromFile_png(const char *filename)
+{
+    
+	BITMAPHEADER bmph;
+    uint8_t fcc_tab[4];
+    uint32_t offset,size;
+    FILE *fd=NULL;
+    uint32_t w,h;
+
+		fd = fopen(filename, "rb");
+ 	    fseek(fd, 0, SEEK_END);
+ 	    size=ftell(fd);
+ 	   fseek(fd, 0, SEEK_SET);
+ 	   read32(fd);
+ 	   read32(fd);
+ 	   read32(fd);
+ 	   read32(fd);
+ 	   w=read32(fd);
+ 	   h=read32(fd);
+ 	   fseek(fd,0,SEEK_SET);
+ 	   uint8_t *data=new uint8_t[size];
+ 	   fread(data,size,1,fd);
+ 	   fclose(fd);
+    
+  
+    
+ 	   ADMImage tmpImage(w,h,1);
+    	// Decode PNG
+    	decoderPng decoder(w,h);
+    	ADMCompressedImage bin;
+    	bin.data=data;
+    	bin.dataLength=size; // This is more than actually, but who cares...
+    			    
+    	decoder.uncompress (&bin, &tmpImage);
+    	
+    	ADMImage *image=new ADMImage(w,h);
+    	COL_RGB24_to_YV12( w, h,tmpImage._planes[0],image->data);
+    
+    	delete [] data;
+    	return image;		
+}
+
 //EOF



From gruntster at mail.berlios.de  Thu Aug  9 17:04:59 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 9 Aug 2007 17:04:59 +0200
Subject: [Avidemux-svn-commit] r3492 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_osSupport
Message-ID: <200708091504.l79F4xOP031799@sheep.berlios.de>

Author: gruntster
Date: 2007-08-09 17:04:49 +0200 (Thu, 09 Aug 2007)
New Revision: 3492

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/win32.cpp
   branches/avidemux_2.4_branch/config.h.cmake
   branches/avidemux_2.4_branch/configure.in.in
Log:
[Win32] use native equivalents for rindex, index, ftello and fseeko

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp	2007-08-08 18:04:24 UTC (rev 3491)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_misc.cpp	2007-08-09 15:04:49 UTC (rev 3492)
@@ -245,33 +245,7 @@
         }
 
 }
-// Does not exist in cygwin
-char *ADM_rindex(const char *s, int c)
-{
-      if(!s) return NULL;
-      if(!*s) return NULL;
-      uint32_t l=strlen(s)-1;
-      while(l)
-      {
-              if(s[l]==c) return (char *)(s+l);
-              l--;
-      }
-      return NULL;
-}
-// Does not exist in cygwin
-char  *ADM_index(const char *s, int c)
-{
-      if(!s) return NULL;
-      if(!*s) return NULL;
-      uint32_t m=strlen(s);
-      uint32_t l=0;
-      while(l<m)
-      {
-              if(s[l]==c) return (char *)(s+l);
-              l++;
-      }
-      return NULL;
-}
+
 uint8_t         ADM_fileExist(char *name)
 {
 FILE *file;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/win32.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/win32.cpp	2007-08-08 18:04:24 UTC (rev 3491)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/win32.cpp	2007-08-09 15:04:49 UTC (rev 3492)
@@ -42,53 +42,22 @@
 
 void gettimeofday(struct timeval *p, void *tz)
 {
-unsigned long int sec;
+    unsigned long int sec;
     SYSTEMTIME  tme;
+
     GetSystemTime(&tme);
+
     sec=tme.wSecond;
     sec+=60*tme.wMinute;
     sec+=60*60*tme.wHour;
     
 	p->tv_sec=sec;
 	p->tv_usec=tme.wMilliseconds*1000;
+
 	return;
-  
-	
 }
 #endif
 
-uint64_t ftello_adm(FILE *f)
-{
-	fpos_t pos;
-	fgetpos(f,&pos);
-	return (uint64_t)pos;
-}
-int fseeko_adm(FILE *f,fpos_t off,int whence)
-{
-    int64_t pos;
-	switch(whence)
-	{
-		case SEEK_SET:
-			fsetpos(f,&off);
-			return 0;
-			break;
-		case SEEK_END:
-		    ADM_assert(!off);
-		    pos=_filelengthi64(fileno(f)) ;
-		    if(pos==-1) return -1;		   
-			fsetpos(f,&pos);
-			return 0;
-			break;
-		case SEEK_CUR:
-			off+=ftello_adm(f);
-			fsetpos(f,&off);
-			return 0;
-
-	}
-	ADM_assert(0);
-	return 0;
- }
-
 int getpriority(int which, int who)
 {
 	unsigned int priorityClass;
@@ -458,4 +427,3 @@
 	}
 }
 #endif
-

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-08 18:04:24 UTC (rev 3491)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 15:04:49 UTC (rev 3492)
@@ -4,10 +4,10 @@
 #cmakedefine ACCEL_DETECT
 
 #if ${WIN32_DEF}
-#define rindex ADM_rindex
-#define index ADM_index
-#define ftello ftello_adm
-#define fseeko fseeko_adm
+#define rindex strrchr
+#define index strchr
+#define ftello ftello64
+#define fseeko fseeko64
 #endif
 /* Big endian CPU - SPARC or PowerPC */
 #cmakedefine ADM_BIG_ENDIAN
@@ -520,18 +520,3 @@
 
 /* Define to 1 if the X Window System is missing or not being used. */
 #cmakedefine X_DISPLAY_MISSING
-
-/* "" */
-#cmakedefine fseeko
-
-/* "" */
-#cmakedefine ftello
-
-/* "rindex does not exist on Cygwin" */
-#cmakedefine index
-
-/* roundup function */
-#cmakedefine restrict
-
-/* "rindex does not exist on Cygwin" */
-#cmakedefine rindex

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-08-08 18:04:24 UTC (rev 3491)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-08-09 15:04:49 UTC (rev 3492)
@@ -408,10 +408,10 @@
 	AC_DEFINE(MEMALIGN_HACK,1,"SSE on Cywin")
 	AC_DEFINE(CYG_MANGLING,1,"Name mangling")
 	AC_DEFINE(ADM_WIN32,1,"Build for windows 32bits")
-	AC_DEFINE(rindex,ADM_rindex,"rindex does not exist on Cygwin")
-	AC_DEFINE(index,ADM_index,"rindex does not exist on Cygwin")
-	AC_DEFINE(fseeko,fseeko_adm,"")
-	AC_DEFINE(ftello,ftello_adm,"")
+	AC_DEFINE(rindex,strrchr,"rindex does not exist on Cygwin")
+	AC_DEFINE(index,strchr,"index does not exist on Cygwin")
+	AC_DEFINE(fseeko,fseeko64,"")
+	AC_DEFINE(ftello,ftello64,"")
 	CXXFLAGS="$CXXFLAGS -mno-cygwin -mms-bitfields"
 	CFLAGS="$CFLAGS -mno-cygwin -mms-bitfields"	
 fi



From gruntster at mail.berlios.de  Thu Aug  9 17:35:45 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 9 Aug 2007 17:35:45 +0200
Subject: [Avidemux-svn-commit] r3493 - branches/avidemux_2.4_branch
Message-ID: <200708091535.l79FZjFL000859@sheep.berlios.de>

Author: gruntster
Date: 2007-08-09 17:35:36 +0200 (Thu, 09 Aug 2007)
New Revision: 3493

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/config.h.cmake
   branches/avidemux_2.4_branch/configure.in.in
Log:
[lav] enable fast integers

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 15:04:49 UTC (rev 3492)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 15:35:36 UTC (rev 3493)
@@ -45,11 +45,9 @@
 SET(USE_MJPEG    1)
 SET(USE_LIBXML2    1)
 SET(HAVE_LRINTF    1)
-SET(EMULATE_FAST_INT    1)
+SET(HAVE_FAST_UNALIGNED 1)
 SET(RUNTIME_CPUDETECT    1)
 
-
-
 ########################################
 # taist : Should fail!
 ########################################
@@ -390,8 +388,6 @@
    SET(ARCH_X86    1)
    SET(HAVE_MMX    1)
    SET(ENABLE_MMX    1)
-   SET(ARCH_X86    1)
-   SET(HAVE_MMX    1)
    SET(ARCH_X86_32    1)
    SET(FPM_INTEL    1)
    SET(MEMALIGN_HACK    1)
@@ -425,6 +421,11 @@
          SET(ENABLE_MMX    1)
      endif( ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "x86_64" OR ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "amd64")
  endif(WIN32)
+ 
+ IF (ARCH_X86_64)
+	SET(HAVE_FAST_64BIT 1)	# FFMPEG
+ ENDIF (ARCH_X86_64)
+	
 MESSAGE(STATUS "<End of CPU and OS Check>")
 MESSAGE(STATUS "<******************************>")
 #

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 15:04:49 UTC (rev 3492)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 15:35:36 UTC (rev 3493)
@@ -15,13 +15,9 @@
 #define PACKAGE   "avidemux"
 #define ADMLOCALE "${ADM_LOCALE}"
 
-/* If we need to explictely link to iconv */
-#cmakedefine NEEED_LIBICONV
-
 /* BSD OS specific ifdef */
 #cmakedefine ADM_BSD_FAMILY
 
-
 #cmakedefine HAVE_AUDIO
 
 /* Sparc workstations */
@@ -277,6 +273,10 @@
 /* Define to 1 if you have the <faad.h> header file. */
 #cmakedefine HAVE_FAAD_H
 
+/* FFMPEG */
+#cmakedefine HAVE_FAST_UNALIGNED
+#cmakedefine HAVE_FAST_64BIT
+
 /* "FontConfig detected" */
 #cmakedefine HAVE_FONTCONFIG
 

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-08-09 15:04:49 UTC (rev 3492)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-08-09 15:35:36 UTC (rev 3493)
@@ -1145,6 +1145,7 @@
 		AC_DEFINE(FPM_INTEL,1,[Mad ])       
 		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")		
 		AC_DEFINE(ARCH_X86_32,1,"X86_32 assembly")
+		AC_DEFINE(HAVE_FAST_UNALIGNED,1,"FFMPEG")
 		use_mmx=yes
 		echo "X86 is ON"
 		;;
@@ -1156,6 +1157,8 @@
 		AC_DEFINE(ENABLE_MMX,1,[post proc])       
 		AC_DEFINE(FPM_DEFAULT,1,[Mad ])
 		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")
+		AC_DEFINE(HAVE_FAST_UNALIGNED,1,"FFMPEG")
+		AC_DEFINE(HAVE_FAST_64BIT,1,"FFMPEG")
 		use_mmx=yes
 		have_amd64=yes                
 		echo "AMD64"
@@ -1165,7 +1168,8 @@
 		AC_DEFINE(ARCH_64_BITS,1,"X86_64 AMD64 assembly")
 		AC_DEFINE(FPM_DEFAULT,1,[Mad ])
 		AC_DEFINE(RUNTIME_CPUDETECT,1,"Let FFmpeg decide which is faster")
-		AC_DEFINE(ENABLE_MMX,0,[post proc])       
+		AC_DEFINE(ENABLE_MMX,0,[post proc])
+		AC_DEFINE(HAVE_FAST_64BIT,1,"FFMPEG")
 		echo "IA64"
 		;;
 	sparc|sparc64)
@@ -1174,7 +1178,8 @@
 		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
 		AC_DEFINE(FPM_SPARC,1,[Mad ])
 		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
-		AC_DEFINE(ENABLE_MMX,0,[post proc])       
+		AC_DEFINE(ENABLE_MMX,0,[post proc])
+		AC_DEFINE(HAVE_FAST_64BIT,1,"FFMPEG")
 		;;		
 	sun4u)
 		LDFLAGS="$LDFLAGS -lposix4";
@@ -1184,7 +1189,8 @@
 		AC_DEFINE(ADM_SPARC,1,[Sparc workstations])
 		AC_DEFINE(ADM_BIG_ENDIAN,1,[Big endian CPU - SPARC or PowerPC])
 		AC_DEFINE(WORDS_BIGENDIAN,1,[Big endian CPU - SPARC or PowerPC])
-		AC_DEFINE(ENABLE_MMX,0,[post proc])       
+		AC_DEFINE(ENABLE_MMX,0,[post proc])
+		AC_DEFINE(HAVE_FAST_64BIT,1,"FFMPEG")
 		;;
 	ppc)
 		have_little_endian=no;



From gruntster at mail.berlios.de  Thu Aug  9 19:56:24 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 9 Aug 2007 19:56:24 +0200
Subject: [Avidemux-svn-commit] r3494 - branches/avidemux_2.4_branch
Message-ID: <200708091756.l79HuO3B023432@sheep.berlios.de>

Author: gruntster
Date: 2007-08-09 19:56:18 +0200 (Thu, 09 Aug 2007)
New Revision: 3494

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/config.h.cmake
Log:
[CMake] tidy up config.h + define HAVE_THREADS to prevent dup declaration + enable acceleration for mpeg2dec

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 15:35:36 UTC (rev 3493)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 17:56:18 UTC (rev 3494)
@@ -37,17 +37,22 @@
 SET(VERSION 2.4)
 SET(PACKAGE_VERSION 2.4)
 
-# We use FFMPEG
-SET(ENABLE_THREADS    1)
 SET(USE_MP3    1)
 SET(USE_AC3    1)
 SET(USE_FFMPEG    1)
 SET(USE_MJPEG    1)
 SET(USE_LIBXML2    1)
+
+# FFMPEG
+SET(ENABLE_THREADS    1)
 SET(HAVE_LRINTF    1)
 SET(HAVE_FAST_UNALIGNED 1)
+SET(HAVE_THREADS 1)
 SET(RUNTIME_CPUDETECT    1)
 
+# mpeg2dec
+SET(ACCEL_DETECT 1)
+
 ########################################
 # taist : Should fail!
 ########################################

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 15:35:36 UTC (rev 3493)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 17:56:18 UTC (rev 3494)
@@ -9,6 +9,7 @@
 #define ftello ftello64
 #define fseeko fseeko64
 #endif
+
 /* Big endian CPU - SPARC or PowerPC */
 #cmakedefine ADM_BIG_ENDIAN
 
@@ -23,19 +24,19 @@
 /* Sparc workstations */
 #cmakedefine ADM_SPARC
 
-/* "Build for windows 32bits" */
+/* Build for Windows 32bits */
 #cmakedefine ADM_WIN32
 
-/* "ALSA is 1.0" */
+/* ALSA is 1.0 */
 #cmakedefine ALSA_1_0_SUPPORT
 
-/* "use ALSA as possible audio device" */
+/* use ALSA as possible audio device */
 #cmakedefine ALSA_SUPPORT
 
 /* AMR_NB */
 #cmakedefine AMR_NB
 
-/* "X86_64 AMD64 assembly" */
+/* X86_64 AMD64 assembly */
 #cmakedefine ARCH_64_BITS
 
 /* Enable PowerPC optim */
@@ -47,182 +48,71 @@
 /* post proc */
 #cmakedefine ARCH_X86
 
-/* "X86_32 assembly" */
+/* X86_32 assembly */
 #cmakedefine ARCH_X86_32
 
-/* "X86_64 AMD64 assembly" */
+/* X86_64 AMD64 assembly */
 #cmakedefine ARCH_X86_64
 
-/* CONFIG_AC3_ENCODER */
+/* FFMPEG */
 #cmakedefine CONFIG_AC3_ENCODER
-
-/* AMR_NB */
 #cmakedefine CONFIG_AMR_NB
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_CYUV_DECODER
-
-/* Inform FFmpeg we are using Darwin Mac OS X */
 #cmakedefine CONFIG_DARWIN
-
-/* FFMPEG */
 #cmakedefine CONFIG_DECODERS
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_DVVIDEO_DECODER
-
-/* DV encoder */
 #cmakedefine CONFIG_DVVIDEO_ENCODER
-
-/* FFMPEG */
 #cmakedefine CONFIG_ENCODERS
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_FFV1_DECODER
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_FFV1_ENCODER
-
-/* CONFIG_FFVHUFF_ENCODER */
 #cmakedefine CONFIG_FFVHUFF_DECODER
-
-/* CONFIG_FFVHUFF_ENCODER */
 #cmakedefine CONFIG_FFVHUFF_ENCODER
-
-/* CONFIG_H263P_ENCODER */
 #cmakedefine CONFIG_H263P_DECODER
-
-/* CONFIG_H263P_ENCODER */
 #cmakedefine CONFIG_H263P_ENCODER
-
-/* CONFIG_H263_ENCODER */
 #cmakedefine CONFIG_H263_DECODER
-
-/* CONFIG_H263_ENCODER */
 #cmakedefine CONFIG_H263_ENCODER
-
-/* CONFIG_H263P_ENCODER */
 #cmakedefine CONFIG_H264_DECODER
-
-/* CONFIG_HUFFYUV_ENCODER */
 #cmakedefine CONFIG_HUFFYUV_DECODER
-
-/* CONFIG_HUFFYUV_ENCODER */
 #cmakedefine CONFIG_HUFFYUV_ENCODER
-
-/* CONFIG_MJPEG_ENCODER */
 #cmakedefine CONFIG_MJPEG_DECODER
-
-/* CONFIG_MJPEG_ENCODER */
 #cmakedefine CONFIG_MJPEG_ENCODER
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_MOV_MUXER
-
-/* CONFIG_MP2_ENCODER */
 #cmakedefine CONFIG_MP2_ENCODER
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_MP4_MUXER
-
-/* CONFIG_MPEG1VIDEO_ENCODER */
 #cmakedefine CONFIG_MPEG1VIDEO_DECODER
-
-/* CONFIG_MPEG1VIDEO_ENCODER */
 #cmakedefine CONFIG_MPEG1VIDEO_ENCODER
-
-/* CONFIG_MPEG2VIDEO_ENCODER */
 #cmakedefine CONFIG_MPEG2VIDEO_DECODER
-
-/* CONFIG_MPEG2VIDEO_ENCODER */
 #cmakedefine CONFIG_MPEG2VIDEO_ENCODER
-
-/* CONFIG_MPEG4_ENCODER */
 #cmakedefine CONFIG_MPEG4_DECODER
-
-/* CONFIG_MPEG4_ENCODER */
 #cmakedefine CONFIG_MPEG4_ENCODER
-
-/* FFMPEG */
 #cmakedefine CONFIG_MPEGAUDIO_HP
-
-/* CONFIG_MSMPEG4V3_ENCODER */
 #cmakedefine CONFIG_MSMPEG4V2_DECODER
-
-/* CONFIG_MSMPEG4V3_ENCODER */
 #cmakedefine CONFIG_MSMPEG4V3_DECODER
-
-/* CONFIG_MSMPEG4V3_ENCODER */
 #cmakedefine CONFIG_MSMPEG4V3_ENCODER
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_MUXERS
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_PSP_MUXER
-
-/* FFMPEG */
 #cmakedefine CONFIG_QDM2_DECODER
-
-/* FFMPEG */
 #cmakedefine CONFIG_RISKY
-
-/* CONFIG_SNOW_DECODER */
 #cmakedefine CONFIG_SNOW_DECODER
-
-/* CONFIG_SNOW_ENCODER */
 #cmakedefine CONFIG_SNOW_ENCODER
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_SVQ3_DECODER
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_TG2_MUXER
-
-/* CONFIG_MUXERS */
 #cmakedefine CONFIG_TGP_MUXER
-
-/* CONFIG_MPEG1VIDEO_ENCODER */
 #cmakedefine CONFIG_TSCC_DECODER
-
-/* FFMPEG */
 #cmakedefine CONFIG_VC1_DECODER
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_WMAV2_DECODER
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_WMV1_DECODER
-
-/* CONFIG_FFV1_ENCODER */
 #cmakedefine CONFIG_WMV2_DECODER
-
-/* FFMPEG */
 #cmakedefine CONFIG_WMV3_DECODER
-
-/* CONFIG_MPEG1VIDEO_ENCODER */
 #cmakedefine CONFIG_ZLIB
 
-/* "Name mangling" */
+/* Name mangling */
 #cmakedefine CYG_MANGLING
 
-/* roundup function */
-#cmakedefine EMULATE_FAST_INT
-
-/* Define to 1 if translation of program messages to the user's native
-   language is requested. */
-#cmakedefine ENABLE_NLS
-
 /* Mad */
 #cmakedefine FPM_DEFAULT
-
-/* Mad */
 #cmakedefine FPM_INTEL
-
-/* Mad */
 #cmakedefine FPM_PPC
-
-/* Mad */
 #cmakedefine FPM_SPARC
 
 /* Using GCC 2.9x.x */
@@ -231,53 +121,20 @@
 /* gettext package name */
 #cmakedefine GETTEXT_PACKAGE
 
-/* Define to 1 if you have the <alsa/asoundlib.h> header file. */
-#cmakedefine HAVE_ALSA_ASOUNDLIB_H
-
 /* AltiVec for mpeg2enc */
 #cmakedefine HAVE_ALTIVEC
 
 /* Enable AltiVec by default */
 #cmakedefine HAVE_ALTIVEC_H
 
-/* Define to 1 if you have the <artsc.h> header file. */
-#cmakedefine HAVE_ARTSC_H
-
 /* Enable AltiVec by default */
 #cmakedefine HAVE_BUILTIN_VECTOR
 
-/* Define to 1 if you have the MacOS X function CFLocaleCopyCurrent in the
-   CoreFoundation framework. */
-#cmakedefine HAVE_CFLOCALECOPYCURRENT
-
-/* Define to 1 if you have the MacOS X function CFPreferencesCopyAppValue in
-   the CoreFoundation framework. */
-#cmakedefine HAVE_CFPREFERENCESCOPYAPPVALUE
-
-/* Define if the GNU dcgettext() function is already present or preinstalled.
-   */
-#cmakedefine HAVE_DCGETTEXT
-
-/* Define to 1 if you have the <dlfcn.h> header file. */
-#cmakedefine HAVE_DLFCN_H
-
-/* Define to 1 if you have the <dts.h> header file. */
-#cmakedefine HAVE_DTS_H
-
-/* Define to 1 if you have the <dts_internal.h> header file. */
-#cmakedefine HAVE_DTS_INTERNAL_H
-
-/* Define to 1 if you have the <faac.h> header file. */
-#cmakedefine HAVE_FAAC_H
-
-/* Define to 1 if you have the <faad.h> header file. */
-#cmakedefine HAVE_FAAD_H
-
 /* FFMPEG */
 #cmakedefine HAVE_FAST_UNALIGNED
 #cmakedefine HAVE_FAST_64BIT
 
-/* "FontConfig detected" */
+/* FontConfig detected */
 #cmakedefine HAVE_FONTCONFIG
 
 /* Define if the GNU gettext() function is already present or preinstalled. */
@@ -286,75 +143,18 @@
 /* Define to 1 if you have the `gettimeofday' function. */
 #cmakedefine HAVE_GETTIMEOFDAY
 
-/* Define if you have the iconv() function. */
-#cmakedefine HAVE_ICONV
-
 /* Define to 1 if you have the <inttypes.h> header file. */
 #cmakedefine HAVE_INTTYPES_H
 
-/* Define to 1 if you have the <lame/lame.h> header file. */
-#cmakedefine HAVE_LAME_LAME_H
-
-/* Define to 1 if you have the `aften' library (-laften). */
-#cmakedefine HAVE_LIBAFTEN
-
-/* Define to 1 if you have the `amrnb' library (-lamrnb). */
-#cmakedefine HAVE_LIBAMRNB
-
-/* Define to 1 if you have the `asound' library (-lasound). */
-#cmakedefine HAVE_LIBASOUND
-
-/* Define to 1 if you have the `dts' library (-ldts). */
-#cmakedefine HAVE_LIBDTS
-
-/* Define to 1 if you have the `esd' library (-lesd). */
-#cmakedefine HAVE_LIBESD
-
-/* Define to 1 if you have the `faac' library (-lfaac). */
-#cmakedefine HAVE_LIBFAAC
-
-/* Define to 1 if you have the `faad' library (-lfaad). */
-#cmakedefine HAVE_LIBFAAD
-
-/* Define to 1 if you have the `fontconfig' library (-lfontconfig). */
-#cmakedefine HAVE_LIBFONTCONFIG
-
 /* Define to 1 if you have the `mp3lame' library (-lmp3lame). */
 #cmakedefine HAVE_LIBMP3LAME
 
-/* Define to 1 if you have the `png' library (-lpng). */
-#cmakedefine HAVE_LIBPNG
-
-/* Define to 1 if you have the `vorbis' library (-lvorbis). */
-#cmakedefine HAVE_LIBVORBIS
-
-/* Define to 1 if you have the `vorbisenc' library (-lvorbisenc). */
-#cmakedefine HAVE_LIBVORBISENC
-
-/* Define to 1 if you have the `x264' library (-lx264). */
-#cmakedefine HAVE_LIBX264
-
-/* Define to 1 if you have the <libxml/parser.h> header file. */
-#cmakedefine HAVE_LIBXML_PARSER_H
-
-/* Define to 1 if you have the `Xv' library (-lXv). */
-#cmakedefine HAVE_LIBXV
-
-/* Define to 1 if you have the `xvidcore' library (-lxvidcore). */
-#cmakedefine HAVE_LIBXVIDCORE
-
-/* roundup function */
+/* lrintf exists? */
 #cmakedefine HAVE_LRINTF
 
 /* Use malloc.h */
 #cmakedefine HAVE_MALLOC_H
 
-/* Define to 1 if you have the <malloc/malloc.h> header file. */
-#cmakedefine HAVE_MALLOC_MALLOC_H
-
-/* Define to 1 if you have the <memory.h> header file. */
-#cmakedefine HAVE_MEMORY_H
-
 /* post proc */
 #cmakedefine HAVE_MMX
 #cmakedefine ENABLE_MMX ${ENABLE_MMX}
@@ -366,15 +166,9 @@
 /* Define to 1 if you have the <stdlib.h> header file. */
 #cmakedefine HAVE_STDLIB_H
 
-/* Define to 1 if you have the <strings.h> header file. */
-#cmakedefine HAVE_STRINGS_H
-
 /* Define to 1 if you have the <string.h> header file. */
 #cmakedefine HAVE_STRING_H
 
-/* Define to 1 if you have the <sys/shm.h> header file. */
-#cmakedefine HAVE_SYS_SHM_H
-
 /* Define to 1 if you have the <sys/stat.h> header file. */
 #cmakedefine HAVE_SYS_STAT_H
 
@@ -387,16 +181,10 @@
 /* Define to 1 if you have the <unistd.h> header file. */
 #cmakedefine HAVE_UNISTD_H
 
-/* Define to 1 if you have the <X11/extensions/XShm.h> header file. */
-#cmakedefine HAVE_X11_EXTENSIONS_XSHM_H
-
-/* Define to 1 if you have the <X11/extensions/Xvlib.h> header file. */
-#cmakedefine HAVE_X11_EXTENSIONS_XVLIB_H
-
 /* stricter prototyping */
 #cmakedefine ICONV_NEED_CONST
 
-/* "SSE on Cywin" */
+/* SSE on Cywin */
 #cmakedefine MEMALIGN_HACK
 
 /* use classing FAAD support */
@@ -423,12 +211,9 @@
 /* Define to the version of this package. */
 #cmakedefine PACKAGE_VERSION
 
-/* "Let FFmpeg decide which is faster" */
+/* Let FFmpeg decide which is faster */
 #cmakedefine RUNTIME_CPUDETECT
 
-/* Define to 1 if you have the ANSI C header files. */
-#cmakedefine STDC_HEADERS
-
 /* use liba52 */
 #cmakedefine USE_AC3
 
@@ -449,7 +234,7 @@
 /* Tell avidemux to use libamrnb */
 #cmakedefine USE_AMR_NB
 
-/* "aRts detected" */
+/* aRts detected */
 #cmakedefine USE_ARTS
 
 /* ESD detected */
@@ -458,7 +243,7 @@
 /* Jack detected */
 #cmakedefine USE_JACK
 
-/* "Use faac audio enccoder" */
+/* Use faac audio enccoder */
 #cmakedefine USE_FAAC
 
 /* FAAD2 detected */
@@ -467,16 +252,16 @@
 /* FFmpeg */
 #cmakedefine USE_FFMPEG
 
-/* "FontConfig detected" */
+/* FontConfig detected */
 #cmakedefine USE_FONTCONFIG
 
-/* "FreeType2 detected" */
+/* FreeType2 detected */
 #cmakedefine USE_FREETYPE
 
-/* "use late binding of selected libraries" */
+/* use late binding of selected libraries */
 #cmakedefine USE_LATE_BINDING
 
-/* "libdca detected" */
+/* libdca detected */
 #cmakedefine USE_LIBDCA
 
 /* Libxml2 is available */
@@ -517,6 +302,3 @@
 
 /* Big endian CPU - SPARC or PowerPC */
 #cmakedefine WORDS_BIGENDIAN
-
-/* Define to 1 if the X Window System is missing or not being used. */
-#cmakedefine X_DISPLAY_MISSING



From gruntster at mail.berlios.de  Fri Aug 10 00:44:06 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 10 Aug 2007 00:44:06 +0200
Subject: [Avidemux-svn-commit] r3495 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_libraries/ADM_lavcodec
	avidemux/ADM_libraries/ADM_lavcodec/i386
Message-ID: <200708092244.l79Mi6Oc001956@sheep.berlios.de>

Author: gruntster
Date: 2007-08-10 00:43:48 +0200 (Fri, 10 Aug 2007)
New Revision: 3495

Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mem.c
Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/Makefile.am
   branches/avidemux_2.4_branch/config.h.cmake
   branches/avidemux_2.4_branch/configure.in.in
Log:
[lav] more Make tidy-ups

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-09 22:43:48 UTC (rev 3495)
@@ -395,7 +395,6 @@
    SET(ENABLE_MMX    1)
    SET(ARCH_X86_32    1)
    SET(FPM_INTEL    1)
-   SET(MEMALIGN_HACK    1)
    add_definitions(-mms-bitfields -mno-cygwin)
  else(WIN32)
       if(CMAKE_OSX_SYSROOT AND  ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i386")

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2007-08-09 22:43:48 UTC (rev 3495)
@@ -38,7 +38,7 @@
 SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
                         i386/cputest.c     
 			i386/mpegvideo_mmx.c     i386/vp3dsp_mmx.c 
-			i386/dsputil_mmx.c  i386/idct_mmx.c  
+			i386/dsputil_mmx.c   
 			i386/fdct_mmx.c   i386/motion_est_mmx.c  i386/simple_idct_mmx.c 
 			i386/fft_sse.c i386/vp3dsp_sse2.c  
 			i386/idct_mmx_xvid.c i386/fft_3dn2.c 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/Makefile.am	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/Makefile.am	2007-08-09 22:43:48 UTC (rev 3495)
@@ -1 +1 @@
-EXTRA_DIST = cputest.c dsputil_mmx.c dsputil_mmx_avg.h dsputil_mmx_rnd.h fdct_mmx.c fft_sse.c idct_mmx.c mmx.h motion_est_mmx.c mpegvideo_mmx.c mpegvideo_mmx_template.c simple_idct_mmx.c vp3dsp_mmx.c vp3dsp_sse2.c
+EXTRA_DIST = cputest.c dsputil_mmx.c dsputil_mmx_avg.h dsputil_mmx_rnd.h fdct_mmx.c fft_sse.c mmx.h motion_est_mmx.c mpegvideo_mmx.c mpegvideo_mmx_template.c simple_idct_mmx.c vp3dsp_mmx.c vp3dsp_sse2.c

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mem.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mem.c	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mem.c	2007-08-09 22:43:48 UTC (rev 3495)
@@ -1,137 +0,0 @@
-/*
- * default memory allocator for libavcodec
- * Copyright (c) 2002 Fabrice Bellard.
- *
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
- * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
- */
-
-/**
- * @file mem.c
- * default memory allocator for libavcodec.
- */
-
-#include "avcodec.h"
-
-/* here we can use OS dependant allocation functions */
-#undef malloc
-#undef free
-#undef realloc
-
-#ifdef HAVE_MALLOC_H
-#include <malloc.h>
-#endif
-
-/* you can redefine av_malloc and av_free in your project to use your
-   memory allocator. You do not need to suppress this file because the
-   linker will do it automatically */
-
-/**
- * Memory allocation of size byte with alignment suitable for all
- * memory accesses (including vectors if available on the
- * CPU). av_malloc(0) must return a non NULL pointer.
- */
-void *av_malloc(unsigned int size)
-{
-    void *ptr;
-#ifdef MEMALIGN_HACK
-    long diff;
-#endif
-
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
-
-#ifdef MEMALIGN_HACK
-    ptr = malloc(size+16);
-    if(!ptr)
-        return ptr;
-    diff= ((-(long)ptr - 1)&15) + 1;
-    ptr += diff;
-    ((char*)ptr)[-1]= diff;
-#elif defined (HAVE_MEMALIGN)
-    ptr = memalign(16,size);
-    /* Why 64?
-       Indeed, we should align it:
-         on 4 for 386
-         on 16 for 486
-         on 32 for 586, PPro - k6-III
-         on 64 for K7 (maybe for P3 too).
-       Because L1 and L2 caches are aligned on those values.
-       But I don't want to code such logic here!
-     */
-     /* Why 16?
-        because some cpus need alignment, for example SSE2 on P4, & most RISC cpus
-        it will just trigger an exception and the unaligned load will be done in the
-        exception handler or it will just segfault (SSE2 on P4)
-        Why not larger? because i didnt see a difference in benchmarks ...
-     */
-     /* benchmarks with p3
-        memalign(64)+1          3071,3051,3032
-        memalign(64)+2          3051,3032,3041
-        memalign(64)+4          2911,2896,2915
-        memalign(64)+8          2545,2554,2550
-        memalign(64)+16         2543,2572,2563
-        memalign(64)+32         2546,2545,2571
-        memalign(64)+64         2570,2533,2558
-
-        btw, malloc seems to do 8 byte alignment by default here
-     */
-#else
-    ptr = malloc(size);
-#endif
-    return ptr;
-}
-
-/**
- * av_realloc semantics (same as glibc): if ptr is NULL and size > 0,
- * identical to malloc(size). If size is zero, it is identical to
- * free(ptr) and NULL is returned.
- */
-void *av_realloc(void *ptr, unsigned int size)
-{
-#ifdef MEMALIGN_HACK
-    int diff;
-#endif
-
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
-
-#ifdef MEMALIGN_HACK
-    //FIXME this isn't aligned correctly, though it probably isn't needed
-    if(!ptr) return av_malloc(size);
-    diff= ((char*)ptr)[-1];
-    return realloc(ptr - diff, size + diff) + diff;
-#else
-    return realloc(ptr, size);
-#endif
-}
-
-/**
- * Free memory which has been allocated with av_malloc(z)() or av_realloc().
- * NOTE: ptr = NULL is explicetly allowed
- * Note2: it is recommended that you use av_freep() instead
- */
-void av_free(void *ptr)
-{
-    /* XXX: this test should not be needed on most libcs */
-    if (ptr)
-#ifdef MEMALIGN_HACK
-        free(ptr - ((char*)ptr)[-1]);
-#else
-        free(ptr);
-#endif
-}
-

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-09 22:43:48 UTC (rev 3495)
@@ -184,9 +184,6 @@
 /* stricter prototyping */
 #cmakedefine ICONV_NEED_CONST
 
-/* SSE on Cywin */
-#cmakedefine MEMALIGN_HACK
-
 /* use classing FAAD support */
 #cmakedefine OLD_FAAD_PROTO
 

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-08-09 17:56:18 UTC (rev 3494)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-08-09 22:43:48 UTC (rev 3495)
@@ -405,7 +405,6 @@
 AM_CONDITIONAL(HAVE_CYGWIN, test "x$use_cygwin" = "xyes")
 
 if test "x$use_cygwin" = "xyes"; then
-	AC_DEFINE(MEMALIGN_HACK,1,"SSE on Cywin")
 	AC_DEFINE(CYG_MANGLING,1,"Name mangling")
 	AC_DEFINE(ADM_WIN32,1,"Build for windows 32bits")
 	AC_DEFINE(rindex,strrchr,"rindex does not exist on Cygwin")



From mean at mail.berlios.de  Sun Aug 12 17:09:21 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 12 Aug 2007 17:09:21 +0200
Subject: [Avidemux-svn-commit] r3496 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass
Message-ID: <200708121509.l7CF9LeP002543@sheep.berlios.de>

Author: mean
Date: 2007-08-12 17:09:21 +0200 (Sun, 12 Aug 2007)
New Revision: 3496

Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/Makefile.am
Log:
[Ass] Remove leftovers from previous version

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/CMakeLists.txt	2007-08-09 22:43:48 UTC (rev 3495)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/CMakeLists.txt	2007-08-12 15:09:21 UTC (rev 3496)
@@ -6,7 +6,7 @@
 #
 if(FT_FOUND)
 SET(${ADM_LIB}_SRCS 
-ass_bitmap.c  ass.c  ass_cache.c  ass_fontconfig.c  ass_library.c  ass_mp.c  ass_render.c  ass_utils.c  mputils.c
+ass_bitmap.c  ass.c  ass_cache.c  ass_fontconfig.c  ass_library.c   ass_render.c  ass_utils.c  mputils.c
 ass_font.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/Makefile.am	2007-08-09 22:43:48 UTC (rev 3495)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/Makefile.am	2007-08-12 15:09:21 UTC (rev 3496)
@@ -1,6 +1,6 @@
 noinst_LIBRARIES = libass.a
 libass_a_METASOURCES = AUTO
-libass_a_SOURCES = ass.c  ass_cache.c  ass_fontconfig.c  ass_mp.c  ass_render.c  ass_utils.c  mputils.c ass_bitmap.c ass_library.c ass_font.c
+libass_a_SOURCES = ass.c  ass_cache.c  ass_fontconfig.c  ass_render.c  ass_utils.c  mputils.c ass_bitmap.c ass_library.c ass_font.c
 
 EXTRA_DIST = 
 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.c	2007-08-09 22:43:48 UTC (rev 3495)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.c	2007-08-12 15:09:21 UTC (rev 3496)
@@ -1,10 +0,0 @@
-#include "ass_mp.h"
-
-// libass-related command line options
-int ass_enabled = 0;
-float ass_font_scale = 1.;
-float ass_line_spacing = 0.;
-int ass_top_margin = 0;
-int ass_bottom_margin = 0;
-int extract_embedded_fonts = 0;
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.h	2007-08-09 22:43:48 UTC (rev 3495)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_mp.h	2007-08-12 15:09:21 UTC (rev 3496)
@@ -1,12 +0,0 @@
-#ifndef __ASS_OPTIONS_H__
-#define __ASS_OPTIONS_H__
-
-extern int ass_enabled;
-extern float ass_font_scale;
-extern float ass_line_spacing;
-extern int ass_top_margin;
-extern int ass_bottom_margin;
-extern int extract_embedded_fonts;
-
-#endif
-



From mean at mail.berlios.de  Mon Aug 13 10:19:49 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 10:19:49 +0200
Subject: [Avidemux-svn-commit] r3497 - in
	branches/avidemux_2.4_branch/avidemux: ADM_filter
	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_GTK/ADM_filters
	ADM_userInterfaces/ADM_QT4/ADM_filters
Message-ID: <200708130819.l7D8Jnua009897@sheep.berlios.de>

Author: mean
Date: 2007-08-13 10:19:48 +0200 (Mon, 13 Aug 2007)
New Revision: 3497

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_saveload.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/vidVCD.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
Log:
[Filter] Convert array to vector, fix size overflow (Chris McGregor)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -38,9 +38,8 @@
 #include "ADM_osSupport/ADM_quota.h"
 //
 // exported vars
-uint32_t nb_video_filter=0;
+std::vector <FILTER_ENTRY> allfilters;
 uint32_t nb_active_filter=0;
-FILTER_ENTRY allfilters[MAX_FILTER];
 FILTER  videofilters[MAX_FILTER];
 
 static uint32_t lastStart=0, lastNb=0;
@@ -82,7 +81,7 @@
 {
 char *name;
 	printf("\nVideo filters\n");
-	for(uint32_t i=0;i<nb_video_filter;i++)
+	for(uint32_t i=0;i<nb_video_filter();i++)
 	{
 		name=allfilters[ i].filtername;
 		if(allfilters[ i].viewable)
@@ -97,7 +96,7 @@
 {
 char *name;
 	VF_FILTERS filter=VF_DUMMY;
-	for(uint32_t i=0;i<nb_video_filter;i++)
+	for(uint32_t i=0;i<nb_video_filter();i++)
 	{
 		name=allfilters[ i].filtername;
 		if(allfilters[ i].viewable)
@@ -118,13 +117,8 @@
 		,AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *)
 		,char *filtername)
 {
-        ADM_assert(nb_video_filter<(MAX_FILTER-1));
-        allfilters[ nb_video_filter].name=name;
-        allfilters[ nb_video_filter].create=create;
-        allfilters[ nb_video_filter].tag=tag;
-        allfilters[ nb_video_filter].viewable=viewable;
-	allfilters[ nb_video_filter].filtername=filtername;
-        nb_video_filter ++;
+//        printf ("*nb_video_filter() = %d, max %d, name = %s\n", nb_video_filter(), (MAX_FILTER-1), name);
+        allfilters.push_back (FILTER_ENTRY (name, create, tag, viewable, filtername));
 
         if(viewable==1)
 	{
@@ -135,15 +129,9 @@
 		,AVDMGenericVideoStream *(*create) (AVDMGenericVideoStream *in, CONFcouple *)
 		,char *filtername,AVDMGenericVideoStream *(*create_from_script) (AVDMGenericVideoStream *in, int n,Arg *args),char *desc)
 {
-        ADM_assert(nb_video_filter<(MAX_FILTER-1));
-        allfilters[ nb_video_filter].name=name;
-        allfilters[ nb_video_filter].create=create;
-        allfilters[ nb_video_filter].tag=tag;
-        allfilters[ nb_video_filter].viewable=viewable;
-	allfilters[ nb_video_filter].filtername=filtername;
-	allfilters[ nb_video_filter].create_from_script=create_from_script;
-        allfilters[ nb_video_filter].description=desc;
-        nb_video_filter ++;
+//    printf ("nb_video_filter = %d, max %d, name = %s\n", nb_video_filter, (MAX_FILTER-1), name);
+        allfilters.push_back (FILTER_ENTRY (name, create, tag, viewable,
+                                            filtername, desc, create_from_script));
 
         if(viewable==1)
 	{
@@ -157,8 +145,7 @@
 ************************************************************************************************/
 AVDMGenericVideoStream *getLastVideoFilter(void)
 {
-extern ADM_Composer *video_body;
-aviInfo info;
+    aviInfo info;
 
 	video_body->getVideoInfo(&info);
 
@@ -182,7 +169,6 @@
 */
 AVDMGenericVideoStream *getLastVideoFilter( uint32_t start, uint32_t nb)
 {
-extern ADM_Composer *video_body;
   // sanity check
   	lastNb=nb;
 	lastStart=start;
@@ -199,7 +185,6 @@
 /********* Returns the first video filters starting from frame xx with nb frames ***************/
 AVDMGenericVideoStream *getFirstVideoFilter( uint32_t start, uint32_t nbFrame)
 {
-extern ADM_Composer *video_body;
   // sanity check
   	lastNb=nbFrame;
 	lastStart=start;
@@ -214,7 +199,6 @@
 }
 AVDMGenericVideoStream *getFirstVideoFilter( void)
 {
-extern ADM_Composer *video_body;
   // sanity check
   aviInfo info;
 
@@ -276,7 +260,7 @@
                         if(tag>=VF_EXTERNAL_START)
                         {
                           // start from the end, it is an external filter 
-                          for(uint32_t i=nb_video_filter-1;i>=0;i--)
+                          for(uint32_t i=nb_video_filter()-1;i>=0;i--)
                           {
                               if(tag==allfilters[i].tag)
                                 {
@@ -287,7 +271,7 @@
                         } // else search forward
                         else
                         {
-                          for(unsigned int i=0;i<nb_video_filter;i++)
+                          for(unsigned int i=0;i<nb_video_filter();i++)
                                   {
                                           if(tag==allfilters[i].tag)
                                                   {
@@ -307,7 +291,7 @@
 {
 
                         ADM_assert(tag!=VF_INVALID);
-                        for(unsigned int i=0;i<nb_video_filter;i++)
+                        for(unsigned int i=0;i<nb_video_filter();i++)
                                 {
                                         if(tag==allfilters[i].tag)
                                                 {
@@ -392,7 +376,7 @@
 
 	video_body->getVideoInfo(&info);
 
-	for(unsigned int i=0;i<nb_video_filter;i++)
+	for(unsigned int i=0;i<nb_video_filter();i++)
 	{
 		if(tag==allfilters[i].tag)
 		{
@@ -428,7 +412,7 @@
                 {
                         VF_FILTERS tag=videofilters[i].tag;
                         qfprintf(f,"app.video.addFilter(");
-                        for(unsigned int j=0;j<nb_video_filter;j++)
+                        for(unsigned int j=0;j<nb_video_filter();j++)
                                 {
                                         if(tag==allfilters[j].tag)
                                         {       

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_saveload.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_saveload.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_saveload.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -42,9 +42,7 @@
 #include "ADM_video/ADM_confCouple.h"
 #include "avi_vars.h"
 // exported vars
-extern uint32_t nb_video_filter;
 extern uint32_t nb_active_filter;
-extern FILTER_ENTRY allfilters[MAX_FILTER];
 extern FILTER  videofilters[MAX_FILTER];
 
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *couple, AVDMGenericVideoStream *in);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/vidVCD.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/vidVCD.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/vidVCD.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -46,8 +46,6 @@
 #include "prefs.h"
 #include "ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h"
 //___________________________________________
-extern FILTER_ENTRY allfilters[MAX_FILTER];
-extern uint32_t nb_video_filter;
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
 extern ADM_Composer *video_body;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-13 08:19:48 UTC (rev 3497)
@@ -17,7 +17,6 @@
  #ifndef __VIDEO_FILTERS__
  #define  __VIDEO_FILTERS__
 
- #define MAX_FILTER 80
 #include "ADM_script/adm_scanner.h"
 typedef enum
 {
@@ -101,6 +100,8 @@
                 VF_DVBSUB,
                 VF_LOGO,
                 VF_DUMMY,
+                VF_COUNT,
+                MAX_FILTER = VF_COUNT - 1,
                 VF_EXTERNAL_START=0xF0000000
           }VF_FILTERS;
 
@@ -108,19 +109,46 @@
 typedef AVDMGenericVideoStream *(ADM_create_from_scriptT) (AVDMGenericVideoStream *in, int n,Arg *args);
 
          
-   typedef struct
+   struct FILTER_ENTRY
    {
         const char        *name;
         ADM_createT       *create;
-        void              *destroy( AVDMGenericVideoStream *old); /* Maybe needed ...*/
+        void              (*destroy)( AVDMGenericVideoStream *old); /* Maybe needed ...*/
         VF_FILTERS        tag;
         uint8_t           viewable;
         char              *filtername;
         char              *description;
         ADM_create_from_scriptT *create_from_script;
-   }FILTER_ENTRY;
+
+       FILTER_ENTRY (const char * name, ADM_createT * create, VF_FILTERS tag,
+                     uint8_t viewable, char * filtername,
+                     char * description = 0,
+                     ADM_create_from_scriptT * create_from_script = 0)
+           : name (name),
+             create (create),
+             destroy (0),
+             tag (tag),
+             viewable (viewable),
+             filtername (filtername),
+             description (description),
+             create_from_script (create_from_script)
+       {
+       }
+
+       FILTER_ENTRY ()
+           : name (0),
+             create (0),
+             destroy (0),
+             tag (VF_INVALID),
+             viewable (0),
+             filtername (0),
+             description (0),
+             create_from_script (0)
+       {
+       }
+   };
  	
- typedef struct
+   typedef struct
    {
           VF_FILTERS              tag;
           AVDMGenericVideoStream *filter;
@@ -133,6 +161,13 @@
             const char  *param[25];
    }FILTER_PARAM;
    
+#include <vector>
+extern std::vector <FILTER_ENTRY> allfilters;
+inline size_t nb_video_filter ()
+{
+    return allfilters.size();
+}
+
 AVDMGenericVideoStream *getLastVideoFilter( uint32_t frameStart, uint32_t nbFrame);
 AVDMGenericVideoStream *getLastVideoFilter( void );
 AVDMGenericVideoStream *getFirstVideoFilter( uint32_t frameStart, uint32_t nbFrame);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-13 08:19:48 UTC (rev 3497)
@@ -45,6 +45,15 @@
         PLANAR_V=3
         
 } ADM_PLANE;
+typedef enum 
+{
+		ADM_IMAGE_UNKNOWN=0,
+        ADM_IMAGE_JPG=1,
+        ADM_IMAGE_PNG=2,
+        ADM_IMAGE_BMP=3,
+        ADM_IMAGE_BMP2=4
+        
+} ADM_IMAGE_TYPE;
 class ADMImage
 {
 public:
@@ -176,4 +185,5 @@
 uint8_t BitBlitAlpha(uint8_t *dst, uint32_t pitchDst,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height,uint32_t alpha);
 
 ADMImage *createImageFromFile(const char *filename);
+ADM_IMAGE_TYPE ADM_identidyImageFile(const char *filename,uint32_t *w,uint32_t *h);
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -64,51 +64,33 @@
 		
 }
 
-/*
+/**
 		\fn 	createImageFromFile
 		\brief 	Create and returns an ADMImage from a file, only YV12 jpg supported ATM
 
 */
 ADMImage *createImageFromFile(const char *filename)
 {
-	    uint32_t *fcc;
-	    uint8_t fcc_tab[4];
-	    FILE *fd;
-
-	    // 1- identity the file type
-	    //
-	    fcc = (uint32_t *) fcc_tab;
-	    fd = fopen(filename, "rb");
-	    if (!fd) 
-	    {
-	    	printf("[imageLoader] Cannot open that file!\n");
-	    	return NULL;
-	    }
-	    fread(fcc_tab, 4, 1, fd);
-	    fcc = (uint32_t *) fcc_tab;
-	    fclose(fd);
-	    if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
-	    {
-		   	return createImageFromFile_jpeg(filename);
-		} 
-	    if (fourCC::check(*fcc, (uint8_t *) "RIFF")) 
-	    {
-	    	printf("[imageLoader] It looks like BMP (RIFF)...\n");
-	    	return createImageFromFile_Bmp(filename);
-	     }
-	    if (fcc_tab[0] == 'B' && fcc_tab[1] == 'M') 
-	    {
-	    	printf("[imageLoader] It looks like BMP2 (BM)...\n");
-	    	return createImageFromFile_Bmp2(filename);
-
-	    	} 
-	    if (fcc_tab[1] == 'P' && fcc_tab[2] == 'N' && fcc_tab[3] == 'G') 
-	    {
-	    	printf("[imageLoader] It looks like PNG...\n");
-	    	return createImageFromFile_png(filename);	    	
-	    }
-	    printf("[imageLoader] Unrecognized file!\n");
-	    return NULL;
+	uint32_t w,h;
+	switch(ADM_identidyImageFile(filename,&w,&h))
+	{
+		case  ADM_IMAGE_UNKNOWN: 
+					printf("[imageLoader] Trouble identifying /loading %s\n",filename);
+					return NULL;
+		case ADM_IMAGE_JPG:
+					return createImageFromFile_jpeg(filename);
+					break;
+		case ADM_IMAGE_PNG:
+					return createImageFromFile_png(filename);
+					break;
+		case ADM_IMAGE_BMP2:
+					return createImageFromFile_Bmp2(filename);
+					break;
+		default:
+				ADM_assert(0);
+	
+	}
+	ADM_assert(0);
 }
 /**
  * 	\fn createImageFromFile_jpeg
@@ -367,5 +349,107 @@
     	delete [] data;
     	return image;		
 }
+/**
+ * 		\fn ADM_identidyImageFile
+ * 		\brief Identidy image type, returns type and width/height
+ */
+ADM_IMAGE_TYPE ADM_identidyImageFile(const char *filename,uint32_t *w,uint32_t *h)
+{
+			uint32_t *fcc;
+		    uint8_t fcc_tab[4];
+		    FILE *fd;
+		    uint32_t off,tag,count,size;
+		    BITMAPHEADER bmph;
 
+		    // 1- identity the file type
+		    //
+		    fcc = (uint32_t *) fcc_tab;
+		    fd = fopen(filename, "rb");
+		    if (!fd) 
+		    {
+		    	printf("[imageIdentify] Cannot open that file!\n");
+		    	return ADM_IMAGE_UNKNOWN;
+		    }
+		    fread(fcc_tab, 4, 1, fd);
+		    fcc = (uint32_t *) fcc_tab;
+		    // 2- JPEG ?
+		    if (fcc_tab[0] == 0xff && fcc_tab[1] == 0xd8) 
+		    {
+		    			// JPEG
+		    	  			fseek(fd, 0, SEEK_SET);
+		    			    read16(fd);	// skip jpeg ffd8
+		    			    count=0;
+		    			    while (count < 10 && tag != 0xFFC0) 
+		    			    {
+
+		    			    	tag = read16(fd);
+		    			    	if ((tag >> 8) != 0xff) 
+		    			    	{
+		    			    		printf("[imageIdentify]invalid jpeg tag found (%x)\n", tag);
+		    			    	}
+		    			    	if (tag == 0xFFC0) 
+		    			    	{
+		    			    		read16(fd);	// size
+		    			    		read8(fd);	// precision
+		    			    		*h = read16(fd);
+		    			    		*w = read16(fd);
+		    		                if(*w&1) *w++;
+		    		                if(*h&1) *h++;
+		    			    	} 
+		    			    	else 
+		    			    	{
+		    			    		off = read16(fd);
+		    			    		if (off < 2) 
+		    			    		{
+		    			    			printf("[imageIdentify]Offset too short!\n");
+		    			    		    fclose(fd);
+		    			    		    return ADM_IMAGE_UNKNOWN;
+		    			    		}
+		    			    		fseek(fd, off - 2, SEEK_CUR);
+		    			    	}
+		    				count++;
+		    			    }
+		    			    fclose(fd);
+		    			    if(count>=10) return ADM_IMAGE_UNKNOWN;
+		    			    return ADM_IMAGE_JPG;
+		    }
+		    // PNG ?
+		    if (fcc_tab[1] == 'P' && fcc_tab[2] == 'N' && fcc_tab[3] == 'G') 
+			    {
+		     	    fseek(fd, 0, SEEK_SET);
+		     	    read32(fd);
+		     	    read32(fd);
+		     	    read32(fd);
+		     	    read32(fd);
+		     	    *w=read32(fd);
+		     	    *h=read32(fd);	
+		     	    fclose(fd);
+		     	    return ADM_IMAGE_PNG;
+			    }
+		    // BMP2?
+		    if (fcc_tab[0] == 'B' && fcc_tab[1] == 'M') 
+		    {
+		    	  
+		     	    fseek(fd, 10, SEEK_SET);
+		     	    fread(fcc_tab, 4, 1, fd);
+		     	    // size, width height follow as int32 
+		     	    fread(&bmph, sizeof(bmph), 1, fd);
+		     #ifdef ADM_BIG_ENDIAN
+		     	    Endian_BitMapInfo(&bmph);
+		     #endif
+		     	    if (bmph.compressionScheme != 0) 
+		     	    {
+		     	    	printf("[imageIdentify] BMP2:Cannot handle compressed bmp\n");
+		     	    	fclose(fd);
+		     	    	return ADM_IMAGE_UNKNOWN;
+		     	    }
+		     	    *w = bmph.width;
+		     	    *h = bmph.height;
+	     	    	fclose(fd);
+	     	    	return ADM_IMAGE_BMP2;
+		    }
+		    // Unknown filetype...
+		    fclose(fd);
+		    return ADM_IMAGE_UNKNOWN;
+}
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -51,8 +51,6 @@
 						    in);
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
 //___________________________________________
-extern FILTER_ENTRY allfilters[MAX_FILTER];
-extern uint32_t nb_video_filter;
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
 extern ADM_Composer *video_body;
@@ -435,7 +433,7 @@
     char *str=NULL;
     GtkTreeIter iter;
     int current_tree=0;
-    for (uint32_t i = 0; i < nb_video_filter; i++)
+    for (uint32_t i = 0; i < nb_video_filter(); i++)
     {
         if (allfilters[i].viewable==1)
         {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-08-12 15:09:21 UTC (rev 3496)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-08-13 08:19:48 UTC (rev 3497)
@@ -62,8 +62,6 @@
 #define EXTERNAL_FILTER_BASE  2000
 #define ACTIVE_FILTER_BASE    3000
 /******************************************************/
-extern FILTER_ENTRY allfilters[MAX_FILTER];
-extern uint32_t nb_video_filter;
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
@@ -441,7 +439,7 @@
   
   max=0;
   
-  for (uint32_t i = 0; i < nb_video_filter; i++)
+  for (uint32_t i = 0; i < nb_video_filter(); i++)
     {
       if (allfilters[i].viewable==1)
         {



From mean at mail.berlios.de  Mon Aug 13 12:04:23 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 12:04:23 +0200
Subject: [Avidemux-svn-commit] r3498 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities
Message-ID: <200708131004.l7DA4NIh019897@sheep.berlios.de>

Author: mean
Date: 2007-08-13 12:04:22 +0200 (Mon, 13 Aug 2007)
New Revision: 3498

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
Log:
[Cosmetic] Add () to macro (Chris McGregor)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-13 10:04:22 UTC (rev 3498)
@@ -152,9 +152,9 @@
 static uint32_t lumaDiff(ADMImage *src1,ADMImage *src2,uint32_t noise);
 };
 void drawString(ADMImage *dst, int x, int y, const char *s) ;
-#define YPLANE(x) (x->data)
-#define UPLANE(x) (x->data+(x->_width*x->_height))
-#define VPLANE(x) (x->data+(5*(x->_width*x->_height)>>2))
+#define YPLANE(x) ((x)->data)
+#define UPLANE(x) ((x)->data+((x)->_width*(x)->_height))
+#define VPLANE(x) ((x)->data+(5*((x)->_width*(x)->_height)>>2))
 
 //
 //  Simple image resizer



From mean at mail.berlios.de  Mon Aug 13 12:04:54 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 12:04:54 +0200
Subject: [Avidemux-svn-commit] r3499 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec
Message-ID: <200708131004.l7DA4sID019931@sheep.berlios.de>

Author: mean
Date: 2007-08-13 12:04:54 +0200 (Mon, 13 Aug 2007)
New Revision: 3499

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c
Log:
[mpeg2dec] Fix for amd64/cpu detect

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c	2007-08-13 10:04:22 UTC (rev 3498)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c	2007-08-13 10:04:54 UTC (rev 3499)
@@ -29,7 +29,7 @@
 #include "attributes.h"
 #include "mpeg2_internal.h"
 
-
+#include "admmangle.h"
 typedef void (*sighandler_t)(int); // MEANX RETSIGTYPE
  
 #ifdef ACCEL_DETECT
@@ -39,48 +39,15 @@
     uint32_t eax, ebx, ecx, edx;
     int AMD;
     uint32_t caps;
+#define cpuid(index,eax,ebx,ecx,edx)\
+    __asm __volatile ("mov %%"REG_b", %%"REG_S"\n\t"\
+         "cpuid\n\t"\
+         "xchg %%"REG_b", %%"REG_S\
+         : "=a" (eax), "=S" (ebx),\
+           "=c" (ecx), "=d" (edx)\
+         : "0" (index));
 
-#if !defined(PIC) && !defined(__PIC__)
-#define cpuid(op,eax,ebx,ecx,edx)	\
-    __asm__ ("cpuid"			\
-	     : "=a" (eax),		\
-	       "=b" (ebx),		\
-	       "=c" (ecx),		\
-	       "=d" (edx)		\
-	     : "a" (op)			\
-	     : "cc")
-#else	/* PIC version : save ebx */
-#define cpuid(op,eax,ebx,ecx,edx)	\
-    __asm__ ("push %%ebx\n\t"		\
-	     "cpuid\n\t"		\
-	     "movl %%ebx,%1\n\t"	\
-	     "pop %%ebx"		\
-	     : "=a" (eax),		\
-	       "=r" (ebx),		\
-	       "=c" (ecx),		\
-	       "=d" (edx)		\
-	     : "a" (op)			\
-	     : "cc")
-#endif
 
-    __asm__ ("pushf\n\t"
-	     "pushf\n\t"
-	     "pop %0\n\t"
-	     "movl %0,%1\n\t"
-	     "xorl $0x200000,%0\n\t"
-	     "push %0\n\t"
-	     "popf\n\t"
-	     "pushf\n\t"
-	     "pop %0\n\t"
-	     "popf"
-	     : "=r" (eax),
-	       "=r" (ebx)
-	     :
-	     : "cc");
-
-    if (eax == ebx)		/* no cpuid */
-	return 0;
-
     cpuid (0x00000000, eax, ebx, ecx, edx);
     if (!eax)			/* vendor string only */
 	return 0;



From mean at mail.berlios.de  Mon Aug 13 12:07:01 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 12:07:01 +0200
Subject: [Avidemux-svn-commit] r3500 -
	branches/avidemux_2.4_branch/avidemux/ADM_encoder
Message-ID: <200708131007.l7DA71N5020053@sheep.berlios.de>

Author: mean
Date: 2007-08-13 12:07:01 +0200 (Mon, 13 Aug 2007)
New Revision: 3500

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
Log:
[codec] Inverted params (Chris Mc Gregor

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-13 10:04:54 UTC (rev 3499)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-13 10:07:01 UTC (rev 3500)
@@ -172,8 +172,8 @@
   4,
   1500,
   700,
-  0,
   1000, // AVG
+  ADM_ENC_CAP_CQ,
   ADM_EXTRA_PARAM,
   &ffmpeg4Extra,
   sizeof (ffmpeg4Extra),
@@ -188,8 +188,8 @@
   4,
   1500,
   700,
-  0,
   1000, // AVG
+  ADM_ENC_CAP_CQ,
   ADM_EXTRA_PARAM,
   &ffmpeg4Extra,
   sizeof (ffmpeg4Extra),



From mean at mail.berlios.de  Mon Aug 13 15:47:29 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 15:47:29 +0200
Subject: [Avidemux-svn-commit] r3501 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
Message-ID: <200708131347.l7DDlTve017466@sheep.berlios.de>

Author: mean
Date: 2007-08-13 15:47:25 +0200 (Mon, 13 Aug 2007)
New Revision: 3501

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidHue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidHue.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filters] Move hue and srt to their proper place, now that they use dialogFactory/flyDialog

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -38,7 +38,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyHue.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -43,7 +43,7 @@
 
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 
 #include "ADM_toolkit_gtk/ADM_gladeSupport.h"
 #include "ADM_toolkit_gtk/toolkit_gtk.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -43,7 +43,7 @@
 #include "ADM_encoder/adm_encmjpeg_param.h"
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
-#include "ADM_video/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
 #include "ADM_video/ADM_vobsubinfo.h"
 #include "ADM_video/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
@@ -52,7 +52,7 @@
 #include "ADM_video/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 #include "ADM_audiofilter/audioencoder_vorbis_param.h"    
     
 #include "ADM_audiofilter/audioeng_buildfilters.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -43,7 +43,7 @@
 #include "ADM_encoder/adm_encmjpeg_param.h"
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
-#include "ADM_video/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
 #include "ADM_video/ADM_vobsubinfo.h"
 #include "ADM_video/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
@@ -52,7 +52,7 @@
 #include "ADM_video/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 #include "ADM_audiofilter/audioencoder_vorbis_param.h"    
     
 #include "ADM_audiofilter/audioeng_buildfilters.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -29,7 +29,7 @@
 #include "ADM_encoder/ADM_vidEncode.hxx"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 /**
       \fn DIA_x264
       \brief Dialog for x264 codec settings

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -37,7 +37,7 @@
 #include "ADM_assert.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyDialogQt4.h"
-#include "ADM_video/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
 #include "DIA_flyHue.h"
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -36,7 +36,7 @@
 
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 
 #include "DIA_flySrtPos.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -31,7 +31,7 @@
 #include "ADM_colorspace/ADM_rgb.h"
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyHue.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -26,7 +26,7 @@
 #include "ADM_video/ADM_genvideo.hxx"
 class ADMfont;
 //#include "ADM_video/ADM_vidFont.h"
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 
 #include "DIA_flyDialog.h"
 #include "DIA_flySrtPos.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -32,7 +32,7 @@
 #include "ADM_encoder/ADM_vidEncode.hxx"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
-#include "ADM_video/ADM_vidSRT.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
 #include "ADM_colorspace/colorspace.h"
 /*****************************************************************/
 extern int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b);

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,180 +0,0 @@
-/***************************************************************************
-                          Hue/Saturation filter ported from mplayer 
- (c) Michael Niedermayer
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <math.h>
-
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-#ifdef HAVE_ENCODER
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_filter/video_filters.h"
-#include "ADM_userInterfaces/ADM_commonUI/DIA_enter.h"
-#include "ADM_video/ADM_cache.h"
-
-#include "admmangle.h"
-#include "ADM_vidHue.h"
-static FILTER_PARAM HueParam={2,{"hue","saturation"}};
-
-extern uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in);
-
-class  ADMVideoHue:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            void            update(void);
-            Hue_Param       *_param;    
-            VideoCache      *vidCache; 
-            float           _hue;
-            float           _saturation;
-  public:
-                
-                        ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *setup);
-    virtual             ~ADMVideoHue();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(hue_script,ADMVideoHue,HueParam);
-BUILD_CREATE(hue_create,ADMVideoHue);
-
-void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
-		    int w, int h, float hue, float sat)
-{
-	int i;
-	const int s= (int)rint(sin(hue) * (1<<16) * sat);
-	const int c= (int)rint(cos(hue) * (1<<16) * sat);
-
-	while (h--) {
-		for (i = 0; i<w; i++)
-		{
-			const int u= usrc[i] - 128;
-			const int v= vsrc[i] - 128;
-			int new_u= (c*u - s*v + (1<<15) + (128<<16))>>16;
-			int new_v= (s*u + c*v + (1<<15) + (128<<16))>>16;
-			if(new_u & 768) new_u= (-new_u)>>31;
-			if(new_v & 768) new_v= (-new_v)>>31;
-			udst[i]= new_u;
-			vdst[i]= new_v;
-		}
-		usrc += srcstride;
-		vsrc += srcstride;
-		udst += dststride;
-		vdst += dststride;
-	}
-}
-
-
-uint8_t ADMVideoHue::configure(AVDMGenericVideoStream *in)
-{
-uint8_t r=0;
-  _in=in;   
-  r=  DIA_getHue(_param, in);
-  if(r) update();
-  return r;  
-}
-char *ADMVideoHue::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf," Hue :%2.2f %2.2f",_param->hue,_param->saturation);
-  return buf;
-}
-
-ADMVideoHue::ADMVideoHue(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&_info,_in->getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  Hue_Param;
-  if(couples)
-  {                 
-    GET(hue);    
-    GET(saturation); 
-  }
-  else
-  {
-    _param->hue =0.0;                
-    _param->saturation=1.0;
-  }      
-  vidCache=new VideoCache(1,_in);
-  update();
-}
-void ADMVideoHue::update(void)
-{
-    _hue=_param->hue*M_PI/180.;
-    _saturation=(100+_param->saturation)/100;
-}
-ADMVideoHue::~ADMVideoHue()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoHue::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(2);
-
-
-                CSET(hue);
-                CSET(saturation);
-                return 1;
-}
-
-
-uint8_t ADMVideoHue::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc=NULL;
-  
-
-  if(frame>=_info.nb_frames) return 0;
-  
-  mysrc=vidCache->getImage(frame);
-  if(!mysrc) return 0;
-  memcpy(YPLANE(data),YPLANE(mysrc),_info.width*_info.height);
-  HueProcess_C(VPLANE(data), UPLANE(data),
-        VPLANE(mysrc), UPLANE(mysrc),
-        _info.width>>1,_info.width>>1,
-        _info.width>>1,_info.height>>1, 
-        _hue, _saturation);
- 
-  vidCache->unlockAll();
-  
-  
-  return 1;
-}
-
-  
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.h	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.h	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,11 +0,0 @@
-/*
-
-*/
-
-typedef struct Hue_Param
-{
-  float     hue ;           /* -180 to 180 */
-  float     saturation;     /* -180 to 180 */
-}Hue_Param;
- void HueProcess_C(uint8_t *udst, uint8_t *vdst, uint8_t *usrc, uint8_t *vsrc, int dststride, int srcstride,
-		    int w, int h, float hue, float sat);

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,420 +0,0 @@
-/***************************************************************************
-                          ADM_vidSRT.cpp  -  description
-                             -------------------
-    begin                : Thu Dec 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-#include <math.h>
-#include <iconv.h>
-
-
-#ifdef USE_FREETYPE
-
-#include "fourcc.h"
-#include "avio.hxx"
-
-#include "avi_vars.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-
-
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-
-#include "ADM_video/ADM_vidFont.h"
-#include "ADM_video/ADM_vidSRT.h"
-
-#include <ADM_assert.h>
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-#include "ADM_filter/video_filters.h"
-
-#include <prefs.h>
-
-static FILTER_PARAM subParam={15,{"_fontsize","_subname","_fontname","_charset",
-				"_baseLine","_Y_percent","_U_percent","_V_percent",
-				"_selfAdjustable","_delay","_useBackgroundColor","_bg_Y_percent",
-      				"_bg_U_percent","_bg_V_percent","_blend"}};
-
-SCRIPT_CREATE(subtitle_script,ADMVideoSubtitle,subParam);
-
-BUILD_CREATE(subtitle_create,ADMVideoSubtitle);
-
-//__________________________________________________________________
-
-//_______________________________________________________________
-
-//__________________________________________________________________
-
-char 								*ADMVideoSubtitle::printConf(void)
- {
-	  	static char buf[50];
- 	
- 				sprintf((char *)buf,"Subtitle ");
-        return buf;
-	}
-
-//--------------------------------------------------------	
-ADMVideoSubtitle::ADMVideoSubtitle(AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-  uint32_t frame;
-//  char c;
-
-  _uncompressed=NULL;
-  _font=NULL;
-
-
-  _in=in;
-  memcpy(&_info,_in->getInfo(),sizeof(_info));
-
-	frame=3*_in->getInfo()->width*_in->getInfo()->height;
-
-	_subs=NULL;
-	_fd=NULL;
- 	_line=0;
-	_oldframe=0;
-	_oldline=0;
-	_font = new ADMfont();	
-	if(couples)
-	{
-                int32_t b;
-			SUBCONF *_param;
-			_conf=NEW( SUBCONF);
-
-
-			_param=_conf; // keep macro happy
-
-			GET(_fontsize);
-			GET(_subname);
-			GET(_fontname);
-			GET(_charset);
-			GET(_baseLine);
-			GET(_Y_percent);
-			GET(_U_percent);
-			GET(_V_percent);
-			GET(_selfAdjustable);
-			GET(_delay);
-			GET(_useBackgroundColor);
-			GET(_bg_Y_percent);
-      			GET(_bg_U_percent);
-      			GET(_bg_V_percent);
-//                        GET(_blend);
-                        couples->getCouple("_blend",&b);
-                        _param->_blend=(BlendMode)b;
-			if(_conf->_baseLine>_info.height-_conf->_fontsize*SRT_MAX_LINE)
-                        {
-                                printf("Base exceeded : base :%lu height :%lu bottom:%lu\n",
-                                        _conf->_baseLine,_info.height,_info.height-_conf->_fontsize*SRT_MAX_LINE);
-                                _conf->_baseLine=_conf->_fontsize*SRT_MAX_LINE;
-                        }
-
-                    char *ft,*sub;
-                        ft=(char *)ADM_alloc(500);
-                        sub=(char *)ADM_alloc(500);
-                        strcpy(ft,(char *)_conf->_subname); 
-                        _conf->_subname=(ADM_filename *)ft;
-                        strcpy(sub,(char *)_conf->_fontname); 
-                        _conf->_fontname=(ADM_filename *)sub;
-
-                        sub=(char *)ADM_alloc(500);
-                        strcpy(sub,_conf->_charset);
-                        _conf->_charset=sub;
-                        loadSubtitle();
-                        loadFont();
-
-	}
-	else
-	{
-			_conf=NEW( SUBCONF);
-
-			_conf->_fontname=(ADM_filename *)ADM_alloc(500);
-			_conf->_subname=(ADM_filename *)ADM_alloc(500);
-			_conf->_charset=(char *)ADM_alloc(500);
-			_conf->_fontname[0]=0;
-			_conf->_subname[0]=0;
-			_conf->_charset[0]=0;
-			
-			
-			_conf->_baseLine=_info.height-24*SRT_MAX_LINE;
-			_conf->_Y_percent=255;
-			_conf->_U_percent=0;
-			_conf->_V_percent=0;
-                        _conf->_fontsize=24; 
-			_conf->_selfAdjustable=0;
-			_conf->_delay=0;
-			_conf->_useBackgroundColor=0;
-			
-			_conf->_bg_Y_percent=0;
-			_conf->_bg_U_percent=0;
-			_conf->_bg_V_percent=0;
-                        _conf->_blend=BLEND_SOLID;
-
-			prefs->get(FILTERS_SUBTITLE_FONTSIZE,&(_conf->_fontsize));
-			prefs->get(FILTERS_SUBTITLE_YPERCENT,&(_conf->_Y_percent));
-			prefs->get(FILTERS_SUBTITLE_UPERCENT,&(_conf->_U_percent));
-			prefs->get(FILTERS_SUBTITLE_VPERCENT,&(_conf->_V_percent));
-			prefs->get(FILTERS_SUBTITLE_SELFADJUSTABLE,&(_conf->_selfAdjustable));			
-			prefs->get(FILTERS_SUBTITLE_USEBACKGROUNDCOLOR,&(_conf->_useBackgroundColor));
-			
-			// _conf->_fontname, ... are used as memory for a dialog
-			// later. we can't used the length of the current string
-			{ char *tmp;
-			   prefs->get(FILTERS_SUBTITLE_FONTNAME,&tmp);
-			   strcpy((char *)_conf->_fontname,tmp);
-			   ADM_dealloc(tmp);
-			   
-			   prefs->get(FILTERS_SUBTITLE_CHARSET,&tmp);
-			   strcpy(_conf->_charset,tmp); 
-                           ADM_dealloc(tmp);
-			}
-			
-	}
-
-  
-  	_info.encoding=1;
-
-
-	_bitmap=0xffffffff;
-#define BITMAP_SIZE _info.width*_conf->_fontsize*SRT_MAX_LINE
-	_bitmapBuffer=new uint8_t[_info.width*_info.height];
-	_maskBuffer=new uint8_t[_info.width*_info.height];
-  _bgBitmapBuffer=new uint8_t[(_info.width*_info.height)>>1];
-	_bgMaskBuffer=new uint8_t[_info.width*_info.height];
-        _dirty=new uint8_t[_info.height];
-	ADM_assert(_bitmapBuffer);
-	ADM_assert(_maskBuffer);
-	ADM_assert(_bgBitmapBuffer);
-	ADM_assert(_bgMaskBuffer);
-        ADM_assert(_dirty);
-}
-uint8_t	ADMVideoSubtitle::loadSubtitle( void )
-{
-unsigned char c,d;
-			_fd=fopen((char *)_conf->_subname,"rt");
-			if(!_fd)
-			{
-                          GUI_Error_HIG(_("Could not open subtitle file"), NULL);
-				return 0;
-			}
-			// Try to detect utf16 files			
-			c=fgetc(_fd);
-			// Skip utf identifier if any
-			if( (c&0xef)==0xef)
-			{
-                          int count=4;
-                                while(count-- && c&0x80) c=fgetc(_fd);
-			}
-			switch(c)
-			{
-			case '{' :
-						loadSubTitle();
-						break;
-			case '1' :
-						loadSRT();
-						break;
-			default:
-                          GUI_Error_HIG(_("Cannot identify subtitle format"), NULL);
-			}
-
-  // Apply delay to subtitles
-  
-  aprintf("[debug] DELAY %d\n", _conf->_delay);
-  if(_conf->_delay)
-  {
-  	int32_t newStartTime;
-	int32_t newEndTime;
-	for(uint32_t i=0;i<_line;i++) 
-	{
-		aprintf("[debug] BEFORE DELAY (%d) %d %d\n",i, _subs[i].startTime,_subs[i].endTime);
-		newStartTime=_subs[i].startTime;
-		newStartTime+=_conf->_delay;
-		_subs[i].startTime=(newStartTime);
-		newEndTime=_subs[i].endTime;
-		newEndTime+=_conf->_delay;
-		_subs[i].endTime=(newEndTime);
-		// put them at infinit display time
-		// should get rid of them
-		if(newEndTime<0 || newStartTime<0)
-		{
-			_subs[i].startTime=_subs[i].endTime=0;
-		}
-		aprintf("[debug] AFTER DELAY (%d) %d %d\n",i, _subs[i].startTime,_subs[i].endTime);
-  	}
-  }
-
-
-	fclose(_fd);
-	_fd=NULL;
-	_bitmap=0xffffffff;
-	if(_line)	// that way we will have the first sub
-		_oldline=_line-1;
-	return 1;
-}
-uint8_t	ADMVideoSubtitle::getCoupledConf( CONFcouple **couples)
-{
-SUBCONF *_param;
-
-			_param=_conf; // keep macro happy
-			ADM_assert(_param);
-			*couples=new CONFcouple(15);
-
-			CSET(_fontsize);
-			CSET(_subname);
-			CSET(_fontname);
-			CSET(_charset);
-			CSET(_baseLine);
-			CSET(_Y_percent);
-			CSET(_U_percent);
-			CSET(_V_percent);
-			CSET(_selfAdjustable);
-			CSET(_delay);
-			CSET(_useBackgroundColor);
-			CSET(_bg_Y_percent);
-			CSET(_bg_U_percent);
-			CSET(_bg_V_percent);
-                        (*couples)->setCouple("_blend",(uint32_t)_param->_blend);
-
-		return 1;
-
-}
-//__________________________________________________________________
-
-ADMVideoSubtitle::~ADMVideoSubtitle()
-{
-
-		if(_bitmapBuffer)
-			{
-				delete [] _bitmapBuffer;
-				_bitmapBuffer=0;
-			}
-		if(_maskBuffer)
-			{
-				delete [] _maskBuffer;
-				_maskBuffer=0;
-			}
-
- 		if(_bgBitmapBuffer) 
-			{
-				delete [] _bgBitmapBuffer;
-				_bgBitmapBuffer=0;
-			}
- 
-		if(_bgMaskBuffer) 
-			{
-				delete [] _bgMaskBuffer;
-				_bgMaskBuffer=0;
-			}
-                if(_dirty)
-                {
-                                delete [] _dirty;
-                                _dirty=0;
-                }
-
-		if(_fd)
-		{
-				fclose(_fd);
-				_fd=NULL;
-		}
-		if(_subs)
-		{
-				for(uint32_t i=0;i<_line;i++)
-				{
-					if(_subs[i].nbLine)
-					{
-					for(uint32_t k=0;k<_subs[i].nbLine;k++)
-					{					
-						if(_subs[i].string[k])
-						{
-							delete [] _subs[i].string[k];
-							_subs[i].string[k]=NULL;
-						}
-					}					
-					
-					delete _subs[i].string;
-					_subs[i].string=NULL;
-					delete _subs[i].lineSize;
-					_subs[i].lineSize=NULL;
-					}
-				}
-				delete [] _subs;
-				_subs=NULL;
-		}
-	if(_conf)
-	{
-			ADM_dealloc(_conf->_subname);
-			ADM_dealloc(_conf->_fontname);
-			ADM_dealloc(_conf->_charset);
-
-		 	DELETE(_conf);
-	}
-	if(_font)
-	{
-		delete _font;
-		_font=NULL;
-	}
-}
-
-uint8_t DIA_srt(AVDMGenericVideoStream *source, SUBCONF *param);
-    
-uint8_t ADMVideoSubtitle::configure(AVDMGenericVideoStream *instream)
-{
-  
-  UNUSED_ARG(instream);
-//char c;
-uint8_t ret=0;
-int charset=0;
-uint32_t l,f;
-
-                        
-          if(DIA_srt(	instream,_conf))
-          {
-            printf("\n Font : %s", _conf->_fontname);
-            printf("\n Sub  : %s", _conf->_subname);
-            printf("\n Font size : %ld",_conf->_fontsize);
-            printf("\n Charset : %d",charset);
-            printf("\n Y : %ld",_conf->_Y_percent);
-            printf("\n U : %ld",_conf->_U_percent);
-            printf("\n V : %ld",_conf->_V_percent);
-
-
-            loadSubtitle();
-            loadFont();
-                        
-            prefs->set(FILTERS_SUBTITLE_FONTNAME,
-                    (ADM_filename *)_conf->_fontname);
-            prefs->set(FILTERS_SUBTITLE_CHARSET,
-                    _conf->_charset);
-            prefs->set(FILTERS_SUBTITLE_FONTSIZE,_conf->_fontsize);
-            prefs->set(FILTERS_SUBTITLE_YPERCENT,_conf->_Y_percent);
-            prefs->set(FILTERS_SUBTITLE_UPERCENT,_conf->_U_percent);
-            prefs->set(FILTERS_SUBTITLE_VPERCENT,_conf->_V_percent);
-            prefs->set(FILTERS_SUBTITLE_SELFADJUSTABLE,
-                        _conf->_selfAdjustable);
-            prefs->set(FILTERS_SUBTITLE_USEBACKGROUNDCOLOR,
-                        _conf->_useBackgroundColor);
-            ret=1;
-        }
-        return ret;
-
-}
-#endif
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.h	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.h	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,128 +0,0 @@
-/***************************************************************************
-                          ADM_vidSRT.h  -  description
-                             -------------------
-    begin                : Thu Dec 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
-    
-    Lots of bugfixes / enhancement by Daniel Lima
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifdef USE_FREETYPE
-
-#define SRT_MAX_LINE 3
-#define SRT_MAX_LINE_LENGTH 512
-
-#define ADM_GLYPH_T uint16_t 
-// UTF16 -> Ascii
-
-#define ADM_ASC(x) x
-
-typedef struct subLine
-{
-  
-	uint32_t 		startTime;
-	uint32_t 		endTime;
-	uint32_t		nbLine;
-	uint32_t		*lineSize;
-	ADM_GLYPH_T		**string;
-	
-}subLine;
-
-typedef enum 
-{
-        BLEND_SOLID=1,
-        BLEND_DOTTED,
-        BLEND_DIMMER
-}BlendMode;
-
-typedef struct SUBCONF
-{
-		uint32_t _fontsize;
-		uint32_t _baseLine;
-
-  /** YUV font color components */
-		int32_t    _Y_percent;
-		int32_t    _U_percent;
-		int32_t    _V_percent;
-		ADM_filename	*_fontname;
-		ADM_filename	*_subname;
-		char 		*_charset;
-		uint32_t	_selfAdjustable;   /** Automatic line breaks */
-		int32_t		_delay;            
-		/** Wait x miliseconds before show subtitles. If negative, it will to show subtitles x */
-		/* miliseconds before. */
-
-
-		uint32_t	_useBackgroundColor;
-
-  /** YUV background color components */
-		int32_t   _bg_Y_percent;
-		int32_t   _bg_U_percent;
-		int32_t   _bg_V_percent;
-                BlendMode _blend;
-
-
-	}SUBCONF;
-
-  class  ADMVideoSubtitle:public AVDMGenericVideoStream
- {
-
- protected:
-
-	    	SUBCONF					*_conf;		
-       virtual char 					*printConf(void) ;
-        FILE						*_fd;
-        uint8_t						loadSubTitle( void );
-	uint8_t  					loadSRT( void )        ;
-        uint32_t					_line;
-        subLine						*_subs;
-        uint32_t					_oldframe;
-        uint32_t					_oldline;
-        uint32_t					_bitmap;
-        uint32_t					search(uint32_t time);
-        void 						displayString(subLine *string);
-	void 						displayString_autoadj(char *string);
-        void 						displayChar(uint32_t w,uint32_t h,char c);
-  	uint32_t					displayLine(ADM_GLYPH_T *string,uint32_t line, uint32_t len);
-  
-	uint8_t 					lowPass(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h);
-	uint8_t 					decimate(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h);
-
-
-        uint8_t						*_bitmapBuffer;
-	uint8_t						*_maskBuffer;
-	uint8_t						*_bgBitmapBuffer;
-	uint8_t						*_bgMaskBuffer;
-        uint8_t                                         *_dirty;
-	uint8_t						blend(uint8_t *target,uint32_t baseLine);
-	ADMfont						*_font;
-	uint8_t						loadSubtitle(void);
-	uint8_t						loadFont(void);
-	uint8_t 					subParse( subLine *in, char *string );
-        uint8_t                                         doChroma(void);
-        uint8_t                                         clearBuffers(void);
-        void                                            doAutoSplit(subLine *string);
-        uint8_t                                         isDirty(int line);
-
- public:
- 		
-  						ADMVideoSubtitle(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~ADMVideoSubtitle();
-		      virtual uint8_t 		getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-       								ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t	getCoupledConf( CONFcouple **couples)		;
-			virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
-							
- }     ;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,798 +0,0 @@
-/***************************************************************************
-                          ADM_vidSRT.cpp  -  description
-                             -------------------
-    begin                : Thu Dec 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-#include <math.h>
-#include <iconv.h>
-
-
-#ifdef USE_FREETYPE
-
-#include "fourcc.h"
-#include "avio.hxx"
-
-#include "avi_vars.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-
-#include "ADM_video/ADM_vidFont.h"
-#include "ADM_video/ADM_vidSRT.h"
-#include <ADM_assert.h>
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-
-
-#define SUB_OUT 0xf0000000
-
-#define ALPHA
-
-#define LUMA_LEVEL 10
-
-#define SAFE_STRCPY(dest,destLen,src,srcLen) \
-memcpy(dest,src,srcLen<destLen?srcLen:destLen-1); \
-dest[srcLen<destLen?srcLen:destLen-1]='\0'; \
-
-
-//                     1
-//		Get in range in 121 + coeff matrix
-//                     1
-//
-// If the value is too far away we ignore it
-// else we blend
-//__________________________________________________________________
-uint8_t ADMVideoSubtitle::getFrameNumberNoAlloc(uint32_t frame,
-						uint32_t *len,
-   						ADMImage *data,
-   						uint32_t *flags)
-{
-
-double f;
-uint32_t time,srch;
-uint32_t absFrame=frame+_info.orgFrame;
-
-	//		printf("\n Stabilize : %lu\n",frame);
-          _uncompressed=data;
-	if(frame>=_info.nb_frames) 
-	{
-		printf("Filter : out of bound!\n");
-		return 0;
-	}
-	if(!_in->getFrameNumberNoAlloc(frame, len,data,flags)) return 0;
-
-	// if no subtitle return...
-	if(!_subs) return 1;
-
-	// compute time stamp
-	      f=absFrame*1000000./_info.fps1000;
-	      time=(uint32_t) floor(f);
-	      // Do we have it already ?
-
-	      if(time<=_subs[_oldline].endTime && time >=_subs[_oldline].startTime)
-	      {
-	      		aprintf("Sub: cached %lu %lu %lu\n",time,_subs[_oldline].startTime,_subs[_oldline].endTime);
-			blend(YPLANE(data),_conf->_baseLine); // re-use it
-			return 1;	
-
-	      }
-	      srch=search(time);
-	      // we got the right one
-     
-	      if(srch!=SUB_OUT) // we got something...
-			{
-					_oldline=srch;
-					aprintf("Sub: Using line %d\n",srch);
-					//printf("\n %s \n",_subs[_oldline].string);
-					displayString(&(_subs[_oldline]));
-					blend(YPLANE(data),_conf->_baseLine);
-			}
-
-		return 1;
-
-}
-//_________________________________________________________________
-uint32_t	ADMVideoSubtitle::search(uint32_t time)
-{
-	if(time<_subs[0].startTime)
-		return SUB_OUT;
-
-	  for(uint32_t i=0;i<_line;i++)
-	  {
-				if((time<=_subs[i].endTime)  &&
-					(time>=_subs[i].startTime)
-				)
-				return i;
-
-		}
-		return SUB_OUT;
-}
-//
-//	Display up to 3 lines of text centered on screen
-//  Each line is separated by a |
-// It is the basic version that tries to use only 2 lines
-// in most cases, 3 when needed
-//______________________________________
-void ADMVideoSubtitle::displayString(subLine *string)
-{
- 
-	uint32_t base=0;	
-	uint32_t nbLine=0;
-	uint32_t i=0;
-	uint32_t overflow=0;
-
-      aprintf("Sub: Rendering string %s\n",string);
-// bbase is the final position in line
-// in the image
-
-	clearBuffers();
-	nbLine=string->nbLine;
-	if(nbLine>SRT_MAX_LINE )
-	{
-		nbLine=SRT_MAX_LINE;
-		printf("Too much lines\n");
-	}
-	switch(nbLine)
-	{
-		case 0:
-			base=2*_conf->_fontsize;; // 1 or 2 lines we dont use the upper line		
-			break;
-		case 1:
-			base=_conf->_fontsize;; // 1 or 2 lines we dont use the upper line		
-			break;
-		default:
-                        base=0;
-                        break;
-	}	
-		
-	aprintf("Sub: %d lines to render\n",nbLine);
-	// scan and display each line
-	for(i=0;i<nbLine;i++)
-	{
-		
-			if(string->lineSize[i]!=displayLine(string->string[i],base,string->lineSize[i]))
-                                overflow=1;
-			base+=_conf->_fontsize;
-		
-	}
-        if(overflow && _conf->_selfAdjustable) 
-        {
-                printf("Do autosplit\n");
-                doAutoSplit(string);
-        }
-    	doChroma();
-	// Compute the dirty state
-        // If a line is not set as dirty, it means it has no pixel in it
-        // In fact we do top/bottom and add a tiny bit to it
-        memset(_dirty,1,_info.height);
-
-        // First to top
-
-        int top=0,bottom=_info.height-1,limit;
-        while(top<_info.height && !isDirty(top)) top++;
-        if(top>_conf->_fontsize>>1) top-=_conf->_fontsize>>1;
-        memset(&(_dirty[0]),0,top); // Clear top
-        
-        // Then bottom
-        limit=(SRT_MAX_LINE+1)*_conf->_fontsize;
-        if(limit>=_info.height) limit=_info.height-1;
-
-
-        bottom=limit;
-        while(bottom>top && !isDirty(bottom)) bottom--;
-        if(bottom+(_conf->_fontsize>>1)<limit) bottom+=_conf->_fontsize>>1;
-        ADM_assert(bottom<=limit);
-        memset(&(_dirty[bottom]),0,limit-bottom+1);
-        //printf("Top:%d bottom :%d limit:%d\n",top,bottom,limit);
-	
-}
-uint8_t ADMVideoSubtitle::isDirty(int line)
-{
-        uint8_t *base=_maskBuffer+_info.width*line;
-        for(int x=0;x<_info.width;x++)
-        {
-                if(base[x]) return 1;
-        }
-        return 0;
-}
-/*
-        We merge the whole lines into one then split it
-        to avoid truncated subs
-*/
-void ADMVideoSubtitle::doAutoSplit(subLine *string)
-{
-        uint32_t base=0;    
-        uint32_t nbLine=0;
-        uint32_t i=0;
-        int      total=0,start,end,pivot;
-
-        aprintf("Sub: Autospliting \n");
-        nbLine=string->nbLine;
-
-        // Merge all strings into one
-
-        for(int i=0;i<nbLine;i++) 
-                total+=1+string->lineSize[i];
-
-        ADM_GLYPH_T allwords[total];
-        int         offset[total];
-        int         sentence[total];
-        int         nbWords=0;
-        //
-        start=0;
-        for(int i=0;i<nbLine;i++) 
-        {
-                memcpy(&(allwords[start]),string->string[i],string->lineSize[i]*sizeof(ADM_GLYPH_T));
-                start+=string->lineSize[i];
-                allwords[start]=' ';
-                start++;
-        }
-        // Remove the last ' '
-        start--;
-        end=start;
-        // Here we go, we have now one line made of all merged sub
-        // We will put as much as possible into one displayed line
-        // then switch to the next one
-        //
-        printf("The new stuff is :<");
-        for(i=0;i<end;i++)
-                printf("%c",allwords[i]);
-        printf(">\n");
-        
-        // Split into words
-        pivot=0;
-        int car;
-        offset[0]=0;
-        nbWords=1;
-        while(pivot<end)
-        {
-                car=ADM_ASC(allwords[pivot]);
-                if(car==' ' || car=='.' || car ==',')
-                        {
-                                offset[nbWords++]=pivot;
-                        }
-                pivot++;
-        }
-        printf("Found %d words\n",nbWords); 
-        // Now  split
-        int nbSentence=0,len;
-        pivot=0;
-        sentence[0]=0;
-        // Try to display as much as possible in one line
-        // We build sentence here
-        while(pivot<nbWords)
-        {
-                for(i=pivot+1;i<nbWords;i++)
-                {
-                        len=offset[i]-offset[pivot];
-                        if(len!=displayLine(&(allwords[offset[pivot]]),0,len)) break;
-                }
-                sentence[nbSentence]=offset[pivot];
-                nbSentence++;
-                if(i>1 && i!=nbWords) i--;
-                pivot=i;
-        }
-        printf("0: %d,off:%d\n",sentence[0],offset[0]);
-        // Take the last word
-        sentence[nbSentence]=end;
-
-        if(nbSentence>SRT_MAX_LINE) nbSentence=SRT_MAX_LINE;
-        // now display
-        printf("Nb sentence:%d\n",nbSentence);
-        for(int j=0;j<nbSentence;j++)
-        {
-                printf("Sentence %d:",j);
-                for(int k=sentence[j];k<sentence[j+1];k++)
-                        printf("%c",allwords[k]);
-                printf("\n");
-        }
-        // now display
-        
-        switch(nbSentence)
-        {
-                case 0:
-                        base=2*_conf->_fontsize;; // 1 or 2 lines we dont use the upper line            
-                        break;
-                case 1:
-                        base=_conf->_fontsize;; // 1 or 2 lines we dont use the upper line              
-                        break;
-                default:
-                        base=0;
-                        break;
-        }
-        // scan and display each line
-        clearBuffers();
-        printf("Display\n");
-        for(i=0;i<nbSentence;i++)
-        {
-                        len=sentence[i+1]-sentence[i];
-                        displayLine(&(allwords[sentence[i]]),base,len);
-                        //displayLine(allwords,base,10);
-                        base+=_conf->_fontsize;
-        }
-        printf("/Display\n");
-        
-}
-/*
-        Once we have the subtitle built, we do the u& v planes
-        and some smoothing to avoid over sharpening on the chroma plane
-
-*/
-uint8_t ADMVideoSubtitle::doChroma(void)
-{
-// now blur bitmap into mask..
-        memset(_maskBuffer,0,SRT_MAX_LINE*_conf->_fontsize*_info.width);
-
-        uint32_t off;
-        uint8_t *src,*dst;
-
-        off=0;
-
-        src=_bitmapBuffer;
-        dst=_maskBuffer;
-
-
-        // We shrink it down for u & v by 2x2
-        // mask buffer->bitmap buffer
-
-        uint8_t tmp[_info.width*_info.height];
-
-        decimate(src,tmp,_info.width,_info.height);
-        lowPass(src,dst,_info.width,_info.height);
-        lowPass(tmp,src,_info.width>>1,_info.height>>1);
-
-        if (_conf->_useBackgroundColor) 
-        {
-                decimate(_bgMaskBuffer,_bgBitmapBuffer,_info.width,_info.height);
-                //lowPass(tmp,_bgBitmapBuffer,_info.width>>1,_info.height>>1);
-        }
-  
-}
-/*
-        Clear the buffers in case we do a new sub or
-                redo one in case it overflows
-*/
-uint8_t ADMVideoSubtitle::clearBuffers(void)
-{
-        memset(_bitmapBuffer,0,_info.height*_info.width);
-        memset(_maskBuffer,0,_info.height*_info.width);
-        memset(_bgBitmapBuffer,0,(_info.height*_info.width)>>1);
-        memset(_bgMaskBuffer,0,_info.height*_info.width);
-        return 1;
-}
-// Display a full line centered on screen. It returns the
-// number of displayed chars.
-//____________________________________________________________
-
-// It also returns the suggested len for this line string (just when display fail)
-//
-uint32_t ADMVideoSubtitle::displayLine(ADM_GLYPH_T *string,uint32_t line, uint32_t len)
-{
-  // n first chars in string that can "fit" in this line
- 
-
-	//uint32_t pixstart;
-	uint8_t *target;
-	int car;
-
-
-	aprintf("Sub DisplayString  line %lu len %lu\n",line,len);
-
-	if(!len)
-	{
-		printf("\n null string\n");
-      		return 0;
-	}
-
-
-  
-	uint32_t w=0,next;
-	int ww;
-
-	// we dummy do it one time to get the actual width of the string
-	// and hence perfectly center it
-	target=_maskBuffer+_info.width*line;
-	for(uint32_t i=0;i<len;i++)
-	{
-			if(ADM_ASC(*(string+i))==' ')
-			{
-					w+=_conf->_fontsize>>2;
-			}
-			else
-			{
-				ww=0;
-				car=string[i];
-				if(i) next=string[i-1];
-					else next=0;
-				// Change ' to "
-				//if(ADM_ASC(car)==0x27)
-				//	car=0x22;
-	        		if(!_font->fontDraw((char *)(target+1+w),car,next , _info.width,_conf->_fontsize,&ww))
-				{
-					printf("Font error\n");
-              return 0;
-				}
-				if((ww<0)||(ww>64))
-				{
-					printf("Warning w out of bound (%d)\n",ww);
-					ww=0;
-				}
-				if(w+ww>_info.width)
-				{
-					printf("Line too long!\n");
-					len=i;
-					goto _abt;
-					break;
-				}
-				w=w+ww;
-			}
-      
-	}
-_abt:
-	//Now we can render it at its final position
-	if(w<_info.width)
-	{
-		target=_bitmapBuffer+_info.width*line+((_info.width-w)>>1);
-	}
-	else
-	{
-		target=_bitmapBuffer+_info.width*line+1;
-	}
-
-  //printf("[debug] line %s\n",string);
-
-	ww=0;
-	w=0;
-	for(uint32_t i=0;i<len;i++)
-	{
-			if(*(string+i)==' ')
-			{
-					w+=_conf->_fontsize>>2;
-
-			}
-			else
-			{
-				ww=0;
-				car=string[i];
-				if(i) next=string[i-1];
-					else next=0;
-	        		if(!_font->fontDraw((char *)(target+1+w),car,next , _info.width,_conf->_fontsize,&ww))
-				{
-					printf("Font error\n");
-              return 0;
-				}
-				if((ww<0)||(ww>64))
-				{
-					printf("Warning w out of bound (%d)\n",ww);
-					ww=0;
-				}
-				w=w+ww;
-			}
-      
-	}
-
-  {
-    if (_conf->_useBackgroundColor) {
-      //Create background info
-      
-      int32_t delta=_info.width*line+((_info.width-w)>>1);
-      uint8_t *bitmapTarget=_bitmapBuffer+delta;
-      uint8_t *maskTarget=_maskBuffer+delta;
-      //uint8_t *bgBitmapTarget=_bgBitmapBuffer+delta;
-      uint8_t *bgMaskTarget=_bgMaskBuffer+delta;
-      
-      delta=3*_info.width;
-      bitmapTarget+=delta;
-      maskTarget+=delta;
-      //bgBitmapTarget+=delta;
-      bgMaskTarget+=delta;
-      
-      for (uint32_t i=0;i<_conf->_fontsize;i++) {
-	//memset(bgTarget,1,w);
-	for (uint32_t j=0;j<w;j++) {
-	  if (*(bitmapTarget+j)==0) {
-	    *(bgMaskTarget+j)=1;   //at this position, we will apply a different color
-	    //*(bgBitmapTarget+j)=1;
-	    *(maskTarget+j)=0;
-	    *(bitmapTarget+j)=0;
-	  }
-	}
-	bgMaskTarget+=_info.width;
-	//bgBitmapTarget+=_info.width;
-	maskTarget+=_info.width;
-	bitmapTarget+=_info.width;
-      }
-
-    }
-  }
-	
-
- 
-  return len;
-}
-//--------------------------------------------------------------------
-//
-//	Blend bitmap buffer into final screen
-//      We scan the SRT_MAX_LINE last line
-//--------------------------------------------------------------------
-uint8_t ADMVideoSubtitle::blend(uint8_t *target,uint32_t baseLine)
-{
-
-	uint8_t  *mask; //*oldtarget=target,*
-  uint8_t  *bgMask;
-	int8_t *chromatarget;
-	uint32_t hei,start;
-	uint32_t y;
-	uint32_t val;
-	int32_t ssigned;
-	double alpha,alpha2;
-#define SHADOW_UP 	8
-#define SHADOW_DOWN 	16
-
-	hei=(SRT_MAX_LINE+1)*_conf->_fontsize;
-	if(hei>=_info.height-1) hei=_info.height-1;
-	hei*=_info.width;  // max height of our subtitle
-	
-
-	aprintf("Sub:Rendering : %d %d %d (yuv)\n",_conf->_Y_percent,_conf->_U_percent,_conf->_V_percent);
-	
-	// keep a little margin for renderin
-	// to render f y or g
-	if((baseLine) > _conf->_fontsize)
-		baseLine-=_conf->_fontsize>>1;
-	
-		
-	//__________________________
-		
-		// Shadow ..
-		uint8_t *shadow=target;
-		uint32_t shadow_pos;
-		
-		shadow_pos=_conf->_fontsize/10;
-		start=_info.width*baseLine;  // base line in final image
-		// mask out left and right
-		mask=_maskBuffer; 
-				
- 		shadow+=start+(1+_info.width)*shadow_pos;
-  		for( y=hei;y>0;y--)
-		{
-     		 if(*mask) 
-		 {
-				if(*mask>LUMA_LEVEL)
-				{
-					val=*shadow;
-					val=(val*SHADOW_UP)/SHADOW_DOWN;
-					*shadow=(uint8_t )val;
-				}				
-     		 } 	  
-      
-		shadow++;
-		mask++;
-		}
-	
-	// /Shadow
-	//__________________________
-	start=_info.width*baseLine;  // base line in final image
-
-	chromatarget=(int8_t *)(target+(_info.width*_info.height));
-
-	// mask out left and right
-
-	mask=_maskBuffer;
-  	bgMask=_bgMaskBuffer;
- 	target+=start;
-        // clip 
-        if(hei+start>_info.width*_info.height)
-        {
-                hei=_info.width*_info.height-start;
-        }
-// Luma
-        int bottom=baseLine+(SRT_MAX_LINE+1)*_conf->_fontsize;
-        if(bottom>_info.height) bottom=_info.height;
-        for( y=baseLine;y<bottom;y++)
-        {
-            if(!_dirty[y-baseLine])
-            {
-                target+=_info.width;
-                mask+=_info.width;
-                bgMask+=_info.width;
-                 continue;
-            }
-            for(int x=0;x<_info.width;x++)
-            {
-                if(*mask) {
-                                if(*mask>LUMA_LEVEL || _conf->_useBackgroundColor)
-                                {
-                                        val=*mask*_conf->_Y_percent+128;
-                                        val>>=8;
-                                        *target=(uint8_t )val;
-                                }
-                                else 
-                                        { *target=0; }
-                        } else 
-                        if(*bgMask)
-                        {
-                                if(_conf->_useBackgroundColor) 
-                                {
-                                        *target=(uint8_t )_conf->_bg_Y_percent;
-                                }
-                        }
-                        else
-                                {
-                                        switch(_conf->_blend)
-                                        {
-                                                case BLEND_SOLID: break;
-                                                case BLEND_DIMMER: *target=(*target*3)>>2;break;
-                                                case BLEND_DOTTED: 
-                                                {
-                                                        int odd;
-                                                                odd= y%_info.width;
-                                                                odd=odd&1;
-                                                                odd+=(1&(y/_info.width));
-                                                                odd&=1;
-                                                                if(odd) *target=0; 
-                                                }
-                                        }
-                                }
-                        
-                target++;
-                mask++;
-                bgMask++;
-              }
-        }
-	
-
-// do u & v
-	int8_t *ctarget;
-
-	baseLine&=0xffffe;
-	start=(_info.width*baseLine)>>2;
-	hei>>=2;
-
-	mask=_bitmapBuffer;
-  	bgMask=_bgBitmapBuffer;
-	ctarget=chromatarget+start;
-	target=(uint8_t *)ctarget;
-
-	ssigned=_conf->_U_percent;
-	ssigned+=128;
-
-  uint8_t bg_val=(uint8_t) _conf->_bg_U_percent+128;
-
-//#define MAXVAL(x) {val=*mask*(x)+127;val>>=8;*ctarget=(uint8_t)(val&0xff);}
-
-#define BLEND_LEVEL 	3
-#define BLEND_PERCENT 	20
-
-#define MAXVAL(x)  *target=(uint8_t )ssigned
-#define DOIT if(*mask) \
-		{ \
-			alpha=*mask; \
-			if(alpha>BLEND_LEVEL) \
-				*target=(uint8_t)ssigned; \
-			else			\
-			{			\
-				alpha2=(100-BLEND_PERCENT)*(*target-128); \
-				alpha=BLEND_PERCENT*(ssigned-128); \
-				alpha=(alpha2+alpha)/100; \
-				*target=(uint8_t)(alpha+128) ;\
-			} \
-                } \
-             else if (_conf->_useBackgroundColor && *bgMask) {*target=(uint8_t)bg_val;}
-	     
-#define RENDER	     \
-	\
-	for( y=hei;y>0;y--) \
-	{ \
-		DOIT; \
-		ctarget++; \
-		target++; \
-		mask++; \
-	bgMask++; \
-	} \
-	
-	RENDER;
-
-	mask=_bitmapBuffer;
-  	bgMask=_bgBitmapBuffer;
-	ctarget=chromatarget+start+((_info.width*_info.height)>>2);;
-	target=(uint8_t *)ctarget;
-	ssigned=_conf->_V_percent;
-	ssigned+=128;
-
-  	bg_val=(uint8_t) _conf->_bg_V_percent+128;
-
-	RENDER;
-
-
-	return 1;
-}
-//
-//	Apply a low pass to alias it
-//					1
-// The softening is a 1 4 1  convolution filter
-//					1
-uint8_t ADMVideoSubtitle::lowPass(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h)
-{
-	uint8_t *prevline, *nextline,*curline,*target;
-	uint32_t val;
-
-	memcpy(dst,src,w*h);
-
-	src++;dst++;
-
-			for(uint32_t line=h-1;line>0;line--)
-			{
-				curline=src+line*w;
-				nextline=curline+w;
-				prevline=curline-w;
-				target=dst+line*w;
-				for(uint32_t col=w-1;col>1;col--)
-				{
-#define LEVEL 8*90
-					// 1 4 1
-					val= (*(curline)*4+*prevline+*nextline+*(curline-1)+*(curline+1));
-					if(val> 0 )
-					if(val<LEVEL)
-						val=1;  // just enough to trigger masking
-					else
-						val>>=3;
-					*target=val;
-					target++;
-					curline++;
-					prevline++;
-					nextline++;
-				}
-
-			}
-	return 1;
-}
-//
-//	Decimate 2x2 (luma->chroma)
-//					1
-//					1
-uint8_t ADMVideoSubtitle::decimate(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h)
-{
-	uint8_t	*curline, *nextline;
-	uint8_t *target=dst;
-
-			for(uint32_t line=0;line<h>>1;line++)
-			{
-				curline=src+line*w*2;
-				nextline=curline+w;
-				target=dst+line*(w>>1);
-				for(uint32_t col=0;col<w>>1;col++)
-				{
-					// 1 4 1
-					*target= (*(curline)+*(curline+1)+*nextline+*(nextline+1))>>2;
-					target++;
-					curline+=2;
-					nextline+=2;
-				}
-
-			}
-	return 1;
-}
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -1,497 +0,0 @@
-/***************************************************************************
-                          ADM_vidload.cpp  -  description
-                             -------------------
-
-	Load the subtitles either in srt or sub format
-
-	The structure is
-		uint32_t 		startTime in ms from beginning
-		uint32_t 		endTime  in ms from beginning
-	
-	All text are stored as utf16 after loading
-
-
-    begin                : Thu Aug 09 2003
-    copyright            : (C) 2003 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-#include <math.h>
-#include <iconv.h>
-#include <errno.h>
-
-
-#ifdef USE_FREETYPE
-//#define __STDC_ISO_10646__
-#include "fourcc.h"
-#include "avio.hxx"
-
-#include "avi_vars.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-
-#include "ADM_video/ADM_vidFont.h"
-#include "ADM_video/ADM_vidSRT.h"
-#include <ADM_assert.h>
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-
-#define ADM_RAW 1024
-
-static iconv_t myConv=(iconv_t)-1;;
-static int ADM_SubAtoi(uint16_t *in);
-
-static uint8_t	ADM_utfInit( char *charset );
-static uint8_t ADM_utfConv(ADM_GLYPH_T *out, char *in,uint32_t nbIn, uint32_t *nbOut);
-static uint8_t ADM_utfEnd( void);
-
-
-
-
-uint8_t	ADMVideoSubtitle::loadFont (void)
-{
- 
-  if (!_font->initFreeType ((char *)_conf->_fontname))
-    {
-      printf ("\n Free type init failed for font %s!", _conf->_fontname);
-    }
-  else
-    {
-      _font->fontSetSize (_conf->_fontsize);
-    }
-   
-  return 1;
-}
-
-//
-//      Load subtitles in .sub format i.e. {xx}{yy} |   |
-//
-// {3610}{3656}Pripraven?uv?a ich|v naom dome s primeranou ctou.
-//__________________________________________________________________
-uint8_t  ADMVideoSubtitle::loadSubTitle (void)
-{
-
-  char string[500];
-  uint32_t current_line = 0;
-  // first cound how many line
-  _line = 0;
-   // init iconv...  
-  if(! ADM_utfInit(_conf->_charset))
-  {
-  	printf("Problem initializing iconv, aborting\n");
-	return 0;
-  
-  }
-  while (fgets (string, 200, _fd))
-    {
-      _line++;
-    }
-  printf ("\n subs : %ld lines\n", _line);
-  // rewind
-  fseek (_fd, 0, SEEK_SET);
-  //
-  _subs = new subLine[_line];
-  if (!_subs)
-    return 0;
-  memset (_subs, 0, sizeof (subLine) * _line);
-
-
- 
-//	
-  for (uint32_t i = 0; i < _line; i++)
-    {
-      fgets (string, ADM_RAW, _fd);
-      //printf("\n in : %s ",string);
-      if (string[0] != '{')
-	continue;
-      subParse ((subLine *) & (_subs[current_line]), string);
-      current_line++;
-    }
-	
-  // the effective number of line we have
-  _line = current_line;
-  return 1;
-  
- ADM_utfEnd( );
-}
-
-//___________________________________________________________________
-//      In case of sub file, take one line and convert it to unicode
-//	we also extract the start/end and split it to N lines
-//	Does not work if input is UTF16. UTF8 is ok.
-//___________________________________________________________________
-uint8_t	ADMVideoSubtitle::subParse (subLine * in, char *string)
-{
-
-
-  static ADM_GLYPH_T 	final[ADM_RAW];	// convert to unicode
-  uint32_t   	startindex, endindex,textindex;
-  uint32_t 	j;
-  float 	f;
- 
-  uint32_t 	finallen=0;
-  uint32_t	alpha;
- 
-  j = 1;
-  
-  
-  ADM_utfConv(final,string,strlen(string),&finallen);
-  
-  // ignore { }
-  while (ADM_ASC(final[j]) != '}' && j < finallen)
-    j++;
- 
-  startindex =1;
-  j += 2;			// skip }{
-  endindex =j;
-  while (ADM_ASC(final[j]) != '}' && j < finallen)
-    j++;
-  // The text starts here
-  textindex = j + 1;
-
-  if (j >= finallen - 1)
-    {
-      printf ("***ERR: Suspicious line !!!\n");
-      return 0;
-
-    }
-
-  // convert frame -> time in ms
-  // skip utf marker if present
-  alpha= ADM_SubAtoi (&final[1]);
-  f=(float)alpha;
-  aprintf("%s start:%d",string,alpha);
-  f = f * 1000000. / _info.fps1000;
-  in->startTime = (uint32_t) floor (f);
-
-  alpha = ADM_SubAtoi (&final[endindex]);
-  f=(float)alpha;
-  aprintf(" end:%d\n",alpha);
-  f = f * 1000000. / _info.fps1000;
-  
-  in->endTime = (uint32_t) floor (f);
-
-  uint32_t lllines=0;
-  finallen-=textindex;
-  if(finallen==0)
-  	{
-		printf("Empty line\n");
-		in->nbLine=0;
-		return 1;
-	}
-  // Count the number of | found
-  for(j=0;j<finallen;j++)
-  {
-  	if(ADM_ASC(final[j+textindex])=='|') lllines++;
-  }
-
-  aprintf("%lu -->%lu\n",in->startTime,in->endTime);
-  in->nbLine=lllines+1;
-  in->string=new ADM_GLYPH_T *[in->nbLine];
-  in->lineSize=new uint32_t[in->nbLine];
-  
-  for(uint32_t i=0;i<in->nbLine;i++)
-  {
-  	in->string[i]=new ADM_GLYPH_T[finallen]; 	// yes, we overshot
-	in->lineSize[i]=0;
-  }
-  
-  uint32_t curline=0, curindex=0;
-  for(uint32_t i=0;i<finallen;i++)
-  {
-  	if(ADM_ASC(final[i+textindex])=='|')
-	{
-		in->lineSize[curline]=curindex;
-		curindex=0;
-		curline++;		
-	}
-	else
-	{
-		in->string[curline][curindex++]=final[i+textindex];
-	}
-  
-  }  
-  if(curindex)
-  	in->lineSize[curline]=curindex;
-  return 1;
-}
-
-//
-//      Load subtitles in .srt format i.e. {xx}{yy} |   |
-//__________________________________________________________________
-uint8_t
-ADMVideoSubtitle::loadSRT (void)
-{
-
-
-  static ADM_GLYPH_T 	final[ADM_RAW];	// convert to unicode
-  ADM_GLYPH_T  		temp[SRT_MAX_LINE][ADM_RAW];
-  uint32_t		tempSize[SRT_MAX_LINE];
-  char			string[ADM_RAW];
-  
-  
-  uint32_t line;  
-  uint32_t len;
-  // Init iconv
-   uint32_t 	finallen=0;
-  subLine	*current;
-  
-  if(! ADM_utfInit(_conf->_charset))
-  {
-  	printf("Problem initializing iconv, aborting\n");
-	return 0;
-  
-  } 
-  
-  // first cound how many line
-  line = 0;
-  _line = 0;
-  while (fgets (string, 300, _fd))
-    line++;
-  printf ("\n subs : %ld lines\n", line);
-  // rewind
-  fseek (_fd, 0, SEEK_SET);
-  //
-  _subs = new subLine[line];
-
-  if (!_subs)
-    return 0;
-  
-  memset (_subs, 0, sizeof (subLine) * line);
-  
-  // read and allocate
-  
-  uint32_t j;
-  int state = 0;
-  int stored=0;
-  
-  for (uint32_t i = 0; i < line; i++)
-    {
-	current=&_subs[_line];
-	fgets (string, ADM_RAW, _fd);
-	ADM_utfConv(final,string,strlen(string),&finallen);
-	// Purge cr/lf	
-	switch (state)
-	{
-	case 0:		// waiting for number	 
-                  if(!_line && (final[0]&0xfefe)==0xfefe)
-                  {
-                      j=ADM_SubAtoi (final+1);
-                  }
-                  else
-		      j = ADM_SubAtoi (final);
-		if (j == _line + 1)
-		{
-			stored=0;
-			state = 1;
-		}
-		break;
-	case 1:		// waiting for time
-		{
-			uint32_t sh, sm, ss, ms;
-			uint32_t dh, dm, ds, md;
-
-			ADM_GLYPH_T *cur=&final[0];
-				
-	  		sh=ADM_SubAtoi(cur);
-			cur+=3;
-			sm=ADM_SubAtoi(cur);
-			cur+=3;
-			ss=ADM_SubAtoi(cur);
-			cur+=3;
-			ms=ADM_SubAtoi(cur);
-			cur+=3;
-			
-			cur+=5;
-			
-			dh=ADM_SubAtoi(cur);
-			cur+=3;
-			dm=ADM_SubAtoi(cur);
-			cur+=3;
-			ds=ADM_SubAtoi(cur);
-			cur+=3;
-			md=ADM_SubAtoi(cur);
-			
-			_subs[_line].startTime = ms + 1000 * (ss + sm * 60 + sh * 3600);
-			_subs[_line].endTime = md + 1000 * (ds + dm * 60 + dh * 3600);
-			state = 2;
-			
-			aprintf("%d %d %d %d / %d %d %d %d>%s<\n",sh,sm,ss,ms,dh,dm,ds,md,string);
-			
-		}
-
-		break;
-	case 2:		
-	   // looking for text
-	   // We append each line to text with a | to separate the lines	 	  
-	  {
-	  	if (finallen < 2)
-	    	{
-	   		// Finished
-	      		_line++;
-	      		state = 0;
-			current->nbLine=stored;
-			current->lineSize=new uint32_t[stored];
-			current->string=new ADM_GLYPH_T *[stored];
-			for(uint32_t i=0;i<stored;i++)
-			{
-				current->lineSize[i]=tempSize[i];
-				current->string[i]=new ADM_GLYPH_T[tempSize[i]];
-				memcpy(current->string[i],temp[i],sizeof(ADM_GLYPH_T)*tempSize[i]);
-			}
-	      		break;
-	    	}
-	  	else
-	    	{
-			if(stored>=SRT_MAX_LINE)
-			{
-				printf("sub:Too much lines, ignoring..\n");
-				continue;
-			}
-	      		// We add it
-			memcpy(temp[stored],final,finallen*sizeof(ADM_GLYPH_T));
-			tempSize[stored]=finallen;
-			stored++;
-	    	}
-	  }
-	  break;
-
-	}
-
-    }
-  ADM_utfEnd( );
-  aprintf(">> Sub: %d subs stored and loaded\n",_line); 	
-  return 1;
-  
-}
-// Sort of atoi for utf16
-// Very basic
-int ADM_SubAtoi(uint16_t *in)
-{
-	int result=0;
-	int d;
-	do
-	{
-		d=ADM_ASC(*in);		
-		in++;
-		if(d>='0' && d<='9')
-		{
-			result*=10;
-			result+=d-'0';
-		}
-		else
-			return result;
-	}while(1);
-	
-
-}
-//	Init iconv, so that we can go utf16
-//
-uint8_t	ADM_utfInit( char *charset )
-{
-	myConv=iconv_open("UTF-16",charset); //"WINDOWS-1251");
-	if((long int)myConv==-1)
-	{
-		printf("\n Error initializing iconv...\n");
-		return  0;
-	}
-	return 1;
-}
-//
-//	Convert the incoming string to utf16
-//	While doing it, remove the utf16 makers from input/output
-//	(fffe)
-//
-uint8_t ADM_utfConv(ADM_GLYPH_T *out, char *in,uint32_t nbIn, uint32_t *nbOut)
-{
-size_t sin,sout,sz;
-char *cout,*cin;
-uint32_t done=0;
-
-	memset(out,0,ADM_RAW*sizeof(ADM_GLYPH_T));
-	sin=strlen(in);
-	sout=ADM_RAW;
-	cin=in;
-	cout=(char *)(out);
-	
-	if((uint8_t)in[0]==0xff && (uint8_t)in[1]==0xfe)
-	{
-		 cin+=2;
-		 sin-=2;
-	}
-	if(!sin) 
-	{
-		*nbOut=0;
-		return 1;
-	}
-#ifdef  ICONV_NEED_CONST 
-  	sz=iconv(myConv,(const char **)&cin,&sin,&cout,&sout);
-#else
-	sz=iconv(myConv,&cin,&sin,&cout,&sout);
-#endif	
-	if(sz==-1)
-	{
-  		printf("Iconv error:%s\n:%s:\n",strerror(errno),in);
-		//out[0]=' ';
-  	}
-	// Get the amound of utf16...
-	done=(ADM_RAW-sout)>>1;
-// For win32 we swap le and be
-#ifdef ADM_WIN32
-       ADM_GLYPH_T glyph;
-       for(uint32_t w=0;w<done;w++)
-       {
-               glyph=out[w];
-               out[w]=((glyph&0xff)<<8)+(glyph>>8);
-       }
-#endif
-	
-	if(done)
-	{
-		if(0xfeff==out[0])
-		{
-			//aprintf("Removing utf tag\n");
-			done--;
-			memmove(&out[0],&out[1],done*sizeof(ADM_GLYPH_T));
-			
-		}
-	}
-
-	while(done &&( ADM_ASC(out[done-1])==0x0a || ADM_ASC(out[done-1]==0x0d))) done--;
-	*nbOut=done;
-	return 1;
-	
-}
-// Close iconv
-//
-
-uint8_t ADM_utfEnd( void)
-{
-  // Purge iconv
-  if((long int)myConv!=-1)
-	{
-		iconv_close(myConv);
-		myConv=(iconv_t)-1;
-	}
-}
-
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-13 13:47:25 UTC (rev 3501)
@@ -14,20 +14,16 @@
 ADM_vidVobsub.cpp
 ADM_vidAsharp.cpp       
 ADM_vidCrop.cpp       
-ADM_vidHue.cpp               
 ADM_vidVobSubRender.cpp
 ADM_interlaced.cpp       
 ADM_vidCached.cpp       
 ADM_vidDelta.cpp      
 ADM_vidMPdelogo.cpp      
-ADM_vidSRT.cpp        
 ADM_vobsubinfo.cpp
 ADM_vidEq2.cpp             
-ADM_vidSRTload.cpp
 ADM_vidClean.cpp        
 ADM_vidEqualizer.cpp  
 ADM_vidNull.cpp          
-ADM_vidSRTRender.cpp
 )
 ADD_LIBRARY(ADM_video STATIC ${ADM_video_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-13 13:47:25 UTC (rev 3501)
@@ -10,7 +10,6 @@
  ADM_vidCached.cpp \
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
- ADM_vidSRT.cpp \
  ADM_vidContrast.cpp \
  ADM_vidCrop.cpp \
  ADM_vidNull.cpp \
@@ -23,14 +22,11 @@
  ADM_interlaced.cpp \
 	ADM_interlaced.h \
  ADM_vidRaw.cpp \
-	ADM_vidSRTRender.cpp \
- ADM_vidSRTload.cpp \
  ADM_cache.cpp \
  ADM_vidEqualizer.cpp \
  ADM_vidVobsub.cpp \
  ADM_vobsubinfo.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidHue.cpp \
  ADM_vidEq2.cpp \
  ADM_vidAsharp.cpp \
  ADM_vidCNR2.cpp \
@@ -57,10 +53,10 @@
 ADM_vidEqualizer.cpp  \
 ADM_mpdetc.cpp ADM_vidEqualizer.h   \
 ADM_mpdetc.h  \
-ADM_resizebis.cpp   ADM_vidSRT.cpp \
-ADM_resizebis.hxx    ADM_vidSRT.h \
-ADM_resizeter.cpp  ADM_vidField.h  ADM_vidSRTRender.cpp \
-ADM_vidFieldUnblend.cpp ADM_vidSRTload.cpp \
+ADM_resizebis.cpp   \
+ADM_resizebis.hxx    \
+ADM_resizeter.cpp  ADM_vidField.h  \
+ADM_vidFieldUnblend.cpp \
 ADM_vidASharp_param.h  ADM_vidFieldUtil.cpp  \
 ADM_vidFieldUtil.h  \
 ADM_vidAnimated.cpp  \
@@ -70,8 +66,8 @@
 ADM_vidFont.cpp \
 ADM_vidFont.h \
 ADM_vidCNR2.cpp  \
-ADM_vidCNR2_param.h  ADM_vidHue.cpp  ADM_vidTDeint_param.h \
-ADM_vidCached.cpp  ADM_vidHue.h  ADM_vidTdeint.cpp \
+ADM_vidCNR2_param.h  ADM_vidTDeint_param.h \
+ADM_vidCached.cpp  ADM_vidTdeint.cpp \
 ADM_vidCached.h  ADM_vidIVTC.cpp \
 ADM_vidIVTC.h \
 ADM_vidChromaShift.cpp \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidHue.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidHue.h (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidHue.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.cpp	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -0,0 +1,419 @@
+/***************************************************************************
+                          ADM_vidSRT.cpp  -  description
+                             -------------------
+    begin                : Thu Dec 12 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <math.h>
+#include <math.h>
+#include <iconv.h>
+
+
+#ifdef USE_FREETYPE
+
+#include "default.h"
+#include "ADM_osSupport/ADM_misc.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+
+
+
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_video/ADM_vidFont.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
+
+#include <ADM_assert.h>
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_FILTER
+#include "ADM_osSupport/ADM_debug.h"
+#include "ADM_filter/video_filters.h"
+
+#include <prefs.h>
+
+static FILTER_PARAM subParam={15,{"_fontsize","_subname","_fontname","_charset",
+				"_baseLine","_Y_percent","_U_percent","_V_percent",
+				"_selfAdjustable","_delay","_useBackgroundColor","_bg_Y_percent",
+      				"_bg_U_percent","_bg_V_percent","_blend"}};
+
+SCRIPT_CREATE(subtitle_script,ADMVideoSubtitle,subParam);
+
+BUILD_CREATE(subtitle_create,ADMVideoSubtitle);
+
+//__________________________________________________________________
+
+//_______________________________________________________________
+
+//__________________________________________________________________
+
+char 								*ADMVideoSubtitle::printConf(void)
+ {
+	  	static char buf[50];
+ 	
+ 				sprintf((char *)buf,"Subtitle ");
+        return buf;
+	}
+
+//--------------------------------------------------------	
+ADMVideoSubtitle::ADMVideoSubtitle(AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+
+  uint32_t frame;
+//  char c;
+
+  _uncompressed=NULL;
+  _font=NULL;
+
+
+  _in=in;
+  memcpy(&_info,_in->getInfo(),sizeof(_info));
+
+	frame=3*_in->getInfo()->width*_in->getInfo()->height;
+
+	_subs=NULL;
+	_fd=NULL;
+ 	_line=0;
+	_oldframe=0;
+	_oldline=0;
+	_font = new ADMfont();	
+	if(couples)
+	{
+                int32_t b;
+			SUBCONF *_param;
+			_conf=NEW( SUBCONF);
+
+
+			_param=_conf; // keep macro happy
+
+			GET(_fontsize);
+			GET(_subname);
+			GET(_fontname);
+			GET(_charset);
+			GET(_baseLine);
+			GET(_Y_percent);
+			GET(_U_percent);
+			GET(_V_percent);
+			GET(_selfAdjustable);
+			GET(_delay);
+			GET(_useBackgroundColor);
+			GET(_bg_Y_percent);
+      			GET(_bg_U_percent);
+      			GET(_bg_V_percent);
+//                        GET(_blend);
+                        couples->getCouple("_blend",&b);
+                        _param->_blend=(BlendMode)b;
+			if(_conf->_baseLine>_info.height-_conf->_fontsize*SRT_MAX_LINE)
+                        {
+                                printf("Base exceeded : base :%lu height :%lu bottom:%lu\n",
+                                        _conf->_baseLine,_info.height,_info.height-_conf->_fontsize*SRT_MAX_LINE);
+                                _conf->_baseLine=_conf->_fontsize*SRT_MAX_LINE;
+                        }
+
+                    char *ft,*sub;
+                        ft=(char *)ADM_alloc(500);
+                        sub=(char *)ADM_alloc(500);
+                        strcpy(ft,(char *)_conf->_subname); 
+                        _conf->_subname=(ADM_filename *)ft;
+                        strcpy(sub,(char *)_conf->_fontname); 
+                        _conf->_fontname=(ADM_filename *)sub;
+
+                        sub=(char *)ADM_alloc(500);
+                        strcpy(sub,_conf->_charset);
+                        _conf->_charset=sub;
+                        loadSubtitle();
+                        loadFont();
+
+	}
+	else
+	{
+			_conf=NEW( SUBCONF);
+
+			_conf->_fontname=(ADM_filename *)ADM_alloc(500);
+			_conf->_subname=(ADM_filename *)ADM_alloc(500);
+			_conf->_charset=(char *)ADM_alloc(500);
+			_conf->_fontname[0]=0;
+			_conf->_subname[0]=0;
+			_conf->_charset[0]=0;
+			
+			
+			_conf->_baseLine=_info.height-24*SRT_MAX_LINE;
+			_conf->_Y_percent=255;
+			_conf->_U_percent=0;
+			_conf->_V_percent=0;
+                        _conf->_fontsize=24; 
+			_conf->_selfAdjustable=0;
+			_conf->_delay=0;
+			_conf->_useBackgroundColor=0;
+			
+			_conf->_bg_Y_percent=0;
+			_conf->_bg_U_percent=0;
+			_conf->_bg_V_percent=0;
+                        _conf->_blend=BLEND_SOLID;
+
+			prefs->get(FILTERS_SUBTITLE_FONTSIZE,&(_conf->_fontsize));
+			prefs->get(FILTERS_SUBTITLE_YPERCENT,&(_conf->_Y_percent));
+			prefs->get(FILTERS_SUBTITLE_UPERCENT,&(_conf->_U_percent));
+			prefs->get(FILTERS_SUBTITLE_VPERCENT,&(_conf->_V_percent));
+			prefs->get(FILTERS_SUBTITLE_SELFADJUSTABLE,&(_conf->_selfAdjustable));			
+			prefs->get(FILTERS_SUBTITLE_USEBACKGROUNDCOLOR,&(_conf->_useBackgroundColor));
+			
+			// _conf->_fontname, ... are used as memory for a dialog
+			// later. we can't used the length of the current string
+			{ char *tmp;
+			   prefs->get(FILTERS_SUBTITLE_FONTNAME,&tmp);
+			   strcpy((char *)_conf->_fontname,tmp);
+			   ADM_dealloc(tmp);
+			   
+			   prefs->get(FILTERS_SUBTITLE_CHARSET,&tmp);
+			   strcpy(_conf->_charset,tmp); 
+                           ADM_dealloc(tmp);
+			}
+			
+	}
+
+  
+  	_info.encoding=1;
+
+
+	_bitmap=0xffffffff;
+#define BITMAP_SIZE _info.width*_conf->_fontsize*SRT_MAX_LINE
+	_bitmapBuffer=new uint8_t[_info.width*_info.height];
+	_maskBuffer=new uint8_t[_info.width*_info.height];
+  _bgBitmapBuffer=new uint8_t[(_info.width*_info.height)>>1];
+	_bgMaskBuffer=new uint8_t[_info.width*_info.height];
+        _dirty=new uint8_t[_info.height];
+	ADM_assert(_bitmapBuffer);
+	ADM_assert(_maskBuffer);
+	ADM_assert(_bgBitmapBuffer);
+	ADM_assert(_bgMaskBuffer);
+        ADM_assert(_dirty);
+}
+uint8_t	ADMVideoSubtitle::loadSubtitle( void )
+{
+unsigned char c,d;
+			_fd=fopen((char *)_conf->_subname,"rt");
+			if(!_fd)
+			{
+                          GUI_Error_HIG(_("Could not open subtitle file"), NULL);
+				return 0;
+			}
+			// Try to detect utf16 files			
+			c=fgetc(_fd);
+			// Skip utf identifier if any
+			if( (c&0xef)==0xef)
+			{
+                          int count=4;
+                                while(count-- && c&0x80) c=fgetc(_fd);
+			}
+			switch(c)
+			{
+			case '{' :
+						loadSubTitle();
+						break;
+			case '1' :
+						loadSRT();
+						break;
+			default:
+                          GUI_Error_HIG(_("Cannot identify subtitle format"), NULL);
+			}
+
+  // Apply delay to subtitles
+  
+  aprintf("[debug] DELAY %d\n", _conf->_delay);
+  if(_conf->_delay)
+  {
+  	int32_t newStartTime;
+	int32_t newEndTime;
+	for(uint32_t i=0;i<_line;i++) 
+	{
+		aprintf("[debug] BEFORE DELAY (%d) %d %d\n",i, _subs[i].startTime,_subs[i].endTime);
+		newStartTime=_subs[i].startTime;
+		newStartTime+=_conf->_delay;
+		_subs[i].startTime=(newStartTime);
+		newEndTime=_subs[i].endTime;
+		newEndTime+=_conf->_delay;
+		_subs[i].endTime=(newEndTime);
+		// put them at infinit display time
+		// should get rid of them
+		if(newEndTime<0 || newStartTime<0)
+		{
+			_subs[i].startTime=_subs[i].endTime=0;
+		}
+		aprintf("[debug] AFTER DELAY (%d) %d %d\n",i, _subs[i].startTime,_subs[i].endTime);
+  	}
+  }
+
+
+	fclose(_fd);
+	_fd=NULL;
+	_bitmap=0xffffffff;
+	if(_line)	// that way we will have the first sub
+		_oldline=_line-1;
+	return 1;
+}
+uint8_t	ADMVideoSubtitle::getCoupledConf( CONFcouple **couples)
+{
+SUBCONF *_param;
+
+			_param=_conf; // keep macro happy
+			ADM_assert(_param);
+			*couples=new CONFcouple(15);
+
+			CSET(_fontsize);
+			CSET(_subname);
+			CSET(_fontname);
+			CSET(_charset);
+			CSET(_baseLine);
+			CSET(_Y_percent);
+			CSET(_U_percent);
+			CSET(_V_percent);
+			CSET(_selfAdjustable);
+			CSET(_delay);
+			CSET(_useBackgroundColor);
+			CSET(_bg_Y_percent);
+			CSET(_bg_U_percent);
+			CSET(_bg_V_percent);
+                        (*couples)->setCouple("_blend",(uint32_t)_param->_blend);
+
+		return 1;
+
+}
+//__________________________________________________________________
+
+ADMVideoSubtitle::~ADMVideoSubtitle()
+{
+
+		if(_bitmapBuffer)
+			{
+				delete [] _bitmapBuffer;
+				_bitmapBuffer=0;
+			}
+		if(_maskBuffer)
+			{
+				delete [] _maskBuffer;
+				_maskBuffer=0;
+			}
+
+ 		if(_bgBitmapBuffer) 
+			{
+				delete [] _bgBitmapBuffer;
+				_bgBitmapBuffer=0;
+			}
+ 
+		if(_bgMaskBuffer) 
+			{
+				delete [] _bgMaskBuffer;
+				_bgMaskBuffer=0;
+			}
+                if(_dirty)
+                {
+                                delete [] _dirty;
+                                _dirty=0;
+                }
+
+		if(_fd)
+		{
+				fclose(_fd);
+				_fd=NULL;
+		}
+		if(_subs)
+		{
+				for(uint32_t i=0;i<_line;i++)
+				{
+					if(_subs[i].nbLine)
+					{
+					for(uint32_t k=0;k<_subs[i].nbLine;k++)
+					{					
+						if(_subs[i].string[k])
+						{
+							delete [] _subs[i].string[k];
+							_subs[i].string[k]=NULL;
+						}
+					}					
+					
+					delete _subs[i].string;
+					_subs[i].string=NULL;
+					delete _subs[i].lineSize;
+					_subs[i].lineSize=NULL;
+					}
+				}
+				delete [] _subs;
+				_subs=NULL;
+		}
+	if(_conf)
+	{
+			ADM_dealloc(_conf->_subname);
+			ADM_dealloc(_conf->_fontname);
+			ADM_dealloc(_conf->_charset);
+
+		 	DELETE(_conf);
+	}
+	if(_font)
+	{
+		delete _font;
+		_font=NULL;
+	}
+}
+
+uint8_t DIA_srt(AVDMGenericVideoStream *source, SUBCONF *param);
+    
+uint8_t ADMVideoSubtitle::configure(AVDMGenericVideoStream *instream)
+{
+  
+  UNUSED_ARG(instream);
+//char c;
+uint8_t ret=0;
+int charset=0;
+uint32_t l,f;
+
+                        
+          if(DIA_srt(	instream,_conf))
+          {
+            printf("\n Font : %s", _conf->_fontname);
+            printf("\n Sub  : %s", _conf->_subname);
+            printf("\n Font size : %ld",_conf->_fontsize);
+            printf("\n Charset : %d",charset);
+            printf("\n Y : %ld",_conf->_Y_percent);
+            printf("\n U : %ld",_conf->_U_percent);
+            printf("\n V : %ld",_conf->_V_percent);
+
+
+            loadSubtitle();
+            loadFont();
+                        
+            prefs->set(FILTERS_SUBTITLE_FONTNAME,
+                    (ADM_filename *)_conf->_fontname);
+            prefs->set(FILTERS_SUBTITLE_CHARSET,
+                    _conf->_charset);
+            prefs->set(FILTERS_SUBTITLE_FONTSIZE,_conf->_fontsize);
+            prefs->set(FILTERS_SUBTITLE_YPERCENT,_conf->_Y_percent);
+            prefs->set(FILTERS_SUBTITLE_UPERCENT,_conf->_U_percent);
+            prefs->set(FILTERS_SUBTITLE_VPERCENT,_conf->_V_percent);
+            prefs->set(FILTERS_SUBTITLE_SELFADJUSTABLE,
+                        _conf->_selfAdjustable);
+            prefs->set(FILTERS_SUBTITLE_USEBACKGROUNDCOLOR,
+                        _conf->_useBackgroundColor);
+            ret=1;
+        }
+        return ret;
+
+}
+#endif
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.h (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRT.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTRender.cpp	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -0,0 +1,797 @@
+/***************************************************************************
+                          ADM_vidSRT.cpp  -  description
+                             -------------------
+    begin                : Thu Dec 12 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <math.h>
+#include <math.h>
+#include <iconv.h>
+
+
+#ifdef USE_FREETYPE
+
+#include "default.h"
+#include "ADM_osSupport/ADM_misc.h"
+
+
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_video/ADM_vidFont.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
+#include <ADM_assert.h>
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_FILTER
+#include "ADM_osSupport/ADM_debug.h"
+
+
+#define SUB_OUT 0xf0000000
+
+#define ALPHA
+
+#define LUMA_LEVEL 10
+
+#define SAFE_STRCPY(dest,destLen,src,srcLen) \
+memcpy(dest,src,srcLen<destLen?srcLen:destLen-1); \
+dest[srcLen<destLen?srcLen:destLen-1]='\0'; \
+
+
+//                     1
+//		Get in range in 121 + coeff matrix
+//                     1
+//
+// If the value is too far away we ignore it
+// else we blend
+//__________________________________________________________________
+uint8_t ADMVideoSubtitle::getFrameNumberNoAlloc(uint32_t frame,
+						uint32_t *len,
+   						ADMImage *data,
+   						uint32_t *flags)
+{
+
+double f;
+uint32_t time,srch;
+uint32_t absFrame=frame+_info.orgFrame;
+
+	//		printf("\n Stabilize : %lu\n",frame);
+          _uncompressed=data;
+	if(frame>=_info.nb_frames) 
+	{
+		printf("Filter : out of bound!\n");
+		return 0;
+	}
+	if(!_in->getFrameNumberNoAlloc(frame, len,data,flags)) return 0;
+
+	// if no subtitle return...
+	if(!_subs) return 1;
+
+	// compute time stamp
+	      f=absFrame*1000000./_info.fps1000;
+	      time=(uint32_t) floor(f);
+	      // Do we have it already ?
+
+	      if(time<=_subs[_oldline].endTime && time >=_subs[_oldline].startTime)
+	      {
+	      		aprintf("Sub: cached %lu %lu %lu\n",time,_subs[_oldline].startTime,_subs[_oldline].endTime);
+			blend(YPLANE(data),_conf->_baseLine); // re-use it
+			return 1;	
+
+	      }
+	      srch=search(time);
+	      // we got the right one
+     
+	      if(srch!=SUB_OUT) // we got something...
+			{
+					_oldline=srch;
+					aprintf("Sub: Using line %d\n",srch);
+					//printf("\n %s \n",_subs[_oldline].string);
+					displayString(&(_subs[_oldline]));
+					blend(YPLANE(data),_conf->_baseLine);
+			}
+
+		return 1;
+
+}
+//_________________________________________________________________
+uint32_t	ADMVideoSubtitle::search(uint32_t time)
+{
+	if(time<_subs[0].startTime)
+		return SUB_OUT;
+
+	  for(uint32_t i=0;i<_line;i++)
+	  {
+				if((time<=_subs[i].endTime)  &&
+					(time>=_subs[i].startTime)
+				)
+				return i;
+
+		}
+		return SUB_OUT;
+}
+//
+//	Display up to 3 lines of text centered on screen
+//  Each line is separated by a |
+// It is the basic version that tries to use only 2 lines
+// in most cases, 3 when needed
+//______________________________________
+void ADMVideoSubtitle::displayString(subLine *string)
+{
+ 
+	uint32_t base=0;	
+	uint32_t nbLine=0;
+	uint32_t i=0;
+	uint32_t overflow=0;
+
+      aprintf("Sub: Rendering string %s\n",string);
+// bbase is the final position in line
+// in the image
+
+	clearBuffers();
+	nbLine=string->nbLine;
+	if(nbLine>SRT_MAX_LINE )
+	{
+		nbLine=SRT_MAX_LINE;
+		printf("Too much lines\n");
+	}
+	switch(nbLine)
+	{
+		case 0:
+			base=2*_conf->_fontsize;; // 1 or 2 lines we dont use the upper line		
+			break;
+		case 1:
+			base=_conf->_fontsize;; // 1 or 2 lines we dont use the upper line		
+			break;
+		default:
+                        base=0;
+                        break;
+	}	
+		
+	aprintf("Sub: %d lines to render\n",nbLine);
+	// scan and display each line
+	for(i=0;i<nbLine;i++)
+	{
+		
+			if(string->lineSize[i]!=displayLine(string->string[i],base,string->lineSize[i]))
+                                overflow=1;
+			base+=_conf->_fontsize;
+		
+	}
+        if(overflow && _conf->_selfAdjustable) 
+        {
+                printf("Do autosplit\n");
+                doAutoSplit(string);
+        }
+    	doChroma();
+	// Compute the dirty state
+        // If a line is not set as dirty, it means it has no pixel in it
+        // In fact we do top/bottom and add a tiny bit to it
+        memset(_dirty,1,_info.height);
+
+        // First to top
+
+        int top=0,bottom=_info.height-1,limit;
+        while(top<_info.height && !isDirty(top)) top++;
+        if(top>_conf->_fontsize>>1) top-=_conf->_fontsize>>1;
+        memset(&(_dirty[0]),0,top); // Clear top
+        
+        // Then bottom
+        limit=(SRT_MAX_LINE+1)*_conf->_fontsize;
+        if(limit>=_info.height) limit=_info.height-1;
+
+
+        bottom=limit;
+        while(bottom>top && !isDirty(bottom)) bottom--;
+        if(bottom+(_conf->_fontsize>>1)<limit) bottom+=_conf->_fontsize>>1;
+        ADM_assert(bottom<=limit);
+        memset(&(_dirty[bottom]),0,limit-bottom+1);
+        //printf("Top:%d bottom :%d limit:%d\n",top,bottom,limit);
+	
+}
+uint8_t ADMVideoSubtitle::isDirty(int line)
+{
+        uint8_t *base=_maskBuffer+_info.width*line;
+        for(int x=0;x<_info.width;x++)
+        {
+                if(base[x]) return 1;
+        }
+        return 0;
+}
+/*
+        We merge the whole lines into one then split it
+        to avoid truncated subs
+*/
+void ADMVideoSubtitle::doAutoSplit(subLine *string)
+{
+        uint32_t base=0;    
+        uint32_t nbLine=0;
+        uint32_t i=0;
+        int      total=0,start,end,pivot;
+
+        aprintf("Sub: Autospliting \n");
+        nbLine=string->nbLine;
+
+        // Merge all strings into one
+
+        for(int i=0;i<nbLine;i++) 
+                total+=1+string->lineSize[i];
+
+        ADM_GLYPH_T allwords[total];
+        int         offset[total];
+        int         sentence[total];
+        int         nbWords=0;
+        //
+        start=0;
+        for(int i=0;i<nbLine;i++) 
+        {
+                memcpy(&(allwords[start]),string->string[i],string->lineSize[i]*sizeof(ADM_GLYPH_T));
+                start+=string->lineSize[i];
+                allwords[start]=' ';
+                start++;
+        }
+        // Remove the last ' '
+        start--;
+        end=start;
+        // Here we go, we have now one line made of all merged sub
+        // We will put as much as possible into one displayed line
+        // then switch to the next one
+        //
+        printf("The new stuff is :<");
+        for(i=0;i<end;i++)
+                printf("%c",allwords[i]);
+        printf(">\n");
+        
+        // Split into words
+        pivot=0;
+        int car;
+        offset[0]=0;
+        nbWords=1;
+        while(pivot<end)
+        {
+                car=ADM_ASC(allwords[pivot]);
+                if(car==' ' || car=='.' || car ==',')
+                        {
+                                offset[nbWords++]=pivot;
+                        }
+                pivot++;
+        }
+        printf("Found %d words\n",nbWords); 
+        // Now  split
+        int nbSentence=0,len;
+        pivot=0;
+        sentence[0]=0;
+        // Try to display as much as possible in one line
+        // We build sentence here
+        while(pivot<nbWords)
+        {
+                for(i=pivot+1;i<nbWords;i++)
+                {
+                        len=offset[i]-offset[pivot];
+                        if(len!=displayLine(&(allwords[offset[pivot]]),0,len)) break;
+                }
+                sentence[nbSentence]=offset[pivot];
+                nbSentence++;
+                if(i>1 && i!=nbWords) i--;
+                pivot=i;
+        }
+        printf("0: %d,off:%d\n",sentence[0],offset[0]);
+        // Take the last word
+        sentence[nbSentence]=end;
+
+        if(nbSentence>SRT_MAX_LINE) nbSentence=SRT_MAX_LINE;
+        // now display
+        printf("Nb sentence:%d\n",nbSentence);
+        for(int j=0;j<nbSentence;j++)
+        {
+                printf("Sentence %d:",j);
+                for(int k=sentence[j];k<sentence[j+1];k++)
+                        printf("%c",allwords[k]);
+                printf("\n");
+        }
+        // now display
+        
+        switch(nbSentence)
+        {
+                case 0:
+                        base=2*_conf->_fontsize;; // 1 or 2 lines we dont use the upper line            
+                        break;
+                case 1:
+                        base=_conf->_fontsize;; // 1 or 2 lines we dont use the upper line              
+                        break;
+                default:
+                        base=0;
+                        break;
+        }
+        // scan and display each line
+        clearBuffers();
+        printf("Display\n");
+        for(i=0;i<nbSentence;i++)
+        {
+                        len=sentence[i+1]-sentence[i];
+                        displayLine(&(allwords[sentence[i]]),base,len);
+                        //displayLine(allwords,base,10);
+                        base+=_conf->_fontsize;
+        }
+        printf("/Display\n");
+        
+}
+/*
+        Once we have the subtitle built, we do the u& v planes
+        and some smoothing to avoid over sharpening on the chroma plane
+
+*/
+uint8_t ADMVideoSubtitle::doChroma(void)
+{
+// now blur bitmap into mask..
+        memset(_maskBuffer,0,SRT_MAX_LINE*_conf->_fontsize*_info.width);
+
+        uint32_t off;
+        uint8_t *src,*dst;
+
+        off=0;
+
+        src=_bitmapBuffer;
+        dst=_maskBuffer;
+
+
+        // We shrink it down for u & v by 2x2
+        // mask buffer->bitmap buffer
+
+        uint8_t tmp[_info.width*_info.height];
+
+        decimate(src,tmp,_info.width,_info.height);
+        lowPass(src,dst,_info.width,_info.height);
+        lowPass(tmp,src,_info.width>>1,_info.height>>1);
+
+        if (_conf->_useBackgroundColor) 
+        {
+                decimate(_bgMaskBuffer,_bgBitmapBuffer,_info.width,_info.height);
+                //lowPass(tmp,_bgBitmapBuffer,_info.width>>1,_info.height>>1);
+        }
+  
+}
+/*
+        Clear the buffers in case we do a new sub or
+                redo one in case it overflows
+*/
+uint8_t ADMVideoSubtitle::clearBuffers(void)
+{
+        memset(_bitmapBuffer,0,_info.height*_info.width);
+        memset(_maskBuffer,0,_info.height*_info.width);
+        memset(_bgBitmapBuffer,0,(_info.height*_info.width)>>1);
+        memset(_bgMaskBuffer,0,_info.height*_info.width);
+        return 1;
+}
+// Display a full line centered on screen. It returns the
+// number of displayed chars.
+//____________________________________________________________
+
+// It also returns the suggested len for this line string (just when display fail)
+//
+uint32_t ADMVideoSubtitle::displayLine(ADM_GLYPH_T *string,uint32_t line, uint32_t len)
+{
+  // n first chars in string that can "fit" in this line
+ 
+
+	//uint32_t pixstart;
+	uint8_t *target;
+	int car;
+
+
+	aprintf("Sub DisplayString  line %lu len %lu\n",line,len);
+
+	if(!len)
+	{
+		printf("\n null string\n");
+      		return 0;
+	}
+
+
+  
+	uint32_t w=0,next;
+	int ww;
+
+	// we dummy do it one time to get the actual width of the string
+	// and hence perfectly center it
+	target=_maskBuffer+_info.width*line;
+	for(uint32_t i=0;i<len;i++)
+	{
+			if(ADM_ASC(*(string+i))==' ')
+			{
+					w+=_conf->_fontsize>>2;
+			}
+			else
+			{
+				ww=0;
+				car=string[i];
+				if(i) next=string[i-1];
+					else next=0;
+				// Change ' to "
+				//if(ADM_ASC(car)==0x27)
+				//	car=0x22;
+	        		if(!_font->fontDraw((char *)(target+1+w),car,next , _info.width,_conf->_fontsize,&ww))
+				{
+					printf("Font error\n");
+              return 0;
+				}
+				if((ww<0)||(ww>64))
+				{
+					printf("Warning w out of bound (%d)\n",ww);
+					ww=0;
+				}
+				if(w+ww>_info.width)
+				{
+					printf("Line too long!\n");
+					len=i;
+					goto _abt;
+					break;
+				}
+				w=w+ww;
+			}
+      
+	}
+_abt:
+	//Now we can render it at its final position
+	if(w<_info.width)
+	{
+		target=_bitmapBuffer+_info.width*line+((_info.width-w)>>1);
+	}
+	else
+	{
+		target=_bitmapBuffer+_info.width*line+1;
+	}
+
+  //printf("[debug] line %s\n",string);
+
+	ww=0;
+	w=0;
+	for(uint32_t i=0;i<len;i++)
+	{
+			if(*(string+i)==' ')
+			{
+					w+=_conf->_fontsize>>2;
+
+			}
+			else
+			{
+				ww=0;
+				car=string[i];
+				if(i) next=string[i-1];
+					else next=0;
+	        		if(!_font->fontDraw((char *)(target+1+w),car,next , _info.width,_conf->_fontsize,&ww))
+				{
+					printf("Font error\n");
+              return 0;
+				}
+				if((ww<0)||(ww>64))
+				{
+					printf("Warning w out of bound (%d)\n",ww);
+					ww=0;
+				}
+				w=w+ww;
+			}
+      
+	}
+
+  {
+    if (_conf->_useBackgroundColor) {
+      //Create background info
+      
+      int32_t delta=_info.width*line+((_info.width-w)>>1);
+      uint8_t *bitmapTarget=_bitmapBuffer+delta;
+      uint8_t *maskTarget=_maskBuffer+delta;
+      //uint8_t *bgBitmapTarget=_bgBitmapBuffer+delta;
+      uint8_t *bgMaskTarget=_bgMaskBuffer+delta;
+      
+      delta=3*_info.width;
+      bitmapTarget+=delta;
+      maskTarget+=delta;
+      //bgBitmapTarget+=delta;
+      bgMaskTarget+=delta;
+      
+      for (uint32_t i=0;i<_conf->_fontsize;i++) {
+	//memset(bgTarget,1,w);
+	for (uint32_t j=0;j<w;j++) {
+	  if (*(bitmapTarget+j)==0) {
+	    *(bgMaskTarget+j)=1;   //at this position, we will apply a different color
+	    //*(bgBitmapTarget+j)=1;
+	    *(maskTarget+j)=0;
+	    *(bitmapTarget+j)=0;
+	  }
+	}
+	bgMaskTarget+=_info.width;
+	//bgBitmapTarget+=_info.width;
+	maskTarget+=_info.width;
+	bitmapTarget+=_info.width;
+      }
+
+    }
+  }
+	
+
+ 
+  return len;
+}
+//--------------------------------------------------------------------
+//
+//	Blend bitmap buffer into final screen
+//      We scan the SRT_MAX_LINE last line
+//--------------------------------------------------------------------
+uint8_t ADMVideoSubtitle::blend(uint8_t *target,uint32_t baseLine)
+{
+
+	uint8_t  *mask; //*oldtarget=target,*
+  uint8_t  *bgMask;
+	int8_t *chromatarget;
+	uint32_t hei,start;
+	uint32_t y;
+	uint32_t val;
+	int32_t ssigned;
+	double alpha,alpha2;
+#define SHADOW_UP 	8
+#define SHADOW_DOWN 	16
+
+	hei=(SRT_MAX_LINE+1)*_conf->_fontsize;
+	if(hei>=_info.height-1) hei=_info.height-1;
+	hei*=_info.width;  // max height of our subtitle
+	
+
+	aprintf("Sub:Rendering : %d %d %d (yuv)\n",_conf->_Y_percent,_conf->_U_percent,_conf->_V_percent);
+	
+	// keep a little margin for renderin
+	// to render f y or g
+	if((baseLine) > _conf->_fontsize)
+		baseLine-=_conf->_fontsize>>1;
+	
+		
+	//__________________________
+		
+		// Shadow ..
+		uint8_t *shadow=target;
+		uint32_t shadow_pos;
+		
+		shadow_pos=_conf->_fontsize/10;
+		start=_info.width*baseLine;  // base line in final image
+		// mask out left and right
+		mask=_maskBuffer; 
+				
+ 		shadow+=start+(1+_info.width)*shadow_pos;
+  		for( y=hei;y>0;y--)
+		{
+     		 if(*mask) 
+		 {
+				if(*mask>LUMA_LEVEL)
+				{
+					val=*shadow;
+					val=(val*SHADOW_UP)/SHADOW_DOWN;
+					*shadow=(uint8_t )val;
+				}				
+     		 } 	  
+      
+		shadow++;
+		mask++;
+		}
+	
+	// /Shadow
+	//__________________________
+	start=_info.width*baseLine;  // base line in final image
+
+	chromatarget=(int8_t *)(target+(_info.width*_info.height));
+
+	// mask out left and right
+
+	mask=_maskBuffer;
+  	bgMask=_bgMaskBuffer;
+ 	target+=start;
+        // clip 
+        if(hei+start>_info.width*_info.height)
+        {
+                hei=_info.width*_info.height-start;
+        }
+// Luma
+        int bottom=baseLine+(SRT_MAX_LINE+1)*_conf->_fontsize;
+        if(bottom>_info.height) bottom=_info.height;
+        for( y=baseLine;y<bottom;y++)
+        {
+            if(!_dirty[y-baseLine])
+            {
+                target+=_info.width;
+                mask+=_info.width;
+                bgMask+=_info.width;
+                 continue;
+            }
+            for(int x=0;x<_info.width;x++)
+            {
+                if(*mask) {
+                                if(*mask>LUMA_LEVEL || _conf->_useBackgroundColor)
+                                {
+                                        val=*mask*_conf->_Y_percent+128;
+                                        val>>=8;
+                                        *target=(uint8_t )val;
+                                }
+                                else 
+                                        { *target=0; }
+                        } else 
+                        if(*bgMask)
+                        {
+                                if(_conf->_useBackgroundColor) 
+                                {
+                                        *target=(uint8_t )_conf->_bg_Y_percent;
+                                }
+                        }
+                        else
+                                {
+                                        switch(_conf->_blend)
+                                        {
+                                                case BLEND_SOLID: break;
+                                                case BLEND_DIMMER: *target=(*target*3)>>2;break;
+                                                case BLEND_DOTTED: 
+                                                {
+                                                        int odd;
+                                                                odd= y%_info.width;
+                                                                odd=odd&1;
+                                                                odd+=(1&(y/_info.width));
+                                                                odd&=1;
+                                                                if(odd) *target=0; 
+                                                }
+                                        }
+                                }
+                        
+                target++;
+                mask++;
+                bgMask++;
+              }
+        }
+	
+
+// do u & v
+	int8_t *ctarget;
+
+	baseLine&=0xffffe;
+	start=(_info.width*baseLine)>>2;
+	hei>>=2;
+
+	mask=_bitmapBuffer;
+  	bgMask=_bgBitmapBuffer;
+	ctarget=chromatarget+start;
+	target=(uint8_t *)ctarget;
+
+	ssigned=_conf->_U_percent;
+	ssigned+=128;
+
+  uint8_t bg_val=(uint8_t) _conf->_bg_U_percent+128;
+
+//#define MAXVAL(x) {val=*mask*(x)+127;val>>=8;*ctarget=(uint8_t)(val&0xff);}
+
+#define BLEND_LEVEL 	3
+#define BLEND_PERCENT 	20
+
+#define MAXVAL(x)  *target=(uint8_t )ssigned
+#define DOIT if(*mask) \
+		{ \
+			alpha=*mask; \
+			if(alpha>BLEND_LEVEL) \
+				*target=(uint8_t)ssigned; \
+			else			\
+			{			\
+				alpha2=(100-BLEND_PERCENT)*(*target-128); \
+				alpha=BLEND_PERCENT*(ssigned-128); \
+				alpha=(alpha2+alpha)/100; \
+				*target=(uint8_t)(alpha+128) ;\
+			} \
+                } \
+             else if (_conf->_useBackgroundColor && *bgMask) {*target=(uint8_t)bg_val;}
+	     
+#define RENDER	     \
+	\
+	for( y=hei;y>0;y--) \
+	{ \
+		DOIT; \
+		ctarget++; \
+		target++; \
+		mask++; \
+	bgMask++; \
+	} \
+	
+	RENDER;
+
+	mask=_bitmapBuffer;
+  	bgMask=_bgBitmapBuffer;
+	ctarget=chromatarget+start+((_info.width*_info.height)>>2);;
+	target=(uint8_t *)ctarget;
+	ssigned=_conf->_V_percent;
+	ssigned+=128;
+
+  	bg_val=(uint8_t) _conf->_bg_V_percent+128;
+
+	RENDER;
+
+
+	return 1;
+}
+//
+//	Apply a low pass to alias it
+//					1
+// The softening is a 1 4 1  convolution filter
+//					1
+uint8_t ADMVideoSubtitle::lowPass(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h)
+{
+	uint8_t *prevline, *nextline,*curline,*target;
+	uint32_t val;
+
+	memcpy(dst,src,w*h);
+
+	src++;dst++;
+
+			for(uint32_t line=h-1;line>0;line--)
+			{
+				curline=src+line*w;
+				nextline=curline+w;
+				prevline=curline-w;
+				target=dst+line*w;
+				for(uint32_t col=w-1;col>1;col--)
+				{
+#define LEVEL 8*90
+					// 1 4 1
+					val= (*(curline)*4+*prevline+*nextline+*(curline-1)+*(curline+1));
+					if(val> 0 )
+					if(val<LEVEL)
+						val=1;  // just enough to trigger masking
+					else
+						val>>=3;
+					*target=val;
+					target++;
+					curline++;
+					prevline++;
+					nextline++;
+				}
+
+			}
+	return 1;
+}
+//
+//	Decimate 2x2 (luma->chroma)
+//					1
+//					1
+uint8_t ADMVideoSubtitle::decimate(uint8_t *src, uint8_t *dst, uint32_t w, uint32_t h)
+{
+	uint8_t	*curline, *nextline;
+	uint8_t *target=dst;
+
+			for(uint32_t line=0;line<h>>1;line++)
+			{
+				curline=src+line*w*2;
+				nextline=curline+w;
+				target=dst+line*(w>>1);
+				for(uint32_t col=0;col<w>>1;col++)
+				{
+					// 1 4 1
+					*target= (*(curline)+*(curline+1)+*nextline+*(nextline+1))>>2;
+					target++;
+					curline+=2;
+					nextline+=2;
+				}
+
+			}
+	return 1;
+}
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSRTload.cpp	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp	2007-08-13 13:47:25 UTC (rev 3501)
@@ -0,0 +1,497 @@
+/***************************************************************************
+                          ADM_vidload.cpp  -  description
+                             -------------------
+
+	Load the subtitles either in srt or sub format
+
+	The structure is
+		uint32_t 		startTime in ms from beginning
+		uint32_t 		endTime  in ms from beginning
+	
+	All text are stored as utf16 after loading
+
+
+    begin                : Thu Aug 09 2003
+    copyright            : (C) 2003 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <math.h>
+#include <math.h>
+#include <iconv.h>
+#include <errno.h>
+
+
+#ifdef USE_FREETYPE
+//#define __STDC_ISO_10646__
+#include "default.h"
+#include "ADM_osSupport/ADM_misc.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_video/ADM_vidFont.h"
+#include "ADM_videoFilter/ADM_vidSRT.h"
+#include <ADM_assert.h>
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_FILTER
+#include "ADM_osSupport/ADM_debug.h"
+
+#define ADM_RAW 1024
+
+static iconv_t myConv=(iconv_t)-1;;
+static int ADM_SubAtoi(uint16_t *in);
+
+static uint8_t	ADM_utfInit( char *charset );
+static uint8_t ADM_utfConv(ADM_GLYPH_T *out, char *in,uint32_t nbIn, uint32_t *nbOut);
+static uint8_t ADM_utfEnd( void);
+
+
+
+
+uint8_t	ADMVideoSubtitle::loadFont (void)
+{
+ 
+  if (!_font->initFreeType ((char *)_conf->_fontname))
+    {
+      printf ("\n Free type init failed for font %s!", _conf->_fontname);
+    }
+  else
+    {
+      _font->fontSetSize (_conf->_fontsize);
+    }
+   
+  return 1;
+}
+
+//
+//      Load subtitles in .sub format i.e. {xx}{yy} |   |
+//
+// {3610}{3656}Pripraven?uv?a ich|v naom dome s primeranou ctou.
+//__________________________________________________________________
+uint8_t  ADMVideoSubtitle::loadSubTitle (void)
+{
+
+  char string[500];
+  uint32_t current_line = 0;
+  // first cound how many line
+  _line = 0;
+   // init iconv...  
+  if(! ADM_utfInit(_conf->_charset))
+  {
+  	printf("Problem initializing iconv, aborting\n");
+	return 0;
+  
+  }
+  while (fgets (string, 200, _fd))
+    {
+      _line++;
+    }
+  printf ("\n subs : %ld lines\n", _line);
+  // rewind
+  fseek (_fd, 0, SEEK_SET);
+  //
+  _subs = new subLine[_line];
+  if (!_subs)
+    return 0;
+  memset (_subs, 0, sizeof (subLine) * _line);
+
+
+ 
+//	
+  for (uint32_t i = 0; i < _line; i++)
+    {
+      fgets (string, ADM_RAW, _fd);
+      //printf("\n in : %s ",string);
+      if (string[0] != '{')
+	continue;
+      subParse ((subLine *) & (_subs[current_line]), string);
+      current_line++;
+    }
+	
+  // the effective number of line we have
+  _line = current_line;
+  return 1;
+  
+ ADM_utfEnd( );
+}
+
+//___________________________________________________________________
+//      In case of sub file, take one line and convert it to unicode
+//	we also extract the start/end and split it to N lines
+//	Does not work if input is UTF16. UTF8 is ok.
+//___________________________________________________________________
+uint8_t	ADMVideoSubtitle::subParse (subLine * in, char *string)
+{
+
+
+  static ADM_GLYPH_T 	final[ADM_RAW];	// convert to unicode
+  uint32_t   	startindex, endindex,textindex;
+  uint32_t 	j;
+  float 	f;
+ 
+  uint32_t 	finallen=0;
+  uint32_t	alpha;
+ 
+  j = 1;
+  
+  
+  ADM_utfConv(final,string,strlen(string),&finallen);
+  
+  // ignore { }
+  while (ADM_ASC(final[j]) != '}' && j < finallen)
+    j++;
+ 
+  startindex =1;
+  j += 2;			// skip }{
+  endindex =j;
+  while (ADM_ASC(final[j]) != '}' && j < finallen)
+    j++;
+  // The text starts here
+  textindex = j + 1;
+
+  if (j >= finallen - 1)
+    {
+      printf ("***ERR: Suspicious line !!!\n");
+      return 0;
+
+    }
+
+  // convert frame -> time in ms
+  // skip utf marker if present
+  alpha= ADM_SubAtoi (&final[1]);
+  f=(float)alpha;
+  aprintf("%s start:%d",string,alpha);
+  f = f * 1000000. / _info.fps1000;
+  in->startTime = (uint32_t) floor (f);
+
+  alpha = ADM_SubAtoi (&final[endindex]);
+  f=(float)alpha;
+  aprintf(" end:%d\n",alpha);
+  f = f * 1000000. / _info.fps1000;
+  
+  in->endTime = (uint32_t) floor (f);
+
+  uint32_t lllines=0;
+  finallen-=textindex;
+  if(finallen==0)
+  	{
+		printf("Empty line\n");
+		in->nbLine=0;
+		return 1;
+	}
+  // Count the number of | found
+  for(j=0;j<finallen;j++)
+  {
+  	if(ADM_ASC(final[j+textindex])=='|') lllines++;
+  }
+
+  aprintf("%lu -->%lu\n",in->startTime,in->endTime);
+  in->nbLine=lllines+1;
+  in->string=new ADM_GLYPH_T *[in->nbLine];
+  in->lineSize=new uint32_t[in->nbLine];
+  
+  for(uint32_t i=0;i<in->nbLine;i++)
+  {
+  	in->string[i]=new ADM_GLYPH_T[finallen]; 	// yes, we overshot
+	in->lineSize[i]=0;
+  }
+  
+  uint32_t curline=0, curindex=0;
+  for(uint32_t i=0;i<finallen;i++)
+  {
+  	if(ADM_ASC(final[i+textindex])=='|')
+	{
+		in->lineSize[curline]=curindex;
+		curindex=0;
+		curline++;		
+	}
+	else
+	{
+		in->string[curline][curindex++]=final[i+textindex];
+	}
+  
+  }  
+  if(curindex)
+  	in->lineSize[curline]=curindex;
+  return 1;
+}
+
+//
+//      Load subtitles in .srt format i.e. {xx}{yy} |   |
+//__________________________________________________________________
+uint8_t
+ADMVideoSubtitle::loadSRT (void)
+{
+
+
+  static ADM_GLYPH_T 	final[ADM_RAW];	// convert to unicode
+  ADM_GLYPH_T  		temp[SRT_MAX_LINE][ADM_RAW];
+  uint32_t		tempSize[SRT_MAX_LINE];
+  char			string[ADM_RAW];
+  
+  
+  uint32_t line;  
+  uint32_t len;
+  // Init iconv
+   uint32_t 	finallen=0;
+  subLine	*current;
+  
+  if(! ADM_utfInit(_conf->_charset))
+  {
+  	printf("Problem initializing iconv, aborting\n");
+	return 0;
+  
+  } 
+  
+  // first cound how many line
+  line = 0;
+  _line = 0;
+  while (fgets (string, 300, _fd))
+    line++;
+  printf ("\n subs : %ld lines\n", line);
+  // rewind
+  fseek (_fd, 0, SEEK_SET);
+  //
+  _subs = new subLine[line];
+
+  if (!_subs)
+    return 0;
+  
+  memset (_subs, 0, sizeof (subLine) * line);
+  
+  // read and allocate
+  
+  uint32_t j;
+  int state = 0;
+  int stored=0;
+  
+  for (uint32_t i = 0; i < line; i++)
+    {
+	current=&_subs[_line];
+	fgets (string, ADM_RAW, _fd);
+	ADM_utfConv(final,string,strlen(string),&finallen);
+	// Purge cr/lf	
+	switch (state)
+	{
+	case 0:		// waiting for number	 
+                  if(!_line && (final[0]&0xfefe)==0xfefe)
+                  {
+                      j=ADM_SubAtoi (final+1);
+                  }
+                  else
+		      j = ADM_SubAtoi (final);
+		if (j == _line + 1)
+		{
+			stored=0;
+			state = 1;
+		}
+		break;
+	case 1:		// waiting for time
+		{
+			uint32_t sh, sm, ss, ms;
+			uint32_t dh, dm, ds, md;
+
+			ADM_GLYPH_T *cur=&final[0];
+				
+	  		sh=ADM_SubAtoi(cur);
+			cur+=3;
+			sm=ADM_SubAtoi(cur);
+			cur+=3;
+			ss=ADM_SubAtoi(cur);
+			cur+=3;
+			ms=ADM_SubAtoi(cur);
+			cur+=3;
+			
+			cur+=5;
+			
+			dh=ADM_SubAtoi(cur);
+			cur+=3;
+			dm=ADM_SubAtoi(cur);
+			cur+=3;
+			ds=ADM_SubAtoi(cur);
+			cur+=3;
+			md=ADM_SubAtoi(cur);
+			
+			_subs[_line].startTime = ms + 1000 * (ss + sm * 60 + sh * 3600);
+			_subs[_line].endTime = md + 1000 * (ds + dm * 60 + dh * 3600);
+			state = 2;
+			
+			aprintf("%d %d %d %d / %d %d %d %d>%s<\n",sh,sm,ss,ms,dh,dm,ds,md,string);
+			
+		}
+
+		break;
+	case 2:		
+	   // looking for text
+	   // We append each line to text with a | to separate the lines	 	  
+	  {
+	  	if (finallen < 2)
+	    	{
+	   		// Finished
+	      		_line++;
+	      		state = 0;
+			current->nbLine=stored;
+			current->lineSize=new uint32_t[stored];
+			current->string=new ADM_GLYPH_T *[stored];
+			for(uint32_t i=0;i<stored;i++)
+			{
+				current->lineSize[i]=tempSize[i];
+				current->string[i]=new ADM_GLYPH_T[tempSize[i]];
+				memcpy(current->string[i],temp[i],sizeof(ADM_GLYPH_T)*tempSize[i]);
+			}
+	      		break;
+	    	}
+	  	else
+	    	{
+			if(stored>=SRT_MAX_LINE)
+			{
+				printf("sub:Too much lines, ignoring..\n");
+				continue;
+			}
+	      		// We add it
+			memcpy(temp[stored],final,finallen*sizeof(ADM_GLYPH_T));
+			tempSize[stored]=finallen;
+			stored++;
+	    	}
+	  }
+	  break;
+
+	}
+
+    }
+  ADM_utfEnd( );
+  aprintf(">> Sub: %d subs stored and loaded\n",_line); 	
+  return 1;
+  
+}
+// Sort of atoi for utf16
+// Very basic
+int ADM_SubAtoi(uint16_t *in)
+{
+	int result=0;
+	int d;
+	do
+	{
+		d=ADM_ASC(*in);		
+		in++;
+		if(d>='0' && d<='9')
+		{
+			result*=10;
+			result+=d-'0';
+		}
+		else
+			return result;
+	}while(1);
+	
+
+}
+//	Init iconv, so that we can go utf16
+//
+uint8_t	ADM_utfInit( char *charset )
+{
+	myConv=iconv_open("UTF-16",charset); //"WINDOWS-1251");
+	if((long int)myConv==-1)
+	{
+		printf("\n Error initializing iconv...\n");
+		return  0;
+	}
+	return 1;
+}
+//
+//	Convert the incoming string to utf16
+//	While doing it, remove the utf16 makers from input/output
+//	(fffe)
+//
+uint8_t ADM_utfConv(ADM_GLYPH_T *out, char *in,uint32_t nbIn, uint32_t *nbOut)
+{
+size_t sin,sout,sz;
+char *cout,*cin;
+uint32_t done=0;
+
+	memset(out,0,ADM_RAW*sizeof(ADM_GLYPH_T));
+	sin=strlen(in);
+	sout=ADM_RAW;
+	cin=in;
+	cout=(char *)(out);
+	
+	if((uint8_t)in[0]==0xff && (uint8_t)in[1]==0xfe)
+	{
+		 cin+=2;
+		 sin-=2;
+	}
+	if(!sin) 
+	{
+		*nbOut=0;
+		return 1;
+	}
+#ifdef  ICONV_NEED_CONST 
+  	sz=iconv(myConv,(const char **)&cin,&sin,&cout,&sout);
+#else
+	sz=iconv(myConv,&cin,&sin,&cout,&sout);
+#endif	
+	if(sz==-1)
+	{
+  		printf("Iconv error:%s\n:%s:\n",strerror(errno),in);
+		//out[0]=' ';
+  	}
+	// Get the amound of utf16...
+	done=(ADM_RAW-sout)>>1;
+// For win32 we swap le and be
+#ifdef ADM_WIN32
+       ADM_GLYPH_T glyph;
+       for(uint32_t w=0;w<done;w++)
+       {
+               glyph=out[w];
+               out[w]=((glyph&0xff)<<8)+(glyph>>8);
+       }
+#endif
+	
+	if(done)
+	{
+		if(0xfeff==out[0])
+		{
+			//aprintf("Removing utf tag\n");
+			done--;
+			memmove(&out[0],&out[1],done*sizeof(ADM_GLYPH_T));
+			
+		}
+	}
+
+	while(done &&( ADM_ASC(out[done-1])==0x0a || ADM_ASC(out[done-1]==0x0d))) done--;
+	*nbOut=done;
+	return 1;
+	
+}
+// Close iconv
+//
+
+uint8_t ADM_utfEnd( void)
+{
+  // Purge iconv
+  if((long int)myConv!=-1)
+	{
+		iconv_close(myConv);
+		myConv=(iconv_t)-1;
+	}
+}
+
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-13 13:47:25 UTC (rev 3501)
@@ -25,5 +25,12 @@
 ADM_vidAnimated.cpp
 ADM_vidDvbSub.cpp
 ADM_vidLogo.cpp
+ADM_vidHue.cpp
+ADM_vidSRT.cpp
+ADM_vidSRTload.cpp
+ADM_vidSRTRender.cpp
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
+if(FT_FOUND)
+add_definitions(${FT_CFLAGS})
+endif(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-13 10:07:01 UTC (rev 3500)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-13 13:47:25 UTC (rev 3501)
@@ -63,7 +63,11 @@
  ADM_vidYadif_asm.c \
  ADM_vidAnimated.cpp \
  ADM_vidDvbSub.cpp \
- ADM_vidLogo.cpp
+ ADM_vidLogo.cpp \
+ ADM_vidHue.cpp \
+ ADM_vidSRT.cpp \
+ ADM_vidSRTload.cpp \
+ ADM_vidSRTRender.cpp
 			
 
 



From mean at mail.berlios.de  Mon Aug 13 15:52:06 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 15:52:06 +0200
Subject: [Avidemux-svn-commit] r3502 - in
	branches/avidemux_2.4_branch/avidemux: ADM_video ADM_videoFilter
Message-ID: <200708131352.l7DDq6gD017785@sheep.berlios.de>

Author: mean
Date: 2007-08-13 15:52:06 +0200 (Mon, 13 Aug 2007)
New Revision: 3502

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidCrop.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filter] move crop also

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidCrop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidCrop.cpp	2007-08-13 13:47:25 UTC (rev 3501)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidCrop.cpp	2007-08-13 13:52:06 UTC (rev 3502)
@@ -1,206 +0,0 @@
-/***************************************************************************
-                          ADM_vidCrop.cpp  -  description
-                             -------------------
-          Crop top/left/right/bottom
-
-          Each one ,must be even
-
-
-    begin                : Sun Mar 24 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-#ifdef HAVE_ENCODER
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidCommonFilter.h"
-#include "ADM_filter/video_filters.h"
-
-
-static FILTER_PARAM cropParam={4,{"left","right","top","bottom"}};
-
-
-SCRIPT_CREATE(crop_script,AVDMVideoStreamCrop,cropParam);
-
-char *AVDMVideoStreamCrop::printConf( void )
-{
- 	static char buf[50];
- 	
- 	sprintf((char *)buf," Crop %lu x %lu --> %lu x %lu",
- 				_in->getInfo()->width,
- 				_in->getInfo()->height,
- 				_info.width,
- 				_info.height);
-        return buf;
-}
-
-//_______________________________________________________________
-
-AVDMVideoStreamCrop::AVDMVideoStreamCrop(
-									AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-
-  	_in=in;		
-   	memcpy(&_info,_in->getInfo(),sizeof(_info));
-	
-		if(couples)
-		{
-			_param=	NEW(CROP_PARAMS);
-			GET(left);
-			GET(right);
-			GET(top);
-			GET(bottom);
-				// Consistency check
-				if(  _in->getInfo()->width<(_param->right+_param->left))
-						{
-                      		printf("\n Warning Cropping too much width ! Width reseted !\n");
-								_param->right=_param->left=0;
-						}
-				if(  _in->getInfo()->height<(_param->bottom+_param->top))
-						{
-                      		printf("\n Warning Cropping too much height ! Height reseted !\n");
-								_param->bottom=_param->top=0;
-						}
-
-			_info.width=_in->getInfo()->width-_param->right-_param->left;		
-			_info.height=_in->getInfo()->height-_param->bottom-_param->top;	
-			
-		}	
-			else 			
-		{	// default parameter	
-				_param=	NEW(CROP_PARAMS); ;
-				_param->left=_param->top=
-				_param->right=_param->bottom=0;
-		}				
-					
- 	//_uncompressed=(uint8_t *)malloc(3*_in->getInfo()->width*_in->getInfo()->height);
- 	//_uncompressed=new uint8_t [3*_in->getInfo()->width*_in->getInfo()->height];
-	_uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
-  	ADM_assert(_uncompressed);
-  	_info.encoding=1;
-	  
-
-  	  	
-}
-AVDMVideoStreamCrop::~AVDMVideoStreamCrop()
-{
- 	delete _uncompressed;
- 	DELETE(_param);
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoStreamCrop::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-
-			ADM_assert(frame<_info.nb_frames);
-			ADM_assert(_param);									
-		if(frame>= _info.nb_frames) return 0;
-			// read uncompressed frame
-       		if(!_in->getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-       		
-       		// Crop Y luma
-       		uint32_t y,x,line;
-       		uint8_t *src,*src2,*dest;
-       		
-       		y=_in->getInfo()->height;
-       		x=_in->getInfo()->width;
-       		line=_info.width;
-       		src=YPLANE(_uncompressed)+_param->top*x+_param->left;
-       		dest=YPLANE(data);
-       		
-       		for(uint32_t k=_info.height;k>0;k--)
-       			{
-       			 	    memcpy(dest,src,line);
-       			 	    src+=x;
-       			 	    dest+=line;
-       			}
-       		 // Crop U  & V
-       		 	src=UPLANE(_uncompressed)+(x*_param->top>>2)+(_param->left>>1);
-       		 	src2=VPLANE(_uncompressed)+(x*_param->top>>2)+(_param->left>>1);
-			dest=UPLANE(data);
-       		 	line>>=1;
-       		 	x>>=1;       		       		 	
-       		 		for(uint32_t k=((_info.height)>>1);k>0;k--)
-       		 		{
-       		 	    	  	memcpy(dest,src,line);
-       			 	    	src+=x;
-       			 	    	dest+=line;
-       		 		}
-			dest=VPLANE(data);	
-       		 		for(uint32_t k=((_info.height)>>1);k>0;k--)
-       		 		{
-       		 	    	  	memcpy(dest,src2,line);
-       			 	    	src2+=x;
-       			 	    	dest+=line;
-       		 		}	
-       		  *flags=0;
-       		  *len= _info.width*_info.height+(_info.width*_info.height>>1);
-		  data->copyInfo(_uncompressed);
-      return 1;
-}
-/**
-	Return the configuration as a couple of string
-	Up to the client to free them afterward
-*/
-uint8_t	AVDMVideoStreamCrop::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_assert(_param);
-			*couples=new CONFcouple(4);
-
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-			CSET(left);
-			CSET(right);
-			CSET(top);
-			CSET(bottom);
-			return 1;
-
-}
-extern int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in);
-uint8_t AVDMVideoStreamCrop::configure( AVDMGenericVideoStream *instream)
-
-{
-		uint8_t r;
-		uint32_t w,h;
-    	if(r = (DIA_getCropParams("Crop Settings",_param,instream )))
-    	{
-			w=_param->left+_param->right;
-			h=_param->top+_param->bottom;
-			ADM_assert(w<instream->getInfo()->width);
-			ADM_assert(h<instream->getInfo()->height);
-			_info.width=instream->getInfo()->width-w;
-			_info.height=instream->getInfo()->height-h;
-		}
-		return r;
-}
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-13 13:47:25 UTC (rev 3501)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-13 13:52:06 UTC (rev 3502)
@@ -13,7 +13,6 @@
 ADM_vidFont.cpp
 ADM_vidVobsub.cpp
 ADM_vidAsharp.cpp       
-ADM_vidCrop.cpp       
 ADM_vidVobSubRender.cpp
 ADM_interlaced.cpp       
 ADM_vidCached.cpp       

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-13 13:47:25 UTC (rev 3501)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-13 13:52:06 UTC (rev 3502)
@@ -11,7 +11,6 @@
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
  ADM_vidContrast.cpp \
- ADM_vidCrop.cpp \
  ADM_vidNull.cpp \
 	ADM_vidClean.cpp \
  ADM_genvideo.cpp \
@@ -81,7 +80,7 @@
 ADM_vidContrast.cpp  ADM_vidMPdelogo.cpp \
 ADM_vidContrast.h  ADM_vidMPdelogo.h \
 ADM_vobsubinfo.cpp \
-ADM_vidCrop.cpp  ADM_vobsubinfo.h \
+ADM_vobsubinfo.h \
 swscale_internal.h \
 ADM_vidTdeint_util.txt mmx_macros.h
 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidCrop.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidCrop.cpp)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-13 13:47:25 UTC (rev 3501)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-13 13:52:06 UTC (rev 3502)
@@ -29,6 +29,7 @@
 ADM_vidSRT.cpp
 ADM_vidSRTload.cpp
 ADM_vidSRTRender.cpp
+ADM_vidCrop.cpp       
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-13 13:47:25 UTC (rev 3501)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-13 13:52:06 UTC (rev 3502)
@@ -67,7 +67,8 @@
  ADM_vidHue.cpp \
  ADM_vidSRT.cpp \
  ADM_vidSRTload.cpp \
- ADM_vidSRTRender.cpp
+ ADM_vidSRTRender.cpp \
+ ADM_vidCrop.cpp       
 			
 
 



From gruntster at mail.berlios.de  Mon Aug 13 18:31:21 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 13 Aug 2007 18:31:21 +0200
Subject: [Avidemux-svn-commit] r3503 - in
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec:
	. i386
Message-ID: <200708131631.l7DGVLpI031734@sheep.berlios.de>

Author: gruntster
Date: 2007-08-13 18:31:01 +0200 (Mon, 13 Aug 2007)
New Revision: 3503

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/fft.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c
Log:
[lav] enable SSE except for WMA due to stack issues  (Win32 only)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/fft.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/fft.c	2007-08-13 13:52:06 UTC (rev 3502)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/fft.c	2007-08-13 16:31:01 UTC (rev 3503)
@@ -74,11 +74,14 @@
             } else if (has_vectors & MM_3DNOW) {
                 /* 3DNow! for K6-2/3 */
                 s->fft_calc = ff_fft_calc_3dn;
-            } else if (has_vectors & MM_SSE) {
+            }
+#ifndef ADM_WIN32	// GRUNTSTER
+			else if (has_vectors & MM_SSE) {
                 /* SSE for P3/P4 */
                 s->imdct_calc = ff_imdct_calc_sse;
                 s->fft_calc = ff_fft_calc_sse;
             }
+#endif
 #else /* HAVE_MMX */
             if (has_vectors & MM_ALTIVEC)
                 s->fft_calc = ff_fft_calc_altivec;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-08-13 13:52:06 UTC (rev 3502)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-08-13 16:31:01 UTC (rev 3503)
@@ -81,7 +81,6 @@
         cpuid(1, eax, ebx, ecx, std_caps);
         if (std_caps & (1<<23))
             rval |= FF_MM_MMX;
-#ifndef ADM_WIN32
         if (std_caps & (1<<25))
             rval |= FF_MM_MMXEXT | FF_MM_SSE;
         if (std_caps & (1<<26))
@@ -90,7 +89,6 @@
             rval |= FF_MM_SSE3;
         if (ecx & 0x00000200 )
             rval |= FF_MM_SSSE3;
-#endif
     }
 
     cpuid(0x80000000, max_ext_level, ebx, ecx, edx);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx.c	2007-08-13 13:52:06 UTC (rev 3502)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx.c	2007-08-13 16:31:01 UTC (rev 3503)
@@ -30,6 +30,7 @@
 #include "vp3dsp_mmx.h"
 #include "vp3dsp_sse2.h"
 #include "h263.h"
+#include "config.h"
 
 //#undef NDEBUG
 //#include <assert.h>
@@ -3643,6 +3644,7 @@
         }
         if(mm_flags & MM_3DNOWEXT)
             c->vector_fmul_reverse = vector_fmul_reverse_3dnow2;
+#ifndef ADM_WIN32	// GRUNTSTER
         if(mm_flags & MM_SSE){
             c->vorbis_inverse_coupling = vorbis_inverse_coupling_sse;
             c->vector_fmul = vector_fmul_sse;
@@ -3650,6 +3652,7 @@
             c->vector_fmul_reverse = vector_fmul_reverse_sse;
             c->vector_fmul_add_add = vector_fmul_add_add_sse;
         }
+#endif
         if(mm_flags & MM_3DNOW)
             c->vector_fmul_add_add = vector_fmul_add_add_3dnow; // faster than sse
     }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c	2007-08-13 13:52:06 UTC (rev 3502)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c	2007-08-13 16:31:01 UTC (rev 3503)
@@ -1899,7 +1899,7 @@
                +sse(s, s->new_picture.data[2] + s->mb_x*8  + s->mb_y*s->uvlinesize*8,s->dest[2], w>>1, h>>1, s->uvlinesize);
 }
 
-static int attribute_align_arg pre_estimate_motion_thread(AVCodecContext *c, void *arg){
+static int pre_estimate_motion_thread(AVCodecContext *c, void *arg){
     MpegEncContext *s= arg;
 
 
@@ -1918,7 +1918,7 @@
     return 0;
 }
 
-static int estimate_motion_thread(AVCodecContext *c, void *arg){
+static int attribute_align_arg estimate_motion_thread(AVCodecContext *c, void *arg){
     MpegEncContext *s= arg;
 
     ff_check_alignment();



From mean at mail.berlios.de  Mon Aug 13 19:01:27 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 19:01:27 +0200
Subject: [Avidemux-svn-commit] r3504 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_commonUI ADM_video
Message-ID: <200708131701.l7DH1RB4010190@sheep.berlios.de>

Author: mean
Date: 2007-08-13 19:01:25 +0200 (Mon, 13 Aug 2007)
New Revision: 3504

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
Log:
[Filter] Flydialog for mplayerEq2, seems there is a bug

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-13 16:31:01 UTC (rev 3503)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-13 17:01:25 UTC (rev 3504)
@@ -1,13 +1,10 @@
-/**/
 /***************************************************************************
-                          DIA_hue
-                             -------------------
+                           Fly-Ui for hue & sat
 
-                           Ui for hue & sat
-
-    begin                : 08 Apr 2005
-    copyright            : (C) 2004/5 by mean
+    copyright            : (C) 2004/5/7 by mean
     email                : fixounet at free.fr
+    
+    
  ***************************************************************************/
 
 /***************************************************************************
@@ -29,7 +26,6 @@
 #include <math.h>
 
 #include "default.h"
-#include "ADM_colorspace/ADM_rgb.h"
 #include "ADM_toolkit_gtk/ADM_gladeSupport.h"
 
 #include "ADM_toolkit_gtk/toolkit_gtk.h"
@@ -39,88 +35,49 @@
 #include "ADM_video/ADM_genvideo.hxx"
 
 #include "ADM_video/ADM_vidEq2.h"
-#include "prototype.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyEq2.h"
+
 #include "ADM_assert.h"
 
-#include "ADM_osSupport/ADM_cpuCap.h"
-
-extern "C" {
-#include "ADM_libraries/ADM_lavcodec/avcodec.h"
-}
-
 static GtkWidget*create_dialog1 (void);
 static float getAdj(GtkWidget *widget);
 static void setAdj(GtkWidget *widget,float val);
 
-static ADMImage *imgsrc,*imgdst,*imgdisplay;
 static GtkWidget *dialog=NULL;
-static uint32_t w,h,zoomW,zoomH;
-static uint32_t *rgbbuffer=NULL;
-static AVDMGenericVideoStream *incoming;
-static Eq2_Param myEq2;
-static ADMImageResizer *resizer=NULL;
 
 static void             update ( void);
 static gboolean         draw (void );
 static void             eq2_changed( void);
+static void 			frame_changed( void );
 
-static void frame_changed( void );
-static Eq2Settings mySettings;
-static ColYuvRgb    *rgbConv=NULL;
+static int lock=0;
+static flyEq2 *myCrop=NULL;
 
-extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
-extern void UI_centreCanvasWindow(GtkWindow *window, GtkWidget *canvas, int newCanvasWidth, int newCanvasHeight);
-
-/************************************************************************/
+/**
+ * 		\fn DIA_getEQ2Param
+ * 		\brief flyDialogGtk handling the mplayer EQ2 user Interface dialog.
+ */
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in)
 {
 uint8_t r=0;
-
-        uint32_t l,f;
-        uint32_t max=in->getInfo()->nb_frames;
-        
-        incoming=in;
+uint32_t w,h;
         // Allocate space for green-ised video
         w=in->getInfo()->width;
         h=in->getInfo()->height;
 
-        imgdst=new ADMImage(w,h);
-        imgsrc=new ADMImage(w,h);
-        imgdisplay=new ADMImage(w,h);
-
-        if(curframe<max) max=curframe;
-        
-        ADM_assert(in->getFrameNumberNoAlloc(max, &l, imgsrc,&f));
-
-        memcpy(YPLANE(imgdisplay),YPLANE(imgsrc),w*h);
-        memcpy(UPLANE(imgdisplay),UPLANE(imgsrc),(w*h)>>2);
-        memcpy(VPLANE(imgdisplay),VPLANE(imgsrc),(w*h)>>2);
-        
-        rgbConv=new ColYuvRgb(w,h);
-        rgbConv->reset(w,h);
-
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-
-        memcpy(&myEq2,param,sizeof(myEq2));
-
-        // upload
-#undef SET
-#undef GET
-#define SET(x,y)        setAdj(WID(hscale##x),myEq2.y)
-#define GET(x,y)        myEq2.y=getAdj(WID(hscale##x))
-
-        SET(Contrast,contrast);
-        SET(Brightness,brightness);
-        SET(Saturation,saturation);
-
-        SET(Gamma,gamma);        
-        SET(GammaWeight,gamma_weight);
-        SET(GammaR,rgamma);
-        SET(GammaG,ggamma);
-        SET(GammaB,bgamma);
-
-        gtk_signal_connect(GTK_OBJECT(WID(hscale1)), "value_changed",GTK_SIGNAL_FUNC(frame_changed),   NULL);
+        gtk_widget_show(dialog);	
+        
+        myCrop=new flyEq2( w, h,in,WID(drawingarea1),WID(hscale1));
+        memcpy(&(myCrop->param),param,sizeof(Eq2_Param));
+        myCrop->upload();
+        
+        int ret=0;
+        int response;
+        //-----------------------
+        gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), "expose_event", GTK_SIGNAL_FUNC(draw),   NULL);
 #define HCONECT(x)  gtk_signal_connect(GTK_OBJECT(WID(hscale##x)), "value_changed",GTK_SIGNAL_FUNC(eq2_changed),   NULL);
 
         HCONECT(Brightness);
@@ -132,164 +89,80 @@
         HCONECT(GammaR);
         HCONECT(GammaG);
         HCONECT(GammaB);
-        
-		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), w, h);
+        gtk_signal_connect(GTK_OBJECT(WID(hscale1)), "value_changed",GTK_SIGNAL_FUNC(frame_changed),   NULL);
+        myCrop->sliderChanged();
+        myCrop->update();
+        //-----------------------
+        response=gtk_dialog_run(GTK_DIALOG(dialog));
 
-		zoomW = w * zoom;
-		zoomH = h * zoom;
-		rgbbuffer=new uint32_t[zoomW*zoomH];
-
-		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
-
-		if (zoom < 1)
-		{
-			UI_centreCanvasWindow((GtkWindow*)dialog, WID(drawingarea1), zoomW, zoomH);
-			resizer = new ADMImageResizer(w, h, zoomW, zoomH, PIX_FMT_YUV420P, PIX_FMT_RGB32);
-		}
-
-        gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), "expose_event", GTK_SIGNAL_FUNC(draw),   NULL);
-        update();
-        // run
-        if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
+        if(response==GTK_RESPONSE_OK)
         {
-                // download
-               memcpy(param,&myEq2,sizeof(myEq2));
-                r=1;
+            myCrop->download();
+            memcpy(param,&(myCrop->param),sizeof(Eq2_Param));
+            ret=1;
         }
-        
         gtk_unregister_dialog(dialog);
         gtk_widget_destroy(dialog);
+        delete myCrop;
+        myCrop=NULL;
+        return ret;
 
-        delete imgdst;
-        delete imgsrc;
-        delete imgdisplay;
-        delete [] rgbbuffer;
-        delete rgbConv;
+}
+/**************************************/
+#undef SET
+#undef GET
+#define SET(x,y)        setAdj(WID(hscale##x),param.y)
+#define GET(x,y)        param.y=getAdj(WID(hscale##x))
 
-		if (resizer)
-		{
-			delete resizer;
-			resizer=NULL;
-		}
 
-        rgbbuffer=NULL;
-        imgdst=NULL;
-        imgsrc=NULL;
-        dialog=NULL;
-        imgdisplay=NULL;
-        return r;
+uint8_t flyEq2::upload(void)
+{
+  lock++;
+  SET(Contrast,contrast);
+  SET(Brightness,brightness);
+  SET(Saturation,saturation);
 
+  SET(Gamma,gamma);        
+  SET(GammaWeight,gamma_weight);
+  SET(GammaR,rgamma);
+  SET(GammaG,ggamma);
+  SET(GammaB,bgamma);
+  
+  lock--;
+  return 1;
 }
-/**********************/
-void frame_changed( void )
+uint8_t flyEq2::download (void)
 {
-uint32_t new_frame,max,l,f;
-double   percent;
-GtkWidget *wid; 
-GtkAdjustment *adj;
-        
-        max=incoming->getInfo()->nb_frames;
-        wid=WID(hscale1);
-        adj=gtk_range_get_adjustment (GTK_RANGE(wid));
-        new_frame=0;
-        
-        percent=(double)GTK_ADJUSTMENT(adj)->value;
-        percent*=max;
-        percent/=100.;
-        new_frame=(uint32_t)floor(percent);
-        
-        if(new_frame>=max) new_frame=max-1;
-        
-        ADM_assert(incoming->getFrameNumberNoAlloc(new_frame, &l, imgsrc,&f));
-        memcpy(YPLANE(imgdisplay),YPLANE(imgsrc),w*h);
-        memcpy(UPLANE(imgdisplay),UPLANE(imgsrc),(w*h)>>2);
-        memcpy(VPLANE(imgdisplay),VPLANE(imgsrc),(w*h)>>2);
-        update();
-        draw();
 
+  GET(Contrast,contrast);
+  GET(Brightness,brightness);
+  GET(Saturation,saturation);
+
+  GET(Gamma,gamma);        
+  GET(GammaWeight,gamma_weight);
+  GET(GammaR,rgamma);
+  GET(GammaG,ggamma);
+  GET(GammaB,bgamma);
+
+ return 1;
 }
-void download (void)
-{
-                GET(Contrast,contrast);
-                GET(Brightness,brightness);
-                GET(Saturation,saturation);
 
-                GET(Gamma,gamma);        
-                GET(GammaWeight,gamma_weight);
-                GET(GammaR,rgamma);
-                GET(GammaG,ggamma);
-                GET(GammaB,bgamma);
+/**********************/
+void frame_changed( void )
+{
+          myCrop->sliderChanged();
 }
 void eq2_changed( void)
 {
-    download();
-    update();
-    draw();
+    if(lock) return;
+    myCrop->update();
 }
 gboolean draw (void)
 {
-	GUI_RGBDisplay((uint8_t *)rgbbuffer, zoomW, zoomH, WID(drawingarea1));
-
+    myCrop->display();
 	return true;
 }
-void update(void )
-{
-uint8_t *src,*dst;
-uint32_t stride;
-
-        update_lut(&mySettings,&myEq2);
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-        if(CpuCaps::hasMMX())
-        {
-                affine_1d_MMX(&(mySettings.param[0]),YPLANE(imgdisplay),YPLANE(imgsrc),w,h);
-                affine_1d_MMX(&(mySettings.param[2]),UPLANE(imgdisplay),UPLANE(imgsrc),w>>1,h>>1);
-                affine_1d_MMX(&(mySettings.param[1]),VPLANE(imgdisplay),VPLANE(imgsrc),w>>1,h>>1);       
-        }
-        else
-#endif
-        {
-                apply_lut(&(mySettings.param[0]),YPLANE(imgdisplay),YPLANE(imgsrc),w,h);
-                apply_lut(&(mySettings.param[2]),UPLANE(imgdisplay),UPLANE(imgsrc),w>>1,h>>1);
-                apply_lut(&(mySettings.param[1]),VPLANE(imgdisplay),VPLANE(imgsrc),w>>1,h>>1);       
-        }
-
-        // copy Y half
-    dst=YPLANE(imgdisplay);
-    src=YPLANE(imgsrc);
-    stride=w;
-    for(uint32_t y=0;y<h;y++)   // We do both u & v!
-    {
-        memcpy(dst,src,stride>>1);
-        dst+=stride;
-        src+=stride;
-    }
-        // U
-    dst=UPLANE(imgdisplay);
-    src=UPLANE(imgsrc);
-    stride=w>>1;
-    for(uint32_t y=0;y<h>>1;y++)   // We do both u & v!
-    {
-        memcpy(dst,src,stride>>1);
-        dst+=stride;
-        src+=stride;
-    }
-        // V
-    dst=VPLANE(imgdisplay);
-    src=VPLANE(imgsrc);
-    stride=w>>1;
-    for(uint32_t y=0;y<h>>1;y++)   // We do both u & v!
-    {
-        memcpy(dst,src,stride>>1);
-        dst+=stride;
-        src+=stride;
-    }
-
-	if (resizer)
-		resizer->resize(imgdisplay->data, (uint8_t*)rgbbuffer);
-	else
-		rgbConv->scale(imgdisplay->data, (uint8_t*)rgbbuffer);
-}
-
+/****************************/
 //**
 float getAdj(GtkWidget *widget)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-08-13 16:31:01 UTC (rev 3503)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-08-13 17:01:25 UTC (rev 3504)
@@ -10,6 +10,7 @@
 DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       GUI_sdlRender.cpp
 DIA_builtin.cpp       DIA_flyChromaShift.cpp  DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     GUI_xvRender.cpp
 DIA_animated.cpp      DIA_ocr.cpp DIA_tsSub.cpp
+DIA_flyEq2.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_userInterfaces)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-13 17:01:25 UTC (rev 3504)
@@ -0,0 +1,105 @@
+/***************************************************************************
+                          ADM_guiContrast.cpp  -  description
+                             -------------------
+    begin                : Mon Sep 23 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+#include "default.h"
+#include "ADM_colorspace/ADM_rgb.h"
+
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_video/ADM_vidContrast.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyEq2.h"
+#include "ADM_osSupport/ADM_cpuCap.h"
+/************* COMMON PART *********************/
+uint8_t  flyEq2::update(void)
+{
+    download();
+    process();
+    copyYuvFinalToRgb();
+    display();
+    return 1;
+}
+
+uint8_t flyEq2::process(void)
+
+{
+	Eq2Settings mySettings;
+	uint8_t *src,*dst;
+	uint32_t stride;
+#if 0
+	printf("Contrast   :%f\n",param.contrast);
+	printf("brightness :%f\n",param.brightness);
+	printf("saturation :%f\n",param.saturation);
+	printf("rgamma :%f\n",param.rgamma);
+	printf("bgamma :%f\n",param.bgamma);
+	printf("ggamma :%f\n",param.ggamma);
+#endif	
+	
+	        update_lut(&mySettings,&param);
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+	        if(CpuCaps::hasMMX())
+	        {
+	                affine_1d_MMX(&(mySettings.param[0]),YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w,_h);
+	                affine_1d_MMX(&(mySettings.param[2]),UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),_w>>1,_h>>1);
+	                affine_1d_MMX(&(mySettings.param[1]),VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),_w>>1,_h>>1);       
+	        }
+	        else
+#endif	
+	        {
+	        	apply_lut(&(mySettings.param[0]),YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w,_h);
+	        	apply_lut(&(mySettings.param[2]),UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),_w>>1,_h>>1);
+	        	apply_lut(&(mySettings.param[1]),VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),_w>>1,_h>>1);       
+	        }
+#if 1
+	    // copy Y half
+	    dst=YPLANE(_yuvBufferOut);
+	    src=YPLANE(_yuvBuffer);
+	    stride=_w;
+	    for(uint32_t y=0;y<_h;y++)   // We do both u & v!
+	    {
+	        memcpy(dst,src,stride>>1);
+	        dst+=stride;
+	        src+=stride;
+	    }
+	        // U
+	    dst=UPLANE(_yuvBufferOut);
+	    src=UPLANE(_yuvBuffer);
+	    stride=_w>>1;
+	    uint32_t h2=_h>>1;
+	    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
+	    {
+	        memcpy(dst,src,stride>>1);
+	        dst+=stride;
+	        src+=stride;
+	    }
+	        // V
+	    dst=VPLANE(_yuvBufferOut);
+	    src=VPLANE(_yuvBuffer);
+	    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
+	    {
+	        memcpy(dst,src,stride>>1);
+	        dst+=stride;
+	        src+=stride;
+	    }
+#endif
+		return 1;
+}
+
+/************* COMMON PART *********************/

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.h	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h	2007-08-13 17:01:25 UTC (rev 3504)
@@ -0,0 +1,35 @@
+
+/***************************************************************************
+                        flyDialog for Eq2-Gtk
+                        (C) Mean 2007
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef FLY_EQ2_H
+#define FLY_EQ2_H
+#include "ADM_video/ADM_vidEq2.h"
+class flyEq2 : public ADM_flyDialog
+{
+  
+  public:
+   Eq2_Param  param;
+  public:
+   uint8_t    process(void);
+   uint8_t    download(void);
+   uint8_t    upload(void);
+   uint8_t    update(void);
+   			  flyEq2 (uint32_t width,uint32_t height,AVDMGenericVideoStream *in, void *canvas, void *slider) : 
+                                    	ADM_flyDialog(width, height,in,canvas, slider,1,RESIZE_AUTO)
+                    {
+                      
+                    };
+};
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-08-13 16:31:01 UTC (rev 3503)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-08-13 17:01:25 UTC (rev 3504)
@@ -13,7 +13,8 @@
 DIA_lavDecoder.cpp  DIA_srt.cpp \
 DIA_animated.cpp \
 DIA_ocr.cpp \
-DIA_tsSub.cpp
+DIA_tsSub.cpp \
+DIA_flyEq2.cpp
 
 commonObjs:=$(subst .cpp,.o,$(libADM_CommonUI_a_SOURCES))
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-13 16:31:01 UTC (rev 3503)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-13 17:01:25 UTC (rev 3504)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#include "config.h"
 #include <stdio.h>
 #include <math.h>
 
@@ -24,14 +24,10 @@
 #include <string.h>
 #include <ADM_assert.h>
 
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-#ifdef HAVE_ENCODER
 
+#include "default.h"
 
+
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
@@ -130,37 +126,6 @@
 {
    update_lut(&settings,_param);      
 }
-void update_lut(Eq2Settings *settings,Eq2_Param *_param)
-{
-     memset(settings,0,sizeof(settings));
-
-    settings->param[0].lut_clean=0;
-    settings->param[1].lut_clean=0;
-    settings->param[2].lut_clean=0;
-    settings->contrast=_param->contrast;
-    settings->param[0].c=_param->contrast;  
-    settings->brightness=_param->brightness;
-    settings->param[0].b=_param->brightness;;
-    settings->saturation=_param->saturation;
-    settings->param[1].c=_param->saturation;
-    settings->param[2].c=_param->saturation;
-    
-    
-    settings->ggamma=_param->ggamma;
-    settings->bgamma=_param->bgamma;
-    settings->rgamma=_param->rgamma;
-    settings->gamma=_param->gamma;
-    settings->param[0].g=settings->gamma*settings->ggamma;
-    settings->param[1].g=sqrt(settings->bgamma/settings->ggamma);
-    settings->param[2].g=sqrt(settings->rgamma/settings->ggamma);
-    settings->param[0].w=settings->param[1].w=settings->param[2].w=
-    settings->gamma_weight=_param->gamma_weight;   
-
-
-    create_lut(&(settings->param[0]));
-    create_lut(&(settings->param[1]));
-    create_lut(&(settings->param[2])); 
-}          
 ADMVideoEq2::~ADMVideoEq2()
 {
   delete _param;
@@ -226,7 +191,40 @@
   return 1;
 }
 
+void update_lut(Eq2Settings *settings,Eq2_Param *_param)
+{
+     memset(settings,0,sizeof(settings));
 
+    settings->param[0].lut_clean=0;
+    settings->param[1].lut_clean=0;
+    settings->param[2].lut_clean=0;
+    settings->contrast=_param->contrast;
+    settings->param[0].c=_param->contrast;  
+    settings->brightness=_param->brightness;
+    settings->param[0].b=_param->brightness;;
+    settings->saturation=_param->saturation;
+    settings->param[1].c=_param->saturation;
+    settings->param[2].c=_param->saturation;
+    
+    
+    settings->ggamma=_param->ggamma;
+    settings->bgamma=_param->bgamma;
+    settings->rgamma=_param->rgamma;
+    settings->gamma=_param->gamma;
+    if(settings->ggamma<0.1) settings->ggamma=0.1;
+    //printf("GGamma:%f\n",settings->ggamma);
+    settings->param[0].g=settings->gamma*settings->ggamma;
+    settings->param[1].g=sqrt(settings->bgamma/settings->ggamma);
+    settings->param[2].g=sqrt(settings->rgamma/settings->ggamma);
+    settings->param[0].w=settings->param[1].w=settings->param[2].w=
+    settings->gamma_weight=_param->gamma_weight;   
+
+
+    create_lut(&(settings->param[0]));
+    create_lut(&(settings->param[1]));
+    create_lut(&(settings->param[2])); 
+}          
+
 void create_lut (oneSetting *par)
 {
   unsigned i;
@@ -388,4 +386,4 @@
     dst += dstride;
   }
 }  
-#endif
+



From mean at mail.berlios.de  Mon Aug 13 19:16:01 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 19:16:01 +0200
Subject: [Avidemux-svn-commit] r3505 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec
Message-ID: <200708131716.l7DHG1u6030992@sheep.berlios.de>

Author: mean
Date: 2007-08-13 19:16:00 +0200 (Mon, 13 Aug 2007)
New Revision: 3505

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/Makefile.am
Log:
[Automake] Add incpath to build libmpeg2dec

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/Makefile.am	2007-08-13 17:01:25 UTC (rev 3504)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/Makefile.am	2007-08-13 17:16:00 UTC (rev 3505)
@@ -18,4 +18,4 @@
 
 #ugly trick to enable MMX
 #INCLUDES = $(all_includes) $(LMPG_OPT)
-INCLUDES = $(all_includes)  $(ALTIVEC_SWITCH)
+INCLUDES = $(all_includes)  $(ALTIVEC_SWITCH) -I../ADM_utilities



From mean at mail.berlios.de  Mon Aug 13 19:18:59 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 19:18:59 +0200
Subject: [Avidemux-svn-commit] r3506 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200708131718.l7DHIxE2004928@sheep.berlios.de>

Author: mean
Date: 2007-08-13 19:18:58 +0200 (Mon, 13 Aug 2007)
New Revision: 3506

Modified:
   branches/avidemux_2.4_branch/avidemux/Makefile.am
Log:
[Automake] Link with imageLoader

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-13 17:16:00 UTC (rev 3505)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-13 17:18:58 UTC (rev 3506)
@@ -103,7 +103,6 @@
 ./ADM_libraries/ADM_smjs/libADM_smjs.a			\
 ./ADM_videoFilter/libADM_videoFilter.a			\
 ./ADM_video/libADM_video.a				\
-./ADM_colorspace/libADM_colorspace.a			\
 ./ADM_audiodevice/libADM_audiodevice.a			\
 ./ADM_outputs/oplug_mp4/liboplug_mp4.a			\
 ./ADM_outputs/oplug_mpeg/liboplug_mpeg.a		\
@@ -142,6 +141,7 @@
 
 adm_postlib= \
 ./ADM_libraries/ADM_utilities/libADM_library.a		\
+./ADM_colorspace/libADM_colorspace.a			\
 ./ADM_osSupport/libADM_ossupport.a			\
 ./ADM_libraries/ADM_libswscale/libswscale.a		\
 $(libmpeg2enc_Altivec) \



From gruntster at mail.berlios.de  Mon Aug 13 21:22:36 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 13 Aug 2007 21:22:36 +0200
Subject: [Avidemux-svn-commit] r3507 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_libraries/ADM_lavcodec/i386 avidemux/ADM_osSupport
Message-ID: <200708131922.l7DJMa6W028407@sheep.berlios.de>

Author: gruntster
Date: 2007-08-13 21:22:12 +0200 (Mon, 13 Aug 2007)
New Revision: 3507

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
   branches/avidemux_2.4_branch/config.h.cmake
   branches/avidemux_2.4_branch/configure.in.in
Log:
[lav] use SSSE3 if available + add configure option to exclude SSSE3 from compilation (for when binutils is too old)

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-13 19:22:12 UTC (rev 3507)
@@ -50,6 +50,10 @@
 SET(HAVE_THREADS 1)
 SET(RUNTIME_CPUDETECT    1)
 
+IF (NOT NO_SSSE3)
+	SET(HAVE_SSSE3 1)
+ENDIF(NOT NO_SSSE3)
+
 # mpeg2dec
 SET(ACCEL_DETECT 1)
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c	2007-08-13 19:22:12 UTC (rev 3507)
@@ -731,6 +731,7 @@
         if(dct_algo==FF_DCT_AUTO || dct_algo==FF_DCT_MMX){
 #ifdef HAVE_SSSE3
             if(mm_flags & MM_SSSE3){
+				av_log(s->avctx, AV_LOG_INFO, "We're using SSSE3!!!\n");
                 s->dct_quantize= dct_quantize_SSSE3;
             } else
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-13 19:22:12 UTC (rev 3507)
@@ -24,18 +24,20 @@
 
   void 	CpuCaps::init( void)
 {
-	printf("Checking cpu capabilities\n");
+	printf("Checking CPU capabilities\n");
 int probed=0;
 #if defined( ARCH_X86)  || defined(ARCH_X86_64)
 	probed=mm_support();
-#define CHECK(x) if(probed & MM_##x) { CpuCaps::myCpuCaps|=ADM_CPU_##x;printf("\tCpu has "#x"\n");}
+#define CHECK(x) if(probed & MM_##x) { CpuCaps::myCpuCaps|=ADM_CPU_##x;printf("\t\t"#x"\n");}
 	CHECK(MMX);
 	CHECK(3DNOW);
 	CHECK(MMXEXT);
 	CHECK(SSE);
-	CHECK(SSE2);	
+	CHECK(SSE2);
+	CHECK(SSE3);
+	CHECK(SSSE3);
 #endif	
-	printf("End of cpu capabilities check\n");
+	printf("End of CPU capabilities check\n");
 }
 /*
         Returns # of threads to use,  0 means multithreading disabled

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-13 19:22:12 UTC (rev 3507)
@@ -25,7 +25,9 @@
         ADM_CPU_3DNOW  =1<<3,
         ADM_CPU_SSE    =1<<4,
         ADM_CPU_SSE2   =1<<5,
-        ADM_CPU_ALTIVEC=1<<6,
+		ADM_CPU_SSE3   =1<<6,
+		ADM_CPU_SSSE3  =1<<7,
+        ADM_CPU_ALTIVEC=1<<8,
 } ADM_CPU_CAPS;
 
 class CpuCaps

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-13 19:22:12 UTC (rev 3507)
@@ -133,6 +133,7 @@
 /* FFMPEG */
 #cmakedefine HAVE_FAST_UNALIGNED
 #cmakedefine HAVE_FAST_64BIT
+#cmakedefine HAVE_SSSE3
 
 /* FontConfig detected */
 #cmakedefine HAVE_FONTCONFIG

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-08-13 17:18:58 UTC (rev 3506)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-08-13 19:22:12 UTC (rev 3507)
@@ -1417,6 +1417,14 @@
 AC_DEFINE(HAVE_THREADS,1,[HAVE_THREADS])
 AC_DEFINE(ENABLE_THREADS,1,[ENABLE_THREADS])
 
+AC_ARG_ENABLE([ssse3],
+	[AC_HELP_STRING([--disable-ssse3], [disable SSSE3 extensions [default=no]])],
+	[disable_ssse3=${enableval}], [disable_ssse3=no])
+
+if test "x$disable_ssse3" = "xno"; then
+	AC_DEFINE(HAVE_SSSE3, 1, [use SSSE3 extensions with libavcodec])
+fi
+
 dnl ________________ libmpeg2 _________________
 AC_DEFINE(ACCEL_DETECT,1,[MPEG2DEC])
 



From gruntster at mail.berlios.de  Mon Aug 13 21:36:03 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 13 Aug 2007 21:36:03 +0200
Subject: [Avidemux-svn-commit] r3508 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386
Message-ID: <200708131936.l7DJa3bT029574@sheep.berlios.de>

Author: gruntster
Date: 2007-08-13 21:35:55 +0200 (Mon, 13 Aug 2007)
New Revision: 3508

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c
Log:
[lav] oops, remove extra logging

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c	2007-08-13 19:22:12 UTC (rev 3507)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/mpegvideo_mmx.c	2007-08-13 19:35:55 UTC (rev 3508)
@@ -731,7 +731,6 @@
         if(dct_algo==FF_DCT_AUTO || dct_algo==FF_DCT_MMX){
 #ifdef HAVE_SSSE3
             if(mm_flags & MM_SSSE3){
-				av_log(s->avctx, AV_LOG_INFO, "We're using SSSE3!!!\n");
                 s->dct_quantize= dct_quantize_SSSE3;
             } else
 #endif



From mean at mail.berlios.de  Mon Aug 13 22:27:19 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 13 Aug 2007 22:27:19 +0200
Subject: [Avidemux-svn-commit] r3509 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <200708132027.l7DKRJEe032531@sheep.berlios.de>

Author: mean
Date: 2007-08-13 22:27:18 +0200 (Mon, 13 Aug 2007)
New Revision: 3509

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/eq2.ui
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
Log:
[QT4] flyDialog for Eq2, same bug as in Gtk

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2007-08-13 19:35:55 UTC (rev 3508)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2007-08-13 20:27:18 UTC (rev 3509)
@@ -8,6 +8,7 @@
 asharp
 chromashift
 contrast
+eq2
 crop
 encoding
 hue

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-13 19:35:55 UTC (rev 3508)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-13 20:27:18 UTC (rev 3509)
@@ -48,7 +48,6 @@
 #include "ADM_video/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
-#include "ADM_video/ADM_vidEq2.h"
 #include "ADM_video/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
@@ -77,7 +76,6 @@
 #endif
 int     DIA_coloryuv(COLOR_YUV_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
-uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-08-13 19:35:55 UTC (rev 3508)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-08-13 20:27:18 UTC (rev 3509)
@@ -9,6 +9,7 @@
 AQ_srt.cpp \
 AT_index_pg.cpp DIA_x264.cpp \
 AQ_vobsub.cpp \
+AQ_eq2.cpp
 DIA_srt.cpp
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-08-13 08:19:48 UTC (rev 3497)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-13 20:27:18 UTC (rev 3509)
@@ -0,0 +1,173 @@
+/***************************************************************************
+                          Q_eq2.cpp  -  description
+
+                flyDialog for MPlayer EQ2 filter
+    copyright            : (C) 2002/2007 by mean Fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+
+#include "ui_eq2.h"
+
+#include "default.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_colorspace/ADM_rgb.h"
+#include "ADM_assert.h"
+#include "ADM_video/ADM_vidEq2.h"
+
+#include "DIA_flyDialog.h"
+#include "DIA_flyDialogQt4.h"
+#include "ADM_video/ADM_vidEq2.h"
+#include "DIA_flyEq2.h"
+
+//
+//	Video is in YV12 Colorspace
+//
+//
+class Ui_eq2Window : public QDialog
+ {
+     Q_OBJECT
+ protected : 
+    int lock;
+ public:
+     flyEq2 *myCrop;
+     ADM_QCanvas *canvas;
+     Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in);
+     ~Ui_eq2Window();
+     Ui_DialogEq2 ui;
+ public slots:
+      void gather(Eq2_Param *param);
+      //void update(int i);
+ private slots:
+   void sliderUpdate(int foo);
+   void valueChanged(int foo);
+
+ private:
+     
+ };
+  Ui_eq2Window::Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in)
+  {
+    uint32_t width,height;
+        ui.setupUi(this);
+        lock=0;
+        // Allocate space for green-ised video
+        width=in->getInfo()->width;
+        height=in->getInfo()->height;
+
+        canvas=new ADM_QCanvas(ui.graphicsView,width,height);
+        
+        myCrop=new flyEq2( width, height,in,canvas,ui.horizontalSlider);
+        memcpy(&(myCrop->param),param,sizeof(Eq2_Param));
+        myCrop->_cookie=&ui;
+        myCrop->upload();
+        myCrop->sliderChanged();
+
+
+        connect( ui.horizontalSlider,SIGNAL(valueChanged(int)),this,SLOT(sliderUpdate(int)));
+#define SPINNER(x) connect( ui.horizontalSlider##x,SIGNAL(valueChanged(int)),this,SLOT(valueChanged(int))); 
+        SPINNER(Red);
+        SPINNER(Blue);
+        SPINNER(Green);
+         
+        SPINNER(Contrast);
+        SPINNER(Brightness);
+        SPINNER(Saturation);
+
+        SPINNER(Initial);
+        SPINNER(Weight);
+  }
+  void Ui_eq2Window::sliderUpdate(int foo)
+  {
+    myCrop->sliderChanged();
+  }
+  void Ui_eq2Window::gather(Eq2_Param *param)
+  {
+    
+        myCrop->download();
+        memcpy(param,&(myCrop->param),sizeof(Eq2_Param));
+  }
+Ui_eq2Window::~Ui_eq2Window()
+{
+  if(myCrop) delete myCrop;
+  myCrop=NULL; 
+  if(canvas) delete canvas;
+  canvas=NULL;
+}
+void Ui_eq2Window::valueChanged( int f )
+{
+  if(lock) return;
+  lock++;
+  myCrop->update();
+  lock--;
+}
+
+#define sliderSet(x,y) w->horizontalSlider##x->setValue((int)(param.y*10));
+#define sliderGet(x,y) param.y=w->horizontalSlider##x->value()/10.;
+//************************
+uint8_t flyEq2::upload(void)
+{
+Ui_DialogEq2 *w=(Ui_DialogEq2 *)_cookie;
+
+        sliderSet(Contrast,contrast);
+        sliderSet(Brightness,brightness);
+        sliderSet(Saturation,saturation);
+
+        sliderSet(Red,rgamma);
+        sliderSet(Green,ggamma);
+        sliderSet(Blue,bgamma);
+
+        sliderSet(Initial,gamma);
+        sliderSet(Weight,gamma);
+       return 1;
+}
+uint8_t flyEq2::download(void)
+{
+Ui_DialogEq2 *w=(Ui_DialogEq2 *)_cookie;
+
+        sliderGet(Contrast,contrast);
+        sliderGet(Brightness,brightness);
+        sliderGet(Saturation,saturation);
+
+        sliderGet(Red,rgamma);
+        sliderGet(Green,ggamma);
+        sliderGet(Blue,bgamma);
+
+        sliderGet(Initial,gamma);
+        sliderGet(Weight,gamma);
+
+return 1;
+}
+/**
+      \fn     DIA_getEQ2Param
+      \brief  Handle MPlayer EQ2 flyDialog
+*/
+uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in)
+{
+        uint8_t ret=0;
+        
+        Ui_eq2Window dialog(param,in);        
+        if(dialog.exec()==QDialog::Accepted)
+        {
+            dialog.gather(param); 
+            ret=1;
+        }
+        return ret;
+}
+//____________________________________
+// EOF
+
+

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/eq2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/eq2.ui	2007-08-13 19:35:55 UTC (rev 3508)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/eq2.ui	2007-08-13 20:27:18 UTC (rev 3509)
@@ -0,0 +1,270 @@
+<ui version="4.0" >
+ <class>DialogEq2</class>
+ <widget class="QDialog" name="DialogEq2" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>651</width>
+    <height>560</height>
+   </rect>
+  </property>
+  <property name="windowTitle" >
+   <string>Contrast</string>
+  </property>
+  <layout class="QGridLayout" >
+   <property name="margin" >
+    <number>9</number>
+   </property>
+   <property name="spacing" >
+    <number>6</number>
+   </property>
+   <item row="5" column="0" colspan="3" >
+    <widget class="QDialogButtonBox" name="buttonBox" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+     <property name="standardButtons" >
+      <set>QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok</set>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="0" colspan="3" >
+    <widget class="QSlider" name="horizontalSlider" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+    </widget>
+   </item>
+   <item row="3" column="0" colspan="3" >
+    <widget class="QGraphicsView" name="graphicsView" />
+   </item>
+   <item row="4" column="2" >
+    <spacer>
+     <property name="orientation" >
+      <enum>Qt::Vertical</enum>
+     </property>
+     <property name="sizeType" >
+      <enum>QSizePolicy::Ignored</enum>
+     </property>
+     <property name="sizeHint" >
+      <size>
+       <width>20</width>
+       <height>40</height>
+      </size>
+     </property>
+    </spacer>
+   </item>
+   <item row="0" column="1" >
+    <widget class="QLabel" name="label_4" >
+     <property name="text" >
+      <string>&lt;b>Gamma&lt;/b></string>
+     </property>
+     <property name="textFormat" >
+      <enum>Qt::RichText</enum>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0" >
+    <layout class="QGridLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item row="4" column="0" >
+      <widget class="QLabel" name="label_3" >
+       <property name="text" >
+        <string>Saturation</string>
+       </property>
+      </widget>
+     </item>
+     <item row="2" column="0" >
+      <widget class="QLabel" name="label_2" >
+       <property name="text" >
+        <string>Brightness</string>
+       </property>
+      </widget>
+     </item>
+     <item row="0" column="0" >
+      <widget class="QLabel" name="label" >
+       <property name="text" >
+        <string>Contrast</string>
+       </property>
+      </widget>
+     </item>
+     <item row="1" column="0" >
+      <widget class="QSlider" name="horizontalSliderContrast" >
+       <property name="minimum" >
+        <number>-200</number>
+       </property>
+       <property name="maximum" >
+        <number>200</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="3" column="0" >
+      <widget class="QSlider" name="horizontalSliderBrightness" >
+       <property name="minimum" >
+        <number>-100</number>
+       </property>
+       <property name="maximum" >
+        <number>100</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="5" column="0" >
+      <widget class="QSlider" name="horizontalSliderSaturation" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="tickInterval" >
+        <number>1</number>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+   <item row="1" column="1" >
+    <layout class="QGridLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item row="2" column="1" >
+      <widget class="QSlider" name="horizontalSliderGreen" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="3" column="1" >
+      <widget class="QSlider" name="horizontalSliderBlue" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="3" column="0" >
+      <widget class="QLabel" name="label_9" >
+       <property name="text" >
+        <string>Blue</string>
+       </property>
+      </widget>
+     </item>
+     <item row="1" column="0" >
+      <widget class="QLabel" name="label_6" >
+       <property name="text" >
+        <string>Red</string>
+       </property>
+      </widget>
+     </item>
+     <item row="0" column="0" >
+      <widget class="QLabel" name="label_5" >
+       <property name="text" >
+        <string>Initial</string>
+       </property>
+      </widget>
+     </item>
+     <item row="4" column="0" >
+      <widget class="QLabel" name="label_7" >
+       <property name="text" >
+        <string>Weight</string>
+       </property>
+      </widget>
+     </item>
+     <item row="1" column="1" >
+      <widget class="QSlider" name="horizontalSliderRed" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="2" column="0" >
+      <widget class="QLabel" name="label_8" >
+       <property name="text" >
+        <string>Green</string>
+       </property>
+      </widget>
+     </item>
+     <item row="0" column="1" >
+      <widget class="QSlider" name="horizontalSliderInitial" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item row="4" column="1" >
+      <widget class="QSlider" name="horizontalSliderWeight" >
+       <property name="maximum" >
+        <number>300</number>
+       </property>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+  </layout>
+ </widget>
+ <resources/>
+ <connections>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>accepted()</signal>
+   <receiver>DialogEq2</receiver>
+   <slot>accept()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>248</x>
+     <y>254</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>157</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>buttonBox</sender>
+   <signal>rejected()</signal>
+   <receiver>DialogEq2</receiver>
+   <slot>reject()</slot>
+   <hints>
+    <hint type="sourcelabel" >
+     <x>316</x>
+     <y>260</y>
+    </hint>
+    <hint type="destinationlabel" >
+     <x>286</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
+</ui>



From mean at mail.berlios.de  Tue Aug 14 10:29:01 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 14 Aug 2007 10:29:01 +0200
Subject: [Avidemux-svn-commit] r3510 - in
	branches/avidemux_2.4_branch/avidemux: ADM_libraries/ADM_utilities
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_commonUI ADM_video
Message-ID: <200708140829.l7E8T1cU018500@sheep.berlios.de>

Author: mean
Date: 2007-08-14 10:29:00 +0200 (Tue, 14 Aug 2007)
New Revision: 3510

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
Log:
[Filter] Fix eq2 + finish qt4 version

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_image.h	2007-08-14 08:29:00 UTC (rev 3510)
@@ -144,7 +144,7 @@
         uint8_t copyTo(ADMImage *target, uint32_t x, uint32_t y);
         uint8_t copyToAlpha(ADMImage *target, uint32_t x, uint32_t y,uint32_t alpha);
         uint8_t pack(uint8_t invertChroma);     /// Transfer data from planes to regular packed space
-        
+        uint8_t copyLeftSideTo(ADMImage *dest);
         /* Some utilitarian functions */
         uint8_t  saveAsBmp(const char *filename);
         uint8_t  saveAsJpg(const char *filename);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	2007-08-14 08:29:00 UTC (rev 3510)
@@ -514,4 +514,48 @@
   return 1;
   
 }
+ /**
+  *		\fn  copyLeftSideTo
+  * 	\brief Copy half the image (left part) to dest
+  * 	@param dest : Image to copy to 
+  */
+ uint8_t ADMImage::copyLeftSideTo(ADMImage *dest)
+ {
+		uint8_t *src,*dst;
+		uint32_t stride;
+ 
+			ADM_assert(_width==dest->_width);
+			ADM_assert(_height==dest->_height);
+		
+	 		dst=YPLANE(dest);
+		    src=YPLANE(this);
+		    stride=_width;
+		    for(uint32_t y=0;y<_height;y++)   // We do both u & v!
+		    {
+		        memcpy(dst,src,stride>>1);
+		        dst+=stride;
+		        src+=stride;
+		    }
+		        // U
+		    dst=UPLANE(dest);
+		    src=UPLANE(this);
+		    stride=_width>>1;
+		    uint32_t h2=_height>>1;
+		    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
+		    {
+		        memcpy(dst,src,stride>>1);
+		        dst+=stride;
+		        src+=stride;
+		    }
+		        // V
+		    dst=VPLANE(dest);
+		    src=VPLANE(this);
+		    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
+		    {
+		        memcpy(dst,src,stride>>1);
+		        dst+=stride;
+		        src+=stride;
+		    }
+		    return 1;
+ }
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
@@ -73,11 +73,13 @@
         myCrop=new flyEq2( w, h,in,WID(drawingarea1),WID(hscale1));
         memcpy(&(myCrop->param),param,sizeof(Eq2_Param));
         myCrop->upload();
+        myCrop->sliderChanged();
+        myCrop->update();
         
         int ret=0;
         int response;
         //-----------------------
-        gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), "expose_event", GTK_SIGNAL_FUNC(draw),   NULL);
+        
 #define HCONECT(x)  gtk_signal_connect(GTK_OBJECT(WID(hscale##x)), "value_changed",GTK_SIGNAL_FUNC(eq2_changed),   NULL);
 
         HCONECT(Brightness);
@@ -89,9 +91,8 @@
         HCONECT(GammaR);
         HCONECT(GammaG);
         HCONECT(GammaB);
+        gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), "expose_event", GTK_SIGNAL_FUNC(draw),   NULL);
         gtk_signal_connect(GTK_OBJECT(WID(hscale1)), "value_changed",GTK_SIGNAL_FUNC(frame_changed),   NULL);
-        myCrop->sliderChanged();
-        myCrop->update();
         //-----------------------
         response=gtk_dialog_run(GTK_DIALOG(dialog));
 
@@ -111,8 +112,8 @@
 /**************************************/
 #undef SET
 #undef GET
-#define SET(x,y)        setAdj(WID(hscale##x),param.y)
-#define GET(x,y)        param.y=getAdj(WID(hscale##x))
+#define SET(x,y)        gtk_range_set_value (GTK_RANGE(WID(hscale##x)),(gdouble)param.y)
+#define GET(x,y)        param.y= (float)gtk_range_get_value (GTK_RANGE(WID(hscale##x)))
 
 
 uint8_t flyEq2::upload(void)
@@ -162,21 +163,8 @@
     myCrop->display();
 	return true;
 }
-/****************************/
 //**
-float getAdj(GtkWidget *widget)
-{
-GtkAdjustment *adj;        
-        adj=gtk_range_get_adjustment (GTK_RANGE(widget));
-        return (float)adj->value;
-}
-void setAdj(GtkWidget *widget,float val)
-{
- gtk_range_set_value (GTK_RANGE(widget),(gdouble)val);
-}
 
-//**
-
 GtkWidget*
 create_dialog1 (void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
@@ -75,6 +75,7 @@
         myCrop->_cookie=&ui;
         myCrop->upload();
         myCrop->sliderChanged();
+        myCrop->update();
 
 
         connect( ui.horizontalSlider,SIGNAL(valueChanged(int)),this,SLOT(sliderUpdate(int)));
@@ -115,13 +116,14 @@
   lock--;
 }
 
-#define sliderSet(x,y) w->horizontalSlider##x->setValue((int)(param.y*10));
-#define sliderGet(x,y) param.y=w->horizontalSlider##x->value()/10.;
+#define sliderSet(x,y) w->horizontalSlider##x->setValue((int)(param.y*100));
+#define sliderGet(x,y) param.y=w->horizontalSlider##x->value()/100.;
 //************************
 uint8_t flyEq2::upload(void)
 {
 Ui_DialogEq2 *w=(Ui_DialogEq2 *)_cookie;
 
+
         sliderSet(Contrast,contrast);
         sliderSet(Brightness,brightness);
         sliderSet(Saturation,saturation);
@@ -131,7 +133,8 @@
         sliderSet(Blue,bgamma);
 
         sliderSet(Initial,gamma);
-        sliderSet(Weight,gamma);
+        sliderSet(Weight,gamma_weight);
+        
        return 1;
 }
 uint8_t flyEq2::download(void)
@@ -147,7 +150,7 @@
         sliderGet(Blue,bgamma);
 
         sliderGet(Initial,gamma);
-        sliderGet(Weight,gamma);
+        sliderGet(Weight,gamma_weight);
 
 return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
@@ -41,63 +41,43 @@
 
 {
 	Eq2Settings mySettings;
-	uint8_t *src,*dst;
-	uint32_t stride;
+
 #if 0
 	printf("Contrast   :%f\n",param.contrast);
 	printf("brightness :%f\n",param.brightness);
 	printf("saturation :%f\n",param.saturation);
+	
+	printf("gamma_weight :%f\n",param.gamma_weight);
+	printf("gamma :%f\n",param.gamma);
+	
+	
+	
 	printf("rgamma :%f\n",param.rgamma);
 	printf("bgamma :%f\n",param.bgamma);
 	printf("ggamma :%f\n",param.ggamma);
+	printf("******************\n");
 #endif	
 	
 	        update_lut(&mySettings,&param);
+	        
+typedef void lutMeType(oneSetting *par, unsigned char *dst, unsigned char *src, unsigned int w, unsigned int h);
+
+			lutMeType *lutMe=apply_lut;
+			
+
 #if (defined( ARCH_X86)  || defined(ARCH_X86_64))
 	        if(CpuCaps::hasMMX())
 	        {
-	                affine_1d_MMX(&(mySettings.param[0]),YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w,_h);
-	                affine_1d_MMX(&(mySettings.param[2]),UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),_w>>1,_h>>1);
-	                affine_1d_MMX(&(mySettings.param[1]),VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),_w>>1,_h>>1);       
+	        		lutMe=affine_1d_MMX;
 	        }
-	        else
 #endif	
-	        {
-	        	apply_lut(&(mySettings.param[0]),YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w,_h);
-	        	apply_lut(&(mySettings.param[2]),UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),_w>>1,_h>>1);
-	        	apply_lut(&(mySettings.param[1]),VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),_w>>1,_h>>1);       
-	        }
-#if 1
-	    // copy Y half
-	    dst=YPLANE(_yuvBufferOut);
-	    src=YPLANE(_yuvBuffer);
-	    stride=_w;
-	    for(uint32_t y=0;y<_h;y++)   // We do both u & v!
-	    {
-	        memcpy(dst,src,stride>>1);
-	        dst+=stride;
-	        src+=stride;
-	    }
-	        // U
-	    dst=UPLANE(_yuvBufferOut);
-	    src=UPLANE(_yuvBuffer);
-	    stride=_w>>1;
-	    uint32_t h2=_h>>1;
-	    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
-	    {
-	        memcpy(dst,src,stride>>1);
-	        dst+=stride;
-	        src+=stride;
-	    }
-	        // V
-	    dst=VPLANE(_yuvBufferOut);
-	    src=VPLANE(_yuvBuffer);
-	    for(uint32_t y=0;y<h2;y++)   // We do both u & v!
-	    {
-	        memcpy(dst,src,stride>>1);
-	        dst+=stride;
-	        src+=stride;
-	    }
+	        lutMe(&(mySettings.param[0]),YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w,_h);
+	        lutMe(&(mySettings.param[2]),UPLANE(_yuvBufferOut),UPLANE(_yuvBuffer),_w>>1,_h>>1);
+	        lutMe(&(mySettings.param[1]),VPLANE(_yuvBufferOut),VPLANE(_yuvBuffer),_w>>1,_h>>1);       
+
+	        	
+	        	#if 1
+	        _yuvBuffer->copyLeftSideTo(_yuvBufferOut);
 #endif
 		return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-13 20:27:18 UTC (rev 3509)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
@@ -199,27 +199,36 @@
     settings->param[1].lut_clean=0;
     settings->param[2].lut_clean=0;
     settings->contrast=_param->contrast;
-    settings->param[0].c=_param->contrast;  
     settings->brightness=_param->brightness;
-    settings->param[0].b=_param->brightness;;
     settings->saturation=_param->saturation;
-    settings->param[1].c=_param->saturation;
-    settings->param[2].c=_param->saturation;
     
-    
     settings->ggamma=_param->ggamma;
     settings->bgamma=_param->bgamma;
     settings->rgamma=_param->rgamma;
     settings->gamma=_param->gamma;
+
+    settings->gamma_weight=_param->gamma_weight;
+    
     if(settings->ggamma<0.1) settings->ggamma=0.1;
-    //printf("GGamma:%f\n",settings->ggamma);
+    
+    settings->param[0].c=_param->contrast;  
+    settings->param[0].b=_param->brightness;;
     settings->param[0].g=settings->gamma*settings->ggamma;
+    settings->param[0].w=settings->gamma_weight;
+    
+    
+    	
+    settings->param[1].c=_param->saturation;
+    settings->param[1].b=0;
     settings->param[1].g=sqrt(settings->bgamma/settings->ggamma);
+    settings->param[1].w=settings->gamma_weight;
+    
+    settings->param[2].c=_param->saturation;
+    settings->param[2].b=0;
     settings->param[2].g=sqrt(settings->rgamma/settings->ggamma);
-    settings->param[0].w=settings->param[1].w=settings->param[2].w=
-    settings->gamma_weight=_param->gamma_weight;   
-
-
+    settings->param[2].w=settings->gamma_weight;
+    
+    //printf("GGamma:%f\n",settings->ggamma);
     create_lut(&(settings->param[0]));
     create_lut(&(settings->param[1]));
     create_lut(&(settings->param[2])); 



From mean at mail.berlios.de  Tue Aug 14 10:34:13 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 14 Aug 2007 10:34:13 +0200
Subject: [Avidemux-svn-commit] r3511 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
Message-ID: <200708140834.l7E8YDaH019067@sheep.berlios.de>

Author: mean
Date: 2007-08-14 10:34:12 +0200 (Tue, 14 Aug 2007)
New Revision: 3511

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filter] Move Eq2 to videoFilter

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -34,7 +34,7 @@
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
 
-#include "ADM_video/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyEq2.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -48,7 +48,7 @@
 #include "ADM_video/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
-#include "ADM_video/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
 #include "ADM_video/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -27,11 +27,11 @@
 #include "ADM_video/ADM_genvideo.hxx"
 #include "ADM_colorspace/ADM_rgb.h"
 #include "ADM_assert.h"
-#include "ADM_video/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
 
 #include "DIA_flyDialog.h"
 #include "DIA_flyDialogQt4.h"
-#include "ADM_video/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
 #include "DIA_flyEq2.h"
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h	2007-08-14 08:34:12 UTC (rev 3511)
@@ -14,7 +14,7 @@
  ***************************************************************************/
 #ifndef FLY_EQ2_H
 #define FLY_EQ2_H
-#include "ADM_video/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
 class flyEq2 : public ADM_flyDialog
 {
   

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -1,398 +0,0 @@
-/***************************************************************************
-                          Hue/Saturation filter ported from mplayer 
- (c)  * Software equalizer (brightness, contrast, gamma, saturation)
- *
- * Hampa Hug <hampa at hampa.ch> (original LUT gamma/contrast/brightness filter)
- * Daniel Moreno <comac at comac.darktech.org> (saturation, R/G/B gamma support)
- * Richard Felker (original MMX contrast/brightness code (vf_eq.c))
- * Michael Niedermayer <michalni at gmx.at> (LUT16)
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-#include <stdio.h>
-#include <math.h>
-
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-
-#include "default.h"
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_filter/video_filters.h"
-#include "ADM_userInterfaces/ADM_commonUI/DIA_enter.h"
-#include "ADM_video/ADM_cache.h"
-
-#include "admmangle.h"
-#include "ADM_osSupport/ADM_cpuCap.h"
-#include "ADM_vidEq2.h"
-static FILTER_PARAM Eq2Param={8,{"contrast","brightness","saturation",
-                                "gamma","gamma_weight","rgamma","ggamma","bgamma"}};
-
-/*=====================================*/
-/*=====================================*/
-class  ADMVideoEq2:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            void            update(void);
-            Eq2_Param       *_param;    
-            VideoCache      *vidCache; 
-            float           _hue;
-            float           _saturation;
-            Eq2Settings     settings;            
-  public:
-                
-                        ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *setup);
-    virtual             ~ADMVideoEq2();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(Eq2_script,ADMVideoEq2,Eq2Param);
-BUILD_CREATE(Eq2_create,ADMVideoEq2);
-
-
-uint8_t ADMVideoEq2::configure(AVDMGenericVideoStream *in)
-{
-  uint8_t r=1;
-  float h,s;
-  _in=in;   
-  r=DIA_getEQ2Param(_param,in);
-  update();
-  return r;        
-}
-char *ADMVideoEq2::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf," Eq2 :Cont:%1.2f Brigh:%1.2f Sat:%1.2f",
-                _param->contrast,_param->brightness,_param->saturation);
-  return buf;
-}
-
-ADMVideoEq2::ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&_info,_in->getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  Eq2_Param;
-  if(couples)
-  {                 
-    GET(contrast); 
-    GET(brightness);    
-    GET(saturation); 
-    GET(gamma); 
-    GET(gamma_weight); 
-    GET(rgamma); 
-    GET(ggamma); 
-    GET(bgamma); 
-  }
-  else
-  {
-    _param->contrast =1.0;                
-    _param->brightness=0.0;
-    _param->saturation =1.0;  
-    _param->gamma =1.0; 
-    _param->gamma_weight=1.0; 
-    _param->rgamma =1.0; 
-    _param->ggamma =1.0; 
-    _param->bgamma =1.0;    
-  }      
-  vidCache=new VideoCache(1,_in);
-  update();
-    
-   
-}
-void ADMVideoEq2::update(void)
-{
-   update_lut(&settings,_param);      
-}
-ADMVideoEq2::~ADMVideoEq2()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoEq2::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(8);
-
-
-                CSET(contrast);
-                CSET(brightness);
-                CSET(saturation);
-                CSET(gamma); 
-                CSET(gamma_weight); 
-                CSET(rgamma); 
-                CSET(ggamma); 
-                CSET(bgamma); 
-                return 1;
-}
-
-
-uint8_t ADMVideoEq2::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc=NULL;
-  
-
-  if(frame>=_info.nb_frames) return 0;
-  
-  mysrc=vidCache->getImage(frame);
-  if(!mysrc) return 0;
-  
-  uint32_t w,h;
-  w=_info.width;
-  h=_info.height;
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-  if(CpuCaps::hasMMX())
-  {
-        affine_1d_MMX(&(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w>>=1;
-        h>>=1;
-        affine_1d_MMX(&(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        affine_1d_MMX(&(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-   }
-   else
-#endif
-   {
-        apply_lut(&(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w>>=1;
-        h>>=1;
-        apply_lut(&(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        apply_lut(&(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-    }
-  vidCache->unlockAll();
-  
-  
-  return 1;
-}
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param)
-{
-     memset(settings,0,sizeof(settings));
-
-    settings->param[0].lut_clean=0;
-    settings->param[1].lut_clean=0;
-    settings->param[2].lut_clean=0;
-    settings->contrast=_param->contrast;
-    settings->brightness=_param->brightness;
-    settings->saturation=_param->saturation;
-    
-    settings->ggamma=_param->ggamma;
-    settings->bgamma=_param->bgamma;
-    settings->rgamma=_param->rgamma;
-    settings->gamma=_param->gamma;
-
-    settings->gamma_weight=_param->gamma_weight;
-    
-    if(settings->ggamma<0.1) settings->ggamma=0.1;
-    
-    settings->param[0].c=_param->contrast;  
-    settings->param[0].b=_param->brightness;;
-    settings->param[0].g=settings->gamma*settings->ggamma;
-    settings->param[0].w=settings->gamma_weight;
-    
-    
-    	
-    settings->param[1].c=_param->saturation;
-    settings->param[1].b=0;
-    settings->param[1].g=sqrt(settings->bgamma/settings->ggamma);
-    settings->param[1].w=settings->gamma_weight;
-    
-    settings->param[2].c=_param->saturation;
-    settings->param[2].b=0;
-    settings->param[2].g=sqrt(settings->rgamma/settings->ggamma);
-    settings->param[2].w=settings->gamma_weight;
-    
-    //printf("GGamma:%f\n",settings->ggamma);
-    create_lut(&(settings->param[0]));
-    create_lut(&(settings->param[1]));
-    create_lut(&(settings->param[2])); 
-}          
-
-void create_lut (oneSetting *par)
-{
-  unsigned i;
-  double   g, v;
-  double   lw, gw;
-
-  g = par->g;
-  gw = par->w;
-  lw = 1.0 - gw;
-
-  if ((g < 0.001) || (g > 1000.0)) {
-    g = 1.0;
-  }
-
-  g = 1.0 / g;
-
-  for (i = 0; i < 256; i++) {
-    v = (double) i / 255.0;
-    v = par->c * (v - 0.5) + 0.5 + par->b;
-
-    if (v <= 0.0) {
-      par->lut[i] = 0;
-    }
-    else {
-      v = v*lw + pow(v, g)*gw;
-
-      if (v >= 1.0) {
-        par->lut[i] = 255;
-      }
-      else {
-        par->lut[i] = (unsigned char) (256.0 * v);
-      }
-    }
-  }
-
-#ifdef LUT16
-  for(i=0; i<256*256; i++){
-    par->lut16[i]= par->lut[i&0xFF] + (par->lut[i>>8]<<8);
-  }
-#endif
-
-  par->lut_clean = 1;
-}
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{
-  unsigned i;
-  int      contrast, brightness;
-  unsigned dstep, sstep,w3;
-  int      pel;
-  short    int brvec[4];
-  short    int contvec[4];
-  w3=w>>3;
-//  printf("\nmmx: src=%p dst=%p w=%d h=%d ds=%d ss=%d\n",src,dst,w,h,dstride,sstride);
-  if(par->g!=1.0) return apply_lut(par,dst,src,w,h);
-  //printf("MMX\n");
-  contrast = (int) (par->c * 256 * 16);
-  brightness = ((int) (100.0 * par->b + 100.0) * 511) / 200 - 128 - contrast / 32;
-
-  brvec[0] = brvec[1] = brvec[2] = brvec[3] = brightness;
-  contvec[0] = contvec[1] = contvec[2] = contvec[3] = contrast;
-
-  
-  asm volatile (
-        "movq (%0), %%mm3 \n\t"
-        "movq (%1), %%mm4 \n\t"
-        ::  "r" (brvec),"r" (contvec)
-        
-        );
-  while (h-- > 0) {
-    asm volatile (
-      "pxor %%mm0, %%mm0 \n\t"
-      "movl %4, %%eax\n\t"
-      ".p2align 4 \n\t"
-      "lop%=: \n\t"
-      "movq (%0), %%mm1 \n\t"
-      "movq (%0), %%mm2 \n\t"
-      "punpcklbw %%mm0, %%mm1 \n\t"
-      "punpckhbw %%mm0, %%mm2 \n\t"
-      "psllw $4, %%mm1 \n\t"
-      "psllw $4, %%mm2 \n\t"
-      "pmulhw %%mm4, %%mm1 \n\t"
-      "pmulhw %%mm4, %%mm2 \n\t"
-      "paddw %%mm3, %%mm1 \n\t"
-      "paddw %%mm3, %%mm2 \n\t"
-      "packuswb %%mm2, %%mm1 \n\t"
-      "add $8, %0 \n\t"
-      "movq %%mm1, (%1) \n\t"
-      "add $8, %1 \n\t"
-      "decl %%eax \n\t"
-      "jnz lop%= \n\t"
-      : "=r" (src), "=r" (dst)
-      : "0" (src), "1" (dst), "r" (w3)
-      : "%eax"
-    );
-
-    for (i = w & 7; i > 0; i--) {
-      pel = ((*src++ * contrast) >> 12) + brightness;
-      if (pel & 768) {
-        pel = (-pel) >> 31;
-      }
-      *dst++ = pel;
-    }
-
-  }
-
-  asm volatile ( "emms \n\t" ::: "memory" );
-}
-#endif
-
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{           
-            
-    
-  unsigned int dstride,  sstride;
-  unsigned int i, j, w2;
-  unsigned char *lut;
-  uint16_t *lut16;
-
-   dstride=sstride=w;
-
-  lut = par->lut;
-#ifdef LUT16
-  lut16 = par->lut16;
-  w2= (w>>3)<<2;
-  for (j = 0; j < h; j++) {
-    uint16_t *src16= (uint16_t*)src;
-    uint16_t *dst16= (uint16_t*)dst;
-    for (i = 0; i < w2; i+=4) {
-      dst16[i+0] = lut16[src16[i+0]];
-      dst16[i+1] = lut16[src16[i+1]];
-      dst16[i+2] = lut16[src16[i+2]];
-      dst16[i+3] = lut16[src16[i+3]];
-    }
-    i <<= 1;
-#else
-  w2= (w>>3)<<3;
-  for (j = 0; j < h; j++) {
-    for (i = 0; i < w2; i+=8) {
-      dst[i+0] = lut[src[i+0]];
-      dst[i+1] = lut[src[i+1]];
-      dst[i+2] = lut[src[i+2]];
-      dst[i+3] = lut[src[i+3]];
-      dst[i+4] = lut[src[i+4]];
-      dst[i+5] = lut[src[i+5]];
-      dst[i+6] = lut[src[i+6]];
-      dst[i+7] = lut[src[i+7]];
-    }
-#endif
-    for (; i < w; i++) {
-      dst[i] = lut[src[i]];
-    }
-
-    src += sstride;
-    dst += dstride;
-  }
-}  
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h	2007-08-14 08:34:12 UTC (rev 3511)
@@ -1,61 +0,0 @@
-
-#ifndef EQ2_PARAM
-#define EQ2_PARAM
-#define LUT16
-typedef struct Eq2_Param
-{
-  float     contrast ;      /* 1.0 means do nothing..*/    
-  float     brightness;     /* 0 means */
-  float     saturation;
-  
-  float     gamma;
-  float     gamma_weight;
-  float     rgamma;
-  float     ggamma;
-  float     bgamma;
-}Eq2_Param;
-//*************************
-
-
-typedef struct oneSetting {
-  unsigned char lut[256];
-#ifdef LUT16
-  uint16_t lut16[256*256];
-#endif
-  int           lut_clean;
-
-  double        c;
-  double        b;
-  double        g;
-  double        w;
-} oneSetting;
-typedef struct Eq2Settings {
-  oneSetting param[3];
-
-  double        contrast;
-  double        brightness;
-  double        saturation;
-
-  double        gamma;
-  double        gamma_weight;
-  double        rgamma;
-  double        ggamma;
-  double        bgamma;
-
- 
-} Eq2Settings;
-//*************************
-uint8_t DIA_getEQ2Param(Eq2_Param *param,AVDMGenericVideoStream *in);
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param);
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h);
-void create_lut (oneSetting *par);
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-                unsigned int w, unsigned int h);
-#endif
-
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-14 08:34:12 UTC (rev 3511)
@@ -19,7 +19,6 @@
 ADM_vidDelta.cpp      
 ADM_vidMPdelogo.cpp      
 ADM_vobsubinfo.cpp
-ADM_vidEq2.cpp             
 ADM_vidClean.cpp        
 ADM_vidEqualizer.cpp  
 ADM_vidNull.cpp          

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-14 08:34:12 UTC (rev 3511)
@@ -26,7 +26,6 @@
  ADM_vidVobsub.cpp \
  ADM_vobsubinfo.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidEq2.cpp \
  ADM_vidAsharp.cpp \
  ADM_vidCNR2.cpp \
   ADM_vidDelta.cpp \
@@ -47,8 +46,8 @@
 ADM_vidDelta.cpp  ADM_vidPartial_param.h \
 ADM_guiResize.cpp   ADM_vidRaw.cpp \
 ADM_interlaced.cpp  \
-ADM_interlaced.h ADM_vidEq2.cpp  ADM_vidResize.cpp \
-ADM_vidEq2.h  ADM_vidResize25.cpp \
+ADM_interlaced.h ADM_vidResize.cpp \
+ADM_vidResize25.cpp \
 ADM_vidEqualizer.cpp  \
 ADM_mpdetc.cpp ADM_vidEqualizer.h   \
 ADM_mpdetc.h  \
@@ -89,5 +88,4 @@
 			 $(FREETYPE_CFLAGS) $(ALTIVEC_SWITCH) -I../ADM_userInterfaces/ADM_commonUI -I../ADM_inputs
 noinst_HEADERS = ADM_mpdetc.h \
   ADM_cache.h \
-ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h \
-ADM_vidEq2.h 
+ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.cpp (from rev 3510, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.h (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-14 08:34:12 UTC (rev 3511)
@@ -30,6 +30,7 @@
 ADM_vidSRTload.cpp
 ADM_vidSRTRender.cpp
 ADM_vidCrop.cpp       
+ADM_vidEq2.cpp       
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-14 08:34:12 UTC (rev 3511)
@@ -68,6 +68,7 @@
  ADM_vidSRT.cpp \
  ADM_vidSRTload.cpp \
  ADM_vidSRTRender.cpp \
+ ADM_vidEq2.cpp \
  ADM_vidCrop.cpp       
 			
 



From mean at mail.berlios.de  Tue Aug 14 10:46:10 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 14 Aug 2007 10:46:10 +0200
Subject: [Avidemux-svn-commit] r3512 -
	branches/avidemux_2.4_branch/avidemux/ADM_video
Message-ID: <200708140846.l7E8kAcb020584@sheep.berlios.de>

Author: mean
Date: 2007-08-14 10:46:10 +0200 (Tue, 14 Aug 2007)
New Revision: 3512

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp
Log:
[OCR] Fix reading unknown language

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp	2007-08-14 08:34:12 UTC (rev 3511)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp	2007-08-14 08:46:10 UTC (rev 3512)
@@ -118,7 +118,7 @@
         memset(sub->lines,0,sizeof(vobSubLine)*nb_lines);
         printf("Rebuilding %d lines of subs\n",nb_lines);
         
-        while(line<nb_lines)
+        while(line<nb_lines && !feof(file))
         {
                 fgets(str,1023,file); 
                 if(!strncmp(str,"palette:",7))
@@ -139,9 +139,15 @@
                                 {
                                   int  l;
                                   char s[50];
+                                  s[0]=0;
+                                  l=999;
                                   sscanf(str,"id: %s index: %d",s,&l);
                                   printf("Found lang : %s index %d while searching %d\n",s,l,index);
-                                  if(l==index) language=1;
+                                  if(l==index)
+                                  {
+                                	  language=1;
+                                	  printf("Match\n");
+                                  }
                                   else language=0;                                                                              
                                 
                                 }
@@ -193,6 +199,8 @@
                 fgets(str,1023,f);
                 if(!strncmp(str,"id:",3))
                 {
+                  s[0]=0;
+                  lang=9999;
                   sscanf(str,"id: %s index: %d",s,&lang);
                   if(lang==index) match=1;
                   else match=0;



From gruntster at mail.berlios.de  Wed Aug 15 12:26:58 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 15 Aug 2007 12:26:58 +0200
Subject: [Avidemux-svn-commit] r3513 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200708151026.l7FAQwxq024009@sheep.berlios.de>

Author: gruntster
Date: 2007-08-15 12:26:49 +0200 (Wed, 15 Aug 2007)
New Revision: 3513

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
[Prefs] only display ALSA and OSS options when supported

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-14 08:46:10 UTC (rev 3512)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-15 10:26:49 UTC (rev 3513)
@@ -95,8 +95,10 @@
     DOME(4,dring);
      
         // Alsa
+#ifdef ALSA_SUPPORT
         if( prefs->get(DEVICE_AUDIO_ALSA_DEVICE, &alsaDevice) != RC_OK )
                 alsaDevice = ADM_strdup("plughw:0,0");
+#endif
         // autovbr
         prefs->get(FEATURE_AUTO_BUILDMAP,&autovbr);
         // autoindex
@@ -141,10 +143,12 @@
                 lavcodec_mpeg=0;
         // Open DML (Gmv)
         if(!prefs->get(FEATURE_USE_ODML, &use_odml))
-          use_odml=0;                
-        // Master or PCM for audio
+          use_odml=0;
+#if defined(ALSA_SUPPORT) || defined (OSS_SUPPORT)
+		// Master or PCM for audio
         if(!prefs->get(FEATURE_AUDIOBAR_USES_MASTER, &useMaster))
                 useMaster=0;
+#endif
         // Autoindex files
         if(!prefs->get(FEATURE_TRYAUTOIDX, &useAutoIndex))
                 useAutoIndex=0;
@@ -223,14 +227,14 @@
         diaElemMenu menuMessage(&msglevel,_("_Message level:"), sizeof(msgEntries)/sizeof(diaMenuEntry),msgEntries,"");
         
         
-        
+#if defined(ALSA_SUPPORT) || defined (OSS_SUPPORT)
         diaMenuEntry volumeEntries[]={
                              {0,       _("PCM"),NULL}
                              ,{1,      _("Master"),NULL}};
         diaElemMenu menuVolume(&useMaster,_("_Volume control:"), sizeof(volumeEntries)/sizeof(diaMenuEntry),volumeEntries,"");
+#endif
         
         
-        
          diaMenuEntry mixerEntries[]={
                              {0,       _("No downmixing"),NULL}
                              ,{1,       _("Stereo"),NULL}
@@ -270,9 +274,10 @@
         MKADID(DUMMY)
 };
         diaElemMenu menuAudio(&newdevice,_("_Audio output:"), sizeof(audioEntries)/sizeof(diaMenuEntry),audioEntries,"");
-        
-        diaElemText entryAlsaDevice(&alsaDevice,_("ALSA _device:"),NULL);
+                
 #ifdef ALSA_SUPPORT
+		diaElemText entryAlsaDevice(&alsaDevice,_("ALSA _device:"),NULL);
+
           int z,m;
           m=sizeof(audioEntries)/sizeof(diaMenuEntry);
           for(z=0;z<m;z++)
@@ -326,8 +331,16 @@
         diaElemTabs tabOutput(_("Output"),4,(diaElem **)diaOutput);
         
         /* Fourth Tab : audio */
+#if defined(ALSA_SUPPORT)
         diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio,&entryAlsaDevice};
         diaElemTabs tabAudio(_("Audio"),4,(diaElem **)diaAudio);
+#elif defined(OSS_SUPPORT)
+        diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio};
+        diaElemTabs tabAudio(_("Audio"),3,(diaElem **)diaAudio);
+#else
+        diaElem *diaAudio[]={&menuMixer,&menuAudio};
+        diaElemTabs tabAudio(_("Audio"),2,(diaElem **)diaAudio);
+#endif
         
         /* Fifth Tab : video */
         
@@ -372,12 +385,14 @@
                 // autoindex
                 prefs->set(FEATURE_AUTO_REBUILDINDEX,autoindex);
                 // Alsa
+#ifdef ALSA_SUPPORT
                 if(alsaDevice)
                 {
                    prefs->set(DEVICE_AUDIO_ALSA_DEVICE, alsaDevice);
                    ADM_dealloc(alsaDevice);
                    alsaDevice=NULL;
                 }
+#endif
                 // Device
                 if(olddevice!=newdevice)
                 {
@@ -385,8 +400,10 @@
                 }
                 // Downmixing (default)
                 prefs->set(DOWNMIXING_PROLOGIC,downmix);
+#if defined(ALSA_SUPPORT) || defined (OSS_SUPPORT)
                 // Master or PCM
                 prefs->set(FEATURE_AUDIOBAR_USES_MASTER, useMaster);
+#endif
                 // allow non std audio fq for dvd
                 prefs->set(FEATURE_MPEG_NO_LIMIT, mpeg_no_limit);
                 // Video render
@@ -429,7 +446,6 @@
 			#endif
 	}
 
-	ADM_dealloc(alsaDevice);
 	ADM_dealloc(filterPath);
 	ADM_dealloc(globalGlyphName);
 



From mean at mail.berlios.de  Wed Aug 15 17:32:45 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 15 Aug 2007 17:32:45 +0200
Subject: [Avidemux-svn-commit] r3514 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <200708151532.l7FFWjiE031422@sheep.berlios.de>

Author: mean
Date: 2007-08-15 17:32:44 +0200 (Wed, 15 Aug 2007)
New Revision: 3514

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
Log:
[Automake] Fix makefile.am (cyrille)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-08-15 10:26:49 UTC (rev 3513)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-08-15 15:32:44 UTC (rev 3514)
@@ -9,7 +9,7 @@
 AQ_srt.cpp \
 AT_index_pg.cpp DIA_x264.cpp \
 AQ_vobsub.cpp \
-AQ_eq2.cpp
+AQ_eq2.cpp \
 DIA_srt.cpp
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \



From mean at mail.berlios.de  Wed Aug 15 17:43:53 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 15 Aug 2007 17:43:53 +0200
Subject: [Avidemux-svn-commit] r3515 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <200708151543.l7FFhrEM032103@sheep.berlios.de>

Author: mean
Date: 2007-08-15 17:43:53 +0200 (Wed, 15 Aug 2007)
New Revision: 3515

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_flyDialog.cpp
Log:
[QT] Automatically set the frame selection slider to the # of images in incoming stream (flyDialog)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_flyDialog.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_flyDialog.cpp	2007-08-15 15:32:44 UTC (rev 3514)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_flyDialog.cpp	2007-08-15 15:43:53 UTC (rev 3515)
@@ -26,9 +26,12 @@
 void ADM_flyDialog::postInit()
 {
 	QWidget *graphicsView = ((ADM_QCanvas*)_canvas)->parentWidget();
-
+	QSlider  *slider=(QSlider *)_slider;
+	
 	graphicsView->setMinimumSize(_w, _h);
 	graphicsView->resize(_w, _h);
+	uint32_t nbFrames=_in->getInfo()->nb_frames; 
+	slider->setMaximum(nbFrames);
 }
 
 float ADM_flyDialog::calcZoomFactor(void) {return 1;}



From mean at mail.berlios.de  Wed Aug 15 17:50:21 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 15 Aug 2007 17:50:21 +0200
Subject: [Avidemux-svn-commit] r3516 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_filters
Message-ID: <200708151550.l7FFoL6S032566@sheep.berlios.de>

Author: mean
Date: 2007-08-15 17:50:20 +0200 (Wed, 15 Aug 2007)
New Revision: 3516

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_filters/CMakeLists.txt
Log:
[CMAKE] Fix extenstion (cyrille)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_filters/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_filters/CMakeLists.txt	2007-08-15 15:43:53 UTC (rev 3515)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_filters/CMakeLists.txt	2007-08-15 15:50:20 UTC (rev 3516)
@@ -6,7 +6,7 @@
 SET(ADM_LIB ADM_dialogFiltersNone)
 #
 SET(${ADM_LIB}_SRCS 
-filter_none
+filter_none.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)



From mean at mail.berlios.de  Thu Aug 16 17:49:51 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 16 Aug 2007 17:49:51 +0200
Subject: [Avidemux-svn-commit] r3517 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_libraries/ADM_lavcodec/i386 ADM_libraries/ADM_libMpeg2Dec
	ADM_libraries/ADM_utilities ADM_osSupport
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200708161549.l7GFnpEp002881@sheep.berlios.de>

Author: mean
Date: 2007-08-16 17:49:50 +0200 (Thu, 16 Aug 2007)
New Revision: 3517

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.4_branch/avidemux/main.cpp
   branches/avidemux_2.4_branch/avidemux/prefs.h
   branches/avidemux_2.4_branch/avidemux/prefs.in
Log:
[CPU] Allow user to disable individually simd extension, require a restart atm

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/i386/cputest.c	2007-08-16 15:49:50 UTC (rev 3517)
@@ -42,10 +42,14 @@
          : "=a" (eax), "=S" (ebx),\
            "=c" (ecx), "=d" (edx)\
          : "0" (index));
-
+/* MEANX */
+extern int ADM_lavcodec_mm_support(void);
+/*/MEANX */
 /* Function to test if multimedia instructions are supported...  */
 int mm_support(void)
 {
+		return ADM_lavcodec_mm_support();
+#if 0 // MEANX : We use the function in ADM_cpuCaps which is about the same
     int rval = 0;
     int eax, ebx, ecx, edx;
     int max_std_level, max_ext_level, std_caps=0, ext_caps=0;
@@ -117,6 +121,7 @@
         (rval&FF_MM_3DNOWEXT) ? "3DNowExt ":"");
 #endif
     return rval;
+#endif // #if 0
 }
 
 #ifdef TEST

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/cpu_accel.c	2007-08-16 15:49:50 UTC (rev 3517)
@@ -22,58 +22,33 @@
  */
 
 #include "config.h"
-
+#include <stdio.h>
 #include <inttypes.h>
 
 #include "mpeg2.h"
 #include "attributes.h"
 #include "mpeg2_internal.h"
 
-#include "admmangle.h"
 typedef void (*sighandler_t)(int); // MEANX RETSIGTYPE
  
+
+extern int ADM_mpeg2dec_mm_support(void); // MEANX
+
 #ifdef ACCEL_DETECT
 #ifdef ARCH_X86
 static inline uint32_t arch_accel (void)
 {
-    uint32_t eax, ebx, ecx, edx;
-    int AMD;
-    uint32_t caps;
-#define cpuid(index,eax,ebx,ecx,edx)\
-    __asm __volatile ("mov %%"REG_b", %%"REG_S"\n\t"\
-         "cpuid\n\t"\
-         "xchg %%"REG_b", %%"REG_S\
-         : "=a" (eax), "=S" (ebx),\
-           "=c" (ecx), "=d" (edx)\
-         : "0" (index));
+   
+    static uint32_t caps;
+    static int done=0;
 
-
-    cpuid (0x00000000, eax, ebx, ecx, edx);
-    if (!eax)			/* vendor string only */
-	return 0;
-
-    AMD = (ebx == 0x68747541) && (ecx == 0x444d4163) && (edx == 0x69746e65);
-
-    cpuid (0x00000001, eax, ebx, ecx, edx);
-    if (! (edx & 0x00800000))	/* no MMX */
-	return 0;
-
-    caps = MPEG2_ACCEL_X86_MMX;
-    if (edx & 0x02000000)	/* SSE - identical to AMD MMX extensions */
-	caps = MPEG2_ACCEL_X86_MMX | MPEG2_ACCEL_X86_MMXEXT;
-
-    cpuid (0x80000000, eax, ebx, ecx, edx);
-    if (eax < 0x80000001)	/* no extended capabilities */
-	return caps;
-
-    cpuid (0x80000001, eax, ebx, ecx, edx);
-
-    if (edx & 0x80000000)
-	caps |= MPEG2_ACCEL_X86_3DNOW;
-
-    if (AMD && (edx & 0x00400000))	/* AMD MMX extensions */
-	caps |= MPEG2_ACCEL_X86_MMXEXT;
-
+#define CHECK_CAPS(y) if (caps & MPEG2_ACCEL_X86_##y ) printf("[LibMpeg2Dec] "#y" supported\n");
+    
+    if(!done)
+    {
+    	caps=ADM_mpeg2dec_mm_support();
+    	done=1;
+    }
     return caps;
 }
 #endif /* ARCH_X86 */
@@ -185,9 +160,9 @@
 #ifdef ACCEL_DETECT
 #if defined (ARCH_X86) || defined (ARCH_PPC) || defined (ARCH_ALPHA) || defined (ARCH_SPARC)
     accel = arch_accel ();
-#define PRT(x) if(accel & x) printf("Mpeg2dec accel :"#x"\n");
+#define PRT(x) if(accel & x) printf("[libMpeg2dec] accel :"#x"\n");
 #ifdef ARCH_X86
-	printf("Mpeg2dec: X86 CPU accel in use:\n");
+	printf("[libMpeg2dec] X86 CPU accel in use:\n");
 	PRT(MPEG2_ACCEL_X86_MMX);
 	PRT(MPEG2_ACCEL_X86_3DNOW);
 	PRT(MPEG2_ACCEL_X86_MMXEXT);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h	2007-08-16 15:49:50 UTC (rev 3517)
@@ -151,16 +151,7 @@
 void mpeg2_set_buf (mpeg2dec_t * mpeg2dec, uint8_t * buf[3], void * id);
 void mpeg2_custom_fbuf (mpeg2dec_t * mpeg2dec, int custom_fbuf);
 
-#define MPEG2_ACCEL_X86_MMX 1
-#define MPEG2_ACCEL_X86_3DNOW 2
-#define MPEG2_ACCEL_X86_MMXEXT 4
-#define MPEG2_ACCEL_PPC_ALTIVEC 1
-#define MPEG2_ACCEL_ALPHA 1
-#define MPEG2_ACCEL_ALPHA_MVI 2
-#define MPEG2_ACCEL_SPARC_VIS 1
-#define MPEG2_ACCEL_SPARC_VIS2 2
-#define MPEG2_ACCEL_DETECT 0x80000000
-
+#include "mpeg2_cpu.h" //MEANX
 uint32_t mpeg2_accel (uint32_t accel);
 mpeg2dec_t * mpeg2_init (void);
 const mpeg2_info_t * mpeg2_info (mpeg2dec_t * mpeg2dec);

Copied: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h (from rev 3516, branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h	2007-08-16 15:49:50 UTC (rev 3517)
@@ -0,0 +1,37 @@
+/*
+ * mpeg2.h
+ * Copyright (C) 2000-2003 Michel Lespinasse <walken at zoy.org>
+ * Copyright (C) 1999-2000 Aaron Holtzman <aholtzma at ess.engr.uvic.ca>
+ *
+ * This file is part of mpeg2dec, a free MPEG-2 video stream decoder.
+ * See http://libmpeg2.sourceforge.net/ for updates.
+ *
+ * mpeg2dec is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * mpeg2dec is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef MPEG2_CPU_H
+#define MPEG2_CPU_H
+
+#define MPEG2_ACCEL_X86_MMX 1
+#define MPEG2_ACCEL_X86_3DNOW 2
+#define MPEG2_ACCEL_X86_MMXEXT 4
+#define MPEG2_ACCEL_PPC_ALTIVEC 1
+#define MPEG2_ACCEL_ALPHA 1
+#define MPEG2_ACCEL_ALPHA_MVI 2
+#define MPEG2_ACCEL_SPARC_VIS 1
+#define MPEG2_ACCEL_SPARC_VIS2 2
+#define MPEG2_ACCEL_DETECT 0x80000000
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
@@ -127,6 +127,7 @@
 	{"feature.reuse_2pass_log",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.audiobar_uses_master",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.multi_thread",		UINT,	"0",	NULL,	"0",	"4"	},
+	{"feature.cpu_caps",		UINT,	"4294967295",NULL,	"0",	"4294967295"},
 	{"feature.mpeg_no_limit",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.auto_buildmap",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.auto_rebuildindex",		UINT,	"0",	NULL,	"0",	"1"	},
@@ -142,7 +143,7 @@
 	{"priority.playback",		UINT,	"0",	NULL,	"0",	"4"	}
 };
 
-int num_opts = 78;
+int num_opts = 79;
 // </prefs_gen>
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 15:49:50 UTC (rev 3517)
@@ -12,8 +12,18 @@
 #include "config.h"
 #include <stdio.h>
 #include "default.h"
+#include "admmangle.h"
 #include "ADM_osSupport/ADM_cpuCap.h"
 #include "prefs.h"
+
+/* Cpu caps interface to other libs */
+extern "C"{ 
+	int ADM_lavcodec_mm_support(void);
+	int ADM_mpeg2dec_mm_support(void);
+	
+}
+
+
 #if defined( ARCH_X86)  || defined(ARCH_X86_64)
 extern "C" 
 {
@@ -21,14 +31,94 @@
 }
 #endif
 
+#define cpuid(index,eax,ebx,ecx,edx)\
+    __asm __volatile\
+        ("mov %%"REG_b", %%"REG_S"\n\t"\
+         "cpuid\n\t"\
+         "xchg %%"REG_b", %%"REG_S\
+         : "=a" (eax), "=S" (ebx),\
+           "=c" (ecx), "=d" (edx)\
+         : "0" (index));
 
+
+/**
+ * 		\fn CpuCaps::init
+ * 		\brief Detect the SIM capabilities of CPU, borrowed from lavcodec
+ */
   void 	CpuCaps::init( void)
 {
-	printf("Checking CPU capabilities\n");
-int probed=0;
-#if defined( ARCH_X86)  || defined(ARCH_X86_64)
-	probed=mm_support();
-#define CHECK(x) if(probed & MM_##x) { CpuCaps::myCpuCaps|=ADM_CPU_##x;printf("\t\t"#x"\n");}
+	printf("[cpuCaps]Checking CPU capabilities\n");
+	myCpuCaps=0;
+	myCpuMask=0xffffffff;
+	prefs->get(FEATURE_CPU_CAPS,&myCpuMask);
+
+#if defined( ARCH_X86)  || defined(ARCH_X86_64)	
+int rval = 0;
+ int eax, ebx, ecx, edx;
+ int max_std_level, max_ext_level, std_caps=0, ext_caps=0;
+ long a, c;
+
+ __asm__ __volatile__ (
+                       /* See if CPUID instruction is supported ... */
+                       /* ... Get copies of EFLAGS into eax and ecx */
+                       "pushf\n\t"
+                       "pop %0\n\t"
+                       "mov %0, %1\n\t"
+
+                       /* ... Toggle the ID bit in one copy and store */
+                       /*     to the EFLAGS reg */
+                       "xor $0x200000, %0\n\t"
+                       "push %0\n\t"
+                       "popf\n\t"
+
+                       /* ... Get the (hopefully modified) EFLAGS */
+                       "pushf\n\t"
+                       "pop %0\n\t"
+                       : "=a" (a), "=c" (c)
+                       :
+                       : "cc"
+                       );
+
+ if (a == c)
+     return ; /* CPUID not supported */
+
+ cpuid(0, max_std_level, ebx, ecx, edx);
+
+ if(max_std_level >= 1)
+ {
+     cpuid(1, eax, ebx, ecx, std_caps);
+     if (std_caps & (1<<23))
+    	 myCpuCaps |= ADM_CPU_MMX;
+     if (std_caps & (1<<25))
+    	 myCpuCaps |= ADM_CPU_MMXEXT | ADM_CPU_SSE;
+     if (std_caps & (1<<26))
+    	 myCpuCaps |= ADM_CPU_SSE2;
+     if (ecx & 1)
+    	 myCpuCaps |= ADM_CPU_SSE3;
+     if (ecx & 0x00000200 )
+    	 myCpuCaps |= ADM_CPU_SSSE3;
+     
+     
+     
+ }
+
+ cpuid(0x80000000, max_ext_level, ebx, ecx, edx);
+
+ if(max_ext_level >= 0x80000001)
+ {
+     cpuid(0x80000001, eax, ebx, ecx, ext_caps);
+     if (ext_caps & (1<<31))
+    	 myCpuCaps |= ADM_CPU_3DNOW;
+     if (ext_caps & (1<<30))
+    	 myCpuCaps |= ADM_CPU_3DNOWEXT;
+     if (ext_caps & (1<<23))
+    	 myCpuCaps |= ADM_CPU_MMX;
+     if (ext_caps & (1<<22))
+    	 myCpuCaps |= ADM_CPU_MMXEXT;
+     
+ }
+#define CHECK(x) if(myCpuCaps & ADM_CPU_##x) { printf("\t\t"#x" detected ");\
+											if(!(myCpuMask&ADM_CPU_##x)) printf("  but disabled");printf("\n");}
 	CHECK(MMX);
 	CHECK(3DNOW);
 	CHECK(MMXEXT);
@@ -36,8 +126,10 @@
 	CHECK(SSE2);
 	CHECK(SSE3);
 	CHECK(SSSE3);
-#endif	
-	printf("End of CPU capabilities check\n");
+
+#endif // X86
+	printf("[cpuCaps]End of CPU capabilities check (cpuMask :%x)\n",myCpuMask);
+	return ;
 }
 /*
         Returns # of threads to use,  0 means multithreading disabled
@@ -51,4 +143,40 @@
         if(multi<2) multi=0; // On thread means no threading...
         return multi;
 }
+/************************************************************************/
+#include "ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h"
+int ADM_mpeg2dec_mm_support(void)
+{
+int rval=0;
+#undef MATCH
+#define MATCH(x,y) if(CpuCaps::myCpuCaps & CpuCaps::myCpuMask & ADM_CPU_##x) rval|=MPEG2_ACCEL_X86_##x;
+	
+	MATCH(MMX,MMX);
+	MATCH(MMXEXT,MMXEXT);
+	MATCH(3DNOW,3DNOW);
+	return rval;
+}
+//******************************************************
+#include "ADM_lavcodec.h"
+/**
+ * 		\fn lavcodec_mm_support
+ * 		\brief Give lavcodec CPU supported ( FF_MM_MMX)
+ */
+int ADM_lavcodec_mm_support(void)
+{
+int rval=0;
+#undef MATCH
+#define MATCH(x,y) if(CpuCaps::myCpuCaps &  CpuCaps::myCpuMask & ADM_CPU_##x) rval|=MM_##x;
+	
+	MATCH(MMX,MMX);
+	MATCH(MMXEXT,MMXEXT);
+	MATCH(SSE,SSE);
+	MATCH(SSE2,SSE2);
+	MATCH(SSE3,SSE3);
+	MATCH(SSSE3,SSSE3);
+	MATCH(3DNOW,3DNOW);
+	MATCH(3DNOWEXT,3DNOWEXT);
+	return rval;
+}
+// EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-16 15:49:50 UTC (rev 3517)
@@ -11,7 +11,7 @@
 //
 #if defined(ARCH_X86_64) ||defined(ARCH_X86)
 
-#define CHECK_Z(x) {if(CpuCaps::myCpuCaps & ADM_CPU_##x) return 1; else return 0;} 
+#define CHECK_Z(x) {if(CpuCaps::myCpuCaps & ADM_CPU_##x & CpuCaps::myCpuMask) return 1; else return 0;} 
 
 #else
 #define         CHECK_Z(x) {return 0;}
@@ -23,17 +23,21 @@
         ADM_CPU_MMX    =1<<1,
         ADM_CPU_MMXEXT =1<<2,
         ADM_CPU_3DNOW  =1<<3,
-        ADM_CPU_SSE    =1<<4,
-        ADM_CPU_SSE2   =1<<5,
-		ADM_CPU_SSE3   =1<<6,
-		ADM_CPU_SSSE3  =1<<7,
-        ADM_CPU_ALTIVEC=1<<8,
+        ADM_CPU_3DNOWEXT  =1<<4,
+        ADM_CPU_SSE    =1<<5,
+        ADM_CPU_SSE2   =1<<6,
+		ADM_CPU_SSE3   =1<<7,
+		ADM_CPU_SSSE3  =1<<8,
+        ADM_CPU_ALTIVEC=1<<9,
+        
+        ADM_CPU_ALL=0xffffffff
 } ADM_CPU_CAPS;
 
 class CpuCaps
 {
 public:
-        static int      myCpuCaps;
+        static uint32_t      myCpuCaps;
+        static uint32_t      myCpuMask;
 public:
 	static void 	init( void);
 	static uint8_t 	hasMMX (void) {CHECK_Z(MMX)};
@@ -41,6 +45,9 @@
 	static uint8_t 	has3DNOW (void) {CHECK_Z(3DNOW)};
 	static uint8_t 	hasSSE (void) {CHECK_Z(SSE)};
 	static uint8_t 	hasSSE2 (void){CHECK_Z(SSE2)};
+	static uint8_t 	hasSSE3 (void){CHECK_Z(SSE3)};
+	static uint8_t 	hasSSSE3 (void){CHECK_Z(SSSE3)};
+	static uint8_t 	has3DNOWEXT(void){CHECK_Z(3DNOWEXT)};
 
 
 };

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
@@ -79,6 +79,7 @@
 uint32_t pp_type=3;
 uint32_t pp_value=5;
 uint32_t hzd,vzd,dring;
+uint32_t capsMMX,capsMMXEXT,caps3DNOW,caps3DNOWEXT,capsSSE,capsSSE2,capsSSE3,capsSSSE3,capsAll;
 
 uint32_t useGlobalGlyph=0;
 char     *globalGlyphName=NULL;
@@ -94,6 +95,19 @@
     DOME(2,vzd);
     DOME(4,dring);
      
+// Cpu caps
+#define CPU_CAPS(x)    	if(CpuCaps::myCpuMask & ADM_CPU_##x) caps##x=1; else caps##x=0;
+    
+    	if(CpuCaps::myCpuMask==ADM_CPU_ALL) capsAll=1; else capsAll=0;
+    	CPU_CAPS(MMX);
+    	CPU_CAPS(MMXEXT);
+    	CPU_CAPS(3DNOW);
+    	CPU_CAPS(3DNOWEXT);
+    	CPU_CAPS(SSE);
+    	CPU_CAPS(SSE2);
+    	CPU_CAPS(SSE3);
+    	CPU_CAPS(SSSE3);
+    
         // Alsa
 #ifdef ALSA_SUPPORT
         if( prefs->get(DEVICE_AUDIO_ALSA_DEVICE, &alsaDevice) != RC_OK )
@@ -186,6 +200,27 @@
                        
         diaElemUInteger multiThread(&mthreads,_("_Number of threads:"),0,10);
 
+
+        
+        diaElemToggle capsToggleAll(&capsAll,_("Enable all Simd"));
+        diaElemFrame      frameSimd(_("Simd"));
+        frameSimd.swallow(&capsToggleAll);
+        
+#define CAPS_TOGGLE(x) diaElemToggle       capsToggle##x(&(caps##x),_("Enable "#x));\
+						capsToggleAll.link(0,&(capsToggle##x));  frameSimd.swallow(   &(capsToggle##x));      
+						  
+
+        CAPS_TOGGLE(MMX);
+        CAPS_TOGGLE(MMXEXT);
+        CAPS_TOGGLE(3DNOW);
+        CAPS_TOGGLE(3DNOWEXT);
+        CAPS_TOGGLE(SSE);
+        CAPS_TOGGLE(SSE2);
+        CAPS_TOGGLE(SSE3);
+        CAPS_TOGGLE(SSSE3);        
+      
+
+        
 		diaMenuEntry priorityEntries[] = {
                              {0,       _("High"),NULL}
                              ,{1,      _("Above normal"),NULL}
@@ -348,7 +383,10 @@
         diaElemTabs tabVideo(_("Video"),2,(diaElem **)diaVideo);
         
         /* Sixth Tab : mthread */
-        diaElem *diaCpu[]={&multiThread, &menuEncodePriority, &menuIndexPriority, &menuPlaybackPriority};
+        diaElem *diaCpu[]={&multiThread, &frameSimd,&menuEncodePriority, &menuIndexPriority, &menuPlaybackPriority};
+        
+        
+        
         diaElemTabs tabCpu(_("CPU"),4,(diaElem **)diaCpu);
         
         /* 7th Tab : Global Glyph */
@@ -364,8 +402,29 @@
         diaElemTabs *tabs[]={&tabUser,&tabAuto,&tabInput,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabGlyph,&tabXfilter};
         if( diaFactoryRunTabs(_("Preferences"),9,tabs))
 	{
+        	
+        	// cpu caps
+        		if(capsAll)
+        		{
+        			CpuCaps::myCpuMask=ADM_CPU_ALL;
+        		}else
+        		{
+        			CpuCaps::myCpuMask=0;
+#undef CPU_CAPS
+#define CPU_CAPS(x)    	if(caps##x) CpuCaps::myCpuMask|= ADM_CPU_##x;        	    	
+        	    	CPU_CAPS(MMX);
+        	    	CPU_CAPS(MMXEXT);
+        	    	CPU_CAPS(3DNOW);
+        	    	CPU_CAPS(3DNOWEXT);
+        	    	CPU_CAPS(SSE);
+        	    	CPU_CAPS(SSE2);
+        	    	CPU_CAPS(SSE3);
+        	    	CPU_CAPS(SSSE3);
+        		}
+        		prefs->set(FEATURE_CPU_CAPS,CpuCaps::myCpuMask);
+        		// Glyphs
                prefs->set(FEATURE_GLOBAL_GLYPH_ACTIVE,useGlobalGlyph);
-                prefs->set(FEATURE_GLOBAL_GLYPH_NAME,globalGlyphName);
+               prefs->set(FEATURE_GLOBAL_GLYPH_NAME,globalGlyphName);
 
           
 		ret=1;

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-16 15:49:50 UTC (rev 3517)
@@ -104,7 +104,8 @@
 void SpidermonkeyDestroy(void);
 
 extern pthread_mutex_t g_pSpiderMonkeyMutex;
-int CpuCaps::myCpuCaps=0;
+uint32_t CpuCaps::myCpuCaps=0;
+uint32_t CpuCaps::myCpuMask=0xffffffff;
 
 int main(int argc, char *argv[])
 {
@@ -206,7 +207,8 @@
 	printf("Initialising prefs\n");
 	initPrefs();
 	prefs->load();
-
+    CpuCaps::init();
+    
 	register_Encoders();
 
 #ifdef USE_SDL
@@ -227,7 +229,6 @@
 #endif
 
     initFileSelector();
-    CpuCaps::init();
     ADM_InitMemcpy();
 
 	// Load .avidemuxrc

Modified: branches/avidemux_2.4_branch/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-16 15:49:50 UTC (rev 3517)
@@ -73,6 +73,7 @@
 	FEATURE_REUSE_2PASS_LOG,
 	FEATURE_AUDIOBAR_USES_MASTER,
 	FEATURE_MULTI_THREAD,
+	FEATURE_CPU_CAPS,
 	FEATURE_MPEG_NO_LIMIT,
 	FEATURE_AUTO_BUILDMAP,
 	FEATURE_AUTO_REBUILDINDEX,

Modified: branches/avidemux_2.4_branch/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-15 15:50:20 UTC (rev 3516)
+++ branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-16 15:49:50 UTC (rev 3517)
@@ -82,6 +82,7 @@
 feature.reuse_2pass_log,                UINT,   0,      0,      1
 feature.audiobar_uses_master,           UINT,   0,      0,      1
 feature.multi_thread,                   UINT,   0,      0,      4
+feature.cpu_caps,  		                UINT,   4294967295,      0,      4294967295
 feature.mpeg_no_limit,                  UINT,   0,      0,      1
 feature.auto_buildmap,                  UINT,   0,      0,      1
 feature.auto_rebuildindex,              UINT,   0,      0,      1



From gruntster at mail.berlios.de  Thu Aug 16 19:23:31 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 16 Aug 2007 19:23:31 +0200
Subject: [Avidemux-svn-commit] r3518 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_audiodevice
	ADM_codecs ADM_encoder ADM_libraries/ADM_utilities
	ADM_osSupport ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200708161723.l7GHNVD9032383@sheep.berlios.de>

Author: gruntster
Date: 2007-08-16 19:22:50 +0200 (Thu, 16 Aug 2007)
New Revision: 3518

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.4_branch/avidemux/prefs.h
   branches/avidemux_2.4_branch/avidemux/prefs.in
Log:
[Codec] new auto-detect threads option for all MT codecs + permit more than 4 threads + MT can now be disabled for x264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -12,7 +12,7 @@
 #ifndef ADM_AUDIODEVICE_H
 #define ADM_AUDIODEVICE_H
 
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 
 void dither16(float *start, uint32_t nb, uint8_t channels);
 
@@ -34,7 +34,7 @@
 		  public:
                                         dummyAudioDevice(void) {};
                         virtual uint8_t init(uint8_t channels, uint32_t fq)
-                                {printf("\n Null audio device"); UNUSED_ARG(fq); UNUSED_ARG(channels); return 1;}
+                                {printf("Null audio device\n"); UNUSED_ARG(fq); UNUSED_ARG(channels); return 1;}
                         virtual uint8_t play(uint32_t len, float *data)
                                 {UNUSED_ARG(len); UNUSED_ARG(data); return 1;}
                         virtual uint8_t stop(void) {return 1;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -22,28 +22,20 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <math.h>
+#include <pthread.h>
 
-
-#include <ADM_assert.h>
-
+#include "ADM_assert.h"
+#include "prefs.h"
 #include "ADM_lavcodec.h"
 #include "ADM_utilities/default.h"
 
-#include "ADM_colorspace/colorspace.h"
-
 #include "ADM_codecs/ADM_codec.h"
-
 #include "ADM_codecs/ADM_ffmp43.h"
-//#include "ADM_gui/GUI_MPP.h"
-
 #include "ADM_toolkit/toolkit.hxx"
 
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME  MODULE_CODEC
 #include "ADM_osSupport/ADM_debug.h"
-#include "ADM_osSupport/ADM_cpuCap.h"
-
 #include "ADM_video/ADM_videoInfoExtractor.h"
 //****************************
 #define WRAP_Open(x) \
@@ -55,13 +47,13 @@
   _context->error_concealment=3; \
   if (avcodec_open(_context, codec) < 0)  \
                       { \
-                                        printf(" Decoder init: Lavcodec :"#x" video decoder failed!\n"); \
+                                        printf("[lavc] Decoder init: "#x" video decoder failed!\n"); \
                                         GUI_Alert("Internal error opening "#x); \
                                         ADM_assert(0); \
                                 } \
                                 else \
                                 { \
-                                        printf(" Decoder init: lavcodec "#x" video decoder initialized!\n"); \
+                                        printf("[lavc] Decoder init: "#x" video decoder initialized!\n"); \
                                 } \
 }
 //****************************
@@ -116,19 +108,25 @@
 void
 decoderFF::decoderMultiThread (void)
 {
-  uint32_t nbThread = 0;
+  uint32_t threads = 0;
 
-  nbThread = ADM_useNbThreads ();
-  if (nbThread)
-    {
-      printf ("[codec]Enabling MT decoder with %u threads\n", nbThread);
-      if (0 > avcodec_thread_init (_context, nbThread))
-	{
-	  printf ("[codec]Failed!!\n");
-	  return;
-	}
-      _usingMT = 1;
-    }
+  prefs->get(FEATURE_THREADING_LAVC, &threads);
+
+  if (threads == 0)
+	  threads = pthread_num_processors_np();
+
+  if (threads == 1)
+	  threads = 0;
+
+  if (threads)
+  {
+      printf ("[lavc] Enabling MT decoder with %u threads\n", threads);
+
+      if (avcodec_thread_init (_context, threads) == -1)
+	      printf ("[lavc] Failed!!\n");
+	  else
+          _usingMT = 1;
+  }
 }
 uint8_t decoderFF::getPARWidth (void)
 {
@@ -218,7 +216,7 @@
   _showMv = 0;
 #define FF_SHOW		(FF_DEBUG_VIS_MV_P_FOR+	FF_DEBUG_VIS_MV_B_FOR+FF_DEBUG_VIS_MV_B_BACK)
 //#define FF_SHOW               (FF_DEBUG_VIS_MV_P_FOR)
-  printf ("FFMpeg build : %d\n", LIBAVCODEC_BUILD);
+  printf ("[lavc] Build: %d\n", LIBAVCODEC_BUILD);
   _context->debug_mv |= FF_SHOW;
   _context->debug |= FF_DEBUG_VIS_MB_TYPE + FF_DEBUG_VIS_QP;
 }
@@ -229,7 +227,7 @@
 {
   if (_usingMT)
     {
-      printf ("[decoder] Killing decoding threads\n");
+      printf ("[lavc] Killing decoding threads\n");
       avcodec_thread_free (_context);
       _usingMT = 0;
     }
@@ -237,7 +235,7 @@
   avcodec_close (_context);
   ADM_dealloc (_context);
   delete[]_internalBuffer;
-  printf ("FF base destroyed\n");
+  printf ("[lavc] Destroyed\n");
 }
 
 //-------------------------------
@@ -248,7 +246,7 @@
 
   AVFrame *
     target;
-#define SET(x) {flag=x;aprintf(" Frame is %s\n",#x);}
+#define SET(x) {flag=x;aprintf("Frame is %s\n",#x);}
 
 
   target = &_frame;
@@ -257,7 +255,7 @@
     case FF_B_TYPE:
       SET (AVI_B_FRAME);
       if (target->key_frame)
-	aprintf ("\n But keyframe is  set\n");
+	aprintf ("\n But keyframe is set\n");
       break;
 
     case FF_I_TYPE:
@@ -277,7 +275,7 @@
     case FF_P_TYPE:
       SET (AVI_P_FRAME);
       if (target->key_frame)
-	aprintf ("\n But keyframe is  set\n");
+	aprintf ("\n But keyframe is set\n");
       break;
     default:
 //                              printf("\n OOops XXX frame ?\n");
@@ -291,13 +289,13 @@
     _context->hurry_up = 4;
   else
     _context->hurry_up = 5;
-  printf ("\n FFmpeg: Hurry up\n");
+  printf ("\n[lavc] Hurry up\n");
   return 1;
 }
 uint8_t decoderFF::decodeFull (void)
 {
   _context->hurry_up = 0;
-  printf ("\n FFmpeg: full decoding\n");
+  printf ("\n[lavc] full decoding\n");
   return 1;
 }
 
@@ -326,7 +324,7 @@
   if (in->dataLength == 0 && !_allowNull)	// Null frame, silently skipped
     {
       
-      printf ("\n ff4: null frame\n");
+      printf ("\n[lavc] null frame\n");
       {
 	// search the last image
 	if (_context->coded_frame && _context->coded_frame->data)
@@ -345,8 +343,8 @@
   out->_qStride = 0;		//Default = no quant
   if (0 > ret && !_context->hurry_up)
     {
-      printf ("\n error in FFMP43/mpeg4!\n");
-      printf ("Err: %d, size :%d\n", ret, in->dataLength);
+      printf ("\n[lavc] error in FFMP43/mpeg4!\n");
+      printf ("[lavc] Err: %d, size :%d\n", ret, in->dataLength);
       return 0;
     }
   if (!got_picture && !_context->hurry_up)
@@ -356,7 +354,7 @@
       // it is meant to mean frame skipped but very dubious
       if (in->dataLength <= 8 && codecId == CODEC_ID_MPEG4)
 	{
-	  printf ("Probably pseudo black frame...\n");
+	  printf ("[lavc] Probably pseudo black frame...\n");
 	  out->_Qp = 2;
 	  out->flags = 0;	// assume P ?
 
@@ -378,12 +376,12 @@
 	    {
 	      out->_noPicture = 1;
 	    }
-	  printf ("\n ignoring got pict ==0\n");
+	  printf ("\n[lavc] ignoring got pict ==0\n");
 	  return 1;
 
 	}
-      printf ("Err: %d, size :%d\n", ret, in->dataLength);
-      printf ("\n error in FFMP43/mpeg4!: got picture \n");
+      printf ("[lavc] Err: %d, size: %d\n", ret, in->dataLength);
+      printf ("\n[lavc] error in FFMP43/mpeg4!: got picture\n");
       //GUI_Alert("Please retry with misc->Turbo off");
       //return 1;
       return 0;
@@ -420,14 +418,14 @@
       out->_colorspace = ADM_COLOR_BGR555;
       break;
     default:
-      printf ("\n Unhandled colorspace:%d\n", _context->pix_fmt);
+      printf ("\n[lavc] Unhandled colorspace: %d\n", _context->pix_fmt);
       return 0;
     }
     clonePic (&_frame, out);
     #if 0
-    printf("Frame bitstream order : %u, display order %u Incoming :%u outgoing :%u\n",_frame.coded_picture_number,_frame.display_picture_number,
+    printf("[lavc] Frame bitstream order: %u, display order %u Incoming: %u outgoing: %u\n",_frame.coded_picture_number,_frame.display_picture_number,
          in->demuxerFrameNo,out->demuxerFrameno);
-    printf("in flags :%x out flags :%x\n",in->flags, out->flags);
+    printf("[lavc] in flags: %x out flags: %x\n",in->flags, out->flags);
  #endif 
   return 1;
 }
@@ -448,14 +446,14 @@
   _allowNull = 1;
   decoderMultiThread ();
   WRAP_Open (CODEC_ID_MPEG4);
-  printf("Non low delay mpeg4 decoder initialized\n");
+  printf("[lavc] Non low delay mpeg4 decoder initialized\n");
 }
 decoderFFMpeg4::decoderFFMpeg4 (uint32_t w, uint32_t h, uint32_t fcc,uint32_t l, uint8_t * d):decoderFF (w,
 	   h)
 {
 // force low delay as avidemux don't handle B-frames
   LOWDELAY();
-  printf ("Using %d bytes of extradata for MPEG4 decoder\n", l);
+  printf ("[lavc] Using %d bytes of extradata for MPEG4 decoder\n", l);
   
   _refCopy = 1;			// YUV420 only
   _context->extradata = (uint8_t *) d;
@@ -518,7 +516,7 @@
 {
   _context->extradata = (uint8_t *) d;
   _context->extradata_size = (int) l;
-  printf ("FFhuff: We have :%d bytes of extra data\n", l);
+  printf ("[lavc] FFhuff: We have %d bytes of extra data\n", l);
   WRAP_Open (CODEC_ID_FFVHUFF);
 
 }
@@ -531,7 +529,7 @@
   _context->extradata_size = (int) l;
   if(lowdelay)
     LOWDELAY();
-  printf ("Initializing lavcodec H264 decoder with %d extradata\n", l);
+  printf ("[lavc] Initializing H264 decoder with %d extradata\n", l);
   WRAP_Open (CODEC_ID_H264);
 
 }
@@ -676,7 +674,7 @@
                             in->data, in->dataLength); 
      if(ret<0) 
      {
-        printf("[FFSUB] Error %d\n",ret);
+        printf("[lavc] FFSUB Error %d\n",ret);
         return 0; 
      }
      return 1;
@@ -712,6 +710,6 @@
     char buf[256];
   
     vsnprintf(buf, sizeof(buf), fmt, list);
-    printf("[LAV] %s\n",buf);
+    printf("[lavc] %s\n",buf);
 }
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -3,7 +3,7 @@
                              -------------------
 
 	Encoder for ffmpeg
-	Rever-enginereed from mplayer & transcode
+	Reverse enginereed from mplayer & transcode
 		
 
     begin                : Tue Sep 10 2002
@@ -20,29 +20,25 @@
  *                                                                         *
  ***************************************************************************/
 #include "config.h"
+
+#ifdef USE_FFMPEG
+
 #define __STDC_CONSTANT_MACROS // Lavcodec crap
-#include <stdint.h>
+#define WIN32_CLASH
+
 #include <stdio.h>
 #include <stdlib.h>
-
 #include <string.h>
 #include <math.h>
+#include <pthread.h>
 
-
-#ifdef USE_FFMPEG
 #include "ADM_lavcodec.h"
-
 #include "avi_vars.h"
-#include "prototype.h"
-
-
-#include "ADM_colorspace/colorspace.h"
-//#include "ADM_codecs/ADM_divxEncode.h"
-
 #include "ADM_toolkit/toolkit.hxx"
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 #include "ADM_codecs/ADM_ffmpeg.h"
-#include "ADM_osSupport/ADM_cpuCap.h"
+#include "prefs.h"
+
 //#define TEST_NOB 1
 
 static char LogName[500];
@@ -57,7 +53,7 @@
 /*****************************************/
 uint8_t ffmpegEncoder::stopEncoder(void)
 {
-    printf("[lavcodec] stopEncoder (%x)\n",_context);
+    printf("[lavc] stopEncoder (%x)\n",_context);
     if (_init)
     {
         _init = 0;
@@ -96,7 +92,7 @@
 ffmpegEncoder::ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id):encoder (width,
 	 height)
 {
-  printf ("\n Build : %d \n", LIBAVCODEC_BUILD);
+  printf ("Build: %d\n", LIBAVCODEC_BUILD);
 
   _id = id;
   _swap = 0;
@@ -130,10 +126,10 @@
 /*****************************************/
 ffmpegEncoder::~ffmpegEncoder ()
 {
-  printf ("[codec] FF base encoder destroying..\n");
+  printf ("[lavc] encoder destroying..\n");
   if (_isMT)
     {
-      printf ("[codec] killing threads\n");
+      printf ("[lavc] killing threads\n");
       avcodec_thread_free (_context);
       _isMT = 0;
     }
@@ -207,7 +203,7 @@
     {
       if (FRAME_FILM == identMovieType (rate))
 	{
-	  printf ("\nPulldown activated...\n");
+	  printf ("Pulldown activated...\n");
 	  _context->flags2 |= CODEC_FLAG2_32_PULLDOWN;
 	}
     }
@@ -216,7 +212,7 @@
 #else
   _context->max_b_frames = 2;
 #endif
-  printf ("\n Using 2 b frames \n");
+  printf ("Using 2 b frames\n");
   if (_id == FF_MPEG2)
     {
       _context->mpeg_quant = 1;	//1; // Should be mpeg quant 
@@ -361,30 +357,36 @@
 
   if (res < 0)
     {
-      printf ("\n Problem opening ffmpeg codec\n");
+      printf ("[lavc] Problem opening codec\n");
       return 0;
     }
   return 1;
 
 }
-void
-ffmpegEncoder::encoderMT (void)
+
+void ffmpegEncoder::encoderMT (void)
 {
-  uint32_t nbThread = 0;
+  uint32_t threads = 0;
 
-  nbThread = ADM_useNbThreads ();
-  if (nbThread )
-    {
-      printf ("[codec]Enabling MT encoder with %u threads\n", nbThread);
-      if (0 > avcodec_thread_init (_context, nbThread))
-	{
-	  printf ("[codec]Failed!!\n");
-	  return;
-	}
-      _isMT = 1;
-    }
+  prefs->get(FEATURE_THREADING_LAVC, &threads);
 
+  if (threads == 0)
+	  threads = pthread_num_processors_np();
+
+  if (threads == 1)
+	  threads = 0;
+
+  if (threads)
+  {
+      printf ("[lavc] Enabling MT encoder with %u threads\n", threads);
+
+      if (avcodec_thread_init (_context, threads) == -1)
+	      printf ("[lavc] Failed!!\n");
+	  else
+          _isMT = 1;
+  }
 }
+
 /*
 		Set user selected matrices.
 
@@ -402,7 +404,7 @@
 {
 
   _context->gop_size = size;
-  printf ("\n Gop size is now %d\n", _context->gop_size);
+  printf ("Gop size is now %d\n", _context->gop_size);
   return 1;
 
 }
@@ -468,14 +470,14 @@
     {
       if (!_statfile)
 	{
-	  printf ("FFmpeg using %s as log file\n", LogName);
+	  printf ("[lavc] using %s as log file\n", LogName);
 	  _statfile = fopen (LogName, "wb");
 	}
 
       if (!_statfile)
 	{
 	  printf
-	    ("\n FF codec : cannot open log file for writing ! (%s)\n",
+	    ("[lavc] cannot open log file for writing! (%s)\n",
 	     LogName);
 	  return 0;
 	}
@@ -540,7 +542,7 @@
   uint32_t statSize;
   FILE *_statfile;
 
-  printf ("\n initializing FFmpeg in VBR mode \n");
+  printf ("[lavc] initializing in VBR mode\n");
   _qual = val;
   mplayer_init ();
 
@@ -555,7 +557,7 @@
   _statfile = fopen (LogName, "rb");
   if (!_statfile)
     {
-      printf ("\n internal file does not exists ?\n");
+      printf ("internal file does not exists ?\n");
       return 0;
     }
 
@@ -601,7 +603,7 @@
 ffmpegEncoderVBRExternal::init (uint32_t val, uint32_t fps1000)
 {
 
-  printf ("\n initializing FFmpeg in VBRExternal  mode \n");
+  printf ("[lavc] initializing in VBRExternal mode\n");
   _qual = val;
   mplayer_init ();
 
@@ -641,7 +643,7 @@
 
   if (!_settingsPresence)
     {
-      printf ("\n using FFmpeg default encode settings \n");
+      printf ("[lavc] using default encode settings \n");
       _context->qmin = 2;
       _context->qmax = 31;
       _context->max_b_frames = 0;
@@ -826,7 +828,7 @@
 {
   *d = (uint8_t *) _context->extradata;
   *l = _context->extradata_size;
-  printf ("\n We got some extra data  : %lu \n", *l);
+  printf ("We got some extra data: %lu\n", *l);
   if (*l)
     return 1;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -55,19 +55,17 @@
 //**********************************************************
 uint8_t X264Encoder::preamble (uint32_t fps1000, ADM_x264Param * zparam)
 {
+  x264_t *xhandle = NULL;
 
-  x264_t *
-    xhandle = NULL;
+  printf ("[x264] Opening x264 for %lu x %lu\n", _w, _h);
 
-  printf ("Opening X264 for %lu x %lu\n", _w, _h);
-
   param.i_threads = zparam->nbThreads;
   param.i_width = _w;
   param.i_height = _h;
   param.i_csp = X264_CSP_I420;
 
-#define MKPARAM(x,y) {param.x = zparam->y;printf(#x" = %d\n",param.x);}
-#define MKPARAMF(x,y) {param.x = (float)zparam->y / 100; printf(#x" = %.2f\n",param.x);}
+#define MKPARAM(x,y) {param.x = zparam->y;printf("[x264] "#x" = %d\n",param.x);}
+#define MKPARAMF(x,y) {param.x = (float)zparam->y / 100; printf("[x264] "#x" = %.2f\n",param.x);}
 
   if (zparam->AR_AsInput) {
     param.vui.i_sar_width = video_body->getPARWidth();
@@ -82,7 +80,7 @@
   if(zparam->idc)
   {
     MKPARAM(i_level_idc,idc);
-    printf("***Forcing level =%d\n",param.i_level_idc);
+    printf("[x264] *** Forcing level = %d\n",param.i_level_idc);
   }
   // KeyframeBoost ?
   // BframeReduction ?
@@ -139,7 +137,7 @@
   MKPARAM(analyse.b_mixed_references,MixedRefs);
   MKPARAM(analyse.i_noise_reduction,NoiseReduction);
   
-#define MES(x,y) if(zparam->x) {param.analyse.inter |=X264_ANALYSE_##y;printf(#x" is on\n");}
+#define MES(x,y) if(zparam->x) {param.analyse.inter |=X264_ANALYSE_##y;printf("[x264] "#x" is on\n");}
   param.analyse.inter=0;
   MES(  _8x8P,  PSUB16x16);
   MES(  _8x8B,  BSUB16x16);
@@ -154,27 +152,30 @@
         float       f_vbv_buffer_init;
 
   */
-  printf("VBV_max_br         :%d\n", param.rc.i_vbv_max_bitrate);
-  printf("vbv_buffer_size    :%d\n", param.rc.i_vbv_buffer_size);
-  printf("f_vbv_buffer_init  :%f\n", param.rc.f_vbv_buffer_init);
+  printf("[x264] VBV_max_br = %d\n", param.rc.i_vbv_max_bitrate);
+  printf("[x264] vbv_buffer_size = %d\n", param.rc.i_vbv_buffer_size);
+  printf("[x264] f_vbv_buffer_init = %f\n", param.rc.f_vbv_buffer_init);
   
   if(zparam->globalHeader)
       param.b_repeat_headers=0;
   else
       param.b_repeat_headers=1;
+
   xhandle = x264_encoder_open (&param);
   if (!xhandle)
     return 0;
 
   _handle = (void *) xhandle;
   _pic = (void *) new    x264_picture_t;
-  printf ("X264 init ok (atom mode : %d)\n", zparam->globalHeader);
+  printf ("[x264] init ok (atom mode: %d)\n", zparam->globalHeader);
+
   if (param.i_threads > 1)
-    printf ("X264 using %d threads\n", param.i_threads);
+    printf ("[x264] using %d threads\n", param.i_threads);
+  else if (param.i_threads == 0)
+    printf ("[x264] using threads\n");
+
   if (zparam->globalHeader)
-  {
     return createHeader ();
-  }
   else
     return 1;
 
@@ -243,7 +244,7 @@
   PICS->i_pts = curFrame++;
   if (x264_encoder_encode (HANDLE, &nal, &nbNal, PICS, &pic_out) < 0)
     {
-      printf ("Error encoding with x264\n");
+      printf ("[x264] Error encoding\n");
       return 0;
     }
 
@@ -298,7 +299,7 @@
       out->flags = AVI_B_FRAME;
       break;
     default:
-      printf ("X264 :Unknown image type:%d\n", pic_out.i_type);
+      printf ("[x264] Unknown image type: %d\n", pic_out.i_type);
       //ADM_assert(0);
 
     }
@@ -311,7 +312,7 @@
 uint8_t
   X264EncoderCQ::init (uint32_t val, uint32_t fps1000, ADM_x264Param * zparam)
 {
-  printf ("X264 CQ\n");
+  printf ("[x264] CQ\n");
   memset (&param, 0, sizeof (param));
   x264_param_default (&param);
   memcpy(&admParam,zparam,sizeof(admParam));
@@ -332,7 +333,7 @@
 uint8_t
   X264EncoderAQ::init (uint32_t val, uint32_t fps1000, ADM_x264Param * zparam)
 {
-  printf ("X264 AQ\n");
+  printf ("[x264] AQ\n");
   memset (&param, 0, sizeof (param));
   x264_param_default (&param);
   memcpy(&admParam,zparam,sizeof(admParam));
@@ -358,7 +359,7 @@
   X264EncoderCBR::init (uint32_t val, uint32_t fps1000,
 			ADM_x264Param * zparam)
 {
-  printf ("X264 pass CBR\n");
+  printf ("[x264] pass CBR\n");
   memset (&param, 0, sizeof (param));
   x264_param_default (&param);
   memcpy(&admParam,zparam,sizeof(admParam));
@@ -381,7 +382,7 @@
   X264EncoderPass1::init (uint32_t val, uint32_t fps1000,
 			  ADM_x264Param * zparam)
 {
-  printf ("X264 pass 1\n");
+  printf ("[x264] pass 1\n");
   memset (&param, 0, sizeof (param));
   x264_param_default (&param);
   memcpy(&admParam,zparam,sizeof(admParam));
@@ -411,7 +412,7 @@
     param.rc.psz_stat_out = "/tmp/x264_log.tmp";
   else
     param.rc.psz_stat_out = zparam->logfile;
-  printf ("x264 codec using %s as statfile\n", param.rc.psz_stat_out);
+  printf ("[x264] codec using %s as statfile\n", param.rc.psz_stat_out);
   return preamble (fps1000, &admParam);
 }
 X264EncoderPass1::~X264EncoderPass1 ()
@@ -424,7 +425,7 @@
 			  ADM_x264Param * zparam)
 {
     val=val/1000; // bps->kdps
-  printf ("X264 pass 2, using bitrate of %u\n",val);
+  printf ("[x264] pass 2, using bitrate of %u\n",val);
   memset (&param, 0, sizeof (param));
   x264_param_default (&param);
   
@@ -447,7 +448,7 @@
     param.rc.psz_stat_in = "/tmp/x264_log.tmp";
   else
     param.rc.psz_stat_in = zparam->logfile;
-  printf ("x264 codec using %s as statfile\n", param.rc.psz_stat_in);
+  printf ("[x264] using %s as statfile\n", param.rc.psz_stat_in);
 
   return preamble (fps1000, &admParam);
 }
@@ -535,10 +536,10 @@
 
   if (x264_encoder_headers (HANDLE, &nal, &nal_count))
     {
-      printf ("X264 : Cannot create header\n");
+      printf ("[x264] Cannot create header\n");
       return 0;
     }
-  printf ("Nb nal :%d\n", nal_count);
+  printf ("[x264] Nb nal: %d\n", nal_count);
 
   // Now encode them
   for (int i = 0; i < nal_count; i++)
@@ -553,12 +554,12 @@
 	}
       else
 	{
-	  printf ("?? type :%d in nal %d\n", nal[i].i_type, i);
+	  printf ("[x264] ?? type %d in nal %d\n", nal[i].i_type, i);
 	  sz = x264_nal_encode (buffer, &len, 0, &nal[i]);
 	}
       if (sz <= 0)
 	{
-	  printf ("X264 : Cannot encode nal  header %d\n", i);
+	  printf ("[x264] Cannot encode nal header %d\n", i);
 	  return 0;
 	}
     }
@@ -566,7 +567,7 @@
   // Check we have everything we want
   if (!picParamLen || !seqParamLen)
     {
-      printf ("X264 : Seqparam or PicParam not found\n");
+      printf ("[x264] Seqparam or PicParam not found\n");
       return 0;
     }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -31,8 +31,8 @@
 #include "ADM_codecs/ADM_xvid4param.h"
 #include "ADM_codecs/ADM_xvid4.h"
 #include "xvid.h"
-#include <ADM_assert.h>
-#include "ADM_osSupport/ADM_cpuCap.h"
+#include "ADM_assert.h"
+#include "prefs.h"
 
 #include "ADM_editor/ADM_edit.hxx"
 extern ADM_Composer *video_body;
@@ -92,7 +92,7 @@
                        &xvid_enc_stats);
     if (ret < 0)
     {
-        printf ("Error calling xvid4 %d\n", ret);
+        printf ("[xvid] Error calling xvid4 %d\n", ret);
         return 0;
 
     }
@@ -100,7 +100,7 @@
 
     out->len = ret;
     if (!ret)
-        printf ("Skipped\n");
+        printf ("[xvid] Skipped\n");
     return 1;
 
 }
@@ -116,17 +116,16 @@
   MMSET (xvid_gbl_init2);
   MMSET (xvid_gbl_info);
 
-  printf ("Initializing global xvid 4\n");
+  printf ("[xvid] Initializing global Xvid 4\n");
   xvid_gbl_init2.version = XVID_VERSION;
   xvid_global (NULL, XVID_GBL_INIT, &xvid_gbl_init2, NULL);
   xvid_gbl_info.version = XVID_VERSION;
   xvid_global (NULL, XVID_GBL_INFO, &xvid_gbl_info, NULL);
+
   if (xvid_gbl_info.build)
-    {
-      printf ("\txvid build:%s\n", xvid_gbl_info.build);
-    }
-  printf ("\txvid thread:%d\n", xvid_gbl_info.num_threads);
-  printf ("\txvid SIMD supported:(%x)\n", xvid_gbl_info.cpu_flags);
+      printf ("[xvid] Build: %s\n", xvid_gbl_info.build);
+
+  printf ("[xvid] SIMD supported: (%x)\n", xvid_gbl_info.cpu_flags);
 #define CPUF(x) if(xvid_gbl_info.cpu_flags  & XVID_CPU_##x) printf("\t\t"#x"\n");
 #if defined( ARCH_X86)  || defined(ARCH_X86_64)
   CPUF (MMX);
@@ -157,13 +156,20 @@
 void
 xvid4Encoder::createUpdate (void)
 {
-  uint32_t nbThread = 0;
-  xvid_enc_create.num_threads = 0;
-  if (nbThread = ADM_useNbThreads ())
-    {
-      printf ("Xvid4 : using %u threads..\n", nbThread);
-      xvid_enc_create.num_threads = nbThread;
-    }
+  uint32_t threads = 0;
+
+  prefs->get(FEATURE_THREADING_XVID, &threads);
+
+  if (threads == 0)
+	  xvid_enc_create.num_threads = xvid_gbl_info.num_threads;
+  else if (threads > 1)
+	  xvid_enc_create.num_threads = threads;
+  else
+      xvid_enc_create.num_threads = 0;
+
+  if (xvid_enc_create.num_threads)
+      printf ("[xvid] using %u threads\n", xvid_enc_create.num_threads);
+
   xvid_enc_create.max_bframes = _param.bframes;
   xvid_enc_create.max_key_interval = _param.max_key_interval;
   xvid_enc_create.bquant_ratio = _param.bquant_ratio;
@@ -182,9 +188,9 @@
     }
 
   preAmble (NULL);
-#define C_VOP(x) if(xvid_enc_frame.vop_flags& XVID_VOP_##x) printf("Vop :"#x" is set\n");
-#define C_VOL(x) if(xvid_enc_frame.vol_flags& XVID_VOL_##x) printf("Vol :"#x" is set\n");
-#define C_ME(x) if(xvid_enc_frame.motion& XVID_ME_##x) printf("ME :"#x" is set\n");
+#define C_VOP(x) if(xvid_enc_frame.vop_flags& XVID_VOP_##x) printf("[xvid] Vop: "#x" is set\n");
+#define C_VOL(x) if(xvid_enc_frame.vol_flags& XVID_VOL_##x) printf("[xvid] Vol: "#x" is set\n");
+#define C_ME(x) if(xvid_enc_frame.motion& XVID_ME_##x) printf("[xvid] ME: "#x" is set\n");
 
   C_VOP (DEBUG);
   C_VOP (CHROMAOPT);
@@ -234,15 +240,15 @@
 void
 xvid4Encoder::dump (void)
 {
-  printf ("Xvid4 codec configuration:\n");
+  printf ("[xvid] Configuration:\n");
   if (_param.mpegQuantizer)
-    printf ("\tMPEGQUANT\n");
+    printf ("\t\tMPEGQUANT\n");
   if (_param.interlaced)
-    printf ("\tINTERLACED\n");
+    printf ("\t\tINTERLACED\n");
 
 
 #define ST(x,y) \
-	if(_param.x) printf("\t"#y"\n");
+	if(_param.x) printf("\t\t"#y"\n");
 
 
   ST (inter4mv, INTER4V);
@@ -262,7 +268,7 @@
   if (_handle)
     {
       xvid_encore (_handle, XVID_ENC_DESTROY, NULL, NULL);
-      printf ("Destroying xvid codec\n");
+      printf ("[xvid] Destroying\n");
       _handle = NULL;
     }
   return 1;
@@ -383,13 +389,13 @@
   if(_param.useCustomIntra) 
   {
   if(!xvid_enc_frame.quant_intra_matrix)  
-      printf("[Xvid4]Using custom intra matrix\n");
+      printf("[xvid] Using custom intra matrix\n");
       xvid_enc_frame.quant_intra_matrix=_param.intraMatrix;
   }
   if(_param.useCustomInter)
   {
     if(!xvid_enc_frame.quant_inter_matrix)
-      printf("[Xvid4]Using custom inter matrix\n");
+      printf("[xvid] Using custom inter matrix\n");
      xvid_enc_frame.quant_inter_matrix=_param.interMatrix;
   }
   return 1;
@@ -422,7 +428,7 @@
   xvid4EncoderCQ::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
 {
   int xerr;
-  printf ("Using Xvid 4 codec with CQ mode = %lu (%dx%d)\n", q, _w, _h);
+  printf ("[xvid] CQ mode = %lu (%d x %d)\n", q, _w, _h);
   _q = q;
   _fps1000 = fps1000;
   memcpy (&_param, param, sizeof (_param));
@@ -456,14 +462,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
   if (xerr < 0)
     {
-      printf ("Xvid-4 init error :%d\n", xerr);
+      printf ("[xvid] init error: %d\n", xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf ("Xvid-4 CQ init Ok\n");
+  printf ("[xvid] CQ init Ok\n");
 
   return 1;
 }
@@ -489,7 +495,7 @@
 				 xvid4EncParam * param)
 {
   int xerr;
-  printf ("Using Xvid 4 codec with CQ mode = %lu (%dx%d)\n", q, _w, _h);
+  printf ("[xvid] CQ mode = %lu (%d x %d)\n", q, _w, _h);
   _q = q;
   _fps1000 = fps1000;
   memcpy (&_param, param, sizeof (_param));
@@ -522,14 +528,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
   if (xerr < 0)
     {
-      printf ("Xvid-4 init error :%d\n", xerr);
+      printf ("[xvid] init error: %d\n", xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf ("Xvid-4 CQ init Ok\n");
+  printf ("[xvid] CQ init Ok\n");
 
   return 1;
 }
@@ -565,7 +571,7 @@
   xvid4EncoderCBR::init (uint32_t br, uint32_t fps1000, xvid4EncParam * param)
 {
   int xerr;
-  printf ("Using Xvid 4 codec with CBR mode = %lu kbps\n", br);
+  printf ("[xvid] CBR mode = %lu kbps\n", br);
   _bitrate = br;
   _fps1000 = fps1000;
   memcpy (&_param, param, sizeof (_param));
@@ -599,14 +605,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
   if (xerr < 0)
     {
-      printf ("Xvid-4 init error :%d\n", xerr);
+      printf ("[xvid] Init error: %d\n", xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf ("Xvid-4 CBR init Ok\n");
+  printf ("[xvid] CBR init Ok\n");
 
   return 1;
 }
@@ -628,7 +634,7 @@
 			   xvid4EncParam * param)
 {
   int xerr;
-  printf ("Using Xvid 4 codec pass 1 of 2 (log: %s)\n",
+  printf ("[xvid] Pass 1 of 2 (log: %s)\n",
 	  (char *) param->logName);
 
   _fps1000 = fps1000;
@@ -664,14 +670,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
   if (xerr < 0)
     {
-      printf ("Xvid-4 init error :%d\n", xerr);
+      printf ("[xvid] Init error: %d\n", xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf ("Xvid-4 Pass1 init Ok\n");
+  printf ("[xvid] Pass 1 init Ok\n");
 
   return 1;
 }
@@ -689,7 +695,7 @@
 {
   int xerr;
   printf
-    ("Using Xvid 4 codec with 2pass  mode pass 2 of 2, average bitrate = %lu\n",
+    ("[xvid] Pass 2 of 2, average bitrate = %lu\n",
      br);
   _bitrate = br;
   _fps1000 = fps1000;
@@ -714,7 +720,7 @@
   pass2.filename = (char *) _param.logName;
 
   pass2.bitrate = br;		// Average bitrate
-#define CPY(x) pass2.x=_param.x;printf(#x"=%d\n",pass2.x);
+#define CPY(x) pass2.x=_param.x;printf("[xvid] "#x"=%d\n",pass2.x);
 
   CPY (keyframe_boost);
   CPY (curve_compression_high);
@@ -740,14 +746,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &xvid_enc_create, NULL);
   if (xerr < 0)
     {
-      printf ("Xvid-4 init error :%d\n", xerr);
+      printf ("[xvid] Init error: %d\n", xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf ("Xvid-4 init Ok\n");
+  printf ("[xvid] Init Ok\n");
 
   return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -80,7 +80,7 @@
     encparam.par_height=instream->getPARHeight();
   }else
   {
-      printf("[xvid4]Using %u x %u aspect ratio\n",encparam.par_width,encparam.par_height);
+      printf("[xvid] Using %u x %u aspect ratio\n",encparam.par_width,encparam.par_height);
   }
   
   //
@@ -95,53 +95,53 @@
   switch (_param.mode)
     {
     case COMPRESS_SAME:
-      printf ("Xvid4 in follow quant mode\n");
+      printf ("[xvid] Follow quant mode\n");
       _state = enc_Same;
       _codec = new xvid4EncoderVBRExternal (_w, _h);
       if (!_codec->init (2, info->fps1000, &encparam))
 	{
-	  printf ("Error initi Xvid4 Follow mode\n");
+	  printf ("[xvid] Error init Follow mode\n");
 	  return 0;
 	}
       break;
     case COMPRESS_CQ:
-      printf ("\n Xvid4 cq mode: %ld", _param.qz);
+      printf ("[xvid] CQ mode: %ld\n", _param.qz);
       _state = enc_CQ;
       _codec = new xvid4EncoderCQ (_w, _h);
 
       if (!_codec->init (_param.qz, info->fps1000, &encparam))
 	{
-	  printf ("Error initi Xvid4 CQ mode\n");
+	  printf ("[xvid] Error init CQ mode\n");
 	  return 0;
 	}
       break;
     case COMPRESS_CBR:
-      printf ("\n Xvid4 cbr mode: %lu", _param.bitrate);
+      printf ("[xvid] CBR mode: %lu\n", _param.bitrate);
       _state = enc_CBR;
 
       _codec = new xvid4EncoderCBR (_w, _h);
       if (!_codec->init (_param.bitrate, info->fps1000, &encparam))
 	{
-	  printf ("Error initi Xvid4 CQ mode\n");
+	  printf ("[xvid] Error init CBR mode\n");
 	  return 0;
 	}
       break;
     case COMPRESS_2PASS:
     case COMPRESS_2PASS_BITRATE:
       if(_param.mode==COMPRESS_2PASS)
-          printf ("\n Xvid dual size: %lu (%s)\n", _param.finalsize, _logname);
+          printf ("[xvid] Dual size: %lu (%s)\n", _param.finalsize, _logname);
       else
-          printf ("\n Xvid dual avg br: %u kb/s (%s)\n", _param.avg_bitrate, _logname);
+          printf ("[xvid] Dual avg br: %u kb/s (%s)\n", _param.avg_bitrate, _logname);
       _state = enc_Pass1;
       _codec = new xvid4EncoderPass1 (_w, _h);
       strcpy (encparam.logName, _logname);
-      printf ("Using %s as stat file\n", encparam.logName);
+      printf ("[xvid] Using %s as stat file\n", encparam.logName);
 
       break;
     default:
       ADM_assert (0);
     }
-  printf ("\n Xvid4 Encoder ready , w: %lu h:%lu mode:%d", _w, _h, _state);
+  printf ("[xvid] Encoder ready, w: %lu h: %lu mode: %d\n", _w, _h, _state);
   return 1;
 
 }
@@ -156,7 +156,7 @@
   info = _in->getInfo ();
   if (!_codec->init (_param.bitrate, info->fps1000, &encparam))
     {
-      printf ("Error initi Xvid4 pass1 mode\n");
+      printf ("[xvid] Error init pass 1 mode\n");
       return 0;
     }
   return 1;
@@ -195,7 +195,7 @@
   ADM_assert (_in);
   if (!_in->getFrameNumberNoAlloc (frame, &l, _vbuffer, &f))
     {
-      printf ("\n Error : Cannot read incoming frame !");
+      printf ("[xvid] Error: Cannot read incoming frame!\n");
       return 0;
     }
 
@@ -207,12 +207,12 @@
       if (frame < (encparam.bframes + 1))
 	{
 	  out->flags = AVI_KEY_FRAME;
-	  printf ("Forcing keyframe for B frame\n");
+	  printf ("[xvid] Forcing keyframe for B frame\n");
 	}
       q = _vbuffer->_Qp;
       if (q < 2 || q > 31)
 	{
-	  printf ("Out of bound incoming q:%d\n", q);
+	  printf ("[xvid] Out of bound incoming q: %d\n", q);
 	  if (q < 2)
 	    q = 2;
 	  if (q > 31)
@@ -255,17 +255,17 @@
   uint32_t         br;
 
   ADM_assert (_state == enc_Pass1);
-  printf ("\n Starting pass 2 (%dx%d)\n", _w, _h);
+  printf ("[xvid] Starting pass 2 (%d x %d)\n", _w, _h);
 
   if(_param.mode==COMPRESS_2PASS)
   {
     
     br=ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
-    printf("[Xvid4] Final Size: %u MB, avg bitrate %u kb/s \n",_param.finalsize,br/1000);
+    printf("[xvid] Final Size: %u MB, avg bitrate %u kb/s\n",_param.finalsize,br/1000);
   }else if(_param.mode==COMPRESS_2PASS_BITRATE)
   {
     br=_param.avg_bitrate*1000;
-    printf("[Xvid4] 2pass avg bitrate %u kb/s\n",br/1000);
+    printf("[xvid] 2 pass avg bitrate %u kb/s\n",br/1000);
   }else ADM_assert(0);
 
   _state = enc_Pass2;
@@ -279,10 +279,10 @@
 
   _codec = new xvid4EncoderPass2 (_w, _h);
   strcpy (encparam.logName, _logname);
-  printf ("Using %s as stat file, average bitrate %d kbps\n", _logname,	  br / 1000);
+  printf ("[xvid] Using %s as stat file, average bitrate %d kbps\n", _logname,	  br / 1000);
   if (!_codec->init (br, _fps1000, &encparam))
     {
-      printf ("Error initializing Xvid4 pass1 mode\n");
+      printf ("[xvid] Error initializing pass1 mode\n");
       return 0;
     }
   _frametogo = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -38,15 +38,15 @@
 
 #include "ADM_encoder/adm_encoder.h"
 #include "ADM_encoder/adm_encx264.h"
-#include "ADM_osSupport/ADM_cpuCap.h"
+#include "prefs.h"
 
-
 #define aprintf printf
 
 
 /*_________________________________________________*/
 EncoderX264::EncoderX264 (COMPRES_PARAMS * codecconfig)
 {
+	uint32_t threads = 0;
 
   _codec = NULL;
   strcpy (_logname, "");
@@ -55,7 +55,10 @@
   memcpy (&_param, codecconfig, sizeof (_param));
   ADM_assert (codecconfig->extraSettingsLen == sizeof (_codecParam));
   memcpy (&_codecParam, (codecconfig->extraSettings), sizeof (_codecParam));
-  _codecParam.nbThreads = ADM_useNbThreads ();
+
+  prefs->get(FEATURE_THREADING_X264, &threads);
+
+  _codecParam.nbThreads = threads;
   _logfile = NULL;
 
 };
@@ -70,7 +73,7 @@
 {
   uint8_t r = 0;
   r = _codec->getExtraData (l, data);
-  printf ("x264 has %d extra bytes\n", *l);
+  printf ("[x264] has %d extra bytes\n", *l);
   return r;
 
 }
@@ -93,35 +96,35 @@
     {
 
     case COMPRESS_CQ:
-      printf ("\n X264 cq mode: %ld", _param.qz);
+      printf ("\n[x264] cq mode: %ld", _param.qz);
       _state = enc_CQ;
       _codec = new X264EncoderCQ (_w, _h);
 
       if (!_codec->init (_param.qz, info->fps1000, &_codecParam))
 	{
-	  printf ("Error initi X264 CQ mode\n");
+	  printf ("[x264] Error init CQ mode\n");
 	  return 0;
 	}
       break;
     case COMPRESS_AQ:
-      printf ("\n X264 AQ mode: %ld", _param.qz);
+      printf ("\n[x264] AQ mode: %ld", _param.qz);
       _state = enc_CQ;
       _codec = new X264EncoderAQ (_w, _h);
 
       if (!_codec->init (_param.qz, info->fps1000, &_codecParam))
 	{
-	  printf ("Error initi X264 AQ mode\n");
+	  printf ("[x264] Error init AQ mode\n");
 	  return 0;
 	}
       break;
     case COMPRESS_CBR:
-      printf ("\n X264 cbr mode: %lu", _param.bitrate);
+      printf ("\n[x264] CBR mode: %lu", _param.bitrate);
       _state = enc_CBR;
 
       _codec = new X264EncoderCBR (_w, _h);
       if (!_codec->init (_param.bitrate, info->fps1000, &_codecParam))
 	{
-	  printf ("Error initi X264 CBR mode\n");
+	  printf ("[x264] Error init CBR mode\n");
 	  return 0;
 	}
       break;
@@ -140,7 +143,7 @@
     }
 
 
-  printf ("\n X264 Encoder ready , w: %lu h:%lu mode:%d", _w, _h, _state);
+  printf ("\n[x264] Encoder ready, w: %lu h: %lu mode: %d", _w, _h, _state);
   return 1;
 
 }
@@ -155,7 +158,7 @@
   info = _in->getInfo ();
   if (!_codec->init (_param.bitrate, info->fps1000, &(_codecParam)))
     {
-      printf ("Error initi Xvid4 pass1 mode\n");
+      printf ("[x264] Error init pass 1 mode\n");
       return 0;
     }
   return 1;
@@ -180,7 +183,7 @@
 {
   // strcpy (_logname, lofile);
   _logfile = ADM_strdup (lofile);
-  printf ("Enc X264, using %s as logfile\n", _logfile);
+  printf ("[x264] using %s as logfile\n", _logfile);
   _frametogo = nbframe;
   _totalframe = nbframe;
   return 1;
@@ -199,7 +202,7 @@
 
   if (!_in->getFrameNumberNoAlloc (frame, &l, _vbuffer, &f))
     {
-      printf ("\n Error : Cannot read incoming frame !");
+      printf ("\n[x264] Error: Cannot read incoming frame!");
       return 0;
     }
 
@@ -238,18 +241,16 @@
   return 1;
 
 }
+
 uint32_t ADM_computeBitrate(uint32_t fps1000, uint32_t nbFrame, uint32_t sizeInMB);
+
 uint8_t EncoderX264::startPass2 (void)
 {
-  
   uint32_t    bitrate;
 
   ADM_assert (_state == enc_Pass1);
-  printf ("\n Starting pass 2 (%dx%d)\n", _w, _h);
+  printf ("\n[x264] Starting pass 2 (%d x %d)\n", _w, _h);
 
-
-  
-
   if(_param.mode==COMPRESS_2PASS)
   {
       bitrate=ADM_computeBitrate(_fps1000, _totalframe, _param.finalsize);
@@ -268,14 +269,14 @@
 	_codec;
       _codec = NULL;
     }
-  printf ("\n X264 dual size: %lu MB\n", _param.finalsize);
+  printf ("\n[x264] dual size: %lu MB\n", _param.finalsize);
 
   _codec = new X264EncoderPass2 (_w, _h);
   // strcpy(encparam.logName,_logname);
   //printf("Using %s as stat file, average bitrate %d kbps\n",_logname,finalSize/1000);
   if (!_codec->init (bitrate, _fps1000, &_codecParam))
     {
-      printf ("Error initializing x264 pass1 mode\n");
+      printf ("[x264] Error initializing x264 pass 2 mode\n");
       return 0;
     }
   _frametogo = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -126,7 +126,9 @@
 	{"feature.use_systray",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.reuse_2pass_log",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.audiobar_uses_master",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.multi_thread",		UINT,	"0",	NULL,	"0",	"4"	},
+	{"feature.threading.lavc",		UINT,	"0",	NULL,	"0",	"32"	},
+	{"feature.threading.x264",		UINT,	"0",	NULL,	"0",	"32"	},
+	{"feature.threading.xvid",		UINT,	"0",	NULL,	"0",	"32"	},
 	{"feature.cpu_caps",		UINT,	"4294967295",NULL,	"0",	"4294967295"},
 	{"feature.mpeg_no_limit",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.auto_buildmap",		UINT,	"0",	NULL,	"0",	"1"	},
@@ -143,7 +145,7 @@
 	{"priority.playback",		UINT,	"0",	NULL,	"0",	"4"	}
 };
 
-int num_opts = 79;
+int num_opts = 81;
 // </prefs_gen>
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -131,18 +131,7 @@
 	printf("[cpuCaps]End of CPU capabilities check (cpuMask :%x)\n",myCpuMask);
 	return ;
 }
-/*
-        Returns # of threads to use,  0 means multithreading disabled
 
-*/
-uint32_t ADM_useNbThreads( void )
-{
-uint32_t multi;
-        if( prefs->get(FEATURE_MULTI_THREAD,&multi) != RC_OK )
-                return  0;
-        if(multi<2) multi=0; // On thread means no threading...
-        return multi;
-}
 /************************************************************************/
 #include "ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h"
 int ADM_mpeg2dec_mm_support(void)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -51,7 +51,7 @@
 
 
 };
-uint32_t ADM_useNbThreads( void ); // FIXME, should not be here
+
 #if (defined( ARCH_X86)  || defined(ARCH_X86_64)) && defined(HAVE_BUILTIN_VECTOR)
 #define USE_SSE 1
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-16 17:22:50 UTC (rev 3518)
@@ -7,6 +7,7 @@
 SET(${ADM_LIB}_SRCS
 DIA_color.cpp          DIA_filesel.cpp  FAC_bitrate.cpp  FAC_float.cpp  FAC_hex.cpp      FAC_menu.cpp   FAC_readOnlyText.cpp
 DIA_dialogFactory.cpp  FAC_bar.cpp      FAC_button.cpp   FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp  FAC_toggle.cpp
+FAC_threadCount.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -80,7 +80,7 @@
   
   
   /* Add text -> encoding mode */
-  label2 = gtk_label_new_with_mnemonic ("_Bitrate (kb/s):");
+  label2 = gtk_label_new_with_mnemonic (_("_Bitrate (kb/s):"));
   gtk_misc_set_alignment (GTK_MISC (label2), 0.0, 0.5);
   gtk_widget_show(label2);
   /* put entry in hbox */

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -0,0 +1,137 @@
+/***************************************************************************
+  FAC_threadCount.cpp
+  Handle dialog factory element : ThreadCount
+  (C) 2007 Gruntster
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+
+#include "config.h"
+#include "default.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_commonUI/DIA_factory.h"
+
+static void customToggled(void *widget, void *userData);
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT)
+{
+	param=(void *)value;
+	paramTitle = title;
+	this->tip=tip;
+}
+
+diaElemThreadCount::~diaElemThreadCount()
+{
+	GtkWidget *w = (GtkWidget*)myWidget;
+	delete[] w;
+	myWidget = NULL;
+}
+
+void diaElemThreadCount::getMe(void)
+{
+	GtkWidget **widgets = (GtkWidget**)myWidget;
+	uint32_t *val = (uint32_t*)param;
+
+	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[0])))
+		*val = 1;   // disabled
+	else if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[1])))
+		*val = 0;   // auto-detect
+	else
+		*val = gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(widgets[3]));   // custom
+}
+
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line)
+{
+	GtkWidget *label1;
+	GtkWidget *hbox1;
+	GtkWidget *radiobutton1;
+	GSList *radiobutton_group = NULL;
+	GtkWidget *radiobutton2;
+	GtkWidget *hbox2;
+	GtkWidget *radiobutton3;
+	GtkObject *spinbutton1_adj;
+	GtkWidget *spinbutton1;
+
+	label1 = gtk_label_new_with_mnemonic (paramTitle);
+	gtk_widget_show (label1);
+	gtk_misc_set_alignment (GTK_MISC (label1), 0.0, 0.5);
+
+	gtk_table_attach (GTK_TABLE (opaque), label1, 0, 1, line, line+1,
+					(GtkAttachOptions) (GTK_FILL),
+					(GtkAttachOptions) (0), 0, 0);
+
+	hbox1 = gtk_hbox_new (FALSE, 20);
+	gtk_widget_show (hbox1);
+
+	radiobutton1 = gtk_radio_button_new_with_mnemonic (NULL, _("Disable"));
+	gtk_widget_show (radiobutton1);
+	gtk_box_pack_start (GTK_BOX (hbox1), radiobutton1, FALSE, FALSE, 0);
+
+	radiobutton2 = gtk_radio_button_new_with_label_from_widget(GTK_RADIO_BUTTON(radiobutton1), _("Auto-detect"));
+	gtk_widget_show (radiobutton2);
+	gtk_box_pack_start (GTK_BOX (hbox1), radiobutton2, FALSE, FALSE, 0);
+
+	hbox2 = gtk_hbox_new (FALSE, 6);
+	gtk_widget_show (hbox2);
+	gtk_box_pack_start (GTK_BOX (hbox1), hbox2, FALSE, FALSE, 0);
+
+	radiobutton3 = gtk_radio_button_new_with_label_from_widget(GTK_RADIO_BUTTON(radiobutton1), _("Custom"));
+	gtk_widget_show (radiobutton3);
+	gtk_box_pack_start (GTK_BOX (hbox2), radiobutton3, TRUE, TRUE, 0);
+
+	spinbutton1_adj = gtk_adjustment_new (2, 2, 32, 1, 10, 10);
+	spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
+	gtk_widget_show (spinbutton1);
+	gtk_box_pack_start (GTK_BOX (hbox2), spinbutton1, TRUE, TRUE, 0);
+
+	gtk_table_attach (GTK_TABLE (opaque), hbox1, 1, 2, line, line+1,
+					(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+					(GtkAttachOptions) (0), 0, 0);
+
+	g_signal_connect(GTK_OBJECT(radiobutton3), "toggled",
+					GTK_SIGNAL_FUNC(customToggled),  this);
+
+	GtkWidget **w;
+	w = new GtkWidget*[4];
+
+	w[0] = radiobutton1;
+	w[1] = radiobutton2;
+	w[2] = radiobutton3;
+	w[3] = spinbutton1;
+
+	myWidget = (void *)w;
+
+	uint32_t val = *(uint32_t *)param;
+
+	gtk_widget_set_sensitive(GTK_WIDGET(spinbutton1), val > 1);
+
+	if (val == 0)
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton2), TRUE);
+	else if (val == 1)
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton1), TRUE);
+	else
+	{
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton3), TRUE);
+		gtk_spin_button_set_value (GTK_SPIN_BUTTON(spinbutton1), val);
+	}
+}
+
+void customToggled(void *widget, void *userData)
+{
+	diaElemThreadCount *elem = (diaElemThreadCount*)userData;
+
+	GtkWidget **widgets = (GtkWidget**)(elem->myWidget);
+
+	gtk_widget_set_sensitive(GTK_WIDGET(widgets[3]), gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[2])));
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-16 17:22:50 UTC (rev 3518)
@@ -21,6 +21,7 @@
 FAC_frame.cpp \
 FAC_hex.cpp \
 FAC_button.cpp \
-DIA_color.cpp
+DIA_color.cpp \
+FAC_threadCount.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -413,4 +413,10 @@
 {
 }
 
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT) {}
+diaElemThreadCount::~diaElemThreadCount() {}
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line) {}
+void diaElemThreadCount::getMe(void) {}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-16 17:22:50 UTC (rev 3518)
@@ -11,6 +11,7 @@
 filesel        
 menu
 toggle
+threadCount
 )
 
 SET(${ADM_LIB}_SRCS

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-16 17:22:50 UTC (rev 3518)
@@ -4,7 +4,7 @@
 libADM_dialogFactory_a_METASOURCES = AUTO
 
 libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp AT_toggle.cpp FAC_integer.cpp AT_menu.cpp FAC_float.cpp \
-AT_filesel.cpp AT_bitrate.cpp \
+AT_filesel.cpp AT_bitrate.cpp AT_threadCount.cpp \
 AT_button.cpp \
 FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp FAC_hex.cpp
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -0,0 +1,143 @@
+/***************************************************************************
+FAC_toggle.cpp
+Handle dialog factory element : Thread Count
+(C) 2007 Gruntster 
+***************************************************************************/
+
+/***************************************************************************
+*                                                                         *
+*   This program is free software; you can redistribute it and/or modify  *
+*   it under the terms of the GNU General Public License as published by  *
+*   the Free Software Foundation; either version 2 of the License, or     *
+*   (at your option) any later version.                                   *
+*                                                                         *
+***************************************************************************/
+
+#include "config.h"
+
+#include <QGridLayout>
+#include <QLabel>
+#include <QRadioButton>
+#include <QButtonGroup>
+#include <QSpinBox>
+
+#include "default.h"
+#include "ADM_commonUI/DIA_factory.h"
+
+extern const char* shortkey(const char*);
+
+class ADM_QthreadCount : public QWidget
+{
+	Q_OBJECT
+
+signals:
+
+public slots:
+
+	void radioGroupChanged(QAbstractButton *s)
+	{
+		spinBox->setEnabled(radiobutton3->isChecked());
+	}
+
+public:
+
+	QLabel *text;
+	QRadioButton *radiobutton1;
+	QRadioButton *radiobutton2;
+	QRadioButton *radiobutton3;
+	QButtonGroup *buttonGroup;
+	QSpinBox *spinBox;
+
+	ADM_QthreadCount(QWidget *widget, const char *title, uint32_t value, QGridLayout *layout, int line) : QWidget(widget) 
+	{
+		radiobutton1 = new QRadioButton("Disabled", widget);
+		radiobutton2 = new QRadioButton("Auto-detect", widget);
+		radiobutton3 = new QRadioButton("Custom", widget);
+
+		buttonGroup = new QButtonGroup;
+		buttonGroup->addButton(radiobutton1);
+		buttonGroup->addButton(radiobutton2);
+		buttonGroup->addButton(radiobutton3);
+
+		spinBox = new QSpinBox();
+		spinBox->setRange(2, 32);
+
+		text = new QLabel(title, widget);
+		text->setBuddy(radiobutton1);
+
+		layout->addWidget(text, line, 0);
+		layout->addWidget(radiobutton1, line, 1);
+		layout->addWidget(radiobutton2, line, 2);
+		layout->addWidget(radiobutton3, line, 3);
+		layout->addWidget(spinBox, line, 4);
+
+		QObject::connect(buttonGroup, SIGNAL(buttonClicked(QAbstractButton*)), this, SLOT(radioGroupChanged(QAbstractButton*)));
+
+		spinBox->setEnabled(value > 1);
+
+		if (value == 0)
+			radiobutton2->setChecked(true);
+		else if (value == 1)
+			radiobutton1->setChecked(true);
+		else
+		{
+			radiobutton3->setChecked(true);
+			spinBox->setValue(value);
+		}
+	}
+
+	~ADM_QthreadCount() 
+	{
+		if (buttonGroup)
+			delete buttonGroup;
+
+		if (radiobutton1)
+			delete radiobutton1;
+
+		if (radiobutton2)
+			delete radiobutton2;
+
+		if (radiobutton3)
+			delete radiobutton3;
+
+		if (spinBox)
+			delete spinBox;
+
+		if (text)
+			delete text;
+	}
+};
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT)
+{
+	param = (void*)value;
+	paramTitle = shortkey(title);
+	this->tip = tip;
+}
+
+diaElemThreadCount::~diaElemThreadCount()
+{
+	delete paramTitle;
+}
+
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line)
+{
+	QGridLayout *layout = (QGridLayout*)opaque;
+
+	ADM_QthreadCount *threadCount = new ADM_QthreadCount((QWidget*)dialog, paramTitle, *(uint32_t *)param, layout, line);
+
+	myWidget = (void*)threadCount;
+}
+
+void diaElemThreadCount::getMe(void)
+{
+	ADM_QthreadCount *threadCount = (ADM_QthreadCount*)myWidget;
+	uint32_t *val = (uint32_t*)param;
+
+	if ((threadCount->radiobutton1)->isChecked())
+		*val = 1;
+	else if ((threadCount->radiobutton2)->isChecked())
+		*val = 0;
+	else
+		*val = (threadCount->spinBox)->value();
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -38,6 +38,7 @@
   ELEM_TOGGLE_INT,
   ELEM_BUTTON,
   ELEM_SLIDER,
+  ELEM_THREAD_COUNT,
   ELEM_MAX=ELEM_TOGGLE
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
@@ -412,6 +413,16 @@
   void finalize(void);
 };
 /**********************************************/
+class diaElemThreadCount : public diaElem
+{
+
+public:
+  
+  diaElemThreadCount(uint32_t *value, const char *title, const char *tip = NULL);
+  virtual ~diaElemThreadCount() ;
+  void setMe(void *dialog, void *opaque, uint32_t line);
+  void getMe(void);
+};
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 uint8_t diaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -48,8 +48,6 @@
 */
 uint8_t DIA_Preferences(void)
 {
-uint8_t ret=0;
-
 uint32_t olddevice,newdevice;
 
 uint32_t	lavcodec_mpeg=0;
@@ -61,7 +59,7 @@
 uint32_t useAutoIndex=0;
 uint32_t useSwap=0;
 uint32_t useNuv=0;
-uint32_t mthreads=0;
+uint32_t lavcThreads=0,x264Threads=0,xvidThreads=0;
 uint32_t encodePriority=2;
 uint32_t indexPriority=2;
 uint32_t playbackPriority=0;
@@ -137,8 +135,10 @@
         if(!prefs->get(FEATURE_MPEG_NO_LIMIT,&mpeg_no_limit)) mpeg_no_limit=0;
 
         // Multithreads
-        if(!prefs->get(FEATURE_MULTI_THREAD, &mthreads))
-                mthreads=0;
+        prefs->get(FEATURE_THREADING_LAVC, &lavcThreads);
+        prefs->get(FEATURE_THREADING_X264, &x264Threads);
+        prefs->get(FEATURE_THREADING_XVID, &xvidThreads);
+
 		// Encoding priority
 		if(!prefs->get(PRIORITY_ENCODING, &encodePriority))
                 encodePriority=2;
@@ -197,13 +197,11 @@
         diaElemToggle togAutoVbr(&autovbr,_("Automatically _build VBR map"));
         diaElemToggle togAutoIndex(&autoindex,_("Automatically _rebuild index"));
         diaElemToggle togAutoUnpack(&autounpack,_("Automatically remove _packed bitstream"));
-                       
-        diaElemUInteger multiThread(&mthreads,_("_Number of threads:"),0,10);
 
 
         
-        diaElemToggle capsToggleAll(&capsAll,_("Enable all Simd"));
-        diaElemFrame      frameSimd(_("Simd"));
+        diaElemToggle capsToggleAll(&capsAll,_("Enable all SIMD"));
+        diaElemFrame      frameSimd(_("SIMD"));
         frameSimd.swallow(&capsToggleAll);
         
 #define CAPS_TOGGLE(x) diaElemToggle       capsToggle##x(&(caps##x),_("Enable "#x));\
@@ -219,8 +217,15 @@
         CAPS_TOGGLE(SSE3);
         CAPS_TOGGLE(SSSE3);        
       
+		diaElemThreadCount lavcThreadCount(&lavcThreads, _("_lavc threads:"));
+		diaElemThreadCount x264ThreadCount(&x264Threads, _("_x264 threads:"));
+		diaElemThreadCount xvidThreadCount(&xvidThreads, _("X_vid threads:"));
 
-        
+		diaElemFrame frameThread(_("Multi-threading"));
+		frameThread.swallow(&lavcThreadCount);
+		frameThread.swallow(&x264ThreadCount);
+		frameThread.swallow(&xvidThreadCount);
+
 		diaMenuEntry priorityEntries[] = {
                              {0,       _("High"),NULL}
                              ,{1,      _("Above normal"),NULL}
@@ -232,6 +237,11 @@
 		diaElemMenu menuIndexPriority(&indexPriority,_("_Indexing/unpacking priority:"), sizeof(priorityEntries)/sizeof(diaMenuEntry), priorityEntries,"");
 		diaElemMenu menuPlaybackPriority(&playbackPriority,_("_Playback priority:"), sizeof(priorityEntries)/sizeof(diaMenuEntry), priorityEntries,"");
 
+		diaElemFrame framePriority(_("Prioritisation"));
+		framePriority.swallow(&menuEncodePriority);
+		framePriority.swallow(&menuIndexPriority);
+		framePriority.swallow(&menuPlaybackPriority);
+
         diaElemUInteger autoSplit(&autosplit,_("_Split MPEG files every (MB):"),10,4096);
         
         diaElemToggle   togTagMp3(&alternate_mp3_tag,_("_Use alternative tag for MP3 in .mp4"));
@@ -378,28 +388,27 @@
 #endif
         
         /* Fifth Tab : video */
-        
         diaElem *diaVideo[]={&menuVideoMode,&framePP};
         diaElemTabs tabVideo(_("Video"),2,(diaElem **)diaVideo);
         
-        /* Sixth Tab : mthread */
-        diaElem *diaCpu[]={&multiThread, &frameSimd,&menuEncodePriority, &menuIndexPriority, &menuPlaybackPriority};
-        
-        
-        
-        diaElemTabs tabCpu(_("CPU"),4,(diaElem **)diaCpu);
-        
-        /* 7th Tab : Global Glyph */
+        /* CPU tab */
+		diaElem *diaCpu[]={&frameSimd};
+		diaElemTabs tabCpu(_("CPU"),1,(diaElem **)diaCpu);
+
+        /* Threading tab */
+		diaElem *diaThreading[]={&frameThread, &framePriority};
+		diaElemTabs tabThreading(_("Threading"),2,(diaElem **)diaThreading);
+
+        /* Global Glyph tab */
         diaElem *diaGlyph[]={&menuGlobaGlyh,&entryGLyphPath};
         diaElemTabs tabGlyph(_("Global Glyphset"),2,(diaElem **)diaGlyph);
-        
-        
-        /* 8th Tab : Xfilter */
+
+        /* Xfilter tab */
         diaElem *diaXFilter[]={&loadEx,&entryFilterPath};
         diaElemTabs tabXfilter(_("External Filters"),2,(diaElem **)diaXFilter);
                                     
 // SET
-        diaElemTabs *tabs[]={&tabUser,&tabAuto,&tabInput,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabGlyph,&tabXfilter};
+        diaElemTabs *tabs[]={&tabUser,&tabAuto,&tabInput,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabThreading,&tabGlyph,&tabXfilter};
         if( diaFactoryRunTabs(_("Preferences"),9,tabs))
 	{
         	
@@ -422,12 +431,11 @@
         	    	CPU_CAPS(SSSE3);
         		}
         		prefs->set(FEATURE_CPU_CAPS,CpuCaps::myCpuMask);
+
         		// Glyphs
                prefs->set(FEATURE_GLOBAL_GLYPH_ACTIVE,useGlobalGlyph);
                prefs->set(FEATURE_GLOBAL_GLYPH_NAME,globalGlyphName);
 
-          
-		ret=1;
                 // Postproc
                 #undef DOME
                 #define DOME(x,y) if(y) pp_type |=x;
@@ -475,8 +483,10 @@
                 prefs->set(SETTINGS_MPEGSPLIT, autosplit);
                 
                 // number of threads
-                if(mthreads<2) mthreads=0;
-                prefs->set(FEATURE_MULTI_THREAD, mthreads);
+                prefs->set(FEATURE_THREADING_LAVC, lavcThreads);
+				prefs->set(FEATURE_THREADING_X264, x264Threads);
+				prefs->set(FEATURE_THREADING_XVID, xvidThreads);
+
 				// Encoding priority
 				prefs->set(PRIORITY_ENCODING, encodePriority);
 				// Indexing / unpacking priority

Modified: branches/avidemux_2.4_branch/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -72,7 +72,9 @@
 	FEATURE_USE_SYSTRAY,
 	FEATURE_REUSE_2PASS_LOG,
 	FEATURE_AUDIOBAR_USES_MASTER,
-	FEATURE_MULTI_THREAD,
+	FEATURE_THREADING_LAVC,
+	FEATURE_THREADING_X264,
+	FEATURE_THREADING_XVID,
 	FEATURE_CPU_CAPS,
 	FEATURE_MPEG_NO_LIMIT,
 	FEATURE_AUTO_BUILDMAP,

Modified: branches/avidemux_2.4_branch/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-16 17:22:50 UTC (rev 3518)
@@ -81,7 +81,9 @@
 feature.use_systray,                    UINT,   0,      0,      1
 feature.reuse_2pass_log,                UINT,   0,      0,      1
 feature.audiobar_uses_master,           UINT,   0,      0,      1
-feature.multi_thread,                   UINT,   0,      0,      4
+feature.threading.lavc,                 UINT,   0,      0,      32
+feature.threading.x264,                 UINT,   0,      0,      32
+feature.threading.xvid,                 UINT,   0,      0,      32
 feature.cpu_caps,  		                UINT,   4294967295,      0,      4294967295
 feature.mpeg_no_limit,                  UINT,   0,      0,      1
 feature.auto_buildmap,                  UINT,   0,      0,      1



From gruntster at mail.berlios.de  Thu Aug 16 19:27:42 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 16 Aug 2007 19:27:42 +0200
Subject: [Avidemux-svn-commit] r3519 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200708161727.l7GHRgMt010642@sheep.berlios.de>

Author: gruntster
Date: 2007-08-16 19:27:27 +0200 (Thu, 16 Aug 2007)
New Revision: 3519

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h
Log:
[Codec] enable Snow decoder

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c	2007-08-16 17:22:50 UTC (rev 3518)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c	2007-08-16 17:27:27 UTC (rev 3519)
@@ -47,6 +47,7 @@
     DECLARE_DECODER (RV20, rv20);
     DECLARE_DECODER (DVBSUB, dvbsub);
     DECLARE_DECODER (FLV, flv);
+	DECLARE_DECODER (SNOW, snow);
 
 #undef DECLARE_DECODER
 #define DECLARE_DECODER(a,b); printf("#define ENABLE_"#a"_DECODER 0\n"); 
@@ -134,7 +135,6 @@
     DECLARE_DECODER (RAWVIDEO, rawvideo);
     DECLARE_DECODER (ROQ, roq);
     DECLARE_DECODER (SGI, sgi);
-    DECLARE_DECODER (SNOW, snow);
     DECLARE_DECODER (SVQ1, svq1);
     DECLARE_DECODER (TARGA, targa);
     DECLARE_DECODER (TIFF, tiff);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h	2007-08-16 17:22:50 UTC (rev 3518)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h	2007-08-16 17:27:27 UTC (rev 3519)
@@ -1,305 +1,305 @@
-#define ENABLE_CINEPAK_DECODER 1
-#define ENABLE_DNXHD_DECODER 1
-#define ENABLE_FOURXM_DECODER 1
-#define ENABLE_FRAPS_DECODER 1
-#define ENABLE_H263I_DECODER 1
-#define ENABLE_H264_DECODER 1
-#define ENABLE_INDEO2_DECODER 1
-#define ENABLE_INDEO3_DECODER 1
-#define ENABLE_INTERPLAY_VIDEO_DECODER 1
-#define ENABLE_MPEGVIDEO_DECODER 1
-#define ENABLE_MSVIDEO1_DECODER 1
-#define ENABLE_VC1_DECODER 1
-#define ENABLE_VCR1_DECODER 1
-#define ENABLE_VP5_DECODER 1
-#define ENABLE_VP6_DECODER 1
-#define ENABLE_VP6F_DECODER 1
-#define ENABLE_WMV3_DECODER 1
-#define ENABLE_WMV1_DECODER 1
-#define ENABLE_WMV2_DECODER 1
-#define ENABLE_VP3_DECODER 1
-#define ENABLE_MPEG4_DECODER 1
-#define ENABLE_MSMPEG4V1_DECODER 1
-#define ENABLE_MSMPEG4V2_DECODER 1
-#define ENABLE_MSMPEG4V3_DECODER 1
-#define ENABLE_MJPEGB_DECODER 1
-#define ENABLE_MJPEG_DECODER 1
-#define ENABLE_WMAV2_DECODER 1
-#define ENABLE_DVVIDEO_DECODER 1
-#define ENABLE_HUFFYUV_DECODER 1
-#define ENABLE_FFVHUFF_DECODER 1
-#define ENABLE_SVQ3_DECODER 1
-#define ENABLE_TSCC_DECODER 1
-#define ENABLE_QDM2_DECODER 1
-#define ENABLE_FFV1_DECODER 1
-#define ENABLE_MPEG1VIDEO_DECODER 1
-#define ENABLE_MPEG2VIDEO_DECODER 1
-#define ENABLE_RV10_DECODER 1
-#define ENABLE_RV20_DECODER 1
-#define ENABLE_DVBSUB_DECODER 1
-#define ENABLE_FLV_DECODER 1
-#define ENABLE_AASC_DECODER 0
-#define ENABLE_AVS_DECODER 0
-#define ENABLE_BETHSOFTVID_DECODER 0
-#define ENABLE_C93_DECODER 0
-#define ENABLE_CAVS_DECODER 0
-#define ENABLE_CLJR_DECODER 0
-#define ENABLE_CSCD_DECODER 0
-#define ENABLE_CYUV_DECODER 0
-#define ENABLE_DSICINVIDEO_DECODER 0
-#define ENABLE_DXA_DECODER 0
-#define ENABLE_EIGHTBPS_DECODER 0
-#define ENABLE_FLIC_DECODER 0
-#define ENABLE_IDCIN_DECODER 0
-#define ENABLE_KMVC_DECODER 0
-#define ENABLE_LOCO_DECODER 0
-#define ENABLE_MDEC_DECODER 0
-#define ENABLE_MMVIDEO_DECODER 0
-#define ENABLE_MPEG_XVMC_DECODER 0
-#define ENABLE_MSRLE_DECODER 0
-#define ENABLE_MSZH_DECODER 0
-#define ENABLE_NUV_DECODER 0
-#define ENABLE_PTX_DECODER 0
-#define ENABLE_QDRAW_DECODER 0
-#define ENABLE_QPEG_DECODER 0
-#define ENABLE_RPZA_DECODER 0
-#define ENABLE_SMACKER_DECODER 0
-#define ENABLE_SMC_DECODER 0
-#define ENABLE_SP5X_DECODER 0
-#define ENABLE_THEORA_DECODER 0
-#define ENABLE_THP_DECODER 0
-#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
-#define ENABLE_TRUEMOTION1_DECODER 0
-#define ENABLE_TRUEMOTION2_DECODER 0
-#define ENABLE_TXD_DECODER 0
-#define ENABLE_ULTI_DECODER 0
-#define ENABLE_VMDVIDEO_DECODER 0
-#define ENABLE_VMNC_DECODER 0
-#define ENABLE_VQA_DECODER 0
-#define ENABLE_WNV1_DECODER 0
-#define ENABLE_XAN_WC3_DECODER 0
-#define ENABLE_XL_DECODER 0
-#define ENABLE_MPEG4AAC_DECODER 0
-#define ENABLE_ALAC_DECODER 0
-#define ENABLE_ATRAC3_DECODER 0
-#define ENABLE_COOK_DECODER 0
-#define ENABLE_DCA_DECODER 0
-#define ENABLE_DSICINAUDIO_DECODER 0
-#define ENABLE_IMC_DECODER 0
-#define ENABLE_LIBA52_DECODER 0
-#define ENABLE_LIBFAAD_DECODER 0
-#define ENABLE_MACE3_DECODER 0
-#define ENABLE_MACE6_DECODER 0
-#define ENABLE_MP3_DECODER 0
-#define ENABLE_MP3ADU_DECODER 0
-#define ENABLE_MP3ON4_DECODER 0
-#define ENABLE_MPC7_DECODER 0
-#define ENABLE_RA_144_DECODER 0
-#define ENABLE_RA_288_DECODER 0
-#define ENABLE_SHORTEN_DECODER 0
-#define ENABLE_SMACKAUD_DECODER 0
-#define ENABLE_TRUESPEECH_DECODER 0
-#define ENABLE_TTA_DECODER 0
-#define ENABLE_VMDAUDIO_DECODER 0
-#define ENABLE_WAVPACK_DECODER 0
-#define ENABLE_WS_SND1_DECODER 0
-#define ENABLE_INTERPLAY_DPCM_DECODER 0
-#define ENABLE_SOL_DPCM_DECODER 0
-#define ENABLE_XAN_DPCM_DECODER 0
-#define ENABLE_ADPCM_THP_DECODER 0
-#define ENABLE_ASV1_DECODER 0
-#define ENABLE_ASV2_DECODER 0
-#define ENABLE_BMP_DECODER 0
-#define ENABLE_FLASHSV_DECODER 0
-#define ENABLE_GIF_DECODER 0
-#define ENABLE_H261_DECODER 0
-#define ENABLE_H263_DECODER 0
-#define ENABLE_JPEGLS_DECODER 0
-#define ENABLE_PNG_DECODER 0
-#define ENABLE_QTRLE_DECODER 0
-#define ENABLE_RAWVIDEO_DECODER 0
-#define ENABLE_ROQ_DECODER 0
-#define ENABLE_SGI_DECODER 0
-#define ENABLE_SNOW_DECODER 0
-#define ENABLE_SVQ1_DECODER 0
-#define ENABLE_TARGA_DECODER 0
-#define ENABLE_TIFF_DECODER 0
-#define ENABLE_ZLIB_DECODER 0
-#define ENABLE_ZMBV_DECODER 0
-#define ENABLE_FLAC_DECODER 0
-#define ENABLE_LIBAMR_NB_DECODER 0
-#define ENABLE_LIBAMR_WB_DECODER 0
-#define ENABLE_LIBGSM_DECODER 0
-#define ENABLE_LIBGSM_MS_DECODER 0
-#define ENABLE_MP2_DECODER 0
-#define ENABLE_SONIC_DECODER 0
-#define ENABLE_VORBIS_DECODER 0
-#define ENABLE_WMAV1_DECODER 0
-#define ENABLE_PCM_ALAW_DECODER 0
-#define ENABLE_PCM_MULAW_DECODER 0
-#define ENABLE_PCM_S8_DECODER 0
-#define ENABLE_PCM_S16BE_DECODER 0
-#define ENABLE_PCM_S16LE_DECODER 0
-#define ENABLE_PCM_S24BE_DECODER 0
-#define ENABLE_PCM_S24DAUD_DECODER 0
-#define ENABLE_PCM_S24LE_DECODER 0
-#define ENABLE_PCM_S32BE_DECODER 0
-#define ENABLE_PCM_S32LE_DECODER 0
-#define ENABLE_PCM_U8_DECODER 0
-#define ENABLE_PCM_U16BE_DECODER 0
-#define ENABLE_PCM_U16LE_DECODER 0
-#define ENABLE_PCM_U24BE_DECODER 0
-#define ENABLE_PCM_U24LE_DECODER 0
-#define ENABLE_PCM_U32BE_DECODER 0
-#define ENABLE_PCM_U32LE_DECODER 0
-#define ENABLE_ROQ_DPCM_DECODER 0
-#define ENABLE_ADPCM_4XM_DECODER 0
-#define ENABLE_ADPCM_ADX_DECODER 0
-#define ENABLE_ADPCM_CT_DECODER 0
-#define ENABLE_ADPCM_EA_DECODER 0
-#define ENABLE_ADPCM_G726_DECODER 0
-#define ENABLE_ADPCM_IMA_DK3_DECODER 0
-#define ENABLE_ADPCM_IMA_DK4_DECODER 0
-#define ENABLE_ADPCM_IMA_QT_DECODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
-#define ENABLE_ADPCM_IMA_WAV_DECODER 0
-#define ENABLE_ADPCM_IMA_WS_DECODER 0
-#define ENABLE_ADPCM_MS_DECODER 0
-#define ENABLE_ADPCM_SBPRO_2_DECODER 0
-#define ENABLE_ADPCM_SBPRO_3_DECODER 0
-#define ENABLE_ADPCM_SBPRO_4_DECODER 0
-#define ENABLE_ADPCM_SWF_DECODER 0
-#define ENABLE_ADPCM_XA_DECODER 0
-#define ENABLE_ADPCM_YAMAHA_DECODER 0
-#define ENABLE_DVDSUB_DECODER 0
-#define ENABLE_H263_PARSER 1
-#define ENABLE_H264_PARSER 1
-#define ENABLE_MPEG4VIDEO_PARSER 1
-#define ENABLE_AAC_PARSER 0
-#define ENABLE_AC3_PARSER 0
-#define ENABLE_CAVSVIDEO_PARSER 0
-#define ENABLE_DCA_PARSER 0
-#define ENABLE_DVBSUB_PARSER 0
-#define ENABLE_DVDSUB_PARSER 0
-#define ENABLE_H261_PARSER 0
-#define ENABLE_MJPEG_PARSER 0
-#define ENABLE_MPEGAUDIO_PARSER 0
-#define ENABLE_MPEGVIDEO_PARSER 0
-#define ENABLE_PNM_PARSER 0
-#define ENABLE_VC1_PARSER 0
-#define ENABLE_MJPEG_ENCODER 1
-#define ENABLE_MSMPEG4V3_ENCODER 1
-#define ENABLE_H263P_ENCODER 1
-#define ENABLE_AC3_ENCODER 1
-#define ENABLE_FFV1_ENCODER 1
-#define ENABLE_FFVHUFF_ENCODER 1
-#define ENABLE_H263_ENCODER 1
-#define ENABLE_MPEG1VIDEO_ENCODER 1
-#define ENABLE_MPEG2VIDEO_ENCODER 1
-#define ENABLE_MPEG4_ENCODER 1
-#define ENABLE_FLV_ENCODER 1
-#define ENABLE_SNOW_ENCODER 1
-#define ENABLE_MP2_ENCODER 1
-#define ENABLE_DVVIDEO_ENCODER 1
-#define ENABLE_HUFFYUV_ENCODER 1
-#define ENABLE_DVBSUB_ENCODER 1
-#define ENABLE_LIBX264_ENCODER 0
-#define ENABLE_LIBXVID_ENCODER 0
-#define ENABLE_LJPEG_ENCODER 0
-#define ENABLE_PAM_ENCODER 0
-#define ENABLE_PBM_ENCODER 0
-#define ENABLE_PGM_ENCODER 0
-#define ENABLE_PGMYUV_ENCODER 0
-#define ENABLE_PPM_ENCODER 0
-#define ENABLE_LIBFAAC_ENCODER 0
-#define ENABLE_LIBMP3LAME_ENCODER 0
-#define ENABLE_LIBTHEORA_ENCODER 0
-#define ENABLE_SONIC_LS_ENCODER 0
-#define ENABLE_ASV1_ENCODER 0
-#define ENABLE_ASV2_ENCODER 0
-#define ENABLE_BMP_ENCODER 0
-#define ENABLE_FLASHSV_ENCODER 0
-#define ENABLE_GIF_ENCODER 0
-#define ENABLE_H261_ENCODER 0
-#define ENABLE_JPEGLS_ENCODER 0
-#define ENABLE_MSMPEG4V1_ENCODER 0
-#define ENABLE_MSMPEG4V2_ENCODER 0
-#define ENABLE_PNG_ENCODER 0
-#define ENABLE_QTRLE_ENCODER 0
-#define ENABLE_RAWVIDEO_ENCODER 0
-#define ENABLE_ROQ_ENCODER 0
-#define ENABLE_RV10_ENCODER 0
-#define ENABLE_RV20_ENCODER 0
-#define ENABLE_SGI_ENCODER 0
-#define ENABLE_SVQ1_ENCODER 0
-#define ENABLE_TARGA_ENCODER 0
-#define ENABLE_TIFF_ENCODER 0
-#define ENABLE_WMV1_ENCODER 0
-#define ENABLE_WMV2_ENCODER 0
-#define ENABLE_ZLIB_ENCODER 0
-#define ENABLE_ZMBV_ENCODER 0
-#define ENABLE_FLAC_ENCODER 0
-#define ENABLE_LIBAMR_NB_ENCODER 0
-#define ENABLE_LIBAMR_WB_ENCODER 0
-#define ENABLE_LIBGSM_ENCODER 0
-#define ENABLE_LIBGSM_MS_ENCODER 0
-#define ENABLE_SONIC_ENCODER 0
-#define ENABLE_VORBIS_ENCODER 0
-#define ENABLE_WMAV1_ENCODER 0
-#define ENABLE_WMAV2_ENCODER 0
-#define ENABLE_PCM_ALAW_ENCODER 0
-#define ENABLE_PCM_MULAW_ENCODER 0
-#define ENABLE_PCM_S8_ENCODER 0
-#define ENABLE_PCM_S16BE_ENCODER 0
-#define ENABLE_PCM_S16LE_ENCODER 0
-#define ENABLE_PCM_S24BE_ENCODER 0
-#define ENABLE_PCM_S24DAUD_ENCODER 0
-#define ENABLE_PCM_S24LE_ENCODER 0
-#define ENABLE_PCM_S32BE_ENCODER 0
-#define ENABLE_PCM_S32LE_ENCODER 0
-#define ENABLE_PCM_U8_ENCODER 0
-#define ENABLE_PCM_U16BE_ENCODER 0
-#define ENABLE_PCM_U16LE_ENCODER 0
-#define ENABLE_PCM_U24BE_ENCODER 0
-#define ENABLE_PCM_U24LE_ENCODER 0
-#define ENABLE_PCM_U32BE_ENCODER 0
-#define ENABLE_PCM_U32LE_ENCODER 0
-#define ENABLE_ROQ_DPCM_ENCODER 0
-#define ENABLE_ADPCM_4XM_ENCODER 0
-#define ENABLE_ADPCM_ADX_ENCODER 0
-#define ENABLE_ADPCM_CT_ENCODER 0
-#define ENABLE_ADPCM_EA_ENCODER 0
-#define ENABLE_ADPCM_G726_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
-#define ENABLE_ADPCM_IMA_QT_ENCODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
-#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
-#define ENABLE_ADPCM_IMA_WS_ENCODER 0
-#define ENABLE_ADPCM_MS_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
-#define ENABLE_ADPCM_SWF_ENCODER 0
-#define ENABLE_ADPCM_XA_ENCODER 0
-#define ENABLE_ADPCM_YAMAHA_ENCODER 0
-#define ENABLE_DVDSUB_ENCODER 0
-#define ENABLE_LIBVORBIS_ENCODER        0
-#define ENABLE_LIBVORBIS_DECODER        0
-#define ENABLE_MP3_HEADER_COMPRESS_BSF  0
-#define ENABLE_IMX_DUMP_HEADER_BSF      0
-#define ENABLE_DUMP_EXTRADATA_BSF       0
-#define ENABLE_REMOVE_EXTRADATA_BSF     0
-#define ENABLE_NOISE_BSF                0
-#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
-#define ENABLE_MJPEGA_DUMP_HEADER_BSF   0
-#define ENABLE_IMX_DUMP_HEADER_BSF      0
-#define ENABLE_ARMV4L      0
-#define ENABLE_MLIB      0
-#define ENABLE_SPARC      0
-#define ENABLE_ALPHA      0
-#define ENABLE_POWERPC      0
-#define ENABLE_MMI      0
-#define ENABLE_SH4      0
-#define ENABLE_BFIN      0
-#define ENABLE_SMALL      0
+#define ENABLE_CINEPAK_DECODER 1
+#define ENABLE_DNXHD_DECODER 1
+#define ENABLE_FOURXM_DECODER 1
+#define ENABLE_FRAPS_DECODER 1
+#define ENABLE_H263I_DECODER 1
+#define ENABLE_H264_DECODER 1
+#define ENABLE_INDEO2_DECODER 1
+#define ENABLE_INDEO3_DECODER 1
+#define ENABLE_INTERPLAY_VIDEO_DECODER 1
+#define ENABLE_MPEGVIDEO_DECODER 1
+#define ENABLE_MSVIDEO1_DECODER 1
+#define ENABLE_VC1_DECODER 1
+#define ENABLE_VCR1_DECODER 1
+#define ENABLE_VP5_DECODER 1
+#define ENABLE_VP6_DECODER 1
+#define ENABLE_VP6F_DECODER 1
+#define ENABLE_WMV3_DECODER 1
+#define ENABLE_WMV1_DECODER 1
+#define ENABLE_WMV2_DECODER 1
+#define ENABLE_VP3_DECODER 1
+#define ENABLE_MPEG4_DECODER 1
+#define ENABLE_MSMPEG4V1_DECODER 1
+#define ENABLE_MSMPEG4V2_DECODER 1
+#define ENABLE_MSMPEG4V3_DECODER 1
+#define ENABLE_MJPEGB_DECODER 1
+#define ENABLE_MJPEG_DECODER 1
+#define ENABLE_WMAV2_DECODER 1
+#define ENABLE_DVVIDEO_DECODER 1
+#define ENABLE_HUFFYUV_DECODER 1
+#define ENABLE_FFVHUFF_DECODER 1
+#define ENABLE_SVQ3_DECODER 1
+#define ENABLE_TSCC_DECODER 1
+#define ENABLE_QDM2_DECODER 1
+#define ENABLE_FFV1_DECODER 1
+#define ENABLE_MPEG1VIDEO_DECODER 1
+#define ENABLE_MPEG2VIDEO_DECODER 1
+#define ENABLE_RV10_DECODER 1
+#define ENABLE_RV20_DECODER 1
+#define ENABLE_DVBSUB_DECODER 1
+#define ENABLE_FLV_DECODER 1
+#define ENABLE_SNOW_DECODER 1
+#define ENABLE_AASC_DECODER 0
+#define ENABLE_AVS_DECODER 0
+#define ENABLE_BETHSOFTVID_DECODER 0
+#define ENABLE_C93_DECODER 0
+#define ENABLE_CAVS_DECODER 0
+#define ENABLE_CLJR_DECODER 0
+#define ENABLE_CSCD_DECODER 0
+#define ENABLE_CYUV_DECODER 0
+#define ENABLE_DSICINVIDEO_DECODER 0
+#define ENABLE_DXA_DECODER 0
+#define ENABLE_EIGHTBPS_DECODER 0
+#define ENABLE_FLIC_DECODER 0
+#define ENABLE_IDCIN_DECODER 0
+#define ENABLE_KMVC_DECODER 0
+#define ENABLE_LOCO_DECODER 0
+#define ENABLE_MDEC_DECODER 0
+#define ENABLE_MMVIDEO_DECODER 0
+#define ENABLE_MPEG_XVMC_DECODER 0
+#define ENABLE_MSRLE_DECODER 0
+#define ENABLE_MSZH_DECODER 0
+#define ENABLE_NUV_DECODER 0
+#define ENABLE_PTX_DECODER 0
+#define ENABLE_QDRAW_DECODER 0
+#define ENABLE_QPEG_DECODER 0
+#define ENABLE_RPZA_DECODER 0
+#define ENABLE_SMACKER_DECODER 0
+#define ENABLE_SMC_DECODER 0
+#define ENABLE_SP5X_DECODER 0
+#define ENABLE_THEORA_DECODER 0
+#define ENABLE_THP_DECODER 0
+#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
+#define ENABLE_TRUEMOTION1_DECODER 0
+#define ENABLE_TRUEMOTION2_DECODER 0
+#define ENABLE_TXD_DECODER 0
+#define ENABLE_ULTI_DECODER 0
+#define ENABLE_VMDVIDEO_DECODER 0
+#define ENABLE_VMNC_DECODER 0
+#define ENABLE_VQA_DECODER 0
+#define ENABLE_WNV1_DECODER 0
+#define ENABLE_XAN_WC3_DECODER 0
+#define ENABLE_XL_DECODER 0
+#define ENABLE_MPEG4AAC_DECODER 0
+#define ENABLE_ALAC_DECODER 0
+#define ENABLE_ATRAC3_DECODER 0
+#define ENABLE_COOK_DECODER 0
+#define ENABLE_DCA_DECODER 0
+#define ENABLE_DSICINAUDIO_DECODER 0
+#define ENABLE_IMC_DECODER 0
+#define ENABLE_LIBA52_DECODER 0
+#define ENABLE_LIBFAAD_DECODER 0
+#define ENABLE_MACE3_DECODER 0
+#define ENABLE_MACE6_DECODER 0
+#define ENABLE_MP3_DECODER 0
+#define ENABLE_MP3ADU_DECODER 0
+#define ENABLE_MP3ON4_DECODER 0
+#define ENABLE_MPC7_DECODER 0
+#define ENABLE_RA_144_DECODER 0
+#define ENABLE_RA_288_DECODER 0
+#define ENABLE_SHORTEN_DECODER 0
+#define ENABLE_SMACKAUD_DECODER 0
+#define ENABLE_TRUESPEECH_DECODER 0
+#define ENABLE_TTA_DECODER 0
+#define ENABLE_VMDAUDIO_DECODER 0
+#define ENABLE_WAVPACK_DECODER 0
+#define ENABLE_WS_SND1_DECODER 0
+#define ENABLE_INTERPLAY_DPCM_DECODER 0
+#define ENABLE_SOL_DPCM_DECODER 0
+#define ENABLE_XAN_DPCM_DECODER 0
+#define ENABLE_ADPCM_THP_DECODER 0
+#define ENABLE_ASV1_DECODER 0
+#define ENABLE_ASV2_DECODER 0
+#define ENABLE_BMP_DECODER 0
+#define ENABLE_FLASHSV_DECODER 0
+#define ENABLE_GIF_DECODER 0
+#define ENABLE_H261_DECODER 0
+#define ENABLE_H263_DECODER 0
+#define ENABLE_JPEGLS_DECODER 0
+#define ENABLE_PNG_DECODER 0
+#define ENABLE_QTRLE_DECODER 0
+#define ENABLE_RAWVIDEO_DECODER 0
+#define ENABLE_ROQ_DECODER 0
+#define ENABLE_SGI_DECODER 0
+#define ENABLE_SVQ1_DECODER 0
+#define ENABLE_TARGA_DECODER 0
+#define ENABLE_TIFF_DECODER 0
+#define ENABLE_ZLIB_DECODER 0
+#define ENABLE_ZMBV_DECODER 0
+#define ENABLE_FLAC_DECODER 0
+#define ENABLE_LIBAMR_NB_DECODER 0
+#define ENABLE_LIBAMR_WB_DECODER 0
+#define ENABLE_LIBGSM_DECODER 0
+#define ENABLE_LIBGSM_MS_DECODER 0
+#define ENABLE_MP2_DECODER 0
+#define ENABLE_SONIC_DECODER 0
+#define ENABLE_VORBIS_DECODER 0
+#define ENABLE_WMAV1_DECODER 0
+#define ENABLE_PCM_ALAW_DECODER 0
+#define ENABLE_PCM_MULAW_DECODER 0
+#define ENABLE_PCM_S8_DECODER 0
+#define ENABLE_PCM_S16BE_DECODER 0
+#define ENABLE_PCM_S16LE_DECODER 0
+#define ENABLE_PCM_S24BE_DECODER 0
+#define ENABLE_PCM_S24DAUD_DECODER 0
+#define ENABLE_PCM_S24LE_DECODER 0
+#define ENABLE_PCM_S32BE_DECODER 0
+#define ENABLE_PCM_S32LE_DECODER 0
+#define ENABLE_PCM_U8_DECODER 0
+#define ENABLE_PCM_U16BE_DECODER 0
+#define ENABLE_PCM_U16LE_DECODER 0
+#define ENABLE_PCM_U24BE_DECODER 0
+#define ENABLE_PCM_U24LE_DECODER 0
+#define ENABLE_PCM_U32BE_DECODER 0
+#define ENABLE_PCM_U32LE_DECODER 0
+#define ENABLE_ROQ_DPCM_DECODER 0
+#define ENABLE_ADPCM_4XM_DECODER 0
+#define ENABLE_ADPCM_ADX_DECODER 0
+#define ENABLE_ADPCM_CT_DECODER 0
+#define ENABLE_ADPCM_EA_DECODER 0
+#define ENABLE_ADPCM_G726_DECODER 0
+#define ENABLE_ADPCM_IMA_DK3_DECODER 0
+#define ENABLE_ADPCM_IMA_DK4_DECODER 0
+#define ENABLE_ADPCM_IMA_QT_DECODER 0
+#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
+#define ENABLE_ADPCM_IMA_WAV_DECODER 0
+#define ENABLE_ADPCM_IMA_WS_DECODER 0
+#define ENABLE_ADPCM_MS_DECODER 0
+#define ENABLE_ADPCM_SBPRO_2_DECODER 0
+#define ENABLE_ADPCM_SBPRO_3_DECODER 0
+#define ENABLE_ADPCM_SBPRO_4_DECODER 0
+#define ENABLE_ADPCM_SWF_DECODER 0
+#define ENABLE_ADPCM_XA_DECODER 0
+#define ENABLE_ADPCM_YAMAHA_DECODER 0
+#define ENABLE_DVDSUB_DECODER 0
+#define ENABLE_H263_PARSER 1
+#define ENABLE_H264_PARSER 1
+#define ENABLE_MPEG4VIDEO_PARSER 1
+#define ENABLE_AAC_PARSER 0
+#define ENABLE_AC3_PARSER 0
+#define ENABLE_CAVSVIDEO_PARSER 0
+#define ENABLE_DCA_PARSER 0
+#define ENABLE_DVBSUB_PARSER 0
+#define ENABLE_DVDSUB_PARSER 0
+#define ENABLE_H261_PARSER 0
+#define ENABLE_MJPEG_PARSER 0
+#define ENABLE_MPEGAUDIO_PARSER 0
+#define ENABLE_MPEGVIDEO_PARSER 0
+#define ENABLE_PNM_PARSER 0
+#define ENABLE_VC1_PARSER 0
+#define ENABLE_MJPEG_ENCODER 1
+#define ENABLE_MSMPEG4V3_ENCODER 1
+#define ENABLE_H263P_ENCODER 1
+#define ENABLE_AC3_ENCODER 1
+#define ENABLE_FFV1_ENCODER 1
+#define ENABLE_FFVHUFF_ENCODER 1
+#define ENABLE_H263_ENCODER 1
+#define ENABLE_MPEG1VIDEO_ENCODER 1
+#define ENABLE_MPEG2VIDEO_ENCODER 1
+#define ENABLE_MPEG4_ENCODER 1
+#define ENABLE_FLV_ENCODER 1
+#define ENABLE_SNOW_ENCODER 1
+#define ENABLE_MP2_ENCODER 1
+#define ENABLE_DVVIDEO_ENCODER 1
+#define ENABLE_HUFFYUV_ENCODER 1
+#define ENABLE_DVBSUB_ENCODER 1
+#define ENABLE_LIBX264_ENCODER 0
+#define ENABLE_LIBXVID_ENCODER 0
+#define ENABLE_LJPEG_ENCODER 0
+#define ENABLE_PAM_ENCODER 0
+#define ENABLE_PBM_ENCODER 0
+#define ENABLE_PGM_ENCODER 0
+#define ENABLE_PGMYUV_ENCODER 0
+#define ENABLE_PPM_ENCODER 0
+#define ENABLE_LIBFAAC_ENCODER 0
+#define ENABLE_LIBMP3LAME_ENCODER 0
+#define ENABLE_LIBTHEORA_ENCODER 0
+#define ENABLE_SONIC_LS_ENCODER 0
+#define ENABLE_ASV1_ENCODER 0
+#define ENABLE_ASV2_ENCODER 0
+#define ENABLE_BMP_ENCODER 0
+#define ENABLE_FLASHSV_ENCODER 0
+#define ENABLE_GIF_ENCODER 0
+#define ENABLE_H261_ENCODER 0
+#define ENABLE_JPEGLS_ENCODER 0
+#define ENABLE_MSMPEG4V1_ENCODER 0
+#define ENABLE_MSMPEG4V2_ENCODER 0
+#define ENABLE_PNG_ENCODER 0
+#define ENABLE_QTRLE_ENCODER 0
+#define ENABLE_RAWVIDEO_ENCODER 0
+#define ENABLE_ROQ_ENCODER 0
+#define ENABLE_RV10_ENCODER 0
+#define ENABLE_RV20_ENCODER 0
+#define ENABLE_SGI_ENCODER 0
+#define ENABLE_SVQ1_ENCODER 0
+#define ENABLE_TARGA_ENCODER 0
+#define ENABLE_TIFF_ENCODER 0
+#define ENABLE_WMV1_ENCODER 0
+#define ENABLE_WMV2_ENCODER 0
+#define ENABLE_ZLIB_ENCODER 0
+#define ENABLE_ZMBV_ENCODER 0
+#define ENABLE_FLAC_ENCODER 0
+#define ENABLE_LIBAMR_NB_ENCODER 0
+#define ENABLE_LIBAMR_WB_ENCODER 0
+#define ENABLE_LIBGSM_ENCODER 0
+#define ENABLE_LIBGSM_MS_ENCODER 0
+#define ENABLE_SONIC_ENCODER 0
+#define ENABLE_VORBIS_ENCODER 0
+#define ENABLE_WMAV1_ENCODER 0
+#define ENABLE_WMAV2_ENCODER 0
+#define ENABLE_PCM_ALAW_ENCODER 0
+#define ENABLE_PCM_MULAW_ENCODER 0
+#define ENABLE_PCM_S8_ENCODER 0
+#define ENABLE_PCM_S16BE_ENCODER 0
+#define ENABLE_PCM_S16LE_ENCODER 0
+#define ENABLE_PCM_S24BE_ENCODER 0
+#define ENABLE_PCM_S24DAUD_ENCODER 0
+#define ENABLE_PCM_S24LE_ENCODER 0
+#define ENABLE_PCM_S32BE_ENCODER 0
+#define ENABLE_PCM_S32LE_ENCODER 0
+#define ENABLE_PCM_U8_ENCODER 0
+#define ENABLE_PCM_U16BE_ENCODER 0
+#define ENABLE_PCM_U16LE_ENCODER 0
+#define ENABLE_PCM_U24BE_ENCODER 0
+#define ENABLE_PCM_U24LE_ENCODER 0
+#define ENABLE_PCM_U32BE_ENCODER 0
+#define ENABLE_PCM_U32LE_ENCODER 0
+#define ENABLE_ROQ_DPCM_ENCODER 0
+#define ENABLE_ADPCM_4XM_ENCODER 0
+#define ENABLE_ADPCM_ADX_ENCODER 0
+#define ENABLE_ADPCM_CT_ENCODER 0
+#define ENABLE_ADPCM_EA_ENCODER 0
+#define ENABLE_ADPCM_G726_ENCODER 0
+#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
+#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
+#define ENABLE_ADPCM_IMA_QT_ENCODER 0
+#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
+#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
+#define ENABLE_ADPCM_IMA_WS_ENCODER 0
+#define ENABLE_ADPCM_MS_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
+#define ENABLE_ADPCM_SWF_ENCODER 0
+#define ENABLE_ADPCM_XA_ENCODER 0
+#define ENABLE_ADPCM_YAMAHA_ENCODER 0
+#define ENABLE_DVDSUB_ENCODER 0
+#define ENABLE_LIBVORBIS_ENCODER        0
+#define ENABLE_LIBVORBIS_DECODER        0
+#define ENABLE_MP3_HEADER_COMPRESS_BSF  0
+#define ENABLE_IMX_DUMP_HEADER_BSF      0
+#define ENABLE_DUMP_EXTRADATA_BSF       0
+#define ENABLE_REMOVE_EXTRADATA_BSF     0
+#define ENABLE_NOISE_BSF                0
+#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
+#define ENABLE_MJPEGA_DUMP_HEADER_BSF   0
+#define ENABLE_IMX_DUMP_HEADER_BSF      0
+#define ENABLE_ARMV4L      0
+#define ENABLE_MLIB      0
+#define ENABLE_SPARC      0
+#define ENABLE_ALPHA      0
+#define ENABLE_POWERPC      0
+#define ENABLE_MMI      0
+#define ENABLE_SH4      0
+#define ENABLE_BFIN      0
+#define ENABLE_SMALL      0



From gruntster at mail.berlios.de  Thu Aug 16 20:34:08 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 16 Aug 2007 20:34:08 +0200
Subject: [Avidemux-svn-commit] r3520 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_osSupport
Message-ID: <200708161834.l7GIY8U0000831@sheep.berlios.de>

Author: gruntster
Date: 2007-08-16 20:34:00 +0200 (Thu, 16 Aug 2007)
New Revision: 3520

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
Log:
[lav] OS friendly CPU detection

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 17:27:27 UTC (rev 3519)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 18:34:00 UTC (rev 3520)
@@ -22,7 +22,6 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <pthread.h>
 
 #include "ADM_assert.h"
 #include "prefs.h"
@@ -37,7 +36,9 @@
 #define MODULE_NAME  MODULE_CODEC
 #include "ADM_osSupport/ADM_debug.h"
 #include "ADM_video/ADM_videoInfoExtractor.h"
-//****************************
+
+extern int ADM_cpu_num_processors(void);
+
 #define WRAP_Open(x) \
 {\
 AVCodec *codec=avcodec_find_decoder(x);\
@@ -113,7 +114,7 @@
   prefs->get(FEATURE_THREADING_LAVC, &threads);
 
   if (threads == 0)
-	  threads = pthread_num_processors_np();
+	  threads = ADM_cpu_num_processors();
 
   if (threads == 1)
 	  threads = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 17:27:27 UTC (rev 3519)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 18:34:00 UTC (rev 3520)
@@ -24,13 +24,11 @@
 #ifdef USE_FFMPEG
 
 #define __STDC_CONSTANT_MACROS // Lavcodec crap
-#define WIN32_CLASH
 
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <math.h>
-#include <pthread.h>
 
 #include "ADM_lavcodec.h"
 #include "avi_vars.h"
@@ -41,6 +39,7 @@
 
 //#define TEST_NOB 1
 
+extern int ADM_cpu_num_processors(void);
 static char LogName[500];
 
 #define WRAP_Open(x) \
@@ -371,7 +370,7 @@
   prefs->get(FEATURE_THREADING_LAVC, &threads);
 
   if (threads == 0)
-	  threads = pthread_num_processors_np();
+	  threads = ADM_cpu_num_processors();
 
   if (threads == 1)
 	  threads = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 17:27:27 UTC (rev 3519)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 18:34:00 UTC (rev 3520)
@@ -11,6 +11,14 @@
 //
 #include "config.h"
 #include <stdio.h>
+
+#if defined(ADM_WIN32)
+#include <pthread.h>
+#elif !defined(__APPLE__)
+#include <string.h>
+#include <sched.h>
+#endif
+
 #include "default.h"
 #include "admmangle.h"
 #include "ADM_osSupport/ADM_cpuCap.h"
@@ -169,3 +177,24 @@
 }
 // EOF
 
+// Stolen from x264
+int ADM_cpu_num_processors(void)
+{
+#if defined(ADM_WIN32)
+    return pthread_num_processors_np();
+#elif !defined(__APPLE__)
+    unsigned int bit;
+    int np;
+
+    cpu_set_t p_aff;
+    memset( &p_aff, 0, sizeof(p_aff) );
+    sched_getaffinity( 0, sizeof(p_aff), &p_aff );
+
+    for( np = 0, bit = 0; bit < sizeof(p_aff); bit++ )
+        np += (((uint8_t *)&p_aff)[bit / 8] >> (bit % 8)) & 1;
+
+    return np;
+#else
+    return 1;
+#endif
+}



From gruntster at mail.berlios.de  Thu Aug 16 21:05:08 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 16 Aug 2007 21:05:08 +0200
Subject: [Avidemux-svn-commit] r3521 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200708161905.l7GJ58el003712@sheep.berlios.de>

Author: gruntster
Date: 2007-08-16 21:04:58 +0200 (Thu, 16 Aug 2007)
New Revision: 3521

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
[Prefs] restore xfilter tab + link xfilter options + save xfilter option + change Glyph option to checkbox

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 18:34:00 UTC (rev 3520)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 19:04:58 UTC (rev 3521)
@@ -191,8 +191,7 @@
         diaElemToggle openDml(&use_odml,_("Create _OpenDML files"));
         diaElemToggle autoIndex(&useAutoIndex,_("Automatically _index MPEG files"));
         diaElemToggle autoSwap(&useSwap,_("Automatically _swap A and B if A>B"));
-        diaElemToggle nuvAudio(&useNuv,_("_Disable NUV audio sync"));
-        diaElemToggle loadEx(&activeXfilter,_("_Load external filters"));
+        diaElemToggle nuvAudio(&useNuv,_("_Disable NUV audio sync"));        
         
         diaElemToggle togAutoVbr(&autovbr,_("Automatically _build VBR map"));
         diaElemToggle togAutoIndex(&autoindex,_("Automatically _rebuild index"));
@@ -351,31 +350,30 @@
                filterPath = ADM_strdup("c:\\");
 #endif
         diaElemDirSelect  entryFilterPath(&filterPath,_("_Filter directory:"),"");
-        /*********************************/
-        diaMenuEntry globalGlyhEntries[]={
-                             {0,       _("No"),NULL}
-                             ,{1,      _("Yes"),NULL}};
-        diaElemMenu  menuGlobaGlyh(&useGlobalGlyph,_("Use _Global GlyphSet:"), sizeof(globalGlyhEntries)/sizeof(diaMenuEntry),globalGlyhEntries,"");
-        diaElemFile  entryGLyphPath(0,&globalGlyphName,_("Gl_yphSet:"),"");
-        menuGlobaGlyh.link(&(globalGlyhEntries[1]),1,&entryGLyphPath);
-        /**********************************************************************/
-        /* First Tab : user interface */
+		diaElemToggle loadEx(&activeXfilter,_("_Load external filters"));
+		loadEx.link(1, &entryFilterPath);
+
+		diaElemToggle togGlobalGlyph(&useGlobalGlyph, _("Use _Global GlyphSet"));
+		diaElemFile  entryGLyphPath(0,&globalGlyphName,_("Gl_yphSet:"),"");
+		togGlobalGlyph.link(1, &entryGLyphPath);
+
+        /* User Interface */
         diaElem *diaUser[]={&useSysTray,&menuMessage};
         diaElemTabs tabUser(_("User Interface"),2,diaUser);
         
-         /* First Tab bis: user interface : Auto*/
+         /* Automation */
         diaElem *diaAuto[]={&autoSwap,&togAutoVbr,&togAutoIndex,&togAutoUnpack,&autoIndex,};
         diaElemTabs tabAuto(_("Automation"),5,diaAuto);
         
-        /* Second Tab : input */
+        /* Input */
         diaElem *diaInput[]={&nuvAudio,&useLavcodec};
         diaElemTabs tabInput(_("Input"),2,(diaElem **)diaInput);
         
-        /* Third Tab : output */
+        /* Output */
         diaElem *diaOutput[]={&autoSplit,&openDml,&allowAnyMpeg,&togTagMp3};
         diaElemTabs tabOutput(_("Output"),4,(diaElem **)diaOutput);
         
-        /* Fourth Tab : audio */
+        /* Audio */
 #if defined(ALSA_SUPPORT)
         diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio,&entryAlsaDevice};
         diaElemTabs tabAudio(_("Audio"),4,(diaElem **)diaAudio);
@@ -387,7 +385,7 @@
         diaElemTabs tabAudio(_("Audio"),2,(diaElem **)diaAudio);
 #endif
         
-        /* Fifth Tab : video */
+        /* Video */
         diaElem *diaVideo[]={&menuVideoMode,&framePP};
         diaElemTabs tabVideo(_("Video"),2,(diaElem **)diaVideo);
         
@@ -400,8 +398,8 @@
 		diaElemTabs tabThreading(_("Threading"),2,(diaElem **)diaThreading);
 
         /* Global Glyph tab */
-        diaElem *diaGlyph[]={&menuGlobaGlyh,&entryGLyphPath};
-        diaElemTabs tabGlyph(_("Global Glyphset"),2,(diaElem **)diaGlyph);
+        diaElem *diaGlyph[]={&togGlobalGlyph,&entryGLyphPath};
+        diaElemTabs tabGlyph(_("Global GlyphSet"),2,(diaElem **)diaGlyph);
 
         /* Xfilter tab */
         diaElem *diaXFilter[]={&loadEx,&entryFilterPath};
@@ -409,7 +407,7 @@
                                     
 // SET
         diaElemTabs *tabs[]={&tabUser,&tabAuto,&tabInput,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabThreading,&tabGlyph,&tabXfilter};
-        if( diaFactoryRunTabs(_("Preferences"),9,tabs))
+        if( diaFactoryRunTabs(_("Preferences"),10,tabs))
 	{
         	
         	// cpu caps
@@ -504,6 +502,8 @@
                 // Use tray while encoding
                 prefs->set(FEATURE_USE_SYSTRAY,useTray);
                 // Filter directory
+				prefs->set(FILTERS_AUTOLOAD_ACTIVE, activeXfilter);
+
                 if(filterPath)
                   prefs->set(FILTERS_AUTOLOAD_PATH, filterPath);
                 // Alternate mp3 tag (haali)



From gruntster at mail.berlios.de  Thu Aug 16 23:22:42 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 16 Aug 2007 23:22:42 +0200
Subject: [Avidemux-svn-commit] r3522 -
	branches/avidemux_2.4_branch/avidemux/ADM_osSupport
Message-ID: <200708162122.l7GLMgTm012869@sheep.berlios.de>

Author: gruntster
Date: 2007-08-16 23:22:36 +0200 (Thu, 16 Aug 2007)
New Revision: 3522

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
Log:
[Win32] flush stdout before and during backtrace

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-08-16 19:04:58 UTC (rev 3521)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-08-16 21:22:36 UTC (rev 3522)
@@ -1,7 +1,7 @@
 /***************************************************************************
   Try to display interesting crash dump
 
-    copyright            : (C) 2007 by mean, (C) 2007 Grunster
+    copyright            : (C) 2007 by mean, (C) 2007 Gruntster
     email                : fixounet at free.fr
  ***************************************************************************/
 
@@ -87,6 +87,8 @@
 			printf("<unknown>");
 
 		printf("+0x%X) [0x%08X]\n", (uint32_t)frameAddr - (uint32_t)moduleAddr, frameAddr);
+
+		fflush(stdout);
 	}
 }
 	
@@ -195,6 +197,8 @@
 
 void ADM_backTrack(int lineno, const char *file)
 {	
+	fflush(stderr);
+	fflush(stdout);
 	saveCrashProject();
 
 	GUI_Error_HIG(_("Fatal Error"),_("A fatal error has occurred.\n\nClick OK to generate debug information. This may take a few minutes to complete."));
@@ -212,6 +216,8 @@
 
 EXCEPTION_DISPOSITION exceptionHandler(struct _EXCEPTION_RECORD* pExceptionRec, void* pEstablisherFrame, struct _CONTEXT* pContextRecord, void* pDispatcherContext)
 {
+	fflush(stderr);
+	fflush(stdout);
 	static int running=0;
 
 	if(running)
@@ -228,6 +234,7 @@
 	SymInitialize(currentProcessId, NULL, TRUE);
 
 	dumpExceptionInfo(currentProcessId, pExceptionRec, pContextRecord);
+	fflush(stdout);
 	dumpBackTrace(currentProcessId);
 
 	SymCleanup(currentProcessId);



From gruntster at mail.berlios.de  Fri Aug 17 02:05:25 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 17 Aug 2007 02:05:25 +0200
Subject: [Avidemux-svn-commit] r3523 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200708170005.l7H05Pd6005448@sheep.berlios.de>

Author: gruntster
Date: 2007-08-17 02:05:15 +0200 (Fri, 17 Aug 2007)
New Revision: 3523

Modified:
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[OCR] fix crash when closing TS OCR window

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-16 21:22:36 UTC (rev 3522)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-17 00:05:15 UTC (rev 3523)
@@ -227,7 +227,7 @@
         case ACT_ViewSide: UI_toogleSide();return;
         case ACT_DVB_Ocr:
         		DIA_ocrDvb();
-        		break;
+        		return;
       case ACT_Ocr:
                 DIA_ocrGen(); //
                 return;



From gruntster at mail.berlios.de  Fri Aug 17 05:04:03 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 17 Aug 2007 05:04:03 +0200
Subject: [Avidemux-svn-commit] r3524 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200708170304.l7H3435f016800@sheep.berlios.de>

Author: gruntster
Date: 2007-08-17 05:03:55 +0200 (Fri, 17 Aug 2007)
New Revision: 3524

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
Log:
[GTK] allow manual entry of audio time shift

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-17 00:05:15 UTC (rev 3523)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-17 03:03:55 UTC (rev 3524)
@@ -200,8 +200,7 @@
 	{"boxCurFrame"			,"activate"		,ACT_JumpToFrame},
 	//{"boxCurTime"			,"editing_done"		,ACT_TimeChanged},
 
-        {"CheckButtonTimeshift"         ,"toggled"             ,ACT_TimeShift},
-        {"spinbuttonTimeShift"          ,"value_changed"       ,ACT_TimeShift}
+        {"CheckButtonTimeshift"         ,"toggled"             ,ACT_TimeShift}
        // {"spinbuttonTimeShift"          ,"editing_done"       ,ACT_TimeShift}
   
 };
@@ -343,7 +342,11 @@
         gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"jogg")), "value_changed",   
                       GTK_SIGNAL_FUNC(jogChange),                   (void *) NULL);  
 
+		// Time Shift
+		gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"spinbuttonTimeShift")), "value_changed",   
+                      GTK_SIGNAL_FUNC(guiCallback), (void *) ACT_TimeShift);  
 
+
 		       
 // Callbacks for buttons
 		uint32_t nb=sizeof(buttonCallback)/sizeof(buttonCallBack_S); 



From gruntster at mail.berlios.de  Fri Aug 17 05:23:07 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 17 Aug 2007 05:23:07 +0200
Subject: [Avidemux-svn-commit] r3525 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708170323.l7H3N7Te018073@sheep.berlios.de>

Author: gruntster
Date: 2007-08-17 05:22:59 +0200 (Fri, 17 Aug 2007)
New Revision: 3525

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
Log:
[QT] increase range of audio time shift

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-17 03:03:55 UTC (rev 3524)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-17 03:22:59 UTC (rev 3525)
@@ -36,18 +36,28 @@
   </property>
   <widget class="QWidget" name="centralwidget" >
    <layout class="QGridLayout" >
-    <property name="margin" >
+    <property name="leftMargin" >
      <number>9</number>
     </property>
-    <property name="spacing" >
+    <property name="topMargin" >
+     <number>9</number>
+    </property>
+    <property name="rightMargin" >
+     <number>9</number>
+    </property>
+    <property name="bottomMargin" >
+     <number>9</number>
+    </property>
+    <property name="horizontalSpacing" >
      <number>6</number>
     </property>
+    <property name="verticalSpacing" >
+     <number>6</number>
+    </property>
     <item row="1" column="1" >
      <widget class="QFrame" name="frame_video" >
       <property name="sizePolicy" >
-       <sizepolicy>
-        <hsizetype>7</hsizetype>
-        <vsizetype>7</vsizetype>
+       <sizepolicy vsizetype="Expanding" hsizetype="Expanding" >
         <horstretch>99</horstretch>
         <verstretch>99</verstretch>
        </sizepolicy>
@@ -62,26 +72,42 @@
     </item>
     <item rowspan="2" row="0" column="0" >
      <layout class="QVBoxLayout" >
-      <property name="margin" >
-       <number>0</number>
-      </property>
       <property name="spacing" >
        <number>6</number>
       </property>
+      <property name="leftMargin" >
+       <number>0</number>
+      </property>
+      <property name="topMargin" >
+       <number>0</number>
+      </property>
+      <property name="rightMargin" >
+       <number>0</number>
+      </property>
+      <property name="bottomMargin" >
+       <number>0</number>
+      </property>
       <item>
        <layout class="QVBoxLayout" >
-        <property name="margin" >
+        <property name="spacing" >
          <number>0</number>
         </property>
-        <property name="spacing" >
+        <property name="leftMargin" >
          <number>0</number>
         </property>
+        <property name="topMargin" >
+         <number>0</number>
+        </property>
+        <property name="rightMargin" >
+         <number>0</number>
+        </property>
+        <property name="bottomMargin" >
+         <number>0</number>
+        </property>
         <item>
          <widget class="QLabel" name="label_3" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>5</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Preferred" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -102,12 +128,21 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="margin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="spacing" >
+          <property name="leftMargin" >
            <number>0</number>
           </property>
+          <property name="topMargin" >
+           <number>0</number>
+          </property>
+          <property name="rightMargin" >
+           <number>0</number>
+          </property>
+          <property name="bottomMargin" >
+           <number>0</number>
+          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -126,18 +161,25 @@
           </item>
           <item>
            <layout class="QVBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
             <property name="spacing" >
              <number>6</number>
             </property>
+            <property name="leftMargin" >
+             <number>0</number>
+            </property>
+            <property name="topMargin" >
+             <number>0</number>
+            </property>
+            <property name="rightMargin" >
+             <number>0</number>
+            </property>
+            <property name="bottomMargin" >
+             <number>0</number>
+            </property>
             <item>
              <widget class="QComboBox" name="comboBoxVideo" >
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -155,9 +197,7 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -176,9 +216,7 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -211,9 +249,7 @@
         <item>
          <widget class="QLabel" name="label_5" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>4</hsizetype>
-            <vsizetype>1</vsizetype>
+           <sizepolicy vsizetype="Minimum" hsizetype="Maximum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -234,12 +270,21 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="margin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="spacing" >
+          <property name="leftMargin" >
            <number>0</number>
           </property>
+          <property name="topMargin" >
+           <number>0</number>
+          </property>
+          <property name="rightMargin" >
+           <number>0</number>
+          </property>
+          <property name="bottomMargin" >
+           <number>0</number>
+          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -258,18 +303,25 @@
           </item>
           <item>
            <layout class="QVBoxLayout" >
-            <property name="margin" >
-             <number>0</number>
-            </property>
             <property name="spacing" >
              <number>6</number>
             </property>
+            <property name="leftMargin" >
+             <number>0</number>
+            </property>
+            <property name="topMargin" >
+             <number>0</number>
+            </property>
+            <property name="rightMargin" >
+             <number>0</number>
+            </property>
+            <property name="bottomMargin" >
+             <number>0</number>
+            </property>
             <item>
              <widget class="QComboBox" name="comboBoxAudio" >
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -287,9 +339,7 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -305,9 +355,7 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
+               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -319,12 +367,21 @@
             </item>
             <item>
              <layout class="QHBoxLayout" >
-              <property name="margin" >
-               <number>0</number>
-              </property>
               <property name="spacing" >
                <number>6</number>
               </property>
+              <property name="leftMargin" >
+               <number>0</number>
+              </property>
+              <property name="topMargin" >
+               <number>0</number>
+              </property>
+              <property name="rightMargin" >
+               <number>0</number>
+              </property>
+              <property name="bottomMargin" >
+               <number>0</number>
+              </property>
               <item>
                <widget class="QCheckBox" name="checkBox_TimeShift" >
                 <property name="text" >
@@ -335,13 +392,17 @@
               <item>
                <widget class="QSpinBox" name="spinBox_TimeValue" >
                 <property name="sizePolicy" >
-                 <sizepolicy>
-                  <hsizetype>1</hsizetype>
-                  <vsizetype>0</vsizetype>
+                 <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
                   <horstretch>0</horstretch>
                   <verstretch>0</verstretch>
                  </sizepolicy>
                 </property>
+                <property name="minimum" >
+                 <number>-99999</number>
+                </property>
+                <property name="maximum" >
+                 <number>99999</number>
+                </property>
                </widget>
               </item>
              </layout>
@@ -369,9 +430,7 @@
         <item>
          <widget class="QLabel" name="label_4" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -386,12 +445,21 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="margin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="spacing" >
+          <property name="leftMargin" >
            <number>0</number>
           </property>
+          <property name="topMargin" >
+           <number>0</number>
+          </property>
+          <property name="rightMargin" >
+           <number>0</number>
+          </property>
+          <property name="bottomMargin" >
+           <number>0</number>
+          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -411,9 +479,7 @@
           <item>
            <widget class="QComboBox" name="comboBoxFormat" >
             <property name="sizePolicy" >
-             <sizepolicy>
-              <hsizetype>1</hsizetype>
-              <vsizetype>0</vsizetype>
+             <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
               <horstretch>0</horstretch>
               <verstretch>0</verstretch>
              </sizepolicy>
@@ -467,26 +533,42 @@
     </item>
     <item row="0" column="1" >
      <layout class="QVBoxLayout" >
-      <property name="margin" >
-       <number>0</number>
-      </property>
       <property name="spacing" >
        <number>6</number>
       </property>
+      <property name="leftMargin" >
+       <number>0</number>
+      </property>
+      <property name="topMargin" >
+       <number>0</number>
+      </property>
+      <property name="rightMargin" >
+       <number>0</number>
+      </property>
+      <property name="bottomMargin" >
+       <number>0</number>
+      </property>
       <item>
        <layout class="QHBoxLayout" >
-        <property name="margin" >
-         <number>0</number>
-        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
+        <property name="leftMargin" >
+         <number>0</number>
+        </property>
+        <property name="topMargin" >
+         <number>0</number>
+        </property>
+        <property name="rightMargin" >
+         <number>0</number>
+        </property>
+        <property name="bottomMargin" >
+         <number>0</number>
+        </property>
         <item>
          <widget class="QLabel" name="label" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -499,9 +581,7 @@
         <item>
          <widget class="QLineEdit" name="lineEdit" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>0</vsizetype>
+           <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -529,9 +609,7 @@
         <item>
          <widget class="QLabel" name="label_2" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -544,9 +622,7 @@
         <item>
          <widget class="QLabel" name="label_6" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -559,9 +635,7 @@
         <item>
          <widget class="QLineEdit" name="lineEdit_2" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>0</vsizetype>
+           <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -577,9 +651,7 @@
         <item>
          <widget class="QLabel" name="label_7" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -592,9 +664,7 @@
         <item>
          <widget class="QLabel" name="label_8" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -621,12 +691,21 @@
       </item>
       <item>
        <layout class="QHBoxLayout" >
-        <property name="margin" >
-         <number>0</number>
-        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
+        <property name="leftMargin" >
+         <number>0</number>
+        </property>
+        <property name="topMargin" >
+         <number>0</number>
+        </property>
+        <property name="rightMargin" >
+         <number>0</number>
+        </property>
+        <property name="bottomMargin" >
+         <number>0</number>
+        </property>
         <item>
          <widget class="QLabel" name="label_12" >
           <property name="text" >
@@ -637,9 +716,7 @@
         <item>
          <widget class="QLabel" name="label_9" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -659,9 +736,7 @@
         <item>
          <widget class="QLabel" name="label_10" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -687,9 +762,7 @@
         <item>
          <widget class="QSlider" name="horizontalSlider_2" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>4</hsizetype>
-            <vsizetype>0</vsizetype>
+           <sizepolicy vsizetype="Fixed" hsizetype="Maximum" >
             <horstretch>1</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -751,18 +824,25 @@
       </item>
       <item>
        <layout class="QHBoxLayout" >
-        <property name="margin" >
-         <number>0</number>
-        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
+        <property name="leftMargin" >
+         <number>0</number>
+        </property>
+        <property name="topMargin" >
+         <number>0</number>
+        </property>
+        <property name="rightMargin" >
+         <number>0</number>
+        </property>
+        <property name="bottomMargin" >
+         <number>0</number>
+        </property>
         <item>
          <widget class="ADM_QSlider" name="horizontalSlider" >
           <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>7</hsizetype>
-            <vsizetype>0</vsizetype>
+           <sizepolicy vsizetype="Fixed" hsizetype="Expanding" >
             <horstretch>5</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -835,7 +915,7 @@
      <x>0</x>
      <y>0</y>
      <width>831</width>
-     <height>29</height>
+     <height>22</height>
     </rect>
    </property>
    <widget class="QMenu" name="menuHelp" >
@@ -994,8 +1074,11 @@
     <enum>Qt::Horizontal</enum>
    </property>
    <attribute name="toolBarArea" >
-    <number>4</number>
+    <enum>TopToolBarArea</enum>
    </attribute>
+   <attribute name="toolBarBreak" >
+    <bool>false</bool>
+   </attribute>
    <addaction name="separator" />
    <addaction name="actionOpen" />
    <addaction name="actionSave_video" />



From gruntster at mail.berlios.de  Fri Aug 17 12:51:41 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 17 Aug 2007 12:51:41 +0200
Subject: [Avidemux-svn-commit] r3526 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708171051.l7HApfM4029750@sheep.berlios.de>

Author: gruntster
Date: 2007-08-17 12:51:34 +0200 (Fri, 17 Aug 2007)
New Revision: 3526

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
Log:
[QT] fix r3525 to support earlier versions of Qt4

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-17 03:22:59 UTC (rev 3525)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-17 10:51:34 UTC (rev 3526)
@@ -36,28 +36,18 @@
   </property>
   <widget class="QWidget" name="centralwidget" >
    <layout class="QGridLayout" >
-    <property name="leftMargin" >
+    <property name="margin" >
      <number>9</number>
     </property>
-    <property name="topMargin" >
-     <number>9</number>
-    </property>
-    <property name="rightMargin" >
-     <number>9</number>
-    </property>
-    <property name="bottomMargin" >
-     <number>9</number>
-    </property>
-    <property name="horizontalSpacing" >
+    <property name="spacing" >
      <number>6</number>
     </property>
-    <property name="verticalSpacing" >
-     <number>6</number>
-    </property>
     <item row="1" column="1" >
      <widget class="QFrame" name="frame_video" >
       <property name="sizePolicy" >
-       <sizepolicy vsizetype="Expanding" hsizetype="Expanding" >
+       <sizepolicy>
+        <hsizetype>7</hsizetype>
+        <vsizetype>7</vsizetype>
         <horstretch>99</horstretch>
         <verstretch>99</verstretch>
        </sizepolicy>
@@ -72,42 +62,26 @@
     </item>
     <item rowspan="2" row="0" column="0" >
      <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>0</number>
+      </property>
       <property name="spacing" >
        <number>6</number>
       </property>
-      <property name="leftMargin" >
-       <number>0</number>
-      </property>
-      <property name="topMargin" >
-       <number>0</number>
-      </property>
-      <property name="rightMargin" >
-       <number>0</number>
-      </property>
-      <property name="bottomMargin" >
-       <number>0</number>
-      </property>
       <item>
        <layout class="QVBoxLayout" >
-        <property name="spacing" >
+        <property name="margin" >
          <number>0</number>
         </property>
-        <property name="leftMargin" >
+        <property name="spacing" >
          <number>0</number>
         </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
         <item>
          <widget class="QLabel" name="label_3" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Preferred" >
+           <sizepolicy>
+            <hsizetype>5</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -128,21 +102,12 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="spacing" >
+          <property name="margin" >
            <number>0</number>
           </property>
-          <property name="leftMargin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="topMargin" >
-           <number>0</number>
-          </property>
-          <property name="rightMargin" >
-           <number>0</number>
-          </property>
-          <property name="bottomMargin" >
-           <number>0</number>
-          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -161,25 +126,18 @@
           </item>
           <item>
            <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
             <property name="spacing" >
              <number>6</number>
             </property>
-            <property name="leftMargin" >
-             <number>0</number>
-            </property>
-            <property name="topMargin" >
-             <number>0</number>
-            </property>
-            <property name="rightMargin" >
-             <number>0</number>
-            </property>
-            <property name="bottomMargin" >
-             <number>0</number>
-            </property>
             <item>
              <widget class="QComboBox" name="comboBoxVideo" >
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
+               <sizepolicy>
+                <hsizetype>5</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -197,7 +155,9 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
+               <sizepolicy>
+                <hsizetype>5</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -216,7 +176,9 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Preferred" >
+               <sizepolicy>
+                <hsizetype>5</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -249,7 +211,9 @@
         <item>
          <widget class="QLabel" name="label_5" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Minimum" hsizetype="Maximum" >
+           <sizepolicy>
+            <hsizetype>4</hsizetype>
+            <vsizetype>1</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -270,21 +234,12 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="spacing" >
+          <property name="margin" >
            <number>0</number>
           </property>
-          <property name="leftMargin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="topMargin" >
-           <number>0</number>
-          </property>
-          <property name="rightMargin" >
-           <number>0</number>
-          </property>
-          <property name="bottomMargin" >
-           <number>0</number>
-          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -303,25 +258,18 @@
           </item>
           <item>
            <layout class="QVBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
             <property name="spacing" >
              <number>6</number>
             </property>
-            <property name="leftMargin" >
-             <number>0</number>
-            </property>
-            <property name="topMargin" >
-             <number>0</number>
-            </property>
-            <property name="rightMargin" >
-             <number>0</number>
-            </property>
-            <property name="bottomMargin" >
-             <number>0</number>
-            </property>
             <item>
              <widget class="QComboBox" name="comboBoxAudio" >
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+               <sizepolicy>
+                <hsizetype>1</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -339,7 +287,9 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+               <sizepolicy>
+                <hsizetype>1</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -355,7 +305,9 @@
                <bool>true</bool>
               </property>
               <property name="sizePolicy" >
-               <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+               <sizepolicy>
+                <hsizetype>1</hsizetype>
+                <vsizetype>0</vsizetype>
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -367,21 +319,12 @@
             </item>
             <item>
              <layout class="QHBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
+              </property>
               <property name="spacing" >
                <number>6</number>
               </property>
-              <property name="leftMargin" >
-               <number>0</number>
-              </property>
-              <property name="topMargin" >
-               <number>0</number>
-              </property>
-              <property name="rightMargin" >
-               <number>0</number>
-              </property>
-              <property name="bottomMargin" >
-               <number>0</number>
-              </property>
               <item>
                <widget class="QCheckBox" name="checkBox_TimeShift" >
                 <property name="text" >
@@ -392,17 +335,19 @@
               <item>
                <widget class="QSpinBox" name="spinBox_TimeValue" >
                 <property name="sizePolicy" >
-                 <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
                   <horstretch>0</horstretch>
                   <verstretch>0</verstretch>
                  </sizepolicy>
                 </property>
-                <property name="minimum" >
-                 <number>-99999</number>
-                </property>
                 <property name="maximum" >
                  <number>99999</number>
                 </property>
+                <property name="minimum" >
+                 <number>-99999</number>
+                </property>
                </widget>
               </item>
              </layout>
@@ -430,7 +375,9 @@
         <item>
          <widget class="QLabel" name="label_4" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -445,21 +392,12 @@
         </item>
         <item>
          <layout class="QHBoxLayout" >
-          <property name="spacing" >
+          <property name="margin" >
            <number>0</number>
           </property>
-          <property name="leftMargin" >
+          <property name="spacing" >
            <number>0</number>
           </property>
-          <property name="topMargin" >
-           <number>0</number>
-          </property>
-          <property name="rightMargin" >
-           <number>0</number>
-          </property>
-          <property name="bottomMargin" >
-           <number>0</number>
-          </property>
           <item>
            <spacer>
             <property name="orientation" >
@@ -479,7 +417,9 @@
           <item>
            <widget class="QComboBox" name="comboBoxFormat" >
             <property name="sizePolicy" >
-             <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>0</vsizetype>
               <horstretch>0</horstretch>
               <verstretch>0</verstretch>
              </sizepolicy>
@@ -533,42 +473,26 @@
     </item>
     <item row="0" column="1" >
      <layout class="QVBoxLayout" >
+      <property name="margin" >
+       <number>0</number>
+      </property>
       <property name="spacing" >
        <number>6</number>
       </property>
-      <property name="leftMargin" >
-       <number>0</number>
-      </property>
-      <property name="topMargin" >
-       <number>0</number>
-      </property>
-      <property name="rightMargin" >
-       <number>0</number>
-      </property>
-      <property name="bottomMargin" >
-       <number>0</number>
-      </property>
       <item>
        <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
         <item>
          <widget class="QLabel" name="label" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -581,7 +505,9 @@
         <item>
          <widget class="QLineEdit" name="lineEdit" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>0</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -609,7 +535,9 @@
         <item>
          <widget class="QLabel" name="label_2" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -622,7 +550,9 @@
         <item>
          <widget class="QLabel" name="label_6" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -635,7 +565,9 @@
         <item>
          <widget class="QLineEdit" name="lineEdit_2" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Fixed" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>0</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -651,7 +583,9 @@
         <item>
          <widget class="QLabel" name="label_7" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -664,7 +598,9 @@
         <item>
          <widget class="QLabel" name="label_8" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -691,21 +627,12 @@
       </item>
       <item>
        <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
         <item>
          <widget class="QLabel" name="label_12" >
           <property name="text" >
@@ -716,7 +643,9 @@
         <item>
          <widget class="QLabel" name="label_9" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -736,7 +665,9 @@
         <item>
          <widget class="QLabel" name="label_10" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Preferred" hsizetype="Minimum" >
+           <sizepolicy>
+            <hsizetype>1</hsizetype>
+            <vsizetype>5</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -762,7 +693,9 @@
         <item>
          <widget class="QSlider" name="horizontalSlider_2" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Fixed" hsizetype="Maximum" >
+           <sizepolicy>
+            <hsizetype>4</hsizetype>
+            <vsizetype>0</vsizetype>
             <horstretch>1</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -824,25 +757,18 @@
       </item>
       <item>
        <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
         <property name="spacing" >
          <number>6</number>
         </property>
-        <property name="leftMargin" >
-         <number>0</number>
-        </property>
-        <property name="topMargin" >
-         <number>0</number>
-        </property>
-        <property name="rightMargin" >
-         <number>0</number>
-        </property>
-        <property name="bottomMargin" >
-         <number>0</number>
-        </property>
         <item>
          <widget class="ADM_QSlider" name="horizontalSlider" >
           <property name="sizePolicy" >
-           <sizepolicy vsizetype="Fixed" hsizetype="Expanding" >
+           <sizepolicy>
+            <hsizetype>7</hsizetype>
+            <vsizetype>0</vsizetype>
             <horstretch>5</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -915,7 +841,7 @@
      <x>0</x>
      <y>0</y>
      <width>831</width>
-     <height>22</height>
+     <height>29</height>
     </rect>
    </property>
    <widget class="QMenu" name="menuHelp" >
@@ -1074,11 +1000,8 @@
     <enum>Qt::Horizontal</enum>
    </property>
    <attribute name="toolBarArea" >
-    <enum>TopToolBarArea</enum>
+    <number>4</number>
    </attribute>
-   <attribute name="toolBarBreak" >
-    <bool>false</bool>
-   </attribute>
    <addaction name="separator" />
    <addaction name="actionOpen" />
    <addaction name="actionSave_video" />



From mean at mail.berlios.de  Fri Aug 17 20:44:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 17 Aug 2007 20:44:58 +0200
Subject: [Avidemux-svn-commit] r3527 -
	branches/avidemux_2.4_branch/avidemux/ADM_colorspace
Message-ID: <200708171844.l7HIiwBt005181@sheep.berlios.de>

Author: mean
Date: 2007-08-17 20:44:58 +0200 (Fri, 17 Aug 2007)
New Revision: 3527

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
Log:
[QT4] Remove the manual rgb to bgr, faster display 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-17 10:51:34 UTC (rev 3526)
+++ branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-17 18:44:58 UTC (rev 3527)
@@ -6,6 +6,8 @@
     begin                : Thu Apr 16 2003
     copyright            : (C) 2002 by mean
     email                : fixounet at free.fr
+    
+ 16 08 2007 : Removed the manual RGB<->BGR, newer swscale can output directly in the correct mode   
  ***************************************************************************/
 
 /***************************************************************************
@@ -98,6 +100,7 @@
     CLEANUP();
     FLAGS();
     PixelFormat fmt=TARGET_COLORSPACE;
+    if(_inverted) fmt=ALTERNATE_COLORSPACE;
     if(!ww || !hh) return 0;   
 	 _context=(void *)sws_getContext(
                       ww,hh,
@@ -180,7 +183,7 @@
 			ddst[1]=ddst[2]=0;
 
 			sws_scale((SwsContext *)_context,srd,ssrc,0,h,dst,ddst);
-
+#if 0
         if(_inverted)
         {
                 uint8_t r,g,b,a;
@@ -188,6 +191,7 @@
                 int pel=h*w;
                 ADM_RGBA2BGRA(ptr,pel);
         }
+#endif
 #if  defined( ADM_BIG_ENDIAN)
         uint8_t r,g,b,a;
         uint8_t *ptr=target;
@@ -241,7 +245,7 @@
     ddst[1]=ddst[2]=0;
 
     sws_scale((SwsContext *)_context,srd,ssrc,0,th,dst,ddst);
-
+#if 0
     if(_inverted)
     {
             uint8_t r,g,b,a;
@@ -253,6 +257,7 @@
               ADM_RGBA2BGRA(ptr,tw);
             }
      }
+#endif
 #if  defined( ADM_BIG_ENDIAN)
         uint8_t r,g,b,a;
         uint8_t *ptr=target;



From mean at mail.berlios.de  Sat Aug 18 08:58:57 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 18 Aug 2007 08:58:57 +0200
Subject: [Avidemux-svn-commit] r3528 - in
	branches/avidemux_2.4_branch/avidemux: ADM_script
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI
Message-ID: <200708180658.l7I6wvsb015100@sheep.berlios.de>

Author: mean
Date: 2007-08-18 08:58:56 +0200 (Sat, 18 Aug 2007)
New Revision: 3528

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
Log:
[DialogFactory] Slider patch (Chris McGregor)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-08-18 06:58:56 UTC (rev 3528)
@@ -667,7 +667,7 @@
 }
 JSBool facSlider(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
 {
-  uint32_t val=4;
+  int32_t val=4;
       diaElemSlider slide(&val,"foo", 0,10);
       
       diaElem *elems[]={&slide   };

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-08-18 06:58:56 UTC (rev 3528)
@@ -47,7 +47,6 @@
 void diaElemInteger::setMe(void *dialog, void *opaque,uint32_t line)
 {
   GtkWidget *widget;
-  GtkObject *adj;
   GtkWidget *label;
   
   label = gtk_label_new_with_mnemonic (paramTitle);
@@ -118,7 +117,6 @@
 void diaElemUInteger::setMe(void *dialog, void *opaque,uint32_t line)
 {
   GtkWidget *widget;
-  GtkObject *adj;
   GtkWidget *label;
   
   label = gtk_label_new_with_mnemonic (paramTitle);
@@ -172,25 +170,79 @@
 }
 
 //****************************************************
-diaElemSlider::diaElemSlider(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,const char *tip)
-  : diaElem(ELEM_SLIDER)
+template <class T>
+diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
+    : diaElem(ELEM_SLIDER),
+      min (min),
+      max (max),
+      incr (incr)
 {
- }
- 
+    param = (void *)value;
+    paramTitle = toggleTitle;
+    this->tip = tip;
+    size = 2;
+}
 
-diaElemSlider::~diaElemSlider()
+template <class T>
+diaElemGenericSlider<T>::~diaElemGenericSlider()
 {
 }
-void diaElemSlider::setMe(void *dialog, void *opaque,uint32_t line)
+
+template <class T>
+void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
 {
+  GtkWidget *label = gtk_label_new_with_mnemonic (paramTitle);
+  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
+  gtk_widget_show(label);
+  
+  gtk_table_attach (GTK_TABLE (opaque), label, 0, 2, line, line+1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  T val=*(T *)param;
+  GtkWidget *widget
+      = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (val, min, max, incr, incr, 0)));
+  gtk_scale_set_value_pos (GTK_SCALE (widget), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (widget), 0);
+  
+  gtk_widget_show (widget);
+  
+  gtk_table_attach (GTK_TABLE (opaque), widget, 0, 2, line+1, line+2,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  gtk_label_set_mnemonic_widget (GTK_LABEL(label), widget);
+  
+  myWidget=(void *)widget;
+  if(readOnly)
+    gtk_widget_set_sensitive(widget,0);
+   if(tip)
+   {
+     GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
+   }
 }
-void diaElemSlider::getMe(void)
+
+template <class T>
+void diaElemGenericSlider<T>::getMe(void)
 {
-
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  T *val=(T *)param;
+  ADM_assert(widget);
+  GtkAdjustment *adj = gtk_range_get_adjustment (GTK_RANGE(widget));
+  *val = (T)GTK_ADJUSTMENT(adj)->value;
+  if(*val<min) *val=min;
+  if(*val>max) *val=max;
 }
 
-void diaElemSlider::enable(uint32_t onoff) 
+template <class T>
+void diaElemGenericSlider<T>::enable(uint32_t onoff)
 {
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  gtk_widget_set_sensitive(GTK_WIDGET(myWidget),onoff);
 }
 
+template class diaElemGenericSlider <int32_t>;
+template class diaElemGenericSlider <uint32_t>;
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-18 06:58:56 UTC (rev 3528)
@@ -392,28 +392,41 @@
 
 }
 //***
-diaElemSlider::diaElemSlider(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,const char *tip)
-  : diaElem(ELEM_SLIDER)
-{
+ 
+ template <class T>
+ diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
+     : diaElem(ELEM_SLIDER),
+       min (min),
+       max (max),
+       incr (incr)
+  {
  }
+  
+ template <class T>
+ diaElemGenericSlider<T>::~diaElemGenericSlider()
+  {
+  }
  
+ template <class T>
+ void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
+  {
+  }
+ 
+ template <class T>
+ void diaElemGenericSlider<T>::getMe(void)
+  {
+  }
+  
+ template <class T>
+ void diaElemGenericSlider<T>::enable(uint32_t onoff) 
+  {
+  }
+  
+ template class diaElemGenericSlider <int32_t>;
+ template class diaElemGenericSlider <uint32_t>;
+ 
 
-diaElemSlider::~diaElemSlider()
-{
-}
-void diaElemSlider::setMe(void *dialog, void *opaque,uint32_t line)
-{
-}
-void diaElemSlider::getMe(void)
-{
-
-}
-
-void diaElemSlider::enable(uint32_t onoff) 
-{
-}
-
-
+//***
 diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT) {}
 diaElemThreadCount::~diaElemThreadCount() {}
 void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line) {}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-08-18 06:58:56 UTC (rev 3528)
@@ -1,6 +1,6 @@
 /***************************************************************************
-  FAC_toggle.cpp
-  Handle dialog factory element : Toggle
+  FAC_integer.cpp
+  Handle dialog factory element : Integer
   (C) 2006 Mean Fixounet at free.fr 
 ***************************************************************************/
 
@@ -144,47 +144,31 @@
     box->setDisabled(1);
 }
 //********************************************
-#if 0
-class diaElemSlider : public diaElem
-{
-  protected:
-    
-    uint32_t _min,_max;
-public:
-            diaElemSlider(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,const char *tip=NULL);
-  virtual   ~diaElemSlider() ;
-  void      setMe(void *dialog, void *opaque,uint32_t line);
-  void      getMe(void);
-  void      enable(uint32_t onoff) ;
-};
-#endif
-#include "../ADM_gui/ADM_qslider.h"
-
-#define ADM_TEST_ADM_SLIDER
-#ifdef ADM_TEST_ADM_SLIDER
-#define MYSLIDERTYPE  ADM_QSlider
-#else
 #define MYSLIDERTYPE  QSlider
-#endif
-             
-diaElemSlider::diaElemSlider(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,const char *tip)
+
+
+template <class T>
+diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
   : diaElem(ELEM_SLIDER)
 {
   param=(void *)value;
   paramTitle=shortkey(toggleTitle);
-  this->_min=min;
-  this->_max=max;
+  this->min=min;
+  this->max=max;
+  this->incr=incr;
   this->tip=tip;
   
  }
  
 
-diaElemSlider::~diaElemSlider()
+template <class T>
+diaElemGenericSlider<T>::~diaElemGenericSlider()
 { 
   if(paramTitle)
     delete paramTitle;
 }
-void diaElemSlider::setMe(void *dialog, void *opaque,uint32_t line)
+template <class T>
+void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
 {
   MYSLIDERTYPE *box=new MYSLIDERTYPE((QWidget *)dialog);
   box->setOrientation ( Qt::Horizontal );
@@ -192,13 +176,13 @@
   QGridLayout *layout=(QGridLayout*) opaque;
  myWidget=(void *)box; 
    
- box->setMinimum(_min);
- box->setMaximum(_max);
- box->setValue(*(uint32_t *)param);
+ box->setMinimum(min);
+ box->setMaximum(max);
+ box->setValue(*(T *)param);
 #ifdef ADM_TEST_ADM_SLIDER
-  box->setNbFrames(_max); 
-  box->setA(_max/3);
-  box->setB((_max*2)/3);
+  box->setNbFrames(max); 
+  box->setA(max/3);
+  box->setB((max*2)/3);
 #endif
  box->show();
  
@@ -207,17 +191,18 @@
  layout->addWidget(text,line,0);
  layout->addWidget(box,line,1);
 }
-void diaElemSlider::getMe(void)
+template <class T>
+void diaElemGenericSlider<T>::getMe(void)
 {
-  uint32_t val;
  MYSLIDERTYPE *box=(MYSLIDERTYPE *)myWidget;
- val=box->value();
- if(val<_min) val=_min;
- if(val>_max) val=_max;
- *(uint32_t *)param=val;
+ T val=box->value();
+ if(val<min) val=min;
+ if(val>max) val=max;
+ *(T *)param=val;
 }
 
-void diaElemSlider::enable(uint32_t onoff) 
+template <class T>
+void diaElemGenericSlider<T>::enable(uint32_t onoff) 
 {
   MYSLIDERTYPE *box=(MYSLIDERTYPE *)myWidget;
   ADM_assert(box);
@@ -226,5 +211,9 @@
   else
     box->setDisabled(1);
 }
+
+template class diaElemGenericSlider <int32_t>;
+template class diaElemGenericSlider <uint32_t>;
+
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-18 06:58:56 UTC (rev 3528)
@@ -39,7 +39,8 @@
   ELEM_BUTTON,
   ELEM_SLIDER,
   ELEM_THREAD_COUNT,
-  ELEM_MAX=ELEM_TOGGLE
+  ELEM_COUNT,
+  ELEM_MAX=ELEM_COUNT-1
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
 /*********************************************/
@@ -90,18 +91,23 @@
   void      enable(uint32_t onoff) ;
 };
 /************************************/
-class diaElemSlider : public diaElem
+template <class T>
+class diaElemGenericSlider : public diaElem
 {
   protected:
     
-    uint32_t _min,_max;
+    T min,max,incr;
 public:
-            diaElemSlider(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,const char *tip=NULL);
-  virtual   ~diaElemSlider() ;
+    diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr = 1, const char *tip=NULL);
+  virtual   ~diaElemGenericSlider() ;
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
 };
+typedef diaElemGenericSlider <int32_t> diaElemSlider;
+/* Same but unsigned */
+typedef diaElemGenericSlider <uint32_t> diaElemUSlider;
+
 /*********************************************/
 class diaElemToggle : public diaElem
 {



From mean at mail.berlios.de  Sat Aug 18 17:21:28 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 18 Aug 2007 17:21:28 +0200
Subject: [Avidemux-svn-commit] r3529 -
	branches/avidemux_2.4_branch/avidemux/ADM_codecs
Message-ID: <200708181521.l7IFLS0P016613@sheep.berlios.de>

Author: mean
Date: 2007-08-18 17:21:27 +0200 (Sat, 18 Aug 2007)
New Revision: 3529

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.h
Log:
[MP4+X264] Put user data/SEI with 1st frame in mp4 mode

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-18 06:58:56 UTC (rev 3528)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-18 15:21:27 UTC (rev 3529)
@@ -214,6 +214,11 @@
       delete[]extraData;
       extraData = NULL;
     }
+  if(_seiUserData)
+  {
+	  delete [] _seiUserData;
+	  _seiUserData=NULL;
+  }
 }
 X264Encoder::~X264Encoder ()
 {
@@ -256,18 +261,15 @@
     {
       sizemax = 0xfffffff;;
       if (!param.b_repeat_headers)
-	size += 4;
-      thisnal =
-	x264_nal_encode (dout + size, &sizemax, param.b_repeat_headers,
-			 &nal[i]);
+    	  size += 4;
+      thisnal =	x264_nal_encode (dout + size, &sizemax, param.b_repeat_headers, &nal[i]);
       if (!param.b_repeat_headers)
-	{			// Need to put size (assuming nal_size=4)
-	  dout[size + 0 - 4] = (thisnal >> 24) & 0xff;
-	  dout[size + 1 - 4] = (thisnal >> 16) & 0xff;
-	  dout[size + 2 - 4] = (thisnal >> 8) & 0xff;
-	  dout[size + 3 - 4] = (thisnal >> 0) & 0xff;
-
-	}
+      {			// Need to put size (assuming nal_size=4)
+    	  dout[size + 0 - 4] = (thisnal >> 24) & 0xff;
+    	  dout[size + 1 - 4] = (thisnal >> 16) & 0xff;
+    	  dout[size + 2 - 4] = (thisnal >> 8) & 0xff;
+    	  dout[size + 3 - 4] = (thisnal >> 0) & 0xff;
+      }
       size += thisnal;
     }
 
@@ -286,6 +288,23 @@
     {
     case X264_TYPE_IDR:
       out->flags = AVI_KEY_FRAME;
+      /* First frame ?*/
+      if(!param.b_repeat_headers && _seiUserData && !pic_out.i_pts)
+      {
+    	  // Put our SEI front...
+    	  // first a temp location...
+    	  uint8_t tmpBuffer[size];
+    	  memcpy(tmpBuffer,out->data,size);
+    	  // Put back out SEI and add Size
+    	  dout[0]=(_seiUserDataLen>>24)&0xff;
+    	  dout[1]=(_seiUserDataLen>>16)&0xff;
+    	  dout[2]=(_seiUserDataLen>>8)&0xff;
+    	  dout[3]=(_seiUserDataLen>>0)&0xff;
+    	  memcpy(dout+4,_seiUserData,_seiUserDataLen);
+    	  memcpy(dout+4+_seiUserDataLen,tmpBuffer,size);
+    	  size+=4+_seiUserDataLen;
+    	  out->len = size; // update total size
+      }
       break;
     case X264_TYPE_I:
       out->flags = AVI_P_FRAME;
@@ -301,7 +320,6 @@
     default:
       printf ("[x264] Unknown image type: %d\n", pic_out.i_type);
       //ADM_assert(0);
-
     }
     
     //
@@ -506,7 +524,7 @@
 
         Try to create the avcC atom and set it as extraData
 _______________________________________________________________*/
-
+#define H264_NAL_TYPE_SEI       0x6
 #define H264_NAL_TYPE_SEQ_PARAM 0x7
 #define H264_NAL_TYPE_PIC_PARAM 0x8
 
@@ -518,23 +536,21 @@
     nal_count;
   uint32_t
     offset = 0;;
-  uint8_t
-    buffer[MAX_HEADER_X264];
-  uint8_t
-    picParam[MAX_HEADER_X264];
-  uint8_t
-    seqParam[MAX_HEADER_X264];
+  uint8_t    buffer[MAX_HEADER_X264];
+  uint8_t    picParam[MAX_HEADER_X264];
+  uint8_t    seqParam[MAX_HEADER_X264];
+  uint8_t    sei[MAX_HEADER_X264];
+  int	     picParamLen = 0, seqParamLen = 0,seiParamLen=0, len;
   int
-    picParamLen = 0, seqParamLen = 0, len;
-  int
     sz;
 
   // 1024 bytes should be enough
   extraData = new uint8_t[MAX_HEADER_X264];
   extraSize = 0;
 
-
-  if (x264_encoder_headers (HANDLE, &nal, &nal_count))
+  x264_t *x264=(x264_t *)_handle;
+  //x264->i_frame=0; // force write_sei_params
+  if (x264_encoder_headers (x264, &nal, &nal_count))
     {
       printf ("[x264] Cannot create header\n");
       return 0;
@@ -544,21 +560,23 @@
   // Now encode them
   for (int i = 0; i < nal_count; i++)
     {
-      if (nal[i].i_type == H264_NAL_TYPE_SEQ_PARAM)
+	  switch(nal[i].i_type)
+	  {
+	  case H264_NAL_TYPE_SEQ_PARAM:
+		  	sz = x264_nal_encode (seqParam, &seqParamLen, 0, &nal[i]);
+		  	break;
+	  case H264_NAL_TYPE_PIC_PARAM:
+		  	sz = x264_nal_encode (picParam, &picParamLen, 0, &nal[i]);
+		  	break;
+	  case H264_NAL_TYPE_SEI:
+		  	sz = x264_nal_encode (sei, &seiParamLen, 0, &nal[i]);
+		  	break;
+	  default:
+		  printf ("[x264] ?? type %d in nal %d\n", nal[i].i_type, i);
+		  sz = x264_nal_encode (buffer, &len, 0, &nal[i]);
+	 }
+    if (sz <= 0)
 	{
-	  sz = x264_nal_encode (seqParam, &seqParamLen, 0, &nal[i]);
-	}
-      else if (nal[i].i_type == H264_NAL_TYPE_PIC_PARAM)
-	{
-	  sz = x264_nal_encode (picParam, &picParamLen, 0, &nal[i]);
-	}
-      else
-	{
-	  printf ("[x264] ?? type %d in nal %d\n", nal[i].i_type, i);
-	  sz = x264_nal_encode (buffer, &len, 0, &nal[i]);
-	}
-      if (sz <= 0)
-	{
 	  printf ("[x264] Cannot encode nal header %d\n", i);
 	  return 0;
 	}
@@ -588,24 +606,26 @@
 
   extraData[offset] = seqParamLen >> 8;
   extraData[offset + 1] = seqParamLen & 0xff;
-
   offset += 2;
-
   memcpy (extraData + offset, seqParam, seqParamLen);
   offset += seqParamLen;
 
+  
   extraData[offset] = 1;	// numOfPictureParameterSets
   offset++;
-
   extraData[offset] = (picParamLen) >> 8;
   extraData[offset + 1] = (picParamLen) & 0xff;
-
   offset += 2;
-
-
   memcpy (extraData + offset, picParam, picParamLen);
   offset += picParamLen;
 
+  // Where x264 stores all its header, save it for later use
+  if(seiParamLen) 
+  {
+	  	_seiUserDataLen=seiParamLen;
+	  	_seiUserData=new uint8_t[_seiUserDataLen];
+	  	memcpy(_seiUserData,sei,_seiUserDataLen);
+  }
 
   extraSize = offset;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.h	2007-08-18 06:58:56 UTC (rev 3528)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.h	2007-08-18 15:21:27 UTC (rev 3529)
@@ -17,6 +17,8 @@
 protected:uint32_t _inited;
   void *_handle;
   void *_pic;
+  uint8_t 	*_seiUserData;
+  uint32_t  _seiUserDataLen; // X264 user data
   uint8_t preamble (uint32_t fps1000, ADM_x264Param * param);
   ADM_x264Param _param;
   uint8_t *extraData;
@@ -34,6 +36,9 @@
     extraSize = 0;
     ptsFrame = 0;
     curFrame = 0;
+    _seiUserDataLen=0;
+    _seiUserData=NULL;
+    
   };
   ~X264Encoder ();
 



From mean at mail.berlios.de  Sat Aug 18 17:22:05 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 18 Aug 2007 17:22:05 +0200
Subject: [Avidemux-svn-commit] r3530 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
Message-ID: <200708181522.l7IFM5f0016659@sheep.berlios.de>

Author: mean
Date: 2007-08-18 17:22:04 +0200 (Sat, 18 Aug 2007)
New Revision: 3530

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASharp_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend_param.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filters] Move to proper place

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -36,7 +36,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyAsharp.h"
 #include "ADM_assert.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -35,7 +35,7 @@
 
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_colorspace/ADM_rgb.h"
 #include "ADM_toolkit_gtk/ADM_gladeSupport.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -34,7 +34,7 @@
 
 
 #include "ADM_videoFilter/ADM_vidAnimated_param.h"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "ADM_audiofilter/audiofilter_normalize_param.h"
 #include "ADM_video/ADM_vidCNR2_param.h"
 #include "ADM_video/ADM_vidColorYuv_param.h"
@@ -49,7 +49,7 @@
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
 #include "ADM_videoFilter/ADM_vidEq2.h"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
 #include "ADM_videoFilter/ADM_vidSRT.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -34,7 +34,7 @@
 
 
 #include "ADM_videoFilter/ADM_vidAnimated_param.h"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "ADM_audiofilter/audiofilter_normalize_param.h"
 #include "ADM_video/ADM_vidCNR2_param.h"
 #include "ADM_video/ADM_vidColorYuv_param.h"
@@ -48,7 +48,7 @@
 #include "ADM_video/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 //#include "ADM_video/ADM_vidFont.h"
 class ADMfont;
 #include "ADM_videoFilter/ADM_vidSRT.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -37,7 +37,7 @@
 #include "ADM_assert.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyDialogQt4.h"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "DIA_flyAsharp.h"
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -37,7 +37,7 @@
 #include "ADM_assert.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyDialogQt4.h"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 #include "DIA_flyContrast.h"
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -32,7 +32,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyAsharp.h"
 #include "ADM_assert.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyContrast.h"
 /************* COMMON PART *********************/

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyEq2.h"
 #include "ADM_osSupport/ADM_cpuCap.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include "ADM_image.h"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
 #include "DIA_flyDialog.h"
 #include "DIA_flyAsharp.h"
 #include "ADM_assert.h"

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,18 +0,0 @@
-
-#ifndef _ASHARP_PARAM
-#define _ASHARP_PARAM
-#define uc uint8_t
-#define bool uint8_t
-
- void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf );
-
-typedef struct ASHARP_PARAM
-{
-        double          t; // Threshold 0:nothing max : 5 ?
-        double          d; // Strength : 0 means nothing, >0  adaptative t is maximum
-        double          b; // Block adaptative sharpening -1 disabled
-        uint32_t        bf;
-}ASHARP_PARAM;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,299 +0,0 @@
-/**/
-/***************************************************************************
-                          ADM_vidASharp  -  description
-                             -------------------   
-    Port of avisynth one
-
- ***************************************************************************/
-/*
-        
-        Copyright (C) 2003 Donald A. Graft
-        Copyright (C) 2002 Marc Fauconneau
-        This program is free software; you can redistribute it and/or modify
-        it under the terms of the GNU General Public License as published by
-        the Free Software Foundation.
-
-        This program is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-        GNU General Public License for more details.
-
-        You should have received a copy of the GNU General Public License
-        along with this program; if not, write to the Free Software
-        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-*/
-
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "avi_vars.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include"ADM_video/ADM_cache.h"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-
-#include "ADM_osSupport/ADM_cpuCap.h"
-#include "ADM_filter/video_filters.h"
-
-#include "ADM_vidASharp_param.h"
-class ASharp : public AVDMGenericVideoStream
-{
-private:
-        
-        VideoCache      *vidCache;
-        ASHARP_PARAM    *_param;
-        int32_t        T,D,B,B2;
-        
-public:    
-
-                        ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)   ;
-                        ~ASharp();
-
-
-                        void update(void);         
-        char            *printConf( void );
-        uint8_t         configure(AVDMGenericVideoStream *in);
-        uint8_t         getCoupledConf( CONFcouple **couples);
-        uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-};
-
-BUILD_CREATE(asharp_create,ASharp);
-static FILTER_PARAM asharp_param={4,{"t", "b","d", "bf"}};
-
-
-SCRIPT_CREATE(asharp_script,ASharp,asharp_param);
-//_______________________________________________
-
-ASharp::ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)
-
-{
-        _in=in;         
-        memcpy(&_info,_in->getInfo(),sizeof(_info));    
-        _info.encoding=1;
-        _uncompressed=NULL;             
-        _info.encoding=1;
-
-
-        _param=new ASHARP_PARAM;
-       
-        if(couples)
-                {
-                     GET(t);
-                     GET(d);
-                     GET(b);
-                     GET(bf); 
-                }
-                else // Default
-                {
-                        _param->t=2;
-                        _param->d=4;
-                        _param->b=-1;
-                        _param->bf=0;
-                }                              
-                update();
-                vidCache=new VideoCache(5,in);
-}
-//________________________________________________________
-void ASharp::update( void)
-{
-                // parameters floating point to fixed point convertion
-                T = (int)(_param->t*(4<<7));
-                D = (int)(_param->d*(4<<7));
-                B = (int)(256-_param->b*64);
-                B2= (int)(256-_param->b*48);
-
-                // clipping (recommended for SIMD code)
-
-                if (T<-(4<<7)) T = -(4<<7); // yes, negatives values are accepted
-                if (D<0) D = 0;
-                if (B<0) B = 0;
-                if (B2<0) B2 = 0;
-
-                if (T>(32*(4<<7))) T = (32*(4<<7));
-                if (D>(16*(4<<7))) D = (16*(4<<7));
-                if (B>256) B = 256;
-                if (B2>256) B2 = 256;
-
-}
-//________________________________________________________
-uint8_t ASharp::getCoupledConf( CONFcouple **couples)
-{
-        *couples=NULL;
-        *couples=new CONFcouple(4);
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-               CSET(t);
-               CSET(d);
-               CSET(b);
-               CSET(bf);    
-        return 1;
-}
-//________________________________________________________
-ASharp::~ASharp(void)
-{
-
-        if(vidCache) delete vidCache;     
-
-     
-        vidCache=NULL;
-
-}
-
-extern uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
-//________________________________________________________
-uint8_t ASharp::configure(AVDMGenericVideoStream *in)
-{
-uint8_t r=0;
-        _in=in;
-        if( DIA_getASharp(_param, _in))
-        {
-                r=1;
-        }
-        update();
-        return r;
-}
-
-//________________________________________________________
-char *ASharp::printConf( void )
-{
-        static char buf[50];
-
-        ADM_assert(_param);
-        sprintf((char *)buf," ASharp (MarcFD)");
-        return buf;
-}
-        
-//________________________________________________________
-uint8_t ASharp::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                ADMImage *data,uint32_t *flags)
-{
-ADMImage *src;
-ADMImage *dst;
-
-        dst=data;
-        if(frame>=_info.nb_frames) return 0;
-        src=vidCache->getImage(frame);
-        dst->duplicate(src);
-        asharp_run_c(     dst->GetWritePtr(PLANAR_Y),
-                        dst->GetPitch(PLANAR_Y), 
-                        _info.height,
-                        _info.width,
-                        T,
-                        D,
-                        B,
-                        B2,
-                        _param->bf);
-
-        vidCache->unlockAll();
-
-        return 1;
-}
-
-
-
-
-void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf )
-        {
-                uc* lineptr = new uc[width];
-                int p = pitch;
-                int y,x;
-                uc* cfp = planeptr+pitch;
-                uc* lp = lineptr;
-                memcpy(lp,planeptr,width);
-                for (y=1;y<height-1;y++) {
-                        int last = cfp[0];
-                        for (x=0;x<width-1;x++) {
-
-                                int avg = 0;
-                                int dev = 0;
-                                int T2;
-                                int diff;
-                                int tmp;
-
-                                avg += lp[x-1];
-                                avg += lp[x  ];
-                                avg += lp[x+1];
-                                avg += last;
-                                avg += cfp[x    ];
-                                avg += cfp[x  +1];
-                                avg += cfp[x+p-1];
-                                avg += cfp[x+p  ];
-                                avg += cfp[x+p+1];
-
-                                avg *= (65535/9);
-                                avg >>= 16;
-
-                                #define CHECK(A) \
-                                if (abs(A-cfp[x])>dev) dev = abs(A-cfp[x]);
-                                
-                                if (bf) {
-
-                                if (y%8>0) {
-                                        if (x%8>0) CHECK(lp[x-1])
-                                        CHECK(lp[x  ])
-                                        if (x%8<7) CHECK(lp[x+1])
-                                }
-                                if (x%8>0) CHECK(last)
-                                if (x%8<7) CHECK(cfp[x  +1])
-                                if (y%8<7) {
-                                        if (x%8>0) CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        if (x%8<7) CHECK(cfp[x+p+1])
-                                }
-
-                                } else {
-                                        CHECK(lp[x-p-1])
-                                        CHECK(lp[x-p  ])
-                                        CHECK(lp[x-p+1])
-                                        CHECK(last)
-                                        CHECK(cfp[x  +1])
-                                        CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        CHECK(cfp[x+p+1])
-                                }
-
-                                T2 = T;
-                                diff = cfp[x]-avg;
-                                int D2 = D;
-
-                                if (x%8==6) D2=(D2*B2)>>8;
-                                if (x%8==7) D2=(D2*B)>>8;
-                                if (x%8==0) D2=(D2*B)>>8;
-                                if (x%8==1) D2=(D2*B2)>>8;
-                                if (y%8==6) D2=(D2*B2)>>8;
-                                if (y%8==7) D2=(D2*B)>>8;
-                                if (y%8==0) D2=(D2*B)>>8;
-                                if (y%8==1) D2=(D2*B2)>>8;
-
-                                int Da = -32+(D>>7);
-                                if (D>0) T2 = ((((dev<<7)*D2)>>16)+Da)<<4;
-
-                                if (T2>T) T2=T;
-                                if (T2<-32) T2=-32;
-
-                                tmp = (((diff<<7)*T2)>>16)+cfp[x];
-
-                                if (tmp < 0) tmp = 0;
-                                if (tmp > 255) tmp = 255;
-                                lp[x-1] = last;
-                                last = cfp[x];
-                                cfp[x] = tmp;
-                        }
-                        lp[x] = cfp[x];
-                        cfp += pitch;
-                }
-        delete[] lineptr;
-} 
-//**********************************

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,243 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.cpp  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-#include <math.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidContrast.h"
-#include "ADM_filter/video_filters.h"
-
-
-
-static FILTER_PARAM contrastParam =
-  { 5, {"offset", "coef", "doLuma", "doChromaU", "doChromaV"} };
-
-
-SCRIPT_CREATE (contrast_script, ADMVideoContrast, contrastParam);
-
-BUILD_CREATE (contrast_create, ADMVideoContrast);
-
-char *
-ADMVideoContrast::printConf (void)
-{
-  static char buf[50];
-
-  ADM_assert (_param);
-  sprintf ((char *) buf, " contrast : %1.2f %d", _param->coef,
-	   _param->offset);
-  return buf;
-}
-
-//_______________________________________________________________
-
-ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
-				    CONFcouple * couples)
-{
-
-
-  _in = in;
-  memcpy (&_info, _in->getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  //   _uncompressed=new uint8_t [3*_in->getInfo()->width*_in->getInfo()->height];
-  _uncompressed =
-    new ADMImage (_in->getInfo ()->width, _in->getInfo ()->height);
-  ADM_assert (_uncompressed);
-  _param = NULL;
-  if (couples)
-    {
-      _param = NEW (CONTRAST_PARAM);
-      GET (offset);
-      GET (coef);
-      GET (doLuma);
-      GET (doChromaU);
-      GET (doChromaV);
-    }
-  else
-    {
-      _param = NEW (CONTRAST_PARAM);
-      _param->offset = 0;
-      _param->coef = 1.0f;
-      _param->doLuma = 1;
-      _param->doChromaU = 1;
-      _param->doChromaV = 1;
-
-    }
-  buildContrastTable (_param->coef, _param->offset, _tableFlat, _tableNZ);
-
-
-}
-
-
-uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
-{
-
-  ADM_assert (_param);
-  *couples = new CONFcouple (5);
-
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-  CSET (offset);
-  CSET (coef);
-  CSET (doLuma);
-  CSET (doChromaU);
-  CSET (doChromaV);
-  return 1;
-
-}
-ADMVideoContrast::~ADMVideoContrast ()
-{
-  if (_uncompressed)
-    delete _uncompressed;
-  _uncompressed = 0;
-  DELETE (_param);
-}
-
-//
-//      Remove y and v just keep U and expand it
-//
-uint8_t
-  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
-					   uint32_t * len,
-					   ADMImage * data, uint32_t * flags)
-{
-  //uint32_t x,w;
-
-  ADM_assert (_param);
- if(frame>= _info.nb_frames) return 0;
-
-
-  if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
-    return 0;
-  *len = _info.width * _info.height + (_info.width * _info.height >> 1);
-
-  uint32_t sz = _info.width * _info.height;
-  // luma 
-  if (_param->doLuma)
-    {
-      if (!doContrast (_uncompressed->data, data->data, _tableFlat,
-		       _info.width, _info.height))
-	return 0;
-    }
-  else
-    {
-      memcpy (data->data, _uncompressed->data, sz);
-    }
-  // ______u_____________         
-
-  if (_param->doChromaU)
-    {
-      if (!doContrast (_uncompressed->data + sz, data->data + sz, _tableNZ,
-		       _info.width >> 1, _info.height >> 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data->data + sz, _uncompressed->data + sz, sz >> 2);
-    }
-
-  // ______v_____________         
-  if (_param->doChromaV)
-    {
-
-      if (!doContrast
-	  (_uncompressed->data + sz + (sz >> 2), data->data + sz + (sz >> 2),
-	   _tableNZ, _info.width >> 1, _info.height >> 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data->data + sz + (sz >> 2),
-	      _uncompressed->data + sz + (sz >> 2), sz >> 2);
-    }
-
-
-
-
-  return 1;
-}
-
-uint8_t
-buildContrastTable (float coef, int8_t off,
-		    uint8_t * tableFlat, uint8_t * tableNZ)
-{
-  float f;
-
-  for (uint32_t i = 0; i < 256; i++)
-    {
-      f = i;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-      f += off;
-      if (f < 0.)
-	f = 0.;
-      if (f > 255.)
-	f = 255.;
-      *(tableFlat + i) = (uint8_t) floor (f);
-
-      f = i;
-      f -= 128;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-
-//                                      f+=off;
-      if (f < -127.)
-	f = -127.;
-      if (f > 127.)
-	f = 127.;
-      f += 128.;
-      *(tableNZ + i) = (uint8_t) floor (f);
-    }
-  return 0;
-}
-
-uint8_t
-doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
-	    uint32_t w, uint32_t h)
-{
-
-  for (uint32_t y = h * w; y > 0; y--)
-    {
-      *out++ = table[*in++];
-    }
-
-  return 1;
-
-}
-uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
-uint8_t
-ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
-{
-  if(DIA_contrast(_in,_param))
-  {
-    buildContrastTable (_param->coef, _param->offset, _tableFlat, _tableNZ);
-    return 1;
-  }
-  return 0;
-}
-
-// EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,57 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.h  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef _CONTRAST_
-#define _CONTRAST_
-
-typedef struct 
-{
-		float 	coef;
-		int32_t  offset;
-		uint32_t	doLuma;
-		uint32_t	doChromaU;
-		uint32_t	doChromaV;
-		
-	
-	}CONTRAST_PARAM;
-	
-  uint8_t buildContrastTable( float coef,int8_t off,	
-  								uint8_t *tableFlat,uint8_t *tableNZ);
-  uint8_t doContrast(uint8_t *in,uint8_t *out,uint8_t *table,
-												uint32_t w,uint32_t h);
-
-
- class  ADMVideoContrast:public AVDMGenericVideoStream
- {
-
- protected:
-				virtual char 					*printConf(void);
-				CONTRAST_PARAM					*_param;
-				uint8_t						_tableFlat[256];
-				uint8_t						_tableNZ[256];
-
- public:
-
-					ADMVideoContrast(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  					virtual ~ADMVideoContrast();
-		          virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          																	ADMImage *data,uint32_t *flags);
-					virtual uint8_t 	configure( AVDMGenericVideoStream *instream) ;
-
- 					virtual uint8_t	getCoupledConf( CONFcouple **couples);
- 				
- }     ;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,152 +0,0 @@
-//
-//      Try to detect blended image
-//      Mean (C) 2005
-//      GPL v2.0
-//
-
-
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "avi_vars.h"
-#include "math.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-#include "ADM_video/ADM_cache.h"
-#include "ADM_filter/video_filters.h"
-
-#include "ADM_vidCNR2_param.h"
-
-//#define SUBST 1
-
-class vidDelta:public AVDMGenericVideoStream
-{
-
-protected:
-  virtual char *printConf (void);
-  VideoCache *vidCache;
-
-
-public:
-
-                        vidDelta (AVDMGenericVideoStream * in, CONFcouple * setup);
-        virtual         ~vidDelta ();
-  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
-					 ADMImage * data, uint32_t * flags);
-  uint8_t configure (AVDMGenericVideoStream * instream);
-  virtual uint8_t getCoupledConf (CONFcouple ** couples);
-
-};
-
-static FILTER_PARAM delta_template =
-  { 0 };
-
-BUILD_CREATE (delta_create, vidDelta);
-SCRIPT_CREATE (delta_script, vidDelta, delta_template);
-
-
-/*************************************/
-uint8_t vidDelta::configure (AVDMGenericVideoStream * in)
-{
-        return 1;
-}
-/*************************************/
-char *vidDelta::printConf (void)
-{
-  static char buf[50];
-  sprintf ((char *) buf, " Delta");
-  return buf;
-}
-/*************************************/
-vidDelta::vidDelta (AVDMGenericVideoStream * in, CONFcouple * couples)
-{
-
-  _in = in;
-  memcpy (&_info, _in->getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  vidCache = new VideoCache (4, in);
-  
-  
-}
-//____________________________________________________________________
-vidDelta::~vidDelta ()
-{
-
-  delete vidCache;
-  vidCache = NULL;
-
-}
-
-//______________________________________________________________
-uint8_t vidDelta::getFrameNumberNoAlloc (uint32_t frame,
-				uint32_t * len,
-				ADMImage * data, uint32_t * flags)
-{
-int w,h,page;
-ADMImage *cur,*prev,*next;
-        w=_info.width;
-        h=_info.height;
-        page=w*h;
-  if(frame>= _info.nb_frames) return 0;
-  if(!frame || frame>=_info.nb_frames-1)
-  {
-        memset(YPLANE(data),0,page);
-        memset(UPLANE(data),128,page>>2);
-        memset(VPLANE(data),128,page>>2);
-        return 1;
-  }
-  cur=vidCache->getImage (frame);
-  prev=vidCache->getImage (frame-1);
-  next=vidCache->getImage (frame+1);
-  // No chroma
-        memset(UPLANE(data),128,page>>2);
-        memset(VPLANE(data),128,page>>2);
-
-   uint8_t *c=YPLANE(cur);
-   uint8_t *p=YPLANE(prev);
-   uint8_t *n=YPLANE(next);
-   uint8_t *out=YPLANE(data);
-#define SAME_THRESH 32
-   int a,b,d,cp,cn,e;
-   for(int y=0;y<h;y++)
-        for(int x=0;x<w;x++)
-        {
-                a=*c++;
-                b=*p++;
-                e=*n++;
-                cp=abs(a-b);
-                cn=abs(a-e);
-                // Cp is the != between current and previous
-                // cn is the != between current and next
-                // We try to spo frames that are blended betwwen next & previous
-                
-                if(cp>SAME_THRESH && cn > SAME_THRESH && abs(cp-cn) < 128) *out++=255;//(cp+cn)/2;
-                        else *out++=0;
-        }
-
-
-  vidCache->unlockAll ();
-  return 1;
-}
-
-/*************************************/
-uint8_t vidDelta::getCoupledConf (CONFcouple ** couples)
-{
-
-  *couples=NULL;
-  return 1;
-}
-
-// EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,330 +0,0 @@
-// Port of Bach unblend avisynth filter
-//
-//      Copyright by Bach, D Graft, Ernst Pech?
-//      Probably GPL
-//
-//
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "avi_vars.h"
-#include "math.h"
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-#include "ADM_video/ADM_cache.h"
-#include "ADM_filter/video_filters.h"
-#include "ADM_vidUnblend_param.h"
-
-class vidUnblend:public AVDMGenericVideoStream
-{
-
-protected:
-  virtual char *printConf (void);
-  VideoCache *vidCache;
-  PARAM_UNBLEND *_param;
-
-  void DrawShow(ADMImage *src, int useframe, int blend, int inframe, int threshold, float dthresh);
-  void Findblend(int frame, int *bblend);
-  int  firsttime;
-  int  reference;
-  unsigned int *sum;
-
-  
-public:
-
-                        vidUnblend (AVDMGenericVideoStream * in, CONFcouple * setup);
-        virtual         ~vidUnblend ();
-  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
-                                         ADMImage * data, uint32_t * flags);
-  uint8_t configure (AVDMGenericVideoStream * instream);
-  virtual uint8_t getCoupledConf (CONFcouple ** couples);
-
-};
-
-static FILTER_PARAM unblend_template =
-  { 3,"show","threshold","dthresh" };
-
-BUILD_CREATE (unblend_create, vidUnblend);
-SCRIPT_CREATE (unblend_script, vidUnblend, unblend_template);
-//*************************************
-uint8_t vidUnblend::configure (AVDMGenericVideoStream * in)
-{
-       
-        return 0;
-}
-/*************************************/
-char *vidUnblend::printConf (void)
-{
-  static char buf[50];
-  sprintf ((char *) buf, " Unblend by Bach");
-  return buf;
-}
-uint8_t vidUnblend::getCoupledConf (CONFcouple ** couples)
-{
-
-  ADM_assert (_param);
-  *couples = new CONFcouple (3);
-#undef CSET
-#define CSET(x)  (*couples)->setCouple(#x,(_param->x))
-
-  CSET (show);
-  CSET (threshold);
-  CSET (dthresh);
-  return 1;
-}
-
-#define MAX_BLOCKS 50
-/*************************************/
-vidUnblend::vidUnblend (AVDMGenericVideoStream * in, CONFcouple * couples)
-{
-
-  _in = in;
-  memcpy (&_info, _in->getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  vidCache = new VideoCache (10, in);
-  _param=new PARAM_UNBLEND;
-  if(couples)
-  {
-#undef GET
-#define GET(x) couples->getCouple(#x,&(_param->x))
-      GET (show);
-      GET (threshold);
-      GET (dthresh);
-
-  }
-  else
-  {
-                _param->show=1;
-                _param->threshold=5;
-                _param->dthresh=3./100.;
-
-  }
-  firsttime=true;
-  sum=new unsigned int[MAX_BLOCKS * MAX_BLOCKS];
-  reference=0;
-  DrawShow(NULL,0,0,0,_param->threshold,_param->dthresh);
-  
-}
-//____________________________________________________________________
-vidUnblend::~vidUnblend ()
-{
-
-  delete vidCache;
-  vidCache = NULL;
-  delete _param;
-  _param=NULL;
-  delete [] sum;
-  sum=NULL;
-
-}
-
-
-#define DrawString(x,y,z,t) printf("Unblend :%s\n",t);
-#define GETFRAME(useframe, src) src=vidCache->getImage(useframe)
-void vidUnblend::DrawShow(ADMImage *src, int useframe, int blend, int inframe, int threshold, float dthresh)
-{
-	char buf[80];
-
-	if (_param->show == true)
-	{
-		sprintf(buf, "unblend %s", 0);
-		DrawString(src, 0, 0, buf);
-		sprintf(buf, "Copyright 2003 Bach, based on source by D.Graft and Ernst Pech");
-		DrawString(src, 0, 1, buf);
-		sprintf(buf,"Using frm %d, instead of frm %d", useframe, useframe-blend);
-		DrawString(src, 0, 2, buf);
-		sprintf(buf,"the diff threshold is %d", threshold);
-		DrawString(src, 0, 4, buf);	
-		sprintf(buf,"the noise threshold is  %f", dthresh);
-		DrawString(src, 0, 5, buf);	
-	}
-}
-
-uint8_t vidUnblend::getFrameNumberNoAlloc (uint32_t inframe,
-                                uint32_t * len,
-                                ADMImage * data, uint32_t * flags)
-{
-
-	int blend=0, useframe;
-	ADMImage *src;
-	char buf[255];
-        if(inframe>= _info.nb_frames) return 0;
-        if(!inframe || inframe>_info.nb_frames-5)
-        {
-                data->duplicate(vidCache->getImage(inframe));
-                vidCache->unlockAll();
-                return 1;
-        }
-
-	useframe = inframe;
-	Findblend(useframe, &blend);
-	//useframe++; ?????
-	switch(blend)
-		{
-		case (-1):
-			useframe--;
-			break;
-		case 1:
-			useframe++;
-			break;
-		default:
-			break;
-		}
-	        
-	   	
-
-                if (_param->show == true)
-		{
-/*
-                sprintf(buf, "unblend %s", VERSION);
-		DrawString(src, 0, 0, buf);
-		sprintf(buf, "Copyright 2003 Bach, based on source by D.Graft and Ernst Pech?);
-		DrawString(src, 0, 1, buf);
-*/
-		sprintf(buf,"Using frm %d, instead of frm %d\n*****************", useframe, useframe-blend);
-		DrawString(src, 0, 2, buf);
-/*
-		sprintf(buf,"the diff threshold is %d", _param->threshold);
-		DrawString(src, 0, 4, buf);	
-		sprintf(buf,"the noise threshold is  %f", _param->dthresh);
-		DrawString(src, 0, 5, buf);		
-*/
-		}
-        src=vidCache->getImage(useframe);
-        data->duplicate(src);
-        vidCache->unlockAll();
-	return 1;
-}
-
-void  vidUnblend::Findblend(int frame, int *bblend)
-
-{
-	int f, x, y,pitchY,row_sizeY,heightY;
-	ADMImage *store[5];
-	const unsigned char *storepY[5];
-	float t;
-	float metric02, metric13, metric24;
-	int metric_count02, metric_count13, metric_count24;
-	int count02, count13, count24;
-	float p0, p1, p2, p3, p4;
-	float percent02, percent13, percent24;
-        int vi_height=_info.height;
-        int vi_width=_info.width;
-		
-	if (firsttime == true || frame == 0)
-	{
-		firsttime=false;
-		reference=0;
-	}
-
-	for (f = 0; f <= 4; f++)
-	{
-		GETFRAME(frame + f - 1, store[f]);
-		storepY[f] = store[f]->data; //store[f]->GetReadPtr(PLANAR_Y);
-	}
-
-    pitchY = _info.width;    //store[0]->GetPitch(PLANAR_Y);
-    row_sizeY = _info.width; //store[0]->GetRowSize(PLANAR_Y);
-    heightY = _info.height;  //store[0]->GetHeight(PLANAR_Y);
-		
-	metric_count02=1;
-	metric02=0;
-	metric_count13=1;
-	metric13=0;
-	metric_count24=1;
-	metric24=0;
-	count02=0;
-	count13=0;
-	count24=0;
-
-	for ( y=0; y<vi_height-1; y=y+2) 
-	{
-	    for ( x=0; x<row_sizeY-1; x=x+2) {
-			
-			p0 = (float)(storepY[0][x] + storepY[0][x+pitchY])/2;
-			p1 = (float)(storepY[1][x] + storepY[1][x+pitchY])/2;
-			p2 = (float)(storepY[2][x] + storepY[2][x+pitchY])/2;
-			p3 = (float)(storepY[3][x] + storepY[3][x+pitchY])/2;
-			p4 = (float)(storepY[4][x] + storepY[4][x+pitchY])/2;
-			
-			t=1000;
-			if (fabs(p1- p3)>_param->threshold ) {
-				t = 255 * (p2 - p1)/(p3 - p1);	// tmax = +-255/1   tmin = +-1/255
-				if (t>32 && t<224) {
-					count13++;
-					metric_count13++;
-					metric13 = metric13 + t;
-				} else {
-					count13--;
-				}
-			}
-
-			// prev frame
-			if (fabs(p0 - p2)>_param->threshold ) {
-				t = 255 * (p1 - p0)/(p2 - p0);
-				if (t>32 && t<224) {
-					count02++;
-					metric02 = metric02 + t;
-					metric_count02++;
-				} else {
-					count02--;
-				}
-			}
-			// next frame
-			if (fabs(p2 - p4)>_param->threshold ) {
-				t = 255 * (p3 - p2)/(p4 - p2);
-				if (t>32 && t<224) {
-					count24++;
-					metric24 = metric24 + t;
-					metric_count24++;
-				} else {
-					count24--;
-				}
-			}
-		}
-
-		storepY[0] += 2 * pitchY;
-		storepY[1] += 2 * pitchY;
-		storepY[2] += 2 * pitchY;
-		storepY[3] += 2 * pitchY;
-		storepY[4] += 2 * pitchY;
-	}
-
-	metric02 = metric02 / metric_count02;
-	metric13 = metric13 / metric_count13;
-	metric24 = metric24 / metric_count24;
-
-	percent02 = (float)200 * count02 / (vi_height * vi_width);
-	percent13 = (float)200 * count13 / (vi_height * vi_width);
-	percent24 = (float)200 * count24 / (vi_height * vi_width);
-
-        if(_param->show)
-        {
-                printf("PC02:%f PC13:%f PC24:%f\n",percent02,percent13,percent24);
-                printf("Metric13:%f \n",metric13);
-        }
-
-	if (percent13>_param->dthresh && (percent02<_param->dthresh ) && (percent24<_param->dthresh )) 
-	{
-                if(_param->show) printf("BLENDED\n");
-		if (metric13<128 && metric13>32) reference=(-1);
-		else if(metric13>128 && metric13<224) reference=1;
-	}
-	else reference=0;
-	
-	*bblend = reference;
-	
-}
-//EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,26 +0,0 @@
-/***************************************************************************
-        See avisynth unblend
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef UNBLEND_PARAM_H
-#define UNBLEND_PARAM_H
-
-typedef struct PARAM_UNBLEND
-{
-        uint32_t show;
-        uint32_t threshold;
-        float    dthresh;
-
-}PARAM_UNBLEND;
-
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-18 15:22:04 UTC (rev 3530)
@@ -7,16 +7,12 @@
 ADM_vidColorYuv.cpp   
 ADM_vidFieldUtil.cpp     
 ADM_vidRaw.cpp        
-ADM_vidUnblend.cpp
 ADM_genvideo.cpp         
-ADM_vidContrast.cpp   
 ADM_vidFont.cpp
 ADM_vidVobsub.cpp
-ADM_vidAsharp.cpp       
 ADM_vidVobSubRender.cpp
 ADM_interlaced.cpp       
 ADM_vidCached.cpp       
-ADM_vidDelta.cpp      
 ADM_vidMPdelogo.cpp      
 ADM_vobsubinfo.cpp
 ADM_vidClean.cpp        

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-18 15:22:04 UTC (rev 3530)
@@ -10,7 +10,6 @@
  ADM_vidCached.cpp \
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
- ADM_vidContrast.cpp \
  ADM_vidNull.cpp \
 	ADM_vidClean.cpp \
  ADM_genvideo.cpp \
@@ -26,10 +25,7 @@
  ADM_vidVobsub.cpp \
  ADM_vobsubinfo.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidAsharp.cpp \
  ADM_vidCNR2.cpp \
-  ADM_vidDelta.cpp \
- ADM_vidUnblend.cpp \
  ADM_vidMPdelogo.cpp \
  ADM_vidColorYuv.cpp  
 
@@ -43,7 +39,7 @@
 ADM_genvideo.cpp \
 ADM_genvideo.hxx ADM_vidPartial.cpp \
 ADM_vidPartial.h \
-ADM_vidDelta.cpp  ADM_vidPartial_param.h \
+ADM_vidPartial_param.h \
 ADM_guiResize.cpp   ADM_vidRaw.cpp \
 ADM_interlaced.cpp  \
 ADM_interlaced.h ADM_vidResize.cpp \
@@ -55,12 +51,11 @@
 ADM_resizebis.hxx    \
 ADM_resizeter.cpp  ADM_vidField.h  \
 ADM_vidFieldUnblend.cpp \
-ADM_vidASharp_param.h  ADM_vidFieldUtil.cpp  \
+ADM_vidFieldUtil.cpp  \
 ADM_vidFieldUtil.h  \
 ADM_vidAnimated.cpp  \
 ADM_vidAnimated.h  \
 ADM_vidAnimated_param.h   \
-ADM_vidAsharp.cpp   \
 ADM_vidFont.cpp \
 ADM_vidFont.h \
 ADM_vidCNR2.cpp  \
@@ -69,15 +64,15 @@
 ADM_vidCached.h  ADM_vidIVTC.cpp \
 ADM_vidIVTC.h \
 ADM_vidChromaShift.cpp \
-ADM_vidChromaShift.h ADM_vidUnblend.cpp \
-ADM_vidClean.cpp ADM_vidUnblend_param.h \
+ADM_vidChromaShift.h  \
+ADM_vidClean.cpp  \
 ADM_vidClean.h \
 ADM_vidColorYuv.cpp  \
 ADM_vidColorYuv.h  ADM_vidVobSub.h \
 ADM_vidColorYuv_param.h  ADM_vidVobSubRender.cpp \
 ADM_vidCommonFilter.h  ADM_vidMPLResize.cpp  ADM_vidVobsub.cpp \
-ADM_vidContrast.cpp  ADM_vidMPdelogo.cpp \
-ADM_vidContrast.h  ADM_vidMPdelogo.h \
+ADM_vidMPdelogo.cpp \
+ADM_vidMPdelogo.h \
 ADM_vobsubinfo.cpp \
 ADM_vobsubinfo.h \
 swscale_internal.h \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASharp_param.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -0,0 +1,243 @@
+/***************************************************************************
+                          ADM_vidContrast.cpp  -  description
+                             -------------------
+    begin                : Sun Sep 22 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+#include <math.h>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "config.h"
+#include "avi_vars.h"
+
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidContrast.h"
+#include "ADM_filter/video_filters.h"
+
+
+
+static FILTER_PARAM contrastParam =
+  { 5, {"offset", "coef", "doLuma", "doChromaU", "doChromaV"} };
+
+
+SCRIPT_CREATE (contrast_script, ADMVideoContrast, contrastParam);
+
+BUILD_CREATE (contrast_create, ADMVideoContrast);
+
+char *
+ADMVideoContrast::printConf (void)
+{
+  static char buf[50];
+
+  ADM_assert (_param);
+  sprintf ((char *) buf, " contrast : %1.2f %d", _param->coef,
+	   _param->offset);
+  return buf;
+}
+
+//_______________________________________________________________
+
+ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
+				    CONFcouple * couples)
+{
+
+
+  _in = in;
+  memcpy (&_info, _in->getInfo (), sizeof (_info));
+  _info.encoding = 1;
+  //   _uncompressed=new uint8_t [3*_in->getInfo()->width*_in->getInfo()->height];
+  _uncompressed =
+    new ADMImage (_in->getInfo ()->width, _in->getInfo ()->height);
+  ADM_assert (_uncompressed);
+  _param = NULL;
+  if (couples)
+    {
+      _param = NEW (CONTRAST_PARAM);
+      GET (offset);
+      GET (coef);
+      GET (doLuma);
+      GET (doChromaU);
+      GET (doChromaV);
+    }
+  else
+    {
+      _param = NEW (CONTRAST_PARAM);
+      _param->offset = 0;
+      _param->coef = 1.0f;
+      _param->doLuma = 1;
+      _param->doChromaU = 1;
+      _param->doChromaV = 1;
+
+    }
+  buildContrastTable (_param->coef, _param->offset, _tableFlat, _tableNZ);
+
+
+}
+
+
+uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
+{
+
+  ADM_assert (_param);
+  *couples = new CONFcouple (5);
+
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+  CSET (offset);
+  CSET (coef);
+  CSET (doLuma);
+  CSET (doChromaU);
+  CSET (doChromaV);
+  return 1;
+
+}
+ADMVideoContrast::~ADMVideoContrast ()
+{
+  if (_uncompressed)
+    delete _uncompressed;
+  _uncompressed = 0;
+  DELETE (_param);
+}
+
+//
+//      Remove y and v just keep U and expand it
+//
+uint8_t
+  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
+					   uint32_t * len,
+					   ADMImage * data, uint32_t * flags)
+{
+  //uint32_t x,w;
+
+  ADM_assert (_param);
+ if(frame>= _info.nb_frames) return 0;
+
+
+  if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+    return 0;
+  *len = _info.width * _info.height + (_info.width * _info.height >> 1);
+
+  uint32_t sz = _info.width * _info.height;
+  // luma 
+  if (_param->doLuma)
+    {
+      if (!doContrast (_uncompressed->data, data->data, _tableFlat,
+		       _info.width, _info.height))
+	return 0;
+    }
+  else
+    {
+      memcpy (data->data, _uncompressed->data, sz);
+    }
+  // ______u_____________         
+
+  if (_param->doChromaU)
+    {
+      if (!doContrast (_uncompressed->data + sz, data->data + sz, _tableNZ,
+		       _info.width >> 1, _info.height >> 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data->data + sz, _uncompressed->data + sz, sz >> 2);
+    }
+
+  // ______v_____________         
+  if (_param->doChromaV)
+    {
+
+      if (!doContrast
+	  (_uncompressed->data + sz + (sz >> 2), data->data + sz + (sz >> 2),
+	   _tableNZ, _info.width >> 1, _info.height >> 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data->data + sz + (sz >> 2),
+	      _uncompressed->data + sz + (sz >> 2), sz >> 2);
+    }
+
+
+
+
+  return 1;
+}
+
+uint8_t
+buildContrastTable (float coef, int8_t off,
+		    uint8_t * tableFlat, uint8_t * tableNZ)
+{
+  float f;
+
+  for (uint32_t i = 0; i < 256; i++)
+    {
+      f = i;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+      f += off;
+      if (f < 0.)
+	f = 0.;
+      if (f > 255.)
+	f = 255.;
+      *(tableFlat + i) = (uint8_t) floor (f);
+
+      f = i;
+      f -= 128;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+
+//                                      f+=off;
+      if (f < -127.)
+	f = -127.;
+      if (f > 127.)
+	f = 127.;
+      f += 128.;
+      *(tableNZ + i) = (uint8_t) floor (f);
+    }
+  return 0;
+}
+
+uint8_t
+doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
+	    uint32_t w, uint32_t h)
+{
+
+  for (uint32_t y = h * w; y > 0; y--)
+    {
+      *out++ = table[*in++];
+    }
+
+  return 1;
+
+}
+uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
+uint8_t
+ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
+{
+  if(DIA_contrast(_in,_param))
+  {
+    buildContrastTable (_param->coef, _param->offset, _tableFlat, _tableNZ);
+    return 1;
+  }
+  return 0;
+}
+
+// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -0,0 +1,152 @@
+//
+//      Try to detect blended image
+//      Mean (C) 2005
+//      GPL v2.0
+//
+
+
+#include "config.h"
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "avi_vars.h"
+#include "math.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_FILTER
+#include "ADM_osSupport/ADM_debug.h"
+#include "ADM_video/ADM_cache.h"
+#include "ADM_filter/video_filters.h"
+
+//#include "ADM_vidCNR2_param.h"
+
+//#define SUBST 1
+
+class vidDelta:public AVDMGenericVideoStream
+{
+
+protected:
+  virtual char *printConf (void);
+  VideoCache *vidCache;
+
+
+public:
+
+                        vidDelta (AVDMGenericVideoStream * in, CONFcouple * setup);
+        virtual         ~vidDelta ();
+  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
+					 ADMImage * data, uint32_t * flags);
+  uint8_t configure (AVDMGenericVideoStream * instream);
+  virtual uint8_t getCoupledConf (CONFcouple ** couples);
+
+};
+
+static FILTER_PARAM delta_template =
+  { 0 };
+
+BUILD_CREATE (delta_create, vidDelta);
+SCRIPT_CREATE (delta_script, vidDelta, delta_template);
+
+
+/*************************************/
+uint8_t vidDelta::configure (AVDMGenericVideoStream * in)
+{
+        return 1;
+}
+/*************************************/
+char *vidDelta::printConf (void)
+{
+  static char buf[50];
+  sprintf ((char *) buf, " Delta");
+  return buf;
+}
+/*************************************/
+vidDelta::vidDelta (AVDMGenericVideoStream * in, CONFcouple * couples)
+{
+
+  _in = in;
+  memcpy (&_info, _in->getInfo (), sizeof (_info));
+  _info.encoding = 1;
+  vidCache = new VideoCache (4, in);
+  
+  
+}
+//____________________________________________________________________
+vidDelta::~vidDelta ()
+{
+
+  delete vidCache;
+  vidCache = NULL;
+
+}
+
+//______________________________________________________________
+uint8_t vidDelta::getFrameNumberNoAlloc (uint32_t frame,
+				uint32_t * len,
+				ADMImage * data, uint32_t * flags)
+{
+int w,h,page;
+ADMImage *cur,*prev,*next;
+        w=_info.width;
+        h=_info.height;
+        page=w*h;
+  if(frame>= _info.nb_frames) return 0;
+  if(!frame || frame>=_info.nb_frames-1)
+  {
+        memset(YPLANE(data),0,page);
+        memset(UPLANE(data),128,page>>2);
+        memset(VPLANE(data),128,page>>2);
+        return 1;
+  }
+  cur=vidCache->getImage (frame);
+  prev=vidCache->getImage (frame-1);
+  next=vidCache->getImage (frame+1);
+  // No chroma
+        memset(UPLANE(data),128,page>>2);
+        memset(VPLANE(data),128,page>>2);
+
+   uint8_t *c=YPLANE(cur);
+   uint8_t *p=YPLANE(prev);
+   uint8_t *n=YPLANE(next);
+   uint8_t *out=YPLANE(data);
+#define SAME_THRESH 32
+   int a,b,d,cp,cn,e;
+   for(int y=0;y<h;y++)
+        for(int x=0;x<w;x++)
+        {
+                a=*c++;
+                b=*p++;
+                e=*n++;
+                cp=abs(a-b);
+                cn=abs(a-e);
+                // Cp is the != between current and previous
+                // cn is the != between current and next
+                // We try to spo frames that are blended betwwen next & previous
+                
+                if(cp>SAME_THRESH && cn > SAME_THRESH && abs(cp-cn) < 128) *out++=255;//(cp+cn)/2;
+                        else *out++=0;
+        }
+
+
+  vidCache->unlockAll ();
+  return 1;
+}
+
+/*************************************/
+uint8_t vidDelta::getCoupledConf (CONFcouple ** couples)
+{
+
+  *couples=NULL;
+  return 1;
+}
+
+// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend_param.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-18 15:22:04 UTC (rev 3530)
@@ -30,7 +30,11 @@
 ADM_vidSRTload.cpp
 ADM_vidSRTRender.cpp
 ADM_vidCrop.cpp       
-ADM_vidEq2.cpp       
+ADM_vidEq2.cpp      
+ADM_vidContrast.cpp 
+ADM_vidDelta.cpp 
+ADM_vidUnblend.cpp 
+ADM_vidAsharp.cpp
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-18 15:22:04 UTC (rev 3530)
@@ -69,6 +69,10 @@
  ADM_vidSRTload.cpp \
  ADM_vidSRTRender.cpp \
  ADM_vidEq2.cpp \
+ ADM_vidAsharp.cpp \
+ ADM_vidContrast.cpp \
+ ADM_vidDelta.cpp  \
+ ADM_vidUnblend.cpp        \
  ADM_vidCrop.cpp       
 			
 



From mean at mail.berlios.de  Sat Aug 18 17:22:35 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 18 Aug 2007 17:22:35 +0200
Subject: [Avidemux-svn-commit] r3531 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_colorspace
Message-ID: <200708181522.l7IFMZ2R016694@sheep.berlios.de>

Author: mean
Date: 2007-08-18 17:22:35 +0200 (Sat, 18 Aug 2007)
New Revision: 3531

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_rgb16.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
Log:
[Codec] Re-enable rgb16 codec

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_rgb16.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_rgb16.cpp	2007-08-18 15:22:04 UTC (rev 3530)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_rgb16.cpp	2007-08-18 15:22:35 UTC (rev 3531)
@@ -70,8 +70,11 @@
         out->_colorspace = (ADM_colorspace)( ADM_COLOR_BGR32A| ADM_COLOR_BACKWARD);
       out->_planeStride[0] = 4 * _w;
     }
-/*        else if(len==2*xx)
-                        color->changeColorSpace(ADM_COLOR_RGB16);*/
+        else if(in->dataLength==2*xx) // RGB16
+        {
+        				out->_colorspace =(ADM_colorspace)(ADM_COLOR_RGB16 |ADM_COLOR_BACKWARD );
+                        out->_planeStride[0] = 2 * _w;
+        }
   else
     return 0;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-18 15:22:04 UTC (rev 3530)
+++ branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-18 15:22:35 UTC (rev 3531)
@@ -581,7 +581,7 @@
         dst[2]=target+((page*5)>>2);
         ddst[0]=w;
         ddst[1]=ddst[2]=w>>1;
-        if(_backward && (_colorspace==ADM_COLOR_BGR24 || _colorspace==ADM_COLOR_BGR32A || _colorspace==ADM_COLOR_RGB32A || 
+        if(_backward && (_colorspace==ADM_COLOR_BGR24 ||_colorspace==ADM_COLOR_RGB16 ||  _colorspace==ADM_COLOR_BGR32A || _colorspace==ADM_COLOR_RGB32A || 
                     _colorspace==ADM_COLOR_RGB24))
         {
                 ssrc[0]=-mul*w;



From gruntster at mail.berlios.de  Sat Aug 18 19:19:14 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 18 Aug 2007 19:19:14 +0200
Subject: [Avidemux-svn-commit] r3532 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui:
	. pics
Message-ID: <200708181719.l7IHJEpW019586@sheep.berlios.de>

Author: gruntster
Date: 2007-08-18 19:18:57 +0200 (Sat, 18 Aug 2007)
New Revision: 3532

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_input.png
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_output.png
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_separate.png
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_side.png
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_top.png
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/avidemux.qrc
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
Log:
[QT] GTK style layout for main window

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 15:22:35 UTC (rev 3531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 17:18:57 UTC (rev 3532)
@@ -70,25 +70,25 @@
 #include "ui_gui2.h"
 
 #define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
-    
+
 #define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
 #define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
 #define DECLARE_VAR(object,signal_name) {#object,signal_name},
-             
+
 #include "translation_table.h"    
 /*
     Declare the table converting widget name to our internal signal           
 */
 typedef struct adm_qt4_translation
 {
-  const char *name;
-  Action     action; 
+	const char *name;
+	Action     action; 
 };
 const adm_qt4_translation myTranslationTable[]=
 {
 #define PROCESS DECLARE_VAR
-     LIST_OF_OBJECTS
-     LIST_OF_BUTTONS
+	LIST_OF_OBJECTS
+	LIST_OF_BUTTONS
 #undef PROCESS
 };
 static Action searchTranslationTable(const char *name);
@@ -97,177 +97,166 @@
     Declare the class that will be our main window
 
 */
- class MainWindow : public QMainWindow
- {
-     Q_OBJECT
+class MainWindow : public QMainWindow
+{
+	Q_OBJECT
 
- public:
-     MainWindow();
-     Ui_MainWindow ui;
- public slots:
-     void timeChanged(int);
-     void buttonPressed(void);
-     void custom(void);
-     void toolButtonPressed(bool z);
-     void comboChanged(int z)
-     {
-        const char *source=qPrintable(sender()->objectName());
+public:
+	MainWindow();
+	Ui_MainWindow ui;
 
-        if(!strcmp(source,"comboBoxVideo"))  
-        {
-          bool b=FALSE;;
-          if(ui.comboBoxVideo->currentIndex())
-          {
-             b=TRUE;
-          }
-          ui.pushButtonVideoConf->setEnabled(b);
-          ui.pushButtonVideoFilter->setEnabled(b);
-          HandleAction (ACT_VideoCodecChanged) ;
-        }
-        else 
-          if(!strcmp(source,"comboBoxAudio"))  
-        {
-          bool b=FALSE;
-          if(ui.comboBoxAudio->currentIndex())
-          {
-             b=TRUE;
-          }
-          ui.pushButtonAudioConf->setEnabled(b);
-          ui.pushButtonAudioFilter->setEnabled(b);
-          HandleAction (ACT_AudioCodecChanged) ;
-        }else
-        if(!strcmp(source,"comboBoxPreview"))  
-        {
-          HandleAction (ACT_PreviewChanged) ;
-        }
-        
+public slots:
+	void timeChanged(int);
+	void buttonPressed(void);
+	void custom(void);
+	void toolButtonPressed(bool z);
+	void comboChanged(int z)
+	{
+		const char *source=qPrintable(sender()->objectName());
 
-        printf("From +: %s\n",source);
-     }
-      void sliderMoved(int u) 
-        {
-          if(!_upd_in_progres)
-          {
-            HandleAction (ACT_Scale) ;
-          }
-        }
-      void volumeChange( int u )
-      {
-      #ifdef HAVE_AUDIO
-      
-      if(_upd_in_progres) return;
-       _upd_in_progres++;
-       int vol;
-              vol=ui.horizontalSlider_2->value();
-              AVDM_setVolume( vol);
-       _upd_in_progres--;
-      #endif
-      }
- private slots:
-   
+		if(!strcmp(source,"comboBoxVideo"))  
+		{
+			bool b=FALSE;
+			if(ui.comboBoxVideo->currentIndex())
+			{
+				b=TRUE;
+			}
+			ui.pushButtonVideoConf->setEnabled(b);
+			ui.pushButtonVideoFilter->setEnabled(b);
+			HandleAction (ACT_VideoCodecChanged) ;
+		}
+		else if(!strcmp(source,"comboBoxAudio"))  
+		{
+			bool b=FALSE;
+			if(ui.comboBoxAudio->currentIndex())
+			{
+				b=TRUE;
+			}
+			ui.pushButtonAudioConf->setEnabled(b);
+			ui.pushButtonAudioFilter->setEnabled(b);
+			HandleAction (ACT_AudioCodecChanged) ;
+		}
+		else
+			printf("From +: %s\n",source);
+	}
 
- private:
-     
- };
+	void sliderMoved(int u) 
+	{
+		if(!_upd_in_progres)
+			HandleAction (ACT_Scale) ;
+	}
 
+	void volumeChange( int u )
+	{
+#ifdef HAVE_AUDIO
+		if(_upd_in_progres) return;
 
-MainWindow::MainWindow()     : QMainWindow()
- {
-     ui.setupUi(this);
-     /*
-        Connect our button to buttonPressed
-     */
+		_upd_in_progres++;
+
+		int vol = ui.horizontalSlider_2->value();
+
+		AVDM_setVolume(vol);
+		_upd_in_progres--;
+#endif
+	}
+
+	void previewModeChanged(QAction *action)
+	{
+		HandleAction(ACT_PreviewChanged);
+	}
+
+private slots:
+
+private:
+
+};
+
+
+MainWindow::MainWindow() : QMainWindow()
+{
+	ui.setupUi(this);
+
+	this->setStatusBar(0);
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes->addAction(ui.actionPreviewInput);
+	groupPreviewModes->addAction(ui.actionPreviewOutput);
+	groupPreviewModes->addAction(ui.actionPreviewSide);
+	groupPreviewModes->addAction(ui.actionPreviewTop);
+	groupPreviewModes->addAction(ui.actionPreviewSeparate);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
 #define PROCESS CONNECT
-     LIST_OF_OBJECTS
+	LIST_OF_OBJECTS
 #undef PROCESS
 #define PROCESS CONNECT_TB
-     LIST_OF_BUTTONS
+	LIST_OF_BUTTONS
 #undef PROCESS
-     // ComboBox
-         
-         
-         
-         //ACT_VideoCodecChanged
-         connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-         connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-         connect( ui.comboBoxPreview,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-     // Slider
-          slider=ui.horizontalSlider;
-          slider->setMinimum(0);
-          slider->setMaximum(1000);
-          connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
-          // Volume slider
-          QSlider *volSlider=ui.horizontalSlider_2;
-          
-          volSlider->setMinimum(0);
-          volSlider->setMaximum(100);
-          connect( volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-          // Add a second toolbar
-          QToolBar *toolBarMove;
-            toolBarMove = new QToolBar(this);
-            toolBarMove->setObjectName(QString::fromUtf8("toolBarMove"));
-            toolBarMove->setOrientation(Qt::Horizontal);
-            this->addToolBar(static_cast<Qt::ToolBarArea>(4), toolBarMove);
-          // And actions to it
-#define ADD(x) toolBarMove->addAction(ui.x)
-            ADD(actionPlay);
-            ADD(actionPlay_Stop);
-            ADD(actionPrevious_Frame);
-            ADD(actionNext_Frame);
-            ADD(actionPrevious_intra_frame);
-            ADD(actionNext_intra_frame);
-            ADD(actionSet_marker_A);
-            ADD(actionSet_marker_B);
-            ADD(actionPrevious_black_frame);
-            ADD(actionNext_blak_frame);
-            ADD(actionFirst_Frame);
-            ADD(actionLast_Frame);
-            ADD(actionGo_to_Marker_A);
-            ADD(actionGo_to_Marker_B);
-            //** Add shortcuts **//
-            QKeySequence seqFilter("CTRL+Alt+F");
-            ui.actionFilters->setShortcut(seqFilter);
-            // default state
-            bool b=0;
-          ui.pushButtonVideoConf->setEnabled(b);
-          ui.pushButtonVideoFilter->setEnabled(b);
-          ui.pushButtonAudioConf->setEnabled(b);
-          ui.pushButtonAudioFilter->setEnabled(b);
-          /* Time Shift */
-  connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-  connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-          
-          
-          
-          /* Build the custom menu */
-          GUI_initCustom();
-          for(int i=0;i<ADM_nbCustom;i++)
-          {
-            customActions[i]=new QAction(customNames[i],NULL);
-            ui.menuCustom->addAction(customActions[i]);
-            connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
-          }
-          printf("Menu built\n");
- }
- /**
-    \fn     custom
-    \brief  Invoked when one of the custom script has been called
- */
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider->setMinimum(0);
+	slider->setMaximum(1000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider->setMinimum(0);
+	volSlider->setMaximum(100);
+	connect( volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+
+	//** Add shortcuts **//
+	QKeySequence seqFilter("CTRL+Alt+F");
+	ui.actionFilters->setShortcut(seqFilter);
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf->setEnabled(b);
+	ui.pushButtonVideoFilter->setEnabled(b);
+	ui.pushButtonAudioConf->setEnabled(b);
+	ui.pushButtonAudioFilter->setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+
+	/* Build the custom menu */
+	GUI_initCustom();
+	for(int i=0;i<ADM_nbCustom;i++)
+	{
+		customActions[i]=new QAction(customNames[i],NULL);
+		ui.menuCustom->addAction(customActions[i]);
+		connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+	}
+	printf("Menu built\n");
+}
+/**
+\fn     custom
+\brief  Invoked when one of the custom script has been called
+*/
 void MainWindow::custom(void)
 {
-    printf("[CUSTOM] Invoked\n");
-    QObject *ptr=sender();
-    if(!ptr) return;
-    for(int i=0;i<ADM_nbCustom;i++)
-    {
-      if(customActions[i]==ptr)
-      {
-        printf("[Custom] %u/%u scrips\n",i,ADM_nbCustom);
-        HandleAction( (Action)(ACT_CUSTOM_BASE+i));
-        return; 
-      }
-    }
-    printf("[Custom] Not found\n");
+	printf("[Custom] Invoked\n");
+	QObject *ptr=sender();
+	if(!ptr) return;
+	for(int i=0;i<ADM_nbCustom;i++)
+	{
+		if(customActions[i]==ptr)
+		{
+			printf("[Custom] %u/%u scripts\n",i,ADM_nbCustom);
+			HandleAction( (Action)(ACT_CUSTOM_BASE+i));
+			return; 
+		}
+	}
+	printf("[Custom] Not found\n");
 }
 /**
     Get the custom entry 
@@ -275,8 +264,8 @@
 */
 const char * GUI_getCustomScript(uint32_t nb)
 {
-    ADM_assert(nb<ADM_nbCustom);
-    return customNames[nb];
+	ADM_assert(nb<ADM_nbCustom);
+	return customNames[nb];
 
 }
 /**
@@ -285,39 +274,39 @@
 */
 void MainWindow::timeChanged(int)
 {
-   HandleAction (ACT_TimeShift) ;
+	HandleAction (ACT_TimeShift) ;
 }
- /*
+/*
       We receive a button press event
- */
- void MainWindow::buttonPressed(void)
- {
-    // Receveid a key press Event, look into table..
-   const char *source=qPrintable(sender()->objectName());
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+	const char *source=qPrintable(sender()->objectName());
 
-    printf("Button From : %s\n",source);
-    Action action=searchTranslationTable(source);
-    if(action!=ACT_DUMMY)
-    {
-      HandleAction (action) ;
-    }
+	printf("Button From: %s\n",source);
+	Action action=searchTranslationTable(source);
 
- }
-  void MainWindow::toolButtonPressed(bool i)
-  {
-     buttonPressed();
-  }
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************
 extern int global_argc;
 extern char **global_argv;
 extern void UI_QT4VideoWidget(QFrame *frame);
+
 int UI_Init(int nargc,char **nargv)
 {
-  global_argc=nargc;
-  global_argv=nargv;
-  return 0;
+	global_argc=nargc;
+	global_argv=nargv;
+	return 0;
 }
 QWidget *QuiMainWindows=NULL;
 QGraphicsView *drawWindow=NULL;
@@ -327,54 +316,80 @@
     \fn UI_getCurrentPreview(void)
     \brief Read previewmode from comboxbox 
 */
+int UI_getCurrentPreview(void)
+{
+	int index;
 
-int    UI_getCurrentPreview(void)
-{
-  return WIDGET(comboBoxPreview)->currentIndex(); 
+	if (WIDGET(actionPreviewOutput)->isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)->isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)->isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)->isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
 }
+
 /**
     \fn UI_setCurrentPreview(int ne)
     \brief Update comboxbox with previewmode
 */
-
-void   UI_setCurrentPreview(int ne)
+void UI_setCurrentPreview(int ne)
 {
-    WIDGET(comboBoxPreview)->setCurrentIndex(ne); 
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)->setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)->setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)->setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)->setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)->setChecked(true);
+	}
 }
 
-
 /**
     \fn UI_RunApp(void)
     \brief Main entry point for the GUI application
 */
 int UI_RunApp(void)
 {
-Q_INIT_RESOURCE(avidemux);
-Q_INIT_RESOURCE(filter);
-   QApplication a( global_argc, global_argv );
-   MainWindow * mw = new MainWindow();
-    
-    a.connect( &a, SIGNAL(lastWindowClosed()), &a, SLOT(quit()) );
-    
+	Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+	QApplication a( global_argc, global_argv );
+	MainWindow * mw = new MainWindow();
+
+	a.connect( &a, SIGNAL(lastWindowClosed()), &a, SLOT(quit()) );
+
 	uint32_t w, h;
 
-	UI_getPhysicalScreenSize(&w,&h); //gtk_widget_get_parent_window (guiRootWindow));
-    printf("The screen seems to be %u x %u px\n",w,h);
+	UI_getPhysicalScreenSize(&w,&h);
+	printf("The screen seems to be %u x %u px\n",w,h);
 
-    mw->show();
-    
-    QuiMainWindows=(QWidget*)mw;
-   
-    UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
-    UI_updateRecentMenu(  );
-    setupMenus();
-    checkCrashFile();
-    
-   if (global_argc >= 2)
-    {
-     automation();
-    }
-    return a.exec();
+	mw->show();
+
+	QuiMainWindows=(QWidget*)mw;
+
+	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu(  );
+	setupMenus();
+	checkCrashFile();
+
+	if (global_argc >= 2)
+		automation();
+
+	return a.exec();
 }
 /**
     \fn searchTranslationTable(const char *name))
@@ -382,15 +397,15 @@
 */
 Action searchTranslationTable(const char *name)
 {
-  for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
-  {
-    if(!strcmp(name, myTranslationTable[i].name))
-    {
-      return  myTranslationTable[i].action;
-    }
-  }
-  printf("WARNING : Signal not found in translation table : %s\n",name);
-  return ACT_DUMMY;
+	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf("WARNING: Signal not found in translation table %s\n",name);
+	return ACT_DUMMY;
 }
 /**
     \fn     UI_updateRecentMenu( void )
@@ -398,30 +413,30 @@
 */
 uint8_t UI_updateRecentMenu( void )
 {
-const char **names;
-uint32_t nb_item=0;
-QAction *actions[4]={WIDGET(actionRecent0),WIDGET(actionRecent1),WIDGET(actionRecent2),WIDGET(actionRecent3)};
-        names=prefs->get_lastfiles();
-        
-        // hide them all
-        for(int i=0;i<4;i++) actions[i]->setVisible(0);
-        // Redraw..
-        for( nb_item=0;nb_item<4;nb_item++)
-        {
-                if(!names[nb_item]) 
-                {
-                   return 1;
-                }
-                else
-                {
-                    //actions[nb_item]->setVisible(1);
-                    // Replace widget ?
-                    actions[nb_item]->setText(names[nb_item]);
-                    actions[nb_item]->setVisible(1);
-                }
-                // Update name
-        }
-        return 1;
+	const char **names;
+	uint32_t nb_item=0;
+	QAction *actions[4]={WIDGET(actionRecent0),WIDGET(actionRecent1),WIDGET(actionRecent2),WIDGET(actionRecent3)};
+	names=prefs->get_lastfiles();
+
+	// hide them all
+	for(int i=0;i<4;i++) actions[i]->setVisible(0);
+	// Redraw..
+	for( nb_item=0;nb_item<4;nb_item++)
+	{
+		if(!names[nb_item]) 
+		{
+			return 1;
+		}
+		else
+		{
+			//actions[nb_item]->setVisible(1);
+			// Replace widget ?
+			actions[nb_item]->setText(names[nb_item]);
+			actions[nb_item]->setVisible(1);
+		}
+		// Update name
+	}
+	return 1;
 }
 /** 
   \fn    setupMenus(void)
@@ -429,62 +444,62 @@
 */
 void setupMenus(void)
 {
-        uint32_t nbVid;
-        const char *name;
+	uint32_t nbVid;
+	const char *name;
 
-                nbVid=encoderGetNbEncoder();
-                printf("Found %d video encoder\n",nbVid);
-                for(uint32_t i=1;i<nbVid;i++)
-                {
-                        name=encoderGetIndexedName(i);
-                        WIDGET(comboBoxVideo)->addItem(name);
-                }
+	nbVid=encoderGetNbEncoder();
+	printf("Found %d video encoder\n",nbVid);
+	for(uint32_t i=1;i<nbVid;i++)
+	{
+		name=encoderGetIndexedName(i);
+		WIDGET(comboBoxVideo)->addItem(name);
+	}
 
-        // And A codec
-        
-        uint32_t nbAud;
+	// And A codec
 
-                nbAud=audioFilterGetNbEncoder();
-                printf("Found %d audio encoder\n",nbAud);		       
-                for(uint32_t i=1;i<nbAud;i++)
-                {
-                        name=audioFilterGetIndexedName(i);
-                        WIDGET(comboBoxAudio)->addItem(name);
-                }
-      /*   Fill in output format window */
-        uint32_t nbFormat;
+	uint32_t nbAud;
 
-                nbFormat=sizeof(ADM_allOutputFormat)/sizeof(ADM_FORMAT_DESC);
-                printf("Found %d Format \n",nbFormat);
-                for(uint32_t i=0;i<nbFormat;i++)
-                {
-                       WIDGET(comboBoxFormat)->addItem(_(ADM_allOutputFormat[i].text));	
-                }
-        
+	nbAud=audioFilterGetNbEncoder();
+	printf("Found %d audio encoder\n",nbAud);		       
+	for(uint32_t i=1;i<nbAud;i++)
+	{
+		name=audioFilterGetIndexedName(i);
+		WIDGET(comboBoxAudio)->addItem(name);
+	}
+	/*   Fill in output format window */
+	uint32_t nbFormat;
+
+	nbFormat=sizeof(ADM_allOutputFormat)/sizeof(ADM_FORMAT_DESC);
+	printf("Found %d Format \n",nbFormat);
+	for(uint32_t i=0;i<nbFormat;i++)
+	{
+		WIDGET(comboBoxFormat)->addItem(_(ADM_allOutputFormat[i].text));	
+	}
+
 }
 /*
     Return % of scale (between 0 and 1)
 */
 double 	UI_readScale( void )
 {
-  double v;
-  if(!slider) v=0;
-  v= (double)(slider->value());
-  v/=10;
-  printf("GetScale\n");
-  return v;
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider->value());
+	v/=10;
+	printf("GetScale\n");
+	return v;
 }
 void UI_setScale( double val )
 {
-if(_upd_in_progres) return;
- _upd_in_progres++;
-   slider->setValue( (int)val*10);
- _upd_in_progres--;
-   
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider->setValue( (int)val*10);
+	_upd_in_progres--;
+
 }
 void UI_purge( void )
 {
- QCoreApplication::processEvents ();
+	QCoreApplication::processEvents ();
 }
 
 
@@ -496,12 +511,12 @@
 */
 void UI_setTitle(char *name)
 {
-      char title[1024];
+	char title[1024];
 
-      strcpy(title,"Avidemux 2 ");
-      strncat(title,name,200);
+	strcpy(title,"Avidemux 2 ");
+	strncat(title,name,200);
 
-      QuiMainWindows->setWindowTitle( title);
+	QuiMainWindows->setWindowTitle( title);
 }
 /**
     \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
@@ -510,19 +525,19 @@
 
 void UI_setFrameType( uint32_t frametype,uint32_t qp)
 {
-char string[100];
-char	c='?';
-      switch(frametype)
-      {
-              case AVI_KEY_FRAME: c='I';break;
-              case AVI_B_FRAME: c='B';break;
-              case 0: c='P';break;
-              default:c='?';break;
-      
-      }
-      sprintf(string,_("Frame:%c(%02d)"),c,qp);
-      WIDGET(label_8)->setText(string);	
+	char string[100];
+	char	c='?';
+	switch(frametype)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
 
+	}
+	sprintf(string,_("%c (%02d)"),c,qp);
+	WIDGET(label_8)->setText(string);	
+
 }
 /**
     \fn     UI_updateFrameCount(uint32_t curFrame)
@@ -531,10 +546,10 @@
 
 void UI_updateFrameCount(uint32_t curFrame)
 {
-    char string[30];
-        sprintf(string,"%lu",curFrame);
+	char string[30];
+	sprintf(string,"%lu",curFrame);
 	WIDGET(lineEdit)->setText(string);
-    
+
 }
 /**
     \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
@@ -543,14 +558,14 @@
 
 void UI_setFrameCount(uint32_t curFrame,uint32_t total)
 {
-    char text[80]; 
-    if(total) total--; // We display from 0 to X  
-    
-    UI_updateFrameCount(curFrame);
-    
-    sprintf(text, "/ %lu ", total);
-    WIDGET(label_2)->setText(text);
-    
+	char text[80]; 
+	if(total) total--; // We display from 0 to X  
+
+	UI_updateFrameCount(curFrame);
+
+	sprintf(text, "/ %lu ", total);
+	WIDGET(label_2)->setText(text);
+
 }
 /**
     \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
@@ -559,12 +574,12 @@
 
 void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
 {
- char text[80];   
- uint16_t mm,hh,ss,ms;
+	char text[80];   
+	uint16_t mm,hh,ss,ms;
 
-      frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
-      sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-      WIDGET(lineEdit_2)->setText(text);
+	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
+	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(lineEdit_2)->setText(text);
 
 }
 /**
@@ -574,15 +589,15 @@
 
 void UI_setTimeCount(uint32_t curFrame,uint32_t total, uint32_t fps)
 {
- char text[80];   
- uint16_t mm,hh,ss,ms;
+	char text[80];   
+	uint16_t mm,hh,ss,ms;
 
-        UI_updateTimeCount(curFrame,fps);
-      frame2time(total,fps, &hh, &mm, &ss, &ms);
-      sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-      WIDGET(label_7)->setText(text);
+	UI_updateTimeCount(curFrame,fps);
+	frame2time(total,fps, &hh, &mm, &ss, &ms);
+	sprintf(text, "/ %02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(label_7)->setText(text);
 #ifdef CUSTOM_SLIDER
-      slider->setNbFrames(total);
+	slider->setNbFrames(total);
 #endif
 }
 /**
@@ -590,17 +605,19 @@
     \brief  Display frame # for marker A & B
 */
 
-void UI_setMarkers(uint32_t a, uint32_t b )
+void UI_setMarkers(uint32_t a, uint32_t b)
 {
- char text[80];
-      snprintf(text,79,"%lu",a);
-      WIDGET(label_9)->setText(text);
-      snprintf(text,79,"%lu",b);
-      WIDGET(label_10)->setText(text);
-      //
+	char text[80];
+
+	snprintf(text,79,"%06lu",a);
+	WIDGET(pushButtonJumpToMarkerA)->setText(text);
+
+	snprintf(text,79,"%06lu",b);
+	WIDGET(pushButtonJumpToMarkerB)->setText(text);
+	//
 #ifdef CUSTOM_SLIDER
-      slider->setA(a);
-      slider->setB(b);
+	slider->setA(a);
+	slider->setB(b);
 #endif
 }
 /**
@@ -610,9 +627,9 @@
 
 int 	UI_getCurrentVCodec(void)
 {
-  int i=WIDGET(comboBoxVideo)->currentIndex();
-  if(i<0) i=0;
-  return i; 
+	int i=WIDGET(comboBoxVideo)->currentIndex();
+	if(i<0) i=0;
+	return i; 
 }
 /**
     \fn     UI_setVideoCodec( int i)
@@ -621,11 +638,11 @@
 
 void UI_setVideoCodec( int i)
 {
-  int b=!!i;
-    WIDGET(comboBoxVideo)->setCurrentIndex(i);
-    
-     WIDGET(pushButtonVideoConf)->setEnabled(b);
-     WIDGET(pushButtonVideoFilter)->setEnabled(b);
+	int b=!!i;
+	WIDGET(comboBoxVideo)->setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)->setEnabled(b);
+	WIDGET(pushButtonVideoFilter)->setEnabled(b);
 }
 /**
     \fn     UI_getCurrentACodec(void)
@@ -634,9 +651,9 @@
 
 int 	UI_getCurrentACodec(void)
 {
-   int i=WIDGET(comboBoxAudio)->currentIndex();
-  if(i<0) i=0;
-  return i; 
+	int i=WIDGET(comboBoxAudio)->currentIndex();
+	if(i<0) i=0;
+	return i; 
 }
 /**
     \fn     UI_setAudioCodec( int i)
@@ -645,9 +662,9 @@
 
 void UI_setAudioCodec( int i)
 { int b=!!i;
-   WIDGET(comboBoxAudio)->setCurrentIndex(i);
-    WIDGET(pushButtonAudioConf)->setEnabled(b);
-    WIDGET(pushButtonAudioFilter)->setEnabled(b);
+WIDGET(comboBoxAudio)->setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)->setEnabled(b);
+WIDGET(pushButtonAudioFilter)->setEnabled(b);
 }
 /**
     \fn     UI_GetCurrentFormat(void)
@@ -656,9 +673,9 @@
 
 ADM_OUT_FORMAT 	UI_GetCurrentFormat( void )
 {
-    int i=WIDGET(comboBoxFormat)->currentIndex();
-  if(i<0) i=0;
-  return (ADM_OUT_FORMAT)i; 
+	int i=WIDGET(comboBoxFormat)->currentIndex();
+	if(i<0) i=0;
+	return (ADM_OUT_FORMAT)i; 
 }
 /**
     \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
@@ -666,37 +683,32 @@
 */
 uint8_t 	UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
 {
-    WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
+	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
 }
-uint8_t UI_sliderResize(uint32_t w)
-{
-  printf("sliderResize %u\n",w);
-  slider->resize(w,w);
-  return 1; 
-}
+
 /**
       \fn GUI_initCustom
       \brief Initialize custom menu
 */
 void GUI_initCustom(void )
 {
-  char *customdir=ADM_getCustomDir();
-  if(!customdir) 
-  {
-      printf("No custom dir...\n");
-      return;
-  }
-  /* Collect the name */
-   if(! buildDirectoryContent(&ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,".js"))
-    {
-      printf("Failed to build custom dir content");
-      return;
-    }
-  if(!ADM_nbCustom)
-  {
-      printf("No custom script\n");
-  }
-  printf("Found %u custom scripts, adding them\n",ADM_nbCustom);
+	char *customdir=ADM_getCustomDir();
+	if(!customdir) 
+	{
+		printf("No custom dir...\n");
+		return;
+	}
+	/* Collect the name */
+	if(! buildDirectoryContent(&ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,".js"))
+	{
+		printf("Failed to build custom dir content");
+		return;
+	}
+	if(!ADM_nbCustom)
+	{
+		printf("No custom script\n");
+	}
+	printf("Found %u custom scripts, adding them\n",ADM_nbCustom);
 }
 /**
       \fn UI_getTimeShift
@@ -704,12 +716,12 @@
 */
 uint8_t UI_getTimeShift(int *onoff,int *value)
 {
-  if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
-        *onoff=1;
-  else
-        *onoff=0;
-  *value=WIDGET(spinBox_TimeValue)->value();
-  return 1;
+	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)->value();
+	return 1;
 }
 /**
       \fn UI_setTimeShift
@@ -718,12 +730,12 @@
 
 uint8_t UI_setTimeShift(int onoff,int value)
 {
-  if(onoff)
-    WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
-  else
-    WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
-  WIDGET(spinBox_TimeValue)->setValue(value);
-  return 1;
+	if(onoff)
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)->setValue(value);
+	return 1;
 }
 
 //********************************************

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-08-18 15:22:35 UTC (rev 3531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-08-18 17:18:57 UTC (rev 3532)
@@ -54,7 +54,6 @@
 extern QWidget *QuiMainWindows;
  ColYuvRgb rgbConverter(640,480,1);
 extern void UI_purge( void );
-extern uint8_t UI_sliderResize(uint32_t w);;
 
 void DIA_previewInit(uint32_t width, uint32_t height) {}
 uint8_t DIA_previewUpdate(uint8_t *data) {return 1;}
@@ -124,8 +123,7 @@
 {
    videoWindow=new ADM_Qvideo(host);
    hostFrame=host;
-   hostFrame->resize(320,200);
-   videoWindow->resize(320,200);
+   videoWindow->resize(hostFrame->size());
    videoWindow->show();
    
 }
@@ -147,8 +145,6 @@
     
 }
 
-#define ADM_RSZ(a,x,y) {a->setMinimumSize(x,y); a->resize(x,y);}
-#define ADM_RSZ_MAX(a,x,y) {a->setMinimumSize(x,y); a->setMaximumSize(x,y); a->resize(x,y);}
 /**
       \brief Resize the window
 */
@@ -157,12 +153,6 @@
 	if(displayW == w && displayH == h && rgbDataBuffer)
 		return;
 
-	QMainWindow *mainWindow = (QMainWindow*)hostFrame->parentWidget()->parentWidget();
-	QWidget *centralWidget = hostFrame->parentWidget();
-
-	uint32_t totalW = w + hostFrame->x();
-	uint32_t totalH = (mainWindow->height() - centralWidget->height()) + hostFrame->y() + h;
-
 	if(rgbDataBuffer)
 		delete[] rgbDataBuffer;
 
@@ -170,16 +160,20 @@
 	displayW = w;
 	displayH = h;
 
-	// Resize host window
-	ADM_RSZ(QuiMainWindows, totalW, totalH);
+	hostFrame->setMinimumSize(displayW, displayH);
+	videoWindow->setMinimumSize(displayW, displayH);	
 
-	// And resize child windows
-	ADM_RSZ_MAX(hostFrame, displayW, displayH);
-	ADM_RSZ_MAX(videoWindow, displayW, displayH);
+	hostFrame->resize(displayW, displayH);
+	videoWindow->resize(displayW, displayH);
 
-	UI_sliderResize(w);
 	UI_purge();
 
+	// Resize only works every second time so both calls are necessary - don't know why ???
+	QuiMainWindows->resize(1, 1);
+	UI_purge();	
+	QuiMainWindows->resize(1, 1);
+	UI_purge();
+
 	printf("[RDR] Resizing to %u x %u\n", displayW, displayH);
 }
 /**

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/avidemux.qrc
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/avidemux.qrc	2007-08-18 15:22:35 UTC (rev 3531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/avidemux.qrc	2007-08-18 17:18:57 UTC (rev 3532)
@@ -23,6 +23,11 @@
         <file>pics/player_start.png</file>
         <file>pics/player_stop.png</file>
         <file>pics/prev_black.png</file>
+        <file>pics/preview_input.png</file>
+        <file>pics/preview_output.png</file>
+        <file>pics/preview_separate.png</file>
+        <file>pics/preview_side.png</file>
+        <file>pics/preview_top.png</file>
         <file>pics/previous.png</file>
         <file>pics/project_open.png</file>
         <file>pics/thumbnail.png</file>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 15:22:35 UTC (rev 3531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 17:18:57 UTC (rev 3532)
@@ -1,27 +1,17 @@
 <ui version="4.0" >
  <author>mean</author>
+ <comment></comment>
+ <exportmacro></exportmacro>
  <class>MainWindow</class>
  <widget class="QMainWindow" name="MainWindow" >
   <property name="geometry" >
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>831</width>
-    <height>581</height>
+    <width>680</width>
+    <height>537</height>
    </rect>
   </property>
-  <property name="minimumSize" >
-   <size>
-    <width>16</width>
-    <height>16</height>
-   </size>
-  </property>
-  <property name="maximumSize" >
-   <size>
-    <width>1920</width>
-    <height>1920</height>
-   </size>
-  </property>
   <property name="windowTitle" >
    <string>Avidemux</string>
   </property>
@@ -35,33 +25,15 @@
    </size>
   </property>
   <widget class="QWidget" name="centralwidget" >
-   <layout class="QGridLayout" >
+   <layout class="QVBoxLayout" >
     <property name="margin" >
      <number>9</number>
     </property>
     <property name="spacing" >
      <number>6</number>
     </property>
-    <item row="1" column="1" >
-     <widget class="QFrame" name="frame_video" >
-      <property name="sizePolicy" >
-       <sizepolicy>
-        <hsizetype>7</hsizetype>
-        <vsizetype>7</vsizetype>
-        <horstretch>99</horstretch>
-        <verstretch>99</verstretch>
-       </sizepolicy>
-      </property>
-      <property name="frameShape" >
-       <enum>QFrame::StyledPanel</enum>
-      </property>
-      <property name="frameShadow" >
-       <enum>QFrame::Raised</enum>
-      </property>
-     </widget>
-    </item>
-    <item rowspan="2" row="0" column="0" >
-     <layout class="QVBoxLayout" >
+    <item>
+     <layout class="QHBoxLayout" >
       <property name="margin" >
        <number>0</number>
       </property>
@@ -74,34 +46,10 @@
          <number>0</number>
         </property>
         <property name="spacing" >
-         <number>0</number>
+         <number>6</number>
         </property>
         <item>
-         <widget class="QLabel" name="label_3" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>5</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize" >
-           <size>
-            <width>180</width>
-            <height>16777215</height>
-           </size>
-          </property>
-          <property name="text" >
-           <string>&lt;b>Video&lt;/b></string>
-          </property>
-          <property name="textFormat" >
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" >
+         <layout class="QVBoxLayout" >
           <property name="margin" >
            <number>0</number>
           </property>
@@ -109,216 +57,216 @@
            <number>0</number>
           </property>
           <item>
+           <widget class="QLabel" name="label_3" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>5</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="maximumSize" >
+             <size>
+              <width>180</width>
+              <height>16777215</height>
+             </size>
+            </property>
+            <property name="text" >
+             <string>&lt;b>Video&lt;/b></string>
+            </property>
+            <property name="textFormat" >
+             <enum>Qt::AutoText</enum>
+            </property>
+           </widget>
+          </item>
+          <item>
            <spacer>
             <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
             <property name="sizeType" >
              <enum>QSizePolicy::Fixed</enum>
             </property>
             <property name="sizeHint" >
              <size>
-              <width>12</width>
-              <height>0</height>
+              <width>20</width>
+              <height>5</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <layout class="QVBoxLayout" >
+           <layout class="QHBoxLayout" >
             <property name="margin" >
              <number>0</number>
             </property>
             <property name="spacing" >
-             <number>6</number>
+             <number>0</number>
             </property>
             <item>
-             <widget class="QComboBox" name="comboBoxVideo" >
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
               </property>
-              <item>
-               <property name="text" >
-                <string>Copy</string>
-               </property>
-              </item>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonVideoConf" >
-              <property name="enabled" >
-               <bool>true</bool>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
               </property>
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
+              <property name="sizeHint" >
+               <size>
+                <width>12</width>
+                <height>0</height>
+               </size>
               </property>
-              <property name="text" >
-               <string>Configure</string>
-              </property>
-              <property name="checkable" >
-               <bool>false</bool>
-              </property>
-             </widget>
+             </spacer>
             </item>
             <item>
-             <widget class="QPushButton" name="pushButtonVideoFilter" >
-              <property name="enabled" >
-               <bool>true</bool>
+             <layout class="QVBoxLayout" >
+              <property name="margin" >
+               <number>0</number>
               </property>
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>5</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
+              <property name="spacing" >
+               <number>6</number>
               </property>
-              <property name="text" >
-               <string>Filters</string>
-              </property>
-             </widget>
+              <item>
+               <widget class="QComboBox" name="comboBoxVideo" >
+                <property name="sizePolicy" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>Copy</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <widget class="QPushButton" name="pushButtonVideoConf" >
+                <property name="enabled" >
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="text" >
+                 <string>Configure</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QPushButton" name="pushButtonVideoFilter" >
+                <property name="enabled" >
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="text" >
+                 <string>Filters</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
             </item>
            </layout>
           </item>
-         </layout>
-        </item>
-        <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType" >
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>1</width>
-            <height>9</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_5" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>4</hsizetype>
-            <vsizetype>1</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize" >
-           <size>
-            <width>180</width>
-            <height>16777215</height>
-           </size>
-          </property>
-          <property name="text" >
-           <string>&lt;b>Audio&lt;/b></string>
-          </property>
-          <property name="textFormat" >
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" >
-          <property name="margin" >
-           <number>0</number>
-          </property>
-          <property name="spacing" >
-           <number>0</number>
-          </property>
           <item>
            <spacer>
             <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
             <property name="sizeType" >
              <enum>QSizePolicy::Fixed</enum>
             </property>
             <property name="sizeHint" >
              <size>
-              <width>12</width>
-              <height>0</height>
+              <width>1</width>
+              <height>14</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <layout class="QVBoxLayout" >
+           <widget class="QLabel" name="label_5" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>5</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="maximumSize" >
+             <size>
+              <width>180</width>
+              <height>16777215</height>
+             </size>
+            </property>
+            <property name="text" >
+             <string>&lt;b>Audio&lt;/b></string>
+            </property>
+            <property name="textFormat" >
+             <enum>Qt::AutoText</enum>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Vertical</enum>
+            </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>5</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" >
             <property name="margin" >
              <number>0</number>
             </property>
             <property name="spacing" >
-             <number>6</number>
+             <number>0</number>
             </property>
             <item>
-             <widget class="QComboBox" name="comboBoxAudio" >
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
               </property>
-              <item>
-               <property name="text" >
-                <string>Copy</string>
-               </property>
-              </item>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonAudioConf" >
-              <property name="enabled" >
-               <bool>true</bool>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
               </property>
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
+              <property name="sizeHint" >
+               <size>
+                <width>12</width>
+                <height>0</height>
+               </size>
               </property>
-              <property name="text" >
-               <string>Configure</string>
-              </property>
-             </widget>
+             </spacer>
             </item>
             <item>
-             <widget class="QPushButton" name="pushButtonAudioFilter" >
-              <property name="enabled" >
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy" >
-               <sizepolicy>
-                <hsizetype>1</hsizetype>
-                <vsizetype>0</vsizetype>
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text" >
-               <string>Filters</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <layout class="QHBoxLayout" >
+             <layout class="QVBoxLayout" >
               <property name="margin" >
                <number>0</number>
               </property>
@@ -326,14 +274,45 @@
                <number>6</number>
               </property>
               <item>
-               <widget class="QCheckBox" name="checkBox_TimeShift" >
+               <widget class="QComboBox" name="comboBoxAudio" >
+                <property name="sizePolicy" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <item>
+                 <property name="text" >
+                  <string>Copy</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <widget class="QPushButton" name="pushButtonAudioConf" >
+                <property name="enabled" >
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy" >
+                 <sizepolicy>
+                  <hsizetype>1</hsizetype>
+                  <vsizetype>0</vsizetype>
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
                 <property name="text" >
-                 <string>&amp;Shift:</string>
+                 <string>Configure</string>
                 </property>
                </widget>
               </item>
               <item>
-               <widget class="QSpinBox" name="spinBox_TimeValue" >
+               <widget class="QPushButton" name="pushButtonAudioFilter" >
+                <property name="enabled" >
+                 <bool>true</bool>
+                </property>
                 <property name="sizePolicy" >
                  <sizepolicy>
                   <hsizetype>1</hsizetype>
@@ -342,137 +321,228 @@
                   <verstretch>0</verstretch>
                  </sizepolicy>
                 </property>
-                <property name="maximum" >
-                 <number>99999</number>
+                <property name="text" >
+                 <string>Filters</string>
                 </property>
-                <property name="minimum" >
-                 <number>-99999</number>
-                </property>
                </widget>
               </item>
+              <item>
+               <layout class="QHBoxLayout" >
+                <property name="margin" >
+                 <number>0</number>
+                </property>
+                <property name="spacing" >
+                 <number>6</number>
+                </property>
+                <item>
+                 <widget class="QCheckBox" name="checkBox_TimeShift" >
+                  <property name="text" >
+                   <string>&amp;Shift:</string>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QSpinBox" name="spinBox_TimeValue" >
+                  <property name="sizePolicy" >
+                   <sizepolicy>
+                    <hsizetype>1</hsizetype>
+                    <vsizetype>0</vsizetype>
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="maximum" >
+                   <number>99999</number>
+                  </property>
+                  <property name="minimum" >
+                   <number>-99999</number>
+                  </property>
+                 </widget>
+                </item>
+               </layout>
+              </item>
              </layout>
             </item>
            </layout>
           </item>
-         </layout>
-        </item>
-        <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType" >
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>1</width>
-            <height>9</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_4" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="text" >
-           <string>&lt;b>Format&lt;/b></string>
-          </property>
-          <property name="textFormat" >
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" >
-          <property name="margin" >
-           <number>0</number>
-          </property>
-          <property name="spacing" >
-           <number>0</number>
-          </property>
           <item>
            <spacer>
             <property name="orientation" >
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
             <property name="sizeType" >
              <enum>QSizePolicy::Fixed</enum>
             </property>
             <property name="sizeHint" >
              <size>
-              <width>12</width>
-              <height>1</height>
+              <width>1</width>
+              <height>14</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <widget class="QComboBox" name="comboBoxFormat" >
+           <widget class="QLabel" name="label_4" >
             <property name="sizePolicy" >
              <sizepolicy>
-              <hsizetype>1</hsizetype>
-              <vsizetype>0</vsizetype>
+              <hsizetype>5</hsizetype>
+              <vsizetype>5</vsizetype>
               <horstretch>0</horstretch>
               <verstretch>0</verstretch>
              </sizepolicy>
             </property>
+            <property name="text" >
+             <string>&lt;b>Format&lt;/b></string>
+            </property>
+            <property name="textFormat" >
+             <enum>Qt::AutoText</enum>
+            </property>
            </widget>
           </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Vertical</enum>
+            </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>5</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" >
+            <property name="margin" >
+             <number>0</number>
+            </property>
+            <property name="spacing" >
+             <number>0</number>
+            </property>
+            <item>
+             <spacer>
+              <property name="orientation" >
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType" >
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" >
+               <size>
+                <width>12</width>
+                <height>1</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+            <item>
+             <widget class="QComboBox" name="comboBoxFormat" >
+              <property name="sizePolicy" >
+               <sizepolicy>
+                <hsizetype>1</hsizetype>
+                <vsizetype>0</vsizetype>
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Vertical</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>10</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
          </layout>
         </item>
+       </layout>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" >
+        <property name="margin" >
+         <number>0</number>
+        </property>
+        <property name="spacing" >
+         <number>6</number>
+        </property>
         <item>
+         <widget class="QFrame" name="frame_video" >
+          <property name="sizePolicy" >
+           <sizepolicy>
+            <hsizetype>7</hsizetype>
+            <vsizetype>7</vsizetype>
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="minimumSize" >
+           <size>
+            <width>100</width>
+            <height>100</height>
+           </size>
+          </property>
+          <property name="autoFillBackground" >
+           <bool>false</bool>
+          </property>
+          <property name="frameShape" >
+           <enum>QFrame::NoFrame</enum>
+          </property>
+          <property name="frameShadow" >
+           <enum>QFrame::Raised</enum>
+          </property>
+          <property name="lineWidth" >
+           <number>0</number>
+          </property>
+         </widget>
+        </item>
+        <item>
          <spacer>
           <property name="orientation" >
-           <enum>Qt::Vertical</enum>
+           <enum>Qt::Horizontal</enum>
           </property>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Expanding</enum>
+          </property>
           <property name="sizeHint" >
            <size>
-            <width>20</width>
-            <height>0</height>
+            <width>1</width>
+            <height>20</height>
            </size>
           </property>
          </spacer>
         </item>
        </layout>
       </item>
-      <item>
-       <spacer>
-        <property name="orientation" >
-         <enum>Qt::Vertical</enum>
-        </property>
-        <property name="sizeHint" >
-         <size>
-          <width>20</width>
-          <height>40</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
      </layout>
     </item>
-    <item row="0" column="2" >
+    <item>
      <spacer>
       <property name="orientation" >
-       <enum>Qt::Horizontal</enum>
+       <enum>Qt::Vertical</enum>
       </property>
       <property name="sizeHint" >
        <size>
-        <width>40</width>
-        <height>20</height>
+        <width>20</width>
+        <height>16777215</height>
        </size>
       </property>
      </spacer>
     </item>
-    <item row="0" column="1" >
-     <layout class="QVBoxLayout" >
+    <item>
+     <layout class="QHBoxLayout" >
       <property name="margin" >
        <number>0</number>
       </property>
@@ -480,7 +550,7 @@
        <number>6</number>
       </property>
       <item>
-       <layout class="QHBoxLayout" >
+       <layout class="QVBoxLayout" >
         <property name="margin" >
          <number>0</number>
         </property>
@@ -488,145 +558,547 @@
          <number>6</number>
         </property>
         <item>
-         <widget class="QLabel" name="label" >
+         <widget class="ADM_QSlider" name="horizontalSlider" >
           <property name="sizePolicy" >
            <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+            <hsizetype>7</hsizetype>
+            <vsizetype>1</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
           </property>
-          <property name="text" >
-           <string>Frame:</string>
+          <property name="orientation" >
+           <enum>Qt::Horizontal</enum>
           </property>
          </widget>
         </item>
         <item>
-         <widget class="QLineEdit" name="lineEdit" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>0</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Vertical</enum>
           </property>
-          <property name="minimumSize" >
-           <size>
-            <width>72</width>
-            <height>0</height>
-           </size>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
           </property>
-          <property name="baseSize" >
+          <property name="sizeHint" >
            <size>
-            <width>0</width>
-            <height>0</height>
+            <width>599</width>
+            <height>4</height>
            </size>
           </property>
-          <property name="echoMode" >
-           <enum>QLineEdit::Normal</enum>
-          </property>
-          <property name="cursorPosition" >
-           <number>0</number>
-          </property>
-         </widget>
+         </spacer>
         </item>
         <item>
-         <widget class="QLabel" name="label_2" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
           </property>
-          <property name="text" >
-           <string>/00000000</string>
+          <property name="spacing" >
+           <number>6</number>
           </property>
-         </widget>
+          <item>
+           <widget class="QToolButton" name="toolButtonPlay" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_play.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonStop" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_stop.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/back.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/forward.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousIntraFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_rew.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextIntraFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_fwd.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonSetMarkerA" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markA.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonSetMarkerB" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markB.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousBlackFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/prev_black.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextBlackFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/next_black.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonFirstFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_start.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonLastFrame" >
+            <property name="text" >
+             <string>...</string>
+            </property>
+            <property name="icon" >
+             <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_end.png</iconset>
+            </property>
+            <property name="iconSize" >
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise" >
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
         </item>
         <item>
-         <widget class="QLabel" name="label_6" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Vertical</enum>
           </property>
-          <property name="text" >
-           <string>Time:</string>
+          <property name="sizeType" >
+           <enum>QSizePolicy::Fixed</enum>
           </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QLineEdit" name="lineEdit_2" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>0</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize" >
+          <property name="sizeHint" >
            <size>
-            <width>90</width>
-            <height>0</height>
+            <width>599</width>
+            <height>2</height>
            </size>
           </property>
-         </widget>
+         </spacer>
         </item>
         <item>
-         <widget class="QLabel" name="label_7" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+         <layout class="QHBoxLayout" >
+          <property name="margin" >
+           <number>0</number>
           </property>
-          <property name="text" >
-           <string>/00:00:00.000</string>
+          <property name="spacing" >
+           <number>6</number>
           </property>
-         </widget>
+          <item>
+           <widget class="QLabel" name="label" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="font" >
+             <font>
+              <family>MS Shell Dlg 2</family>
+              <pointsize>8</pointsize>
+              <weight>75</weight>
+              <italic>false</italic>
+              <bold>true</bold>
+              <underline>false</underline>
+              <strikeout>false</strikeout>
+             </font>
+            </property>
+            <property name="text" >
+             <string>Frame:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLineEdit" name="lineEdit" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>0</hsizetype>
+              <vsizetype>0</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="maximumSize" >
+             <size>
+              <width>54</width>
+              <height>16777215</height>
+             </size>
+            </property>
+            <property name="baseSize" >
+             <size>
+              <width>0</width>
+              <height>0</height>
+             </size>
+            </property>
+            <property name="maxLength" >
+             <number>8</number>
+            </property>
+            <property name="echoMode" >
+             <enum>QLineEdit::Normal</enum>
+            </property>
+            <property name="cursorPosition" >
+             <number>0</number>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_2" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="text" >
+             <string>/ 0</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_6" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="font" >
+             <font>
+              <family>MS Shell Dlg 2</family>
+              <pointsize>8</pointsize>
+              <weight>75</weight>
+              <italic>false</italic>
+              <bold>true</bold>
+              <underline>false</underline>
+              <strikeout>false</strikeout>
+             </font>
+            </property>
+            <property name="text" >
+             <string>Time:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLineEdit" name="lineEdit_2" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>0</hsizetype>
+              <vsizetype>0</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="maximumSize" >
+             <size>
+              <width>84</width>
+              <height>16777215</height>
+             </size>
+            </property>
+            <property name="maxLength" >
+             <number>12</number>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_7" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="text" >
+             <string>/ 00:00:00.000</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType" >
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>20</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_14" >
+            <property name="font" >
+             <font>
+              <family>MS Shell Dlg 2</family>
+              <pointsize>8</pointsize>
+              <weight>75</weight>
+              <italic>false</italic>
+              <bold>true</bold>
+              <underline>false</underline>
+              <strikeout>false</strikeout>
+             </font>
+            </property>
+            <property name="text" >
+             <string>Frame Type:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_8" >
+            <property name="sizePolicy" >
+             <sizepolicy>
+              <hsizetype>1</hsizetype>
+              <vsizetype>5</vsizetype>
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="text" >
+             <string>?</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation" >
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" >
+             <size>
+              <width>60</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
         </item>
-        <item>
-         <widget class="QLabel" name="label_8" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="text" >
-           <string>Frame: ?</string>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Horizontal</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>40</width>
-            <height>20</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
        </layout>
       </item>
       <item>
-       <layout class="QHBoxLayout" >
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Horizontal</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>14</width>
+          <height>95</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
         <property name="margin" >
          <number>0</number>
         </property>
@@ -634,159 +1106,240 @@
          <number>6</number>
         </property>
         <item>
-         <widget class="QLabel" name="label_12" >
-          <property name="text" >
-           <string> A:</string>
+         <spacer>
+          <property name="orientation" >
+           <enum>Qt::Vertical</enum>
           </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_9" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+          <property name="sizeType" >
+           <enum>QSizePolicy::MinimumExpanding</enum>
           </property>
-          <property name="text" >
-           <string>0000000</string>
+          <property name="sizeHint" >
+           <size>
+            <width>20</width>
+            <height>5</height>
+           </size>
           </property>
-         </widget>
+         </spacer>
         </item>
         <item>
-         <widget class="QLabel" name="label_11" >
-          <property name="text" >
-           <string> B:</string>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_10" >
+         <widget class="QGroupBox" name="groupBox" >
           <property name="sizePolicy" >
            <sizepolicy>
             <hsizetype>1</hsizetype>
-            <vsizetype>5</vsizetype>
+            <vsizetype>1</vsizetype>
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
           </property>
-          <property name="text" >
-           <string>0000000</string>
+          <property name="minimumSize" >
+           <size>
+            <width>116</width>
+            <height>80</height>
+           </size>
           </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QToolButton" name="toolButton" >
-          <property name="enabled" >
-           <bool>false</bool>
+          <property name="font" >
+           <font>
+            <family>MS Shell Dlg 2</family>
+            <pointsize>8</pointsize>
+            <weight>75</weight>
+            <italic>false</italic>
+            <bold>true</bold>
+            <underline>false</underline>
+            <strikeout>false</strikeout>
+           </font>
           </property>
-          <property name="text" >
-           <string>...</string>
+          <property name="title" >
+           <string>Selection</string>
           </property>
-          <property name="icon" >
-           <iconset resource="avidemux.qrc" >:/new/prefix1/pics/arts.png</iconset>
+          <property name="alignment" >
+           <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
           </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QSlider" name="horizontalSlider_2" >
-          <property name="sizePolicy" >
-           <sizepolicy>
-            <hsizetype>4</hsizetype>
-            <vsizetype>0</vsizetype>
-            <horstretch>1</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="baseSize" >
-           <size>
-            <width>60</width>
-            <height>0</height>
-           </size>
-          </property>
-          <property name="orientation" >
-           <enum>Qt::Horizontal</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QComboBox" name="comboBoxPreview" >
-          <item>
-           <property name="text" >
-            <string>Input</string>
+          <widget class="QLabel" name="label_11" >
+           <property name="geometry" >
+            <rect>
+             <x>10</x>
+             <y>50</y>
+             <width>16</width>
+             <height>23</height>
+            </rect>
            </property>
-          </item>
-          <item>
+           <property name="font" >
+            <font>
+             <family>MS Shell Dlg 2</family>
+             <pointsize>8</pointsize>
+             <weight>50</weight>
+             <italic>false</italic>
+             <bold>false</bold>
+             <underline>false</underline>
+             <strikeout>false</strikeout>
+            </font>
+           </property>
            <property name="text" >
-            <string>Output</string>
+            <string> B:</string>
            </property>
-          </item>
-          <item>
+          </widget>
+          <widget class="QLabel" name="label_12" >
+           <property name="geometry" >
+            <rect>
+             <x>10</x>
+             <y>20</y>
+             <width>16</width>
+             <height>23</height>
+            </rect>
+           </property>
+           <property name="font" >
+            <font>
+             <family>MS Shell Dlg 2</family>
+             <pointsize>8</pointsize>
+             <weight>50</weight>
+             <italic>false</italic>
+             <bold>false</bold>
+             <underline>false</underline>
+             <strikeout>false</strikeout>
+            </font>
+           </property>
            <property name="text" >
-            <string>Side</string>
+            <string> A:</string>
            </property>
-          </item>
-          <item>
+          </widget>
+          <widget class="QPushButton" name="pushButtonJumpToMarkerA" >
+           <property name="geometry" >
+            <rect>
+             <x>30</x>
+             <y>20</y>
+             <width>75</width>
+             <height>23</height>
+            </rect>
+           </property>
+           <property name="sizePolicy" >
+            <sizepolicy>
+             <hsizetype>1</hsizetype>
+             <vsizetype>0</vsizetype>
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="font" >
+            <font>
+             <family>MS Shell Dlg 2</family>
+             <pointsize>8</pointsize>
+             <weight>50</weight>
+             <italic>false</italic>
+             <bold>false</bold>
+             <underline>false</underline>
+             <strikeout>false</strikeout>
+            </font>
+           </property>
            <property name="text" >
-            <string>Top</string>
+            <string>000000</string>
            </property>
-          </item>
-          <item>
+          </widget>
+          <widget class="QPushButton" name="pushButtonJumpToMarkerB" >
+           <property name="geometry" >
+            <rect>
+             <x>30</x>
+             <y>50</y>
+             <width>75</width>
+             <height>23</height>
+            </rect>
+           </property>
+           <property name="sizePolicy" >
+            <sizepolicy>
+             <hsizetype>1</hsizetype>
+             <vsizetype>0</vsizetype>
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="font" >
+            <font>
+             <family>MS Shell Dlg 2</family>
+             <pointsize>8</pointsize>
+             <weight>50</weight>
+             <italic>false</italic>
+             <bold>false</bold>
+             <underline>false</underline>
+             <strikeout>false</strikeout>
+            </font>
+           </property>
+           <property name="layoutDirection" >
+            <enum>Qt::LeftToRight</enum>
+           </property>
            <property name="text" >
-            <string>Separate</string>
+            <string>000000</string>
            </property>
-          </item>
+          </widget>
          </widget>
         </item>
-        <item>
-         <spacer>
-          <property name="orientation" >
-           <enum>Qt::Horizontal</enum>
-          </property>
-          <property name="sizeHint" >
-           <size>
-            <width>40</width>
-            <height>20</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
        </layout>
       </item>
       <item>
-       <layout class="QHBoxLayout" >
+       <spacer>
+        <property name="orientation" >
+         <enum>Qt::Horizontal</enum>
+        </property>
+        <property name="sizeType" >
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" >
+         <size>
+          <width>14</width>
+          <height>95</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" >
         <property name="margin" >
          <number>0</number>
         </property>
         <property name="spacing" >
-         <number>6</number>
+         <number>4</number>
         </property>
         <item>
-         <widget class="ADM_QSlider" name="horizontalSlider" >
+         <widget class="QToolButton" name="toolButtonAudioToggle" >
+          <property name="enabled" >
+           <bool>true</bool>
+          </property>
+          <property name="text" >
+           <string>...</string>
+          </property>
+          <property name="icon" >
+           <iconset resource="avidemux.qrc" >:/new/prefix1/pics/arts.png</iconset>
+          </property>
+          <property name="checkable" >
+           <bool>true</bool>
+          </property>
+          <property name="checked" >
+           <bool>true</bool>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSlider" name="horizontalSlider_2" >
           <property name="sizePolicy" >
            <sizepolicy>
-            <hsizetype>7</hsizetype>
-            <vsizetype>0</vsizetype>
-            <horstretch>5</horstretch>
+            <hsizetype>5</hsizetype>
+            <vsizetype>1</vsizetype>
+            <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
           </property>
           <property name="maximumSize" >
            <size>
-            <width>1200</width>
-            <height>16777215</height>
+            <width>16777215</width>
+            <height>64</height>
            </size>
           </property>
-          <property name="sizeIncrement" >
-           <size>
-            <width>10</width>
-            <height>0</height>
-           </size>
+          <property name="maximum" >
+           <number>100</number>
           </property>
+          <property name="value" >
+           <number>100</number>
+          </property>
           <property name="orientation" >
-           <enum>Qt::Horizontal</enum>
+           <enum>Qt::Vertical</enum>
           </property>
          </widget>
         </item>
@@ -794,45 +1347,6 @@
       </item>
      </layout>
     </item>
-    <item row="2" column="1" >
-     <spacer>
-      <property name="orientation" >
-       <enum>Qt::Vertical</enum>
-      </property>
-      <property name="sizeHint" >
-       <size>
-        <width>20</width>
-        <height>40</height>
-       </size>
-      </property>
-     </spacer>
-    </item>
-    <item row="2" column="0" >
-     <spacer>
-      <property name="orientation" >
-       <enum>Qt::Vertical</enum>
-      </property>
-      <property name="sizeHint" >
-       <size>
-        <width>20</width>
-        <height>40</height>
-       </size>
-      </property>
-     </spacer>
-    </item>
-    <item row="1" column="2" >
-     <spacer>
-      <property name="orientation" >
-       <enum>Qt::Horizontal</enum>
-      </property>
-      <property name="sizeHint" >
-       <size>
-        <width>40</width>
-        <height>20</height>
-       </size>
-      </property>
-     </spacer>
-    </item>
    </layout>
   </widget>
   <widget class="QMenuBar" name="menubar" >
@@ -840,17 +1354,10 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>831</width>
-     <height>29</height>
+     <width>680</width>
+     <height>23</height>
     </rect>
    </property>
-   <widget class="QMenu" name="menuHelp" >
-    <property name="title" >
-     <string>Help</string>
-    </property>
-    <addaction name="actionShow_built_in_support" />
-    <addaction name="actionAbout_avidemux" />
-   </widget>
    <widget class="QMenu" name="menuFile" >
     <property name="title" >
      <string>File</string>
@@ -890,42 +1397,21 @@
     <addaction name="actionQuit" />
     <addaction name="separator" />
    </widget>
-   <widget class="QMenu" name="menuEdit" >
+   <widget class="QMenu" name="menuTools" >
     <property name="title" >
-     <string>Edit</string>
+     <string>Tools</string>
     </property>
-    <addaction name="actionReset_Edits" />
+    <addaction name="actionCalculator" />
     <addaction name="separator" />
-    <addaction name="actionCut" />
-    <addaction name="actionCopy" />
-    <addaction name="actionPaste" />
-    <addaction name="actionDelete" />
+    <addaction name="actionRebuild_I_B_Frames" />
+    <addaction name="actionBitrate_histogram" />
+    <addaction name="actionScan_for_black_frames" />
     <addaction name="separator" />
-    <addaction name="actionSet_marker_A" />
-    <addaction name="actionSet_marker_B" />
-    <addaction name="separator" />
-    <addaction name="actionPreferences" />
+    <addaction name="actionVob_to_vobsub" />
+    <addaction name="actionOCR" />
+    <addaction name="actionOCR_DVB_T_TS_files" />
+    <addaction name="actionGlyphs_Edit" />
    </widget>
-   <widget class="QMenu" name="menuVideo" >
-    <property name="title" >
-     <string>Video</string>
-    </property>
-    <addaction name="actionDecoder_options" />
-    <addaction name="actionPostprocessing" />
-    <addaction name="separator" />
-    <addaction name="actionFilters" />
-    <addaction name="actionFrame_rate" />
-   </widget>
-   <widget class="QMenu" name="menuAudio" >
-    <property name="title" >
-     <string>Audio</string>
-    </property>
-    <addaction name="actionMain_Track" />
-    <addaction name="actionSecondary_Track" />
-    <addaction name="actionBuild_VBR_time_map" />
-    <addaction name="actionSave_2" />
-    <addaction name="actionFilters_2" />
-   </widget>
    <widget class="QMenu" name="menuAuto" >
     <property name="title" >
      <string>Auto</string>
@@ -959,20 +1445,12 @@
      <string>Custom</string>
     </property>
    </widget>
-   <widget class="QMenu" name="menuTools" >
+   <widget class="QMenu" name="menuHelp" >
     <property name="title" >
-     <string>Tools</string>
+     <string>Help</string>
     </property>
-    <addaction name="actionCalculator" />
-    <addaction name="separator" />
-    <addaction name="actionRebuild_I_B_Frames" />
-    <addaction name="actionBitrate_histogram" />
-    <addaction name="actionScan_for_black_frames" />
-    <addaction name="separator" />
-    <addaction name="actionVob_to_vobsub" />
-    <addaction name="actionOCR" />
-    <addaction name="actionOCR_DVB_T_TS_files" />
-    <addaction name="actionGlyphs_Edit" />
+    <addaction name="actionShow_built_in_support" />
+    <addaction name="actionAbout_avidemux" />
    </widget>
    <widget class="QMenu" name="menuView" >
     <property name="title" >
@@ -983,6 +1461,42 @@
     <addaction name="actionZoom_1_1" />
     <addaction name="actionZoom_2_1" />
    </widget>
+   <widget class="QMenu" name="menuEdit" >
+    <property name="title" >
+     <string>Edit</string>
+    </property>
+    <addaction name="actionReset_Edits" />
+    <addaction name="separator" />
+    <addaction name="actionCut" />
+    <addaction name="actionCopy" />
+    <addaction name="actionPaste" />
+    <addaction name="actionDelete" />
+    <addaction name="separator" />
+    <addaction name="actionSet_marker_A" />
+    <addaction name="actionSet_marker_B" />
+    <addaction name="separator" />
+    <addaction name="actionPreferences" />
+   </widget>
+   <widget class="QMenu" name="menuVideo" >
+    <property name="title" >
+     <string>Video</string>
+    </property>
+    <addaction name="actionDecoder_options" />
+    <addaction name="actionPostprocessing" />
+    <addaction name="separator" />
+    <addaction name="actionFilters" />
+    <addaction name="actionFrame_rate" />
+   </widget>
+   <widget class="QMenu" name="menuAudio" >
+    <property name="title" >
+     <string>Audio</string>
+    </property>
+    <addaction name="actionMain_Track" />
+    <addaction name="actionSecondary_Track" />
+    <addaction name="actionBuild_VBR_time_map" />
+    <addaction name="actionSave_2" />
+    <addaction name="actionFilters_2" />
+   </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
    <addaction name="menuView" />
@@ -1011,8 +1525,20 @@
    <addaction name="actionSave_project" />
    <addaction name="separator" />
    <addaction name="actionCalculator" />
-   <addaction name="separator" />
   </widget>
+  <widget class="QToolBar" name="toolBar_2" >
+   <property name="orientation" >
+    <enum>Qt::Horizontal</enum>
+   </property>
+   <attribute name="toolBarArea" >
+    <number>4</number>
+   </attribute>
+   <addaction name="actionPreviewInput" />
+   <addaction name="actionPreviewOutput" />
+   <addaction name="actionPreviewSide" />
+   <addaction name="actionPreviewTop" />
+   <addaction name="actionPreviewSeparate" />
+  </widget>
   <action name="actionOpen" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/fileopen.png</iconset>
@@ -1167,22 +1693,6 @@
     <string>Postprocessing</string>
    </property>
   </action>
-  <action name="actionPreview" >
-   <property name="icon" >
-    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/thumbnail.png</iconset>
-   </property>
-   <property name="text" >
-    <string>Preview</string>
-   </property>
-  </action>
-  <action name="actionDisplay_output" >
-   <property name="icon" >
-    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/add_sub_task.png</iconset>
-   </property>
-   <property name="text" >
-    <string>Display output</string>
-   </property>
-  </action>
   <action name="actionFrame_rate" >
    <property name="text" >
     <string>Frame rate</string>
@@ -1197,6 +1707,9 @@
    <property name="text" >
     <string>Filters</string>
    </property>
+   <property name="shortcut" >
+    <string/>
+   </property>
   </action>
   <action name="actionMain_Track" >
    <property name="text" >
@@ -1227,6 +1740,15 @@
    <property name="text" >
     <string>Filters</string>
    </property>
+   <property name="iconText" >
+    <string>Filters</string>
+   </property>
+   <property name="toolTip" >
+    <string>Filters</string>
+   </property>
+   <property name="shortcut" >
+    <string/>
+   </property>
   </action>
   <action name="actionCalculator" >
    <property name="icon" >
@@ -1457,12 +1979,73 @@
     <string>Glyphs Edit</string>
    </property>
   </action>
+  <action name="actionPreviewInput" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="checked" >
+    <bool>true</bool>
+   </property>
+   <property name="icon" >
+    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_input.png</iconset>
+   </property>
+   <property name="text" >
+    <string>Input</string>
+   </property>
+  </action>
+  <action name="actionPreviewOutput" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="icon" >
+    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_output.png</iconset>
+   </property>
+   <property name="text" >
+    <string>Output</string>
+   </property>
+  </action>
+  <action name="actionPreviewSide" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="icon" >
+    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_side.png</iconset>
+   </property>
+   <property name="text" >
+    <string>Side</string>
+   </property>
+  </action>
+  <action name="actionPreviewTop" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="icon" >
+    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_top.png</iconset>
+   </property>
+   <property name="text" >
+    <string>Top</string>
+   </property>
+  </action>
+  <action name="actionPreviewSeparate" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="icon" >
+    <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_separate.png</iconset>
+   </property>
+   <property name="text" >
+    <string>Separate</string>
+   </property>
+  </action>
  </widget>
+ <pixmapfunction></pixmapfunction>
  <customwidgets>
   <customwidget>
    <class>ADM_QSlider</class>
    <extends>QSlider</extends>
    <header>ADM_qslider.h</header>
+   <container>0</container>
+   <pixmap></pixmap>
   </customwidget>
  </customwidgets>
  <resources>

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_input.png
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_input.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_output.png
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_output.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_separate.png
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_separate.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_side.png
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_side.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_top.png
===================================================================
(Binary files differ)


Property changes on: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/pics/preview_top.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-18 15:22:35 UTC (rev 3531)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-18 17:18:57 UTC (rev 3532)
@@ -26,8 +26,6 @@
 PROCESS(actionZoom_2_1,ACT_ZOOM_2_1) \
 PROCESS(actionDecoder_options,ACT_DecoderOption) \
 PROCESS(actionPostprocessing,ACT_SetPostProcessing) \
-PROCESS(actionPreview,ACT_PreviewToggle) \
-PROCESS(actionDisplay_output,ACT_OuputToggle) \
 PROCESS(actionFrame_rate,ACT_ChangeFPS) \
 PROCESS(actionEncoder,ACT_SelectEncoder) \
 PROCESS(actionFilters,ACT_VideoParameter) \
@@ -72,16 +70,27 @@
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  
 
 #if 0
-// PROCESS(actionZoom_4_1,ACT_ZOOM_4_1) \
+PROCESS(actionZoom_4_1,ACT_ZOOM_4_1) \
 PROCESS(actionMain_toolbar,ACT_SaveCurrentWork) \
-PROCESS(actionA_V_toolbar,ACT_DUMMY) \
+PROCESS(actionA_V_toolbar,ACT_DUMMY)
+#endif
 
-
-#endif
 #define LIST_OF_BUTTONS     \
-PROCESS(pushButtonVideoConf ,ACT_VideoCodec)  \
-PROCESS(pushButtonVideoFilter , ACT_VideoParameter  ) \
-PROCESS(pushButtonAudioConf ,ACT_AudioCodec ) \
-PROCESS(pushButtonAudioFilter ,ACT_AudioFilters ) 
-
-
+PROCESS(pushButtonVideoConf, ACT_VideoCodec)  \
+PROCESS(pushButtonVideoFilter, ACT_VideoParameter) \
+PROCESS(pushButtonAudioConf, ACT_AudioCodec) \
+PROCESS(pushButtonAudioFilter, ACT_AudioFilters) \
+PROCESS(toolButtonPlay, ACT_PlayAvi) \
+PROCESS(toolButtonStop, ACT_StopAvi) \
+PROCESS(toolButtonPreviousFrame, ACT_PreviousFrame) \
+PROCESS(toolButtonNextFrame, ACT_NextFrame) \
+PROCESS(toolButtonPreviousIntraFrame, ACT_PreviousKFrame) \
+PROCESS(toolButtonNextIntraFrame, ACT_NextKFrame) \
+PROCESS(toolButtonSetMarkerA, ACT_MarkA) \
+PROCESS(toolButtonSetMarkerB, ACT_MarkB) \
+PROCESS(toolButtonPreviousBlackFrame, ACT_PrevBlackFrame) \
+PROCESS(toolButtonNextBlackFrame, ACT_NextBlackFrame) \
+PROCESS(toolButtonFirstFrame, ACT_Begin) \
+PROCESS(toolButtonLastFrame, ACT_End) \
+PROCESS(pushButtonJumpToMarkerA, ACT_GotoMarkA) \
+PROCESS(pushButtonJumpToMarkerB, ACT_GotoMarkB)
\ No newline at end of file



From mean at mail.berlios.de  Sat Aug 18 20:10:10 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 18 Aug 2007 20:10:10 +0200
Subject: [Avidemux-svn-commit] r3533 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
Message-ID: <200708181810.l7IIAAWg006324@sheep.berlios.de>

Author: mean
Date: 2007-08-18 20:10:09 +0200 (Sat, 18 Aug 2007)
New Revision: 3533

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp
Log:
[GTK] Mysterious change happened, dont crash

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp	2007-08-18 18:10:09 UTC (rev 3533)
@@ -388,7 +388,7 @@
   GtkWidget *label15;
   GtkWidget *labelBitrate;
   GtkWidget *labelBPP;
-  GtkWidget *label8;
+  
   GtkWidget *dialog_action_area1;
   GtkWidget *doit;
   GtkWidget *button1;
@@ -796,7 +796,7 @@
   GLADE_HOOKUP_OBJECT (Calculator, label15, "label15");
   GLADE_HOOKUP_OBJECT (Calculator, labelBitrate, "labelBitrate");
   GLADE_HOOKUP_OBJECT (Calculator, labelBPP, "labelBPP");
-  GLADE_HOOKUP_OBJECT (Calculator, label8, "label8");
+  
   GLADE_HOOKUP_OBJECT_NO_REF (Calculator, dialog_action_area1, "dialog_action_area1");
   GLADE_HOOKUP_OBJECT (Calculator, doit, "doit");
   GLADE_HOOKUP_OBJECT (Calculator, button1, "button1");



From gruntster at mail.berlios.de  Sat Aug 18 20:23:07 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 18 Aug 2007 20:23:07 +0200
Subject: [Avidemux-svn-commit] r3534 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708181823.l7IIN7nK006874@sheep.berlios.de>

Author: gruntster
Date: 2007-08-18 20:23:01 +0200 (Sat, 18 Aug 2007)
New Revision: 3534

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
Log:
[QT] add shortcuts and accelerators to main window

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 18:10:09 UTC (rev 3533)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 18:23:01 UTC (rev 3534)
@@ -214,9 +214,6 @@
 	volSlider->setMaximum(100);
 	connect( volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
 
-	//** Add shortcuts **//
-	QKeySequence seqFilter("CTRL+Alt+F");
-	ui.actionFilters->setShortcut(seqFilter);
 	// default state
 	bool b=0;
 	ui.pushButtonVideoConf->setEnabled(b);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 18:10:09 UTC (rev 3533)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 18:23:01 UTC (rev 3534)
@@ -1358,48 +1358,72 @@
      <height>23</height>
     </rect>
    </property>
-   <widget class="QMenu" name="menuFile" >
+   <widget class="QMenu" name="menuAuto" >
     <property name="title" >
-     <string>File</string>
+     <string>A&amp;uto</string>
     </property>
-    <widget class="QMenu" name="menuSave" >
-     <property name="title" >
-      <string>Save</string>
-     </property>
-     <addaction name="actionSave_video" />
-     <addaction name="actionSave_BMP" />
-     <addaction name="actionSave_jpeg" />
-    </widget>
-    <widget class="QMenu" name="menuRecent_Files" >
-     <property name="title" >
-      <string>Recent Files</string>
-     </property>
-     <addaction name="actionRecent0" />
-     <addaction name="actionRecent1" />
-     <addaction name="actionRecent2" />
-     <addaction name="actionRecent3" />
-    </widget>
-    <addaction name="actionOpen" />
-    <addaction name="menuRecent_Files" />
-    <addaction name="actionAppend" />
-    <addaction name="menuSave" />
+    <addaction name="actionVCD" />
+    <addaction name="actionSVCD" />
+    <addaction name="actionDVD" />
+    <addaction name="actionPSP" />
+    <addaction name="actionPSP_H264" />
+   </widget>
+   <widget class="QMenu" name="menuHelp" >
+    <property name="title" >
+     <string>&amp;Help</string>
+    </property>
+    <addaction name="actionShow_built_in_support" />
+    <addaction name="actionAbout_avidemux" />
+   </widget>
+   <widget class="QMenu" name="menuVideo" >
+    <property name="title" >
+     <string>Vi&amp;deo</string>
+    </property>
+    <addaction name="actionDecoder_options" />
+    <addaction name="actionPostprocessing" />
     <addaction name="separator" />
-    <addaction name="actionProperties" />
+    <addaction name="actionFilters" />
+    <addaction name="actionFrame_rate" />
+   </widget>
+   <widget class="QMenu" name="menuView" >
+    <property name="title" >
+     <string>&amp;View</string>
+    </property>
+    <addaction name="actionZoom_1_4" />
+    <addaction name="actionZoom_1_2" />
+    <addaction name="actionZoom_1_1" />
+    <addaction name="actionZoom_2_1" />
+   </widget>
+   <widget class="QMenu" name="menuEdit" >
+    <property name="title" >
+     <string>&amp;Edit</string>
+    </property>
+    <addaction name="actionReset_Edits" />
     <addaction name="separator" />
-    <addaction name="actionLoad_run_project" />
-    <addaction name="actionSave_project" />
-    <addaction name="actionSave_project_as" />
+    <addaction name="actionCut" />
+    <addaction name="actionCopy" />
+    <addaction name="actionPaste" />
+    <addaction name="actionDelete" />
     <addaction name="separator" />
-    <addaction name="actionConnect_to_AvsProxy" />
+    <addaction name="actionSet_marker_A" />
+    <addaction name="actionSet_marker_B" />
     <addaction name="separator" />
-    <addaction name="actionAdd_to_joblist" />
-    <addaction name="actionShow_Joblist" />
-    <addaction name="actionQuit" />
+    <addaction name="actionPreferences" />
+   </widget>
+   <widget class="QMenu" name="menuAudio" >
+    <property name="title" >
+     <string>&amp;Audio</string>
+    </property>
+    <addaction name="actionMain_Track" />
+    <addaction name="actionSecondary_Track" />
+    <addaction name="actionBuild_VBR_time_map" />
     <addaction name="separator" />
+    <addaction name="actionSave_2" />
+    <addaction name="actionFilters_2" />
    </widget>
    <widget class="QMenu" name="menuTools" >
     <property name="title" >
-     <string>Tools</string>
+     <string>&amp;Tools</string>
     </property>
     <addaction name="actionCalculator" />
     <addaction name="separator" />
@@ -1412,19 +1436,14 @@
     <addaction name="actionOCR_DVB_T_TS_files" />
     <addaction name="actionGlyphs_Edit" />
    </widget>
-   <widget class="QMenu" name="menuAuto" >
+   <widget class="QMenu" name="menuCustom" >
     <property name="title" >
-     <string>Auto</string>
+     <string>&amp;Custom</string>
     </property>
-    <addaction name="actionVCD" />
-    <addaction name="actionSVCD" />
-    <addaction name="actionDVD" />
-    <addaction name="actionPSP" />
-    <addaction name="actionPSP_H264" />
    </widget>
    <widget class="QMenu" name="menuGo" >
     <property name="title" >
-     <string>Go</string>
+     <string>&amp;Go</string>
     </property>
     <addaction name="actionPlay_Stop" />
     <addaction name="actionPrevious_Frame" />
@@ -1435,68 +1454,53 @@
     <addaction name="actionNext_blak_frame" />
     <addaction name="actionFirst_Frame" />
     <addaction name="actionLast_Frame" />
+    <addaction name="separator" />
     <addaction name="actionGo_to_Marker_A" />
     <addaction name="actionGo_to_Marker_B" />
+    <addaction name="separator" />
     <addaction name="actionJump_to_Frame" />
     <addaction name="actionJump_to_Time" />
    </widget>
-   <widget class="QMenu" name="menuCustom" >
+   <widget class="QMenu" name="menuFile" >
     <property name="title" >
-     <string>Custom</string>
+     <string>&amp;File</string>
     </property>
-   </widget>
-   <widget class="QMenu" name="menuHelp" >
-    <property name="title" >
-     <string>Help</string>
-    </property>
-    <addaction name="actionShow_built_in_support" />
-    <addaction name="actionAbout_avidemux" />
-   </widget>
-   <widget class="QMenu" name="menuView" >
-    <property name="title" >
-     <string>View</string>
-    </property>
-    <addaction name="actionZoom_1_4" />
-    <addaction name="actionZoom_1_2" />
-    <addaction name="actionZoom_1_1" />
-    <addaction name="actionZoom_2_1" />
-   </widget>
-   <widget class="QMenu" name="menuEdit" >
-    <property name="title" >
-     <string>Edit</string>
-    </property>
-    <addaction name="actionReset_Edits" />
+    <widget class="QMenu" name="menuRecent_Files" >
+     <property name="title" >
+      <string>&amp;Recent Files</string>
+     </property>
+     <addaction name="actionRecent0" />
+     <addaction name="actionRecent1" />
+     <addaction name="actionRecent2" />
+     <addaction name="actionRecent3" />
+    </widget>
+    <widget class="QMenu" name="menuSave" >
+     <property name="title" >
+      <string>&amp;Save</string>
+     </property>
+     <addaction name="actionSave_video" />
+     <addaction name="separator" />
+     <addaction name="actionSave_BMP" />
+     <addaction name="actionSave_jpeg" />
+    </widget>
+    <addaction name="actionOpen" />
+    <addaction name="menuRecent_Files" />
+    <addaction name="actionAppend" />
+    <addaction name="menuSave" />
     <addaction name="separator" />
-    <addaction name="actionCut" />
-    <addaction name="actionCopy" />
-    <addaction name="actionPaste" />
-    <addaction name="actionDelete" />
+    <addaction name="actionProperties" />
     <addaction name="separator" />
-    <addaction name="actionSet_marker_A" />
-    <addaction name="actionSet_marker_B" />
+    <addaction name="actionLoad_run_project" />
+    <addaction name="actionSave_project" />
+    <addaction name="actionSave_project_as" />
     <addaction name="separator" />
-    <addaction name="actionPreferences" />
-   </widget>
-   <widget class="QMenu" name="menuVideo" >
-    <property name="title" >
-     <string>Video</string>
-    </property>
-    <addaction name="actionDecoder_options" />
-    <addaction name="actionPostprocessing" />
+    <addaction name="actionAdd_to_joblist" />
+    <addaction name="actionShow_Joblist" />
     <addaction name="separator" />
-    <addaction name="actionFilters" />
-    <addaction name="actionFrame_rate" />
+    <addaction name="actionConnect_to_AvsProxy" />
+    <addaction name="separator" />
+    <addaction name="actionQuit" />
    </widget>
-   <widget class="QMenu" name="menuAudio" >
-    <property name="title" >
-     <string>Audio</string>
-    </property>
-    <addaction name="actionMain_Track" />
-    <addaction name="actionSecondary_Track" />
-    <addaction name="actionBuild_VBR_time_map" />
-    <addaction name="actionSave_2" />
-    <addaction name="actionFilters_2" />
-   </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
    <addaction name="menuView" />
@@ -1544,36 +1548,54 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/fileopen.png</iconset>
    </property>
    <property name="text" >
-    <string>Open</string>
+    <string>&amp;Open...</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+O</string>
+   </property>
   </action>
   <action name="actionAppend" >
    <property name="text" >
-    <string>Append</string>
+    <string>&amp;Append...</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+Alt+A</string>
+   </property>
   </action>
   <action name="actionQuit" >
    <property name="text" >
-    <string>Quit</string>
+    <string>&amp;Quit</string>
    </property>
   </action>
   <action name="actionCut" >
    <property name="text" >
-    <string>Cut</string>
+    <string>Cu&amp;t</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+X</string>
+   </property>
   </action>
   <action name="actionCopy" >
    <property name="text" >
-    <string>Copy</string>
+    <string>&amp;Copy</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+C</string>
+   </property>
   </action>
   <action name="actionPaste" >
    <property name="text" >
-    <string>Paste</string>
+    <string>&amp;Paste</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+V</string>
+   </property>
   </action>
   <action name="actionDelete" >
    <property name="text" >
+    <string>&amp;Delete</string>
+   </property>
+   <property name="shortcut" >
     <string>Delete</string>
    </property>
   </action>
@@ -1582,20 +1604,38 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markA.png</iconset>
    </property>
    <property name="text" >
-    <string>Set marker A</string>
+    <string>Set Marker A</string>
    </property>
+   <property name="iconText" >
+    <string>Set Marker A</string>
+   </property>
+   <property name="toolTip" >
+    <string>Set Marker A</string>
+   </property>
+   <property name="shortcut" >
+    <string>[</string>
+   </property>
   </action>
   <action name="actionSet_marker_B" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/markB.png</iconset>
    </property>
    <property name="text" >
-    <string>Set marker B</string>
+    <string>Set Marker B</string>
    </property>
+   <property name="iconText" >
+    <string>Set Marker B</string>
+   </property>
+   <property name="toolTip" >
+    <string>Set Marker B</string>
+   </property>
+   <property name="shortcut" >
+    <string>]</string>
+   </property>
   </action>
   <action name="actionPreferences" >
    <property name="text" >
-    <string>Preferences</string>
+    <string>Pre&amp;ferences...</string>
    </property>
   </action>
   <action name="actionProperties" >
@@ -1603,50 +1643,92 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/info.png</iconset>
    </property>
    <property name="text" >
-    <string>Information</string>
+    <string>&amp;Information...</string>
    </property>
+   <property name="shortcut" >
+    <string>Alt+Return</string>
+   </property>
   </action>
   <action name="actionSave_video" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/filesave.png</iconset>
    </property>
    <property name="text" >
-    <string>Save video</string>
+    <string>Save &amp;Video...</string>
    </property>
+   <property name="iconText" >
+    <string>Save Video</string>
+   </property>
+   <property name="toolTip" >
+    <string>Save Video</string>
+   </property>
   </action>
   <action name="actionSave_BMP" >
    <property name="text" >
-    <string>Save BMP</string>
+    <string>Save &amp;BMP Image...</string>
    </property>
+   <property name="iconText" >
+    <string>Save BMP Image</string>
+   </property>
+   <property name="toolTip" >
+    <string>Save BMP Image</string>
+   </property>
   </action>
   <action name="actionSave_jpeg" >
    <property name="text" >
-    <string>Save jpeg</string>
+    <string>Save &amp;JPEG Image...</string>
    </property>
+   <property name="iconText" >
+    <string>Save JPEG Image</string>
+   </property>
+   <property name="toolTip" >
+    <string>Save JPEG Image</string>
+   </property>
   </action>
   <action name="actionLoad_run_project" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/project_open.png</iconset>
    </property>
    <property name="text" >
-    <string>Load/run project</string>
+    <string>&amp;Load/Run Project...</string>
    </property>
+   <property name="iconText" >
+    <string>Load/Run Project</string>
+   </property>
+   <property name="toolTip" >
+    <string>Load/Run Project</string>
+   </property>
   </action>
   <action name="actionSave_project" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/filesave.png</iconset>
    </property>
    <property name="text" >
-    <string>Save project</string>
+    <string>Save &amp;Project</string>
    </property>
+   <property name="iconText" >
+    <string>Save Project</string>
+   </property>
+   <property name="toolTip" >
+    <string>Save Project</string>
+   </property>
+   <property name="shortcut" >
+    <string>Ctrl+S</string>
+   </property>
   </action>
   <action name="actionSave_project_as" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/filesaveas.png</iconset>
    </property>
    <property name="text" >
-    <string>Save project as</string>
+    <string>Save P&amp;roject As...</string>
    </property>
+   <property name="iconText" >
+    <string>Save Project As</string>
+   </property>
+   <property name="toolTip" >
+    <string>Save Project As</string>
+   </property>
   </action>
   <action name="actionMain_toolbar" >
    <property name="text" >
@@ -1660,23 +1742,35 @@
   </action>
   <action name="actionZoom_1_4" >
    <property name="text" >
-    <string>Zoom 1:4</string>
+    <string>&amp;Zoom 1:4</string>
    </property>
+   <property name="shortcut" >
+    <string>Shift+Ctrl+4</string>
+   </property>
   </action>
   <action name="actionZoom_1_2" >
    <property name="text" >
-    <string>Zoom 1:2</string>
+    <string>Z&amp;oom 1:2</string>
    </property>
+   <property name="shortcut" >
+    <string>Shift+Ctrl+2</string>
+   </property>
   </action>
   <action name="actionZoom_1_1" >
    <property name="text" >
-    <string>Zoom 1:1</string>
+    <string>Zoom &amp;1:1</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+Alt+1</string>
+   </property>
   </action>
   <action name="actionZoom_2_1" >
    <property name="text" >
-    <string>Zoom 2:1</string>
+    <string>Zoom &amp;2:1</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+Alt+2</string>
+   </property>
   </action>
   <action name="actionZoom_4_1" >
    <property name="text" >
@@ -1685,18 +1779,36 @@
   </action>
   <action name="actionDecoder_options" >
    <property name="text" >
-    <string>Decoder options</string>
+    <string>&amp;Decoder Options...</string>
    </property>
+   <property name="iconText" >
+    <string>Decoder Options</string>
+   </property>
+   <property name="toolTip" >
+    <string>Decoder Options</string>
+   </property>
+   <property name="shortcut" >
+    <string>F3</string>
+   </property>
   </action>
   <action name="actionPostprocessing" >
    <property name="text" >
-    <string>Postprocessing</string>
+    <string>&amp;Postprocessing...</string>
    </property>
+   <property name="shortcut" >
+    <string>F4</string>
+   </property>
   </action>
   <action name="actionFrame_rate" >
    <property name="text" >
-    <string>Frame rate</string>
+    <string>&amp;Frame Rate...</string>
    </property>
+   <property name="iconText" >
+    <string>Frame Rate</string>
+   </property>
+   <property name="toolTip" >
+    <string>Frame Rate</string>
+   </property>
   </action>
   <action name="actionEncoder" >
    <property name="text" >
@@ -1705,31 +1817,40 @@
   </action>
   <action name="actionFilters" >
    <property name="text" >
-    <string>Filters</string>
+    <string>Fil&amp;ters...</string>
    </property>
    <property name="shortcut" >
-    <string/>
+    <string>Ctrl+Alt+F</string>
    </property>
   </action>
   <action name="actionMain_Track" >
    <property name="text" >
-    <string>Main Track</string>
+    <string>&amp;Main Track...</string>
    </property>
   </action>
   <action name="actionSecondary_Track" >
    <property name="text" >
-    <string>Secondary Track</string>
+    <string>&amp;Secondary Track...</string>
    </property>
   </action>
   <action name="actionBuild_VBR_time_map" >
    <property name="text" >
-    <string>Build VBR time map</string>
+    <string>Build VBR Time Map</string>
    </property>
+   <property name="iconText" >
+    <string>Build VBR Time Map</string>
+   </property>
+   <property name="toolTip" >
+    <string>Build VBR Time Map</string>
+   </property>
   </action>
   <action name="actionSave_2" >
    <property name="text" >
-    <string>Save</string>
+    <string>S&amp;ave...</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+Alt+S</string>
+   </property>
   </action>
   <action name="actionEncoder_2" >
    <property name="text" >
@@ -1738,7 +1859,7 @@
   </action>
   <action name="actionFilters_2" >
    <property name="text" >
-    <string>Filters</string>
+    <string>&amp;Filters</string>
    </property>
    <property name="iconText" >
     <string>Filters</string>
@@ -1755,141 +1876,255 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/calc.png</iconset>
    </property>
    <property name="text" >
-    <string>Calculator</string>
+    <string>&amp;Calculator...</string>
    </property>
+   <property name="shortcut" >
+    <string>F7</string>
+   </property>
   </action>
   <action name="actionRebuild_I_B_Frames" >
    <property name="text" >
-    <string>Rebuild I&amp;B Frames</string>
+    <string>&amp;Rebuild I &amp;&amp; B Frames</string>
    </property>
+   <property name="iconText" >
+    <string>Rebuild I &amp; B Frames</string>
+   </property>
+   <property name="toolTip" >
+    <string>Rebuild I &amp; B Frames</string>
+   </property>
   </action>
   <action name="actionBitrate_histogram" >
    <property name="text" >
-    <string>Bitrate histogram</string>
+    <string>&amp;Bitrate Histogram...</string>
    </property>
+   <property name="iconText" >
+    <string>Bitrate Histogram</string>
+   </property>
+   <property name="toolTip" >
+    <string>Bitrate Histogram</string>
+   </property>
   </action>
   <action name="actionScan_for_black_frames" >
    <property name="text" >
-    <string>Scan for black frames</string>
+    <string>&amp;Scan for Black Frames...</string>
    </property>
+   <property name="iconText" >
+    <string>Scan for Black Frames</string>
+   </property>
+   <property name="toolTip" >
+    <string>Scan for Black Frames</string>
+   </property>
   </action>
   <action name="actionVob_to_vobsub" >
    <property name="text" >
-    <string>Vob to vobsub</string>
+    <string>&amp;VOB -> VobSub...</string>
    </property>
+   <property name="iconText" >
+    <string>VOB -> VobSub</string>
+   </property>
+   <property name="toolTip" >
+    <string>VOB -> VobSub</string>
+   </property>
   </action>
   <action name="actionOCR" >
    <property name="text" >
-    <string>OCR (Vobsub Files)</string>
+    <string>&amp;OCR (VobSub -> srt)...</string>
    </property>
+   <property name="iconText" >
+    <string>OCR (VobSub -> srt)</string>
+   </property>
+   <property name="toolTip" >
+    <string>OCR (VobSub -> srt)</string>
+   </property>
   </action>
   <action name="actionPlay_Stop" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_stop.png</iconset>
    </property>
    <property name="text" >
-    <string>Play/Stop</string>
+    <string>&amp;Play/Stop</string>
    </property>
+   <property name="shortcut" >
+    <string>P</string>
+   </property>
   </action>
   <action name="actionPrevious_Frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/back.png</iconset>
    </property>
    <property name="text" >
-    <string>Previous Frame</string>
+    <string>P&amp;revious Frame</string>
    </property>
+   <property name="shortcut" >
+    <string>4</string>
+   </property>
   </action>
   <action name="actionNext_Frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/forward.png</iconset>
    </property>
    <property name="text" >
-    <string>Next Frame</string>
+    <string>&amp;Next Frame</string>
    </property>
+   <property name="shortcut" >
+    <string>6</string>
+   </property>
   </action>
   <action name="actionPrevious_intra_frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_rew.png</iconset>
    </property>
    <property name="text" >
-    <string>Previous intra frame</string>
+    <string>Pr&amp;evious Intra Frame</string>
    </property>
+   <property name="iconText" >
+    <string>Previous Intra Frame</string>
+   </property>
+   <property name="toolTip" >
+    <string>Previous Intra Frame</string>
+   </property>
+   <property name="shortcut" >
+    <string>2</string>
+   </property>
   </action>
   <action name="actionNext_intra_frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_fwd.png</iconset>
    </property>
    <property name="text" >
-    <string>Next intra frame</string>
+    <string>Next &amp;Intra Frame</string>
    </property>
+   <property name="iconText" >
+    <string>Next Intra Frame</string>
+   </property>
+   <property name="toolTip" >
+    <string>Next Intra Frame</string>
+   </property>
+   <property name="shortcut" >
+    <string>8</string>
+   </property>
   </action>
   <action name="actionPrevious_black_frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/prev_black.png</iconset>
    </property>
    <property name="text" >
-    <string>Previous black frame</string>
+    <string>Previou&amp;s Black Frame</string>
    </property>
+   <property name="iconText" >
+    <string>Previous Black Frame</string>
+   </property>
+   <property name="toolTip" >
+    <string>Previous Black Frame</string>
+   </property>
   </action>
   <action name="actionNext_blak_frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/next_black.png</iconset>
    </property>
    <property name="text" >
-    <string>Next blak frame</string>
+    <string>Ne&amp;xt Black Frame</string>
    </property>
+   <property name="iconText" >
+    <string>Next Black Frame</string>
+   </property>
+   <property name="toolTip" >
+    <string>Next Black Frame</string>
+   </property>
   </action>
   <action name="actionFirst_Frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_start.png</iconset>
    </property>
    <property name="text" >
-    <string>First Frame</string>
+    <string>&amp;First Frame</string>
    </property>
+   <property name="shortcut" >
+    <string>Home</string>
+   </property>
   </action>
   <action name="actionLast_Frame" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_end.png</iconset>
    </property>
    <property name="text" >
-    <string>Last Frame</string>
+    <string>&amp;Last Frame</string>
    </property>
+   <property name="shortcut" >
+    <string>End</string>
+   </property>
   </action>
   <action name="actionGo_to_Marker_A" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/gotoA.png</iconset>
    </property>
    <property name="text" >
-    <string>Go to Marker A</string>
+    <string>Jump to Marker &amp;A</string>
    </property>
+   <property name="iconText" >
+    <string>Jump to Marker A</string>
+   </property>
+   <property name="toolTip" >
+    <string>Jump to Marker A</string>
+   </property>
+   <property name="shortcut" >
+    <string>Ctrl+[</string>
+   </property>
   </action>
   <action name="actionGo_to_Marker_B" >
    <property name="icon" >
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/gotoB.png</iconset>
    </property>
    <property name="text" >
-    <string>Go to Marker B</string>
+    <string>Jump to Marker &amp;B</string>
    </property>
+   <property name="iconText" >
+    <string>Jump to Marker B</string>
+   </property>
+   <property name="toolTip" >
+    <string>Jump to Marker B</string>
+   </property>
+   <property name="shortcut" >
+    <string>Ctrl+]</string>
+   </property>
   </action>
   <action name="actionJump_to_Frame" >
    <property name="text" >
-    <string>Jump to Frame</string>
+    <string>Jump to Fra&amp;me...</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+F</string>
+   </property>
   </action>
   <action name="actionJump_to_Time" >
    <property name="text" >
-    <string>Jump to Time</string>
+    <string>Jump to &amp;Time...</string>
    </property>
+   <property name="shortcut" >
+    <string>Ctrl+T</string>
+   </property>
   </action>
   <action name="actionShow_built_in_support" >
    <property name="text" >
-    <string>Show built-in support</string>
+    <string>&amp;Built-in Support...</string>
    </property>
+   <property name="iconText" >
+    <string>Built-in Support</string>
+   </property>
+   <property name="toolTip" >
+    <string>Built-in Support</string>
+   </property>
   </action>
   <action name="actionAbout_avidemux" >
    <property name="text" >
-    <string>About avidemux</string>
+    <string>&amp;About Avidemux...</string>
    </property>
+   <property name="iconText" >
+    <string>About Avidemux</string>
+   </property>
+   <property name="toolTip" >
+    <string>About Avidemux</string>
+   </property>
   </action>
   <action name="actionPlay" >
    <property name="icon" >
@@ -1921,47 +2156,74 @@
   </action>
   <action name="actionVCD" >
    <property name="text" >
-    <string>VCD</string>
+    <string>&amp;VCD</string>
    </property>
   </action>
   <action name="actionSVCD" >
    <property name="text" >
-    <string>SVCD</string>
+    <string>&amp;SVCD</string>
    </property>
   </action>
   <action name="actionDVD" >
    <property name="text" >
-    <string>DVD</string>
+    <string>&amp;DVD</string>
    </property>
   </action>
   <action name="actionPSP" >
    <property name="text" >
-    <string>PSP</string>
+    <string>&amp;PSP</string>
    </property>
   </action>
   <action name="actionPSP_H264" >
    <property name="text" >
-    <string>PSP (H264)</string>
+    <string>PSP (&amp;H.264)</string>
    </property>
+   <property name="iconText" >
+    <string>PSP (H.264)</string>
+   </property>
+   <property name="toolTip" >
+    <string>PSP (H.264)</string>
+   </property>
   </action>
   <action name="actionAdd_to_joblist" >
    <property name="text" >
-    <string>Add to joblist</string>
+    <string>Add to &amp;Joblist...</string>
    </property>
+   <property name="iconText" >
+    <string>Add to Joblist</string>
+   </property>
+   <property name="toolTip" >
+    <string>Add to Joblist</string>
+   </property>
   </action>
   <action name="actionShow_Joblist" >
    <property name="text" >
-    <string>Show Joblist</string>
+    <string>View &amp;Joblist...</string>
    </property>
+   <property name="iconText" >
+    <string>View Joblist</string>
+   </property>
+   <property name="toolTip" >
+    <string>View Joblist</string>
+   </property>
+   <property name="shortcut" >
+    <string>Ctrl+J</string>
+   </property>
   </action>
   <action name="actionConnect_to_AvsProxy" >
    <property name="text" >
-    <string>Connect to AvsProxy</string>
+    <string>Co&amp;nnect to avsproxy</string>
    </property>
+   <property name="iconText" >
+    <string>Connect to avsproxy</string>
+   </property>
+   <property name="toolTip" >
+    <string>Connect to avsproxy</string>
+   </property>
   </action>
   <action name="actionReset_Edits" >
    <property name="text" >
-    <string>Reset Edits</string>
+    <string>&amp;Reset Edits</string>
    </property>
   </action>
   <action name="actionSave" >
@@ -1971,13 +2233,25 @@
   </action>
   <action name="actionOCR_DVB_T_TS_files" >
    <property name="text" >
-    <string>OCR (DVB-T TS files)</string>
+    <string>OCR (&amp;TS -> srt)...</string>
    </property>
+   <property name="iconText" >
+    <string>OCR (TS -> srt)</string>
+   </property>
+   <property name="toolTip" >
+    <string>OCR (TS -> srt)</string>
+   </property>
   </action>
   <action name="actionGlyphs_Edit" >
    <property name="text" >
-    <string>Glyphs Edit</string>
+    <string>Edit &amp;Glyphs...</string>
    </property>
+   <property name="iconText" >
+    <string>Edit Glyphs</string>
+   </property>
+   <property name="toolTip" >
+    <string>Edit Glyphs</string>
+   </property>
   </action>
   <action name="actionPreviewInput" >
    <property name="checkable" >



From gruntster at mail.berlios.de  Sat Aug 18 21:02:17 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 18 Aug 2007 21:02:17 +0200
Subject: [Avidemux-svn-commit] r3535 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708181902.l7IJ2Hfq010075@sheep.berlios.de>

Author: gruntster
Date: 2007-08-18 21:02:11 +0200 (Sat, 18 Aug 2007)
New Revision: 3535

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
Log:
[QT] main window - fix Play menu item + make zoom items checkable + add preview modes to menu

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 18:23:01 UTC (rev 3534)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-18 19:02:11 UTC (rev 3535)
@@ -188,6 +188,14 @@
 	groupPreviewModes->addAction(ui.actionPreviewSeparate);
 	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
 
+	// Zoom modes
+	QActionGroup *groupZoomModes = new QActionGroup(this);
+
+	groupZoomModes->addAction(ui.actionZoom_1_4);
+	groupZoomModes->addAction(ui.actionZoom_1_2);
+	groupZoomModes->addAction(ui.actionZoom_1_1);
+	groupZoomModes->addAction(ui.actionZoom_2_1);
+
 	/*
 	Connect our button to buttonPressed
 	*/

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 18:23:01 UTC (rev 3534)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-18 19:02:11 UTC (rev 3535)
@@ -1358,16 +1358,6 @@
      <height>23</height>
     </rect>
    </property>
-   <widget class="QMenu" name="menuAuto" >
-    <property name="title" >
-     <string>A&amp;uto</string>
-    </property>
-    <addaction name="actionVCD" />
-    <addaction name="actionSVCD" />
-    <addaction name="actionDVD" />
-    <addaction name="actionPSP" />
-    <addaction name="actionPSP_H264" />
-   </widget>
    <widget class="QMenu" name="menuHelp" >
     <property name="title" >
      <string>&amp;Help</string>
@@ -1385,31 +1375,6 @@
     <addaction name="actionFilters" />
     <addaction name="actionFrame_rate" />
    </widget>
-   <widget class="QMenu" name="menuView" >
-    <property name="title" >
-     <string>&amp;View</string>
-    </property>
-    <addaction name="actionZoom_1_4" />
-    <addaction name="actionZoom_1_2" />
-    <addaction name="actionZoom_1_1" />
-    <addaction name="actionZoom_2_1" />
-   </widget>
-   <widget class="QMenu" name="menuEdit" >
-    <property name="title" >
-     <string>&amp;Edit</string>
-    </property>
-    <addaction name="actionReset_Edits" />
-    <addaction name="separator" />
-    <addaction name="actionCut" />
-    <addaction name="actionCopy" />
-    <addaction name="actionPaste" />
-    <addaction name="actionDelete" />
-    <addaction name="separator" />
-    <addaction name="actionSet_marker_A" />
-    <addaction name="actionSet_marker_B" />
-    <addaction name="separator" />
-    <addaction name="actionPreferences" />
-   </widget>
    <widget class="QMenu" name="menuAudio" >
     <property name="title" >
      <string>&amp;Audio</string>
@@ -1421,46 +1386,11 @@
     <addaction name="actionSave_2" />
     <addaction name="actionFilters_2" />
    </widget>
-   <widget class="QMenu" name="menuTools" >
-    <property name="title" >
-     <string>&amp;Tools</string>
-    </property>
-    <addaction name="actionCalculator" />
-    <addaction name="separator" />
-    <addaction name="actionRebuild_I_B_Frames" />
-    <addaction name="actionBitrate_histogram" />
-    <addaction name="actionScan_for_black_frames" />
-    <addaction name="separator" />
-    <addaction name="actionVob_to_vobsub" />
-    <addaction name="actionOCR" />
-    <addaction name="actionOCR_DVB_T_TS_files" />
-    <addaction name="actionGlyphs_Edit" />
-   </widget>
    <widget class="QMenu" name="menuCustom" >
     <property name="title" >
      <string>&amp;Custom</string>
     </property>
    </widget>
-   <widget class="QMenu" name="menuGo" >
-    <property name="title" >
-     <string>&amp;Go</string>
-    </property>
-    <addaction name="actionPlay_Stop" />
-    <addaction name="actionPrevious_Frame" />
-    <addaction name="actionNext_Frame" />
-    <addaction name="actionPrevious_intra_frame" />
-    <addaction name="actionNext_intra_frame" />
-    <addaction name="actionPrevious_black_frame" />
-    <addaction name="actionNext_blak_frame" />
-    <addaction name="actionFirst_Frame" />
-    <addaction name="actionLast_Frame" />
-    <addaction name="separator" />
-    <addaction name="actionGo_to_Marker_A" />
-    <addaction name="actionGo_to_Marker_B" />
-    <addaction name="separator" />
-    <addaction name="actionJump_to_Frame" />
-    <addaction name="actionJump_to_Time" />
-   </widget>
    <widget class="QMenu" name="menuFile" >
     <property name="title" >
      <string>&amp;File</string>
@@ -1501,6 +1431,88 @@
     <addaction name="separator" />
     <addaction name="actionQuit" />
    </widget>
+   <widget class="QMenu" name="menuAuto" >
+    <property name="title" >
+     <string>A&amp;uto</string>
+    </property>
+    <addaction name="actionVCD" />
+    <addaction name="actionSVCD" />
+    <addaction name="actionDVD" />
+    <addaction name="actionPSP" />
+    <addaction name="actionPSP_H264" />
+   </widget>
+   <widget class="QMenu" name="menuTools" >
+    <property name="title" >
+     <string>&amp;Tools</string>
+    </property>
+    <addaction name="actionCalculator" />
+    <addaction name="separator" />
+    <addaction name="actionRebuild_I_B_Frames" />
+    <addaction name="actionBitrate_histogram" />
+    <addaction name="actionScan_for_black_frames" />
+    <addaction name="separator" />
+    <addaction name="actionVob_to_vobsub" />
+    <addaction name="actionOCR" />
+    <addaction name="actionOCR_DVB_T_TS_files" />
+    <addaction name="actionGlyphs_Edit" />
+   </widget>
+   <widget class="QMenu" name="menuGo" >
+    <property name="title" >
+     <string>&amp;Go</string>
+    </property>
+    <addaction name="actionPlay" />
+    <addaction name="actionPrevious_Frame" />
+    <addaction name="actionNext_Frame" />
+    <addaction name="actionPrevious_intra_frame" />
+    <addaction name="actionNext_intra_frame" />
+    <addaction name="actionPrevious_black_frame" />
+    <addaction name="actionNext_blak_frame" />
+    <addaction name="actionFirst_Frame" />
+    <addaction name="actionLast_Frame" />
+    <addaction name="separator" />
+    <addaction name="actionGo_to_Marker_A" />
+    <addaction name="actionGo_to_Marker_B" />
+    <addaction name="separator" />
+    <addaction name="actionJump_to_Frame" />
+    <addaction name="actionJump_to_Time" />
+   </widget>
+   <widget class="QMenu" name="menuEdit" >
+    <property name="title" >
+     <string>&amp;Edit</string>
+    </property>
+    <addaction name="actionReset_Edits" />
+    <addaction name="separator" />
+    <addaction name="actionCut" />
+    <addaction name="actionCopy" />
+    <addaction name="actionPaste" />
+    <addaction name="actionDelete" />
+    <addaction name="separator" />
+    <addaction name="actionSet_marker_A" />
+    <addaction name="actionSet_marker_B" />
+    <addaction name="separator" />
+    <addaction name="actionPreferences" />
+   </widget>
+   <widget class="QMenu" name="menuView" >
+    <property name="title" >
+     <string>&amp;View</string>
+    </property>
+    <widget class="QMenu" name="menu_Preview" >
+     <property name="title" >
+      <string>&amp;Preview Mode</string>
+     </property>
+     <addaction name="actionPreviewInput" />
+     <addaction name="actionPreviewOutput" />
+     <addaction name="actionPreviewSide" />
+     <addaction name="actionPreviewTop" />
+     <addaction name="actionPreviewSeparate" />
+    </widget>
+    <addaction name="actionZoom_1_4" />
+    <addaction name="actionZoom_1_2" />
+    <addaction name="actionZoom_1_1" />
+    <addaction name="actionZoom_2_1" />
+    <addaction name="separator" />
+    <addaction name="menu_Preview" />
+   </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
    <addaction name="menuView" />
@@ -1741,6 +1753,9 @@
    </property>
   </action>
   <action name="actionZoom_1_4" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
    <property name="text" >
     <string>&amp;Zoom 1:4</string>
    </property>
@@ -1749,6 +1764,9 @@
    </property>
   </action>
   <action name="actionZoom_1_2" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
    <property name="text" >
     <string>Z&amp;oom 1:2</string>
    </property>
@@ -1757,6 +1775,12 @@
    </property>
   </action>
   <action name="actionZoom_1_1" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
+   <property name="checked" >
+    <bool>true</bool>
+   </property>
    <property name="text" >
     <string>Zoom &amp;1:1</string>
    </property>
@@ -1765,6 +1789,9 @@
    </property>
   </action>
   <action name="actionZoom_2_1" >
+   <property name="checkable" >
+    <bool>true</bool>
+   </property>
    <property name="text" >
     <string>Zoom &amp;2:1</string>
    </property>
@@ -1942,8 +1969,14 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_stop.png</iconset>
    </property>
    <property name="text" >
-    <string>&amp;Play/Stop</string>
+    <string>Stop</string>
    </property>
+   <property name="iconText" >
+    <string>Stop</string>
+   </property>
+   <property name="toolTip" >
+    <string>Stop</string>
+   </property>
    <property name="shortcut" >
     <string>P</string>
    </property>
@@ -2131,8 +2164,17 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/player_play.png</iconset>
    </property>
    <property name="text" >
-    <string>Play</string>
+    <string>&amp;Play/Stop</string>
    </property>
+   <property name="iconText" >
+    <string>Play/Stop</string>
+   </property>
+   <property name="toolTip" >
+    <string>Play/Stop</string>
+   </property>
+   <property name="shortcut" >
+    <string>P</string>
+   </property>
   </action>
   <action name="actionRecent0" >
    <property name="text" >
@@ -2264,7 +2306,7 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_input.png</iconset>
    </property>
    <property name="text" >
-    <string>Input</string>
+    <string>&amp;Input</string>
    </property>
   </action>
   <action name="actionPreviewOutput" >
@@ -2275,7 +2317,7 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_output.png</iconset>
    </property>
    <property name="text" >
-    <string>Output</string>
+    <string>&amp;Output</string>
    </property>
   </action>
   <action name="actionPreviewSide" >
@@ -2286,7 +2328,7 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_side.png</iconset>
    </property>
    <property name="text" >
-    <string>Side</string>
+    <string>Si&amp;de</string>
    </property>
   </action>
   <action name="actionPreviewTop" >
@@ -2297,7 +2339,7 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_top.png</iconset>
    </property>
    <property name="text" >
-    <string>Top</string>
+    <string>&amp;Top</string>
    </property>
   </action>
   <action name="actionPreviewSeparate" >
@@ -2308,9 +2350,34 @@
     <iconset resource="avidemux.qrc" >:/new/prefix1/pics/preview_separate.png</iconset>
    </property>
    <property name="text" >
-    <string>Separate</string>
+    <string>&amp;Separate</string>
    </property>
   </action>
+  <action name="action_Input" >
+   <property name="text" >
+    <string>&amp;Input</string>
+   </property>
+  </action>
+  <action name="action_Output" >
+   <property name="text" >
+    <string>&amp;Output</string>
+   </property>
+  </action>
+  <action name="actionSi_de" >
+   <property name="text" >
+    <string>Si&amp;de</string>
+   </property>
+  </action>
+  <action name="action_Top" >
+   <property name="text" >
+    <string>&amp;Top</string>
+   </property>
+  </action>
+  <action name="action_Separate" >
+   <property name="text" >
+    <string>&amp;Separate</string>
+   </property>
+  </action>
  </widget>
  <pixmapfunction></pixmapfunction>
  <customwidgets>



From mean at mail.berlios.de  Sun Aug 19 09:55:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 19 Aug 2007 09:55:58 +0200
Subject: [Avidemux-svn-commit] r3536 - in
	branches/avidemux_2.4_branch/avidemux: ADM_infoExtractor
	ADM_inputs/ADM_mpegdemuxer
Message-ID: <200708190755.l7J7twPC017512@sheep.berlios.de>

Author: mean
Date: 2007-08-19 09:55:57 +0200 (Sun, 19 Aug 2007)
New Revision: 3536

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_h264_tag.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
Log:
[H264] Factorize some defines

Copied: branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_h264_tag.h (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_h264_tag.h	2007-08-19 07:55:57 UTC (rev 3536)
@@ -0,0 +1,23 @@
+/***************************************************************************
+                      NAL TYPE for H264
+                      
+**************************************************************************/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_H264_TAG_H
+#define ADM_H264_TAG_H
+#define NAL_NON_IDR       1
+#define NAL_IDR           5
+#define NAL_SEI           6
+#define NAL_SPS           7
+#define NAL_PPS           8
+#define NAL_AU_DELIMITER  9
+#define NAL_FILLER        12
+#endif
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2007-08-18 19:02:11 UTC (rev 3535)
+++ branches/avidemux_2.4_branch/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2007-08-19 07:55:57 UTC (rev 3536)
@@ -41,6 +41,9 @@
 #include "ADM_lavcodec/bitstream.h"
 #include "ADM_lavcodec/golomb.h"
 }
+
+#include "ADM_infoExtractor/ADM_h264_tag.h"
+
 static void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags);
 /*
     Extract width & height from vol header passed as arg
@@ -415,8 +418,6 @@
 {
   uint8_t *head=buffer, *tail=buffer+len;
   uint8_t stream;
-#define NAL_NON_IDR       1
-#define NAL_IDR           5
   
   uint32_t val,hnt;  
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2007-08-18 19:02:11 UTC (rev 3535)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2007-08-19 07:55:57 UTC (rev 3536)
@@ -47,6 +47,9 @@
 #include "ADM_osSupport/ADM_debug.h"
 
 #include "dmx_indexer_internal.h"
+
+#include "ADM_infoExtractor/ADM_h264_tag.h"
+#undef aprintf
 #define aprintf printf
 static const char Type[5]={'X','I','P','B','P'};
 
@@ -84,13 +87,7 @@
       \brief main indexing loop for mpeg2 payload
 */
 
-#define NAL_NON_IDR       1
-#define NAL_IDR           5
-#define NAL_SEI           6
-#define NAL_SPS           7
-#define NAL_PPS           8
-#define NAL_AU_DELIMITER  9
-#define NAL_FILLER        12
+
 // 12 : Filler
 uint8_t   dmx_videoIndexerH264::run  (void)
 {



From gruntster at mail.berlios.de  Sun Aug 19 15:18:12 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 19 Aug 2007 15:18:12 +0200
Subject: [Avidemux-svn-commit] r3537 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML
Message-ID: <200708191318.l7JDIC27019213@sheep.berlios.de>

Author: gruntster
Date: 2007-08-19 15:17:59 +0200 (Sun, 19 Aug 2007)
New Revision: 3537

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp
Log:
[AVI] fix random crash when opening AVI files with audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp	2007-08-19 07:55:57 UTC (rev 3536)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp	2007-08-19 13:17:59 UTC (rev 3537)
@@ -335,8 +335,6 @@
 		//	several
 		//--------------------------------------------------
 		// and audio track
-		uint32_t audioTrack=0xff;	
-		uint32_t audioTrackNumber=0;
 		if(_mainaviheader.dwStreams>=2)
 		{
 			// which one is the audio track, is there several ?
@@ -358,8 +356,7 @@
                                         fseeko(_fd,_Tracks[run].strh.offset,SEEK_SET);
                                         if(_Tracks[run].strh.size != sizeof(_audiostream))
                                         {
-                                                printf("Mmm(2) we have a bogey here, size mismatch : %u \n"
-                                                        ,_Tracks[audioTrack].strh.size);
+                                                printf("Mmm(2) we have a bogey here, size mismatch : %u \n",_Tracks[run].strh.size);
                                                 printf("expected %d\n",sizeof(_audiostream));
                                                 if(_Tracks[run].strh.size<sizeof(_audiostream)-8)
                                                 {
@@ -384,7 +381,7 @@
                                         if(extra<0)
                                         {	
                                                 printf("WavHeader is not big enough (%lu/%lu)!\n",
-                                                _Tracks[audioTrack].strf.size,sizeof(WAVHeader));
+                                                _Tracks[run].strf.size,sizeof(WAVHeader));
                                                 return 0;
                                         }
                                         fread(track->wavHeader,sizeof(WAVHeader),1,_fd);				



From gruntster at mail.berlios.de  Sun Aug 19 15:47:25 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 19 Aug 2007 15:47:25 +0200
Subject: [Avidemux-svn-commit] r3538 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
Message-ID: <200708191347.l7JDlPeu021314@sheep.berlios.de>

Author: gruntster
Date: 2007-08-19 15:46:48 +0200 (Sun, 19 Aug 2007)
New Revision: 3538

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui
Log:
[QT] default generic progress window to 0%

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui	2007-08-19 13:17:59 UTC (rev 3537)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui	2007-08-19 13:46:48 UTC (rev 3538)
@@ -1,4 +1,7 @@
 <ui version="4.0" >
+ <author></author>
+ <comment></comment>
+ <exportmacro></exportmacro>
  <class>Dialog</class>
  <widget class="QDialog" name="Dialog" >
   <property name="geometry" >
@@ -39,8 +42,13 @@
         <widget class="QLabel" name="label_2" >
          <property name="font" >
           <font>
+           <family>MS Shell Dlg 2</family>
+           <pointsize>8</pointsize>
            <weight>75</weight>
+           <italic>false</italic>
            <bold>true</bold>
+           <underline>false</underline>
+           <strikeout>false</strikeout>
           </font>
          </property>
          <property name="text" >
@@ -60,8 +68,13 @@
          </property>
          <property name="font" >
           <font>
+           <family>MS Shell Dlg 2</family>
+           <pointsize>8</pointsize>
            <weight>75</weight>
+           <italic>false</italic>
            <bold>true</bold>
+           <underline>false</underline>
+           <strikeout>false</strikeout>
           </font>
          </property>
          <property name="text" >
@@ -112,9 +125,6 @@
    </item>
    <item>
     <widget class="QProgressBar" name="progressBar" >
-     <property name="value" >
-      <number>24</number>
-     </property>
      <property name="orientation" >
       <enum>Qt::Horizontal</enum>
      </property>
@@ -173,6 +183,7 @@
    </item>
   </layout>
  </widget>
+ <pixmapfunction></pixmapfunction>
  <resources/>
  <connections/>
 </ui>



From mean at mail.berlios.de  Sun Aug 19 18:01:40 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 19 Aug 2007 18:01:40 +0200
Subject: [Avidemux-svn-commit] r3539 - in
	branches/avidemux_2.4_branch/avidemux: ADM_ocr
	ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_GTK/ADM_ocr
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_ocr
	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
Message-ID: <200708191601.l7JG1eGd019486@sheep.berlios.de>

Author: mean
Date: 2007-08-19 18:01:39 +0200 (Sun, 19 Aug 2007)
New Revision: 3539

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_mpdetc.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSub.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSubBitmap.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobsub.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vobsubinfo.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vobsubinfo.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_mpdetc.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidMPresize.c
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubBitmap.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobsub.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/swscale_internal.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocr.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDvbSub.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filters] Move more filters to proper place (all the ones that have dialog for both qt and gtk)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocr.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocr.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_ocr/ADM_ocr.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -16,8 +16,8 @@
  ***************************************************************************/
 #ifndef ADM_OCR_H
 #define ADM_OCR_H
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 #include "ADM_ocr/adm_glyph.h"
 typedef enum
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vobsub.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -43,8 +43,8 @@
 
 
 
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 
 #define MAX_INDECES ADM_MAX_LANGUAGE
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -62,9 +62,9 @@
 
 #include "ADM_colorspace/colorspace.h"
 
-#include "ADM_video/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
 
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 #include "ADM_leftturn.h"
 #include "DIA_enter.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -44,8 +44,8 @@
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
 #include "ADM_videoFilter/ADM_vidHue.h"
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
 #include "ADM_videoFilter/ADM_vidEq2.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -44,8 +44,8 @@
 #include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
 #include "ADM_videoFilter/ADM_vidHue.h"
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 #include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
 #include "ADM_videoFilter/ADM_vidContrast.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -30,8 +30,8 @@
 #include "ADM_video/ADM_genvideo.hxx"
 #include "ADM_colorspace/ADM_rgb.h"
 
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 
 #include "ADM_assert.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -30,8 +30,8 @@
 #include "ADM_video/ADM_genvideo.hxx"
 #include "ADM_colorspace/ADM_rgb.h"
 
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 
 #include "ADM_assert.h"
 #include "ADM_ocr/ADM_ocr.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -37,8 +37,8 @@
 #include "ADM_video/ADM_genvideo.hxx"
 #include "ADM_filter/video_filters.h"
 
-#include "ADM_video/ADM_vobsubinfo.h"
-#include "ADM_video/ADM_vidVobSub.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
 #include "ADM_ocr/ADM_ocr.h"
 #include "ADM_osSupport/ADM_misc.h"
 #include "ADM_toolkit/toolkit.hxx"

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_mpdetc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_mpdetc.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_mpdetc.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,71 +0,0 @@
-//
-//
-// C++ Interface: ADM_mpdetc
-//
-// Description: 
-//		Port of Mplayer Detc filter (inverse telecine)
-//		Original author & copyright : Richard Felker
-//
-// Author: mean <fixounet at free.fr>, (C) 2003
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-typedef struct metrics {
-	/* difference: total, even lines, odd lines */
-	int d, e, o;
-	/* noise: temporal, spacial (current), spacial (past) */
-	int t, s, p;
-};
-
-typedef struct frameinfo {
-	/* peak, relative, mean */
-	 metrics p, r, m;
-};
-
-struct vf_priv_s {
-	struct frameinfo fi[2];
-	uint8_t  *dmpi;
-	int first;
-	int drop, lastdrop, dropnext;
-	int inframes, outframes;
-};
-
-enum {
-	F_DROP,
-	F_MERGE,
-	F_NEXT,
-	F_SHOW
-};
-
-
-
-class  AVDMVideoMPDetc:public AVDMGenericVideoStream
- {
-
- protected:
-
-	struct vf_priv_s	*_param;
-	ADMImage		*_lastFrame;
-        virtual char 		*printConf(void) ;
-	
-	
-		uint8_t 	do_put_image(ADMImage *data);
-		uint32_t	_inFrame;
-		uint32_t	_lastAsked;
-		uint32_t 	_copy;
-	
-
- public:
-  				AVDMVideoMPDetc(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  				~AVDMVideoMPDetc();
-	virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t 	configure( AVDMGenericVideoStream *instream) 
-								{return 0;};
-
-
- }     ;
-
- 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidMPresize.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidMPresize.c	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidMPresize.c	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,221 +0,0 @@
-/***************************************************************************
-                          ADM_vidResize.cpp  -  description
-                             -------------------
-   Resize a picture in YUV12
-
-   w,h 		size of final picture
-   dw,dh  size of black bordered picture
-
-
-    begin                : Thu Mar 21 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <assert.h>
-
-#include "config.h"
-
-#include "fourcc.h"
-#include "avio.hxx"
-#include "avi_vars.h"
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_video/ADM_vidCommonFilter.h"
-#include "ADM_video/swscale.h"
-
-
-
-
-
-class  AVDMVideoStreamMPResize:public AVDMGenericVideoStream
- {
-
- protected:
-
-
- public:
-
-  				AVDMVideoStreamMPResize(  AVDMGenericVideoStream *in,CONFcouple *setup);
-				AVDMVideoStreamMPResize(	AVDMGenericVideoStream *in,uint32_t x,uint32_t y);
-  				virtual 		~AVDMVideoStreamMPResize();
-          virtual 		uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          																	uint8_t *data,uint32_t *flags);
-				uint8_t configure( AVDMGenericVideoStream *instream);
-	virtual 		char 	*printConf(void) ;
-
-          virtual uint8_t	getCoupledConf( CONFcouple **couples);
-
-
- }     ;
-
-//BUILD_CREATE(partial_create,ADMVideoPartial);
-
-char *AVDMVideoStreamMPResize::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf," Resize %lu x %lu --> %lu x %lu",
- 				_in->getInfo()->width,
- 				_in->getInfo()->height,
- 				_info.width,
- 				_info.height);
-        return buf;
-}
-//_______________________________________________________________
-AVDMVideoStreamMPResize::AVDMVideoStreamMPResize(
-									AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-  	_in=in;
-   	memcpy(&_info,_in->getInfo(),sizeof(_info));
-	//_uncompressed=(uint8_t *)malloc(3*_info.width*_info.height);
-	_uncompressed=new uint8_t[3*_info.width*_info.height];
-
-		if(couples)
-		{
-			 _param=NEW(RESIZE_PARAMS);
-			GET(w);
-			GET(h);
-			GET(algo);
-			_info.width=_param->w;
-			_info.height=_param->h;
-
-		}
-			else
-			{
-				_param=NEW( RESIZE_PARAMS);
-				_param->w=_info.width;
-				_param->h = _info.height;
-			    _param->algo = 0;
-			}
-			//_intermediate_buffer=(uint8_t *)malloc(3*_info.width*_in->getInfo()->height);
-			_intermediate_buffer=new uint8_t [3*_info.width*_in->getInfo()->height];
-
-  _info.encoding=1;
-  _init=0;
-	Vpattern_luma=NULL;
-    Vpattern_chroma=NULL;
-	Hpattern_luma=NULL;
-    Hpattern_chroma=NULL;
-}
-/*AVDMGenericVideoStream *createResizeFromParam(AVDMGenericVideoStream *in,uint32_t x,uint32_t y)
-{
-
-	return new AVDMVideoStreamResize(in,x,y);
-}*/
-AVDMVideoStreamMPResize::AVDMVideoStreamMPResize(
-									AVDMGenericVideoStream *in,uint32_t x,uint32_t y)
-{
-
-  	_in=in;
-   	memcpy(&_info,_in->getInfo(),sizeof(_info));
-	//_uncompressed=(uint8_t *)malloc(3*_info.width*_info.height);
-	_uncompressed=new uint8_t[3*_info.width*_info.height];
-	_param=NEW( RESIZE_PARAMS);
-	_param->w=x;
-	_param->h = y;
-	_info.width=_param->w;
-	_info.height=_param->h;
-	_param->algo = 0;
-			//_intermediate_buffer=(uint8_t *)malloc(3*_info.width*_in->getInfo()->height);
-			_intermediate_buffer=new uint8_t [3*_info.width*_in->getInfo()->height];
-
-  _info.encoding=1;
-  _init=0;
-	Vpattern_luma=NULL;
-    Vpattern_chroma=NULL;
-	Hpattern_luma=NULL;
-    Hpattern_chroma=NULL;
-}
-
-uint8_t	AVDMVideoStreamMPResize::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_assert(_param);
-			*couples=new CONFcouple(3);
-
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-	CSET(w);
-	CSET(h);
-	CSET(algo);
-			return 1;
-
-}
-// ___ destructor_____________
-AVDMVideoStreamMPResize::~AVDMVideoStreamMPResize()
-{
- 	delete [] _uncompressed;
-	delete [] _intermediate_buffer;
-	DELETE(_param);
-	_uncompressed=_intermediate_buffer=NULL;
- 	endcompute();
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoStreamMPResize::getFrameNumberNoAlloc(uint32_t frame,
-																		uint32_t *len,
-   																	uint8_t *data,
-   																	uint32_t *flags)
-{
-static Image in,out;
-			if(frame>= _info.nb_frames) return 0;
-			ADM_assert(_param);	
-	
-   			
-
-			// bypass filter
-			//return _in->getFrameNumberNoAlloc(frame, len,data,flags)	;
-			
-								
-			// read uncompressed frame
-       		if(!_in->getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-       		
-       		// do the resize in 3 passes, Y, U then V
-       		in.width=_in->getInfo()->width;
-       		in.height=_in->getInfo()->height;
-       		in.data=_uncompressed;
-
-       		out.width=_info.width;
-       		out.height=_info.height;
-       		out.data=data;
-       		
-              if(!_init)
-              {
-               	_init=1;
-               	printf("\n Precomputing with algo :%lu\n",_param->algo);
-                	if(_param->algo>2)
-                 		{
-                      	printf("\n Wrong algorithm selection");
-                        ADM_assert(0);
-                     }
-               	 precompute(&out,&in, _param->algo );
-              }
-       		zoom(&out,&in)         ;
-       				       			
-       		
-       		  *flags=0;
-       		  *len= _info.width*_info.height+(_info.width*_info.height>>1);       				
-      return 1;
-}
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,81 +0,0 @@
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef _VOBSUB_V_
-#define _VOBSUB_V_
-#include "ADM_inputs/ADM_mpegdemuxer/dmx_demuxerPS.h"
-#define VS_MAXPACKET 128*1024
-
-#define NOSUB 0xffffffff
-
-#define MAX_DISPLAY_TIME 3000 // 3s
-
-//************************************
-typedef struct vobSubParam
-{
-        char            *subname;
-        uint32_t        index;
-        int32_t         subShift;
-}vobSubParam;
-//************************************
-#include "ADM_video/ADM_vidVobSubBitmap.h"
-//************************************
-class  ADMVideoVobSub:public AVDMGenericVideoStream
- {
-
- protected:
-        virtual char                    *printConf(void);
-        uint8_t                         guessPalette(void);
-        uint8_t                         readbyte(void);         /// Read a byte from buffer
-        uint16_t                        readword(void);         /// Read a 16 bits word from buffer
-        uint8_t                         forward(uint32_t v);    /// Read a 16 bits word from buffer
-        uint8_t                         decodeRLE(uint32_t off,uint32_t start,uint32_t end);
-        uint8_t                         setup(void);            /// Rebuild internal info
-        uint8_t                         cleanup(void);          /// Destroy all internal info
-        uint8_t                         paletteYUV( void );     /// Convert RGB Pallette to yuv
-        uint8_t                         Palettte2Display( void ); /// Convert the RLE to YUV bitmap
-        uint8_t                         handleSub( uint32_t idx );/// Decode a sub packet
-        uint32_t                        lookupSub(uint64_t time);/// Return sub index corresponding to time
-        
-        dmx_demuxerPS                   *_parser;        
-        uint8_t                         *_data;                 /// Data for packet
-        VobSubInfo                      *_vobSubInfo;           /// Info of the index file
-        vobSubParam                     *_param;
-        vobSubBitmap                    *_original;              /// True size (..) depacked vobsub
-        vobSubBitmap                    *_resampled;            /// Final one; to be blended in picture
-        vobSubBitmap                    *_chromaResampled;      /// Same as above but shinked by 2
-        uint32_t                        _x1,_y1,_x2,_y2;        /// sub boxing
-        uint32_t                        _subW,_subH;
-        uint8_t                         _displaying;            ///  Is display active
-        uint32_t                        _curOffset;
-        uint32_t                        _subSize;
-        uint32_t                        _dataSize;              /// Size of the data chunk
-        
-        uint8_t                         _colors[4];             /// Colors palette
-        uint8_t                         _alpha[4];              /// Colors alpha
-        int16_t                         _YUVPalette[16];        /// Luma only
-        uint32_t                        _currentSub;            ///
-        uint32_t                        _initialPts;
- public:
-    /* This 3 functions are used by OCR */
-                        ADMVideoVobSub(  char *fileidx,uint32_t idx);
-              vobSubBitmap *getBitmap(uint32_t nb,uint32_t *start, uint32_t *end,uint32_t *first,uint32_t *last);
-              uint32_t     getNbImage( void);
-    /* /ocr */ 
-    
-                        ADMVideoVobSub(  AVDMGenericVideoStream *in,CONFcouple *setup);
-                        ~ADMVideoVobSub();
-        virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                                ADMImage *data,uint32_t *flags);
-        virtual uint8_t getCoupledConf( CONFcouple **couples)           ;
-        virtual uint8_t configure( AVDMGenericVideoStream *instream);
-                                                        
-};
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubBitmap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubBitmap.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubBitmap.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,40 +0,0 @@
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef _VOBSUB_BITMAP_H
-#define _VOBSUB_BITMAP_H
-//************************************
-class vobSubBitmap
-{
-  protected:
-        uint8_t                         *_dirty;                   /// Dirty lines (non transparent)
-  public:
-        uint8_t                         isDirty(uint32_t line);
-        uint8_t                         setDirty(uint32_t line);
-
-        uint32_t                        _width,_height;
-        uint32_t                        placeTop, placeHeight;     /// Position of the sub
-      
-        uint8_t                         *_bitmap;                  /// YUV image
-        uint8_t                         *_alphaMask;               /// alpha mask 
-        
- 
-                                        vobSubBitmap(uint32_t w, uint32_t h); 
-                                        ~vobSubBitmap();
-        void                            clear(void);
-        
-                                        /// Convert palette bitmap to yuv&mask bitmap
-        uint8_t                         buildYUV( int16_t *palette ); 
-                                        /// Generate the final bitmap (resized)
-        uint8_t                         subResize(vobSubBitmap **tgt,uint32_t newx,uint32_t newy,
-                                                uint32_t oldtop, uint32_t oldheight);
-};
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubRender.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubRender.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,677 +0,0 @@
-//
-// C++ Implementation: %{MODULE}
-//
-// Description:
-//
-//
-// Author: %{AUTHOR} <%{EMAIL}>, (C) %{YEAR}
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-//
-// C++ Implementation:Spudecoder (subs for DVd like stream)
-//
-// Description:
-//
-//
-// Author: Mean, fixounet at free.fr
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-// see http://sam.zoy.org/writings/dvd/subtitles/
-
-/*
-        This part of the vobsub stuff 
-                - decodes the command spu block
-                - rle decode the bitmap itself
-                
-        
-       palettized is the palette based decoded sub
-       
-       Elsewhere
-       
-       bitmap & alphamask are the bitmap & alpha channel stuff
-       subW & subH are width and height of them
-       
-       The RLE decoder is derivated from mplayer one
-*/
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_filter/video_filters.h"
-
-
-#include "ADM_toolkit/filesel.h"
-
-#include "ADM_colorspace/colorspace.h"
-
-#include "ADM_vobsubinfo.h"
-
-#include "ADM_vidVobSub.h"
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-extern "C" {
-#include "ADM_lavcodec/avcodec.h"
-}
-#endif
-
-#include "../ADM_lavutil/avutil.h"
-#include "ADM_libswscale/swscale.h"
-#include "ADM_osSupport/ADM_cpuCap.h"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-
-//*************************************************************
-uint8_t ADMVideoVobSub::forward(uint32_t v)
-{
-        aprintf("Current : %lu forwarding : %lu\n",_curOffset,v);
-         if(_curOffset+v>=_subSize) return 0;
-         _curOffset+=v;
-         return 1;
-
-}
-//*************************************************************
-uint8_t ADMVideoVobSub::readbyte( void )
-{
-        ADM_assert(_curOffset<_subSize);
-        return _data[_curOffset++];
-
-}
-//*************************************************************
-uint16_t ADMVideoVobSub::readword( void )
-{
-uint16_t w;
-        ADM_assert(_curOffset<_subSize-1);
-        w= _data[_curOffset]<<8;
-        w+= _data[_curOffset+1];
-        _curOffset+=2;
-        return w;
-}
-//***********************************************************
-//      Convert RGB Palette to YUV Palette
-//      ALL 16 of them
-//
-uint8_t ADMVideoVobSub::paletteYUV( void )
-{
-uint8_t r,g,b,a;
-uint8_t y;
-int8_t u,v;
-uint32_t value;
-        for(int i=0;i<16;i++)
-        {
-               value=_vobSubInfo->Palette[i];
-               r=(value>>16)&0xff;
-               g=(value>>8)&0xff; 
-               b=(value)&0xff;
-               
-               COL_RgbToYuv(b,  g,  r, &y, &u,&v);
-               
-                _YUVPalette[i]=y;
-                //_YUVPalette[i][1]=u;
-                //_YUVPalette[i][2]=v;
-        
-        }
-        return 1;
-
-}
-
-
-//***********************************************************
-// RLE code inspired from mplayer
-uint8_t ADMVideoVobSub::decodeRLE(uint32_t off,uint32_t start,uint32_t end)
-{
-
-        if(!_original) return 0;
-
-        uint32_t oldoffset=_curOffset;
-        uint32_t stride=_subW;
-        uint32_t x,y;
-        uint8_t *ptr=_original->_bitmap;
-        uint8_t *alpha=_original->_alphaMask;
-        uint32_t a,b;
-        int     nibbleparity=0;
-        int     nibble=0;
-        
-        int run,color;
-        
-#define SKIPNIBBLE        {nibbleparity=0;}
-#define NEXTNIBBLE(x) if(nibbleparity){ x=nibble&0xf;nibbleparity=0;}else {nibble=readbyte();nibbleparity=1;x=nibble>>4;}
-       
-        _curOffset=off;
-        aprintf("Vobsub: Rle at offset :%d datasize:%d (stride:%d)\n",off,_dataSize,stride);
-        if(!ptr)
-        {
-                printf("Vobsub:No infos yet RLE data...\n");
-                 return 1;
-        }
-        x=0;
-        y=0;
-        while(
-               (_curOffset<_dataSize)
-            && (y<(_subH>>1)) 
-            && ((!end) || (_curOffset<end))
-        )
-        {
-               NEXTNIBBLE(a);
-               if(a<4)
-               {
-                 a<<=4;
-                 NEXTNIBBLE(b);
-                 a|=b;
-                 if(a<0x10)
-                 {
-                        a<<=4;
-                        NEXTNIBBLE(b);
-                        a|=b;
-                        if(a<0x40)
-                        {
-                                a<<=4;
-                                NEXTNIBBLE(b);
-                                a|=b;
-                                if(a<0x100)
-                                {
-                                        a|=(stride-x)<<2;
-                                }
-                        }
-                 }
-              }
-              run=a>>2;
-              color=3-(a&0x3);
-             // aprintf("Vobsub: Run:%d color:%d\n",run,color);
-              if((run>stride-x) || !run)
-                run=stride-x;
-              
-              //memset(ptr,color,run);
-              memset(ptr,_colors[color],run);
-              memset(alpha,_alpha[color],run);
-              if(run!=stride) _original->setDirty(y*2+start);
-              x+=run;
-              ptr+=run;
-              alpha+=run;
-              //  aprintf("x:%d y:%d\n",x,y);
-              if(x>=stride)
-              {
-                        
-                     y++;
-                     x=0;
-                     ptr=_original->_bitmap+(y*2+start)*stride;
-                     alpha=_original->_alphaMask+(y*2+start)*stride;
-                     SKIPNIBBLE;
-              }
-        }
-        aprintf("vobsub End :%d y:%d\n",_curOffset,y); 
-        _curOffset=oldoffset;
-} 
-//***********************************************        
-// Decode Sub automaton command
-//***********************************************
-uint8_t  ADMVideoVobSub::handleSub( uint32_t idx )
-{       
-uint16_t date,next,dum;
-uint8_t  command;
-        _subSize=0;
-uint32_t pts;
-uint64_t posA,posR;
- uint32_t odd,even;
-int doneA=0;
-int doneB=0;
-        _parser->getPos(&posA,&posR);
-        // Read data
-aprintf("**Cur:A:%llx R:%llx next:%llx\n",posA,posR,_vobSubInfo->lines[idx+1].fileOffset);        
-while(posA<_vobSubInfo->lines[idx+1].fileOffset)
-{        
-        odd=even=0;
-        aprintf("**Cur: A:%llx R:%llx next:%llx\n",posA,posR,_vobSubInfo->lines[idx+1].fileOffset);
-        
-        _subSize=_parser->read16i();
-        if(!_subSize)
-        {
-            printf("Vobsub: error reading\n");
-            return 0;
-        }
-        
-        aprintf("Vobsub: data len =%d\n",_subSize);
-        
-        if(_subSize>VS_MAXPACKET-1)
-         {
-            printf("Vobsub: error reading (packet too big)\n");
-            return 0;
-        }
-        if(!_parser->read(_data+2,_subSize-2)) 
-        {
-                printf("VS: read failed\n");
-                return 0;
-        }
-       
-        // We got the full packet
-        // now scan it
-        _curOffset=2;
-        if(_subSize<4)
-        {
-          printf("[handleSub] Packet too short!\n");
-          return 1; 
-        }
-        _dataSize=readword();
-        aprintf("data block=%lu\n",_dataSize);
-        if(_dataSize<=4)
-        {
-            printf("Vobsub: data block too small\n");
-            return 0;       
-        }
-        
-        if(!forward(_dataSize-4)) return 0;    // go to the command block
-        
-        
-        while(2)
-        {
-                if(_curOffset>_subSize-5) break;
-                date=readword();
-                next=readword();
-                if(next==_curOffset-4) break;            // end of command
-                
-                while(_curOffset<next)
-                {
-                      
-                      
-                        command=readbyte();
-                        aprintf("vobsub:Command : %d date:%d next:%d cur:%lu\n",command,date,next,_curOffset);
-                        int left=next-_curOffset;
-                        switch(command)
-                        {
-                                case 00: _displaying=1;
-                                        break;
-                                case 01: // start date
-                                        break;
-                                case 02: // stop date
-#if 0                                
-                                        pts=_parser->getPTS();
-                                        if(!_vobSubInfo->lines[idx].stopTime)
-                                        {
-                                                double comp;
-                                           
-                                                comp=pts-_initialPts;
-                                                comp=comp/90;     // 90khz
-                                                comp+=date*10;    // 1/100th of a second
-                                                 _vobSubInfo->lines[idx].stopTime=(uint32_t)comp;
-                                                aprintf("****Sub: idx : %lu starts at :%lu end at :%lu\n",
-                                                        idx,
-                                                        _vobSubInfo->lines[idx].startTime, 
-                                                        _vobSubInfo->lines[idx].stopTime);
-                                        
-                                        }
-#endif                                        
-                                        break;
-                                case 03: // Pallette 4 nibble= 16 bits
-                                         if(left<2)
-                                         {
-                                            printf("Command 3: Palette: Not enough bytes left\n");
-                                            return 1; 
-                                         }
-                                         dum=readword();
-                                        _colors[0]=dum>>12;
-                                        _colors[1]=0xf & (dum>>8);
-                                        _colors[2]=0xf & (dum>>4);
-                                        _colors[3]=0xf & (dum);
-                                        break;          
-                                case 0xff:
-                                        break;
-                                case 04: // alpha channel
-                                         //4 nibble= 16 bits
-                                        if(left<2)
-                                         {
-                                            printf("Command 4: Alpha: Not enough bytes left\n");
-                                            return 1; 
-                                         }
-
-                                        dum=readword();
-                                        _alpha[0]=dum>>12;
-                                        _alpha[1]=0xf & (dum>>8);
-                                        _alpha[2]=0xf & (dum>>4);
-                                        _alpha[3]=0xf & (dum);
-                                        break;
-                                case 05:
-                                        // Coordinates 12 bits per entry X1/X2/Y1/Y2
-                                        // 48 bits total / 6 bytes
-                                        {
-                                                uint16_t a,b,c;
-                                                uint32_t nx1,nx2,ny1,ny2;
-                                                if(left<6)
-                                                {
-                                                    printf("Command 5: Coord: Not enough bytes left\n");
-                                                    return 1; 
-                                                }
-                                                if(doneA) return 1;
-                                                doneA++;
-                                                a=readword();
-                                                b=readword();
-                                                c=readword();
-                                                nx1=a>>4;
-                                                nx2=((a&0xf)<<8)+(b>>8);
-                                                ny1=((b&0xf)<<4)+(c>>12);
-                                                ny2=c&0xfff;
-                                                
-                                                aprintf("vobsuv: x1:%d x2:%d y1:%d y2:%d\n",nx1,nx2,ny1,ny2);
-                                                
-                                                if(nx1==_x1 && nx2==_x2 && ny1==_y1 && ny2==_y2 && _original)
-                                                {       // Reuse old bitmap
-                                                        _original->clear();
-                                                }
-                                                else
-                                                {
-                                                  if(_original)
-                                                        delete _original;
-                                                  _original=NULL;
-                                                  _x1=nx1;
-                                                  _x2=nx2;
-                                                  _y1=ny1;
-                                                  _y2=ny2;
-                                                  _subW=_x2-_x1+1;
-                                                  _subH=_y2-_y1+1;                                                
-                                                  _original=new vobSubBitmap(_subW,_subH);
-                                                }
-                                                                        
-                                        }
-                                        break;
-                                case 06: // RLE offset 
-                                        // 2*16 bits : odd offset, even offset
-                                        {
-                                                if(doneB) return 1;
-                                                doneB++;
-                                                if(left<4)
-                                                {
-                                                    printf("Command 6: RLE: Not enough bytes left\n");
-                                                    return 1; 
-                                                }
-                                        odd=readword();                                        
-                                        even=readword();
- 
-                                        }
-                                        break;   
-                                default:                                                     
-                                        printf("Unknown command:%d\n",command);
-                                        return 0;
-                                  
-                        } //End switch command     
-                }// end while
-        }
-        _parser->getPos(&posA,&posR);
-        /*****/
-        if(_original && odd && even) 
-        {
-                _original->clear();
-                decodeRLE(odd,0,even);
-                decodeRLE(even,1,0);
-                if(!_vobSubInfo->hasPalette)
-                {
-                        // guess palette   
-                        guessPalette();
-                }
-        }
-        /*****/
-  }   // Next picture  
-  return 1;
-}
-/*
-    Try to guess the palette...
-*/
-uint8_t ADMVideoVobSub::guessPalette(void)
-{
- int  stat[4];
- uint32_t sum,sumalpha,y,x;
- uint8_t *in,*inmax,*inalpha;
- int background,foreground,candidate1,candidate2;
- 
-    memset(stat,0,4*sizeof(int));
-   
-    in=_original->_bitmap ;
-    y=_original->_width*_original->_height;
-    inmax=in+y;
-    for(x=0;x<y;x++)
-    {
-        stat[(*in)&0x03]++;
-        in++; 
-           
-    }  
-    // normally just between 0 & 3
-    sum=stat[0]+stat[1]+stat[2]+stat[3];
-   
-    #define PERC(x) stat[x]*=10000;stat[x]/=sum;//alpha[x]*=1000;alpha[x]/=sumalpha;
-    PERC(0);
-    PERC(1);
-    PERC(2);
-    PERC(3);
-    int nbColor=0;
-    for(int i=0;i<4;i++) 
-    {
-        printf("Color : %d percent :%d \n",i,stat[i]);
-    }
-#define NB_COLOR nbColor=0;for(int i=0;i<4;i++) if(stat[i]) nbColor++;
-#define SEARCH_MAX(OUT) max=0;for(int o=0;o<4;o++) if(stat[o]>max) {max=stat[o];OUT=o;}stat[OUT]=0;
-#define SET_COLOR(x,color) for(int k=0;k<4;k++) _YUVPalette[x+4*k]=color;
-    // Search Max
-    int max=0;
-    memset(_YUVPalette,0,sizeof(_YUVPalette));
-    
-    // The most common color is background
-    SEARCH_MAX(background);
-    SET_COLOR(background,0);
-    printf("Background is %d\n",background);
- 
-    // Search for A/B /C
-    in=_original->_bitmap ;
-    while(in<inmax)
-    {
-        if(*in!=background) break;
-        in++;   
-    };
-    candidate1=*in; 
-    while(in<inmax)
-    {
-        if(*in!=candidate1) break;
-        in++;   
-    };
-    // if we have background / candidate / candidate2
-    //  we consider candidate to be blending and candidate2 to be solid
-    candidate2=*in;
-    if(candidate2!=background)
-    {
-        SET_COLOR(candidate1,0x40);
-        SET_COLOR(candidate2,0xFF); 
-    }else 
-    // We have background / candidate / background
-    // candidate is then considered solid color
-    {
-        SET_COLOR(candidate2,0xff);
-    }
-    return 1;
-    
-}
-
-vobSubBitmap::vobSubBitmap(uint32_t w, uint32_t h)
-{
-  uint32_t page;
-  
-  _width=w;
-  _height=h;
-  
-  page=w*h;
-   
-
-  _bitmap=new uint8_t [page];
-  _alphaMask=new uint8_t [page];
-  _dirty=new uint8_t[h];                                                
-  clear();
-}
-uint8_t vobSubBitmap::isDirty(uint32_t line)
-{
-        ADM_assert(line<_height);
-        if(_dirty[line]) return 1;
-        return 0;
-
-}
-uint8_t vobSubBitmap::setDirty(uint32_t line)
-{
-        ADM_assert(line<_height);
-        _dirty[line]=1;
-        return 1;
-}
-vobSubBitmap::~vobSubBitmap()
-{
-#define CLN(x) if(x) delete [] x;
-
-  CLN(_bitmap);
-  CLN(_alphaMask);  
-  CLN(_dirty);
-}
-void vobSubBitmap::clear(void)
-{
-#define CLR(x) memset(x,0,_width*_height);
-
-  CLR(_bitmap);
-  CLR(_alphaMask);
-  memset(_dirty,0,_height);
-}
-
-//***********************************************************
-// Convert the palette bitmap into yuv + alphamask bitmap
-//
-//***********************************************************
-uint8_t vobSubBitmap::buildYUV( int16_t *palette )
-{
-  
-  uint8_t *ptr;
-
-  ptr=_bitmap;      
-        
-  for(uint32_t y=0;y<_width*_height;y++)
-  {
-    *ptr=palette[*ptr];
-    ptr++;  
-  }
-  return 1;
-}
-//***********************************************************
-//
-//      Resample the square beginning at position = oldtop with a height of oldheigh
-//        to a square of size new, newy
-//
-//***********************************************************
-uint8_t vobSubBitmap::subResize(vobSubBitmap **tgt,uint32_t newx,uint32_t newy,uint32_t oldtop, uint32_t oldheight)
-{
-  int flags=0;
-  SwsContext *ctx=NULL;
-  int er=0;
-  
-  aprintf("Sub Resize : top %lu height %lu -> %lu %lu\n",oldtop, oldheight,newx, newy);
-  
-#if 0  
-//#ifdef USE_MMX
-                
-#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
-                ADD(MMX,MMX);           
-                ADD(3DNOW,3DNOW);
-                ADD(MMXEXT,MMX2);
-#endif  
-  flags+=SWS_BILINEAR;
-  // Need a new one ?
-  // Or reuse the old one ?
-  if(*tgt && (*tgt)->_width==newx && (*tgt)->_height==newy)
-  {
-    (*tgt)->clear(); // useless FIXME
-  }
-  else
-  {
-    if(*tgt) delete *tgt;
-    *tgt=NULL;
-    *tgt=new  vobSubBitmap(newx,newy);    
-  }
-  
-  // Need to resize ?
-  if(oldheight==newy && _width==newx)
-  {
-    uint8_t *src,*dst;
-    aprintf("No need to resize\n");
-    src=_bitmap+oldtop*_width;
-    dst=(*tgt)->_bitmap;
-    memcpy(dst,src,newx*newy); 
-    
-    src=_alphaMask+oldtop*_width;
-    dst=(*tgt)->_alphaMask;
-    memcpy(dst,src,newx*newy); 
-    
-    return 1;    
-  }
-  
-  ctx=sws_getContext(
-  _width,oldheight,
-  PIX_FMT_GRAY8,
-  newx,newy,
-  PIX_FMT_GRAY8,
-  flags,
-  NULL, NULL,NULL);
-
-  ADM_assert(ctx);
-    
-  //************************
-  uint8_t *src[3];
-  uint8_t *dst[3];
-  int ssrc[3];
-  int ddst[3];
-  
-
-  //resize bitmap
-  
-  src[0]=_bitmap+oldtop*_width;
-  src[1]=NULL;
-  src[2]=NULL;
-
-  ssrc[0]=_width;
-  ssrc[1]=ssrc[2]=0;
-
-  
-  dst[0]=(*tgt)->_bitmap;
-  dst[1]=NULL;
-  dst[2]=NULL;
-  
-  ddst[0]=newx;
-  ddst[1]=ddst[2]=0;
-
-  er=sws_scale(ctx,src,ssrc,0,oldheight,dst,ddst);
-  aprintf("Er:%d\n",er);
-  
-  // And alpha
-  src[0]=_alphaMask+oldtop*_width;  
-  dst[0]=(*tgt)->_alphaMask;
-  er=sws_scale(ctx,src,ssrc,0,_height,dst,ddst);
-  aprintf("Er:%d\n",er);
-  // end
-  sws_freeContext(ctx); 
-  return 1;             
-}
-
-//EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobsub.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobsub.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobsub.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,672 +0,0 @@
-//
-// C++ Implementation:Spudecoder (subs for DVd like stream)
-//
-// Description:
-//
-//
-// Author: Mean, fixounet at free.fr
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-// see http://sam.zoy.org/writings/dvd/subtitles/
-
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-#include <ADM_assert.h>
-
-#include "config.h"
-#include "fourcc.h"
-#include "avio.hxx"
-#include "config.h"
-#include "avi_vars.h"
-
-
-
-#include "ADM_toolkit/toolkit.hxx"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_filter/video_filters.h"
-
-
-#include "ADM_toolkit/filesel.h"
-
-#include "ADM_colorspace/colorspace.h"
-
-#include "ADM_vobsubinfo.h"
-
-#define VOBSUB "/capture/sub/phone.sub"
-
-#include "ADM_vidVobSub.h"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_FILTER
-#include "ADM_osSupport/ADM_debug.h"
-
-
-extern uint8_t DIA_vobsub(vobSubParam *param);
-
-static FILTER_PARAM vobsubParam={3,{"subname","index","subShift"}};
-//*************************************************************
-//
-
-//*************************************************************
-SCRIPT_CREATE(vobsub_script,ADMVideoVobSub,vobsubParam);
-BUILD_CREATE(vobsub_create,ADMVideoVobSub);
-//*************************************************************
-uint8_t ADMVideoVobSub::configure(AVDMGenericVideoStream *in)
-{
-
-       
-  if(DIA_vobsub(_param))
-       {
-                cleanup();
-                setup();
-                return 1;
-       }
-        
-        return 0;        
-}
- 
-//*************************************************************
-char *ADMVideoVobSub::printConf( void )
-{
-        static char buf[50];
-        
-        sprintf((char *)buf," VobSub");
-        return buf;
-}
-//*************************************************************
-ADMVideoVobSub::ADMVideoVobSub(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-        _in=in;         
-        memcpy(&_info,_in->getInfo(),sizeof(_info));    
-        _info.encoding=1;       
-        _parser=NULL;  
-        _resampled=NULL;
-        _chromaResampled=NULL;
-        _original=NULL;        
-        
-        _param=NEW(vobSubParam);
-        
-        if(couples)
-        {                 
-                GET(subname);
-                GET(index);                               
-                GET(subShift);  
-        }
-        else
-        {
-#ifdef KK_ADM_DEBUG
-                _param->subname=ADM_strdup(VOBSUB);
-#else                
-                _param->subname =NULL;
-#endif                
-                _param->index = 0;   
-                _param->subShift=0;             
-        }
-        
-        setup();
-}
-/*
-    Alternate constructor for use by OCR
-*/
-ADMVideoVobSub::ADMVideoVobSub(  char *fileidx,uint32_t idx)
-{
-
-        _in=NULL;         
-        memset(&_info,0,sizeof(_info));    
-        _info.encoding=1;       
-        _parser=NULL;  
-        _resampled=NULL;
-        _chromaResampled=NULL;
-        _original=NULL;        
-        
-        _param=NEW(vobSubParam);
-        
-        
-        _param->subname=ADM_strdup(fileidx);
-        _param->index = idx;   
-        _param->subShift=0;                    
-        
-        setup();
-}
-/*
-    Returns bitmap & info for the Nth subs
-*/
-
-vobSubBitmap *ADMVideoVobSub::getBitmap(uint32_t nb,uint32_t *start, uint32_t *end,uint32_t *first,uint32_t *last)
-{
-uint32_t top=0,bottom=0;
-    ADM_assert(_vobSubInfo);
-    ADM_assert(nb<_vobSubInfo->nbLines);
-    
-    // Seek & decode
-    //_parser->_asyncJump2(0,_vobSubInfo->lines[nb].fileOffset);
-    _parser->setPos(_vobSubInfo->lines[nb].fileOffset,0);
-    if(!handleSub(nb))
-        {
-                printf("Error reading getBimap\n");
-                *first=*last=0;
-                return _original; // might be null (?)
-        }
-    *first=*last=0;
-    if(_original)
-    {
-    uint32_t ox,oy;
-        _original->buildYUV(_YUVPalette);
-        ox=_original->_width;        
-        oy=_original->_height;
-        printf("Original :%lu x %lu (original  %d)\n",ox,oy,_vobSubInfo->height);
-        ADM_assert(oy<=_vobSubInfo->height);
-        
-        // Search the 1st/last non null line
-//#define DONTCLIP
-#ifdef DONTCLIP     
-         *first=0;
-         *last=oy-1;   
-#else
-        if(oy>_original->_height) oy=_original->_height-1;
-
-        while(top<oy && !_original->isDirty(top) ) top++;
-        
-        if(top==oy)
-        {
-                top=bottom=0;   // Empty bitmap ?
-                *first=top;
-                *last=bottom;
-                printf("Empry bitmap\n");
-                return NULL; 
-        }
-        bottom=oy-1;
-        while(bottom>top && !_original->isDirty(bottom)) bottom--;
-        
-        // If true it means we have 2 subs, one on top, one on bottom
-        //
-#if 0
-        if(bottom>(oy>>1) && top<(oy>>1) && (bottom-top>(oy>>1)))
-        {
-          // in that case, take only the lower one
-          top=oy>>1;
-          while(top<oy && !_original->isDirty(top)) top++;                    
-        }
-        printf("> clipped: %lu / %lu=%lu\n",top,bottom,bottom-top+1);
-#endif
-        *first=top;
-        *last=bottom;
-#endif
-    }
-    *start=_vobSubInfo->lines[nb].startTime;
-    *end=_vobSubInfo->lines[nb].stopTime;
-    return _original;
-}
-/*
-    Returns the nb of lines found in the sub
-*/
-uint32_t     ADMVideoVobSub::getNbImage( void)
-{
-    if(!_parser) return 0;
-    if(!_param) return 0;
-    if(!_vobSubInfo) return 0;
-    return _vobSubInfo->nbLines;
-
-}
-//************************************
-uint8_t ADMVideoVobSub::setup(void)
-{
-  char *dup;
-  int l;
-  
-   _vobSubInfo=NULL;
-   if(_param->subname && strlen(_param->subname)>5)
-        {
-                printf("Opening %s\n",_param->subname);
-                dup=ADM_strdup(_param->subname);
-                l=strlen(dup);
-                if(l>5)
-                  if(dup[l-4]=='.')
-                {
-                  dup[l-3]='s';
-                  dup[l-2]='u';
-                  dup[l-1]='b';
-                          
-                }
-                if(vobSubRead(_param->subname,_param->index,&_vobSubInfo))
-                {
-                        printf("Opening index \n");
-                       
-                        MPEG_TRACK track;
-                        memset(&track,0,sizeof(track));
-                        track.pes=_param->index+0x20;
-                        track.pid=0;
-                       // _parser=new ADM_mpegDemuxerProgramStream(_param->index+0x20,0xe0);
-                        _parser=new dmx_demuxerPS(1,&track,0);
-                        if(!_parser->open(dup))
-                        {
-                                printf("Mpeg Parser : opening %s failed\n",_param->subname);
-                                delete _parser;
-                                _parser=NULL;
-                
-                         }
-                         
-                }
-                ADM_dealloc(dup);
-        }
-        
-        
-        if(!_parser)
-        {
-                printf("opening of vobsub file failed\n");
-        }
-         else
-        {       // Recompute sub duration
-                uint32_t end;
-                vobSubLine *cur,*next;
-                // Assuming max displat time = MAX_DISPLAY_TIME
-                for(uint32_t i=0;i<_vobSubInfo->nbLines-1;i++)
-                {
-                        if(i && !_vobSubInfo->lines[i].startTime)
-                        {
-                                _vobSubInfo->lines[i].startTime=0xf0000000;
-                                _vobSubInfo->lines[i].stopTime=0xf0000001;
-                                
-                        }
-                        else
-                        {
-                                cur=&_vobSubInfo->lines[i];
-                                next=&_vobSubInfo->lines[i+1];
-                        
-                                end=cur->startTime+MAX_DISPLAY_TIME;
-                                if(end>=next->startTime) end=next->startTime-1;
-                                cur->stopTime=end;                                
-                        }
-                }
-                _vobSubInfo->lines[_vobSubInfo->nbLines-1].stopTime=
-                        MAX_DISPLAY_TIME+_vobSubInfo->lines[_vobSubInfo->nbLines-1].startTime;
-                // Convert all the palette from RGB to YUV
-                paletteYUV();
-        }
-      
-        _x1=_y1=_x2=_y2=0;
-        _data=new uint8_t [VS_MAXPACKET];
-        _subSize=0;
-        _subW=_subH=0;
-        
-        memset(&_original,0,sizeof(_original));
-        _currentSub=NOSUB;
-        _initialPts=0;
-                
-
-}
-//*************************************************************
-uint8_t ADMVideoVobSub::cleanup(void)
-{
-
-        if(_parser) delete _parser;
-        _parser=NULL;
-        
-        if(_original)
-          delete _original;
-        _original=NULL;        
-        
-        if(_resampled)
-          delete _resampled;
-        _resampled=NULL;
-        
-        if(_chromaResampled)
-          delete _chromaResampled;
-        _chromaResampled=NULL;
-        
-        
-        if(_data) delete [] _data;
-        _data=NULL;
-        
-        if(_vobSubInfo) destroySubInfo( _vobSubInfo);
-        _vobSubInfo=NULL;
-        
-
-}
-//*************************************************************
-ADMVideoVobSub::~ADMVideoVobSub()
-{
-        cleanup();
-         if(_param)
-        {
-                if(_param->subname)  ADM_dealloc(_param->subname);
-                DELETE(_param);
-        }
-        _param=NULL;
-}
-
-//*************************************************************
-uint8_t ADMVideoVobSub::getCoupledConf( CONFcouple **couples)
-{
-                        ADM_assert(_param);
-                        *couples=new CONFcouple(3);
-
-#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
-                        if(_param->subname)
-                                CSET(subname);
-                        else
-                          (*couples)->setCouple("subname","none") ;
-                        CSET(index);
-                        CSET(subShift);
-                        
-
-                        return 1;
-}
-//*************************************************************
-uint8_t ADMVideoVobSub::getFrameNumberNoAlloc(uint32_t frame,
-                                uint32_t *len,
-                                ADMImage *data,
-                                uint32_t *flags)
-{
-
-uint64_t time;
-uint32_t sub;
-
-        if(frame>= _info.nb_frames) return 0;
-        // read uncompressed frame
-        if(!_in->getFrameNumberNoAlloc(frame, len,data,flags)) return 0;
-
-        if(!_parser)        
-        {
-                //
-                printf("No valid vobsub to process\n");
-                
-                return 1;
-        
-        }
-        
-        time=(frame+_info.orgFrame);
-        time=(time*1000*1000)/_info.fps1000;
-        
-        sub=lookupSub(time);  
-        // Should we re-use the current one ? 
-        if(sub==NOSUB)
-        {
-                aprintf("No matching sub for time %llu frame%lu\n",time,frame);
-                return 1;
-        }
-        // If it is a new sub, decode it...
-        if(sub!=_currentSub )
-        {                
-                // _parser->_asyncJump2(0,_vobSubInfo->lines[sub].fileOffset);
-                _parser->setPos(_vobSubInfo->lines[sub].fileOffset,0);
-                 //_initialPts=_parser->getPTS();
-                 handleSub(sub);
-                _currentSub=sub;
-                Palettte2Display(); // Create the bitmap
-                // Time to resize the bitmap
-                // First try : Do it bluntly
-                
-        }                
-        
-        // and if there is something to display, display it
-        //
-        vobSubBitmap *src;
-        //src=_original;
-        src=_resampled;
-        
-        if(src)          
-        {
-               
-          aprintf("We have %lu %lu to merge\n",src->_width,src->_height);
-                // Merge
-                
-                uint32_t stridein,strideout,len;
-                uint8_t *in,*out,*mask,*in2;
-                uint16_t old,nw,alp;
-                uint32_t xx,yy;
-                
-                stridein=src->_width;
-                strideout=_info.width;
-                
-                if(strideout>stridein)
-                {
-                        len=stridein;
-                        xx=src->_width;
-                }
-                else
-                {
-                        xx=_info.width;
-                        len=strideout;
-                }
-                if(src->_height>_info.height) yy=_info.height;
-                        else                 yy=src->_height;           
-                in=src->_bitmap;
-                mask=src->_alphaMask;
-               
-                out=data->data+_info.width*src->placeTop;
-                // auto center
-                uint32_t center=_info.width-src->_width;
-                out+=(center>>2)*2;
-                
-                for(uint32_t y=0;y<yy;y++)
-                {
-                  for(uint32_t x=0;x<xx;x++)
-                        {
-                               old=out[x];
-                               nw=in[x];
-                               alp=mask[x];
-
-                                if(alp) 
-                                {
-                                  if(alp>7)  nw=old*(16-alp-1)+(alp+1)*nw;
-                                        else nw=old*(16-alp)+(alp)*nw;
-                                  out[x]=nw>>4;                                         
-                                }
-
-                               //out[x]=nw;
-                        }
-                        //memcpy(out,in,len);
-                        out+=strideout;
-                        in+=stridein;
-                        mask+=stridein;
-                }
-                
-                // Now do chroma u & chroma V
-#define DOCHROMA                
-#if defined(DOCHROMA)                
-                uint32_t crosspage=(_info.width*_info.height)>>2;
-                
-                strideout=_info.width>>1;
-                stridein=_chromaResampled->_width;
-                
-                out=data->data+_info.width*_info.height;
-                out+=(src->placeTop>>1)*(_info.width>>1);
-                mask=_chromaResampled->_alphaMask;
-                // Center
-                out+=(center>>2)*1;
-                if(strideout>stridein) xx=stridein;
-                else            xx=strideout;
-                
-                int16_t left=(_info.height>>1)-(_chromaResampled->_height+(_original->placeTop>>1));
-                
-                if(left<_chromaResampled->_height) yy=left;
-                else yy=_chromaResampled->_height;
-                
-                for(uint32_t y=0;y<yy;y++)
-                {
-                   for(uint32_t x=0;x<xx;x++)
-                   {
-                        if(mask[x]>10)         
-                        {
-                          int16_t val;
-                          val=out[x];
-                          val-=128;
-                         
-                          
-                          
-                          nw=val*(16-alp);
-                          
-                          val/=4;
-                          val=val+128;
-                                
-                          out[x]=val; 
-                          out[crosspage+x]=val;
-                        }                                                 
-                   }
-                   out+=strideout;
-                   mask+=stridein;
-                }
-#endif                
-        }
-        return 1;
-}
-//*************************************************************************
-//
-//      Convert the original bitmap to a rescaled & repositionned one
-//      that will be blended into the current picutr
-//
-//*************************************************************************
-uint8_t ADMVideoVobSub::Palettte2Display( void )
-{
-        ADM_assert(_parser);
-        ADM_assert(_vobSubInfo);
-     
-        // Then Process the RLE Datas
-        // To get the _bitmap yuv data
-        ADM_assert(_original);
-        
-        // Set correct color
-        _original->buildYUV(_YUVPalette);
-        
-        // rebuild the scaled one
-        // Compute the target size
-        uint32_t fx,fy;
-        uint32_t ox,oy;
-        uint32_t sx,sy;
-        /*
-                Fx, fy : Final size of the image (i.e size of the current picture)
-                ox,oy  : Original size of the image where the sub is coming from
-                sx,sy  : Size of the  sub
-        
-                And we want the final size of the sub
-                        + coordinates but that we will do later
-        
-        */
-        
-        fx=_info.width;
-        fy=_info.height;
-        
-        ox=_vobSubInfo->width;
-        oy=_vobSubInfo->height;
-        
-        sx=_subW;
-        sy=_subH;
-        
-        // Search the 1st/last non null line
-        uint32_t top=0,bottom=0;
-
-        if(oy>_original->_height) oy=_original->_height-1;
-
-        while(top<oy && !_original->isDirty(top)) top++;
-        
-        bottom=_original->_height-1;
-        if(top==bottom)
-        {
-                printf("Empty sub ?");
-                return 0;
-        }
-        
-        while(bottom && !_original->isDirty(bottom)) bottom--;
-        
-        // If true it means we have 2 subs, one on top, one on bottom
-        //
-        if(bottom>(oy>>1) && top<(oy>>1) && (bottom-top>(oy>>1)))
-        {
-          // in that case, take only the lower one
-          top=oy>>1;
-          while(top<oy && !_original->isDirty(top)) top++;                    
-        }
-        //
-        //  The useful part is between top & bottom lines
-        //
-        
-        // Shrink factor
-        // The shrink factor is the one used to shrink from the original video
-        // to the resize video
-        
-        double scale,l;
-        scale=fx;
-        scale/=ox;
-        printf("top %lu : bottom :%lu Scale :%f ox:%lu oy:%lu fx:%lu \n",top,bottom,scale,ox,oy,fx);
-        
-        // We rescale the sub by the same factor
-        // Only the visible / useful part
-        l=scale;
-        l=l*sx;
-        sx=(uint32_t )floor(l);
-        
-       
-        l=scale;
-        l=l*(bottom-top);
-        sy=(uint32_t )floor(l);
-        
-
-        // And we resize that useful part of sub
-        // to our final bitmap (resampled)
-                
-        _original->subResize(&_resampled,sx,sy,top, bottom-top);
-                
-        uint32_t tail;
-        
-        // Set the position of the sub so that it is ok
-        
-        tail=16+sy;
-        
-        if(tail>fy) tail=0;
-        else
-        {
-            tail=fy-tail;           
-        }
-        
-        _resampled->placeTop=tail;
-        
-        _resampled->subResize(&_chromaResampled,sx>>1,sy>>1,0,sy);
-        return 1;
-}
-
-//
-//      Return the index in the sub table of the sub matching the time
-//
-uint32_t ADMVideoVobSub::lookupSub(uint64_t time)
-{
-int64_t head,tail, cur;
-int32_t i;
-        cur=(int64_t)time;
-        i=0;
-        while(i<_vobSubInfo->nbLines-1)
-        {
-                head=(int64_t)_vobSubInfo->lines[i].startTime;
-                tail=(int64_t) _vobSubInfo->lines[i].stopTime;
-                head+=_param->subShift;
-                tail+=_param->subShift;
-                if(head<=cur &&tail>cur)
-                {
-                  aprintf("Matching for time %llu : sub %lu starting at :%lu (shift %lu)\n",
-                                        time,i,_vobSubInfo->lines[i].startTime,_param->subShift);
-                        return i; 
-                }   
-                if(head>cur) return NOSUB;                   
-                i++;       
-        }
-        return NOSUB;
-
-
-}
-//EOF
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,265 +0,0 @@
-//
-// C++ Implementation: vobsub parser
-//
-// Description:
-//
-//
-// Author: Mean, 2005 GPL
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-#include "ADM_utilities/default.h"
-#include "ADM_vobsubinfo.h"
-
-static uint8_t fillLine(char *str,VobSubInfo *sub,uint32_t line);
-static uint32_t countLine(FILE *f,int index);
-uint8_t fillPalette(char *str,VobSubInfo *sub);
-
-uint8_t destroySubInfo(VobSubInfo *sub)
-{
-        if(!sub) return 1;      // ?
-        if(sub->lines) delete [] sub->lines;
-        delete sub;
-        return 1;
-
-
-}
-//****************** 
-// Extract Line info
-//******************
-uint8_t fillLine(char *str,VobSubInfo *sub,uint32_t line)
-{
-int hh,mm,ss,ms,o;
-uint64_t ti;
-uint32_t pos;
-
-        ADM_assert(line<sub->nbLines);
-
-        o=sscanf(str,"timestamp: %d:%d:%d:%d, filepos: %x\n",&hh,&mm,&ss,&ms,&pos);
-        ADM_assert(o==5);
-        
-        ti=hh*3600+mm*60+ss;
-        ti=ti*1000+ms;
-        
-        sub->lines[line].startTime      =ti;
-        sub->lines[line].stopTime       =ti+1000;
-        sub->lines[line].fileOffset     =pos;
-        
-        return 1;
-}
-//******************
-// Extract palette
-//******************
-uint8_t fillPalette(char *str,VobSubInfo *sub)
-{
-int p[16],o;
-
-        o=sscanf(str,"palette: %x, %x, %x, %x, %x, %x, %x, %x,"
-                                " %x, %x, %x, %x, %x, %x, %x, %x",
-                                &p[0],&p[1],&p[2],&p[3],&p[4],&p[5],&p[6],&p[7],
-                                &p[8],&p[9],&p[10],&p[11],&p[12],&p[13],&p[14],&p[15]);
-        ADM_assert(o==16);
-        for(int i=0;i<16;i++)
-                sub->Palette[i]=p[i];
-                                       
-        return 1;
-}
-//******************
-//******************
-uint8_t vobSubRead(char *filename,int index,VobSubInfo **info)
-{
-FILE            *file=NULL;
-uint32_t        nb_lines;
-VobSubInfo      *sub=NULL;
-uint8_t         success=0;
-uint32_t        line=0,l;
-char            str[1024];
-char            *dup;
-int             language=0;
-
-        if(!filename)
-        {
-                printf("Null file ?\n");
-                return 0;
-        }
-        *info=NULL;
-        file=fopen(filename,"rt");
-        if(!file) 
-        {
-                printf("Could not open %s file\n",filename);
-                return 0;
-        }
-        nb_lines=countLine(file,index);
-        if(!nb_lines)
-        {
-                printf("Empty file\n");
-                 goto subAbort;
-        }
-        // Try to read the file
-        sub=new VobSubInfo;
-        memset(sub,0,sizeof(VobSubInfo));
-        //
-        sub->nbLines=nb_lines;
-        sub->lines=new vobSubLine[nb_lines];
-        memset(sub->lines,0,sizeof(vobSubLine)*nb_lines);
-        printf("Rebuilding %d lines of subs\n",nb_lines);
-        
-        while(line<nb_lines && !feof(file))
-        {
-                fgets(str,1023,file); 
-                if(!strncmp(str,"palette:",7))
-                {
-                                 fillPalette(str,sub);
-                                 sub->hasPalette=1;
-                }
-                else 
-                {
-                        if(!strncmp(str,"timestamp: ",10) && language)        
-                        {
-                                fillLine(str,sub,line);
-                                line++;
-                        }
-                        else
-                        {
-                                if(!strncmp(str,"id:",3))       // Catch language/index
-                                {
-                                  int  l;
-                                  char s[50];
-                                  s[0]=0;
-                                  l=999;
-                                  sscanf(str,"id: %s index: %d",s,&l);
-                                  printf("Found lang : %s index %d while searching %d\n",s,l,index);
-                                  if(l==index)
-                                  {
-                                	  language=1;
-                                	  printf("Match\n");
-                                  }
-                                  else language=0;                                                                              
-                                
-                                }
-                                else
-                                {
-                                        if(!strncmp(str,"size:",5))       // Catch original screen dimension
-                                        {
-                                            sscanf(str,"size:%"SCNu32"x%"SCNu32"",&(sub->width),&(sub->height));
-                                        }
-                                
-                                }
-                                
-                        }
-                }
-        }
-subSuccess:        
-        success=1;
-        if(!sub->hasPalette)
-        {
-            for(int j=0;j<16;j++)
-                sub->Palette[j]=j;   
-        }
-subAbort:        
-        if(success)
-        {
-                *info=sub;
-        }
-        else
-        {
-                destroySubInfo( sub);        
-        }
-        fclose(file);
-        return success;
-
-}
-//******************
-// count #nb beginning by timestamp in file
-//******************
-uint32_t countLine(FILE *f,int index)
-{
-char str[1024],s[1024];
-uint32_t nb=0;
-uint32_t match=0;
-int lang;
-
-        fseek(f,0,SEEK_SET);
-        while(!feof(f))
-        {
-                fgets(str,1023,f);
-                if(!strncmp(str,"id:",3))
-                {
-                  s[0]=0;
-                  lang=9999;
-                  sscanf(str,"id: %s index: %d",s,&lang);
-                  if(lang==index) match=1;
-                  else match=0;
-                }
-                else
-                  if(match)
-                        if(!strncmp(str,"timestamp: ",10)) nb++;
-        
-        }
-        fseek(f,0,SEEK_SET);
-        return nb;
-}
-//*****************************************
-vobSubLanguage *vobSubAllocateLanguage(void)
-{
-  vobSubLanguage *l;
-  l=new vobSubLanguage;
-  memset(l,0,sizeof(vobSubLanguage));
-  return l;  
-}
-//*****************************************
-uint8_t vobSubDestroyLanguage(vobSubLanguage *lingua)
-{
-  for(uint32_t i=0;i<lingua->nbLanguage;i++)  
-    delete [] lingua->language[i].name;
-  delete lingua; 
-  return 1;
-}
-//*****************************************
-uint8_t vobSubGetLanguage(const char *filename,vobSubLanguage *lingua)
-{
-  char str[1024];
-  char s[16];
-  uint32_t nb=0,index;
-  FILE *fd=NULL;
-  
-  fd=fopen(filename,"rb");
-  if(!fd) return 0;
-  
-  
-
-  
-  while(!feof(fd))
-  {
-    fgets(str,1023,fd);
-    if(!strncmp(str,"id: ",3))
-    {
-      sscanf(str,"id: %s index: %d",s,&index);
-      lingua->language[nb].name=new char[3];
-      lingua->language[nb].name[0]=str[4];
-      lingua->language[nb].name[1]=str[5];
-      lingua->language[nb].name[2]=0;
-      //
-      lingua->language[nb].index=index;
-      nb++;
-    }        
-  }
-  lingua->nbLanguage=nb;
-  return 1;
-}
-
-//EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -1,60 +0,0 @@
-//
-// C++ Interface: Vobsubinfo struct & prototyping
-//
-// Description: Read the idx part of an index file
-//
-//
-// Author: mean , fixounet at free.fr, GPL (C) 2005
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef _VOBSUB_INFO_
-#define _VOBSUB_INFO_
-#define ADM_MAX_LANGUAGE 33
-typedef struct vobSubLine
-{
-        uint32_t        startTime;      /// Starting time in ms
-        uint32_t        stopTime;       /// Stop time
-        uint64_t        fileOffset;     /// Offset in the file where this sub starts
-
-}vobSubLine;
-typedef struct vobSubOneLang
-{
-        char     *name;
-        uint32_t index;
-}vobSubOneLang;
-typedef struct vobSubLanguage
-{
-        uint32_t        nbLanguage; 
-        vobSubOneLang   language[ADM_MAX_LANGUAGE];  
-}vobSubLanguage;
-
-typedef struct VobSubInfo
-{
-        uint32_t        hasPalette;
-        uint32_t        Palette[16];
-        uint32_t        nbLines;
-        uint32_t        width;
-        uint32_t        height;
-        vobSubLine      *lines;
-}VobSubInfo;
-
-/// Read the sub and return a new filled out vobsub info struct
-uint8_t vobSubRead(char *filename,int index,VobSubInfo **info);
-uint8_t destroySubInfo(VobSubInfo *sub);
-
-uint8_t         vobSubGetLanguage(const char *filename,vobSubLanguage *lingua);
-vobSubLanguage  *vobSubAllocateLanguage(void);
-uint8_t         vobSubDestroyLanguage(vobSubLanguage *lingua);
-
-#endif
-// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-19 16:01:39 UTC (rev 3539)
@@ -9,12 +9,9 @@
 ADM_vidRaw.cpp        
 ADM_genvideo.cpp         
 ADM_vidFont.cpp
-ADM_vidVobsub.cpp
-ADM_vidVobSubRender.cpp
 ADM_interlaced.cpp       
 ADM_vidCached.cpp       
 ADM_vidMPdelogo.cpp      
-ADM_vobsubinfo.cpp
 ADM_vidClean.cpp        
 ADM_vidEqualizer.cpp  
 ADM_vidNull.cpp          

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-19 16:01:39 UTC (rev 3539)
@@ -11,20 +11,15 @@
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
  ADM_vidNull.cpp \
-	ADM_vidClean.cpp \
+ ADM_vidClean.cpp \
  ADM_genvideo.cpp \
  ADM_vidFieldUtil.cpp \
  ADM_vidFieldUtil.h \
  ADM_confCouples.cpp \
- ADM_confCouple.h ADM_vidCommonFilter.h \
  ADM_interlaced.cpp \
-	ADM_interlaced.h \
  ADM_vidRaw.cpp \
  ADM_cache.cpp \
  ADM_vidEqualizer.cpp \
- ADM_vidVobsub.cpp \
- ADM_vobsubinfo.cpp \
- ADM_vidVobSubRender.cpp \
  ADM_vidCNR2.cpp \
  ADM_vidMPdelogo.cpp \
  ADM_vidColorYuv.cpp  
@@ -32,55 +27,8 @@
 				
 
 
-EXTRA_DIST =  ADM_cache.cpp  \
-ADM_cache.h  \
-ADM_confCouple.h ADM_vidNull.cpp \
-ADM_confCouples.cpp  \
-ADM_genvideo.cpp \
-ADM_genvideo.hxx ADM_vidPartial.cpp \
-ADM_vidPartial.h \
-ADM_vidPartial_param.h \
-ADM_guiResize.cpp   ADM_vidRaw.cpp \
-ADM_interlaced.cpp  \
-ADM_interlaced.h ADM_vidResize.cpp \
-ADM_vidResize25.cpp \
-ADM_vidEqualizer.cpp  \
-ADM_mpdetc.cpp ADM_vidEqualizer.h   \
-ADM_mpdetc.h  \
-ADM_resizebis.cpp   \
-ADM_resizebis.hxx    \
-ADM_resizeter.cpp  ADM_vidField.h  \
-ADM_vidFieldUnblend.cpp \
-ADM_vidFieldUtil.cpp  \
-ADM_vidFieldUtil.h  \
-ADM_vidAnimated.cpp  \
-ADM_vidAnimated.h  \
-ADM_vidAnimated_param.h   \
-ADM_vidFont.cpp \
-ADM_vidFont.h \
-ADM_vidCNR2.cpp  \
-ADM_vidCNR2_param.h  ADM_vidTDeint_param.h \
-ADM_vidCached.cpp  ADM_vidTdeint.cpp \
-ADM_vidCached.h  ADM_vidIVTC.cpp \
-ADM_vidIVTC.h \
-ADM_vidChromaShift.cpp \
-ADM_vidChromaShift.h  \
-ADM_vidClean.cpp  \
-ADM_vidClean.h \
-ADM_vidColorYuv.cpp  \
-ADM_vidColorYuv.h  ADM_vidVobSub.h \
-ADM_vidColorYuv_param.h  ADM_vidVobSubRender.cpp \
-ADM_vidCommonFilter.h  ADM_vidMPLResize.cpp  ADM_vidVobsub.cpp \
-ADM_vidMPdelogo.cpp \
-ADM_vidMPdelogo.h \
-ADM_vobsubinfo.cpp \
-ADM_vobsubinfo.h \
-swscale_internal.h \
-ADM_vidTdeint_util.txt mmx_macros.h
+EXTRA_DIST =  
 
 ####### kdevelop will overwrite this part!!! (end)############
 INCLUDES = $(all_includes) -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil \
 			 $(FREETYPE_CFLAGS) $(ALTIVEC_SWITCH) -I../ADM_userInterfaces/ADM_commonUI -I../ADM_inputs
-noinst_HEADERS = ADM_mpdetc.h \
-  ADM_cache.h \
-ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/swscale_internal.h
===================================================================

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_mpdetc.h (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_mpdetc.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDvbSub.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDvbSub.h	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDvbSub.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -20,7 +20,7 @@
 #include "ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h"
 
 #include "ADM_codecs/ADM_ffmp43.h"
-#include "ADM_video/ADM_vidVobSubBitmap.h"
+#include "ADM_videoFilter/ADM_vidVobSubBitmap.h"
 
 
 #define READ_BUFFER_SIZE (64*1024)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSub.h (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSub.h	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSub.h	2007-08-19 16:01:39 UTC (rev 3539)
@@ -0,0 +1,81 @@
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _VOBSUB_V_
+#define _VOBSUB_V_
+#include "ADM_inputs/ADM_mpegdemuxer/dmx_demuxerPS.h"
+#define VS_MAXPACKET 128*1024
+
+#define NOSUB 0xffffffff
+
+#define MAX_DISPLAY_TIME 3000 // 3s
+
+//************************************
+typedef struct vobSubParam
+{
+        char            *subname;
+        uint32_t        index;
+        int32_t         subShift;
+}vobSubParam;
+//************************************
+#include "ADM_videoFilter/ADM_vidVobSubBitmap.h"
+//************************************
+class  ADMVideoVobSub:public AVDMGenericVideoStream
+ {
+
+ protected:
+        virtual char                    *printConf(void);
+        uint8_t                         guessPalette(void);
+        uint8_t                         readbyte(void);         /// Read a byte from buffer
+        uint16_t                        readword(void);         /// Read a 16 bits word from buffer
+        uint8_t                         forward(uint32_t v);    /// Read a 16 bits word from buffer
+        uint8_t                         decodeRLE(uint32_t off,uint32_t start,uint32_t end);
+        uint8_t                         setup(void);            /// Rebuild internal info
+        uint8_t                         cleanup(void);          /// Destroy all internal info
+        uint8_t                         paletteYUV( void );     /// Convert RGB Pallette to yuv
+        uint8_t                         Palettte2Display( void ); /// Convert the RLE to YUV bitmap
+        uint8_t                         handleSub( uint32_t idx );/// Decode a sub packet
+        uint32_t                        lookupSub(uint64_t time);/// Return sub index corresponding to time
+        
+        dmx_demuxerPS                   *_parser;        
+        uint8_t                         *_data;                 /// Data for packet
+        VobSubInfo                      *_vobSubInfo;           /// Info of the index file
+        vobSubParam                     *_param;
+        vobSubBitmap                    *_original;              /// True size (..) depacked vobsub
+        vobSubBitmap                    *_resampled;            /// Final one; to be blended in picture
+        vobSubBitmap                    *_chromaResampled;      /// Same as above but shinked by 2
+        uint32_t                        _x1,_y1,_x2,_y2;        /// sub boxing
+        uint32_t                        _subW,_subH;
+        uint8_t                         _displaying;            ///  Is display active
+        uint32_t                        _curOffset;
+        uint32_t                        _subSize;
+        uint32_t                        _dataSize;              /// Size of the data chunk
+        
+        uint8_t                         _colors[4];             /// Colors palette
+        uint8_t                         _alpha[4];              /// Colors alpha
+        int16_t                         _YUVPalette[16];        /// Luma only
+        uint32_t                        _currentSub;            ///
+        uint32_t                        _initialPts;
+ public:
+    /* This 3 functions are used by OCR */
+                        ADMVideoVobSub(  char *fileidx,uint32_t idx);
+              vobSubBitmap *getBitmap(uint32_t nb,uint32_t *start, uint32_t *end,uint32_t *first,uint32_t *last);
+              uint32_t     getNbImage( void);
+    /* /ocr */ 
+    
+                        ADMVideoVobSub(  AVDMGenericVideoStream *in,CONFcouple *setup);
+                        ~ADMVideoVobSub();
+        virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                                ADMImage *data,uint32_t *flags);
+        virtual uint8_t getCoupledConf( CONFcouple **couples)           ;
+        virtual uint8_t configure( AVDMGenericVideoStream *instream);
+                                                        
+};
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSubBitmap.h (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubBitmap.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobSubRender.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidVobsub.cpp (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidVobsub.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vobsubinfo.cpp (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vobsubinfo.h (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vobsubinfo.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-19 16:01:39 UTC (rev 3539)
@@ -35,8 +35,13 @@
 ADM_vidDelta.cpp 
 ADM_vidUnblend.cpp 
 ADM_vidAsharp.cpp
+ADM_vidVobsub.cpp
+ADM_vidVobSubRender.cpp
+ADM_vobsubinfo.cpp
+
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)
 add_definitions(${FT_CFLAGS})
 endif(FT_FOUND)
+include_directories(../ADM_inputs)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-19 13:46:48 UTC (rev 3538)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-19 16:01:39 UTC (rev 3539)
@@ -73,6 +73,9 @@
  ADM_vidContrast.cpp \
  ADM_vidDelta.cpp  \
  ADM_vidUnblend.cpp        \
+ ADM_vidVobsub.cpp \
+ ADM_vidVobSubRender.cpp \
+ ADM_vobsubinfo.cpp \
  ADM_vidCrop.cpp       
 			
 



From gruntster at mail.berlios.de  Mon Aug 20 05:26:44 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Aug 2007 05:26:44 +0200
Subject: [Avidemux-svn-commit] r3540 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708200326.l7K3QiYM002440@sheep.berlios.de>

Author: gruntster
Date: 2007-08-20 05:26:34 +0200 (Mon, 20 Aug 2007)
New Revision: 3540

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[QT] new slider

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp (from rev 3537, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp	2007-08-19 13:17:59 UTC (rev 3537)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp	2007-08-20 03:26:34 UTC (rev 3540)
@@ -0,0 +1,78 @@
+
+/***************************************************************************
+Custom slider
+***************************************************************************/
+
+/***************************************************************************
+*                                                                         *
+*   This program is free software; you can redistribute it and/or modify  *
+*   it under the terms of the GNU General Public License as published by  *
+*   the Free Software Foundation; either version 2 of the License, or     *
+*   (at your option) any later version.                                   *
+*                                                                         *
+***************************************************************************/
+
+#include "config.h"
+
+#include <math.h>
+#include <QPainter>
+#include <QSlider>
+
+#include "ADM_qslider.h"
+
+ADM_QSlider::ADM_QSlider(QWidget *parent) : QSlider(parent)
+{
+	frameCount = markerA = markerB = 0;
+}
+
+void ADM_QSlider::paintEvent(QPaintEvent *event)
+{
+	QSlider::paintEvent(event);	
+
+	if(markerA != 0 && markerB != frameCount)
+	{
+		int a = markerA, b = markerB;
+
+		if(markerA > markerB)
+		{
+			b = markerA;
+			a = markerB; 
+		}
+
+		int left = (a * width()) / frameCount;
+		int right = (b * width()) / frameCount;
+
+		QPainter painter(this);
+
+		painter.setPen(Qt::blue);
+		painter.drawRect(left, 1, right - left, height() - 3);
+		painter.end();
+	}
+}
+
+void ADM_QSlider::setMarkerA(uint32_t frameIndex)
+{
+	if(frameIndex > frameCount)
+		printf("[ADM_QSlider] Marker A is out of bounds (%u, %u)\n", markerA, frameCount);
+	else
+		markerA = frameIndex;
+
+	repaint();
+}
+
+void ADM_QSlider::setMarkerB(uint32_t frameIndex)
+{
+	if(frameIndex > frameCount)
+		printf("[ADM_QSlider] Marker B is out of bounds (%u, %u)\n", markerB, frameCount);
+	else
+		markerB = frameIndex;
+
+	repaint();
+}
+
+void ADM_QSlider::setFrameCount(uint32_t count)
+{
+	frameCount = count;
+}
+
+//EOF 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h	2007-08-19 16:01:39 UTC (rev 3539)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h	2007-08-20 03:26:34 UTC (rev 3540)
@@ -1,46 +1,18 @@
 #ifndef ADM_Q_SLIDER_H
 #define ADM_Q_SLIDER_H
-class ADM_QSlider : public QWidget
+
+class ADM_QSlider : public QSlider
 {
-        Q_OBJECT
-signals:
-void valueChanged(int value);
-public slots:
 protected:
-        QSlider *_slider;
-        uint32_t _max,_A,_B;
-        void paintEvent(QPaintEvent *ev);
-        int paintCount;
-        void resizeEvent ( QResizeEvent * event ) ;
+	uint32_t frameCount, markerA, markerB;
+	void paintEvent(QPaintEvent *event);
 
 public:
-        ADM_QSlider(QWidget *father); 
-        ~ADM_QSlider(); 
-        
-        void setA(uint32_t a);
-        void setB(uint32_t a);
-        void setNbFrames(uint32_t a);
-        int  value() const;
-         Qt::Orientation orientation() const;
+	ADM_QSlider(QWidget *parent = 0); 
 
-    void setMinimum(int);
-    int minimum() const;
-
-    void setMaximum(int);
-    int maximum() const;
-    
-    QSize sizeHint() const;
-    QSize minimumSizeHint() const;
- //   bool event(QEvent *event);
-    void setSizePolicy ( QSizePolicy horizontal);
-    QSizePolicy sizePolicy () const;
-    void setMaximumSize ( const QSize & );
-    QSize maximumSize () const;
-
-public Q_SLOTS:
-    void setValue(int);
-    void setOrientation(Qt::Orientation);
-
+	void setMarkerA(uint32_t frameIndex);
+	void setMarkerB(uint32_t frameIndex);
+	void setFrameCount(uint32_t count);
 };
-#endif
 
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2007-08-19 16:01:39 UTC (rev 3539)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/CMakeLists.txt	2007-08-20 03:26:34 UTC (rev 3540)
@@ -3,24 +3,23 @@
 ################################
 include(AdmLib)
 SET(ADM_LIB ADM_guiQt4)
-#
+
 SET(${ADM_LIB}_SRCS
-avidemux_rsc.cpp  file_qt4.cpp  gui_none.cpp
+avidemux_rsc.cpp  file_qt4.cpp  gui_none.cpp  ADM_qslider.cpp
 )
-#
-#
+
+
 SET(${ADM_LIB}_T
 preview
-qslider
 )
-#
+
 SET(${ADM_LIB}_Q
 gui2
 )
 Q_RCC(avidemux)
-#########################################"
+
 include(adm_qt4)
-################################
-INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}")
+
+include_directories("${CMAKE_CURRENT_SOURCE_DIR}")
 include_directories(${QT_INCLUDES})
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Makefile.am	2007-08-19 16:01:39 UTC (rev 3539)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Makefile.am	2007-08-20 03:26:34 UTC (rev 3540)
@@ -10,7 +10,7 @@
 libADM_gui2_a_METASOURCES = AUTO
 
 libADM_gui2_a_SOURCES = gui_none.cpp file_qt4.cpp avidemux_rsc.cpp \
-			AQ_gui2.cpp   AT_preview.cpp AT_qslider.cpp
+			AQ_gui2.cpp   AT_preview.cpp ADM_qslider.cpp
 
 include ../Makefile.adm
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-19 16:01:39 UTC (rev 3539)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-20 03:26:34 UTC (rev 3540)
@@ -12,7 +12,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "config.h"
-#define CUSTOM_SLIDER
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <math.h>
@@ -20,21 +20,14 @@
 #include <QtCore/QVariant>
 #include <QtGui/QAction>
 #include <QtGui/QApplication>
-#include <QtGui/QButtonGroup>
 #include <QtGui/QFrame>
 #include <QtGui/QGraphicsView>
-#include <QtGui/QHBoxLayout>
 #include <QtGui/QMainWindow>
-#include <QtGui/QMenu>
-#include <QtGui/QMenuBar>
 #include <QtGui/QSlider>
-#include <QtGui/QSpacerItem>
 #include <QtGui/QStatusBar>
-#include <QtGui/QToolButton>
-#include <QtGui/QVBoxLayout>
 #include <QtGui/QWidget>
-#include <ADM_qslider.h>
 
+#include "ADM_qslider.h"
 #include "default.h"
 #include "ADM_osSupport/ADM_misc.h"
 #include "ADM_codecs/ADM_codec.h"
@@ -53,11 +46,7 @@
 extern void checkCrashFile(void);
 static void setupMenus(void);
 static void GUI_initCustom(void);
-#ifdef CUSTOM_SLIDER
 static ADM_QSlider *slider=NULL;
-#else
-static QSlider *slider=NULL;
-#endif
 static int _upd_in_progres=0;
 /* Ugly game with macro so that buttons emit their name ...*/
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
@@ -491,7 +480,6 @@
 	if(!slider) v=0;
 	v= (double)(slider->value());
 	v/=10;
-	printf("GetScale\n");
 	return v;
 }
 void UI_setScale( double val )
@@ -601,9 +589,7 @@
 	frame2time(total,fps, &hh, &mm, &ss, &ms);
 	sprintf(text, "/ %02d:%02d:%02d.%03d", hh, mm, ss, ms);
 	WIDGET(label_7)->setText(text);
-#ifdef CUSTOM_SLIDER
-	slider->setNbFrames(total);
-#endif
+	slider->setFrameCount(total);
 }
 /**
     \fn     UI_setMarkers(uint32_t a, uint32_t b )
@@ -619,11 +605,9 @@
 
 	snprintf(text,79,"%06lu",b);
 	WIDGET(pushButtonJumpToMarkerB)->setText(text);
-	//
-#ifdef CUSTOM_SLIDER
-	slider->setA(a);
-	slider->setB(b);
-#endif
+
+	slider->setMarkerA(a);
+	slider->setMarkerB(b);
 }
 /**
     \fn     UI_getCurrentVCodec(void)

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp	2007-08-19 16:01:39 UTC (rev 3539)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_qslider.cpp	2007-08-20 03:26:34 UTC (rev 3540)
@@ -1,256 +0,0 @@
-
-/***************************************************************************
-      Custom slider
-      It is definitively ugly
-      It should derive from QHorizontalSlider or something
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include "config.h"
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <math.h>
-
-#include <time.h>
-#include <sys/time.h>
-
-#include <QtCore/QVariant>
-#include <QtGui/QAction>
-#include <QtGui/QApplication>
-#include <QtGui/QButtonGroup>
-#include <QtGui/QFrame>
-#include <QtGui/QGraphicsView>
-#include <QMessageBox>
-#include <QPainter>
-#include <QImage>
-#include <QSlider>
-#include <QResizeEvent>
-// moc does not like includes.... #include <ADM_qslider.h>
-#define MIN_BOTTOM 0
-
-
-#define zprintf(prt, ...) ;
-
-class ADM_QSlider : public QWidget
-{
-        Q_OBJECT
-signals:
-  void valueChanged(int value);
-
-public slots:
-        void sliderMoved(int);
-protected:
-        QSlider *_slider;
-        uint32_t _max,_A,_B;
-        void paintEvent(QPaintEvent *ev);
-        int paintCount;
-        void resizeEvent ( QResizeEvent * event ) ;
-        QSize maximumS;
-public:
-        ADM_QSlider(QWidget *father); 
-        ~ADM_QSlider(); 
-        
-        void setA(uint32_t a);
-        void setB(uint32_t a);
-        void setNbFrames(uint32_t a);
-        int  value() const;
-         Qt::Orientation orientation() const;
-
-    void setMinimum(int);
-    int minimum() const;
-
-    void setMaximum(int);
-    int maximum() const;
-    
-    QSize sizeHint() const;
-    QSize minimumSizeHint() const;
- //   bool event(QEvent *event);
-    void setSizePolicy ( QSizePolicy horizontal);
-    QSizePolicy sizePolicy () const;
-    void setMaximumSize ( const QSize & );
-    QSize maximumSize () const;
-public Q_SLOTS:
-    void setValue(int);
-    void setOrientation(Qt::Orientation);
-
-};
-//****************************************************************************************************
-void ADM_QSlider::setOrientation(Qt::Orientation x)
-{
-  zprintf("Orientation\n");
-  _slider->setOrientation(x); 
-}
-void ADM_QSlider::setValue(int x)
-{
-  zprintf("Value\n");
-  _slider->setValue(x); 
-}
-
-void ADM_QSlider::setMinimum(int x)
-{
-  zprintf("Min\n");
-  _slider->setMinimum(x); 
-}
-void ADM_QSlider::setMaximum(int x)
-{
-  zprintf("Max\n");
-  _slider->setMaximum(x); 
-}
- int ADM_QSlider::minimum(void) const
-{
-  return _slider->minimum(); 
-}
-int ADM_QSlider::maximum(void) const
-{
-  return _slider->maximum(); 
-}
-int ADM_QSlider::value(void) const
-{
-  return _slider->value(); 
-}
-
-ADM_QSlider::ADM_QSlider(QWidget *father) : QWidget(father)
-{
-  _max=_A=_B=0;
-  paintCount=0;
-  _slider=new QSlider(this);
-  _slider->setTickInterval(1);
-  _slider->setSingleStep(1);
-
-  
-  _slider->show();
-  connect( _slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
-  
-}
-void ADM_QSlider::sliderMoved(int i)
-{
-  zprintf("Moved\n");
-  emit( valueChanged(i));
-}
-ADM_QSlider::~ADM_QSlider()
-{
-  if(_slider) delete _slider;
-  _slider=NULL;
-}
-void ADM_QSlider::paintEvent(QPaintEvent *ev)
-{
-  int a=_A,b=_B;
-  if(paintCount) return;
-    zprintf("[*********************************PAINT************************]\n");
-    paintCount++;
-    //_slider->repaint();
-    if( _max)
-    {
-      if(_A>_B)
-      {
-        b=_A;
-        a=_B; 
-      }
-     zprintf("[QSLIDER] %u %u %u\n",_A,_B,_max); 
-      // Paint!
-      QPainter painter(this);
-      int Wwidth,Wheight,dA,dB;
-      float f;
-        Wwidth=width();
-        Wheight=height();
-
-        
-        f=a*Wwidth;
-        f/=_max;
-        dA=(int)floor(f+0.49);
-        
-        f=b*Wwidth;
-        f/=_max;
-        dB=(int)floor(f+0.49);
-        
-        QRectF r(dA,0,dB-dA+1,Wheight-1);
-        
-        painter.setPen(Qt::blue);
-        
-//         painter.drawLine(dA,1,dA,Wheight-MIN_BOTTOM+1);
-//         painter.drawLine(dB,1,dB,Wheight-MIN_BOTTOM+1);
-//         painter.drawLine(dA,Wheight-MIN_BOTTOM+2,dB,Wheight-MIN_BOTTOM+2);
-        painter.drawRect(dA,0,dB-dA+1,Wheight-1);
-        painter.end();
-    }
-    paintCount--;
-}
-void ADM_QSlider::setA(uint32_t a)
-{
-  _A=a;
-  zprintf("[QSLIDER] Set A (%u,%u)\n",_A,_max);  
-  if(_A>_max)
-  {
-    printf("[QSLIDER] A out of bound(%u,%u)\n",_A,_max);  
-  }
-  repaint();
-}
-void ADM_QSlider::setB(uint32_t a)
-{
-    _B=a;
-    zprintf("[QSLIDER] Set B (%u,%u)\n",_B,_max);  
-  if(_B>_max)
-  {
-    printf("[QSLIDER] B out of bound(%u,%u)\n",_B,_max);  
-  }
-  repaint();
-}
-void ADM_QSlider::setNbFrames(uint32_t a)
-{
-  _max=a; 
-  repaint();
-}
-QSize ADM_QSlider::sizeHint() const
-{
-  return _slider->sizeHint(); 
-}
-QSize ADM_QSlider::minimumSizeHint() const
-{
-   return _slider->minimumSizeHint(); 
-}
-void ADM_QSlider::resizeEvent ( QResizeEvent * event ) 
-{
-  QSize nw,old;
-  nw=event->size();
-  old=event->oldSize();
-  zprintf("RESIZE %dx%d->%dx%d\n",old.width(),old.height(),nw.width(),nw.height());
-  if(nw.height()>MIN_BOTTOM) nw.setHeight(nw.height()-MIN_BOTTOM);
-  zprintf("RESIZE2 %dx%d->%dx%d\n",old.width(),old.height(),nw.width(),nw.height());
-  _slider->resize(nw);
-  
-}
-void ADM_QSlider::setSizePolicy ( QSizePolicy horizontal )
-{
-    zprintf("PolicySet\n");
-    _slider->setSizePolicy(horizontal);
-}
-QSizePolicy ADM_QSlider::sizePolicy () const
-{
-  return _slider->sizePolicy(); 
-}
-void ADM_QSlider::setMaximumSize ( const QSize &sz )
-{
-    maximumS=sz;
-    _slider->setMaximumSize(sz);
-}
-/*bool ADM_QSlider::event(QEvent *xevent)
-{
-  return  _slider->event(xevent);
-}*/
-
-QSize ADM_QSlider::maximumSize () const
-{
-  return maximumS; 
-}
-
-//EOF 



From gruntster at mail.berlios.de  Mon Aug 20 12:34:00 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Aug 2007 12:34:00 +0200
Subject: [Avidemux-svn-commit] r3541 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708201034.l7KAY0Wh020194@sheep.berlios.de>

Author: gruntster
Date: 2007-08-20 12:33:41 +0200 (Mon, 20 Aug 2007)
New Revision: 3541

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
Log:
[QT] enable cursor keys for seeking

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-20 03:26:34 UTC (rev 3540)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-20 10:33:41 UTC (rev 3541)
@@ -1386,11 +1386,6 @@
     <addaction name="actionSave_2" />
     <addaction name="actionFilters_2" />
    </widget>
-   <widget class="QMenu" name="menuCustom" >
-    <property name="title" >
-     <string>&amp;Custom</string>
-    </property>
-   </widget>
    <widget class="QMenu" name="menuFile" >
     <property name="title" >
      <string>&amp;File</string>
@@ -1456,26 +1451,6 @@
     <addaction name="actionOCR_DVB_T_TS_files" />
     <addaction name="actionGlyphs_Edit" />
    </widget>
-   <widget class="QMenu" name="menuGo" >
-    <property name="title" >
-     <string>&amp;Go</string>
-    </property>
-    <addaction name="actionPlay" />
-    <addaction name="actionPrevious_Frame" />
-    <addaction name="actionNext_Frame" />
-    <addaction name="actionPrevious_intra_frame" />
-    <addaction name="actionNext_intra_frame" />
-    <addaction name="actionPrevious_black_frame" />
-    <addaction name="actionNext_blak_frame" />
-    <addaction name="actionFirst_Frame" />
-    <addaction name="actionLast_Frame" />
-    <addaction name="separator" />
-    <addaction name="actionGo_to_Marker_A" />
-    <addaction name="actionGo_to_Marker_B" />
-    <addaction name="separator" />
-    <addaction name="actionJump_to_Frame" />
-    <addaction name="actionJump_to_Time" />
-   </widget>
    <widget class="QMenu" name="menuEdit" >
     <property name="title" >
      <string>&amp;Edit</string>
@@ -1513,6 +1488,31 @@
     <addaction name="separator" />
     <addaction name="menu_Preview" />
    </widget>
+   <widget class="QMenu" name="menuCustom" >
+    <property name="title" >
+     <string>&amp;Custom</string>
+    </property>
+   </widget>
+   <widget class="QMenu" name="menuGo" >
+    <property name="title" >
+     <string>&amp;Go</string>
+    </property>
+    <addaction name="actionPlay" />
+    <addaction name="actionPrevious_Frame" />
+    <addaction name="actionNext_Frame" />
+    <addaction name="actionPrevious_intra_frame" />
+    <addaction name="actionNext_intra_frame" />
+    <addaction name="actionPrevious_black_frame" />
+    <addaction name="actionNext_blak_frame" />
+    <addaction name="actionFirst_Frame" />
+    <addaction name="actionLast_Frame" />
+    <addaction name="separator" />
+    <addaction name="actionGo_to_Marker_A" />
+    <addaction name="actionGo_to_Marker_B" />
+    <addaction name="separator" />
+    <addaction name="actionJump_to_Frame" />
+    <addaction name="actionJump_to_Time" />
+   </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
    <addaction name="menuView" />
@@ -1608,7 +1608,7 @@
     <string>&amp;Delete</string>
    </property>
    <property name="shortcut" >
-    <string>Delete</string>
+    <string>Del</string>
    </property>
   </action>
   <action name="actionSet_marker_A" >
@@ -1760,7 +1760,7 @@
     <string>&amp;Zoom 1:4</string>
    </property>
    <property name="shortcut" >
-    <string>Shift+Ctrl+4</string>
+    <string>Ctrl+Shift+4</string>
    </property>
   </action>
   <action name="actionZoom_1_2" >
@@ -1771,7 +1771,7 @@
     <string>Z&amp;oom 1:2</string>
    </property>
    <property name="shortcut" >
-    <string>Shift+Ctrl+2</string>
+    <string>Ctrl+Shift+2</string>
    </property>
   </action>
   <action name="actionZoom_1_1" >
@@ -1989,7 +1989,7 @@
     <string>P&amp;revious Frame</string>
    </property>
    <property name="shortcut" >
-    <string>4</string>
+    <string>Left</string>
    </property>
   </action>
   <action name="actionNext_Frame" >
@@ -2000,7 +2000,7 @@
     <string>&amp;Next Frame</string>
    </property>
    <property name="shortcut" >
-    <string>6</string>
+    <string>Right</string>
    </property>
   </action>
   <action name="actionPrevious_intra_frame" >
@@ -2017,7 +2017,7 @@
     <string>Previous Intra Frame</string>
    </property>
    <property name="shortcut" >
-    <string>2</string>
+    <string>Down</string>
    </property>
   </action>
   <action name="actionNext_intra_frame" >
@@ -2034,7 +2034,7 @@
     <string>Next Intra Frame</string>
    </property>
    <property name="shortcut" >
-    <string>8</string>
+    <string>Up</string>
    </property>
   </action>
   <action name="actionPrevious_black_frame" >



From gruntster at mail.berlios.de  Mon Aug 20 12:48:17 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Aug 2007 12:48:17 +0200
Subject: [Avidemux-svn-commit] r3542 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708201048.l7KAmHX7010591@sheep.berlios.de>

Author: gruntster
Date: 2007-08-20 12:47:52 +0200 (Mon, 20 Aug 2007)
New Revision: 3542

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[QT] smoother seeking with mouse + set main window title to the same as GTK

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-20 10:33:41 UTC (rev 3541)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-20 10:47:52 UTC (rev 3542)
@@ -202,7 +202,7 @@
 	// Slider
 	slider=ui.horizontalSlider;
 	slider->setMinimum(0);
-	slider->setMaximum(1000);
+	slider->setMaximum(1000000000);
 	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
 
 	// Volume slider
@@ -479,14 +479,14 @@
 	double v;
 	if(!slider) v=0;
 	v= (double)(slider->value());
-	v/=10;
+	v/=10000000;
 	return v;
 }
 void UI_setScale( double val )
 {
 	if(_upd_in_progres) return;
 	_upd_in_progres++;
-	slider->setValue( (int)val*10);
+	slider->setValue( (int)(val * 10000000));
 	_upd_in_progres--;
 
 }
@@ -504,10 +504,10 @@
 */
 void UI_setTitle(char *name)
 {
-	char title[1024];
+    char title[300];
 
-	strcpy(title,"Avidemux 2 ");
-	strncat(title,name,200);
+    strncpy(title,name,200);
+    strncat(title," - Avidemux", 11);
 
 	QuiMainWindows->setWindowTitle( title);
 }



From mean at mail.berlios.de  Mon Aug 20 20:21:20 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 20 Aug 2007 20:21:20 +0200
Subject: [Avidemux-svn-commit] r3543 - in branches/avidemux_2.4_branch:
	autononreg/dialogFactory avidemux/ADM_script
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200708201821.l7KILKO6024444@sheep.berlios.de>

Author: mean
Date: 2007-08-20 20:21:19 +0200 (Mon, 20 Aug 2007)
New Revision: 3543

Added:
   branches/avidemux_2.4_branch/autononreg/dialogFactory/matrix.js
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_matrix.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
Log:
[DialogFactory] new dialogFactory widget : matrix (incomplete)

Copied: branches/avidemux_2.4_branch/autononreg/dialogFactory/matrix.js (from rev 3532, branches/avidemux_2.4_branch/autononreg/dialogFactory/slider.js)
===================================================================
--- branches/avidemux_2.4_branch/autononreg/dialogFactory/slider.js	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/autononreg/dialogFactory/matrix.js	2007-08-20 18:21:19 UTC (rev 3543)
@@ -0,0 +1,10 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+var app = new Avidemux();
+var file="/work/samples/2mn.avi";
+var goodfcc="DIV3";
+var fps;
+
+	dialogFactoryMatrix();
+
+/* End of test
+*/

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-08-20 18:21:19 UTC (rev 3543)
@@ -81,6 +81,7 @@
 JSBool facHex(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facDirSel(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facButton(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+JSBool facMatrix(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool facSlider(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool assertTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
@@ -116,6 +117,7 @@
   {"dialogFactoryHex",       facHex,        0},
   {"dialogFactoryButton",       facButton,        0},
   {"dialogFactorySlider",       facSlider,        0},
+  {"dialogFactoryMatrix",       facMatrix,        0},
   {"crashTest",               crashTest,        0},
   {"assertTest",               assertTest,        0},
   {0}
@@ -790,6 +792,34 @@
       
       
 }
+JSBool facMatrix(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+    
+      uint8_t data[16];
+      for(int i=0;i<100;i++) data[i]=i;
+      
+      diaElemMatrix Matrix(data,"Matrix",4);
+      
+      
+         diaElem *elems[]={&Matrix   };
+  if(diaFactoryRun("Test Matrix",1,elems))
+  {
+    *rval = BOOLEAN_TO_JSVAL(1);
+    
+  }else
+    *rval = BOOLEAN_TO_JSVAL(0);
+  
+  for(int x=0;x<4*4;x++)
+  {
+	  if(x && !(x&3)) printf("\n");
+	  printf("%02x ",data[x]);
+	  
+  }
+  
+  return JS_TRUE;
+      
+      
+}
 
 JSBool crashTest(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-20 18:21:19 UTC (rev 3543)
@@ -5,9 +5,22 @@
 SET(ADM_LIB ADM_dialogFactoryGtk)
 #
 SET(${ADM_LIB}_SRCS
-DIA_color.cpp          DIA_filesel.cpp  FAC_bitrate.cpp  FAC_float.cpp  FAC_hex.cpp      FAC_menu.cpp   FAC_readOnlyText.cpp
-DIA_dialogFactory.cpp  FAC_bar.cpp      FAC_button.cpp   FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp  FAC_toggle.cpp
+DIA_color.cpp          
+DIA_filesel.cpp  
+DIA_dialogFactory.cpp  
+FAC_bitrate.cpp  
+FAC_float.cpp  
+FAC_hex.cpp      
+FAC_menu.cpp   
+FAC_readOnlyText.cpp
+FAC_bar.cpp      
+FAC_button.cpp   
+FAC_frame.cpp  
+FAC_integer.cpp  
+FAC_notch.cpp  
+FAC_toggle.cpp
 FAC_threadCount.cpp
+FAC_matrix.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_matrix.cpp (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_matrix.cpp	2007-08-20 18:21:19 UTC (rev 3543)
@@ -0,0 +1,132 @@
+/***************************************************************************
+  FAC_matrix.cpp
+  Handle dialog factory element : Matrix
+  (C) 2007 Mean Fixounet at free.fr 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+
+
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+
+#include "default.h"
+#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
+#include "ADM_toolkit_gtk/toolkit_gtk.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h"
+
+
+
+
+diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
+  : diaElem(ELEM_MATRIX)
+{
+  param=(void *)trix;
+  paramTitle=toggleTitle;
+  this->tip=tip;
+  _matrix=new uint8_t[trixSize*trixSize];
+  _matrixSize=trixSize;
+  memcpy(_matrix,trix,trixSize*trixSize);
+}
+
+diaElemMatrix::~diaElemMatrix()
+{
+  if(_matrix) delete [] _matrix;
+  _matrix=NULL;
+  if(myWidget)
+  {
+	  GtkWidget **arrayWidget=( GtkWidget **)myWidget;
+	  delete [] arrayWidget;
+	  myWidget=NULL;
+  }
+}
+void diaElemMatrix::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  GtkWidget *widget;
+  GtkWidget *table;
+  GtkWidget *label;
+  GtkWidget **arrayWidget=new GtkWidget*[_matrixSize*_matrixSize];  
+  label = gtk_label_new_with_mnemonic (paramTitle);
+  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
+  gtk_widget_show(label);
+  
+  gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  //*************
+    table = gtk_table_new (_matrixSize, _matrixSize, FALSE);
+    gtk_table_set_col_spacings (GTK_TABLE (table), 0);
+    gtk_table_set_row_spacings (GTK_TABLE (table), 0);
+    gtk_widget_show(table);
+    
+    gtk_table_attach (GTK_TABLE (opaque), table, 1, 2, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  // Create widgets
+    int index=0;
+    for(int y=0;y<_matrixSize*_matrixSize;y++)
+    	{
+    		int val=_matrix[index];
+    		GtkWidget *w= gtk_spin_button_new_with_range(0,255,1);
+    		
+    		  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON(w),TRUE);
+    		  gtk_spin_button_set_digits  (GTK_SPIN_BUTTON(w),0);
+    		  gtk_spin_button_set_value (GTK_SPIN_BUTTON(w),val);
+    		  arrayWidget[index]=w;
+    		  
+    		  gtk_table_attach (GTK_TABLE (table),w, y%_matrixSize, 1+(y%_matrixSize), y/_matrixSize, 1+(y/_matrixSize),
+    		                     (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+    		                     (GtkAttachOptions) (0), 0, 0);
+    		  gtk_widget_show(w);
+    		  index++;
+    	}
+    	
+    
+  
+    myWidget=(void *)arrayWidget;
+    if(tip)
+    {
+      GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, table, tip, NULL);
+    }
+
+}
+void diaElemMatrix::getMe(void)
+{
+	 GtkWidget **arrayWidget=( GtkWidget **)myWidget;
+	 
+	 ADM_assert(arrayWidget);
+	 int index=0;
+	  for(int y=0;y<_matrixSize*_matrixSize;y++)
+	  {
+	    		_matrix[index]=(uint8_t)gtk_spin_button_get_value( GTK_SPIN_BUTTON(arrayWidget[index]));
+	    		index++;
+	  }
+	  memcpy(param,_matrix,_matrixSize*_matrixSize);
+}
+void diaElemMatrix::enable(uint32_t onoff)
+{
+	 GtkWidget **arrayWidget=( GtkWidget **)myWidget;
+		 
+		 ADM_assert(arrayWidget);
+		 int index=0;
+		  for(int y=0;y<_matrixSize*_matrixSize;y++)
+		  {
+			  gtk_widget_set_sensitive( GTK_WIDGET(arrayWidget[index++]),onoff);
+		  }
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-20 18:21:19 UTC (rev 3543)
@@ -22,6 +22,7 @@
 FAC_hex.cpp \
 FAC_button.cpp \
 DIA_color.cpp \
-FAC_threadCount.cpp
+FAC_matrix.cpp \
+FAC_threadCount.cpp?
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-20 18:21:19 UTC (rev 3543)
@@ -424,8 +424,32 @@
   
  template class diaElemGenericSlider <int32_t>;
  template class diaElemGenericSlider <uint32_t>;
- 
+//****
 
+
+
+ diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
+   : diaElem(ELEM_MATRIX)
+ {
+ }
+
+ diaElemMatrix::~diaElemMatrix()
+ {
+ }
+ void diaElemMatrix::setMe(void *dialog, void *opaque,uint32_t line)
+ {
+
+ }
+ void diaElemMatrix::getMe(void)
+ {
+   
+ }
+ void diaElemMatrix::enable(uint32_t onoff)
+ {
+ }
+
+
+
 //***
 diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT) {}
 diaElemThreadCount::~diaElemThreadCount() {}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-20 18:21:19 UTC (rev 3543)
@@ -17,6 +17,7 @@
 SET(${ADM_LIB}_SRCS
 FAC_bar.cpp    FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp         
 FAC_float.cpp  FAC_hex.cpp    FAC_readOnlyText.cpp
+FAC_matrix.cpp
 )
 
 ################################

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp (from rev 3532, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp	2007-08-18 17:18:57 UTC (rev 3532)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp	2007-08-20 18:21:19 UTC (rev 3543)
@@ -0,0 +1,57 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Toggle
+  (C) 2006 Mean Fixounet at free.fr 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+
+
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <math.h>
+
+#include <QDialog>
+#include <QSpinBox>
+#include <QGridLayout>
+#include <QLabel>
+
+#include "default.h"
+#include "ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h"
+
+extern const char *shortkey(const char *);
+
+
+
+
+diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
+  : diaElem(ELEM_MATRIX)
+{
+}
+
+diaElemMatrix::~diaElemMatrix()
+{
+}
+void diaElemMatrix::setMe(void *dialog, void *opaque,uint32_t line)
+{
+
+}
+void diaElemMatrix::getMe(void)
+{
+  
+}
+void diaElemMatrix::enable(uint32_t onoff)
+{
+}
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-20 18:21:19 UTC (rev 3543)
@@ -6,7 +6,7 @@
 libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp AT_toggle.cpp FAC_integer.cpp AT_menu.cpp FAC_float.cpp \
 AT_filesel.cpp AT_bitrate.cpp AT_threadCount.cpp \
 AT_button.cpp \
-FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp FAC_hex.cpp
+FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp FAC_hex.cpp FAC_matrix.cpp
 
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-20 10:47:52 UTC (rev 3542)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-20 18:21:19 UTC (rev 3543)
@@ -39,6 +39,7 @@
   ELEM_BUTTON,
   ELEM_SLIDER,
   ELEM_THREAD_COUNT,
+  ELEM_MATRIX,
   ELEM_COUNT,
   ELEM_MAX=ELEM_COUNT-1
 }elemEnum;
@@ -90,6 +91,21 @@
   void      getMe(void);
   void      enable(uint32_t onoff) ;
 };
+
+/*********************************************/
+
+class diaElemMatrix : public diaElem
+{
+  protected:
+  public:
+    uint8_t *_matrix;
+    uint32_t _matrixSize;
+    		diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip=NULL);
+  virtual   ~diaElemMatrix() ;
+  void      setMe(void *dialog, void *opaque,uint32_t line);
+  void      getMe(void);
+  void      enable(uint32_t onoff) ;
+};
 /************************************/
 template <class T>
 class diaElemGenericSlider : public diaElem



From mean at mail.berlios.de  Mon Aug 20 20:27:48 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 20 Aug 2007 20:27:48 +0200
Subject: [Avidemux-svn-commit] r3544 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
Message-ID: <200708201827.l7KIRm9h024870@sheep.berlios.de>

Author: mean
Date: 2007-08-20 20:27:47 +0200 (Mon, 20 Aug 2007)
New Revision: 3544

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
Log:
[Automake] Fix makefile for matrix 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-20 18:21:19 UTC (rev 3543)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-20 18:27:47 UTC (rev 3544)
@@ -23,6 +23,6 @@
 FAC_button.cpp \
 DIA_color.cpp \
 FAC_matrix.cpp \
-FAC_threadCount.cpp?
+FAC_threadCount.cpp
 
 



From gruntster at mail.berlios.de  Tue Aug 21 00:28:07 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 21 Aug 2007 00:28:07 +0200
Subject: [Avidemux-svn-commit] r3545 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200708202228.l7KMS7ZA014777@sheep.berlios.de>

Author: gruntster
Date: 2007-08-21 00:28:01 +0200 (Tue, 21 Aug 2007)
New Revision: 3545

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
Log:
[GTK] disable seeking via the cursor keys when altering the audio time shift or current frame index

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-20 18:27:47 UTC (rev 3544)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-20 22:28:01 UTC (rev 3545)
@@ -12,23 +12,18 @@
  *   it under the terms of the GNU General Public License as published by  *
  *   the Free Software Foundation; either version 2 of the License, or     *
  *   (at your option) any later version.                                   *
- * GtkObject *sliderAdjustment=NULL;
- *sliderAdjustment=gtk_adjustment_new (52.1, 0, 99.99, 0.01, 0, 0);
- *sliderNavigate = gtk_hscale_new (GTK_ADJUSTMENT (sliderAdjustment));
  ***************************************************************************/
+#include "config.h"
+
 #include <stdio.h>
 #include <stdlib.h>
-#  include <config.h>
-
-
 #include <string.h>
+#include <math.h>
 
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
 
-#include <../ADM_assert.h>
-
-#include "math.h"
+#include "../ADM_assert.h"
 #include "default.h"
 #include "ADM_commonUI/GUI_render.h"
 #include "../gui_action.hxx"
@@ -45,7 +40,6 @@
 #include "../ADM_toolkit/filesel.h"
 #include "../ADM_editor/ADM_Video.h"
 #include "../ADM_osSupport/ADM_misc.h"
-#include "../ADM_editor/ADM_outputfmt.h"
 #include "../prefs.h"
 #include "../ADM_toolkit_gtk/gtkmarkscale.h"
 #include "../ADM_toolkit_gtk/jogshuttle.h"
@@ -59,7 +53,6 @@
 	   uint16_t * ss, uint16_t * ms);
 
 static GtkWidget *guiRootWindow=NULL;
-
 static GtkWidget *guiDrawingArea=NULL;
 static GtkWidget *guiSlider=NULL;
 
@@ -74,13 +67,16 @@
 static GtkWidget *guiVideoToggle=NULL;
 static GdkCursor *guiCursorBusy=NULL;
 static GdkCursor *guiCursorNormal=NULL;
-static gint	  guiCursorEvtMask=0;
+
+static  GtkAdjustment *sliderAdjustment;
+
+static int keyPressHandlerId=0;
+
+//static gint	  guiCursorEvtMask=0;
 static gint       jogChange( void );
 static void volumeChange( void );
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
 static uint32_t ADM_nbCustom=0;
-// heek !
-static  GtkAdjustment *sliderAdjustment;
 // Needed for DND
 extern void A_openAvi (char *name);
 extern void A_appendAvi (char *name);
@@ -145,7 +141,8 @@
 static gboolean  on_drawingarea1_expose_event(GtkWidget * widget,  GdkEventExpose * event, gpointer user_data);
 // Currentframe taking/loosing focus
 static int  UI_grabFocus( void);
-static int  UI_looseFocus( void);
+static int  UI_loseFocus( void);
+static void UI_focusAfterActivate(GtkMenuItem * menuitem, gpointer user_data);
 static void GUI_initCursor( void );
  void UI_BusyCursor( void );
  void UI_NormalCursor( void );
@@ -153,6 +150,7 @@
 gboolean SliderIsShifted = FALSE;
 gboolean UI_SliderPressed(GtkWidget *widget, GdkEventButton *event, gpointer user_data);
 gboolean UI_SliderReleased(GtkWidget *widget, GdkEventButton *event, gpointer user_data);
+gboolean UI_returnFocus(GtkWidget *widget, GdkEventButton *event, gpointer user_data);
 // Global
 GtkAccelGroup *accel_group;
 //
@@ -164,11 +162,8 @@
 	const char *signal;
 	Action action;
 
-}buttonCallBack_S;
+} buttonCallBack_S;
 
-
-
-
 buttonCallBack_S buttonCallback[]=
 {
 	{"buttonPlay"			,"clicked"		,ACT_PlayAvi},
@@ -196,12 +191,10 @@
 	{"buttonGotoB"			,"clicked"		,ACT_GotoMarkB},	
 	{"toolbuttonCalc"		,"clicked"		,ACT_Bitrate},	
 
-	//{"boxCurFrame"			,"editing_done"		,ACT_JumpToFrame},
-	{"boxCurFrame"			,"activate"		,ACT_JumpToFrame},
+	//{"boxCurFrame"			,"activate"		,ACT_JumpToFrame},
 	//{"boxCurTime"			,"editing_done"		,ACT_TimeChanged},
-
-        {"CheckButtonTimeshift"         ,"toggled"             ,ACT_TimeShift}
-       // {"spinbuttonTimeShift"          ,"editing_done"       ,ACT_TimeShift}
+    {"CheckButtonTimeshift"         ,"toggled"             ,ACT_TimeShift}
+    // {"spinbuttonTimeShift"          ,"editing_done"       ,ACT_TimeShift}
   
 };
 
@@ -216,6 +209,7 @@
 		guiRootWindow=create_mainWindow();
 		
 		if(!guiRootWindow) return 0;
+
 		gtk_register_dialog(guiRootWindow);
 					
 		// and seek global sub entity
@@ -289,6 +283,7 @@
 	
 	ADM_LOOKUP(guiCurTime,boxCurTime);
 	ADM_LOOKUP(guiTotalTime,labelTotalTime);
+
 #if 0
 	ADM_LOOKUP(guiPreviewToggle,toggletoolbuttonPreview);
 	ADM_LOOKUP(guiOutputToggle,toggletoolbuttonOutput);
@@ -313,42 +308,34 @@
 	
 	
 //	now add callbacks
-	
-	gtk_signal_connect(GTK_OBJECT(guiSlider), "button_press_event",
-                       GTK_SIGNAL_FUNC(UI_SliderPressed),
-                       NULL);
+	 gtk_widget_add_events(guiRootWindow, GDK_BUTTON_PRESS_MASK);
+	 gtk_signal_connect(GTK_OBJECT(guiRootWindow), "button_press_event", GTK_SIGNAL_FUNC(UI_returnFocus), NULL);
 
-	gtk_signal_connect(GTK_OBJECT(guiSlider), "button_release_event",
-                       GTK_SIGNAL_FUNC(UI_SliderReleased),
-                       NULL);
-#define ADD_SIGNAL(a,b,c)  gtk_signal_connect(GTK_OBJECT(a),b, \
-		       GTK_SIGNAL_FUNC(guiCallback), (void *) c);
-				       
-      	ADD_SIGNAL(guiSlider,"value_changed",ACT_Scale);
-	
-	// We need to know when the current frame box has the focus to cancel
-	// shortcuts
-	
-	gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"boxCurFrame")), "focus_in_event", 
-                      GTK_SIGNAL_FUNC(UI_grabFocus),                   (void *) NULL);	   
-	gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"boxCurFrame")), "focus_out_event", 	
-                      GTK_SIGNAL_FUNC(UI_looseFocus),                   (void *) NULL);	 
+	gtk_signal_connect(GTK_OBJECT(guiSlider), "button_press_event", GTK_SIGNAL_FUNC(UI_SliderPressed), NULL);
+	gtk_signal_connect(GTK_OBJECT(guiSlider), "button_release_event", GTK_SIGNAL_FUNC(UI_SliderReleased), NULL);
 
-        // Volume
-         gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"hscalVolume")), "value_changed",   
-                      GTK_SIGNAL_FUNC(volumeChange),                   (void *) NULL);  
+	// Current Frame	
+	gtk_signal_connect(GTK_OBJECT(guiCurFrame), "focus_in_event", GTK_SIGNAL_FUNC(UI_grabFocus), (void *) NULL);
+	gtk_signal_connect(GTK_OBJECT(guiCurFrame), "focus_out_event", GTK_SIGNAL_FUNC(UI_loseFocus), (void *) NULL);
+	gtk_signal_connect(GTK_OBJECT(guiCurFrame), "activate", GTK_SIGNAL_FUNC(UI_focusAfterActivate), (void *) ACT_JumpToFrame);
 
-        // Jog
-        gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"jogg")), "value_changed",   
-                      GTK_SIGNAL_FUNC(jogChange),                   (void *) NULL);  
+    // Volume
+    gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"hscalVolume")), "value_changed", GTK_SIGNAL_FUNC(volumeChange), (void *) NULL);
 
-		// Time Shift
-		gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"spinbuttonTimeShift")), "value_changed",   
-                      GTK_SIGNAL_FUNC(guiCallback), (void *) ACT_TimeShift);  
+    // Jog
+    gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"jogg")), "value_changed", GTK_SIGNAL_FUNC(jogChange), (void *) NULL);
 
+	// Time Shift
+	gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"spinbuttonTimeShift")), "focus_in_event", GTK_SIGNAL_FUNC(UI_grabFocus), (void *) NULL);
+	gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"spinbuttonTimeShift")), "focus_out_event", GTK_SIGNAL_FUNC(UI_loseFocus), (void *) NULL);
+	gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,"spinbuttonTimeShift")), "activate", GTK_SIGNAL_FUNC(UI_focusAfterActivate), (void *) ACT_TimeShift);
 
-		       
-// Callbacks for buttons
+#define ADD_SIGNAL(a,b,c)  gtk_signal_connect(GTK_OBJECT(a), b, GTK_SIGNAL_FUNC(guiCallback), (void *) c);
+
+   	ADD_SIGNAL(guiSlider,"value_changed",ACT_Scale);
+	ADD_SIGNAL(lookup_widget(guiRootWindow,"spinbuttonTimeShift"),"value_changed",ACT_TimeShift);
+
+	// Callbacks for buttons
 		uint32_t nb=sizeof(buttonCallback)/sizeof(buttonCallBack_S); 
 		GtkWidget *bt;
 		
@@ -362,7 +349,7 @@
 				ADM_assert(0);
 			}
 			ADD_SIGNAL(bt,buttonCallback[i].signal,buttonCallback[i].action);
-			GTK_WIDGET_UNSET_FLAGS (bt, GTK_CAN_FOCUS);			
+			GTK_WIDGET_UNSET_FLAGS (bt, GTK_CAN_FOCUS);
 		}
 
 	GTK_WIDGET_SET_FLAGS (lookup_widget(guiRootWindow,"boxCurFrame"), GTK_CAN_FOCUS);
@@ -692,47 +679,83 @@
 }
 int UI_grabFocus( void)
 {
-//	printf("Grabbing focus\n");
 #define RM(x,y)   gtk_widget_remove_accelerator (lookup_widget(guiRootWindow,#x), accel_group, \
                               y, (GdkModifierType) 0  );
-	RM(buttonNextFrame,GDK_KP_6);
-	RM(buttonPrevFrame,GDK_KP_4);
-	RM(buttonNextKFrame,GDK_KP_8);
-	RM(buttonPrevKFrame,GDK_KP_2);
-	RM(delete1,GDK_Delete);
 #define RMCTRL(x,y)   gtk_widget_remove_accelerator (lookup_widget(guiRootWindow,#x), accel_group, \
                               y, (GdkModifierType) GDK_CONTROL_MASK  );	
+
+	RM(next_frame1, GDK_KP_6);
+	RM(previous_frame1, GDK_KP_4);
+	RM(next_intra_frame1, GDK_KP_8);
+	RM(previous_intra_frame1, GDK_KP_2);
+
+	RM(buttonNextFrame, GDK_KP_6);
+	RM(buttonPrevFrame, GDK_KP_4);
+	RM(buttonNextKFrame, GDK_KP_8);
+	RM(buttonPrevKFrame, GDK_KP_2);
+
+	RM(delete1, GDK_Delete);
+
 	RMCTRL(paste1,GDK_V);
 	RMCTRL(copy1,GDK_C);
 	RMCTRL(cut1,GDK_X);
+
+	UI_arrow_disabled();
+
 	return FALSE;
 	
 }
-int UI_looseFocus( void)
+int UI_loseFocus( void)
 {
 #define ADD(x,y)  gtk_widget_add_accelerator (lookup_widget(guiRootWindow,#x), "clicked", accel_group, \
-                              y, (GdkModifierType) 0, \
-                              GTK_ACCEL_VISIBLE);
-//	printf("Dropping focus\n");			      
-	ADD(buttonNextFrame,GDK_KP_6);
-	ADD(buttonPrevFrame,GDK_KP_4);
-	ADD(buttonNextKFrame,GDK_KP_8);
-	ADD(buttonPrevKFrame,GDK_KP_2);
-	
-	gtk_widget_add_accelerator (lookup_widget(guiRootWindow,"delete1"), "activate", accel_group, \
-                              GDK_Delete, (GdkModifierType) 0, \
-                              GTK_ACCEL_VISIBLE);	
-	
+                              y, (GdkModifierType) 0, GTK_ACCEL_VISIBLE);
+#define ADD_ACT(x,y)  gtk_widget_add_accelerator (lookup_widget(guiRootWindow,#x), "activate", accel_group, \
+                              y, (GdkModifierType) 0, GTK_ACCEL_VISIBLE);
 #define ADDCTRL(x,y) gtk_widget_add_accelerator (lookup_widget(guiRootWindow,#x), "activate", accel_group, \
-                              y, (GdkModifierType) GDK_CONTROL_MASK, \
-                              GTK_ACCEL_VISIBLE);
+                              y, (GdkModifierType) GDK_CONTROL_MASK, GTK_ACCEL_VISIBLE);
+
+	ADD_ACT(next_frame1, GDK_KP_6);
+	ADD_ACT(previous_frame1, GDK_KP_4);
+	ADD_ACT(next_intra_frame1, GDK_KP_8);
+	ADD_ACT(previous_intra_frame1, GDK_KP_2);
+	ADD_ACT(delete1, GDK_Delete);
+
+	ADD(buttonNextFrame, GDK_KP_6);
+	ADD(buttonPrevFrame, GDK_KP_4);
+	ADD(buttonNextKFrame, GDK_KP_8);
+	ADD(buttonPrevKFrame, GDK_KP_2);
 	
 	ADDCTRL(paste1,GDK_V);
 	ADDCTRL(copy1,GDK_C);
 	ADDCTRL(cut1,GDK_X);
+
+	UI_arrow_enabled();
 	
 	return FALSE;
 }
+
+void UI_focusAfterActivate(GtkMenuItem * menuitem, gpointer user_data)
+{
+	// return focus to window once Enter has been pressed
+	UNUSED_ARG(menuitem);
+    Action act;
+    uint32_t aint;
+    if(update_ui) return; // no event sent
+
+    aint = (long int) user_data;
+    act = (Action) aint;
+
+	HandleAction(act);
+
+	gtk_widget_grab_focus(lookup_widget(guiRootWindow, "menuBar"));
+}
+
+gboolean UI_returnFocus(GtkWidget *widget, GdkEventButton *event, gpointer user_data)
+{
+	gtk_widget_grab_focus(lookup_widget(guiRootWindow, "menuBar"));
+	return FALSE;
+}
+
 void UI_setMarkers(uint32_t a, uint32_t b )
 {
 char string[500];
@@ -1086,16 +1109,14 @@
 // Override arrow keys to quickly navigate
 uint8_t UI_arrow_enabled(void)
 {
-  g_signal_connect(GTK_OBJECT(guiRootWindow), "key_press_event",
-                       GTK_SIGNAL_FUNC(UI_on_key_press),
-                       NULL);
-   
+	keyPressHandlerId = g_signal_connect(GTK_OBJECT(guiRootWindow), "key_press_event", GTK_SIGNAL_FUNC(UI_on_key_press), NULL);
+}
 
-}
 uint8_t UI_arrow_disabled(void)
 {
+	g_signal_handler_disconnect(GTK_OBJECT(guiRootWindow), keyPressHandlerId);
+}
 
-}
 gboolean UI_SliderPressed(GtkWidget *widget, GdkEventButton *event, gpointer user_data)
 {
 	if(event->state&GDK_SHIFT_MASK) SliderIsShifted=TRUE;



From gruntster at mail.berlios.de  Tue Aug 21 02:11:38 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 21 Aug 2007 02:11:38 +0200
Subject: [Avidemux-svn-commit] r3546 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:
	ADM_dialog ADM_gui
Message-ID: <200708210011.l7L0Bcrf007414@sheep.berlios.de>

Author: gruntster
Date: 2007-08-21 02:11:28 +0200 (Tue, 21 Aug 2007)
New Revision: 3546

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[QT] enable modifier keys for slider (Shift+Mouse = don't lock to intra frames; Shift+Left/Right = jump 25 frames; Ctrl+Left/Right = jump 50 frames)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-20 22:28:01 UTC (rev 3545)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-21 00:11:28 UTC (rev 3546)
@@ -60,11 +60,8 @@
 #include "ADM_audiofilter/audioencoder.h"
 #include "ADM_lavcodec.h"
 #include "ADM_codecs/ADM_ffmpegConfig.h"
-
 #include "DIA_resizeWiz.h"
-    
 #include "ADM_assert.h"
-int SliderIsShifted=0;
 
 //******************************
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-20 22:28:01 UTC (rev 3545)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 00:11:28 UTC (rev 3546)
@@ -26,6 +26,7 @@
 #include <QtGui/QSlider>
 #include <QtGui/QStatusBar>
 #include <QtGui/QWidget>
+#include <QtGui/QKeyEvent>
 
 #include "ADM_qslider.h"
 #include "default.h"
@@ -46,6 +47,9 @@
 extern void checkCrashFile(void);
 static void setupMenus(void);
 static void GUI_initCustom(void);
+
+int SliderIsShifted=0;
+static int shiftKeyHeld=0;
 static ADM_QSlider *slider=NULL;
 static int _upd_in_progres=0;
 /* Ugly game with macro so that buttons emit their name ...*/
@@ -129,12 +133,22 @@
 			printf("From +: %s\n",source);
 	}
 
-	void sliderMoved(int u) 
+	void sliderValueChanged(int u) 
 	{
 		if(!_upd_in_progres)
 			HandleAction (ACT_Scale) ;
 	}
 
+	void sliderMoved(int value)
+	{
+		SliderIsShifted = shiftKeyHeld;
+	}
+
+	void sliderReleased(void)
+	{
+		SliderIsShifted = 0;
+	}
+
 	void volumeChange( int u )
 	{
 #ifdef HAVE_AUDIO
@@ -154,6 +168,9 @@
 		HandleAction(ACT_PreviewChanged);
 	}
 
+protected:
+	bool eventFilter(QObject* watched, QEvent* event);
+
 private slots:
 
 private:
@@ -203,7 +220,9 @@
 	slider=ui.horizontalSlider;
 	slider->setMinimum(0);
 	slider->setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
 
 	// Volume slider
 	QSlider *volSlider=ui.horizontalSlider_2;
@@ -231,6 +250,9 @@
 		connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
 	}
 	printf("Menu built\n");
+
+	this->installEventFilter(this);
+	slider->installEventFilter(this);
 }
 /**
 \fn     custom
@@ -278,7 +300,6 @@
 	// Receveid a key press Event, look into table..
 	const char *source=qPrintable(sender()->objectName());
 
-	printf("Button From: %s\n",source);
 	Action action=searchTranslationTable(source);
 
 	if(action!=ACT_DUMMY)
@@ -289,6 +310,57 @@
 {
 	buttonPressed();
 }
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	if (event->type() == QEvent::KeyPress)
+	{
+		QKeyEvent *keyEvent = (QKeyEvent*)event;
+
+		if (watched == slider)
+		{
+			switch (keyEvent->key())
+			{
+				case Qt::Key_Left:
+					if (keyEvent->modifiers() == Qt::ShiftModifier)
+						HandleAction(ACT_Back25Frames);
+					else if (keyEvent->modifiers() == Qt::ControlModifier)
+						HandleAction(ACT_Back50Frames);
+					else
+						HandleAction(ACT_PreviousFrame);
+
+					return true;
+				case Qt::Key_Right:
+					if (keyEvent->modifiers() == Qt::ShiftModifier)
+						HandleAction(ACT_Forward25Frames);
+					else if (keyEvent->modifiers() == Qt::ControlModifier)
+						HandleAction(ACT_Forward50Frames);
+					else
+						HandleAction(ACT_NextFrame);
+
+					return true;
+				case Qt::Key_Up:
+					HandleAction(ACT_NextKFrame);
+					return true;
+				case Qt::Key_Down:
+					HandleAction(ACT_PreviousKFrame);
+					return true;
+			}
+		}
+		else if (keyEvent->key() == Qt::Key_Shift)
+			shiftKeyHeld = 1;
+	}
+	else if (event->type() == QEvent::KeyRelease)
+	{
+		QKeyEvent *keyEvent = (QKeyEvent*)event;
+
+		if (keyEvent->key() == Qt::Key_Shift)
+			shiftKeyHeld = 0;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************
@@ -442,7 +514,7 @@
 	const char *name;
 
 	nbVid=encoderGetNbEncoder();
-	printf("Found %d video encoder\n",nbVid);
+	printf("Found %d video encoder(s)\n",nbVid);
 	for(uint32_t i=1;i<nbVid;i++)
 	{
 		name=encoderGetIndexedName(i);
@@ -454,7 +526,7 @@
 	uint32_t nbAud;
 
 	nbAud=audioFilterGetNbEncoder();
-	printf("Found %d audio encoder\n",nbAud);		       
+	printf("Found %d audio encoder(s)\n",nbAud);		       
 	for(uint32_t i=1;i<nbAud;i++)
 	{
 		name=audioFilterGetIndexedName(i);
@@ -464,7 +536,7 @@
 	uint32_t nbFormat;
 
 	nbFormat=sizeof(ADM_allOutputFormat)/sizeof(ADM_FORMAT_DESC);
-	printf("Found %d Format \n",nbFormat);
+	printf("Found %d format(s)\n",nbFormat);
 	for(uint32_t i=0;i<nbFormat;i++)
 	{
 		WIDGET(comboBoxFormat)->addItem(_(ADM_allOutputFormat[i].text));	



From gruntster at mail.berlios.de  Tue Aug 21 17:03:04 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 21 Aug 2007 17:03:04 +0200
Subject: [Avidemux-svn-commit] r3547 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708211503.l7LF34AF031434@sheep.berlios.de>

Author: gruntster
Date: 2007-08-21 17:02:54 +0200 (Tue, 21 Aug 2007)
New Revision: 3547

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[QT] enable Up/Down keys for audio shift + fix focus issues

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp	2007-08-21 00:11:28 UTC (rev 3546)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp	2007-08-21 15:02:54 UTC (rev 3547)
@@ -29,16 +29,16 @@
 {
 	QSlider::paintEvent(event);	
 
-	if(markerA != 0 && markerB != frameCount)
+	int a = markerA, b = markerB;
+
+	if (markerA > markerB)
 	{
-		int a = markerA, b = markerB;
+		b = markerA;
+		a = markerB; 
+	}
 
-		if(markerA > markerB)
-		{
-			b = markerA;
-			a = markerB; 
-		}
-
+	if (frameCount > 0 && (a != 0 || b != frameCount))
+	{
 		int left = (a * width()) / frameCount;
 		int right = (b * width()) / frameCount;
 
@@ -52,27 +52,33 @@
 
 void ADM_QSlider::setMarkerA(uint32_t frameIndex)
 {
-	if(frameIndex > frameCount)
-		printf("[ADM_QSlider] Marker A is out of bounds (%u, %u)\n", markerA, frameCount);
-	else
-		markerA = frameIndex;
-
-	repaint();
+	setMarkers(frameIndex, markerB);
 }
 
 void ADM_QSlider::setMarkerB(uint32_t frameIndex)
 {
-	if(frameIndex > frameCount)
+	setMarkers(markerA, frameIndex);
+}
+
+void ADM_QSlider::setMarkers(uint32_t frameIndexA, uint32_t frameIndexB)
+{
+	if (frameIndexA > frameCount)
+		printf("[ADM_QSlider] Marker A is out of bounds (%u, %u)\n", markerA, frameCount);
+	else if (frameIndexB > frameCount)
 		printf("[ADM_QSlider] Marker B is out of bounds (%u, %u)\n", markerB, frameCount);
 	else
-		markerB = frameIndex;
+	{
+		markerA = frameIndexA;
+		markerB = frameIndexB;
 
-	repaint();
+		repaint();
+	}
 }
 
 void ADM_QSlider::setFrameCount(uint32_t count)
 {
 	frameCount = count;
+	repaint();
 }
 
 //EOF 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h	2007-08-21 00:11:28 UTC (rev 3546)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h	2007-08-21 15:02:54 UTC (rev 3547)
@@ -12,6 +12,7 @@
 
 	void setMarkerA(uint32_t frameIndex);
 	void setMarkerB(uint32_t frameIndex);
+	void setMarkers(uint32_t frameIndexA, uint32_t frameIndexB);
 	void setFrameCount(uint32_t count);
 };
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 00:11:28 UTC (rev 3546)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 15:02:54 UTC (rev 3547)
@@ -103,6 +103,7 @@
 	void buttonPressed(void);
 	void custom(void);
 	void toolButtonPressed(bool z);
+
 	void comboChanged(int z)
 	{
 		const char *source=qPrintable(sender()->objectName());
@@ -168,8 +169,12 @@
 		HandleAction(ACT_PreviewChanged);
 	}
 
+	void previousIntraFrame(void);
+	void nextIntraFrame(void);
+
 protected:
 	bool eventFilter(QObject* watched, QEvent* event);
+	void mousePressEvent(QMouseEvent* event);
 
 private slots:
 
@@ -212,6 +217,9 @@
 	LIST_OF_BUTTONS
 #undef PROCESS
 
+	connect(ui.actionPrevious_intra_frame, SIGNAL(triggered()), this, SLOT(previousIntraFrame()));
+	connect(ui.actionNext_intra_frame, SIGNAL(triggered()), this, SLOT(nextIntraFrame()));
+
 	//ACT_VideoCodecChanged
 	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
 	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
@@ -345,10 +353,13 @@
 				case Qt::Key_Down:
 					HandleAction(ACT_PreviousKFrame);
 					return true;
+				case Qt::Key_Shift:
+					shiftKeyHeld = 1;
+					break;
 			}
 		}
-		else if (keyEvent->key() == Qt::Key_Shift)
-			shiftKeyHeld = 1;
+		else if (keyEvent->key() == Qt::Key_Return)
+			this->setFocus(Qt::OtherFocusReason);
 	}
 	else if (event->type() == QEvent::KeyRelease)
 	{
@@ -361,6 +372,27 @@
 	return QObject::eventFilter(watched, event);
 }
 
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************
@@ -632,11 +664,11 @@
 	WIDGET(label_2)->setText(text);
 
 }
+
 /**
     \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
     \brief  Display the time corresponding to current frame according to fps (fps1000)
 */
-
 void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
 {
 	char text[80];   
@@ -645,29 +677,31 @@
 	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
 	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
 	WIDGET(lineEdit_2)->setText(text);
+}
 
-}
 /**
     \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
     \brief  Display the time corresponding to current frame according to fps (fps1000) and total duration
 */
-
 void UI_setTimeCount(uint32_t curFrame,uint32_t total, uint32_t fps)
 {
 	char text[80];   
 	uint16_t mm,hh,ss,ms;
 
+	if(total) total--; // We display from 0 to X
+
 	UI_updateTimeCount(curFrame,fps);
 	frame2time(total,fps, &hh, &mm, &ss, &ms);
 	sprintf(text, "/ %02d:%02d:%02d.%03d", hh, mm, ss, ms);
 	WIDGET(label_7)->setText(text);
+
 	slider->setFrameCount(total);
 }
+
 /**
     \fn     UI_setMarkers(uint32_t a, uint32_t b )
     \brief  Display frame # for marker A & B
 */
-
 void UI_setMarkers(uint32_t a, uint32_t b)
 {
 	char text[80];
@@ -678,14 +712,13 @@
 	snprintf(text,79,"%06lu",b);
 	WIDGET(pushButtonJumpToMarkerB)->setText(text);
 
-	slider->setMarkerA(a);
-	slider->setMarkerB(b);
+	slider->setMarkers(a, b);
 }
+
 /**
     \fn     UI_getCurrentVCodec(void)
     \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
 */
-
 int 	UI_getCurrentVCodec(void)
 {
 	int i=WIDGET(comboBoxVideo)->currentIndex();

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-21 00:11:28 UTC (rev 3546)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-21 15:02:54 UTC (rev 3547)
@@ -44,8 +44,6 @@
 PROCESS(actionPlay_Stop,ACT_StopAvi) \
 PROCESS(actionPrevious_Frame,ACT_PreviousFrame) \
 PROCESS(actionNext_Frame,ACT_NextFrame) \
-PROCESS(actionPrevious_intra_frame,ACT_PreviousKFrame) \
-PROCESS(actionNext_intra_frame,ACT_NextKFrame) \
 PROCESS(actionPrevious_black_frame,ACT_PrevBlackFrame) \
 PROCESS(actionNext_blak_frame,ACT_NextBlackFrame) \
 PROCESS(actionFirst_Frame,ACT_Begin) \
@@ -70,6 +68,8 @@
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  
 
 #if 0
+PROCESS(actionPrevious_intra_frame,ACT_PreviousKFrame) \
+PROCESS(actionNext_intra_frame,ACT_NextKFrame) \
 PROCESS(actionZoom_4_1,ACT_ZOOM_4_1) \
 PROCESS(actionMain_toolbar,ACT_SaveCurrentWork) \
 PROCESS(actionA_V_toolbar,ACT_DUMMY)

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 00:11:28 UTC (rev 3546)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 15:02:54 UTC (rev 3547)
@@ -1018,12 +1018,6 @@
   curframe = 0;
   getFirstVideoFilter(); // reinit first filter
 
-
-  //frameStart = 0;
-  //frameEnd = avifileinfo->nb_frames - 1;
-  video_body->getMarkers(&frameStart,&frameEnd);
-  UI_setMarkers (frameStart, frameEnd);
-
   // now get audio information if exists
   wavinfo = video_body->getAudioInfo ();	//wavinfo); // will be null if no audio
   if (!wavinfo)
@@ -1047,11 +1041,14 @@
 
   // Init renderer
     admPreview::setMainDimension(avifileinfo->width, avifileinfo->height);
-  curframe = 0;
-  
+  curframe = 0;  
 
   // Draw first frame
-  rebuild_status_bar (); 
+  rebuild_status_bar();
+
+  video_body->getMarkers(&frameStart,&frameEnd);
+  UI_setMarkers (frameStart, frameEnd);
+
   getFirstVideoFilter(); // Rebuild filter if needed
   
   /* Zoom out if needed */



From gruntster at mail.berlios.de  Tue Aug 21 19:14:43 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 21 Aug 2007 19:14:43 +0200
Subject: [Avidemux-svn-commit] r3548 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_NONE/ADM_gui2
	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
Message-ID: <200708211714.l7LHEhsd031438@sheep.berlios.de>

Author: gruntster
Date: 2007-08-21 19:14:33 +0200 (Tue, 21 Aug 2007)
New Revision: 3548

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[QT] clip path from script name in Custom menu + refresh Custom menu after saving new project

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -921,6 +921,8 @@
 
 }
 
+void UI_refreshCustomMenu(void) {}
+
 int  UI_getCurrentPreview(void)
  {
        

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -55,6 +55,8 @@
 void UI_setVProcessToggleStatus( uint8_t status )
 {}
 //**************************************************
+void UI_refreshCustomMenu(void) {}
+
 int    UI_getCurrentPreview(void)
 {
   return 0; 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -46,7 +46,6 @@
 extern const char* audioFilterGetIndexedName(uint32_t i);
 extern void checkCrashFile(void);
 static void setupMenus(void);
-static void GUI_initCustom(void);
 
 int SliderIsShifted=0;
 static int shiftKeyHeld=0;
@@ -97,6 +96,7 @@
 public:
 	MainWindow();
 	Ui_MainWindow ui;
+	void buildCustomMenu(void);
 
 public slots:
 	void timeChanged(int);
@@ -250,14 +250,7 @@
 	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
 
 	/* Build the custom menu */
-	GUI_initCustom();
-	for(int i=0;i<ADM_nbCustom;i++)
-	{
-		customActions[i]=new QAction(customNames[i],NULL);
-		ui.menuCustom->addAction(customActions[i]);
-		connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
-	}
-	printf("Menu built\n");
+	buildCustomMenu();
 
 	this->installEventFilter(this);
 	slider->installEventFilter(this);
@@ -393,6 +386,53 @@
 		HandleAction(ACT_NextKFrame);
 }
 
+void MainWindow::buildCustomMenu(void)
+{
+	if (ADM_nbCustom)
+	{
+		for(int i = 0; i < ADM_nbCustom; i++)
+		{
+			disconnect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+			delete customActions[i];
+			customActions[i] = NULL;
+		}
+
+		ui.menuCustom->clear();
+		ADM_nbCustom = 0;
+	}
+
+	char *customdir = ADM_getCustomDir();
+
+	if (!customdir)
+	{
+		printf("No custom dir...\n");
+		return;
+	}
+
+	/* Collect the name */
+	if (! buildDirectoryContent(&ADM_nbCustom, customdir, customNames, ADM_MAC_CUSTOM_SCRIPT,".js"))
+	{
+		printf("Failed to build custom dir content");
+		return;
+	}
+
+	if(ADM_nbCustom)
+	{
+		printf("Found %u custom script(s), adding them\n", ADM_nbCustom);
+
+		for(int i=0; i < ADM_nbCustom; i++)
+		{
+			customActions[i] = new QAction(GetFileName(customNames[i]), NULL);
+			ui.menuCustom->addAction(customActions[i]);
+			connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+		}
+	}
+	else
+		printf("No custom scripts\n");
+
+	printf("Custom menu built\n");
+}
+
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************
@@ -410,6 +450,11 @@
 QGraphicsView *drawWindow=NULL;
 uint8_t UI_updateRecentMenu( void );
 
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)->buildCustomMenu();
+}
+
 /**
     \fn UI_getCurrentPreview(void)
     \brief Read previewmode from comboxbox 
@@ -781,30 +826,6 @@
 }
 
 /**
-      \fn GUI_initCustom
-      \brief Initialize custom menu
-*/
-void GUI_initCustom(void )
-{
-	char *customdir=ADM_getCustomDir();
-	if(!customdir) 
-	{
-		printf("No custom dir...\n");
-		return;
-	}
-	/* Collect the name */
-	if(! buildDirectoryContent(&ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,".js"))
-	{
-		printf("Failed to build custom dir content");
-		return;
-	}
-	if(!ADM_nbCustom)
-	{
-		printf("No custom script\n");
-	}
-	printf("Found %u custom scripts, adding them\n",ADM_nbCustom);
-}
-/**
       \fn UI_getTimeShift
       \brief get state (on/off) and value for time Shift
 */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-21 17:14:33 UTC (rev 3548)
@@ -46,5 +46,7 @@
 
 uint8_t UI_arrow_enabled(void);
 uint8_t UI_arrow_disabled(void);
+
+void UI_refreshCustomMenu(void);
 #endif
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -457,6 +457,7 @@
 
     case ACT_SaveWork:
       GUI_FileSelWrite (_("Select Workbench to Save"), A_saveWorkbench);
+	  UI_refreshCustomMenu();
       break;
     case ACT_ADD_JOB:
         A_addJob();
@@ -468,6 +469,7 @@
          ADM_dealloc(tmp);
       }else{
         GUI_FileSelWrite (_("Select Workbench to Save"), A_saveWorkbench);
+		UI_refreshCustomMenu();
       }
       break;
         case ACT_JumpToFrame: 



From mean at mail.berlios.de  Tue Aug 21 20:53:33 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 21 Aug 2007 20:53:33 +0200
Subject: [Avidemux-svn-commit] r3549 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
Message-ID: <200708211853.l7LIrXta030781@sheep.berlios.de>

Author: mean
Date: 2007-08-21 20:53:32 +0200 (Tue, 21 Aug 2007)
New Revision: 3549

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp
Log:
[QT] Matrix diaElem for QT

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp	2007-08-21 17:14:33 UTC (rev 3548)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp	2007-08-21 18:53:32 UTC (rev 3549)
@@ -38,20 +38,80 @@
 diaElemMatrix::diaElemMatrix(uint8_t *trix,const char *toggleTitle, uint32_t trixSize,const char *tip)
   : diaElem(ELEM_MATRIX)
 {
+	
+	  param=(void *)trix;
+	  paramTitle=shortkey(toggleTitle);
+	  _matrix=new uint8_t[trixSize*trixSize];
+	   _matrixSize=trixSize;
+	   memcpy(_matrix,trix,trixSize*trixSize);
+	  this->tip=tip;
+	
 }
 
 diaElemMatrix::~diaElemMatrix()
 {
+	 if(_matrix) delete [] _matrix;
+	  _matrix=NULL;
+	  if(myWidget)
+	  {
+		  QSpinBox **arrayWidget=( QSpinBox **)myWidget;
+		  delete [] arrayWidget;
+		  myWidget=NULL;
+	  }
+	  if(paramTitle)
+	      delete paramTitle;
+	  paramTitle=NULL;
 }
 void diaElemMatrix::setMe(void *dialog, void *opaque,uint32_t line)
 {
+	 QSpinBox **box=new QSpinBox*[_matrixSize*_matrixSize];
+	  QGridLayout *layout=(QGridLayout*) opaque;
+	 myWidget=(void *)box; 
 
+
+	  
+	  
+	 
+	 QLabel *text=new QLabel( this->paramTitle,(QWidget *)dialog);
+	 layout->addWidget(text,line,0);
+	 
+	 QGridLayout *layout2=new QGridLayout((QWidget *)dialog);
+	  layout->addLayout(layout2,line,1);
+	  /*layout->setMargin(0);
+	  layout->setSpacing(0);*/
+	 
+
+	 for(int y=0;y<_matrixSize*_matrixSize;y++)
+	 			  {
+	 				  box[y]=new QSpinBox((QWidget *)dialog);
+	 				  box[y]->setMinimum(0);
+	 				  box[y]->setMaximum(255);
+	 				  box[y]->setValue(_matrix[y]);
+	 				 layout2->addWidget(box[y],y/_matrixSize,y%_matrixSize);
+	 			  }
+	 myWidget =(void *)box;
 }
 void diaElemMatrix::getMe(void)
 {
-  
+	 QSpinBox **box=( QSpinBox **)myWidget;
+	 ADM_assert(box);
+	for(int y=0;y<_matrixSize*_matrixSize;y++)
+		 			  {
+		 				  _matrix[y]=box[y]->value();
+		 			  }
+	memcpy(param,_matrix,_matrixSize*_matrixSize);
 }
 void diaElemMatrix::enable(uint32_t onoff)
 {
+	QSpinBox **arrayWidget=( QSpinBox **)myWidget;
+			 
+			 ADM_assert(arrayWidget);
+			 int index=0;
+			  for(int y=0;y<_matrixSize*_matrixSize;y++)
+			  {
+				  if(onoff) arrayWidget[y]->setEnabled(1);
+				  else arrayWidget[y]->setEnabled(0);
+				  
+			  }
 }
 



From gruntster at mail.berlios.de  Wed Aug 22 02:12:50 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 22 Aug 2007 02:12:50 +0200
Subject: [Avidemux-svn-commit] r3550 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_script
	ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_NONE/ADM_gui2
	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
Message-ID: <200708220012.l7M0Coe3000935@sheep.berlios.de>

Author: gruntster
Date: 2007-08-22 02:12:37 +0200 (Wed, 22 Aug 2007)
New Revision: 3550

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemux.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
Log:
[QT] jump to frame and time via the textboxes on main window

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemux.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemux.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSAvidemux.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -46,7 +46,7 @@
 extern int A_delete(uint32_t start, uint32_t end);
 
 extern uint8_t A_ListAllBlackFrames( char *file );
-extern uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss);
+extern uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss,uint32_t ms);
 extern uint8_t addFile(char *name);
 
 uint8_t A_setContainer(const char *cont);
@@ -484,7 +484,7 @@
 	if(JSVAL_IS_INT(argv[0]) == false || JSVAL_IS_INT(argv[1]) == false || JSVAL_IS_INT(argv[2]) == false)
 		return JS_FALSE;
         enterLock();
-	*rval = INT_TO_JSVAL(A_jumpToTime(JSVAL_TO_INT(argv[0]),JSVAL_TO_INT(argv[1]),JSVAL_TO_INT(argv[2])));
+	*rval = INT_TO_JSVAL(A_jumpToTime(JSVAL_TO_INT(argv[0]),JSVAL_TO_INT(argv[1]),JSVAL_TO_INT(argv[2]), 0));
 	leaveLock();
 	return JS_TRUE;
 }// end GoToTime

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -833,6 +833,12 @@
 	return  (uint32_t)i;
 	 
 }
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
+{
+	return 0;
+}
+
 /**
 		in=0 -> arts1
 		in=1 -> alsa

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -103,6 +103,9 @@
 {
     return 0;
 }
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms) { return 0; }
+
 void UI_JumpDone(void)
 {}
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -27,6 +27,7 @@
 #include <QtGui/QStatusBar>
 #include <QtGui/QWidget>
 #include <QtGui/QKeyEvent>
+#include <QtGui/QValidator>
 
 #include "ADM_qslider.h"
 #include "default.h"
@@ -51,10 +52,13 @@
 static int shiftKeyHeld=0;
 static ADM_QSlider *slider=NULL;
 static int _upd_in_progres=0;
-/* Ugly game with macro so that buttons emit their name ...*/
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
 static QAction  *customActions[ADM_MAC_CUSTOM_SCRIPT];
 static uint32_t ADM_nbCustom=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+
 #ifdef HAVE_AUDIO
 extern uint8_t AVDM_setVolume(int volume);
 #endif
@@ -85,6 +89,11 @@
 };
 static Action searchTranslationTable(const char *name);
 #define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+
 /*
     Declare the class that will be our main window
 
@@ -137,7 +146,7 @@
 	void sliderValueChanged(int u) 
 	{
 		if(!_upd_in_progres)
-			HandleAction (ACT_Scale) ;
+			HandleAction(ACT_Scale);
 	}
 
 	void sliderMoved(int value)
@@ -172,6 +181,25 @@
 	void previousIntraFrame(void);
 	void nextIntraFrame(void);
 
+	void timeChangeFinished(void)
+	{
+		this->setFocus(Qt::OtherFocusReason);
+	}
+
+	void currentFrameChanged(void)
+	{
+		HandleAction(ACT_JumpToFrame);
+
+		this->setFocus(Qt::OtherFocusReason);
+	}
+
+	void currentTimeChanged(void)
+	{
+		HandleAction(ACT_JumpToTime);
+
+		this->setFocus(Qt::OtherFocusReason);
+	}
+
 protected:
 	bool eventFilter(QObject* watched, QEvent* event);
 	void mousePressEvent(QMouseEvent* event);
@@ -248,12 +276,29 @@
 	/* Time Shift */
 	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
 	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
 
+	connect(ui.lineEdit, SIGNAL(editingFinished()), this, SLOT(currentFrameChanged()));
+
+	QIntValidator *frameValidator = new QIntValidator(0, 0x7FFFFFFF, this);
+	ui.lineEdit->setValidator(frameValidator);
+
+	connect(ui.lineEdit, SIGNAL(editingFinished()), this, SLOT(currentFrameChanged()));
+
+	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.lineEdit_2->setValidator(timeValidator);
+	ui.lineEdit_2->setInputMask("99:99:99.999");
+
+	connect(ui.lineEdit_2, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
 	/* Build the custom menu */
 	buildCustomMenu();
 
 	this->installEventFilter(this);
 	slider->installEventFilter(this);
+	ui.lineEdit->installEventFilter(this);
+	ui.lineEdit_2->installEventFilter(this);
 }
 /**
 \fn     custom
@@ -314,52 +359,71 @@
 
 bool MainWindow::eventFilter(QObject* watched, QEvent* event)
 {
-	if (event->type() == QEvent::KeyPress)
+	QKeyEvent *keyEvent;
+
+	switch (event->type())
 	{
-		QKeyEvent *keyEvent = (QKeyEvent*)event;
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
 
-		if (watched == slider)
-		{
-			switch (keyEvent->key())
+			if (watched == slider)
 			{
-				case Qt::Key_Left:
-					if (keyEvent->modifiers() == Qt::ShiftModifier)
-						HandleAction(ACT_Back25Frames);
-					else if (keyEvent->modifiers() == Qt::ControlModifier)
-						HandleAction(ACT_Back50Frames);
-					else
-						HandleAction(ACT_PreviousFrame);
+				switch (keyEvent->key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
 
-					return true;
-				case Qt::Key_Right:
-					if (keyEvent->modifiers() == Qt::ShiftModifier)
-						HandleAction(ACT_Forward25Frames);
-					else if (keyEvent->modifiers() == Qt::ControlModifier)
-						HandleAction(ACT_Forward50Frames);
-					else
-						HandleAction(ACT_NextFrame);
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
 
-					return true;
-				case Qt::Key_Up:
-					HandleAction(ACT_NextKFrame);
-					return true;
-				case Qt::Key_Down:
-					HandleAction(ACT_PreviousKFrame);
-					return true;
-				case Qt::Key_Shift:
-					shiftKeyHeld = 1;
-					break;
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
 			}
-		}
-		else if (keyEvent->key() == Qt::Key_Return)
-			this->setFocus(Qt::OtherFocusReason);
-	}
-	else if (event->type() == QEvent::KeyRelease)
-	{
-		QKeyEvent *keyEvent = (QKeyEvent*)event;
 
-		if (keyEvent->key() == Qt::Key_Shift)
-			shiftKeyHeld = 0;
+			break;
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent->key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+			if (watched == ui.lineEdit)
+			{
+				QString temp(ui.lineEdit->text());
+				int pos = 0;
+
+				if (ui.lineEdit->validator()->validate(temp, pos) != QValidator::Acceptable)
+					UI_updateFrameCount(currentFrame);
+			}
+			else if (watched == ui.lineEdit_2)
+			{
+				uint16_t hh, mm, ss, ms;
+
+				if (!UI_readCurTime(hh, mm, ss, ms))
+					UI_updateTimeCount(currentFrame, currentFps);
+			}
 	}
 
 	return QObject::eventFilter(watched, event);
@@ -637,8 +701,40 @@
 	_upd_in_progres++;
 	slider->setValue( (int)(val * 10000000));
 	_upd_in_progres--;
+}
 
+uint32_t UI_readCurFrame(void)
+{
+	bool ok;
+	
+	return WIDGET(lineEdit)->text().toUInt(&ok);
 }
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(lineEdit_2)->text();
+	int pos;
+
+	if (WIDGET(lineEdit_2)->validator()->validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&frame, currentFps, hh, mm, ss, ms);
+
+		if (frame <= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
 void UI_purge( void )
 {
 	QCoreApplication::processEvents ();
@@ -681,33 +777,36 @@
 	WIDGET(label_8)->setText(string);	
 
 }
+
 /**
     \fn     UI_updateFrameCount(uint32_t curFrame)
     \brief  Display the current displayed frame #
 */
-
 void UI_updateFrameCount(uint32_t curFrame)
 {
 	char string[30];
 	sprintf(string,"%lu",curFrame);
 	WIDGET(lineEdit)->setText(string);
 
+	currentFrame = curFrame;
 }
+
 /**
     \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
     \brief  Display the current displayed frame # and total frame #
 */
-
 void UI_setFrameCount(uint32_t curFrame,uint32_t total)
 {
 	char text[80]; 
-	if(total) total--; // We display from 0 to X  
+	if (total) total--; // We display from 0 to X  
 
 	UI_updateFrameCount(curFrame);
 
-	sprintf(text, "/ %lu ", total);
+	sprintf(text, "/ %lu", total);
 	WIDGET(label_2)->setText(text);
 
+	((QIntValidator*)(WIDGET(lineEdit)->validator()))->setTop(total);
+	frameCount = total;
 }
 
 /**
@@ -741,6 +840,8 @@
 	WIDGET(label_7)->setText(text);
 
 	slider->setFrameCount(total);
+
+	currentFps = fps;	
 }
 
 /**

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-22 00:12:37 UTC (rev 3550)
@@ -911,6 +911,9 @@
               <height>0</height>
              </size>
             </property>
+            <property name="text" >
+             <string>0</string>
+            </property>
             <property name="maxLength" >
              <number>8</number>
             </property>
@@ -918,7 +921,7 @@
              <enum>QLineEdit::Normal</enum>
             </property>
             <property name="cursorPosition" >
-             <number>0</number>
+             <number>1</number>
             </property>
            </widget>
           </item>
@@ -995,6 +998,9 @@
               <height>16777215</height>
              </size>
             </property>
+            <property name="text" >
+             <string>00:00:00.000</string>
+            </property>
             <property name="maxLength" >
              <number>12</number>
             </property>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -17,7 +17,6 @@
 void UI_setVProcessToggleStatus( uint8_t status ) {}
 void UI_iconify( void ) {}
 void UI_deiconify( void ) {}
-uint32_t UI_readCurFrame( void ) {return 0;}
 void UI_JumpDone(void) {}
 void UI_toogleSide(void) {}
 void UI_toogleMain(void) {}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-22 00:12:37 UTC (rev 3550)
@@ -23,6 +23,7 @@
 void UI_deiconify( void );
 
 uint32_t UI_readCurFrame( void );
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
 void UI_JumpDone(void);
 
 int    UI_getCurrentPreview(void);

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-22 00:12:37 UTC (rev 3550)
@@ -133,7 +133,7 @@
 extern uint8_t ogmSave(const char  *name);
 //
 static uint8_t A_pass(char *name);
-uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss);
+uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss,uint32_t ms);
 //__________
 extern uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss);
 extern uint8_t GUI_getFrame(uint32_t frameno,  uint32_t *flags);
@@ -448,13 +448,6 @@
                         GUI_FileSelWrite (_("Select OGM File to Write"), (SELFILE_CB *)ogmSave);
     			break;
 				
-    case ACT_FrameChanged:
-    			printf("FrameChanged\n");
-			break;
-  	case ACT_TimeChanged:
-			printf("TimeChanged\n");
-      			break;			
-
     case ACT_SaveWork:
       GUI_FileSelWrite (_("Select Workbench to Save"), A_saveWorkbench);
 	  UI_refreshCustomMenu();
@@ -474,7 +467,6 @@
       break;
         case ACT_JumpToFrame: 
                 // read value	
-                printf("Jump!\n");	 
                 nf=UI_readCurFrame();
                 if(nf>0 && nf< avifileinfo->nb_frames)
                 {
@@ -482,13 +474,21 @@
                 }
                 UI_JumpDone();
                 break;
+	case ACT_JumpToTime:
+		{
+			uint16_t hh, mm, ss, ms;
+
+			if (UI_readCurTime(hh, mm, ss, ms))
+				A_jumpToTime(hh, mm, ss, ms);
+		}
+		break;
     case ACT_GotoTime:
                 {
                         uint16_t mm,hh,ss,ms;
                              frame2time(curframe,avifileinfo->fps1000,&hh,&mm,&ss,&ms);
                              if(DIA_gotoTime(&hh,&mm,&ss))
                                 {
-                                        A_jumpToTime(hh,mm,ss);
+                                        A_jumpToTime(hh,mm,ss, 0);
                                 }
                 }
                 break;
@@ -1940,10 +1940,10 @@
 }
 extern int DIA_getMPParams( uint32_t *pplevel, uint32_t *ppstrength,uint32_t *swap);
 //
-uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss)
+uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss,uint32_t ms)
 {
 uint32_t frame;
-        time2frame(&frame,avifileinfo->fps1000,hh,mm,ss,0);
+        time2frame(&frame,avifileinfo->fps1000,hh,mm,ss,ms);
         if(frame>=avifileinfo->nb_frames)
         {
                 printf("Frame is out of bound\n");

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-08-21 18:53:32 UTC (rev 3549)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-08-22 00:12:37 UTC (rev 3550)
@@ -82,11 +82,6 @@
   ACT_AudioSourceAC3,
   ACT_AudioSourceNone,
 
- 
-
-  ACT_FrameChanged,
-  ACT_TimeChanged,
-
   ACT_MarkA,
   ACT_MarkB,
   ACT_GotoMarkA,
@@ -158,6 +153,7 @@
 
 ACT_Requant,
 ACT_JumpToFrame,
+ACT_JumpToTime,
 ACT_RunScript,
 ACT_AudioCodecChanged,
 ACT_VideoCodecChanged,



From gruntster at mail.berlios.de  Wed Aug 22 17:13:31 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 22 Aug 2007 17:13:31 +0200
Subject: [Avidemux-svn-commit] r3551 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708221513.l7MFDVWJ011245@sheep.berlios.de>

Author: gruntster
Date: 2007-08-22 17:13:23 +0200 (Wed, 22 Aug 2007)
New Revision: 3551

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[QT] enable mute button

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-22 00:12:37 UTC (rev 3550)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-22 15:13:23 UTC (rev 3551)
@@ -162,7 +162,8 @@
 	void volumeChange( int u )
 	{
 #ifdef HAVE_AUDIO
-		if(_upd_in_progres) return;
+		if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
+			return;
 
 		_upd_in_progres++;
 
@@ -173,6 +174,16 @@
 #endif
 	}
 
+	void audioToggled(bool checked)
+	{
+#ifdef HAVE_AUDIO
+		if (checked)
+			AVDM_setVolume(ui.horizontalSlider_2->value());
+		else
+			AVDM_setVolume(0);
+#endif
+	}
+
 	void previewModeChanged(QAction *action)
 	{
 		HandleAction(ACT_PreviewChanged);
@@ -264,7 +275,8 @@
 	QSlider *volSlider=ui.horizontalSlider_2;
 	volSlider->setMinimum(0);
 	volSlider->setMaximum(100);
-	connect( volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
 
 	// default state
 	bool b=0;



From gruntster at mail.berlios.de  Wed Aug 22 19:22:30 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 22 Aug 2007 19:22:30 +0200
Subject: [Avidemux-svn-commit] r3552 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_QT4/ADM_dialog ADM_QT4/ADM_gui ADM_commonUI
Message-ID: <200708221722.l7MHMUsH028492@sheep.berlios.de>

Author: gruntster
Date: 2007-08-22 19:21:56 +0200 (Wed, 22 Aug 2007)
New Revision: 3552

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
Log:
[QT] enable spacebar + tidy ups

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp	2007-08-22 15:13:23 UTC (rev 3551)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp	2007-08-22 17:21:56 UTC (rev 3552)
@@ -67,10 +67,8 @@
 void ADM_QCanvas::paintEvent(QPaintEvent *ev)
 {
     if(!dataBuffer)
-    {
-      printf("Nothing to draw\n");
       return ;
-    }
+
     QImage image(dataBuffer,_w,_h,QImage::Format_RGB32);
       QPainter painter(this);
       painter.drawImage(QPoint(0,0),image);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-22 15:13:23 UTC (rev 3551)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-22 17:21:56 UTC (rev 3552)
@@ -311,6 +311,8 @@
 	slider->installEventFilter(this);
 	ui.lineEdit->installEventFilter(this);
 	ui.lineEdit_2->installEventFilter(this);
+
+	this->setFocus(Qt::OtherFocusReason);
 }
 /**
 \fn     custom
@@ -411,6 +413,11 @@
 						break;
 				}
 			}
+			else if (keyEvent->key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
 
 			break;
 		case QEvent::KeyRelease:

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-08-22 15:13:23 UTC (rev 3551)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-08-22 17:21:56 UTC (rev 3552)
@@ -98,10 +98,8 @@
         void paintEvent(QPaintEvent *ev)
         {
           if(!displayW || !displayH || !rgbDataBuffer || accelRender)
-          {
-            printf("Nothing to draw\n");
             return ;
-          }
+
           if(accelRender) 
           {
             if(lastImage)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-08-22 15:13:23 UTC (rev 3551)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-08-22 17:21:56 UTC (rev 3552)
@@ -107,7 +107,7 @@
 	char SDL_windowhack[32];
     int winid=(int)window->window;
 
-    sprintf(SDL_windowhack,"[SDL] SDL_WINDOWID=%ld",winid);
+    sprintf(SDL_windowhack,"SDL_WINDOWID=%ld",winid);
     putenv(SDL_windowhack);
 #endif
 



From gruntster at mail.berlios.de  Wed Aug 22 20:06:07 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 22 Aug 2007 20:06:07 +0200
Subject: [Avidemux-svn-commit] r3553 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200708221806.l7MI67Gm011625@sheep.berlios.de>

Author: gruntster
Date: 2007-08-22 20:05:57 +0200 (Wed, 22 Aug 2007)
New Revision: 3553

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/dsputil.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/pthread.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
Log:
[lav] "official" stack alignment fix

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/dsputil.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/dsputil.c	2007-08-22 17:21:56 UTC (rev 3552)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/dsputil.c	2007-08-22 18:05:57 UTC (rev 3553)
@@ -3838,7 +3838,7 @@
     return 0;
 }
 
-void attribute_align_arg dsputil_init(DSPContext* c, AVCodecContext *avctx)
+void dsputil_init(DSPContext* c, AVCodecContext *avctx)
 {
     int i;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c	2007-08-22 17:21:56 UTC (rev 3552)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_enc.c	2007-08-22 18:05:57 UTC (rev 3553)
@@ -1918,7 +1918,7 @@
     return 0;
 }
 
-static int attribute_align_arg estimate_motion_thread(AVCodecContext *c, void *arg){
+static int estimate_motion_thread(AVCodecContext *c, void *arg){
     MpegEncContext *s= arg;
 
     ff_check_alignment();
@@ -1945,7 +1945,7 @@
     return 0;
 }
 
-static int attribute_align_arg mb_var_thread(AVCodecContext *c, void *arg){
+static int mb_var_thread(AVCodecContext *c, void *arg){
     MpegEncContext *s= arg;
     int mb_x, mb_y;
 
@@ -1987,7 +1987,7 @@
         s->misc_bits+= get_bits_diff(s);
 }
 
-static int attribute_align_arg encode_thread(AVCodecContext *c, void *arg){
+static int encode_thread(AVCodecContext *c, void *arg){
     MpegEncContext *s= arg;
     int mb_x, mb_y, pdif = 0;
     int i, j;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/pthread.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/pthread.c	2007-08-22 17:21:56 UTC (rev 3552)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/pthread.c	2007-08-22 18:05:57 UTC (rev 3553)
@@ -42,7 +42,7 @@
     int done;
 } ThreadContext;
 
-static void* worker(void *v)
+static void* attribute_align_arg worker(void *v)
 {
     AVCodecContext *avctx = v;
     ThreadContext *c = avctx->thread_opaque;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-08-22 17:21:56 UTC (rev 3552)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-08-22 18:05:57 UTC (rev 3553)
@@ -816,7 +816,7 @@
     return pic;
 }
 
-int avcodec_open(AVCodecContext *avctx, AVCodec *codec)
+int attribute_align_arg avcodec_open(AVCodecContext *avctx, AVCodec *codec)
 {
     int ret= -1;
 
@@ -864,7 +864,7 @@
     return ret;
 }
 
-int avcodec_encode_audio(AVCodecContext *avctx, uint8_t *buf, int buf_size,
+int attribute_align_arg avcodec_encode_audio(AVCodecContext *avctx, uint8_t *buf, int buf_size,
                          const short *samples)
 {
     if(buf_size < FF_MIN_BUFFER_SIZE && 0){
@@ -879,7 +879,7 @@
         return 0;
 }
 
-int avcodec_encode_video(AVCodecContext *avctx, uint8_t *buf, int buf_size,
+int attribute_align_arg avcodec_encode_video(AVCodecContext *avctx, uint8_t *buf, int buf_size,
                          const AVFrame *pict)
 {
     if(buf_size < FF_MIN_BUFFER_SIZE){
@@ -907,7 +907,7 @@
     return ret;
 }
 
-int avcodec_decode_video(AVCodecContext *avctx, AVFrame *picture,
+int attribute_align_arg avcodec_decode_video(AVCodecContext *avctx, AVFrame *picture,
                          int *got_picture_ptr,
                          uint8_t *buf, int buf_size)
 {
@@ -930,7 +930,7 @@
     return ret;
 }
 
-int avcodec_decode_audio2(AVCodecContext *avctx, int16_t *samples,
+int attribute_align_arg avcodec_decode_audio2(AVCodecContext *avctx, int16_t *samples,
                          int *frame_size_ptr,
                          uint8_t *buf, int buf_size)
 {



From gruntster at mail.berlios.de  Thu Aug 23 10:25:00 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 23 Aug 2007 10:25:00 +0200
Subject: [Avidemux-svn-commit] r3554 - branches/avidemux_2.4_branch
Message-ID: <200708230825.l7N8P0Zb000611@sheep.berlios.de>

Author: gruntster
Date: 2007-08-23 10:24:54 +0200 (Thu, 23 Aug 2007)
New Revision: 3554

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
Log:
[CMake] fix HAVE_LIBINTL_H endif

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-22 18:05:57 UTC (rev 3553)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-23 08:24:54 UTC (rev 3554)
@@ -90,8 +90,8 @@
         MESSAGE(STATUS "Does not work, with    ${outputWithLibintl}")
       endif(WITH_LIBINTL)
   endif(WITHOUT_LIBINTL)
+endif(NO_NLS)
 endif(HAVE_LIBINTL_H)
-endif(NO_NLS)
 ########################################
 # Locale
 ########################################



From gruntster at mail.berlios.de  Thu Aug 23 19:48:10 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 23 Aug 2007 19:48:10 +0200
Subject: [Avidemux-svn-commit] r3555 - in
	branches/avidemux_2.4_branch/avidemux: ADM_filter
	ADM_userInterfaces/ADM_GTK/ADM_filters
	ADM_userInterfaces/ADM_QT4/ADM_filters
Message-ID: <200708231748.l7NHmANg023484@sheep.berlios.de>

Author: gruntster
Date: 2007-08-23 19:48:01 +0200 (Thu, 23 Aug 2007)
New Revision: 3555

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
Log:
[Filter] only #include <vector> where necessary

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-23 08:24:54 UTC (rev 3554)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-23 17:48:01 UTC (rev 3555)
@@ -18,8 +18,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <ADM_assert.h>
-#include <ADM_assert.h>
+#include <vector>
+
+#include "ADM_assert.h"
 #include "config.h"
 #include "fourcc.h"
 #include "avio.hxx"
@@ -81,7 +82,7 @@
 {
 char *name;
 	printf("\nVideo filters\n");
-	for(uint32_t i=0;i<nb_video_filter();i++)
+	for(uint32_t i=0;i<allfilters.size();i++)
 	{
 		name=allfilters[ i].filtername;
 		if(allfilters[ i].viewable)
@@ -96,7 +97,7 @@
 {
 char *name;
 	VF_FILTERS filter=VF_DUMMY;
-	for(uint32_t i=0;i<nb_video_filter();i++)
+	for(uint32_t i=0;i<allfilters.size();i++)
 	{
 		name=allfilters[ i].filtername;
 		if(allfilters[ i].viewable)
@@ -122,7 +123,7 @@
 
         if(viewable==1)
 	{
-        	aprintf("\nRegistered filter %lu: %s",nb_video_filter,name);
+        	aprintf("\nRegistered filter %lu: %s",allfilters.size(),name);
 	}
 }
 void registerFilterEx(const char *name,VF_FILTERS tag,uint8_t viewable
@@ -135,7 +136,7 @@
 
         if(viewable==1)
 	{
-        	aprintf("\nRegistered filter %lu: %s",nb_video_filter,name);
+        	aprintf("\nRegistered filter %lu: %s",allfilters.size(),name);
 	}
 
 
@@ -260,7 +261,7 @@
                         if(tag>=VF_EXTERNAL_START)
                         {
                           // start from the end, it is an external filter 
-                          for(uint32_t i=nb_video_filter()-1;i>=0;i--)
+                          for(uint32_t i=allfilters.size()-1;i>=0;i--)
                           {
                               if(tag==allfilters[i].tag)
                                 {
@@ -271,7 +272,7 @@
                         } // else search forward
                         else
                         {
-                          for(unsigned int i=0;i<nb_video_filter();i++)
+                          for(unsigned int i=0;i<allfilters.size();i++)
                                   {
                                           if(tag==allfilters[i].tag)
                                                   {
@@ -291,7 +292,7 @@
 {
 
                         ADM_assert(tag!=VF_INVALID);
-                        for(unsigned int i=0;i<nb_video_filter();i++)
+                        for(unsigned int i=0;i<allfilters.size();i++)
                                 {
                                         if(tag==allfilters[i].tag)
                                                 {
@@ -376,7 +377,7 @@
 
 	video_body->getVideoInfo(&info);
 
-	for(unsigned int i=0;i<nb_video_filter();i++)
+	for(unsigned int i=0;i<allfilters.size();i++)
 	{
 		if(tag==allfilters[i].tag)
 		{
@@ -412,7 +413,7 @@
                 {
                         VF_FILTERS tag=videofilters[i].tag;
                         qfprintf(f,"app.video.addFilter(");
-                        for(unsigned int j=0;j<nb_video_filter();j++)
+                        for(unsigned int j=0;j<allfilters.size();j++)
                                 {
                                         if(tag==allfilters[j].tag)
                                         {       

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-23 08:24:54 UTC (rev 3554)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-23 17:48:01 UTC (rev 3555)
@@ -161,13 +161,6 @@
             const char  *param[25];
    }FILTER_PARAM;
    
-#include <vector>
-extern std::vector <FILTER_ENTRY> allfilters;
-inline size_t nb_video_filter ()
-{
-    return allfilters.size();
-}
-
 AVDMGenericVideoStream *getLastVideoFilter( uint32_t frameStart, uint32_t nbFrame);
 AVDMGenericVideoStream *getLastVideoFilter( void );
 AVDMGenericVideoStream *getFirstVideoFilter( uint32_t frameStart, uint32_t nbFrame);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-23 08:24:54 UTC (rev 3554)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-23 17:48:01 UTC (rev 3555)
@@ -7,9 +7,11 @@
  *                                                                         *
  ***************************************************************************/
 #include "config.h"
-//#include "prototype.h"
+
+#include <vector>
 #include <gtk/gtk.h>
 #include <gdk/gdkkeysyms.h>
+
 #include "avi_vars.h"
 #include "ADM_toolkit/toolkit.hxx"
 #include <ADM_assert.h>
@@ -53,6 +55,8 @@
 //___________________________________________
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
+extern std::vector <FILTER_ENTRY> allfilters;
+
 extern ADM_Composer *video_body;
 //___________________________________________
 static gulong row_inserted_id;
@@ -433,7 +437,7 @@
     char *str=NULL;
     GtkTreeIter iter;
     int current_tree=0;
-    for (uint32_t i = 0; i < nb_video_filter(); i++)
+    for (uint32_t i = 0; i < allfilters.size(); i++)
     {
         if (allfilters[i].viewable==1)
         {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-08-23 08:24:54 UTC (rev 3554)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-08-23 17:48:01 UTC (rev 3555)
@@ -28,8 +28,8 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
+#include <vector>
 
-
 #define Ui_Dialog Ui_mainFilterDialog
 #include "ui_mainfilter.h"
 #undef Ui_Dialog
@@ -64,6 +64,8 @@
 /******************************************************/
 extern FILTER videofilters[MAX_FILTER];
 extern uint32_t nb_active_filter;
+extern std::vector <FILTER_ENTRY> allfilters;
+
 extern const char  *filterGetNameFromTag(VF_FILTERS tag);
 extern ADM_Composer *video_body;
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *conf, AVDMGenericVideoStream *in) ;
@@ -439,7 +441,7 @@
   
   max=0;
   
-  for (uint32_t i = 0; i < nb_video_filter(); i++)
+  for (uint32_t i = 0; i < allfilters.size(); i++)
     {
       if (allfilters[i].viewable==1)
         {



From gruntster at mail.berlios.de  Thu Aug 23 23:42:09 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 23 Aug 2007 23:42:09 +0200
Subject: [Avidemux-svn-commit] r3556 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex
Message-ID: <200708232142.l7NLg9G0005741@sheep.berlios.de>

Author: gruntster
Date: 2007-08-23 23:42:02 +0200 (Thu, 23 Aug 2007)
New Revision: 3556

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
Log:
[mplex] reduce verbosity

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-23 17:48:01 UTC (rev 3555)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp	2007-08-23 21:42:02 UTC (rev 3556)
@@ -106,6 +106,8 @@
         _restamp=0;
 	cond_slaveThread_problem = new admCond(&mutex_slaveThread_problem);
 	kind_of_slaveThread_problem = 0;
+
+	mjpeg_default_handler_verbosity(1);
 }
 //___________________________________________________________________________
 mplexMuxer::~mplexMuxer()



From gruntster at mail.berlios.de  Sat Aug 25 22:50:39 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 25 Aug 2007 22:50:39 +0200
Subject: [Avidemux-svn-commit] r3557 -
	branches/avidemux_2.4_branch/avidemux/ADM_osSupport
Message-ID: <200708252050.l7PKodwS000356@sheep.berlios.de>

Author: gruntster
Date: 2007-08-25 22:50:32 +0200 (Sat, 25 Aug 2007)
New Revision: 3557

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
Log:
[Win32] make back-tracing function public for debugging purposes

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-08-23 21:42:02 UTC (rev 3556)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_crashdump.cpp	2007-08-25 20:50:32 UTC (rev 3557)
@@ -176,8 +176,13 @@
 	fflush(stdout);
 }
 
-static void dumpBackTrace(void* processId)
+extern "C"
 {
+void dumpBackTrace(void* processId)
+{
+	if (!processId)
+		processId = GetCurrentProcess();
+
 	const int maxAddrCount = 32;
 
 	printf("\n*********** BACKTRACE **************\n");
@@ -194,6 +199,7 @@
 
 	printf("*********** BACKTRACE **************\n\n");
 }
+}
 
 void ADM_backTrack(int lineno, const char *file)
 {	
@@ -410,6 +416,7 @@
   strcat(where,name);
   printf("Saving crash file to %s\n",where);
   video_body->saveAsScript (where, NULL);
+  delete[] where;
 }
 /**
     \fn checkCrashFile



From gruntster at mail.berlios.de  Sat Aug 25 23:09:47 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 25 Aug 2007 23:09:47 +0200
Subject: [Avidemux-svn-commit] r3558 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_codecs
	ADM_colorspace ADM_libraries/ADM_lavcodec
Message-ID: <200708252109.l7PL9lxV001280@sheep.berlios.de>

Author: gruntster
Date: 2007-08-25 23:09:36 +0200 (Sat, 25 Aug 2007)
New Revision: 3558

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/wma.c
   branches/avidemux_2.4_branch/avidemux/main.cpp
Log:
[lav] fix mem leaks

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-25 20:50:32 UTC (rev 3557)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-25 21:09:36 UTC (rev 3558)
@@ -713,4 +713,9 @@
     vsnprintf(buf, sizeof(buf), fmt, list);
     printf("[lavc] %s\n",buf);
 }
+
+void ADM_lavDestroy(void)
+{
+	av_free_static();
+}
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-25 20:50:32 UTC (rev 3557)
+++ branches/avidemux_2.4_branch/avidemux/ADM_colorspace/ADM_rgb.cpp	2007-08-25 21:09:36 UTC (rev 3558)
@@ -101,7 +101,11 @@
     FLAGS();
     PixelFormat fmt=TARGET_COLORSPACE;
     if(_inverted) fmt=ALTERNATE_COLORSPACE;
-    if(!ww || !hh) return 0;   
+    if(!ww || !hh) return 0;
+
+	if (_context)
+		sws_freeContext((SwsContext *)_context);
+
 	 _context=(void *)sws_getContext(
                       ww,hh,
                       PIX_FMT_YUV420P ,
@@ -281,6 +285,10 @@
 	CLEANUP();
     FLAGS();
    if(!ww || !hh) return 0;
+
+	if (_context)
+		sws_freeContext((SwsContext *)_context);
+
 	 _context=(void *)sws_getContext(
 				    		ww,hh,
 						PIX_FMT_YUV420P ,
@@ -340,6 +348,10 @@
                 case ADM_COLOR_RGB16:c=PIX_FMT_RGB565;break;
                 default: ADM_assert(0);
     }
+
+	if (_context)
+		sws_freeContext((SwsContext *)_context);
+
          _context=(void *)sws_getContext(
 				    		ww,hh,
 						c ,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/wma.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/wma.c	2007-08-25 20:50:32 UTC (rev 3557)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/wma.c	2007-08-25 21:09:36 UTC (rev 3558)
@@ -385,6 +385,7 @@
         free_vlc(&s->coef_vlc[i]);
         av_free(s->run_table[i]);
         av_free(s->level_table[i]);
+		av_free(s->int_table[i]);
     }
 
     return 0;

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-25 20:50:32 UTC (rev 3557)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-25 21:09:36 UTC (rev 3558)
@@ -49,9 +49,9 @@
 #endif
 
 extern uint8_t filterDynLoad(const char *path);
-typedef void *FCT_VOID(void *);
-uint8_t lavformat_init(void);
-extern void     ADM_lavInit();
+
+extern void  ADM_lavInit();
+extern void  ADM_lavDestroy();
 extern "C" {
      extern uint8_t     ADM_InitMemcpy(void);
 };
@@ -298,6 +298,7 @@
     destroyPrefs();
     filterCleanUp();
 	destroyLibWrappers();
+	ADM_lavDestroy();
 
 #ifdef USE_SDL
 	quitSdl();



From gruntster at mail.berlios.de  Sat Aug 25 23:50:58 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 25 Aug 2007 23:50:58 +0200
Subject: [Avidemux-svn-commit] r3559 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_editor
	ADM_encoder ADM_inputs/ADM_asf ADM_libraries/ADM_utilities
	ADM_outputs/oplug_avi
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory ADM_video
Message-ID: <200708252150.l7PLowWF004851@sheep.berlios.de>

Author: gruntster
Date: 2007-08-25 23:50:43 +0200 (Sat, 25 Aug 2007)
New Revision: 3559

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edCache.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[Cosmetic] correct syntax to make finding leaks easier

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edCache.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edCache.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edCache.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -45,7 +45,7 @@
 	{
 		delete _elem[i].image;
 	}
-	delete _elem;
+	delete[] _elem;
 
 }
 ADMImage 	*EditorCache::getImage(uint32_t no)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edit.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -234,7 +234,7 @@
 
 	if(_segments)
 	{
-		delete _segments;
+		delete[] _segments;
 		_segments=NULL;
 	}
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -235,7 +235,7 @@
       _codec;
   _codec = NULL;
   if (_logfile)
-    delete[]_logfile;
+    delete _logfile;
 
 
   return 1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -80,7 +80,7 @@
   }
   if(myName)
   {
-    delete [] myName;
+    delete myName;
     myName=NULL; 
   }
   if(_extraData)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -378,7 +378,7 @@
    {
      asfBit *bit;
      ADM_assert(queue->pop((void**)&bit));
-     delete bit->data;
+     delete[] bit->data;
      delete bit;
    }
    return 1; 
@@ -393,7 +393,7 @@
      ADM_assert(queue->pop((void**)&bit));
      memcpy(buffer,bit->data,bit->len);
      *len+=bit->len;
-     delete bit->data;
+     delete[] bit->data;
      delete bit;
    }
    return 1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -935,7 +935,7 @@
 	PRT_LAFI("=> LASTFILES_",3,opt_defs[LASTFILES_FILE3].current_val);
 	PRT_LAFI("=> LASTFILES_",4,opt_defs[LASTFILES_FILE4].current_val);
 #endif
-	ADM_dealloc(internal_file);
+	delete[] internal_file;
 	return RC_OK;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_avisave.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -140,8 +140,8 @@
 GenericAviSave::~GenericAviSave ()
 {
   cleanupAudio();
-  delete vbuffer;
-  delete[]abuffer;
+  delete[] vbuffer;
+  delete[] abuffer;
   _incoming=NULL;
   ADM_assert(!_file);
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -860,7 +860,7 @@
 
   alist->End ();
   delete alist;
-  delete buf;
+  delete[] buf;
   return 1;
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -113,7 +113,7 @@
 {
   GtkWidget **widget=(GtkWidget **)myWidget;
   char **name=(char **)param;
-  if(*name) delete [] *name;
+  if(*name) delete *name;
   *name=NULL;
   *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
 }
@@ -238,7 +238,7 @@
 GtkWidget **wid=(GtkWidget **)myWidget;
   GtkWidget *widget=wid[0];
   char **name=(char **)param;
-  if(*name) delete [] *name;
+  if(*name) delete *name;
   *name=NULL;
   *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget)));
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -50,8 +50,8 @@
 {
 	for(uint32_t i=0;i<nb;i++)
 		{
-			if(name[i]) delete [] name[i];
-			if(value[i]) delete [] value[i];
+			if(name[i]) delete name[i];
+			if(value[i]) delete value[i];
 		}
 		delete [] name;
 		delete [] value;

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-25 21:09:36 UTC (rev 3558)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-25 21:50:43 UTC (rev 3559)
@@ -924,7 +924,7 @@
 
   if (res!=ADM_OK)			// an error occured
     {
-	ADM_dealloc(longname);
+		delete[] longname;
     	if(ADM_IGN==res) 
 	{
 		return 0;
@@ -992,7 +992,7 @@
 	UI_setTitle(longname+i);
     }
 	g_free(name_utf8);
-	ADM_dealloc(longname);
+	delete[] longname;
 	return 1;
 }
 



From gruntster at mail.berlios.de  Sun Aug 26 00:08:08 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 26 Aug 2007 00:08:08 +0200
Subject: [Avidemux-svn-commit] r3560 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_GTK/ADM_gui2 ADM_QT4/ADM_dialogFactory ADM_QT4/ADM_gui
Message-ID: <200708252208.l7PM88m4005643@sheep.berlios.de>

Author: gruntster
Date: 2007-08-26 00:07:57 +0200 (Sun, 26 Aug 2007)
New Revision: 3560

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_button.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
Log:
[GUI] fix mem leaks

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-25 21:50:43 UTC (rev 3559)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-25 22:07:57 UTC (rev 3560)
@@ -234,6 +234,9 @@
 void destroyGUI(void)
 {
 	renderDestroy();
+
+	for(int i=0;i<ADM_nbCustom;i++)
+		delete(customNames[i]);
 }
 
 /**

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_button.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_button.cpp	2007-08-25 21:50:43 UTC (rev 3559)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_button.cpp	2007-08-25 22:07:57 UTC (rev 3560)
@@ -83,7 +83,7 @@
 
 diaElemButton::~diaElemButton()
 {
-  
+	delete paramTitle;
 }
 
 void diaElemButton::setMe(void *dialog, void *opaque,uint32_t line)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_menu.cpp	2007-08-25 21:50:43 UTC (rev 3559)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_menu.cpp	2007-08-25 22:07:57 UTC (rev 3560)
@@ -88,6 +88,7 @@
   for(int i=0;i<nbMenu;i++)
       delete menus[i];
   delete [] menus;
+  delete dyna;
   
 }
 void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-25 21:50:43 UTC (rev 3559)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-25 22:07:57 UTC (rev 3560)
@@ -104,8 +104,10 @@
 
 public:
 	MainWindow();
+	virtual ~MainWindow();	
+	void buildCustomMenu(void);
+	
 	Ui_MainWindow ui;
-	void buildCustomMenu(void);
 
 public slots:
 	void timeChanged(int);
@@ -212,6 +214,7 @@
 	}
 
 protected:
+	void clearCustomMenu(void);
 	bool eventFilter(QObject* watched, QEvent* event);
 	void mousePressEvent(QMouseEvent* event);
 
@@ -469,7 +472,7 @@
 		HandleAction(ACT_NextKFrame);
 }
 
-void MainWindow::buildCustomMenu(void)
+void MainWindow::clearCustomMenu(void)
 {
 	if (ADM_nbCustom)
 	{
@@ -477,13 +480,18 @@
 		{
 			disconnect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
 			delete customActions[i];
-			customActions[i] = NULL;
+			delete customNames[i];
 		}
 
 		ui.menuCustom->clear();
 		ADM_nbCustom = 0;
 	}
+}
 
+void MainWindow::buildCustomMenu(void)
+{
+	clearCustomMenu();
+
 	char *customdir = ADM_getCustomDir();
 
 	if (!customdir)
@@ -516,6 +524,11 @@
 	printf("Custom menu built\n");
 }
 
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+}
+
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************



From gruntster at mail.berlios.de  Sun Aug 26 00:48:18 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 26 Aug 2007 00:48:18 +0200
Subject: [Avidemux-svn-commit] r3561 -
	branches/avidemux_2.4_branch/avidemux/ADM_audio
Message-ID: <200708252248.l7PMmIGN004728@sheep.berlios.de>

Author: gruntster
Date: 2007-08-26 00:48:09 +0200 (Sun, 26 Aug 2007)
New Revision: 3561

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audio/audiogen.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audio/audiotimeline.cpp
Log:
[VBR] fix large leak after building VBR time map

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/audiogen.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/audiogen.cpp	2007-08-25 22:07:57 UTC (rev 3560)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/audiogen.cpp	2007-08-25 22:48:09 UTC (rev 3561)
@@ -63,6 +63,12 @@
 	_codec=NULL;
 	}
 
+	if (_audioMap)
+	{
+		delete[] _audioMap;
+		_audioMap = NULL;
+	}
+
 }
 uint8_t AVDMGenericAudioStream::isPaketizable( void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/audiotimeline.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/audiotimeline.cpp	2007-08-25 22:07:57 UTC (rev 3560)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/audiotimeline.cpp	2007-08-25 22:48:09 UTC (rev 3561)
@@ -72,7 +72,9 @@
       ms10=_wavheader->frequency/100;
       
       
-     
+     if (_audioMap)
+		 delete[] _audioMap;
+
      _audioMap=new ST_point[100*3600*4]; // 4 hours / 6 Megs
 
      



From mean at mail.berlios.de  Sun Aug 26 11:13:13 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 26 Aug 2007 11:13:13 +0200
Subject: [Avidemux-svn-commit] r3562 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_audiocodec
	ADM_audiofilter ADM_codecs ADM_editor ADM_encoder
	ADM_libraries/ADM_lavcodec ADM_libraries/ADM_lavformat
	ADM_outputs ADM_script ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_QT4/ADM_gui
Message-ID: <200708260913.l7Q9DDux011582@sheep.berlios.de>

Author: mean
Date: 2007-08-26 11:13:11 +0200 (Sun, 26 Aug 2007)
New Revision: 3562

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/flvenc.c
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodeclist.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.h
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
   branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp
   branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
Log:
[Output] FLV output (incomplete)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodeclist.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodeclist.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiocodec/ADM_audiocodeclist.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -5,27 +5,28 @@
         const char *name;
         const char *menuName;
         AUDIOENCODER codec;
+        uint32_t     wavTag;
 }CODECLIST;
 
  const CODECLIST myCodecList[]=
 {
-                {"copy","Copy", AUDIOENC_COPY},
+                {"copy","Copy", AUDIOENC_COPY,WAV_PCM},
 #ifdef HAVE_LIBMP3LAME
-                {"lame","MP3 (LAME)", AUDIOENC_MP3},
+                {"lame","MP3 (LAME)", AUDIOENC_MP3,WAV_MP3},
 #endif
 #ifdef USE_FAAC
-                {"aac","AAC (FAAC)", AUDIOENC_FAAC},
+                {"aac","AAC (FAAC)", AUDIOENC_FAAC,WAV_AAC},
 #endif
 #ifdef USE_VORBIS
-                {"vorbis","Vorbis", AUDIOENC_VORBIS},
+                {"vorbis","Vorbis", AUDIOENC_VORBIS,WAV_OGG},
 #endif
 #ifdef USE_AFTEN
-                {"aften","AC3 (Aften)", AUDIOENC_AFTEN},
+                {"aften","AC3 (Aften)", AUDIOENC_AFTEN,WAV_AC3},
 #endif
-                {"twolame","MP2 (TwoLAME)", AUDIOENC_2LAME},
-                {"mp2", "MP2 (lavc)", AUDIOENC_MP2},
-                {"ac3", "AC3 (lavc)",AUDIOENC_AC3},
-                {"none", "WAV PCM",AUDIOENC_NONE},
-                {"lpcm", "WAV LPCM",AUDIOENC_LPCM}
+                {"twolame","MP2 (TwoLAME)", AUDIOENC_2LAME,WAV_MP2},
+                {"mp2", "MP2 (lavc)", AUDIOENC_MP2,WAV_MP2},
+                {"ac3", "AC3 (lavc)",AUDIOENC_AC3,WAV_AC3},
+                {"none", "WAV PCM",AUDIOENC_NONE,WAV_PCM},
+                {"lpcm", "WAV LPCM",AUDIOENC_LPCM,WAV_LPCM}
 };
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -432,4 +432,34 @@
 	audioResampleMode=RESAMPLING_CUSTOM;
 	audioFreq=fq;
 }
+/**
+ * 	\fn getAudioOuputTag
+ *  \brief Return the encoding of the currently selected codec
+ *  Must be called only in process mode, else it is meaningless.
+ */
+uint32_t audioFilter_getOuputCodec(void)
+{
+	
+	for(uint32_t i=0;i<sizeof(myCodecList)/sizeof(CODECLIST);i++)
+		{
+			if(activeAudioEncoder==myCodecList[i].codec)
+			{
+				return myCodecList[i].wavTag;
+			}
+		
+		}
+	ADM_assert(0);
+	return WAV_PCM;
+}
+/**
+ * 	\fn getAudioOuputFrequency
+ *  \brief Return the encoding of the currently selected codec
+ */
+uint32_t audioFilter_getOuputFrequency(uint32_t inputFrequency)
+{
+	if(activeAudioEncoder==AUDIOENC_COPY) return inputFrequency;
+	if(audioResampleMode == RESAMPLING_NONE) return inputFrequency;
+	return audioFreq;
+}
+//EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -34,7 +34,8 @@
 
 void audioCodecConfigure( void );
 void audioCodecSelect( void );
-
+uint32_t audioFilter_getOuputCodec(void);
+uint32_t audioFilter_getOuputFrequency(uint32_t inputFrequency);
 typedef enum 
 {
 	AUDIOENC_NONE,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -502,5 +502,3 @@
 }
 
 
-
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -21,8 +21,8 @@
  ***************************************************************************/
 #include "config.h"
 
-#ifdef USE_FFMPEG
 
+
 #define __STDC_CONSTANT_MACROS // Lavcodec crap
 
 #include <stdio.h>
@@ -328,6 +328,9 @@
     case FF_H263P:
       WRAP_Open (CODEC_ID_H263P);
       break;
+    case FF_FLV1:
+      WRAP_Open (CODEC_ID_FLV1);
+      break;
     case FF_HUFF:
       WRAP_Open (CODEC_ID_HUFFYUV);
       break;
@@ -894,4 +897,4 @@
   _frame.quality = (int) floor (FF_QP2LAMBDA * _qual + 0.5);
   return ffmpegEncoder::encode(in,out);
 }
-#endif
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -35,6 +35,7 @@
   FF_SNOW = 10,
   FF_FFHUFF = 11,
   FF_DV=12,
+  FF_FLV1=13,
 } FF_CODEC_ID;
 
 /*

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -23,6 +23,7 @@
 	ADM_MP4,
 	ADM_OGM,
 	ADM_PSP,
+	ADM_FLV,
 	ADM_FORMAT_MAX,
 	ADM_FMT_DUMMY=ADM_FORMAT_MAX
 }ADM_OUT_FORMAT;
@@ -45,6 +46,7 @@
   {ADM_MP4,_("MP4")},
   {ADM_OGM,_("OGM")},
   {ADM_PSP,_("PSP")},
+  {ADM_FLV,_("FLV")}
 };
 
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -130,7 +130,22 @@
   sizeof (ffmpeg4Extra),
   NULL
 };
-
+COMPRES_PARAMS ffmpegFLV1 = {
+  CodecFLV1,
+  "FLV1 (lavc)",
+  "FLV1",
+  "FLV1",
+  COMPRESS_CQ,
+  4,
+  1500,
+  700,
+  1000, // AVG
+  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ ,
+  ADM_EXTRA_PARAM,
+  &ffmpeg4Extra,
+  sizeof (ffmpeg4Extra),
+  NULL
+};
 COMPRES_PARAMS ffmpegSnow = {
   CodecSnow,
   "Snow (lavc)",
@@ -749,7 +764,8 @@
   &ffmpegFFV1,
   &yv12codec,
   &ffmpegH263Codec,
-  &MjpegCodec,  
+  &MjpegCodec,
+  &ffmpegFLV1,
   &DUMMYONE
 };
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx	2007-08-26 09:13:11 UTC (rev 3562)
@@ -44,6 +44,7 @@
   CodecYV12,
   CodecRequant,
   CodecDV,
+  CodecFLV1,
   CodecDummy
 }SelectCodecType;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encConfig.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -697,6 +697,9 @@
     case CodecHuff:
       e = new EncoderFFMPEGHuff (&ffmpegHUFF);
       break;
+    case CodecFLV1:
+       e = new EncoderFFMPEGFLV1 (&ffmpegFLV1);
+       break;
     case CodecFFV1:
       e = new EncoderFFMPEGFFV1 (&ffmpegFFV1);
       break;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -26,7 +26,7 @@
 
 
 
-#ifdef USE_FFMPEG
+
 #include "ADM_lavcodec.h"
 
 
@@ -269,7 +269,50 @@
 
 
 }
+//********************* FLV1 **********************************************
+EncoderFFMPEGFLV1::EncoderFFMPEGFLV1 (COMPRES_PARAMS * config):
+EncoderFFMPEG (FF_FLV1, config)
+{
+  _id = FF_FLV1;
+  _frametogo = 0;
 
+
+}
+uint8_t
+EncoderFFMPEGFLV1::hasExtraHeaderData (uint32_t * l, uint8_t ** data)
+{
+  *l = 0;
+  *data = NULL;
+  return 0;
+
+}
+uint8_t
+EncoderFFMPEGFLV1::configure (AVDMGenericVideoStream * instream)
+{
+  ADM_assert (instream);
+  ADV_Info *info;
+
+
+
+  info = instream->getInfo ();
+  _fps = info->fps1000;
+  _w = info->width;
+  _h = info->height;
+  
+  _vbuffer = new ADMImage (_w, _h);
+  ADM_assert (_vbuffer);
+  _in = instream;
+
+ 
+  _codec = new ffmpegEncoderCQ (_w, _h, _id);
+  _codec->init (_param.qz, _fps, 0);
+  _state=enc_CQ;
+  return 1;
+
+
+
+}
+
 //************************* SNOW **************************
 // return codec name as seen in avi header
 //
@@ -300,6 +343,9 @@
     case FF_SNOW:
       return "SNOW";
       break;
+    case FF_FLV1:
+      return "FLV1";
+      break;
 
     default:
       ADM_assert (0);
@@ -532,4 +578,4 @@
 }
 //-----------------------ffmpegEncoderHuff
 
-#endif
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -298,5 +298,46 @@
   virtual uint8_t hasExtraHeaderData (uint32_t * l, uint8_t ** data);
 
 };
+class EncoderFFMPEGFLV1:public EncoderFFMPEG
+{
 
+protected:
+
+
+public:
+	EncoderFFMPEGFLV1 (COMPRES_PARAMS * config);
+  ~EncoderFFMPEGFLV1 ()
+  {
+    stop ();
+  };				// can be called twice if needed ..
+  virtual uint8_t isDualPass (void)
+  {
+    return 0;
+  };
+  virtual uint8_t configure (AVDMGenericVideoStream * instream);
+  virtual uint8_t setLogFile (const char *p, uint32_t fr)
+  {
+    UNUSED_ARG (p);
+    UNUSED_ARG (fr);
+    return 1;
+  };
+  virtual uint8_t startPass2 (void)
+  {
+    return 1;
+  };
+  virtual uint8_t startPass1 (void)
+  {
+    return 1;
+  };
+  virtual const char *getDisplayName (void)
+  {
+    return "FFMPEG FLV1";
+  }
+  virtual const char *getFCCHandler (void)
+  {
+    return "FLV1";
+  }
+  virtual uint8_t hasExtraHeaderData (uint32_t * l, uint8_t ** data);
+
+};
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.c	2007-08-26 09:13:11 UTC (rev 3562)
@@ -213,6 +213,7 @@
     DECLARE_ENCODER(H263P, h263p);
     DECLARE_ENCODER(AC3, ac3);
     DECLARE_ENCODER (FFV1, ffv1);
+    DECLARE_ENCODER (FLV1, flv1);
     DECLARE_ENCODER (FFVHUFF, ffvhuff);
     DECLARE_ENCODER (H263, h263);
     DECLARE_ENCODER (MPEG1VIDEO, mpeg1video);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/ffconf.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -1,305 +1,306 @@
-#define ENABLE_CINEPAK_DECODER 1
-#define ENABLE_DNXHD_DECODER 1
-#define ENABLE_FOURXM_DECODER 1
-#define ENABLE_FRAPS_DECODER 1
-#define ENABLE_H263I_DECODER 1
-#define ENABLE_H264_DECODER 1
-#define ENABLE_INDEO2_DECODER 1
-#define ENABLE_INDEO3_DECODER 1
-#define ENABLE_INTERPLAY_VIDEO_DECODER 1
-#define ENABLE_MPEGVIDEO_DECODER 1
-#define ENABLE_MSVIDEO1_DECODER 1
-#define ENABLE_VC1_DECODER 1
-#define ENABLE_VCR1_DECODER 1
-#define ENABLE_VP5_DECODER 1
-#define ENABLE_VP6_DECODER 1
-#define ENABLE_VP6F_DECODER 1
-#define ENABLE_WMV3_DECODER 1
-#define ENABLE_WMV1_DECODER 1
-#define ENABLE_WMV2_DECODER 1
-#define ENABLE_VP3_DECODER 1
-#define ENABLE_MPEG4_DECODER 1
-#define ENABLE_MSMPEG4V1_DECODER 1
-#define ENABLE_MSMPEG4V2_DECODER 1
-#define ENABLE_MSMPEG4V3_DECODER 1
-#define ENABLE_MJPEGB_DECODER 1
-#define ENABLE_MJPEG_DECODER 1
-#define ENABLE_WMAV2_DECODER 1
-#define ENABLE_DVVIDEO_DECODER 1
-#define ENABLE_HUFFYUV_DECODER 1
-#define ENABLE_FFVHUFF_DECODER 1
-#define ENABLE_SVQ3_DECODER 1
-#define ENABLE_TSCC_DECODER 1
-#define ENABLE_QDM2_DECODER 1
-#define ENABLE_FFV1_DECODER 1
-#define ENABLE_MPEG1VIDEO_DECODER 1
-#define ENABLE_MPEG2VIDEO_DECODER 1
-#define ENABLE_RV10_DECODER 1
-#define ENABLE_RV20_DECODER 1
-#define ENABLE_DVBSUB_DECODER 1
-#define ENABLE_FLV_DECODER 1
-#define ENABLE_SNOW_DECODER 1
-#define ENABLE_AASC_DECODER 0
-#define ENABLE_AVS_DECODER 0
-#define ENABLE_BETHSOFTVID_DECODER 0
-#define ENABLE_C93_DECODER 0
-#define ENABLE_CAVS_DECODER 0
-#define ENABLE_CLJR_DECODER 0
-#define ENABLE_CSCD_DECODER 0
-#define ENABLE_CYUV_DECODER 0
-#define ENABLE_DSICINVIDEO_DECODER 0
-#define ENABLE_DXA_DECODER 0
-#define ENABLE_EIGHTBPS_DECODER 0
-#define ENABLE_FLIC_DECODER 0
-#define ENABLE_IDCIN_DECODER 0
-#define ENABLE_KMVC_DECODER 0
-#define ENABLE_LOCO_DECODER 0
-#define ENABLE_MDEC_DECODER 0
-#define ENABLE_MMVIDEO_DECODER 0
-#define ENABLE_MPEG_XVMC_DECODER 0
-#define ENABLE_MSRLE_DECODER 0
-#define ENABLE_MSZH_DECODER 0
-#define ENABLE_NUV_DECODER 0
-#define ENABLE_PTX_DECODER 0
-#define ENABLE_QDRAW_DECODER 0
-#define ENABLE_QPEG_DECODER 0
-#define ENABLE_RPZA_DECODER 0
-#define ENABLE_SMACKER_DECODER 0
-#define ENABLE_SMC_DECODER 0
-#define ENABLE_SP5X_DECODER 0
-#define ENABLE_THEORA_DECODER 0
-#define ENABLE_THP_DECODER 0
-#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
-#define ENABLE_TRUEMOTION1_DECODER 0
-#define ENABLE_TRUEMOTION2_DECODER 0
-#define ENABLE_TXD_DECODER 0
-#define ENABLE_ULTI_DECODER 0
-#define ENABLE_VMDVIDEO_DECODER 0
-#define ENABLE_VMNC_DECODER 0
-#define ENABLE_VQA_DECODER 0
-#define ENABLE_WNV1_DECODER 0
-#define ENABLE_XAN_WC3_DECODER 0
-#define ENABLE_XL_DECODER 0
-#define ENABLE_MPEG4AAC_DECODER 0
-#define ENABLE_ALAC_DECODER 0
-#define ENABLE_ATRAC3_DECODER 0
-#define ENABLE_COOK_DECODER 0
-#define ENABLE_DCA_DECODER 0
-#define ENABLE_DSICINAUDIO_DECODER 0
-#define ENABLE_IMC_DECODER 0
-#define ENABLE_LIBA52_DECODER 0
-#define ENABLE_LIBFAAD_DECODER 0
-#define ENABLE_MACE3_DECODER 0
-#define ENABLE_MACE6_DECODER 0
-#define ENABLE_MP3_DECODER 0
-#define ENABLE_MP3ADU_DECODER 0
-#define ENABLE_MP3ON4_DECODER 0
-#define ENABLE_MPC7_DECODER 0
-#define ENABLE_RA_144_DECODER 0
-#define ENABLE_RA_288_DECODER 0
-#define ENABLE_SHORTEN_DECODER 0
-#define ENABLE_SMACKAUD_DECODER 0
-#define ENABLE_TRUESPEECH_DECODER 0
-#define ENABLE_TTA_DECODER 0
-#define ENABLE_VMDAUDIO_DECODER 0
-#define ENABLE_WAVPACK_DECODER 0
-#define ENABLE_WS_SND1_DECODER 0
-#define ENABLE_INTERPLAY_DPCM_DECODER 0
-#define ENABLE_SOL_DPCM_DECODER 0
-#define ENABLE_XAN_DPCM_DECODER 0
-#define ENABLE_ADPCM_THP_DECODER 0
-#define ENABLE_ASV1_DECODER 0
-#define ENABLE_ASV2_DECODER 0
-#define ENABLE_BMP_DECODER 0
-#define ENABLE_FLASHSV_DECODER 0
-#define ENABLE_GIF_DECODER 0
-#define ENABLE_H261_DECODER 0
-#define ENABLE_H263_DECODER 0
-#define ENABLE_JPEGLS_DECODER 0
-#define ENABLE_PNG_DECODER 0
-#define ENABLE_QTRLE_DECODER 0
-#define ENABLE_RAWVIDEO_DECODER 0
-#define ENABLE_ROQ_DECODER 0
-#define ENABLE_SGI_DECODER 0
-#define ENABLE_SVQ1_DECODER 0
-#define ENABLE_TARGA_DECODER 0
-#define ENABLE_TIFF_DECODER 0
-#define ENABLE_ZLIB_DECODER 0
-#define ENABLE_ZMBV_DECODER 0
-#define ENABLE_FLAC_DECODER 0
-#define ENABLE_LIBAMR_NB_DECODER 0
-#define ENABLE_LIBAMR_WB_DECODER 0
-#define ENABLE_LIBGSM_DECODER 0
-#define ENABLE_LIBGSM_MS_DECODER 0
-#define ENABLE_MP2_DECODER 0
-#define ENABLE_SONIC_DECODER 0
-#define ENABLE_VORBIS_DECODER 0
-#define ENABLE_WMAV1_DECODER 0
-#define ENABLE_PCM_ALAW_DECODER 0
-#define ENABLE_PCM_MULAW_DECODER 0
-#define ENABLE_PCM_S8_DECODER 0
-#define ENABLE_PCM_S16BE_DECODER 0
-#define ENABLE_PCM_S16LE_DECODER 0
-#define ENABLE_PCM_S24BE_DECODER 0
-#define ENABLE_PCM_S24DAUD_DECODER 0
-#define ENABLE_PCM_S24LE_DECODER 0
-#define ENABLE_PCM_S32BE_DECODER 0
-#define ENABLE_PCM_S32LE_DECODER 0
-#define ENABLE_PCM_U8_DECODER 0
-#define ENABLE_PCM_U16BE_DECODER 0
-#define ENABLE_PCM_U16LE_DECODER 0
-#define ENABLE_PCM_U24BE_DECODER 0
-#define ENABLE_PCM_U24LE_DECODER 0
-#define ENABLE_PCM_U32BE_DECODER 0
-#define ENABLE_PCM_U32LE_DECODER 0
-#define ENABLE_ROQ_DPCM_DECODER 0
-#define ENABLE_ADPCM_4XM_DECODER 0
-#define ENABLE_ADPCM_ADX_DECODER 0
-#define ENABLE_ADPCM_CT_DECODER 0
-#define ENABLE_ADPCM_EA_DECODER 0
-#define ENABLE_ADPCM_G726_DECODER 0
-#define ENABLE_ADPCM_IMA_DK3_DECODER 0
-#define ENABLE_ADPCM_IMA_DK4_DECODER 0
-#define ENABLE_ADPCM_IMA_QT_DECODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
-#define ENABLE_ADPCM_IMA_WAV_DECODER 0
-#define ENABLE_ADPCM_IMA_WS_DECODER 0
-#define ENABLE_ADPCM_MS_DECODER 0
-#define ENABLE_ADPCM_SBPRO_2_DECODER 0
-#define ENABLE_ADPCM_SBPRO_3_DECODER 0
-#define ENABLE_ADPCM_SBPRO_4_DECODER 0
-#define ENABLE_ADPCM_SWF_DECODER 0
-#define ENABLE_ADPCM_XA_DECODER 0
-#define ENABLE_ADPCM_YAMAHA_DECODER 0
-#define ENABLE_DVDSUB_DECODER 0
-#define ENABLE_H263_PARSER 1
-#define ENABLE_H264_PARSER 1
-#define ENABLE_MPEG4VIDEO_PARSER 1
-#define ENABLE_AAC_PARSER 0
-#define ENABLE_AC3_PARSER 0
-#define ENABLE_CAVSVIDEO_PARSER 0
-#define ENABLE_DCA_PARSER 0
-#define ENABLE_DVBSUB_PARSER 0
-#define ENABLE_DVDSUB_PARSER 0
-#define ENABLE_H261_PARSER 0
-#define ENABLE_MJPEG_PARSER 0
-#define ENABLE_MPEGAUDIO_PARSER 0
-#define ENABLE_MPEGVIDEO_PARSER 0
-#define ENABLE_PNM_PARSER 0
-#define ENABLE_VC1_PARSER 0
-#define ENABLE_MJPEG_ENCODER 1
-#define ENABLE_MSMPEG4V3_ENCODER 1
-#define ENABLE_H263P_ENCODER 1
-#define ENABLE_AC3_ENCODER 1
-#define ENABLE_FFV1_ENCODER 1
-#define ENABLE_FFVHUFF_ENCODER 1
-#define ENABLE_H263_ENCODER 1
-#define ENABLE_MPEG1VIDEO_ENCODER 1
-#define ENABLE_MPEG2VIDEO_ENCODER 1
-#define ENABLE_MPEG4_ENCODER 1
-#define ENABLE_FLV_ENCODER 1
-#define ENABLE_SNOW_ENCODER 1
-#define ENABLE_MP2_ENCODER 1
-#define ENABLE_DVVIDEO_ENCODER 1
-#define ENABLE_HUFFYUV_ENCODER 1
-#define ENABLE_DVBSUB_ENCODER 1
-#define ENABLE_LIBX264_ENCODER 0
-#define ENABLE_LIBXVID_ENCODER 0
-#define ENABLE_LJPEG_ENCODER 0
-#define ENABLE_PAM_ENCODER 0
-#define ENABLE_PBM_ENCODER 0
-#define ENABLE_PGM_ENCODER 0
-#define ENABLE_PGMYUV_ENCODER 0
-#define ENABLE_PPM_ENCODER 0
-#define ENABLE_LIBFAAC_ENCODER 0
-#define ENABLE_LIBMP3LAME_ENCODER 0
-#define ENABLE_LIBTHEORA_ENCODER 0
-#define ENABLE_SONIC_LS_ENCODER 0
-#define ENABLE_ASV1_ENCODER 0
-#define ENABLE_ASV2_ENCODER 0
-#define ENABLE_BMP_ENCODER 0
-#define ENABLE_FLASHSV_ENCODER 0
-#define ENABLE_GIF_ENCODER 0
-#define ENABLE_H261_ENCODER 0
-#define ENABLE_JPEGLS_ENCODER 0
-#define ENABLE_MSMPEG4V1_ENCODER 0
-#define ENABLE_MSMPEG4V2_ENCODER 0
-#define ENABLE_PNG_ENCODER 0
-#define ENABLE_QTRLE_ENCODER 0
-#define ENABLE_RAWVIDEO_ENCODER 0
-#define ENABLE_ROQ_ENCODER 0
-#define ENABLE_RV10_ENCODER 0
-#define ENABLE_RV20_ENCODER 0
-#define ENABLE_SGI_ENCODER 0
-#define ENABLE_SVQ1_ENCODER 0
-#define ENABLE_TARGA_ENCODER 0
-#define ENABLE_TIFF_ENCODER 0
-#define ENABLE_WMV1_ENCODER 0
-#define ENABLE_WMV2_ENCODER 0
-#define ENABLE_ZLIB_ENCODER 0
-#define ENABLE_ZMBV_ENCODER 0
-#define ENABLE_FLAC_ENCODER 0
-#define ENABLE_LIBAMR_NB_ENCODER 0
-#define ENABLE_LIBAMR_WB_ENCODER 0
-#define ENABLE_LIBGSM_ENCODER 0
-#define ENABLE_LIBGSM_MS_ENCODER 0
-#define ENABLE_SONIC_ENCODER 0
-#define ENABLE_VORBIS_ENCODER 0
-#define ENABLE_WMAV1_ENCODER 0
-#define ENABLE_WMAV2_ENCODER 0
-#define ENABLE_PCM_ALAW_ENCODER 0
-#define ENABLE_PCM_MULAW_ENCODER 0
-#define ENABLE_PCM_S8_ENCODER 0
-#define ENABLE_PCM_S16BE_ENCODER 0
-#define ENABLE_PCM_S16LE_ENCODER 0
-#define ENABLE_PCM_S24BE_ENCODER 0
-#define ENABLE_PCM_S24DAUD_ENCODER 0
-#define ENABLE_PCM_S24LE_ENCODER 0
-#define ENABLE_PCM_S32BE_ENCODER 0
-#define ENABLE_PCM_S32LE_ENCODER 0
-#define ENABLE_PCM_U8_ENCODER 0
-#define ENABLE_PCM_U16BE_ENCODER 0
-#define ENABLE_PCM_U16LE_ENCODER 0
-#define ENABLE_PCM_U24BE_ENCODER 0
-#define ENABLE_PCM_U24LE_ENCODER 0
-#define ENABLE_PCM_U32BE_ENCODER 0
-#define ENABLE_PCM_U32LE_ENCODER 0
-#define ENABLE_ROQ_DPCM_ENCODER 0
-#define ENABLE_ADPCM_4XM_ENCODER 0
-#define ENABLE_ADPCM_ADX_ENCODER 0
-#define ENABLE_ADPCM_CT_ENCODER 0
-#define ENABLE_ADPCM_EA_ENCODER 0
-#define ENABLE_ADPCM_G726_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
-#define ENABLE_ADPCM_IMA_QT_ENCODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
-#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
-#define ENABLE_ADPCM_IMA_WS_ENCODER 0
-#define ENABLE_ADPCM_MS_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
-#define ENABLE_ADPCM_SWF_ENCODER 0
-#define ENABLE_ADPCM_XA_ENCODER 0
-#define ENABLE_ADPCM_YAMAHA_ENCODER 0
-#define ENABLE_DVDSUB_ENCODER 0
-#define ENABLE_LIBVORBIS_ENCODER        0
-#define ENABLE_LIBVORBIS_DECODER        0
-#define ENABLE_MP3_HEADER_COMPRESS_BSF  0
-#define ENABLE_IMX_DUMP_HEADER_BSF      0
-#define ENABLE_DUMP_EXTRADATA_BSF       0
-#define ENABLE_REMOVE_EXTRADATA_BSF     0
-#define ENABLE_NOISE_BSF                0
-#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
-#define ENABLE_MJPEGA_DUMP_HEADER_BSF   0
-#define ENABLE_IMX_DUMP_HEADER_BSF      0
-#define ENABLE_ARMV4L      0
-#define ENABLE_MLIB      0
-#define ENABLE_SPARC      0
-#define ENABLE_ALPHA      0
-#define ENABLE_POWERPC      0
-#define ENABLE_MMI      0
-#define ENABLE_SH4      0
-#define ENABLE_BFIN      0
-#define ENABLE_SMALL      0
+#define ENABLE_CINEPAK_DECODER 1
+#define ENABLE_DNXHD_DECODER 1
+#define ENABLE_FOURXM_DECODER 1
+#define ENABLE_FRAPS_DECODER 1
+#define ENABLE_H263I_DECODER 1
+#define ENABLE_H264_DECODER 1
+#define ENABLE_INDEO2_DECODER 1
+#define ENABLE_INDEO3_DECODER 1
+#define ENABLE_INTERPLAY_VIDEO_DECODER 1
+#define ENABLE_MPEGVIDEO_DECODER 1
+#define ENABLE_MSVIDEO1_DECODER 1
+#define ENABLE_VC1_DECODER 1
+#define ENABLE_VCR1_DECODER 1
+#define ENABLE_VP5_DECODER 1
+#define ENABLE_VP6_DECODER 1
+#define ENABLE_VP6F_DECODER 1
+#define ENABLE_WMV3_DECODER 1
+#define ENABLE_WMV1_DECODER 1
+#define ENABLE_WMV2_DECODER 1
+#define ENABLE_VP3_DECODER 1
+#define ENABLE_MPEG4_DECODER 1
+#define ENABLE_MSMPEG4V1_DECODER 1
+#define ENABLE_MSMPEG4V2_DECODER 1
+#define ENABLE_MSMPEG4V3_DECODER 1
+#define ENABLE_MJPEGB_DECODER 1
+#define ENABLE_MJPEG_DECODER 1
+#define ENABLE_WMAV2_DECODER 1
+#define ENABLE_DVVIDEO_DECODER 1
+#define ENABLE_HUFFYUV_DECODER 1
+#define ENABLE_FFVHUFF_DECODER 1
+#define ENABLE_SVQ3_DECODER 1
+#define ENABLE_TSCC_DECODER 1
+#define ENABLE_QDM2_DECODER 1
+#define ENABLE_FFV1_DECODER 1
+#define ENABLE_MPEG1VIDEO_DECODER 1
+#define ENABLE_MPEG2VIDEO_DECODER 1
+#define ENABLE_RV10_DECODER 1
+#define ENABLE_RV20_DECODER 1
+#define ENABLE_DVBSUB_DECODER 1
+#define ENABLE_FLV_DECODER 1
+#define ENABLE_SNOW_DECODER 1
+#define ENABLE_AASC_DECODER 0
+#define ENABLE_AVS_DECODER 0
+#define ENABLE_BETHSOFTVID_DECODER 0
+#define ENABLE_C93_DECODER 0
+#define ENABLE_CAVS_DECODER 0
+#define ENABLE_CLJR_DECODER 0
+#define ENABLE_CSCD_DECODER 0
+#define ENABLE_CYUV_DECODER 0
+#define ENABLE_DSICINVIDEO_DECODER 0
+#define ENABLE_DXA_DECODER 0
+#define ENABLE_EIGHTBPS_DECODER 0
+#define ENABLE_FLIC_DECODER 0
+#define ENABLE_IDCIN_DECODER 0
+#define ENABLE_KMVC_DECODER 0
+#define ENABLE_LOCO_DECODER 0
+#define ENABLE_MDEC_DECODER 0
+#define ENABLE_MMVIDEO_DECODER 0
+#define ENABLE_MPEG_XVMC_DECODER 0
+#define ENABLE_MSRLE_DECODER 0
+#define ENABLE_MSZH_DECODER 0
+#define ENABLE_NUV_DECODER 0
+#define ENABLE_PTX_DECODER 0
+#define ENABLE_QDRAW_DECODER 0
+#define ENABLE_QPEG_DECODER 0
+#define ENABLE_RPZA_DECODER 0
+#define ENABLE_SMACKER_DECODER 0
+#define ENABLE_SMC_DECODER 0
+#define ENABLE_SP5X_DECODER 0
+#define ENABLE_THEORA_DECODER 0
+#define ENABLE_THP_DECODER 0
+#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
+#define ENABLE_TRUEMOTION1_DECODER 0
+#define ENABLE_TRUEMOTION2_DECODER 0
+#define ENABLE_TXD_DECODER 0
+#define ENABLE_ULTI_DECODER 0
+#define ENABLE_VMDVIDEO_DECODER 0
+#define ENABLE_VMNC_DECODER 0
+#define ENABLE_VQA_DECODER 0
+#define ENABLE_WNV1_DECODER 0
+#define ENABLE_XAN_WC3_DECODER 0
+#define ENABLE_XL_DECODER 0
+#define ENABLE_MPEG4AAC_DECODER 0
+#define ENABLE_ALAC_DECODER 0
+#define ENABLE_ATRAC3_DECODER 0
+#define ENABLE_COOK_DECODER 0
+#define ENABLE_DCA_DECODER 0
+#define ENABLE_DSICINAUDIO_DECODER 0
+#define ENABLE_IMC_DECODER 0
+#define ENABLE_LIBA52_DECODER 0
+#define ENABLE_LIBFAAD_DECODER 0
+#define ENABLE_MACE3_DECODER 0
+#define ENABLE_MACE6_DECODER 0
+#define ENABLE_MP3_DECODER 0
+#define ENABLE_MP3ADU_DECODER 0
+#define ENABLE_MP3ON4_DECODER 0
+#define ENABLE_MPC7_DECODER 0
+#define ENABLE_RA_144_DECODER 0
+#define ENABLE_RA_288_DECODER 0
+#define ENABLE_SHORTEN_DECODER 0
+#define ENABLE_SMACKAUD_DECODER 0
+#define ENABLE_TRUESPEECH_DECODER 0
+#define ENABLE_TTA_DECODER 0
+#define ENABLE_VMDAUDIO_DECODER 0
+#define ENABLE_WAVPACK_DECODER 0
+#define ENABLE_WS_SND1_DECODER 0
+#define ENABLE_INTERPLAY_DPCM_DECODER 0
+#define ENABLE_SOL_DPCM_DECODER 0
+#define ENABLE_XAN_DPCM_DECODER 0
+#define ENABLE_ADPCM_THP_DECODER 0
+#define ENABLE_ASV1_DECODER 0
+#define ENABLE_ASV2_DECODER 0
+#define ENABLE_BMP_DECODER 0
+#define ENABLE_FLASHSV_DECODER 0
+#define ENABLE_GIF_DECODER 0
+#define ENABLE_H261_DECODER 0
+#define ENABLE_H263_DECODER 0
+#define ENABLE_JPEGLS_DECODER 0
+#define ENABLE_PNG_DECODER 0
+#define ENABLE_QTRLE_DECODER 0
+#define ENABLE_RAWVIDEO_DECODER 0
+#define ENABLE_ROQ_DECODER 0
+#define ENABLE_SGI_DECODER 0
+#define ENABLE_SVQ1_DECODER 0
+#define ENABLE_TARGA_DECODER 0
+#define ENABLE_TIFF_DECODER 0
+#define ENABLE_ZLIB_DECODER 0
+#define ENABLE_ZMBV_DECODER 0
+#define ENABLE_FLAC_DECODER 0
+#define ENABLE_LIBAMR_NB_DECODER 0
+#define ENABLE_LIBAMR_WB_DECODER 0
+#define ENABLE_LIBGSM_DECODER 0
+#define ENABLE_LIBGSM_MS_DECODER 0
+#define ENABLE_MP2_DECODER 0
+#define ENABLE_SONIC_DECODER 0
+#define ENABLE_VORBIS_DECODER 0
+#define ENABLE_WMAV1_DECODER 0
+#define ENABLE_PCM_ALAW_DECODER 0
+#define ENABLE_PCM_MULAW_DECODER 0
+#define ENABLE_PCM_S8_DECODER 0
+#define ENABLE_PCM_S16BE_DECODER 0
+#define ENABLE_PCM_S16LE_DECODER 0
+#define ENABLE_PCM_S24BE_DECODER 0
+#define ENABLE_PCM_S24DAUD_DECODER 0
+#define ENABLE_PCM_S24LE_DECODER 0
+#define ENABLE_PCM_S32BE_DECODER 0
+#define ENABLE_PCM_S32LE_DECODER 0
+#define ENABLE_PCM_U8_DECODER 0
+#define ENABLE_PCM_U16BE_DECODER 0
+#define ENABLE_PCM_U16LE_DECODER 0
+#define ENABLE_PCM_U24BE_DECODER 0
+#define ENABLE_PCM_U24LE_DECODER 0
+#define ENABLE_PCM_U32BE_DECODER 0
+#define ENABLE_PCM_U32LE_DECODER 0
+#define ENABLE_ROQ_DPCM_DECODER 0
+#define ENABLE_ADPCM_4XM_DECODER 0
+#define ENABLE_ADPCM_ADX_DECODER 0
+#define ENABLE_ADPCM_CT_DECODER 0
+#define ENABLE_ADPCM_EA_DECODER 0
+#define ENABLE_ADPCM_G726_DECODER 0
+#define ENABLE_ADPCM_IMA_DK3_DECODER 0
+#define ENABLE_ADPCM_IMA_DK4_DECODER 0
+#define ENABLE_ADPCM_IMA_QT_DECODER 0
+#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
+#define ENABLE_ADPCM_IMA_WAV_DECODER 0
+#define ENABLE_ADPCM_IMA_WS_DECODER 0
+#define ENABLE_ADPCM_MS_DECODER 0
+#define ENABLE_ADPCM_SBPRO_2_DECODER 0
+#define ENABLE_ADPCM_SBPRO_3_DECODER 0
+#define ENABLE_ADPCM_SBPRO_4_DECODER 0
+#define ENABLE_ADPCM_SWF_DECODER 0
+#define ENABLE_ADPCM_XA_DECODER 0
+#define ENABLE_ADPCM_YAMAHA_DECODER 0
+#define ENABLE_DVDSUB_DECODER 0
+#define ENABLE_H263_PARSER 1
+#define ENABLE_H264_PARSER 1
+#define ENABLE_MPEG4VIDEO_PARSER 1
+#define ENABLE_AAC_PARSER 0
+#define ENABLE_AC3_PARSER 0
+#define ENABLE_CAVSVIDEO_PARSER 0
+#define ENABLE_DCA_PARSER 0
+#define ENABLE_DVBSUB_PARSER 0
+#define ENABLE_DVDSUB_PARSER 0
+#define ENABLE_H261_PARSER 0
+#define ENABLE_MJPEG_PARSER 0
+#define ENABLE_MPEGAUDIO_PARSER 0
+#define ENABLE_MPEGVIDEO_PARSER 0
+#define ENABLE_PNM_PARSER 0
+#define ENABLE_VC1_PARSER 0
+#define ENABLE_MJPEG_ENCODER 1
+#define ENABLE_MSMPEG4V3_ENCODER 1
+#define ENABLE_H263P_ENCODER 1
+#define ENABLE_AC3_ENCODER 1
+#define ENABLE_FFV1_ENCODER 1
+#define ENABLE_FLV1_ENCODER 1
+#define ENABLE_FFVHUFF_ENCODER 1
+#define ENABLE_H263_ENCODER 1
+#define ENABLE_MPEG1VIDEO_ENCODER 1
+#define ENABLE_MPEG2VIDEO_ENCODER 1
+#define ENABLE_MPEG4_ENCODER 1
+#define ENABLE_FLV_ENCODER 1
+#define ENABLE_SNOW_ENCODER 1
+#define ENABLE_MP2_ENCODER 1
+#define ENABLE_DVVIDEO_ENCODER 1
+#define ENABLE_HUFFYUV_ENCODER 1
+#define ENABLE_DVBSUB_ENCODER 1
+#define ENABLE_LIBX264_ENCODER 0
+#define ENABLE_LIBXVID_ENCODER 0
+#define ENABLE_LJPEG_ENCODER 0
+#define ENABLE_PAM_ENCODER 0
+#define ENABLE_PBM_ENCODER 0
+#define ENABLE_PGM_ENCODER 0
+#define ENABLE_PGMYUV_ENCODER 0
+#define ENABLE_PPM_ENCODER 0
+#define ENABLE_LIBFAAC_ENCODER 0
+#define ENABLE_LIBMP3LAME_ENCODER 0
+#define ENABLE_LIBTHEORA_ENCODER 0
+#define ENABLE_SONIC_LS_ENCODER 0
+#define ENABLE_ASV1_ENCODER 0
+#define ENABLE_ASV2_ENCODER 0
+#define ENABLE_BMP_ENCODER 0
+#define ENABLE_FLASHSV_ENCODER 0
+#define ENABLE_GIF_ENCODER 0
+#define ENABLE_H261_ENCODER 0
+#define ENABLE_JPEGLS_ENCODER 0
+#define ENABLE_MSMPEG4V1_ENCODER 0
+#define ENABLE_MSMPEG4V2_ENCODER 0
+#define ENABLE_PNG_ENCODER 0
+#define ENABLE_QTRLE_ENCODER 0
+#define ENABLE_RAWVIDEO_ENCODER 0
+#define ENABLE_ROQ_ENCODER 0
+#define ENABLE_RV10_ENCODER 0
+#define ENABLE_RV20_ENCODER 0
+#define ENABLE_SGI_ENCODER 0
+#define ENABLE_SVQ1_ENCODER 0
+#define ENABLE_TARGA_ENCODER 0
+#define ENABLE_TIFF_ENCODER 0
+#define ENABLE_WMV1_ENCODER 0
+#define ENABLE_WMV2_ENCODER 0
+#define ENABLE_ZLIB_ENCODER 0
+#define ENABLE_ZMBV_ENCODER 0
+#define ENABLE_FLAC_ENCODER 0
+#define ENABLE_LIBAMR_NB_ENCODER 0
+#define ENABLE_LIBAMR_WB_ENCODER 0
+#define ENABLE_LIBGSM_ENCODER 0
+#define ENABLE_LIBGSM_MS_ENCODER 0
+#define ENABLE_SONIC_ENCODER 0
+#define ENABLE_VORBIS_ENCODER 0
+#define ENABLE_WMAV1_ENCODER 0
+#define ENABLE_WMAV2_ENCODER 0
+#define ENABLE_PCM_ALAW_ENCODER 0
+#define ENABLE_PCM_MULAW_ENCODER 0
+#define ENABLE_PCM_S8_ENCODER 0
+#define ENABLE_PCM_S16BE_ENCODER 0
+#define ENABLE_PCM_S16LE_ENCODER 0
+#define ENABLE_PCM_S24BE_ENCODER 0
+#define ENABLE_PCM_S24DAUD_ENCODER 0
+#define ENABLE_PCM_S24LE_ENCODER 0
+#define ENABLE_PCM_S32BE_ENCODER 0
+#define ENABLE_PCM_S32LE_ENCODER 0
+#define ENABLE_PCM_U8_ENCODER 0
+#define ENABLE_PCM_U16BE_ENCODER 0
+#define ENABLE_PCM_U16LE_ENCODER 0
+#define ENABLE_PCM_U24BE_ENCODER 0
+#define ENABLE_PCM_U24LE_ENCODER 0
+#define ENABLE_PCM_U32BE_ENCODER 0
+#define ENABLE_PCM_U32LE_ENCODER 0
+#define ENABLE_ROQ_DPCM_ENCODER 0
+#define ENABLE_ADPCM_4XM_ENCODER 0
+#define ENABLE_ADPCM_ADX_ENCODER 0
+#define ENABLE_ADPCM_CT_ENCODER 0
+#define ENABLE_ADPCM_EA_ENCODER 0
+#define ENABLE_ADPCM_G726_ENCODER 0
+#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
+#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
+#define ENABLE_ADPCM_IMA_QT_ENCODER 0
+#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
+#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
+#define ENABLE_ADPCM_IMA_WS_ENCODER 0
+#define ENABLE_ADPCM_MS_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
+#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
+#define ENABLE_ADPCM_SWF_ENCODER 0
+#define ENABLE_ADPCM_XA_ENCODER 0
+#define ENABLE_ADPCM_YAMAHA_ENCODER 0
+#define ENABLE_DVDSUB_ENCODER 0
+#define ENABLE_LIBVORBIS_ENCODER        0
+#define ENABLE_LIBVORBIS_DECODER        0
+#define ENABLE_MP3_HEADER_COMPRESS_BSF  0
+#define ENABLE_IMX_DUMP_HEADER_BSF      0
+#define ENABLE_DUMP_EXTRADATA_BSF       0
+#define ENABLE_REMOVE_EXTRADATA_BSF     0
+#define ENABLE_NOISE_BSF                0
+#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
+#define ENABLE_MJPEGA_DUMP_HEADER_BSF   0
+#define ENABLE_IMX_DUMP_HEADER_BSF      0
+#define ENABLE_ARMV4L      0
+#define ENABLE_MLIB      0
+#define ENABLE_SPARC      0
+#define ENABLE_ALPHA      0
+#define ENABLE_POWERPC      0
+#define ENABLE_MMI      0
+#define ENABLE_SH4      0
+#define ENABLE_BFIN      0
+#define ENABLE_SMALL      0

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -109,26 +109,29 @@
 	_fps1000=info->fps1000;
 	switch(_type)
 	{
-                case MUXER_TS:
-                        fmt=guess_format("mpegts", NULL, NULL);
-                        break;
-		case MUXER_DVD:
-			fmt = guess_format("dvd", NULL, NULL);
-			break;
-		case MUXER_VCD:
-			fmt = guess_format("vcd", NULL, NULL);
-			break;
-		case MUXER_SVCD:
-			fmt = guess_format("svcd", NULL, NULL);
-			break;
-                case MUXER_MP4:
-                        fmt = guess_format("mp4", NULL, NULL);
-                        break;
-                case MUXER_PSP:
-                        fmt = guess_format("psp", NULL, NULL);
-                        break;                        
-		default:
-			fmt=NULL;
+	case MUXER_TS:
+		fmt=guess_format("mpegts", NULL, NULL);
+		break;
+	case MUXER_DVD:
+		fmt = guess_format("dvd", NULL, NULL);
+		break;
+	case MUXER_VCD:
+		fmt = guess_format("vcd", NULL, NULL);
+		break;
+	case MUXER_SVCD:
+		fmt = guess_format("svcd", NULL, NULL);
+		break;
+	case MUXER_MP4:
+		fmt = guess_format("mp4", NULL, NULL);
+		break;
+	case MUXER_PSP:
+		fmt = guess_format("psp", NULL, NULL);
+		break;
+	case MUXER_FLV:
+		fmt = guess_format("flv", NULL, NULL);
+		break;          
+	default:
+		fmt=NULL;
 	}
 	if (!fmt) 
 	{
@@ -156,6 +159,26 @@
 	c = video_st->codec;
 	switch(_type)
 	{
+				case MUXER_FLV:
+					 c->codec=new AVCodec;
+					 memset(c->codec,0,sizeof(AVCodec));
+					 if(fourCC::check(info->fcc,(uint8_t *)"FLV1"))
+					 {
+						 c->codec_id=CODEC_ID_FLV1;
+					 	 c->codec->name=ADM_strdup("FLV1");
+					 }else
+					 {
+						 if(fourCC::check(info->fcc,(uint8_t *)"VP6F"))
+						 			{
+							 		 c->codec_id=CODEC_ID_VP6F;
+					 				 c->codec->name=ADM_strdup("VP6F");
+						 			}
+						 else
+							 ADM_assert(0);
+					 
+					 }
+					 
+					 break;
                 case MUXER_MP4:
                 case MUXER_PSP:
                         strcpy(oc->title,"Avidemux");
@@ -286,7 +309,7 @@
 			c->frame_rate_base = 1001;	
 			break;
 */
-                        if(_type==MUXER_MP4 || _type==MUXER_PSP)
+                        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV)
                         {
                                  c->time_base= fps24; //(AVRational){1001,24000};
                                 break;
@@ -298,7 +321,7 @@
 			break;
 		default:
                       {
-                            if(_type==MUXER_MP4 || _type==MUXER_PSP)
+                            if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV)
                             {
                                     c->time_base=fpsfree;// (AVRational){1000,_fps1000};
                                     break;
@@ -381,6 +404,7 @@
 //----------------------
 	switch(_type)
 	{
+				case MUXER_FLV:
                 case MUXER_PSP:
                 case MUXER_MP4:
                         oc->mux_rate=10080*1000; // Needed ?
@@ -449,11 +473,18 @@
 
             timeInUs=(int64_t)sample2time_us(sample);
             /* Rescale to ?? */
-            f=timeInUs;
-            f/=1000000.; // In ms seconds 
-            f*=_audioFq;
-            
-            f=floor(f+0.4);
+            if(_type==MUXER_FLV) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+            {
+            			f=timeInUs/1000;
+            			f=floor(f+0.4);
+            }
+            else
+            {
+            	f=timeInUs;
+            	f/=1000000.; // In ms seconds 
+            	f*=_audioFq;
+            	f=floor(f+0.4);
+            }
             pkt.dts=pkt.pts=(int)(f);
 
             //printf("F:%f Q:%u D=%u\n",f,pkt.pts,timeInUs-_lastAudioDts);
@@ -516,7 +547,7 @@
             av_init_packet(&pkt);
 	    
         p=bitstream->ptsFrame+1;      // Pts           // Time p/fps1000=out/den  out=p*den*1000/fps1000
-	p=(p*1000*1000*1000);
+        p=(p*1000*1000*1000);
         p=p/_fps1000;                  // in us
 	
         d=bitstream->dtsFrame;		// dts
@@ -536,9 +567,14 @@
         d=bitstream->dtsFrame;
         RESCALE(d);
         
-	pkt.dts=(int64_t)floor(d);
-	pkt.pts=(int64_t)floor(p);
-        
+        if(_type==MUXER_FLV) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+        {
+        			p=p*1000/_fps1000;
+        			d=d*1000/_fps1000;
+        }
+    	pkt.dts=(int64_t)floor(d);
+    	pkt.pts=(int64_t)floor(p);
+
        // printf("Lavformat : Pts :%u dts:%u",displayframe,frameno);
 	aprintf("Lavformat : Pts :%llu dts:%llu",pkt.pts,pkt.dts);
 	pkt.stream_index=0;
@@ -546,7 +582,7 @@
         pkt.data= bitstream->data;
         pkt.size= bitstream->len;
 	// Look if it is a gop start or seq start
-        if(_type==MUXER_MP4 || _type==MUXER_PSP)
+        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV)
         {
             if(bitstream->flags & AVI_KEY_FRAME) 
                         pkt.flags |= PKT_FLAG_KEY;
@@ -609,11 +645,13 @@
 {
      extern  int        mpegps_init(void );
      extern  int        movenc_init(void );
+     extern  int        flvenc_init(void );
 };
 extern URLProtocol file_protocol ;
 uint8_t lavformat_init(void)
 {
                 movenc_init();
+                flvenc_init();
                 register_protocol(&file_protocol);
 }
 extern "C"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -17,13 +17,14 @@
 typedef enum
 {
         MUXER_NONE=0,
-	MUXER_DVD,
-	MUXER_VCD,
-	MUXER_SVCD,
+        MUXER_DVD,
+		MUXER_VCD,
+		MUXER_SVCD,
         MUXER_TS,
         MUXER_MP4,
         MUXER_PSP,
-	MUXER_DUMMY
+        MUXER_FLV,
+        MUXER_DUMMY
 }ADM_MUXER_TYPE;
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2007-08-26 09:13:11 UTC (rev 3562)
@@ -8,6 +8,7 @@
  mpeg.c utils.c avio.c ADM_lavformat.cpp 
 aviobuf.c cutils.c img2.c file.c mpegtsenc.c ADM_muxts.cpp movenc.c 
 avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c
+flvenc.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am	2007-08-26 09:13:11 UTC (rev 3562)
@@ -6,7 +6,7 @@
 
 libADM_lavformat_a_SOURCES =  mpeg.c utils.c avio.c ADM_lavformat.cpp \
 aviobuf.c cutils.c img2.c file.c mpegtsenc.c ADM_muxts.cpp movenc.c \
-avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c
+avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c flvenc.c
 
 
 EXTRA_DIST = ADM_lavformat.cpp  ADM_muxts.cpp  avformat.h  avio.h   \

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/flvenc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/flvenc.c	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/flvenc.c	2007-08-26 09:13:11 UTC (rev 3562)
@@ -0,0 +1,344 @@
+/*
+ * FLV muxer
+ * Copyright (c) 2003 The FFmpeg Project.
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+#include "avformat.h"
+#include "flv.h"
+#include "riff.h"
+
+#undef NDEBUG
+#include <assert.h>
+
+static const AVCodecTag flv_video_codec_ids[] = {
+    {CODEC_ID_FLV1,    FLV_CODECID_H263  },
+    {CODEC_ID_FLASHSV, FLV_CODECID_SCREEN},
+    {CODEC_ID_VP6F,    FLV_CODECID_VP6   },
+    {CODEC_ID_VP6,     FLV_CODECID_VP6   },
+    {CODEC_ID_NONE,    0}
+};
+
+static const AVCodecTag flv_audio_codec_ids[] = {
+    {CODEC_ID_MP3,       FLV_CODECID_MP3    >> FLV_AUDIO_CODECID_OFFSET},
+    {CODEC_ID_PCM_S8,    FLV_CODECID_PCM_BE >> FLV_AUDIO_CODECID_OFFSET},
+    {CODEC_ID_PCM_S16BE, FLV_CODECID_PCM_BE >> FLV_AUDIO_CODECID_OFFSET},
+    {CODEC_ID_PCM_S16LE, FLV_CODECID_PCM_LE >> FLV_AUDIO_CODECID_OFFSET},
+    {CODEC_ID_ADPCM_SWF, FLV_CODECID_ADPCM  >> FLV_AUDIO_CODECID_OFFSET},
+    {CODEC_ID_NONE,      0}
+};
+
+typedef struct FLVContext {
+    int hasAudio;
+    int hasVideo;
+    int reserved;
+    offset_t duration_offset;
+    offset_t filesize_offset;
+    int64_t duration;
+} FLVContext;
+
+static int get_audio_flags(AVCodecContext *enc){
+    int flags = (enc->bits_per_sample == 16) ? FLV_SAMPLESSIZE_16BIT : FLV_SAMPLESSIZE_8BIT;
+
+    switch (enc->sample_rate) {
+        case    44100:
+            flags |= FLV_SAMPLERATE_44100HZ;
+            break;
+        case    22050:
+            flags |= FLV_SAMPLERATE_22050HZ;
+            break;
+        case    11025:
+            flags |= FLV_SAMPLERATE_11025HZ;
+            break;
+        case     8000: //nellymoser only
+        case     5512: //not mp3
+            flags |= FLV_SAMPLERATE_SPECIAL;
+            break;
+        default:
+            av_log(enc, AV_LOG_ERROR, "flv does not support that sample rate, choose from (44100, 22050, 11025).\n");
+            return -1;
+    }
+
+    if (enc->channels > 1) {
+        flags |= FLV_STEREO;
+    }
+
+    switch(enc->codec_id){
+    case CODEC_ID_MP3:
+        flags |= FLV_CODECID_MP3    | FLV_SAMPLESSIZE_16BIT;
+        break;
+    case CODEC_ID_PCM_S8:
+        flags |= FLV_CODECID_PCM_BE | FLV_SAMPLESSIZE_8BIT;
+        break;
+    case CODEC_ID_PCM_S16BE:
+        flags |= FLV_CODECID_PCM_BE | FLV_SAMPLESSIZE_16BIT;
+        break;
+    case CODEC_ID_PCM_S16LE:
+        flags |= FLV_CODECID_PCM_LE | FLV_SAMPLESSIZE_16BIT;
+        break;
+    case CODEC_ID_ADPCM_SWF:
+        flags |= FLV_CODECID_ADPCM | FLV_SAMPLESSIZE_16BIT;
+        break;
+    case 0:
+        flags |= enc->codec_tag<<4;
+        break;
+    default:
+        av_log(enc, AV_LOG_ERROR, "codec not compatible with flv\n");
+        return -1;
+    }
+
+    return flags;
+}
+
+static void put_amf_string(ByteIOContext *pb, const char *str)
+{
+    size_t len = strlen(str);
+    put_be16(pb, len);
+    put_buffer(pb, str, len);
+}
+
+static void put_amf_double(ByteIOContext *pb, double d)
+{
+    put_byte(pb, AMF_DATA_TYPE_NUMBER);
+    put_be64(pb, av_dbl2int(d));
+}
+
+static void put_amf_bool(ByteIOContext *pb, int b) {
+    put_byte(pb, AMF_DATA_TYPE_BOOL);
+    put_byte(pb, !!b);
+}
+
+static int flv_write_header(AVFormatContext *s)
+{
+    ByteIOContext *pb = &s->pb;
+    FLVContext *flv = s->priv_data;
+    int i, width, height, samplerate, samplesize, channels, audiocodecid, videocodecid;
+    double framerate = 0.0;
+    int metadata_size_pos, data_size;
+
+    flv->hasAudio = 0;
+    flv->hasVideo = 0;
+
+    for(i=0; i<s->nb_streams; i++){
+        AVCodecContext *enc = s->streams[i]->codec;
+        if (enc->codec_type == CODEC_TYPE_VIDEO) {
+            width = enc->width;
+            height = enc->height;
+            if (s->streams[i]->r_frame_rate.den && s->streams[i]->r_frame_rate.num) {
+                framerate = av_q2d(s->streams[i]->r_frame_rate);
+            } else {
+                framerate = 1/av_q2d(s->streams[i]->codec->time_base);
+            }
+            flv->hasVideo=1;
+
+            videocodecid = enc->codec_tag;
+            if(videocodecid == 0) {
+                av_log(enc, AV_LOG_ERROR, "video codec not compatible with flv\n");
+                return -1;
+            }
+        } else {
+            flv->hasAudio=1;
+            samplerate = enc->sample_rate;
+            channels = enc->channels;
+
+            audiocodecid = enc->codec_tag;
+            samplesize = (enc->codec_id == CODEC_ID_PCM_S8) ? 8 : 16;
+
+            if(get_audio_flags(enc)<0)
+                return -1;
+        }
+        av_set_pts_info(s->streams[i], 24, 1, 1000); /* 24 bit pts in ms */
+    }
+    put_tag(pb,"FLV");
+    put_byte(pb,1);
+    put_byte(pb,   FLV_HEADER_FLAG_HASAUDIO * flv->hasAudio
+                 + FLV_HEADER_FLAG_HASVIDEO * flv->hasVideo);
+    put_be32(pb,9);
+    put_be32(pb,0);
+
+    for(i=0; i<s->nb_streams; i++){
+        if(s->streams[i]->codec->codec_tag == 5){
+            put_byte(pb,8); // message type
+            put_be24(pb,0); // include flags
+            put_be24(pb,0); // time stamp
+            put_be32(pb,0); // reserved
+            put_be32(pb,11); // size
+            flv->reserved=5;
+        }
+    }
+
+    /* write meta_tag */
+    put_byte(pb, 18);         // tag type META
+    metadata_size_pos= url_ftell(pb);
+    put_be24(pb, 0);          // size of data part (sum of all parts below)
+    put_be24(pb, 0);          // time stamp
+    put_be32(pb, 0);          // reserved
+
+    /* now data of data_size size */
+
+    /* first event name as a string */
+    put_byte(pb, AMF_DATA_TYPE_STRING);
+    put_amf_string(pb, "onMetaData"); // 12 bytes
+
+    /* mixed array (hash) with size and string/type/data tuples */
+    put_byte(pb, AMF_DATA_TYPE_MIXEDARRAY);
+    put_be32(pb, 5*flv->hasVideo + 4*flv->hasAudio + 2); // +2 for duration and file size
+
+    put_amf_string(pb, "duration");
+    flv->duration_offset= url_ftell(pb);
+    put_amf_double(pb, 0); // delayed write
+
+    if(flv->hasVideo){
+        put_amf_string(pb, "width");
+        put_amf_double(pb, width);
+
+        put_amf_string(pb, "height");
+        put_amf_double(pb, height);
+
+        put_amf_string(pb, "videodatarate");
+        put_amf_double(pb, s->bit_rate / 1024.0);
+
+        put_amf_string(pb, "framerate");
+        put_amf_double(pb, framerate);
+
+        put_amf_string(pb, "videocodecid");
+        put_amf_double(pb, videocodecid);
+    }
+
+    if(flv->hasAudio){
+        put_amf_string(pb, "audiosamplerate");
+        put_amf_double(pb, samplerate);
+
+        put_amf_string(pb, "audiosamplesize");
+        put_amf_double(pb, samplesize);
+
+        put_amf_string(pb, "stereo");
+        put_amf_bool(pb, (channels == 2));
+
+        put_amf_string(pb, "audiocodecid");
+        put_amf_double(pb, audiocodecid);
+    }
+
+    put_amf_string(pb, "filesize");
+    flv->filesize_offset= url_ftell(pb);
+    put_amf_double(pb, 0); // delayed write
+
+    put_amf_string(pb, "");
+    put_byte(pb, AMF_END_OF_OBJECT);
+
+    /* write total size of tag */
+    data_size= url_ftell(pb) - metadata_size_pos - 10;
+    url_fseek(pb, metadata_size_pos, SEEK_SET);
+    put_be24(pb, data_size);
+    url_fseek(pb, data_size + 10 - 3, SEEK_CUR);
+    put_be32(pb, data_size + 11);
+
+    return 0;
+}
+
+static int flv_write_trailer(AVFormatContext *s)
+{
+    int64_t file_size;
+
+    ByteIOContext *pb = &s->pb;
+    FLVContext *flv = s->priv_data;
+
+    file_size = url_ftell(pb);
+
+    /* update informations */
+    url_fseek(pb, flv->duration_offset, SEEK_SET);
+    put_amf_double(pb, flv->duration / (double)1000);
+    url_fseek(pb, flv->filesize_offset, SEEK_SET);
+    put_amf_double(pb, file_size);
+
+    url_fseek(pb, file_size, SEEK_SET);
+    return 0;
+}
+
+static int flv_write_packet(AVFormatContext *s, AVPacket *pkt)
+{
+    ByteIOContext *pb = &s->pb;
+    AVCodecContext *enc = s->streams[pkt->stream_index]->codec;
+    FLVContext *flv = s->priv_data;
+    int size= pkt->size;
+    int flags, flags_size;
+
+//    av_log(s, AV_LOG_DEBUG, "type:%d pts: %"PRId64" size:%d\n", enc->codec_type, timestamp, size);
+
+    if(enc->codec_id == CODEC_ID_VP6 || enc->codec_id == CODEC_ID_VP6F)
+        flags_size= 2;
+    else
+        flags_size= 1;
+
+    if (enc->codec_type == CODEC_TYPE_VIDEO) {
+        put_byte(pb, FLV_TAG_TYPE_VIDEO);
+
+        flags = enc->codec_tag;
+        if(flags == 0) {
+            av_log(enc, AV_LOG_ERROR, "video codec %X not compatible with flv\n",enc->codec_id);
+            return -1;
+        }
+
+        flags |= pkt->flags & PKT_FLAG_KEY ? FLV_FRAME_KEY : FLV_FRAME_INTER;
+    } else {
+        assert(enc->codec_type == CODEC_TYPE_AUDIO);
+        flags = get_audio_flags(enc);
+
+        assert(size);
+
+        put_byte(pb, FLV_TAG_TYPE_AUDIO);
+    }
+
+    put_be24(pb,size + flags_size);
+    put_be24(pb,pkt->pts);
+    put_be32(pb,flv->reserved);
+    put_byte(pb,flags);
+    if (enc->codec_id == CODEC_ID_VP6)
+        put_byte(pb,0);
+    if (enc->codec_id == CODEC_ID_VP6F)
+        put_byte(pb, enc->extradata_size ? enc->extradata[0] : 0);
+    put_buffer(pb, pkt->data, size);
+    put_be32(pb,size+flags_size+11); // previous tag size
+    flv->duration = pkt->pts + pkt->duration;
+
+    put_flush_packet(pb);
+    return 0;
+}
+
+AVOutputFormat flv_muxer = {
+    "flv",
+    "flv format",
+    "video/x-flv",
+    "flv",
+    sizeof(FLVContext),
+// MEANX #ifdef CONFIG_LIBMP3LAME
+#ifdef HAVE_LIBMP3LAME    
+    CODEC_ID_MP3,
+#else // CONFIG_LIBMP3LAME
+    CODEC_ID_NONE,
+#endif // CONFIG_LIBMP3LAME
+    CODEC_ID_FLV1,
+    flv_write_header,
+    flv_write_packet,
+    flv_write_trailer,
+    .codec_tag= (const AVCodecTag*[]){flv_video_codec_ids, flv_audio_codec_ids, 0},
+};
+int flvenc_init(void)
+{
+    av_register_output_format(&flv_muxer);
+    return 0;
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt	2007-08-26 09:13:11 UTC (rev 3562)
@@ -3,4 +3,5 @@
 subdirs (PREORDER oplug_mpeg)
 subdirs (PREORDER oplug_mpegFF)
 subdirs (PREORDER oplug_ogm)
+subdirs (PREORDER oplug_flv)
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am	2007-08-26 09:13:11 UTC (rev 3562)
@@ -1 +1 @@
-SUBDIRS= oplug_avi  oplug_mp4  oplug_mpeg  oplug_mpegFF  oplug_ogm
+SUBDIRS= oplug_avi  oplug_mp4  oplug_mpeg  oplug_mpegFF  oplug_ogm oplug_flv

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -27,6 +27,7 @@
   MK_CONT(AVI_UNP),
   MK_CONT(MP4),
   MK_CONT(PSP),
+  MK_CONT(FLV),
   MK_CONT(FMT_DUMMY)  
 };
 #define NB_CONT (sizeof(container)/sizeof(ADM_CONTAINER))

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -36,11 +36,11 @@
   GtkWidget *menuitem1;
   GtkWidget *menuitem1_menu;
   GtkWidget *open_video1;
-  GtkWidget *image8423;
+  GtkWidget *image8448;
   GtkWidget *append_video1;
-  GtkWidget *image8424;
+  GtkWidget *image8449;
   GtkWidget *save_stuff;
-  GtkWidget *image8425;
+  GtkWidget *image8450;
   GtkWidget *save_stuff_menu;
   GtkWidget *save_as_avi1;
   GtkWidget *separator1;
@@ -50,41 +50,41 @@
   GtkWidget *close1;
   GtkWidget *separator3;
   GtkWidget *save_project1;
-  GtkWidget *image8426;
+  GtkWidget *image8451;
   GtkWidget *save_project_as1;
-  GtkWidget *image8427;
+  GtkWidget *image8452;
   GtkWidget *run_script1;
-  GtkWidget *image8428;
+  GtkWidget *image8453;
   GtkWidget *add_to_joblist1;
   GtkWidget *joblist1;
   GtkWidget *separator16;
   GtkWidget *connect_to_avsproxy1;
   GtkWidget *separator18;
   GtkWidget *video_informations1;
-  GtkWidget *image8429;
+  GtkWidget *image8454;
   GtkWidget *avi_muxer_options1;
   GtkWidget *separator4;
   GtkWidget *quit1;
-  GtkWidget *image8430;
+  GtkWidget *image8455;
   GtkWidget *menuitem2;
   GtkWidget *menuitem2_menu;
   GtkWidget *reset_edits1;
-  GtkWidget *image8431;
+  GtkWidget *image8456;
   GtkWidget *separator5;
   GtkWidget *cut1;
-  GtkWidget *image8432;
+  GtkWidget *image8457;
   GtkWidget *copy1;
-  GtkWidget *image8433;
+  GtkWidget *image8458;
   GtkWidget *paste1;
-  GtkWidget *image8434;
+  GtkWidget *image8459;
   GtkWidget *delete1;
-  GtkWidget *image8435;
+  GtkWidget *image8460;
   GtkWidget *separator6;
   GtkWidget *set_marker_a1;
   GtkWidget *set_marker_b1;
   GtkWidget *separator7;
   GtkWidget *preferences1;
-  GtkWidget *image8436;
+  GtkWidget *image8461;
   GtkWidget *view1;
   GtkWidget *view1_menu;
   GtkWidget *toolbar1;
@@ -112,13 +112,13 @@
   GtkWidget *build_vbr_time_map1;
   GtkWidget *separator11;
   GtkWidget *save_audio1;
-  GtkWidget *image8437;
+  GtkWidget *image8462;
   GtkWidget *audio_encoder1;
   GtkWidget *filters2;
   GtkWidget *tools1;
   GtkWidget *tools1_menu;
   GtkWidget *calculator1;
-  GtkWidget *image8438;
+  GtkWidget *image8463;
   GtkWidget *separator12;
   GtkWidget *rebuild_frames;
   GtkWidget *check_frames;
@@ -138,38 +138,39 @@
   GtkWidget *dvd1;
   GtkWidget *psp1;
   GtkWidget *psp__h264_1;
+  GtkWidget *flv1;
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
-  GtkWidget *image8439;
+  GtkWidget *image8464;
   GtkWidget *previous_frame1;
-  GtkWidget *image8440;
+  GtkWidget *image8465;
   GtkWidget *next_frame1;
-  GtkWidget *image8441;
+  GtkWidget *image8466;
   GtkWidget *previous_intra_frame1;
-  GtkWidget *image8442;
+  GtkWidget *image8467;
   GtkWidget *next_intra_frame1;
-  GtkWidget *image8443;
+  GtkWidget *image8468;
   GtkWidget *search_previous_black_frame1;
   GtkWidget *search_next_black_frame1;
   GtkWidget *first_frame1;
-  GtkWidget *image8444;
+  GtkWidget *image8469;
   GtkWidget *last_frame1;
-  GtkWidget *image8445;
+  GtkWidget *image8470;
   GtkWidget *separator14;
   GtkWidget *go_to_marker_a1;
   GtkWidget *go_to_marker_b1;
   GtkWidget *separator15;
   GtkWidget *jum_to_frame1;
-  GtkWidget *image8446;
+  GtkWidget *image8471;
   GtkWidget *jump_to_time1;
-  GtkWidget *image8447;
+  GtkWidget *image8472;
   GtkWidget *custom1;
   GtkWidget *help2;
   GtkWidget *help2_menu;
   GtkWidget *show_builtin_support1;
   GtkWidget *about1;
-  GtkWidget *image8448;
+  GtkWidget *image8473;
   GtkWidget *toolbar2;
   GtkIconSize tmp_toolbar_icon_size;
   GtkWidget *menutoolbuttonOpen;
@@ -300,9 +301,9 @@
                               GDK_O, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8423 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8423);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8423);
+  image8448 = gtk_image_new_from_stock ("gtk-open", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8448);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (open_video1), image8448);
 
   append_video1 = gtk_image_menu_item_new_with_mnemonic (_("_Append..."));
   gtk_widget_show (append_video1);
@@ -311,17 +312,17 @@
                               GDK_A, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8424 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8424);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8424);
+  image8449 = gtk_image_new_from_stock ("gtk-add", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8449);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (append_video1), image8449);
 
   save_stuff = gtk_image_menu_item_new_with_mnemonic (_("_Save"));
   gtk_widget_show (save_stuff);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_stuff);
 
-  image8425 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8425);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8425);
+  image8450 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8450);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_stuff), image8450);
 
   save_stuff_menu = gtk_menu_new ();
   gtk_menu_item_set_submenu (GTK_MENU_ITEM (save_stuff), save_stuff_menu);
@@ -363,25 +364,25 @@
   gtk_widget_show (save_project1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project1);
 
-  image8426 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8426);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8426);
+  image8451 = gtk_image_new_from_stock ("gtk-save", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8451);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project1), image8451);
 
   save_project_as1 = gtk_image_menu_item_new_with_mnemonic (_("Save P_roject As..."));
   gtk_widget_show (save_project_as1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), save_project_as1);
 
-  image8427 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8427);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8427);
+  image8452 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8452);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_project_as1), image8452);
 
   run_script1 = gtk_image_menu_item_new_with_mnemonic (_("_Load/Run Project..."));
   gtk_widget_show (run_script1);
   gtk_container_add (GTK_CONTAINER (menuitem1_menu), run_script1);
 
-  image8428 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8428);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8428);
+  image8453 = gtk_image_new_from_stock ("gtk-execute", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8453);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (run_script1), image8453);
 
   add_to_joblist1 = gtk_menu_item_new_with_mnemonic (_("A_dd to Joblist..."));
   gtk_widget_show (add_to_joblist1);
@@ -415,9 +416,9 @@
                               GDK_Return, (GdkModifierType)( GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8429 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8429);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8429);
+  image8454 = gtk_image_new_from_stock ("gtk-properties", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8454);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (video_informations1), image8454);
 
   avi_muxer_options1 = gtk_menu_item_new_with_mnemonic (_("AVI _Muxer Options"));
   gtk_widget_show (avi_muxer_options1);
@@ -435,9 +436,9 @@
                               GDK_Q, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8430 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8430);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8430);
+  image8455 = gtk_image_new_from_stock ("gtk-quit", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8455);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (quit1), image8455);
 
   menuitem2 = gtk_menu_item_new_with_mnemonic (_("_Edit"));
   gtk_widget_show (menuitem2);
@@ -450,9 +451,9 @@
   gtk_widget_show (reset_edits1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), reset_edits1);
 
-  image8431 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8431);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8431);
+  image8456 = gtk_image_new_from_stock ("gtk-undo", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8456);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (reset_edits1), image8456);
 
   separator5 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator5);
@@ -466,9 +467,9 @@
                               GDK_X, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8432 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8432);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8432);
+  image8457 = gtk_image_new_from_stock ("gtk-cut", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8457);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (cut1), image8457);
 
   copy1 = gtk_image_menu_item_new_with_mnemonic (_("_Copy"));
   gtk_widget_show (copy1);
@@ -477,9 +478,9 @@
                               GDK_C, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8433 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8433);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8433);
+  image8458 = gtk_image_new_from_stock ("gtk-copy", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8458);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (copy1), image8458);
 
   paste1 = gtk_image_menu_item_new_with_mnemonic (_("_Paste"));
   gtk_widget_show (paste1);
@@ -488,9 +489,9 @@
                               GDK_V, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8434 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8434);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8434);
+  image8459 = gtk_image_new_from_stock ("gtk-paste", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8459);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (paste1), image8459);
 
   delete1 = gtk_image_menu_item_new_with_mnemonic (_("_Delete"));
   gtk_widget_show (delete1);
@@ -499,9 +500,9 @@
                               GDK_Delete, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8435 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8435);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8435);
+  image8460 = gtk_image_new_from_stock ("gtk-remove", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8460);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (delete1), image8460);
 
   separator6 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator6);
@@ -531,9 +532,9 @@
   gtk_widget_show (preferences1);
   gtk_container_add (GTK_CONTAINER (menuitem2_menu), preferences1);
 
-  image8436 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8436);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8436);
+  image8461 = gtk_image_new_from_stock ("gtk-preferences", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8461);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (preferences1), image8461);
 
   view1 = gtk_menu_item_new_with_mnemonic (_("_View"));
   gtk_widget_show (view1);
@@ -680,9 +681,9 @@
                               GDK_S, (GdkModifierType)( GDK_CONTROL_MASK | GDK_MOD1_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8437 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8437);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8437);
+  image8462 = gtk_image_new_from_stock ("gtk-save-as", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8462);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (save_audio1), image8462);
 
   audio_encoder1 = gtk_menu_item_new_with_mnemonic (_("_Encoder"));
   gtk_widget_show (audio_encoder1);
@@ -709,9 +710,9 @@
                               GDK_F7, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8438 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
-  gtk_widget_show (image8438);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8438);
+  image8463 = create_pixmap (mainWindow, "gnome-calculator_small.xpm");
+  gtk_widget_show (image8463);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (calculator1), image8463);
 
   separator12 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator12);
@@ -791,6 +792,10 @@
   gtk_widget_show (psp__h264_1);
   gtk_container_add (GTK_CONTAINER (help1_menu), psp__h264_1);
 
+  flv1 = gtk_menu_item_new_with_mnemonic (_("F_LV"));
+  gtk_widget_show (flv1);
+  gtk_container_add (GTK_CONTAINER (help1_menu), flv1);
+
   go1 = gtk_menu_item_new_with_mnemonic (_("_Go"));
   gtk_widget_show (go1);
   gtk_container_add (GTK_CONTAINER (menuBar), go1);
@@ -805,9 +810,9 @@
                               GDK_P, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8439 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8439);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8439);
+  image8464 = gtk_image_new_from_stock ("gtk-media-play", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8464);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (play_video1), image8464);
 
   previous_frame1 = gtk_image_menu_item_new_with_mnemonic (_("P_revious Frame"));
   gtk_widget_show (previous_frame1);
@@ -816,9 +821,9 @@
                               GDK_KP_4, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8440 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8440);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8440);
+  image8465 = gtk_image_new_from_stock ("gtk-media-previous", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8465);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_frame1), image8465);
 
   next_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Next Frame"));
   gtk_widget_show (next_frame1);
@@ -827,9 +832,9 @@
                               GDK_KP_6, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8441 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8441);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8441);
+  image8466 = gtk_image_new_from_stock ("gtk-media-next", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8466);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_frame1), image8466);
 
   previous_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Pr_evious Intra Frame"));
   gtk_widget_show (previous_intra_frame1);
@@ -838,9 +843,9 @@
                               GDK_KP_2, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8442 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8442);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8442);
+  image8467 = gtk_image_new_from_stock ("gtk-media-rewind", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8467);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (previous_intra_frame1), image8467);
 
   next_intra_frame1 = gtk_image_menu_item_new_with_mnemonic (_("Next _Intra Frame"));
   gtk_widget_show (next_intra_frame1);
@@ -849,9 +854,9 @@
                               GDK_KP_8, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8443 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8443);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8443);
+  image8468 = gtk_image_new_from_stock ("gtk-media-forward", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8468);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (next_intra_frame1), image8468);
 
   search_previous_black_frame1 = gtk_menu_item_new_with_mnemonic (_("Previou_s Black Frame"));
   gtk_widget_show (search_previous_black_frame1);
@@ -868,9 +873,9 @@
                               GDK_Home, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8444 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8444);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8444);
+  image8469 = gtk_image_new_from_stock ("gtk-goto-first", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8469);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (first_frame1), image8469);
 
   last_frame1 = gtk_image_menu_item_new_with_mnemonic (_("_Last Frame"));
   gtk_widget_show (last_frame1);
@@ -879,9 +884,9 @@
                               GDK_End, (GdkModifierType)( 0 ),
                               GTK_ACCEL_VISIBLE);
 
-  image8445 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8445);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8445);
+  image8470 = gtk_image_new_from_stock ("gtk-goto-last", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8470);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (last_frame1), image8470);
 
   separator14 = gtk_separator_menu_item_new ();
   gtk_widget_show (separator14);
@@ -914,9 +919,9 @@
                               GDK_F, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8446 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8446);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8446);
+  image8471 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8471);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8471);
 
   jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_("Go to _Time..."));
   gtk_widget_show (jump_to_time1);
@@ -925,9 +930,9 @@
                               GDK_T, (GdkModifierType)( GDK_CONTROL_MASK),
                               GTK_ACCEL_VISIBLE);
 
-  image8447 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8447);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8447);
+  image8472 = gtk_image_new_from_stock ("gtk-jump-to", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8472);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jump_to_time1), image8472);
 
   custom1 = gtk_menu_item_new_with_mnemonic (_("_Custom"));
   gtk_widget_show (custom1);
@@ -948,9 +953,9 @@
   gtk_widget_show (about1);
   gtk_container_add (GTK_CONTAINER (help2_menu), about1);
 
-  image8448 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
-  gtk_widget_show (image8448);
-  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8448);
+  image8473 = gtk_image_new_from_stock ("gtk-about", GTK_ICON_SIZE_MENU);
+  gtk_widget_show (image8473);
+  gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (about1), image8473);
 
   toolbar2 = gtk_toolbar_new ();
   gtk_widget_show (toolbar2);
@@ -1472,11 +1477,11 @@
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1, "menuitem1");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem1_menu, "menuitem1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, open_video1, "open_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8423, "image8423");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8448, "image8448");
   GLADE_HOOKUP_OBJECT (mainWindow, append_video1, "append_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8424, "image8424");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8449, "image8449");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff, "save_stuff");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8425, "image8425");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8450, "image8450");
   GLADE_HOOKUP_OBJECT (mainWindow, save_stuff_menu, "save_stuff_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, save_as_avi1, "save_as_avi1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator1, "separator1");
@@ -1486,41 +1491,41 @@
   GLADE_HOOKUP_OBJECT (mainWindow, close1, "close1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator3, "separator3");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project1, "save_project1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8426, "image8426");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8451, "image8451");
   GLADE_HOOKUP_OBJECT (mainWindow, save_project_as1, "save_project_as1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8427, "image8427");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8452, "image8452");
   GLADE_HOOKUP_OBJECT (mainWindow, run_script1, "run_script1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8428, "image8428");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8453, "image8453");
   GLADE_HOOKUP_OBJECT (mainWindow, add_to_joblist1, "add_to_joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, joblist1, "joblist1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator16, "separator16");
   GLADE_HOOKUP_OBJECT (mainWindow, connect_to_avsproxy1, "connect_to_avsproxy1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator18, "separator18");
   GLADE_HOOKUP_OBJECT (mainWindow, video_informations1, "video_informations1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8429, "image8429");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8454, "image8454");
   GLADE_HOOKUP_OBJECT (mainWindow, avi_muxer_options1, "avi_muxer_options1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator4, "separator4");
   GLADE_HOOKUP_OBJECT (mainWindow, quit1, "quit1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8430, "image8430");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8455, "image8455");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2, "menuitem2");
   GLADE_HOOKUP_OBJECT (mainWindow, menuitem2_menu, "menuitem2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, reset_edits1, "reset_edits1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8431, "image8431");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8456, "image8456");
   GLADE_HOOKUP_OBJECT (mainWindow, separator5, "separator5");
   GLADE_HOOKUP_OBJECT (mainWindow, cut1, "cut1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8432, "image8432");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8457, "image8457");
   GLADE_HOOKUP_OBJECT (mainWindow, copy1, "copy1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8433, "image8433");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8458, "image8458");
   GLADE_HOOKUP_OBJECT (mainWindow, paste1, "paste1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8434, "image8434");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8459, "image8459");
   GLADE_HOOKUP_OBJECT (mainWindow, delete1, "delete1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8435, "image8435");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8460, "image8460");
   GLADE_HOOKUP_OBJECT (mainWindow, separator6, "separator6");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_a1, "set_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, set_marker_b1, "set_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator7, "separator7");
   GLADE_HOOKUP_OBJECT (mainWindow, preferences1, "preferences1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8436, "image8436");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8461, "image8461");
   GLADE_HOOKUP_OBJECT (mainWindow, view1, "view1");
   GLADE_HOOKUP_OBJECT (mainWindow, view1_menu, "view1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar1, "toolbar1");
@@ -1548,13 +1553,13 @@
   GLADE_HOOKUP_OBJECT (mainWindow, build_vbr_time_map1, "build_vbr_time_map1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator11, "separator11");
   GLADE_HOOKUP_OBJECT (mainWindow, save_audio1, "save_audio1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8437, "image8437");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8462, "image8462");
   GLADE_HOOKUP_OBJECT (mainWindow, audio_encoder1, "audio_encoder1");
   GLADE_HOOKUP_OBJECT (mainWindow, filters2, "filters2");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1, "tools1");
   GLADE_HOOKUP_OBJECT (mainWindow, tools1_menu, "tools1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, calculator1, "calculator1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8438, "image8438");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8463, "image8463");
   GLADE_HOOKUP_OBJECT (mainWindow, separator12, "separator12");
   GLADE_HOOKUP_OBJECT (mainWindow, rebuild_frames, "rebuild_frames");
   GLADE_HOOKUP_OBJECT (mainWindow, check_frames, "check_frames");
@@ -1574,38 +1579,39 @@
   GLADE_HOOKUP_OBJECT (mainWindow, dvd1, "dvd1");
   GLADE_HOOKUP_OBJECT (mainWindow, psp1, "psp1");
   GLADE_HOOKUP_OBJECT (mainWindow, psp__h264_1, "psp__h264_1");
+  GLADE_HOOKUP_OBJECT (mainWindow, flv1, "flv1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8439, "image8439");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8464, "image8464");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_frame1, "previous_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8440, "image8440");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8465, "image8465");
   GLADE_HOOKUP_OBJECT (mainWindow, next_frame1, "next_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8441, "image8441");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8466, "image8466");
   GLADE_HOOKUP_OBJECT (mainWindow, previous_intra_frame1, "previous_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8442, "image8442");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8467, "image8467");
   GLADE_HOOKUP_OBJECT (mainWindow, next_intra_frame1, "next_intra_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8443, "image8443");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8468, "image8468");
   GLADE_HOOKUP_OBJECT (mainWindow, search_previous_black_frame1, "search_previous_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, search_next_black_frame1, "search_next_black_frame1");
   GLADE_HOOKUP_OBJECT (mainWindow, first_frame1, "first_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8444, "image8444");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8469, "image8469");
   GLADE_HOOKUP_OBJECT (mainWindow, last_frame1, "last_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8445, "image8445");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8470, "image8470");
   GLADE_HOOKUP_OBJECT (mainWindow, separator14, "separator14");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_a1, "go_to_marker_a1");
   GLADE_HOOKUP_OBJECT (mainWindow, go_to_marker_b1, "go_to_marker_b1");
   GLADE_HOOKUP_OBJECT (mainWindow, separator15, "separator15");
   GLADE_HOOKUP_OBJECT (mainWindow, jum_to_frame1, "jum_to_frame1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8446, "image8446");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8471, "image8471");
   GLADE_HOOKUP_OBJECT (mainWindow, jump_to_time1, "jump_to_time1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8447, "image8447");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8472, "image8472");
   GLADE_HOOKUP_OBJECT (mainWindow, custom1, "custom1");
   GLADE_HOOKUP_OBJECT (mainWindow, help2, "help2");
   GLADE_HOOKUP_OBJECT (mainWindow, help2_menu, "help2_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, show_builtin_support1, "show_builtin_support1");
   GLADE_HOOKUP_OBJECT (mainWindow, about1, "about1");
-  GLADE_HOOKUP_OBJECT (mainWindow, image8448, "image8448");
+  GLADE_HOOKUP_OBJECT (mainWindow, image8473, "image8473");
   GLADE_HOOKUP_OBJECT (mainWindow, toolbar2, "toolbar2");
   GLADE_HOOKUP_OBJECT (mainWindow, menutoolbuttonOpen, "menutoolbuttonOpen");
   GLADE_HOOKUP_OBJECT (mainWindow, toolitem11, "toolitem11");

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -95,6 +95,7 @@
 CALLBACK(dvd1                                   ,ACT_AUTO_DVD);
 CALLBACK(psp1                                   ,ACT_AUTO_PSP);
 CALLBACK(psp__h264_1,                           ACT_AUTO_PSP_H264);
+CALLBACK(flv1,                                  ACT_AUTO_FLV);
 
 CALLBACK(add_to_joblist1                       ,ACT_ADD_JOB);
 CALLBACK(joblist1                              ,ACT_HANDLE_JOB);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui	2007-08-26 09:13:11 UTC (rev 3562)
@@ -1,15 +1,13 @@
 <ui version="4.0" >
  <author>mean</author>
- <comment></comment>
- <exportmacro></exportmacro>
  <class>MainWindow</class>
  <widget class="QMainWindow" name="MainWindow" >
   <property name="geometry" >
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>680</width>
-    <height>537</height>
+    <width>828</width>
+    <height>589</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -1360,8 +1358,8 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>680</width>
-     <height>23</height>
+     <width>828</width>
+     <height>25</height>
     </rect>
    </property>
    <widget class="QMenu" name="menuHelp" >
@@ -1432,16 +1430,6 @@
     <addaction name="separator" />
     <addaction name="actionQuit" />
    </widget>
-   <widget class="QMenu" name="menuAuto" >
-    <property name="title" >
-     <string>A&amp;uto</string>
-    </property>
-    <addaction name="actionVCD" />
-    <addaction name="actionSVCD" />
-    <addaction name="actionDVD" />
-    <addaction name="actionPSP" />
-    <addaction name="actionPSP_H264" />
-   </widget>
    <widget class="QMenu" name="menuTools" >
     <property name="title" >
      <string>&amp;Tools</string>
@@ -1519,6 +1507,17 @@
     <addaction name="actionJump_to_Frame" />
     <addaction name="actionJump_to_Time" />
    </widget>
+   <widget class="QMenu" name="menuAuto" >
+    <property name="title" >
+     <string>A&amp;uto</string>
+    </property>
+    <addaction name="actionVCD" />
+    <addaction name="actionSVCD" />
+    <addaction name="actionDVD" />
+    <addaction name="actionPSP" />
+    <addaction name="actionPSP_H264" />
+    <addaction name="actionFLV" />
+   </widget>
    <addaction name="menuFile" />
    <addaction name="menuEdit" />
    <addaction name="menuView" />
@@ -2384,15 +2383,17 @@
     <string>&amp;Separate</string>
    </property>
   </action>
+  <action name="actionFLV" >
+   <property name="text" >
+    <string>FLV</string>
+   </property>
+  </action>
  </widget>
- <pixmapfunction></pixmapfunction>
  <customwidgets>
   <customwidget>
    <class>ADM_QSlider</class>
    <extends>QSlider</extends>
    <header>ADM_qslider.h</header>
-   <container>0</container>
-   <pixmap></pixmap>
   </customwidget>
  </customwidgets>
  <resources>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-08-26 09:13:11 UTC (rev 3562)
@@ -63,6 +63,7 @@
 PROCESS(actionSVCD,ACT_AUTO_SVCD) \
 PROCESS(actionDVD,ACT_AUTO_DVD) \
 PROCESS(actionPSP,ACT_AUTO_PSP) \
+PROCESS(actionFLV,ACT_AUTO_FLV) \
 PROCESS(actionPSP_H264,ACT_AUTO_PSP_H264)\
 PROCESS(actionAdd_to_joblist,ACT_ADD_JOB) \
 PROCESS(actionShow_Joblist,ACT_HANDLE_JOB)  

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-26 09:13:11 UTC (rev 3562)
@@ -118,6 +118,7 @@
 oplug_mpeg
 oplug_mpegFF
 oplug_ogm
+oplug_flv
 )
 
 FOREACH(_current ${ADM_outputs})

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -419,6 +419,7 @@
         case ACT_AUTO_SVCD:
         case ACT_AUTO_DVD:
         case ACT_AUTO_PSP:
+        case ACT_AUTO_FLV:
         case ACT_AUTO_PSP_H264:
                 A_autoDrive( action);
                 break;

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-08-26 09:13:11 UTC (rev 3562)
@@ -175,6 +175,7 @@
 ACT_AUTO_DVD,
 ACT_AUTO_PSP,
 ACT_AUTO_PSP_H264,
+ACT_AUTO_FLV,
 
 ACT_ADD_JOB,
 ACT_HANDLE_JOB,

Modified: branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -57,6 +57,43 @@
 #define PSP_AUDIO_FQ 24000        
         switch(action)
         {
+        		case ACT_AUTO_FLV:
+        			// Check audio is mp3 @ 44.1/22.05/11.025 kHz MP3
+        			if(currentaudiostream)
+        			{
+        				fq=currentaudiostream->getInfo()->frequency;
+        				if(currentaudiostream->getInfo()->encoding==WAV_MP3 && (fq==44100 || fq==22050 || fq==11025))
+        						{
+        	                		audioCodecSetcodec(AUDIOENC_COPY);
+        						}
+        				else
+        				{
+#ifdef HAVE_LIBMP3LAME
+        					audioCodecSetcodec(AUDIOENC_MP3);
+        					audioFilter_SetBitrate(128);
+        					// set fq
+        					
+#else
+        					 GUI_Error_HIG(_("Codec Error"),
+        					        _( "You don't have LAME!.\nIt is needed to create FLV  video."));
+#endif
+        					 if(fq==44100 || fq==22050 || fq==11025)
+        					         						{}
+        					 else
+        					 {
+        						 audioFilterResample(22050);
+        					 }
+        					 
+        				}
+        			}
+        			// Now video
+        			 if(!videoCodecSelectByName("FLV1")) 
+                    {
+                      GUI_Error_HIG(_("Codec Error"),_( "Cannot select FLV1  codec."));
+                        return 0;
+                    }
+        			break;
+        			
                 case ACT_AUTO_PSP:
                 case ACT_AUTO_PSP_H264:
                     // Resize
@@ -225,6 +262,9 @@
           case ACT_AUTO_PSP_H264:
               UI_SetCurrentFormat(ADM_PSP);
               break;
+          case ACT_AUTO_FLV:
+        	  UI_SetCurrentFormat(ADM_FLV);
+        	  break;
           default:
               UI_SetCurrentFormat(ADM_PS);
         }

Modified: branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-08-26 09:13:11 UTC (rev 3562)
@@ -45,6 +45,7 @@
 #include "oplug_avi/op_avisave.h"
 #include "oplug_avi/op_savecopy.h"
 #include "oplug_mp4/oplug_mp4.h"
+#include "oplug_flv/oplug_flv.h"
 #include "ADM_encoder/adm_encoder.h"
 
 #include "oplug_avi/op_saveprocess.h"
@@ -170,8 +171,12 @@
 					printf(" AVI family\n");
 					switch(UI_GetCurrentFormat())
 					{
-                                                case ADM_MP4:
-                                                case ADM_PSP:
+						case ADM_FLV:
+                            			ret=oplug_flv(name);
+                            			break;
+                        case ADM_MP4:
+                        case ADM_PSP:
+                        
                                                     ret=oplug_mp4(name,UI_GetCurrentFormat());
                                                     break;
 						case ADM_AVI:



From mean at mail.berlios.de  Sun Aug 26 11:44:59 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 26 Aug 2007 11:44:59 +0200
Subject: [Avidemux-svn-commit] r3563 - in
	branches/avidemux_2.4_branch/avidemux/ADM_outputs: . oplug_flv
Message-ID: <200708260944.l7Q9ixCe014287@sheep.berlios.de>

Author: mean
Date: 2007-08-26 11:44:59 +0200 (Sun, 26 Aug 2007)
New Revision: 3563

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.h
Log:
[Output] Flv output

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/CMakeLists.txt	2007-08-26 09:13:11 UTC (rev 3562)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/CMakeLists.txt	2007-08-26 09:44:59 UTC (rev 3563)
@@ -0,0 +1,3 @@
+
+SET(ADM_oplug_flv_SRCS oplug_flv.cpp)
+ADD_LIBRARY(oplug_flv STATIC ${ADM_oplug_flv_SRCS})

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/Makefile.am	2007-08-26 09:13:11 UTC (rev 3562)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/Makefile.am	2007-08-26 09:44:59 UTC (rev 3563)
@@ -0,0 +1,14 @@
+####### kdevelop will overwrite this part!!! (begin)##########
+noinst_LIBRARIES = liboplug_flv.a
+
+INCLUDES = $(all_includes)  -I../../ADM_libraries -I../../ADM_libraries/ADM_utilities   -I../../ADM_libraries/ADM_lavutil \
+		-I../../ADM_userInterfaces/ADM_commonUI 
+
+liboplug_flv_a_METASOURCES = AUTO
+
+liboplug_flv_a_SOURCES = oplug_flv.cpp 
+
+
+EXTRA_DIST = oplug_flv.cpp  oplug_flv.h
+
+####### kdevelop will overwrite this part!!! (end)############

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2007-08-26 09:13:11 UTC (rev 3562)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp	2007-08-26 09:44:59 UTC (rev 3563)
@@ -0,0 +1,383 @@
+/***************************************************************************
+                          oplug_flv.cpp  -  I/f to lavformat flash encoder
+                             -------------------
+    
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+        
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <string.h>
+#include <math.h>
+#include <pthread.h>
+#define WIN32_CLASH
+
+
+extern "C" {
+#include "ADM_lavcodec.h"
+};
+#include "default.h"
+#include "ADM_editor/ADM_Video.h"
+#include "ADM_colorspace/colorspace.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include <ADM_assert.h>
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_filter/video_filters.h"
+
+
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_encoder/adm_encoder.h"
+
+#include "ADM_codecs/ADM_ffmpeg.h"
+#include "ADM_encoder/adm_encffmpeg.h"
+#include "oplug_mpegFF/oplug_vcdff.h"
+
+#include "DIA_encoding.h"
+#include "ADM_audiofilter/audioprocess.hxx"
+#include "ADM_audiofilter/audioeng_buildfilters.h"
+#include "ADM_lavformat/ADM_lavformat.h"
+#include "ADM_utilities/fourcc.h"
+#include "ADM_encoder/adm_encConfig.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_mplex/ADM_mthread.h"
+#include "ADM_toolkit/ADM_audioQueue.h"
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_MP4
+#include "ADM_osSupport/ADM_debug.h"
+
+
+extern const char 				*getStrFromAudioCodec( uint32_t codec);
+extern AVDMGenericAudioStream 	*mpt_getAudioStream(void);
+extern void   	 				UI_purge(void );
+
+extern uint32_t					videoProcessMode (void);
+extern uint32_t 				frameStart,frameEnd;
+extern uint32_t 				audioProcessMode(void);
+extern AVDMGenericAudioStream 	*currentaudiostream;;
+extern SelectCodecType  		current_codec;
+
+
+
+static 				uint8_t *_buffer=NULL,*_outbuffer=NULL;
+
+/*
+ * 		\fn    Oplug_flv
+		\brief Main function to save in flv format. 
+		It is very close to oplug_mp4 but somehow simplified as the following assumptions are made :
+				* No b frame
+				* No 2 pass encoding
+
+*/
+uint8_t oplug_flv(const char *name)
+{
+AVDMGenericVideoStream *_incoming=NULL;
+AVDMGenericAudioStream  *audio=NULL;
+
+uint8_t		audioBuffer[48000];
+uint8_t         *videoBuffer=NULL;
+
+uint32_t alen;//,flags;
+uint32_t size;
+
+uint8_t   ret=0;
+
+uint32_t  sample_got=0,sample;
+uint32_t  extraDataSize=0;
+uint8_t   *extraData=NULL;
+lavMuxer  *muxer=NULL;
+aviInfo      info;
+uint32_t   width,height;
+DIA_encoding *encoding_gui=NULL;
+Encoder         *_encode=NULL;
+uint32_t total=0;
+uint32_t videoExtraDataSize=0;
+uint8_t  *videoExtraData=NULL;
+uint8_t *dummy,err;
+WAVHeader *audioinfo=NULL;
+int prefill=0;
+uint32_t displayFrame=0;
+ADMBitstream    bitstream(0);
+uint32_t        frameWrite=0;
+uint8_t r=0;
+uint32_t skipping=1;
+pthread_t     audioThread;
+audioQueueMT context;
+PacketQueue   *pq=NULL;//("MP4 audioQ",50,2*1024*1024);
+uint32_t    totalAudioSize=0;
+uint32_t sent=0;
+
+        // Setup video
+        
+        if(videoProcessMode())
+        {
+             _incoming = getLastVideoFilter (frameStart,frameEnd-frameStart);
+        }else
+        {
+             _incoming = getFirstVideoFilter (frameStart,frameEnd-frameStart);
+        }
+
+           videoBuffer=new uint8_t[_incoming->getInfo()->width*_incoming->getInfo()->height*3];
+                // Set global header encoding, needed for H264
+           _encode = getVideoEncoder (_incoming->getInfo()->width,  _incoming->getInfo()->height,1);
+           total= _incoming->getInfo()->nb_frames;
+
+           info.fcc=*(uint32_t *)_encode->getCodecName(); //FIXME
+           //
+           char *supportedVideo[3]={"FLV1","VP6F","VP6 "};
+           int supported=0;
+           for(int i=0;i<3;i++)
+           {
+        	   if(fourCC::check(info.fcc,(uint8_t *)supportedVideo[i]))
+        	   {
+        		   	supported=1;
+        	   }
+           }
+           if(!supported)
+           {
+        	   GUI_Error_HIG(_("Unsupported video"),_("Only FLV1 and VP6 video are supported"));
+        	   goto stopit;
+           }
+           /* Check audio, we support only mp3 right now
+            * 44100, 22050, 11025 only!
+            *  */
+           if(currentaudiostream)
+           {
+        	   uint32_t audioCodec=0;
+        	   uint32_t fq=currentaudiostream->getInfo()->frequency;
+        	   
+        	   	if(audioProcessMode())
+        	   	{
+        	   		audioCodec=audioFilter_getOuputCodec();
+        	   		fq=audioFilter_getOuputFrequency(fq);
+        	   		
+        	   	}else
+        	   	{	// copy
+        	   		audioCodec=currentaudiostream->getInfo()->encoding;
+        	   	}
+        	   	if(audioCodec!=WAV_MP3 )
+        	   		{
+        	   			GUI_Error_HIG(_("Unsupported audio"),_("Audio must be mp3 for flv output."));
+        	   			goto stopit;
+        	   		}
+        	   	if(fq!=44100 && fq!=22050 && fq!=11025)
+        	   	{
+    	   			GUI_Error_HIG(_("Unsupported audio"),_("Frequency must be 44100, 22050 or 11025 Hz."));
+    	   			goto stopit;
+        	   		
+        	   	}
+           }
+           
+           
+           encoding_gui=new DIA_encoding(_incoming->getInfo()->fps1000);
+           bitstream.bufferSize=_incoming->getInfo()->width*_incoming->getInfo()->height*3;
+           if (!_encode)
+                {
+                  GUI_Error_HIG ("[FLV]",_("Cannot initialize the video stream"));
+                        goto  stopit;
+                }
+
+                // init compressor
+                encoding_gui->setContainer("FLV");
+                encoding_gui->setAudioCodec("None");
+                if(!videoProcessMode())
+                        encoding_gui->setCodec("Copy");
+                else
+                        encoding_gui->setCodec(_encode->getDisplayName());
+                
+                if (!_encode->configure (_incoming))
+                {
+                      GUI_Error_HIG (_("Filter init failed"), NULL);
+                     goto  stopit;
+                };
+
+                encoding_gui->setPhasis ("Encoding");
+                
+                
+                info.width=_incoming->getInfo()->width;
+                info.height=_incoming->getInfo()->height;
+                info.nb_frames=_incoming->getInfo()->nb_frames;
+                info.fps1000=_incoming->getInfo()->fps1000;
+                
+                _encode->hasExtraHeaderData( &videoExtraDataSize,&dummy);
+                if(videoExtraDataSize)
+                {
+                        printf("[FLV]We have extradata for video in copy mode (%d)\n",videoExtraDataSize);
+                        videoExtraData=new uint8_t[videoExtraDataSize];
+                        memcpy(videoExtraData,dummy,videoExtraDataSize);
+                }
+        // _________________Setup video (cont) _______________
+        // ___________ Read 1st frame _________________
+             
+             ADM_assert(_encode);
+             bitstream.data=videoBuffer;
+             
+preFilling:
+             bitstream.cleanup(0);
+             if(!(err=_encode->encode ( prefill, &bitstream)))// FIXME: We should never execute it more than once
+             {
+                        printf("[FLV]:First frame error\n");
+                        GUI_Error_HIG (_("Error while encoding"), NULL);
+                        goto  stopit;
+              }
+              sent++;
+              if(!bitstream.len)
+              {
+                prefill++;
+                goto preFilling;
+              }
+              if(!bitstream.flags & AVI_KEY_FRAME)
+              {
+                GUI_Error_HIG (_("KeyFrame error"),_( "The beginning frame is not a key frame.\nPlease move the A marker."));
+                  goto  stopit; 
+              }
+          
+// ____________Setup audio__________________
+          if(currentaudiostream)
+          {
+                audio=mpt_getAudioStream();
+                if(!audio)
+                {
+                        GUI_Error_HIG ("[FLV]",_("Cannot initialize the audio stream"));
+                        goto  stopit;
+                }
+          } 
+          if(audio)
+          {
+                audioinfo=audio->getInfo();
+                audio->extraData(&extraDataSize,&extraData);
+                if(audioProcessMode())
+                        encoding_gui->setAudioCodec(getStrFromAudioCodec(audio->getInfo()->encoding));
+                else
+                         encoding_gui->setAudioCodec("Copy");
+
+           }else
+           {
+                encoding_gui->setAudioCodec("None");
+           }
+// ____________Setup Muxer _____________________
+           muxer= new lavMuxer;
+           
+           if(!muxer->open(
+                name,
+                2000000, // Muxrate
+                MUXER_FLV,
+                &info,videoExtraDataSize,videoExtraData,
+                audioinfo,extraDataSize,extraData))
+                         goto stopit;
+//_____________ Loop _____________________
+          
+          encoding_gui->setContainer("FLV");
+         
+          if(!videoProcessMode())
+                encoding_gui->setCodec("Copy");
+          else
+                encoding_gui->setCodec(_encode->getDisplayName());
+           //
+          UI_purge();
+          if(bitstream.len)
+          {
+            muxer->writeVideoPacket( &bitstream);
+            frameWrite++;
+          }
+//_____________ Start Audio thread _____________________
+          if(audio)
+          {          
+            pq=new PacketQueue("[FLV] audioQ",5000,2*1024*1024);
+            memset(&context,0,sizeof(context));
+            context.audioEncoder=audio;
+            context.audioTargetSample=0xFFFF0000; ; //FIXME
+            context.packetQueue=pq;
+            // start audio thread
+            ADM_assert(!pthread_create(&audioThread,NULL,(THRINP)defaultAudioQueueSlave,&context)); 
+            ADM_usleep(4000);
+          }
+//_____________GO !___________________
+           for(int frame=1;frame<total;frame++)
+           {
+               while(muxer->needAudio())
+               {
+                    if(pq->Pop(audioBuffer,&alen,&sample))
+                    {
+                     if(alen)
+                     {
+                        muxer->writeAudioPacket(alen,audioBuffer,sample_got);
+                        totalAudioSize+=alen;
+                        encoding_gui->setAudioSize(totalAudioSize);
+                        sample_got+=sample;
+                     }
+                    }else break;
+               }
+               ADM_assert(_encode);
+               bitstream.cleanup(frameWrite);
+              
+               r=_encode->encode ( prefill+frame, &bitstream);
+              
+               if(!r && frame<total-2)
+               {
+                        printf("[FLV]:Frame %u error\n",frame);
+                        GUI_Error_HIG ("FLV",_("Error while encoding"));
+                        goto  stopit;
+                }
+                if(!bitstream.len && skipping)
+                {
+                    printf("[FLV]Frame skipped (xvid ?)\n");
+                    continue;
+                }
+                sent++;
+                skipping=0;
+            //    printf("Prefill %u FrameWrite :%u Frame %u PtsFrame :%u\n",prefill,frameWrite,frame,bitstream.ptsFrame);
+                frameWrite++;
+                muxer->writeVideoPacket( &bitstream);
+                encoding_gui->setFrame(frame,bitstream.len,bitstream.out_quantizer,total);
+               if(!encoding_gui->isAlive())
+                {
+                    
+                    goto stopit;
+                }
+               
+           }
+           ret=1;
+           
+stopit:
+    
+    // Flush slave Q
+    if(audio&& pq)
+    {
+        context.audioAbort=1;
+        pq->Abort();
+        // Wait for audio slave to be over
+        while(!context.audioDone)
+        {
+          printf("[FLV]Waiting Audio thread\n");
+          ADM_usleep(500000); 
+        }
+        delete pq;
+    }
+    //
+           if(muxer) muxer->close();
+           if(encoding_gui) delete encoding_gui;
+           if(videoBuffer) delete [] videoBuffer;
+           if(muxer) delete muxer;
+           if(_encode) delete _encode;	
+           if(videoExtraData) delete [] videoExtraData;
+           // Cleanup
+           deleteAudioFilter (audio);
+           return ret;
+}
+
+	
+// EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.h	2007-08-26 09:13:11 UTC (rev 3562)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_flv/oplug_flv.h	2007-08-26 09:44:59 UTC (rev 3563)
@@ -0,0 +1,21 @@
+/***************************************************************************
+                          oplug_vcdff.h  -  description
+                             -------------------
+    begin                : Sun Nov 10 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifdef USE_FFMPEG
+#include "ADM_editor/ADM_outputfmt.h"
+uint8_t oplug_flv(const char *name);
+
+#endif



From mean at mail.berlios.de  Sun Aug 26 14:29:26 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 26 Aug 2007 14:29:26 +0200
Subject: [Avidemux-svn-commit] r3564 - branches/avidemux_2.4_branch/avidemux
Message-ID: <200708261229.l7QCTQlo006115@sheep.berlios.de>

Author: mean
Date: 2007-08-26 14:29:26 +0200 (Sun, 26 Aug 2007)
New Revision: 3564

Modified:
   branches/avidemux_2.4_branch/avidemux/Makefile.am
Log:
[Automake] add flv output

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-26 09:44:59 UTC (rev 3563)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-26 12:29:26 UTC (rev 3564)
@@ -109,6 +109,7 @@
 ./ADM_outputs/oplug_mpegFF/liboplug_mpegFF.a		\
 ./ADM_outputs/oplug_ogm/liboplug_ogm.a			\
 ./ADM_outputs/oplug_avi/liboplug_avi.a			\
+./ADM_outputs/oplug_flv/liboplug_flv.a			\
 ./ADM_encoder/libADM_encoder.a				\
 ./ADM_codecs/libADM_codecs.a				\
 ./ADM_requant/libADM_requant.a				\



From mean at mail.berlios.de  Tue Aug 28 17:32:59 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 28 Aug 2007 17:32:59 +0200
Subject: [Avidemux-svn-commit] r3565 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_encoder
	ADM_outputs/oplug_mpegFF ADM_userInterfaces/ADM_commonUI
Message-ID: <200708281532.l7SFWxKr005716@sheep.berlios.de>

Author: mean
Date: 2007-08-28 17:32:58 +0200 (Tue, 28 Aug 2007)
New Revision: 3565

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
Log:
[FLV] simple configuration dialog + [LAVC] some fixes about lavc encoding

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-28 15:32:58 UTC (rev 3565)
@@ -65,7 +65,7 @@
 /*****************************************/
 ffmpegEncoderCQ::~ffmpegEncoderCQ ()
   {
-    printf("Deleting ffmpegCQencoder\n");
+    printf("[LAVCODEC]Deleting ffmpegCQencoder\n");
     //stopEncoder ();
     if (_statfile)
       {
@@ -91,7 +91,7 @@
 ffmpegEncoder::ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id):encoder (width,
 	 height)
 {
-  printf ("Build: %d\n", LIBAVCODEC_BUILD);
+  printf ("[LAVCODEC]Build: %d\n", LIBAVCODEC_BUILD);
 
   _id = id;
   _swap = 0;
@@ -126,7 +126,7 @@
 ffmpegEncoder::~ffmpegEncoder ()
 {
   printf ("[lavc] encoder destroying..\n");
-  if (_isMT)
+  if (_isMT && _context)
     {
       printf ("[lavc] killing threads\n");
       avcodec_thread_free (_context);
@@ -202,7 +202,7 @@
     {
       if (FRAME_FILM == identMovieType (rate))
 	{
-	  printf ("Pulldown activated...\n");
+	  printf ("[LAVCODEC]Pulldown activated...\n");
 	  _context->flags2 |= CODEC_FLAG2_32_PULLDOWN;
 	}
     }
@@ -211,7 +211,7 @@
 #else
   _context->max_b_frames = 2;
 #endif
-  printf ("Using 2 b frames\n");
+  printf ("[LAVCODEC]Using 2 b frames\n");
   if (_id == FF_MPEG2)
     {
       _context->mpeg_quant = 1;	//1; // Should be mpeg quant 
@@ -224,7 +224,7 @@
     {
       if (_settings.widescreen)
 	{
-          printf("WideScreen\n");
+          printf("[LAVCODEC]WideScreen\n");
 	  _context->sample_aspect_ratio.num = 16;
 	  _context->sample_aspect_ratio.den = 9;
 	}
@@ -277,17 +277,19 @@
 
   //
   //_context->dsp_mask= FF_MM_FORCE;
-  printf ("Mpeg12 settings:\n____________\n");
-  printf ("FF Max rate   (header) : %lu kbps\n",
+  printf ("[LAVCODEC]Mpeg12 settings:\n____________\n");
+  printf ("[LAVCODEC]FF Max rate   (header) : %lu kbps\n",
 	  (_context->rc_max_rate_header) / 1000);
-  printf ("FF Buffer Size(header) : %lu bits / %lu kB\n",
+  printf ("[LAVCODEC]FF Buffer Size(header) : %lu bits / %lu kB\n",
 	  (_context->rc_buffer_size_header),
 	  _context->rc_buffer_size_header / (8 * 1024));
-  printf ("FF Max rate   (rc) : %lu kbps\n", (_context->rc_max_rate) / 1000);
-  printf ("FF Buffer Size(rc) : %lu bits / %lu kB\n",
+  printf ("[LAVCODEC]FF Max rate   (rc) : %lu kbps\n", (_context->rc_max_rate) / 1000);
+  printf ("[LAVCODEC]FF Buffer Size(rc) : %lu bits / %lu kB\n",
 	  (_context->rc_buffer_size), _context->rc_buffer_size / (8 * 1024));
 
-  printf ("FF GOP Size    : %lu\n", _context->gop_size);
+  printf ("[LAVCODEC]FF GOP Size    : %lu\n", _context->gop_size);
+  printf ("[LAVCODEC]FF Bitrate    : %lu (kb/s)\n", _context->bit_rate/1000);
+  
   return 1;
 }
 
@@ -406,7 +408,7 @@
 {
 
   _context->gop_size = size;
-  printf ("Gop size is now %d\n", _context->gop_size);
+  printf ("[LAVCODEC]Gop size is now %d\n", _context->gop_size);
   return 1;
 
 }
@@ -431,7 +433,7 @@
 uint8_t
 ffmpegEncoderCQ::init (uint32_t val, uint32_t fps1000, uint8_t vbr)
 {
-
+  printf ("[LAVCODEC] Using Q=%u\n",val); 
   mplayer_init ();
   _qual = val;
   _vbr = vbr;
@@ -513,9 +515,12 @@
   {
   1000, fps1000};
 
-  _context->bit_rate = _br;
+  if(_id==FF_MPEG2 || _id==FF_MPEG1)
+	  _context->bit_rate = _br;
+  else
+	  _context->bit_rate = _br*1000;
 
-  printf ("--> br: %lu", _br);
+  printf ("[LAVCODEC] Using  bitrate in context :%lu kbps",_context->bit_rate/1000);
 
   return initContext ();
 
@@ -663,7 +668,7 @@
     }
   else
     {
-      if (_id == FF_MPEG1 || _id == FF_MPEG2)
+      if (_id == FF_MPEG1 || _id == FF_MPEG2 || _id == FF_FLV1)
 	{
 	  _context->gop_size = _settings.gop_size;
 	}
@@ -671,8 +676,8 @@
 	{
 	  _context->gop_size = 250;
 	}
-#define SETX(x) _context->x=_settings.x; printf(#x" : %d\n",_settings.x);
-#define SETX_COND(x) if(_settings.is_##x) {_context->x=_settings.x; printf(#x" : %d\n",_settings.x);} else\
+#define SETX(x) _context->x=_settings.x; printf("[LAVCODEC]"#x" : %d\n",_settings.x);
+#define SETX_COND(x) if(_settings.is_##x) {_context->x=_settings.x; printf("[LAVCODEC]"#x" : %d\n",_settings.x);} else\
 		{ printf(#x" is not activated\n");}
       SETX (me_method);
       SETX (qmin);
@@ -686,9 +691,9 @@
 #undef SETX
 #undef SETX_COND
 
-#define SETX(x)  _context->x=_settings.x; printf(#x" : %f\n",_settings.x);
-#define SETX_COND(x)  if(_settings.is_##x) {_context->x=_settings.x; printf(#x" : %f\n",_settings.x);} else  \
-									{printf(#x" No activated\n");}
+#define SETX(x)  _context->x=_settings.x; printf("[LAVCODEC]"#x" : %f\n",_settings.x);
+#define SETX_COND(x)  if(_settings.is_##x) {_context->x=_settings.x; printf("[LAVCODEC]"#x" : %f\n",_settings.x);} else  \
+									{printf("[LAVCODEC]"#x" No activated\n");}
       SETX_COND (lumi_masking);
       SETX_COND (dark_masking);
       SETX (qcompress);
@@ -699,7 +704,7 @@
 #undef SETX
 #undef SETX_COND
 
-#define SETX(x) if(_settings.x){ _context->flags|=CODEC_FLAG##x;printf(#x" is set\n");}
+#define SETX(x) if(_settings.x){ _context->flags|=CODEC_FLAG##x;printf("[LAVCODEC]"#x" is set\n");}
       SETX (_GMC);
 
 
@@ -729,7 +734,7 @@
 	{
 	  _context->sample_aspect_ratio.num = 16;
 	  _context->sample_aspect_ratio.den = 9;
-	  printf ("16/9 aspect ratio is set.\n");
+	  printf ("[LAVCODEC]16/9 aspect ratio is set.\n");
 
 	}
 #undef SETX
@@ -830,7 +835,7 @@
 {
   *d = (uint8_t *) _context->extradata;
   *l = _context->extradata_size;
-  printf ("We got some extra data: %lu\n", *l);
+  printf ("[LAVCODEC]We got some extra data: %lu\n", *l);
   if (*l)
     return 1;
 
@@ -856,7 +861,7 @@
   _context->bit_rate = 0;
   _context->bit_rate_tolerance = 1024 * 8 * 1000;
   _context->gop_size = 250;
-  printf ("FFV1 codec initializing...\n");
+  printf ("[LAVCODEC]FFV1 codec initializing...\n");
   return initContext ();
 }
 
@@ -885,7 +890,7 @@
   _context->bit_rate = 0;
   _context->bit_rate_tolerance = 1024 * 8 * 1000;
   _context->gop_size = 250;
-  printf ("FF Mjpeg codec initializing %d %% -> q =%d...\n", val, _qual);
+  printf ("[LAVCODEC]FF Mjpeg codec initializing %d %% -> q =%d...\n", val, _qual);
   return initContext ();
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-28 15:32:58 UTC (rev 3565)
@@ -2,6 +2,7 @@
 #define ADM_CODEC_CONFIG_
 
 uint8_t DIA_DVDffParam (COMPRES_PARAMS * incoming);
+uint8_t DIA_flv1Param(COMPRES_PARAMS *incoming);
 #define REQUANT_AS_CODE
 #include "ADM_vidEncode.hxx"
 // Yv12
@@ -65,6 +66,45 @@
   0,				// NAQ
   0				// DUMMY 
 };
+FFcodecSetting ffmpeg4Extra_FLV1 = {
+  ME_EPZS,			//     ME
+  0,				//          GMC     
+  0,				// 4MV
+  0,				//           _QPEL;   
+  0,				//           _TREILLIS_QUANT
+  2,				//           qmin;
+  31,				//          qmax;
+  3,				//           max_qdiff;
+  0,				//           max_b_frames;
+  0,				//          mpeg_quant;
+  1,				//
+  -2,				//                 luma_elim_threshold;
+  1,				//
+  -5,				// chroma_elim_threshold;
+  0.05,				//lumi_masking;
+  1,				// is lumi
+  0.01,				//dark_masking; 
+  1,				// is dark
+  0.5,				// qcompress amount of qscale change between easy & hard scenes (0.0-1.0
+  0.5,				// qblur;    amount of qscale smoothing over time (0.0-1.0) 
+  0,				// min bitrate in kB/S
+  0,				// max bitrate
+  0,				// default matrix
+  100,				// no gop size
+  NULL,
+  NULL,
+  0,				// interlaced
+  0,				// WLA: bottom-field-first
+  0,				// wide screen
+  2,				// mb eval = distortion
+  8000,				// vratetol 8Meg
+  0,				// is temporal
+  0.0,				// temporal masking
+  0,				// is spatial
+  0.0,				// spatial masking
+  0,				// NAQ
+  0				// DUMMY 
+};
 
 COMPRES_PARAMS ffmpegH263Codec = {
   CodecH263,
@@ -135,16 +175,16 @@
   "FLV1 (lavc)",
   "FLV1",
   "FLV1",
-  COMPRESS_CQ,
+  COMPRESS_CBR,
   4,
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ ,
+  ADM_ENC_CAP_CBR,
   ADM_EXTRA_PARAM,
-  &ffmpeg4Extra,
+  &ffmpeg4Extra_FLV1,
   sizeof (ffmpeg4Extra),
-  NULL
+  &DIA_flv1Param
 };
 COMPRES_PARAMS ffmpegSnow = {
   CodecSnow,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encffmpeg.cpp	2007-08-28 15:32:58 UTC (rev 3565)
@@ -304,8 +304,9 @@
   _in = instream;
 
  
-  _codec = new ffmpegEncoderCQ (_w, _h, _id);
-  _codec->init (_param.qz, _fps, 0);
+  _codec = new ffmpegEncoderCBR (_w, _h, _id);
+  _codec->setConfig (&_settings);
+  _codec->init (_param.bitrate, _fps, 0);
   _state=enc_CQ;
   return 1;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2007-08-28 15:32:58 UTC (rev 3565)
@@ -453,6 +453,7 @@
          //**********************************************************
 
       bitstream.data=_outbuffer;
+      bitstream.bufferSize=_page;
       for(uint32_t i=0;i<total;i++)
       {
        	// get frame

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-08-28 15:32:58 UTC (rev 3565)
@@ -10,7 +10,7 @@
 DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       GUI_sdlRender.cpp
 DIA_builtin.cpp       DIA_flyChromaShift.cpp  DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     GUI_xvRender.cpp
 DIA_animated.cpp      DIA_ocr.cpp DIA_tsSub.cpp
-DIA_flyEq2.cpp
+DIA_flyEq2.cpp          DIA_flv1.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_userInterfaces)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp (from rev 3561, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp	2007-08-25 22:48:09 UTC (rev 3561)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp	2007-08-28 15:32:58 UTC (rev 3565)
@@ -0,0 +1,56 @@
+/*
+    Simplified dialog for FLV1 codec
+    Only bitrate and gop size
+
+
+*/
+#include <config.h>
+
+#include <stdio.h>
+#include <stdlib.h>
+
+
+#include "ADM_lavcodec.h"
+
+#include "default.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_codecs/ADM_ffmpegConfig.h"
+#include "DIA_factory.h"
+#include "ADM_assert.h" 
+
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_assert.h" 
+#include "DIA_factory.h"
+#include "../../ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
+
+/**
+      \fn DIA_DVDffParam
+      \brief Dialog to set encoding options for SVCD/DVD lavcodec based
+*/
+//____________________________________________
+
+uint8_t DIA_flv1Param(COMPRES_PARAMS *incoming)
+{
+	
+
+	int ret;
+	FFcodecSetting *conf=(FFcodecSetting *)incoming->extraSettings;
+	ADM_assert(incoming->extraSettingsLen==sizeof(FFcodecSetting));
+
+                      
+         diaElemUInteger  bitrate(&(incoming->bitrate),_("_Bitrate (kb/s):"),100,9000);
+         diaElemUInteger  gop(&(conf->gop_size),_("_GOP size:"),1,250);
+
+         diaElem *elems[2]={&bitrate,&gop};
+    
+  if( diaFactoryRun("FLV1 Configuration",2,elems))
+  {
+    return 1;
+  }
+  return 0;
+}	
+// EOF
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-08-26 12:29:26 UTC (rev 3564)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-08-28 15:32:58 UTC (rev 3565)
@@ -14,7 +14,8 @@
 DIA_animated.cpp \
 DIA_ocr.cpp \
 DIA_tsSub.cpp \
-DIA_flyEq2.cpp
+DIA_flyEq2.cpp \
+DIA_flv1.cpp
 
 commonObjs:=$(subst .cpp,.o,$(libADM_CommonUI_a_SOURCES))
 



From mean at mail.berlios.de  Wed Aug 29 09:55:08 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 29 Aug 2007 09:55:08 +0200
Subject: [Avidemux-svn-commit] r3566 - in
	branches/avidemux_2.4_branch/avidemux: ADM_encoder
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
Message-ID: <200708290755.l7T7t8oj005039@sheep.berlios.de>

Author: mean
Date: 2007-08-29 09:55:07 +0200 (Wed, 29 Aug 2007)
New Revision: 3566

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp
Log:
[DialogFactory] Take into account capabilities of codec, remove CBR mode for lavc mpeg1/2 (does not work)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-28 15:32:58 UTC (rev 3565)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_encCodecDesc.h	2007-08-29 07:55:07 UTC (rev 3566)
@@ -148,7 +148,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
+  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
   ADM_EXTRA_PARAM,
   &ffmpeg4Extra,
   sizeof (ffmpeg4Extra),
@@ -164,7 +164,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
+  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ,
   ADM_EXTRA_PARAM,
   &ffmpeg4Extra,
   sizeof (ffmpeg4Extra),
@@ -319,7 +319,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
+  ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
   ADM_EXTRA_PARAM,
   &ffmpeg1Extra,
   sizeof (ffmpeg1Extra),
@@ -379,7 +379,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
+  ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
   ADM_EXTRA_PARAM,
   &ffmpeg2DVDExtra,
   sizeof (ffmpeg2DVDExtra),
@@ -498,7 +498,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
+  ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
   ADM_EXTRA_PARAM,
   &SVCDExtra,
   sizeof (SVCDExtra),
@@ -626,7 +626,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS +ADM_ENC_CAP_2PASS_BR,
+  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS +ADM_ENC_CAP_2PASS_BR+ADM_ENC_CAP_SAME,
   ADM_EXTRA_PARAM,
   &xvid4Extra,
   sizeof (xvid4Extra),
@@ -767,7 +767,7 @@
   1500,
   700,
   1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS + ADM_ENC_CAP_GLOBAL+ADM_ENC_CAP_2PASS_BR,
+  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS + ADM_ENC_CAP_GLOBAL+ADM_ENC_CAP_2PASS_BR+ADM_ENC_CAP_AQ,
   ADM_EXTRA_PARAM,
   &x264Extra,
   sizeof (x264Extra),

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx	2007-08-28 15:32:58 UTC (rev 3565)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/ADM_vidEncode.hxx	2007-08-29 07:55:07 UTC (rev 3566)
@@ -55,14 +55,17 @@
   COMPRESS_2PASS,
   COMPRESS_SAME,
   COMPRESS_2PASS_BITRATE,
-  COMPRESS_AQ
+  COMPRESS_AQ,
+  COMPRESS_MAX
 } COMPRESSION_MODE;
 
-#define ADM_ENC_CAP_CBR    0x001
-#define ADM_ENC_CAP_CQ     0x002
-#define ADM_ENC_CAP_2PASS  0x004
-#define ADM_ENC_CAP_GLOBAL 0x008
-#define ADM_ENC_CAP_2PASS_BR  0x010
+#define ADM_ENC_CAP_CBR    		0x001
+#define ADM_ENC_CAP_CQ     		0x002
+#define ADM_ENC_CAP_AQ     		0x080
+#define ADM_ENC_CAP_2PASS  		0x004
+#define ADM_ENC_CAP_GLOBAL 		0x008
+#define ADM_ENC_CAP_2PASS_BR  	0x010
+#define ADM_ENC_CAP_SAME  		0x020
 
 #define ADM_EXTRA_PARAM_JS 0x100
 #define ADM_EXTRA_PARAM    0x200

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-28 15:32:58 UTC (rev 3565)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-29 07:55:07 UTC (rev 3566)
@@ -28,8 +28,34 @@
 #include "ADM_assert.h"
 
 static void cb_mod(void *w,void *p);
+/**
+ * 	\fn 	readPullDown
+ * \brief 	Convert the raw read of the combox into the actual compression mode
+ */
+static COMPRESSION_MODE readPulldown(COMPRES_PARAMS *copy,int rank)
+{
+	int index=0;
+	COMPRESSION_MODE mode=COMPRESS_MAX;
+	
+#undef LOOKUP
+#define LOOKUP(A,B) \
+  if(copy->capabilities & ADM_ENC_CAP_##A) \
+  { \
+	  if(rank==index) mode=COMPRESS_##B; \
+	  index++; \
+  } 
+  
+  LOOKUP(CBR,CBR);
+  LOOKUP(CQ,CQ);
+  LOOKUP(SAME,SAME);
+  LOOKUP(AQ,AQ);
+  LOOKUP(2PASS,2PASS);
+  LOOKUP(2PASS_BR,2PASS_BITRATE);
+  
+	ADM_assert(mode!=COMPRESS_MAX);
+	return mode;
+}
 
-
  diaElemBitrate::diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_BITRATE)
 {
@@ -93,11 +119,24 @@
   gtk_widget_show (combo);
   
   gtk_label_set_mnemonic_widget (GTK_LABEL(label1), combo);
-  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - bitrate"));
-  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - constant quality"));
-  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Two pass - video size"));
-  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Two pass - average bitrate"));
+  if((copy.capabilities & ADM_ENC_CAP_CBR)) 
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - bitrate"));
+  if((copy.capabilities & ADM_ENC_CAP_CQ))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - constant quality"));
+  if((copy.capabilities & ADM_ENC_CAP_SAME))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - same qz as input"));
+  if((copy.capabilities & ADM_ENC_CAP_AQ))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Single pass - Average quantizer"));
+
+  if((copy.capabilities & ADM_ENC_CAP_2PASS))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Two pass - video size"));
+  if((copy.capabilities & ADM_ENC_CAP_2PASS_BR))
+	  gtk_combo_box_append_text (GTK_COMBO_BOX (combo),_("Two pass - average bitrate"));
   
+  /**/
+  
+   
+  
   PUT_ARRAY(1,0,combo);
   
   
@@ -124,20 +163,27 @@
   w[2]=combo;
   w[3]=spin;
   myWidget=(void *)w;
-  int i=0;
-  switch(copy.mode)
-  {
-    case  COMPRESS_CQ: i=1;break;
-    case  COMPRESS_CBR:i=0;break;
-    case  COMPRESS_2PASS:i=2;break;
-    case  COMPRESS_SAME:i=4;break;
-    case  COMPRESS_2PASS_BITRATE:i=3;break;
-    default: ADM_assert(0);
-  }
-  gtk_combo_box_set_active(GTK_COMBO_BOX(combo),i);
+  
+  int index=0,set=-1;
+#undef LOOKUP
+#define LOOKUP(A,B) \
+  if(copy.capabilities & ADM_ENC_CAP_##A) \
+  { \
+	  if(copy.mode==COMPRESS_##B) set=index; \
+	  index++; \
+  } \
+  
+  LOOKUP(CBR,CBR);
+  LOOKUP(CQ,CQ);
+  LOOKUP(SAME,SAME);
+  LOOKUP(AQ,AQ);
+  LOOKUP(2PASS,2PASS);
+  LOOKUP(2PASS_BR,2PASS_BITRATE);
+  if(set!=-1) gtk_combo_box_set_active(GTK_COMBO_BOX(combo),set);
 }
 
 
+
 void diaElemBitrate::getMe(void)
 {
   
@@ -147,40 +193,51 @@
   GtkComboBox *combo=(GtkComboBox *)w[2];
   GtkSpinButton *spin=(GtkSpinButton*)w[3];
   GtkLabel *label=(GtkLabel*)w[1];
+
   int rank=gtk_combo_box_get_active(GTK_COMBO_BOX(combo));
+  COMPRESSION_MODE mode=readPulldown(&copy,rank);
+    
+  
 #undef P
 #undef M
 #undef S
 #define P(x) 
 #define M(x,y)
 #define S(x)   x=(uint32_t)gtk_spin_button_get_value  (GTK_SPIN_BUTTON(spin))
-  switch(rank)
+  switch(mode)
   {
-    case 0: //CBR
+    case COMPRESS_CBR: //CBR
           P(_Bitrate (kb/s):);
           M(0,20000);
           S(copy.bitrate);
           copy.mode=COMPRESS_CBR;
-          break; 
-    case 1:// CQ
+          break;
+    case COMPRESS_AQ:// CQ
           P(_Quantizer:);
           M(2,31);
           S(copy.qz);
+          copy.mode=COMPRESS_AQ;
+          break;
+
+    case COMPRESS_CQ:// CQ
+          P(_Quantizer:);
+          M(2,31);
+          S(copy.qz);
           copy.mode=COMPRESS_CQ;
           break;
-    case 2 : // 2pass Filesize
+    case  COMPRESS_2PASS: // 2pass Filesize
           P(_Video size (MB):);
           M(1,8000);
           S(copy.finalsize);
           copy.mode=COMPRESS_2PASS;
           break;
-    case 3 : // 2pass Avg
+    case COMPRESS_2PASS_BITRATE : // 2pass Avg
           P(_Average bitrate (kb/s):);
           M(0,20000);
           S(copy.avg_bitrate);
           copy.mode=COMPRESS_2PASS_BITRATE;
           break;
-    case 4 : // Same Qz as input
+    case COMPRESS_SAME : // Same Qz as input
           P(-);
           M(0,0);
           copy.mode=COMPRESS_SAME;
@@ -197,35 +254,42 @@
   GtkSpinButton *spin=(GtkSpinButton*)w[3];
   GtkLabel *label=(GtkLabel*)w[1];
   int rank=gtk_combo_box_get_active(GTK_COMBO_BOX(combo));
+  COMPRESSION_MODE mode=readPulldown(&copy,rank);
+  
 //#undef P
 #undef M
 #undef S
 //#define P(x) gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_(#x));
 #define M(x,y) gtk_spin_button_set_range  (GTK_SPIN_BUTTON(spin),x,y)
 #define S(x)   gtk_spin_button_set_value  (GTK_SPIN_BUTTON(spin),x)
-  switch(rank)
+  switch(mode)
   {
-    case 0: //CBR
+    case COMPRESS_CBR: //CBR
           gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("_Bitrate (kb/s):"));
           M(0,20000);
           S(copy.bitrate);
           break; 
-    case 1:// CQ
+    case COMPRESS_CQ:// CQ
           gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("_Quantizer:"));
           M(2,maxQ);
           S(copy.qz);
           break;
-    case 2 : // 2pass Filesize
+    case COMPRESS_AQ:// CQ
+              gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("A_vg Quantizer:"));
+              M(2,64);
+              S(copy.qz);
+              break;
+    case COMPRESS_2PASS : // 2pass Filesize
           gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("_Video size (MB):"));
           M(1,8000);
           S(copy.finalsize);
           break;
-    case 3 : // 2pass Avg
+    case COMPRESS_2PASS_BITRATE : // 2pass Avg
           gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("_Average bitrate (kb/s):"));
           M(0,20000);
           S(copy.avg_bitrate);
           break;
-    case 4 : // Same Qz as input
+    case COMPRESS_SAME : // Same Qz as input
           gtk_label_set_text_with_mnemonic(GTK_LABEL(label),_("-"));
           M(0,0);
           break;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp	2007-08-28 15:32:58 UTC (rev 3565)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp	2007-08-29 07:55:07 UTC (rev 3566)
@@ -55,16 +55,19 @@
           
            compress=p;
            combo=new QComboBox(z);
+           
            maxQ=mq;
-#define add(x) combo->addItem(_(#x))
+           int index=0,set=-1;
+#define add(x,z,y) if(compress->capabilities & ADM_ENC_CAP_##x) {combo->addItem(_(#y));\
+						if(p->mode==COMPRESS_##z) set=index;\
+						index++;}
   
-  add(Constant Bitrate);
-  add(Constant Quality);
-  add(Two pass-filesize);
-  add(Two pass-Avg bitrate);
-  add(Same Quantizer as input);
-  // FIXME UGLY!
-  if(maxQ==51) add(Average Quantizer);
+  add(CBR,CBR,Constant Bitrate);
+  add(CQ,CQ,Constant Quality);
+  add(SAME,SAME,Same Quantizer as input);
+  add(AQ,AQ,Average Quantizer);
+  add(2PASS,2PASS,Two pass-filesize);
+  add(2PASS_BR,2PASS_BITRATE,Two pass-Avg bitrate);
   
            combo->show();
            
@@ -84,19 +87,13 @@
           
           layout->addWidget(text2,line+1,0);
           layout->addWidget(box,line+1,1);
-          int i;
-          switch(compress-> mode)
+       
+       
+          if(set!=-1) 
           {
-            case  COMPRESS_CQ: i=1;break;
-            case  COMPRESS_CBR:i=0;break;
-            case  COMPRESS_2PASS:i=2;break;
-            case  COMPRESS_SAME:i=4;break;
-            case  COMPRESS_AQ:i=5;break;
-            case  COMPRESS_2PASS_BITRATE:i=3;break;
-            default: ADM_assert(0);
+        	  	combo->setCurrentIndex(set);
+        	  	comboChanged(set);
           }
-          combo->setCurrentIndex(i);
-          comboChanged(i);        
           QObject::connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
           
           
@@ -104,18 +101,48 @@
         virtual ~ADM_Qbitrate() ;
         void readBack(void);
 };
+
+/**
+ * 	\fn 	readPullDown
+ * \brief 	Convert the raw read of the combox into the actual compression mode
+ */
+static COMPRESSION_MODE readPulldown(COMPRES_PARAMS *copy,int rank)
+{
+	int index=0;
+	COMPRESSION_MODE mode=COMPRESS_MAX;
+	
+#undef LOOKUP
+#define LOOKUP(A,B) \
+  if(copy->capabilities & ADM_ENC_CAP_##A) \
+  { \
+	  if(rank==index) mode=COMPRESS_##B; \
+	  index++; \
+  } 
+  
+  LOOKUP(CBR,CBR);
+  LOOKUP(CQ,CQ);
+  LOOKUP(SAME,SAME);
+  LOOKUP(AQ,AQ);
+  LOOKUP(2PASS,2PASS);
+  LOOKUP(2PASS_BR,2PASS_BITRATE);
+  
+	ADM_assert(mode!=COMPRESS_MAX);
+	return mode;
+}
+
 void ADM_Qbitrate::readBack(void)
 {
 #define Mx(x) compress->mode=x
 #define Vx(x) compress->x=box->value();
-  switch(combo->currentIndex())
+	COMPRESSION_MODE mode=readPulldown(compress,combo->currentIndex());
+  switch(mode)
   {
-    case 0: Mx(COMPRESS_CBR);Vx(bitrate);break;
-    case 1: Mx(COMPRESS_CQ);Vx(qz);break;
-    case 2: Mx(COMPRESS_2PASS);Vx(finalsize);break;
-    case 3: Mx(COMPRESS_2PASS_BITRATE);Vx(bitrate);break;
-    case 4: Mx(COMPRESS_SAME);break;
-    case 5: Mx(COMPRESS_AQ);break;
+    case COMPRESS_CBR: Mx(COMPRESS_CBR);Vx(bitrate);break;
+    case COMPRESS_CQ: Mx(COMPRESS_CQ);Vx(qz);break;
+    case COMPRESS_2PASS: Mx(COMPRESS_2PASS);Vx(finalsize);break;
+    case COMPRESS_2PASS_BITRATE: Mx(COMPRESS_2PASS_BITRATE);Vx(avg_bitrate);break;
+    case COMPRESS_SAME: Mx(COMPRESS_SAME);break;
+    case COMPRESS_AQ: Mx(COMPRESS_AQ);break;
     default :
           ADM_assert(0);
   }
@@ -123,36 +150,37 @@
 void ADM_Qbitrate::comboChanged(int i)
 {
   printf("Changed\n"); 
-  #define P(x) text2->setText(_(#x))
+ #define P(x) text2->setText(_(#x))
 #define M(x,y) box->setMinimum  (x);box->setMaximum  (y);
 #define S(x)   box->setValue(x);
-  switch(i)
+  COMPRESSION_MODE mode=readPulldown(compress,i);
+    switch(mode)
   {
-    case 0: //CBR
+    case COMPRESS_CBR: //CBR
           P(Bitrate (kb/s));
           M(0,20000);
           S(compress->bitrate);
           break; 
-    case 1:// CQ
+    case COMPRESS_CQ:// CQ
           P(Quantizer);
           M(2,maxQ);
           S(compress->qz);
           break;
-    case 2 : // 2pass Filesize
+    case COMPRESS_2PASS : // 2pass Filesize
           P(FileSize (MB));
           M(1,8000);
           S(compress->finalsize);
           break;
-    case 3 : // 2pass Avg
+    case COMPRESS_2PASS_BITRATE : // 2pass Avg
           P(Average Br (kb/s));
           M(0,20000);
           S(compress->avg_bitrate);
           break;
-    case 4 : // Same Qz as input
+    case COMPRESS_SAME : // Same Qz as input
           P(-);
           M(0,0);
           break;
-    case 5 : // AQ
+    case COMPRESS_AQ : // AQ
           P(Quantizer);
           M(2,maxQ);
           S(compress->qz);



From mean at mail.berlios.de  Wed Aug 29 19:49:57 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 29 Aug 2007 19:49:57 +0200
Subject: [Avidemux-svn-commit] r3567 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_commonUI
	ADM_videoFilter
Message-ID: <200708291749.l7THnvMW005231@sheep.berlios.de>

Author: mean
Date: 2007-08-29 19:49:57 +0200 (Wed, 29 Aug 2007)
New Revision: 3567

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_print.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidTdeint.cpp
Log:
[TDeint] Print some infos

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_print.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_print.cpp	2007-08-29 07:55:07 UTC (rev 3566)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_print.cpp	2007-08-29 17:49:57 UTC (rev 3567)
@@ -54,12 +54,53 @@
 		}
 	}
 }
+static void drawDigitSmall(ADMImage *dst, int x, int y, int num) 
+{
 
+	x = x * 6;
+	y = y * 20;
 
+	int pitch = dst->_width;
+	for (int tx = 0; tx < 10; tx++) {
+		for (int ty = 0; ty < 20; ty++) 
+		{
+			unsigned char *dp = YPLANE(dst);
+
+			dp+=(y+ty)*pitch+(x+tx)*2;
+
+			if (font[num][ty] & (1 << (15 - tx))) 
+			{
+				
+					dp[0] = 250;
+			} else 
+			{
+					dp[0] = (unsigned char) ((dp[0] * 3) >> 2);
+						
+			}
+		}
+	}
+}
+
+
 void drawString(ADMImage *dst, int x, int y, const char *s) 
 {
-	for (int xx = 0; *s; ++s, ++xx) {
-		drawDigit(dst, x + xx, y, *s - ' ');
+	int len=strlen(s);
+	if( ((x+len)*20)<dst->_width)
+	{
+		for (int xx = 0; *s; ++s, ++xx) 
+			{
+				if(*s==0x0d || *s==0x0a) continue;
+				drawDigit(dst, x + xx, y, *s - ' ');
+			}	
 	}
+	else
+	{
+		for (int xx = 0; *s; ++s, ++xx) 
+				{
+					if(*s==0x0d || *s==0x0a) continue;
+					drawDigitSmall(dst, x + xx, y, *s - ' ');
+				}	
+	}
+	
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp	2007-08-29 07:55:07 UTC (rev 3566)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp	2007-08-29 17:49:57 UTC (rev 3567)
@@ -109,15 +109,16 @@
       diaElemUInteger  intAreaCombing(PX(cthresh),_("Area com_bing threshold:"),0,255);
       diaElemUInteger  intCombed(PX(MI),_("Combe_d threshold:"),0,255);
       diaElemInteger   intArtefact(PX(AP),_("Artefact _protection threshold:"),-1,255);
+      diaElemToggle    intDebug(PX(debug),_("Debug:"));
 
          diaElem *diaRC[]={&menuFieldOrder,&menuInterpolaye,&menuType,&menuMnt,&menuLink,&menuAP,
                             &toggleUseChroma,&toggleTryWeave,&toggleDenoise,&toggleSharp,&toggleEvaluteAll,
-                            &intMotionLuma,&intMotionChroma,&intAreaCombing,&intCombed,&intArtefact
+                            &intMotionLuma,&intMotionChroma,&intAreaCombing,&intCombed,&intArtefact,&intDebug
                   };
 
         
          
-        if( diaFactoryRun(_("TDeint"),16,diaRC))
+        if( diaFactoryRun(_("TDeint"),17,diaRC))
 	{
            param->order=(int)order-1;
            param->field=(int)field-1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidTdeint.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidTdeint.cpp	2007-08-29 07:55:07 UTC (rev 3566)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidTdeint.cpp	2007-08-29 17:49:57 UTC (rev 3567)
@@ -61,8 +61,10 @@
 #define MIN(a,b) a<b ? a : b
 #define MAX(a,b) b<a ? a : b
 #define child_GetParity(x) 0 //FIXME!!
-#define OutputDebugString printf
 
+#define OutputDebugString(img,y,text) drawString(img, 0, y, text)
+
+
 #include "ADM_vidTDeint_param.h"
 #define PRM(x) x
 class vidTDeint:public AVDMGenericVideoStream
@@ -367,6 +369,7 @@
         mthreshLS = mthreshL; 
         mthreshCS = mthreshC;
         typeS = type;
+#if 0
         if (debug)
         {
                 sprintf(buf,"TDeint:  %s (%s) by tritical\n", "B4", "08 2005");
@@ -375,6 +378,7 @@
                                 mode == 1 ? "bob - double rate" : mode == -2 ? "upsize - ELA" : "upsize - ELA-2");
                 OutputDebugString(buf);
         }
+#endif
 }
 //____________________________________________________________________
 vidTDeint::~vidTDeint ()
@@ -511,8 +515,8 @@
 				{
 					if (debug)
 					{
-						sprintf(buf,"TDeint:  frame %d:  not deinterlacing\n", n);
-						OutputDebugString(buf);
+						sprintf(buf,"TD fr %d:  not deinterlacing\n", n);
+						OutputDebugString(data,0,buf);
 					}
 					data->duplicate(src);
 					vidCache->unlockAll();
@@ -531,8 +535,8 @@
 		{
 			if (debug)
 			{
-				sprintf(buf,"TDeint:  frame %d:  not deinterlacing\n", n);
-				OutputDebugString(buf);
+				sprintf(buf,"TD fr %d:  not deinterlacing\n", n);
+				OutputDebugString(data,0,buf);
 			}
 			data->duplicate(src);
 			vidCache->unlockAll();
@@ -544,8 +548,8 @@
 	{
 		if (debug)
 		{
-			sprintf(buf,"TDeint:  frame %d:  not deinterlacing (HINTS)\n", n);
-			OutputDebugString(buf);
+			sprintf(buf,"TD fr %d:  not deinterlacing (HINTS)\n", n);
+			OutputDebugString(data,0,buf);
 		}
 		data->duplicate(src);
 			vidCache->unlockAll();
@@ -558,8 +562,8 @@
 		{
 			if (debug)
 			{
-				sprintf(buf,"TDeint:  frame %d:  not deinterlacing (full = false)\n", n);
-				OutputDebugString(buf);
+				sprintf(buf,"TD fr %d:  not deinterlacing (full = false)\n", n);
+				OutputDebugString(data,0,buf);
 			}
 			data->duplicate(src);
 			vidCache->unlockAll();
@@ -588,8 +592,10 @@
 		subtractFieldsYV12(prv, src, nxt);
 		if (debug)
 		{
-			sprintf(buf, "TDeint:  frame %d:  accumP = %u  accumN = %u\n", n, accumP, accumN);
-			OutputDebugString(buf);
+			sprintf(buf, "TD fr %d:  accumP = %u  ", n, accumP);
+			OutputDebugString(data,2,buf);
+			sprintf(buf, "accumN = %u\n", accumN);
+			OutputDebugString(data,3,buf);
 		}
 	}
 	if (tryWeave && (mode != 0 || full || found || (field^PRM(order) && accumP > accumN) || 
@@ -600,10 +606,10 @@
 		{
 			if (debug)
 			{
-				sprintf(buf,"TDeint:  frame %d:  weaved with %s (tryWeave)\n", n, 
+				sprintf(buf,"TD  fr %d:  weaved with %s (tryWeave)\n", n, 
 					field^PRM(order) ? (accumP <= accumN ? "CURR" : "NEXT") : 
 					(accumN <= accumP ? "CURR" : "PREV"));
-				OutputDebugString(buf);
+				OutputDebugString(data,2,buf);
 			}
 			if (hintField >= 0 && !fieldOVR) field = hintField;
 			vidCache->unlockAll();
@@ -631,12 +637,13 @@
 	if (!(passHint&0xFFFFFF00)) vidTDeint::putHint(dst, passHint, field);
 	if (debug)
 	{
-		sprintf(buf,"TDeint:  frame %d:  field = %s  order = %s\n", n, 
+		sprintf(buf,"TD  fr %d:  field = %s  order = %s\n", n, 
 			field == 1 ? "bottom" : "top", PRM(order) == 1 ? "tff" : "bff");
-		OutputDebugString(buf);
-		sprintf(buf,"TDeint:  frame %d:  mthreshL = %d  mthreshC = %d  type = %d\n", n, 
-			mthreshL, mthreshC, type);
-		OutputDebugString(buf);
+		OutputDebugString(data,3,buf);
+		sprintf(buf,"TD  fr %d:  mthreshL = %d  \n",n,mthreshL);
+		OutputDebugString(data,4,buf);
+		sprintf(buf,"mthreshC = %d  type = %d\n", mthreshC, type);
+		OutputDebugString(data,5,buf);
 	}
 	if (hintField >= 0 && !fieldOVR) field = hintField;
 	vidCache->unlockAll();



From gruntster at mail.berlios.de  Wed Aug 29 21:45:27 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Aug 2007 21:45:27 +0200
Subject: [Avidemux-svn-commit] r3568 - in branches/avidemux_2.4_branch: .
	avidemux avidemux/ADM_libraries
	avidemux/ADM_libraries/ADM_nvwa avidemux/ADM_osSupport
Message-ID: <200708291945.l7TJjRwX011965@sheep.berlios.de>

Author: gruntster
Date: 2007-08-29 21:45:10 +0200 (Wed, 29 Aug 2007)
New Revision: 3568

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/fast_mutex.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/static_assert.h
Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memsupport.cpp
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
   branches/avidemux_2.4_branch/config.h.cmake
Log:
[Debug] Nvwa memory leak detector, enabled only in debug mode and with FIND_LEAKS defined

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-08-29 19:45:10 UTC (rev 3568)
@@ -445,6 +445,7 @@
 
 if(CMAKE_BUILD_TYPE STREQUAL "Debug")
 MESSAGE(STATUS "** DEBUG BUILD (${CMAKE_BUILD_TYPE})**")
+SET(ADM_DEBUG 1)
 add_definitions(-DADM_DEBUG)
 else (CMAKE_BUILD_TYPE STREQUAL "Debug")
 MESSAGE(STATUS "** RELEASE BUILD (${CMAKE_BUILD_TYPE})**")

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt	2007-08-29 19:45:10 UTC (rev 3568)
@@ -0,0 +1,14 @@
+################################
+#
+################################
+include(AdmLib)
+SET(ADM_LIB ADM_nvwa)
+#
+SET(${ADM_LIB}_SRCS 
+debug_new.cpp
+)
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
+ADD_DEFINITIONS(-D_DEBUG_NEW_ERROR_ACTION=NULL -D_DEBUG_NEW_ALIGNMENT=32)
+
+################################

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.cpp	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.cpp	2007-08-29 19:45:10 UTC (rev 3568)
@@ -0,0 +1,730 @@
+// -*- Mode: C++; tab-width: 4; c-basic-offset: 4; indent-tabs-mode: nil -*-
+// vim:tabstop=4:shiftwidth=4:expandtab:
+
+/*
+ * Copyright (C) 2004-2005 Wu Yongwei <adah at users dot sourceforge dot net>
+ *
+ * This software is provided 'as-is', without any express or implied
+ * warranty.  In no event will the authors be held liable for any
+ * damages arising from the use of this software.
+ *
+ * Permission is granted to anyone to use this software for any purpose,
+ * including commercial applications, and to alter it and redistribute
+ * it freely, subject to the following restrictions:
+ *
+ * 1. The origin of this software must not be misrepresented; you must
+ *    not claim that you wrote the original software. If you use this
+ *    software in a product, an acknowledgment in the product
+ *    documentation would be appreciated but is not required.
+ * 2. Altered source versions must be plainly marked as such, and must
+ *    not be misrepresented as being the original software.
+ * 3. This notice may not be removed or altered from any source
+ *    distribution.
+ *
+ * This file is part of Stones of Nvwa:
+ *      http://sourceforge.net/projects/nvwa
+ *
+ */
+
+/**
+ * @file    debug_new.cpp
+ *
+ * Implementation of debug versions of new and delete to check leakage.
+ *
+ * @version 3.16, 2005/11/22
+ * @author  Wu Yongwei
+ *
+ */
+
+#include <new>
+#include <assert.h>
+#include <limits.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#ifdef __unix__
+#include <alloca.h>
+#endif
+#ifdef _WIN32
+#include <malloc.h>
+#endif
+#include "fast_mutex.h"
+#include "static_assert.h"
+
+// GRUNTSTER
+static void* _malloc(size_t size);
+static void _free(void *ptr);
+
+#if !_FAST_MUTEX_CHECK_INITIALIZATION && !defined(_NOTHREADS)
+#error "_FAST_MUTEX_CHECK_INITIALIZATION not set: check_leaks may not work"
+#endif
+
+/**
+ * @def _DEBUG_NEW_ALIGNMENT
+ *
+ * The alignment requirement of allocated memory blocks.  It must be a
+ * power of two.
+ */
+#ifndef _DEBUG_NEW_ALIGNMENT
+#define _DEBUG_NEW_ALIGNMENT 16
+#endif
+
+/**
+ * @def _DEBUG_NEW_CALLER_ADDRESS
+ *
+ * The expression to return the caller address.  #print_position will
+ * later on use this address to print the position information of memory
+ * operation points.
+ */
+#ifndef _DEBUG_NEW_CALLER_ADDRESS
+#ifdef __GNUC__
+#define _DEBUG_NEW_CALLER_ADDRESS __builtin_return_address(0)
+#else
+#define _DEBUG_NEW_CALLER_ADDRESS NULL
+#endif
+#endif
+
+/**
+ * @def _DEBUG_NEW_ERROR_ACTION
+ *
+ * The action to take when an error occurs.  The default behaviour is to
+ * call \e abort, unless \c _DEBUG_NEW_ERROR_CRASH is defined, in which
+ * case a segmentation fault will be triggered instead (which can be
+ * useful on platforms like Windows that do not generate a core dump
+ * when \e abort is called).
+ */
+#ifndef _DEBUG_NEW_ERROR_ACTION
+#ifndef _DEBUG_NEW_ERROR_CRASH
+#define _DEBUG_NEW_ERROR_ACTION NULL //abort()
+#else
+#define _DEBUG_NEW_ERROR_ACTION do { *((char*)0) = 0; abort(); } while (0)
+#endif
+#endif
+
+/**
+ * @def _DEBUG_NEW_FILENAME_LEN
+ *
+ * The length of file name stored if greater than zero.  If it is zero,
+ * only a const char pointer will be stored.  Currently the default
+ * behaviour is to copy the file name, because I found that the exit
+ * leakage check cannot access the address of the file name sometimes
+ * (in my case, a core dump will occur when trying to access the file
+ * name in a shared library after a \c SIGINT).  If the default value is
+ * too small for you, try defining it to \c 52, which makes the size of
+ * new_ptr_list_t 64 (it is 32 by default) on 32-bit platforms.
+ */
+#ifndef _DEBUG_NEW_FILENAME_LEN
+#define _DEBUG_NEW_FILENAME_LEN 20
+#endif
+
+/**
+ * @def _DEBUG_NEW_HASHTABLESIZE
+ *
+ * The size of the hash bucket for the table to store pointers to
+ * allocated memory.  To ensure good performance, always make it a power
+ * of two.
+ */
+#ifndef _DEBUG_NEW_HASHTABLESIZE
+#define _DEBUG_NEW_HASHTABLESIZE 16384
+#endif
+
+/**
+ * @def _DEBUG_NEW_HASH
+ *
+ * The hash function for the pointers.  This one has good performance in
+ * test for me.
+ */
+#ifndef _DEBUG_NEW_HASH
+#define _DEBUG_NEW_HASH(p) (((size_t)(p) >> 8) % _DEBUG_NEW_HASHTABLESIZE)
+#endif
+
+/**
+ * @def _DEBUG_NEW_PROGNAME
+ *
+ * The program (executable) name to be set at compile time.  It is
+ * better to assign the full program path to #new_progname in \e main
+ * (at run time) than to use this (compile-time) macro, but this macro
+ * serves well as a quick hack.  Note also that double quotation marks
+ * need to be used around the program name, i.e., one should specify a
+ * command-line option like <code>-D_DEBUG_NEW_PROGNAME=\"a.out\"</code>
+ * in \e bash, or <code>-D_DEBUG_NEW_PROGNAME=\"a.exe\"</code> in the
+ * Windows command prompt.
+ */
+#ifndef _DEBUG_NEW_PROGNAME
+#define _DEBUG_NEW_PROGNAME NULL
+#endif
+
+/**
+ * @def _DEBUG_NEW_USE_ADDR2LINE
+ *
+ * Whether to use \e addr2line to convert a caller address to file/line
+ * information.  Defining it to a non-zero value will enable the
+ * conversion (automatically done if GCC is detected).  Defining it to
+ * zero will disable the conversion.
+ */
+#ifndef _DEBUG_NEW_USE_ADDR2LINE
+#ifdef __GNUC__
+#define _DEBUG_NEW_USE_ADDR2LINE 1
+#else
+#define _DEBUG_NEW_USE_ADDR2LINE 0
+#endif
+#endif
+
+#ifdef _MSC_VER
+#pragma warning(disable: 4073)  // #pragma init_seg(lib) used
+#pragma warning(disable: 4290)  // C++ exception specification ignored
+#pragma init_seg(lib)
+#endif
+
+#undef  _DEBUG_NEW_EMULATE_MALLOC
+#undef  _DEBUG_NEW_REDEFINE_NEW
+/**
+ * Macro to indicate whether redefinition of \c new is wanted.  Here it
+ * is defined to \c 0 to disable the redefinition of \c new.
+ */
+#define _DEBUG_NEW_REDEFINE_NEW 0
+#include "debug_new.h"
+
+/**
+ * Gets the aligned value of memory block size.
+ */
+#define align(s) \
+        (((s) + _DEBUG_NEW_ALIGNMENT - 1) & ~(_DEBUG_NEW_ALIGNMENT - 1))
+
+/**
+ * Structure to store the position information where \c new occurs.
+ */
+struct new_ptr_list_t
+{
+    new_ptr_list_t*     next;
+    union
+    {
+#if _DEBUG_NEW_FILENAME_LEN == 0
+    const char*         file;
+#else
+    char                file[_DEBUG_NEW_FILENAME_LEN];
+#endif
+    void*               addr;
+    };
+    int                 line;
+    size_t              size;
+};
+
+/**
+ * The extra memory allocated by <code>operator new</code>.
+ */
+const int aligned_list_item_size = align(sizeof(new_ptr_list_t));
+
+/**
+ * Array of pointer lists of a hash value.
+ */
+static new_ptr_list_t* new_ptr_list[_DEBUG_NEW_HASHTABLESIZE];
+
+/**
+ * Array of mutex guards to protect simultaneous access to the pointer
+ * lists of a hash value.
+ */
+static fast_mutex new_ptr_lock[_DEBUG_NEW_HASHTABLESIZE];
+
+/**
+ * The mutex guard to protect simultaneous output to #new_output_fp.
+ */
+static fast_mutex new_output_lock;
+
+/**
+ * Total memory allocated in bytes.
+ */
+static size_t total_mem_alloc = 0;
+
+/**
+ * Flag to control whether #check_leaks will be automatically called on
+ * program exit.
+ */
+bool new_autocheck_flag = true;
+
+/**
+ * Flag to control whether verbose messages are output.
+ */
+bool new_verbose_flag = false;
+
+/**
+ * Pointer to the output stream.  The default output is \e stderr, and
+ * one may change it to a user stream if needed (say, #new_verbose_flag
+ * is \c true and there are a lot of (de)allocations).
+ */
+FILE* new_output_fp = stderr;
+
+/**
+ * Pointer to the program name.  Its initial value is the macro
+ * #_DEBUG_NEW_PROGNAME.  You should try to assign the program path to
+ * it early in your application.  Assigning <code>argv[0]</code> to it
+ * in \e main is one way.  If you use \e bash or \e ksh (or similar),
+ * the following statement is probably what you want:
+ * `<code>new_progname = getenv("_");</code>'.
+ */
+const char* new_progname = _DEBUG_NEW_PROGNAME;
+
+#if _DEBUG_NEW_USE_ADDR2LINE
+/**
+ * Tries printing the position information from an instruction address.
+ * This is the version that uses \e addr2line.
+ *
+ * @param addr  the instruction address to convert and print
+ * @return      \c true if the address is converted successfully (and
+ *              the result is printed); \c false if no useful
+ *              information is got (and nothing is printed)
+ */
+static bool print_position_from_addr(const void* addr)
+{
+    static const void* last_addr = NULL;
+    static char last_info[256] = "";
+    if (addr == last_addr)
+    {
+        if (last_info[0] == '\0')
+            return false;
+        fprintf(new_output_fp, "%s", last_info);
+        return true;
+    }
+    if (new_progname)
+    {
+        const char addr2line_cmd[] = "addr2line -e ";
+#if   defined(__CYGWIN__) || defined(_WIN32)
+        const int  exeext_len = 4;
+#else
+        const int  exeext_len = 0;
+#endif
+#if  !defined(__CYGWIN__) && defined(__unix__)
+        const char ignore_err[] = " 2>/dev/null";
+#elif defined(__CYGWIN__) || \
+        (defined(_WIN32) && defined(WINVER) && WINVER >= 0x0500)
+        const char ignore_err[] = " 2>nul";
+#else
+        const char ignore_err[] = "";
+#endif
+        char* cmd = (char*)alloca(strlen(new_progname)
+                                  + exeext_len
+                                  + sizeof addr2line_cmd - 1
+                                  + sizeof ignore_err - 1
+                                  + sizeof(void*) * 2
+                                  + 4 /* SP + "0x" + null */);
+        strcpy(cmd, addr2line_cmd);
+        strcpy(cmd + sizeof addr2line_cmd - 1, new_progname);
+        size_t len = strlen(cmd);
+#if   defined(__CYGWIN__) || defined(_WIN32)
+        if (len <= 4
+                || (strcmp(cmd + len - 4, ".exe") != 0 &&
+                    strcmp(cmd + len - 4, ".EXE") != 0))
+        {
+            strcpy(cmd + len, ".exe");
+            len += 4;
+        }
+#endif
+        sprintf(cmd + len, " %p%s", addr, ignore_err);
+        FILE* fp = popen(cmd, "r");
+        if (fp)
+        {
+            char buffer[sizeof last_info] = "";
+            len = 0;
+            if (fgets(buffer, sizeof buffer, fp))
+            {
+                len = strlen(buffer);
+                if (buffer[len - 1] == '\n')
+                    buffer[--len] = '\0';
+            }
+            int res = pclose(fp);
+            // Display the file/line information only if the command
+            // is executed successfully and the output points to a
+            // valid position, but the result will be cached if only
+            // the command is executed successfully.
+            if (res == 0 && len > 0)
+            {
+                last_addr = addr;
+                if (buffer[len - 1] == '0' && buffer[len - 2] == ':')
+                    last_info[0] = '\0';
+                else
+                {
+                    fprintf(new_output_fp, "%s", buffer);
+                    strcpy(last_info, buffer);
+                    return true;
+                }
+            }
+        }
+    }
+    return false;
+}
+#else
+/**
+ * Tries printing the position information from an instruction address.
+ * This is the stub version that does nothing at all.
+ *
+ * @return      \c false always
+ */
+static bool print_position_from_addr(const void*)
+{
+    return false;
+}
+#endif // _DEBUG_NEW_USE_ADDR2LINE
+
+/**
+ * Prints the position information of a memory operation point.  When \c
+ * _DEBUG_NEW_USE_ADDR2LINE is defined to a non-zero value, this
+ * function will try to convert a given caller address to file/line
+ * information with \e addr2line.
+ *
+ * @param ptr   source file name if \e line is non-zero; caller address
+ *              otherwise
+ * @param line  source line number if non-zero; indication that \e ptr
+ *              is the caller address otherwise
+ */
+static void print_position(const void* ptr, int line)
+{
+    line &= ~INT_MIN;       // Result from new[] if highest bit set: Ignore
+    if (line != 0)          // Is file/line information present?
+    {
+        fprintf(new_output_fp, "%s:%d", (const char*)ptr, line);
+    }
+    else if (ptr != NULL)   // Is caller address present?
+    {
+        if (!print_position_from_addr(ptr)) // Fail to get source position?
+            fprintf(new_output_fp, "%p", ptr);
+    }
+    else                    // No information is present
+    {
+        fprintf(new_output_fp, "<Unknown>");
+    }
+}
+
+/**
+ * Searches for the raw pointer given a user pointer.  The term `raw
+ * pointer' here refers to the pointer to the pointer to originally
+ * <em>malloc</em>'d memory.
+ *
+ * @param pointer       user pointer to search for
+ * @param hash_index    hash index of the user pointer
+ * @return              the raw pointer if searching is successful; or
+ *                      \c NULL otherwise
+ */
+static new_ptr_list_t** search_pointer(void* pointer, size_t hash_index)
+{
+    new_ptr_list_t** raw_ptr = &new_ptr_list[hash_index];
+    while (*raw_ptr)
+    {
+        if ((char*)*raw_ptr + aligned_list_item_size == pointer)
+        {
+            return raw_ptr;
+        }
+        raw_ptr = &(*raw_ptr)->next;
+    }
+    return NULL;
+}
+
+/**
+ * Frees memory and adjusts pointers relating to a raw pointer.  If the
+ * highest bit of \c line (set from a previous <code>new[]</code> call)
+ * does not agree with \c array_mode, program will abort with an error
+ * message.
+ *
+ * @param raw_ptr       raw pointer to free
+ * @param addr          pointer to the caller
+ * @param array_mode    flag indicating whether it is invoked by a
+ *                      <code>delete[]</code> call
+ */
+static void free_pointer(new_ptr_list_t** raw_ptr, void* addr, bool array_mode)
+{
+    new_ptr_list_t* ptr = *raw_ptr;
+    int array_mode_mismatch = array_mode ^ ((ptr->line & INT_MIN) != 0);
+    if (array_mode_mismatch)
+    {
+        const char* msg;
+        if (array_mode)
+            msg = "delete[] after new";
+        else
+            msg = "delete after new[]";
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "%s: pointer %p (size %u)\n\tat ",
+                msg,
+                (char*)ptr + aligned_list_item_size,
+                ptr->size);
+        print_position(addr, 0);
+        fprintf(new_output_fp, "\n\toriginally allocated at ");
+        if ((ptr->line & ~INT_MIN) != 0)
+            print_position(ptr->file, ptr->line);
+        else
+            print_position(ptr->addr, ptr->line);
+        fprintf(new_output_fp, "\n");
+        fflush(new_output_fp);
+        _DEBUG_NEW_ERROR_ACTION;
+    }
+    total_mem_alloc -= ptr->size;
+    if (new_verbose_flag)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "delete: freeing  %p (size %u, %u bytes still allocated)\n",
+                (char*)ptr + aligned_list_item_size,
+                ptr->size, total_mem_alloc);
+    }
+    *raw_ptr = ptr->next;
+    _free(ptr);
+    return;
+}
+
+/**
+ * Checks for memory leaks.
+ *
+ * @return  zero if no leakage is found; the number of leaks otherwise
+ */
+int check_leaks()
+{
+    int leak_cnt = 0;
+    for (int i = 0; i < _DEBUG_NEW_HASHTABLESIZE; ++i)
+    {
+        fast_mutex_autolock lock(new_ptr_lock[i]);
+        new_ptr_list_t* ptr = new_ptr_list[i];
+        if (ptr == NULL)
+            continue;
+        while (ptr)
+        {
+            fast_mutex_autolock lock(new_output_lock);
+            fprintf(new_output_fp,
+                    "Leaked object at %p (size %u, ",
+                    (char*)ptr + aligned_list_item_size,
+                    ptr->size);
+            if ((ptr->line & ~INT_MIN) != 0)
+                print_position(ptr->file, ptr->line);
+            else
+                print_position(ptr->addr, ptr->line);
+            fprintf(new_output_fp, ")\n");
+            ptr = ptr->next;
+            ++leak_cnt;
+        }
+    }
+    return leak_cnt;
+}
+
+void* operator new(size_t size, const char* file, int line)
+{
+    assert((line & INT_MIN) == 0);
+    STATIC_ASSERT((_DEBUG_NEW_ALIGNMENT & (_DEBUG_NEW_ALIGNMENT - 1)) == 0,
+                  Alignment_must_be_power_of_two);
+    size_t s = size + aligned_list_item_size;
+    new_ptr_list_t* ptr = (new_ptr_list_t*)_malloc(s);
+    if (ptr == NULL)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "new:  out of memory when allocating %u bytes\n",
+                size);
+        fflush(new_output_fp);
+        _DEBUG_NEW_ERROR_ACTION;
+    }
+    void* pointer = (char*)ptr + aligned_list_item_size;
+    size_t hash_index = _DEBUG_NEW_HASH(pointer);
+#if _DEBUG_NEW_FILENAME_LEN == 0
+    ptr->file = file;
+#else
+    if (line)
+        strncpy(ptr->file, file, _DEBUG_NEW_FILENAME_LEN - 1)
+                [_DEBUG_NEW_FILENAME_LEN - 1] = '\0';
+    else
+        ptr->addr = (void*)file;
+#endif
+    ptr->line = line;
+    ptr->size = size;
+    {
+        fast_mutex_autolock lock(new_ptr_lock[hash_index]);
+        ptr->next = new_ptr_list[hash_index];
+        new_ptr_list[hash_index] = ptr;
+    }
+    if (new_verbose_flag)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "new:  allocated  %p (size %u, ",
+                pointer, size);
+        if (line != 0)
+            print_position(ptr->file, ptr->line);
+        else
+            print_position(ptr->addr, ptr->line);
+        fprintf(new_output_fp, ")\n");
+    }
+    total_mem_alloc += size;
+    return pointer;
+}
+
+void* operator new[](size_t size, const char* file, int line)
+{
+    void* pointer = operator new(size, file, line);
+    new_ptr_list_t* ptr =
+            (new_ptr_list_t*)((char*)pointer - aligned_list_item_size);
+    assert((ptr->line & INT_MIN) == 0);
+    ptr->line |= INT_MIN;   // Result from new[] if highest bit set: Set
+    return pointer;
+}
+
+void* operator new(size_t size) throw(std::bad_alloc)
+{
+    return operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+void* operator new[](size_t size) throw(std::bad_alloc)
+{
+    return operator new[](size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+#if !defined(__BORLANDC__) || __BORLANDC__ > 0x551
+void* operator new(size_t size, const std::nothrow_t&) throw()
+{
+    return operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+void* operator new[](size_t size, const std::nothrow_t&) throw()
+{
+    return operator new[](size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+#endif
+
+void operator delete(void* pointer) throw()
+{
+    if (pointer == NULL)
+        return;
+    size_t hash_index = _DEBUG_NEW_HASH(pointer);
+    fast_mutex_autolock lock(new_ptr_lock[hash_index]);
+    new_ptr_list_t** raw_ptr = search_pointer(pointer, hash_index);
+    if (raw_ptr == NULL)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp, "delete: invalid pointer %p at ", pointer);
+        print_position(_DEBUG_NEW_CALLER_ADDRESS, 0);
+        fprintf(new_output_fp, "\n");
+        fflush(new_output_fp);
+        _DEBUG_NEW_ERROR_ACTION;
+    }
+    free_pointer(raw_ptr, _DEBUG_NEW_CALLER_ADDRESS, false);
+}
+
+void operator delete[](void* pointer) throw()
+{
+    if (pointer == NULL)
+        return;
+    size_t hash_index = _DEBUG_NEW_HASH(pointer);
+    fast_mutex_autolock lock(new_ptr_lock[hash_index]);
+    new_ptr_list_t** raw_ptr = search_pointer(pointer, hash_index);
+    if (raw_ptr == NULL)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp, "delete[]: invalid pointer %p at ", pointer);
+        print_position(_DEBUG_NEW_CALLER_ADDRESS, 0);
+        fprintf(new_output_fp, "\n");
+        fflush(new_output_fp);
+        _DEBUG_NEW_ERROR_ACTION;
+    }
+    free_pointer(raw_ptr, _DEBUG_NEW_CALLER_ADDRESS, true);
+}
+
+#if HAS_PLACEMENT_DELETE
+void operator delete(void* pointer, const char* file, int line) throw()
+{
+    if (new_verbose_flag)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "info: exception thrown on initializing object at %p (",
+                pointer);
+        print_position(file, line);
+        fprintf(new_output_fp, ")\n");
+    }
+    operator delete(pointer);
+}
+
+void operator delete[](void* pointer, const char* file, int line) throw()
+{
+    if (new_verbose_flag)
+    {
+        fast_mutex_autolock lock(new_output_lock);
+        fprintf(new_output_fp,
+                "info: exception thrown on initializing objects at %p (",
+                pointer);
+        print_position(file, line);
+        fprintf(new_output_fp, ")\n");
+    }
+    operator delete[](pointer);
+}
+
+void operator delete(void* pointer, const std::nothrow_t&) throw()
+{
+    operator delete(pointer, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+void operator delete[](void* pointer, const std::nothrow_t&) throw()
+{
+    operator delete[](pointer, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+#endif // HAS_PLACEMENT_DELETE
+
+int __debug_new_counter::_count = 0;
+
+/**
+ * Constructor to increment the count.
+ */
+__debug_new_counter::__debug_new_counter()
+{
+    ++_count;
+}
+
+/**
+ * Destructor to decrement the count.  When the count is zero,
+ * #check_leaks will be called.
+ */
+__debug_new_counter::~__debug_new_counter()
+{
+    if (--_count == 0 && new_autocheck_flag)
+        if (check_leaks())
+        {
+            new_verbose_flag = true;
+#if defined(__GNUC__) && __GNUC__ >= 3
+            if (!getenv("GLIBCPP_FORCE_NEW") && !getenv("GLIBCXX_FORCE_NEW"))
+                fprintf(new_output_fp,
+"*** WARNING:  GCC 3 or later is detected, please make sure the\n"
+"    environment variable GLIBCPP_FORCE_NEW (GCC 3.2 and 3.3) or\n"
+"    GLIBCXX_FORCE_NEW (GCC 3.4 and later) is defined.  Check the\n"
+"    README file for details.\n");
+#endif
+        }
+}
+
+// GRUNTSTER
+size_t getSizeFromPointer(void* ptr)
+{
+	size_t hash_index = _DEBUG_NEW_HASH(ptr);
+    fast_mutex_autolock lock(new_ptr_lock[hash_index]);
+    new_ptr_list_t** raw_pointer = search_pointer(ptr, hash_index);
+	new_ptr_list_t* pointer = *raw_pointer;
+
+	return pointer->size;
+}
+
+static void* _malloc(size_t size)
+{
+	char *ptr, *ptr2, *aligned_ptr;
+
+	ptr = (char *)malloc(size + 16 + sizeof(int));
+	if (ptr == NULL) return(NULL);
+
+	ptr2 = ptr + sizeof(int);
+	aligned_ptr = ptr2 + (16 - ((size_t)ptr2 & 15));
+
+	ptr2 = aligned_ptr - sizeof(int);
+	*((int *)ptr2)=(int)(aligned_ptr - ptr);
+
+	return(aligned_ptr);
+}
+
+static void _free(void *ptr)
+{
+	int *ptr2 = (int *)ptr - 1;
+	char *c = (char *)ptr;
+
+	free(c - *ptr2);
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.h	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/debug_new.h	2007-08-29 19:45:10 UTC (rev 3568)
@@ -0,0 +1,143 @@
+// -*- Mode: C++; tab-width: 4; c-basic-offset: 4; indent-tabs-mode: nil -*-
+// vim:tabstop=4:shiftwidth=4:expandtab:
+
+/*
+ * Copyright (C) 2004-2005 Wu Yongwei <adah at users dot sourceforge dot net>
+ *
+ * This software is provided 'as-is', without any express or implied
+ * warranty.  In no event will the authors be held liable for any
+ * damages arising from the use of this software.
+ *
+ * Permission is granted to anyone to use this software for any purpose,
+ * including commercial applications, and to alter it and redistribute
+ * it freely, subject to the following restrictions:
+ *
+ * 1. The origin of this software must not be misrepresented; you must
+ *    not claim that you wrote the original software. If you use this
+ *    software in a product, an acknowledgment in the product
+ *    documentation would be appreciated but is not required.
+ * 2. Altered source versions must be plainly marked as such, and must
+ *    not be misrepresented as being the original software.
+ * 3. This notice may not be removed or altered from any source
+ *    distribution.
+ *
+ * This file is part of Stones of Nvwa:
+ *      http://sourceforge.net/projects/nvwa
+ *
+ */
+
+/**
+ * @file    debug_new.h
+ *
+ * Header file for checking leaks caused by unmatched new/delete.
+ *
+ * @version 3.4, 2005/09/13
+ * @author  Wu Yongwei
+ *
+ */
+
+#ifndef _DEBUG_NEW_H
+#define _DEBUG_NEW_H
+
+#include <new>
+#include <stdio.h>
+
+/**
+ * @def HAS_PLACEMENT_DELETE
+ *
+ * Macro to indicate whether placement delete operators are supported on
+ * a certain compiler.  Some compilers, like Borland C++ Compiler 5.5.1
+ * and Digital Mars Compiler 8.42, do not support them, and the user
+ * must define this macro to \c 0 to make the program compile.  Also
+ * note that in that case memory leakage will occur if an exception is
+ * thrown in the initialization (constructor) of a dynamically created
+ * object.
+ */
+#ifndef HAS_PLACEMENT_DELETE
+#define HAS_PLACEMENT_DELETE 1
+#endif
+
+/**
+ * @def _DEBUG_NEW_REDEFINE_NEW
+ *
+ * Macro to indicate whether redefinition of \c new is wanted.  If one
+ * wants to define one's own <code>operator new</code>, to call
+ * <code>operator new</code> directly, or to call placement \c new, it
+ * should be defined to \c 0 to alter the default behaviour.  Unless, of
+ * course, one is willing to take the trouble to write something like:
+ * @code
+ * # ifdef new
+ * #   define _NEW_REDEFINED
+ * #   undef new
+ * # endif
+ *
+ * // Code that uses new is here
+ *
+ * # ifdef _NEW_REDEFINED
+ * #   ifdef DEBUG_NEW
+ * #     define new DEBUG_NEW
+ * #   endif
+ * #   undef _NEW_REDEFINED
+ * # endif
+ * @endcode
+ */
+#ifndef _DEBUG_NEW_REDEFINE_NEW
+#define _DEBUG_NEW_REDEFINE_NEW 1
+#endif
+
+/* Prototypes */
+int check_leaks();
+void* operator new(size_t size, const char* file, int line);
+void* operator new[](size_t size, const char* file, int line);
+#if HAS_PLACEMENT_DELETE
+void operator delete(void* pointer, const char* file, int line) throw();
+void operator delete[](void* pointer, const char* file, int line) throw();
+#endif
+#if defined(_MSC_VER) && _MSC_VER < 1300
+// MSVC 6 requires the following declarations; or the non-placement
+// new[]/delete[] will not compile.
+void* operator new[](size_t) throw(std::bad_alloc);
+void operator delete[](void*) throw();
+#endif
+
+/* Control variables */
+extern bool new_autocheck_flag; // default to true: call check_leaks() on exit
+extern bool new_verbose_flag;   // default to false: no verbose information
+extern FILE* new_output_fp;     // default to stderr: output to console
+extern const char* new_progname;// default to NULL; should be assigned argv[0]
+
+/**
+ * @def DEBUG_NEW
+ *
+ * The macro to catch file/line information on allocation.  If
+ * #_DEBUG_NEW_REDEFINE_NEW is not defined, one can use this macro
+ * directly; otherwise \c new will be defined to it, and one must use
+ * \c new instead.
+ */
+#define DEBUG_NEW new(__FILE__, __LINE__)
+
+# if _DEBUG_NEW_REDEFINE_NEW
+#   define new DEBUG_NEW
+# endif
+# ifdef _DEBUG_NEW_EMULATE_MALLOC
+#   include <stdlib.h>
+#   ifdef new
+#     define malloc(s) ((void*)(new char[s]))
+#   else
+#     define malloc(s) ((void*)(DEBUG_NEW char[s]))
+#   endif
+#   define free(p) delete[] (char*)(p)
+# endif
+
+/** Counter class for on-exit leakage check. */
+class __debug_new_counter
+{
+    static int _count;
+public:
+    __debug_new_counter();
+    ~__debug_new_counter();
+};
+/** Counting object for each file including debug_new.h. */
+static __debug_new_counter __debug_new_count;
+
+#endif // _DEBUG_NEW_H

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/fast_mutex.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/fast_mutex.h	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/fast_mutex.h	2007-08-29 19:45:10 UTC (rev 3568)
@@ -0,0 +1,311 @@
+// -*- Mode: C++; tab-width: 4; c-basic-offset: 4; indent-tabs-mode: nil -*-
+// vim:tabstop=4:shiftwidth=4:expandtab:
+
+/*
+ * Copyright (C) 2004-2005 Wu Yongwei <adah at users dot sourceforge dot net>
+ *
+ * This software is provided 'as-is', without any express or implied
+ * warranty.  In no event will the authors be held liable for any
+ * damages arising from the use of this software.
+ *
+ * Permission is granted to anyone to use this software for any purpose,
+ * including commercial applications, and to alter it and redistribute
+ * it freely, subject to the following restrictions:
+ *
+ * 1. The origin of this software must not be misrepresented; you must
+ *    not claim that you wrote the original software. If you use this
+ *    software in a product, an acknowledgment in the product
+ *    documentation would be appreciated but is not required.
+ * 2. Altered source versions must be plainly marked as such, and must
+ *    not be misrepresented as being the original software.
+ * 3. This notice may not be removed or altered from any source
+ *    distribution.
+ *
+ * This file is part of Stones of Nvwa:
+ *      http://sourceforge.net/projects/nvwa
+ *
+ */
+
+/**
+ * @file    fast_mutex.h
+ *
+ * A fast mutex implementation for POSIX and Win32.
+ *
+ * @version 1.18, 2005/05/06
+ * @author  Wu Yongwei
+ *
+ */
+
+#ifndef _FAST_MUTEX_H
+#define _FAST_MUTEX_H
+
+# if !defined(_NOTHREADS)
+#   if !defined(_WIN32THREADS) && \
+            (defined(_WIN32) && defined(_MT))
+//      Automatically use _WIN32THREADS when specifying -MT/-MD in MSVC,
+//      or -mthreads in MinGW GCC.
+#       define _WIN32THREADS
+#   elif !defined(_PTHREADS) && \
+            defined(_REENTRANT)
+//      Automatically use _PTHREADS when specifying -pthread in GCC.
+//      N.B. I do not detect on _PTHREAD_H since libstdc++-v3 under
+//      Linux will silently include <pthread.h> anyway.
+#       define _PTHREADS
+#   endif
+# endif
+
+# if !defined(_PTHREADS) && !defined(_WIN32THREADS) && !defined(_NOTHREADS)
+#   define _NOTHREADS
+# endif
+
+# if defined(_NOTHREADS)
+#   if defined(_PTHREADS) || defined(_WIN32THREADS)
+#       undef _NOTHREADS
+#       error "Cannot define multi-threaded mode with -D_NOTHREADS"
+#       if defined(__MINGW32__) && defined(_WIN32THREADS) && !defined(_MT)
+#           error "Be sure to specify -mthreads with -D_WIN32THREADS"
+#       endif
+#   endif
+# endif
+
+# ifndef _FAST_MUTEX_CHECK_INITIALIZATION
+/**
+ * Macro to control whether to check for initialization status for each
+ * lock/unlock operation.  Defining it to a non-zero value will enable
+ * the check, so that the construction/destruction of a static object
+ * using a static fast_mutex not yet constructed or already destroyed
+ * will work (with lock/unlock operations ignored).  Defining it to zero
+ * will disable to check.
+ */
+#   define _FAST_MUTEX_CHECK_INITIALIZATION 1
+# endif
+
+# if defined(_PTHREADS) && defined(_WIN32THREADS)
+//  Some C++ libraries have _PTHREADS defined even on Win32 platforms.
+//  Thus this hack.
+#   undef _PTHREADS
+# endif
+
+# ifdef _DEBUG
+#   include <stdio.h>
+#   include <stdlib.h>
+/** Macro for fast_mutex assertions.  Real version (for debug mode). */
+#   define _FAST_MUTEX_ASSERT(_Expr, _Msg) \
+        if (!(_Expr)) { \
+            fprintf(stderr, "fast_mutex::%s\n", _Msg); \
+            abort(); \
+        }
+# else
+/** Macro for fast_mutex assertions.  Fake version (for release mode). */
+#   define _FAST_MUTEX_ASSERT(_Expr, _Msg) \
+        ((void)0)
+# endif
+
+# ifdef _PTHREADS
+#   include <pthread.h>
+/**
+ * Macro alias to `volatile' semantics.  Here it is truly volatile since
+ * it is in a multi-threaded (POSIX threads) environment.
+ */
+#   define __VOLATILE volatile
+    /**
+     * Class for non-reentrant fast mutexes.  This is the implementation
+     * for POSIX threads.
+     */
+    class fast_mutex
+    {
+        pthread_mutex_t _M_mtx_impl;
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+        bool _M_initialized;
+#       endif
+#       ifdef _DEBUG
+        bool _M_locked;
+#       endif
+    public:
+        fast_mutex()
+#       ifdef _DEBUG
+            : _M_locked(false)
+#       endif
+        {
+            ::pthread_mutex_init(&_M_mtx_impl, NULL);
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            _M_initialized = true;
+#       endif
+        }
+        ~fast_mutex()
+        {
+            _FAST_MUTEX_ASSERT(!_M_locked, "~fast_mutex(): still locked");
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            _M_initialized = false;
+#       endif
+            ::pthread_mutex_destroy(&_M_mtx_impl);
+        }
+        void lock()
+        {
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            if (!_M_initialized)
+                return;
+#       endif
+            ::pthread_mutex_lock(&_M_mtx_impl);
+#       ifdef _DEBUG
+            // The following assertion should _always_ be true for a
+            // real `fast' pthread_mutex.  However, this assertion can
+            // help sometimes, when people forget to use `-lpthread' and
+            // glibc provides an empty implementation.  Having this
+            // assertion is also more consistent.
+            _FAST_MUTEX_ASSERT(!_M_locked, "lock(): already locked");
+            _M_locked = true;
+#       endif
+        }
+        void unlock()
+        {
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            if (!_M_initialized)
+                return;
+#       endif
+#       ifdef _DEBUG
+            _FAST_MUTEX_ASSERT(_M_locked, "unlock(): not locked");
+            _M_locked = false;
+#       endif
+            ::pthread_mutex_unlock(&_M_mtx_impl);
+        }
+    private:
+        fast_mutex(const fast_mutex&);
+        fast_mutex& operator=(const fast_mutex&);
+    };
+# endif // _PTHREADS
+
+# ifdef _WIN32THREADS
+#   include <windows.h>
+/**
+ * Macro alias to `volatile' semantics.  Here it is truly volatile since
+ * it is in a multi-threaded (Win32 threads) environment.
+ */
+#   define __VOLATILE volatile
+    /**
+     * Class for non-reentrant fast mutexes.  This is the implementation
+     * for Win32 threads.
+     */
+    class fast_mutex
+    {
+        CRITICAL_SECTION _M_mtx_impl;
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+        bool _M_initialized;
+#       endif
+#       ifdef _DEBUG
+        bool _M_locked;
+#       endif
+    public:
+        fast_mutex()
+#       ifdef _DEBUG
+            : _M_locked(false)
+#       endif
+        {
+            ::InitializeCriticalSection(&_M_mtx_impl);
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            _M_initialized = true;
+#       endif
+        }
+        ~fast_mutex()
+        {
+            _FAST_MUTEX_ASSERT(!_M_locked, "~fast_mutex(): still locked");
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            _M_initialized = false;
+#       endif
+            ::DeleteCriticalSection(&_M_mtx_impl);
+        }
+        void lock()
+        {
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            if (!_M_initialized)
+                return;
+#       endif
+            ::EnterCriticalSection(&_M_mtx_impl);
+#       ifdef _DEBUG
+            _FAST_MUTEX_ASSERT(!_M_locked, "lock(): already locked");
+            _M_locked = true;
+#       endif
+        }
+        void unlock()
+        {
+#       if _FAST_MUTEX_CHECK_INITIALIZATION
+            if (!_M_initialized)
+                return;
+#       endif
+#       ifdef _DEBUG
+            _FAST_MUTEX_ASSERT(_M_locked, "unlock(): not locked");
+            _M_locked = false;
+#       endif
+            ::LeaveCriticalSection(&_M_mtx_impl);
+        }
+    private:
+        fast_mutex(const fast_mutex&);
+        fast_mutex& operator=(const fast_mutex&);
+    };
+# endif // _WIN32THREADS
+
+# ifdef _NOTHREADS
+/**
+ * Macro alias to `volatile' semantics.  Here it is not truly volatile
+ * since it is in a single-threaded environment.
+ */
+#   define __VOLATILE
+    /**
+     * Class for non-reentrant fast mutexes.  This is the null
+     * implementation for single-threaded environments.
+     */
+    class fast_mutex
+    {
+#       ifdef _DEBUG
+        bool _M_locked;
+#       endif
+    public:
+        fast_mutex()
+#       ifdef _DEBUG
+            : _M_locked(false)
+#       endif
+        {
+        }
+        ~fast_mutex()
+        {
+            _FAST_MUTEX_ASSERT(!_M_locked, "~fast_mutex(): still locked");
+        }
+        void lock()
+        {
+#       ifdef _DEBUG
+            _FAST_MUTEX_ASSERT(!_M_locked, "lock(): already locked");
+            _M_locked = true;
+#       endif
+        }
+        void unlock()
+        {
+#       ifdef _DEBUG
+            _FAST_MUTEX_ASSERT(_M_locked, "unlock(): not locked");
+            _M_locked = false;
+#       endif
+        }
+    private:
+        fast_mutex(const fast_mutex&);
+        fast_mutex& operator=(const fast_mutex&);
+    };
+# endif // _NOTHREADS
+
+/** An acquistion-on-initialization lock class based on fast_mutex. */
+class fast_mutex_autolock
+{
+    fast_mutex& _M_mtx;
+public:
+    explicit fast_mutex_autolock(fast_mutex& __mtx) : _M_mtx(__mtx)
+    {
+        _M_mtx.lock();
+    }
+    ~fast_mutex_autolock()
+    {
+        _M_mtx.unlock();
+    }
+private:
+    fast_mutex_autolock(const fast_mutex_autolock&);
+    fast_mutex_autolock& operator=(const fast_mutex_autolock&);
+};
+
+#endif // _FAST_MUTEX_H

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/static_assert.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/static_assert.h	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/static_assert.h	2007-08-29 19:45:10 UTC (rev 3568)
@@ -0,0 +1,50 @@
+// -*- Mode: C++; tab-width: 4; c-basic-offset: 4; indent-tabs-mode: nil -*-
+// vim:tabstop=4:shiftwidth=4:expandtab:
+
+/*
+ * Copyright (C) 2004-2005 Wu Yongwei <adah at users dot sourceforge dot net>
+ *
+ * This software is provided 'as-is', without any express or implied
+ * warranty.  In no event will the authors be held liable for any
+ * damages arising from the use of this software.
+ *
+ * Permission is granted to anyone to use this software for any purpose,
+ * including commercial applications, and to alter it and redistribute
+ * it freely, subject to the following restrictions:
+ *
+ * 1. The origin of this software must not be misrepresented; you must
+ *    not claim that you wrote the original software. If you use this
+ *    software in a product, an acknowledgment in the product
+ *    documentation would be appreciated but is not required.
+ * 2. Altered source versions must be plainly marked as such, and must
+ *    not be misrepresented as being the original software.
+ * 3. This notice may not be removed or altered from any source
+ *    distribution.
+ *
+ * This file is part of Stones of Nvwa:
+ *      http://sourceforge.net/projects/nvwa
+ *
+ */
+
+/**
+ * @file    static_assert.h
+ *
+ * Template class to check validity duing compile time (adapted from Loki).
+ *
+ * @version 1.2, 2005/11/22
+ * @author  Wu Yongwei
+ *
+ */
+
+#ifndef STATIC_ASSERT
+
+template <bool> struct __nvwa_compile_time_error;
+template <>     struct __nvwa_compile_time_error<true> {};
+
+#define STATIC_ASSERT(_Expr, _Msg) \
+    { \
+        __nvwa_compile_time_error<((_Expr) != 0)> ERROR_##_Msg; \
+        (void)ERROR_##_Msg; \
+    }
+
+#endif // STATIC_ASSERT

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/CMakeLists.txt	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/CMakeLists.txt	2007-08-29 19:45:10 UTC (rev 3568)
@@ -1,20 +1,24 @@
-subdirs (PREORDER ADM_lavcodec)
-subdirs (PREORDER ADM_lavformat)
-subdirs (PREORDER ADM_lavutil)
-subdirs (PREORDER ADM_liba52)
-subdirs (PREORDER ADM_libMad)
-subdirs (PREORDER ADM_libMpeg2Dec)
-subdirs (PREORDER ADM_libmpeg2enc)
-subdirs (PREORDER ADM_libswscale)
-subdirs (PREORDER ADM_libtwolame)
-subdirs (PREORDER ADM_libwrapper)
-subdirs (PREORDER ADM_lvemux)
-subdirs (PREORDER ADM_mplex)
-subdirs (PREORDER ADM_smjs)
-subdirs (PREORDER ADM_utilities)
-subdirs (PREORDER ADM_xvidratectl)
-subdirs (PREORDER ADM_libpostproc)
-
-if(USE_FREETYPE)
-subdirs (PREORDER ADM_libass)
-endif(USE_FREETYPE)
+subdirs (PREORDER ADM_lavcodec)
+subdirs (PREORDER ADM_lavformat)
+subdirs (PREORDER ADM_lavutil)
+subdirs (PREORDER ADM_liba52)
+subdirs (PREORDER ADM_libMad)
+subdirs (PREORDER ADM_libMpeg2Dec)
+subdirs (PREORDER ADM_libmpeg2enc)
+subdirs (PREORDER ADM_libswscale)
+subdirs (PREORDER ADM_libtwolame)
+subdirs (PREORDER ADM_libwrapper)
+subdirs (PREORDER ADM_lvemux)
+subdirs (PREORDER ADM_mplex)
+subdirs (PREORDER ADM_smjs)
+subdirs (PREORDER ADM_utilities)
+subdirs (PREORDER ADM_xvidratectl)
+subdirs (PREORDER ADM_libpostproc)
+
+if(USE_FREETYPE)
+subdirs (PREORDER ADM_libass)
+endif(USE_FREETYPE)
+
+if (ADM_DEBUG AND FIND_LEAKS)
+subdirs (PREORDER ADM_nvwa)
+endif (ADM_DEBUG AND FIND_LEAKS)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memsupport.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memsupport.cpp	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_memsupport.cpp	2007-08-29 19:45:10 UTC (rev 3568)
@@ -29,19 +29,25 @@
 #include <math.h>
 
 #include "default.h"
+#include "ADM_assert.h"
 
-#include <ADM_assert.h>
-
 #include "ADM_osSupport/ADM_threads.h"
 
 #undef memalign
 #undef malloc
 #undef free
 
-
 static uint32_t ADM_consumed=0;
 static admMutex memAccess("MemAccess");
 static int doMemStat=0;
+
+#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
+#define _DEBUG_NEW_CALLER_ADDRESS __builtin_return_address(0)
+extern void* operator new(size_t size, const char* file, int line);
+extern void operator delete(void* pointer, const char* file, int line) throw();
+extern size_t getSizeFromPointer(void* ptr);
+#endif
+
 extern "C" {
 
 void *av_malloc(unsigned int size);
@@ -68,6 +74,8 @@
 	printf("\tMemory consumed :%lu (MB)\n",ADM_consumed>>20);
 
 }
+
+#if !defined(ADM_DEBUG) || !defined(FIND_LEAKS)
 /**
     \fn ADM_calloc(size_t nbElm,size_t elSize);
     \brief Replacement for system Calloc using our memory management
@@ -253,4 +261,113 @@
 	
 
 }
+#else
+
+void *ADM_alloc(size_t size)
+{
+	return operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+void *ADM_calloc(size_t nbElm,size_t elSize)
+{
+  void *out = operator new(nbElm*elSize, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+
+  memset(out,0,nbElm*elSize);
+  return out;
+}
+
+char *ADM_strdup(const char *in)
+{
+    if(!in) return NULL;
+
+	int size = strlen(in) + 1;
+	char *out = (char *)(operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0));
+
+	memcpy(out, in, size);
+
+	return out;
+}
+
+void ADM_dezalloc(void *ptr)
+{
+	operator delete(ptr, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+
+void *ADM_realloc(void *ptr, size_t newsize)
+{
+	void *nalloc;
+    
+    if(!ptr)
+		return operator new(newsize, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+
+    if(!newsize) 
+    {    
+		operator delete(ptr, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+		return NULL;
+    }
+
+	uint32_t size = getSizeFromPointer(ptr);
+
+	if (size >= newsize)
+		return ptr;
+
+	nalloc = operator new(newsize, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+	memcpy(nalloc,ptr,getSizeFromPointer(ptr));
+	operator delete(ptr, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+
+	return nalloc;
+}
+
+extern "C"
+{
+void *av_malloc(unsigned int size)
+{
+	return operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+void av_freep(void *arg)
+{
+    void **ptr= (void**)arg;
+    av_free(*ptr);
+    *ptr = NULL;
+}
+
+void *av_mallocz(unsigned int size)
+{
+    void *ptr;
+
+	ptr = operator new(size, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+
+    if (ptr)
+        memset(ptr, 0, size);
+    return ptr;
+}
+}
+
+char *av_strdup(const char *s)
+{
+    char *ptr;
+    int len;
+    len = strlen(s) + 1;
+	ptr = (char *)operator new(len, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+
+    if (ptr)
+        memcpy(ptr, s, len);
+
+    return ptr;
+}
+
+void *av_realloc(void *ptr, unsigned int newsize)
+{
+	if(!ptr)
+		return operator new(newsize, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+	else
+		return ADM_realloc(ptr,newsize);
+}
+
+void av_free(void *ptr)
+{
+	if(ptr)
+		operator delete(ptr, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
+}
+#endif
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-29 19:45:10 UTC (rev 3568)
@@ -189,6 +189,10 @@
 SET(ADM_LIBRARIES ${ADM_LIBRARIES}  ADM_libass)
 ENDIF(USE_FREETYPE)
 
+if (ADM_DEBUG AND FIND_LEAKS)
+SET(ADM_LIBRARIES ${ADM_LIBRARIES} ADM_nvwa)
+ENDIF (ADM_DEBUG AND FIND_LEAKS)
+
 FOREACH(_current ${ADM_LIBRARIES})
 add_libs_all_targets(${_current})
 ENDFOREACH(_current ${ADM_SUBDIR})

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-08-29 17:49:57 UTC (rev 3567)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-08-29 19:45:10 UTC (rev 3568)
@@ -300,3 +300,6 @@
 
 /* Big endian CPU - SPARC or PowerPC */
 #cmakedefine WORDS_BIGENDIAN
+
+/* use Nvwa memory leak detector */
+#cmakedefine FIND_LEAKS



From gruntster at mail.berlios.de  Wed Aug 29 21:49:33 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Aug 2007 21:49:33 +0200
Subject: [Avidemux-svn-commit] r3569 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_libraries/ADM_nvwa
Message-ID: <200708291949.l7TJnXbb012137@sheep.berlios.de>

Author: gruntster
Date: 2007-08-29 21:49:26 +0200 (Wed, 29 Aug 2007)
New Revision: 3569

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/main.cpp
Log:
[Debug] Nvwa, part 2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt	2007-08-29 19:45:10 UTC (rev 3568)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_nvwa/CMakeLists.txt	2007-08-29 19:49:26 UTC (rev 3569)
@@ -9,6 +9,6 @@
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)
-ADD_DEFINITIONS(-D_DEBUG_NEW_ERROR_ACTION=NULL -D_DEBUG_NEW_ALIGNMENT=32)
+ADD_DEFINITIONS(-D_DEBUG_NEW_ERROR_ACTION=NULL)
 
 ################################

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-29 19:45:10 UTC (rev 3568)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-08-29 19:49:26 UTC (rev 3569)
@@ -107,8 +107,17 @@
 uint32_t CpuCaps::myCpuCaps=0;
 uint32_t CpuCaps::myCpuMask=0xffffffff;
 
+#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
+extern const char* new_progname;
+extern int check_leaks();
+#endif
+
 int main(int argc, char *argv[])
 {
+#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
+	new_progname = argv[0];
+#endif
+
 #ifndef ADM_WIN32
 	// thx smurf uk :)
     installSigHandler();
@@ -315,4 +324,8 @@
     ADM_memStat();
     ADM_memStatEnd();
     printf("\nGoodbye...\n\n");
+
+#if defined(ADM_DEBUG) && defined(FIND_LEAKS)
+	check_leaks();
+#endif
 }



From gruntster at mail.berlios.de  Wed Aug 29 21:59:37 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Aug 2007 21:59:37 +0200
Subject: [Avidemux-svn-commit] r3570 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_inputs/ADM_mp4
	ADM_libraries/ADM_mplex ADM_userInterfaces/ADM_commonUI
Message-ID: <200708291959.l7TJxbAs012782@sheep.berlios.de>

Author: gruntster
Date: 2007-08-29 21:59:27 +0200 (Wed, 29 Aug 2007)
New Revision: 3570

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyPreview.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[MP4] fix mem leak + cosmetics

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp	2007-08-29 19:49:26 UTC (rev 3569)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp	2007-08-29 19:59:27 UTC (rev 3570)
@@ -249,10 +249,12 @@
         {
           printf("Cannot find needed atom\n");
           fclose(_fd);
-          return 0; 
+		  delete atom;
+          return 0;
         }
         
-        
+        delete atom;
+
 	      _isvideopresent=1;
 	      _isaudiopresent=0;
     	     

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.cpp	2007-08-29 19:49:26 UTC (rev 3569)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_mplex/bits.cpp	2007-08-29 19:59:27 UTC (rev 3570)
@@ -57,7 +57,7 @@
 void BitStreamBuffering::Release()
 {
     if( bfr != 0)
-        delete bfr;
+        delete[] bfr;
     bfr = 0;
     bfr_size = 0;
     buffered = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyPreview.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyPreview.h	2007-08-29 19:49:26 UTC (rev 3569)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyPreview.h	2007-08-29 19:59:27 UTC (rev 3570)
@@ -10,7 +10,7 @@
 	uint8_t setData(uint8_t *buffer) {_rgb->scale(buffer, _rgbBufferOut); return 1;}
 
 	flyPreview(uint32_t width, uint32_t height, void *canvas) : 
-		ADM_flyDialog(width, height, NULL, canvas, NULL, 0, RESIZE_NONE) {delete _rgbBuffer; _rgbBuffer = NULL;};
+		ADM_flyDialog(width, height, NULL, canvas, NULL, 0, RESIZE_NONE) {delete[] _rgbBuffer; _rgbBuffer = NULL;};
 	virtual ~flyPreview(void) {_rgbBuffer = NULL;};
 };
 
@@ -23,7 +23,7 @@
 	uint8_t cleanup(void) {return 1;}
 
 	flySeekablePreview(uint32_t width, uint32_t height, AVDMGenericVideoStream *videoStream, void *canvas, void *slider) : 
-		ADM_flyDialog(width, height, videoStream, canvas, slider, 0, RESIZE_AUTO) {delete _rgbBufferOut; _rgbBufferOut = NULL;};
+		ADM_flyDialog(width, height, videoStream, canvas, slider, 0, RESIZE_AUTO) {delete[] _rgbBufferOut; _rgbBufferOut = NULL;};
 	virtual ~flySeekablePreview(void) {_rgbBufferOut = NULL;};
 };
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-29 19:49:26 UTC (rev 3569)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-29 19:59:27 UTC (rev 3570)
@@ -1226,7 +1226,7 @@
   
   fclose (out);
   delete work;
-  delete buffer;
+  delete[] buffer;
   printf ("\n wanted %llu samples, goto %llu samples, written %u bytes\n", tgt_sample,cur_sample, written);
 
 



From mean at mail.berlios.de  Thu Aug 30 20:36:24 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 30 Aug 2007 20:36:24 +0200
Subject: [Avidemux-svn-commit] r3571 -
	branches/avidemux_2.4_branch/avidemux/ADM_video
Message-ID: <200708301836.l7UIaOBU013092@sheep.berlios.de>

Author: mean
Date: 2007-08-30 20:36:24 +0200 (Thu, 30 Aug 2007)
New Revision: 3571

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_cache.h
Log:
[Cache] Chris Mc Gregor : protect against multiple includes

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_cache.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_cache.h	2007-08-29 19:59:27 UTC (rev 3570)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_cache.h	2007-08-30 18:36:24 UTC (rev 3571)
@@ -9,6 +9,10 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
+
+#ifndef __ADM_CACHE__
+#define __ADM_CACHE__
+
 typedef struct vidCacheEntry
 {
 		uint32_t 	frameNum;
@@ -41,3 +45,4 @@
 		uint8_t unlock(ADMImage  *frame);
 		uint8_t purge(void);
 };
+#endif



From mean at mail.berlios.de  Thu Aug 30 20:37:10 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 30 Aug 2007 20:37:10 +0200
Subject: [Avidemux-svn-commit] r3572 -
	branches/avidemux_2.4_branch/avidemux/ADM_filter
Message-ID: <200708301837.l7UIbAvk013142@sheep.berlios.de>

Author: mean
Date: 2007-08-30 20:37:09 +0200 (Thu, 30 Aug 2007)
New Revision: 3572

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
Log:
[Cache] Chris Mc Gregor : Accept filter without conf

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-30 18:36:24 UTC (rev 3571)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-08-30 18:37:09 UTC (rev 3572)
@@ -340,7 +340,7 @@
 		{
 			if(!strncasecmp(param->param[i],args[j].arg.string,l))
 			{
-				if(strlen(args[j].arg.string)>l+1 && args[j].arg.string[l]=='=')
+				if(strlen(args[j].arg.string)>l && args[j].arg.string[l]=='=')
 				{
 					found=j;
 					trans[i]=j;



From mean at mail.berlios.de  Thu Aug 30 20:37:47 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 30 Aug 2007 20:37:47 +0200
Subject: [Avidemux-svn-commit] r3573 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters
Message-ID: <200708301837.l7UIblQs013178@sheep.berlios.de>

Author: mean
Date: 2007-08-30 20:37:47 +0200 (Thu, 30 Aug 2007)
New Revision: 3573

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
Log:
[GTK/Filters] Chris Mc Gregor : Try do display filters with very long comment

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-30 18:37:09 UTC (rev 3572)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2007-08-30 18:37:47 UTC (rev 3573)
@@ -517,10 +517,44 @@
     {
         gtk_list_store_append (stores[0], &iter);
         fil=videofilters[i].tag;
+         const char * name = filterGetNameFromTag(fil);
+         const char * conf = videofilters[i].filter->printConf ();
+         int namelen = strlen (name);
+         while (*conf == ' ')
+             ++conf;
+         if (strncasecmp (name, conf, namelen) == 0)
+         {
+             conf += namelen;
+             while (*conf == ' ' || *conf == ':')
+                 ++conf;
+         }
+         const char * smallstart = "";
+         const char * smallend = "";
+         const char * namesmallstart = "";
+         const char * namesmallend = "";
+         int conflen = strlen (conf);
+         if (conflen > 120)
+         {
+             smallstart = "<small>";
+             smallend = "</small>";
+             if (conflen > 180)
+             {
+                 namesmallstart = smallstart;
+                 namesmallend = smallend;
+             }
+         }
+
         str = g_strconcat("<span  weight=\"bold\">",
-                            filterGetNameFromTag(fil),
+                            namesmallstart,
+                            name,
+                            namesmallend,
                             "</span>\n",
-                            "<span size=\"smaller\">", videofilters[i].filter->printConf (), "</span>",  NULL);
+                             "<span size=\"smaller\">",
+                             smallstart,
+                             conf,
+                             smallend,
+                             "</span>",  NULL);
+
         gtk_list_store_set (stores[0], &iter,
                             0, str,
                             1, videofilters[i].tag,



From mean at mail.berlios.de  Thu Aug 30 20:42:42 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 30 Aug 2007 20:42:42 +0200
Subject: [Avidemux-svn-commit] r3574 - branches/avidemux_2.4_branch/po
Message-ID: <200708301842.l7UIggS6013574@sheep.berlios.de>

Author: mean
Date: 2007-08-30 20:42:41 +0200 (Thu, 30 Aug 2007)
New Revision: 3574

Modified:
   branches/avidemux_2.4_branch/po/de.po
Log:
[Translations] De update (J. Martin)

Modified: branches/avidemux_2.4_branch/po/de.po
===================================================================
--- branches/avidemux_2.4_branch/po/de.po	2007-08-30 18:37:47 UTC (rev 3573)
+++ branches/avidemux_2.4_branch/po/de.po	2007-08-30 18:42:41 UTC (rev 3574)
@@ -7,8 +7,8 @@
 msgstr ""
 "Project-Id-Version: de\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-07-16 21:16+0200\n"
-"PO-Revision-Date: 2007-07-16 21:35+0100\n"
+"POT-Creation-Date: 2007-08-23 20:57+0200\n"
+"PO-Revision-Date: 2007-08-23 22:53+0100\n"
 "Last-Translator: Joo Martin <debian at joomart.de>\n"
 "Language-Team: German\n"
 "MIME-Version: 1.0\n"
@@ -31,7 +31,7 @@
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:215
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:110
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:236
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:284
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:104
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:101
 #, c-format
@@ -71,13 +71,13 @@
 msgstr "Bit_rate Modus:"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:241
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:285
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:288
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp:59
 msgid "_Bitrate:"
 msgstr "_Bitrate (kb/s):"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:246
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:287
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:290
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp:40
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:204
 msgid "_Quality:"
@@ -97,15 +97,15 @@
 "Die Anzahl Kan?le ist gr??er als vom gew?hlten Audio Codec verarbeiten kann.\n"
 "?ndere entweder den Codec oder benutze den Mixer-Filter, um weniger Kan?le zu haben."
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:268
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
 msgid "VBR"
 msgstr "VBR"
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:269
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:272
 msgid "Quality based"
 msgstr "qualit?tsbasiert"
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:274
 #: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:113
 #: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:91
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:203
@@ -122,7 +122,7 @@
 msgstr "Fehler beim Konvertieren nach BMP"
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:417
-#: avidemux/gtk_gui.cpp:1923
+#: avidemux/gtk_gui.cpp:1919
 msgid "Something bad happened"
 msgstr "Irgendwas Schlimmes ist passiert"
 
@@ -132,22 +132,26 @@
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:335
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:115
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:127
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:136
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:233
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:239
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:246
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:255
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:366
 #: avidemux/ADM_ocr/adm_glyph.cpp:221
 #: avidemux/gtk_gui.cpp:895
-#: avidemux/gtk_gui.cpp:1527
+#: avidemux/gtk_gui.cpp:1497
 msgid "File error"
 msgstr "Dateifehler"
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
-#: avidemux/gtk_gui.cpp:1527
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:366
+#: avidemux/gtk_gui.cpp:1497
 #, c-format
 msgid "Cannot open \"%s\" for writing."
 msgstr "Kann \"%s\" nicht zum Schreiben ?ffnen."
@@ -181,8 +185,16 @@
 msgid "Unknown"
 msgstr "Unbekannt"
 
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp:191
+msgid "Wrong Colorspace"
+msgstr "Falscher Farbraum"
+
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp:191
+msgid "Only YV12/I420 or YUY2/I422 JPegs are supported"
+msgstr "Nur YV12/I420 oder YUY2/I422 JPEGs werden unterst?tzt"
+
 #: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:193
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
 msgid "Incompatible audio"
 msgstr "Inkompatibles Audio"
@@ -199,43 +211,40 @@
 msgid "Incompatible frame rate"
 msgstr "Inkompatible Bildrate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:76
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:74
 msgid "Hue"
 msgstr "Farbton"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:171
 msgid "Hue/Saturation"
 msgstr "Farbton/S?ttigung"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:200
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:185
 msgid "<b>Hue:</b>"
 msgstr "<b>Farbton:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:208
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:193
 msgid "<b>Saturation:</b>"
 msgstr "<b>S?ttigung:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:319
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:180
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:150
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:336
 msgid "Preview"
 msgstr "Vorschau"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:355
-msgid "Stack Field"
-msgstr "Stapel-Feld"
-
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:155
 msgid "ColorYuv (From avisynth)"
 msgstr "Yuv-Farben (von AviSynth)"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:179
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:210
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:194
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:212
 msgid "Contrast"
 msgstr "Kontrast"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:186
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:221
 msgid "Brightness"
 msgstr "Helligkeit"
 
@@ -253,7 +262,7 @@
 msgstr "Brillianz Y"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:214
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:255
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:239
 msgid "Chroma U"
 msgstr "Farbintensit?t U"
 
@@ -292,8 +301,8 @@
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:101
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:105
 #: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:264
-#: avidemux/gtk_gui.cpp:2001
-#: avidemux/gtk_gui.cpp:2100
+#: avidemux/gtk_gui.cpp:1997
+#: avidemux/gtk_gui.cpp:2096
 msgid "None"
 msgstr "Keine"
 
@@ -341,20 +350,12 @@
 msgid "<b>frame2</b>"
 msgstr "<b>Bild2</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:57
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:61
 msgid "Mini OCR"
 msgstr "Mini OCR"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:75
-msgid "# of Glyphs :"
-msgstr "# von Schriftzeichen :"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:82
-msgid "# of lines"
-msgstr "# von Zeilen"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:89
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:96
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:79
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:93
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:661
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:668
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:675
@@ -367,51 +368,83 @@
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:694
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:419
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:433
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1429
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1426
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:82
 msgid "0"
 msgstr "0"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:103
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:86
+msgid "0:0:0"
+msgstr "0:0:0"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:100
+msgid "# of lines"
+msgstr "# von Zeilen"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:108
+msgid "TimeCode:"
+msgstr "Zeitcode:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:116
+msgid "# of Glyphs :"
+msgstr "# von Schriftzeichen :"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:124
 msgid "<b>Stats</b>"
 msgstr "<b>Status</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:125
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:141
 msgid "Current Glyph"
 msgstr "Aktuelles Schriftzeichen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:138
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:154
 msgid " Text:"
 msgstr " Text:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:145
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:268
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:161
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:252
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:262
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:283
 msgid " "
 msgstr " "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:160
-msgid "Calibrate"
-msgstr "Kalibrieren"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:176
+msgid "_Calibrate"
+msgstr "_Kalibrieren"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:165
-msgid "Skip all"
-msgstr "Alles ?berspringen"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:180
+msgid "If the glyphs are too thin, enter a lower value here"
+msgstr "Falls das Schriftzeichen zu schmal ist, dann bitte hier einen kleineren Wert eingeben"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:170
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:182
+msgid "S_kip all"
+msgstr "Alles ?bers_pringen"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:186
+msgid "Skip the whole image"
+msgstr "Das gesamte Bild ?berspringen"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:188
 msgid "Skip Glyph"
 msgstr "Schriftzeichen ?berspringen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:175
-msgid "Ignore glyph"
-msgstr "Schriftzeichen ignorieren"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:192
+msgid "Skip the current letter/glyph"
+msgstr "Aktuelles Schriftzeichen ?berspringen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:180
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:194
+msgid "_Ignore glyph"
+msgstr "Schriftzeichen _ignorieren"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:198
+msgid "This glyph will be ignored from now on"
+msgstr "Dieses Schriftzeichen wird von jetzt an ignoriert"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:200
 msgid "Ok"
 msgstr "Ok"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:189
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:214
 msgid "<b>Bitmap</b>"
 msgstr "<b>Bitmap</b>"
 
@@ -533,7 +566,7 @@
 msgstr "Priorit?t:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:843
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:229
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:61
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:105
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:108
@@ -545,7 +578,7 @@
 msgstr "?ber Normal"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:845
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:188
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:231
 #: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:74
 msgid "Normal"
 msgstr "Normal"
@@ -555,7 +588,7 @@
 msgstr "Unter Normal"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:847
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:190
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:233
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:59
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:104
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:107
@@ -566,43 +599,43 @@
 msgid "Pause / Abort"
 msgstr "Pause / Abbruch"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:343
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:205
 msgid "MPlayer eq2"
 msgstr "MPlayer eq2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:369
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:231
 msgid "Brigh_tness:"
 msgstr "Helligkei_t:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:377
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:239
 msgid "_Saturation:"
 msgstr "_S?ttigung:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:412
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:274
 msgid "_Contrast:"
 msgstr "_Kontrast:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:438
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:300
 msgid "_Initial:"
 msgstr "Anfangswert:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:464
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:326
 msgid "_Red:"
 msgstr "_Rot:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:481
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:343
 msgid "_Green:"
 msgstr "_Gr?n:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:489
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:351
 msgid "_Blue:"
 msgstr "_Blau:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:497
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:359
 msgid "_Weight:"
 msgstr "Ge_wichtung:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:523
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:385
 msgid "<b>Gamma</b>"
 msgstr "<b>Gamma</b>"
 
@@ -693,6 +726,7 @@
 msgstr "1- oder 2-Durchlauf-Kodierung ausw?hlen"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:760
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:96
 msgid "Single pass - bitrate"
 msgstr "Einmaliger Lauf - Bitrate"
 
@@ -1308,7 +1342,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:750
 msgid "Fast P-Skip"
-msgstr "Schnelles ?berspringen von P-Bildern"
+msgstr "Schnelles P-Skip"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:753
 msgid "Uncheck to enable fast p-skip"
@@ -1343,6 +1377,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:808
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:559
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:87
 msgid "Custom"
 msgstr "Individuell"
 
@@ -1548,7 +1583,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1159
 msgid "Set how much \"bitrate bonus\" a keyframe can get"
-msgstr ""
+msgstr "Legt fest, wieviel \"Bitratenbonus\" ein Keyframe bekommen kann"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1162
 msgid "Keyframe boost (%)"
@@ -1568,7 +1603,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1198
 msgid "Define how much the bitrate can fluctuate over the entire video. 0% results in a constant bitrate stream, while 100% results in a pure quality based bitrate stream"
-msgstr ""
+msgstr "Legt fest, wie stark die Bitrate ?ber das gesamte Video schwanken kann. 0% ergibt einen konstanten Bitratenstrom, w?hrend 100% einen richtigen qualit?tsbasierten Bitratenstrom ergibt"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1201
 msgid "<b>Bitrate</b>"
@@ -1608,7 +1643,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1300
 msgid "Increase / decrease sensitivity for detecting Scene Changes to compensate for. Improves I-frame usage and helps quality"
-msgstr ""
+msgstr "Erh?ht / reduziert Empfindlichkeit, um Szenenwechsel festzustellen, die zu kompensieren sind. Verbessert die Verwendung von I-Bildern und hilft der Qualit?t"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1303
 msgid "Min IDR frame interval"
@@ -1616,11 +1651,11 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1316
 msgid "Set minimum frame interval between IDR frames. Defines the minimum amount a frame can be reused and referenced by other frames before a new clean one is established"
-msgstr ""
+msgstr "Setzt das kleinste Bildintervall zwischen IDR-Bildern. Definiert den kleinsten Betrag, den ein Bild durch andere Bilder wieder verwenden und referenzieren kann, bevor ein komplettes Bild kommt"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1325
 msgid "Set maximum frame interval between IDR frames. Defines the maximum amount a frame can be reused and referenced by other frames before a new clean one is established"
-msgstr ""
+msgstr "Setzt das gr??te Bildintervall zwischen IDR-Bildern. Definiert den gr??ten Betrag, den ein Bild durch andere Bilder wieder verwenden und referenzieren kann, bevor ein komplettes Bild kommt"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1328
 msgid "Max IDR frame interval"
@@ -1653,7 +1688,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1430
 msgid "Allowed variance of average bitrate. Lower values mean less variance. Higher values mean more variance."
-msgstr ""
+msgstr "Erlaubte Varianz der durchschnittl. Bitrate. Niedrigere Werte bedeuten weniger Varianz. H?here Werte bedeuten mehr Varianz."
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1433
 msgid "Bitrate Variance"
@@ -1661,7 +1696,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1446
 msgid "Allowed variance of average quantizer or quality. Lower values mean less variance. Higher values mean more variance. Note that 0 means constant quality while 1 means constant fluctuation. Recommended 0.6."
-msgstr ""
+msgstr "Erlaubte Varianz des durchschnittl. Quantizers. Niedrigere Werte bedeuten weniger Varianz. H?here Werte bedeuten mehr Varianz. Hierbei bedeutet 0 konstanter Quantizer, w?hrend 1 konstante Schwankungen bedeutet. Empfohlener Wert ist 0.6"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:1455
 msgid "Reduced fluctuations in Quantizer (before curve compression)"
@@ -1787,49 +1822,49 @@
 msgid "<b>Mode</b>"
 msgstr "<b>Modus</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:378
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:379
 msgid "Mplayer Delogo"
 msgstr "Mplayer Delogo (Logo-Entfernung)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:396
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:397
 msgid "X"
 msgstr "X"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:403
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:404
 msgid "Y"
 msgstr "Y"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:410
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:411
 msgid "W"
 msgstr "W"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:417
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:418
 msgid "H"
 msgstr "H"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:424
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:425
 msgid "Band"
 msgstr "Band"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:68
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:73
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:74
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:67
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:71
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:72
 msgid "ASHARP"
 msgstr "ASHARP"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:199
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:184
 msgid "ChromaShift"
 msgstr "Farbintensit?ts-Verschiebung"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:213
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:198
 msgid "U Shift :"
 msgstr "U Verschiebung:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:205
 msgid "V Shift :"
 msgstr "V Verschiebung:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:262
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:247
 msgid "<b>Preview</b>"
 msgstr "<b>Vorschau</b>"
 
@@ -2347,23 +2382,23 @@
 msgid "Enter parameters (i.e. -b 192 -m s ...)"
 msgstr "Parameter eingeben (z.B. -b 192 -m -s ...)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:199
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:183
 msgid "ASharp by MarcFD"
 msgstr "ASharp von MarcFD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:212
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:196
 msgid "Threshold :"
 msgstr "Schwelle :"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:204
 msgid "Strength :"
 msgstr "St?rke :"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:212
 msgid "Block Adaptative :"
 msgstr "Block anpassungsf?hig:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:236
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:220
 msgid "Unknown flag :"
 msgstr "Unbekannter Schalter:"
 
@@ -2384,7 +2419,7 @@
 msgstr "arbeitet"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:401
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:992
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:989
 msgid "Calculator"
 msgstr "Taschenrechner"
 
@@ -2517,13 +2552,11 @@
 msgstr "Wiederholen"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:306
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
 msgid "No"
 msgstr "Nein"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:307
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
 msgid "Yes"
 msgstr "Ja"
@@ -2608,7 +2641,7 @@
 msgstr "Seitenverh?ltnis:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:318
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1056
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1053
 msgid "<b>Video</b>"
 msgstr "<b>Video</b>"
 
@@ -2653,7 +2686,7 @@
 msgstr "Variable Bitrate:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:496
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1096
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1093
 msgid "<b>Audio</b>"
 msgstr "<b>Audio</b>"
 
@@ -2669,7 +2702,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
-#: avidemux/gtk_gui.cpp:2278
+#: avidemux/gtk_gui.cpp:2274
 msgid "Failed"
 msgstr "Fehlgeschlagen"
 
@@ -2745,11 +2778,11 @@
 msgid "Run Job"
 msgstr "Job starten"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:251
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:235
 msgid "Luma"
 msgstr "Brillianz"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:259
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:243
 msgid "Chroma v"
 msgstr "Farbintensit?t V"
 
@@ -2797,7 +2830,7 @@
 msgid "Extra Settings"
 msgstr "Extra Einstellungen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:449
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:450
 msgid "Equalizer"
 msgstr "Equalizer"
 
@@ -2859,31 +2892,31 @@
 msgid "Lanczos3"
 msgstr "Lanczos3"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:273
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:258
 msgid "Crop Settings"
 msgstr "Zuschnitt Einstellungen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:307
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:292
 msgid "AutoCrop"
 msgstr "Auto-Zuschnitt"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:329
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:314
 msgid "Reset"
 msgstr "Zur?ck setzen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:338
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:323
 msgid "Crop Left :"
 msgstr "Zuschnitt Links:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:346
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:331
 msgid "Crop Top:"
 msgstr "Zuschnitt Oben:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:354
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:339
 msgid "Crop Right:"
 msgstr "Zuschnitt Rechts:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:347
 msgid "Crop Bottom:"
 msgstr "Zuschnitt Unten:"
 
@@ -2892,17 +2925,17 @@
 msgstr "Video Kodierer"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:118
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1076
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1116
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1073
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1113
 msgid "Configure"
 msgstr "Konfigurieren"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:92
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:91
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:222
 msgid "Subtitle Size and Position"
 msgstr "Untertitel Gr??e und Position"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:251
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:236
 msgid "Font Size:"
 msgstr "Schriftgr??e:"
 
@@ -2984,19 +3017,21 @@
 msgid "Configure codec"
 msgstr "Konfiguriere Codec"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:437
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:427
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:370
 msgid "Input"
 msgstr "Eingang"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:438
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:428
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:374
 msgid "Output"
 msgstr "Ausgabe"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:439
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:429
 msgid "Side"
 msgstr "Seitlich"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:440
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:430
 #: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:109
 #: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:81
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:90
@@ -3004,18 +3039,17 @@
 msgid "Top"
 msgstr "Oben"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:441
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:431
 msgid "Separate"
 msgstr "Trennen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:615
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:499
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:605
 #, c-format
 msgid "Frame:%c(%02d)"
 msgstr "Bild:%c(%02d)"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:289
-#: avidemux/main.cpp:203
+#: avidemux/main.cpp:200
 msgid "_File"
 msgstr "_Datei"
 
@@ -3148,366 +3182,366 @@
 msgstr "Zoom _2:1"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:588
-msgid "Zoom _4:1"
-msgstr "Zoom _4:1"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:595
 msgid "Vi_deo"
 msgstr "Vi_deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:602
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:595
 msgid "_Decoder Options"
 msgstr "_Dekodierer Optionen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:609
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:602
 msgid "_Postprocessing"
 msgstr "Nachbearbeitung"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:612
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:605
 msgid "Select postprocessing level"
 msgstr "Nachbearbeitungsstufe ausw?hlen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:622
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:615
 msgid "P_review"
 msgstr "Vo_rschau"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:629
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:622
 msgid "Display _Output"
 msgstr "A_usgabe anzeigen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:641
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:634
 msgid "_Frame Rate"
 msgstr "Bildrate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:645
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:694
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:638
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:687
 msgid "_Encoder"
 msgstr "Kodier_er"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:652
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:645
 msgid "Fil_ters"
 msgstr "Fil_ter"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:659
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:652
 msgid "_Audio"
 msgstr "_Audio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:666
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:659
 msgid "_Main Track"
 msgstr "_Haupt-Audiospur"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:670
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:663
 msgid "_Second Track"
 msgstr "_Zweite Audiospur"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:674
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:667
 msgid "_Build VBR Time Map"
 msgstr "Erstelle VBR Zeitkarte"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:683
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:676
 msgid "S_ave..."
 msgstr "Speichern..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:701
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:694
 msgid "_Filters"
 msgstr "_Filter"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:705
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:698
 msgid "_Tools"
 msgstr "_Werkzeuge"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:712
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:705
 msgid "_Calculator"
 msgstr "_Taschenrechner"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:728
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:721
 msgid "_Rebuild Frames (I & B)"
 msgstr "Bilder neu aufbauen (I & B)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:732
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:725
 msgid "C_heck Frames (slow)"
 msgstr "Bilder ?berpr?fen (langsam)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:736
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:729
 msgid "_Bitrate Histogram"
 msgstr "_Bitrate Histogramm"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:740
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:733
 msgid "_Scan for Black Frames..."
 msgstr "_Schwarze Bilder suchen..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:749
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:742
 msgid "_VOB -> VobSub"
 msgstr "_VOB -> VobSub"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:753
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:746
 msgid "_OCR (VobSub -> srt)"
 msgstr "_OCR (VobSub -> srt)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:757
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:750
+msgid "OCR (TS->srt)"
+msgstr "OCR (TS->srt)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:754
 msgid "_Edit Glyph"
 msgstr "Schriftzeichen b_earbeiten"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:766
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:763
 msgid "_Frame Hex Dump"
 msgstr "Bild Hexadez. Abbild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:770
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:767
 msgid "A_uto"
 msgstr "A_uto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:777
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:774
 msgid "_VCD"
 msgstr "_VCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:781
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:778
 msgid "_SVCD"
 msgstr "_SVCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:785
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:782
 msgid "_DVD"
 msgstr "_DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:789
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:786
 msgid "_PSP"
 msgstr "_PSP"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:793
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:790
 msgid "PSP (_H.264)"
 msgstr "PSP (_H.264)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:797
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:794
 msgid "_Go"
 msgstr "Sprin_gen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:804
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:801
 msgid "_Play/Stop"
 msgstr "Abspielen/Anhalten"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:815
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:812
 msgid "P_revious Frame"
 msgstr "Vo_rheriges Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:826
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:823
 msgid "_Next Frame"
 msgstr "_N?chstes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:837
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:834
 msgid "Pr_evious Intra Frame"
 msgstr "Vorheriges I-Bild (keyframe)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:848
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:845
 msgid "Next _Intra Frame"
 msgstr "N?chstes I-Bild (keyframe)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:859
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:856
 msgid "Previou_s Black Frame"
 msgstr "Vorherige_s schwarzes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:863
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:860
 msgid "Ne_xt Black Frame"
 msgstr "N?_chstes schwarzes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:867
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:864
 msgid "_First Frame"
 msgstr "_Erstes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:878
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:875
 msgid "_Last Frame"
 msgstr "_Letztes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:894
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:891
 msgid "Go to Marker _A"
 msgstr "Gehe zu Marke _A"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:901
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:898
 msgid "Go to Marker _B"
 msgstr "Gehe zu Marke _B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:913
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:910
 msgid "Go to Fra_me..."
 msgstr "Springe zu _Bild..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:924
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:921
 msgid "Go to _Time..."
 msgstr "Springe zur _Zeit..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:935
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:932
 msgid "_Custom"
 msgstr "_Individuell"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:939
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:936
 msgid "_Help"
 msgstr "_Hilfe"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:946
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:943
 msgid "_Built-in Support"
 msgstr "Eingebaute Unterst?tzung"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:950
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:947
 msgid "_About"
 msgstr "Infos _?ber Avidemux"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:968
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:965
 msgid "Open a file"
 msgstr "?ffne eine Datei"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:978
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:975
 msgid "Save the file"
 msgstr "Datei speichern"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:984
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:981
 msgid "Audio/video file information"
 msgstr "Audio/Video Datei-Information"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:995
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:992
 msgid "Bitrate/size calculator"
 msgstr "Bitrate/Gr??e berechnen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1074
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1114
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1071
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1111
 msgid "Copy"
 msgstr "Kopie"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1079
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1076
 msgid "Configure video encoder"
 msgstr "Video Kodierer konfigurieren"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1084
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1140
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1081
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1137
 msgid "Filters"
 msgstr "Filter"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1087
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1084
 msgid "Video filters"
 msgstr "Video Filter"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1119
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1116
 msgid "Configure audio encoder"
 msgstr "Audio Kodierer konfigurieren"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1127
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1124
 msgid "Audio filters"
 msgstr "Audio Filter"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1148
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1145
 msgid "Shift:"
 msgstr "Verschiebung"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1151
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1148
 msgid "Enable time shift"
 msgstr "Zeitverschiebung einschalten"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1157
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1154
 msgid "Audio/video time shift (ms)"
 msgstr "A/V Zeitverschiebung (ms)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1164
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1161
 msgid "<b>Format</b>"
 msgstr "<b>Format</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1197
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1194
 msgid "<b>Selection</b>"
 msgstr "<b>Auswahl</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1214
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1222
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1211
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1219
 msgid " 0000000"
 msgstr " 0000000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1230
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1227
 msgid "A:"
 msgstr "A:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1234
 msgid "Go to marker A"
 msgstr "Gehe zu Marke A"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1239
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1236
 msgid "B:"
 msgstr "B:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1246
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1243
 msgid "Go to marker B"
 msgstr "Gehe zu Marke B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1258
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1255
 msgid "Play"
 msgstr "Abspielen"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1272
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1269
 msgid "Stop"
 msgstr "Stopp"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1284
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1281
 msgid "Previous frame"
 msgstr "Vorheriges Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1299
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1296
 msgid "Next frame"
 msgstr "N?chstes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1314
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1311
 msgid "Previous keyframe"
 msgstr "Vorheriges I-Bild (keyframe)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1329
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1326
 msgid "Next keyframe"
 msgstr "N?chstes I-Bild (keyframe)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1343
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1340
 msgid "Selection: start"
 msgstr "Auswahl: Start"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1354
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1351
 msgid "Selection: end"
 msgstr "Auswahl: Ende"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1365
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1362
 msgid "Previous black frame"
 msgstr "Vorheriges schwarzes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1376
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1373
 msgid "Next black frame"
 msgstr "N?chstes schwarzes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1387
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1384
 msgid "First frame"
 msgstr "Erstes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1398
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1395
 msgid "Last frame"
 msgstr "Letztes Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1420
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1417
 msgid "Frame: "
 msgstr "Bild:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1427
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1424
 msgid "Current frame"
 msgstr "Aktuelles Bild"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1432
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1429
 msgid "/ 0000000"
 msgstr "/ 0000000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1439
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1436
 msgid "Time: "
 msgstr " Zeit:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1446
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1443
 msgid "Current time"
 msgstr "Aktuelle Zeit"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1447
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1444
 msgid "00:00:00.000"
 msgstr "00:00:00.000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1450
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1447
 msgid "/ 00:00:00,000"
 msgstr "/ 00:00:00,000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1457
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1454
 msgid "Frame: ?"
 msgstr "Bild: ? "
 
@@ -3515,6 +3549,40 @@
 msgid "_Encoding mode:"
 msgstr "Kodi_er-Modus:"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:83
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:209
+msgid "_Bitrate (kb/s):"
+msgstr "_Bitrate (kb/s):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:97
+msgid "Single pass - constant quality"
+msgstr "Einmaliger Lauf - konstanter Quantizer"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:98
+msgid "Two pass - video size"
+msgstr "Zwei Durchl?ufe - Videogr??e"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:99
+msgid "Two pass - average bitrate"
+msgstr "Zwei Durchl?ufe - durchschnittl. Bitrate"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:214
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
+msgid "_Quantizer:"
+msgstr "_Quantizer:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:219
+msgid "_Video size (MB):"
+msgstr "_Video Gr??e (MB):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:224
+msgid "_Average bitrate (kb/s):"
+msgstr "Durchschnittl. Bitr_ate (kb/s):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:229
+msgid "-"
+msgstr "-"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:100
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:134
 msgid "_Previous"
@@ -3529,6 +3597,14 @@
 msgid "Select Color"
 msgstr "Farbe ausw?hlen"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:75
+msgid "Disable"
+msgstr "Deaktivieren"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:79
+msgid "Auto-detect"
+msgstr "Auto-Erkennung"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:123
 msgid "Video Filter Manager"
 msgstr "Video Filter Manager"
@@ -3690,28 +3766,22 @@
 msgid "Save as script"
 msgstr "Als Skript speichern"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:242
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:327
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:244
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:413
 msgid "The filter is already partial"
 msgstr "Der Filter ist bereits aufgeteilt"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:348
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:350
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:455
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:457
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:342
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:344
 msgid "Load set of filters"
 msgstr "Gesetzte Filter laden"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:363
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:464
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:357
 msgid "Nothing to save"
 msgstr "Nichts zum Speichern"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:367
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:369
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:468
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:470
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:361
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:363
 msgid "Save set of filters"
 msgstr "Gesetzte Filter speichern"
 
@@ -3755,7 +3825,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:121
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:211
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:475
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:474
 msgid "Cannot open directory as a file"
 msgstr "Kann das Verzeichnis nicht als Datei ?ffnen"
 
@@ -3791,24 +3861,7 @@
 msgid "All"
 msgstr "Alles"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
-msgid "Output file error"
-msgstr "Ausgabe-Datei Fehler"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
-#, c-format
-msgid "Could not open \"%s\" for writing."
-msgstr "Konnte \"%s\" nicht zum Schreiben ?ffnen."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:189
-msgid "Problem loading sub"
-msgstr "Problem beim Laden von Sub"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:295
-msgid "Select Glyphfile to save to"
-msgstr "Schriftzeichen-Datei zum Speichern ausw?hlen"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:181
 msgid "Sure ?"
 msgstr "Sicher ?"
 
@@ -4058,6 +4111,7 @@
 msgstr "Bibliotheken"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:178
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:394
 msgid "CPU"
 msgstr "CPU"
 
@@ -4076,13 +4130,13 @@
 msgstr "U mit V tau_schen"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:51
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:285
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:334
 #: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:72
 msgid "_Horizontal deblocking"
 msgstr "_Horizontal entblockieren"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:52
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:286
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:335
 #: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:73
 msgid "_Vertical deblocking"
 msgstr "_Vertikal entblockieren"
@@ -4092,194 +4146,246 @@
 msgid "_Deringing"
 msgstr "_De-Ringing"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:170
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:188
 msgid "_Use systray while encoding"
 msgstr "Systemablage w?hrend des Kodierens ben_utzen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:171
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:189
 msgid "_Accept non-standard audio frequency for DVD"
 msgstr "Erlaube _Nicht-Standard Audio-Frequenz f?r DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:172
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:190
 msgid "_Use libavcodec MPEG-2 decoder"
 msgstr ""
 "MPEG Dekodierer libavcodec ben_utzen \n"
 "(ggf. Probleme bei Videos im Halbbildmodus!)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:173
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:191
 msgid "Create _OpenDML files"
 msgstr "_OpenDML-Dateien erstellen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:174
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
 msgid "Automatically _index MPEG files"
 msgstr "MPEG-Dateien automatisch _indizieren"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:175
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
 msgid "Automatically _swap A and B if A>B"
 msgstr "Automatisch A mit B tauschen, wenn A > B"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:176
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:194
 msgid "_Disable NUV audio sync"
 msgstr "NUV Audio-Sync _deaktivieren"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:177
-msgid "_Load external filters"
-msgstr "Externe Filter _laden"
-
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:179
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:196
 msgid "Automatically _build VBR map"
 msgstr "VBR-Zeitkarte automatisch _erstellen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:180
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:197
 msgid "Automatically _rebuild index"
 msgstr "Index automatisch wieder erstellen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:181
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
 msgid "Automatically remove _packed bitstream"
 msgstr "Ge_packten Bitstream automatisch entfernen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:183
-msgid "_Number of threads:"
-msgstr "A_nzahl der Threads:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:202
+msgid "Enable all SIMD"
+msgstr "Alle SIMD aktivieren"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:187
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
+msgid "SIMD"
+msgstr "SIMD"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:206
+msgid "Enable "
+msgstr "Aktivieren"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:219
+msgid "_lavc threads:"
+msgstr "_lavc Threads:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:220
+msgid "_x264 threads:"
+msgstr "_x264 Threads:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:221
+msgid "X_vid threads:"
+msgstr "X_vid Threads:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:223
+msgid "Multi-threading"
+msgstr "Multi-Threading"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:230
 msgid "Above normal"
 msgstr "?ber normal"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:189
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:232
 msgid "Below normal"
 msgstr "Unter normal"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:235
 msgid "_Encoding priority:"
 msgstr "Kodi_erungspriorit?t:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:236
 msgid "_Indexing/unpacking priority:"
 msgstr "_Indizieren/Entpacken Priorit?t:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:194
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:237
 msgid "_Playback priority:"
 msgstr "_Wiedergabe Priorit?t:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:196
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:239
+msgid "Prioritisation"
+msgstr "Priorisierung"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:244
 msgid "_Split MPEG files every (MB):"
 msgstr "Mpeg_s aufteilen alle (MB):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:246
 msgid "_Use alternative tag for MP3 in .mp4"
 msgstr "Alternatives 'Tag' f?r MP3 in .mp4 ben_utzen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:201
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:249
 msgid "GTK+ (slow)"
 msgstr "Gtk+ (langsam)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:251
 msgid "XVideo (best)"
 msgstr "XVideo (bestens)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:207
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:255
 msgid "SDL (GDI)"
 msgstr "SDL (GDI)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:208
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:256
 msgid "SDL (DirectX)"
 msgstr "SDL (DirectX)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:210
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:258
 msgid "SDL (good)"
 msgstr "SDL (gut)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:214
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:262
 msgid "Video _display:"
 msgstr "Video-Anzeige:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:219
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:267
 msgid "No alerts"
 msgstr "Keine Meldungen anzeigen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:268
 msgid "Display only error alerts"
 msgstr "Nur Fehlermeldungen anzeigen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:221
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:269
 msgid "Display all alerts"
 msgstr "Alle Meldungen anzeigen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:223
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:271
 msgid "_Message level:"
 msgstr "Anzeigestufe f?r Meldungen:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:276
 msgid "PCM"
 msgstr "PCM"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:229
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:277
 msgid "Master"
 msgstr "Master"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:230
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:278
 msgid "_Volume control:"
 msgstr "Lautst?rkeregler:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:235
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:283
 msgid "No downmixing"
 msgstr "Nicht herunter mischen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:285
 msgid "Pro Logic"
 msgstr "Dolby ProLogic"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:238
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:286
 msgid "Pro Logic II"
 msgstr "Dolby ProLogic II"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:240
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:288
 msgid "_Local playback downmixing:"
 msgstr "_Lokale Wiedergabe herunter mischen:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:272
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:320
 msgid "_Audio output:"
 msgstr "_Audio-Ausgabe:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:274
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:323
 msgid "ALSA _device:"
 msgstr "ALSA _Ger?t:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:287
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:336
 msgid "De_ringing"
 msgstr "De-_Ringing"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:288
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:337
 #: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:167
 msgid "_Strength:"
 msgstr "_St?rke:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:289
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:338
 msgid "Default Postprocessing"
 msgstr "Voreingestellte Nachbearbeitung"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:303
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:352
 msgid "_Filter directory:"
 msgstr "_Filter-Verzeichnis:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:308
-msgid "Use _Global GlyphSet:"
-msgstr "_Globalen Schriftzeichensatz verwenden:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:353
+msgid "_Load external filters"
+msgstr "Externe Filter _laden"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:309
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:356
+msgid "Use _Global GlyphSet"
+msgstr "_Globalen Schriftzeichensatz verwenden"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:357
 msgid "Gl_yphSet:"
 msgstr "Schrift_zeichensatz:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:343
-msgid "Global Glyphset"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:98
+msgid "User Interface"
+msgstr "Benutzerschnittstelle"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:366
+msgid "Automation"
+msgstr "Automation"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:379
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:382
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:385
+msgid "Audio"
+msgstr "Audio"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:390
+#: avidemux/gtk_gui.cpp:1996
+msgid "Video"
+msgstr "Video"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:398
+msgid "Threading"
+msgstr "Threading"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:402
+msgid "Global GlyphSet"
 msgstr "Globaler Schriftzeichensatz"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:348
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:406
 msgid "External Filters"
 msgstr "Externe Filter"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:352
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:410
 msgid "Preferences"
 msgstr "Einstellungen"
 
@@ -4379,10 +4485,6 @@
 msgid "Quantizer _blur:"
 msgstr "Quantizer _Unsch?rfe:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:98
-msgid "User Interface"
-msgstr "Benutzerschnittstelle"
-
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:108
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:86
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:89
@@ -4729,43 +4831,63 @@
 msgid "Timecode:"
 msgstr "Zeitcode:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:92
 msgid "Select idx file:"
 msgstr "IDX-Datei ausw?hlen:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:83
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:93
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:210
 msgid "Use glyphset (optional):"
 msgstr "Schriftzeichensatz verwenden (optional):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:84
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:94
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:211
 msgid "Output SRT file"
 msgstr "Ausgabe SRT-Datei"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:95
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:222
 msgid "Select input and ouput files"
 msgstr "Eingabe-und Ausgabedateien ausw?hlen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:115
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:127
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:246
 msgid "The idx/sub file does not exist."
 msgstr "Die IDX-/SUB-Datei existiert nicht."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:239
 msgid "Please Select a valid output SRT file."
 msgstr "Bitte eine g?ltige SRT-Ausgabedatei ausw?hlen"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:136
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:255
 msgid "Cannot load the glyphset file."
 msgstr "Schriftzeichen-Datei kann nicht geladen werden."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:144
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:156
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:276
 msgid "Glyphset filename"
 msgstr "Dateiname f?r Schriftzeichensatz"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:146
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:158
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:278
 msgid "Save Glyph"
 msgstr "Schriftzeichen speichern"
 
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:208
+msgid "Input TS:"
+msgstr "Eingang TS:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:209
+msgid "Subtitle PID:"
+msgstr "Untertitel PID:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:233
+msgid "Please Select a valid TS file."
+msgstr "Bitte eine g?ltige TS Datei ausw?hlen."
+
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp:58
 msgid "Very Low"
 msgstr "Sehr niedrig"
@@ -5002,6 +5124,15 @@
 msgid "This script has already been successfully executed."
 msgstr "Dieses Skript wurde bereits erfolgreich ausgef?hrt."
 
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp:123
+msgid "Select Idx File"
+msgstr "Idx Datei ausw?hlen"
+
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:795
+#, c-format
+msgid "%c (%02d)"
+msgstr "%c (%02d)"
+
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:62
 msgid "Select File to Read"
 msgstr "Einzulesende Datei ausw?hlen"
@@ -5137,35 +5268,35 @@
 msgid "Could not initialize audio"
 msgstr "Kann Audio nicht initialisieren"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:143
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:154
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:142
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:153
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:94
 msgid "There is no audio track"
 msgstr "Dies ist keine Audio-Spur"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:164
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:163
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:113
 msgid "Audio track is not suitable"
 msgstr "Audio-Spur ist nicht brauchbar"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:174
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:173
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
 msgid "For VCD, audio must be 44.1 kHz MP2."
 msgstr "F?r VCD muss Audio 44.1 kHz MP2 sein"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:193
 msgid "For DVD, audio must be 48 kHz MP2, AC3 or LPCM."
 msgstr "F?r DVD muss Audio 48 kHz MP2, AC3 oder LPCM sein."
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:313
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:305
 msgid "Reuse log file ?"
 msgstr "Log-Datei wieder verwenden?"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:328
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:320
 msgid "Error in pass 1"
 msgstr "Fehler beim 1. Durchlauf"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:478
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:462
 msgid "Error in pass 2"
 msgstr "Fehler beim 2. Durchlauf"
 
@@ -5189,23 +5320,23 @@
 msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
 msgstr "F?r DVD muss Audio 48 kHz MP2 (stereo), AC3, DTS or LPCM (stereo) sein."
 
-#: avidemux/ADM_filter/filter_saveload.cpp:157
+#: avidemux/ADM_filter/filter_saveload.cpp:155
 msgid "Problem reading XML filters"
 msgstr "Problem beim Lesen von XML Filter"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:165
+#: avidemux/ADM_filter/filter_saveload.cpp:163
 msgid "No filter found"
 msgstr "Keinen Filter gefunden"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:201
+#: avidemux/ADM_filter/filter_saveload.cpp:199
 msgid "Could not find a filter"
 msgstr "Konnte keinen Filter finden"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:209
+#: avidemux/ADM_filter/filter_saveload.cpp:207
 msgid "No tag found"
 msgstr "Kein Marke gefunden"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:289
+#: avidemux/ADM_filter/filter_saveload.cpp:287
 msgid "Node not found"
 msgstr "Knoten nicht gefunden"
 
@@ -5375,15 +5506,15 @@
 msgid "PSP"
 msgstr "PSP"
 
-#: avidemux/ADM_codecs/ADM_ffmp43.cpp:52
+#: avidemux/ADM_codecs/ADM_ffmp43.cpp:45
 msgid "Internal error finding codec"
 msgstr "Interner Fehler beim Finden eines Codec"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:48
 msgid "Internal error opening codec"
 msgstr "Interner Fehler beim ?ffnen eines Codec"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:55
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:50
 msgid "Internal error with context for  codec"
 msgstr "Interner Fehler mit Kontext f?r Codec"
 
@@ -5392,40 +5523,40 @@
 msgid "Building VBR map"
 msgstr "Erstelle VBR Zeitkarte"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:236
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:238
 msgid "Select a directory"
 msgstr "Ein Verzeichnis ausw?hlen"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:502
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:504
 msgid "Uinteger"
 msgstr "Uinteger"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:517
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:519
 msgid "Float"
 msgstr "Float"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:535
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:537
 msgid "Toggle"
 msgstr "Wechseln"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:556
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:558
 msgid "No Strategy"
 msgstr "Keine Strategie"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:557
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:559
 msgid "3:2 Pulldown"
-msgstr "3:2 Abriss"
+msgstr ""
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:558
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:560
 msgid "Pal/Secam"
 msgstr "Pal/Secam"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:559
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:561
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:86
 msgid "NTSC converted from PAL"
 msgstr "NTSC konvertiert von PAL"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:561
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:563
 msgid "menu"
 msgstr "Men?"
 
@@ -5437,14 +5568,6 @@
 msgid "Do you want to print metrics on screen ?"
 msgstr "Sollen Ma?e angezeigt werden ?"
 
-#: avidemux/ADM_video/ADM_vidSRT.cpp:215
-msgid "Could not open subtitle file"
-msgstr "Untertitel-Datei kann nicht ge?ffnet werden"
-
-#: avidemux/ADM_video/ADM_vidSRT.cpp:235
-msgid "Cannot identify subtitle format"
-msgstr "Kann Untertitel-Datei nicht identifizieren"
-
 #: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:163
 msgid "_Mask"
 msgstr "_Maske"
@@ -5569,7 +5692,7 @@
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:190
 msgid "Discard closer"
-msgstr ""
+msgstr "Enger ablegen"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:191
 msgid "Replace (interpolate)"
@@ -5577,7 +5700,7 @@
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:192
 msgid "Discard longer dupe (anim?s)"
-msgstr ""
+msgstr "Weiter gespiegelt ablegen (anim?s)"
 
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:193
 msgid "Pulldown dupe removal"
@@ -5772,7 +5895,7 @@
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:86
 #: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:91
 msgid "If metric is less than identical, images are considered identical"
-msgstr ""
+msgstr "Wenn das Ma? kleiner oder identisch ist, wird davon ausgegangen, dass die Bilder identisch sind"
 
 #: avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp:87
 #: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:92
@@ -5828,10 +5951,6 @@
 msgid "_Identical:"
 msgstr "_Identisch:"
 
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
-msgid "_Quantizer:"
-msgstr "_Quantizer:"
-
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:106
 msgid "Linear blend"
 msgstr "Linear mischen"
@@ -5948,13 +6067,37 @@
 msgid "Width and height cannot be odd"
 msgstr "Breite und H?he k?nnen nicht ungerade sein"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:88
+msgid "_Logo (jpg file):"
+msgstr "_Logo (jpg Datei):"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:89
+msgid "_X Position:"
+msgstr "_X Position:"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:90
+msgid "_Y Position:"
+msgstr "_Y Position:"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:91
+msgid "_Alpha:"
+msgstr "_Alpha:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSRT.cpp:214
+msgid "Could not open subtitle file"
+msgstr "Untertitel-Datei kann nicht ge?ffnet werden"
+
+#: avidemux/ADM_videoFilter/ADM_vidSRT.cpp:234
+msgid "Cannot identify subtitle format"
+msgstr "Kann Untertitel-Datei nicht identifizieren"
+
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:204
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:230
 msgid "Fatal Error"
 msgstr "Fataler Fehler"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:204
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:230
 msgid ""
 "A fatal error has occurred.\n"
 "\n"
@@ -5964,15 +6107,15 @@
 "\n"
 "Bitte auf OK klicken um Debug-Informationen zu erstellen. Das kann einige Minuten dauern."
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:430
 msgid "Load it"
 msgstr "Lade es"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:430
 msgid "Crash file"
 msgstr "Dateiabsturz"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:424
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:431
 msgid ""
 "I have detected a crash file. \n"
 "Do you want to load it  ?\n"
@@ -6074,8 +6217,8 @@
 msgstr "Pr?fe die Rechte f?r /dev/dsp."
 
 #: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:281
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:366
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:501
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:363
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:498
 msgid "Malformed header"
 msgstr "Fehlerhafte Kopfzeilen"
 
@@ -6181,6 +6324,19 @@
 msgid "Generating VobSub file"
 msgstr "Erstelle VobSub Datei"
 
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:87
+msgid "Output file error"
+msgstr "Ausgabe-Datei Fehler"
+
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:87
+#, c-format
+msgid "Could not open \"%s\" for writing."
+msgstr "Konnte \"%s\" nicht zum Schreiben ?ffnen."
+
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:105
+msgid "Problem loading sub"
+msgstr "Problem beim Laden von Sub"
+
 #: avidemux/gui_navigate.cpp:76
 #: avidemux/gui_navigate.cpp:114
 #: avidemux/gui_navigate.cpp:390
@@ -6209,27 +6365,27 @@
 msgid "Cannot decode the frame."
 msgstr "Kann Bild nicht dekodieren."
 
-#: avidemux/gtk_gui.cpp:253
+#: avidemux/gtk_gui.cpp:251
 msgid "Select ECMAScript to Run"
 msgstr "Auszuf?hrendes ECMA-Skript ausw?hlen"
 
-#: avidemux/gtk_gui.cpp:300
-#: avidemux/gtk_gui.cpp:339
+#: avidemux/gtk_gui.cpp:298
+#: avidemux/gtk_gui.cpp:337
 msgid "Obsolete"
 msgstr "?berfl?ssig"
 
-#: avidemux/gtk_gui.cpp:367
+#: avidemux/gtk_gui.cpp:365
 msgid "Not coded in this version"
 msgstr "Nicht ?bersetzt in dieser Version"
 
-#: avidemux/gtk_gui.cpp:382
-#: avidemux/gtk_gui.cpp:387
+#: avidemux/gtk_gui.cpp:380
+#: avidemux/gtk_gui.cpp:385
 #: avidemux/gtk_gui.cpp:506
 #: avidemux/gtk_gui.cpp:509
 msgid "Select AVI File..."
 msgstr "AVI-Datei ausw?hlen..."
 
-#: avidemux/gtk_gui.cpp:442
+#: avidemux/gtk_gui.cpp:440
 msgid ""
 "This is to be used to undo packed VOP on MPEG-4.\n"
 "Continue ?"
@@ -6237,16 +6393,16 @@
 "Dies wird ben?tigt, um das Packen von VOP von Mpeg-4 zur?ckzunehmen.\n"
 "Fortfahren ?"
 
-#: avidemux/gtk_gui.cpp:444
+#: avidemux/gtk_gui.cpp:442
 msgid "Select AVI File to Write"
 msgstr "Als AVI-Datei schreiben"
 
-#: avidemux/gtk_gui.cpp:450
+#: avidemux/gtk_gui.cpp:448
 msgid "Select OGM File to Write"
 msgstr "Als OGM-Datei schreiben"
 
-#: avidemux/gtk_gui.cpp:461
-#: avidemux/gtk_gui.cpp:472
+#: avidemux/gtk_gui.cpp:452
+#: avidemux/gtk_gui.cpp:464
 msgid "Select Workbench to Save"
 msgstr "Arbeitsbereich als Projekt speichern"
 
@@ -6296,7 +6452,7 @@
 msgstr "Au?erhalb der Grenzen"
 
 #: avidemux/gtk_gui.cpp:719
-#: avidemux/gtk_gui.cpp:1911
+#: avidemux/gtk_gui.cpp:1907
 msgid "Marker A > B"
 msgstr "Marke A > B"
 
@@ -6365,281 +6521,277 @@
 "Die soeben geladene Datei enth?lt mehrere Audio-Spuren.\n"
 "Gehe zu Audio->Hauptspur und w?hle die aktive Spur aus."
 
-#: avidemux/gtk_gui.cpp:1065
+#: avidemux/gtk_gui.cpp:1038
 msgid "No audio decoder found for this file"
 msgstr "Keinen Audio Dekodierer f?r diese Datei gefunden"
 
-#: avidemux/gtk_gui.cpp:1066
+#: avidemux/gtk_gui.cpp:1039
 msgid "Save (A+V) will generate bad AVI. Save audio will work."
 msgstr "Speichern von (A+V) wird schlechtes AVI erzeugen. Speichern von Audio arbeitet gut."
 
-#: avidemux/gtk_gui.cpp:1122
+#: avidemux/gtk_gui.cpp:1098
 msgid "Something failed when appending"
 msgstr "Irgendwas ging schief beim Anh?ngen"
 
-#: avidemux/gtk_gui.cpp:1131
-#: avidemux/gtk_gui.cpp:1930
+#: avidemux/gtk_gui.cpp:1107
+#: avidemux/gtk_gui.cpp:1926
 msgid "Something bad happened (II)"
 msgstr "Irgendwas Schlimmes ist passiert (II)"
 
-#: avidemux/gtk_gui.cpp:1195
+#: avidemux/gtk_gui.cpp:1171
 msgid "Cannot save the audio in copy mode"
 msgstr "Kann im Kopie-Modus kein Audio speichern"
 
-#: avidemux/gtk_gui.cpp:1195
+#: avidemux/gtk_gui.cpp:1171
 msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "Bitte WAV PCM als Audio Codec ausw?hlen, sonst w?re die Audio-Datei Roh-PCM."
 
-#: avidemux/gtk_gui.cpp:1203
-#: avidemux/gtk_gui.cpp:1559
+#: avidemux/gtk_gui.cpp:1179
+#: avidemux/gtk_gui.cpp:1536
 msgid "Saving audio"
 msgstr "Audio speichern"
 
-#: avidemux/gtk_gui.cpp:1280
+#: avidemux/gtk_gui.cpp:1256
 msgid "Get Frame"
 msgstr "Hole Bild"
 
-#: avidemux/gtk_gui.cpp:1280
+#: avidemux/gtk_gui.cpp:1256
 msgid "Cannot get this frame to save"
 msgstr "Kann dieses Bild nicht zum zum Speichern bekommen"
 
-#: avidemux/gtk_gui.cpp:1317
+#: avidemux/gtk_gui.cpp:1293
 msgid "Mark A > B"
 msgstr "Marke A > B"
 
-#: avidemux/gtk_gui.cpp:1317
+#: avidemux/gtk_gui.cpp:1293
 msgid "Set your markers correctly."
 msgstr "Bitte Marken korrekt setzen."
 
-#: avidemux/gtk_gui.cpp:1326
+#: avidemux/gtk_gui.cpp:1302
 msgid "Saving as set of jpegs"
 msgstr "Speichern als Satz von Jpeg-Dateien"
 
-#: avidemux/gtk_gui.cpp:1332
+#: avidemux/gtk_gui.cpp:1308
 msgid "Cannot decode frame"
 msgstr "Kann Bild nicht dekodieren"
 
-#: avidemux/gtk_gui.cpp:1332
+#: avidemux/gtk_gui.cpp:1308
 msgid "Aborting."
 msgstr "Abbruch."
 
-#: avidemux/gtk_gui.cpp:1343
-#: avidemux/gtk_gui.cpp:1362
-#: avidemux/gtk_gui.cpp:2274
+#: avidemux/gtk_gui.cpp:1319
+#: avidemux/gtk_gui.cpp:1338
+#: avidemux/gtk_gui.cpp:2270
 msgid "Done"
 msgstr "Fertig"
 
-#: avidemux/gtk_gui.cpp:1343
+#: avidemux/gtk_gui.cpp:1319
 #, c-format
 msgid "Saved %d images."
 msgstr "%d Bilder gespeichert."
 
-#: avidemux/gtk_gui.cpp:1345
+#: avidemux/gtk_gui.cpp:1321
 msgid "Error"
 msgstr "Fehler"
 
-#: avidemux/gtk_gui.cpp:1345
+#: avidemux/gtk_gui.cpp:1321
 msgid "Could not save all images."
 msgstr "Konnte nicht alle Bilder speichern."
 
-#: avidemux/gtk_gui.cpp:1362
+#: avidemux/gtk_gui.cpp:1338
 #, c-format
 msgid "Saved \"%s\"."
 msgstr "\"%s\" gespeichert."
 
-#: avidemux/gtk_gui.cpp:1364
+#: avidemux/gtk_gui.cpp:1340
 msgid "BMP op failed"
 msgstr "BMP Op. misslungen"
 
-#: avidemux/gtk_gui.cpp:1364
+#: avidemux/gtk_gui.cpp:1340
 #, c-format
 msgid "Saving %s as a BMP file failed."
 msgstr "Speichern von %s als BMP-Datei ist misslungen."
 
-#: avidemux/gtk_gui.cpp:1384
-#: avidemux/gtk_gui.cpp:1450
+#: avidemux/gtk_gui.cpp:1360
+#: avidemux/gtk_gui.cpp:1426
 msgid "Failed to open the file"
 msgstr "?ffnen der Datei gescheitert"
 
-#: avidemux/gtk_gui.cpp:1384
-#: avidemux/gtk_gui.cpp:1450
+#: avidemux/gtk_gui.cpp:1360
+#: avidemux/gtk_gui.cpp:1426
 msgid "Not a WAV file?"
 msgstr "Keine WAV-Datei?"
 
-#: avidemux/gtk_gui.cpp:1385
+#: avidemux/gtk_gui.cpp:1361
 #, c-format
 msgid "WAV open file failed..."
 msgstr "?ffnen der WAV Datei gescheitert"
 
-#: avidemux/gtk_gui.cpp:1520
+#: avidemux/gtk_gui.cpp:1490
 msgid "Cannot decompress audio frame"
 msgstr "Kann Audio nicht dekomprimieren"
 
-#: avidemux/gtk_gui.cpp:1534
+#: avidemux/gtk_gui.cpp:1504
 msgid "Memory Error"
 msgstr "Speicherfehler"
 
-#: avidemux/gtk_gui.cpp:1580
+#: avidemux/gtk_gui.cpp:1557
 msgid "No frames to encode"
 msgstr "Keine Bilder zum Kodieren"
 
-#: avidemux/gtk_gui.cpp:1580
+#: avidemux/gtk_gui.cpp:1557
 msgid "Please check markers. Is \"A>\" == \">B\"?"
 msgstr "Bitte Marken ?berpr?fen. Ist \"A>\" == \">B\"?"
 
-#: avidemux/gtk_gui.cpp:1700
+#: avidemux/gtk_gui.cpp:1696
 msgid "Saving raw video stream"
 msgstr "Rohe Videodaten speichern"
 
-#: avidemux/gtk_gui.cpp:1846
+#: avidemux/gtk_gui.cpp:1842
 msgid "Checking video"
 msgstr "Video pr?fen"
 
-#: avidemux/gtk_gui.cpp:1862
+#: avidemux/gtk_gui.cpp:1858
 msgid "No error found"
 msgstr "Keinen Fehler gefunden"
 
-#: avidemux/gtk_gui.cpp:1866
+#: avidemux/gtk_gui.cpp:1862
 #, c-format
 msgid "Errors found in %u frames"
 msgstr "Fehler wurden in %u Bildern gefunden"
 
-#: avidemux/gtk_gui.cpp:1884
+#: avidemux/gtk_gui.cpp:1880
 msgid "Cannot decompress the audio stream"
 msgstr "Kann Audio-Strom nicht dekomprimieren"
 
-#: avidemux/gtk_gui.cpp:1884
+#: avidemux/gtk_gui.cpp:1880
 msgid "Switch audio codec to Copy."
 msgstr "Schalte Audio-Codec um nach Kopie."
 
-#: avidemux/gtk_gui.cpp:1911
+#: avidemux/gtk_gui.cpp:1907
 msgid "Cannot delete the selection."
 msgstr "Die Auswahl kann nicht gel?scht werden."
 
-#: avidemux/gtk_gui.cpp:1916
+#: avidemux/gtk_gui.cpp:1912
 msgid "You can't remove all frames"
 msgstr "Es k?nnen nicht alle Bilder entfernt werden"
 
-#: avidemux/gtk_gui.cpp:1992
+#: avidemux/gtk_gui.cpp:1988
 msgid "Could not get tracks info"
 msgstr "Konnte keine Spur-Infos bekommen"
 
-#: avidemux/gtk_gui.cpp:2000
-msgid "Video"
-msgstr "Video"
-
-#: avidemux/gtk_gui.cpp:2000
+#: avidemux/gtk_gui.cpp:1996
 msgid "Take audio from video file"
 msgstr "Audio-Spur von der Video-Datei nehmen"
 
-#: avidemux/gtk_gui.cpp:2001
-#: avidemux/gtk_gui.cpp:2100
+#: avidemux/gtk_gui.cpp:1997
+#: avidemux/gtk_gui.cpp:2096
 msgid "No audio"
 msgstr "Keine Audio-Spur"
 
-#: avidemux/gtk_gui.cpp:2002
-#: avidemux/gtk_gui.cpp:2101
+#: avidemux/gtk_gui.cpp:1998
+#: avidemux/gtk_gui.cpp:2097
 msgid "External AC3"
 msgstr "Externes AC3"
 
-#: avidemux/gtk_gui.cpp:2002
-#: avidemux/gtk_gui.cpp:2101
+#: avidemux/gtk_gui.cpp:1998
+#: avidemux/gtk_gui.cpp:2097
 msgid "Take audio from external AC3 file"
 msgstr "Audio-Spur von externer AC3-Datei ?bernehmen"
 
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:1999
+#: avidemux/gtk_gui.cpp:2098
 msgid "External MP3"
 msgstr "Externe MP3"
 
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:1999
+#: avidemux/gtk_gui.cpp:2098
 msgid "Take audio from external MP3 file"
 msgstr "Audio-Spur von externer MP3-Datei ?bernehmen"
 
-#: avidemux/gtk_gui.cpp:2004
-#: avidemux/gtk_gui.cpp:2103
+#: avidemux/gtk_gui.cpp:2000
+#: avidemux/gtk_gui.cpp:2099
 msgid "External WAV"
 msgstr "Externe WAV"
 
-#: avidemux/gtk_gui.cpp:2004
-#: avidemux/gtk_gui.cpp:2103
+#: avidemux/gtk_gui.cpp:2000
+#: avidemux/gtk_gui.cpp:2099
 msgid "Take audio from external WAV file"
 msgstr "Audio-Spur von externer WAV-Datei ?bernehmen"
 
-#: avidemux/gtk_gui.cpp:2008
-#: avidemux/gtk_gui.cpp:2108
+#: avidemux/gtk_gui.cpp:2004
+#: avidemux/gtk_gui.cpp:2104
 msgid "_Audio source:"
 msgstr "_Audio Quelle:"
 
-#: avidemux/gtk_gui.cpp:2012
-#: avidemux/gtk_gui.cpp:2109
+#: avidemux/gtk_gui.cpp:2008
+#: avidemux/gtk_gui.cpp:2105
 msgid "_External file:"
 msgstr "_Externe Datei:"
 
-#: avidemux/gtk_gui.cpp:2027
+#: avidemux/gtk_gui.cpp:2023
 msgid "_Track from video:"
 msgstr "_Spur vom Video:"
 
-#: avidemux/gtk_gui.cpp:2037
+#: avidemux/gtk_gui.cpp:2033
 msgid "Main Audio Track"
 msgstr "Haupt-Audio-Spur"
 
-#: avidemux/gtk_gui.cpp:2043
-#: avidemux/gtk_gui.cpp:2121
+#: avidemux/gtk_gui.cpp:2039
+#: avidemux/gtk_gui.cpp:2117
 msgid "Cannot load"
 msgstr "Kann nicht laden"
 
-#: avidemux/gtk_gui.cpp:2043
-#: avidemux/gtk_gui.cpp:2121
+#: avidemux/gtk_gui.cpp:2039
+#: avidemux/gtk_gui.cpp:2117
 msgid "The selected audio file does not exist."
 msgstr "Die ausgew?hlte Audiodatei existiert nicht."
 
-#: avidemux/gtk_gui.cpp:2118
+#: avidemux/gtk_gui.cpp:2114
 msgid "Second Audio Track"
 msgstr "Zweite Audio-Spur"
 
-#: avidemux/gtk_gui.cpp:2150
+#: avidemux/gtk_gui.cpp:2146
 msgid "Error loading the MP3 file"
 msgstr "Fehler beim Laden der MP3 Datei"
 
-#: avidemux/gtk_gui.cpp:2159
-#: avidemux/gtk_gui.cpp:2181
-#: avidemux/gtk_gui.cpp:2203
+#: avidemux/gtk_gui.cpp:2155
+#: avidemux/gtk_gui.cpp:2177
+#: avidemux/gtk_gui.cpp:2199
 msgid "Second track loaded"
 msgstr "Zweite Spur geladen"
 
-#: avidemux/gtk_gui.cpp:2173
+#: avidemux/gtk_gui.cpp:2169
 msgid "Error loading the AC3 file"
 msgstr "Fehler beim Laden der AC3 Datei"
 
-#: avidemux/gtk_gui.cpp:2195
+#: avidemux/gtk_gui.cpp:2191
 msgid "Error loading the WAV file"
 msgstr "Fehler beim Laden der WAV Datei"
 
-#: avidemux/gtk_gui.cpp:2262
+#: avidemux/gtk_gui.cpp:2258
 msgid "Saving failed"
 msgstr "Speichern gescheitert"
 
-#: avidemux/gtk_gui.cpp:2262
+#: avidemux/gtk_gui.cpp:2258
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
 msgstr "Speichern des Jobs misslungen. Vielleicht bestehen Rechte-Probleme mit  ~/.avidemux"
 
-#: avidemux/gtk_gui.cpp:2274
+#: avidemux/gtk_gui.cpp:2270
 #, c-format
 msgid "File %s has been successfully saved."
 msgstr "Datei %s wurde erfolgreich gespeichert."
 
-#: avidemux/gtk_gui.cpp:2278
+#: avidemux/gtk_gui.cpp:2274
 #, c-format
 msgid "File %s was NOT saved correctly."
 msgstr "Datei %s wurde NICHT korrekt gespeichert."
 
-#: avidemux/gtk_gui.cpp:2432
+#: avidemux/gtk_gui.cpp:2437
 msgid "AvsProxy"
 msgstr "Avs-Proxy"
 
-#: avidemux/gtk_gui.cpp:2432
+#: avidemux/gtk_gui.cpp:2437
 msgid ""
 "Failed to connect to avsproxy.\n"
 "Is it running ?"
@@ -6647,19 +6799,19 @@
 "Fehler beim Verbinden mit Avs-Proxy.\n"
 "L?uft es ?"
 
-#: avidemux/gtk_gui.cpp:2437
+#: avidemux/gtk_gui.cpp:2442
 msgid "avsproxy"
 msgstr "avsproxy"
 
-#: avidemux/gtk_gui.cpp:2465
+#: avidemux/gtk_gui.cpp:2470
 msgid "Frame type:"
 msgstr "Bildtyp:"
 
-#: avidemux/gtk_gui.cpp:2466
+#: avidemux/gtk_gui.cpp:2471
 msgid "Frame size:"
 msgstr "Bildgr??e:"
 
-#: avidemux/gtk_gui.cpp:2468
+#: avidemux/gtk_gui.cpp:2473
 msgid "Frame Hex Dump"
 msgstr "Bild hexadez. Abbild"
 
@@ -6691,7 +6843,7 @@
 "FAAC nicht vorhanden!\n"
 "Es wird f?r die Erstellung von PSP-kompatiblen Videos ben?tigt."
 
-#: avidemux/guiplay.cpp:365
+#: avidemux/guiplay.cpp:361
 msgid "Trouble initializing audio device"
 msgstr "Probleme beim Initialisieren des Audio-Ger?tes"
 
@@ -6740,6 +6892,12 @@
 "Eventuell ist sanftes Kopieren erforderlich.\n"
 " Aktivieren?"
 
+#~ msgid "Zoom _4:1"
+#~ msgstr "Zoom _4:1"
+#~ msgid "Select Glyphfile to save to"
+#~ msgstr "Schriftzeichen-Datei zum Speichern ausw?hlen"
+#~ msgid "Stack Field"
+#~ msgstr "Stapel-Feld"
 #~ msgid "<b>Glyphs</b>"
 #~ msgstr "<b>Schriftzeichen</b>"
 #~ msgid "  "
@@ -6856,10 +7014,6 @@
 #~ msgstr "Neues FPS?"
 #~ msgid "Nothing to do."
 #~ msgstr "Nichts zu tun."
-#~ msgid "Two pass - file size"
-#~ msgstr "Zwei Durchl?ufe - Dateigr??e"
-#~ msgid "Two pass - average bitrate"
-#~ msgstr "Zwei Durchl?ufe - durchschnittl. Bitrate"
 #~ msgid "Same quantizer as input"
 #~ msgstr "Gleicher Quantizer wie Eingang"
 #~ msgid "average quantizer"
@@ -6884,8 +7038,6 @@
 #~ msgstr "Gop Gr??e  (12):"
 #~ msgid "Use Xvid ratecontrol"
 #~ msgstr "Xvid Bitratenpr?fung verwenden"
-#~ msgid "0:0:0"
-#~ msgstr "0:0:0"
 #~ msgid "Field Order :"
 #~ msgstr "Feld-Reihenfolge:"
 #~ msgid "Sharp :"
@@ -6952,8 +7104,6 @@
 #~ msgstr "Zei_tverschiebung einschalten"
 #~ msgid "_Enable resampling"
 #~ msgstr "_Erlaube Resampling"
-#~ msgid "Select File"
-#~ msgstr "Datei ausw?hlen"
 #~ msgid "Done : %02d%%"
 #~ msgstr "Fertig : %02d%%"
 #~ msgid "Encoding in Progress"
@@ -7189,14 +7339,8 @@
 #~ msgstr "Ben_utze OpenDML (kein Aufteilen von AVI Dateien)"
 #~ msgid "_Reuse 2-pass log"
 #~ msgstr "2. Durchlauf-Log wieder verwenden"
-#~ msgid "Audio"
-#~ msgstr "Audio"
 #~ msgid "_Video output:"
 #~ msgstr "_Video Ausgabe:"
-#~ msgid "Threads"
-#~ msgstr "Threads"
-#~ msgid "MultiThread"
-#~ msgstr "MultiThread"
 #~ msgid "Path to external filters"
 #~ msgstr "Pfad zu externen Filtern"
 #~ msgid "Only Errors"



From mean at mail.berlios.de  Fri Aug 31 18:18:26 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 31 Aug 2007 18:18:26 +0200
Subject: [Avidemux-svn-commit] r3575 - in
	branches/avidemux_2.4_branch/avidemux: ADM_filter ADM_video
	ADM_videoFilter
Message-ID: <200708311618.l7VGIQFk023488@sheep.berlios.de>

Author: mean
Date: 2007-08-31 18:18:20 +0200 (Fri, 31 Aug 2007)
New Revision: 3575

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filter] Chris MacGregor funky filters

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-08-31 16:18:20 UTC (rev 3575)
@@ -158,6 +158,7 @@
 
         //*********************
  registerFilter("-------- Deblender ---------",VF_INVALID,2,NULL,NULL);
+//	registerFilter("---- Video Analysis Tools ----",VF_INVALID,2,NULL,NULL);
 
         REGISTERX("blendremover","Blend remover","Remove blend between previous and next picture.",VF_BLENDREMOVAL,1,blendremove_create,blendremove_script);
         REGISTERX("hardivtcremove","Hard pulldown removal","Remove IVTC that has been analog captured or resized.",VF_HARDIVTC,1,hardivtc_create,hardivtc_script);
@@ -168,6 +169,10 @@
         REGISTERX("animatedmenu","Animated Menu",
             "Create a video made of 6 mini windows, very useful to do DVD menus.",
             VF_ANIMATED,1,animated_create,animated_script);
+	REGISTERX("computeaverage","Compute Average","Compute average luma value for each pixel throughout all frames, and save to file",VF_COMPUTEAVERAGE,1,computeaverage_create,computeaverage_script);
+	REGISTERX("swissarmyknife","Swiss Army Knife","Apply operation like P'=P*A, P-A, P+A, etc. using a convolution, rolling average, image from file, or constant",VF_SWISSARMYKNIFE,1,swissarmyknife_create,swissarmyknife_script);
+	REGISTERX("threshold","Threshold","Force too-bright/too-dim pixels to 0 and the rest to 255 or vice-versa",VF_THRESHOLD,1,threshold_create,threshold_script);
+	REGISTERX("particlelist","Particle List","Identify 'particles' (groups of pixels)",VF_PARTICLELIST,1,particle_create,particle_script);
 
 // Does not work
 //        REGISTERX("unblend","Unblend by Bach",VF_UNBLEND,1,unblend_create,unblend_script);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/video_filters.h	2007-08-31 16:18:20 UTC (rev 3575)
@@ -99,6 +99,10 @@
                 VF_YADIF,
                 VF_DVBSUB,
                 VF_LOGO,
+                VF_COMPUTEAVERAGE,
+                VF_SWISSARMYKNIFE,
+                VF_THRESHOLD,
+                VF_PARTICLELIST,
                 VF_DUMMY,
                 VF_COUNT,
                 MAX_FILTER = VF_COUNT - 1,

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-08-31 16:18:20 UTC (rev 3575)
@@ -167,6 +167,7 @@
 
 
 #define GET(x) ADM_assert(couples->getCouple((char *)#x,&(_param->x)))
+#define GET2(x,t) (assert(couples->getCouple((char *)#x,&(t))),(_param->x)=(t))
 #define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
 
 #define MPLAYER_RESIZE_PREFFERED

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,531 @@
+/***************************************************************************
+                          ADM_vidComputeAverage.cpp  -  compute average of
+                                                     all frames (so it can
+                                                     later be subtracted to
+                                                     remove static
+                                                     background details)
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+ 
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+#include <math.h>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "config.h"
+#include "avi_vars.h"
+
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_filter/video_filters.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
+#include "ADM_vidComputeAverage.h"
+
+static FILTER_PARAM computeAverageParam={5,{"start_frame",
+                                            "end_frame",
+                                            "output_file",
+                                            "bias",
+                                            "display_mode"}};
+
+// This is a hack to work around the fact that the ctor & dtor get called
+// too often.  The right solution would be to arrange for the filter
+// objects to be constructed and destructed only when really necessary:
+// when a new instance of a filter is added to the list (by the user), it
+// is constructed, and when it is removed from the list (by the user), it
+// is destructed, and anything else is handled by a separate init() or
+// configure() method.  This would allow the objects to maintain a
+// persistent state in a more straightforward way.
+
+ADMVideoComputeAverage::PImap ADMVideoComputeAverage::pimap;
+
+
+SCRIPT_CREATE(computeaverage_script,ADMVideoComputeAverage,computeAverageParam);
+
+BUILD_CREATE(computeaverage_create,ADMVideoComputeAverage);
+
+ADMVideoComputeAverage::ADMVideoComputeAverage(AVDMGenericVideoStream *in,CONFcouple *couples)
+			
+{
+    _in=in;
+    memcpy(&_info,in->getInfo(),sizeof(_info));
+    _info.encoding = 1;	
+    _uncompressed = new ADMImage (_in->getInfo()->width,_in->getInfo()->height);
+    ADM_assert(_uncompressed);
+    _param=NEW (COMPUTEAVERAGE_PARAM);
+    if (couples)
+    {
+        GET(start_frame);
+        GET(end_frame);
+        char * tmp;
+        GET2(output_file, tmp);
+        GET(bias);
+        GET(display_mode);
+    }
+    else
+    {
+        _param->start_frame = 1;
+        _param->end_frame = -1;
+        _param->output_file = ADM_strdup ("");
+        _param->bias = 128;
+        _param->display_mode = DISPLAYMODE_FRAME_MINUS_AVERAGE;
+    }
+
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    // This explicit check wouldn't be necessary if there was an easier way of
+    // ensuring that we got a 0 pointer when a new map entry was auto-consed
+    // up...
+
+    if (pimap.count (couples) == 0)
+    {
+        myInfo = new PersistentInfo;
+        myInfo->conf = couples;
+        pimap [couples] = myInfo;
+    }
+    else
+    {
+        myInfo = pimap [couples];
+        if (couples)
+        {
+            if (myInfo->oldConf == couples)
+            {
+                pimap.erase (myInfo->conf);
+                myInfo->conf = myInfo->oldConf;
+                myInfo->oldConf = 0;
+            }
+            else
+            {
+                ADM_assert (myInfo->conf == couples);
+
+                if (myInfo->oldConf)
+                {
+                    pimap.erase (myInfo->oldConf);
+                    myInfo->oldConf = 0;
+                }
+            }
+        }
+    }
+
+    myInfo->refCount++;
+
+    printf ("ADMVideoComputeAverage ctor (%p, conf = %p), pi = %p, rc now %d\n",
+            this, couples, myInfo, myInfo->refCount);
+}
+
+uint8_t	ADMVideoComputeAverage::getCoupledConf (CONFcouple **couples)
+{
+
+    ADM_assert(_param);
+    *couples=new CONFcouple(computeAverageParam.nb);
+
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    printf("ADMVideoComputeAverage::getCoupledConf(): this = %p, couples = %p, "
+           "oldConf = %p (was %p), pi = %p\n",
+           this, *couples, myInfo->conf, myInfo->oldConf, myInfo);
+
+    if (myInfo->oldConf)
+        pimap.erase (myInfo->oldConf);
+    myInfo->oldConf = myInfo->conf;
+    myInfo->conf = *couples;
+    pimap [myInfo->conf] = myInfo;
+    if (myInfo->oldConf == 0)
+        pimap.erase (0);
+
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+    CSET(start_frame);
+    CSET(end_frame);
+    CSET(output_file);
+    CSET(bias);
+    CSET(display_mode);
+
+    return 1;
+
+}
+
+uint8_t ADMVideoComputeAverage::configure(AVDMGenericVideoStream *in)
+{
+    UNUSED_ARG(in);
+
+    diaElemInteger start_frame
+        (&(_param->start_frame),
+         _("_Start Frame (first frame # to include in average):"),
+         0, 0x7fffffff);
+    diaElemInteger end_frame
+        (&(_param->end_frame),
+         _("_End Frame (last frame # to include), -1 = last:"),
+         -1000000, 0x7fffffff);
+    diaElemFile output_file
+        (1, const_cast<char **>(&(_param->output_file)), _("_Output File:"));
+    diaElemSlider bias
+        (&(_param->bias),
+         _("_Bias (only for display; use 0 for "
+           "average, 128 for frame minus average):"), -256, +256);
+    diaMenuEntry tDisplayMode [] = {
+        { DISPLAYMODE_FRAME_MINUS_AVERAGE,
+          _("Current frame minus average so far"), NULL },
+        { DISPLAYMODE_AVERAGE, _("Average so far"), NULL },
+        { DISPLAYMODE_BLANK,
+          _("Display nothing (fast for batch processing)"), NULL },
+    };
+    diaElemMenu display_mode
+        (&(_param->display_mode),
+         _("Display _Mode:"),
+         sizeof (tDisplayMode) / sizeof (diaMenuEntry), tDisplayMode);
+    diaElem * elems[] = { &start_frame, &end_frame, &output_file,
+                          &bias, &display_mode };
+
+    uint8_t ret = diaFactoryRun("ComputeAverage", sizeof (elems) / sizeof (diaElem *), elems);
+    return ret;
+	
+}
+
+ADMVideoComputeAverage::~ADMVideoComputeAverage()
+{
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    myInfo->refCount--;
+    printf ("ADMVideoComputeAverage dtor (%p), conf = %p, pi = %p, rc now %d\n",
+            this, myInfo->conf, myInfo, myInfo->refCount);
+
+    if (myInfo->oldConf)
+    {
+        pimap.erase (myInfo->oldConf);
+        myInfo->oldConf = 0;
+    }
+
+    if (myInfo->refCount < 1)
+    {
+        pimap.erase (myInfo->conf);
+        delete myInfo;
+    }
+
+    DELETE(_param);
+    delete  _uncompressed;	
+    _uncompressed=NULL;
+}
+
+char * ADMVideoComputeAverage::printConf (void) 
+{
+    const int CONF_LEN = 512;
+    static char conf[CONF_LEN];
+
+    const char * display = "oops";
+    if (_param->display_mode == DISPLAYMODE_AVERAGE)
+        display = "average so far";
+    else if (_param->display_mode == DISPLAYMODE_FRAME_MINUS_AVERAGE)
+        display = "current frame minus average so far";
+    else if (_param->display_mode == DISPLAYMODE_BLANK)
+        display = "nothing (fast)";
+
+    snprintf(conf, CONF_LEN, "ComputeAverage: Average of frames %d - %d, "
+             "output to %s, display %s %+d",
+             _param->start_frame, _param->end_frame, _param->output_file,
+             display, _param->bias);
+    return conf;
+	
+}
+
+static inline
+uint8_t saturate_pixel (uint32_t pixel)
+{
+    if (pixel & 0xffffff00)
+    {
+        if (int32_t (pixel) < 0)
+            return 0;
+        else // if (pixel > 255)
+            return 255;
+    }
+
+    return pixel;
+}
+
+uint8_t ADMVideoComputeAverage::getFrameNumberNoAlloc (uint32_t frame, uint32_t *len,
+                                                       ADMImage *data, uint32_t *flags)
+{
+    if (frame >= _info.nb_frames)
+        return 0;
+
+    int debug = 0;
+
+    int curr_frame = frame + _info.orgFrame;
+    int num_frames = _info.nb_frames + _info.orgFrame;
+
+    int planesize = _info.width * _info.height;
+    uint32_t size = (planesize * 3) >> 1;
+    *len = size;
+			
+    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+        return 0;
+    ADMImage * image = _uncompressed;
+
+    uint32_t start_frame = _param->start_frame - 1;
+    uint32_t end_frame = _param->end_frame;
+    if (int32_t (end_frame) < 0)
+        end_frame = int32_t (num_frames) + int32_t (end_frame); // 0-based, thus -1 = last frame
+    else
+        --end_frame;
+
+    if (!myInfo->sums
+        || myInfo->width != _info.width || myInfo->height != _info.height
+        || myInfo->start_frame != start_frame
+        || myInfo->end_frame != end_frame)
+    {
+        printf ("ADMVideoComputeAverage: resetting; was %p %ux%u, %u..%u\n",
+                myInfo->sums, myInfo->width, myInfo->height,
+                myInfo->start_frame, myInfo->end_frame);
+
+        if (!myInfo->sums
+            || myInfo->width != _info.width || myInfo->height != _info.height)
+        {
+            myInfo->width = _info.width;
+            myInfo->height = _info.height;
+            delete[] myInfo->sums;
+            myInfo->sums = new uint32_t [planesize];
+        }
+
+        uint32_t pixremaining = planesize + 1;
+        uint32_t * sums = myInfo->sums + planesize;
+        while (--pixremaining)
+        {
+            *--sums = 0;
+        }
+
+        myInfo->frame_count = 0;
+        myInfo->most_recent_frame = -1;
+        myInfo->start_frame = start_frame;
+        myInfo->end_frame = end_frame;
+
+        printf ("ADMVideoComputeAverage: reset average; now %p %ux%u, "
+                "%u..%u\n",
+                myInfo->sums, myInfo->width, myInfo->height,
+                myInfo->start_frame, myInfo->end_frame);
+    }
+			
+    // HERE: for speed, we do luma (Y plane) only.  However, some
+    // users might want chroma, too... we should make that
+    // an option or something.
+
+    uint8_t * currp = YPLANE (image) + planesize;
+    uint8_t * destp = YPLANE (data) + planesize;
+    uint32_t * sums = myInfo->sums + planesize;
+    uint32_t pixremaining = planesize + 1;
+    int32_t bias = _param->bias;
+
+    if (curr_frame >= start_frame && curr_frame <= end_frame
+        && curr_frame != myInfo->most_recent_frame)
+    {
+        uint32_t frame_count = ++(myInfo->frame_count);
+        uint32_t half_frame_count = frame_count / 2;
+        if (debug & 2)
+            printf ("Including frame %u of %u, now have %u (%u - %u)\n",
+                    curr_frame + 1, num_frames, frame_count, start_frame, end_frame);
+
+        if (_param->display_mode == DISPLAYMODE_AVERAGE)
+        {
+            while (--pixremaining)
+            {
+                uint8_t curr = *--currp;
+                uint32_t sum = (*--sums += curr);
+
+                uint32_t avg = (sum + half_frame_count) / frame_count;
+                *--destp = saturate_pixel (avg + bias);
+            }
+        }
+        else if (_param->display_mode == DISPLAYMODE_FRAME_MINUS_AVERAGE)
+        {
+            while (--pixremaining)
+            {
+                uint8_t curr = *--currp;
+                uint32_t sum = (*--sums += curr);
+
+                uint32_t avg = (sum + half_frame_count) / frame_count;
+                *--destp = saturate_pixel (curr + bias - avg);
+            }
+        }
+        else // if (_param->display_mode == DISPLAYMODE_BLANK)
+        {
+            while (--pixremaining)
+            {
+                *--sums += *--currp;
+            }
+        }
+
+        myInfo->most_recent_frame = curr_frame;
+
+        // If we just did the last frame of the specified range, then we need
+        // to write the output file.
+
+        if (curr_frame == end_frame
+            && frame_count == end_frame - start_frame + 1)
+            write_output_file();
+    }
+    else // frame out of specified range for collecting average
+    {
+        uint32_t frame_count = myInfo->frame_count;
+        uint32_t half_frame_count = frame_count / 2;
+        if (debug & 2)
+            printf ("Using %u frame(s) (%u - %u) worth of average on frame %u of %u\n",
+                    frame_count, start_frame, end_frame, curr_frame + 1, num_frames);
+
+        if (frame_count == 0)
+        {
+            // dividing by zero is not a good idea.  Just punt.
+            return 0;
+        }
+        else if (_param->display_mode == DISPLAYMODE_AVERAGE)
+        {
+            while (--pixremaining)
+            {
+                uint32_t sum = *--sums;
+                uint32_t avg = (sum + half_frame_count) / frame_count;
+                *--destp = saturate_pixel (avg + bias);
+            }
+        }
+        else if (_param->display_mode == DISPLAYMODE_FRAME_MINUS_AVERAGE)
+        {
+            while (--pixremaining)
+            {
+                uint8_t curr = *--currp;
+                uint32_t sum = *--sums;
+
+                uint32_t avg = (sum + half_frame_count) / frame_count;
+                *--destp = saturate_pixel (curr + bias - avg);
+            }
+        }
+        else if (curr_frame > end_frame)
+        {
+            // nothing more to do
+            return 0;
+        }
+    }
+
+    if (_param->display_mode != DISPLAYMODE_BLANK)
+    {
+        // HERE: the following two lines do a luma-only-ize
+
+        memset (UPLANE (data), 128, planesize >> 2);
+        memset (VPLANE (data), 128, planesize >> 2);
+    }
+
+    data->copyInfo(image);
+    return 1;
+}
+
+void ADMVideoComputeAverage::write_output_file () const
+{
+    const char * output_file = _param->output_file;
+    if (!output_file || !*output_file)
+    {
+        printf ("ADMVideoComputeAverage: Wanted to write output file, but "
+                "no file has been specified!!\n");
+        return;
+    }
+
+    FILE * fp = fopen (output_file, "wb");
+    if (!fp)
+    {
+        perror (output_file);
+        return;
+    }
+
+    uint32_t width = myInfo->width;
+    uint32_t height = myInfo->height;
+
+    int pixelcount = width * height;
+    uint32_t * sums = myInfo->sums;
+    uint32_t pixremaining = pixelcount + 1;
+
+    FileHeader header;
+    memcpy (header.magic, "DGCMimgF", sizeof (header.magic));
+    header.width = width;
+    header.height = height;
+
+    int nwritten = fwrite (&header, sizeof (FileHeader), 1, fp);
+    if (nwritten != 1)
+    {
+        printf ("Failed to write file header to %s\n", output_file);
+        fflush (stdout);
+        perror (output_file);
+        fclose (fp);
+        unlink (output_file);
+        return;
+    }
+
+    uint32_t frame_count = myInfo->frame_count;
+
+    printf ("frame count = %u\n", frame_count);
+
+    float minavg = 1000;
+    float maxavg = -1000;
+    while (--pixremaining)
+    {
+        uint32_t sum = *sums++;
+        float avg = float (sum) / frame_count;
+
+        if (avg < minavg)
+            minavg = avg;
+        if (avg > maxavg)
+            maxavg = avg;
+
+        nwritten = fwrite (&avg, sizeof (float), 1, fp);
+        if (nwritten != 1)
+        {
+            printf ("Failed to write pixel %u to %s\n",
+                    pixelcount - pixremaining + 1, output_file);
+            fflush (stdout);
+            perror (output_file);
+            fclose (fp);
+            unlink (output_file);
+            return;
+        }
+    }
+
+    printf ("Successfully wrote %ux%u = %u floating point pixel averages "
+            "(from %.6f to %.6f) of %u frames to %s\n",
+            width, height, pixelcount, minavg, maxavg, frame_count, output_file);
+
+    fclose (fp);
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.h	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.h	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,125 @@
+/***************************************************************************
+                          ADM_vidComputeAverage.h  -  compute average of
+                                                     all frames (so it can
+                                                     later be subtracted to
+                                                     remove static
+                                                     background details)
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+#ifndef __COMPUTEAVERAGE__
+#define __COMPUTEAVERAGE__   
+
+#include <map>
+
+#include "ADM_video/ADM_cache.h"
+
+typedef struct COMPUTEAVERAGE_PARAM
+{
+    int32_t start_frame;
+    int32_t end_frame; // -1 means last frame, -2 = last - 1, ...
+    const char * output_file;
+    int32_t bias;
+    uint32_t display_mode;
+
+} COMPUTEAVERAGE_PARAM;
+
+class  ADMVideoComputeAverage : public AVDMGenericVideoStream
+{
+
+    enum DisplayMode
+    {
+        DISPLAYMODE_INVALID = 0,
+        DISPLAYMODE_FRAME_MINUS_AVERAGE,
+        DISPLAYMODE_AVERAGE,
+        DISPLAYMODE_BLANK,
+        DISPLAYMODE_COUNT
+    };
+
+ public:
+
+    struct FileHeader
+    {
+        char magic [8]; // "DGCMimg" + (is_float ? "F" : "8")
+        uint32_t width;
+        uint32_t height;
+    };
+        
+
+ protected:
+
+     // This is a hack to work around the fact that the ctor & dtor get called
+     // too often.  The right solution would be to arrange for the filter
+     // objects to be constructed and destructed only when really necessary:
+     // when a new instance of a filter is added to the list (by the user), it
+     // is constructed, and when it is removed from the list (by the user), it
+     // is destructed, and anything else is handled by a separate init() or
+     // configure() method.  This would allow the objects to maintain a
+     // persistent state in a more straightforward way.
+
+     class PersistentInfo
+     {
+     public:
+         CONFcouple *  conf;
+         CONFcouple *  oldConf;
+         uint32_t      refCount;
+
+         uint32_t *    sums;
+         uint32_t      frame_count;
+         uint32_t      width;
+         uint32_t      height;
+         uint32_t      start_frame;
+         uint32_t      end_frame;
+         uint32_t      most_recent_frame;
+
+         PersistentInfo ()
+             : conf (0),
+               oldConf (0),
+               refCount (0),
+
+               sums (0),
+               frame_count (0),
+               width (0),
+               height (0),
+               start_frame (0),
+               end_frame (0),
+               most_recent_frame (0)
+         {
+         }
+     };
+
+     typedef std::map <CONFcouple *, PersistentInfo *> PImap;
+     static PImap pimap;
+
+     PersistentInfo * myInfo;
+
+     COMPUTEAVERAGE_PARAM *  _param;
+
+     void write_output_file () const;
+
+ public:
+ 		
+     ADMVideoComputeAverage (AVDMGenericVideoStream *in, CONFcouple *setup);
+
+     ~ADMVideoComputeAverage();
+
+     virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t *len,
+                                            ADMImage *data, uint32_t *flags);
+
+     virtual uint8_t configure (AVDMGenericVideoStream *instream);
+     virtual char * printConf (void);
+     virtual uint8_t getCoupledConf (CONFcouple **couples);
+							
+ };
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,738 @@
+/***************************************************************************
+                          ADM_vidParticle.cpp  -  detect particles (groups
+                                                     of pixels)
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+ 
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+#include <math.h>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "config.h"
+#include "avi_vars.h"
+
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_encoder/adm_encoder.h"
+
+#include "ADM_filter/video_filters.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
+#include "ADM_vidParticle.h"
+
+FILE * ADMVideoParticle::outfp = 0;
+uint32_t ADMVideoParticle::last_frame_written = 0xffffffff;
+
+static FILTER_PARAM particleParam =
+{
+    10,
+    { "min_area", "max_area", "left_crop", "right_crop",          // 4
+      "top_crop", "bottom_crop", "output_format", "output_file",  // + 4 = 8
+      "camera_number", "debug"                                    // + 2 = 10
+    }
+};
+
+SCRIPT_CREATE(particle_script,ADMVideoParticle,particleParam);
+
+BUILD_CREATE(particle_create,ADMVideoParticle);
+
+ADMVideoParticle::ADMVideoParticle (AVDMGenericVideoStream *in, CONFcouple *couples)
+{
+    printf ("ADMVideoParticle ctor (%p)\n", this);
+    _in = in;
+    memcpy(&_info, in->getInfo(), sizeof(_info));
+    _info.encoding = 1;
+    _uncompressed = new ADMImage(_in->getInfo()->width, _in->getInfo()->height);
+    ADM_assert(_uncompressed);
+    _param = NEW(PARTICLE_PARAM);
+
+    if (couples)
+    {
+        GET(min_area);
+        GET(max_area);
+        GET(left_crop);
+        GET(right_crop);
+        GET(top_crop);
+        GET(bottom_crop);
+        GET(output_format);
+
+        char * tmp;
+        GET2(output_file, tmp);
+        GET(camera_number);
+        GET(debug);
+    }
+    else
+    {
+        _param->min_area = 5;
+        _param->max_area = 50000;
+        _param->left_crop = 0;
+        _param->right_crop = 0;
+        _param->top_crop = 0;
+        _param->bottom_crop = 0;
+        _param->output_format = OUTPUTFMT_FORMAT_NEW;
+        _param->output_file = ADM_strdup ("");
+        _param->camera_number = 1;
+        _param->debug = 0;
+    }
+}
+
+uint8_t	ADMVideoParticle::getCoupledConf (CONFcouple **couples)
+{
+
+    ADM_assert(_param);
+    *couples = new CONFcouple(particleParam.nb);
+
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+    CSET(min_area);
+    CSET(max_area);
+    CSET(left_crop);
+    CSET(right_crop);
+    CSET(top_crop);
+    CSET(bottom_crop);
+    CSET(output_format);
+    CSET(output_file);
+    CSET(camera_number);
+    CSET(debug);
+
+    return 1;
+
+}
+
+uint8_t ADMVideoParticle::configure(AVDMGenericVideoStream *in)
+{
+    UNUSED_ARG(in);
+
+    diaElemUInteger min_area
+        (&(_param->min_area),
+         _("Mi_nimum area for a particle to be detected:"), 1, 0x7fffffff);
+    diaElemUInteger max_area
+        (&(_param->max_area),
+         _("Ma_ximum area for a particle to be detected:"), 1, 0x7fffffff);
+
+    diaElemUInteger left_crop
+        (&(_param->left_crop),
+         _("_Left side crop (ignore particles in):"), 0, 0x7fffffff);
+    diaElemUInteger right_crop
+        (&(_param->right_crop),
+         _("_Right side crop (ignore particles in):"), 0, 0x7fffffff);
+    diaElemUInteger top_crop
+        (&(_param->top_crop),
+         _("_Top crop (ignore particles in):"), 0, 0x7fffffff);
+    diaElemUInteger bottom_crop
+        (&(_param->bottom_crop),
+         _("_Bottom crop (ignore particles in):"), 0, 0x7fffffff);
+
+    diaMenuEntry tOutputFmt [] = {
+        { OUTPUTFMT_FORMAT_NEW,
+          _("New format, preferred, good for Tracker3D"), NULL },
+        { OUTPUTFMT_FORMAT_OLD,
+          _("Old format that Tracker3D can't read directly"), NULL },
+    };
+
+    diaElemMenu output_format
+        (&(_param->output_format), _("_Output Format:"),
+         sizeof (tOutputFmt) / sizeof (diaMenuEntry), tOutputFmt);
+
+    diaElemFile output_file
+        (1, const_cast<char **>(&(_param->output_file)), _("_Output File:"));
+
+    diaElemUInteger camera_number
+        (&(_param->camera_number), _("_Camera number:"), 1, 0x7fffffff);
+
+    diaElemUInteger debug(&(_param->debug), _("_Debugging settings (bits):"),
+                          0, 0x7fffffff);
+
+    diaElem * elems[] = { &min_area, &max_area, &left_crop, &right_crop,
+                          &top_crop, &bottom_crop, &output_format,
+                          &output_file, &camera_number, &debug };
+
+    uint8_t ret = diaFactoryRun("Particle", sizeof (elems) / sizeof (diaElem *), elems);
+    return ret;
+	
+}
+
+ADMVideoParticle::~ADMVideoParticle()
+{
+    printf ("ADMVideoParticle dtor (%p)\n", this);
+    DELETE(_param);
+    delete _uncompressed;
+    _uncompressed = NULL;
+}
+
+char *ADMVideoParticle::printConf (void)
+{
+    const int CONF_LEN = 1024;
+    static char conf[CONF_LEN];
+
+    char * cptr = conf;
+
+    cptr += snprintf (conf, CONF_LEN, "ParticleList: Area=%u..%u",
+                      _param->min_area, _param->max_area);
+
+    if (_param->left_crop || _param->right_crop || _param->top_crop
+        || _param->bottom_crop)
+    {
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          ", Crop (L/R/T/B): %u/%u/%u/%u",
+                          _param->left_crop, _param->right_crop,
+                          _param->top_crop, _param->bottom_crop);
+    }
+
+    if (_param->output_file && _param->output_file[0])
+    {
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf), ", %s Output to %s",
+                          _param->output_format == OUTPUTFMT_FORMAT_OLD
+                          ? "Old" : "New", _param->output_file);
+    }
+
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), ", Camera # %u",
+                      _param->camera_number);
+
+    if (_param->debug)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          ", debug=0x%x", _param->debug);
+
+    return conf;
+}
+
+uint8_t ADMVideoParticle::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                                ADMImage *data, uint32_t *flags)
+{
+    if (frame >= _info.nb_frames)
+        return 0;
+
+    uint32_t real_frame = frame + _info.orgFrame;
+
+    uint32_t debug = _param->debug;
+
+    if (debug & 1)
+        printf ("in ADMVideoParticle::getFrameNumberNoAlloc(%d, ...)\n", frame);
+
+    uint32_t w = _info.width;
+    uint32_t h = _info.height;
+    uint32_t planesize = w * h;
+    uint32_t uvplanesize = planesize >> 2;
+    uint32_t size = planesize + (uvplanesize * 2);
+    *len = size;
+			
+    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+        return 0;
+    ADMImage * image = _uncompressed;
+
+    memset (UPLANE (data), 128, uvplanesize);
+    memset (VPLANE (data), 128, uvplanesize);
+    memset (YPLANE (data), 0, planesize);
+
+    // HERE: we should erase anything outside the ROI (region of interest),
+    // unless we decide to handle that some other way and/or place...
+
+    uint8_t * imagePixels = YPLANE (image);
+    ImageTool imtool (imagePixels, w, h, data);
+    imtool.setDebug (debug);
+    imtool.setMinArea (_param->min_area);
+    imtool.setMaxArea (_param->max_area);
+    static uint32_t particleNum = 0;
+
+    OutputFmt outfmt = static_cast <OutputFmt> (_param->output_format);
+    uint32_t camera_number = _param->camera_number;
+
+    if (!outfp && real_frame == 0
+        && _param->output_file && _param->output_file[0])
+    {
+        printf ("Preparing to write particle list to %s\n",
+                _param->output_file);
+
+        outfp = fopen (_param->output_file, "w");
+        if (!outfp)
+        {
+            perror (_param->output_file);
+        }
+        else if (real_frame == 0) // ick
+        {
+            if (outfmt == OUTPUTFMT_FORMAT_NEW)
+                fprintf (outfp, "%% Frame  Camera  X  Y  Area  Particle\n");
+            else
+                fprintf (outfp, "%% Particle  Area  X  Y  Frame\n");
+        }
+    }
+
+    for (uint32_t y = 0; y < h; y++)
+    {
+        uint8_t * pixelrow = imagePixels + (y * w);
+        for (uint32_t x = 0; x < w; x++)
+        {
+            if (imtool.goodPixel (pixelrow [x]))
+            {
+                if (imtool.autoOutline (x, y) == 0)
+                    continue;
+
+                uint32_t area = imtool.particleArea();
+                float centroid_x = imtool.particleCentroidX();
+                float centroid_y = imtool.particleCentroidY();
+                if (debug & 0x01)
+                    printf ("%d %d %.6f %.6f %d\n",
+                            ++particleNum, area, centroid_x, centroid_y,
+                            real_frame + 1);
+
+                if (!outfp || last_frame_written == real_frame)
+                    continue;
+
+                if (outfmt == OUTPUTFMT_FORMAT_NEW)
+                {
+                    fprintf (outfp, "%d %d %.6f %.6f %d %d\n",
+                             real_frame + 1, camera_number, centroid_x, centroid_y,
+                             area, ++particleNum);
+                }
+                else
+                {
+                    fprintf (outfp, "%d %d %.6f %.6f %d\n",
+                             ++particleNum, area, centroid_x, centroid_y,
+                             real_frame + 1);
+                }
+            }
+        }
+    }
+
+    last_frame_written = real_frame;
+
+    if (outfp && real_frame >= _info.nb_frames + _info.orgFrame - 1)
+    {
+        fclose (outfp);
+        outfp = 0;
+        printf ("Finished writing particle list to %s\n",
+                _param->output_file);
+    }
+
+    data->copyInfo(image);
+    return 1;
+}	                           
+
+//////////////////////////////////////////////////////////////////////////////
+
+char ImageTool::directionLetters [] = "ESWN#?";
+
+PixelOffset ImageTool::leftOffset [ImageTool::DIRECTION_COUNT] =
+{
+//     East         South        West         North
+    {  0, -1 },  {  1,  0 },  {  0,  1 },  { -1,  0 }
+};
+
+// Interesting - aheadOffset [n] == leftOffset [(n + 1) % DIRECTION_COUNT]...
+PixelOffset ImageTool::aheadOffset [ImageTool::DIRECTION_COUNT] =
+{
+//     East         South        West         North
+    {  1,  0 },  {  0,  1 },  { -1,  0 },  {  0, -1 }
+};
+
+// If we're using 4-connectedness (current implementation), then the following
+// would be treated as two independent particles; with 8-connectedness, this
+// would be a single particle with some "holes" in it.
+
+// . . . * * . . .
+// . . * * * . . .
+// . * * * . * . .
+// . * * * . * * .
+// * * * . * * * .
+// * * . * * * * .
+// . * . * * * . .
+// . . . * . . . .
+
+
+uint8_t ImageTool::autoOutline (uint32_t x, uint32_t y)
+{
+    pixelList.clear();
+
+    if (debug & 0x02)
+        printf ("autoOutline(%d,%d):", x, y);
+
+    ADM_assert (goodPixel (x, y));
+
+    uint32_t startingX = x;
+    uint32_t startingY = y;
+
+    TracingDirection direction = DIRECTION_COUNT; // deliberately invalid
+    TracingDirection newDirection = DIRECTION_EAST;
+
+    int8_t
+        Lx, Ly,  // left
+        Ax, Ay;  // ahead
+
+#if 0
+    uint32_t prevX;
+    uint32_t prevY;
+    TracingDirection startingDirection = direction;
+#endif
+
+    uint32_t pointCount = 0;
+    uint32_t pointMax = my_w * my_h; // more than that and something is wrong
+
+    do
+    {
+#if 0
+        prevX = x;
+        prevY = y;
+#endif
+
+        pixelList.push_back (PixelLoc (x, y));
+        if (debug & 0x04)
+            printf (" %c(%d,%d)%c", directionLetters [direction],
+                    x, y, directionLetters [newDirection]);
+
+        if (++pointCount >= pointMax)
+        {
+            printf ("\nUh oh!  Too many points!! (%d) (@(%d,%d), dir %c)\n",
+                    pointCount, x, y, directionLetters [direction]);
+            showStuff();
+            break;
+        }
+
+        if (newDirection != direction)
+        {
+            direction = newDirection;
+            Lx = leftOffset [direction].x;
+            Ly = leftOffset [direction].y;
+            Ax = aheadOffset [direction].x;
+            Ay = aheadOffset [direction].y;
+#define ARx (Ax + Rx)
+#define ARy (Ay + Ry)
+#define Rx  (-Lx)
+#define Ry  (-Ly)
+#define BRx (Bx + Rx)
+#define BRy (By + Ry)
+#define Bx  (-Ax)
+#define By  (-Ay)
+#define BLx (Bx + Lx)
+#define BLy (By + Ly)
+        }
+
+        if (goodPixel (x + Lx, y + Ly))
+        {
+            // Turn left
+            x += Lx;
+            y += Ly;
+            newDirection = TracingDirection ((direction + TURN_LEFT)
+                                             % DIRECTION_COUNT);
+        }
+        else if (goodPixel (x + Ax, y + Ay))
+        {
+            // Continue in same direction
+            x += Ax;
+            y += Ay;
+            // newDirection = direction;
+        }
+        else if (goodPixel (x + Rx, y + Ry))
+        {
+            // Turn right
+            x += Rx;
+            y += Ry;
+            newDirection = TracingDirection ((direction + TURN_RIGHT)
+                                             % DIRECTION_COUNT);
+        }
+#if 0
+// if we turn this on, we probably ought to be looking at the AL pixel as
+// well.  (And turn on the BR case, below?)
+
+        else if (goodPixel (x + ARx, y + ARy))
+        {
+            // Slide down one pixel and continue
+            do that!;
+        }
+#endif
+        else if (goodPixel (x + Bx, y + By))
+        {
+            // Turn around (reverse direction)
+            x += Bx;
+            y += By;
+            newDirection = TracingDirection ((direction + TURN_AROUND)
+                                             % DIRECTION_COUNT);
+        }
+#if 0
+        else if (goodPixel (x + BRx, y + BRy))
+        {
+            // Slide down one pixel and turn right
+            do that (the slide)!;
+            newDirection = TracingDirection ((direction + TURN_RIGHT)
+                                             % DIRECTION_COUNT);
+        }
+#endif
+        else
+        {
+            // Apparently there is nowhere to go.  This should happen only if
+            // we're looking at an isolated pixel (a one-pixel particle).
+
+            if (pixelList.size() > 1)
+            {
+                printf ("\nUh oh!  We're stuck, but it's not a lonely pixel!  "
+                        "(@(%d,%d), dir %c)\n",
+                        x, y, directionLetters [direction]);
+                showStuff();
+                ADM_assert (pixelList.size() > 1);
+            }
+
+            break; // we'd fall out anyway, but this is faster & more explicit
+        }
+
+    } while (x != startingX || y != startingY);
+
+    if (debug & 0x02)
+        printf (" done! %d points in all\n", pixelList.size());
+
+    // HERE: if we moved this to below the loop that does the centroid, etc.,
+    // then we could show that info and also the fill-in of the particle,
+    // based on reading the output image (if it exists).
+
+    if (debug & 0x08)
+        showStuff();
+
+    // We now do 4 things in one pass: 1. count the pixels in the particle
+    // (thus computing the area, defined as the number of pixels in the
+    // particle); 2. clear those pixels in the input image so that we don't
+    // count the particle more than once; 3. compute the centroid (defined as
+    // the point whose x is the average of all the x's in the particle, and
+    // whose y is the average of all the y's in particle); 4. if there is an
+    // output image, draw the particle in the output, with the outline
+    // highlighted.
+
+    my_particleArea = 0;
+    my_particleCentroidX = 0;
+    my_particleCentroidY = 0;
+
+    uint32_t sumOfXs = 0;
+    uint32_t sumOfYs = 0;
+    uint32_t count = 0;
+
+    PixelList::iterator plit = pixelList.begin();
+    while (plit != pixelList.end())
+    {
+        uint32_t px = plit->x;
+        uint32_t py = plit->y;
+
+        ++plit;
+
+        if (my_outImage)
+        {
+            outPixel (px, py) = 255;
+#ifdef USE_COLOR_IN_OUTPUT
+            outUPixel (px, py) = 0;
+            outVPixel (px, py) = 0;
+#endif
+        }
+
+        // We do the above (set up output pixels) first so we ensure that the
+        // outline is highlighted even if the code below has already displayed
+        // some of the pixels in the outline (due to direct or indirect
+        // adjacency to other outline pixels).
+
+        if (getPixel (px, py) == 0)
+            continue;
+
+        // If we're still here, then this pixel is part of the particle but
+        // has not yet been counted or otherwise processed.  There may be
+        // other horizontally adjacent pixels, as well, which we will also
+        // process now, if they are present - this accomplishes "filling" the
+        // particle outline (except that any pixels that were actually not
+        // "on" in the particle will be ignored).
+
+        // First, we process the pixel itself, and any pixels to the right of
+        // it (if they are on).
+
+        uint32_t startX = px;
+
+        count++;
+        sumOfXs += px;
+        sumOfYs += py;
+        getPixel (px, py) = 0; // erase to prevent being counted again
+
+        while (goodPixel (++px, py))
+        {
+            count++;
+            sumOfXs += px;
+            sumOfYs += py;
+            getPixel (px, py) = 0; // erase to prevent being counted again
+            if (my_outImage)
+                outPixel (px, py) = 128;
+        }
+
+        // Now, we process any pixels to the left of the original one (if they
+        // are on).
+
+        px = startX;
+        while (goodPixel (--px, py))
+        {
+            count++;
+            sumOfXs += px;
+            sumOfYs += py;
+            getPixel (px, py) = 0; // erase to prevent being counted again
+            if (my_outImage)
+                outPixel (px, py) = 128;
+        }
+    }
+
+    my_particleArea = count;
+
+    if (my_particleArea < my_minArea || my_particleArea > my_maxArea)
+    {
+        if (my_outImage)
+        {
+            // We need to erase the particle we just drew. :-(
+
+            plit = pixelList.begin();
+            while (plit != pixelList.end())
+            {
+                uint32_t px = plit->x;
+                uint32_t py = plit->y;
+
+                ++plit;
+
+                // First, we erase the pixel itself, and any pixels to the right of
+                // it (if they are on).
+
+                uint32_t startX = px;
+
+                while (validPixel (px, py) && outPixel (px, py))
+                    outPixel (px++, py) = 0;
+
+                // Now, we process any pixels to the left of the original one (if they
+                // are on).
+
+                px = startX;
+                while (validPixel (--px, py) && outPixel (px, py))
+                    outPixel (px, py) = 0;
+            }
+        }
+
+        return 0;
+    }
+
+    my_particleCentroidX = float (sumOfXs) / count;
+    my_particleCentroidY = float (sumOfYs) / count;
+
+    if (my_outImage)
+    {
+        uint32_t px = static_cast <uint32_t> (nearbyintf (my_particleCentroidX));
+        uint32_t py = static_cast <uint32_t> (nearbyintf (my_particleCentroidY));
+        if (validPixel (px, py))
+            outPixel (px, py) = 255;
+        else
+            printf ("################# Uh oh, about to stomp invalid centroid pixel (%d, %d)!!\n",
+                    px, py);
+#ifdef USE_COLOR_IN_OUTPUT
+        outUPixel (px, py) = 255;
+        outVPixel (px, py) = 255;
+#endif
+    }
+
+    return 1;
+}
+
+void ImageTool::showStuff () const
+{
+    uint32_t minx = 0xffffffff;
+    uint32_t miny = 0xffffffff;
+    uint32_t maxx = 0;
+    uint32_t maxy = 0;
+
+    PixelList::const_iterator plit = pixelList.begin();
+    while (plit != pixelList.end())
+    {
+        uint32_t px = plit->x;
+        uint32_t py = plit->y;
+
+        if (px < minx)
+            minx = px;
+        if (px > maxx)
+            maxx = px;
+        if (py < miny)
+            miny = py;
+        if (py > maxy)
+            maxy = py;
+
+        ++plit;
+    }
+
+    minx -= (minx > 0);
+    miny -= (miny > 0);
+    maxx += (maxx < my_w - 1);
+    maxy += (maxy < my_h - 1);
+
+    printf ("(%d..%d, %d..%d):\n", minx, maxx, miny, maxy);
+
+    for (uint32_t py = miny; py <= maxy; py++)
+    {
+        printf ("    ");
+        for (uint32_t px = minx; px <= maxx; px++)
+        {
+            if (goodPixel (px, py))
+            {
+                printf ("*");
+#if 0
+// This is now done in autoOutline() where it belongs (more so than here,
+// anyway).
+                outPixel (px, py) = 64;
+#endif
+            }
+            else
+                printf (".");
+        }
+        printf ("\n");
+    }
+
+    printf ("\nOutline (%d points):\n\n", pixelList.size());
+
+    std::string blankLine (maxx - minx + 1, '.');
+    std::vector <std::string> showOutline (maxy - miny + 1, blankLine);
+
+    plit = pixelList.begin();
+    while (plit != pixelList.end())
+    {
+        uint32_t px = plit->x;
+        uint32_t py = plit->y;
+
+        char & ch = showOutline [py - miny][px - minx];
+        if (ch == '.')
+            ch = '1';
+        else if (ch == '9')
+            ch = '+';
+        else if (ch != '+')
+            ++ch;
+
+#if 0
+// This is now done in autoOutline() where it belongs (more so than here,
+// anyway).
+        getPixel (px, py) = 0;
+        outPixel (px, py) = 255;
+        outUPixel (px, py) = 0;
+        outVPixel (px, py) = 0;
+#endif
+
+        ++plit;
+    }
+
+    std::vector <std::string>::iterator oit = showOutline.begin();
+    while (oit != showOutline.end())
+        std::cout << *oit++ << "\n";
+
+    std::cout << "\npixelList: " << pixelList << "\n\n";
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,313 @@
+/***************************************************************************
+                          ADM_vidParticle.h  -  detect particles (groups of pixels)
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+#ifndef __PARTICLE__
+#define __PARTICLE__   
+#include "ADM_video/ADM_cache.h"
+struct PARTICLE_PARAM
+{
+
+    uint32_t min_area;
+    uint32_t max_area;
+    uint32_t left_crop;
+    uint32_t right_crop;
+    uint32_t top_crop;
+    uint32_t bottom_crop;
+    uint32_t output_format;
+    const char * output_file;
+    uint32_t camera_number;
+    uint32_t debug;
+
+};
+
+class ADMVideoParticle : public AVDMGenericVideoStream
+{
+
+ protected:
+    	
+     PARTICLE_PARAM *  _param;
+
+     static FILE * outfp; // ugly, but hard to avoid
+     static uint32_t last_frame_written; // ditto
+
+ public:
+ 		
+     enum OutputFmt
+     {
+         OUTPUTFMT_INVALID = 0,
+
+         OUTPUTFMT_FORMAT_NEW,
+         OUTPUTFMT_FORMAT_OLD,
+
+         OUTPUTFMT_COUNT
+     };
+
+
+     ADMVideoParticle(  AVDMGenericVideoStream *in,CONFcouple *setup);
+
+     ~ADMVideoParticle();
+
+     virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                              ADMImage *data,uint32_t *flags);
+
+     virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
+     virtual char 		   *printConf(void);
+     virtual uint8_t 	getCoupledConf( CONFcouple **couples);
+							
+};
+
+//////////////////////////////////////////////////////////////////////////////
+
+#include <list>
+#include <vector>
+#include <iostream>
+#include <iterator>
+
+class PixelLoc
+{
+public:
+    uint16_t x;
+    uint16_t y;
+
+    PixelLoc ()
+        : x (0),
+          y (0)
+    {
+    }
+
+    PixelLoc (uint32_t a_x, uint32_t a_y)
+        : x (a_x),
+          y (a_y)
+    {
+    }
+
+    // Use this to sort by y's, then (for PixelLoc's with the same y) by x's.
+
+    class Compare
+    {
+    public:
+        int operator () (const PixelLoc & p1, const PixelLoc & p2) const
+        {
+            return ((p1.y == p2.y) ? (p1.x < p2.x) : (p1.y < p2.y));
+        }
+    };
+};
+
+// Now that we no longer need to sort the list or insert anything into it, a
+// vector should be faster.
+// typedef std::list <PixelLoc> PixelList;
+typedef std::vector <PixelLoc> PixelList;
+
+inline std::ostream &
+operator << (std::ostream & s, const PixelLoc & pl)
+{
+    return s << "(" << pl.x << "," << pl.y << ")";
+}
+
+inline std::ostream &
+operator << (std::ostream & s, const PixelList & theList)
+{
+    s << "[ ";
+    std::copy (theList.begin(), theList.end(),
+               std::ostream_iterator <PixelLoc> (s, " "));
+    s << "]";
+    return s;
+}
+
+struct PixelOffset
+{
+    int8_t x;
+    int8_t y;
+};
+
+class ImageTool
+{
+private:
+    uint8_t * my_pixels;
+    uint32_t my_w;
+    uint32_t my_h;
+    ADMImage * my_outImage;
+    uint32_t my_minArea;
+    uint32_t my_maxArea;
+    uint32_t my_particleArea;
+    float my_particleCentroidX;
+    float my_particleCentroidY;
+    uint32_t debug;
+    PixelList pixelList;
+
+    enum TracingDirection
+    {
+        // The order of the members here is important - several things depend
+        // on it!
+
+        DIRECTION_EAST,   // x + 1, y
+        DIRECTION_SOUTH,  // x    , y + 1
+        DIRECTION_WEST,   // x - 1, y
+        DIRECTION_NORTH,  // x    , y - 1
+        DIRECTION_COUNT
+    };
+
+    enum TurnDirection
+    {
+        // These values are designed to be added to TracingDirection values.
+        TURN_RIGHT = 1,
+        TURN_AROUND = 2, // reverse
+        TURN_LEFT = 3,
+    };
+
+    static char directionLetters [];
+    static PixelOffset leftOffset [DIRECTION_COUNT];
+    static PixelOffset aheadOffset [DIRECTION_COUNT];
+
+public:
+    ImageTool (uint8_t * pixels, uint32_t w, uint32_t h, ADMImage * outImage = 0)
+        : my_pixels (pixels),
+          my_w (w),
+          my_h (h),
+          my_outImage (outImage),
+          my_particleArea (0),
+          my_particleCentroidX (0),
+          my_particleCentroidY (0),
+          debug (0)
+    {
+    }
+
+    // Return true if the pixel is part of a particle.
+
+    bool goodPixel (uint8_t pixel) const
+    {
+        // HERE: If we wanted to incorporate thresholding into this step, or look
+        // for black particles on a white background, this function would be the
+        // place to make the change.
+
+        return (pixel != 0);
+    }
+
+    uint8_t & getPixel (uint32_t x, uint32_t y) const
+    {
+        return my_pixels [(y * my_w) + x];
+    }
+
+    uint8_t & getPixel (uint32_t index) const
+    {
+        return my_pixels [index];
+    }
+
+    // This one does bounds checking, and forces references "off the edge" to
+    // the nearest valid pixel - it's useful for convolutions.
+
+    uint8_t & getPixelSafely (int32_t x, int32_t y) const
+    {
+        if (x < 0)
+            x = 0;
+        else if (x >= my_w)
+            x = my_w - 1;
+
+        if (y < 0)
+            y = 0;
+        else if (y >= my_h)
+            y = my_h - 1;
+
+        return my_pixels [(y * my_w) + x];
+    }
+
+    uint8_t & getPixelSafely (uint32_t x, uint32_t y) const
+    {
+        return getPixelSafely (static_cast <int32_t> (x),
+                               static_cast <int32_t> (y));
+    }
+
+    uint8_t & outPixel (uint32_t x, uint32_t y) const
+    {
+        return YPLANE (my_outImage) [(y * my_w) + x];
+    }
+
+    uint8_t & outUPixel (uint32_t x, uint32_t y) const
+    {
+        return UPLANE (my_outImage) [((y >> 2) * my_w) + (x >> 1)];
+    }
+
+    uint8_t & outVPixel (uint32_t x, uint32_t y) const
+    {
+        return VPLANE (my_outImage) [((y >> 2) * my_w) + (x >> 1)];
+    }
+
+    bool validPixel (uint32_t x, uint32_t y) const
+    {
+        return (x < my_w && y < my_h);
+    }
+
+    bool goodPixel (uint32_t x, uint32_t y) const
+    {
+        // HERE: this might be a good place to implement ROI (region of
+        // interest) if we want that.
+
+        return (validPixel (x, y) && goodPixel (getPixel (x, y)));
+    }
+
+    uint32_t width () const
+    {
+        return my_w;
+    }
+
+    uint32_t height () const
+    {
+        return my_h;
+    }
+
+    uint32_t particleArea () const
+    {
+        return my_particleArea;
+    }
+
+    float particleCentroidX () const
+    {
+        return my_particleCentroidX;
+    }
+
+    float particleCentroidY () const
+    {
+        return my_particleCentroidY;
+    }
+
+    uint8_t autoOutline (uint32_t x, uint32_t y);
+
+    void showStuff () const;
+
+    // implementation is in ADM_vidSwissArmyKnife.cpp - nothing else uses it
+    // (currently).
+
+    template <class Oper, class Histo>
+    void convolve (const std::vector <float> & kernel,
+                   uint32_t kw, uint32_t kh, int32_t bias, const Oper & op,
+                   const Histo & histogram_in);
+
+    void setDebug (uint32_t newDebug)
+    {
+        debug = newDebug;
+    }
+
+    void setMinArea (uint32_t newMinArea)
+    {
+        my_minArea = newMinArea;
+    }
+
+    void setMaxArea (uint32_t newMaxArea)
+    {
+        my_maxArea = newMaxArea;
+    }
+};
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,2684 @@
+/***************************************************************************
+                          ADM_vidSwissArmyKnife.cpp  -  Perform one of many
+                                                        possible operations
+                             -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+ 
+#include <ctype.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <errno.h>
+#include <ADM_assert.h>
+#include <math.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+
+#include <iostream>
+#include <fstream>
+#include <iterator>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "config.h"
+#include "avi_vars.h"
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_encoder/adm_encoder.h"
+
+#include "ADM_filter/video_filters.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
+#include "ADM_vidSwissArmyKnife.h"
+#include "ADM_vidParticle.h" // for ImageTool
+#include "ADM_vidComputeAverage.h" // for ADMVideoComputeAverage::FileHeader
+
+static const int MAX_PIXEL_LUMA = 255;
+
+static FILTER_PARAM swissArmyKnifeParam =
+{
+    15,
+    { "tool", "input_type", "input_file", "load_bias",              // 4
+      "load_multiplier", "input_constant", "memory_constant_denom", // + 3 = 7
+      "init_start_frame", "init_end_frame", "init_by_rolling",      // + 3 = 10
+      "bias", "scale_from_min", "scale_from_max",                   // + 3 = 13
+      "histogram_frame_interval", "debug"                           // + 2 = 15
+    }
+};
+
+ADMVideoSwissArmyKnife::ToolMap ADMVideoSwissArmyKnife::tool_map [] =
+{
+    { TOOL_A,         "A",        "%s" },
+    { TOOL_P,         "P",        "P" },
+    { TOOL_P_MINUS_A, "P-A",      "P-%s" },
+    { TOOL_A_MINUS_P, "A-P",      "%s-P" },
+    { TOOL_P_PLUS_A,  "P+A",      "P+%s" },
+    { TOOL_P_TIMES_A, "P*A",      "P*%s" },
+    { TOOL_P_DIVBY_A, "P/A",      "P/%s" },
+    { TOOL_A_DIVBY_P, "A/P",      "%s/P" },
+    { TOOL_MIN_P_A,   "min(P,A)", "min(P,%s)" },
+    { TOOL_MAX_P_A,   "max(P,A)", "max(P,%s)" },
+
+    { TOOL_INVALID, 0, 0 }
+};
+
+// This is a hack to work around the fact that the ctor & dtor get called
+// too often.  The right solution would be to arrange for the filter
+// objects to be constructed and destructed only when really necessary:
+// when a new instance of a filter is added to the list (by the user), it
+// is constructed, and when it is removed from the list (by the user), it
+// is destructed, and anything else is handled by a separate init() or
+// configure() method.  This would allow the objects to maintain a
+// persistent state in a more straightforward way.
+
+ADMVideoSwissArmyKnife::PImap ADMVideoSwissArmyKnife::pimap;
+
+
+SCRIPT_CREATE(swissarmyknife_script,ADMVideoSwissArmyKnife,swissArmyKnifeParam);
+
+BUILD_CREATE(swissarmyknife_create,ADMVideoSwissArmyKnife);
+
+ADMVideoSwissArmyKnife::ADMVideoSwissArmyKnife(AVDMGenericVideoStream *in,CONFcouple *couples)
+			
+{
+    _in = in;
+    memcpy(&_info, in->getInfo(), sizeof(_info));
+    _info.encoding = 1;
+    _uncompressed = new ADMImage(_in->getInfo()->width, _in->getInfo()->height);
+    ADM_assert(_uncompressed);
+    _param=NEW(SWISSARMYKNIFE_PARAM);
+
+    if (couples)
+    {
+        GET(tool);
+        GET(input_type);
+
+        char * tmp;
+        GET2(input_file, tmp);
+        GET(load_bias);
+        GET(load_multiplier);
+
+        GET(input_constant);
+
+        GET(memory_constant_denom);
+        GET(init_start_frame);
+        GET(init_end_frame);
+        GET(init_by_rolling);
+
+        GET(bias);
+        GET(scale_from_min);
+        GET(scale_from_max);
+        GET(histogram_frame_interval);
+        GET(debug);
+    }
+    else
+    {
+        _param->tool = TOOL_P_MINUS_A;
+        _param->input_type = INPUT_ROLLING_AVERAGE;
+
+        _param->input_file = ADM_strdup ("");
+        _param->load_bias = 0.0;
+        _param->load_multiplier = 1.0;
+
+        _param->input_constant = 0;
+
+        _param->memory_constant_denom = 100;
+        _param->init_start_frame = 1;
+        _param->init_end_frame = 100;
+        _param->init_by_rolling = false;
+
+        _param->bias = 128;
+        _param->scale_from_min = 0;
+        _param->scale_from_max = 255;
+        _param->histogram_frame_interval = 0;
+        _param->debug = 0;
+    }
+
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    // This explicit check wouldn't be necessary if there was an easier way of
+    // ensuring that we got a 0 pointer when a new map entry was auto-consed
+    // up...
+
+    if (pimap.count (couples) == 0)
+    {
+        myInfo = new PersistentInfo;
+        myInfo->conf = couples;
+        pimap [couples] = myInfo;
+    }
+    else
+    {
+        myInfo = pimap [couples];
+        if (couples)
+        {
+            if (myInfo->oldConf == couples)
+            {
+                pimap.erase (myInfo->conf);
+                myInfo->conf = myInfo->oldConf;
+                myInfo->oldConf = 0;
+            }
+            else
+            {
+                ADM_assert (myInfo->conf == couples);
+
+                if (myInfo->oldConf)
+                {
+                    pimap.erase (myInfo->oldConf);
+                    myInfo->oldConf = 0;
+                }
+            }
+        }
+    }
+
+    myInfo->refCount++;
+
+    printf ("ADMVideoSwissArmyKnife ctor (%p, conf = %p), pi = %p, rc now %d\n",
+            this, couples, myInfo, myInfo->refCount);
+}
+
+uint8_t	ADMVideoSwissArmyKnife::getCoupledConf (CONFcouple **couples)
+{
+
+    ADM_assert(_param);
+    *couples = new CONFcouple(swissArmyKnifeParam.nb);
+
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    printf("ADMVideoSwissArmyKnife::getCoupledConf(): this = %p, couples = %p, "
+           "oldConf = %p (was %p), pi = %p\n",
+           this, *couples, myInfo->conf, myInfo->oldConf, myInfo);
+
+    if (myInfo->oldConf)
+        pimap.erase (myInfo->oldConf);
+    myInfo->oldConf = myInfo->conf;
+    myInfo->conf = *couples;
+    pimap [myInfo->conf] = myInfo;
+    if (myInfo->oldConf == 0)
+        pimap.erase (0);
+
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+    CSET(tool);
+    CSET(input_type);
+
+    CSET(input_file);
+    CSET(load_bias);
+    CSET(load_multiplier);
+
+    CSET(input_constant);
+
+    CSET(memory_constant_denom);
+    CSET(init_start_frame);
+    CSET(init_end_frame);
+    CSET(init_by_rolling);
+
+    CSET(bias);
+    CSET(scale_from_min);
+    CSET(scale_from_max);
+    CSET(histogram_frame_interval);
+    CSET(debug);
+
+    return 1;
+}
+
+uint8_t ADMVideoSwissArmyKnife::configure(AVDMGenericVideoStream *in)
+{
+    UNUSED_ARG(in);
+
+    diaMenuEntry tTool [] = {
+        { TOOL_A,          _("P' = A"), NULL },
+        { TOOL_P,          _("P' = P"), NULL },
+        { TOOL_P_MINUS_A,  _("P' = P - A"), NULL },
+        { TOOL_A_MINUS_P,  _("P' = A - P"), NULL },
+        { TOOL_P_PLUS_A,   _("P' = P + A"), NULL },
+        { TOOL_P_TIMES_A,  _("P' = P * A"), NULL },
+        { TOOL_P_DIVBY_A,  _("P' = P / A"), NULL },
+        { TOOL_A_DIVBY_P,  _("P' = A / P"), NULL },
+        { TOOL_MIN_P_A,    _("P' = min (P, A)"), NULL },
+        { TOOL_MAX_P_A,    _("P' = max (P, A)"), NULL }
+    };
+
+    diaMenuEntry tInputType [] = {
+        { INPUT_CUSTOM_CONVOLUTION,
+          _("A = convolve(P); Load convolution kernel from file"), NULL },
+        { INPUT_FILE_IMAGE_FLOAT,
+          _("A = pixel from image file as float; Load image from file"), NULL },
+        { INPUT_FILE_IMAGE_INTEGER,
+          _("A = pixel from image file as integer; Load image from file"), NULL },
+        { INPUT_CONSTANT_VALUE,
+          _("A = floating point constant value"), NULL },
+        { INPUT_ROLLING_AVERAGE,
+          _("A = rolling average of pixel: A = A*(1-alpha)+(P*alpha)"), NULL },
+    };
+
+    diaElemMenu tool
+        (&(_param->tool),
+         _("Select _Operation on each pixel P and input A:"),
+         sizeof (tTool) / sizeof (diaMenuEntry), tTool);
+    diaElemMenu input_type
+        (&(_param->input_type),
+         _("Input _Type:"),
+         sizeof (tInputType) / sizeof (diaMenuEntry), tInputType);
+
+    diaElemFile input_file
+        (0, const_cast<char **>(&(_param->input_file)),
+         _("Input _File (image or convolution kernel):"));
+    diaElemFloat load_bias
+        (&(_param->load_bias),
+         _("_Load Bias (added to each pixel\n"
+           "in file image when loaded):"),
+         -99999, +99999); // arbitrary!
+    diaElemFloat load_multiplier
+        (&(_param->load_multiplier),
+         _("Load _Multiplier (each pixel in\n"
+           "file image mult. by this when loaded):"),
+         -99999, +99999); // arbitrary!
+
+    diaElemFloat input_constant
+        (&(_param->input_constant),
+         _("Input _Constant:"), -99999, +99999); // arbitrary!
+
+    diaElemUInteger memory_constant_denom
+        (&(_param->memory_constant_denom),
+         _("Denominator of memory constant _alpha\n"
+           "(where A = (1-alpha)*A + alpha*curr_frame):"),
+         0, 0x7fffffff);
+    diaElemUInteger init_start_frame
+        (&(_param->init_start_frame),
+         _("Init _Start Frame (first frame # to use for head start):"),
+         0, 0x7fffffff);
+    diaElemUInteger init_end_frame
+        (&(_param->init_end_frame),
+         _("Init _End Frame (last frame # to use for head start):"),
+         0, 0x7fffffff);
+    diaElemToggle init_by_rolling
+        (&(_param->init_by_rolling),
+         _("Init By _Rolling (compute head start using a "
+           "rolling average rather than a straight average)"));
+
+    diaElemSlider bias
+        (&(_param->bias),
+         _("_Bias (will be added to result):"), -256, +256);
+    diaElemSlider scale_from_min
+        (&(_param->scale_from_min),
+         _("Mi_nimum value (will be scaled to 0):"), -1024, +1024);
+    diaElemSlider scale_from_max
+        (&(_param->scale_from_max),
+         _("Ma_ximum value (will be scaled to 255):"), -1024, +1024);
+    diaElemUInteger histogram_frame_interval
+        (&(_param->histogram_frame_interval),
+         _("_Histogram every N frames (0 to disable):"), 0, 0x7fffffff);
+    diaElemUInteger debug
+        (&(_param->debug), _("_Debugging settings (bits):"), 0, 0x7fffffff);
+
+    diaElem * elems[] = { &tool, &input_type, &input_file, &load_bias,
+                          &load_multiplier, &input_constant,
+                          &memory_constant_denom, &init_start_frame,
+                          &init_end_frame, &init_by_rolling,
+                          &bias, &scale_from_min, &scale_from_max,
+                          &histogram_frame_interval, &debug };
+
+    uint8_t ret = diaFactoryRun("SwissArmyKnife", sizeof (elems) / sizeof (diaElem *), elems);
+    if (ret) // 0 = cancel
+    {
+        myInfo->image_data_invalid = true;
+        myInfo->histogram_data_invalid = true;
+    }
+    return ret;
+	
+}
+
+ADMVideoSwissArmyKnife::~ADMVideoSwissArmyKnife()
+{
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    myInfo->refCount--;
+    printf ("ADMVideoSwissArmyKnife dtor (%p), conf = %p, pi = %p, rc now %d\n",
+            this, myInfo->conf, myInfo, myInfo->refCount);
+
+    if (myInfo->oldConf)
+    {
+        pimap.erase (myInfo->oldConf);
+        myInfo->oldConf = 0;
+    }
+
+    if (myInfo->refCount < 1)
+    {
+        pimap.erase (myInfo->conf);
+        delete myInfo;
+    }
+
+    DELETE(_param);
+    delete _uncompressed;
+    _uncompressed = NULL;
+}
+
+char * ADMVideoSwissArmyKnife::printConf( void) 
+{
+    const int CONF_LEN = 1024;
+    static char conf[CONF_LEN];
+
+    ToolMap * tm;
+    for (tm = tool_map; tm->outputName; tm++)
+        if (tm->toolid == _param->tool)
+            break;
+
+    char inputstr [CONF_LEN];
+    char where [256];
+    where[0] = '\0';
+    char moreinfo [256];
+    moreinfo[0] = '\0';
+    const char * input_file = _param->input_file;
+    if (!input_file || !*input_file)
+        input_file = "**** no file selected ****";
+    switch (_param->input_type)
+    {
+    case INPUT_CUSTOM_CONVOLUTION:
+        snprintf (inputstr, CONF_LEN, "convolve(P,%s)", input_file);
+        break;
+    case INPUT_FILE_IMAGE_FLOAT:
+        snprintf (inputstr, CONF_LEN,
+                  (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
+                  ? "pixel_from(%s)"
+                  : "((pixel_from(%s)%+.6f)*%.6f)",
+                  input_file, _param->load_bias, _param->load_multiplier);
+        break;
+    case INPUT_FILE_IMAGE_INTEGER:
+        snprintf (inputstr, CONF_LEN,
+                  (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
+                  ? "integer(pixel_from(%s))"
+                  : "integer((pixel_from(%s)%+.6f)*%.6f)",
+                  input_file, _param->load_bias, _param->load_multiplier);
+        break;
+    case INPUT_CONSTANT_VALUE:
+        if (int (_param->input_constant) == _param->input_constant)
+            sprintf (inputstr, "%d", int (_param->input_constant));
+        else
+            sprintf (inputstr, "%.6f", _param->input_constant);
+        break;
+    case INPUT_ROLLING_AVERAGE:
+        sprintf (inputstr, "A");
+        sprintf (where, " (where each frame, A=(A*(1-alpha))+(P*alpha), "
+                 "alpha=1/%u=%.6f)", _param->memory_constant_denom,
+                 1.0 / _param->memory_constant_denom);
+        if (_param->init_start_frame)
+            sprintf (moreinfo, ", initial A = %s avg of frames %u - %u",
+                     _param->init_by_rolling ? "rolling" : "straight",
+                     _param->init_start_frame, _param->init_end_frame);
+        break;
+    default:
+        sprintf (inputstr, "OOOPS!! (unexpected type %d)",
+                 _param->input_type);
+        break;
+    }
+
+    char * cptr = conf;
+
+    cptr += snprintf (conf, CONF_LEN, "Swiss Army Knife: P' = ");
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), tm->format, inputstr);
+    if (_param->bias)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%+d",
+                          _param->bias);
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%s", where);
+    if (_param->scale_from_min != 0 || _param->scale_from_max != 255)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          ", scaled from %d..%d to 0..255",
+                          _param->scale_from_min, _param->scale_from_max);
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%s", moreinfo);
+    if (_param->histogram_frame_interval)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          ", histogram every %u frames",
+                          _param->histogram_frame_interval);
+    if (_param->debug)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          ", debug=0x%x", _param->debug);
+    fprintf (stderr, "conf is (%d) \"%s\"\n", cptr - conf, conf);
+    return conf;
+}
+
+//==============================================================================
+
+// Note: The structure of the following code (with the template functions, and
+// the functor objects, etc.) is all about minimizing the code executed
+// per-pixel.  We need to select an input (convolution, etc.), and an
+// operation to apply that input to each pixel (P' = P - A, etc.), and
+// optionally scale the result, and optionally collect a histogram...but we
+// don't want any more if's or pointer (or reference dereferences) in the
+// per-pixel core of the loop than we absolutely must have, and we certainly
+// don't want any switches or function calls.  At the same time, we don't want
+// to duplicate the code that humans have to deal with - that's the whole
+// point of templates.  So, buckle your seat belts, because this is where C++
+// gets really fun!
+
+//==============================================================================
+
+class HistogramNull // do-nothing version
+{
+public:
+    static
+    void reset()
+    {
+    }
+    static
+    void record_input (uint8_t P)
+    {
+    }
+    static
+    void record_output (int32_t P)
+    {
+    }
+    static
+    void dump (uint32_t frame_count, uint32_t pixels_per_frame)
+    {
+    }
+    static
+    bool frame_check ()
+    {
+        return false;
+    }
+};
+
+//------------------------------------------------------------------------------
+
+class Histogram
+{
+public:
+    // Optionally, we could make this a template class with range_size a
+    // template parameter.  However, it would have to be used in more than one
+    // place, with different range sizes, for that to be worth doing.
+
+    static const int32_t input_range_size = 256; // 8 bit pixels
+    static const int32_t range_size = 1024; // This must be a power of 2!
+    static const int32_t midpoint = 128;
+    static const int32_t range_min = midpoint - (range_size / 2);
+    static const int32_t range_max = midpoint + (range_size / 2) - 1;
+    static const int32_t out_of_range_mask = ~(range_size - 1);
+
+    uint32_t * input_data;
+    uint32_t * output_data;
+    uint32_t pixels_per_frame;
+    uint32_t & frame_count;
+    uint32_t frame_interval;
+
+    // The default copy ctor and assignment operators are just fine in this
+    // case!  Also, note that the ctor allocates the memory and sets the
+    // pointers to which it is passed references, but does not keep the
+    // references (since it won't need to change those pointers again) - it
+    // keeps local copies instead, to avoid later indirections.  It does store
+    // a reference to the frame_count for use in frame_check().
+
+    Histogram (uint32_t * & input_data_ref, uint32_t * & output_data_ref,
+               uint32_t frame_interval, uint32_t & frame_count,
+               uint32_t pixels_per_frame)
+        : input_data (input_data_ref),
+          output_data (output_data_ref),
+          pixels_per_frame (pixels_per_frame),
+          frame_count (frame_count),
+          frame_interval (frame_interval)
+    {
+        if (!input_data)
+        {
+            input_data = input_data_ref = new uint32_t [input_range_size];
+            output_data = output_data_ref = new uint32_t [range_size];
+            // printf ("histogram: allocated data at %p, %p\n",
+            //         input_data, output_data);
+            reset();
+        }
+        else
+            ;// printf ("histogram: using data at %p, %p\n",
+             //         input_data, output_data);
+    }
+
+    // no dtor needed - deallocation is handled elsewhere
+
+    void reset () const
+    {
+        memset (input_data, 0, input_range_size * sizeof (input_data[0]));
+        memset (output_data, 0, range_size * sizeof (output_data[0]));
+        frame_count = 0;
+    }
+
+    void record_input (uint8_t P) const
+    {
+        input_data[P]++;
+    }
+
+    void record_output (int32_t P) const
+    {
+        P -= range_min; // scale into histogram data array index
+        if ((P & out_of_range_mask) == 0)
+        {
+            output_data[P]++;
+            return;
+        }
+
+        if (P < 0)
+            P = 0;
+        else if (P >= range_size)
+            P = range_size - 1;
+
+        output_data[P]++;
+    }
+
+    void dump () const
+    {
+        int32_t index_min = 0;
+        int32_t index_max = range_size - 1;
+        while (index_min < index_max)
+        {
+            if (output_data[index_min])
+                break;
+            ++index_min;
+        }
+        while (index_min < index_max)
+        {
+            if (output_data[index_max])
+                break;
+            --index_max;
+        }
+        
+        printf ("Swiss Army Knife Histogram for past %u frames:\n"
+                " =================== Input (0 - 255), "
+                "avg/frame over %d frames: ====================\n",
+                frame_count, frame_count);
+        do_dump (input_data, 0, 255, 0);
+        printf ("=========== Result before saturation (%d - %d), "
+                "avg/frame over %d frames: ==========\n",
+                index_min + range_min, index_max + range_min, frame_count);
+        do_dump (output_data, index_min, index_max, range_min);
+    }
+
+    // returns true if it outputs data and resets the counter, else false.
+
+    bool frame_check () const
+    {
+        if (++frame_count < frame_interval)
+        {
+            // printf ("histogram: frame %d of %d\n",
+            //         frame_count, frame_interval);
+            return false;
+        }
+
+        dump();
+        reset();
+        return true;
+    }
+
+private:
+    void do_dump (uint32_t * data, int32_t index_min, int32_t index_max,
+                  int32_t bias) const
+    {
+        // We scan the data to find the maximum value, so we can scale the
+        // bars to provide useful visual data.
+
+        uint32_t max_pixels = 0;
+        for (int32_t index = index_min; index <= index_max; index++)
+        {
+            if (data[index] > max_pixels)
+                max_pixels = data[index];
+        }
+
+        // Effectively, for each pixel-value count, we divide by the frame
+        // count to get the average number of times that pixel value occurred
+        // per frame, and then we scale the bar so that only the max number of
+        // pixels gets 100% of the bar.
+
+        const int32_t bar_max = 11; // hardcoded as %11s in printf below
+#if 0
+        max_pixels /= frame_count;
+        int32_t divisor = frame_count * max_pixels / bar_max;
+#else
+        int32_t divisor = max_pixels / bar_max;
+#endif
+
+        const int32_t columns = 4;
+        // The "+ columns" below is to round up to the total number of rows we
+        // need including partial rows; it's really "+ 1 + (columns - 1)",
+        // where the + 1 is to account for index_max being the top end of the
+        // range, not the top end + 1.
+        int32_t column_len = (index_max - index_min + columns) / columns;
+
+        int32_t column_end = index_min + column_len;
+
+        const char * bar = "*********************************************";
+        const char * bar_end = bar + strlen (bar);
+
+        for (int32_t index = index_min; index < column_end; index++)
+        {
+            int32_t index2 = index;
+            int32_t val = index + bias;
+            
+            for (int32_t column = 0;
+                 column < columns;
+                 ++column, index2 += column_len, val += column_len)
+            {
+                if (index2 > index_max)
+                    break;
+
+                int32_t dat = data[index2];
+                int32_t bar_size = dat / divisor;
+                if (bar_size == 0 && dat != 0)
+                    bar_size = 1;
+#define HISTOGRAM_SHOW_VALUES 1
+#ifdef HISTOGRAM_SHOW_VALUES
+                printf (" %5d: %6d %-11s", val, dat / frame_count, bar_end - bar_size);
+#else
+                printf (" %5d: %-11s", val, bar_end - bar_size);
+#endif
+            }
+            printf ("\n");
+        }
+    }
+};
+
+//==============================================================================
+
+template <typename Oper, typename Histo>
+void ImageTool::convolve (const std::vector <float> & kernel,
+                          uint32_t kw, uint32_t kh, int32_t bias,
+                          const Oper & op_in, const Histo & histogram_in)
+{
+    // We make local copies of the functors so that the calls below to
+    // record_input() and record_output() (for the histogram) and operator()
+    // (for the op) are accessing stack data rather than incurring yet another
+    // indirection.  When it's per-pixel, every little bit helps!
+
+    Histo histogram = histogram_in;
+    Oper op = op_in;
+
+    uint32_t sathigh = 0;
+    uint32_t satlow = 0;
+
+    // The following code is copied with little significant change (mostly
+    // just porting & performance tweaks, and adding some debugging output)
+    // from ImageJ's Convolver::convolveFloat() function.  Blame them for
+    // variable names like "uc". ;-)
+
+    // We have (for the moment) skipped the normalizing step - we assume that
+    // the scale is 1.0.
+
+    // We also assume that kw and kh are both odd.
+
+    int32_t uc = kw / 2;
+    int32_t vc = kh / 2;
+
+    uint32_t xedge = my_w - uc;
+    uint32_t yedge = my_h - vc;
+
+    for (uint32_t y = 0; y < my_h; y++)
+    {
+        bool y_is_edgy = (y < vc || y >= yedge);
+
+        for (uint32_t x = 0; x < my_w; x++)
+        {
+            float sum = 0;
+            uint32_t i = 0;
+
+            // If some of this pixel's neighbors are "off the edge" of the
+            // input image, we'll use the "safe" getPixel().
+
+            if (y_is_edgy || x < uc || x >= xedge)
+            {
+                for (int32_t v = -vc; v <= vc; v++)
+                    for (int32_t u = -uc; u <= uc; u++)
+                        sum += getPixelSafely (x + u, y + v) * kernel [i++];
+            }
+            else
+            {
+                // HERE: we could optimize this a good bit by putting
+                // &(getPixel(x - uc, y - vc)) into a pointer, then just
+                // incrementing the pointer (and adding a precomputed (my_w -
+                // uc * 2) to shift lines).  It violates the nice
+                // encapsulation provided by ImageTool, but if/when we add a
+                // SIMD version of this loop, that sure isn't going to use
+                // GetPixel()... ;-)
+
+                for (int32_t v = -vc; v <= vc; v++)
+                {
+                    int32_t offset = x + ((y + v) * my_w);
+
+                    for (int32_t u = -uc; u <= uc; u++)
+                        sum += getPixel (offset + u) * kernel [i++];
+                }
+            }
+
+            // as noted above, we're currently assuming the matrix was already
+            // normalized...
+            // sum *= scale;
+
+            int32_t P = getPixel (x, y);
+
+            histogram.record_input (P);
+
+            float A = sum;
+
+            int32_t result = op (P, A) + bias;
+
+            histogram.record_output (result);
+
+            if (result & 0xffffff00)
+            {
+                if (result < 0)
+                {
+                    result = 0;
+                    satlow++;
+                }
+                else // if (result > 255)
+                {
+                    result = 255;
+                    sathigh++;
+                }
+            }
+
+            outPixel (x, y) = result;
+        }
+    }
+
+    if (debug & 2)
+    {
+        if (satlow || sathigh)
+            printf ("    Saturated %d low, %d high\n", satlow, sathigh);
+    }
+}
+
+//==============================================================================
+
+template <typename Oper, typename Histo>
+void ADMVideoSwissArmyKnife::computeRollingAverage (ADMImage * image,
+                                                    ADMImage * data,
+                                                    uint32_t planesize,
+                                                    int32_t bias,
+                                                    const Oper & op_in,
+                                                    const Histo & histogram_in)
+{
+    // We make local copies of the functors so that the calls below to
+    // record_input() and record_output() (for the histogram) and operator()
+    // (for the op) are accessing stack data rather than incurring yet another
+    // indirection.  When it's per-pixel, every little bit helps!
+
+    Histo histogram = histogram_in;
+    Oper op = op_in;
+
+    float alpha = 1.0 / _param->memory_constant_denom;
+    float oneminusalpha = 1 - alpha;
+
+    // HERE: for speed, we do luma (Y plane) only.  However, some
+    // users might want chroma, too... we should make that
+    // an option or something.
+
+    uint8_t * currp = YPLANE (image) + planesize;
+    uint8_t * destp = YPLANE (data) + planesize;
+    float * bgp = myInfo->bg + planesize;
+    uint32_t pixremaining = planesize + 1;
+
+    uint32_t sathigh = 0;
+    uint32_t satlow = 0;
+
+    while (--pixremaining)
+    {
+        int32_t P = *--currp;
+        histogram.record_input (P);
+
+        float A = *--bgp;
+        *bgp = (A * oneminusalpha) + (P * alpha);
+
+        int32_t result = op (P, A) + bias;
+
+        histogram.record_output (result);
+
+        if (result & 0xffffff00)
+        {
+            if (result < 0)
+            {
+                result = 0;
+                satlow++;
+            }
+            else // if (result > 255)
+            {
+                result = 255;
+                sathigh++;
+            }
+        }
+
+        *--destp = result;
+    }
+
+    if (_param->debug & 2)
+    {
+        if (satlow || sathigh)
+            printf ("    Saturated %d low, %d high\n", satlow, sathigh);
+    }
+}
+
+//==============================================================================
+
+template <typename InputImageType, typename Oper, typename Histo>
+void ADMVideoSwissArmyKnife::applyImage (ADMImage * image, ADMImage * data,
+                                         uint32_t planesize, int32_t bias,
+                                         InputImageType * input_image,
+                                         const Oper & op_in,
+                                         const Histo & histogram_in)
+{
+    // We make local copies of the functors so that the calls below to
+    // record_input() and record_output() (for the histogram) and operator()
+    // (for the op) are accessing stack data rather than incurring yet another
+    // indirection.  When it's per-pixel, every little bit helps!
+
+    Histo histogram = histogram_in;
+    Oper op = op_in;
+
+    // HERE: for speed, we do luma (Y plane) only.  However, some
+    // users might want chroma, too... we should make that
+    // an option or something.
+
+    uint8_t * currp = YPLANE (image) + planesize;
+    uint8_t * destp = YPLANE (data) + planesize;
+    InputImageType * bgp = input_image + planesize;
+    uint32_t pixremaining = planesize + 1;
+
+    uint32_t sathigh = 0;
+    uint32_t satlow = 0;
+
+    while (--pixremaining)
+    {
+        int32_t P = *--currp;
+        histogram.record_input (P);
+
+        InputImageType A = *--bgp;
+        int32_t result = op (P, A) + bias;
+
+        histogram.record_output (result);
+
+        if (result & 0xffffff00)
+        {
+            if (result < 0)
+            {
+                result = 0;
+                satlow++;
+            }
+            else // if (result > 255)
+            {
+                result = 255;
+                sathigh++;
+            }
+        }
+
+        *--destp = result;
+    }
+
+    if (_param->debug & 2)
+    {
+        if (satlow || sathigh)
+            printf ("    Saturated %d low, %d high\n", satlow, sathigh);
+    }
+}
+
+//==============================================================================
+
+template <typename Oper, typename Histo>
+void ADMVideoSwissArmyKnife::applyConstant (ADMImage * image, ADMImage * data,
+                                            uint32_t planesize, int32_t bias,
+                                            const Oper & op_in,
+                                            const Histo & histogram_in)
+{
+    // We make local copies of the functors so that the calls below to
+    // record_input() and record_output() (for the histogram) and operator()
+    // (for the op) are accessing stack data rather than incurring yet another
+    // indirection.  When it's per-pixel, every little bit helps!
+
+    Histo histogram = histogram_in;
+    Oper op = op_in;
+
+    // HERE: for speed, we do luma (Y plane) only.  However, some
+    // users might want chroma, too... we should make that
+    // an option or something.
+
+    uint8_t * currp = YPLANE (image) + planesize;
+    uint8_t * destp = YPLANE (data) + planesize;
+    float A = _param->input_constant;
+    uint32_t pixremaining = planesize + 1;
+
+    uint32_t sathigh = 0;
+    uint32_t satlow = 0;
+
+    while (--pixremaining)
+    {
+        int32_t P = *--currp;
+        histogram.record_input (P);
+
+        int32_t result = op (P, A) + bias;
+
+        histogram.record_output (result);
+
+        if (result & 0xffffff00)
+        {
+            if (result < 0)
+            {
+                result = 0;
+                satlow++;
+            }
+            else // if (result > 255)
+            {
+                result = 255;
+                sathigh++;
+            }
+        }
+
+        *--destp = result;
+    }
+
+    if (_param->debug & 2)
+    {
+        if (satlow || sathigh)
+            printf ("    Saturated %d low, %d high\n", satlow, sathigh);
+    }
+}
+
+//==============================================================================
+
+class OpPequalsA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> (A + .5);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return A;
+    }
+};
+
+class OpPequalsP
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return P;
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return P;
+    }
+};
+
+class OpPequalsPminusA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (P - static_cast <int32_t> (A + .5));
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (P - A);
+    }
+};
+
+class OpPequalsAminusP
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t> (A + .5) - P);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (A - P);
+    }
+};
+
+class OpPequalsPplusA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (P + static_cast <int32_t> (A + .5));
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (P + A);
+    }
+};
+
+class OpPequalsPtimesA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> ((P * A) + .5);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (P * A);
+    }
+};
+
+class OpPequalsPdivByA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> ((P / A) + .5);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (P / A);
+    }
+};
+
+class OpPequalsAdivByP
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> ((A / P) + .5);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return (A / P);
+    }
+};
+
+class OpPequalsMinPA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        int32_t intA = static_cast <int32_t> (A + .5);
+        return ((intA > P) ? P : intA);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return ((A > P) ? P : A);
+    }
+};
+
+class OpPequalsMaxPA
+{
+public:
+    int32_t operator () (int32_t P, float A) const
+    {
+        int32_t intA = static_cast <int32_t> (A + .5);
+        return ((intA > P) ? intA : P);
+    }
+
+    int32_t operator () (int32_t P, uint8_t A) const
+    {
+        return ((A > P) ? A : P);
+    }
+};
+
+//------------------------------------------------------------------------------
+
+class OpPequalsA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> (((A - scale_min) * multiplier) + .5);
+    }
+};
+
+class OpPequalsP_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsP_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return static_cast <int32_t> (((P - scale_min) * multiplier) + .5);
+    }
+};
+
+class OpPequalsPminusA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsPminusA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((P - A) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsAminusP_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsAminusP_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((A - P) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsPplusA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsPplusA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((P + A) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsPtimesA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsPtimesA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((P * A) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsPdivByA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsPdivByA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((P / A) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsAdivByP_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsAdivByP_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((A / P) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsMinPA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsMinPA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((A > P ? P : A) - scale_min) * multiplier) + .5));
+    }
+};
+
+class OpPequalsMaxPA_Scaled
+{
+    float scale_min;
+    float multiplier;
+public:
+    OpPequalsMaxPA_Scaled (int32_t scale_min, int32_t scale_max)
+        : scale_min (scale_min),
+          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+
+    int32_t operator () (int32_t P, float A) const
+    {
+        return (static_cast <int32_t>
+                ((((A > P ? A : P) - scale_min) * multiplier) + .5));
+    }
+};
+
+//==============================================================================
+
+uint8_t ADMVideoSwissArmyKnife::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+          			ADMImage *data, uint32_t *flags)
+{
+    if (frame >= _info.nb_frames)
+        return 0;
+
+    uint32_t debug = _param->debug;
+
+    if (debug & 1)
+        printf ("in ADMVideoSwissArmyKnife::getFrameNumberNoAlloc(%d, ...)\n",
+                frame);
+
+    bool doingConvolution = (_param->input_type == INPUT_CUSTOM_CONVOLUTION);
+    bool doingRollingAvg = (_param->input_type == INPUT_ROLLING_AVERAGE);
+    bool doingFileImage = (_param->input_type == INPUT_FILE_IMAGE_FLOAT
+                           || _param->input_type == INPUT_FILE_IMAGE_INTEGER);
+    bool doingFileImageFloat = (_param->input_type == INPUT_FILE_IMAGE_FLOAT);
+    bool doingApplyConstant = (_param->input_type == INPUT_CONSTANT_VALUE);
+
+    bool needRead = false;
+    bool needFile = doingConvolution || doingFileImage;
+
+    if (needFile)
+    {
+        if (myInfo->input_file_name != _param->input_file)
+        {
+            myInfo->input_file_name = _param->input_file;
+            myInfo->input_file_mtime = 0;
+            printf ("SwissArmyKnife: new input file has been selected: %s\n",
+                    myInfo->input_file_name.c_str());
+            needRead = true;
+        }
+
+        // HERE: we should rearrange a bit to move the stat() call out to the
+        // ctor - we don't need to check it every frame!
+
+        struct stat st;
+        if (stat (myInfo->input_file_name.c_str(), &st) == -1)
+        {
+            perror (myInfo->input_file_name.c_str());
+            return 0;
+        }
+
+        if (st.st_mtime != myInfo->input_file_mtime)
+        {
+            if (!needRead && myInfo->input_file_mtime)
+                printf ("SwissArmyKnife: input file %s has been changed - "
+                        "re-reading it\n", myInfo->input_file_name.c_str());
+            needRead = true;
+            myInfo->input_file_mtime = st.st_mtime;
+        }
+        else if (!needRead && myInfo->image_data_invalid)
+            needRead = true;
+    }
+
+    FloatVector & kernel = myInfo->kernel;
+    uint32_t & kernel_w = myInfo->kernel_w;
+    uint32_t & kernel_h = myInfo->kernel_h;
+
+    uint32_t w = _info.width;
+    uint32_t h = _info.height;
+    uint32_t planesize = w * h;
+    uint32_t size = (planesize * 3) >> 1;
+    *len = size;
+			
+    if (needRead)
+    {
+        myInfo->histogram_data_invalid = true;
+
+        if (doingConvolution)
+        {
+            kernel.clear();
+            kernel_w = 0;
+            kernel_h = 0;
+
+            using namespace std;
+
+            const char * filename = myInfo->input_file_name.c_str();
+            ifstream inputStream (filename);
+            if (!inputStream)
+            {
+                printf ("SwissArmyKnife: can't open input file %s, but it "
+                        "apparently does exist...(%d)\n", filename, errno);
+                return 0;
+            }
+
+#ifndef ASSUME_SQUARE_MATRIX
+            // We read the dimensions as floats just in case they happen to be
+            // written that way (no reason to punt) - however, we do expect
+            // that anything to the right of the decimal is 0!
+
+            float dimtmp;
+            inputStream >> dimtmp;
+            kernel_w = uint32_t (dimtmp);
+            if (float (kernel_w) != dimtmp)
+                printf ("SwissArmyKnife: %s: What exactly do you expect a "
+                        "width of %f to mean?  Truncating to %d...\n",
+                        filename, dimtmp, uint32_t (dimtmp));
+            inputStream >> dimtmp;
+            kernel_h = uint32_t (dimtmp);
+            if (float (kernel_h) != dimtmp)
+                printf ("SwissArmyKnife: %s: What exactly do you expect a "
+                        "height of %f to mean?  Truncating to %d...\n",
+                        filename, dimtmp, uint32_t (dimtmp));
+            if (kernel_w < 1 || (kernel_w & 1) == 0
+                || kernel_h < 1 || (kernel_h & 1) == 0)
+            {
+                printf ("SwissArmyKnife: %s: Can't handle a convolution "
+                        "kernel with dimensions %dx%d - both dimensions "
+                        "must be odd (and positive)\n",
+                        filename, int (kernel_w), int (kernel_h));
+                myInfo->input_file_mtime = 0;  // force re-read, avoid crash
+                return 0;
+            }
+#endif
+
+            copy (istream_iterator <float> (inputStream),
+                  istream_iterator <float> (),
+                  back_inserter (kernel));
+
+#ifdef ASSUME_SQUARE_MATRIX
+            kernel_dim = uint32_t (sqrtf (kernel.size()));
+            if (kernel_dim * kernel_dim != kernel.size())
+            {
+                if ((kernel_dim + 1) * (kernel_dim + 1) == kernel.size())
+                    ++kernel_dim;
+                else
+                {
+                    printf ("SwissArmyKnife: Can't determine matrix "
+                            "dimensions to explain %d input values! "
+                            "(sqrt(%d) = %f)\n",
+                            kernel.size(), kernel.size(),
+                            sqrt (kernel.size()));
+                    kernel_dim = 0;
+                    return 0;
+                }
+            }
+#endif
+
+            printf ("SwissArmyKnife: read %d convolution kernel values "
+                    "from %s (%dx%d):\n",
+                    kernel.size(), filename, kernel_w, kernel_h);
+            if (debug & 8)
+            {
+                FloatVector::const_iterator kit = kernel.begin();
+                int count = 0;
+                while (kit != kernel.end())
+                {
+                    printf ("%.6f%c", *kit++,
+                            (++count % kernel_w) ? ' ' : '\n');
+                }
+                if (count % kernel_w)
+                    printf ("[incomplete?!]\n");
+            }
+        }
+        else // file image (not convolution)
+        {
+            ADM_assert (_param->input_type == INPUT_FILE_IMAGE_FLOAT
+                        || _param->input_type == INPUT_FILE_IMAGE_INTEGER);
+
+            const char * filename = myInfo->input_file_name.c_str();
+            FILE * fin = fopen (filename, "rb");
+            if (!fin)
+            {
+                printf ("SwissArmyKnife: can't open input file %s, but it "
+                        "apparently does exist...(%d)\n", filename, errno);
+                return 0;
+            }
+
+            ADMVideoComputeAverage::FileHeader header;
+            int nread = fread (&header, sizeof (header), 1, fin);
+            if (nread != 1 || strncmp (header.magic, "DGCMimgF", 8) != 0)
+            {
+                printf ("SwissArmyKnife: %s does not appear to be a valid "
+                        "DG/CM floating-point raw image file (produced by the "
+                        "ComputeAverage filter)\n", filename);
+                fclose (fin);
+                return 0;
+            }
+
+            uint32_t width = header.width;
+            uint32_t height = header.height;
+            uint32_t pixelcount = width * height;
+
+            if (width > 2000 || height > 2000)
+            {
+                printf ("SwissArmyKnife: invalid image dimensions "
+                        "(%dx%d) in %s\n",
+                        int (width), int (height), filename);
+                fclose (fin);
+                return 0;
+            }
+
+            myInfo->image_data_invalid = true;
+            delete [] myInfo->image_float;
+            delete [] myInfo->image_int;
+
+            myInfo->image_float = new float [pixelcount];
+
+            nread = fread (myInfo->image_float, sizeof (float), pixelcount, fin);
+            fclose (fin);
+            if (nread != pixelcount)
+            {
+                printf ("SwissArmyKnife: failed to read image data "
+                        "(%ux%u = %u) from %s (got %u)\n",
+                        width, height, pixelcount, filename, nread);
+                delete [] myInfo->image_float;
+                myInfo->image_float = 0;
+                return 0;
+            }
+
+            printf ("SwissArmyKnife: successfully loaded image data "
+                    "(%ux%u = %u) from %s\n",
+                    width, height, pixelcount, filename);
+
+            myInfo->image_int = new uint8_t [pixelcount];
+            float * floatpixp = myInfo->image_float + pixelcount;
+            uint8_t * intpixp = myInfo->image_int + pixelcount;
+
+            if (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
+            {
+                printf ("Converting %u pixels to integer values (and keeping "
+                        "the floats, too)\n", pixelcount);
+
+                ++pixelcount;
+                while (--pixelcount)
+                {
+                    *--intpixp = static_cast <uint8_t> (*--floatpixp + 0.5);
+                }
+            }
+            else
+            {
+                float load_bias = _param->load_bias;
+                float load_multiplier = _param->load_multiplier;
+
+                printf ("applying P = (P + %.6f) * %.6f to %u pixels\n",
+                        load_bias, load_multiplier, pixelcount);
+
+                ++pixelcount;
+                while (--pixelcount)
+                {
+                    float floatpix
+                        = (*--floatpixp + load_bias) * load_multiplier;
+                    *floatpixp = floatpix;
+
+                    uint8_t intpix;
+                    if (floatpix < 0)
+                        intpix = 0;
+                    else if (floatpix > 255)
+                        intpix = 255;
+                    else
+                        intpix = static_cast <uint8_t> (floatpix + 0.5);
+
+                    *--intpixp = intpix;
+                }
+            }
+
+            myInfo->image_w = width;
+            myInfo->image_h = height;
+            myInfo->image_data_invalid = false;
+        }
+    }
+    else if (doingRollingAvg)
+    {
+        if (!myInfo->bg
+            || myInfo->bg_x != w || myInfo->bg_y != h
+            || myInfo->bg_mc != _param->memory_constant_denom
+            || myInfo->bg_isf != _param->init_start_frame
+            || myInfo->bg_ief != _param->init_end_frame
+            || myInfo->bg_ibr != _param->init_by_rolling)
+        {
+            if (!myInfo->bg || myInfo->bg_x != w || myInfo->bg_y != h)
+            {
+                myInfo->bg_x = w;
+                myInfo->bg_y = h;
+                delete [] myInfo->bg;
+                myInfo->bg = new float [planesize];
+            }
+
+            myInfo->histogram_data_invalid = true;
+
+            myInfo->bg_mc = _param->memory_constant_denom;
+            myInfo->bg_isf = _param->init_start_frame;
+            myInfo->bg_ief = _param->init_end_frame;
+            myInfo->bg_ibr = _param->init_by_rolling;
+
+            if (myInfo->bg_isf && myInfo->bg_isf <= myInfo->bg_ief)
+            {
+                uint32_t do_frames = myInfo->bg_ief - myInfo->bg_isf + 1;
+
+                uint32_t firstframe = myInfo->bg_isf - 1;
+                uint32_t lastframe = myInfo->bg_ief - 1;
+                if (lastframe >= _info.nb_frames)
+                {
+                    lastframe = _info.nb_frames - 1;
+                    if (firstframe > _info.nb_frames)
+                    {
+                        firstframe = lastframe - do_frames + 1;
+                        if (firstframe > _info.nb_frames)
+                            firstframe = 0;
+                    }
+                    do_frames = lastframe - firstframe + 1;
+                }
+
+                // if (debug & 2)
+                printf ("Getting a \"head start\" on rolling average by computing %s "
+                        "%d frames of size %dx%d from %d to %d with alpha = %.5f (1/%d)\n",
+                        myInfo->bg_ibr ? "rolling average over" : "straight average of",
+                        do_frames, myInfo->bg_x, myInfo->bg_y,
+                        firstframe + 1, lastframe + 1,
+                        1.0 / myInfo->bg_mc, myInfo->bg_mc);
+
+
+                ADMImage aimage (myInfo->bg_x, myInfo->bg_y);
+
+                // HERE: for speed, we do luma (Y plane) only.  However, some
+                // users might want chroma, too... we should make that an option
+                // or something.  (...in which case bg should be big enough for
+                // all three planes.)
+
+                if (myInfo->bg_ibr)
+                {
+                    // We want to "prime" the rolling average with the values from
+                    // the first frame (rather than zeroes, which doesn't seem to
+                    // work out well).  So we do the following block just once,
+                    // but in its own scope to not collide with the locals of the
+                    // loop that follows:
+                    {
+                        uint32_t flen;
+                        uint32_t fflags = *flags;
+                        if (!_in->getFrameNumberNoAlloc (firstframe, &flen,
+                                                         &aimage, &fflags))
+                            return 0;
+
+                        uint8_t * currp = YPLANE (&aimage) + planesize;
+                        float * bgp = myInfo->bg + planesize;
+                        uint32_t pixremaining = planesize + 1;
+                        while (--pixremaining)
+                        {
+                            *--bgp = *--currp;
+                        }
+
+                        ++firstframe; // don't include this one again
+                    }
+
+                    float alpha = 1.0 / _param->memory_constant_denom;
+                    float oneminusalpha = 1 - alpha;
+
+                    for (int fnum = firstframe; fnum <= lastframe; fnum++)
+                    {
+                        uint32_t flen;
+                        uint32_t fflags = *flags;
+                        if (!_in->getFrameNumberNoAlloc (fnum, &flen,
+                                                         &aimage, &fflags))
+                            return 0;
+
+                        uint8_t * currp = YPLANE (&aimage) + planesize;
+                        float * bgp = myInfo->bg + planesize;
+                        uint32_t pixremaining = planesize + 1;
+                        while (--pixremaining)
+                        {
+                            --bgp;
+                            *bgp = (*bgp * oneminusalpha) + (*--currp * alpha);
+                        }
+                    }
+                }
+                else // head start uses straight average (not rolling average)
+                {
+                    uint32_t sums [planesize];
+                    memset (sums, 0, planesize * sizeof sums[0]);
+
+                    for (int fnum = firstframe; fnum <= lastframe; fnum++)
+                    {
+                        uint32_t flen;
+                        uint32_t fflags = *flags;
+                        if (!_in->getFrameNumberNoAlloc (fnum, &flen,
+                                                         &aimage, &fflags))
+                            return 0;
+
+                        uint8_t * currp = YPLANE (&aimage) + planesize;
+                        uint32_t * sump = sums + planesize;
+                        uint32_t pixremaining = planesize + 1;
+                        while (--pixremaining)
+                        {
+                            *--sump += *--currp;
+                        }
+                    }
+
+                    float * bgp = myInfo->bg + planesize;
+                    uint32_t * sump = sums + planesize;
+                    uint32_t pixremaining = planesize + 1;
+                    // we use a floating point multiply of a reciprocal rather
+                    // than a floating point divide, because floating point
+                    // folklore says the multiply will be faster.
+                    float one_over_framecount = 1.0 / do_frames;
+                    while (--pixremaining)
+                    {
+                        *--bgp = *--sump * one_over_framecount;
+                    }
+                }
+
+                // if (debug & 2)
+                printf ("Done computing head start.\n");
+            }
+            else // if (debug & 2)
+            {
+                printf ("Starting with new 0 baseline background\n");
+                memset (myInfo->bg, 0, planesize * sizeof (myInfo->bg[0]));
+            }
+        }
+        else
+        {
+            if (debug & 4)
+                printf ("Using existing baseline background of size %dx%d with "
+                        "alpha = %.5f (1/%d)\n", myInfo->bg_x, myInfo->bg_y,
+                        1.0 / myInfo->bg_mc, myInfo->bg_mc);
+        }
+    }			
+
+    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+        return 0;
+
+    ADMImage * image = _uncompressed;
+    uint8_t * imagePixels = YPLANE (image);
+
+    ImageTool imtool (imagePixels, w, h, data);
+    imtool.setDebug (debug);
+
+    Histogram * histogram = 0;
+    int32_t bias = _param->bias;
+    uint32_t tool = _param->tool;
+
+    // HERE: give some thought to the general issue of keeping myInfo & _param
+    // in sync, and resetting the histogram (or whatever) when things change.
+
+    if (_param->histogram_frame_interval != 0)
+    {
+        histogram = new Histogram (myInfo->histogram_input_data,
+                                   myInfo->histogram_output_data,
+                                   _param->histogram_frame_interval,
+                                   myInfo->histogram_frame_count,
+                                   w * h);
+        tool += TOOL_ADD_HISTOGRAM;
+        if (myInfo->histogram_frame_interval !=
+            _param->histogram_frame_interval)
+        {
+            if (myInfo->histogram_frame_interval)
+                myInfo->histogram_data_invalid = true;
+            myInfo->histogram_frame_interval
+                = _param->histogram_frame_interval;
+        }
+
+        if (myInfo->histogram_data_invalid)
+        {
+            myInfo->histogram_data_invalid = false;
+            histogram->reset();
+        }
+    }
+
+    int32_t scale_min = _param->scale_from_min;
+    int32_t scale_max = _param->scale_from_max;
+    if (scale_min != 0 || scale_max != 255)
+    {
+        // printf ("Scaling enabled (from %d..%d to 0..255)\n",
+        //         scale_min, scale_max);
+        tool += TOOL_ADD_SCALING;
+    }
+
+    if (doingConvolution)
+    {
+        switch (tool)
+        {
+        case TOOL_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsA(), HistogramNull());
+            break;
+        case TOOL_P: // HERE: we could optimize this if we wanted to
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsP(), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPminusA(), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsAminusP(), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPplusA(), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPtimesA(), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPdivByA(), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsAdivByP(), HistogramNull());
+            break;
+        case TOOL_MIN_P_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsMinPA(), HistogramNull());
+            break;
+        case TOOL_MAX_P_A:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsMaxPA(), HistogramNull());
+            break;
+
+        case TOOL_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsA(), *histogram);
+            break;
+        case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsP(), *histogram);
+            break;
+        case TOOL_P_MINUS_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPminusA(), *histogram);
+            break;
+        case TOOL_A_MINUS_P_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsAminusP(), *histogram);
+            break;
+        case TOOL_P_PLUS_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPplusA(), *histogram);
+            break;
+        case TOOL_P_TIMES_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPtimesA(), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsPdivByA(), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsAdivByP(), *histogram);
+            break;
+        case TOOL_MIN_P_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsMinPA(), *histogram);
+            break;
+        case TOOL_MAX_P_A_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias, OpPequalsMaxPA(), *histogram);
+            break;
+
+        case TOOL_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsP_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPminusA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsAminusP_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPplusA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPtimesA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPdivByA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsAdivByP_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_MIN_P_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsMinPA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+        case TOOL_MAX_P_A_SCALED:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsMaxPA_Scaled (scale_min, scale_max), HistogramNull());
+            break;
+
+        case TOOL_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsP_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPminusA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsAminusP_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPplusA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPtimesA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsPdivByA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsAdivByP_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsMinPA_Scaled (scale_min, scale_max), *histogram);
+            break;
+        case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
+            imtool.convolve (kernel, kernel_w, kernel_h, bias,
+                             OpPequalsMaxPA_Scaled (scale_min, scale_max), *histogram);
+            break;
+
+        default:
+            printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
+                    _param->tool);
+            return 0;
+        }
+    }
+    else if (doingRollingAvg)
+    {
+        switch (tool)
+        {
+        case TOOL_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsA(), HistogramNull());
+            break;
+        case TOOL_P: // HERE: we could optimize this if we wanted to
+            computeRollingAverage (image, data, planesize, bias, OpPequalsP(), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPminusA(), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsAminusP(), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPplusA(), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPtimesA(), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPdivByA(), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsAdivByP(), HistogramNull());
+            break;
+        case TOOL_MIN_P_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsMinPA(), HistogramNull());
+            break;
+        case TOOL_MAX_P_A:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsMaxPA(), HistogramNull());
+            break;
+
+        case TOOL_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsA(), *histogram);
+            break;
+        case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            computeRollingAverage (image, data, planesize, bias, OpPequalsP(), *histogram);
+            break;
+        case TOOL_P_MINUS_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPminusA(), *histogram);
+            break;
+        case TOOL_A_MINUS_P_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsAminusP(), *histogram);
+            break;
+        case TOOL_P_PLUS_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPplusA(), *histogram);
+            break;
+        case TOOL_P_TIMES_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPtimesA(), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsPdivByA(), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsAdivByP(), *histogram);
+            break;
+        case TOOL_MIN_P_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsMinPA(), *histogram);
+            break;
+        case TOOL_MAX_P_A_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias, OpPequalsMaxPA(), *histogram);
+            break;
+
+        case TOOL_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsP_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_P_MINUS_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPminusA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_A_MINUS_P_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsAminusP_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_P_PLUS_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPplusA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_P_TIMES_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_MIN_P_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsMinPA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+        case TOOL_MAX_P_A_SCALED:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                                   HistogramNull());
+            break;
+
+        case TOOL_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsP_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPminusA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsAminusP_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPplusA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsMinPA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+        case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
+            computeRollingAverage (image, data, planesize, bias,
+                                   OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                                   *histogram);
+            break;
+
+        default:
+            printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
+                    _param->tool);
+            return 0;
+        }
+    }
+    else if (doingFileImageFloat)
+    {
+        if (w != myInfo->image_w || h != myInfo->image_h)
+        {
+            const char * bar = "*************************";
+            printf ("\n%s%s%s\nAttempting to apply a %ux%u input image to "
+                    "%ux%u video - even if I could do that, it probably "
+                    "wouldn't be what you wanted...\n%s%s%s\n",
+                    bar, bar, bar, myInfo->image_w, myInfo->image_h,
+                    w, h, bar, bar, bar);
+            return 0;
+        }
+
+        float * flt_img = myInfo->image_float;
+
+        switch (tool)
+        {
+        case TOOL_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsA(), HistogramNull());
+            break;
+        case TOOL_P: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsP(), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPminusA(), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsAminusP(), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPplusA(), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPtimesA(), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPdivByA(), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsAdivByP(), HistogramNull());
+            break;
+        case TOOL_MIN_P_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsMinPA(), HistogramNull());
+            break;
+        case TOOL_MAX_P_A:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsMaxPA(), HistogramNull());
+            break;
+
+        case TOOL_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsA(), *histogram);
+            break;
+        case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsP(), *histogram);
+            break;
+        case TOOL_P_MINUS_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPminusA(), *histogram);
+            break;
+        case TOOL_A_MINUS_P_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsAminusP(), *histogram);
+            break;
+        case TOOL_P_PLUS_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPplusA(), *histogram);
+            break;
+        case TOOL_P_TIMES_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPtimesA(), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsPdivByA(), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsAdivByP(), *histogram);
+            break;
+        case TOOL_MIN_P_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsMinPA(), *histogram);
+            break;
+        case TOOL_MAX_P_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img, OpPequalsMaxPA(), *histogram);
+            break;
+
+        case TOOL_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_MINUS_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPminusA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_A_MINUS_P_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsAminusP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_PLUS_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPplusA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_TIMES_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_MIN_P_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsMinPA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_MAX_P_A_SCALED:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+
+        case TOOL_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPminusA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsAminusP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPplusA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsMinPA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, flt_img,
+                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+
+        default:
+            printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
+                    _param->tool);
+            return 0;
+        }
+    }
+    else if (doingFileImage)
+    {
+        if (w != myInfo->image_w || h != myInfo->image_h)
+        {
+            const char * bar = "*************************";
+            printf ("\n%s%s%s\nAttempting to apply a %ux%u input image to "
+                    "%ux%u video - even if I could do that, it probably "
+                    "wouldn't be what you wanted...\n%s%s%s\n",
+                    bar, bar, bar, myInfo->image_w, myInfo->image_h,
+                    w, h, bar, bar, bar);
+            return 0;
+        }
+
+        uint8_t * int_img = myInfo->image_int;
+
+        switch (tool)
+        {
+        case TOOL_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsA(), HistogramNull());
+            break;
+        case TOOL_P: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, int_img, OpPequalsP(), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPminusA(), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsAminusP(), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPplusA(), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPtimesA(), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPdivByA(), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsAdivByP(), HistogramNull());
+            break;
+        case TOOL_MIN_P_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsMinPA(), HistogramNull());
+            break;
+        case TOOL_MAX_P_A:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsMaxPA(), HistogramNull());
+            break;
+
+        case TOOL_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsA(), *histogram);
+            break;
+        case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, int_img, OpPequalsP(), *histogram);
+            break;
+        case TOOL_P_MINUS_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPminusA(), *histogram);
+            break;
+        case TOOL_A_MINUS_P_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsAminusP(), *histogram);
+            break;
+        case TOOL_P_PLUS_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPplusA(), *histogram);
+            break;
+        case TOOL_P_TIMES_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPtimesA(), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsPdivByA(), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsAdivByP(), *histogram);
+            break;
+        case TOOL_MIN_P_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsMinPA(), *histogram);
+            break;
+        case TOOL_MAX_P_A_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img, OpPequalsMaxPA(), *histogram);
+            break;
+
+        case TOOL_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsP_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_P_MINUS_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPminusA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_A_MINUS_P_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsAminusP_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_P_PLUS_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPplusA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_P_TIMES_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_MIN_P_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsMinPA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+        case TOOL_MAX_P_A_SCALED:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                        HistogramNull());
+            break;
+
+        case TOOL_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsP_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPminusA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsAminusP_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPplusA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsMinPA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+        case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
+            applyImage (image, data, planesize, bias, int_img,
+                        OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                        *histogram);
+            break;
+
+        default:
+            printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
+                    _param->tool);
+            return 0;
+        }
+    }
+    else if (doingApplyConstant)
+    {
+        switch (tool)
+        {
+        case TOOL_A:
+            applyConstant (image, data, planesize, bias, OpPequalsA(), HistogramNull());
+            break;
+        case TOOL_P: // HERE: we could optimize this if we wanted to
+            applyConstant (image, data, planesize, bias, OpPequalsP(), HistogramNull());
+            break;
+        case TOOL_P_MINUS_A:
+            applyConstant (image, data, planesize, bias, OpPequalsPminusA(), HistogramNull());
+            break;
+        case TOOL_A_MINUS_P:
+            applyConstant (image, data, planesize, bias, OpPequalsAminusP(), HistogramNull());
+            break;
+        case TOOL_P_PLUS_A:
+            applyConstant (image, data, planesize, bias, OpPequalsPplusA(), HistogramNull());
+            break;
+        case TOOL_P_TIMES_A:
+            applyConstant (image, data, planesize, bias, OpPequalsPtimesA(), HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A:
+            applyConstant (image, data, planesize, bias, OpPequalsPdivByA(), HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P:
+            applyConstant (image, data, planesize, bias, OpPequalsAdivByP(), HistogramNull());
+            break;
+        case TOOL_MIN_P_A:
+            applyConstant (image, data, planesize, bias, OpPequalsMinPA(), HistogramNull());
+            break;
+        case TOOL_MAX_P_A:
+            applyConstant (image, data, planesize, bias, OpPequalsMaxPA(), HistogramNull());
+            break;
+
+        case TOOL_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsA(), *histogram);
+            break;
+        case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyConstant (image, data, planesize, bias, OpPequalsP(), *histogram);
+            break;
+        case TOOL_P_MINUS_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsPminusA(), *histogram);
+            break;
+        case TOOL_A_MINUS_P_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsAminusP(), *histogram);
+            break;
+        case TOOL_P_PLUS_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsPplusA(), *histogram);
+            break;
+        case TOOL_P_TIMES_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsPtimesA(), *histogram);
+            break;
+        case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsPdivByA(), *histogram);
+            break;
+        case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsAdivByP(), *histogram);
+            break;
+        case TOOL_MIN_P_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsMinPA(), *histogram);
+            break;
+        case TOOL_MAX_P_A_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias, OpPequalsMaxPA(), *histogram);
+            break;
+
+        case TOOL_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_MINUS_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPminusA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_A_MINUS_P_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsAminusP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_PLUS_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPplusA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_TIMES_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_P_DIVBY_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_A_DIVBY_P_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_MIN_P_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsMinPA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+        case TOOL_MAX_P_A_SCALED:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                           HistogramNull());
+            break;
+
+        case TOOL_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPminusA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsAminusP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPplusA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsMinPA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+        case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
+            applyConstant (image, data, planesize, bias,
+                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
+                           *histogram);
+            break;
+
+        default:
+            printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
+                    _param->tool);
+            return 0;
+        }
+    }
+    else
+    {
+        printf ("ooops!  input selection botch in SwissArmyKnife!\n");
+        return 0;
+    }
+
+    if (histogram)
+    {
+        histogram->frame_check();
+        delete histogram;
+    }
+
+    // HERE: the following two lines do a luma-only-ize
+
+    memset (UPLANE (data), 128, planesize >> 2);
+    memset (VPLANE (data), 128, planesize >> 2);
+
+    data->copyInfo(image);
+    return 1;
+}	                           

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,264 @@
+/***************************************************************************
+                          ADM_vidSwissArmyKnife.h  -  Perform one of many
+                                                      possible operations
+                             -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+#ifndef __SWISSARMYKNIFE__
+#define __SWISSARMYKNIFE__   
+
+#include <map>
+
+#include "ADM_video/ADM_cache.h"
+
+#include <vector>
+#include <string>
+
+#include <sys/time.h>
+
+struct SWISSARMYKNIFE_PARAM
+{
+    uint32_t tool; // ADMVideoSwissArmyKnife::Tool
+    uint32_t input_type; // ADMVideoSwissArmyKnife::Input
+
+    const char * input_file;
+    float load_bias;
+    float load_multiplier;
+
+    float input_constant;
+
+    uint32_t memory_constant_denom;
+    uint32_t init_start_frame;
+    uint32_t init_end_frame;
+    uint32_t init_by_rolling;
+
+    int32_t  bias;
+    int32_t  scale_from_min;
+    int32_t  scale_from_max;
+    uint32_t histogram_frame_interval;
+    uint32_t debug;
+
+};
+
+class ADMVideoSwissArmyKnife : public AVDMGenericVideoStream
+{
+protected:
+    	
+    // This is a hack to work around the fact that the ctor & dtor get called
+    // too often.  The right solution would be to arrange for the filter
+    // objects to be constructed and destructed only when really necessary:
+    // when a new instance of a filter is added to the list (by the user), it
+    // is constructed, and when it is removed from the list (by the user), it
+    // is destructed, and anything else is handled by a separate init() or
+    // configure() method.  This would allow the objects to maintain a
+    // persistent state in a more straightforward way.
+
+    typedef std::vector <float> FloatVector;
+
+    class PersistentInfo
+    {
+    public:
+        CONFcouple *  conf;
+        CONFcouple *  oldConf;
+        uint32_t      refCount;
+
+        FloatVector   kernel;
+        uint32_t      kernel_w;
+        uint32_t      kernel_h;
+
+        uint32_t      image_w;
+        uint32_t      image_h;
+        uint8_t *     image_int;
+        float *       image_float;
+
+        std::string   input_file_name;
+        time_t        input_file_mtime;
+
+        float *       bg;
+        uint32_t      bg_mc;
+        uint32_t      bg_isf;
+        uint32_t      bg_ief;
+        uint32_t      bg_x;
+        uint32_t      bg_y;
+
+        uint32_t      histogram_frame_interval;
+        uint32_t *    histogram_input_data;
+        uint32_t *    histogram_output_data;
+        uint32_t      histogram_frame_count;
+
+        bool          bg_ibr;
+        bool          histogram_data_invalid;
+        bool          image_data_invalid;
+
+        PersistentInfo ()
+            : conf (0),
+              oldConf (0),
+              refCount (0),
+
+              kernel_w (0),
+              kernel_h (0),
+
+              image_w (0),
+              image_h (0),
+              image_int (0),
+              image_float (0),
+
+              input_file_mtime (0),
+
+              bg (0),
+              bg_mc (0),
+              bg_isf (0),
+              bg_ief (0),
+              bg_x (0),
+              bg_y (0),
+
+              histogram_frame_interval (0),
+              histogram_input_data (0),
+              histogram_output_data (0),
+              histogram_frame_count (0),
+
+              bg_ibr (false),
+              histogram_data_invalid (false),
+              image_data_invalid (false)
+        {
+        }
+
+        ~PersistentInfo ()
+        {
+            delete image_int;
+            delete image_float;
+            delete bg;
+            delete histogram_input_data;
+            delete histogram_output_data;
+        }
+    };
+
+    typedef std::map <CONFcouple *, PersistentInfo *> PImap;
+    static PImap pimap;
+
+    PersistentInfo * myInfo;
+
+    enum Input
+    {
+        INPUT_INVALID = 0,
+
+        INPUT_FILE_IMAGE_FLOAT,
+        INPUT_FILE_IMAGE_INTEGER,
+        INPUT_CUSTOM_CONVOLUTION,
+        INPUT_CONSTANT_VALUE,
+        INPUT_ROLLING_AVERAGE,
+
+        INPUT_COUNT
+    };
+
+    enum Tool
+    {
+        TOOL_INVALID = 0,
+
+        TOOL_A,          // P' = A
+        TOOL_P,          // P' = P
+        TOOL_P_MINUS_A,  // P' = P - A
+        TOOL_A_MINUS_P,  // P' = A - P
+        TOOL_P_PLUS_A,   // P' = P + A
+        TOOL_P_TIMES_A,  // P' = P * A
+        TOOL_P_DIVBY_A,  // P' = P / A
+        TOOL_A_DIVBY_P,  // P' = A / P
+        TOOL_MIN_P_A,    // P' = min (P, A)
+        TOOL_MAX_P_A,    // P' = max (P, A)
+
+        TOOL_A_WITH_HISTOGRAM,
+        TOOL_P_WITH_HISTOGRAM,
+        TOOL_P_MINUS_A_WITH_HISTOGRAM,
+        TOOL_A_MINUS_P_WITH_HISTOGRAM,
+        TOOL_P_PLUS_A_WITH_HISTOGRAM,
+        TOOL_P_TIMES_A_WITH_HISTOGRAM,
+        TOOL_P_DIVBY_A_WITH_HISTOGRAM,
+        TOOL_A_DIVBY_P_WITH_HISTOGRAM,
+        TOOL_MIN_P_A_WITH_HISTOGRAM,
+        TOOL_MAX_P_A_WITH_HISTOGRAM,
+
+        TOOL_A_SCALED,
+        TOOL_P_SCALED,
+        TOOL_P_MINUS_A_SCALED,
+        TOOL_A_MINUS_P_SCALED,
+        TOOL_P_PLUS_A_SCALED,
+        TOOL_P_TIMES_A_SCALED,
+        TOOL_P_DIVBY_A_SCALED,
+        TOOL_A_DIVBY_P_SCALED,
+        TOOL_MIN_P_A_SCALED,
+        TOOL_MAX_P_A_SCALED,
+
+        TOOL_A_SCALED_WITH_HISTOGRAM,
+        TOOL_P_SCALED_WITH_HISTOGRAM,
+        TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM,
+        TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM,
+        TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM,
+        TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM,
+        TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM,
+        TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM,
+        TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM,
+        TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM,
+
+        TOOL_TOTAL_COUNT,
+
+        TOOL_ADD_HISTOGRAM = TOOL_A_WITH_HISTOGRAM - TOOL_A,
+        TOOL_ADD_SCALING = TOOL_A_SCALED - TOOL_A,
+
+    };
+
+    struct ToolMap
+    {
+        Tool toolid;
+        const char * outputName; // displayed name
+        const char * format;     // printf format (%s is A)
+    };
+
+    static ToolMap tool_map [];
+
+    SWISSARMYKNIFE_PARAM *  _param;
+
+public:
+
+    ADMVideoSwissArmyKnife (AVDMGenericVideoStream *in,CONFcouple *setup);
+    ~ADMVideoSwissArmyKnife();
+
+    virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t *len,
+                                           ADMImage *data, uint32_t *flags);
+
+    virtual uint8_t configure (AVDMGenericVideoStream *instream);
+    virtual char * printConf(void);
+    virtual uint8_t getCoupledConf (CONFcouple **couples);
+
+private:
+
+    template <typename Oper, typename Histo>
+    void computeRollingAverage (ADMImage * image, ADMImage * data,
+                                uint32_t planesize, int32_t bias,
+                                const Oper & op_in,
+                                const Histo & histogram_in);
+
+    template <typename InputImageType, typename Oper, typename Histo>
+    void applyImage (ADMImage * image, ADMImage * data,
+                     uint32_t planesize, int32_t bias,
+                     InputImageType * input_image,
+                     const Oper & op_in, const Histo & histogram_in);
+
+    template <typename Oper, typename Histo>
+    void applyConstant (ADMImage * image, ADMImage * data,
+                        uint32_t planesize, int32_t bias,
+                        const Oper & op_in,
+                        const Histo & histogram_in);
+
+};
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,226 @@
+/***************************************************************************
+                          ADM_vidThreshold.cpp  -  do thresholding
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+ 
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ADM_assert.h>
+#include <math.h>
+
+#include "config.h"
+#include "fourcc.h"
+#include "avio.hxx"
+#include "config.h"
+#include "avi_vars.h"
+
+
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+
+#include "ADM_filter/video_filters.h"
+
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
+
+#include "ADM_vidThreshold.h"
+
+// #define THRESHOLD_HISTO 1
+
+static FILTER_PARAM thresholdParam={3,{"min", "max", "debug"}};
+
+SCRIPT_CREATE(threshold_script,ADMVideoThreshold,thresholdParam);
+
+BUILD_CREATE(threshold_create,ADMVideoThreshold);
+
+ADMVideoThreshold::ADMVideoThreshold(AVDMGenericVideoStream *in,CONFcouple *couples)
+			
+{
+    printf ("ADMVideoThreshold ctor (%p)\n", this);
+    _in=in;
+    memcpy(&_info,in->getInfo(),sizeof(_info));
+    _info.encoding=1;	
+    _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
+    ADM_assert(_uncompressed);    	  	
+    _param=NEW( THRESHOLD_PARAM );
+    if(couples)
+    {
+        GET(min);
+        GET(max);
+        GET(debug);
+    }
+    else
+    {
+        _param->min = 100;
+        _param->max = 200;
+        _param->debug = 0;
+    }
+}
+
+uint8_t	ADMVideoThreshold::getCoupledConf( CONFcouple **couples)
+{
+
+    ADM_assert(_param);
+    *couples=new CONFcouple(3);
+
+#define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
+    CSET(min);
+    CSET(max);
+    CSET(debug);
+
+    return 1;
+
+}
+
+uint8_t ADMVideoThreshold::configure(AVDMGenericVideoStream *in)
+{
+    UNUSED_ARG(in);
+
+    diaElemUSlider minslide(&(_param->min), _("Mi_nimum value to be non-zero in output:"), 0, 255);
+    diaElemUSlider maxslide(&(_param->max), _("Ma_ximum value to be non-zero in output:"), 0, 255);
+    diaElemUInteger debug(&(_param->debug), _("_Debugging settings (bits):"),
+                          0, 0x7fffffff);
+    diaElem * elems[] = { &minslide, &maxslide, &debug };
+
+    uint8_t ret = diaFactoryRun("Threshold", sizeof (elems) / sizeof (diaElem *), elems);
+    return ret;
+}
+
+ADMVideoThreshold::~ADMVideoThreshold()
+{
+    printf ("ADMVideoThreshold dtor (%p)\n", this);
+    DELETE(_param);
+    delete  _uncompressed;	
+    _uncompressed=NULL;
+}
+
+char	*ADMVideoThreshold::printConf( void) 
+{
+    static char conf[100];
+
+    sprintf(conf,"Threshold: Min = %3u  Max = %3u  Debug=0x%06x",
+            _param->min, _param->max, _param->debug);
+    return conf;
+	
+}
+uint8_t ADMVideoThreshold::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+          			ADMImage *data,uint32_t *flags)
+{
+    if (frame>= _info.nb_frames)
+        return 0;
+
+    uint32_t debug = _param->debug;
+
+    if (debug & 1)
+        printf ("in ADMVideoThreshold::getFrameNumberNoAlloc(%d, ...)\n",
+                frame);
+
+    uint32_t planesize = _info.width * _info.height;
+    uint32_t size = (planesize*3)>>1;
+    *len = size;
+			
+    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+        return 0;
+    ADMImage * image = _uncompressed;
+
+    // HERE: for speed, we do luma (Y plane) only.  However, some
+    // users might want chroma, too... we should make that
+    // an option or something.
+
+    uint8_t * currp = YPLANE (image) + planesize;
+    uint8_t * destp = YPLANE (data) + planesize;
+    uint32_t pixremaining = planesize + 1;
+
+#ifdef THRESHOLD_HISTO
+    uint32_t histo_before [256];
+    uint32_t histo_after [256];
+
+    memset (histo_before, 0, 256 * sizeof (uint32_t));
+    memset (histo_after, 0, 256 * sizeof (uint32_t));
+#endif
+
+    uint32_t min = _param->min;
+    uint32_t max = _param->max;
+
+    uint8_t in_range_value;
+    uint8_t out_of_range_value;
+    if (min <= max)
+    {
+        in_range_value = 255;
+        out_of_range_value = 0;
+    }
+    else
+    {
+        in_range_value = 0;
+        out_of_range_value = 255;
+        uint32_t tmp = min;
+        min = max;
+        max = tmp;
+    }
+
+#ifdef DUMP_FRAME_DATA
+    FILE * fp = fopen ("/tmp/framedump.new.out", "a");
+    ADM_assert(fp);
+#endif
+
+    while (--pixremaining)
+    {
+        int32_t curr = *--currp;
+
+#ifdef THRESHOLD_HISTO
+        histo_before [curr]++;
+#endif
+
+#ifdef DUMP_FRAME_DATA
+        fprintf (fp, "%x\n", curr);
+#endif
+
+        if (curr < min || curr > max)
+            *--destp = out_of_range_value;
+        else
+            *--destp = in_range_value;
+
+#ifdef THRESHOLD_HISTO
+        histo_after [*destp]++;
+#endif
+    }
+
+#ifdef DUMP_FRAME_DATA
+    fclose (fp);
+#endif
+
+#ifdef THRESHOLD_HISTO
+    if (debug & 0x800)
+    {
+        printf ("    Histogram:\n\tValue\tBefore\tAfter\tValue\tBefore\tAfter"
+                "\tValue\tBefore\tAfter\tValue\tBefore\tAfter\n");
+        for (int val = 0; val <= 63; val++)
+            printf ("\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\n",
+                    val, histo_before [val], histo_after [val],
+                    val + 64, histo_before [val + 64], histo_after [val + 64],
+                    val + 128, histo_before [val + 128], histo_after [val + 128],
+                    val + 192, histo_before [val + 192], histo_after [val + 192]);
+    }
+#endif
+
+    // HERE: the following two lines do a luma-only-ize
+
+    memset (UPLANE (data), 128, planesize >> 2);
+    memset (VPLANE (data), 128, planesize >> 2);
+
+    data->copyInfo(image);
+    return 1;
+}	                           

Added: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-08-31 16:18:20 UTC (rev 3575)
@@ -0,0 +1,51 @@
+/***************************************************************************
+                          ADM_vidThreshold.h  -  do thresholding
+                              -------------------
+                          Chris MacGregor, 2005, 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ 
+#ifndef __THRESHOLD__
+#define __THRESHOLD__   
+#include "ADM_video/ADM_cache.h"
+typedef struct THRESHOLD_PARAM
+{
+
+    uint32_t min;
+    uint32_t max;
+    uint32_t debug;
+
+} THRESHOLD_PARAM;
+
+class  ADMVideoThreshold:public AVDMGenericVideoStream
+ {
+
+ protected:
+    	
+     THRESHOLD_PARAM *  _param;
+
+ public:
+ 		
+
+     ADMVideoThreshold(  AVDMGenericVideoStream *in,CONFcouple *setup);
+
+     ~ADMVideoThreshold();
+
+     virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                              ADMImage *data,uint32_t *flags);
+
+     virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
+     virtual char 		   *printConf(void);
+     virtual uint8_t 	getCoupledConf( CONFcouple **couples);
+							
+ };
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-31 16:18:20 UTC (rev 3575)
@@ -38,6 +38,10 @@
 ADM_vidVobsub.cpp
 ADM_vidVobSubRender.cpp
 ADM_vobsubinfo.cpp
+ADM_vidComputeAverage.cpp
+ADM_vidSwissArmyKnife.cpp
+ADM_vidThreshold.cpp
+ADM_vidParticle.cpp
 
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-30 18:42:41 UTC (rev 3574)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-31 16:18:20 UTC (rev 3575)
@@ -76,7 +76,11 @@
  ADM_vidVobsub.cpp \
  ADM_vidVobSubRender.cpp \
  ADM_vobsubinfo.cpp \
- ADM_vidCrop.cpp       
+ ADM_vidCrop.cpp \
+ ADM_vidComputeAverage.cpp \
+ ADM_vidSwissArmyKnife.cpp \
+ ADM_vidThreshold.cpp \
+ ADM_vidParticle.cpp       
 			
 
 



From mean at mail.berlios.de  Fri Aug 31 18:35:28 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 31 Aug 2007 18:35:28 +0200
Subject: [Avidemux-svn-commit] r3576 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_editor
	ADM_outputs ADM_outputs/oplug_dummy
Message-ID: <200708311635.l7VGZSqj010142@sheep.berlios.de>

Author: mean
Date: 2007-08-31 18:35:21 +0200 (Fri, 31 Aug 2007)
New Revision: 3576

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/Makefile.am
   branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
Log:
[Container] Dummy container, useful for testing and Chris MacGregor weird filters

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-08-31 16:35:21 UTC (rev 3576)
@@ -24,6 +24,7 @@
 	ADM_OGM,
 	ADM_PSP,
 	ADM_FLV,
+	ADM_DUMMY,
 	ADM_FORMAT_MAX,
 	ADM_FMT_DUMMY=ADM_FORMAT_MAX
 }ADM_OUT_FORMAT;
@@ -33,7 +34,9 @@
   ADM_OUT_FORMAT format;
   const char *text;
 }ADM_FORMAT_DESC;
-
+/**
+ * 	This is used to fill-in the menus in GUIs
+ */
 const ADM_FORMAT_DESC ADM_allOutputFormat[]=
 {
   {ADM_AVI,_("AVI")},
@@ -46,7 +49,8 @@
   {ADM_MP4,_("MP4")},
   {ADM_OGM,_("OGM")},
   {ADM_PSP,_("PSP")},
-  {ADM_FLV,_("FLV")}
+  {ADM_FLV,_("FLV")},
+  {ADM_DUMMY,_("DUMMY")}
 };
 
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/CMakeLists.txt	2007-08-31 16:35:21 UTC (rev 3576)
@@ -4,4 +4,5 @@
 subdirs (PREORDER oplug_mpegFF)
 subdirs (PREORDER oplug_ogm)
 subdirs (PREORDER oplug_flv)
+subdirs (PREORDER oplug_dummy)
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/Makefile.am	2007-08-31 16:35:21 UTC (rev 3576)
@@ -1 +1 @@
-SUBDIRS= oplug_avi  oplug_mp4  oplug_mpeg  oplug_mpegFF  oplug_ogm oplug_flv
+SUBDIRS= oplug_avi  oplug_mp4  oplug_mpeg  oplug_mpegFF  oplug_ogm oplug_flv oplug_dummy

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/CMakeLists.txt	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/CMakeLists.txt	2007-08-31 16:35:21 UTC (rev 3576)
@@ -0,0 +1,3 @@
+
+SET(ADM_oplug_dummy_SRCS oplug_dummy.cpp)
+ADD_LIBRARY(oplug_dummy STATIC ${ADM_oplug_dummy_SRCS})

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/Makefile.am	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/Makefile.am	2007-08-31 16:35:21 UTC (rev 3576)
@@ -0,0 +1,14 @@
+####### kdevelop will overwrite this part!!! (begin)##########
+noinst_LIBRARIES = liboplug_dummy.a
+
+INCLUDES = $(all_includes)  -I../../ADM_libraries -I../../ADM_libraries/ADM_utilities   -I../../ADM_libraries/ADM_lavutil \
+		-I../../ADM_userInterfaces/ADM_commonUI 
+
+liboplug_dummy_a_METASOURCES = AUTO
+
+liboplug_dummy_a_SOURCES = oplug_dummy.cpp 
+
+
+EXTRA_DIST = oplug_dummy.cpp  oplug_dummy.h
+
+####### kdevelop will overwrite this part!!! (end)############

Added: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp	2007-08-31 16:35:21 UTC (rev 3576)
@@ -0,0 +1,246 @@
+/***************************************************************************
+                          oplug_dummy.cpp  -  Container that discards all inputs
+                          						Video only!
+                             -------------------
+    
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+        
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <string.h>
+#include <math.h>
+#include <pthread.h>
+#define WIN32_CLASH
+
+
+extern "C" {
+#include "ADM_lavcodec.h"
+};
+#include "default.h"
+#include "ADM_editor/ADM_Video.h"
+#include "ADM_colorspace/colorspace.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include <ADM_assert.h>
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_filter/video_filters.h"
+
+
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_encoder/adm_encoder.h"
+
+#include "ADM_codecs/ADM_ffmpeg.h"
+#include "ADM_encoder/adm_encffmpeg.h"
+#include "oplug_mpegFF/oplug_vcdff.h"
+
+#include "DIA_encoding.h"
+#include "ADM_audiofilter/audioprocess.hxx"
+#include "ADM_audiofilter/audioeng_buildfilters.h"
+#include "ADM_lavformat/ADM_lavformat.h"
+#include "ADM_utilities/fourcc.h"
+#include "ADM_encoder/adm_encConfig.h"
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_mplex/ADM_mthread.h"
+#include "ADM_toolkit/ADM_audioQueue.h"
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_MP4
+#include "ADM_osSupport/ADM_debug.h"
+
+
+extern void   	 				UI_purge(void );
+
+extern uint32_t					videoProcessMode (void);
+extern uint32_t 				frameStart,frameEnd;
+extern SelectCodecType  		current_codec;
+
+
+
+static 				uint8_t *_buffer=NULL,*_outbuffer=NULL;
+
+/*
+ * 		\fn    Oplug_dummy
+		\brief Main function to save in dummy format. 
+		This containers drops all datas. Useful for testing or some weird filters
+
+*/
+uint8_t oplug_dummy(const char *name)
+{
+AVDMGenericVideoStream *_incoming=NULL;
+AVDMGenericAudioStream  *audio=NULL;
+
+uint8_t		audioBuffer[48000];
+uint8_t         *videoBuffer=NULL;
+
+uint32_t alen;//,flags;
+uint32_t size;
+
+uint8_t   ret=0;
+
+uint32_t  sample_got=0,sample;
+uint32_t  extraDataSize=0;
+uint8_t   *extraData=NULL;
+aviInfo      info;
+uint32_t   width,height;
+DIA_encoding *encoding_gui=NULL;
+Encoder         *_encode=NULL;
+uint32_t total=0;
+uint32_t videoExtraDataSize=0;
+uint8_t  *videoExtraData=NULL;
+uint8_t *dummy,err;
+int prefill=0;
+uint32_t displayFrame=0;
+ADMBitstream    bitstream(0);
+uint32_t        frameWrite=0;
+uint8_t r=0;
+uint32_t skipping=1;
+
+uint32_t    totalAudioSize=0;
+uint32_t sent=0;
+
+        // Setup video
+        
+        if(videoProcessMode())
+        {
+             _incoming = getLastVideoFilter (frameStart,frameEnd-frameStart);
+        }else
+        {
+             _incoming = getFirstVideoFilter (frameStart,frameEnd-frameStart);
+        }
+
+           videoBuffer=new uint8_t[_incoming->getInfo()->width*_incoming->getInfo()->height*3];
+                // Set global header encoding, needed for H264
+           _encode = getVideoEncoder (_incoming->getInfo()->width,  _incoming->getInfo()->height,1);
+           total= _incoming->getInfo()->nb_frames;
+
+           info.fcc=*(uint32_t *)_encode->getCodecName(); //FIXME
+           
+           encoding_gui=new DIA_encoding(_incoming->getInfo()->fps1000);
+           bitstream.bufferSize=_incoming->getInfo()->width*_incoming->getInfo()->height*3;
+           if (!_encode)
+                {
+                  GUI_Error_HIG ("[FLV]",_("Cannot initialize the video stream"));
+                        goto  stopit;
+                }
+
+                // init compressor
+                encoding_gui->setContainer("Dummy");
+                encoding_gui->setAudioCodec("None");
+                if(!videoProcessMode())
+                        encoding_gui->setCodec("Copy");
+                else
+                        encoding_gui->setCodec(_encode->getDisplayName());
+                
+                if (!_encode->configure (_incoming))
+                {
+                      GUI_Error_HIG (_("Filter init failed"), NULL);
+                     goto  stopit;
+                };
+
+                encoding_gui->setPhasis ("Encoding");
+                
+                
+                info.width=_incoming->getInfo()->width;
+                info.height=_incoming->getInfo()->height;
+                info.nb_frames=_incoming->getInfo()->nb_frames;
+                info.fps1000=_incoming->getInfo()->fps1000;
+                
+                _encode->hasExtraHeaderData( &videoExtraDataSize,&dummy);
+                if(videoExtraDataSize)
+                {
+                        printf("[FLV]We have extradata for video in copy mode (%d)\n",videoExtraDataSize);
+                        videoExtraData=new uint8_t[videoExtraDataSize];
+                        memcpy(videoExtraData,dummy,videoExtraDataSize);
+                }
+        // _________________Setup video (cont) _______________
+        // ___________ Read 1st frame _________________
+             
+             ADM_assert(_encode);
+             bitstream.data=videoBuffer;
+             
+preFilling:
+             bitstream.cleanup(0);
+             if(!(err=_encode->encode ( prefill, &bitstream)))// FIXME: We should never execute it more than once
+             {
+                        printf("[FLV]:First frame error\n");
+                        GUI_Error_HIG (_("Error while encoding"), NULL);
+                        goto  stopit;
+              }
+              sent++;
+              if(!bitstream.len)
+              {
+                prefill++;
+                goto preFilling;
+              }
+              if(!bitstream.flags & AVI_KEY_FRAME)
+              {
+                GUI_Error_HIG (_("KeyFrame error"),_( "The beginning frame is not a key frame.\nPlease move the A marker."));
+                  goto  stopit; 
+              }
+         
+          if(!videoProcessMode())
+                encoding_gui->setCodec("Copy");
+          else
+                encoding_gui->setCodec(_encode->getDisplayName());
+           //
+          UI_purge();
+          if(bitstream.len)
+          {
+            frameWrite++;
+          }
+           for(int frame=1;frame<total;frame++)
+           {
+               
+               ADM_assert(_encode);
+               bitstream.cleanup(frameWrite);
+              
+               r=_encode->encode ( prefill+frame, &bitstream);
+              
+               if(!r && frame<total-2)
+               {
+                        printf("[FLV]:Frame %u error\n",frame);
+                        GUI_Error_HIG ("FLV",_("Error while encoding"));
+                        goto  stopit;
+                }
+                if(!bitstream.len && skipping)
+                {
+                    printf("[FLV]Frame skipped (xvid ?)\n");
+                    continue;
+                }
+                sent++;
+                skipping=0;
+                frameWrite++;
+                encoding_gui->setFrame(frame,bitstream.len,bitstream.out_quantizer,total);
+               if(!encoding_gui->isAlive())
+                {
+                    
+                    goto stopit;
+                }
+               
+           }
+           ret=1;
+           
+stopit:
+    
+           if(encoding_gui) delete encoding_gui;
+           if(videoBuffer) delete [] videoBuffer;
+           if(_encode) delete _encode;	
+           if(videoExtraData) delete [] videoExtraData;
+           return ret;
+}
+
+	
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-08-31 16:35:21 UTC (rev 3576)
@@ -119,6 +119,7 @@
 oplug_mpegFF
 oplug_ogm
 oplug_flv
+oplug_dummy
 )
 
 FOREACH(_current ${ADM_outputs})

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-08-31 16:35:21 UTC (rev 3576)
@@ -110,6 +110,7 @@
 ./ADM_outputs/oplug_ogm/liboplug_ogm.a			\
 ./ADM_outputs/oplug_avi/liboplug_avi.a			\
 ./ADM_outputs/oplug_flv/liboplug_flv.a			\
+./ADM_outputs/oplug_dummy/liboplug_dummy.a		\
 ./ADM_encoder/libADM_encoder.a				\
 ./ADM_codecs/libADM_codecs.a				\
 ./ADM_requant/libADM_requant.a				\

Modified: branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-08-31 16:18:20 UTC (rev 3575)
+++ branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-08-31 16:35:21 UTC (rev 3576)
@@ -58,6 +58,7 @@
 
 static uint8_t  A_SaveAudioNVideo(const char *name);
  extern int A_SaveUnpackedVop(const char *name);
+ extern uint8_t oplug_dummy(const char *name);
  extern int A_SavePackedVop(const char *name);
  extern uint8_t ogmSave(const char *name);
  extern uint8_t ADM_saveRaw(const char *name);
@@ -171,6 +172,9 @@
 					printf(" AVI family\n");
 					switch(UI_GetCurrentFormat())
 					{
+						case ADM_DUMMY:
+					                            			ret=oplug_dummy(name);
+					                            			break;
 						case ADM_FLV:
                             			ret=oplug_flv(name);
                             			break;



