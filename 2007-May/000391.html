<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3090 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog	ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3090%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_dialog%20ADM_NONE/ADM_dialog%20ADM_QT4/ADM_dialog%0A%09ADM_commonUI&In-Reply-To=%3C200705141724.l4EHOG1W001906%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000390.html">
   <LINK REL="Next"  HREF="000392.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3090 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog	ADM_commonUI</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3090%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_dialog%20ADM_NONE/ADM_dialog%20ADM_QT4/ADM_dialog%0A%09ADM_commonUI&In-Reply-To=%3C200705141724.l4EHOG1W001906%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3090 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog	ADM_commonUI">mean at mail.berlios.de
       </A><BR>
    <I>Mon May 14 19:24:16 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000390.html">[Avidemux-svn-commit] r3089 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
</A></li>
        <LI>Next message: <A HREF="000392.html">[Avidemux-svn-commit] r3095 - branches/avidemux_2.4_branch/po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#391">[ date ]</a>
              <a href="thread.html#391">[ thread ]</a>
              <a href="subject.html#391">[ subject ]</a>
              <a href="author.html#391">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-05-14 19:24:15 +0200 (Mon, 14 May 2007)
New Revision: 3090

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/hue.ui
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
Log:
flyDialog for Hue, GTK&amp;QT

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-05-14 17:24:15 UTC (rev 3090)
@@ -6,7 +6,7 @@
 			   Ui for hue &amp; sat
 
     begin                : 08 Apr 2005
-    copyright            : (C) 2004/5 by mean
+    copyright            : (C) 2004/7 by mean
     email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
  ***************************************************************************/
 
@@ -47,185 +47,123 @@
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 #include &quot;ADM_video/ADM_vidHue.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;DIA_flyHue.h&quot;
+
 #include &quot;ADM_assert.h&quot;
 
-uint8_t DIA_getHue(Hue_Param *param, ADMImage *image);
-
 static GtkWidget	*create_dialog1 (void);
 static void  		update ( void);
 static gboolean 	draw (void );
 static void 		upload(void);
 static void 		download(void);
-static void  		read ( void );
-static void		recalc( void );
 static void 		frame_changed( void );
 static void             hue_changed( void);
-extern void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
 
-static ADMImage *imgsrc,*imgdst,*imgdisplay;
+static int lock=0;
 static GtkWidget *dialog=NULL;
-static uint32_t w,h;
-static uint32_t *rgbbuffer=NULL;
-static AVDMGenericVideoStream *incoming;
-static Hue_Param  myHue;
-static float      hue,sat;
-static ColYuvRgb    *rgbConv=NULL;
-//
-//	Video is in YV12 Colorspace
-//
-//
+static flyHue *myCrop=NULL;
+
+
+/**
+      \fn DIA_getHue
+      \brief Handle Hue (fly)Dialog
+*/
 uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in)
 {
-        int ret;
-        uint32_t l,f;
-        uint32_t max=in-&gt;getInfo()-&gt;nb_frames;
-        
-        incoming=in;
+      uint32_t width,height;
+      uint8_t ret=0;
         // Allocate space for green-ised video
-        w=in-&gt;getInfo()-&gt;width;
-        h=in-&gt;getInfo()-&gt;height;
-        
-        rgbConv=new ColYuvRgb(w,h);
-        rgbConv-&gt;reset(w,h);
-        
-        rgbbuffer=new uint32_t[w*h];
+        width=in-&gt;getInfo()-&gt;width;
+        height=in-&gt;getInfo()-&gt;height;
 
-        imgdst=new ADMImage(w,h);
-        imgsrc=new ADMImage(w,h);
-        imgdisplay=new ADMImage(w,h);
-
-        if(curframe&lt;max) max=curframe;
-        
-        ADM_assert(in-&gt;getFrameNumberNoAlloc(max, &amp;l, imgsrc,&amp;f));
-        // Luma is not changed by this filter
-        memcpy(YPLANE(imgdisplay),YPLANE(imgsrc),w*h);
-        memcpy(&amp;myHue,param,sizeof(myHue));
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-
-        gtk_widget_set_usize(WID(drawingarea1), w,h);
-
-
-
-        upload();
+        
+        gtk_widget_set_usize(WID(drawingarea1), width,height);
+        gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;Hue&quot;));
+        gtk_widget_show(dialog);
+	
+        
         gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), &quot;expose_event&quot;,
             GTK_SIGNAL_FUNC(draw),
             NULL);
-
+//
         gtk_signal_connect(GTK_OBJECT(WID(hscale1)), &quot;value_changed&quot;,GTK_SIGNAL_FUNC(frame_changed),   NULL);
         gtk_signal_connect(GTK_OBJECT(WID(hscaleHue)), &quot;value_changed&quot;,GTK_SIGNAL_FUNC(hue_changed),   NULL);
         gtk_signal_connect(GTK_OBJECT(WID(hscaleSaturation)), &quot;value_changed&quot;,GTK_SIGNAL_FUNC(hue_changed),   NULL);
         gtk_widget_show(dialog);
 
-        update();
-        draw();
+          
+        myCrop=new flyHue( width, height,in,WID(drawingarea1),WID(hscale1));
+        memcpy(&amp;(myCrop-&gt;param),param,sizeof(Hue_Param));
+        myCrop-&gt;upload();
+        myCrop-&gt;sliderChanged();
         ret=0;
         int response;
         response=gtk_dialog_run(GTK_DIALOG(dialog));
 
         if(response==GTK_RESPONSE_OK)
         {
-	    memcpy(param,&amp;myHue,sizeof(myHue));
+            myCrop-&gt;download();
+            memcpy(param,&amp;(myCrop-&gt;param),sizeof(Hue_Param));
             ret=1;
         }
         gtk_unregister_dialog(dialog);
         gtk_widget_destroy(dialog);
-    
-        delete imgdst;
-        delete imgsrc;
-        delete imgdisplay;
-        delete [] rgbbuffer;
-        delete rgbConv;
-        rgbConv=NULL;
-
-        rgbbuffer=NULL;
-        imgdst=NULL;
-        imgsrc=NULL;
-        dialog=NULL;
-        imgdisplay=NULL;
+        delete myCrop;
         return ret;
 }
 void hue_changed( void)
 {
-    download();
-    update();
-    draw();
+  if(lock) return;
+  
+   myCrop-&gt;update();
+  
 }
 void frame_changed( void )
 {
-uint32_t new_frame,max,l,f;
-double   percent;
-GtkWidget *wid;	
-GtkAdjustment *adj;
-	
-	max=incoming-&gt;getInfo()-&gt;nb_frames;
-	wid=WID(hscale1);
-	adj=gtk_range_get_adjustment (GTK_RANGE(wid));
-	new_frame=0;
-	
-	percent=(double)GTK_ADJUSTMENT(adj)-&gt;value;
-	percent*=max;
-	percent/=100.;
-	new_frame=(uint32_t)floor(percent);
-	
-	if(new_frame&gt;=max) new_frame=max-1;
-	
-	ADM_assert(incoming-&gt;getFrameNumberNoAlloc(new_frame, &amp;l, imgsrc,&amp;f));
-        memcpy(YPLANE(imgdisplay),YPLANE(imgsrc),w*h);
-        update();
-        draw();
-
+  myCrop-&gt;sliderChanged();
 }
 gboolean draw (void)
 {
-    GtkWidget *draw;
-        draw=WID(drawingarea1);
-        GUI_RGBDisplay((uint8_t *)rgbbuffer, w,h, (void *)draw);
-        return true;
+    myCrop-&gt;display();
 }
+//
 void upload( void)
 {
-    gtk_range_set_value (GTK_RANGE(WID(hscaleHue)),(gdouble)myHue.hue);
-    gtk_range_set_value (GTK_RANGE(WID(hscaleSaturation)),(gdouble)myHue.saturation);
+    myCrop-&gt;upload();
 }
 void download (void)
 {
-    GtkAdjustment *adj;	
+     myCrop-&gt;download();
+}
+/**************************************/
+uint8_t flyHue::upload(void)
+{
+    lock++;
+      gtk_range_set_value (GTK_RANGE(WID(hscaleHue)),(gdouble)param.hue);
+      gtk_range_set_value (GTK_RANGE(WID(hscaleSaturation)),(gdouble)param.saturation);
+    lock--;
+        return 1;
+}
+uint8_t flyHue::download (void)
+{
+    
+       GtkAdjustment *adj;	
 
         adj=gtk_range_get_adjustment (GTK_RANGE(WID(hscaleHue)));
-        myHue.hue=(float)GTK_ADJUSTMENT(adj)-&gt;value;
+        param.hue=(float)GTK_ADJUSTMENT(adj)-&gt;value;
         
         adj=gtk_range_get_adjustment (GTK_RANGE(WID(hscaleSaturation)));
-        myHue.saturation=(float)GTK_ADJUSTMENT(adj)-&gt;value;
+        param.saturation=(float)GTK_ADJUSTMENT(adj)-&gt;value;
+        return 1;
 }
-void update(void )
-{
-uint8_t *src,*dst;
-uint32_t stride;
-    hue=myHue.hue*M_PI/180.;
-    sat=(100+myHue.saturation)/100;
-    // Do it!
-    HueProcess_C(VPLANE(imgdisplay), UPLANE(imgdisplay),
-        VPLANE(imgsrc), UPLANE(imgsrc),
-        w&gt;&gt;1,w&gt;&gt;1,
-        w&gt;&gt;1,h&gt;&gt;1, 
-        hue, sat);
-    // Prepare RGB buffer
-    
-    // Copy half source to display
-    dst=imgdisplay-&gt;data+w*h;
-    src=imgsrc-&gt;data+w*h;
-    stride=w&gt;&gt;1;
-    for(uint32_t y=0;y&lt;h;y++)   // We do both u &amp; v!
-    {
-        memcpy(dst,src,stride&gt;&gt;1);
-        dst+=stride;
-        src+=stride;
-    }
-    //
-    //COL_yv12rgb(  w,   h,imgdisplay-&gt;data,(uint8_t *)rgbbuffer );
-    rgbConv-&gt;scale(imgdisplay-&gt;data,(uint8_t *)rgbbuffer );
-}
+
+
+
+
+//******************
 GtkWidget   *create_dialog1 (void)
 {
   GtkWidget *dialog1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-05-14 17:24:15 UTC (rev 3090)
@@ -83,7 +83,6 @@
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getHue(Hue_Param *param, ADMImage *image){return 0;}
 uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous){return 0;}

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h	2007-05-14 17:24:15 UTC (rev 3090)
@@ -0,0 +1,102 @@
+
+/***************************************************************************
+                          Template for QT4 flyDialog
+    copyright            : (C) 2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#ifndef WINDOW_NAME
+#error WINDOW_NAME undefined
+#endif
+
+#ifndef PARAM_NAME
+#error PARAM_NAME undefined
+#endif
+
+#ifndef DIALOG_NAME
+#error DIALOG_NAME undefined
+#endif
+
+#ifndef FUNC_NAME
+#error FUNC_NAME undefined
+#endif
+
+#ifndef FLY_NAME
+#error FLY_NAME undefined
+#endif
+
+
+static int lock=0;
+
+class WINDOW_NAME : public QDialog
+ {
+     Q_OBJECT
+ protected : 
+    int lock;
+ public:
+     FLY_NAME *myCrop;
+     ADM_QCanvas *canvas;
+     WINDOW_NAME(PARAM_NAME *param,AVDMGenericVideoStream *in);
+     ~WINDOW_NAME();
+     DIALOG_NAME ui;
+ public slots:
+      void gather(PARAM_NAME *param);
+      //void update(int i);
+ private slots:
+   void sliderUpdate(int foo);
+   void valueChanged(int foo);
+
+ private:
+     
+ };
+ 
+  void WINDOW_NAME::sliderUpdate(int foo)
+  {
+    myCrop-&gt;sliderChanged();
+  }
+  void WINDOW_NAME::gather(PARAM_NAME *param)
+  {
+    
+        myCrop-&gt;download();
+        memcpy(param,&amp;(myCrop-&gt;param),sizeof(PARAM_NAME));
+  }
+
+void WINDOW_NAME::valueChanged( int f )
+{
+  if(lock) return;
+  lock++;
+  myCrop-&gt;update();
+  lock--;
+}
+
+
+/**
+      \fn     DIA_getCropParams
+      \brief  Handle crop dialog
+*/
+uint8_t FUNC_NAME(PARAM_NAME *param, AVDMGenericVideoStream *in)
+{
+        uint8_t ret=0;
+        
+        WINDOW_NAME dialog(param,in);        
+        if(dialog.exec()==QDialog::Accepted)
+        {
+            dialog.gather(param); 
+            ret=1;
+        }
+        return ret;
+}
+//____________________________________
+// EOF
+
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-14 17:24:15 UTC (rev 3090)
@@ -80,8 +80,7 @@
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getHue(Hue_Param *param, ADMImage *image){return 0;}
-uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in){return 0;}
+//uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous){return 0;}
 uint8_t DIA_pipe(char **cmd,char **param){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-14 17:24:15 UTC (rev 3090)
@@ -4,7 +4,7 @@
 AQ_props.cpp AQ_working.cpp AQ_encoding.cpp  DIA_xvid4.cpp AQ_resizing.cpp AT_flyDialog.cpp \
 AQ_crop.cpp AT_QCanvas.cpp \
 AQ_asharp.cpp AQ_chromashift.cpp \
-AQ_contrast.cpp
+AQ_contrast.cpp AQ_hue.cpp
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
 		-I../../../ADM_libraries/ADM_utilities \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp (from rev 3086, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-05-13 18:19:17 UTC (rev 3086)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp	2007-05-14 17:24:15 UTC (rev 3090)
@@ -0,0 +1,155 @@
+/***************************************************************************
+                          DIA_crop.cpp  -  description
+                             -------------------
+
+			    GUI for cropping including autocrop
+			    +Revisted the Gtk2 way
+			     +Autocrop now in RGB space (more accurate)
+
+    begin                : Fri May 3 2002
+    copyright            : (C) 2002/2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;config.h&gt;
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;math.h&gt;
+
+#define Ui_Dialog Ui_hueDialog
+#include &quot;ui_hue.h&quot;
+#undef Ui_Dialog
+
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_image.h&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_colorspace/ADM_rgb.h&quot;
+#include &quot;ADM_assert.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;DIA_flyDialogQt4.h&quot;
+#include &quot;ADM_video/ADM_vidHue.h&quot;
+#include &quot;DIA_flyHue.h&quot;
+
+//
+//	Video is in YV12 Colorspace
+//
+//
+class Ui_hueWindow : public QDialog
+ {
+     Q_OBJECT
+ protected : 
+    int lock;
+ public:
+     flyHue *myCrop;
+     ADM_QCanvas *canvas;
+     Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in);
+     ~Ui_hueWindow();
+     Ui_hueDialog ui;
+ public slots:
+      void gather(Hue_Param *param);
+      //void update(int i);
+ private slots:
+   void sliderUpdate(int foo);
+   void valueChanged(int foo);
+
+ private:
+     
+ };
+  Ui_hueWindow::Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in)
+  {
+    uint32_t width,height;
+        ui.setupUi(this);
+        lock=0;
+        // Allocate space for green-ised video
+        width=in-&gt;getInfo()-&gt;width;
+        height=in-&gt;getInfo()-&gt;height;
+        ui.graphicsView-&gt;resize(width,height);
+        canvas=new ADM_QCanvas(ui.graphicsView,width,height);
+        
+        myCrop=new flyHue( width, height,in,canvas,ui.horizontalSlider);
+        memcpy(&amp;(myCrop-&gt;param),param,sizeof(Hue_Param));
+        myCrop-&gt;_cookie=&ui;
+        myCrop-&gt;upload();
+        myCrop-&gt;sliderChanged();
+
+
+        connect( ui.horizontalSlider,SIGNAL(valueChanged(int)),this,SLOT(sliderUpdate(int)));
+#define SPINNER(x) connect( ui.horizontalSlider##x,SIGNAL(valueChanged(int)),this,SLOT(valueChanged(int))); 
+          SPINNER(Hue);
+          SPINNER(Saturation);
+
+  }
+  void Ui_hueWindow::sliderUpdate(int foo)
+  {
+    myCrop-&gt;sliderChanged();
+  }
+  void Ui_hueWindow::gather(Hue_Param *param)
+  {
+    
+        myCrop-&gt;download();
+        memcpy(param,&amp;(myCrop-&gt;param),sizeof(Hue_Param));
+  }
+Ui_hueWindow::~Ui_hueWindow()
+{
+  if(myCrop) delete myCrop;
+  myCrop=NULL; 
+  if(canvas) delete canvas;
+  canvas=NULL;
+}
+void Ui_hueWindow::valueChanged( int f )
+{
+  if(lock) return;
+  lock++;
+  myCrop-&gt;update();
+  lock--;
+}
+
+#define MYSPIN(x) w-&gt;horizontalSlider##x
+#define MYCHECK(x) w-&gt;checkBox##x
+//************************
+uint8_t flyHue::upload(void)
+{
+      Ui_hueDialog *w=(Ui_hueDialog *)_cookie;
+
+        MYSPIN(Saturation)-&gt;setValue(param.saturation);
+        MYSPIN(Hue)-&gt;setValue(param.hue);
+        return 1;
+}
+uint8_t flyHue::download(void)
+{
+       Ui_hueDialog *w=(Ui_hueDialog *)_cookie;
+         param.hue=MYSPIN(Hue)-&gt;value();
+         param.saturation=MYSPIN(Saturation)-&gt;value();
+return 1;
+}
+
+/**
+      \fn     DIA_getCropParams
+      \brief  Handle crop dialog
+*/
+uint8_t DIA_getHue(Hue_Param *param,AVDMGenericVideoStream *in)
+{
+        uint8_t ret=0;
+        
+        Ui_hueWindow dialog(param,in);        
+        if(dialog.exec()==QDialog::Accepted)
+        {
+            dialog.gather(param); 
+            ret=1;
+        }
+        return ret;
+}
+//____________________________________
+// EOF
+
+

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/hue.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/hue.ui	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/hue.ui	2007-05-14 17:24:15 UTC (rev 3090)
@@ -0,0 +1,158 @@
+&lt;ui version=&quot;4.0&quot; &gt;
+ &lt;class&gt;Dialog&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;Dialog&quot; &gt;
+  &lt;property name=&quot;geometry&quot; &gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;505&lt;/width&gt;
+    &lt;height&gt;475&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot; &gt;
+   &lt;string&gt;Hue&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QGridLayout&quot; &gt;
+   &lt;property name=&quot;margin&quot; &gt;
+    &lt;number&gt;9&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;spacing&quot; &gt;
+    &lt;number&gt;6&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;item row=&quot;4&quot; column=&quot;0&quot; colspan=&quot;3&quot; &gt;
+    &lt;widget class=&quot;QDialogButtonBox&quot; name=&quot;buttonBox&quot; &gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;standardButtons&quot; &gt;
+      &lt;set&gt;QDialogButtonBox::Cancel|QDialogButtonBox::NoButton|QDialogButtonBox::Ok&lt;/set&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;3&quot; column=&quot;2&quot; &gt;
+    &lt;spacer&gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Vertical&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;sizeType&quot; &gt;
+      &lt;enum&gt;QSizePolicy::Ignored&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;sizeHint&quot; &gt;
+      &lt;size&gt;
+       &lt;width&gt;20&lt;/width&gt;
+       &lt;height&gt;40&lt;/height&gt;
+      &lt;/size&gt;
+     &lt;/property&gt;
+    &lt;/spacer&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;0&quot; column=&quot;1&quot; &gt;
+    &lt;spacer&gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;sizeHint&quot; &gt;
+      &lt;size&gt;
+       &lt;width&gt;40&lt;/width&gt;
+       &lt;height&gt;20&lt;/height&gt;
+      &lt;/size&gt;
+     &lt;/property&gt;
+    &lt;/spacer&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;1&quot; column=&quot;0&quot; colspan=&quot;3&quot; &gt;
+    &lt;widget class=&quot;QSlider&quot; name=&quot;horizontalSlider&quot; &gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;2&quot; column=&quot;0&quot; colspan=&quot;3&quot; &gt;
+    &lt;widget class=&quot;QGraphicsView&quot; name=&quot;graphicsView&quot; /&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;0&quot; column=&quot;0&quot; &gt;
+    &lt;layout class=&quot;QVBoxLayout&quot; &gt;
+     &lt;property name=&quot;margin&quot; &gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;spacing&quot; &gt;
+      &lt;number&gt;6&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Hue&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QSlider&quot; name=&quot;horizontalSliderHue&quot; &gt;
+       &lt;property name=&quot;minimum&quot; &gt;
+        &lt;number&gt;-90&lt;/number&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;90&lt;/number&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_4&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;Saturation&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QSlider&quot; name=&quot;horizontalSliderSaturation&quot; &gt;
+       &lt;property name=&quot;minimum&quot; &gt;
+        &lt;number&gt;-10&lt;/number&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;maximum&quot; &gt;
+        &lt;number&gt;10&lt;/number&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;resources/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;accepted()&lt;/signal&gt;
+   &lt;receiver&gt;Dialog&lt;/receiver&gt;
+   &lt;slot&gt;accept()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;248&lt;/x&gt;
+     &lt;y&gt;254&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;157&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;rejected()&lt;/signal&gt;
+   &lt;receiver&gt;Dialog&lt;/receiver&gt;
+   &lt;slot&gt;reject()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;316&lt;/x&gt;
+     &lt;y&gt;260&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;286&lt;/x&gt;
+     &lt;y&gt;274&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+&lt;/ui&gt;

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp	2007-05-14 17:24:15 UTC (rev 3090)
@@ -0,0 +1,80 @@
+/**/
+/***************************************************************************
+                          DIA_hue
+                             -------------------
+
+			   Ui for hue &amp; sat
+
+    begin                : 08 Apr 2005
+    copyright            : (C) 2004/7 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+
+#include &lt;config.h&gt;
+
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_colorspace/ADM_rgb.h&quot;
+#include &quot;ADM_image.h&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_video/ADM_vidHue.h&quot;
+#include &quot;DIA_flyDialog.h&quot;
+#include &quot;DIA_flyHue.h&quot;
+
+#include &quot;ADM_assert.h&quot;
+// FIXME
+#ifndef M_PI
+#define M_PI    3.14159265358979323846
+#endif
+
+/************* COMMON PART *********************/
+uint8_t  flyHue::update(void)
+{
+    download();
+    process();
+    _rgb-&gt;scale(_yuvBufferOut-&gt;data,_rgbBufferOut);
+    display();
+    return 1;
+}        
+
+uint8_t  flyHue::process(void )
+{
+uint8_t *src,*dst;
+uint32_t stride;
+float hue,sat;
+    hue=param.hue*M_PI/180.;
+    sat=(100+param.saturation)/100.;
+    memcpy(YPLANE(_yuvBufferOut),YPLANE(_yuvBuffer),_w*_h); // copy luma
+    // Do it!
+    HueProcess_C(VPLANE(_yuvBufferOut), UPLANE(_yuvBufferOut),
+        VPLANE(_yuvBuffer), UPLANE(_yuvBuffer),
+        _w&gt;&gt;1,_w&gt;&gt;1,
+        _w&gt;&gt;1,_h&gt;&gt;1, 
+        hue, sat);
+    // Copy half source to display
+    dst=_yuvBufferOut-&gt;data+_w*_h;
+    src=_yuvBuffer-&gt;data+_w*_h;
+    stride=_w&gt;&gt;1;
+    for(uint32_t y=0;y&lt;_h;y++)   // We do both u &amp; v!
+    {
+        memcpy(dst,src,stride&gt;&gt;1);
+        dst+=stride;
+        src+=stride;
+    }
+    return 1;
+}
+//EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.h	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.h	2007-05-14 17:24:15 UTC (rev 3090)
@@ -0,0 +1,19 @@
+#ifndef FLY_HUE_H
+#define FLY_HUE_H
+class flyHue : public ADM_flyDialog
+{
+  
+  public:
+   Hue_Param  param;
+  public:
+   uint8_t    process(void);
+   uint8_t    download(void);
+   uint8_t    upload(void);
+   uint8_t    update(void);
+   flyHue (uint32_t width,uint32_t height,AVDMGenericVideoStream *in,
+                                    void *canvas, void *slider) : ADM_flyDialog(width, height,in,canvas, slider,1) 
+                    {
+                      
+                    };
+};
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-05-14 14:27:58 UTC (rev 3089)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-05-14 17:24:15 UTC (rev 3090)
@@ -7,6 +7,7 @@
 DIA_lavcodec.cpp DIA_mjpeg.cpp DIA_requant.cpp \
 DIA_audioFilter.cpp DIA_flyDialog.cpp DIA_flyCrop.cpp \
 DIA_flyAsharp.cpp DIA_flyChromaShift.cpp DIA_flyContrast.cpp \
+DIA_flyHue.cpp \
 DIA_tdeint.cpp DIA_v2v.cpp
 
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000390.html">[Avidemux-svn-commit] r3089 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
</A></li>
	<LI>Next message: <A HREF="000392.html">[Avidemux-svn-commit] r3095 - branches/avidemux_2.4_branch/po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#391">[ date ]</a>
              <a href="thread.html#391">[ thread ]</a>
              <a href="subject.html#391">[ subject ]</a>
              <a href="author.html#391">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
