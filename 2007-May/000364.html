<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3061 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3061%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_codecs%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory&In-Reply-To=%3C200705101633.l4AGXjlZ030190%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000363.html">
   <LINK REL="Next"  HREF="000365.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3061 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3061%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_codecs%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory&In-Reply-To=%3C200705101633.l4AGXjlZ030190%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3061 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory">mean at mail.berlios.de
       </A><BR>
    <I>Thu May 10 18:33:45 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000363.html">[Avidemux-svn-commit] r3060 -	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
</A></li>
        <LI>Next message: <A HREF="000365.html">[Avidemux-svn-commit] r3062 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog	ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#364">[ date ]</a>
              <a href="thread.html#364">[ thread ]</a>
              <a href="subject.html#364">[ subject ]</a>
              <a href="author.html#364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-05-10 18:33:42 +0200 (Thu, 10 May 2007)
New Revision: 3061

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4param.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp
Log:
minimalistic xvi4 using dialogFactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4param.h	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4param.h	2007-05-10 16:33:42 UTC (rev 3061)
@@ -21,55 +21,55 @@
 typedef struct xvid4EncParam
 {
 
-  int guiLevel;			// equivalent to divx level : Fast/medium/insane
+  uint32_t guiLevel;			// equivalent to divx level : Fast/medium/insane
 
-  int min_key_interval;
-  int max_key_interval;
-  int bframes;
+  uint32_t min_key_interval;
+  uint32_t max_key_interval;
+  uint32_t bframes;
 
-  int mpegQuantizer;		// 0 h263/ 1 Mpeg quantizer
-  int interlaced;
-  int inter4mv;
-  int trellis;
-  int cartoon;
-  int greyscale;
+  uint32_t mpegQuantizer;		// 0 h263/ 1 Mpeg quantizer
+  uint32_t interlaced;
+  uint32_t inter4mv;
+  uint32_t trellis;
+  uint32_t cartoon;
+  uint32_t greyscale;
 
-  int qpel;
-  int gmc;
-  int bvhq;
-  int hqac;
+  uint32_t qpel;
+  uint32_t gmc;
+  uint32_t bvhq;
+  uint32_t hqac;
 
-  int chroma_opt;
-  int qmin[3];			// IPB
-  int qmax[3];			// IPB
+  uint32_t   chroma_opt;
+  uint32_t qmin[3];			// IPB
+  uint32_t qmax[3];			// IPB
 
-  uint8_t par_as_input;
-  uint8_t par_width;
-  uint8_t par_height;
+  uint32_t par_as_input;
+  uint32_t par_width;
+  uint32_t par_height;
 
 
   // This if for 2 pass   
-  int keyframe_boost;
-  int curve_compression_high;
-  int curve_compression_low;
-  int overflow_control_strength;
-  int max_overflow_improvement;
-  int max_overflow_degradation;
-  int kfreduction;
-  int kfthreshold;
+  uint32_t keyframe_boost;
+  uint32_t curve_compression_high;
+  uint32_t curve_compression_low;
+  uint32_t overflow_control_strength;
+  uint32_t max_overflow_improvement;
+  uint32_t max_overflow_degradation;
+  uint32_t kfreduction;
+  uint32_t kfthreshold;
 
   int container_frame_overhead;
   //
-  int bquant_ratio;
-  int bquant_offset;
-  int vhqmode;
-  int chroma_me;
-  int turbo;
-  int packed;
-  int closed_gop;
-  int bframe_threshold;
-  int useCustomIntra;
-  int useCustomInter;
+  uint32_t bquant_ratio;
+  uint32_t bquant_offset;
+  uint32_t vhqmode;
+  uint32_t chroma_me;
+  uint32_t turbo;
+  uint32_t packed;
+  uint32_t closed_gop;
+  uint32_t bframe_threshold;
+  uint32_t useCustomIntra;
+  uint32_t useCustomInter;
   uint8_t  intraMatrix[64];
   uint8_t  interMatrix[64];
   char logName[200];

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-10 16:33:42 UTC (rev 3061)
@@ -95,7 +95,6 @@
 uint8_t DIA_x264(COMPRES_PARAMS *config){return 0;}
 uint8_t DIA_XVCDParam(char *title,COMPRESSION_MODE * mode, uint32_t * qz,
 		   				   uint32_t * br,uint32_t *fsize,FFcodecSetting *conf	){return 0;}
-uint8_t DIA_xvid4(COMPRES_PARAMS *incoming){return 0;}
 
 //******************************
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp	2007-05-10 16:33:42 UTC (rev 3061)
@@ -0,0 +1,150 @@
+
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2007
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+#include &lt;math.h&gt;
+#include &lt;math.h&gt;
+#include &lt;iconv.h&gt;
+#include &quot;config.h&quot;
+
+
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+
+#include &quot;avi_vars.h&quot;
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+#include &quot;ADM_assert.h&quot; 
+#ifdef USE_XVID_4
+#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+
+#include &quot;ADM_codecs/ADM_xvid4param.h&quot;
+/**
+      \fn getFFCompressParams
+      \brief Dialog for lavcodec mpeg4/... codec settings
+*/
+uint8_t DIA_xvid4(COMPRES_PARAMS *incoming)
+{
+int b;
+int ret=0;
+int code;
+      xvid4EncParam localParam;
+      ADM_assert(incoming-&gt;extraSettingsLen==sizeof(localParam));
+      memcpy(&amp;localParam,incoming-&gt;extraSettings,sizeof(localParam));
+#define PX(x) &amp;(localParam.x)
+         // Our tabs
+         /* Tab 1 main */
+           diaElemBitrate bitrate(incoming,NULL);
+#define MKTOGGLE(y,x)           diaElemToggle  t_##x(PX(x),#y)
+        MKTOGGLE(Interlaced,	    interlaced);
+        MKTOGGLE(Cartoon Mode,      cartoon);
+        MKTOGGLE(Greyscale,         greyscale);
+        MKTOGGLE(Cartoon Mode,      turbo);
+        MKTOGGLE(Greyscale,         chroma_opt);
+        diaElem *main[]={&amp;bitrate,&amp;t_interlaced,&amp;t_cartoon,&amp;t_greyscale,&amp;t_turbo,&amp;t_chroma_opt};
+        diaElemTabs tabMain(&quot;Main&quot;,6,main);
+         /* Tab 2 motion */
+         diaMenuEntry motionMenu[] = {
+                             {0,       _(&quot;None&quot;),NULL}
+                            ,{1,      _(&quot;Very Low&quot;),NULL}
+                            ,{2,      _(&quot;Low&quot;),NULL}
+                            ,{3,      _(&quot;Medium&quot;),NULL}
+                            ,{4,      _(&quot;High&quot;),NULL}
+                            ,{5,      _(&quot;Very High&quot;),NULL}
+                            ,{6,      _(&quot;Ultra High&quot;),NULL}};
+        diaElemMenu motion(PX(guiLevel),_(&quot;Motion Search Precision&quot;),7,motionMenu);
+        
+         diaMenuEntry vhqMenu[] = {
+                             {0,       _(&quot;Off&quot;),NULL}
+                            ,{1,      _(&quot;Mode Decision&quot;),NULL}
+                            ,{2,      _(&quot;Limited Search&quot;),NULL}
+                            ,{3,      _(&quot;Medium Search&quot;),NULL}
+                            ,{4,      _(&quot;Wide Search&quot;),NULL} };
+         diaElemMenu vhq(PX(vhqmode),_(&quot;VHQ Mode&quot;),5,vhqMenu);
+        
+        
+        /* Tab2-ASP */
+          diaElemUInteger  bframe(PX(bframes),_(&quot;Max B Frames&quot;),0,3);
+          diaElemToggle    qpel(PX(qpel),_(&quot;Quarter Pixel&quot;));
+          diaElemToggle    gmc(PX(gmc),_(&quot;GMC&quot;));
+          diaElemToggle    bvhq(PX(bvhq),_(&quot;BVHQ&quot;));
+          diaElemFrame  frameASP(_(&quot;Advanced Simple Profile&quot;));
+          frameASP.swallow(&amp;bframe);
+          frameASP.swallow(&amp;qpel);
+          frameASP.swallow(&amp;gmc);
+          frameASP.swallow(&amp;bvhq);
+        
+         
+          /* Tab 2 motion extra */
+            diaElemToggle    inter4mv(PX(inter4mv),_(&quot;4MV&quot;));
+            diaElemToggle    chroma_me(PX(chroma_me),_(&quot;Chroma ME&quot;));
+            diaElemToggle    hqac(PX(chroma_me),_(&quot;HQ AC&quot;));
+          diaElemFrame  frameMore(_(&quot;More Search&quot;));
+          frameMore.swallow(&amp;inter4mv);
+          frameMore.swallow(&amp;chroma_me);
+          frameMore.swallow(&amp;hqac);
+          /* Tab 2 gop size */
+          diaElemUInteger  min_key_interval(PX(min_key_interval),_(&quot;Min Gop Size&quot;),1,900);
+          diaElemUInteger  max_key_interval(PX(max_key_interval),_(&quot;Max Gop Size&quot;),1,900);
+            diaElemFrame  frameGop(_(&quot;GOP Size&quot;));
+              frameGop.swallow(&amp;min_key_interval);
+              frameGop.swallow(&amp;max_key_interval);
+            
+           diaElem *motions[]={&amp;motion,&amp;vhq,&amp;frameMore,&amp;frameGop,&amp;frameASP};
+          diaElemTabs tabMotion(&quot;Motion&quot;,5,motions);
+        /* Tab 3 Qz*/
+          diaMenuEntry qzMenu[] = {
+                             {0,       _(&quot;H263&quot;),NULL}
+                            ,{1,      _(&quot;Mpeg&quot;),NULL}}                            ;
+           diaElemMenu h263(PX(mpegQuantizer),_(&quot;Quantization Matrix&quot;),2,qzMenu);
+           diaElemToggle    trellis(PX(trellis),_(&quot;Trellis Quantization&quot;));
+           
+           
+          diaElem *qz[]={&amp;h263,&amp;trellis};
+          diaElemTabs tabQz(_(&quot;Quantization&quot;),2,qz);
+          
+          /* Tab 4 : 2nd pass */
+#define MKENTRY(y,x) diaElemUInteger  x(PX(x),_(#y),0,100);frameOne.swallow(&amp;x);
+        diaElemFrame  frameOne(_(&quot;Two Pass Tuning&quot;)); 
+         
+        MKENTRY(Key Frame Boost(%),	keyframe_boost		);
+        
+        MKENTRY(I-frames closer than...	,		kfthreshold			);
+        MKENTRY(.. are reduced by(%),	kfreduction			);
+        MKENTRY(Max Overflow Improvement(%),	max_overflow_improvement	);
+        MKENTRY(Max Overglow Degradation(%),	max_overflow_degradation	);
+
+#undef MKENTRY
+#define MKENTRY(y,x) diaElemUInteger  x(PX(x),_(#y),0,100);frameTwo.swallow(&amp;x);
+        diaElemFrame  frameTwo(_(&quot;Curve Compression&quot;));  
+
+        MKENTRY(High Bitrate Scenes (%),curve_compression_high	);
+        MKENTRY(Low Bitrate Scenes (%),curve_compression_low	);
+        MKENTRY(Overflow Control Strength,overflow_control_strength	);
+                
+         diaElem *twopass[]={&amp;frameOne,&amp;frameTwo};
+          diaElemTabs tabPass(&quot;Two Pass&quot;,2,twopass);
+        /**/
+        
+        
+          
+          /* End of tabs */
+        diaElemTabs *tabs[4]={&amp;tabMain,&amp;tabMotion,&amp;tabQz,&amp;tabPass};
+        if( diaFactoryRunTabs(_(&quot;Xvid4 Configuration&quot;),4,tabs))
+	{
+           memcpy(incoming-&gt;extraSettings,&amp;localParam,sizeof(localParam));
+           return 1;
+        }
+         return 0;
+}
+#endif
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-10 16:33:42 UTC (rev 3061)
@@ -1,7 +1,7 @@
 
 noinst_LIBRARIES = libADM_dialog.a 
 libADM_dialog_a_SOURCES = DIA_busy.cpp  alert_qt4.cpp DIA_none.cpp OCR_none.cpp DIA_indexing.cpp \
-AQ_props.cpp AQ_working.cpp AQ_encoding.cpp 
+AQ_props.cpp AQ_working.cpp AQ_encoding.cpp  DIA_xvid4.cpp
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
 		-I../../../ADM_libraries/ADM_utilities \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp	2007-05-10 16:33:42 UTC (rev 3061)
@@ -91,14 +91,30 @@
             case  COMPRESS_2PASS_BITRATE:i=3;break;
             default: ADM_assert(0);
           }
+          combo-&gt;setCurrentIndex(i);
           comboChanged(i);        
           QObject::connect(combo, SIGNAL(currentIndexChanged(int )), this, SLOT(comboChanged(int )));
           
           
         }
         virtual ~ADM_Qbitrate() ;
-            
+        void readBack(void);
 };
+void ADM_Qbitrate::readBack(void)
+{
+#define Mx(x) compress-&gt;mode=x
+#define Vx(x) compress-&gt;x=box-&gt;value();
+  switch(combo-&gt;currentIndex())
+  {
+    case 0: Mx(COMPRESS_CBR);Vx(bitrate);break;
+    case 1: Mx(COMPRESS_CQ);Vx(qz);break;
+    case 2: Mx(COMPRESS_2PASS);Vx(finalsize);break;
+    case 3: Mx(COMPRESS_2PASS_BITRATE);Vx(bitrate);break;
+    case 4: Mx(COMPRESS_SAME);break;
+    default :
+          ADM_assert(0);
+  }
+}
 void ADM_Qbitrate::comboChanged(int i)
 {
   printf(&quot;Changed\n&quot;); 
@@ -178,7 +194,8 @@
 }
 void diaElemBitrate::getMe(void)
 {
-  //memcpy(param,&amp;copy,sizeof(copy));
+  ((ADM_Qbitrate *)myWidget)-&gt;readBack();
+  memcpy(param,&amp;copy,sizeof(copy));
 }
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp	2007-05-10 15:04:14 UTC (rev 3060)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp	2007-05-10 16:33:42 UTC (rev 3061)
@@ -154,7 +154,18 @@
   dialog.setLayout(&amp;layout);
   if(dialog.exec()==QDialog::Accepted)
   {
-   
+      // Read tabs
+       for(int tab=0;tab&lt;nb;tab++)
+     {
+        ADM_assert(tabs[tab]);
+        diaElemTabs *myTab=tabs[tab];
+        for(int i=0;i&lt;myTab-&gt;nbElems;i++)
+        {
+          myTab-&gt;dias[i]-&gt;getMe();
+        }
+    
+      }
+      return 1;
   }
   return 0;
   


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000363.html">[Avidemux-svn-commit] r3060 -	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
</A></li>
	<LI>Next message: <A HREF="000365.html">[Avidemux-svn-commit] r3062 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_NONE/ADM_dialog ADM_QT4/ADM_dialog	ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#364">[ date ]</a>
              <a href="thread.html#364">[ thread ]</a>
              <a href="subject.html#364">[ subject ]</a>
              <a href="author.html#364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
