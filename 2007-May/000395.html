<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3098 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3098%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog&In-Reply-To=%3C200705151515.l4FFFW94020931%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000394.html">
   <LINK REL="Next"  HREF="000396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3098 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3098%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog&In-Reply-To=%3C200705151515.l4FFFW94020931%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3098 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog">mean at mail.berlios.de
       </A><BR>
    <I>Tue May 15 17:15:32 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000394.html">[Avidemux-svn-commit] r3097 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
</A></li>
        <LI>Next message: <A HREF="000396.html">[Avidemux-svn-commit] r3099 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#395">[ date ]</a>
              <a href="thread.html#395">[ thread ]</a>
              <a href="subject.html#395">[ subject ]</a>
              <a href="author.html#395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-05-15 17:15:31 +0200 (Tue, 15 May 2007)
New Revision: 3098

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_indexing.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
Log:
indexing dialog for QT4

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_indexing.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_indexing.cpp	2007-05-15 14:51:45 UTC (rev 3097)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_indexing.cpp	2007-05-15 15:15:31 UTC (rev 3098)
@@ -1,33 +0,0 @@
-# include &lt;config.h&gt;
-
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;default.h&quot;
-#include &quot;prefs.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
-#include &quot;ADM_assert.h&quot; 
-#include &quot;DIA_idx_pg.h&quot;
-
-DIA_progressIndexing::DIA_progressIndexing(const char *name)
-{}
-DIA_progressIndexing::~DIA_progressIndexing()
-{}
- uint8_t       DIA_progressIndexing::update(uint32_t done,uint32_t total, uint32_t nbImage, uint32_t hh, uint32_t mm, uint32_t ss)
-{
-  return 1;
-}
-uint8_t       DIA_progressIndexing::abortRequest(void)
-{
-  return 0; 
-}
-uint8_t       DIA_progressIndexing::isAborted(void)
-{
-  return 0; 
-}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-15 14:51:45 UTC (rev 3097)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Makefile.am	2007-05-15 15:15:31 UTC (rev 3098)
@@ -1,10 +1,11 @@
 
 noinst_LIBRARIES = libADM_dialog.a 
-libADM_dialog_a_SOURCES = DIA_busy.cpp  alert_qt4.cpp DIA_none.cpp OCR_none.cpp DIA_indexing.cpp \
+libADM_dialog_a_SOURCES = DIA_busy.cpp  alert_qt4.cpp DIA_none.cpp OCR_none.cpp  \
 AQ_props.cpp AQ_working.cpp AQ_encoding.cpp  DIA_xvid4.cpp AQ_resizing.cpp AT_flyDialog.cpp \
 AQ_crop.cpp AT_QCanvas.cpp \
 AQ_asharp.cpp AQ_chromashift.cpp \
-AQ_contrast.cpp AQ_hue.cpp
+AQ_contrast.cpp AQ_hue.cpp \
+AT_index_pg.cpp
 
 INCLUDES = $(all_includes)  $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
 		-I../../../ADM_libraries/ADM_utilities \

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp	2007-05-15 14:51:45 UTC (rev 3097)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp	2007-05-15 15:15:31 UTC (rev 3098)
@@ -1,179 +0,0 @@
-/***************************************************************************
-                          DIA_dmx.cpp  -  description
-                             -------------------     
-Indexer progress dialog                             
-    
-    copyright            : (C) 2005 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-#include &lt;assert.h&gt;
-
-#include &lt;QtCore/QVariant&gt;
-#include &lt;QtGui/QAction&gt;
-#include &lt;QtGui/QApplication&gt;
-#include &lt;QtGui/QButtonGroup&gt;
-#include &lt;QtGui/QDialog&gt;
-#include &lt;QtGui/QLabel&gt;
-#include &lt;QtGui/QProgressBar&gt;
-
-
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_encoder/adm_encoder.h&quot;
-#include &quot;DIA_idx_pg.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-extern void UI_purge( void );
-
-class Ui_indexingDialog : public QDialog
- {
-     Q_OBJECT
- protected : 
-    int lock;
-    
- public:
-   int abted;
-   
-     Ui_indexingDialog(const char *name);
-     ~Ui_indexingDialog();
-    void setTime(const char *f);
-    void setImage(const char *f);
-    void setETA(const char *f);
-    void setPercent(float f);
- public slots:
- private slots:
-
- private:
-     
- };
-static Ui_indexingDialog *dialog=NULL; 
-#if 0
-static gint on_destroy_abort(GtkObject * object, gpointer user_data)
-{
-DIA_progressIndexing *pf;
-
-        UNUSED_ARG(object);
-        UNUSED_ARG(user_data);
-
-        pf=(Ui_indexingDialog *)user_data;
-        if(!GUI_Confirmation_HIG(_(&quot;Continue indexing&quot;),_(&quot;Abort Requested&quot;),_(&quot;Do you want to abort indexing ?&quot;)))
-        {
-         //       pf-&gt;abortRequest();
-                abted=1;
-        }
-
-        return TRUE;
-
-};
-#endif
-
-DIA_progressIndexing::DIA_progressIndexing(const char *name)
-{
-        dialog=new Ui_indexingDialog(name);
-        clock.reset();
-        aborted=0;
-	_nextUpdate=0;
-
-}
-DIA_progressIndexing::~DIA_progressIndexing()
-{
-        ADM_assert(dialog);
-        delete dialog;
-        dialog=NULL;
-}
-uint8_t       DIA_progressIndexing::isAborted(void) 
-{
-        ADM_assert(dialog);
-        return dialog-&gt;abted;
-}
-uint8_t DIA_progressIndexing::abortRequest(void)
-{
-        ADM_assert(dialog);
-        aborted=1;
-        dialog-&gt;abted=1;
-        return 1;
-}
-uint8_t       DIA_progressIndexing::update(uint32_t done,uint32_t total, uint32_t nbImage, uint32_t hh, uint32_t mm, uint32_t ss)
-{
-        uint32_t tim;
-	#define  GUI_UPDATE_RATE 1000
-
-	tim=clock.getElapsedMS();
-	if(tim&gt;_nextUpdate)
-	{
-        char string[256];
-        double f;
-        	uint32_t   tom,zhh,zmm,zss;
-
-		_nextUpdate=tim+GUI_UPDATE_RATE;
-        sprintf(string,&quot;%02d:%02d:%02d&quot;,hh,mm,ss);
-        dialog-&gt;setTime(string);
-        
-
-        sprintf(string,&quot;%0lu&quot;,nbImage);
-        dialog-&gt;setImage(string);
-
-        f=done;
-        f/=total;
-
-        dialog-&gt;setPercent(f);
-
-        /* compute ETL */
-       // Do a simple relation between % and time
-        // Elapsed time =total time*percent
-        if(f&lt;0.01) return 1;
-        f=tim/f;
-        // Tom is total time
-        tom=(uint32_t)floor(f);
-        if(tim&gt;tom) return 1;
-        tom=tom-tim;
-        ms2time(tom,&amp;zhh,&amp;zmm,&amp;zss);
-        sprintf(string,&quot;%02d:%02d:%02d&quot;,zhh,zmm,zss);
-        dialog-&gt;setETA(string);
-        UI_purge();
-        }
-        return 1;
-}
-//****************************** CLASS ***********************
-Ui_indexingDialog::Ui_indexingDialog(const char *name)
-{
-      abted=0;
-}
-Ui_indexingDialog::~Ui_indexingDialog()
-{
-  
-}
-void Ui_indexingDialog::setTime(const char *f)
-{
-    printf(&quot;Time:%s\n&quot;,f);
-}
-void Ui_indexingDialog::setETA(const char *f)
-{
-    printf(&quot;Eta:%s\n&quot;,f);
-}
-void Ui_indexingDialog::setPercent(float f)
-{
-    printf(&quot;Eta:%f\n&quot;,f);
-}
-
-
-
-// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp (from rev 3097, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_index_pg.cpp	2007-05-15 14:51:45 UTC (rev 3097)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp	2007-05-15 15:15:31 UTC (rev 3098)
@@ -0,0 +1,254 @@
+/***************************************************************************
+                          DIA_dmx.cpp  -  description
+                             -------------------     
+Indexer progress dialog                             
+    
+    copyright            : (C) 2005 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+#include &lt;assert.h&gt;
+
+#include &lt;QtCore/QVariant&gt;
+#include &lt;QtGui/QAction&gt;
+#include &lt;QtGui/QApplication&gt;
+#include &lt;QtGui/QButtonGroup&gt;
+#include &lt;QtGui/QDialog&gt;
+#include &lt;QtGui/QLabel&gt;
+#include &lt;QtGui/QProgressBar&gt;
+#include &lt;QtGui/QVBoxLayout&gt;
+#include &lt;QtGui/QWidget&gt;
+
+
+
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
+#include &quot;ADM_encoder/adm_encoder.h&quot;
+#include &quot;DIA_idx_pg.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+extern void UI_purge( void );
+
+class Ui_iDialog
+{
+public:
+    QWidget *verticalLayout;
+    QVBoxLayout *vboxLayout;
+    QLabel *labelTimeLeft;
+    QLabel *labelImages;
+    QProgressBar *progressBar;
+
+    void setupUi(QDialog *Dialog)
+    {
+    Dialog-&gt;setObjectName(QString::fromUtf8(&quot;Dialog&quot;));
+    verticalLayout = new QWidget(Dialog);
+    verticalLayout-&gt;setObjectName(QString::fromUtf8(&quot;verticalLayout&quot;));
+    verticalLayout-&gt;setGeometry(QRect(9, 9, 215, 89));
+    vboxLayout = new QVBoxLayout(verticalLayout);
+    vboxLayout-&gt;setSpacing(6);
+    vboxLayout-&gt;setMargin(0);
+    vboxLayout-&gt;setObjectName(QString::fromUtf8(&quot;vboxLayout&quot;));
+    labelTimeLeft = new QLabel(verticalLayout);
+    labelTimeLeft-&gt;setObjectName(QString::fromUtf8(&quot;labelTimeLeft&quot;));
+    vboxLayout-&gt;addWidget(labelTimeLeft);
+    
+    labelImages = new QLabel(verticalLayout);
+    labelImages-&gt;setObjectName(QString::fromUtf8(&quot;labelImages&quot;));
+    vboxLayout-&gt;addWidget(labelImages);
+
+    progressBar = new QProgressBar(verticalLayout);
+    progressBar-&gt;setObjectName(QString::fromUtf8(&quot;progressBar&quot;));
+    progressBar-&gt;setValue(0);
+    progressBar-&gt;setOrientation(Qt::Horizontal);
+
+    vboxLayout-&gt;addWidget(progressBar);
+
+
+    retranslateUi(Dialog);
+
+    QSize size(236, 111);
+    size = size.expandedTo(Dialog-&gt;minimumSizeHint());
+    Dialog-&gt;resize(size);
+
+
+    QMetaObject::connectSlotsByName(Dialog);
+    } // setupUi
+
+    void retranslateUi(QDialog *Dialog)
+    {
+    Dialog-&gt;setWindowTitle(QApplication::translate(&quot;Dialog&quot;, &quot;Indexing&quot;, 0, QApplication::UnicodeUTF8));
+    labelTimeLeft-&gt;setText(QApplication::translate(&quot;Dialog&quot;, &quot;Time Left : Infinity&quot;, 0, QApplication::UnicodeUTF8));
+    labelImages-&gt;setText(QApplication::translate(&quot;Dialog&quot;, &quot;# Images :&quot;, 0, QApplication::UnicodeUTF8));
+    
+    Q_UNUSED(Dialog);
+    } // retranslateUi
+
+};
+
+namespace Ui {
+    class Dialog: public Ui_iDialog {};
+} // namespace Ui
+
+
+
+class Ui_indexingDialog : public QDialog
+ {
+     Q_OBJECT
+ protected : 
+    int lock;
+    
+ public:
+   int abted;
+   Ui_iDialog ui;
+     Ui_indexingDialog(const char *name);
+     ~Ui_indexingDialog();
+    void setTime(const char *f);
+    void setImage(const char *f);
+    void setETA(const char *f);
+    void setPercent(float f);
+ public slots:
+ private slots:
+
+ private:
+     
+ };
+static Ui_indexingDialog *dialog=NULL; 
+#if 0
+static gint on_destroy_abort(GtkObject * object, gpointer user_data)
+{
+DIA_progressIndexing *pf;
+
+        UNUSED_ARG(object);
+        UNUSED_ARG(user_data);
+
+        pf=(Ui_indexingDialog *)user_data;
+        if(!GUI_Confirmation_HIG(_(&quot;Continue indexing&quot;),_(&quot;Abort Requested&quot;),_(&quot;Do you want to abort indexing ?&quot;)))
+        {
+         //       pf-&gt;abortRequest();
+                abted=1;
+        }
+
+        return TRUE;
+
+};
+#endif
+
+DIA_progressIndexing::DIA_progressIndexing(const char *name)
+{
+        dialog=new Ui_indexingDialog(name);
+        clock.reset();
+        aborted=0;
+	_nextUpdate=0;
+        dialog-&gt;show();
+        UI_purge();
+
+}
+DIA_progressIndexing::~DIA_progressIndexing()
+{
+        ADM_assert(dialog);
+        delete dialog;
+        dialog=NULL;
+}
+uint8_t       DIA_progressIndexing::isAborted(void) 
+{
+        ADM_assert(dialog);
+        return dialog-&gt;abted;
+}
+uint8_t DIA_progressIndexing::abortRequest(void)
+{
+        ADM_assert(dialog);
+        aborted=1;
+        dialog-&gt;abted=1;
+        return 1;
+}
+uint8_t       DIA_progressIndexing::update(uint32_t done,uint32_t total, uint32_t nbImage, uint32_t hh, uint32_t mm, uint32_t ss)
+{
+        uint32_t tim;
+	#define  GUI_UPDATE_RATE 1000
+
+	tim=clock.getElapsedMS();
+	if(tim&gt;_nextUpdate)
+	{
+        char string[256];
+        double f;
+        	uint32_t   tom,zhh,zmm,zss;
+
+		_nextUpdate=tim+GUI_UPDATE_RATE;
+        sprintf(string,&quot;%02d:%02d:%02d&quot;,hh,mm,ss);
+        dialog-&gt;setTime(string);
+        
+
+        sprintf(string,_(&quot;# Images :%0lu&quot;),nbImage);
+        dialog-&gt;setImage(string);
+
+        f=done;
+        f/=total;
+
+        dialog-&gt;setPercent(f);
+
+        /* compute ETL */
+       // Do a simple relation between % and time
+        // Elapsed time =total time*percent
+        if(f&lt;0.01) return 1;
+        f=tim/f;
+        // Tom is total time
+        tom=(uint32_t)floor(f);
+        if(tim&gt;tom) return 1;
+        tom=tom-tim;
+        ms2time(tom,&amp;zhh,&amp;zmm,&amp;zss);
+        sprintf(string,_(&quot;Time Left :%02d:%02d:%02d&quot;),zhh,zmm,zss);
+        dialog-&gt;setETA(string);
+        UI_purge();
+        }
+        return 1;
+}
+//****************************** CLASS ***********************
+Ui_indexingDialog::Ui_indexingDialog(const char *name)
+{
+      abted=0;
+      ui.setupUi(this);
+}
+Ui_indexingDialog::~Ui_indexingDialog()
+{
+    
+}
+void Ui_indexingDialog::setTime(const char *f)
+{
+    //printf(&quot;Time:%s\n&quot;,f);
+}
+void Ui_indexingDialog::setImage(const char *f)
+{
+    dialog-&gt;ui.labelImages-&gt;setText(f);
+}
+
+void Ui_indexingDialog::setETA(const char *f)
+{
+   // printf(&quot;Eta:%s\n&quot;,f);
+  dialog-&gt;ui.labelTimeLeft-&gt;setText(f);
+}
+void Ui_indexingDialog::setPercent(float f)
+{
+    dialog-&gt;ui.progressBar-&gt;setValue((int)(100.*f));
+    
+}
+
+
+
+// EOF


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000394.html">[Avidemux-svn-commit] r3097 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
</A></li>
	<LI>Next message: <A HREF="000396.html">[Avidemux-svn-commit] r3099 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#395">[ date ]</a>
              <a href="thread.html#395">[ thread ]</a>
              <a href="subject.html#395">[ subject ]</a>
              <a href="author.html#395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
