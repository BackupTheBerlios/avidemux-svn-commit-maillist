<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3088 - in	branches/avidemux_2.4_branch/avidemux: . ADM_script	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_commonUI ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3088%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_script%0A%09ADM_toolkit%20ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_videoFilter&In-Reply-To=%3C200705141427.l4EER7Dr003155%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000388.html">
   <LINK REL="Next"  HREF="000390.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3088 - in	branches/avidemux_2.4_branch/avidemux: . ADM_script	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_commonUI ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3088%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_script%0A%09ADM_toolkit%20ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_videoFilter&In-Reply-To=%3C200705141427.l4EER7Dr003155%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3088 - in	branches/avidemux_2.4_branch/avidemux: . ADM_script	ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_gui	ADM_userInterfaces/ADM_commonUI ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Mon May 14 16:27:07 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000388.html">[Avidemux-svn-commit] r3087 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video
</A></li>
        <LI>Next message: <A HREF="000390.html">[Avidemux-svn-commit] r3089 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-05-14 16:27:05 +0200 (Mon, 14 May 2007)
New Revision: 3088

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
file enhancement, vob2vobsub switched to dialogFactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -570,7 +570,7 @@
    uint32_t tog=0;
    char *test=ADM_strdup(&quot;Entry test1&quot;);
     
-      diaElemFileRead fread(&amp;test,&quot;Entry&quot;);
+      diaElemFile fread(0,&amp;test,&quot;Entry&quot;);
       diaElem *elems[]={&amp;fread   };
   if(diaFactoryRun(&quot;Test FileRead&quot;,1,elems))
   {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h	2007-05-14 14:27:05 UTC (rev 3088)
@@ -21,6 +21,7 @@
 void GUI_FileSelRead(const char *label, char * * name);
 void GUI_FileSelWrite(const char *label, char * * name);
 
+uint8_t FileSel_SelectWrite(const char *title,char *target,uint32_t max, const char *source);
 uint8_t FileSel_SelectRead(const char *title,char *target,uint32_t max, const char *source);
 uint8_t FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source);
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -26,7 +26,7 @@
 #define actionVOBSUB    33
 
 
-uint8_t  DIA_v2v(char **vobname, char **ifoname,char **vobsubname)
+uint8_t  DIA_v2vx(char **vobname, char **ifoname,char **vobsubname)
 {
 uint8_t ret=0;
 char *tmp=NULL,*tmp2=NULL,*tmp3=NULL;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -31,15 +31,16 @@
 static void dirSel(void *w,void *p);
 
 
-diaElemFileRead::diaElemFileRead(char **filename,const char *toggleTitle,const char *tip)
+diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_FILE_READ)
 {
   param=(void *)filename;
   paramTitle=toggleTitle;
   this-&gt;tip=tip;
+  _write=writemode;
 }
 
-diaElemFileRead::~diaElemFileRead()
+diaElemFile::~diaElemFile()
 {
 GtkWidget **wid=(GtkWidget **)myWidget;
         if(wid)
@@ -49,7 +50,7 @@
         }
   
 }
-void diaElemFileRead::setMe(void *dialog, void *opaque,uint32_t line)
+void diaElemFile::setMe(void *dialog, void *opaque,uint32_t line)
 {
   GtkObject *adj;
   GtkWidget *label;
@@ -108,7 +109,7 @@
   myWidget=(void *)w;
   
 }
-void diaElemFileRead::getMe(void)
+void diaElemFile::getMe(void)
 {
   GtkWidget **widget=(GtkWidget **)myWidget;
   char **name=(char **)param;
@@ -117,16 +118,19 @@
   *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
 }
 
-void diaElemFileRead::changeFile(void)
+void diaElemFile::changeFile(void)
 {
 #define MAX_SEL 2040
   char buffer[MAX_SEL+1];
+  uint8_t t=0;
   GtkWidget **wid=(GtkWidget **)myWidget;
   GtkWidget *widget=(GtkWidget *)wid[0];
   const char *txt;
   txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
-  if(FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt))
+  if(_write) t=FileSel_SelectWrite(paramTitle,buffer,MAX_SEL,txt);
+      else t= t=FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt);
+  if(t)
   {
     char **name=(char **)param;
     if(*name) delete [] *name;
@@ -137,7 +141,7 @@
   
 }
 
-void   diaElemFileRead::enable(uint32_t onoff)
+void   diaElemFile::enable(uint32_t onoff)
 {
 GtkWidget **wid=(GtkWidget **)myWidget;
      gtk_widget_set_sensitive(GTK_WIDGET(wid[0]),onoff);  
@@ -146,7 +150,7 @@
 
 void fileRead(void *w,void *p)
 {
-  diaElemFileRead *me=(diaElemFileRead *)p;
+  diaElemFile *me=(diaElemFile *)p;
   me-&gt;changeFile();
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -142,6 +142,89 @@
 	return ret;
 }
 /**
+    \fn FileSel_SelectWrite(const char *title,char *target,uint32_t max, const char *source)
+    \brief allow to select a file
+    @return 0 on failure, 1 on success
+    @param title : window title 
+    @param target : where to copy the result (must be allocated by caller)
+    @param max : Max # of bytes that target can hold
+    @param source : where we start from
+*/
+uint8_t FileSel_SelectWrite(const char *title,char *target,uint32_t max, const char *source)
+{
+	
+GtkWidget *dialog;
+uint8_t ret=0;
+gchar *selected_filename;
+gchar last;
+char *dupe=NULL,*tmpname=NULL;
+DIR *dir=NULL;
+	
+	dialog = gtk_file_chooser_dialog_new (&quot;Open File&quot;,
+                                      NULL,
+                                      GTK_FILE_CHOOSER_ACTION_SAVE,
+                                      GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
+                                      GTK_STOCK_OPEN, GTK_RESPONSE_ACCEPT,
+                                      NULL);
+	gtk_window_set_title (GTK_WINDOW (dialog),title);
+        initFileSelector();
+        setFilter(dialog);
+        gtk_register_dialog(dialog);
+//	gtk_transient(dialog);
+	if(source)
+	{
+		dupe=PathCanonize(source);
+		PathStripName(dupe);
+		if( (dir=opendir(dupe)) )
+			{
+				closedir(dir);
+				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
+			}
+		delete [] dupe;
+	
+	}
+	else	//use pref
+	{
+		if( prefs-&gt;get(LASTDIR_WRITE,(ADM_filename **)&amp;tmpname))
+		{
+			
+	
+			dupe=PathCanonize(tmpname);
+			PathStripName(dupe);
+
+			if( (dir=opendir(dupe)) )
+			{
+				closedir(dir);
+				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)dupe);
+			}
+			delete [] dupe;
+		}
+	}
+	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_ACCEPT)
+	{
+			selected_filename= (gchar *) 	gtk_file_chooser_get_filename(GTK_FILE_CHOOSER(dialog));
+			if(strlen(selected_filename))
+			{
+			last=selected_filename[strlen(selected_filename) - 1]; 
+			 if (last == '/' || last =='\\' )
+			 {
+                           GUI_Error_HIG(_(&quot;Cannot open directory as a file&quot;), NULL);
+						return 0;
+			}
+			else
+			{
+                              strncpy(target,(char *)selected_filename,max);
+                              // Finally we accept it :)
+                              ret=1;
+					
+			}
+			}
+	}	
+        gtk_unregister_dialog(dialog);
+	gtk_widget_destroy(dialog);
+	return ret;
+}
+/**
     \fn FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source)
     \brief allow to select a directory
     @return 0 on failure, 1 on success

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -164,26 +164,26 @@
 { 
 }
 //*****************
-diaElemFileRead::diaElemFileRead(char **filename,const char *toggleTitle,const char *tip)
+diaElemFile::diaElemFile(uint32_t write,char **filename,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_FILE_READ)
 {
  
 }
 
-diaElemFileRead::~diaElemFileRead()
+diaElemFile::~diaElemFile()
 {
   
 }
-void diaElemFileRead::setMe(void *dialog, void *opaque,uint32_t line)
+void diaElemFile::setMe(void *dialog, void *opaque,uint32_t line)
 {
  
   
 }
-void diaElemFileRead::getMe(void)
+void diaElemFile::getMe(void)
 {
  
 }
-void   diaElemFileRead::enable(uint32_t onoff)
+void   diaElemFile::enable(uint32_t onoff)
 {}
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
   diaElemBitrate::diaElemBitrate(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -99,7 +99,7 @@
 uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}
 uint8_t DIA_audioTrack(AudioSource *source, uint32_t *track,uint32_t nbTrack, audioInfo *infos){return 0;}
 const char * GUI_getCustomScript(uint32_t nb) {return 0;}
-uint8_t  DIA_v2v(char **vobname, char **ifoname,char **vobsubname) {return 0;}
+//uint8_t  DIA_v2v(char **vobname, char **ifoname,char **vobsubname) {return 0;}
 uint8_t DIA_RecentFiles( char **name ){return 0;}
 
 uint8_t DIA_about( void ){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -35,6 +35,14 @@
 extern const char *shortkey(const char *);
 void GUI_FileSelRead(const char *label, char * * name);
 #define MAX_SEL 2040
+
+typedef enum ADM_fileMode
+{
+    ADM_FILEMODE_DIR,
+    ADM_FILEMODE_READ,
+    ADM_FILEMODE_WRITE
+};
+
 class  ADM_Qfilesel : public QWidget
 {
      Q_OBJECT
@@ -48,11 +56,20 @@
           uint8_t r=0;
           char buffer[MAX_SEL+1],*txt;
           txt=&quot;&quot;;
-          if(!directoryMode)
-            r=FileSel_SelectRead(_(&quot;Select Directory&quot;),buffer,MAX_SEL,txt);
-          else
-            r=FileSel_SelectDir(_(&quot;Select File&quot;),buffer,MAX_SEL,txt);
-            
+          switch(fileMode)
+          {
+            case ADM_FILEMODE_READ:
+                r=FileSel_SelectRead(_(&quot;Select File to Read&quot;),buffer,MAX_SEL,txt);
+                break;
+            case ADM_FILEMODE_WRITE:
+                r=FileSel_SelectWrite(_(&quot;Select File to Write&quot;),buffer,MAX_SEL,txt);
+                break;
+
+            case ADM_FILEMODE_DIR:
+                r=FileSel_SelectDir(_(&quot;Select Directory&quot;),buffer,MAX_SEL,txt);
+                break;
+            default: ADM_assert(0);
+          }
           if(r)
           {
             edit-&gt;setText(buffer);
@@ -62,12 +79,12 @@
         QLineEdit *edit;
         QDialogButtonBox *button;
         QLabel *text;
-        int directoryMode;
+        ADM_fileMode fileMode;
             
-        ADM_Qfilesel(QWidget *z,const char *title,char *entry,QGridLayout *layout,int line,int dir) : QWidget(z) 
+        ADM_Qfilesel(QWidget *z,const char *title,char *entry,QGridLayout *layout,int line, ADM_fileMode mode) : QWidget(z) 
         {
           
-          directoryMode=dir;
+          fileMode=mode;
           edit=new QLineEdit(entry,z);
           
           edit-&gt;show();
@@ -96,27 +113,31 @@
 };
 
 
-diaElemFileRead::diaElemFileRead(char **filename,const char *toggleTitle,const char *tip)
+diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,const char *tip)
   : diaElem(ELEM_FILE_READ)
 {
   param=(void *)filename;
   paramTitle=shortkey(toggleTitle);
   this-&gt;tip=tip;
+  _write=writemode;
 }
 
-diaElemFileRead::~diaElemFileRead()
+diaElemFile::~diaElemFile()
 {
   if(paramTitle)
     delete paramTitle;
 }
-void diaElemFileRead::setMe(void *dialog, void *opaque,uint32_t line)
+void diaElemFile::setMe(void *dialog, void *opaque,uint32_t line)
 {
  QGridLayout *layout=(QGridLayout*) opaque;
-  
-  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,0);
+ ADM_Qfilesel *fs;
+  if(_write)
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_WRITE);
+  else
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_READ);
   myWidget=(void *)fs; 
 }
-void diaElemFileRead::getMe(void)
+void diaElemFile::getMe(void)
 {
   
   char **n=(char **)param;
@@ -126,7 +147,7 @@
   QString s=(fs-&gt;edit)-&gt;text();
   *n=ADM_strdup( s.toLatin1() );
 }
-void diaElemFileRead::enable(uint32_t onoff)
+void diaElemFile::enable(uint32_t onoff)
 {
   ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
   fs-&gt;setEnabled(onoff);
@@ -147,7 +168,7 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,1);
+  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_DIR);
   myWidget=(void *)fs; 
 }
 void diaElemDirSelect::getMe(void) 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -101,6 +101,31 @@
   
 }
 /**
+      \fn FileSel_SelectWrite
+      \brief select file, write mode
+      @param title window title
+      @param target where to store result
+      @param max Max buffer size in bytes
+      @param source Original value
+      @return 1 on success, 0 on failure
+
+*/
+uint8_t FileSel_SelectWrite(const char *title,char *target,uint32_t max, const char *source)
+{
+  char *dir=NULL,*tmpname=NULL;
+   QString fileName;
+ 
+  fileName=QFileDialog::getSaveFileName(QuiMainWindows,title,source);
+                
+  if(!fileName.isNull() )
+  {
+    const char *s=fileName.toLatin1(); // Fixme utf8 ?
+    strncpy(target,s,max);
+  }
+  
+  
+}
+/**
       \fn FileSel_SelectRead
       \brief select file, read mode
       @param title window title

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h	2007-05-14 14:27:05 UTC (rev 3088)
@@ -40,7 +40,7 @@
 PROCESS(actionRebuild_I_B_Frames,ACT_RebuildKF) \
 PROCESS(actionBitrate_histogram,ACT_BitRate) \
 PROCESS(actionScan_for_black_frames,ACT_AllBlackFrames) \
-PROCESS(actionVob_to_vobsub,ACT_DUMMY) \
+PROCESS(actionVob_to_vobsub,ACT_V2V) \
 PROCESS(actionOCR,ACT_Ocr) \
 PROCESS(actionPlay_Stop,ACT_StopAvi) \
 PROCESS(actionPrevious_Frame,ACT_PreviousFrame) \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-05-14 14:27:05 UTC (rev 3088)
@@ -235,17 +235,17 @@
 };
 
 /*************************************************/
-class diaElemFileRead : public diaElem
+class diaElemFile : public diaElem
 {
 
 public:
   
-  diaElemFileRead(char **filename,const char *toggleTitle,const char *tip=NULL);
-  virtual ~diaElemFileRead() ;
+  diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,const char *tip=NULL);
+  virtual ~diaElemFile() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
-  
-  void changeFile(void);
+  uint32_t _write;
+  void   changeFile(void);
   void   enable(uint32_t onoff);
 };
 /*************************************************/

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp (from rev 3067, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_v2v.cpp	2007-05-11 15:41:44 UTC (rev 3067)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -0,0 +1,87 @@
+/***************************************************************************
+                          GUI_mux.h  -  description
+                             -------------------
+    begin                : Wed Jul 3 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+# include &quot;config.h&quot;
+
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+
+# include &lt;math.h&gt;
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_toolkit/filesel.h&quot;
+#include &quot;DIA_factory.h&quot;
+
+/**
+      \fn DIA_v2v
+      \brief  handle vob2vobsub dialog 
+*/
+uint8_t  DIA_v2v(char **vobname, char **ifoname,char **vobsubname)
+{
+uint8_t ret=0;
+char *tmp=NULL,*tmp2=NULL,*tmp3=NULL;
+
+        
+        diaElemFile eVob(0,&amp;tmp,_(&quot;Vob file(s):&quot;),&quot;&quot;);
+        diaElemFile eIfo(0,&amp;tmp2,_(&quot;IFO file:&quot;),&quot;&quot;);
+        diaElemFile eVsub(1,&amp;tmp3,_(&quot;Vobsub file:&quot;),&quot;&quot;);
+        
+        while(1)
+        {
+           diaElem *tabs[]={&amp;eVob,&amp;eIfo,&amp;eVsub};
+          if( diaFactoryRun(_(&quot;Vob 2 Vobsub&quot;),3,tabs))
+	  {
+              if(!ADM_fileExist(tmp))
+              {
+                GUI_Error_HIG(_(&quot;VOB file&quot;),_(&quot;The selected vobfile does not exist.&quot;)); 
+                continue;
+              }
+              if(!ADM_fileExist(tmp2))
+              {
+                GUI_Error_HIG(_(&quot;IFO file&quot;),_(&quot;The selected IFO file does not exist.&quot;)); 
+                continue;
+              }
+              if(strlen(tmp3)&lt;3)
+              {
+                 GUI_Error_HIG(_(&quot;VobSub file&quot;),_(&quot;Select a correct vobsub path/dir.&quot;)); 
+                 continue;
+              }
+                  if(*vobname) ADM_dealloc(*vobname);
+                  if(*ifoname) ADM_dealloc(*ifoname);
+                  if(*vobsubname) ADM_dealloc(*vobsubname);
+
+                    *vobname=*ifoname=*vobsubname=NULL;
+
+                  *vobname=ADM_strdup(tmp);
+                  *ifoname=ADM_strdup(tmp2);
+                  *vobsubname=(char *)ADM_alloc(strlen(tmp3)+5); //ADM_strdup(tmp3);
+                  strcpy(*vobsubname,tmp3);
+                  if(tmp3[strlen(tmp3)-1]!='x'|| tmp3[strlen(tmp3)-2]!='d') 
+                          strcat(*vobsubname,&quot;.idx&quot;);
+                  ADM_dealloc(tmp);
+                  ADM_dealloc(tmp2);
+                  ADM_dealloc(tmp3);
+                  return 1;
+          } 
+          else return 0;
+        }
+        return 0;
+}
+//EOF
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-05-14 14:27:05 UTC (rev 3088)
@@ -7,7 +7,7 @@
 DIA_lavcodec.cpp DIA_mjpeg.cpp DIA_requant.cpp \
 DIA_audioFilter.cpp DIA_flyDialog.cpp DIA_flyCrop.cpp \
 DIA_flyAsharp.cpp DIA_flyChromaShift.cpp DIA_flyContrast.cpp \
-DIA_tdeint.cpp
+DIA_tdeint.cpp DIA_v2v.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASS.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -82,7 +82,7 @@
     MKME(scale,font_scale);
     MKME(spacing,line_spacing);
     
-    diaElemFileRead   file((char **)PX(subfile),_(&quot;_Subtitle file (ass/ssa)&quot;));
+    diaElemFile       file(0,(char **)PX(subfile),_(&quot;_Subtitle file (ass/ssa)&quot;));
     diaElemFloat      dSpacing(&amp;spacing,_(&quot;_Line spacing&quot;),0.10,10.0);
     diaElemFloat      dScale(&amp;scale,_(&quot;_Font scale&quot;),0.10,10.0);
     diaElemUInteger   dTop(PX(top_margin),_(&quot;_Top margin&quot;),0,200);

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-05-14 12:38:05 UTC (rev 3087)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-05-14 14:27:05 UTC (rev 3088)
@@ -2003,7 +2003,7 @@
         
         
         
-        diaElemFileRead sourceName(&amp;newtrackname,_(&quot;_External file:&quot;));
+        diaElemFile  sourceName(0,&amp;newtrackname,_(&quot;_External file:&quot;));
         
         // Now build the list of embedded track
 #define MAX_AUDIO_TRACK 10
@@ -2100,7 +2100,7 @@
         old=nw=secondAudioSource;
 
         diaElemMenu     sourceMenu(&amp;nw,_(&quot;_Audio source:&quot;),4,sourcesStream,NULL);
-        diaElemFileRead sourceName(&amp;newtrackname,_(&quot;_External file:&quot;));
+        diaElemFile     sourceName(0,&amp;newtrackname,_(&quot;_External file:&quot;));
         diaElem *allWidgets[]={&amp;sourceMenu,&amp;sourceName};
 
   /* Link..*/


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000388.html">[Avidemux-svn-commit] r3087 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video
</A></li>
	<LI>Next message: <A HREF="000390.html">[Avidemux-svn-commit] r3089 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
