<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3442 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_gui2 ADM_NONE/ADM_gui2 ADM_QT4/ADM_gui ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3442%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_gui2%20ADM_NONE/ADM_gui2%20ADM_QT4/ADM_gui%20ADM_commonUI&In-Reply-To=%3C200707241853.l6OIrjq2017634%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000716.html">
   <LINK REL="Next"  HREF="000718.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3442 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_gui2 ADM_NONE/ADM_gui2 ADM_QT4/ADM_gui ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3442%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces%3A%0A%09ADM_GTK/ADM_gui2%20ADM_NONE/ADM_gui2%20ADM_QT4/ADM_gui%20ADM_commonUI&In-Reply-To=%3C200707241853.l6OIrjq2017634%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3442 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_gui2 ADM_NONE/ADM_gui2 ADM_QT4/ADM_gui ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Tue Jul 24 20:53:45 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000716.html">[Avidemux-svn-commit] r3441 - in	branches/avidemux_2.4_branch/avidemux: ADM_osSupport	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
</A></li>
        <LI>Next message: <A HREF="000718.html">[Avidemux-svn-commit] r3443 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#717">[ date ]</a>
              <a href="thread.html#717">[ thread ]</a>
              <a href="subject.html#717">[ subject ]</a>
              <a href="author.html#717">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2007-07-24 20:53:25 +0200 (Tue, 24 Jul 2007)
New Revision: 3442

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
Log:
[Playback] resize Qt4 playback window to fit video + reduce zoom if it exceeds screen resolution

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -1080,11 +1080,6 @@
         return 1;
 }
 
-uint8_t UI_shrink(uint32_t w,uint32_t h)
-{
-        gtk_widget_set_usize(guiRootWindow, w, h);
-        return 1;
-}
 // Override arrow keys to quickly navigate
 uint8_t UI_arrow_enabled(void)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -126,10 +126,6 @@
   return 1;
 }
 
-uint8_t UI_shrink(uint32_t w,uint32_t h)
-{
-  return 1;
-}
 uint8_t UI_arrow_enabled(void)
 {
   return 1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -1,706 +1,712 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#define CUSTOM_SLIDER
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;math.h&gt;
-
-#include &lt;QtCore/QVariant&gt;
-#include &lt;QtGui/QAction&gt;
-#include &lt;QtGui/QApplication&gt;
-#include &lt;QtGui/QButtonGroup&gt;
-#include &lt;QtGui/QFrame&gt;
-#include &lt;QtGui/QGraphicsView&gt;
-#include &lt;QtGui/QHBoxLayout&gt;
-#include &lt;QtGui/QMainWindow&gt;
-#include &lt;QtGui/QMenu&gt;
-#include &lt;QtGui/QMenuBar&gt;
-#include &lt;QtGui/QSlider&gt;
-#include &lt;QtGui/QSpacerItem&gt;
-#include &lt;QtGui/QStatusBar&gt;
-#include &lt;QtGui/QToolButton&gt;
-#include &lt;QtGui/QVBoxLayout&gt;
-#include &lt;QtGui/QWidget&gt;
-#include &lt;ADM_qslider.h&gt;
-
-#include &quot;default.h&quot;
-#include &quot;ADM_osSupport/ADM_misc.h&quot;
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;gui_action.hxx&quot;
-#include &quot;ADM_editor/ADM_outputfmt.h&quot;
-#include &quot;ADM_toolkit/filesel.h&quot;
-#include &quot;prefs.h&quot;
-
-extern int automation(void );
-extern void HandleAction(Action a);
-extern uint32_t encoderGetNbEncoder (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-extern uint32_t audioFilterGetNbEncoder(void);
-extern const char* audioFilterGetIndexedName(uint32_t i);
-extern void checkCrashFile(void);
-static void setupMenus(void);
-static void GUI_initCustom(void);
-#ifdef CUSTOM_SLIDER
-static ADM_QSlider *slider=NULL;
-#else
-static QSlider *slider=NULL;
-#endif
-static int _upd_in_progres=0;
-/* Ugly game with macro so that buttons emit their name ...*/
-static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
-static QAction  *customActions[ADM_MAC_CUSTOM_SCRIPT];
-static uint32_t ADM_nbCustom=0;
-
-
-#include &quot;ui_gui2.h&quot;
-
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
-    
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-             
-#include &quot;translation_table.h&quot;    
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct adm_qt4_translation
-{
-  const char *name;
-  Action     action; 
-};
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-     LIST_OF_OBJECTS
-     LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-/*
-    Declare the class that will be our main window
-
-*/
- class MainWindow : public QMainWindow
- {
-     Q_OBJECT
-
- public:
-     MainWindow();
-     Ui_MainWindow ui;
- public slots:
-     void timeChanged(int);
-     void buttonPressed(void);
-     void custom(void);
-     void toolButtonPressed(bool z);
-     void comboChanged(int z)
-     {
-        const char *source=qPrintable(sender()-&gt;objectName());
-
-        if(!strcmp(source,&quot;comboBoxVideo&quot;))  
-        {
-          bool b=FALSE;;
-          if(ui.comboBoxVideo-&gt;currentIndex())
-          {
-             b=TRUE;
-          }
-          ui.pushButtonVideoConf-&gt;setEnabled(b);
-          ui.pushButtonVideoFilter-&gt;setEnabled(b);
-          HandleAction (ACT_VideoCodecChanged) ;
-        }
-        else 
-          if(!strcmp(source,&quot;comboBoxAudio&quot;))  
-        {
-          bool b=FALSE;
-          if(ui.comboBoxAudio-&gt;currentIndex())
-          {
-             b=TRUE;
-          }
-          ui.pushButtonAudioConf-&gt;setEnabled(b);
-          ui.pushButtonAudioFilter-&gt;setEnabled(b);
-          HandleAction (ACT_AudioCodecChanged) ;
-        }else
-        if(!strcmp(source,&quot;comboBoxPreview&quot;))  
-        {
-          HandleAction (ACT_PreviewChanged) ;
-        }
-        
-
-        printf(&quot;From +: %s\n&quot;,source);
-     }
-      void sliderMoved(int u) 
-        {
-          if(!_upd_in_progres)
-          {
-            HandleAction (ACT_Scale) ;
-          }
-        }
- private slots:
-   
-
- private:
-     
- };
-
-
-MainWindow::MainWindow()     : QMainWindow()
- {
-     ui.setupUi(this);
-     /*
-        Connect our button to buttonPressed
-     */
-#define PROCESS CONNECT
-     LIST_OF_OBJECTS
-#undef PROCESS
-#define PROCESS CONNECT_TB
-     LIST_OF_BUTTONS
-#undef PROCESS
-     // ComboBox
-         
-         
-         
-         //ACT_VideoCodecChanged
-         connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-         connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-         connect( ui.comboBoxPreview,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-     // Slider
-          slider=ui.horizontalSlider;
-          slider-&gt;setMinimum(0);
-          slider-&gt;setMaximum(1000);
-          connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
-          //connect( slider,SIGNAL(sliderMoved()),this,SLOT(sliderMoved()));
-  
-          // Add a second toolbar
-          QToolBar *toolBarMove;
-            toolBarMove = new QToolBar(this);
-            toolBarMove-&gt;setObjectName(QString::fromUtf8(&quot;toolBarMove&quot;));
-            toolBarMove-&gt;setOrientation(Qt::Horizontal);
-            this-&gt;addToolBar(static_cast&lt;Qt::ToolBarArea&gt;(4), toolBarMove);
-          // And actions to it
-#define ADD(x) toolBarMove-&gt;addAction(ui.x)
-            ADD(actionPlay);
-            ADD(actionPlay_Stop);
-            ADD(actionPrevious_Frame);
-            ADD(actionNext_Frame);
-            ADD(actionPrevious_intra_frame);
-            ADD(actionNext_intra_frame);
-            ADD(actionSet_marker_A);
-            ADD(actionSet_marker_B);
-            ADD(actionPrevious_black_frame);
-            ADD(actionNext_blak_frame);
-            ADD(actionFirst_Frame);
-            ADD(actionLast_Frame);
-            ADD(actionGo_to_Marker_A);
-            ADD(actionGo_to_Marker_B);
-            //** Add shortcuts **//
-            QKeySequence seqFilter(&quot;CTRL+Alt+F&quot;);
-            ui.actionFilters-&gt;setShortcut(seqFilter);
-            // default state
-            bool b=0;
-          ui.pushButtonVideoConf-&gt;setEnabled(b);
-          ui.pushButtonVideoFilter-&gt;setEnabled(b);
-          ui.pushButtonAudioConf-&gt;setEnabled(b);
-          ui.pushButtonAudioFilter-&gt;setEnabled(b);
-          /* Time Shift */
-  connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-  connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-          
-          
-          
-          /* Build the custom menu */
-          GUI_initCustom();
-          for(int i=0;i&lt;ADM_nbCustom;i++)
-          {
-            customActions[i]=new QAction(customNames[i],NULL);
-            ui.menuCustom-&gt;addAction(customActions[i]);
-            connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
-          }
-          printf(&quot;Menu built\n&quot;);
- }
- /**
-    \fn     custom
-    \brief  Invoked when one of the custom script has been called
- */
-void MainWindow::custom(void)
-{
-    printf(&quot;[CUSTOM] Invoked\n&quot;);
-    QObject *ptr=sender();
-    if(!ptr) return;
-    for(int i=0;i&lt;ADM_nbCustom;i++)
-    {
-      if(customActions[i]==ptr)
-      {
-        printf(&quot;[Custom] %u/%u scrips\n&quot;,i,ADM_nbCustom);
-        HandleAction( (Action)(ACT_CUSTOM_BASE+i));
-        return; 
-      }
-    }
-    printf(&quot;[Custom] Not found\n&quot;);
-}
-/**
-    Get the custom entry 
-
-*/
-const char * GUI_getCustomScript(uint32_t nb)
-{
-    ADM_assert(nb&lt;ADM_nbCustom);
-    return customNames[nb];
-
-}
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-   HandleAction (ACT_TimeShift) ;
-}
- /*
-      We receive a button press event
- */
- void MainWindow::buttonPressed(void)
- {
-    // Receveid a key press Event, look into table..
-   const char *source=qPrintable(sender()-&gt;objectName());
-
-    printf(&quot;Button From : %s\n&quot;,source);
-    Action action=searchTranslationTable(source);
-    if(action!=ACT_DUMMY)
-    {
-      HandleAction (action) ;
-    }
-
- }
-  void MainWindow::toolButtonPressed(bool i)
-  {
-     buttonPressed();
-  }
-//*********************************************
-//***** Hook to core                ***********
-//*********************************************
-extern int global_argc;
-extern char **global_argv;
-extern void UI_QT4VideoWidget(QFrame *frame);
-int UI_Init(int nargc,char **nargv)
-{
-  global_argc=nargc;
-  global_argv=nargv;
-  return 0;
-}
-QWidget *QuiMainWindows=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-
-int    UI_getCurrentPreview(void)
-{
-  return WIDGET(comboBoxPreview)-&gt;currentIndex(); 
-}
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-
-void   UI_setCurrentPreview(int ne)
-{
-    WIDGET(comboBoxPreview)-&gt;setCurrentIndex(ne); 
-}
-
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-Q_INIT_RESOURCE(avidemux);
-Q_INIT_RESOURCE(filter);
-   QApplication a( global_argc, global_argv );
-   MainWindow * mw = new MainWindow();
-    
-    a.connect( &amp;a, SIGNAL(lastWindowClosed()), &amp;a, SLOT(quit()) );
-    
-    mw-&gt;show();
-    
-    QuiMainWindows=(QWidget*)mw;
-   
-    UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
-    UI_updateRecentMenu(  );
-    setupMenus();
-    checkCrashFile();
-    
-   if (global_argc &gt;= 2)
-    {
-     automation();
-    }
-    return a.exec();
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-  for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
-  {
-    if(!strcmp(name, myTranslationTable[i].name))
-    {
-      return  myTranslationTable[i].action;
-    }
-  }
-  printf(&quot;WARNING : Signal not found in translation table : %s\n&quot;,name);
-  return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-const char **names;
-uint32_t nb_item=0;
-QAction *actions[4]={WIDGET(actionRecent0),WIDGET(actionRecent1),WIDGET(actionRecent2),WIDGET(actionRecent3)};
-        names=prefs-&gt;get_lastfiles();
-        
-        // hide them all
-        for(int i=0;i&lt;4;i++) actions[i]-&gt;setVisible(0);
-        // Redraw..
-        for( nb_item=0;nb_item&lt;4;nb_item++)
-        {
-                if(!names[nb_item]) 
-                {
-                   return 1;
-                }
-                else
-                {
-                    //actions[nb_item]-&gt;setVisible(1);
-                    // Replace widget ?
-                    actions[nb_item]-&gt;setText(names[nb_item]);
-                    actions[nb_item]-&gt;setVisible(1);
-                }
-                // Update name
-        }
-        return 1;
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video &amp; audio co
-*/
-void setupMenus(void)
-{
-        uint32_t nbVid;
-        const char *name;
-
-                nbVid=encoderGetNbEncoder();
-                printf(&quot;Found %d video encoder\n&quot;,nbVid);
-                for(uint32_t i=1;i&lt;nbVid;i++)
-                {
-                        name=encoderGetIndexedName(i);
-                        WIDGET(comboBoxVideo)-&gt;addItem(name);
-                }
-
-        // And A codec
-        
-        uint32_t nbAud;
-
-                nbAud=audioFilterGetNbEncoder();
-                printf(&quot;Found %d audio encoder\n&quot;,nbAud);		       
-                for(uint32_t i=1;i&lt;nbAud;i++)
-                {
-                        name=audioFilterGetIndexedName(i);
-                        WIDGET(comboBoxAudio)-&gt;addItem(name);
-                }
-      /*   Fill in output format window */
-        uint32_t nbFormat;
-
-                nbFormat=sizeof(ADM_allOutputFormat)/sizeof(ADM_FORMAT_DESC);
-                printf(&quot;Found %d Format \n&quot;,nbFormat);
-                for(uint32_t i=0;i&lt;nbFormat;i++)
-                {
-                       WIDGET(comboBoxFormat)-&gt;addItem(_(ADM_allOutputFormat[i].text));	
-                }
-        
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-  double v;
-  if(!slider) v=0;
-  v= (double)(slider-&gt;value());
-  v/=10;
-  printf(&quot;GetScale\n&quot;);
-  return v;
-}
-void UI_setScale( double val )
-{
-if(_upd_in_progres) return;
- _upd_in_progres++;
-   slider-&gt;setValue( (int)val*10);
- _upd_in_progres--;
-   
-}
-void UI_purge( void )
-{
- QCoreApplication::processEvents ();
-}
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(char *name)
-{
-      char title[1024];
-
-      strcpy(title,&quot;Avidemux 2 &quot;);
-      strncat(title,name,200);
-
-      QuiMainWindows-&gt;setWindowTitle( title);
-}
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-char string[100];
-char	c='?';
-      switch(frametype)
-      {
-              case AVI_KEY_FRAME: c='I';break;
-              case AVI_B_FRAME: c='B';break;
-              case 0: c='P';break;
-              default:c='?';break;
-      
-      }
-      sprintf(string,_(&quot;Frame:%c(%02d)&quot;),c,qp);
-      WIDGET(label_8)-&gt;setText(string);	
-
-}
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-
-void UI_updateFrameCount(uint32_t curFrame)
-{
-    char string[30];
-        sprintf(string,&quot;%lu&quot;,curFrame);
-	WIDGET(lineEdit)-&gt;setText(string);
-    
-}
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-    char text[80]; 
-    if(total) total--; // We display from 0 to X  
-    
-    UI_updateFrameCount(curFrame);
-    
-    sprintf(text, &quot;/ %lu &quot;, total);
-    WIDGET(label_2)-&gt;setText(text);
-    
-}
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
- char text[80];   
- uint16_t mm,hh,ss,ms;
-
-      frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
-      sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-      WIDGET(lineEdit_2)-&gt;setText(text);
-
-}
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000) and total duration
-*/
-
-void UI_setTimeCount(uint32_t curFrame,uint32_t total, uint32_t fps)
-{
- char text[80];   
- uint16_t mm,hh,ss,ms;
-
-        UI_updateTimeCount(curFrame,fps);
-      frame2time(total,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
-      sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-      WIDGET(label_7)-&gt;setText(text);
-#ifdef CUSTOM_SLIDER
-      slider-&gt;setNbFrames(total);
-#endif
-}
-/**
-    \fn     UI_setMarkers(uint32_t a, uint32_t b )
-    \brief  Display frame # for marker A &amp; B
-*/
-
-void UI_setMarkers(uint32_t a, uint32_t b )
-{
- char text[80];
-      snprintf(text,79,&quot;%lu&quot;,a);
-      WIDGET(label_9)-&gt;setText(text);
-      snprintf(text,79,&quot;%lu&quot;,b);
-      WIDGET(label_10)-&gt;setText(text);
-      //
-#ifdef CUSTOM_SLIDER
-      slider-&gt;setA(a);
-      slider-&gt;setB(b);
-#endif
-}
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentVCodec(void)
-{
-  int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
-  if(i&lt;0) i=0;
-  return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-  int b=!!i;
-    WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
-    
-     WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
-     WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-   int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
-  if(i&lt;0) i=0;
-  return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-   WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
-    WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
-    WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-ADM_OUT_FORMAT 	UI_GetCurrentFormat( void )
-{
-    int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
-  if(i&lt;0) i=0;
-  return (ADM_OUT_FORMAT)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-{
-    WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
-}
-uint8_t UI_sliderResize(uint32_t w)
-{
-  printf(&quot;sliderResize %u\n&quot;,w);
-  slider-&gt;resize(w,w);
-  return 1; 
-}
-/**
-      \fn GUI_initCustom
-      \brief Initialize custom menu
-*/
-void GUI_initCustom(void )
-{
-  char *customdir=ADM_getCustomDir();
-  if(!customdir) 
-  {
-      printf(&quot;No custom dir...\n&quot;);
-      return;
-  }
-  /* Collect the name */
-   if(! buildDirectoryContent(&amp;ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,&quot;.js&quot;))
-    {
-      printf(&quot;Failed to build custom dir content&quot;);
-      return;
-    }
-  if(!ADM_nbCustom)
-  {
-      printf(&quot;No custom script\n&quot;);
-  }
-  printf(&quot;Found %u custom scripts, adding them\n&quot;,ADM_nbCustom);
-}
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-  if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
-        *onoff=1;
-  else
-        *onoff=0;
-  *value=WIDGET(spinBox_TimeValue)-&gt;value();
-  return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-  if(onoff)
-    WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
-  else
-    WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
-  WIDGET(spinBox_TimeValue)-&gt;setValue(value);
-  return 1;
-}
-
-//********************************************
-//EOF
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+#define CUSTOM_SLIDER
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;math.h&gt;
+
+#include &lt;QtCore/QVariant&gt;
+#include &lt;QtGui/QAction&gt;
+#include &lt;QtGui/QApplication&gt;
+#include &lt;QtGui/QButtonGroup&gt;
+#include &lt;QtGui/QFrame&gt;
+#include &lt;QtGui/QGraphicsView&gt;
+#include &lt;QtGui/QHBoxLayout&gt;
+#include &lt;QtGui/QMainWindow&gt;
+#include &lt;QtGui/QMenu&gt;
+#include &lt;QtGui/QMenuBar&gt;
+#include &lt;QtGui/QSlider&gt;
+#include &lt;QtGui/QSpacerItem&gt;
+#include &lt;QtGui/QStatusBar&gt;
+#include &lt;QtGui/QToolButton&gt;
+#include &lt;QtGui/QVBoxLayout&gt;
+#include &lt;QtGui/QWidget&gt;
+#include &lt;ADM_qslider.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_osSupport/ADM_misc.h&quot;
+#include &quot;ADM_codecs/ADM_codec.h&quot;
+#include &quot;gui_action.hxx&quot;
+#include &quot;ADM_editor/ADM_outputfmt.h&quot;
+#include &quot;ADM_toolkit/filesel.h&quot;
+#include &quot;prefs.h&quot;
+
+extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern uint32_t encoderGetNbEncoder (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+extern uint32_t audioFilterGetNbEncoder(void);
+extern const char* audioFilterGetIndexedName(uint32_t i);
+extern void checkCrashFile(void);
+static void setupMenus(void);
+static void GUI_initCustom(void);
+#ifdef CUSTOM_SLIDER
+static ADM_QSlider *slider=NULL;
+#else
+static QSlider *slider=NULL;
+#endif
+static int _upd_in_progres=0;
+/* Ugly game with macro so that buttons emit their name ...*/
+static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
+static QAction  *customActions[ADM_MAC_CUSTOM_SCRIPT];
+static uint32_t ADM_nbCustom=0;
+
+
+#include &quot;ui_gui2.h&quot;
+
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
+    
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+             
+#include &quot;translation_table.h&quot;    
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct adm_qt4_translation
+{
+  const char *name;
+  Action     action; 
+};
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+     LIST_OF_OBJECTS
+     LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+/*
+    Declare the class that will be our main window
+
+*/
+ class MainWindow : public QMainWindow
+ {
+     Q_OBJECT
+
+ public:
+     MainWindow();
+     Ui_MainWindow ui;
+ public slots:
+     void timeChanged(int);
+     void buttonPressed(void);
+     void custom(void);
+     void toolButtonPressed(bool z);
+     void comboChanged(int z)
+     {
+        const char *source=qPrintable(sender()-&gt;objectName());
+
+        if(!strcmp(source,&quot;comboBoxVideo&quot;))  
+        {
+          bool b=FALSE;;
+          if(ui.comboBoxVideo-&gt;currentIndex())
+          {
+             b=TRUE;
+          }
+          ui.pushButtonVideoConf-&gt;setEnabled(b);
+          ui.pushButtonVideoFilter-&gt;setEnabled(b);
+          HandleAction (ACT_VideoCodecChanged) ;
+        }
+        else 
+          if(!strcmp(source,&quot;comboBoxAudio&quot;))  
+        {
+          bool b=FALSE;
+          if(ui.comboBoxAudio-&gt;currentIndex())
+          {
+             b=TRUE;
+          }
+          ui.pushButtonAudioConf-&gt;setEnabled(b);
+          ui.pushButtonAudioFilter-&gt;setEnabled(b);
+          HandleAction (ACT_AudioCodecChanged) ;
+        }else
+        if(!strcmp(source,&quot;comboBoxPreview&quot;))  
+        {
+          HandleAction (ACT_PreviewChanged) ;
+        }
+        
+
+        printf(&quot;From +: %s\n&quot;,source);
+     }
+      void sliderMoved(int u) 
+        {
+          if(!_upd_in_progres)
+          {
+            HandleAction (ACT_Scale) ;
+          }
+        }
+ private slots:
+   
+
+ private:
+     
+ };
+
+
+MainWindow::MainWindow()     : QMainWindow()
+ {
+     ui.setupUi(this);
+     /*
+        Connect our button to buttonPressed
+     */
+#define PROCESS CONNECT
+     LIST_OF_OBJECTS
+#undef PROCESS
+#define PROCESS CONNECT_TB
+     LIST_OF_BUTTONS
+#undef PROCESS
+     // ComboBox
+         
+         
+         
+         //ACT_VideoCodecChanged
+         connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+         connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+         connect( ui.comboBoxPreview,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+     // Slider
+          slider=ui.horizontalSlider;
+          slider-&gt;setMinimum(0);
+          slider-&gt;setMaximum(1000);
+          connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderMoved(int)));
+          //connect( slider,SIGNAL(sliderMoved()),this,SLOT(sliderMoved()));
+  
+          // Add a second toolbar
+          QToolBar *toolBarMove;
+            toolBarMove = new QToolBar(this);
+            toolBarMove-&gt;setObjectName(QString::fromUtf8(&quot;toolBarMove&quot;));
+            toolBarMove-&gt;setOrientation(Qt::Horizontal);
+            this-&gt;addToolBar(static_cast&lt;Qt::ToolBarArea&gt;(4), toolBarMove);
+          // And actions to it
+#define ADD(x) toolBarMove-&gt;addAction(ui.x)
+            ADD(actionPlay);
+            ADD(actionPlay_Stop);
+            ADD(actionPrevious_Frame);
+            ADD(actionNext_Frame);
+            ADD(actionPrevious_intra_frame);
+            ADD(actionNext_intra_frame);
+            ADD(actionSet_marker_A);
+            ADD(actionSet_marker_B);
+            ADD(actionPrevious_black_frame);
+            ADD(actionNext_blak_frame);
+            ADD(actionFirst_Frame);
+            ADD(actionLast_Frame);
+            ADD(actionGo_to_Marker_A);
+            ADD(actionGo_to_Marker_B);
+            //** Add shortcuts **//
+            QKeySequence seqFilter(&quot;CTRL+Alt+F&quot;);
+            ui.actionFilters-&gt;setShortcut(seqFilter);
+            // default state
+            bool b=0;
+          ui.pushButtonVideoConf-&gt;setEnabled(b);
+          ui.pushButtonVideoFilter-&gt;setEnabled(b);
+          ui.pushButtonAudioConf-&gt;setEnabled(b);
+          ui.pushButtonAudioFilter-&gt;setEnabled(b);
+          /* Time Shift */
+  connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+  connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+          
+          
+          
+          /* Build the custom menu */
+          GUI_initCustom();
+          for(int i=0;i&lt;ADM_nbCustom;i++)
+          {
+            customActions[i]=new QAction(customNames[i],NULL);
+            ui.menuCustom-&gt;addAction(customActions[i]);
+            connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+          }
+          printf(&quot;Menu built\n&quot;);
+ }
+ /**
+    \fn     custom
+    \brief  Invoked when one of the custom script has been called
+ */
+void MainWindow::custom(void)
+{
+    printf(&quot;[CUSTOM] Invoked\n&quot;);
+    QObject *ptr=sender();
+    if(!ptr) return;
+    for(int i=0;i&lt;ADM_nbCustom;i++)
+    {
+      if(customActions[i]==ptr)
+      {
+        printf(&quot;[Custom] %u/%u scrips\n&quot;,i,ADM_nbCustom);
+        HandleAction( (Action)(ACT_CUSTOM_BASE+i));
+        return; 
+      }
+    }
+    printf(&quot;[Custom] Not found\n&quot;);
+}
+/**
+    Get the custom entry 
+
+*/
+const char * GUI_getCustomScript(uint32_t nb)
+{
+    ADM_assert(nb&lt;ADM_nbCustom);
+    return customNames[nb];
+
+}
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+   HandleAction (ACT_TimeShift) ;
+}
+ /*
+      We receive a button press event
+ */
+ void MainWindow::buttonPressed(void)
+ {
+    // Receveid a key press Event, look into table..
+   const char *source=qPrintable(sender()-&gt;objectName());
+
+    printf(&quot;Button From : %s\n&quot;,source);
+    Action action=searchTranslationTable(source);
+    if(action!=ACT_DUMMY)
+    {
+      HandleAction (action) ;
+    }
+
+ }
+  void MainWindow::toolButtonPressed(bool i)
+  {
+     buttonPressed();
+  }
+//*********************************************
+//***** Hook to core                ***********
+//*********************************************
+extern int global_argc;
+extern char **global_argv;
+extern void UI_QT4VideoWidget(QFrame *frame);
+int UI_Init(int nargc,char **nargv)
+{
+  global_argc=nargc;
+  global_argv=nargv;
+  return 0;
+}
+QWidget *QuiMainWindows=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+
+int    UI_getCurrentPreview(void)
+{
+  return WIDGET(comboBoxPreview)-&gt;currentIndex(); 
+}
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+
+void   UI_setCurrentPreview(int ne)
+{
+    WIDGET(comboBoxPreview)-&gt;setCurrentIndex(ne); 
+}
+
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+Q_INIT_RESOURCE(avidemux);
+Q_INIT_RESOURCE(filter);
+   QApplication a( global_argc, global_argv );
+   MainWindow * mw = new MainWindow();
+    
+    a.connect( &amp;a, SIGNAL(lastWindowClosed()), &amp;a, SLOT(quit()) );
+    
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(&amp;w,&amp;h); //gtk_widget_get_parent_window (guiRootWindow));
+    printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
+
+    mw-&gt;show();
+    
+    QuiMainWindows=(QWidget*)mw;
+   
+    UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
+    UI_updateRecentMenu(  );
+    setupMenus();
+    checkCrashFile();
+    
+   if (global_argc &gt;= 2)
+    {
+     automation();
+    }
+    return a.exec();
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+  for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
+  {
+    if(!strcmp(name, myTranslationTable[i].name))
+    {
+      return  myTranslationTable[i].action;
+    }
+  }
+  printf(&quot;WARNING : Signal not found in translation table : %s\n&quot;,name);
+  return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+const char **names;
+uint32_t nb_item=0;
+QAction *actions[4]={WIDGET(actionRecent0),WIDGET(actionRecent1),WIDGET(actionRecent2),WIDGET(actionRecent3)};
+        names=prefs-&gt;get_lastfiles();
+        
+        // hide them all
+        for(int i=0;i&lt;4;i++) actions[i]-&gt;setVisible(0);
+        // Redraw..
+        for( nb_item=0;nb_item&lt;4;nb_item++)
+        {
+                if(!names[nb_item]) 
+                {
+                   return 1;
+                }
+                else
+                {
+                    //actions[nb_item]-&gt;setVisible(1);
+                    // Replace widget ?
+                    actions[nb_item]-&gt;setText(names[nb_item]);
+                    actions[nb_item]-&gt;setVisible(1);
+                }
+                // Update name
+        }
+        return 1;
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video &amp; audio co
+*/
+void setupMenus(void)
+{
+        uint32_t nbVid;
+        const char *name;
+
+                nbVid=encoderGetNbEncoder();
+                printf(&quot;Found %d video encoder\n&quot;,nbVid);
+                for(uint32_t i=1;i&lt;nbVid;i++)
+                {
+                        name=encoderGetIndexedName(i);
+                        WIDGET(comboBoxVideo)-&gt;addItem(name);
+                }
+
+        // And A codec
+        
+        uint32_t nbAud;
+
+                nbAud=audioFilterGetNbEncoder();
+                printf(&quot;Found %d audio encoder\n&quot;,nbAud);		       
+                for(uint32_t i=1;i&lt;nbAud;i++)
+                {
+                        name=audioFilterGetIndexedName(i);
+                        WIDGET(comboBoxAudio)-&gt;addItem(name);
+                }
+      /*   Fill in output format window */
+        uint32_t nbFormat;
+
+                nbFormat=sizeof(ADM_allOutputFormat)/sizeof(ADM_FORMAT_DESC);
+                printf(&quot;Found %d Format \n&quot;,nbFormat);
+                for(uint32_t i=0;i&lt;nbFormat;i++)
+                {
+                       WIDGET(comboBoxFormat)-&gt;addItem(_(ADM_allOutputFormat[i].text));	
+                }
+        
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+  double v;
+  if(!slider) v=0;
+  v= (double)(slider-&gt;value());
+  v/=10;
+  printf(&quot;GetScale\n&quot;);
+  return v;
+}
+void UI_setScale( double val )
+{
+if(_upd_in_progres) return;
+ _upd_in_progres++;
+   slider-&gt;setValue( (int)val*10);
+ _upd_in_progres--;
+   
+}
+void UI_purge( void )
+{
+ QCoreApplication::processEvents ();
+}
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(char *name)
+{
+      char title[1024];
+
+      strcpy(title,&quot;Avidemux 2 &quot;);
+      strncat(title,name,200);
+
+      QuiMainWindows-&gt;setWindowTitle( title);
+}
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+char string[100];
+char	c='?';
+      switch(frametype)
+      {
+              case AVI_KEY_FRAME: c='I';break;
+              case AVI_B_FRAME: c='B';break;
+              case 0: c='P';break;
+              default:c='?';break;
+      
+      }
+      sprintf(string,_(&quot;Frame:%c(%02d)&quot;),c,qp);
+      WIDGET(label_8)-&gt;setText(string);	
+
+}
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+
+void UI_updateFrameCount(uint32_t curFrame)
+{
+    char string[30];
+        sprintf(string,&quot;%lu&quot;,curFrame);
+	WIDGET(lineEdit)-&gt;setText(string);
+    
+}
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+    char text[80]; 
+    if(total) total--; // We display from 0 to X  
+    
+    UI_updateFrameCount(curFrame);
+    
+    sprintf(text, &quot;/ %lu &quot;, total);
+    WIDGET(label_2)-&gt;setText(text);
+    
+}
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+ char text[80];   
+ uint16_t mm,hh,ss,ms;
+
+      frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
+      sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+      WIDGET(lineEdit_2)-&gt;setText(text);
+
+}
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000) and total duration
+*/
+
+void UI_setTimeCount(uint32_t curFrame,uint32_t total, uint32_t fps)
+{
+ char text[80];   
+ uint16_t mm,hh,ss,ms;
+
+        UI_updateTimeCount(curFrame,fps);
+      frame2time(total,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
+      sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+      WIDGET(label_7)-&gt;setText(text);
+#ifdef CUSTOM_SLIDER
+      slider-&gt;setNbFrames(total);
+#endif
+}
+/**
+    \fn     UI_setMarkers(uint32_t a, uint32_t b )
+    \brief  Display frame # for marker A &amp; B
+*/
+
+void UI_setMarkers(uint32_t a, uint32_t b )
+{
+ char text[80];
+      snprintf(text,79,&quot;%lu&quot;,a);
+      WIDGET(label_9)-&gt;setText(text);
+      snprintf(text,79,&quot;%lu&quot;,b);
+      WIDGET(label_10)-&gt;setText(text);
+      //
+#ifdef CUSTOM_SLIDER
+      slider-&gt;setA(a);
+      slider-&gt;setB(b);
+#endif
+}
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentVCodec(void)
+{
+  int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
+  if(i&lt;0) i=0;
+  return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+  int b=!!i;
+    WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
+    
+     WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
+     WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+   int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
+  if(i&lt;0) i=0;
+  return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+   WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
+    WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
+    WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+ADM_OUT_FORMAT 	UI_GetCurrentFormat( void )
+{
+    int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
+  if(i&lt;0) i=0;
+  return (ADM_OUT_FORMAT)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+{
+    WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
+}
+uint8_t UI_sliderResize(uint32_t w)
+{
+  printf(&quot;sliderResize %u\n&quot;,w);
+  slider-&gt;resize(w,w);
+  return 1; 
+}
+/**
+      \fn GUI_initCustom
+      \brief Initialize custom menu
+*/
+void GUI_initCustom(void )
+{
+  char *customdir=ADM_getCustomDir();
+  if(!customdir) 
+  {
+      printf(&quot;No custom dir...\n&quot;);
+      return;
+  }
+  /* Collect the name */
+   if(! buildDirectoryContent(&amp;ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,&quot;.js&quot;))
+    {
+      printf(&quot;Failed to build custom dir content&quot;);
+      return;
+    }
+  if(!ADM_nbCustom)
+  {
+      printf(&quot;No custom script\n&quot;);
+  }
+  printf(&quot;Found %u custom scripts, adding them\n&quot;,ADM_nbCustom);
+}
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+  if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
+        *onoff=1;
+  else
+        *onoff=0;
+  *value=WIDGET(spinBox_TimeValue)-&gt;value();
+  return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+  if(onoff)
+    WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
+  else
+    WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
+  WIDGET(spinBox_TimeValue)-&gt;setValue(value);
+  return 1;
+}
+
+//********************************************
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -37,14 +37,14 @@
 #if !defined(ADM_WIN32) &amp;&amp; !defined(__APPLE__)
 #include &lt;QX11Info&gt;
 #endif
-#include &quot;fourcc.h&quot;
 #include &quot;avio.hxx&quot;
 
 #include &quot;ADM_colorspace/ADM_rgb.h&quot;
 #include &quot;GUI_render.h&quot;
 #include &quot;GUI_accelRender.h&quot;
 #include &quot;prefs.h&quot;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
+#include &quot;ui_gui2.h&quot;
     
 void UI_QT4VideoWidget(QFrame *host);
 static QFrame *hostFrame=NULL;
@@ -146,37 +146,40 @@
     
 }
 
-#define ADM_RSZ(a,x,y) {a-&gt;resize(x,y);a-&gt;setMinimumSize(x,y);}
-#define ADM_RSZ_MAX(a,x,y) {a-&gt;resize(x,y);a-&gt;setMinimumSize(x,y);a-&gt;setMaximumSize(x,y);}
+#define ADM_RSZ(a,x,y) {a-&gt;setMinimumSize(x,y); a-&gt;resize(x,y);}
+#define ADM_RSZ_MAX(a,x,y) {a-&gt;setMinimumSize(x,y); a-&gt;setMaximumSize(x,y); a-&gt;resize(x,y);}
 /**
       \brief Resize the window
 */
 void  UI_updateDrawWindowSize(void *win,uint32_t w,uint32_t h)
 {
-  if(displayW==w &amp;&amp; displayH==h &amp;&amp; rgbDataBuffer) return ;
-  if(rgbDataBuffer) delete [] rgbDataBuffer;
-  rgbDataBuffer=NULL;
-  rgbDataBuffer=new uint8_t [w*h*4]; // 32 bits / color
-  displayW=w;
-  displayH=h;
-  // Resize Host window
-  // It depends on where the frame start
-  printf(&quot;[RDR] %d x %d\n&quot;,hostFrame-&gt;x(),hostFrame-&gt;y());
-  uint32_t totalw=displayW+hostFrame-&gt;x();
-  uint32_t totalh=displayH+hostFrame-&gt;y()+50;
-  ADM_RSZ(QuiMainWindows,totalw,totalh);
-  // And resize child windows
-  
-  ADM_RSZ_MAX(hostFrame,displayW,displayH);
-  ADM_RSZ_MAX(videoWindow,displayW,displayH);
-  
-  UI_sliderResize(w);
-  
-  UI_purge();
-  
+	if(displayW == w &amp;&amp; displayH == h &amp;&amp; rgbDataBuffer)
+		return;
 
-  printf(&quot;[RDR] Resizing to %u x %u\n&quot;,displayW,displayH);
-  return ;
+	QMainWindow *mainWindow = (QMainWindow*)hostFrame-&gt;parentWidget()-&gt;parentWidget();
+	QWidget *centralWidget = hostFrame-&gt;parentWidget();
+
+	uint32_t totalW = w + hostFrame-&gt;x();
+	uint32_t totalH = (mainWindow-&gt;height() - centralWidget-&gt;height()) + hostFrame-&gt;y() + h;
+
+	if(rgbDataBuffer)
+		delete[] rgbDataBuffer;
+
+	rgbDataBuffer = new uint8_t[w * h * 4]; // 32 bits / color
+	displayW = w;
+	displayH = h;
+
+	// Resize host window
+	ADM_RSZ(QuiMainWindows, totalW, totalH);
+
+	// And resize child windows
+	ADM_RSZ_MAX(hostFrame, displayW, displayH);
+	ADM_RSZ_MAX(videoWindow, displayW, displayH);
+
+	UI_sliderResize(w);
+	UI_purge();
+
+	printf(&quot;[RDR] Resizing to %u x %u\n&quot;, displayW, displayH);
 }
 /**
       \brief Retrieve info from window, needed for accel layer

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -8,63 +8,27 @@
 //
 //
 
-#include &lt;config.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;GUI_ui.h&quot;
+#include &quot;config.h&quot;
 
-static ADM_OUT_FORMAT format=ADM_AVI;
-static int audioCodec=0;
-static int videoCodec=0;
-//**************************************************
-//**************************************************
+#include &lt;QtGui/QApplication&gt;
+#include &lt;QtGui/QDesktopWidget&gt;
 
-//**************************************************
-//**************************************************
-void UI_setAProcessToggleStatus( uint8_t status )
-{}
-void UI_setVProcessToggleStatus( uint8_t status )
-{}
+void UI_setAProcessToggleStatus( uint8_t status ) {}
+void UI_setVProcessToggleStatus( uint8_t status ) {}
+void UI_iconify( void ) {}
+void UI_deiconify( void ) {}
+uint32_t UI_readCurFrame( void ) {return 0;}
+void UI_JumpDone(void) {}
+void UI_toogleSide(void) {}
+void UI_toogleMain(void) {}
+uint8_t UI_arrow_enabled(void) {return 1;}
+uint8_t UI_arrow_disabled(void) {return 1;}
 
-//**************************************************
-
-
-void UI_iconify( void )
-{}
-void UI_deiconify( void )
-{}
-
-uint32_t UI_readCurFrame( void )
+uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
 {
-    return 0;
-}
-void UI_JumpDone(void)
-{}
+	QRect qrect = QApplication::desktop()-&gt;availableGeometry();
 
-
-void UI_toogleSide(void)
-{}
-void UI_toogleMain(void)
-{}
-
-
-
-uint8_t UI_shrink(uint32_t w,uint32_t h)
-{
-  return 1;
+	*w = (uint32_t)qrect.width();
+	*h = (uint32_t)qrect.height();
 }
-uint8_t UI_arrow_enabled(void)
-{
-  return 1;
-}
-uint8_t UI_arrow_disabled(void)
-{
-  return 1;
-}
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
-{
-  *w=*h=10000; 
-}
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-07-24 18:53:25 UTC (rev 3442)
@@ -46,9 +46,7 @@
 
 
 extern uint8_t BitBlit(uint8_t *dst, uint32_t pitchDest,uint8_t *src,uint32_t pitchSrc,uint32_t width, uint32_t height);
-
 extern void UI_purge(void);
-extern uint8_t UI_shrink(uint32_t w,uint32_t h);
 
 static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
 static uint8_t  GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-07-24 00:42:36 UTC (rev 3441)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-07-24 18:53:25 UTC (rev 3442)
@@ -44,7 +44,6 @@
 
 uint8_t UI_updateRecentMenu( void );
 
-uint8_t UI_shrink(uint32_t w,uint32_t h);
 uint8_t UI_arrow_enabled(void);
 uint8_t UI_arrow_disabled(void);
 #endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000716.html">[Avidemux-svn-commit] r3441 - in	branches/avidemux_2.4_branch/avidemux: ADM_osSupport	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
</A></li>
	<LI>Next message: <A HREF="000718.html">[Avidemux-svn-commit] r3443 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#717">[ date ]</a>
              <a href="thread.html#717">[ thread ]</a>
              <a href="subject.html#717">[ subject ]</a>
              <a href="author.html#717">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
