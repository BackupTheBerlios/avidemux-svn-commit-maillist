<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3335 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3335%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audio%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200707051744.l65Hiq6r014756%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000611.html">
   <LINK REL="Next"  HREF="000613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3335 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3335%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audio%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200707051744.l65Hiq6r014756%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3335 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI">mean at mail.berlios.de
       </A><BR>
    <I>Thu Jul  5 19:44:52 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000611.html">[Avidemux-svn-commit] r3334 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
</A></li>
        <LI>Next message: <A HREF="000613.html">[Avidemux-svn-commit] r3336 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#612">[ date ]</a>
              <a href="thread.html#612">[ thread ]</a>
              <a href="subject.html#612">[ subject ]</a>
              <a href="author.html#612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-07-05 19:44:51 +0200 (Thu, 05 Jul 2007)
New Revision: 3335

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_mp3info.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/patch.bash
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/jogshuttle.c
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/alert_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
   branches/avidemux_2.4_branch/avidemux/gui_action.hxx
   branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp
Log:
JM jog shuttle, not completly working

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_mp3info.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_mp3info.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_mp3info.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -124,7 +124,11 @@
 					// Check consistency
 					if(templ)
 					{
-						if(templ-&gt;samplerate!=mpegInfo-&gt;samplerate) continue;
+						if(templ-&gt;samplerate!=mpegInfo-&gt;samplerate)
+                                                {
+                                                  printf(&quot;[MP3]samplerate does not match\n&quot;);
+                                                  continue;
+                                                }
 					
 					}
 					found=1;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -48,6 +48,7 @@
 #include &quot;../ADM_editor/ADM_outputfmt.h&quot;
 #include &quot;../prefs.h&quot;
 #include &quot;../ADM_toolkit_gtk/gtkmarkscale.h&quot;
+#include &quot;../ADM_toolkit_gtk/jogshuttle.h&quot;
 
 uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r);
 
@@ -329,8 +330,8 @@
                       GTK_SIGNAL_FUNC(UI_looseFocus),                   (void *) NULL);	 
 
         
-        // navKey
-        gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,&quot;hscaleSensitive&quot;)), &quot;value_changed&quot;,   
+        // Jog
+        gtk_signal_connect(GTK_OBJECT(lookup_widget(guiRootWindow,&quot;jogg&quot;)), &quot;value_changed&quot;,   
                       GTK_SIGNAL_FUNC(volumeChange),                   (void *) NULL);  
 
 
@@ -562,25 +563,26 @@
 
 void volumeChange( void )
 {
-#ifdef HAVE_AUDIO
-GtkWidget *wid;
-GtkAdjustment *adj;
-int vol;
+    HandleAction(ACT_JOG);    
 
+}
+/**
+    \fn UI_readJog
+    \brief Returns value of jog
+*/
+int32_t UI_readJog(void)
+{
+  GtkWidget *wid;
+  float val;
 
-if(_upd_in_progres) return;
- _upd_in_progres++;
-
-        wid=lookup_widget(guiRootWindow,&quot;hscaleSensitive&quot;);
-        adj=gtk_range_get_adjustment (GTK_RANGE(wid));
-        vol=(int)floor(adj-&gt;value+0.5);
-        AVDM_setVolume( vol);
- _upd_in_progres--;
-#endif
+        wid=lookup_widget(guiRootWindow,&quot;jogg&quot;);
+        val=jog_shuttle_get_value(wid);
+        printf(&quot;Jog : %f\n&quot;,val);
+        val=val*100;
+        return (int32_t )val;
+        
 }
 
-
-
 void UI_setTitle(char *name)
 {
         char title[1024];

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -14,6 +14,7 @@
 
 #include &lt;gdk/gdkkeysyms.h&gt;
 #include &lt;gtk/gtk.h&gt;
+#include &quot;../ADM_toolkit_gtk/jogshuttle.h&quot;
 
 #include &quot;../ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
 
@@ -246,7 +247,6 @@
   GtkWidget *buttonEnd;
   GtkWidget *image2245;
   GtkWidget *sliderNavigate;
-  GtkWidget *hscaleSensitive;
   GtkWidget *hbox16;
   GtkWidget *label1;
   GtkWidget *boxCurFrame;
@@ -255,6 +255,7 @@
   GtkWidget *boxCurTime;
   GtkWidget *labelTotalTime;
   GtkWidget *labelFrameType;
+  GtkWidget *jogg;
   extern GtkAccelGroup *accel_group;
   GtkTooltips *tooltips;
 
@@ -900,7 +901,7 @@
   gtk_container_add (GTK_CONTAINER (go1_menu), separator15);
   gtk_widget_set_sensitive (separator15, FALSE);
 
-  jum_to_frame1 = gtk_image_menu_item_new_with_mnemonic (_(&quot;Go to Fra_me...&quot;));
+  jum_to_frame1 = gtk_image_menu_item_new_with_mnemonic (_(&quot;_Jump to Frame...&quot;));
   gtk_widget_show (jum_to_frame1);
   gtk_container_add (GTK_CONTAINER (go1_menu), jum_to_frame1);
   gtk_widget_add_accelerator (jum_to_frame1, &quot;activate&quot;, accel_group,
@@ -911,7 +912,7 @@
   gtk_widget_show (image8219);
   gtk_image_menu_item_set_image (GTK_IMAGE_MENU_ITEM (jum_to_frame1), image8219);
 
-  jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_(&quot;Go to _Time...&quot;));
+  jump_to_time1 = gtk_image_menu_item_new_with_mnemonic (_(&quot;Jump to _Time...&quot;));
   gtk_widget_show (jump_to_time1);
   gtk_container_add (GTK_CONTAINER (go1_menu), jump_to_time1);
   gtk_widget_add_accelerator (jump_to_time1, &quot;activate&quot;, accel_group,
@@ -1376,15 +1377,6 @@
   GTK_WIDGET_UNSET_FLAGS (sliderNavigate, GTK_CAN_FOCUS);
   gtk_scale_set_value_pos (GTK_SCALE (sliderNavigate), GTK_POS_LEFT);
 
-  hscaleSensitive = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (62.2951, 0, 100, 5, 5, 5)));
-  gtk_widget_show (hscaleSensitive);
-  gtk_table_attach (GTK_TABLE (table2), hscaleSensitive, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), 0, 0);
-  gtk_scale_set_draw_value (GTK_SCALE (hscaleSensitive), FALSE);
-  gtk_scale_set_value_pos (GTK_SCALE (hscaleSensitive), GTK_POS_RIGHT);
-  gtk_scale_set_digits (GTK_SCALE (hscaleSensitive), 0);
-
   hbox16 = gtk_hbox_new (FALSE, 6);
   gtk_widget_show (hbox16);
   gtk_table_attach (GTK_TABLE (table2), hbox16, 0, 1, 2, 3,
@@ -1403,7 +1395,7 @@
   gtk_entry_set_text (GTK_ENTRY (boxCurFrame), _(&quot;0&quot;));
   gtk_entry_set_width_chars (GTK_ENTRY (boxCurFrame), 8);
 
-  labelTotalFrame = gtk_label_new (_(&quot;/ 0000000&quot;));
+  labelTotalFrame = gtk_label_new (_(&quot;/0000000&quot;));
   gtk_widget_show (labelTotalFrame);
   gtk_box_pack_start (GTK_BOX (hbox16), labelTotalFrame, FALSE, FALSE, 0);
   GTK_WIDGET_SET_FLAGS (labelTotalFrame, GTK_CAN_FOCUS);
@@ -1421,7 +1413,7 @@
   gtk_entry_set_text (GTK_ENTRY (boxCurTime), _(&quot;00:00:00.000&quot;));
   gtk_entry_set_width_chars (GTK_ENTRY (boxCurTime), 13);
 
-  labelTotalTime = gtk_label_new (_(&quot;/ 00:00:00,000&quot;));
+  labelTotalTime = gtk_label_new (_(&quot;/00:00:00,000&quot;));
   gtk_widget_show (labelTotalTime);
   gtk_box_pack_start (GTK_BOX (hbox16), labelTotalTime, FALSE, FALSE, 0);
   GTK_WIDGET_SET_FLAGS (labelTotalTime, GTK_CAN_FOCUS);
@@ -1434,6 +1426,14 @@
   GTK_WIDGET_SET_FLAGS (labelFrameType, GTK_CAN_FOCUS);
   gtk_label_set_selectable (GTK_LABEL (labelFrameType), TRUE);
 
+  jogg = jog_shuttle_new ();
+  gtk_widget_show (jogg);
+  gtk_table_attach (GTK_TABLE (table2), jogg, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (GTK_FILL), 0, 0);
+  GTK_WIDGET_UNSET_FLAGS (jogg, GTK_CAN_FOCUS);
+  GTK_WIDGET_UNSET_FLAGS (jogg, GTK_CAN_DEFAULT);
+
   /* Store pointers to all widgets, for use by lookup_widget(). */
   GLADE_HOOKUP_OBJECT_NO_REF (mainWindow, mainWindow, &quot;mainWindow&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, vbox1, &quot;vbox1&quot;);
@@ -1648,7 +1648,6 @@
   GLADE_HOOKUP_OBJECT (mainWindow, buttonEnd, &quot;buttonEnd&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, image2245, &quot;image2245&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, sliderNavigate, &quot;sliderNavigate&quot;);
-  GLADE_HOOKUP_OBJECT (mainWindow, hscaleSensitive, &quot;hscaleSensitive&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, hbox16, &quot;hbox16&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, label1, &quot;label1&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, boxCurFrame, &quot;boxCurFrame&quot;);
@@ -1657,6 +1656,7 @@
   GLADE_HOOKUP_OBJECT (mainWindow, boxCurTime, &quot;boxCurTime&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, labelTotalTime, &quot;labelTotalTime&quot;);
   GLADE_HOOKUP_OBJECT (mainWindow, labelFrameType, &quot;labelFrameType&quot;);
+  GLADE_HOOKUP_OBJECT (mainWindow, jogg, &quot;jogg&quot;);
   GLADE_HOOKUP_OBJECT_NO_REF (mainWindow, tooltips, &quot;tooltips&quot;);
 
   gtk_window_add_accel_group (GTK_WINDOW (mainWindow), accel_group);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/patch.bash
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/patch.bash	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/patch.bash	2007-07-05 17:44:51 UTC (rev 3335)
@@ -1,5 +1,6 @@
 cat GUI_main2.cpp | sed 's/, 0,$/, (GdkModifierType) 0,/g' | sed 's/-2/-1/g' | sed 's/GtkAccelGroup \*/extern GtkAccelGroup */' | sed 's/(GdkModifierType)/(GdkModifierType)(/g' | sed 's/MASK,$/MASK\),/g' |sed 's/( 0,$/( 0 ),/g' | \
 sed 's/sliderNavigate = gtk_hscale_new/sliderNavigate = gtk_markscale_new/' | \
+sed 's/jog_shuttle_new (&quot;jogg&quot;, &quot;&quot;, &quot;&quot;, 0, 0);/jog_shuttle_new ();/' | \
 sed 's/gtk_widget_show (sliderNavigate);/gtk_widget_show (sliderNavigate);gtk_scale_set_draw_value (GTK_SCALE (sliderNavigate), FALSE);/' |\
 sed 's/#include &quot;interface.h&quot;//' |\
 sed 's/#include &quot;support.h&quot;/#include &quot;..\/ADM_toolkit_gtk\/gtkmarkscale.h&quot;/' |\

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/CMakeLists.txt	2007-07-05 17:44:51 UTC (rev 3335)
@@ -6,7 +6,7 @@
 #
 SET(${ADM_LIB}_SRCS
 ADM_gladeSupport.cpp  ADM_tray_gtk.cpp  choice.cpp  TLK_filesel.cpp  toolkit.cpp  toolkit_dialog.cpp 
-                                        eggtrayicon.c eggtray_win32.c gtkmarkscale.c
+                                        eggtrayicon.c eggtray_win32.c gtkmarkscale.c jogshuttle.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/Makefile.am	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/Makefile.am	2007-07-05 17:44:51 UTC (rev 3335)
@@ -9,7 +9,7 @@
 libADM_toolkit_gtk_a_METASOURCES = AUTO
 
 libADM_toolkit_gtk_a_SOURCES = ADM_gladeSupport.cpp  ADM_tray_gtk.cpp  choice.cpp  TLK_filesel.cpp  toolkit.cpp  toolkit_dialog.cpp \
-					eggtrayicon.c eggtray_win32.c gtkmarkscale.c
+					eggtrayicon.c eggtray_win32.c gtkmarkscale.c jogshuttle.c
 
 
 EXTRA_DIST = 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/jogshuttle.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/jogshuttle.c	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/jogshuttle.c	2007-07-05 17:44:51 UTC (rev 3335)
@@ -341,6 +341,7 @@
 {
 	JogShuttlePrivate *priv;
 	priv = JOG_SHUTTLE_GET_PRIVATE (wheel);
+        if(priv-&gt;pressed==FALSE) return 0;
 	return (priv-&gt;value);
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/alert_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/alert_none.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/alert_none.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -255,3 +255,7 @@
 {
   beQuiet=1;
 }
+int32_t UI_readJog(void)
+{
+ return 0; 
+}
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -99,6 +99,9 @@
 int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}
 
 
-
+int32_t UI_readJog(void)
+{
+  return 0; 
+}
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-07-05 17:44:51 UTC (rev 3335)
@@ -14,8 +14,8 @@
 void 	UI_setFrameType( uint32_t frametype,uint32_t qp);
 void 	UI_setMarkers(uint32_t a, uint32_t b );
 void 	UI_setTitle(char *name);
+int32_t UI_readJog(void);
 
-
 void UI_setAProcessToggleStatus( uint8_t status );
 void UI_setVProcessToggleStatus( uint8_t status );
 

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -169,6 +169,7 @@
 void GUI_showCurrentFrameHex(void);
 void GUI_avsProxy(void);
 uint8_t GUI_close(void);
+extern void A_jog(void);
 //___________________________________________
 // serialization of user event throught gui
 //
@@ -366,6 +367,8 @@
     {
       switch (action)
 	{
+          case ACT_JOG:
+                break;
         case ACT_TimeShift:
                 A_TimeShift();
                 break;
@@ -389,6 +392,10 @@
   // we have an AVI loaded
   switch (action)
     {
+       case ACT_JOG:
+                A_jog();
+                break;
+
        case ACT_CLOSE:
               GUI_close();
               break;

Modified: branches/avidemux_2.4_branch/avidemux/gui_action.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/gui_action.hxx	2007-07-05 17:44:51 UTC (rev 3335)
@@ -191,6 +191,7 @@
 ACT_BUILT_IN,
 ACT_HEX_DUMP,
 ACT_AVS_PROXY,
+ACT_JOG,
 ACT_CUSTOM_BASE,
 ACT_CUSTOM_END=ACT_CUSTOM_BASE+ADM_MAC_CUSTOM_SCRIPT,
 ACT_DUMMY

Modified: branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp	2007-07-05 17:37:24 UTC (rev 3334)
+++ branches/avidemux_2.4_branch/avidemux/gui_navigate.cpp	2007-07-05 17:44:51 UTC (rev 3335)
@@ -44,6 +44,7 @@
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 #include &quot;ADM_filter/video_filters.h&quot;
 #include &quot;DIA_busy.h&quot;
+#include &quot;GUI_ui.h&quot;
 extern void    UI_purge(void );
 //____________________________________
 
@@ -453,5 +454,65 @@
           DIA_StopBusy ();
         }
 }
+/**
+      \fn A_jogRead
+      \brief read an average value of jog
+*/
+#define NB_JOG_READ           3
+#define JOG_READ_PERIOD_US    5*1000 // 5ms
+#define JOG_THRESH1           40
+#define JOG_THRESH2           80
+#define JOG_THRESH1_PERIOD    100*1000 //us
+#define JOG_THRESH2_PERIOD    40*1000
+#define JOG_THRESH3_PERIOD    500
+/**
+    \fn A_jogRead
+    \brief Read an average value of jog
+*/
+uint32_t A_jogRead(void)
+{
+  int32_t sum=0,v;
+    for(int i=0;i&lt;NB_JOG_READ;i++)
+    {
+        v=UI_readJog();
+        if(abs(v)&lt;10) v=0;
+        sum+=v;
+        ADM_usleep(JOG_READ_PERIOD_US);
+    } 
+    return sum/NB_JOG_READ;
+}
+#define REFRESH 10000
+/**
+      \fn     A_jog
+      \brief  Handle jogshuttle widget
+*/
+void A_jog(void)
+{
+  int32_t r;
+  uint32_t a;
+  uint32_t slip;
+  static int jog=0;
+  if(jog) return;
+  jog++;
+  while(r=A_jogRead())
+  {
+      a=abs(r);
+      printf(&quot;%d \n&quot;,r);
+      if(a&lt;JOG_THRESH1) slip=JOG_THRESH1_PERIOD;
+        else if(a&lt;JOG_THRESH2) slip=JOG_THRESH2_PERIOD;
+          else slip=JOG_THRESH3_PERIOD;
+    
+      if(r&gt;0) GUI_NextKeyFrame();
+      else GUI_PreviousKeyFrame();       
+      UI_purge();
+      for(int i=0;i&lt;slip/REFRESH;i++)
+      {
+        UI_purge();
+        ADM_usleep(REFRESH);
+        UI_purge();
+      }
+  }
+  jog--;
+}
 //EOF
         


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000611.html">[Avidemux-svn-commit] r3334 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
</A></li>
	<LI>Next message: <A HREF="000613.html">[Avidemux-svn-commit] r3336 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#612">[ date ]</a>
              <a href="thread.html#612">[ thread ]</a>
              <a href="subject.html#612">[ subject ]</a>
              <a href="author.html#612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
