<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3368 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3368%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200707141734.l6EHY1R0029171%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000644.html">
   <LINK REL="Next"  HREF="000646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3368 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3368%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200707141734.l6EHY1R0029171%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3368 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Sat Jul 14 19:34:01 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000644.html">[Avidemux-svn-commit] r3367 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000646.html">[Avidemux-svn-commit] r3369 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_libraries/ADM_utilities ADM_ocr	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_ocr	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#645">[ date ]</a>
              <a href="thread.html#645">[ thread ]</a>
              <a href="subject.html#645">[ subject ]</a>
              <a href="author.html#645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2007-07-14 19:33:40 +0200 (Sat, 14 Jul 2007)
New Revision: 3368

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
resize GTK flyDialog filters when image is greater than screen resolution

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -53,6 +53,9 @@
 static int lock=0;
 static GtkWidget *dialog=NULL;
 static flyASharp *myCrop=NULL;
+
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
+
 //
 //      Video is in YV12 Colorspace
 //
@@ -67,12 +70,22 @@
 
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-        
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
         gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;ASHARP&quot;));
+
+		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+		uint32_t zoomW = width * zoom;
+		uint32_t zoomH = height * zoom;
+
+		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+		if (zoom &lt; 1)
+		{
+			gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+		}
+
         gtk_widget_show(dialog);
-	
-        
+
         gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), &quot;expose_event&quot;,
             GTK_SIGNAL_FUNC(draw),
             NULL);
@@ -86,6 +99,7 @@
           
         myCrop=new flyASharp( width, height,in,WID(drawingarea1),WID(hscale1));
         memcpy(&amp;(myCrop-&gt;param),param,sizeof(ASHARP_PARAM));
+		myCrop-&gt;resizeImage(zoomW, zoomH);
         myCrop-&gt;upload();
         myCrop-&gt;sliderChanged();
         ret=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -19,10 +19,6 @@
 #include &lt;stdio.h&gt;
 #include &lt;gdk/gdkkeysyms.h&gt;
 #include &lt;gtk/gtk.h&gt;
-
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
 # include &lt;math.h&gt;
 
 #include &quot;default.h&quot;
@@ -52,6 +48,8 @@
 static void update(void);
 
 static flyChromaShift *myCrop=NULL;
+
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
 //**************************************
 
 uint8_t DIA_getChromaShift( AVDMGenericVideoStream *instream,CHROMASHIFT_PARAM    *param );
@@ -67,13 +65,25 @@
 
         dialog=create_ChromaShift();
         gtk_register_dialog(dialog);
-        
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
         gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;ASHARP&quot;));
+
+		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+		uint32_t zoomW = width * zoom;
+		uint32_t zoomH = height * zoom;
+
+		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+		if (zoom &lt; 1)
+		{
+			gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+		}
+
         gtk_widget_show(dialog);
 	
         myCrop=new flyChromaShift( width, height,in,WID(drawingarea1),WID(hscale));
         memcpy(&amp;(myCrop-&gt;param),param,sizeof(CHROMASHIFT_PARAM));
+		myCrop-&gt;resizeImage(zoomW, zoomH);
         myCrop-&gt;upload();
         myCrop-&gt;sliderChanged();
         

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -57,6 +57,8 @@
 static int lock=0;
 static flyContrast *myCrop=NULL;
 
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
+
 /********************************************************************/
 uint8_t DIA_contrast(AVDMGenericVideoStream *in,CONTRAST_PARAM *param)
 {
@@ -69,11 +71,21 @@
 
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-        
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
         gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;ASHARP&quot;));
-        gtk_widget_show(dialog);
-	
+
+		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+		uint32_t zoomW = width * zoom;
+		uint32_t zoomH = height * zoom;
+
+		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+		if (zoom &lt; 1)
+		{
+			gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+		}
+
+        gtk_widget_show(dialog);	
         
           // and value changed
 #define CNX(x,y) gtk_signal_connect(GTK_OBJECT(WID(x)), y, GTK_SIGNAL_FUNC(gui_update), (void *) (1));
@@ -97,6 +109,7 @@
           
         myCrop=new flyContrast( width, height,in,WID(drawingarea1),WID(hscale1));
         memcpy(&amp;(myCrop-&gt;param),param,sizeof(CONTRAST_PARAM));
+		myCrop-&gt;resizeImage(zoomW, zoomH);
         myCrop-&gt;upload();
         myCrop-&gt;sliderChanged();
         ret=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -25,12 +25,8 @@
 #include &lt;stdio.h&gt;
 #include &lt;gdk/gdkkeysyms.h&gt;
 #include &lt;gtk/gtk.h&gt;
+#include &lt;math.h&gt;
 
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-# include &lt;math.h&gt;
-
 #include &quot;default.h&quot;
 #include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
 #include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
@@ -44,9 +40,8 @@
 #include &quot;DIA_flyCrop.h&quot;
 
 static GtkWidget	*create_dialog1 (void);
-static void 		draw (GtkWidget *dialog,uint32_t w,uint32_t h );
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
 
-
 /* Link between UI and core */
 static gboolean 	ui_draw( void );
 static void 		ui_autocrop (void );
@@ -66,69 +61,84 @@
 //	Video is in YV12 Colorspace
 //
 //
-int DIA_getCropParams(	char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in)
+int DIA_getCropParams(char *name, CROP_PARAMS *param, AVDMGenericVideoStream *in)
 {
-  uint32_t width,height;
-        // Allocate space for green-ised video
-        width=in-&gt;getInfo()-&gt;width;
-        height=in-&gt;getInfo()-&gt;height;
-        
-        
-  
-        uint8_t ret=0;
-  
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-        
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
-        gtk_window_set_title (GTK_WINDOW (dialog), name);
-        gtk_widget_show(dialog);
+	uint32_t width, height;
+
+	// Allocate space for green-ised video
+	width = in-&gt;getInfo()-&gt;width;
+	height = in-&gt;getInfo()-&gt;height;
+
+	uint8_t ret=0;
+
+	dialog=create_dialog1();
+	gtk_register_dialog(dialog);
+	gtk_window_set_title(GTK_WINDOW(dialog), name);
+
+	float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+	uint32_t zoomW = width * zoom;
+	uint32_t zoomH = height * zoom;
+
+	gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+	if (zoom &lt; 1)
+	{
+		gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+	}
+
+	gtk_widget_show(dialog);
 	
-#define CONNECT(x,y,z) 	gtk_signal_connect(GTK_OBJECT(WID(x)), #y,GTK_SIGNAL_FUNC(z),   NULL);
+#define CONNECT(x,y,z) 	gtk_signal_connect(GTK_OBJECT(WID(x)), #y, GTK_SIGNAL_FUNC(z), NULL);
 
-        CONNECT(drawingarea1,expose_event,ui_draw);
-        CONNECT(buttonAutocrop,clicked,ui_autocrop);
-        CONNECT(buttonReset,clicked,ui_reset);
-        CONNECT(scale,value_changed,ui_frame_changed);
-                              
-          gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonCancel), GTK_RESPONSE_CANCEL);
-          gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonOk),      GTK_RESPONSE_OK);
-          gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonApply),  GTK_RESPONSE_APPLY);
+	CONNECT(drawingarea1,expose_event,ui_draw);
+	CONNECT(buttonAutocrop,clicked,ui_autocrop);
+	CONNECT(buttonReset,clicked,ui_reset);
+	CONNECT(scale,value_changed,ui_frame_changed);
+	                  
+	gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonCancel), GTK_RESPONSE_CANCEL);
+	gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonOk), GTK_RESPONSE_OK);
+	gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(buttonApply), GTK_RESPONSE_APPLY);
 
 #define CONNECT_SPIN(x) CONNECT(spinbutton##x, value_changed,ui_update)
           
-          CONNECT_SPIN(Top);
-          CONNECT_SPIN(Left);
-          CONNECT_SPIN(Right);
-          CONNECT_SPIN(Bottom);
-          
-        myCrop=new flyCrop( width, height,in,WID(drawingarea1),WID(scale));
-        myCrop-&gt;left=param-&gt;left;
-        myCrop-&gt;right=param-&gt;right;
-        myCrop-&gt;top=param-&gt;top;
-        myCrop-&gt;bottom=param-&gt;bottom;
-        myCrop-&gt;upload();
-        myCrop-&gt;sliderChanged();
-        ret=0;
-        int response;
-        while( (response=gtk_dialog_run(GTK_DIALOG(dialog)))==GTK_RESPONSE_APPLY)
-        {
-          ui_update();
-        }
-        if(response==GTK_RESPONSE_OK)
-        {
-                ui_read( );
-                param-&gt;left=myCrop-&gt;left;
-                param-&gt;right=myCrop-&gt;right;
-                param-&gt;top=myCrop-&gt;top;
-                param-&gt;bottom=myCrop-&gt;bottom;
-                ret=1;
-        }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        delete myCrop;
-        return ret;
+	CONNECT_SPIN(Top);
+	CONNECT_SPIN(Left);
+	CONNECT_SPIN(Right);
+	CONNECT_SPIN(Bottom);
+
+	myCrop=new flyCrop(width, height,in,WID(drawingarea1),WID(scale));
+	myCrop-&gt;resizeImage(zoomW, zoomH);
+	myCrop-&gt;left=param-&gt;left;
+	myCrop-&gt;right=param-&gt;right;
+	myCrop-&gt;top=param-&gt;top;
+	myCrop-&gt;bottom=param-&gt;bottom;
+	myCrop-&gt;upload();	
+	myCrop-&gt;sliderChanged();	
+
+	int response;
+
+	while((response = gtk_dialog_run(GTK_DIALOG(dialog))) == GTK_RESPONSE_APPLY)
+	{
+	  ui_update();
+	}
+
+	if(response==GTK_RESPONSE_OK)
+	{
+		ui_read( );
+		param-&gt;left=myCrop-&gt;left;
+		param-&gt;right=myCrop-&gt;right;
+		param-&gt;top=myCrop-&gt;top;
+		param-&gt;bottom=myCrop-&gt;bottom;
+		ret=1;
+	}
+
+	gtk_unregister_dialog(dialog);
+	gtk_widget_destroy(dialog);
+	delete myCrop;
+	return ret;
 }
+
 /*
       Link GTK dialog and core
 */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -18,23 +18,15 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
-
-
 #include &lt;config.h&gt;
 
-
 #include &lt;string.h&gt;
 #include &lt;stdio.h&gt;
 
 #include &lt;gdk/gdkkeysyms.h&gt;
 #include &lt;gtk/gtk.h&gt;
+#include &lt;math.h&gt;
 
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-# include &lt;math.h&gt;
-
 #include &quot;default.h&quot;
 #include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
 #include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
@@ -64,6 +56,7 @@
 static GtkWidget *dialog=NULL;
 static flyHue *myCrop=NULL;
 
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
 
 /**
       \fn DIA_getHue
@@ -80,11 +73,20 @@
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
         
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
         gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;Hue&quot;));
-        gtk_widget_show(dialog);
-	
-        
+
+		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+		uint32_t zoomW = width * zoom;
+		uint32_t zoomH = height * zoom;
+
+		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+		if (zoom &lt; 1)
+		{
+			gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+		}
+
         gtk_signal_connect(GTK_OBJECT(WID(drawingarea1)), &quot;expose_event&quot;,
             GTK_SIGNAL_FUNC(draw),
             NULL);
@@ -93,10 +95,10 @@
         gtk_signal_connect(GTK_OBJECT(WID(hscaleHue)), &quot;value_changed&quot;,GTK_SIGNAL_FUNC(hue_changed),   NULL);
         gtk_signal_connect(GTK_OBJECT(WID(hscaleSaturation)), &quot;value_changed&quot;,GTK_SIGNAL_FUNC(hue_changed),   NULL);
         gtk_widget_show(dialog);
-
           
         myCrop=new flyHue( width, height,in,WID(drawingarea1),WID(hscale1));
         memcpy(&amp;(myCrop-&gt;param),param,sizeof(Hue_Param));
+		myCrop-&gt;resizeImage(zoomW, zoomH);
         myCrop-&gt;upload();
         myCrop-&gt;sliderChanged();
         ret=0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -71,6 +71,8 @@
 static GtkWidget *dialog=NULL;
 static flySrtPos *myCrop=NULL;
 static int lock=0;
+
+extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
 /**
       \fn DIA_srtPos
       \brief Dialog that handles subtitle size and position
@@ -87,18 +89,29 @@
 
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-        
-        gtk_widget_set_usize(WID(drawingarea1), width,height);
         gtk_window_set_title (GTK_WINDOW (dialog), _(&quot;Subtitle Size and Position&quot;));
+
+		float zoom = UI_calcZoomToFitScreen(GTK_WINDOW(dialog), WID(drawingarea1), width, height);
+
+		uint32_t zoomW = width * zoom;
+		uint32_t zoomH = height * zoom;
+
+		gtk_widget_set_usize(WID(drawingarea1), zoomW, zoomH);
+
+		if (zoom &lt; 1)
+		{
+			gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
+		}
+
         gtk_widget_show(dialog);
 	
         myCrop=new flySrtPos( width, height,in,WID(drawingarea1),WID(hscale1));
         myCrop-&gt;param.fontSize=*size;
         myCrop-&gt;param.position=*position;
-        
-           gtk_range_set_range(GTK_RANGE(WID(vscale1)),0,height-1);
-        
-        
+
+        gtk_range_set_range(GTK_RANGE(WID(vscale1)),0,height-1);
+
+		myCrop-&gt;resizeImage(zoomW, zoomH);
         myCrop-&gt;upload();
         myCrop-&gt;sliderChanged();
         

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -50,7 +50,7 @@
 #include &quot;../ADM_toolkit_gtk/gtkmarkscale.h&quot;
 #include &quot;../ADM_toolkit_gtk/jogshuttle.h&quot;
 
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r);
+uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
 
 
 #define WOD(x) lookup_widget (guiRootWindow,#x)
@@ -229,7 +229,7 @@
 		GUI_initCursor(  );
     
                 
-                UI_getPhysicalScreenSize(&amp;w,&amp;h,NULL); //gtk_widget_get_parent_window (guiRootWindow));
+                UI_getPhysicalScreenSize(&amp;w,&amp;h); //gtk_widget_get_parent_window (guiRootWindow));
                 printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
  
                  GUI_gtk_grow_off(1);
@@ -1107,7 +1107,7 @@
 extern char **global_argv;
 typedef gboolean GCALL       (void *);
 extern int automation(void );
-extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *root=NULL);
+extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
 int UI_Init(int argc, char **argv)
 {
   uint32_t w,h;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -22,23 +22,21 @@
 #include &lt;unistd.h&gt;
 
 #include &lt;gtk/gtk.h&gt;
-#ifndef ADM_WIN32
+#ifdef ADM_WIN32
+#include &lt;gdk/gdkwin32.h&gt;
+#else
 #include &lt;gdk/gdkx.h&gt;
-#else
-#include &lt;gdk/gdkwin32.h&gt;
 #endif
+
 #include &lt;time.h&gt;
 #include &lt;sys/time.h&gt;
 
-
-//#include &quot;../avi_vars.h&quot;
 #include &lt;../ADM_assert.h&gt;
 #define WIN32_CLASH
 #include &quot;default.h&quot;
 #include &quot;../ADM_osSupport/ADM_misc.h&quot;
 
 #include &quot;ADM_commonUI/GUI_render.h&quot;
-
 #include &quot;ADM_commonUI/GUI_accelRender.h&quot;
 
 #include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
@@ -50,8 +48,10 @@
 
 void GUI_gtk_grow_off(int onff);
 
-extern GtkWidget *getDrawWidget( void );
- ColYuvRgb rgbConverter(640,480);
+extern GtkWidget *getDrawWidget(void);
+extern uint8_t UI_getPhysicalScreenSize(uint32_t *w, uint32_t *h);
+
+ColYuvRgb rgbConverter(640,480);
 uint32_t lastW,lastH;
 /**
     \brief return pointer to the drawing widget that displays video
@@ -70,7 +70,7 @@
 
     if(lastW&gt;w || lastH&gt;h)
     {
-      printf(&quot;[Gtk] Warning window bigger than display %u x %u vs %u x %u\n&quot;,w,h,lastW,lastH);
+      printf(&quot;[GTK] Warning window bigger than display %u x %u vs %u x %u\n&quot;,w,h,lastW,lastH);
     }
 
     gdk_draw_rgb_32_image(widget-&gt;window, widget-&gt;style-&gt;fg_gc[GTK_STATE_NORMAL], 0,    // X
@@ -112,6 +112,40 @@
         xinfo-&gt;display=	(void*)GDK_WINDOW_HWND(widget-&gt;window);
 #endif
 }
-#if 0
-#endif
+
+// Calculate the zoom ratio required to fit the whole image on the screen.
+float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight)
+{
+	int windowWidth, windowHeight;
+	int drawingWidth, drawingHeight;
+	uint32_t screenWidth, screenHeight;
+	
+	gtk_window_get_size(window, &amp;windowWidth, &amp;windowHeight);
+	gtk_widget_get_size_request(drawingArea, &amp;drawingWidth, &amp;drawingHeight);
+
+	UI_getPhysicalScreenSize(&amp;screenWidth, &amp;screenHeight);
+
+	// Take drawing area out of the equation, how much extra do we need for additional controls?
+	windowWidth -= drawingWidth;
+	windowHeight -= drawingHeight;
+
+	// Take borders and captions into consideration (GTK doesn't seem to support this so we'll have to guess)
+	windowWidth += 10;
+	windowHeight += 40;
+
+	// This is the true amount of screen real estate we can work with
+	screenWidth -= windowWidth;
+	screenHeight -= windowHeight;
+
+	// Calculate zoom ratio
+	if (imageWidth &gt; screenWidth || imageHeight &gt; screenHeight)
+	{
+		if ((imageWidth - screenWidth) &gt; (imageHeight - screenHeight))
+			return (float)screenWidth / (float)imageWidth;
+		else
+			return (float)screenHeight / (float)imageHeight;
+	}
+	else
+		return 1;
+}
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/toolkit.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -193,21 +193,22 @@
     \fn UI_getPhysicalScreenSize
     \brief return the physical size of display in pixels
 */
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r)
+uint8_t UI_getPhysicalScreenSize(uint32_t *w, uint32_t *h)
 {
-  static int inited=0;
-  static int ww,hh;
-    if(!inited)
-    {
-      
-      GdkScreen *sc= gdk_screen_get_default  ();
-      ww=  gdk_screen_get_width(sc);
-      hh=  gdk_screen_get_height(sc);
-      inited=1;
+	static int inited = 0;
+	static int ww,hh;
+
+    if (!inited)
+    {      
+      GdkScreen* sc = gdk_screen_get_default();
+      ww = gdk_screen_get_width(sc);
+      hh = gdk_screen_get_height(sc);
+      inited = 1;
     }
+
     *w=ww;
     *h=hh;
+
     return 1;
 }
-
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -29,7 +29,7 @@
 void GUI_FileSelWrite(const char *label, char * * name)
 {}
 
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r)
+uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
 {
   *w=*h=10000; 
 }
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -63,7 +63,7 @@
 {
   return 1;
 }
-uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r)
+uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h)
 {
   *w=*h=10000; 
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -101,7 +101,6 @@
 //----------------------------------------
 uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
 {
-int mul,xx,yy;
 	if(screenBuffer) 
         {
                 delete  [] screenBuffer;

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-07-14 17:15:30 UTC (rev 3367)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-07-14 17:33:40 UTC (rev 3368)
@@ -155,7 +155,7 @@
 PARAM_MUX muxMode = MUX_REGULAR;
 int muxParam = 0;
 
-extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h,void *r=NULL);
+extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
 extern uint8_t GUI_jobs(void);
 extern bool parseECMAScript(const char *name);
 void A_parseECMAScript(const char *name);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000644.html">[Avidemux-svn-commit] r3367 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:	ADM_GTK/ADM_dialog ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000646.html">[Avidemux-svn-commit] r3369 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_libraries/ADM_utilities ADM_ocr	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_ocr	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#645">[ date ]</a>
              <a href="thread.html#645">[ thread ]</a>
              <a href="subject.html#645">[ subject ]</a>
              <a href="author.html#645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
