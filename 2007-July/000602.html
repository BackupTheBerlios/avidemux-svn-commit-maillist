<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3325 - in	branches/avidemux_2.4_branch/avidemux: ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3325%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_audio%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200707011612.l61GC6h2010171%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000601.html">
   <LINK REL="Next"  HREF="000603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3325 - in	branches/avidemux_2.4_branch/avidemux: ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3325%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20ADM_audio%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200707011612.l61GC6h2010171%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3325 - in	branches/avidemux_2.4_branch/avidemux: ADM_audio	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Sun Jul  1 18:12:06 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000601.html">[Avidemux-svn-commit] r3324 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialog ADM_gui
</A></li>
        <LI>Next message: <A HREF="000603.html">[Avidemux-svn-commit] r3326 - in branches/avidemux_2.4_branch: .	avidemux avidemux/ADM_libraries/ADM_smjs cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#602">[ date ]</a>
              <a href="thread.html#602">[ thread ]</a>
              <a href="subject.html#602">[ subject ]</a>
              <a href="author.html#602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-07-01 18:12:05 +0200 (Sun, 01 Jul 2007)
New Revision: 3325

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated_param.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated_param.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_aacinfo.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
move animated to videoFilter and redo dialog with dialogFactory

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_aacinfo.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_aacinfo.cpp	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/ADM_aacinfo.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -96,7 +96,7 @@
 				a[7]=stream[start+7];
 				if(start&gt;=maxSearch-7) break;
 				start++;
-				if(a[0]==0xff &amp;&amp; ((a[1]&amp;0xF0)==0xF0))
+				if(a[0]==0xff &amp;&amp; ((a[1]&amp;0xF6)==0xF0))
 				{
 					// Layer
                                         part=a[1]&amp;0xf;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2007-07-01 16:12:05 UTC (rev 3325)
@@ -7,7 +7,7 @@
 SET(${ADM_LIB}_SRCS
 DIA_about.cpp     DIA_calculator.cpp   DIA_crop.cpp       DIA_flyDialog.cpp  DIA_mpdelogo.cpp  DIA_preview.cpp     DIA_srt.cpp      DIA_xvid4.cpp
 DIA_acodec.cpp    DIA_chromaShift.cpp  DIA_encoding.cpp   DIA_hue.cpp        DIA_ocr.cpp       DIA_properties.cpp  DIA_vcodec.cpp   DIA_xvid.cpp
-DIA_animated.cpp  DIA_cnr2.cpp         DIA_eq2.cpp        DIA_idx_pg.cpp     DIA_partial.cpp   DIA_quota.cpp       DIA_vobsub.cpp
+DIA_cnr2.cpp         DIA_eq2.cpp        DIA_idx_pg.cpp     DIA_partial.cpp   DIA_quota.cpp       DIA_vobsub.cpp
 DIA_asharp.cpp    DIA_coloryuv.cpp     DIA_equalizer.cpp  DIA_jobs.cpp       DIA_pause.cpp     DIA_recent.cpp      DIA_working.cpp
 DIA_busy.cpp      DIA_contrast.cpp     DIA_exLame.cpp     DIA_jobs_save.cpp  DIA_pipe.cpp      DIA_resize.cpp      DIA_x264.cpp
 )

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_animated.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -1,437 +0,0 @@
-/***************************************************************************
-                          DIA_animated
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-
-#include &lt;config.h&gt;
-
-
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-
-# include &lt;math.h&gt;
-
-
-#include &quot;ADM_image.h&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidAnimated_param.h&quot;
-#include &quot;ADM_toolkit/filesel.h&quot;
-#include &quot;ADM_assert.h&quot;
-
-
-uint8_t DIA_animated(ANIMATED_PARAM *param);
-
-static GtkWidget	*create_dialog1 (void);
-
-#define SPIN_GET(x,y) {param-&gt;y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;}
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)param-&gt;y) ;}
-#define CHECK_GET(x,y) {param-&gt;y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),param-&gt;y);}	
-#define ENTRY_SET(x,y) {gtk_write_entry_string(WID(x),(char *)y);}
-#define ENTRY_GET(x,y) {y= (ADM_filename *) ADM_strdup(gtk_editable_get_chars(GTK_EDITABLE ((WID(x))), 0, -1));}
-#define ASSOCIATE(x,y)   gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),y)
-
-#define LOAD_BGD 0x101
-
-uint8_t DIA_animated(ANIMATED_PARAM *param)
-{
-    uint8_t ret=0;
-    GtkWidget *dialog;
-    const char *entries[MAX_VIGNETTE]={&quot;spinbuttonTC0&quot;,&quot;spinbuttonTC1&quot;,&quot;spinbuttonTC2&quot;,
-                            &quot;spinbuttonTC3&quot;,&quot;spinbuttonTC4&quot;,&quot;spinbuttonTC5&quot; };
-
-        dialog=create_dialog1();
-        gtk_register_dialog(dialog);
-
-        CHECK_SET(checkbuttonStd,isNTSC);
-        SPIN_SET(spinbuttonvignetteW,vignetteW);
-        SPIN_SET(spinbuttonvignetteH,vignetteH);
-        if(param-&gt;backgroundImg)
-            ENTRY_SET(entryBgd,param-&gt;backgroundImg);
-        for(int i=0;i&lt;MAX_VIGNETTE;i++)
-        {
-                gtk_spin_button_set_value(GTK_SPIN_BUTTON(lookup_widget(dialog,entries[i])),
-                    (gfloat)param-&gt;timecode[i]) ;
-        }
-
-        ASSOCIATE(button1,LOAD_BGD);
-        //gtk_widget_show(dialog);
-        int action;
-
-        while(1)
-        {
-            action=gtk_dialog_run(GTK_DIALOG(dialog));
-            if(action==LOAD_BGD)
-            {
-                char *nw;
-                    GUI_FileSelRead(_(&quot;Select background picture&quot;), &amp;nw);
-                    if(nw)
-                    {
-                        ENTRY_SET(entryBgd,nw);
-                        ADM_dealloc(nw);
-                    }
-
-                continue;
-            }
-            break;
-        }
-        if(action==GTK_RESPONSE_OK)
-        {
-            CHECK_GET(checkbuttonStd,isNTSC);
-            SPIN_GET(spinbuttonvignetteW,vignetteW);
-            SPIN_GET(spinbuttonvignetteH,vignetteH);
-
-            if(param-&gt;backgroundImg) ADM_dealloc(param-&gt;backgroundImg);
-            param-&gt;backgroundImg=NULL;
-            ENTRY_GET(entryBgd,param-&gt;backgroundImg);
-
-            for(int i=0;i&lt;MAX_VIGNETTE;i++)
-            {
-                
-                param-&gt;timecode[i]=(uint32_t)gtk_spin_button_get_value(GTK_SPIN_BUTTON(lookup_widget(dialog,entries[i]))) ;
-            }
-            ret=1;
-        }
-
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-        return ret;
-}
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *vbox1;
-  GtkWidget *frame1;
-  GtkWidget *alignment1;
-  GtkWidget *table2;
-  GtkWidget *label9;
-  GtkWidget *label10;
-  GtkWidget *checkbuttonStd;
-  GtkWidget *hbox2;
-  GtkWidget *entryBgd;
-  GtkWidget *button1;
-  GtkWidget *label11;
-  GtkWidget *label12;
-  GtkObject *spinbuttonvignetteH_adj;
-  GtkWidget *spinbuttonvignetteH;
-  GtkObject *spinbuttonvignetteW_adj;
-  GtkWidget *spinbuttonvignetteW;
-  GtkWidget *General;
-  GtkWidget *frame2;
-  GtkWidget *alignment2;
-  GtkWidget *table1;
-  GtkWidget *label3;
-  GtkWidget *label4;
-  GtkWidget *label5;
-  GtkWidget *label6;
-  GtkWidget *label7;
-  GtkWidget *label8;
-  GtkObject *spinbuttonTC0_adj;
-  GtkWidget *spinbuttonTC0;
-  GtkObject *spinbuttonTC1_adj;
-  GtkWidget *spinbuttonTC1;
-  GtkObject *spinbuttonTC2_adj;
-  GtkWidget *spinbuttonTC2;
-  GtkObject *spinbuttonTC3_adj;
-  GtkWidget *spinbuttonTC3;
-  GtkObject *spinbuttonTC4_adj;
-  GtkWidget *spinbuttonTC4;
-  GtkObject *spinbuttonTC5_adj;
-  GtkWidget *spinbuttonTC5;
-  GtkWidget *label2;
-  GtkWidget *hseparator1;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-  GtkTooltips *tooltips;
-
-  tooltips = gtk_tooltips_new ();
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;Animated Menu&quot;));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  vbox1 = gtk_vbox_new (FALSE, 0);
-  gtk_widget_show (vbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), vbox1, TRUE, TRUE, 0);
-
-  frame1 = gtk_frame_new (NULL);
-  gtk_widget_show (frame1);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame1, TRUE, TRUE, 0);
-  gtk_frame_set_shadow_type (GTK_FRAME (frame1), GTK_SHADOW_NONE);
-
-  alignment1 = gtk_alignment_new (0.5, 0.5, 1, 1);
-  gtk_widget_show (alignment1);
-  gtk_container_add (GTK_CONTAINER (frame1), alignment1);
-  gtk_alignment_set_padding (GTK_ALIGNMENT (alignment1), 0, 0, 12, 0);
-
-  table2 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table2);
-  gtk_container_add (GTK_CONTAINER (alignment1), table2);
-
-  label9 = gtk_label_new (_(&quot;BackGround Image :&quot;));
-  gtk_widget_show (label9);
-  gtk_table_attach (GTK_TABLE (table2), label9, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label9), 0, 0.5);
-
-  label10 = gtk_label_new (_(&quot;Standard&quot;));
-  gtk_widget_show (label10);
-  gtk_table_attach (GTK_TABLE (table2), label10, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label10), 0, 0.5);
-
-  checkbuttonStd = gtk_check_button_new_with_mnemonic (_(&quot;NTSC (default is PAL)&quot;));
-  gtk_widget_show (checkbuttonStd);
-  gtk_table_attach (GTK_TABLE (table2), checkbuttonStd, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  hbox2 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox2);
-  gtk_table_attach (GTK_TABLE (table2), hbox2, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  entryBgd = gtk_entry_new ();
-  gtk_widget_show (entryBgd);
-  gtk_box_pack_start (GTK_BOX (hbox2), entryBgd, TRUE, FALSE, 0);
-
-  button1 = gtk_button_new_from_stock (&quot;gtk-open&quot;);
-  gtk_widget_show (button1);
-  gtk_box_pack_start (GTK_BOX (hbox2), button1, FALSE, FALSE, 0);
-
-  label11 = gtk_label_new (_(&quot;Vignette Width&quot;));
-  gtk_widget_show (label11);
-  gtk_table_attach (GTK_TABLE (table2), label11, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label11), 0, 0.5);
-
-  label12 = gtk_label_new (_(&quot;Vignette Height&quot;));
-  gtk_widget_show (label12);
-  gtk_table_attach (GTK_TABLE (table2), label12, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label12), 0, 0.5);
-
-  spinbuttonvignetteH_adj = gtk_adjustment_new (1, 16, 240, 2, 10, 10);
-  spinbuttonvignetteH = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonvignetteH_adj), 1, 0);
-  gtk_widget_show (spinbuttonvignetteH);
-  gtk_table_attach (GTK_TABLE (table2), spinbuttonvignetteH, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonvignetteH), TRUE);
-
-  spinbuttonvignetteW_adj = gtk_adjustment_new (1, 16, 240, 2, 10, 10);
-  spinbuttonvignetteW = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonvignetteW_adj), 1, 0);
-  gtk_widget_show (spinbuttonvignetteW);
-  gtk_table_attach (GTK_TABLE (table2), spinbuttonvignetteW, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonvignetteW), TRUE);
-
-  General = gtk_label_new (_(&quot;&lt;b&gt;General&lt;/b&gt;&quot;));
-  gtk_widget_show (General);
-  gtk_frame_set_label_widget (GTK_FRAME (frame1), General);
-  gtk_label_set_use_markup (GTK_LABEL (General), TRUE);
-
-  frame2 = gtk_frame_new (NULL);
-  gtk_widget_show (frame2);
-  gtk_box_pack_start (GTK_BOX (vbox1), frame2, TRUE, TRUE, 0);
-  gtk_frame_set_shadow_type (GTK_FRAME (frame2), GTK_SHADOW_NONE);
-
-  alignment2 = gtk_alignment_new (0.5, 0.5, 1, 1);
-  gtk_widget_show (alignment2);
-  gtk_container_add (GTK_CONTAINER (frame2), alignment2);
-  gtk_alignment_set_padding (GTK_ALIGNMENT (alignment2), 0, 0, 12, 0);
-
-  table1 = gtk_table_new (6, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_container_add (GTK_CONTAINER (alignment2), table1);
-
-  label3 = gtk_label_new (_(&quot;Chapter 1&quot;));
-  gtk_widget_show (label3);
-  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
-
-  label4 = gtk_label_new (_(&quot;Chapter 2&quot;));
-  gtk_widget_show (label4);
-  gtk_table_attach (GTK_TABLE (table1), label4, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
-
-  label5 = gtk_label_new (_(&quot;Chapter 3&quot;));
-  gtk_widget_show (label5);
-  gtk_table_attach (GTK_TABLE (table1), label5, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label5), 0, 0.5);
-
-  label6 = gtk_label_new (_(&quot;Chapter 4&quot;));
-  gtk_widget_show (label6);
-  gtk_table_attach (GTK_TABLE (table1), label6, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label6), 0, 0.5);
-
-  label7 = gtk_label_new (_(&quot;Chapter 5&quot;));
-  gtk_widget_show (label7);
-  gtk_table_attach (GTK_TABLE (table1), label7, 0, 1, 4, 5,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label7), 0, 0.5);
-
-  label8 = gtk_label_new (_(&quot;Chapter 6&quot;));
-  gtk_widget_show (label8);
-  gtk_table_attach (GTK_TABLE (table1), label8, 0, 1, 5, 6,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label8), 0, 0.5);
-
-  spinbuttonTC0_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC0 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC0_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC0);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC0, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC0, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC0), TRUE);
-
-  spinbuttonTC1_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC1_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC1);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC1, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC1, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC1), TRUE);
-
-  spinbuttonTC2_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC2 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC2_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC2);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC2, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC2, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC2), TRUE);
-
-  spinbuttonTC3_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC3 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC3_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC3);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC3, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC3, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC3), TRUE);
-
-  spinbuttonTC4_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC4 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC4_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC4);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC4, 1, 2, 4, 5,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC4, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC4), TRUE);
-
-  spinbuttonTC5_adj = gtk_adjustment_new (160, 0, 900000, 2, 10, 10);
-  spinbuttonTC5 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonTC5_adj), 1, 0);
-  gtk_widget_show (spinbuttonTC5);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonTC5, 1, 2, 5, 6,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_tooltips_set_tip (tooltips, spinbuttonTC5, _(&quot;Start frame for this vignette.&quot;), NULL);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonTC5), TRUE);
-
-  label2 = gtk_label_new (_(&quot;&lt;b&gt;TimeCode&lt;/b&gt;&quot;));
-  gtk_widget_show (label2);
-  gtk_frame_set_label_widget (GTK_FRAME (frame2), label2);
-  gtk_label_set_use_markup (GTK_LABEL (label2), TRUE);
-
-  hseparator1 = gtk_hseparator_new ();
-  gtk_widget_show (hseparator1);
-  gtk_box_pack_start (GTK_BOX (vbox1), hseparator1, TRUE, TRUE, 0);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, vbox1, &quot;vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame1, &quot;frame1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, alignment1, &quot;alignment1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table2, &quot;table2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label9, &quot;label9&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label10, &quot;label10&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonStd, &quot;checkbuttonStd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox2, &quot;hbox2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entryBgd, &quot;entryBgd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, button1, &quot;button1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label11, &quot;label11&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label12, &quot;label12&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonvignetteH, &quot;spinbuttonvignetteH&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonvignetteW, &quot;spinbuttonvignetteW&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, General, &quot;General&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, frame2, &quot;frame2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, alignment2, &quot;alignment2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label5, &quot;label5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label6, &quot;label6&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label7, &quot;label7&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label8, &quot;label8&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC0, &quot;spinbuttonTC0&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC1, &quot;spinbuttonTC1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC2, &quot;spinbuttonTC2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC3, &quot;spinbuttonTC3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC4, &quot;spinbuttonTC4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonTC5, &quot;spinbuttonTC5&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hseparator1, &quot;hseparator1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, tooltips, &quot;tooltips&quot;);
-
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-07-01 16:12:05 UTC (rev 3325)
@@ -27,7 +27,6 @@
         DIA_srt.cpp \
 	DIA_coloryuv.cpp \
 	DIA_quota.cpp \
-	DIA_animated.cpp \
 	DIA_partial.cpp  \
 	DIA_flyDialog.cpp
 
@@ -42,7 +41,7 @@
 DIA_contrast.cpp      DIA_exLame.cpp       DIA_srt.cpp \
 DIA_about.cpp         \
 DIA_acodec.cpp       DIA_crop.cpp          \
-DIA_animated.cpp     DIA_hue.cpp          DIA_ocr.cpp         DIA_vcodec.cpp \
+DIA_hue.cpp          DIA_ocr.cpp         DIA_vcodec.cpp \
 DIA_asharp.cpp       DIA_idx_pg.cpp       DIA_partial.cpp     DIA_vobsub.cpp \
 DIA_idx_pg.h         DIA_pause.cpp       \
 DIA_pipe.cpp        DIA_working.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -33,7 +33,7 @@
 #include &quot;ADM_toolkit/filesel.h&quot;
 
 
-#include &quot;ADM_video/ADM_vidAnimated_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidAnimated_param.h&quot;
 #include &quot;ADM_video/ADM_vidASharp_param.h&quot;
 #include &quot;ADM_audiofilter/audiofilter_normalize_param.h&quot;
 #include &quot;ADM_video/ADM_vidCNR2_param.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -33,7 +33,7 @@
 #include &quot;ADM_toolkit/filesel.h&quot;
 
 
-#include &quot;ADM_video/ADM_vidAnimated_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidAnimated_param.h&quot;
 #include &quot;ADM_video/ADM_vidASharp_param.h&quot;
 #include &quot;ADM_audiofilter/audiofilter_normalize_param.h&quot;
 #include &quot;ADM_video/ADM_vidCNR2_param.h&quot;
@@ -76,7 +76,6 @@
 		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
 #endif
 int     DIA_coloryuv(COLOR_YUV_PARAM *param){return 0;}
-uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-07-01 16:12:05 UTC (rev 3325)
@@ -9,6 +9,7 @@
 DIA_audioFilter.cpp   DIA_enter.cpp           DIA_flyCrop.cpp      DIA_gototime.cpp    DIA_postproc.cpp  DIA_srt.cpp        GUI_render.cpp
 DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       GUI_sdlRender.cpp
 DIA_builtin.cpp       DIA_flyChromaShift.cpp  DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     GUI_xvRender.cpp
+DIA_animated.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_userInterfaces)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp (from rev 3318, branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp	2007-06-28 17:29:59 UTC (rev 3318)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -0,0 +1,64 @@
+//
+//
+// C++ Implementation: DIA_SVCD
+//
+// Description: 
+//
+//
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2003
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+
+#include &lt;config.h&gt;
+//#include &quot;ADM_lavcodec.h&quot;
+
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+
+# include &lt;math.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidAnimated_param.h&quot;
+#include &quot;ADM_assert.h&quot; 
+#include &quot;DIA_factory.h&quot;
+
+/**
+      \fn DIA_animated
+      \brief Dialog to set params for the animated filter
+*/
+uint8_t DIA_animated(ANIMATED_PARAM *param,uint32_t w, uint32_t h,uint32_t n)
+{	
+  uint8_t r=0;
+#define PX(x) &amp;(param-&gt;x)
+   diaElemFile      jpeg(0,(char **)PX(backgroundImg),_(&quot;_Background Image:&quot;));
+   diaElemToggle    isNtsc(PX(isNTSC),_(&quot;_NTSC(default is Pal):&quot;));
+   diaElemUInteger   vignetteW(PX(vignetteW),_(&quot;Vignette _Width:&quot;),16,w/3);
+   diaElemUInteger   vignetteH(PX(vignetteH),_(&quot;Vignette _Height:&quot;),16,h/2);
+   
+   diaElemUInteger *timecode[MAX_VIGNETTE];
+   diaElemFrame timecodes(_(&quot;Vignette frame number&quot;));
+
+   for(int i=0;i&lt;MAX_VIGNETTE;i++)
+   {
+     timecode[i]=new diaElemUInteger(&amp;(param-&gt;timecode[i]),_(&quot;Timecode:&quot;),0,n);
+     timecodes.swallow(timecode[i]);
+   }
+
+ 
+      diaElem *elems[5]={&amp;jpeg,&amp;isNtsc,&amp;vignetteW,&amp;vignetteH,&amp;timecodes};
+    
+  if( diaFactoryRun(&quot;MPEG-2 Configuration&quot;,5,elems))
+  {
+    r=1;
+  }
+  for(int i=0;i&lt;MAX_VIGNETTE;i++)
+  {
+    delete timecode[i]; 
+  }
+  
+  return r;
+}	
+// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-07-01 16:12:05 UTC (rev 3325)
@@ -10,7 +10,8 @@
 DIA_flyHue.cpp \
 DIA_flySrtPos.cpp \
 DIA_tdeint.cpp DIA_v2v.cpp \
-DIA_lavDecoder.cpp  DIA_srt.cpp
+DIA_lavDecoder.cpp  DIA_srt.cpp \
+DIA_animated.cpp
 
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -1,351 +0,0 @@
-
-/***************************************************************************
-    (c)Mean 2006 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
- 
- /***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;math.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include&quot;ADM_video/ADM_vidAnimated.h&quot;
-
-
-#include &quot;ADM_inputs/ADM_inpics/ADM_pics.h&quot;
-
-static FILTER_PARAM animated_template={10,
-    {&quot;tc0&quot;,&quot;tc1&quot;,&quot;tc2&quot;,
-    &quot;tc3&quot;,&quot;tc4&quot;,&quot;tc5&quot;,
-    &quot;isNTSC&quot;,&quot;backgroundImg&quot;,&quot;vignetteW&quot;,&quot;vignetteH&quot;
-    }};
-BUILD_CREATE(animated_create,ADMVideoAnimated);
-SCRIPT_CREATE(animated_script,ADMVideoAnimated,animated_template);
-
-#define LOOKUP 4
-#define CACHE_SIZE (LOOKUP*2+3)
-
-
-extern uint8_t DIA_animated(ANIMATED_PARAM *param);
-
-uint8_t ADMVideoAnimated::configure(AVDMGenericVideoStream *in)
-{
-   if(DIA_animated(_param))
-   {
-      setup();
-      return 1;
-   }
-   return 0;
-}
-
-char *ADMVideoAnimated::printConf( void )
-{
-   static char buf[50];
-   sprintf((char *)buf,&quot; Animated Menu &quot;);
-   return buf;
-}
-uint8_t ADMVideoAnimated::setup( void)
-{
-    cleanup();
-    for(int i=0;i&lt;MAX_VIGNETTE;i++) _caches[i]=new VideoCache(CACHE_SIZE,_in);  // 18 is good for mpeg2
-    _resizer=new ADMImageResizer(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height,
-            _param-&gt;vignetteW,_param-&gt;vignetteH);
-    _image=new ADMImage(_param-&gt;vignetteW,_param-&gt;vignetteH);
-    loadImage();
-}
-uint8_t ADMVideoAnimated::cleanup( void)
-{
-   
-    for(int i=0;i&lt;MAX_VIGNETTE;i++) 
-    {
-        if(_caches[i]) delete _caches[i];
-        _caches[i]=NULL;
-    }
-    if(_resizer) delete _resizer;
-    if(_image) delete _image;
-    if(_BkgGnd) delete _BkgGnd;
-    _resizer=NULL;
-    _image=NULL;
-    _BkgGnd=NULL;
-
-}
-ADMVideoAnimated::ADMVideoAnimated(AVDMGenericVideoStream *in,CONFcouple *couples) 
-{
-   _resizer=NULL;
-   _image=NULL;
-   _BkgGnd=NULL;
-   for(int i=0;i&lt;MAX_VIGNETTE;i++) _caches[i]=NULL;
-
-   _in=in;
-   memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-   _info.encoding=1;
-   _uncompressed=NULL;
-   _param=NEW(ANIMATED_PARAM);
-   if(couples)
-   {
-        GET(isNTSC);
-        GET(backgroundImg);
-        GET(vignetteW);
-        GET(vignetteH);
-#undef GET
-#define GET(x)  couples-&gt;getCouple((char *)&quot;tc&quot;#x,&amp;(_param-&gt;timecode[x]))
-        GET(0);
-        GET(1);
-        GET(2);
-        GET(3);
-        GET(4);
-        GET(5);
-   }
-   else // Default
-   {
-#define MKP(x,y) _param-&gt;x=y;
-            MKP(isNTSC,0);
-            MKP(vignetteW,160);
-            MKP(vignetteH,120);
-#ifdef ADM_WIN32
-       MKP(backgroundImg,(ADM_filename *)ADM_strdup(&quot;c:\\test.jpg&quot;));
-#else
-            MKP(backgroundImg,(ADM_filename *)ADM_strdup(&quot;/tmp/taist.jpg&quot;));
-#endif
-#undef MKP
-#define MKP(x,y) _param-&gt;timecode[x]=y
-        MKP(0,0);
-        MKP(1,100);
-        MKP(2,200);
-        MKP(3,300);
-        MKP(4,500);
-        MKP(5,600);
-   }
-   if(_param-&gt;isNTSC) _info.height=480;
-        else _info.height=576;
-    _info.width=720;
-    setup();
-}
-//____________________________________________________________________
-ADMVideoAnimated::~ADMVideoAnimated()
-{
-   if(_param-&gt;backgroundImg) ADM_dealloc(_param-&gt;backgroundImg);
-   delete _param;
-   _param=NULL;
-   _uncompressed=NULL;
-   cleanup();
-}
-#define BYTE uint8_t 
-#ifndef MAX
-#define MAX(x,y) ((x)&gt;(y) ?(x):(y))
-#endif
-#ifndef MIN
-#define MIN(x,y) ((x)&lt;(y) ?(x):(y))
-#endif
-//_____________________________________________________________
-// It is slow as we should do the resize in place (one 
-//   bunch of memcpy saved)
-// Since it is killing the editor cache anyway, speed it not an issue
-//______________________________________________________________
-uint8_t ADMVideoAnimated::getFrameNumberNoAlloc(uint32_t frame,
-  uint32_t *len,
-  ADMImage *data,
-  uint32_t *flags)
-  {
-    ADMImage *in;
-    uint32_t offset,pool;
-
-    if(frame&gt;= _info.nb_frames) return 0;
-    
-    // Clean the image
-    if(_BkgGnd)
-        data -&gt;duplicate(_BkgGnd);
-    else
-        {
-                data-&gt;blacken();
-                printf(&quot;No background image\n&quot;);
-        }
- const int x_coordinate[3]={LEFT_MARGIN,360-(_param-&gt;vignetteW)/2,720-(_param-&gt;vignetteW)-LEFT_MARGIN};
- const int y_coordinate[2]={TOP_MARGIN,TOP_MARGIN+(_param-&gt;vignetteH)+TOP_MARGIN};
-
-     // Do 3 top
-     for(int line=0;line&lt;2;line++)
-        for(int i=0;i&lt;3;i++)
-        {
-            pool=i+(3*line);
-            if(_param-&gt;timecode[pool]+frame&lt;_in-&gt;getInfo()-&gt;nb_frames) 
-            {
-                // Load LOOKUP frames ...
-                if(!(frame%LOOKUP))
-                    for(int lookup=0;lookup&lt;LOOKUP;lookup++)
-                    {
-                        _caches[pool]-&gt;getImage(_param-&gt;timecode[pool]+frame+lookup);
-                    }
-                // Unlock them
-                _caches[pool]-&gt;unlockAll();
-                in=_caches[pool]-&gt;getImage(_param-&gt;timecode[pool]+frame);
-                if(in) 
-                {
-                     _resizer-&gt;resize(in,_image);
-                    _caches[pool]-&gt;unlockAll();
-                }else
-                {   
-                    printf(&quot;[Animated] Failed to get image %u for pool %u\n&quot;,_param-&gt;timecode[pool]+frame,pool);
-                    _image-&gt;blacken();
-                }
-            }else
-            {   // Blacken 
-                printf(&quot;[Animated] out of bound : %u for pool %u\n&quot;,_param-&gt;timecode[pool]+frame,pool);
-                 _image-&gt;blacken();
-            }
-            // Blit
-
-            _image-&gt;copyTo(data,x_coordinate[i],y_coordinate[line]);
-        }
-
-	return 1;
-
-}
-
-
-uint8_t	ADMVideoAnimated::getCoupledConf( CONFcouple **couples)
-{
-   
-      ADM_assert(_param);
-      *couples=new CONFcouple(10);
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-       CSET(isNTSC);
-       CSET(backgroundImg);
-        CSET(vignetteW);
-        CSET(vignetteH);
-#undef CSET
-#define CSET(x)  (*couples)-&gt;setCouple((char *)&quot;tc&quot;#x,(_param-&gt;timecode[x]))
-        CSET(0);
-        CSET(1);
-        CSET(2);
-        CSET(3);
-        CSET(4);
-        CSET(5);
-
-      return 1;
-}
-uint8_t	ADMVideoAnimated::loadImage(void)
-{
-picHeader *pic=NULL;
-decoders *decoder=NULL;
-ADMImage  *fullSize=NULL;
-ADMImageResizer *resizer=NULL;
-uint32_t len=0,flags_removed=0;
-uint32_t w,h;
-uint8_t *extraData=NULL;
-uint32_t extraDataSize=0;
-
-uint8_t *rdBuffer=NULL;
-
-    if(_BkgGnd) delete _BkgGnd;
-    _BkgGnd=NULL;
-
-    // open the jpg file and load it to binary
-    
-    pic=new picHeader;
-    if(!pic-&gt;open((char *)_param-&gt;backgroundImg))
-    {
-        printf(&quot;[Animated] Cannot load background image\n&quot;);
-        goto skipIt;
-    }
-  
-    // Ok, now we need its size
-    
-    w=pic-&gt;getWidth();
-    h=pic-&gt;getHeight();
-    printf(&quot;[Animated]Pic: %d x %d\n&quot;,w,h);
-    pic-&gt;getExtraHeaderData(&amp;extraDataSize,&amp;extraData);
-    //********
-    {
-        aviInfo info;
-        pic-&gt;getVideoInfo(&amp;info);
-        decoder=getDecoder (info.fcc, w,h,extraDataSize,extraData);
-    }
-     if(!decoder) 
-    {
-        printf(&quot;[Animated]Cannot get decoder\n&quot;);
-        goto skipIt;
-    }
-    // Build new image
-    fullSize=new ADMImage(w,h);
-    fullSize-&gt;blacken();
-    rdBuffer=new uint8_t[w*h*3];     // Hardcoded!
-    ADMCompressedImage img;
-    img.data=rdBuffer;
-    if(!pic-&gt;getFrameNoAlloc(0,&amp;img))
-    {
-        printf(&quot;[Animated]Get frame failed\n&quot;);
-        goto skipIt;
-    }
-    // Decode it
-    if(!decoder-&gt;uncompress (&amp;img, fullSize))
-    {
-        printf(&quot;[Animated]Decoding failed\n&quot;);
-        goto skipIt;
-    }
-    if(fullSize-&gt;_colorspace!=ADM_COLOR_YV12)
-    {
-        printf(&quot;[Animated]Wrong colorspace, only yv12 supported\n&quot;);
-        goto skipIt;
-    }
-    // Need to packit ?
-    if(fullSize-&gt;_planeStride[0])
-        fullSize-&gt;pack(0);
-    // Resize it
-    _BkgGnd=new ADMImage(_info.width,_info.height);
-    resizer=new ADMImageResizer(w,h,_info.width,_info.height);
-    //Util_saveJpg (&quot;/tmp/before.jpg&quot;,w,h,fullSize);
-    if(!resizer-&gt;resize(fullSize,_BkgGnd))
-    {
-        delete _BkgGnd;
-        _BkgGnd=NULL;
-        printf(&quot;[Animated]Resize failed\n&quot;);
-        
-    }else
-    {
-        printf(&quot;[Animated]Image ready\n&quot;);
-    }
-    
-skipIt:
-    {
-        if(decoder) delete decoder;
-        decoder=NULL;
-        if(pic)     delete pic;
-        pic=NULL;
-        if(fullSize)     delete fullSize;
-        fullSize=NULL;
-        if(resizer)     delete resizer;
-        resizer=NULL;
-        if(rdBuffer)     delete [] rdBuffer;
-        rdBuffer=NULL;
-    }
-    return 1;
-
-
-}
-
-
-// EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.h	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.h	2007-07-01 16:12:05 UTC (rev 3325)
@@ -1,50 +0,0 @@
-/***************************************************************************
-                          Port of avisynth ColorYuv Filter
-    copyright            : (C) 2006 by mean
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ADM_VID_ANIMATED_H
-#define ADM_VID_ANIMATED_H
-
-
-
-#define LEFT_MARGIN 50
-#define TOP_MARGIN 50
-
-#include &quot;ADM_vidAnimated_param.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-
-class  ADMVideoAnimated:public AVDMGenericVideoStream
-{
-
-    protected:
-
-        virtual     char            *printConf(void) ;
-                    ANIMATED_PARAM  *_param;
-                    ADMImageResizer *_resizer;
-                    ADMImage        *_image;
-                    ADMImage        *_BkgGnd;
-                    VideoCache      *_caches[MAX_VIGNETTE];
-                    uint8_t         setup( void);
-                    uint8_t         cleanup( void);
-                    uint8_t         loadImage(void);
-    public:
-                    ADMVideoAnimated(  AVDMGenericVideoStream *in,CONFcouple *setup);
-                    ~ADMVideoAnimated();
-        virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                ADMImage *data,uint32_t *flags);
-
-        virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
-        virtual uint8_t getCoupledConf( CONFcouple **couples);
-
-}     ;
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated_param.h	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated_param.h	2007-07-01 16:12:05 UTC (rev 3325)
@@ -1,26 +0,0 @@
-/***************************************************************************
-    copyright            : (C) 2006 by mean
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef ADM_VID_ANIMATED_PARAM_H
-#define ADM_VID_ANIMATED_PARAM_H
-#define MAX_VIGNETTE 6
-typedef struct ANIMATED_PARAM
-{
-    uint32_t        vignetteW;
-    uint32_t        vignetteH;
-    uint32_t        isNTSC;
-    uint32_t        timecode[MAX_VIGNETTE];
-    ADM_filename    *backgroundImg;
-}ANIMATED_PARAM;
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-07-01 16:12:05 UTC (rev 3325)
@@ -9,7 +9,6 @@
 ADM_vidRaw.cpp        
 ADM_vidUnblend.cpp
 ADM_genvideo.cpp         
-ADM_vidAnimated.cpp     
 ADM_vidContrast.cpp   
 ADM_vidFont.cpp
 ADM_vidVobsub.cpp

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-07-01 16:12:05 UTC (rev 3325)
@@ -37,8 +37,7 @@
   ADM_vidDelta.cpp \
  ADM_vidUnblend.cpp \
  ADM_vidMPdelogo.cpp \
- ADM_vidColorYuv.cpp  \
- ADM_vidAnimated.cpp 
+ ADM_vidColorYuv.cpp  
 
 				
 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated.cpp (from rev 3318, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.cpp	2007-06-28 17:29:59 UTC (rev 3318)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated.cpp	2007-07-01 16:12:05 UTC (rev 3325)
@@ -0,0 +1,352 @@
+
+/***************************************************************************
+    (c)Mean 2006 <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+ 
+ /***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;avi_vars.h&quot;
+#include &quot;math.h&quot;
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+#include &quot;ADM_vidAnimated.h&quot;
+
+
+#include &quot;ADM_inputs/ADM_inpics/ADM_pics.h&quot;
+
+static FILTER_PARAM animated_template={10,
+    {&quot;tc0&quot;,&quot;tc1&quot;,&quot;tc2&quot;,
+    &quot;tc3&quot;,&quot;tc4&quot;,&quot;tc5&quot;,
+    &quot;isNTSC&quot;,&quot;backgroundImg&quot;,&quot;vignetteW&quot;,&quot;vignetteH&quot;
+    }};
+BUILD_CREATE(animated_create,ADMVideoAnimated);
+SCRIPT_CREATE(animated_script,ADMVideoAnimated,animated_template);
+
+#define LOOKUP 4
+#define CACHE_SIZE (LOOKUP*2+3)
+
+
+extern uint8_t DIA_animated(ANIMATED_PARAM *param,uint32_t w,uint32_t h, uint32_t n);
+
+uint8_t ADMVideoAnimated::configure(AVDMGenericVideoStream *in)
+{
+  ADV_Info *f=in-&gt;getInfo();
+   if(DIA_animated(_param,f-&gt;width,f-&gt;height,f-&gt;nb_frames))
+   {
+      setup();
+      return 1;
+   }
+   return 0;
+}
+
+char *ADMVideoAnimated::printConf( void )
+{
+   static char buf[50];
+   sprintf((char *)buf,&quot; Animated Menu &quot;);
+   return buf;
+}
+uint8_t ADMVideoAnimated::setup( void)
+{
+    cleanup();
+    for(int i=0;i&lt;MAX_VIGNETTE;i++) _caches[i]=new VideoCache(CACHE_SIZE,_in);  // 18 is good for mpeg2
+    _resizer=new ADMImageResizer(_in-&gt;getInfo()-&gt;width,_in-&gt;getInfo()-&gt;height,
+            _param-&gt;vignetteW,_param-&gt;vignetteH);
+    _image=new ADMImage(_param-&gt;vignetteW,_param-&gt;vignetteH);
+    loadImage();
+}
+uint8_t ADMVideoAnimated::cleanup( void)
+{
+   
+    for(int i=0;i&lt;MAX_VIGNETTE;i++) 
+    {
+        if(_caches[i]) delete _caches[i];
+        _caches[i]=NULL;
+    }
+    if(_resizer) delete _resizer;
+    if(_image) delete _image;
+    if(_BkgGnd) delete _BkgGnd;
+    _resizer=NULL;
+    _image=NULL;
+    _BkgGnd=NULL;
+
+}
+ADMVideoAnimated::ADMVideoAnimated(AVDMGenericVideoStream *in,CONFcouple *couples) 
+{
+   _resizer=NULL;
+   _image=NULL;
+   _BkgGnd=NULL;
+   for(int i=0;i&lt;MAX_VIGNETTE;i++) _caches[i]=NULL;
+
+   _in=in;
+   memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+   _info.encoding=1;
+   _uncompressed=NULL;
+   _param=NEW(ANIMATED_PARAM);
+   if(couples)
+   {
+        GET(isNTSC);
+        GET(backgroundImg);
+        GET(vignetteW);
+        GET(vignetteH);
+#undef GET
+#define GET(x)  couples-&gt;getCouple((char *)&quot;tc&quot;#x,&amp;(_param-&gt;timecode[x]))
+        GET(0);
+        GET(1);
+        GET(2);
+        GET(3);
+        GET(4);
+        GET(5);
+   }
+   else // Default
+   {
+#define MKP(x,y) _param-&gt;x=y;
+            MKP(isNTSC,0);
+            MKP(vignetteW,160);
+            MKP(vignetteH,120);
+#ifdef ADM_WIN32
+       MKP(backgroundImg,(ADM_filename *)ADM_strdup(&quot;c:\\test.jpg&quot;));
+#else
+            MKP(backgroundImg,(ADM_filename *)ADM_strdup(&quot;/tmp/taist.jpg&quot;));
+#endif
+#undef MKP
+#define MKP(x,y) _param-&gt;timecode[x]=y
+        MKP(0,0);
+        MKP(1,100);
+        MKP(2,200);
+        MKP(3,300);
+        MKP(4,500);
+        MKP(5,600);
+   }
+   if(_param-&gt;isNTSC) _info.height=480;
+        else _info.height=576;
+    _info.width=720;
+    setup();
+}
+//____________________________________________________________________
+ADMVideoAnimated::~ADMVideoAnimated()
+{
+   if(_param-&gt;backgroundImg) ADM_dealloc(_param-&gt;backgroundImg);
+   delete _param;
+   _param=NULL;
+   _uncompressed=NULL;
+   cleanup();
+}
+#define BYTE uint8_t 
+#ifndef MAX
+#define MAX(x,y) ((x)&gt;(y) ?(x):(y))
+#endif
+#ifndef MIN
+#define MIN(x,y) ((x)&lt;(y) ?(x):(y))
+#endif
+//_____________________________________________________________
+// It is slow as we should do the resize in place (one 
+//   bunch of memcpy saved)
+// Since it is killing the editor cache anyway, speed it not an issue
+//______________________________________________________________
+uint8_t ADMVideoAnimated::getFrameNumberNoAlloc(uint32_t frame,
+  uint32_t *len,
+  ADMImage *data,
+  uint32_t *flags)
+  {
+    ADMImage *in;
+    uint32_t offset,pool;
+
+    if(frame&gt;= _info.nb_frames) return 0;
+    
+    // Clean the image
+    if(_BkgGnd)
+        data -&gt;duplicate(_BkgGnd);
+    else
+        {
+                data-&gt;blacken();
+                printf(&quot;No background image\n&quot;);
+        }
+ const int x_coordinate[3]={LEFT_MARGIN,360-(_param-&gt;vignetteW)/2,720-(_param-&gt;vignetteW)-LEFT_MARGIN};
+ const int y_coordinate[2]={TOP_MARGIN,TOP_MARGIN+(_param-&gt;vignetteH)+TOP_MARGIN};
+
+     // Do 3 top
+     for(int line=0;line&lt;2;line++)
+        for(int i=0;i&lt;3;i++)
+        {
+            pool=i+(3*line);
+            if(_param-&gt;timecode[pool]+frame&lt;_in-&gt;getInfo()-&gt;nb_frames) 
+            {
+                // Load LOOKUP frames ...
+                if(!(frame%LOOKUP))
+                    for(int lookup=0;lookup&lt;LOOKUP;lookup++)
+                    {
+                        _caches[pool]-&gt;getImage(_param-&gt;timecode[pool]+frame+lookup);
+                    }
+                // Unlock them
+                _caches[pool]-&gt;unlockAll();
+                in=_caches[pool]-&gt;getImage(_param-&gt;timecode[pool]+frame);
+                if(in) 
+                {
+                     _resizer-&gt;resize(in,_image);
+                    _caches[pool]-&gt;unlockAll();
+                }else
+                {   
+                    printf(&quot;[Animated] Failed to get image %u for pool %u\n&quot;,_param-&gt;timecode[pool]+frame,pool);
+                    _image-&gt;blacken();
+                }
+            }else
+            {   // Blacken 
+                printf(&quot;[Animated] out of bound : %u for pool %u\n&quot;,_param-&gt;timecode[pool]+frame,pool);
+                 _image-&gt;blacken();
+            }
+            // Blit
+
+            _image-&gt;copyTo(data,x_coordinate[i],y_coordinate[line]);
+        }
+
+	return 1;
+
+}
+
+
+uint8_t	ADMVideoAnimated::getCoupledConf( CONFcouple **couples)
+{
+   
+      ADM_assert(_param);
+      *couples=new CONFcouple(10);
+#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
+       CSET(isNTSC);
+       CSET(backgroundImg);
+        CSET(vignetteW);
+        CSET(vignetteH);
+#undef CSET
+#define CSET(x)  (*couples)-&gt;setCouple((char *)&quot;tc&quot;#x,(_param-&gt;timecode[x]))
+        CSET(0);
+        CSET(1);
+        CSET(2);
+        CSET(3);
+        CSET(4);
+        CSET(5);
+
+      return 1;
+}
+uint8_t	ADMVideoAnimated::loadImage(void)
+{
+picHeader *pic=NULL;
+decoders *decoder=NULL;
+ADMImage  *fullSize=NULL;
+ADMImageResizer *resizer=NULL;
+uint32_t len=0,flags_removed=0;
+uint32_t w,h;
+uint8_t *extraData=NULL;
+uint32_t extraDataSize=0;
+
+uint8_t *rdBuffer=NULL;
+
+    if(_BkgGnd) delete _BkgGnd;
+    _BkgGnd=NULL;
+
+    // open the jpg file and load it to binary
+    
+    pic=new picHeader;
+    if(!pic-&gt;open((char *)_param-&gt;backgroundImg))
+    {
+        printf(&quot;[Animated] Cannot load background image\n&quot;);
+        goto skipIt;
+    }
+  
+    // Ok, now we need its size
+    
+    w=pic-&gt;getWidth();
+    h=pic-&gt;getHeight();
+    printf(&quot;[Animated]Pic: %d x %d\n&quot;,w,h);
+    pic-&gt;getExtraHeaderData(&amp;extraDataSize,&amp;extraData);
+    //********
+    {
+        aviInfo info;
+        pic-&gt;getVideoInfo(&amp;info);
+        decoder=getDecoder (info.fcc, w,h,extraDataSize,extraData);
+    }
+     if(!decoder) 
+    {
+        printf(&quot;[Animated]Cannot get decoder\n&quot;);
+        goto skipIt;
+    }
+    // Build new image
+    fullSize=new ADMImage(w,h);
+    fullSize-&gt;blacken();
+    rdBuffer=new uint8_t[w*h*3];     // Hardcoded!
+    ADMCompressedImage img;
+    img.data=rdBuffer;
+    if(!pic-&gt;getFrameNoAlloc(0,&amp;img))
+    {
+        printf(&quot;[Animated]Get frame failed\n&quot;);
+        goto skipIt;
+    }
+    // Decode it
+    if(!decoder-&gt;uncompress (&amp;img, fullSize))
+    {
+        printf(&quot;[Animated]Decoding failed\n&quot;);
+        goto skipIt;
+    }
+    if(fullSize-&gt;_colorspace!=ADM_COLOR_YV12)
+    {
+        printf(&quot;[Animated]Wrong colorspace, only yv12 supported\n&quot;);
+        goto skipIt;
+    }
+    // Need to packit ?
+    if(fullSize-&gt;_planeStride[0])
+        fullSize-&gt;pack(0);
+    // Resize it
+    _BkgGnd=new ADMImage(_info.width,_info.height);
+    resizer=new ADMImageResizer(w,h,_info.width,_info.height);
+    //Util_saveJpg (&quot;/tmp/before.jpg&quot;,w,h,fullSize);
+    if(!resizer-&gt;resize(fullSize,_BkgGnd))
+    {
+        delete _BkgGnd;
+        _BkgGnd=NULL;
+        printf(&quot;[Animated]Resize failed\n&quot;);
+        
+    }else
+    {
+        printf(&quot;[Animated]Image ready\n&quot;);
+    }
+    
+skipIt:
+    {
+        if(decoder) delete decoder;
+        decoder=NULL;
+        if(pic)     delete pic;
+        pic=NULL;
+        if(fullSize)     delete fullSize;
+        fullSize=NULL;
+        if(resizer)     delete resizer;
+        resizer=NULL;
+        if(rdBuffer)     delete [] rdBuffer;
+        rdBuffer=NULL;
+    }
+    return 1;
+
+
+}
+
+
+// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated.h (from rev 3318, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAnimated_param.h (from rev 3318, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAnimated_param.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-07-01 16:12:05 UTC (rev 3325)
@@ -22,5 +22,6 @@
 ADM_vidResize25.cpp
 ADM_vidTdeint.cpp
 ADM_vidChromaShift.cpp  
+ADM_vidAnimated.cpp
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-07-01 08:18:15 UTC (rev 3324)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-07-01 16:12:05 UTC (rev 3325)
@@ -60,7 +60,8 @@
  ADM_vidFastConvolution.cpp  \
  ADM_vidRotate.cpp \
  ADM_vidYadif.cpp \
- ADM_vidYadif_asm.c
+ ADM_vidYadif_asm.c \
+ ADM_vidAnimated.cpp
 			
 
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000601.html">[Avidemux-svn-commit] r3324 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialog ADM_gui
</A></li>
	<LI>Next message: <A HREF="000603.html">[Avidemux-svn-commit] r3326 - in branches/avidemux_2.4_branch: .	avidemux avidemux/ADM_libraries/ADM_smjs cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#602">[ date ]</a>
              <a href="thread.html#602">[ thread ]</a>
              <a href="subject.html#602">[ subject ]</a>
              <a href="author.html#602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
