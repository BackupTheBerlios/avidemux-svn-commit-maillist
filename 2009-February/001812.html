<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4582 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows:	build_scripts/avidemux installer
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4582%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/platforms/windows%3A%0A%09build_scripts/avidemux%20installer&In-Reply-To=%3C200902101600.n1AG0VwQ017200%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001811.html">
   <LINK REL="Next"  HREF="001813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4582 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows:	build_scripts/avidemux installer</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4582%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/platforms/windows%3A%0A%09build_scripts/avidemux%20installer&In-Reply-To=%3C200902101600.n1AG0VwQ017200%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4582 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows:	build_scripts/avidemux installer">gruntster at mail.berlios.de
       </A><BR>
    <I>Tue Feb 10 17:00:31 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001811.html">[Avidemux-svn-commit] r4581 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows:	build_scripts/avidemux build_scripts/avidemux/Tools installer
</A></li>
        <LI>Next message: <A HREF="001813.html">[Avidemux-svn-commit] r4583 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/ADM_coreDemuxerMpeg/include	avidemux/ADM_coreDemuxerMpeg/src plugins/ADM_demuxers/MpegPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1812">[ date ]</a>
              <a href="thread.html#1812">[ thread ]</a>
              <a href="subject.html#1812">[ subject ]</a>
              <a href="author.html#1812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-02-10 17:00:26 +0100 (Tue, 10 Feb 2009)
New Revision: 4582

Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
Log:
[Win32] update installer script for 2.5 (generate log for uninstalling) [Part 2]

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2009-02-09 21:07:24 UTC (rev 4581)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2009-02-10 16:00:26 UTC (rev 4582)
@@ -24,9 +24,7 @@
 advzip -z -4 &quot;%packageDir%\%zipFile%&quot;
 
 echo -- Generating %exeFile% --
-echo !define BUILDDIR %buildDir% &gt; &quot;..\..\installer\builddir.nsh&quot;
-&quot;%nsisDir%\makensis&quot; /V2 &quot;..\..\installer\avidemux.nsi&quot;
+cd %buildDir%
+&quot;%nsisDir%\makensis&quot; /V2 /NOCD /DNSIDIR=&quot;%curDir%\..\..\installer&quot; /DEXEDIR=&quot;%packageDir%&quot; &quot;%curDir%\..\..\installer\avidemux.nsi&quot;
 
-move &quot;..\..\installer\%exeFile%&quot; &quot;%packageDir%&quot;
-
 pause

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2009-02-09 21:07:24 UTC (rev 4581)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2009-02-10 16:00:26 UTC (rev 4582)
@@ -5,8 +5,8 @@
 !include MUI2.nsh
 !include nsDialogs.nsh
 !include Memento.nsh
-!include revision.nsh
-!include builddir.nsh
+!include FileFunc.nsh
+!include ${NSIDIR}\revision.nsh
 
 Name &quot;Avidemux 2.5.0 beta r${REVISION}&quot;
 
@@ -35,14 +35,14 @@
 !define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install-blue-full.ico&quot;
 !define MUI_HEADERIMAGE
 !define MUI_HEADERIMAGE_RIGHT
-!define MUI_HEADERIMAGE_BITMAP &quot;PageHeader.bmp&quot;
+!define MUI_HEADERIMAGE_BITMAP &quot;${NSIDIR}\PageHeader.bmp&quot;
 !define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM
 !define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;${REGKEY}&quot;
 !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup
 !define MUI_STARTMENUPAGE_DEFAULTFOLDER Avidemux
 !define MUI_STARTMENUPAGE_NODISABLE
-!define MUI_WELCOMEFINISHPAGE_BITMAP &quot;WelcomeFinishStrip.bmp&quot;
-!define MUI_UNICON &quot;..\..\..\avidemux\xpm\adm.ico&quot;
+!define MUI_WELCOMEFINISHPAGE_BITMAP &quot;${NSIDIR}\WelcomeFinishStrip.bmp&quot;
+!define MUI_UNICON &quot;${NSIDIR}\..\..\..\avidemux\xpm\adm.ico&quot;
 !define MUI_UNFINISHPAGE_NOAUTOCLOSE
 !define MUI_COMPONENTSPAGE_NODESC
 
@@ -58,7 +58,7 @@
 # Installer pages
 ##########################
 !insertmacro MUI_PAGE_WELCOME
-!insertmacro MUI_PAGE_LICENSE License.rtf
+!insertmacro MUI_PAGE_LICENSE &quot;${NSIDIR}\License.rtf&quot;
 !define MUI_PAGE_CUSTOMFUNCTION_LEAVE CheckSelectedUIs
 !insertmacro MUI_PAGE_COMPONENTS
 Page custom InstallOptionsPage InstallOptionsPageLeave
@@ -87,7 +87,7 @@
 ##########################
 # Installer attributes
 ##########################
-OutFile avidemux_2.5_r${REVISION}_win32.exe
+OutFile ${EXEDIR}\avidemux_2.5_r${REVISION}_win32.exe
 InstallDir &quot;$PROGRAMFILES\Avidemux 2.5&quot;
 CRCCheck on
 XPStyle on
@@ -105,6 +105,71 @@
 InstType Full
 
 ##########################
+# Uninstaller macros
+##########################
+!define UninstallLogPath &quot;$INSTDIR\uninstall.log&quot;
+Var UninstallLogHandle
+
+; Uninstall log file missing.
+LangString UninstallLogMissing ${LANG_ENGLISH} &quot;uninstall.log not found!$\r$\nUninstallation cannot proceed!&quot;
+
+!macro InstallFile FILEREGEX
+	File &quot;${FILEREGEX}&quot;
+	!define Index 'Line${__LINE__}'
+	${GetFileName} &quot;${FILEREGEX}&quot; $R0
+	FindFirst $0 $1 &quot;$OUTDIR\$R0&quot;
+	StrCmp $0 &quot;&quot; &quot;${Index}-End&quot;
+&quot;${Index}-Loop:&quot;
+	StrCmp $1 &quot;&quot; &quot;${Index}-End&quot;
+	FileWrite $UninstallLogHandle &quot;$OUTDIR\$1$\r$\n&quot;
+	FindNext $0 $1
+	Goto &quot;${Index}-Loop&quot;
+&quot;${Index}-End:&quot;
+	!undef Index
+!macroend
+!define File &quot;!insertmacro InstallFile&quot;
+ 
+!macro InstallFolder FILEREGEX
+	File /r &quot;${FILEREGEX}\*&quot;
+	Push &quot;$OUTDIR&quot;
+	Call InstallFolderInternal
+!macroend
+!define Folder &quot;!insertmacro InstallFolder&quot;
+ 
+Function InstallFolderInternal
+	Pop $9
+	!define Index 'Line${__LINE__}'
+	FindFirst $0 $1 &quot;$9\*&quot;
+	StrCmp $0 &quot;&quot; &quot;${Index}-End&quot;
+&quot;${Index}-Loop:&quot;
+	StrCmp $1 &quot;&quot; &quot;${Index}-End&quot;
+	StrCmp $1 &quot;.&quot; &quot;${Index}-Next&quot;
+	StrCmp $1 &quot;..&quot; &quot;${Index}-Next&quot;
+	IfFileExists &quot;$9\$1\*&quot; 0 &quot;${Index}-Write&quot;
+		Push $0
+		Push $9
+		Push &quot;$9\$1&quot;
+		Call InstallFolderInternal
+		Pop $9
+		Pop $0
+		Goto &quot;${Index}-Next&quot;
+&quot;${Index}-Write:&quot;
+	FileWrite $UninstallLogHandle &quot;$9\$1$\r$\n&quot;
+&quot;${Index}-Next:&quot;
+	FindNext $0 $1
+	Goto &quot;${Index}-Loop&quot;
+&quot;${Index}-End:&quot;
+	!undef Index
+FunctionEnd
+
+; WriteUninstaller macro
+!macro WriteUninstaller Path
+	WriteUninstaller &quot;${Path}&quot;
+	FileWrite $UninstallLogHandle &quot;${Path}$\r$\n&quot;
+!macroend
+!define WriteUninstaller &quot;!insertmacro WriteUninstaller&quot;
+
+##########################
 # Macros
 ##########################
 !macro InstallGtkLanguage LANG_NAME LANG_CODE
@@ -114,8 +179,8 @@
 
 installGtk${LANG_CODE}:
     SetOutPath $INSTDIR\share\locale\${LANG_CODE}\LC_MESSAGES
-    File ${BUILDDIR}\share\locale\${LANG_CODE}\LC_MESSAGES\avidemux.mo
-    File ${BUILDDIR}\share\locale\${LANG_CODE}\LC_MESSAGES\gtk20.mo
+    ${File} share\locale\${LANG_CODE}\LC_MESSAGES\avidemux.mo
+    ${File} share\locale\${LANG_CODE}\LC_MESSAGES\gtk20.mo
 
 endGtk${LANG_CODE}:
 !macroend
@@ -127,54 +192,54 @@
 
 installQt4${LANG_CODE}:	
 	SetOutPath $INSTDIR\i18n
-    File ${BUILDDIR}\i18n\avidemux_${LANG_CODE}.qm
-    File ${BUILDDIR}\i18n\qt_${LANG_CODE}.qm
+    ${File} i18n\avidemux_${LANG_CODE}.qm
+    ${File} i18n\qt_${LANG_CODE}.qm
 
 endQt4${LANG_CODE}:
 !macroend
 
-!macro UninstallLanguage LANG_NAME LANG_CODE
-    RmDir /r /REBOOTOK $INSTDIR\share\locale\${LANG_CODE}
-    Delete /REBOOTOK $INSTDIR\i18n\avidemux_${LANG_CODE}.qm
-    Delete /REBOOTOK $INSTDIR\i18n\qt_${LANG_CODE}.qm
-!macroend
-
 ##########################
 # Installer sections
 ##########################
+Section -OpenLogFile
+	CreateDirectory &quot;$INSTDIR&quot;
+	FileOpen $UninstallLogHandle ${UninstallLogPath} a
+	FileSeek $UninstallLogHandle 0 END
+SectionEnd
+
 Section &quot;Core files (required)&quot; SecCore
     SectionIn 1 2 RO
     SetOutPath $INSTDIR
     SetOverwrite on
-    File &quot;${BUILDDIR}\Build Info.txt&quot;
-    File &quot;${BUILDDIR}\Change Log.html&quot;
-    File ${BUILDDIR}\zlib1.dll
-    File ${BUILDDIR}\freetype6.dll
-    File ${BUILDDIR}\iconv.dll
-    File ${BUILDDIR}\intl.dll
-    File ${BUILDDIR}\libADM_core.dll
-    File ${BUILDDIR}\libADM_coreAudio.dll
-    File ${BUILDDIR}\libADM_coreImage.dll
-    File ${BUILDDIR}\libADM_coreUI.dll
-    File ${BUILDDIR}\libADM_smjs.dll
-    File ${BUILDDIR}\libaften.dll
-    File ${BUILDDIR}\libexpat-*.dll
-    File ${BUILDDIR}\libfontconfig-1.dll
-    File ${BUILDDIR}\libxml2.dll
-    File ${BUILDDIR}\ogg.dll
-    File ${BUILDDIR}\pthreadGC2.dll
-    File ${BUILDDIR}\SDL.dll
-    File ${BUILDDIR}\xmltok.dll
-    File ${BUILDDIR}\AUTHORS.
-    File ${BUILDDIR}\COPYING.
-    File ${BUILDDIR}\README.
-    File ${BUILDDIR}\avcodec-*.dll
-    File ${BUILDDIR}\avformat-*.dll
-    File ${BUILDDIR}\avutil-*.dll
-    File ${BUILDDIR}\postproc-*.dll
-    File ${BUILDDIR}\swscale-*.dll
+    ${File} &quot;Build Info.txt&quot;
+    ${File} &quot;Change Log.html&quot;
+    ${File} zlib1.dll
+    ${File} freetype6.dll
+    ${File} iconv.dll
+    ${File} intl.dll
+    ${File} libADM_core.dll
+    ${File} libADM_coreAudio.dll
+    ${File} libADM_coreImage.dll
+    ${File} libADM_coreUI.dll
+    ${File} libADM_smjs.dll
+    ${File} libaften.dll
+    ${File} libexpat-*.dll
+    ${File} libfontconfig-1.dll
+    ${File} libxml2.dll
+    ${File} ogg.dll
+    ${File} pthreadGC2.dll
+    ${File} SDL.dll
+    ${File} xmltok.dll
+    ${File} AUTHORS.
+    ${File} COPYING.
+    ${File} README.
+    ${File} avcodec-*.dll
+    ${File} avformat-*.dll
+    ${File} avutil-*.dll
+    ${File} postproc-*.dll
+    ${File} swscale-*.dll
     SetOutPath $INSTDIR\etc\fonts
-    File /r ${BUILDDIR}\etc\fonts\*
+    ${Folder} etc\fonts
 SectionEnd
 
 SectionGroup /e &quot;User interfaces&quot; SecGrpUI
@@ -182,55 +247,55 @@
         SectionIn 1 2
         SetOutPath $INSTDIR
         SetOverwrite on
-        File ${BUILDDIR}\avidemux2_cli.exe
-        File ${BUILDDIR}\libADM_render_cli.dll
-        File ${BUILDDIR}\libADM_UICli.dll
+        ${File} avidemux2_cli.exe
+        ${File} libADM_render_cli.dll
+        ${File} libADM_UICli.dll
     ${MementoSectionEnd}
 
     ${MementoUnselectedSection} GTK+ SecUiGtk
         SectionIn 2
         SetOverwrite on
         SetOutPath $INSTDIR\etc\gtk-2.0
-        File /r ${BUILDDIR}\etc\gtk-2.0\*
+        ${Folder} etc\gtk-2.0
         SetOutPath $INSTDIR\etc\pango
-        File /r ${BUILDDIR}\etc\pango\*
+        ${Folder} etc\pango
         SetOutPath $INSTDIR\lib\gtk-2.0
-        File /r ${BUILDDIR}\lib\gtk-2.0\*
+        ${Folder} lib\gtk-2.0
         SetOutPath $INSTDIR\share\themes
-        File /r ${BUILDDIR}\share\themes\*
+        ${Folder} share\themes
         SetOutPath $INSTDIR
-        File ${BUILDDIR}\avidemux2_gtk.exe
-        File ${BUILDDIR}\gtk2_prefs.exe
-        File ${BUILDDIR}\jpeg62.dll
-        File ${BUILDDIR}\libADM_render_gtk.dll
-        File ${BUILDDIR}\libADM_UIGtk.dll
-        File ${BUILDDIR}\libatk-1.0-0.dll
-        File ${BUILDDIR}\libcairo-2.dll
-        File ${BUILDDIR}\libgdk_pixbuf-2.0-0.dll
-        File ${BUILDDIR}\libgdk-win32-2.0-0.dll
-        File ${BUILDDIR}\libgio-2.0-0.dll
-        File ${BUILDDIR}\libglib-2.0-0.dll
-        File ${BUILDDIR}\libgmodule-2.0-0.dll
-        File ${BUILDDIR}\libgobject-2.0-0.dll
-        File ${BUILDDIR}\libgthread-2.0-0.dll
-        File ${BUILDDIR}\libgtk-win32-2.0-0.dll
-        File ${BUILDDIR}\libpango-1.0-0.dll
-        File ${BUILDDIR}\libpangocairo-1.0-0.dll
-        File ${BUILDDIR}\libpangowin32-1.0-0.dll
-        File ${BUILDDIR}\libpng12-0.dll
-        File ${BUILDDIR}\libtiff3.dll
+        ${File} avidemux2_gtk.exe
+        ${File} gtk2_prefs.exe
+        ${File} jpeg62.dll
+        ${File} libADM_render_gtk.dll
+        ${File} libADM_UIGtk.dll
+        ${File} libatk-1.0-0.dll
+        ${File} libcairo-2.dll
+        ${File} libgdk_pixbuf-2.0-0.dll
+        ${File} libgdk-win32-2.0-0.dll
+        ${File} libgio-2.0-0.dll
+        ${File} libglib-2.0-0.dll
+        ${File} libgmodule-2.0-0.dll
+        ${File} libgobject-2.0-0.dll
+        ${File} libgthread-2.0-0.dll
+        ${File} libgtk-win32-2.0-0.dll
+        ${File} libpango-1.0-0.dll
+        ${File} libpangocairo-1.0-0.dll
+        ${File} libpangowin32-1.0-0.dll
+        ${File} libpng12-0.dll
+        ${File} libtiff3.dll
     ${MementoSectionEnd}
 
     ${MementoSection} Qt4 SecUiQt4
         SectionIn 1 2
         SetOutPath $INSTDIR
         SetOverwrite on
-        File ${BUILDDIR}\QtGui4.dll
-        File ${BUILDDIR}\avidemux2_qt4.exe
-        File ${BUILDDIR}\libADM_render_qt4.dll
-        File ${BUILDDIR}\libADM_UIQT4.dll
-        File ${BUILDDIR}\mingwm10.dll
-        File ${BUILDDIR}\QtCore4.dll
+        ${File} QtGui4.dll
+        ${File} avidemux2_qt4.exe
+        ${File} libADM_render_qt4.dll
+        ${File} libADM_UIQT4.dll
+        ${File} mingwm10.dll
+        ${File} QtCore4.dll
     ${MementoSectionEnd}
 SectionGroupEnd
 
@@ -240,21 +305,21 @@
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioDecoder
-			File ${BUILDDIR}\lib\ADM_plugins\audioDecoder\libADM_ad_faad.dll
+			${File} lib\ADM_plugins\audioDecoder\libADM_ad_faad.dll
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\libfaad2.dll
+			${File} libfaad2.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;liba52 (AC-3)&quot; SecAudDecA52
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioDecoder
-			File ${BUILDDIR}\lib\ADM_plugins\audioDecoder\libADM_ad_a52.dll
+			${File} lib\ADM_plugins\audioDecoder\libADM_ad_a52.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;MAD (MPEG)&quot; SecAudDecMad
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioDecoder
-			File ${BUILDDIR}\lib\ADM_plugins\audioDecoder\libADM_ad_Mad.dll
+			${File} lib\ADM_plugins\audioDecoder\libADM_ad_Mad.dll
 		${MementoSectionEnd}
 	SectionGroupEnd
 	SectionGroup &quot;Audio Devices&quot; SecGrpAudioDevice
@@ -262,13 +327,13 @@
 			SectionIn 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioDevices
-			File ${BUILDDIR}\lib\ADM_plugins\audioDevices\libADM_av_sdl.dll
+			${File} lib\ADM_plugins\audioDevices\libADM_av_sdl.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;MS Windows (Waveform)&quot; SecAudDevWaveform
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioDevices
-			File ${BUILDDIR}\lib\ADM_plugins\audioDevices\libADM_av_win32.dll
+			${File} lib\ADM_plugins\audioDevices\libADM_av_win32.dll
 		${MementoSectionEnd}
 	SectionGroupEnd
 	SectionGroup &quot;Audio Encoders&quot; SecGrpAudioEncoder
@@ -276,50 +341,50 @@
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_faac.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_faac.dll
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\libfaac.dll
+			${File} libfaac.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;LAME (MP3)&quot; SecAudEncLame
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_lame.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_lame.dll
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\libmp3lame-0.dll
+			${File} libmp3lame-0.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;libavcodec (AC-3)&quot; SecAudEncLavAc3
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_lav_ac3.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_lav_ac3.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;libavcodec (MP2)&quot; SecAudEncLavMp2
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_lav_mp2.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_lav_mp2.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;libvorbis (Vorbis)&quot; SecAudEncVorbis
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_vorbis.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_vorbis.dll
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\vorbis.dll
-			File ${BUILDDIR}\vorbisenc.dll
+			${File} vorbis.dll
+			${File} vorbisenc.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;PCM&quot; SecAudEncPcm
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_pcm.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_pcm.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;TwoLAME (MP2)&quot; SecAudEncTwoLame
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\audioEncoders
-			File ${BUILDDIR}\lib\ADM_plugins\audioEncoders\libADM_ae_twolame.dll
+			${File} lib\ADM_plugins\audioEncoders\libADM_ae_twolame.dll
 		${MementoSectionEnd}
 	SectionGroupEnd
 	SectionGroup &quot;Video Encoders&quot; SecGrpVideoEncoder
@@ -327,39 +392,39 @@
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\videoEncoder
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\libADM_vidEnc_x264.dll
+			${File} lib\ADM_plugins\videoEncoder\libADM_vidEnc_x264.dll
 			SetOutPath $INSTDIR\lib\ADM_plugins\videoEncoder\x264
 			!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\x264\libADM_vidEnc_x264_Gtk.dll
+			${File} lib\ADM_plugins\videoEncoder\x264\libADM_vidEnc_x264_Gtk.dll
 CheckQt4:
 			!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\x264\libADM_vidEnc_x264_Qt.dll
+			${File} lib\ADM_plugins\videoEncoder\x264\libADM_vidEnc_x264_Qt.dll
 End:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\x264\x264Param.xsd
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\x264\*.xml
+			${File} lib\ADM_plugins\videoEncoder\x264\x264Param.xsd
+			${File} lib\ADM_plugins\videoEncoder\x264\*.xml
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\libx264-*.dll
+			${File} libx264-*.dll
 		${MementoSectionEnd}
 		${MementoSection} &quot;Xvid (MPEG-4 ASP)&quot; SecVidEncXvid
 			SectionIn 1 2
 			SetOverwrite on
 			SetOutPath $INSTDIR\lib\ADM_plugins\videoEncoder
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\libADM_vidEnc_xvid.dll
+			${File} lib\ADM_plugins\videoEncoder\libADM_vidEnc_xvid.dll
 SetOutPath $INSTDIR\lib\ADM_plugins\videoEncoder\xvid
 			!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\xvid\libADM_vidEnc_Xvid_Gtk.dll
+			${File} lib\ADM_plugins\videoEncoder\xvid\libADM_vidEnc_Xvid_Gtk.dll
 CheckQt4:
 			!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\xvid\libADM_vidEnc_Xvid_Qt.dll
+			${File} lib\ADM_plugins\videoEncoder\xvid\libADM_vidEnc_Xvid_Qt.dll
 End:
-			File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\xvid\XvidParam.xsd
-			#File ${BUILDDIR}\lib\ADM_plugins\videoEncoder\xvid\*.xml
+			${File} lib\ADM_plugins\videoEncoder\xvid\XvidParam.xsd
+			#${File} lib\ADM_plugins\videoEncoder\xvid\*.xml
 			SetOutPath $INSTDIR
-			File ${BUILDDIR}\xvidcore.dll
+			${File} xvidcore.dll
 		${MementoSectionEnd}
 	SectionGroupEnd
 	SectionGroup &quot;Video Filters&quot; SecGrpVideoFilter
@@ -368,7 +433,7 @@
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_addborders.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_addborders.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Avisynth Resize&quot; SecVidFltAvisynthResize
 				SectionIn 1 2
@@ -377,18 +442,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_avisynthResize_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_avisynthResize_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_avisynthResize_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_avisynthResize_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Blacken Borders&quot; SecVidFltBlackenBorders
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_blackenBorders.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_blackenBorders.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Crop&quot; SecVidFltCrop
 				SectionIn 1 2
@@ -397,18 +462,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Crop_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Crop_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_crop_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_crop_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Fade&quot; SecVidFltFade
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_fade.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_fade.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;MPlayer Resize&quot; SecVidFltMplayerResize
 				SectionIn 1 2
@@ -417,36 +482,36 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mplayerResize_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mplayerResize_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mplayerResize_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mplayerResize_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Resample FPS&quot; SecVidFltResampleFps
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_resampleFps.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_resampleFps.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Reverse&quot; SecVidFltReverse
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_reverse.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_reverse.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Rotate&quot; SecVidFltRotate
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_rotate.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_rotate.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Vertical Flip&quot; SecVidFltVerticalFlip
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_vflip.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_vflip.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup &quot;Interlacing Filters&quot; SecGrpVideoFilterInterlacing
@@ -454,157 +519,157 @@
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_decimate.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_decimate.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Decomb Telecide&quot; SecVidFltDecombTelecide
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_telecide.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_telecide.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Deinterlace&quot; SecVidFltDeinterlace
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Deinterlace.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Deinterlace.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;DG Bob&quot; SecVidFltDbGob
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_blendDgBob.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_blendDgBob.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Drop&quot; SecVidFltDrop
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_dropOut.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_dropOut.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Fade&quot; SecVidFltFadeInterlace
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_separateField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_separateField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Gauss Smooth&quot; SecVidFltGaussSmooth
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutiongauss.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutiongauss.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Keep Even Fields&quot; SecVidFltKeepEvenFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_keepEvenField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_keepEvenField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Keep Odd Fields&quot; SecVidFltKeepOddFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_keepOddField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_keepOddField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;KernelDeint&quot; SecVidFltKernelDeint
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_kernelDeint.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_kernelDeint.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;libavcodec Deinterlacer&quot; SecVidFltLavDeinterlacer
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_lavDeinterlace.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_lavDeinterlace.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;mcDeint&quot; SecVidFltMcDeint
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mcdeint.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mcdeint.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Mean&quot; SecVidFltMean
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionmean.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionmean.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Median&quot; SecVidFltMedian
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionmedian.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionmedian.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Merge Fields&quot; SecVidFltMergeFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mergeField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mergeField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;PAL Field Shift&quot; SecVidFltPalFieldShift
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_palShift.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_palShift.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;PAL Smart Field Shift&quot; SecVidFltPalSmartFieldShift
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_smartPalShift.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_smartPalShift.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Pulldown&quot; SecVidFltPulldown
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Pulldown.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Pulldown.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Separate Fields&quot; SecVidFltSeparateFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_hzStackField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_hzStackField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Sharpen&quot; SecVidFltSharpen
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionsharpen.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_fastconvolutionsharpen.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Smart Swap Fields&quot; SecVidFltSmartSwapFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_smartSwapField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_smartSwapField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Stack Fields&quot; SecVidFltStackFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_stackField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_stackField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Swap Fields&quot; SecVidFltSwapFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_swapField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_swapField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;TDeint&quot; SecVidFltTDeint
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_tdeint.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_tdeint.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Unstack Fields&quot; SecVidFltUnstackFields
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_unstackField.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_unstackField.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;yadif&quot; SecVidFltYadif
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_yadif.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_yadif.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup &quot;Colour Filters&quot; SecGrpVideoFilterColour
@@ -615,18 +680,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_colorYUV_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_colorYUV_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_colorYUV_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_colorYUV_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Blend Removal&quot; SecVidFltBlendRemoval
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_blendRemoval.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_blendRemoval.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Chroma Shift&quot; SecVidFltChromaShift
 				SectionIn 1 2
@@ -635,24 +700,24 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_chromaShift_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_chromaShift_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_chromaShift_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_chromaShift_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Chroma U&quot; SecVidFltChromaU
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vidChromaU.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vidChromaU.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Chroma V&quot; SecVidFltChromaV
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vidChromaV.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vidChromaV.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Contrast&quot; SecVidFltContrast
 				SectionIn 1 2
@@ -661,18 +726,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_contrast_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_contrast_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_contrast_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_contrast_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Luma Delta&quot; SecVidFltLumaDelta
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Delta.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Delta.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Luma Equaliser&quot; SecVidFltLumaEqualiser
 				SectionIn 1 2
@@ -681,18 +746,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_equalizer_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_equalizer_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_equalizer_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_equalizer_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Luma Only&quot; SecVidFltLumaOnly
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_lumaonly.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_lumaonly.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Mplayer Eq2&quot; SecVidFltMPlayerEq2
 				SectionIn 1 2
@@ -701,11 +766,11 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_eq2_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_eq2_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_eq2_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_eq2_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Mplayer Hue&quot; SecVidFltMPlayerHue
@@ -715,18 +780,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_hue_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_hue_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_hue_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_hue_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Swap U and V&quot; SecVidFltSwapUandV
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_swapuv.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_swapuv.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup &quot;Noise Filters&quot; SecGrpVideoFilterNoise
@@ -737,66 +802,66 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_cnr2_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_cnr2_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_cnr2_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_cnr2_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Denoise&quot; SecVidFltDenoise
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Denoise.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Denoise.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;FluxSmooth&quot; SecVidFltFluxSmooth
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_FluxSmooth.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_FluxSmooth.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Forced Post-processing&quot; SecVidFltForcedPostProcessing
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_forcedPP.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_forcedPP.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Light Denoiser&quot; SecVidFltLightDenoiser
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Stabilize.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Stabilize.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Median (5x5)&quot; SecVidFltMediam5x5
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_largemedian.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_largemedian.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;MPlayer Denoise3d&quot; SecVidFltMPlayerDenoise3d
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_denoise3d.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_denoise3d.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;MPlayer Hqdn3d&quot; SecVidFltMPlayerHqdn3d
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_denoise3dhq.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_denoise3dhq.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Temporal Cleaner&quot; SecVidFltTemporalCleaner
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_vlad.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_vlad.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;TIsophote&quot; SecVidFltTisophote
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Tisophote.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Tisophote.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup &quot;Sharpness Filters&quot; SecGrpVideoFilterSharpness
@@ -807,30 +872,30 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_asharp_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_asharp_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_asharp_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_asharp_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;MSharpen&quot; SecVidFltMSharpen
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mSharpen.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mSharpen.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;MSmooth&quot; SecVidFltMSmooth
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mSmooth.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mSmooth.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Soften&quot; SecVidFltSoften
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_soften.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_soften.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 		SectionGroup &quot;Subtitle Filters&quot; SecGrpVideoFilterSubtitle
@@ -838,7 +903,7 @@
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_ssa.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_ssa.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;Subtitler&quot; SecVidFltSubtitler
 				SectionIn 1 2
@@ -847,11 +912,11 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_sub_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_sub_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_sub_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_sub_qt4.dll
 End:
 			${MementoSectionEnd}
 		SectionGroupEnd
@@ -860,7 +925,7 @@
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Mosaic.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Mosaic.dll
 			${MementoSectionEnd}
 			${MementoSection} &quot;MPlayer Delogo&quot; SecVidFltMPlayerDelogo
 				SectionIn 1 2
@@ -869,18 +934,18 @@
 
 				!insertmacro SectionFlagIsSet ${SecUiGtk} ${SF_SELECTED} InstallGtk CheckQt4
 InstallGtk:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mpdelogo_gtk.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mpdelogo_gtk.dll
 CheckQt4:
 				!insertmacro SectionFlagIsSet ${SecUiQt4} ${SF_SELECTED} InstallQt4 End
 InstallQt4:
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_mpdelogo_qt4.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_mpdelogo_qt4.dll
 End:
 			${MementoSectionEnd}
 			${MementoSection} &quot;Whirl&quot; SecVidFltWhirl
 				SectionIn 1 2
 				SetOverwrite on
 				SetOutPath $INSTDIR\lib\ADM_plugins\videoFilter
-				File ${BUILDDIR}\lib\ADM_plugins\videoFilter\libADM_vf_Whirl.dll
+				${File} lib\ADM_plugins\videoFilter\libADM_vf_Whirl.dll
 			${MementoSectionEnd}
 		SectionGroupEnd
 	SectionGroupEnd
@@ -955,8 +1020,8 @@
     SectionIn 2
     SetOutPath $INSTDIR
     SetOverwrite on
-    File /r ${BUILDDIR}\avsproxy.exe
-    File /r ${BUILDDIR}\avsproxy_gui.exe
+    ${File} avsproxy.exe
+    ${File} avsproxy_gui.exe
 ${MementoSectionEnd}
 
 ${MementoSection} &quot;-Start menu Change Log&quot; SecStartMenuChangeLog
@@ -1026,164 +1091,46 @@
     WriteRegDWORD HKLM &quot;${UNINST_REGKEY}&quot; NoRepair 1
 SectionEnd
 
-##########################
-# Uninstaller sections
-##########################
-Section /o &quot;un.AvsProxy&quot; UnSecAvsProxy
-    Delete /REBOOTOK $INSTDIR\avsproxy.exe
-    Delete /REBOOTOK $INSTDIR\avsproxy_gui.exe
+Section -CloseLogFile
+	FileClose $UninstallLogHandle
+	SetFileAttributes ${UninstallLogPath} HIDDEN
 SectionEnd
-
-Section /o un.Catalan UnSecLangCatalan
-	!insertmacro UninstallLanguage Catalan ca
-SectionEnd
-
-Section /o un.Czech UnSecLangCzech
-	!insertmacro UninstallLanguage Czech cs
-SectionEnd
-
-Section /o un.French UnSecLangFrench
-	!insertmacro UninstallLanguage French fr
-SectionEnd
-
-Section /o un.German UnSecLangGerman
-	!insertmacro UninstallLanguage German de
-SectionEnd
-
-Section /o un.Greek UnSecLangGreek
-	!insertmacro UninstallLanguage Greek el
-SectionEnd
-
-Section /o un.Italian UnSecLangItalian
-	!insertmacro UninstallLanguage Italian it
-SectionEnd
-
-Section /o un.Japanese UnSecLangJapanese
-	!insertmacro UninstallLanguage Japanese ja
-SectionEnd
-
-Section /o un.Russian UnSecLangRussian
-	!insertmacro UninstallLanguage Russian ru
-SectionEnd
-
-Section /o un.Serbian UnSecLangSerbianCyrillic
-	!insertmacro UninstallLanguage SerbianCyrillic sr
-SectionEnd
-
-Section /o un.SerbianLatin UnSecLangSerbianLatin
-	!insertmacro UninstallLanguage SerbianLatin <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">sr at latin</A>
-SectionEnd
-
-Section /o un.Spanish UnSecLangSpanish
-	!insertmacro UninstallLanguage Spanish es
-SectionEnd
-
-Section /o un.Turkish UnSecLangTurkish
-	!insertmacro UninstallLanguage Turkish tr
-SectionEnd
-
-Section /o un.GTK+ UnSecUiGtk
-	Delete /REBOOTOK $INSTDIR\libtiff3.dll
-	Delete /REBOOTOK $INSTDIR\libpng12-0.dll
-    Delete /REBOOTOK $INSTDIR\libpangowin32-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libpangocairo-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libpango-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgio-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libglib-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgtk-win32-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgthread-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgobject-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgmodule-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgdk-win32-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libgdk_pixbuf-2.0-0.dll
-    Delete /REBOOTOK $INSTDIR\libcairo-2.dll
-    Delete /REBOOTOK $INSTDIR\libatk-1.0-0.dll
-    Delete /REBOOTOK $INSTDIR\jpeg62.dll
-    Delete /REBOOTOK $INSTDIR\gtk2_prefs.exe
-    Delete /REBOOTOK $INSTDIR\avidemux2_gtk.exe
-    RmDir /r /REBOOTOK $INSTDIR\share\themes
-    RmDir /r /REBOOTOK $INSTDIR\lib\gtk-2.0
-    RmDir /r /REBOOTOK $INSTDIR\etc\gtk-2.0
-    RmDir /r /REBOOTOK $INSTDIR\etc\pango
-SectionEnd
-
-Section /o un.Qt4 UnSecUiQt4
-    Delete /REBOOTOK $INSTDIR\QtCore4.dll
-    Delete /REBOOTOK $INSTDIR\mingwm10.dll
-    Delete /REBOOTOK $INSTDIR\avidemux2_qt4.exe
-    Delete /REBOOTOK $INSTDIR\QtGui4.dll
-SectionEnd
-
-Section /o &quot;un.Command line&quot; UnSecUiCli
-    Delete /REBOOTOK $INSTDIR\avidemux2_cli.exe
-SectionEnd
-
-Section /o &quot;un.Core files (required)&quot; UnSecCore
-    Delete /REBOOTOK $INSTDIR\xvidcore.dll
-    Delete /REBOOTOK $INSTDIR\xmltok.dll
-    Delete /REBOOTOK $INSTDIR\vorbisenc.dll
-    Delete /REBOOTOK $INSTDIR\vorbis.dll
-    Delete /REBOOTOK $INSTDIR\SDL.dll
-    Delete /REBOOTOK $INSTDIR\pthreadGC2.dll
-    Delete /REBOOTOK $INSTDIR\ogg.dll
-    Delete /REBOOTOK $INSTDIR\libxml2.dll
-    Delete /REBOOTOK $INSTDIR\libx264-*.dll
-    Delete /REBOOTOK $INSTDIR\libmp3lame-0.dll
-    Delete /REBOOTOK $INSTDIR\libfontconfig-1.dll
-    Delete /REBOOTOK $INSTDIR\libfaad2.dll
-    Delete /REBOOTOK $INSTDIR\libfaac.dll
-    Delete /REBOOTOK $INSTDIR\libexpat-*.dll
-    Delete /REBOOTOK $INSTDIR\libaften.dll
-    Delete /REBOOTOK $INSTDIR\intl.dll
-    Delete /REBOOTOK $INSTDIR\iconv.dll
-    Delete /REBOOTOK $INSTDIR\freetype6.dll
-    Delete /REBOOTOK $INSTDIR\zlib1.dll
-    Delete /REBOOTOK &quot;$INSTDIR\Build Info.txt&quot;
-    Delete /REBOOTOK &quot;$INSTDIR\Change Log.html&quot;
-    Delete /REBOOTOK &quot;$INSTDIR\stdout.txt&quot;
-    Delete /REBOOTOK &quot;$INSTDIR\stderr.txt&quot;
-    RmDir /r /REBOOTOK $INSTDIR\etc\fonts
-
-    RmDir /REBOOTOK $INSTDIR\share\gettext
-    RmDir /REBOOTOK $INSTDIR\share
-SectionEnd
-
-Section /o &quot;un.Start menu&quot; UnSecStartMenu
-    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Change Log.lnk&quot;
+ 
+Section Uninstall
+	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup	
+	
+	Delete /REBOOTOK &quot;$QUICKLAUNCH\${INTERNALNAME} GTK+.lnk&quot;
+    Delete /REBOOTOK &quot;$QUICKLAUNCH\${INTERNALNAME} Qt4.lnk&quot;
+    Delete /REBOOTOK &quot;$DESKTOP\${INTERNALNAME} GTK+.lnk&quot;
+    Delete /REBOOTOK &quot;$DESKTOP\${INTERNALNAME} Qt4.lnk&quot;
+	Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Change Log.lnk&quot;
     Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} GTK+.lnk&quot;
     Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\${INTERNALNAME} Qt4.lnk&quot;
     Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\AVS Proxy GUI.lnk&quot;
-SectionEnd
-
-Section /o &quot;un.Quick Launch&quot; UnSecQuickLaunch
-    Delete /REBOOTOK &quot;$QUICKLAUNCH\${INTERNALNAME} GTK+.lnk&quot;
-    Delete /REBOOTOK &quot;$QUICKLAUNCH\${INTERNALNAME} Qt4.lnk&quot;
-SectionEnd
-
-Section /o &quot;un.Desktop&quot; UnSecDesktop
-    Delete /REBOOTOK &quot;$DESKTOP\${INTERNALNAME} GTK+.lnk&quot;
-    Delete /REBOOTOK &quot;$DESKTOP\${INTERNALNAME} Qt4.lnk&quot;
-SectionEnd
-
-Section un.post UnSecUninstaller
-    RmDir /REBOOTOK $INSTDIR\etc
-    RmDir /REBOOTOK $INSTDIR\i18n
-    RmDir /REBOOTOK $INSTDIR\lib
-    RmDir /REBOOTOK $INSTDIR\share\locale
-    RmDir /REBOOTOK $INSTDIR\share
+    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup
+    DeleteRegValue HKLM &quot;${REGKEY}&quot; StartMenuGroup
     
     DeleteRegKey HKLM &quot;${UNINST_REGKEY}&quot;
-    Delete /REBOOTOK $INSTDIR\uninstall.exe
-    DeleteRegValue HKLM &quot;${REGKEY}&quot; StartMenuGroup
     DeleteRegValue HKLM &quot;${REGKEY}&quot; Path
     DeleteRegKey /IfEmpty HKLM &quot;${REGKEY}&quot;
-    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup
-    RmDir /REBOOTOK $INSTDIR
-    Push $R0
-    StrCpy $R0 $StartMenuGroup 1
-    StrCmp $R0 &quot;&gt;&quot; no_smgroup
-no_smgroup:
+
+	FileOpen $UninstallLogHandle &quot;${UninstallLogPath}&quot; r
+UninstallLoop:
+    ClearErrors
+    FileRead $UninstallLogHandle $R0
+    IfErrors UninstallEnd
+	Push $R0
+    Call un.TrimNewLines
     Pop $R0
+    Delete &quot;$R0&quot;
+    Goto UninstallLoop
+UninstallEnd:
+	FileClose $UninstallLogHandle
+	Delete &quot;${UninstallLogPath}&quot;
+	Delete &quot;$INSTDIR\uninstall.exe&quot;
+	Push &quot;\&quot;
+	Call un.RemoveEmptyDirs
+	RMDir &quot;$INSTDIR&quot;
 SectionEnd
 
 ##########################
@@ -1204,6 +1151,7 @@
     InitPluginsDir
 
     ${MementoSectionRestore}
+    SetShellVarContext all
 	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
 
 #checkStartMenuGtk:
@@ -1397,7 +1345,7 @@
     IntOp $0 $0 &amp; ${SF_SELECTED}
 
     StrCmp $0 ${SF_SELECTED} 0 End
-        Exec &quot;$INSTDIR\avidemux2_gtk.exe&quot;    
+        Exec &quot;$INSTDIR\avidemux2_gtk.exe&quot;
 
 end:
 FunctionEnd
@@ -1406,6 +1354,58 @@
 # Uninstaller functions
 ##########################
 Function un.onInit
-    ReadRegStr $INSTDIR HKLM &quot;${REGKEY}&quot; Path
-    !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
+	!insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup
+	SetShellVarContext all
 FunctionEnd
+
+; TrimNewlines (copied from NSIS documentation)
+; input, top of stack  (e.g. whatever$\r$\n)
+; output, top of stack (replaces, with e.g. whatever)
+; modifies no other variables.
+Function un.TrimNewlines
+	Exch $R0
+	Push $R1
+	Push $R2
+	StrCpy $R1 0
+
+loop:
+	IntOp $R1 $R1 - 1
+	StrCpy $R2 $R0 1 $R1
+	StrCmp $R2 &quot;$\r&quot; loop
+	StrCmp $R2 &quot;$\n&quot; loop
+	IntOp $R1 $R1 + 1
+	IntCmp $R1 0 no_trim_needed
+	StrCpy $R0 $R0 $R1
+
+no_trim_needed:
+	Pop $R2
+	Pop $R1
+	Exch $R0
+FunctionEnd
+ 
+Function un.RemoveEmptyDirs
+	Pop $9
+	!define Index 'Line${__LINE__}'
+	FindFirst $0 $1 &quot;$INSTDIR$9*&quot;
+	StrCmp $0 &quot;&quot; &quot;${Index}-End&quot;
+&quot;${Index}-Loop:&quot;
+	StrCmp $1 &quot;&quot; &quot;${Index}-End&quot;
+	StrCmp $1 &quot;.&quot; &quot;${Index}-Next&quot;
+	StrCmp $1 &quot;..&quot; &quot;${Index}-Next&quot;
+	Push $0
+	Push $1
+	Push $9
+	Push &quot;$9$1\&quot;
+	Call un.RemoveEmptyDirs
+	Pop $9
+	Pop $1
+	Pop $0
+;&quot;${Index}-Remove:&quot;
+	RMDir &quot;$INSTDIR$9$1&quot;
+&quot;${Index}-Next:&quot;
+	FindNext $0 $1
+	Goto &quot;${Index}-Loop&quot;
+&quot;${Index}-End:&quot;
+	FindClose $0
+	!undef Index
+FunctionEnd


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001811.html">[Avidemux-svn-commit] r4581 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows:	build_scripts/avidemux build_scripts/avidemux/Tools installer
</A></li>
	<LI>Next message: <A HREF="001813.html">[Avidemux-svn-commit] r4583 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/ADM_coreDemuxerMpeg/include	avidemux/ADM_coreDemuxerMpeg/src plugins/ADM_demuxers/MpegPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1812">[ date ]</a>
              <a href="thread.html#1812">[ thread ]</a>
              <a href="subject.html#1812">[ subject ]</a>
              <a href="author.html#1812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
