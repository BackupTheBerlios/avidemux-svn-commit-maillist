<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r4605 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/ADM_audio avidemux/ADM_coreAudio/src	avidemux/ADM_coreUI/include avidemux/ADM_coreUI/src	avidemux/ADM_editor avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	plugins/ADM_demuxers/MpegPS
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4605%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/ADM_audio%20avidemux/ADM_coreAudio/src%0A%09avidemux/ADM_coreUI/include%20avidemux/ADM_coreUI/src%0A%09avidemux/ADM_editor%20avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09plugins/ADM_demuxers/MpegPS&In-Reply-To=%3C200902151434.n1FEYMce024168%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001834.html">
   <LINK REL="Next"  HREF="001836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r4605 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/ADM_audio avidemux/ADM_coreAudio/src	avidemux/ADM_coreUI/include avidemux/ADM_coreUI/src	avidemux/ADM_editor avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	plugins/ADM_demuxers/MpegPS</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r4605%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux%20avidemux/ADM_audio%20avidemux/ADM_coreAudio/src%0A%09avidemux/ADM_coreUI/include%20avidemux/ADM_coreUI/src%0A%09avidemux/ADM_editor%20avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09plugins/ADM_demuxers/MpegPS&In-Reply-To=%3C200902151434.n1FEYMce024168%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r4605 - in branches/avidemux_2.6_branch_mean:	avidemux avidemux/ADM_audio avidemux/ADM_coreAudio/src	avidemux/ADM_coreUI/include avidemux/ADM_coreUI/src	avidemux/ADM_editor avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog	plugins/ADM_demuxers/MpegPS">mean at mail.berlios.de
       </A><BR>
    <I>Sun Feb 15 15:34:22 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001834.html">[Avidemux-svn-commit] r4604 -	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
</A></li>
        <LI>Next message: <A HREF="001836.html">[Avidemux-svn-commit] r4606 - in	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers:	Matroska OpenDml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1835">[ date ]</a>
              <a href="thread.html#1835">[ thread ]</a>
              <a href="subject.html#1835">[ subject ]</a>
              <a href="author.html#1835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2009-02-15 15:34:21 +0100 (Sun, 15 Feb 2009)
New Revision: 4605

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audio/audiotimeline.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudio/src/ADM_audioStreamMP3.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/include/DIA_working.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/src/DIA_working.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/toolkit_dialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gui_blackframes.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
Log:
[QT4] Finish the DIA_working + call createWorking rather than using dummy middleman class

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audio/audiotimeline.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audio/audiotimeline.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audio/audiotimeline.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -73,9 +73,9 @@
 
       ADM_assert(_audioMap);
 
-      DIA_working *work;
+      DIA_workingBase *work;
 
-      work=new DIA_working(QT_TR_NOOP(&quot;Building VBR map&quot;));
+      work=createWorking(QT_TR_NOOP(&quot;Building VBR map&quot;));
 
       goTo(0);
       uint32_t Mul=2*_wavheader-&gt;channels;
@@ -86,7 +86,7 @@
 				if(!work-&gt;isAlive())
 				{
 					delete work;
-					work=new DIA_working(QT_TR_NOOP(&quot;Building VBR map&quot;));
+					work=createWorking(QT_TR_NOOP(&quot;Building VBR map&quot;));
 					work-&gt;update(offset,_length);
 				}
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudio/src/ADM_audioStreamMP3.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudio/src/ADM_audioStreamMP3.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudio/src/ADM_audioStreamMP3.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -133,7 +133,7 @@
 {
 uint32_t size;
 uint64_t newDts,pos;
-DIA_working *work=new DIA_working(&quot;Building time map&quot;);
+DIA_workingBase *work=createWorking(&quot;Building time map&quot;);
     
     ADM_assert(access-&gt;canSeekOffset()==true);
     access-&gt;setPos(0);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/include/DIA_working.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/include/DIA_working.h	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/include/DIA_working.h	2009-02-15 14:34:21 UTC (rev 4605)
@@ -1,12 +1,11 @@
 /***************************************************************************
-                          DIA_working.cpp  -  description
-                             -------------------
-    begin                : Thu Apr 21 2003
-    copyright            : (C) 2003 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+    \fn DIA_working.cpp 
+    \brief UI that handles working state with cancel &amp; percent
 
-	This class deals with the working window
+    copyright            : (C) 2003/2009 by mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
 
+
+
  ***************************************************************************/
 
 /***************************************************************************
@@ -21,38 +20,46 @@
 #ifndef __DIA_WK__
 #define __DIA_WK__
 #include &quot;ADM_clock.h&quot;
-	class DIA_workingBase
-	{
-		protected :
-				uint32_t 	lastper;
-				Clock	    _clock;
-				uint32_t	_nextUpdate;
-				uint32_t 	elapsed;
-				
-		public:
-				void 		*_priv;
-                            DIA_workingBase( const char *title=NULL ) {};
-				virtual		~DIA_workingBase(){};
-				// If returns 1 -&gt; Means aborted
-				virtual uint8_t  	update(uint32_t percent) {ADM_assert(0);}
-				virtual uint8_t 	update(uint32_t current,uint32_t total){ADM_assert(0);};
-				virtual uint8_t  	isAlive (void ){ADM_assert(0);};
-				
-	};
-
-    class DIA_working : public DIA_workingBase
-    {
+/**
+    \class DIA_workingBase
+*/
+class DIA_workingBase
+{
+    protected :
+            uint32_t 	lastper;
+            Clock	    _clock;
+            uint32_t	_nextUpdate;
+            uint32_t 	elapsed;
+            
+    public:
+            void 		*_priv;
+                        DIA_workingBase( const char *title=NULL ) {};
+            virtual		~DIA_workingBase(){};
+            // If returns 1 -&gt; Means aborted
+            virtual uint8_t  	update(uint32_t percent) {ADM_assert(0);}
+            virtual uint8_t 	update(uint32_t current,uint32_t total){ADM_assert(0);};
+            virtual uint8_t  	isAlive (void ){ADM_assert(0);};
+            
+};
+/**
+    \class DIA_working
+*/
+#if 0
+class DIA_working : public DIA_workingBase
+{
 protected:
-                    void        *son;
-            
+                void        *son;
+        
 public:
-                                DIA_working( const char *title=NULL );
-            virtual		        ~DIA_working();
-				// If returns 1 -&gt; Means aborted
-			virtual uint8_t  	update(uint32_t percent);
-            virtual uint8_t 	update(uint32_t current,uint32_t total);
-            virtual uint8_t  	isAlive (void );
-            
-    };
+                            DIA_working( const char *title=NULL );
+        virtual		        ~DIA_working();
+            // If returns 1 -&gt; Means aborted
+        virtual uint8_t  	update(uint32_t percent);
+        virtual uint8_t 	update(uint32_t current,uint32_t total);
+        virtual uint8_t  	isAlive (void );
+        
+};
+#endif
+DIA_workingBase *createWorking(const char *title);
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/src/DIA_working.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/src/DIA_working.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUI/src/DIA_working.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -20,7 +20,7 @@
 
 #define SON ((DIA_workingBase *)son)
 #include &quot;DIA_coreUI_internal.h&quot;
-
+#if 0
 extern DIA_workingBase *createWorking(const char *title);
 /**
     \fn DIA_working
@@ -65,3 +65,4 @@
     if(son) return SON-&gt;isAlive();
     return 0;
 }
+#endif
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -86,9 +86,9 @@
 	{
 		frames+=_videos[i]._nb_video_frames;
 	}
-	DIA_working *work;
-        uint8_t nocopy;
-	work=new DIA_working(QT_TR_NOOP(&quot;Rebuilding Frames&quot;));
+	DIA_workingBase *work;
+    uint8_t nocopy;
+	work=createWorking(QT_TR_NOOP(&quot;Rebuilding Frames&quot;));
 
 
 	for(uint32_t vid=0;vid&lt;_nb_video;vid++)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -213,7 +213,7 @@
 
 	if (shutdownRequired &amp;&amp; !stopReq)
 	{
-		DIA_working *work=new DIA_working(QT_TR_NOOP(&quot;Shutting down&quot;));
+		DIA_workingBase *work=createWorking(QT_TR_NOOP(&quot;Shutting down&quot;));
 		bool performShutdown=true;
 
 		for(int i = 0; i &lt;= 30; i++)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_working.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -36,11 +36,11 @@
 
 void on_work_abort(GtkObject * object, gpointer user_data)
 {
-DIA_working *dial;
+DIA_workingBase *dial;
 GtkWidget *dialog;
 
 	UNUSED_ARG(object);
-	dial=(DIA_working *)user_data;
+	dial=(DIA_workingBase *)user_data;
 	dialog=(GtkWidget *)dial-&gt;_priv;
         gtk_unregister_dialog(dialog);
 	gtk_widget_destroy(dialog);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/toolkit_dialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/toolkit_dialog.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/toolkit_dialog.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -364,8 +364,8 @@
 		&amp;ADM_GtkCoreUIToolkit::GUI_Verbose,
 		&amp;ADM_GtkCoreUIToolkit::GUI_Quiet,
 		&amp;ADM_GtkCoreUIToolkit::GUI_isQuiet,
-        &amp;ADM_GtkCoreUIToolkit::createWorking,
-        &amp;ADM_GtkCoreUIToolkit::createEncodingGtk
+        &amp;ADM_GtkCoreUIToolkit::createWorking
+        // &amp;ADM_GtkCoreUIToolkit::createEncodingQt4
 };
 
 void InitCoreToolkit(void )

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/CMakeLists.txt	2009-02-15 14:34:21 UTC (rev 4605)
@@ -1,11 +1,14 @@
 SET(ADM_LIB ADM_dialogQt4)
 
-SET(uiFiles
-	about.ui  
+SET(    
+        uiFiles
+        about.ui  
         calculator.ui  
 #encoding.ui  
         license.ui
-	jobs.ui  props.ui  vobsub.ui  working.ui)
+        jobs.ui  
+        props.ui  vobsub.ui  
+        working.ui)
 
 SET(headers
 	Q_about.h  Q_calculator.h  
@@ -17,16 +20,20 @@
 QT4_ADD_RESOURCES(${ADM_LIB}_resource  about.qrc)
 
 SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS}
-	${${ADM_LIB}_headers}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource}  Q_about.cpp  
-#	Q_calculator.cpp  
-#Q_encoding.cpp  
+	${${ADM_LIB}_headers}  ${${ADM_LIB}_source}  ${${ADM_LIB}_resource}  
+        Q_about.cpp  
         Q_license.cpp
-	Q_jobs.cpp  Q_props.cpp   
-#Q_vobsub.cpp  
-#Q_working.cpp   
+        Q_jobs.cpp  Q_props.cpp   
+        Q_working.cpp   
         T_index_pg.cpp
-	alert_qt4.cpp  DIA_busy.cpp  DIA_none.cpp  
-#DIA_xvid4.cpp  OCR_none.cpp
+        alert_qt4.cpp  
+        DIA_busy.cpp  
+        DIA_none.cpp  
+#DIA_xvid4.cpp  OCR_none.cpp
+#Q_vobsub.cpp  
+#Q_calculator.cpp  
+#Q_encoding.cpp  
+
 )
 
 ADD_DEFINITIONS(-DADM_SUBVERSION=${ADM_SUBVERSION})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -26,29 +26,48 @@
  }
 //*******************************************
 
-DIA_working::DIA_working( void )
+namespace ADM_Qt4CoreUIToolkit
 {
-  workWindow *wind;
-  wind=new workWindow();
-  _priv=(void *)wind;
-  postCtor();
-}
-DIA_working::DIA_working( const char *title )
+
+class DIA_workingQt4 : public DIA_workingBase
 {
+protected:
+        virtual void 	    postCtor( void ) ;
+public:
+                            DIA_workingQt4( const char *title=NULL );
+        virtual		        ~DIA_workingQt4();
+            // If returns 1 -&gt; Means aborted
+        virtual uint8_t  	update(uint32_t percent);
+        virtual uint8_t 	update(uint32_t current,uint32_t total);
+        virtual uint8_t  	isAlive (void );
+                void        closeDialog(void);
+        
+};
+
+
+
+
+
+
+/****************************************/
+//*******************************************
+
+DIA_workingQt4::DIA_workingQt4( const char *title ) : DIA_workingBase(title)
+{
   workWindow *wind;
   wind=new workWindow();
   _priv=(void *)wind;
   wind-&gt;setWindowTitle(title);
   postCtor();
 }
-void DIA_working :: postCtor( void )
+void DIA_workingQt4 :: postCtor( void )
 {
   workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
       wind-&gt;show();
       lastper=0;
       _nextUpdate=0;
 }
-uint8_t DIA_working::update(uint32_t percent)
+uint8_t DIA_workingQt4::update(uint32_t percent)
 {
 		#define GUI_UPDATE_RATE 1000
 
@@ -86,7 +105,7 @@
         return 0;
 }
 
-uint8_t DIA_working::update(uint32_t cur, uint32_t total)
+uint8_t DIA_workingQt4::update(uint32_t cur, uint32_t total)
 {
         double d,n;
         uint32_t percent;
@@ -105,23 +124,32 @@
 
 }
 
-uint8_t DIA_working::isAlive (void )
+uint8_t DIA_workingQt4::isAlive (void )
 {
 	if(!_priv) return 0;
 	return 1;
 }
 
-DIA_working::~DIA_working()
+DIA_workingQt4::~DIA_workingQt4()
 {
     closeDialog();
 }
 
-void DIA_working::closeDialog( void )
+void DIA_workingQt4::closeDialog( void )
 {
   workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
     if(wind) delete wind;
     wind=NULL;
 }
+/**
+    \fn createWorking
+*/
+DIA_workingBase *createWorking(const char *title)
+{
+    return new DIA_workingQt4(title);
+}   
 
+
+}
 //********************************************
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -226,6 +226,7 @@
   beQuiet=1;
 }
 //****************************************************************************************************
+extern DIA_workingBase *createWorking(const char *title);
 }
 
 static CoreToolkitDescriptor Qt4CoreToolkitDescriptor=
@@ -238,7 +239,9 @@
 		&amp;ADM_Qt4CoreUIToolkit::GUI_Alternate,
 		&amp;ADM_Qt4CoreUIToolkit::GUI_Verbose,
 		&amp;ADM_Qt4CoreUIToolkit::GUI_Quiet,
-		&amp;ADM_Qt4CoreUIToolkit::GUI_isQuiet
+		&amp;ADM_Qt4CoreUIToolkit::GUI_isQuiet,
+        &amp;ADM_Qt4CoreUIToolkit::createWorking,
+        //&amp;ADM_Qt4CoreUIToolkit::createEncodingQt4
 };
 
 void InitCoreToolkit(void )

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -1167,7 +1167,7 @@
   uint32_t len2;
   uint32_t written, max;
   uint64_t dts;
-  DIA_working *work;
+  DIA_workingBase *work;
   FILE *out;
 
 #define ONE_STRIKE (64*1024)
@@ -1181,7 +1181,7 @@
   out = fopen (name, &quot;wb&quot;);
   if (!out) return;
 
-  work=new DIA_working(QT_TR_NOOP(&quot;Saving audio&quot;));
+  work=createWorking(QT_TR_NOOP(&quot;Saving audio&quot;));
 
   uint32_t timeEnd,timeStart,sample,hold,len;
   uint64_t tgt_sample,cur_sample;
@@ -1291,7 +1291,7 @@
   uint32_t curImg;
   char	 fullName[2048],*ext;
   char *baseName;
-  DIA_working *working;
+  DIA_workingBase *working;
   uint8_t success=0;
 
         if(frameStart&gt;frameEnd)
@@ -1305,7 +1305,7 @@
         src=new ADMImage(avifileinfo-&gt;width,avifileinfo-&gt;height);
         ADM_assert(src);
 
-        working=new DIA_working(QT_TR_NOOP(&quot;Saving as set of jpegs&quot;));
+        working=createWorking(QT_TR_NOOP(&quot;Saving as set of jpegs&quot;));
         for(curImg=frameStart;curImg&lt;=frameEnd;curImg++)
         {
                 working-&gt;update(curImg-frameStart,frameEnd-frameStart);
@@ -1633,7 +1633,7 @@
   FILE *fd, *fi;
   uint8_t *buffer = new uint8_t[avifileinfo-&gt;width * avifileinfo-&gt;height * 3],ret=0;
   char *idx;
-  DIA_working *work;
+  DIA_workingBase *work;
   uint8_t seq;
   idx = new char[strlen (name) + 8];
   strcpy (idx, name);
@@ -1642,7 +1642,7 @@
   fi = fopen (idx, &quot;wt&quot;);
   if (!fd)
     return 0;
-  work=new DIA_working(QT_TR_NOOP(&quot;Saving raw video stream&quot;));
+  work=createWorking(QT_TR_NOOP(&quot;Saving raw video stream&quot;));
   ADMCompressedImage image;
   image.data=buffer;
   image.dataLength=avifileinfo-&gt;width * avifileinfo-&gt;height * 3;
@@ -1788,10 +1788,10 @@
 //uint32_t buf[720*576*2];
 uint32_t error=0;
 ADMImage *aImage;
-DIA_working *work;
+DIA_workingBase *work;
 
 	nb = avifileinfo-&gt;nb_frames;
-	work=new DIA_working(QT_TR_NOOP(&quot;Checking video&quot;));
+	work=createWorking(QT_TR_NOOP(&quot;Checking video&quot;));
 	aImage=new ADMImage(avifileinfo-&gt;width,avifileinfo-&gt;height);
   for(uint32_t i=0;i&lt;nb;i++)
   {

Modified: branches/avidemux_2.6_branch_mean/avidemux/gui_blackframes.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gui_blackframes.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/avidemux/gui_blackframes.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -157,7 +157,7 @@
 
    const int darkness=40;
 
-   DIA_working *work=new DIA_working(QT_TR_NOOP(&quot;Seeking&quot;));
+   DIA_workingBase *work=createWorking(QT_TR_NOOP(&quot;Seeking&quot;));
    orgFrame=curframe;
    int total;
     // Avoid it being 0
@@ -238,7 +238,7 @@
     const int darkness=40;
 
     startframe=curframe;
-    DIA_working *work=new DIA_working(QT_TR_NOOP(&quot;Finding black frames&quot;));
+    DIA_workingBase *work=createWorking(QT_TR_NOOP(&quot;Finding black frames&quot;));
     printf(&quot;\n** Listing all black frames **\n&quot;);
 
     for (f=0; f&lt;avifileinfo-&gt;nb_frames; f++) {

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-02-15 14:34:18 UTC (rev 4604)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegPS/ADM_psIndex.cpp	2009-02-15 14:34:21 UTC (rev 4605)
@@ -24,7 +24,7 @@
 #include &quot;avidemutils.h&quot;
 #include &quot;ADM_quota.h&quot;
 #include &quot;ADM_psAudioProbe.h&quot;
-#include &quot;DIA_encoding.h&quot;
+#include &quot;DIA_working.h&quot;
 
 static const char Type[5]={'X','I','P','B','P'};
 
@@ -88,7 +88,7 @@
         FILE *index;
         psPacketLinearTracker *pkt;
         listOfPsAudioTracks *audioTracks;
-        DIA_encodingBase  *ui;
+        DIA_workingBase  *ui;
 public:
                 PsIndexer(void);
                 ~PsIndexer();
@@ -120,7 +120,7 @@
     index=NULL;
     pkt=NULL;
     audioTracks=NULL;
-    ui=createEncoding (25000);
+    ui=createWorking (&quot;Indexing&quot;);
 }
 
 /**
@@ -224,7 +224,7 @@
                                 float pos=data.startAt;
                                 pos=pos/(float)fullSize;
                                 pos*=100;
-                                ui-&gt;setPercent( (uint32_t)pos);
+                                ui-&gt;update( (uint32_t)pos);
 
                             }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001834.html">[Avidemux-svn-commit] r4604 -	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
</A></li>
	<LI>Next message: <A HREF="001836.html">[Avidemux-svn-commit] r4606 - in	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers:	Matroska OpenDml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1835">[ date ]</a>
              <a href="thread.html#1835">[ thread ]</a>
              <a href="subject.html#1835">[ subject ]</a>
              <a href="author.html#1835">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
