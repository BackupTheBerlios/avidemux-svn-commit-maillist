<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r7281 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-June/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7281%20-%0A%09branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui&In-Reply-To=%3C20110615062324.6E4EE481412%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004434.html">
   <LINK REL="Next"  HREF="004436.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r7281 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui</H1>
    <B>mean at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7281%20-%0A%09branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui&In-Reply-To=%3C20110615062324.6E4EE481412%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r7281 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui">mean at mail.berlios.de
       </A><BR>
    <I>Wed Jun 15 08:23:24 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004434.html">[Avidemux-svn-commit] r7280 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="004436.html">[Avidemux-svn-commit] r7282 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4435">[ date ]</a>
              <a href="thread.html#4435">[ thread ]</a>
              <a href="subject.html#4435">[ subject ]</a>
              <a href="author.html#4435">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2011-06-15 08:23:24 +0200 (Wed, 15 Jun 2011)
New Revision: 7281

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[Q_gui] convert to unix crlf

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-06-15 06:23:22 UTC (rev 7280)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-06-15 06:23:24 UTC (rev 7281)
@@ -1,1205 +1,1205 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &quot;ADM_inttype.h&quot;
-#include &lt;QtCore/QFileInfo&gt;
-#include &lt;QtCore/QUrl&gt;
-#include &lt;QtGui/QKeyEvent&gt;
-#include &lt;QtGui/QGraphicsView&gt;
-
-#define MENU_DECLARE
-#include &quot;Q_gui2.h&quot;
-#include &quot;ADM_default.h&quot;
-
-#include &quot;DIA_fileSel.h&quot;
-#include &quot;ADM_vidMisc.h&quot;
-#include &quot;prefs.h&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_render/GUI_renderInternal.h&quot;
-#include &quot;ADM_coreVideoEncoderInternal.h&quot;
-#include &quot;ADM_muxerProto.h&quot;
-#include &quot;T_vumeter.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-
-extern int global_argc;
-extern char **global_argv;
-
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
-extern int automation(void );
-extern void HandleAction(Action a);
-extern int encoderGetEncoderCount (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-uint32_t audioEncoderGetNumberOfEncoders(void);
-const char  *audioEncoderGetDisplayName(uint32_t i);
-extern void checkCrashFile(void);
-extern void UI_QT4VideoWidget(QFrame *frame);
-extern void loadTranslator(void);
-extern void initTranslator(void);
-extern void destroyTranslator(void);
-extern ADM_RENDER_TYPE UI_getPreferredRender(void);
-extern int A_openAvi(const char *name);
-extern int A_appendAvi(const char *name);
-extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
-
-
-int SliderIsShifted=0;
-static void setupMenus(void);
-static int shiftKeyHeld=0;
-static ADM_QSlider *slider=NULL;
-static int _upd_in_progres=0;
-static int currentFps = 0;
-static int frameCount = 0;
-static int currentFrame = 0;
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
-uint32_t ADM_ve6_getNbEncoders(void);
-void UI_refreshCustomMenu(void);
-QWidget *QuiMainWindows=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-extern void saveCrashProject(void);
-extern uint8_t AVDM_setVolume(int volume);
-extern bool ADM_QPreviewCleanup(void);
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
-
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-
-#include &quot;translation_table.h&quot;   
-
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct 
-{
-	const char *name;
-	Action     action; 
-}adm_qt4_translation;
-
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-	LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-
-int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms);
-void UI_updateFrameCount(uint32_t curFrame);
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-extern void UI_purge(void);
-/*
-    Declare the class that will be our main window
-
-*/
-
-void MainWindow::comboChanged(int z)
-{
-	const char *source=qPrintable(sender()-&gt;objectName());
-
-	if(!strcmp(source,&quot;comboBoxVideo&quot;))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxVideo-&gt;currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonVideoConf-&gt;setEnabled(b);
-		ui.pushButtonVideoFilter-&gt;setEnabled(b);
-		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
-	}
-	else if(!strcmp(source,&quot;comboBoxAudio&quot;))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxAudio-&gt;currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonAudioConf-&gt;setEnabled(b);
-		ui.pushButtonAudioFilter-&gt;setEnabled(b);
-		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
-	}
-	else
-		printf(&quot;From +: %s\n&quot;,source);
-}
-
-void MainWindow::sliderValueChanged(int u) 
-{
-	if(!_upd_in_progres)
-		HandleAction(ACT_Scale);
-}
-
-void MainWindow::sliderMoved(int value)
-{
-	SliderIsShifted = shiftKeyHeld;
-}
-
-void MainWindow::sliderReleased(void)
-{
-	SliderIsShifted = 0;
-}
-
-void MainWindow::thumbSlider_valueEmitted(int value)
-{
-        if (value &gt; 0)
-                nextIntraFrame();
-        else
-                previousIntraFrame();
-}
-
-void MainWindow::volumeChange( int u )
-{
-	if (_upd_in_progres || !ui.toolButtonAudioToggle-&gt;isChecked())
-		return;
-
-	_upd_in_progres++;
-
-	int vol = ui.horizontalSlider_2-&gt;value();
-
-	AVDM_setVolume(vol);
-	_upd_in_progres--;
-}
-
-void MainWindow::audioToggled(bool checked)
-{
-	if (checked)
-		AVDM_setVolume(ui.horizontalSlider_2-&gt;value());
-	else
-		AVDM_setVolume(0);
-}
-
-void MainWindow::previewModeChanged(QAction *action)
-{
-	HandleAction(ACT_PreviewChanged);
-}
-
-void MainWindow::timeChangeFinished(void)
-{
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentFrameChanged(void)
-{
-//	HandleAction(ACT_JumpToFrame);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentTimeChanged(void)
-{
-	HandleAction(ACT_GotoTime);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-/**
-    \fn ctor
-*/
-MainWindow::MainWindow() : QMainWindow()
-{
-	ui.setupUi(this);
-
-#if defined(__APPLE__) &amp;&amp; defined(USE_SDL)
-	ui.actionAbout_avidemux-&gt;setMenuRole(QAction::NoRole);
-	ui.actionPreferences-&gt;setMenuRole(QAction::NoRole);
-	ui.actionQuit-&gt;setMenuRole(QAction::NoRole);
-#endif
-
-	// Preview modes
-	QActionGroup *groupPreviewModes = new QActionGroup(this);
-
-	groupPreviewModes-&gt;addAction(ui.actionPreviewInput);
-	groupPreviewModes-&gt;addAction(ui.actionPreviewOutput);
-	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
-
-	/*
-	Connect our button to buttonPressed
-	*/
-#define PROCESS CONNECT_TB
-	LIST_OF_BUTTONS
-#undef PROCESS
-
-	//ACT_VideoCodecChanged
-	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-
-	// Slider
-	slider=ui.horizontalSlider;
-	slider-&gt;setMinimum(0);
-	slider-&gt;setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
-	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
-	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
-
-   // Thumb slider
-    ui.sliderPlaceHolder-&gt;installEventFilter(this);
-    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
-    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
-
-	// Volume slider
-	QSlider *volSlider=ui.horizontalSlider_2;
-	volSlider-&gt;setMinimum(0);
-	volSlider-&gt;setMaximum(100);
-	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
-
-	// default state
-	bool b=0;
-	ui.pushButtonVideoConf-&gt;setEnabled(b);
-	ui.pushButtonVideoFilter-&gt;setEnabled(b);
-	ui.pushButtonAudioConf-&gt;setEnabled(b);
-	ui.pushButtonAudioFilter-&gt;setEnabled(b);
-
-	/* Time Shift */
-	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
-
-	QRegExp timeRegExp(&quot;^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$&quot;);
-	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
-	ui.currentTime-&gt;setValidator(timeValidator);
-	ui.currentTime-&gt;setInputMask(&quot;99:99:99.999&quot;);
-
-	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
-
-    // Build file,... menu
-    buildMyMenu();
-
-	/* Build the custom menu */
-    jsMenu=new QMenu(&quot;javaScript&quot;);
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;config.h&quot;
+#include &quot;ADM_inttype.h&quot;
+#include &lt;QtCore/QFileInfo&gt;
+#include &lt;QtCore/QUrl&gt;
+#include &lt;QtGui/QKeyEvent&gt;
+#include &lt;QtGui/QGraphicsView&gt;
+
+#define MENU_DECLARE
+#include &quot;Q_gui2.h&quot;
+#include &quot;ADM_default.h&quot;
+
+#include &quot;DIA_fileSel.h&quot;
+#include &quot;ADM_vidMisc.h&quot;
+#include &quot;prefs.h&quot;
+#include &quot;avi_vars.h&quot;
+
+#include &quot;ADM_render/GUI_renderInternal.h&quot;
+#include &quot;ADM_coreVideoEncoderInternal.h&quot;
+#include &quot;ADM_muxerProto.h&quot;
+#include &quot;T_vumeter.h&quot;
+#include &quot;DIA_coreToolkit.h&quot;
+
+extern int global_argc;
+extern char **global_argv;
+
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern int encoderGetEncoderCount (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+uint32_t audioEncoderGetNumberOfEncoders(void);
+const char  *audioEncoderGetDisplayName(uint32_t i);
+extern void checkCrashFile(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
+extern int A_openAvi(const char *name);
+extern int A_appendAvi(const char *name);
+extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
+
+
+int SliderIsShifted=0;
+static void setupMenus(void);
+static int shiftKeyHeld=0;
+static ADM_QSlider *slider=NULL;
+static int _upd_in_progres=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
+uint32_t ADM_ve6_getNbEncoders(void);
+void UI_refreshCustomMenu(void);
+QWidget *QuiMainWindows=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+extern void saveCrashProject(void);
+extern uint8_t AVDM_setVolume(int volume);
+extern bool ADM_QPreviewCleanup(void);
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
+
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+
+#include &quot;translation_table.h&quot;   
+
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct 
+{
+	const char *name;
+	Action     action; 
+}adm_qt4_translation;
+
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+	LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+extern void UI_purge(void);
+/*
+    Declare the class that will be our main window
+
+*/
+
+void MainWindow::comboChanged(int z)
+{
+	const char *source=qPrintable(sender()-&gt;objectName());
+
+	if(!strcmp(source,&quot;comboBoxVideo&quot;))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxVideo-&gt;currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonVideoConf-&gt;setEnabled(b);
+		ui.pushButtonVideoFilter-&gt;setEnabled(b);
+		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
+	}
+	else if(!strcmp(source,&quot;comboBoxAudio&quot;))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxAudio-&gt;currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonAudioConf-&gt;setEnabled(b);
+		ui.pushButtonAudioFilter-&gt;setEnabled(b);
+		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
+	}
+	else
+		printf(&quot;From +: %s\n&quot;,source);
+}
+
+void MainWindow::sliderValueChanged(int u) 
+{
+	if(!_upd_in_progres)
+		HandleAction(ACT_Scale);
+}
+
+void MainWindow::sliderMoved(int value)
+{
+	SliderIsShifted = shiftKeyHeld;
+}
+
+void MainWindow::sliderReleased(void)
+{
+	SliderIsShifted = 0;
+}
+
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+        if (value &gt; 0)
+                nextIntraFrame();
+        else
+                previousIntraFrame();
+}
+
+void MainWindow::volumeChange( int u )
+{
+	if (_upd_in_progres || !ui.toolButtonAudioToggle-&gt;isChecked())
+		return;
+
+	_upd_in_progres++;
+
+	int vol = ui.horizontalSlider_2-&gt;value();
+
+	AVDM_setVolume(vol);
+	_upd_in_progres--;
+}
+
+void MainWindow::audioToggled(bool checked)
+{
+	if (checked)
+		AVDM_setVolume(ui.horizontalSlider_2-&gt;value());
+	else
+		AVDM_setVolume(0);
+}
+
+void MainWindow::previewModeChanged(QAction *action)
+{
+	HandleAction(ACT_PreviewChanged);
+}
+
+void MainWindow::timeChangeFinished(void)
+{
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentFrameChanged(void)
+{
+//	HandleAction(ACT_JumpToFrame);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentTimeChanged(void)
+{
+	HandleAction(ACT_GotoTime);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+/**
+    \fn ctor
+*/
+MainWindow::MainWindow() : QMainWindow()
+{
+	ui.setupUi(this);
+
+#if defined(__APPLE__) &amp;&amp; defined(USE_SDL)
+	ui.actionAbout_avidemux-&gt;setMenuRole(QAction::NoRole);
+	ui.actionPreferences-&gt;setMenuRole(QAction::NoRole);
+	ui.actionQuit-&gt;setMenuRole(QAction::NoRole);
+#endif
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes-&gt;addAction(ui.actionPreviewInput);
+	groupPreviewModes-&gt;addAction(ui.actionPreviewOutput);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
+#define PROCESS CONNECT_TB
+	LIST_OF_BUTTONS
+#undef PROCESS
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider-&gt;setMinimum(0);
+	slider-&gt;setMaximum(1000000000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
+
+   // Thumb slider
+    ui.sliderPlaceHolder-&gt;installEventFilter(this);
+    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider-&gt;setMinimum(0);
+	volSlider-&gt;setMaximum(100);
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
+
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf-&gt;setEnabled(b);
+	ui.pushButtonVideoFilter-&gt;setEnabled(b);
+	ui.pushButtonAudioConf-&gt;setEnabled(b);
+	ui.pushButtonAudioFilter-&gt;setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
+
+	QRegExp timeRegExp(&quot;^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$&quot;);
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.currentTime-&gt;setValidator(timeValidator);
+	ui.currentTime-&gt;setInputMask(&quot;99:99:99.999&quot;);
+
+	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
+    // Build file,... menu
+    buildMyMenu();
+
+	/* Build the custom menu */
+    jsMenu=new QMenu(&quot;javaScript&quot;);
     pyMenu=new QMenu(&quot;tinyPython&quot;);
-    autoMenu=ui.menuAuto ;//new QMenu(&quot;autoPython&quot;);
-    ui.menuCustom-&gt;addMenu(jsMenu);
+    autoMenu=ui.menuAuto ;//new QMenu(&quot;autoPython&quot;);
+    ui.menuCustom-&gt;addMenu(jsMenu);
     ui.menuCustom-&gt;addMenu(pyMenu);
-    //ui.menuAuto-&gt;addMenu(autoMenu);
-	buildCustomMenu();
-
-    recentFiles=new QMenu(&quot;Recent Files&quot;);
-    recentProjects=new QMenu(&quot;Recent Projects&quot;);
-    ui.menuRecent-&gt;addMenu(recentFiles);
-    ui.menuRecent-&gt;addMenu(recentProjects);
-    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
-
-	this-&gt;installEventFilter(this);
-	slider-&gt;installEventFilter(this);
-    
-	//ui.currentTime-&gt;installEventFilter(this);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-
-	setAcceptDrops(true);
-    setWindowIcon(QIcon(&quot;:/new/prefix1/pics/avidemux_icon_small.png&quot;));
-
-    // Hook also the toolbar
-    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-
-	QWidget* dummy0 = new QWidget();
-	QWidget* dummy1 = new QWidget();
-	QWidget* dummy2 = new QWidget();
-	QWidget* dummy3 = new QWidget();
-	QWidget* dummy4 = new QWidget();
-
-	ui.codecWidget-&gt;setTitleBarWidget(dummy0);
-	ui.navigationWidget-&gt;setTitleBarWidget(dummy1);
-	ui.selectionWidget-&gt;setTitleBarWidget(dummy2);
-	ui.volumeWidget-&gt;setTitleBarWidget(dummy3);
-	ui.audioMetreWidget-&gt;setTitleBarWidget(dummy4);
-
-	this-&gt;resize(1, 1);
-}
-/**
-    \fn searchToolBar
-*/
-typedef struct 
-{
-    const char *name;
-    Action event;
-}toolBarTranslate;
-
-toolBarTranslate toolbar[]=
-{
-{&quot;actionOpen&quot;,              ACT_OPEN_VIDEO},
-{&quot;actionSave_video&quot;,        ACT_SAVE_VIDEO},
-{&quot;actionProperties&quot;,        ACT_VIDEO_PROPERTIES},
-{&quot;actionLoad_run_project&quot;,  ACT_RUN_PY_PROJECT},
-{&quot;actionSave_project&quot;,      ACT_SAVE_PY_PROJECT},
-//{&quot;actionPreviewInput&quot;,ACT_PreviewToggle},
-//{&quot;actionPreviewOutput&quot;,ACT_PreviewToggle},
-
-{NULL,ACT_DUMMY}
-};
-void MainWindow::searchToolBar(QAction *action)
-{
-        toolBarTranslate *t=toolbar;
-        QString me(action-&gt;objectName());
-        const char *name=me.toUtf8().constData();
-        while(t-&gt;name)
-        {
-            if(!strcmp(name,t-&gt;name))
-            {
-                HandleAction(t-&gt;event);
-                return;
-            }
-            t++;
-        }
-        ADM_warning(&quot;Toolbar:Cannot handle %s\n&quot;,name);
-}
-/**
-    \fn buildFileMenu
-*/
-bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
-{
-    QMenu *subMenu=NULL;
-    for(int i=0;i&lt;nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        switch(m-&gt;type)
-        {
-            case MENU_SEPARATOR:
-                root-&gt;addSeparator();
-                break;
-            case MENU_SUBMENU:
-                {
-                    subMenu=root-&gt;addMenu(m-&gt;text);
-                }
-                break;
-            case MENU_SUBACTION:
-            case MENU_ACTION:
-                {   
-                        QMenu *insert=root;
-                        if(m-&gt;type==MENU_SUBACTION) insert=subMenu;
-                        QAction *a=NULL;
-                        if(m-&gt;icon) 
-                        {
-                            QIcon icon(m-&gt;icon);
-                            a=insert-&gt;addAction(icon,m-&gt;text);
-                        }else
-                            a=insert-&gt;addAction(m-&gt;text);
-                        m-&gt;cookie=(void *)a;
-                        if(m-&gt;shortCut)
-                        {
-                            QKeySequence s(m-&gt;shortCut);
-                            a-&gt;setShortcut(s);
-                        }
-                        break;
-                }
-            default:
-                break;
-        }
-    }
-    return true;
-}
-/**
-    buildFileMenu
-*/
-bool MainWindow::buildMyMenu(void)
-{
-    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
-    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
-
-    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
-    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
-
-    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
-    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
-
-    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
-    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
-
-    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
-    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
-
-    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
-    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
-
-    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
-    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
-
-    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
-    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
-
-    return true;
-}
-
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-	HandleAction (ACT_TimeShift) ;
-}
-/**
-    \fn searchMenu
-*/
-void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
-{
-    for(int i=0;i&lt;nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        if(m-&gt;cookie==(void*)action)
-        {
-            HandleAction (m-&gt;event);
-        }
-    }
-}
-
-/**
-    \fn searchFileMenu
-*/
-#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
-    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
-
-MKMENU(File)
-MKMENU(Edit)
-//MKMENU(Recent)
-MKMENU(View)
-MKMENU(Tool)
-MKMENU(Go)
-//MKMENU(Custom)
-MKMENU(Audio)
-MKMENU(Video)
-MKMENU(Help)
-
-
-
-/*
-      We receive a button press event
-*/
-void MainWindow::buttonPressed(void)
-{
-	// Receveid a key press Event, look into table..
-    QObject *obj=sender();
-    if(!obj) return;
-    QString me(obj-&gt;objectName());
-    
-	Action action=searchTranslationTable(qPrintable(me));
-    
-
-	if(action!=ACT_DUMMY)
-		HandleAction (action);
-
-}
-void MainWindow::toolButtonPressed(bool i)
-{
-	buttonPressed();
-}
-
-bool MainWindow::eventFilter(QObject* watched, QEvent* event)
-{
-	QKeyEvent *keyEvent;
-
-	switch (event-&gt;type())
-	{
-		case QEvent::KeyPress:
-			keyEvent = (QKeyEvent*)event;
-
-			if (watched == slider)
-			{
-				switch (keyEvent-&gt;key())
-				{
-					case Qt::Key_Left:
-						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Back25Frames);
-						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Back50Frames);
-						else
-							HandleAction(ACT_PreviousFrame);
-
-						return true;
-					case Qt::Key_Right:
-						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Forward25Frames);
-						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Forward50Frames);
-						else
-							HandleAction(ACT_NextFrame);
-
-						return true;
-					case Qt::Key_Up:
-						HandleAction(ACT_NextKFrame);
-						return true;
-					case Qt::Key_Down:
-						HandleAction(ACT_PreviousKFrame);
-						return true;
-					case Qt::Key_Shift:
-						shiftKeyHeld = 1;
-						break;
-				}
-			}
-			else if (keyEvent-&gt;key() == Qt::Key_Space)
-			{
-				HandleAction(ACT_PlayAvi);
-				return true;
-			}
-
-			break;
-        case QEvent::Resize:
-            if (watched == ui.sliderPlaceHolder)
-            {
-                    thumbSlider-&gt;resize(ui.sliderPlaceHolder-&gt;width(), 16);
-                    thumbSlider-&gt;move(0, (ui.sliderPlaceHolder-&gt;height() - thumbSlider-&gt;height()) / 2);
-            }
-            break;
-
-		case QEvent::KeyRelease:
-			keyEvent = (QKeyEvent*)event;
-
-			if (keyEvent-&gt;key() == Qt::Key_Shift)
-				shiftKeyHeld = 0;
-
-			break;
-		case QEvent::FocusOut:
-            break;
-        default:
-            break;
-	}
-
-	return QObject::eventFilter(watched, event);
-}
-/**
-    \fn buildRecentMenu
-*/
-bool MainWindow::buildRecentMenu(void)
-{
-    const char **names;
-	names=prefs-&gt;get_lastfiles();
-    // Purge entries...
-    recentFiles-&gt;clear();
-    for(int i=0;i&lt;4;i++)
-    {
-        if(names[i])
-        {
-            recentFileAction[i]=recentFiles-&gt;addAction(QString('0'+i)+QString(&quot;:&quot;)+QString::fromUtf8(names[i]));
-        }else
-            recentFileAction[i]=NULL;
-    }
-	return true;
-}
-/**
-    \fn searchRecentFiles
-*/
-void MainWindow::searchRecentFiles(QAction * action)
-{
-    for(int i=0;i&lt;4;i++)
-    {
-            QAction *a= recentFileAction[i];
-            if(!a) continue;
-
-            if(a==action) 
-            {
-                HandleAction((Action)(ACT_RECENT0+i));
-                return;
-            }
-    }
-}
-void MainWindow::mousePressEvent(QMouseEvent* event)
-{
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
-{
-	if (event-&gt;mimeData()-&gt;hasFormat(&quot;text/uri-list&quot;))
-		event-&gt;acceptProposedAction();
-}
-
-void MainWindow::dropEvent(QDropEvent *event)
-{
-	QList&lt;QUrl&gt; urlList;
-	QString fileName;
-	QFileInfo info;
-
-	if (event-&gt;mimeData()-&gt;hasUrls())
-	{
-		urlList = event-&gt;mimeData()-&gt;urls();
-
-		for (int fileIndex = 0; fileIndex &lt; urlList.size(); fileIndex++)
-		{
-			fileName = urlList[fileIndex].toLocalFile();
-			info.setFile(fileName);
-#warning FIXME
-#if 0
-			if (info.isFile())
-			{
-				if (avifileinfo)
-					FileSel_ReadWrite(reinterpret_cast &lt;void (*)(const char *)&gt; (A_appendAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
-				else
-					FileSel_ReadWrite(reinterpret_cast &lt;void (*)(const char *)&gt; (A_openAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
-			}
-#endif
-		}
-	}
-
-	event-&gt;acceptProposedAction();
-}
-
-void MainWindow::previousIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue-&gt;hasFocus())
-		ui.spinBox_TimeValue-&gt;stepDown();
-	else
-		HandleAction(ACT_PreviousKFrame);
-}
-
-void MainWindow::nextIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue-&gt;hasFocus())
-		ui.spinBox_TimeValue-&gt;stepUp();
-	else
-		HandleAction(ACT_NextKFrame);
-}
-
-MainWindow::~MainWindow()
-{
-	clearCustomMenu();
-    delete thumbSlider;
-    thumbSlider=NULL;
-}
-
-void MainWindow::closeEvent(QCloseEvent *event)
-{
-static bool first=true;
-    ADM_warning(&quot;Close event\n&quot;);
-    if(first)
-    {
-        first=false;
-        HandleAction(ACT_EXIT);
-    }
-    event-&gt;accept();
-//         event-&gt;ignore();
-
-}
-
-
-static const UI_FUNCTIONS_T UI_Hooks=
-    {
-        ADM_RENDER_API_VERSION_NUMBER,
-        UI_getWindowInfo,
-        UI_updateDrawWindowSize,
-        UI_rgbDraw,
-        UI_getDrawWidget,
-        UI_getPreferredRender
-        
-    };
-QApplication *myApplication=NULL;
-/**
-    \fn  UI_Init
-    \brief First part of UI initialization
-
-*/
-int UI_Init(int nargc,char **nargv)
-{
-    ADM_info(&quot;Starting QT4 GUI...\n&quot;);
-	initTranslator();
-
-	global_argc=nargc;
-	global_argv=nargv;
-	ADM_renderLibInit(&amp;UI_Hooks);
-    Q_INIT_RESOURCE(avidemux);
-	Q_INIT_RESOURCE(filter);
-
-	myApplication=new QApplication (global_argc, global_argv);
-	myApplication-&gt;connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
-
-	loadTranslator();
-
-	MainWindow *mw = new MainWindow();
-	mw-&gt;show();
-
-	QuiMainWindows = (QWidget*)mw;
-
-	uint32_t w, h;
-
-	UI_getPhysicalScreenSize(QuiMainWindows, &amp;w,&amp;h);
-	printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
-
-	UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu();
-
-    // Init vumeter
-    UI_InitVUMeter(mw-&gt;ui.frameVU);
-	return 0;
-}
-/**
-
-*/
-bool UI_End(void)
-{
-    ADM_QPreviewCleanup();
-    return true;
-}
-void UI_refreshCustomMenu(void)
-{
-	((MainWindow*)QuiMainWindows)-&gt;buildCustomMenu();
-}
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-int UI_getCurrentPreview(void)
-{
-	int index;
-
-	if (WIDGET(actionPreviewOutput)-&gt;isChecked())
-		index = 1;
-	else if (WIDGET(actionPreviewSide)-&gt;isChecked())
-		index = 2;
-	else if (WIDGET(actionPreviewTop)-&gt;isChecked())
-		index = 3;
-	else if (WIDGET(actionPreviewSeparate)-&gt;isChecked())
-		index = 4;
-	else
-		index = 0;
-
-	return index;
-}
-
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-void UI_setCurrentPreview(int ne)
-{
-	switch (ne)
-	{
-		case 1:
-			WIDGET(actionPreviewOutput)-&gt;setChecked(true);
-			break;
-		case 2:
-			WIDGET(actionPreviewSide)-&gt;setChecked(true);
-			break;
-		case 3:
-			WIDGET(actionPreviewTop)-&gt;setChecked(true);
-			break;
-		case 4:
-			WIDGET(actionPreviewSeparate)-&gt;setChecked(true);
-			break;
-		default:
-			WIDGET(actionPreviewInput)-&gt;setChecked(true);
-	}
-}
-/**
-        \fn FatalFunctionQt
-*/
-static void FatalFunctionQt(const char *title, const char *info)
-{
-	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
-}
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-	
-	setupMenus();
-    ADM_setCrashHook(&amp;saveCrashProject, &amp;FatalFunctionQt);
-	checkCrashFile();
-
-	if (global_argc &gt;= 2)
-		automation();
-
-	myApplication-&gt;exec();
-
-	destroyTranslator();
-    delete myApplication;
-    myApplication=NULL;
-    return 1;
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-	for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
-	{
-		if(!strcmp(name, myTranslationTable[i].name))
-		{
-			return  myTranslationTable[i].action;
-		}
-	}
-	printf(&quot;WARNING: Signal not found in translation table %s\n&quot;,name);
-	return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-    return  ((MainWindow *)QuiMainWindows)-&gt;buildRecentMenu();
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video &amp; audio co
-*/
-void setupMenus(void)
-{
-	uint32_t nbVid;
-    uint32_t maj,mn,pa;
-	const char *name;
-
-	nbVid=ADM_ve6_getNbEncoders();
-	printf(&quot;Found %d video encoder(s)\n&quot;,nbVid);
-	for(uint32_t i=1;i&lt;nbVid;i++)
-	{
-		ADM_ve6_getEncoderInfo(i,&amp;name,&amp;maj,&amp;mn,&amp;pa);
-		WIDGET(comboBoxVideo)-&gt;addItem(name);
-	}
-
-	// And A codec
-
-	uint32_t nbAud;
-
-    nbAud=audioEncoderGetNumberOfEncoders();
-	printf(&quot;Found %d audio encoder(s)\n&quot;,nbAud);		       
-	for(uint32_t i=1;i&lt;nbAud;i++)
-	{
-		name=audioEncoderGetDisplayName(i);
-		WIDGET(comboBoxAudio)-&gt;addItem(name);
-	}
-
-	/*   Fill in output format window */
-	uint32_t nbFormat=ADM_mx_getNbMuxers();
-
-	printf(&quot;Found %d format(s)\n&quot;,nbFormat);
-	for(uint32_t i=0;i&lt;nbFormat;i++)
-	{
-        const char *name=ADM_mx_getDisplayName(i);
-		WIDGET(comboBoxFormat)-&gt;addItem(name);	
-	}
-
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-	double v;
-	if(!slider) v=0;
-	v= (double)(slider-&gt;value());
-	v/=10000000;
-	return v;
-}
-void UI_setScale( double val )
-{
-	if(_upd_in_progres) return;
-	_upd_in_progres++;
-	slider-&gt;setValue( (int)(val * 10000000));
-	_upd_in_progres--;
-}
-
-int UI_readCurFrame(void)
-{
-	return 0;
-}
-
-int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms)
-{
-	int success = 0;
-
-	QString timeText = WIDGET(currentTime)-&gt;text();
-	int pos;
-
-	if (WIDGET(currentTime)-&gt;validator()-&gt;validate(timeText, pos) == QValidator::Acceptable)
-	{
-		uint32_t frame;
-
-		hh = (uint16_t)timeText.left(2).toUInt();
-		mm = (uint16_t)timeText.mid(3, 2).toUInt();
-		ss = (uint16_t)timeText.mid(6, 2).toUInt();
-		ms = (uint16_t)timeText.right(3).toUInt();
-
-		time2frame(&amp;frame, currentFps, hh, mm, ss, ms);
-
-		if (frame &lt;= frameCount)
-			success = 1;
-	}
-
-	return success;
-}
-
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(const char *name)
-{
-	char *title;
-	const char* defaultTitle = &quot;Avidemux&quot;;
-
-	if (name &amp;&amp; (*name) )
-	{
-		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
-
-		strcpy(title, name);
-		strcat(title, &quot; - &quot;);
-		strcat(title, defaultTitle);
-	}
-	else
-	{
-		title = new char[strlen(defaultTitle) + 1];
-
-		strcpy(title, defaultTitle);
-	}
-
-	QuiMainWindows-&gt;setWindowTitle(QString::fromUtf8(title));
-	delete [] title;
-}
-
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-	char string[100];
-	char	c='?';
-    const char *f=&quot;???&quot;;
-	switch(frametype&amp;AVI_FRAME_TYPE_MASK)
-	{
-	case AVI_KEY_FRAME: c='I';break;
-	case AVI_B_FRAME: c='B';break;
-	case 0: c='P';break;
-	default:c='?';break;
-
-	}
-    switch(frametype&amp;AVI_STRUCTURE_TYPE_MASK)
-	{
-	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f=&quot;TFF&quot;;break;
-    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f=&quot;BFF&quot;;break;
-    case AVI_FRAME_STRUCTURE: f=&quot;FRM&quot;;break;
-	default:f=&quot;???&quot;;
-
-                    break;
-	}
-	sprintf(string,QT_TR_NOOP(&quot;%c-%s (%02d)&quot;),c,f,qp);
-	WIDGET(label_8)-&gt;setText(string);	
-
-}
-
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-void UI_updateFrameCount(uint32_t curFrame)
-{
-	
-}
-
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-	
-}
-
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
-	char text[80];   
-	uint32_t mm,hh,ss,ms;
-
-	frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
-	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-	WIDGET(currentTime)-&gt;setText(text);
-}
-
-
-
-/**
-    \fn UI_setCurrentTime
-    \brief Set current PTS of displayed video
-*/
-void UI_setCurrentTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-  	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-	WIDGET(currentTime)-&gt;setText(text);
-
-}
-
-/**
-    \fn UI_setTotalTime
-    \brief SEt the total duration of video
-*/
-void UI_setTotalTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-  	sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-    WIDGET(totalTime)-&gt;setText(text);
-    slider-&gt;setTotalDuration(curTime);
-}
-/**
-    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
-    \brief  Display frame # for marker A &amp; B
-*/
-void UI_setMarkers(uint64_t a, uint64_t b)
-{
-	char text[80];
-    uint64_t absoluteA=a,absoluteB=b;
-    uint32_t hh,mm,ss,ms;
-    uint32_t timems;
-    a/=1000;
-    b/=1000;
-
-    timems=(uint32_t)(a);
-    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerA)-&gt;setText(text);
-
-	timems=(uint32_t)(b);
-    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerB)-&gt;setText(text);
-
-	slider-&gt;setMarkers(absoluteA, absoluteB);
-}
-
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-int 	UI_getCurrentVCodec(void)
-{
-	int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-	int b=!!i;
-	WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
-
-	WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
-	WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-	int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
-WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
-WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-int 	UI_GetCurrentFormat( void )
-{
-	int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return (int)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
-{
-	WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
-    return 1;
-}
-
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-	if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
-		*onoff=1;
-	else
-		*onoff=0;
-	*value=WIDGET(spinBox_TimeValue)-&gt;value();
-	return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (onoff &amp;&amp; value)
-		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
-	else
-		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
-	WIDGET(spinBox_TimeValue)-&gt;setValue(value);
-	return 1;
-}
-/**
-    \fn UI_setVUMeter
-*/
-bool UI_setVUMeter( uint32_t volume[6])
-{
-    UI_vuUpdate( volume);
-    return true;
-}
-/**
-    \fn setDecodeName
-*/
-bool UI_setDecoderName(const char *name)
-{
-    WIDGET(labelVideoDecoder)-&gt;setText(name);	
-    return true;
-}
-//********************************************
-//EOF
+    //ui.menuAuto-&gt;addMenu(autoMenu);
+	buildCustomMenu();
+
+    recentFiles=new QMenu(&quot;Recent Files&quot;);
+    recentProjects=new QMenu(&quot;Recent Projects&quot;);
+    ui.menuRecent-&gt;addMenu(recentFiles);
+    ui.menuRecent-&gt;addMenu(recentProjects);
+    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
+
+	this-&gt;installEventFilter(this);
+	slider-&gt;installEventFilter(this);
+    
+	//ui.currentTime-&gt;installEventFilter(this);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+
+	setAcceptDrops(true);
+    setWindowIcon(QIcon(&quot;:/new/prefix1/pics/avidemux_icon_small.png&quot;));
+
+    // Hook also the toolbar
+    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+
+	QWidget* dummy0 = new QWidget();
+	QWidget* dummy1 = new QWidget();
+	QWidget* dummy2 = new QWidget();
+	QWidget* dummy3 = new QWidget();
+	QWidget* dummy4 = new QWidget();
+
+	ui.codecWidget-&gt;setTitleBarWidget(dummy0);
+	ui.navigationWidget-&gt;setTitleBarWidget(dummy1);
+	ui.selectionWidget-&gt;setTitleBarWidget(dummy2);
+	ui.volumeWidget-&gt;setTitleBarWidget(dummy3);
+	ui.audioMetreWidget-&gt;setTitleBarWidget(dummy4);
+
+	this-&gt;resize(1, 1);
+}
+/**
+    \fn searchToolBar
+*/
+typedef struct 
+{
+    const char *name;
+    Action event;
+}toolBarTranslate;
+
+toolBarTranslate toolbar[]=
+{
+{&quot;actionOpen&quot;,              ACT_OPEN_VIDEO},
+{&quot;actionSave_video&quot;,        ACT_SAVE_VIDEO},
+{&quot;actionProperties&quot;,        ACT_VIDEO_PROPERTIES},
+{&quot;actionLoad_run_project&quot;,  ACT_RUN_PY_PROJECT},
+{&quot;actionSave_project&quot;,      ACT_SAVE_PY_PROJECT},
+//{&quot;actionPreviewInput&quot;,ACT_PreviewToggle},
+//{&quot;actionPreviewOutput&quot;,ACT_PreviewToggle},
+
+{NULL,ACT_DUMMY}
+};
+void MainWindow::searchToolBar(QAction *action)
+{
+        toolBarTranslate *t=toolbar;
+        QString me(action-&gt;objectName());
+        const char *name=me.toUtf8().constData();
+        while(t-&gt;name)
+        {
+            if(!strcmp(name,t-&gt;name))
+            {
+                HandleAction(t-&gt;event);
+                return;
+            }
+            t++;
+        }
+        ADM_warning(&quot;Toolbar:Cannot handle %s\n&quot;,name);
+}
+/**
+    \fn buildFileMenu
+*/
+bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
+{
+    QMenu *subMenu=NULL;
+    for(int i=0;i&lt;nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        switch(m-&gt;type)
+        {
+            case MENU_SEPARATOR:
+                root-&gt;addSeparator();
+                break;
+            case MENU_SUBMENU:
+                {
+                    subMenu=root-&gt;addMenu(m-&gt;text);
+                }
+                break;
+            case MENU_SUBACTION:
+            case MENU_ACTION:
+                {   
+                        QMenu *insert=root;
+                        if(m-&gt;type==MENU_SUBACTION) insert=subMenu;
+                        QAction *a=NULL;
+                        if(m-&gt;icon) 
+                        {
+                            QIcon icon(m-&gt;icon);
+                            a=insert-&gt;addAction(icon,m-&gt;text);
+                        }else
+                            a=insert-&gt;addAction(m-&gt;text);
+                        m-&gt;cookie=(void *)a;
+                        if(m-&gt;shortCut)
+                        {
+                            QKeySequence s(m-&gt;shortCut);
+                            a-&gt;setShortcut(s);
+                        }
+                        break;
+                }
+            default:
+                break;
+        }
+    }
+    return true;
+}
+/**
+    buildFileMenu
+*/
+bool MainWindow::buildMyMenu(void)
+{
+    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
+    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
+
+    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
+    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
+
+    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
+    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
+
+    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
+    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
+
+    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
+    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
+
+    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
+    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
+
+    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
+    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
+
+    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
+    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
+
+    return true;
+}
+
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+	HandleAction (ACT_TimeShift) ;
+}
+/**
+    \fn searchMenu
+*/
+void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
+{
+    for(int i=0;i&lt;nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        if(m-&gt;cookie==(void*)action)
+        {
+            HandleAction (m-&gt;event);
+        }
+    }
+}
+
+/**
+    \fn searchFileMenu
+*/
+#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
+    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
+
+MKMENU(File)
+MKMENU(Edit)
+//MKMENU(Recent)
+MKMENU(View)
+MKMENU(Tool)
+MKMENU(Go)
+//MKMENU(Custom)
+MKMENU(Audio)
+MKMENU(Video)
+MKMENU(Help)
+
+
+
+/*
+      We receive a button press event
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+    QObject *obj=sender();
+    if(!obj) return;
+    QString me(obj-&gt;objectName());
+    
+	Action action=searchTranslationTable(qPrintable(me));
+    
+
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	QKeyEvent *keyEvent;
+
+	switch (event-&gt;type())
+	{
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
+
+			if (watched == slider)
+			{
+				switch (keyEvent-&gt;key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
+
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
+
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
+			}
+			else if (keyEvent-&gt;key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
+
+			break;
+        case QEvent::Resize:
+            if (watched == ui.sliderPlaceHolder)
+            {
+                    thumbSlider-&gt;resize(ui.sliderPlaceHolder-&gt;width(), 16);
+                    thumbSlider-&gt;move(0, (ui.sliderPlaceHolder-&gt;height() - thumbSlider-&gt;height()) / 2);
+            }
+            break;
+
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent-&gt;key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+            break;
+        default:
+            break;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+/**
+    \fn buildRecentMenu
+*/
+bool MainWindow::buildRecentMenu(void)
+{
+    const char **names;
+	names=prefs-&gt;get_lastfiles();
+    // Purge entries...
+    recentFiles-&gt;clear();
+    for(int i=0;i&lt;4;i++)
+    {
+        if(names[i])
+        {
+            recentFileAction[i]=recentFiles-&gt;addAction(QString('0'+i)+QString(&quot;:&quot;)+QString::fromUtf8(names[i]));
+        }else
+            recentFileAction[i]=NULL;
+    }
+	return true;
+}
+/**
+    \fn searchRecentFiles
+*/
+void MainWindow::searchRecentFiles(QAction * action)
+{
+    for(int i=0;i&lt;4;i++)
+    {
+            QAction *a= recentFileAction[i];
+            if(!a) continue;
+
+            if(a==action) 
+            {
+                HandleAction((Action)(ACT_RECENT0+i));
+                return;
+            }
+    }
+}
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+{
+	if (event-&gt;mimeData()-&gt;hasFormat(&quot;text/uri-list&quot;))
+		event-&gt;acceptProposedAction();
+}
+
+void MainWindow::dropEvent(QDropEvent *event)
+{
+	QList&lt;QUrl&gt; urlList;
+	QString fileName;
+	QFileInfo info;
+
+	if (event-&gt;mimeData()-&gt;hasUrls())
+	{
+		urlList = event-&gt;mimeData()-&gt;urls();
+
+		for (int fileIndex = 0; fileIndex &lt; urlList.size(); fileIndex++)
+		{
+			fileName = urlList[fileIndex].toLocalFile();
+			info.setFile(fileName);
+#warning FIXME
+#if 0
+			if (info.isFile())
+			{
+				if (avifileinfo)
+					FileSel_ReadWrite(reinterpret_cast &lt;void (*)(const char *)&gt; (A_appendAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
+				else
+					FileSel_ReadWrite(reinterpret_cast &lt;void (*)(const char *)&gt; (A_openAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
+			}
+#endif
+		}
+	}
+
+	event-&gt;acceptProposedAction();
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue-&gt;hasFocus())
+		ui.spinBox_TimeValue-&gt;stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue-&gt;hasFocus())
+		ui.spinBox_TimeValue-&gt;stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+    delete thumbSlider;
+    thumbSlider=NULL;
+}
+
+void MainWindow::closeEvent(QCloseEvent *event)
+{
+static bool first=true;
+    ADM_warning(&quot;Close event\n&quot;);
+    if(first)
+    {
+        first=false;
+        HandleAction(ACT_EXIT);
+    }
+    event-&gt;accept();
+//         event-&gt;ignore();
+
+}
+
+
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
+QApplication *myApplication=NULL;
+/**
+    \fn  UI_Init
+    \brief First part of UI initialization
+
+*/
+int UI_Init(int nargc,char **nargv)
+{
+    ADM_info(&quot;Starting QT4 GUI...\n&quot;);
+	initTranslator();
+
+	global_argc=nargc;
+	global_argv=nargv;
+	ADM_renderLibInit(&amp;UI_Hooks);
+    Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+
+	myApplication=new QApplication (global_argc, global_argv);
+	myApplication-&gt;connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
+
+	loadTranslator();
+
+	MainWindow *mw = new MainWindow();
+	mw-&gt;show();
+
+	QuiMainWindows = (QWidget*)mw;
+
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(QuiMainWindows, &amp;w,&amp;h);
+	printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
+
+	UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu();
+
+    // Init vumeter
+    UI_InitVUMeter(mw-&gt;ui.frameVU);
+	return 0;
+}
+/**
+
+*/
+bool UI_End(void)
+{
+    ADM_QPreviewCleanup();
+    return true;
+}
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)-&gt;buildCustomMenu();
+}
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+int UI_getCurrentPreview(void)
+{
+	int index;
+
+	if (WIDGET(actionPreviewOutput)-&gt;isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)-&gt;isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)-&gt;isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)-&gt;isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
+}
+
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+void UI_setCurrentPreview(int ne)
+{
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)-&gt;setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)-&gt;setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)-&gt;setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)-&gt;setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)-&gt;setChecked(true);
+	}
+}
+/**
+        \fn FatalFunctionQt
+*/
+static void FatalFunctionQt(const char *title, const char *info)
+{
+	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
+}
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+	
+	setupMenus();
+    ADM_setCrashHook(&amp;saveCrashProject, &amp;FatalFunctionQt);
+	checkCrashFile();
+
+	if (global_argc &gt;= 2)
+		automation();
+
+	myApplication-&gt;exec();
+
+	destroyTranslator();
+    delete myApplication;
+    myApplication=NULL;
+    return 1;
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+	for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf(&quot;WARNING: Signal not found in translation table %s\n&quot;,name);
+	return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+    return  ((MainWindow *)QuiMainWindows)-&gt;buildRecentMenu();
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video &amp; audio co
+*/
+void setupMenus(void)
+{
+	uint32_t nbVid;
+    uint32_t maj,mn,pa;
+	const char *name;
+
+	nbVid=ADM_ve6_getNbEncoders();
+	printf(&quot;Found %d video encoder(s)\n&quot;,nbVid);
+	for(uint32_t i=1;i&lt;nbVid;i++)
+	{
+		ADM_ve6_getEncoderInfo(i,&amp;name,&amp;maj,&amp;mn,&amp;pa);
+		WIDGET(comboBoxVideo)-&gt;addItem(name);
+	}
+
+	// And A codec
+
+	uint32_t nbAud;
+
+    nbAud=audioEncoderGetNumberOfEncoders();
+	printf(&quot;Found %d audio encoder(s)\n&quot;,nbAud);		       
+	for(uint32_t i=1;i&lt;nbAud;i++)
+	{
+		name=audioEncoderGetDisplayName(i);
+		WIDGET(comboBoxAudio)-&gt;addItem(name);
+	}
+
+	/*   Fill in output format window */
+	uint32_t nbFormat=ADM_mx_getNbMuxers();
+
+	printf(&quot;Found %d format(s)\n&quot;,nbFormat);
+	for(uint32_t i=0;i&lt;nbFormat;i++)
+	{
+        const char *name=ADM_mx_getDisplayName(i);
+		WIDGET(comboBoxFormat)-&gt;addItem(name);	
+	}
+
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider-&gt;value());
+	v/=10000000;
+	return v;
+}
+void UI_setScale( double val )
+{
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider-&gt;setValue( (int)(val * 10000000));
+	_upd_in_progres--;
+}
+
+int UI_readCurFrame(void)
+{
+	return 0;
+}
+
+int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(currentTime)-&gt;text();
+	int pos;
+
+	if (WIDGET(currentTime)-&gt;validator()-&gt;validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&amp;frame, currentFps, hh, mm, ss, ms);
+
+		if (frame &lt;= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(const char *name)
+{
+	char *title;
+	const char* defaultTitle = &quot;Avidemux&quot;;
+
+	if (name &amp;&amp; (*name) )
+	{
+		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
+
+		strcpy(title, name);
+		strcat(title, &quot; - &quot;);
+		strcat(title, defaultTitle);
+	}
+	else
+	{
+		title = new char[strlen(defaultTitle) + 1];
+
+		strcpy(title, defaultTitle);
+	}
+
+	QuiMainWindows-&gt;setWindowTitle(QString::fromUtf8(title));
+	delete [] title;
+}
+
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+	char string[100];
+	char	c='?';
+    const char *f=&quot;???&quot;;
+	switch(frametype&amp;AVI_FRAME_TYPE_MASK)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
+
+	}
+    switch(frametype&amp;AVI_STRUCTURE_TYPE_MASK)
+	{
+	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f=&quot;TFF&quot;;break;
+    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f=&quot;BFF&quot;;break;
+    case AVI_FRAME_STRUCTURE: f=&quot;FRM&quot;;break;
+	default:f=&quot;???&quot;;
+
+                    break;
+	}
+	sprintf(string,QT_TR_NOOP(&quot;%c-%s (%02d)&quot;),c,f,qp);
+	WIDGET(label_8)-&gt;setText(string);	
+
+}
+
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+void UI_updateFrameCount(uint32_t curFrame)
+{
+	
+}
+
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+	
+}
+
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+	char text[80];   
+	uint32_t mm,hh,ss,ms;
+
+	frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
+	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+	WIDGET(currentTime)-&gt;setText(text);
+}
+
+
+
+/**
+    \fn UI_setCurrentTime
+    \brief Set current PTS of displayed video
+*/
+void UI_setCurrentTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+  	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+	WIDGET(currentTime)-&gt;setText(text);
+
+}
+
+/**
+    \fn UI_setTotalTime
+    \brief SEt the total duration of video
+*/
+void UI_setTotalTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+  	sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+    WIDGET(totalTime)-&gt;setText(text);
+    slider-&gt;setTotalDuration(curTime);
+}
+/**
+    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
+    \brief  Display frame # for marker A &amp; B
+*/
+void UI_setMarkers(uint64_t a, uint64_t b)
+{
+	char text[80];
+    uint64_t absoluteA=a,absoluteB=b;
+    uint32_t hh,mm,ss,ms;
+    uint32_t timems;
+    a/=1000;
+    b/=1000;
+
+    timems=(uint32_t)(a);
+    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerA)-&gt;setText(text);
+
+	timems=(uint32_t)(b);
+    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerB)-&gt;setText(text);
+
+	slider-&gt;setMarkers(absoluteA, absoluteB);
+}
+
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+int 	UI_getCurrentVCodec(void)
+{
+	int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+	int b=!!i;
+	WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
+	WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+	int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
+WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+int 	UI_GetCurrentFormat( void )
+{
+	int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return (int)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
+{
+	WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
+    return 1;
+}
+
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+	if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)-&gt;value();
+	return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+	if (onoff &amp;&amp; value)
+		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)-&gt;setValue(value);
+	return 1;
+}
+/**
+    \fn UI_setVUMeter
+*/
+bool UI_setVUMeter( uint32_t volume[6])
+{
+    UI_vuUpdate( volume);
+    return true;
+}
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)-&gt;setText(name);	
+    return true;
+}
+//********************************************
+//EOF


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004434.html">[Avidemux-svn-commit] r7280 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="004436.html">[Avidemux-svn-commit] r7282 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4435">[ date ]</a>
              <a href="thread.html#4435">[ thread ]</a>
              <a href="subject.html#4435">[ subject ]</a>
              <a href="author.html#4435">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
