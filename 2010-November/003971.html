<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6792 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts:	. avidemux faac faad fontconfig js lame libogg libvorbis	libvpx nspr opencore-amr x264 xvid
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-November/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6792%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts%3A%0A%09.%20avidemux%20faac%20faad%20fontconfig%20js%20lame%20libogg%20libvorbis%0A%09libvpx%20nspr%20opencore-amr%20x264%20xvid&In-Reply-To=%3C20101128094811.B9EAF480FC7%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003970.html">
   <LINK REL="Next"  HREF="003972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6792 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts:	. avidemux faac faad fontconfig js lame libogg libvorbis	libvpx nspr opencore-amr x264 xvid</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6792%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts%3A%0A%09.%20avidemux%20faac%20faad%20fontconfig%20js%20lame%20libogg%20libvorbis%0A%09libvpx%20nspr%20opencore-amr%20x264%20xvid&In-Reply-To=%3C20101128094811.B9EAF480FC7%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6792 - in	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts:	. avidemux faac faad fontconfig js lame libogg libvorbis	libvpx nspr opencore-amr x264 xvid">gruntster at mail.berlios.de
       </A><BR>
    <I>Sun Nov 28 10:48:11 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003970.html">[Avidemux-svn-commit] r6791 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches
</A></li>
        <LI>Next message: <A HREF="003972.html">[Avidemux-svn-commit] r6793 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3971">[ date ]</a>
              <a href="thread.html#3971">[ thread ]</a>
              <a href="subject.html#3971">[ subject ]</a>
              <a href="author.html#3971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2010-11-28 10:48:11 +0100 (Sun, 28 Nov 2010)
New Revision: 6792

Added:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faac/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faac/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faad/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faad/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Makefile.ref.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/WINNT6.1.mk
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/jsnum.c.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.sh.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/nspr/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/nspr/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrnb_Makefile.in
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrwb_Makefile.in
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/configure.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/nasm.inc.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat
Log:
[win] more build scripts

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat	2010-11-28 09:41:13 UTC (rev 6791)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/Set Common Environment Variables.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -3,26 +3,18 @@
 set nsisDir=%ProgramFiles32%\NSIS
 
 set devDir=E:\Dev
+set msysDir=E:/Dev/MSYS
 
-if &quot;%BuildBits%&quot; == &quot;32&quot; (
-	set msysDir=E:/Dev/MSYS
-	set qtDir=%devDir%\Qt
-	set CFLAGS=-m32 
-	set CXXFLAGS=-m32
-	set LDFLAGS=-m32
-	goto :setVars )
+if &quot;%BuildBits%&quot; == &quot;32&quot; goto :setVars
+if &quot;%BuildBits%&quot; == &quot;64&quot; goto :setVars
 
-if &quot;%BuildBits%&quot; == &quot;64&quot; (
-	set msysDir=E:/Dev/MSYS-64
-	set qtDir=%devDir%\Qt-64
-	goto :setVars )
-
 echo Error - BuildBits variable not set
 goto error
 
 :setVars
-set mingwDir=%devDir%\MinGW64
-set usrLocalDir=%msysDir%/local
+set mingwDir=%devDir%\MinGW%BuildBits%
+set usrLocalDir=%msysDir%/local%BuildBits%
+set qtDir=%devDir%\Qt%BuildBits%
 set CMAKE_INCLUDE_PATH=%usrLocalDir%/include
 set CMAKE_LIBRARY_PATH=%usrLocalDir%/lib
 set PKG_CONFIG_PATH=%usrLocalDir%\lib\pkgconfig
@@ -30,6 +22,8 @@
 set CFLAGS=%CFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
 set CXXFLAGS=%CXXFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
 set LDFLAGS=%LDFLAGS% -shared-libgcc -lstdc++ -L%CMAKE_LIBRARY_PATH%
+set admBuildDir=%devDir%\avidemux_2.5_build%BuildBits%
+set admSdkBuildDir=%devDir%\avidemux_2.5_build%BuildBits%_sdk
 
 if exist &quot;%qtDir%&quot; (
 	for /f %%d in ('dir /b /ad /on %qtDir%') do set qtVer=%%d
@@ -73,7 +67,7 @@
 	goto error
 )
 
-set PATH=%cmakeDir%;%mingwDir%\bin;%usrLocalDir%\bin;%msysDir%\bin;%msysDir%\local32\bin;%qtDir%\bin;%PATH%
+set PATH=%cmakeDir%;%mingwDir%\bin;%usrLocalDir%\bin;%msysDir%\bin;%msysDir%\local-shared\bin;%qtDir%\bin;c:\strawberry\perl\bin;%PATH%
 
 goto end
 

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-11-28 09:41:13 UTC (rev 6791)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -33,17 +33,11 @@
 	goto error
 )
 
-if &quot;%BuildBits%&quot; == &quot;32&quot; (
-	set buildFolder=build
-	set buildPluginFolder=buildPlugins)
+set buildFolder=build%BuildBits%
+set buildPluginFolder=buildPlugins%BuildBits%
+set buildDir=%admBuildDir%
+set sdkBuildDir=%admSdkBuildDir%
 
-if &quot;%BuildBits%&quot; == &quot;64&quot; (
-	set buildFolder=build64
-	set buildPluginFolder=buildPlugins64)
-
-set buildDir=%devDir%\avidemux_2.5_%buildFolder%
-set sdkBuildDir=%devDir%\avidemux_2.5_%buildFolder%_sdk
-
 set curDir=%CD%
 cd ..\..\..\..
 set sourceDir=%CD%
@@ -54,11 +48,9 @@
 	goto error
 )
 
-if &quot;%BuildBits%&quot; == &quot;32&quot; (set jsFolder=js)
-if &quot;%BuildBits%&quot; == &quot;64&quot; (set jsFolder=js-64)
-
+set jsFolder=js-1.7.0-%BuildBits%
 set SpiderMonkeySourceDir=%devDir%\%jsFolder%\src
-set SpiderMonkeyLibDir=%devDir%\%jsFolder%\src\WINNT6.0_OPT.OBJ
+set SpiderMonkeyLibDir=%devDir%\%jsFolder%\src\WINNT6.1_OPT.OBJ
 
 goto end
 

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faac/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faac/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faac/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,62 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for FAAC
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=faac-1.28.tar.gz
+set sourceFolder=faac-1.28-%BuildBits%
+set tarFolder=faac-1.28
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://downloads.sourceforge.net/faac/%package%">http://downloads.sourceforge.net/faac/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%/%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+copy &quot;.\include\*.h&quot; &quot;%usrLocalDir%\include&quot;
+cd libfaac
+gcc -s -O3 -shared -I../include *.c -o&quot;%usrLocalDir%/bin/libfaac.dll&quot; -Wl,--out-implib,&quot;%usrLocalDir%/lib/libfaac.a&quot;
+if errorlevel 1 goto end
+
+copy &quot;%usrLocalDir%\bin\libfaac.dll&quot; &quot;%admBuildDir%&quot;
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faad/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faad/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/faad/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,62 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for FAAD
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=faad2-2.7.tar.gz
+set sourceFolder=faac-2.7-%BuildBits%
+set tarFolder=faad2-2.7
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://downloads.sourceforge.net/faac/%package%">http://downloads.sourceforge.net/faac/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%/%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+copy &quot;.\include\*.h&quot; &quot;%usrLocalDir%\include&quot;
+cd libfaad
+gcc -s -O3 -DHAVE_MEMCPY=1 -DHAVE_STRING_H=1 -DHAVE_STDINT_H=1 -I../include -I&quot;.&quot; *.c -shared -o &quot;%usrLocalDir%/bin/libfaad2.dll&quot; -Wl,--out-implib,&quot;%usrLocalDir%/lib/libfaad.a&quot;
+if errorlevel 1 goto end
+
+copy &quot;%usrLocalDir%\bin\libfaad2.dll&quot; &quot;%admBuildDir%&quot;
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,77 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for fontconfig
+echo =========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=fontconfig-2.8.0.tar.gz
+set sourceFolder=fontconfig-2.8.0-%BuildBits%
+set tarFolder=fontconfig-2.8.0
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://fontconfig.org/release/%package%">http://fontconfig.org/release/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%/%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Configuring
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-static
+
+if &quot;%BuildBits%&quot; == &quot;64&quot; (
+	echo.
+	echo Patching
+	patch -p0 -i &quot;%curDir%\libtool.patch&quot;
+)
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+del &quot;%usrLocalDir%\etc\fonts\fonts.conf.bak&quot;
+copy &quot;%usrLocalDir%\bin\libfontconfig-1.dll&quot; &quot;%admBuildDir%&quot;
+xcopy /s/y &quot;%usrLocalDir%\etc\fonts\*.*&quot; &quot;%admBuildDir%\etc\fonts\&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/fontconfig/libtool.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- libtool.orig	2010-11-27 22:40:35 +0000
++++ libtool	2010-11-27 22:52:21 +0000
+@@ -117,7 +117,7 @@
+ reload_cmds=&quot;\$LD\$reload_flag -o \$output\$reload_objs&quot;
+ 
+ # Method to check whether dependent libraries are shared objects.
+-deplibs_check_method=&quot;file_magic file format pei*-i386(.*architecture: i386)?&quot;
++deplibs_check_method=&quot;file_magic file format pei*-x86-64(.*architecture: i386)?&quot;
+ 
+ # Command to use when deplibs_check_method == &quot;file_magic&quot;.
+ file_magic_cmd=&quot;\$OBJDUMP -f&quot;

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Makefile.ref.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Makefile.ref.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Makefile.ref.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- src/Makefile.ref.orig	2010-11-28 02:53:57 +0000
++++ src/Makefile.ref	2010-11-28 02:53:12 +0000
+@@ -94,7 +94,7 @@
+ ifeq ($(OS_ARCH),WINNT)
+ _MSC_VER = $(shell $(CC) 2&gt;&amp;1 | sed -n 's/.*Compiler Version \([0-9]*\)\.\([0-9]*\).*/\1\2/p')
+ ifeq (,$(filter-out 1200 1300 1310,$(_MSC_VER)))
+-CFLAGS += -Op
++#CFLAGS += -Op
+ else
+ CFLAGS += -fp:precise
+ endif

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,76 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+%~d0
+cd &quot;%~dp0&quot;
+
+echo MSYS build for SpiderMonkey
+echo ===========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=js-1.7.0.tar.gz
+set sourceFolder=js-1.7.0-%BuildBits%
+set tarFolder=js
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://ftp.mozilla.org/pub/mozilla.org/js/%package%">http://ftp.mozilla.org/pub/mozilla.org/js/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%/%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+	move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Patching
+copy &quot;%curDir%\WINNT6.1.mk&quot; .\src\config
+patch -p0 -i &quot;%curDir%\Makefile.ref.patch&quot;
+patch -p0 -i &quot;%curDir%\jsnum.c.patch&quot;
+
+echo.
+cd src
+windres -i js3240.rc -o jsres.o -O coff
+set CFLAGS=%CFLAGS% -I&quot;%usrLocalDir%/include/nspr&quot;
+make -f Makefile.ref JS_DIST=&quot;%usrLocalDir%&quot; BUILD_OPT=1 JS_HAS_FILE_OBJECT=1 XLDFLAGS=&quot;%LDFLAGS% jsres.o -L%usrLocalDir%/lib -lnspr4&quot;
+if errorlevel 1 goto end
+echo.
+
+copy &quot;WINNT6.1_OPT.OBJ\libjs.dll&quot; &quot;%usrLocalDir%\bin&quot;
+copy &quot;%usrLocalDir%\bin\libjs.dll&quot; &quot;%admBuildDir%&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/WINNT6.1.mk
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/WINNT6.1.mk	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/WINNT6.1.mk	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,26 @@
+CC = gcc
+CCC = g++
+LD = g++
+
+CFLAGS +=  -Wall -Wno-format
+OS_CFLAGS = -D_X86_=1 -DXP_WIN -DXP_WIN32 -DWIN32 -D_WINDOWS -D_WIN32 -DWINVER=0x500 -D_WIN32_WINNT=0x500 -D_MINGW -DEXPORT_JS_API
+
+XMKSHLIBOPTS += -Wl,--out-implib=$(OBJDIR)/libjs.dll.a
+RANLIB = ranlib
+MKSHLIB = $(LD) -shared $(XMKSHLIBOPTS)
+
+ifdef BUILD_OPT
+OS_CFLAGS += -s
+endif
+
+#.c.o:
+#      $(CC) -c -MD $*.d $(CFLAGS) $&lt;
+
+CPU_ARCH = x86
+GFX_ARCH = win32
+
+JSDLL_CFLAGS = -DEXPORT_JS_API
+OS_LIBS = -lm -lc
+
+PREBUILT_CPUCFG = 1
+SO_SUFFIX=dll
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/jsnum.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/jsnum.c.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/js/jsnum.c.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- src/jsnum.c.orig	2007-04-06 21:53:22 +0100
++++ src/jsnum.c	2010-11-28 03:00:05 +0000
+@@ -528,7 +528,7 @@
+  * to 53 bit mantissa.
+  * On Alpha platform this is handled via Compiler option.
+  */
+-#define FIX_FPU() _control87(MCW_EM | PC_53, MCW_EM | MCW_PC)
++#define FIX_FPU() _control87(_MCW_EM | _PC_53, _MCW_EM | _MCW_PC)
+ 
+ #else
+ 

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,78 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for LAME
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=lame-3.98.4.tar.gz
+set sourceFolder=lame-3.98.4-%BuildBits%
+set tarFolder=lame-3.98.4
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://sourceforge.net/projects/lame/files/lame/3.98.4/%package%/download/">http://sourceforge.net/projects/lame/files/lame/3.98.4/%package%/download/</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+if &quot;%BuildBits%&quot; == &quot;64&quot; (
+	echo.
+	echo Patching
+	patch -p0 -i &quot;%curDir%\configure.patch&quot;
+	patch -p0 -i &quot;%curDir%\nasm.h.patch&quot;
+)
+
+echo.
+echo Configuring
+
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-static --enable-nasm
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+strip &quot;%usrLocalDir%\bin\libmp3lame-0.dll&quot;
+copy &quot;%usrLocalDir%\bin\libmp3lame-0.dll&quot; &quot;%admBuildDir%&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- configure.orig	2010-03-22 20:40:17 +0000
++++ configure	2010-11-27 20:28:19 +0000
+@@ -30152,7 +30152,7 @@
+ case $host_os in
+ 	*cygwin*|*mingw32*)
+ 		CYGWIN=yes
+-		NASM_FORMAT=&quot;-f win32 -DWIN32&quot;
++		NASM_FORMAT=&quot;-f win64 -DWIN32&quot;
+ 		;;
+ 	*darwin*)
+ 		NASM_FORMAT=&quot;-f macho&quot;

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,13 @@
+--- libmp3lame/i386/nasm.h.orig	2010-11-27 20:30:25 +0000
++++ libmp3lame/i386/nasm.h	2010-11-27 20:28:15 +0000
+@@ -45,7 +45,9 @@
+ %endif
+ 
+ %ifdef WIN32
+-	%define _NAMING
++	%ifnidn __OUTPUT_FORMAT__,win64
++		%define _NAMING
++	%endif
+ %endif
+ 
+ %ifdef __tos__

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,70 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for libogg
+echo =====================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=libogg-1.2.1.tar.gz
+set sourceFolder=libogg-1.2.1-%BuildBits%
+set tarFolder=libogg-1.2.1
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://downloads.xiph.org/releases/ogg/%package%">http://downloads.xiph.org/releases/ogg/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Configuring
+
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-static
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy &quot;%usrLocalDir%\bin\libogg-0.dll&quot; &quot;%admBuildDir%&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,75 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for libvorbis
+echo ========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=libvorbis-1.3.2.tar.gz
+set sourceFolder=libvorbis-1.3.2-%BuildBits%
+set tarFolder=libvorbis-1.3.2
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://downloads.xiph.org/releases/vorbis/%package%">http://downloads.xiph.org/releases/vorbis/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+	move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Configuring
+
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-static --disable-examples --disable-docs
+
+echo.
+echo Patching
+patch -p0 -i &quot;%curDir%\libtool.patch&quot;
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy &quot;%usrLocalDir%\bin\libvorbis-0.dll&quot; &quot;%admBuildDir%&quot;
+copy &quot;%usrLocalDir%\bin\libvorbisenc-2.dll&quot; &quot;%admBuildDir%&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvorbis/libtool.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,24 @@
+--- libtool.orig	2010-11-27 19:32:53 +0000
++++ libtool	2010-11-27 19:33:08 +0000
+@@ -6446,8 +6446,8 @@
+ 		esac
+ 		else
+ 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+-		  test -z &quot;$libdir&quot; &amp;&amp; \
+-		    func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
++		  #test -z &quot;$libdir&quot; &amp;&amp; \
++		    #func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
+ 		  test &quot;$absdir&quot; != &quot;$libdir&quot; &amp;&amp; \
+ 		    func_warning &quot;\`$deplib' seems to be moved&quot;
+ 
+@@ -8570,8 +8570,8 @@
+ 		func_basename &quot;$deplib&quot;
+ 		name=&quot;$func_basename_result&quot;
+ 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+-		test -z &quot;$libdir&quot; &amp;&amp; \
+-		  func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
++		#test -z &quot;$libdir&quot; &amp;&amp; \
++		  #func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
+ 		newdependency_libs=&quot;$newdependency_libs $libdir/$name&quot;
+ 		;;
+ 	      *) newdependency_libs=&quot;$newdependency_libs $deplib&quot; ;;

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,74 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for libvpx
+echo =====================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=libvpx-v0.9.5.tar.bz2
+set sourceFolder=libvpx-0.9.5-%BuildBits%
+set tarFolder=libvpx-v0.9.5
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://webm.googlecode.com/files/%package%">http://webm.googlecode.com/files/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfj &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Patching
+patch -p0 -i &quot;%curDir%\configure.patch&quot;
+patch -p0 -i &quot;%curDir%\configure.sh.patch&quot;
+
+echo.
+echo Configuring
+
+if &quot;%BuildBits%&quot; == &quot;32&quot; sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-vp8-encoder
+if &quot;%BuildBits%&quot; == &quot;64&quot; sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-vp8-encoder --target=x86_64-win64-gcc
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,10 @@
+--- configure.orig	2010-11-27 11:16:30 +0000
++++ configure	2010-11-27 11:15:53 +0000
+@@ -117,6 +117,7 @@
+ all_platforms=&quot;${all_platforms} x86_64-linux-gcc&quot;
+ all_platforms=&quot;${all_platforms} x86_64-linux-icc&quot;
+ all_platforms=&quot;${all_platforms} x86_64-solaris-gcc&quot;
++all_platforms=&quot;${all_platforms} x86_64-win64-gcc&quot;
+ all_platforms=&quot;${all_platforms} x86_64-win64-vs8&quot;
+ all_platforms=&quot;${all_platforms} x86_64-win64-vs9&quot;
+ all_platforms=&quot;${all_platforms} universal-darwin8-gcc&quot;

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.sh.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.sh.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libvpx/configure.sh.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,17 @@
+--- build/make/configure.sh.orig	2010-10-28 14:14:14 +0100
++++ build/make/configure.sh	2010-11-27 11:45:42 +0000
+@@ -877,8 +877,12 @@
+         [ &quot;${AS##*/}&quot; = nasm ] &amp;&amp; add_asflags -Ox
+         AS_SFX=.asm
+         case  ${tgt_os} in
+-            win*)
+-                add_asflags -f win${bits}
++            win32)
++                add_asflags -f win32
++                enabled debug &amp;&amp; add_asflags -g dwarf2
++            ;;
++			win64)
++                add_asflags -f x64
+                 enabled debug &amp;&amp; add_asflags -g dwarf2
+             ;;
+             linux*|solaris*)

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/nspr/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/nspr/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/nspr/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,80 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+%~d0
+cd &quot;%~dp0&quot;
+
+echo MSYS build for nspr
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=nspr-4.8.6.tar.gz
+set sourceFolder=nspr-4.8.6-%BuildBits%
+set tarFolder=nspr-4.8.6
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v4.8.6/src/%package%">ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v4.8.6/src/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%/%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+	move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Configuring
+cd mozilla\nsprpub
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --enable-strip --enable-win32-target=WIN95 --enable-optimize --disable-debug
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make
+if errorlevel 1 goto end
+
+make install
+if errorlevel 1 goto end
+
+move &quot;%usrLocalDir%\lib\nspr4.dll&quot; &quot;%usrLocalDir%\bin&quot;
+copy &quot;%usrLocalDir%\bin\nspr4.dll&quot; &quot;%admBuildDir%&quot;
+
+pexports &quot;%usrLocalDir%/bin/nspr4.dll&quot; &gt; nspr4.def
+dlltool -d nspr4.def -l &quot;%usrLocalDir%/lib/nspr4.dll.a&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,75 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for opencore-amr
+echo ===========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=opencore-amr-0.1.2.tar.gz
+set sourceFolder=opencore-amr-0.1.2-%BuildBits%
+set tarFolder=opencore-amr-0.1.2
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://sourceforge.net/projects/opencore-amr/files/opencore-amr/0.1.2/%package%/download">http://sourceforge.net/projects/opencore-amr/files/opencore-amr/0.1.2/%package%/download</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b %tarFolder%') do (
+  move &quot;%CD%\%tarFolder%\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Patching
+patch -p0 -i &quot;%curDir%\amrnb_Makefile.in&quot;
+patch -p0 -i &quot;%curDir%\amrwb_Makefile.in&quot;
+
+echo.
+echo Configuring
+
+sh ./configure --prefix=&quot;%usrLocalDir%&quot; --disable-static
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy &quot;%usrLocalDir%\bin\libopencore-amrnb-0.dll&quot; &quot;%admBuildDir%&quot;
+copy &quot;%usrLocalDir%\bin\libopencore-amrwb-0.dll&quot; &quot;%admBuildDir%&quot;
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrnb_Makefile.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrnb_Makefile.in	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrnb_Makefile.in	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- amrnb/Makefile.in.orig	2009-09-18 18:45:43 +0100
++++ amrnb/Makefile.in	2010-11-27 20:52:08 +0000
+@@ -274,7 +274,7 @@
+ pkgconfigdir = $(libdir)/pkgconfig
+ pkgconfig_DATA = opencore-amrnb.pc
+ lib_LTLIBRARIES = libopencore-amrnb.la
+-libopencore_amrnb_la_LDFLAGS = -version-info @OPENCORE_AMRNB_VERSION@
++libopencore_amrnb_la_LDFLAGS = -version-info @OPENCORE_AMRNB_VERSION@ -no-undefined
+ 
+ # Our sources to include. There are certain sources we exclude and they are
+ # $(DEC_SRC_DIR)/decoder_gsm_amr.cpp

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrwb_Makefile.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrwb_Makefile.in	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/opencore-amr/amrwb_Makefile.in	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- amrwb/Makefile.in.orig	2010-11-27 20:54:46 +0000
++++ amrwb/Makefile.in	2010-11-27 20:52:45 +0000
+@@ -250,7 +250,7 @@
+ pkgconfigdir = $(libdir)/pkgconfig
+ pkgconfig_DATA = opencore-amrwb.pc
+ lib_LTLIBRARIES = libopencore-amrwb.la
+-libopencore_amrwb_la_LDFLAGS = -version-info @OPENCORE_AMRWB_VERSION@
++libopencore_amrwb_la_LDFLAGS = -version-info @OPENCORE_AMRWB_VERSION@ -no-undefined
+ 
+ # Our sources to include. There are certain sources we exclude and they are
+ # $(DEC_SRC_DIR)/decoder_amr_wb.cpp

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat	2010-11-28 09:41:13 UTC (rev 6791)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -16,7 +16,7 @@
 verify &gt;nul
 call &quot;../Set Common Environment Variables&quot;
 
-if errorlevel 1 goto error
+if errorlevel 1 goto end
 
 set PATH=%PATH%;%devDir%\Git\bin
 
@@ -24,32 +24,26 @@
 del &quot;%usrLocalDir%\include\x264.h&quot;
 cd &quot;%devDir%&quot;
 
-if &quot;%BuildBits%&quot; == &quot;32&quot; (
-	set sourceFolder=x264
-	set buildFolder=build
-)
-
-if &quot;%BuildBits%&quot; == &quot;64&quot; (
-	set sourceFolder=x264-64
-	set buildFolder=build64
-	set configFlags=--host=x86_64-pc-mingw32
-)
-
+set sourceFolder=x264-%BuildBits%
 rm -r -f %sourceFolder%
+if errorlevel 1 goto end
 
 echo Downloading from git
 git clone <A HREF="git://git.videolan.org/x264.git">git://git.videolan.org/x264.git</A> %sourceFolder%
 if errorlevel 1 goto end
 
 cd &quot;%devDir%/%sourceFolder%&quot;
-sh ./configure --prefix=/usr/local --enable-shared %configFlags%
+
+if &quot;%BuildBits%&quot; == &quot;32&quot; sh ./configure --prefix=%usrLocalDir% --enable-shared
+if &quot;%BuildBits%&quot; == &quot;64&quot; sh ./configure --prefix=%usrLocalDir% --enable-shared --host=x86_64-pc-mingw32
+
 if errorlevel 1 goto end
 
 make install
 if errorlevel 1 goto end
 
-del &quot;%devDir%\avidemux_2.5_%buildFolder%\libx264-*.dll&quot;
-copy &quot;%usrLocalDir%/bin/libx264-*.dll&quot; &quot;%devDir%\avidemux_2.5_%buildFolder%&quot;
+del &quot;%admBuildDir%\libx264-*.dll&quot;
+copy &quot;%usrLocalDir%/bin/libx264-*.dll&quot; &quot;%admBuildDir%&quot;
 
 :end
 pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/Perform Build.bat	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,79 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">+ at echo</A> off
+
+echo MSYS build for Xvid
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify &gt;nul
+call &quot;../Set Common Environment Variables&quot;
+if errorlevel 1 goto end
+
+set package=xvidcore-1.2.2.tar.gz
+set sourceFolder=xvidcore-1.2.2-%BuildBits%
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget <A HREF="http://downloads.xvid.org/downloads/%package%">http://downloads.xvid.org/downloads/%package%</A>
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+mkdir &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+tar xfz &quot;%package%&quot; -C &quot;%devDir%\%sourceFolder%&quot;
+if errorlevel 1 goto end
+
+cd &quot;%devDir%\%sourceFolder%&quot;
+
+for /f &quot;delims=&quot; %%a in ('dir /b xvidcore') do (
+  move &quot;%CD%\xvidcore\%%a&quot; &quot;%CD%&quot;
+)
+
+echo.
+echo Patching
+patch -p0 -i &quot;%curDir%\configure.patch&quot;
+patch -p0 -i &quot;%curDir%\nasm.inc.patch&quot;
+
+echo.
+echo Configuring
+cd build\generic
+
+if &quot;%BuildBits%&quot; == &quot;32&quot; sh ./configure --prefix=&quot;%usrLocalDir%&quot;
+if &quot;%BuildBits%&quot; == &quot;64&quot; sh ./configure --prefix=&quot;%usrLocalDir%&quot; --build=x86_64-pc-mingw32
+if errorlevel 1 goto end
+echo.
+pause
+
+make LDFLAGS=&quot;%LDFLAGS% -Wl,-s&quot;
+if errorlevel 1 goto end
+
+make install
+if errorlevel 1 goto end
+
+move &quot;%usrLocalDir%\lib\xvidcore.dll&quot; &quot;%usrLocalDir%\bin&quot;
+copy &quot;%usrLocalDir%\bin\xvidcore.dll&quot; &quot;%admBuildDir%&quot;
+copy &quot;.\=build\xvidcore.dll.a&quot; &quot;%usrLocalDir%\lib&quot;
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/configure.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/configure.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/configure.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,11 @@
+--- build/generic/configure.orig	2009-05-28 18:13:31 +0100
++++ build/generic/configure	2010-11-27 10:25:35 +0000
+@@ -1319,7 +1319,7 @@
+ API_MAJOR=&quot;4&quot;
+ API_MINOR=&quot;2&quot;
+ 
+-minimum_yasm_minor_version=8
++minimum_yasm_minor_version=1
+ minimum_nasm_minor_version=0
+ minimum_nasm_major_version=2
+ nasm_prog=&quot;nasm&quot;

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/nasm.inc.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/nasm.inc.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/xvid/nasm.inc.patch	2010-11-28 09:48:11 UTC (rev 6792)
@@ -0,0 +1,16 @@
+--- src/nasm.inc.orig	2009-05-28 16:04:35 +0100
++++ src/nasm.inc	2010-11-27 10:51:04 +0000
+@@ -157,9 +157,10 @@
+ %define XVID_MOVSXD movsx
+ %endif
+ 
+-
+-%ifdef WINDOWS
+-      %define PREFIX
++%ifndef ARCH_IS_X86_64
++      %ifdef WINDOWS
++            %define PREFIX
++      %endif
+ %endif
+ 
+ %ifdef NO_PREFIX


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003970.html">[Avidemux-svn-commit] r6791 - in	branches/avidemux_2.5_branch_gruntster/cmake: . patches
</A></li>
	<LI>Next message: <A HREF="003972.html">[Avidemux-svn-commit] r6793 -	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3971">[ date ]</a>
              <a href="thread.html#3971">[ thread ]</a>
              <a href="subject.html#3971">[ subject ]</a>
              <a href="author.html#3971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
