<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6080 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_encoder ADM_libraries ADM_libraries/ADM_mplex	ADM_osSupport ADM_outputs/oplug_mpegFF ADM_toolkit	ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6080%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_encoder%20ADM_libraries%20ADM_libraries/ADM_mplex%0A%09ADM_osSupport%20ADM_outputs/oplug_mpegFF%20ADM_toolkit%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C201004061755.o36Ht6od005282%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003283.html">
   <LINK REL="Next"  HREF="003285.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6080 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_encoder ADM_libraries ADM_libraries/ADM_mplex	ADM_osSupport ADM_outputs/oplug_mpegFF ADM_toolkit	ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6080%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%20.%0A%09ADM_encoder%20ADM_libraries%20ADM_libraries/ADM_mplex%0A%09ADM_osSupport%20ADM_outputs/oplug_mpegFF%20ADM_toolkit%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C201004061755.o36Ht6od005282%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6080 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_encoder ADM_libraries ADM_libraries/ADM_mplex	ADM_osSupport ADM_outputs/oplug_mpegFF ADM_toolkit	ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Tue Apr  6 19:55:06 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003283.html">[Avidemux-svn-commit] r6079 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_outputs	cmake/patches
</A></li>
        <LI>Next message: <A HREF="003285.html">[Avidemux-svn-commit] r6081 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2010-04-06 19:54:55 +0200 (Tue, 06 Apr 2010)
New Revision: 6080

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_xvidratectl/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
Log:
[mpeg2enc] remove old mpeg2enc and xvid rate control logic

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -23,67 +23,6 @@
   NULL
 };
 
-#include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
-// ************ Mpeg2enc VCD *************
-Mpeg2encParam VCDExtra = {
-  (1152 * 1000) &gt;&gt; 3,		// Max BR
-  18,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
-
-
-COMPRES_PARAMS VCDCodec = {
-  CodecVCD,
-  QT_TR_NOOP(&quot;VCD (mpeg2enc)&quot;),
-  &quot;VCD&quot;,
-  &quot;Mpeg2enc (VCD)&quot;,
-  COMPRESS_CBR,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CBR,
-  ADM_EXTRA_PARAM,
-  &amp;VCDExtra,
-  sizeof (VCDExtra),
-  NULL
-};
-//************  MPEG2Enc SVCD *******************
-
-
-
-extern uint8_t DIA_SVCDParam (COMPRES_PARAMS * toto);
-
-
-Mpeg2encParam SVCDExtra = {
-  2500 ,		// Max BR
-  12,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
-
-COMPRES_PARAMS SVCDCodec = {
-  CodecSVCD,
-  QT_TR_NOOP(&quot;SVCD (mpeg2enc)&quot;),
-  &quot;SVCD&quot;,
-  &quot;Mpeg2enc (SVCD)&quot;,
-  COMPRESS_CQ,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
-  ADM_EXTRA_PARAM,
-  &amp;SVCDExtra,
-  sizeof (SVCDExtra),
-  DIA_SVCDParam
-};
-//*******************
 #if defined REQUANT_AS_CODE
 uint32_t RequantFactorExtra=1000; // 1000* the actual requant factor
 COMPRES_PARAMS RequantCodec = {
@@ -103,33 +42,7 @@
     DIA_requant
 };
 #endif
-//********************************************
-Mpeg2encParam DVDExtra = {
-  9000            ,		// Max BR
-  12,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
 
-COMPRES_PARAMS DVDCodec = {
-  CodecDVD,
-  QT_TR_NOOP(&quot;DVD (mpeg2enc)&quot;),
-  &quot;DVD&quot;,
-  &quot;Mpeg2enc (DVD)&quot;,
-  COMPRESS_CQ,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
-  ADM_EXTRA_PARAM,
-  &amp;DVDExtra,
-  sizeof (DVDExtra),
-  DIA_SVCDParam
-};
-
 COMPRES_PARAMS DUMMYONE =
   { CodecDummy, QT_TR_NOOP(&quot;dummy&quot;), &quot;dummy&quot;, &quot;dummy&quot;, COMPRESS_CQ, 4, 1500, 700,1000, 0, 0,
 NULL, 0 };
@@ -139,9 +52,6 @@
 
 COMPRES_PARAMS *internalVideoCodec[] = {
   &amp;CopyCodec,
-  &amp;VCDCodec,
-  &amp;SVCDCodec,
-  &amp;DVDCodec,
   &amp;RequantCodec,
   &amp;yv12codec,
   &amp;DUMMYONE

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2010-04-06 17:54:55 UTC (rev 6080)
@@ -20,9 +20,6 @@
 typedef enum 
 {
   CodecCopy,
-  CodecVCD,
-  CodecSVCD,
-  CodecDVD,
   CodecYV12,
   CodecRequant,
   CodecExternal,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,6 +1,6 @@
 SET(ADM_encoder_SRCS 
 	adm_encConfig.cpp  adm_encoder.cpp
-	adm_encCopy.cpp    adm_encmpeg2enc.cpp  adm_encRequant.cpp  adm_encyv12.cpp
+	adm_encCopy.cpp    adm_encRequant.cpp  adm_encyv12.cpp
 	ADM_pluginLoad.cpp ADM_externalEncoder.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_encoder ${ADM_encoder_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -49,7 +49,6 @@
 #include &quot;adm_encoder.h&quot;
 #include &quot;adm_encCopy.h&quot;
 #include &quot;adm_encyv12.h&quot;
-#include &quot;adm_encmpeg2enc.h&quot;
 #include &quot;adm_encRequant.h&quot;
 #include &quot;ADM_pluginLoad.h&quot;
 #include &quot;ADM_externalEncoder.h&quot;
@@ -87,10 +86,9 @@
 	{
 		return CodecFamilyXVCD;
 	}
-	else if ((currentCodecType == CodecExternal &amp;&amp; (
+	else if (currentCodecType == CodecExternal &amp;&amp; (
 		strcmp(videoCodecPluginGetGuid(), &quot;056FE919-C1D3-4450-A812-A767EAB07786&quot;) == 0 || // mpeg2enc MPEG-1 plugin
-		strcmp(videoCodecPluginGetGuid(), &quot;C16E9CCE-D9B3-4fbe-B0C5-8B1BEBF2178E&quot;) == 0)) || // mpeg2enc MPEG-2 plugin
-		currentCodecType == CodecVCD || currentCodecType == CodecSVCD || currentCodecType == CodecDVD || currentCodecType == CodecRequant)
+		strcmp(videoCodecPluginGetGuid(), &quot;C16E9CCE-D9B3-4fbe-B0C5-8B1BEBF2178E&quot;) == 0))  // mpeg2enc MPEG-2 plugin
 	{
 		return CodecFamilyMpeg;
 	}
@@ -195,56 +193,6 @@
 			aprintf (&quot;Follow mode\n&quot;);
 		}
 
-		// search for other options
-		if (!strcasecmp (cs, &quot;mbr&quot;))
-		{
-			compmode = NO_COMPRESSION_MODE;
-			iparam = (iparam * 1000) &gt;&gt; 3;
-
-			switch (currentCodecType)
-			{
-			case CodecSVCD:
-				SVCDExtra.maxBitrate = (int) iparam;
-				break;
-			case CodecDVD:
-				DVDExtra.maxBitrate = (int) iparam;
-				break;
-			default:
-				break;
-			}
-		}
-
-		if (!strcasecmp (cs, &quot;matrix&quot;))
-		{
-			compmode = NO_COMPRESSION_MODE;
-
-			switch (currentCodecType)
-			{
-			case CodecSVCD:
-				SVCDExtra.user_matrix = (int) iparam;
-				break;
-			case CodecDVD:
-				DVDExtra.user_matrix = (int) iparam;
-				break;
-			default:
-				break;
-			}
-		}
-
-		if (!strcmp (cs, &quot;ws&quot;))
-		{
-			switch (currentCodecType)
-			{
-			case CodecDVD:
-				DVDExtra.widescreen = 1;
-			case CodecSVCD:
-				SVCDExtra.widescreen = 1;
-				break;
-			default:
-				break;
-			}
-		}
-
 		if (compmode == UNSET_COMPRESSION_MODE)
 		{
 			printf (&quot;\n ***** Unknown mode for video codec (%s)\n&quot;, cmdString);
@@ -606,10 +554,6 @@
 	case CodecYV12:
 		e = new EncoderYV12 ();
 		break;
-	case CodecDVD:
-		e=new EncoderMpeg2enc(MPEG2ENC_DVD, desc);
-		printf(&quot;\n Using mpeg2enc encoder (DVD)\n&quot;);
-		break;
 	case CodecRequant:
 		if(!isMpeg12Compatible(avifileinfo-&gt;fcc))
 		{
@@ -621,14 +565,6 @@
 
 		printf(&quot;\n Using mpeg2 requant\n&quot;);
 		break;
-	case CodecSVCD:
-		e=new EncoderMpeg2enc(MPEG2ENC_SVCD, desc);
-		printf(&quot;\n Using mpeg2enc encoder (SVCD)\n&quot;);
-		break;
-	case CodecVCD:
-		e=new EncoderMpeg2enc(MPEG2ENC_VCD, desc);
-		printf(&quot;\n Using mpeg2enc encoder (VCD)\n&quot;);
-		break;
 	case CodecExternal:
 		e = new externalEncoder(&amp;AllVideoCodec[currentCodecIndex], globalHeaderFlag);
 		break;

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,113 +0,0 @@
-/***************************************************************************
-                          adm_encffmmatrix.g  -  description
-                             -------------------
-
-	Defined mpeg1/2 custom matrices
-
-    begin                : Tue Sep 1 2003
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#define ADM_MATRIX_DEFAULT 	0
-#define ADM_MATRIX_TMP	     	1
-#define ADM_MATRIX_ANIME	     	2
-#define ADM_MATRIX_KVCD 		3
-#define ADM_MATRIX_HRTMP	4
-
-static uint16_t tmpgenc_intra[64] = {
-  8, 16, 19, 22, 26, 27, 29, 34,
-  16, 16, 22, 24, 27, 29, 34, 37,
-  19, 22, 26, 27, 29, 34, 34, 38,
-  22, 22, 26, 27, 29, 34, 37, 40,
-  22, 26, 27, 29, 32, 35, 40, 48,
-  26, 27, 29, 32, 35, 40, 48, 58,
-  26, 27, 29, 34, 38, 46, 56, 69,
-  27, 29, 35, 38, 46, 56, 69, 83
-};
-static uint16_t tmpgenc_inter[64] = {
-  16, 17, 18, 19, 20, 21, 22, 23,	//0
-  17, 18, 19, 20, 21, 22, 23, 24,
-  18, 19, 20, 21, 22, 23, 24, 25,
-  19, 20, 21, 22, 23, 24, 26, 27,
-  20, 21, 22, 23, 25, 26, 27, 28,	//4
-  21, 22, 23, 24, 26, 27, 28, 30,
-  22, 23, 24, 26, 27, 28, 30, 31,
-  23, 24, 25, 27, 28, 30, 31, 33
-};
-static uint16_t anime_intra[64] = {
-  8, 32, 32, 32, 32, 32, 32, 32,	//0
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,	//4
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32
-};
-static uint16_t anime_inter[64] = {
-  16, 16, 16, 16, 16, 16, 16, 16,	//0
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,	//4
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-};
-//----------------------------------------------
-static uint16_t kvcd_intra[64] = {
-  8, 9, 12, 22, 26, 27, 29, 34,	//0
-  9, 10, 14, 26, 27, 29, 37, 37,
-  12, 14, 18, 27, 29, 34, 37, 38,
-  22, 26, 27, 31, 36, 37, 38, 40,
-
-  26, 27, 29, 36, 39, 38, 40, 48,	//4
-  27, 29, 34, 37, 38, 40, 48, 58,
-  29, 34, 37, 38, 40, 48, 58, 69,
-  34, 37, 38, 40, 48, 58, 69, 79
-};
-static uint16_t kvcd_inter[64] = {
-  16, 18, 20, 22, 24, 26, 28, 30,	//0
-  18, 20, 22, 24, 26, 28, 30, 32,	//0
-  20, 22, 24, 26, 28, 30, 32, 34,	//0
-  22, 24, 26, 28, 30, 32, 34, 36,	//0
-
-  24, 26, 28, 30, 32, 34, 36, 38,	//0
-  26, 28, 30, 32, 34, 36, 38, 40,	//0
-  28, 30, 32, 34, 36, 38, 40, 42,	//0
-  30, 32, 34, 36, 38, 40, 42, 44	//0
-};
-//----------------------------------------------
-static uint16_t hrtmpgenc_intra[64] = {
-// High resolution INTRA table
-  8, 16, 18, 20, 24, 25, 26, 30,
-  16, 16, 20, 23, 25, 26, 30, 30,
-  18, 20, 22, 24, 26, 28, 29, 31,
-  20, 21, 23, 24, 26, 28, 31, 31,
-  21, 23, 24, 25, 28, 30, 30, 33,
-  23, 24, 25, 28, 30, 30, 33, 36,
-  24, 25, 26, 29, 29, 31, 34, 38,
-  25, 26, 28, 29, 31, 34, 38, 42
-};
-static uint16_t hrtmpgenc_inter[64] = {
-// TMPEGEnc INTER table
-  16, 17, 18, 19, 20, 21, 22, 23,
-  17, 18, 19, 20, 21, 22, 23, 24,
-  18, 19, 20, 21, 22, 23, 24, 25,
-  19, 20, 21, 22, 23, 24, 26, 27,
-  20, 21, 22, 23, 25, 26, 27, 28,
-  21, 22, 23, 24, 26, 27, 28, 30,
-  22, 23, 24, 26, 27, 28, 30, 31,
-  23, 24, 25, 27, 28, 30, 31, 33
-};
-
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,431 +0,0 @@
-/***************************************************************************
-                         
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;math.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;time.h&gt;
-#include &lt;sys/time.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-#include &lt;errno.h&gt;
-
-#include &quot;fourcc.h&quot;
-#include &quot;ADM_osSupport/ADM_quota.h&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_assert.h&quot;
-
-
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_videoFilter.h&quot;
-#include &quot;ADM_encoder/adm_encoder.h&quot;
-#include &quot;ADM_encoder/adm_encConfig.h&quot;
-
-#include &quot;ADM_audiofilter/audioprocess.hxx&quot;
-
-#include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
-#include &quot;ADM_audiofilter/audioeng_buildfilters.h&quot;
-#include &quot;prefs.h&quot;
-#include &quot;adm_encmpeg2enc.h&quot;
-#include &quot;ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_ENCODER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-#warning FIXME: Duplicate define with mpeg2enc -&gt; bad
-#define MPEG_PREFILL 5
-
-static ADM_newXvidRcVBV *_xrc = NULL;
-extern uint32_t ADM_computeBitrate(uint32_t fps1000, uint32_t nbFrame, uint32_t sizeInMB);
-
-/**
-      \fn verifyLog
-      \brief Ask the RC if the 2pass log file is correct
-      @param file filename
-      @param nb nbFrames expected to be present
-      @return 1 if file is ok, 0 is corrupted
-
-*/
-uint8_t EncoderMpeg2enc::verifyLog(const char *file,uint32_t nbFrame)
-{
-      return ADM_newXvidRcVBV::verifyLog(file,nbFrame+2);
-}
-/*_________________________________________________*/
-EncoderMpeg2enc::EncoderMpeg2enc (MPEG2ENC_ID id, COMPRES_PARAMS * config)
-{
-  _frametogo = 0;
-  _pass1Done = 0;
-  _lastQz = 0;
-  _lastBitrate = 0;
-  _totalframe = 0;
-  _id=id;
-  memcpy (&amp;_param, config, sizeof (_param));
-  ADM_assert (config-&gt;extraSettingsLen == sizeof (_settings)); //Mpeg2encParam
-  memcpy (&amp;_settings, config-&gt;extraSettings, sizeof (_settings));
-  _delayed=0;
-  _availableFrames=0;
-
-};
-#define MPEG1_MIN_Q 2
-#define MPEG1_MAX_Q 28
-
-uint8_t     EncoderMpeg2enc::encode (uint32_t frame, ADMBitstream *out)
-{
-  uint32_t l,flags;
-  ADM_assert (_codec);
-  ADM_assert (_in);
-  ADM_rframe rf;
-  uint32_t asked;
-  uint32_t nq;
-  uint32_t nf;
-  ADM_rframe f;
-
-_retry:
-  asked=frame+_delayed;
-  if(asked&gt;=_availableFrames) asked=_availableFrames-1;
-  if (!_in-&gt;getFrameNumberNoAlloc (asked, &amp;l, _vbuffer, &amp;flags))
-  {
-    printf (&quot;\n Error : Cannot read incoming frame !&quot;);
-    return 0;
-  }
-  
-  if(_state==enc_Pass2)
-  {
-      _xrc-&gt;getQz (&amp;nq, &amp;f);
-      switch (f)
-      {
-        case RF_I:
-          nf = AVI_KEY_FRAME;
-          break;
-        default:
-          nf = 0;
-      }
-  
-      if (nq &lt; MPEG1_MIN_Q)
-        nq = MPEG1_MIN_Q;
-      if (nq &gt; MPEG1_MAX_Q)
-        nq = MPEG1_MAX_Q;
-  
-        //printf(&quot;asked :%d &quot;,nq);
-        out-&gt;in_quantizer=nq;
-        out-&gt;flags=nf;
-   }else
-  {
-      out-&gt;in_quantizer=0;
-  }
-   if(!_codec-&gt;encode (_vbuffer, out ))
-   {
-     printf(&quot;[mpeg2enc]Codec error frame %u delay %u\n&quot;, frame,_delayed);
-     return 0;
-   }
-   
-   switch (out-&gt;flags)
-   {
-     case AVI_KEY_FRAME:
-       rf = RF_I;
-       break;
-     case AVI_B_FRAME:
-       rf = RF_B;
-       break;
-     case 0:
-       rf = RF_P;
-       break;
-     default:
-       ADM_assert (0);
-
-   }
-   
-   switch(_state)
-   {
-     case enc_Pass1:
-        {
-          if (!out-&gt;len)
-          {
-            printf (&quot;Skipping delay\n&quot;);
-            goto _retry;
-          }
-         
-          _xrc-&gt;logPass1 (out-&gt;out_quantizer, rf, out-&gt;len);
-          _frametogo++;
-        }
-        break;
-     case enc_Pass2:
-     {
-       if (!out-&gt;len)
-       {
-         printf (&quot;Skipping delay\n&quot;);
-         goto _retry;
-       }
-       {
-         _xrc-&gt;logPass2 (out-&gt;out_quantizer, rf, out-&gt;len);
-       }
-     }
-     break;
-     default:
-       break;
-   }
-   return 1;
-}
-EncoderMpeg2enc::~EncoderMpeg2enc ()
-{
-  stop ();
-};
-
-
-
-//--------------------------------
-uint8_t     EncoderMpeg2enc::configure (AVDMGenericVideoStream * instream, int useExistingLogFile)
-{
-
-  ADM_assert (instream);
-  ADV_Info *info;
-  fd = NULL;
-
-  uint32_t flag1, flag2, flag3,qz,br;
-  flag1 = flag2 = flag3 = 0;
-
-  info = instream-&gt;getInfo ();
-  _fps1000 = info-&gt;fps1000;
-  _w = info-&gt;width;
-  _h = info-&gt;height;
-
-  _vbuffer = new ADMImage (_w, _h);
-  ADM_assert (_vbuffer);
-  _in = instream;
-
-  _availableFrames=instream-&gt;getInfo()-&gt;nb_frames;
-  
-  uint32_t interlaced=_settings.interlaced;
-  uint32_t bff=_settings.bff;
-  uint32_t widescreen=_settings.widescreen;
-  
-  _codec=NULL;
-  switch (_param.mode)
-  {
-    case COMPRESS_CQ:
-          qz=_param.qz;
-          br=_settings.maxBitrate*1000;
-          _state = enc_CQ;
-      break;
-    case COMPRESS_CBR:
-          qz=0;
-          br=_param.bitrate*1000;
-          _state = enc_CBR;
-          break;
-    case COMPRESS_2PASS:
-    case COMPRESS_2PASS_BITRATE:
-          qz=2;
-          br=0;
-          _state = enc_Pass1;
-          _xrc = new ADM_newXvidRcVBV (_fps1000, _logname);
-          break;
-  }
-  switch(_id)
-  {
-    case MPEG2ENC_VCD:
-      {
-        Mpeg2encVCD *dec;
-        dec = new Mpeg2encVCD (_w, _h);
-        dec-&gt;init (1, 0, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;	
-      }
-      break;
-    case MPEG2ENC_SVCD:
-    {
-        Mpeg2encSVCD * dec;
-        dec = new Mpeg2encSVCD (_w, _h);
-        dec-&gt;setMatrix (_settings.user_matrix);
-        dec-&gt;init (qz, br, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;
-    }
-        break;
-    case MPEG2ENC_DVD:
-      {
-        Mpeg2encDVD *dec;
-        dec = new Mpeg2encDVD (_w, _h);
-        dec-&gt;setMatrix (_settings.user_matrix);
-        dec-&gt;init (qz, br, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;
-      }
-      break;
-      default:
-        ADM_assert (0);
-    }
-
-  ADM_assert(_codec);
-
-  _in = instream;
-  printf (&quot;\n Mpeg2enc Encoder , w: %lu h:%lu mode:%d&quot;, _w, _h, _state);
-  return 1;
-}
-
-
-
-
-uint8_t    EncoderMpeg2enc::startPass1 (void)
-{
-  ADM_assert (_state == enc_Pass1);
-  _frametogo = 0;
-  printf (&quot;\n Starting pass 1\n&quot;);
-  printf (&quot; Creating logfile :%s\n&quot;, _logname);
-  _pass1Done = 1;
-  {
-    printf (&quot;Using Xvid 2 pass rate control (%s)\n&quot;, _logname);
-    _xrc-&gt;startPass1 ();
-  }
-  return 1;
-}
-
-int EncoderMpeg2enc::getRequirements (void) { return 0; }
-
-uint8_t   EncoderMpeg2enc::isDualPass (void)
-{
-  if ((_state == enc_Pass1) || (_state == enc_Pass2))
-  {
-    return 1;
-  }
-  return 0;
-}
-
-uint8_t    EncoderMpeg2enc::setLogFile (const char *lofile, uint32_t nbframe)
-{
-  strcpy (_logname, lofile);
-  _frametogo = nbframe;
-  _totalframe = nbframe;
-  return 1;
-}
-
-//_______________________________
-uint8_t     EncoderMpeg2enc::stop (void)
-{
-  printf (&quot;[Mpeg2enc]Stopping encoder\n&quot;);
-  if (_codec)     delete _codec;
-  _codec = NULL;
-    if (_state == enc_Pass1 || _state == enc_Pass2)
-    {
-      if (_xrc)
-      {
-        delete _xrc;
-        _xrc = NULL;
-      }
-
-    }
-  return 1;
-}
-//_______________________________
-
-uint8_t    EncoderMpeg2enc::startPass2 (void)
-{
-  uint32_t br,avg_bitrate,size;
-  
-  ADM_assert (_state == enc_Pass1);
-  printf (&quot;[Mpeg2enc]-------* Starting pass 2*-------------\n&quot;);
-
-  if(_param.mode==COMPRESS_2PASS)
-  {
-    br=ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
-    size=_param.finalsize;
-    printf(&quot;[Mpeg2enc] Final Size: %u MB, avg bitrate %u kb/s \n&quot;,size,br/1000);
-  }else if(_param.mode==COMPRESS_2PASS_BITRATE)
-  {
-    double d;
-    br=_param.avg_bitrate;
-    d=_totalframe;
-    d/=_fps1000;
-    d*=_param.avg_bitrate*1000*1000;
-    d/=(1024*1024);
-    size=(uint32_t )d;
-
-    printf(&quot;[Mpeg2enc]  Final Size: %u MB 2pass avg bitrate %u kb/s\n&quot;,size,br);
-    
-  }else ADM_assert(0);
-
-  uint32_t maxbr;
-
-  maxbr=_settings.maxBitrate*1000; // B/s
-
-  printf(&quot;[Mpeg2enc] Max bitrate %u kbps\n&quot;,maxbr/1000);
-  /* Check Max bitrate */
-  if(br&gt;maxbr)
-  {
-     br=maxbr;
-     printf(&quot;[Mpeg2enc] Max bitrate exceeeded, Clipping..\n&quot;);
-  }
-
-
-  printf (&quot;[Mpeg2enc] ** Total size     : %lu MBytes \n&quot;, _param.finalsize);
-  printf (&quot;[Mpeg2enc] ** Total frame    : %lu  \n&quot;, _totalframe);
-
-  printf (&quot;[Mpeg2enc] VBR parameters computed\n&quot;);
-  _state = enc_Pass2;
-  // Delete codec and start new one
-  if (_codec)
-  {
-    delete _codec;
-    _codec = NULL;
-  }
-
-  /*********/
-  uint32_t interlaced=_settings.interlaced;
-  uint32_t bff=_settings.bff;
-  uint32_t widescreen=_settings.widescreen;
-  uint32_t vbv;
-  
-  switch(_id)
-  {
-    case MPEG2ENC_SVCD:
-
-      Mpeg2encSVCD * dec;
-      dec = new Mpeg2encSVCD (_w, _h);
-      dec-&gt;setMatrix (_settings.user_matrix);
-      dec-&gt;init (2, br, _fps1000, interlaced, bff, widescreen, 0);	// WLA
-      _codec = dec;
-      vbv=122*1024;
-      break;
-    case MPEG2ENC_DVD:
-    {
-
-      Mpeg2encDVD *dec;
-      dec = new Mpeg2encDVD (_w, _h);
-      dec-&gt;setMatrix (_settings.user_matrix);
-      dec-&gt;init (2, br, _fps1000, interlaced, bff, widescreen, 0);	// WLA
-      _codec = dec;
-      vbv=224*1024;
-    }
-    break;
-    default:
-      ADM_assert (0);
-      break;
-  }
-  _xrc-&gt;setVBVInfo (_settings.maxBitrate, 0,  vbv);
-  ADM_assert (_xrc-&gt;startPass2 (size, _totalframe));
-  
-  printf (&quot;\n XV:ready to encode in 2pass(%s)\n&quot;, _logname);
-  _frametogo = 0;
-  return 1;
-
-
-}
-
-////***********************************
-////***********************************
-////***********************************
-////***********************************
-////***********************************

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,64 +0,0 @@
-/***************************************************************************
-                         
-    copyright            : (C) 2006 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ENC_MPEG2ENC_H
-#define ENC_MPEG2ENC_H
-#include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2Param.h&quot;
-#include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
-typedef enum 
-{
-  MPEG2ENC_INVALID=0,
-  MPEG2ENC_VCD=1,
-  MPEG2ENC_SVCD=2,
-  MPEG2ENC_DVD=3
-}MPEG2ENC_ID;
-
-class EncoderMpeg2enc:public Encoder
-{
-  private:
-    uint8_t setMatrix (void);
-    uint8_t _lastQz;
-    uint32_t _lastBitrate;
-    MPEG2ENC_ID _id;
-    Mpeg2encParam _settings;
-    Mpeg2enc      *_codec;
-    uint32_t      _fps1000;
-    uint32_t      _delayed;
-    uint32_t      _availableFrames;
-  public:
-
-
-    uint32_t _totalframe;
-    uint32_t _pass1Done;
-
-  public:
-    EncoderMpeg2enc (MPEG2ENC_ID id, COMPRES_PARAMS * config);
-    virtual ~ EncoderMpeg2enc ();	// can be called twice if needed ..
-	virtual int getRequirements (void);
-    virtual uint8_t isDualPass (void);
-    virtual uint8_t configure (AVDMGenericVideoStream * instream, int useExistingLogFile);
-    virtual uint8_t encode (uint32_t frame, ADMBitstream *out);
-    virtual uint8_t setLogFile (const char *p, uint32_t fr);
-    virtual uint8_t stop (void);
-    virtual uint8_t startPass2 (void);
-    virtual uint8_t startPass1 (void);
-    virtual const char *getCodecName (void) {return &quot;MPEG&quot;;};
-    virtual const char *getFCCHandler (void) {return &quot;MPEG&quot;;};
-    virtual const char *getDisplayName (void) {return QT_TR_NOOP(&quot;MPEG&quot;);}; // FIXME
-            uint8_t verifyLog(const char *name,uint32_t nbFrame);
-
-};
-
-#endif
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -4,7 +4,7 @@
 	ac3strm_in.cpp      ADM_mplexout.cpp   audiostrm_out.cpp  dtsstrm_in.cpp  lpcmstrm_in.cpp   multiplexor.cpp   stream_params.cpp  videostrm_in.cpp
 	ADM_mplexin.cpp     ADM_mthread.cpp    bits.cpp           inputstrm.cpp   padstrm.cpp       systems.cpp       videostrm_out.cpp
 	ADM_mplexmuxer.cpp  ADM_transfert.cpp  interact.cpp       mpastrm_in.cpp  stillsstream.cpp  mpegconsts.c      mjpeg_logging.c    decodebufmodel.cpp
-	yuv4mpeg.c          cpu_accel.c)
+	yuv4mpeg.c          yuv4mpeg_ratio.c   cpu_accel.c)
 
 include_directories(&quot;${PTHREAD_INCLUDE_DIR}&quot;)
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c	2010-04-06 17:54:55 UTC (rev 6080)
@@ -0,0 +1,157 @@
+/*
+ *  yuv4mpeg_ratio.c:  Functions for dealing with y4m_ratio_t datatype.
+ *
+ *  Copyright (C) 2001 Matthew J. Marjanovic &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">maddog at mir.com</A>&gt;
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version 2
+ *  of the License, or (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ *
+ */
+
+#include &lt;config.h&gt;
+
+#include &lt;string.h&gt;
+#include &quot;yuv4mpeg.h&quot;
+#include &quot;yuv4mpeg_intern.h&quot;
+
+
+/* useful list of standard framerates */
+const y4m_ratio_t y4m_fps_UNKNOWN    = Y4M_FPS_UNKNOWN;
+const y4m_ratio_t y4m_fps_NTSC_FILM  = Y4M_FPS_NTSC_FILM;
+const y4m_ratio_t y4m_fps_FILM       = Y4M_FPS_FILM;
+const y4m_ratio_t y4m_fps_PAL        = Y4M_FPS_PAL;
+const y4m_ratio_t y4m_fps_NTSC       = Y4M_FPS_NTSC;
+const y4m_ratio_t y4m_fps_30         = Y4M_FPS_30;
+const y4m_ratio_t y4m_fps_PAL_FIELD  = Y4M_FPS_PAL_FIELD;
+const y4m_ratio_t y4m_fps_NTSC_FIELD = Y4M_FPS_NTSC_FIELD;
+const y4m_ratio_t y4m_fps_60         = Y4M_FPS_60;
+
+/* useful list of standard sample aspect ratios */
+const y4m_ratio_t y4m_sar_UNKNOWN        = Y4M_SAR_UNKNOWN;
+const y4m_ratio_t y4m_sar_SQUARE         = Y4M_SAR_SQUARE;
+const y4m_ratio_t y4m_sar_SQR_ANA_16_9   = Y4M_SAR_SQR_ANA_16_9;
+const y4m_ratio_t y4m_sar_NTSC_CCIR601   = Y4M_SAR_NTSC_CCIR601;
+const y4m_ratio_t y4m_sar_NTSC_16_9      = Y4M_SAR_NTSC_16_9;
+const y4m_ratio_t y4m_sar_NTSC_SVCD_4_3  = Y4M_SAR_NTSC_SVCD_4_3;
+const y4m_ratio_t y4m_sar_NTSC_SVCD_16_9 = Y4M_SAR_NTSC_SVCD_16_9;
+const y4m_ratio_t y4m_sar_PAL_CCIR601    = Y4M_SAR_PAL_CCIR601;
+const y4m_ratio_t y4m_sar_PAL_16_9       = Y4M_SAR_PAL_16_9;
+const y4m_ratio_t y4m_sar_PAL_SVCD_4_3   = Y4M_SAR_PAL_SVCD_4_3;
+const y4m_ratio_t y4m_sar_PAL_SVCD_16_9  = Y4M_SAR_PAL_SVCD_16_9;
+
+/* useful list of standard display aspect ratios */
+const y4m_ratio_t y4m_dar_UNKNOWN        = Y4M_DAR_UNKNOWN;
+const y4m_ratio_t y4m_dar_4_3            = Y4M_DAR_4_3;
+const y4m_ratio_t y4m_dar_16_9           = Y4M_DAR_16_9;
+const y4m_ratio_t y4m_dar_221_100        = Y4M_DAR_221_100;
+
+/*
+ *  Euler's algorithm for greatest common divisor
+ */
+
+static int gcd(int a, int b)
+{
+  a = (a &gt;= 0) ? a : -a;
+  b = (b &gt;= 0) ? b : -b;
+
+  while (b &gt; 0) {
+    int x = b;
+    b = a % b;
+    a = x;
+  }
+  return a;
+}
+    
+
+/*************************************************************************
+ *
+ * Remove common factors from a ratio
+ *
+ *************************************************************************/
+
+
+void y4m_ratio_reduce(y4m_ratio_t *r)
+{
+  int d;
+  if ((r-&gt;n == 0) &amp;&amp; (r-&gt;d == 0)) return;  /* &quot;unknown&quot; */
+  d = gcd(r-&gt;n, r-&gt;d);
+  r-&gt;n /= d;
+  r-&gt;d /= d;
+}
+
+
+
+/*************************************************************************
+ *
+ * Parse &quot;nnn:ddd&quot; into a ratio
+ *
+ * returns:         Y4M_OK  - success
+ *           Y4M_ERR_RANGE  - range error 
+ *
+ *************************************************************************/
+
+int y4m_parse_ratio(y4m_ratio_t *r, const char *s)
+{
+  char *t = strchr(s, ':');
+  if (t == NULL) return Y4M_ERR_RANGE;
+  r-&gt;n = atoi(s);
+  r-&gt;d = atoi(t+1);
+  if (r-&gt;d &lt; 0) return Y4M_ERR_RANGE;
+  /* 0:0 == unknown, so that is ok, otherwise zero denominator is bad */
+  if ((r-&gt;d == 0) &amp;&amp; (r-&gt;n != 0)) return Y4M_ERR_RANGE;
+  y4m_ratio_reduce(r);
+  return Y4M_OK;
+}
+
+
+
+/*************************************************************************
+ *
+ * Guess the true SAR (sample aspect ratio) from a list of commonly 
+ * encountered values, given the &quot;suggested&quot; display aspect ratio, and
+ * the true frame width and height.
+ *
+ * Returns y4m_sar_UNKNOWN if no match is found.
+ *
+ *************************************************************************/
+
+/* this is big enough to accommodate the difference between 720 and 704 */
+#define GUESS_ASPECT_TOLERANCE 0.03
+
+y4m_ratio_t y4m_guess_sar(int width, int height, y4m_ratio_t dar)
+{
+  int i;
+  double implicit_sar = (double)(dar.n * height) / (double)(dar.d * width);
+  const y4m_ratio_t *sarray[] =
+    {
+      &amp;y4m_sar_SQUARE,
+      &amp;y4m_sar_NTSC_CCIR601,
+      &amp;y4m_sar_NTSC_16_9,
+      &amp;y4m_sar_NTSC_SVCD_4_3,
+      &amp;y4m_sar_NTSC_SVCD_16_9,
+      &amp;y4m_sar_PAL_CCIR601,
+      &amp;y4m_sar_PAL_16_9,
+      &amp;y4m_sar_PAL_SVCD_4_3,
+      &amp;y4m_sar_PAL_SVCD_16_9,
+      &amp;y4m_sar_UNKNOWN
+    };
+  for (i = 0; !(Y4M_RATIO_EQL(*(sarray[i]),y4m_sar_UNKNOWN)); i++) {
+    double ratio = implicit_sar / Y4M_RATIO_DBL(*(sarray[i]));
+    if ( (ratio &gt; (1.0 - GUESS_ASPECT_TOLERANCE)) &amp;&amp;
+	 (ratio &lt; (1.0 + GUESS_ASPECT_TOLERANCE)) )
+      return *(sarray[i]);
+  }
+  return y4m_sar_UNKNOWN;
+} 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,4 +1,3 @@
-add_subdirectory(ADM_libmpeg2enc)
 add_subdirectory(ADM_lvemux)
 add_subdirectory(ADM_mplex)
 
@@ -7,7 +6,6 @@
 endif (NOT USE_SYSTEM_SPIDERMONKEY)
 
 add_subdirectory(ADM_utilities)
-add_subdirectory(ADM_xvidratectl)
 
 if (ADM_DEBUG AND FIND_LEAKS)
 	add_subdirectory(ADM_nvwa)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -21,7 +21,6 @@
 #define  MODULE_MPEG_DEMUX	0x040000
 #define  MODULE_AUDIO_EDITOR    0x080000
 #define MODULE_INPIC		0x100000
-#define MODULE_MPEG2ENC		0x200000
 #define MODULE_ODML		0x400000
 #define MODULE_OGM_AUDIO	0x800000
 #define MODULE_REQUANT		0x1000000

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -207,15 +207,6 @@
       encoding =new DIA_encoding(_fps1000);
       switch (videoCodecGetType())
       {
-          case CodecVCD:
-            encoding-&gt;setCodec(QT_TR_NOOP(&quot;libmpeg2enc VCD&quot;));
-            break;
-          case CodecSVCD:
-            encoding-&gt;setCodec(QT_TR_NOOP(&quot;libmpeg2enc SVCD&quot;));
-            break;
-          case CodecDVD:
-            encoding-&gt;setCodec(QT_TR_NOOP(&quot;libmpeg2enc DVD&quot;));
-            break;
           case CodecRequant:
             encoding-&gt;setCodec(QT_TR_NOOP(&quot;MPEG Requantizer&quot;));
             break;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -207,17 +207,7 @@
 
 }  ;
 #define NB_AUTO (sizeof(reaction_table)/sizeof(AUTOMATON))
-//_________________________________________________________________________
 
-typedef enum {
-	SOME_UNKNOWN,
-	MPEG2ENC_VCD,    // pseudo codec with profile
-	MPEG2ENC_SVCD,   // pseudo codec with profile
-	MPEG2ENC_DVD     // pseudo codec with profile
-} codec_t;
-static codec_t codec = SOME_UNKNOWN;
-
-//void automation(int argc, char **argv)
 int automation(void )
 
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -8,7 +8,6 @@
 DIA_postproc.cpp  
 DIA_bitrateHisto.cpp  
 DIA_prefs.cpp     
-DIA_SVCD.cpp       
 DIA_builtin.cpp       
 DIA_lavDecoder.cpp  
 DIA_requant.cpp   

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,83 +0,0 @@
-//
-//
-// C++ Implementation: DIA_SVCD
-//
-// Description: 
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2003
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-#include &quot;config.h&quot;
-//#include &quot;ADM_lavcodec.h&quot;
-
-
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
-# include &lt;math.h&gt;
-
-#include &quot;ADM_default.h&quot;
-
-#include &quot;ADM_codecs/ADM_codec.h&quot;
-#include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_assert.h&quot; 
-#include &quot;DIA_factory.h&quot;
-#include &quot;../../ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
-
-/**
-      \fn DIA_SVCDParam
-      \brief Dialog to set encoding options for SVCD/DVD mpeg2enc based
-*/
-uint8_t DIA_SVCDParam(COMPRES_PARAMS *incoming)
-{	
-
-Mpeg2encParam *conf=(Mpeg2encParam *)incoming-&gt;extraSettings;
-ADM_assert(incoming-&gt;extraSettingsLen==sizeof(Mpeg2encParam));
-
-diaMenuEntry wideM[]={
-  {0,QT_TR_NOOP(&quot;4:3&quot;)},
-  {1,QT_TR_NOOP(&quot;16:9&quot;)}};
-diaMenuEntry matrixM[]={
-  {0,QT_TR_NOOP(&quot;Default&quot;)},
-  {1,QT_TR_NOOP(&quot;TMPGEnc&quot;)},
-  {2,QT_TR_NOOP(&quot;Anime&quot;)},
-  {3,QT_TR_NOOP(&quot;KVCD&quot;)}
-};
-diaMenuEntry interM[]={
-  {0,QT_TR_NOOP(&quot;Progressive&quot;)},
-  {1,QT_TR_NOOP(&quot;Interlaced TFF&quot;)},
-  {2,QT_TR_NOOP(&quot;Interlaced BFF&quot;)}
-};
-                      
-         diaElemBitrate bitrate(incoming,NULL);
-         diaElemMenu      widescreen(&amp;(conf-&gt;widescreen),QT_TR_NOOP(&quot;Aspect _ratio:&quot;),2,wideM);
-         diaElemMenu      matrix(&amp;(conf-&gt;user_matrix),QT_TR_NOOP(&quot;_Matrices:&quot;),4,matrixM);
-         diaElemUInteger gop(&amp;(conf-&gt;gop_size),QT_TR_NOOP(&quot;_GOP size:&quot;),1,30);
-         diaElemUInteger maxb(&amp;(conf-&gt;maxBitrate),QT_TR_NOOP(&quot;Ma_x. bitrate:&quot;),100,9000);
-
-uint32_t inter;
-          if(!conf-&gt;interlaced) inter=0;
-            else if(conf-&gt;bff) inter=2;
-                else inter=1;
-         diaElemMenu      interW(&amp;inter,QT_TR_NOOP(&quot;_Interlacing:&quot;),3,interM);
-  
-      diaElem *elems[6]={&amp;bitrate,&amp;widescreen,&amp;interW,&amp;matrix,&amp;gop,&amp;maxb};
-    
-  if( diaFactoryRun(QT_TR_NOOP(&quot;MPEG-2 Configuration&quot;),6,elems))
-  {
-    switch(inter)
-    {
-      case 0: conf-&gt;interlaced=0;conf-&gt;bff=0;break;
-      case 1: conf-&gt;interlaced=1;conf-&gt;bff=0;break;
-      case 2: conf-&gt;interlaced=1;conf-&gt;bff=1;break;
-      default: ADM_assert(0);
-    }
-    return 1;
-  }
-  return 0;
-}	
-// EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -101,7 +101,7 @@
 	SET(MACOSX_BUNDLE_SHORT_VERSION_STRING &quot;${ADM_OSX_VERSION}&quot;)
 	SET(MACOSX_BUNDLE_VERSION &quot;${ADM_OSX_VERSION}&quot;)
 	SET(MACOSX_BUNDLE_BUNDLE_NAME &quot;Avidemux&quot; )
-	SET(MACOSX_BUNDLE_COPYRIGHT &quot;Copyright 2001-2009 Mean&quot; )
+	SET(MACOSX_BUNDLE_COPYRIGHT &quot;Copyright 2001-2010 Mean&quot; )
 	SET(MACOSX_BUNDLE_SIGNATURE &quot;Avdx&quot; )
 	SET(MACOSX_BUNDLE_GUI_IDENTIFIER www.avidemux.org)
 
@@ -259,10 +259,8 @@
 
 ADD_ADMLIB_ALL_TARGETS(
 	ADM_mplex
-	ADM_libmpeg2enc
 	ADM_lvemux
 	ADM_utilities
-	ADM_xvidratectl
 )
 
 ADD_LIB_ALL_TARGETS(
@@ -483,5 +481,3 @@
                       WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
                       COMMENT &quot;Creating temporary lib directory for proper plugins linking&quot;)
 ENDIF (UNIX AND NOT APPLE)
-
-

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -56,7 +56,6 @@
 #include &quot;ADM_videoFilter.h&quot;
 #include &quot;ADM_videoFilter_internal.h&quot;
 #include &quot;ADM_encoder/ADM_vidEncode.hxx&quot;
-#include &quot;ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h&quot;
 #include &quot;ADM_video/ADM_vidMisc.h&quot;
 #include &quot;ADM_preview.h&quot;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003283.html">[Avidemux-svn-commit] r6079 - in	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_outputs	cmake/patches
</A></li>
	<LI>Next message: <A HREF="003285.html">[Avidemux-svn-commit] r6081 - in	branches/avidemux_2.5_branch_gruntster/avidemux: .	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_commonUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
