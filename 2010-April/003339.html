<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6135 - in	branches/avidemux_2.6_branch_mean/avidemux: .	common/ADM_script2 common/ADM_script2/include	common/ADM_script2/src common/ADM_script2/src_dialogFactory
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6135%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux%3A%20.%0A%09common/ADM_script2%20common/ADM_script2/include%0A%09common/ADM_script2/src%20common/ADM_script2/src_dialogFactory&In-Reply-To=%3C201004251430.o3PEUdEZ014981%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003338.html">
   <LINK REL="Next"  HREF="003340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6135 - in	branches/avidemux_2.6_branch_mean/avidemux: .	common/ADM_script2 common/ADM_script2/include	common/ADM_script2/src common/ADM_script2/src_dialogFactory</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6135%20-%20in%0A%09branches/avidemux_2.6_branch_mean/avidemux%3A%20.%0A%09common/ADM_script2%20common/ADM_script2/include%0A%09common/ADM_script2/src%20common/ADM_script2/src_dialogFactory&In-Reply-To=%3C201004251430.o3PEUdEZ014981%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6135 - in	branches/avidemux_2.6_branch_mean/avidemux: .	common/ADM_script2 common/ADM_script2/include	common/ADM_script2/src common/ADM_script2/src_dialogFactory">mean at mail.berlios.de
       </A><BR>
    <I>Sun Apr 25 16:30:39 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003338.html">[Avidemux-svn-commit] r6134 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv
</A></li>
        <LI>Next message: <A HREF="003340.html">[Avidemux-svn-commit] r6136 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3339">[ date ]</a>
              <a href="thread.html#3339">[ thread ]</a>
              <a href="subject.html#3339">[ subject ]</a>
              <a href="author.html#3339">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-04-25 16:30:38 +0200 (Sun, 25 Apr 2010)
New Revision: 6135

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
Log:
[JS/DF] Import from 2.5

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt	2010-04-25 14:30:38 UTC (rev 6135)
@@ -1 +1,2 @@
 subdirs (src)
+subdirs (src_dialogFactory)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -25,8 +25,11 @@
 #include &quot;ADM_jsUtils.h&quot;
 #include &quot;ADM_jsShell.h&quot;
 #include &quot;ADM_jsDebug.h&quot;
+#include &quot;ADM_jsDFactory.h&quot;
 
 typedef JSBool JS_PROTOTYPE(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+
 /**
     \struct ADM_JS_HOOK
 */

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,21 @@
+/**
+    \file ADM_jsDialogFactory.h
+    \brief Base class for dialog factory mapping
+    \author mean, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef ADM_JS_DIALOG_H
+#define ADM_JS_DIALOG_H
+#include &quot;ADM_jsIf.h&quot;
+extern &quot;C&quot;  JSObject *jsDialogFactoryInit(JSContext *cx,JSObject *obj);
+
+#endif // ADM_JS_SHELL_H

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -23,7 +23,7 @@
 static void *jsLoggerCookie=NULL;
 vector &lt;ADM_JS_HOOK &gt;jsHooks;
 extern ADM_Composer *video_body;
-
+extern bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj);
 #define JSVAR(a,b,c) a b=c
 
 #if defined( __MINGW32__) 
@@ -147,6 +147,7 @@
 extern &quot;C&quot; JSFunctionSpec  *jsGetTestFunctions(void);
 extern &quot;C&quot; JSFunctionSpec  *jsGetAdmFunctions(void);
 extern &quot;C&quot; JSFunctionSpec  *jsGetEditFunctions(void);
+extern &quot;C&quot; JSFunctionSpec  *jsGetDialogFactoryFunctions(void);
 extern &quot;C&quot; JSObject *jsEditorInit(JSContext *cx,JSObject *obj);
 extern &quot;C&quot; JSObject *jsAvidemuxInit(JSContext *cx,JSObject *obj);
 static bool registerOne(const char *name,const char *text,JSFunctionSpec *s,JSContext *cx,JSObject *obj)
@@ -222,9 +223,16 @@
             h.name=&quot;editor&quot;;
             h.text=&quot;Please prefix this with editor.&quot;;
             h.jsFunctions=jsGetEditFunctions();
+            jsEditorInit(cx,obj);
             jsHooks.push_back(h);
-            jsEditorInit(cx,obj);
-            return true;
+        // Register dialogFactory functions
+#if 0
+            h.name=&quot;dialog&quot;;
+            h.text=&quot;.&quot;;
+            h.jsFunctions=jsGetDialogFactoryFunctions();
+            jsHooks.push_back(h);
+#endif
+            return ADM_JSDialogFactoryInit(cx,obj);
 }
 /**
     \fn SpidermonkeyInit

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,193 @@
+/**
+    \file   ADM_JSDFMenu.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDFMenu.h&quot;
+
+ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_menuEntries = NULL;
+	_index = 0;
+}
+
+ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+	std::vector&lt;char*&gt;::iterator it;
+
+	for (it = _items.begin(); it != _items.end(); it++)
+		delete *it;
+
+	_items.clear();
+
+	if (_menuEntries)
+		delete _menuEntries;
+
+	_menuEntries = NULL;
+}
+
+void ADM_JSDFMenuHelper::addItem(const char* item)
+{
+	_items.push_back(ADM_strdup(item));
+}
+
+diaElem* ADM_JSDFMenuHelper::getControl(void)
+{
+	if (_menuEntries)
+		delete _menuEntries;
+
+	std::vector&lt;char*&gt;::iterator it;
+	int i = 0;
+
+	_menuEntries = new diaMenuEntry[_items.size()];	
+
+	for (it = _items.begin(); it != _items.end(); it++)
+	{
+		_menuEntries[i].val = i;
+		_menuEntries[i].text = *it;
+		_menuEntries[i].desc = NULL;
+
+		i++;
+	}
+
+	return new diaElemMenu(&amp;_index, _title, _items.size(), _menuEntries);
+}
+
+int ADM_JSDFMenuHelper::index(void)
+{
+	return _index;
+}
+
+void ADM_JSDFMenuHelper::setIndex(int index)
+{
+	_index = index;
+}
+
+JSPropertySpec ADM_JSDFMenu::properties[] = 
+{ 
+	{ &quot;index&quot;, indexProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFMenu::methods[] =
+{
+	{ &quot;addItem&quot;, addItem, 1, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDFMenu::m_dfMenuHelper =
+{
+	&quot;DFMenu&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
+};
+
+JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dfMenuHelper, 
+		ADM_JSDFMenu::JSConstructor, 1,
+		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	pObject-&gt;addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject-&gt;index());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject-&gt;setIndex(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,65 @@
+/**
+    \file   ADM_JSDFMenu.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFMenu_H
+#define _ADM_JSDFMenu_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &lt;vector&gt;
+
+class ADM_JSDFMenuHelper
+{
+private:
+	char* _title;
+	uint32_t _index;
+	diaMenuEntry *_menuEntries;
+	std::vector &lt;char*&gt; _items;
+
+public:
+	ADM_JSDFMenuHelper(const char *title);
+	~ADM_JSDFMenuHelper(void);
+	void addItem(const char* item);
+	diaElem* getControl(void);
+	int index(void);
+	void setIndex(int index);
+};
+
+class ADM_JSDFMenu
+{
+public:
+	ADM_JSDFMenu(void) {}
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+
+	static JSBool addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
+
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass m_dfMenuHelper;
+
+	enum
+	{
+		indexProperty
+	};
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,138 @@
+/**
+    \file   ADM_JSDialogFactory.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDialogFactory.h&quot;
+
+ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+}
+
+ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+}
+
+void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFMenuHelper* control)
+{
+	_controls.push_back(control);
+}
+
+diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
+{
+	*controlCount = (int)_controls.size();
+
+	std::vector&lt;ADM_JSDFMenuHelper*&gt;::iterator it;
+	int i = 0;
+	diaElem **elems = new diaElem*[*controlCount];
+
+	for (it = _controls.begin(); it != _controls.end(); it++)
+	{
+		elems[i] = (*it)-&gt;getControl();
+		i++;
+	}
+
+	return elems;
+}
+
+const char* ADM_JSDialogFactoryHelper::title(void)
+{
+	return _title;
+}
+
+JSFunctionSpec ADM_JSDialogFactory::methods[] =
+{
+	{ &quot;addControl&quot;, addControl, 1, 0, 0 },
+	{ &quot;show&quot;, show, 0, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
+{
+	&quot;DialogFactory&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
+};
+
+JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dialogFactoryHelper, 
+		ADM_JSDialogFactory::JSConstructor, 1,
+		NULL, ADM_JSDialogFactory::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (JSVAL_IS_STRING(argv[0]) == false)
+		return JS_FALSE;
+
+	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (pObject != NULL)
+		delete pObject;
+}
+
+JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	p-&gt;addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (argc != 0)
+		return JS_FALSE;
+
+	int controlCount;
+	diaElem **elems = p-&gt;getControls(&amp;controlCount);
+
+	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p-&gt;title(), controlCount, elems));
+
+	for (int i = 0; i &lt; controlCount; i++)
+		delete elems[i];
+
+	delete elems;
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,61 @@
+/**
+    \file   ADM_JSDialogFactory.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDialogFactory_H
+#define _ADM_JSDialogFactory_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDFMenu.h&quot;
+#include &lt;vector&gt;
+/**
+    \class ADM_JSDialogFactoryHelper
+*/
+class ADM_JSDialogFactoryHelper
+{
+private:
+	char* _title;
+	std::vector &lt;ADM_JSDFMenuHelper*&gt; _controls;
+
+public:
+	ADM_JSDialogFactoryHelper(const char *title);
+	~ADM_JSDialogFactoryHelper(void);
+	void addControl(ADM_JSDFMenuHelper* control);
+	diaElem** getControls(int *controlCount);
+	const char* title(void);
+};
+/**
+    \class ADM_JSDialogFactory
+*/
+
+class ADM_JSDialogFactory
+{
+public:
+	ADM_JSDialogFactory(void) {}
+	virtual ~ADM_JSDialogFactory(void);
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+	static JSFunctionSpec methods[];
+	static JSClass m_dialogFactoryHelper;
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,11 @@
+SET(ADM_scriptDF_SRCS
+        ADM_JSDFMenu.cpp
+        ADM_JSDialogFactory.cpp
+        ADM_JSDialogFactory_if.cpp 
+)
+
+ADD_DEFINITIONS(&quot;-DJS_THREADSAFE -DXP_UNIX&quot;)
+ADD_LIBRARY(ADM_scriptDF STATIC ${ADM_scriptDF_SRCS})
+include_directories(../include)
+include_directories(.)
+include_directories(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_smjs)

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-25 14:30:38 UTC (rev 6135)
@@ -98,6 +98,7 @@
 ADM_requant6 
 #ADM_script6 
 ADM_script26 
+ADM_scriptDF
 ADM_videoEncoder6 
 ADM_internalVideoFilter6
 ADM_toolkit6


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003338.html">[Avidemux-svn-commit] r6134 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv
</A></li>
	<LI>Next message: <A HREF="003340.html">[Avidemux-svn-commit] r6136 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3339">[ date ]</a>
              <a href="thread.html#3339">[ thread ]</a>
              <a href="subject.html#3339">[ subject ]</a>
              <a href="author.html#3339">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
