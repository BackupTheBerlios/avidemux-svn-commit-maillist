<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6133 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script: .	dialogFactory
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6133%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script%3A%20.%0A%09dialogFactory&In-Reply-To=%3C201004191802.o3JI2Rur030842%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003336.html">
   <LINK REL="Next"  HREF="003338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6133 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script: .	dialogFactory</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6133%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script%3A%20.%0A%09dialogFactory&In-Reply-To=%3C201004191802.o3JI2Rur030842%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6133 - in	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script: .	dialogFactory">mean at mail.berlios.de
       </A><BR>
    <I>Mon Apr 19 20:02:27 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003336.html">[Avidemux-svn-commit] r6132 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
</A></li>
        <LI>Next message: <A HREF="003338.html">[Avidemux-svn-commit] r6134 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3337">[ date ]</a>
              <a href="thread.html#3337">[ thread ]</a>
              <a href="subject.html#3337">[ subject ]</a>
              <a href="author.html#3337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2010-04-19 20:02:26 +0200 (Mon, 19 Apr 2010)
New Revision: 6133

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt
Log:
[js/dialogFactory] Add toggle and integer to existing menu

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,177 +0,0 @@
-#include &quot;ADM_JSDFMenu.h&quot;
-
-ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
-{
-	_title = ADM_strdup(title);
-	_menuEntries = NULL;
-	_index = 0;
-}
-
-ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
-{
-	if (_title)
-		delete _title;
-
-	_title = NULL;
-
-	std::vector&lt;char*&gt;::iterator it;
-
-	for (it = _items.begin(); it != _items.end(); it++)
-		delete *it;
-
-	_items.clear();
-
-	if (_menuEntries)
-		delete _menuEntries;
-
-	_menuEntries = NULL;
-}
-
-void ADM_JSDFMenuHelper::addItem(const char* item)
-{
-	_items.push_back(ADM_strdup(item));
-}
-
-diaElem* ADM_JSDFMenuHelper::getControl(void)
-{
-	if (_menuEntries)
-		delete _menuEntries;
-
-	std::vector&lt;char*&gt;::iterator it;
-	int i = 0;
-
-	_menuEntries = new diaMenuEntry[_items.size()];	
-
-	for (it = _items.begin(); it != _items.end(); it++)
-	{
-		_menuEntries[i].val = i;
-		_menuEntries[i].text = *it;
-		_menuEntries[i].desc = NULL;
-
-		i++;
-	}
-
-	return new diaElemMenu(&amp;_index, _title, _items.size(), _menuEntries);
-}
-
-int ADM_JSDFMenuHelper::index(void)
-{
-	return _index;
-}
-
-void ADM_JSDFMenuHelper::setIndex(int index)
-{
-	_index = index;
-}
-
-JSPropertySpec ADM_JSDFMenu::properties[] = 
-{ 
-	{ &quot;index&quot;, indexProperty, JSPROP_ENUMERATE },
-	{ 0 }
-};
-
-JSFunctionSpec ADM_JSDFMenu::methods[] =
-{
-	{ &quot;addItem&quot;, addItem, 1, 0, 0 },
-	{ 0 }
-};
-
-JSClass ADM_JSDFMenu::m_dfMenuHelper =
-{
-	&quot;DFMenu&quot;, JSCLASS_HAS_PRIVATE,
-	JS_PropertyStub, JS_PropertyStub,
-	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
-	JS_EnumerateStub, JS_ResolveStub,
-	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
-};
-
-JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
-{
-	return JS_InitClass(cx, obj, proto, &amp;m_dfMenuHelper, 
-		ADM_JSDFMenu::JSConstructor, 1,
-		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
-		NULL, NULL);
-}
-
-JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (!JSVAL_IS_STRING(argv[0]))
-		return JS_FALSE;
-
-	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	if (!JS_SetPrivate(cx, obj, pObject))
-		return JS_FALSE;
-
-	*rval = OBJECT_TO_JSVAL(obj);
-
-	return JS_TRUE;
-}
-
-void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
-{
-	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
-
-	if (pObject)
-		delete pObject;
-}
-
-JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
-
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (!JSVAL_IS_STRING(argv[0]))
-		return JS_FALSE;
-
-	pObject-&gt;addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
-{
-	if (JSVAL_IS_INT(id)) 
-	{
-		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
-
-		switch(JSVAL_TO_INT(id))
-		{
-			case indexProperty:
-			{
-				*vp = INT_TO_JSVAL(pObject-&gt;index());
-				break;
-			}
-		}
-	}
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
-{
-	if (JSVAL_IS_INT(id)) 
-	{
-		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
-
-		switch(JSVAL_TO_INT(id))
-		{
-			case indexProperty:
-			{
-				if (JSVAL_IS_INT(*vp))
-					pObject-&gt;setIndex(JSVAL_TO_INT(*vp));
-
-				break;
-			}
-			default:
-				return JS_FALSE;
-		}
-	}
-
-	return JS_TRUE;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,50 +0,0 @@
-#ifndef _ADM_JSDFMenu_H
-#define _ADM_JSDFMenu_H
-
-#include &quot;config.h&quot;
-#include &quot;jsapi.h&quot;
-#include &quot;DIA_factory.h&quot;
-#include &lt;vector&gt;
-
-class ADM_JSDFMenuHelper
-{
-private:
-	char* _title;
-	uint32_t _index;
-	diaMenuEntry *_menuEntries;
-	std::vector &lt;char*&gt; _items;
-
-public:
-	ADM_JSDFMenuHelper(const char *title);
-	~ADM_JSDFMenuHelper(void);
-	void addItem(const char* item);
-	diaElem* getControl(void);
-	int index(void);
-	void setIndex(int index);
-};
-
-class ADM_JSDFMenu
-{
-public:
-	ADM_JSDFMenu(void) {}
-
-	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
-								jsval *argv, jsval *rval);
-	static void JSDestructor(JSContext *cx, JSObject *obj);
-	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
-	static JSBool JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
-	static JSBool JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
-
-	static JSBool addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
-
-	static JSPropertySpec properties[];
-	static JSFunctionSpec methods[];
-	static JSClass m_dfMenuHelper;
-
-	enum
-	{
-		indexProperty
-	};
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,123 +0,0 @@
-#include &quot;ADM_JSDialogFactory.h&quot;
-
-ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
-{
-	_title = ADM_strdup(title);
-}
-
-ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
-{
-	if (_title)
-		delete _title;
-
-	_title = NULL;
-}
-
-void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFMenuHelper* control)
-{
-	_controls.push_back(control);
-}
-
-diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
-{
-	*controlCount = (int)_controls.size();
-
-	std::vector&lt;ADM_JSDFMenuHelper*&gt;::iterator it;
-	int i = 0;
-	diaElem **elems = new diaElem*[*controlCount];
-
-	for (it = _controls.begin(); it != _controls.end(); it++)
-	{
-		elems[i] = (*it)-&gt;getControl();
-		i++;
-	}
-
-	return elems;
-}
-
-const char* ADM_JSDialogFactoryHelper::title(void)
-{
-	return _title;
-}
-
-JSFunctionSpec ADM_JSDialogFactory::methods[] =
-{
-	{ &quot;addControl&quot;, addControl, 1, 0, 0 },
-	{ &quot;show&quot;, show, 0, 0, 0 },
-	{ 0 }
-};
-
-JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
-{
-	&quot;DialogFactory&quot;, JSCLASS_HAS_PRIVATE,
-	JS_PropertyStub, JS_PropertyStub,
-	JS_PropertyStub, JS_PropertyStub,
-	JS_EnumerateStub, JS_ResolveStub,
-	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
-};
-
-JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
-{
-	return JS_InitClass(cx, obj, proto, &amp;m_dialogFactoryHelper, 
-		ADM_JSDialogFactory::JSConstructor, 1,
-		NULL, ADM_JSDialogFactory::methods,
-		NULL, NULL);
-}
-
-JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (JSVAL_IS_STRING(argv[0]) == false)
-		return JS_FALSE;
-
-	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	if (!JS_SetPrivate(cx, obj, pObject))
-		return JS_FALSE;
-
-	*rval = OBJECT_TO_JSVAL(obj);
-
-	return JS_TRUE;
-}
-
-void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
-{
-	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
-
-	if (pObject != NULL)
-		delete pObject;
-}
-
-JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
-
-	if (argc != 1)
-		return JS_FALSE;
-
-	p-&gt;addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
-
-	if (argc != 0)
-		return JS_FALSE;
-
-	int controlCount;
-	diaElem **elems = p-&gt;getControls(&amp;controlCount);
-
-	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p-&gt;title(), controlCount, elems));
-
-	for (int i = 0; i &lt; controlCount; i++)
-		delete elems[i];
-
-	delete elems;
-
-	return JS_TRUE;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,41 +0,0 @@
-#ifndef _ADM_JSDialogFactory_H
-#define _ADM_JSDialogFactory_H
-
-#include &quot;config.h&quot;
-#include &quot;jsapi.h&quot;
-#include &quot;DIA_factory.h&quot;
-#include &quot;ADM_JSDFMenu.h&quot;
-#include &lt;vector&gt;
-
-class ADM_JSDialogFactoryHelper
-{
-private:
-	char* _title;
-	std::vector &lt;ADM_JSDFMenuHelper*&gt; _controls;
-
-public:
-	ADM_JSDialogFactoryHelper(const char *title);
-	~ADM_JSDialogFactoryHelper(void);
-	void addControl(ADM_JSDFMenuHelper* control);
-	diaElem** getControls(int *controlCount);
-	const char* title(void);
-};
-
-class ADM_JSDialogFactory
-{
-public:
-	ADM_JSDialogFactory(void) {}
-	virtual ~ADM_JSDialogFactory(void);
-
-	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
-								jsval *argv, jsval *rval);
-	static void JSDestructor(JSContext *cx, JSObject *obj);
-	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
-	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
-	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
-
-	static JSFunctionSpec methods[];
-	static JSClass m_dialogFactoryHelper;
-};
-
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -18,12 +18,13 @@
 #include &quot;ADM_JSGlobal.h&quot;
 #include &quot;ADM_JSAvidemux.h&quot;
 #include &quot;ADM_JSDirectorySearch.h&quot;
-#include &quot;ADM_JSDialogFactory.h&quot;
-#include &quot;ADM_JSDFMenu.h&quot;
+#include &quot;dialogFactory/ADM_JSDialogFactory.h&quot;
+#include &quot;dialogFactory/ADM_JSDFMenu.h&quot;
 
 extern uint8_t JS_AvidemuxFunction(JSContext *cx,JSObject *global);
 extern void A_Resync(void);
 extern char * actual_workbench_file;
+extern bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj);
 
 void
 printJSError(JSContext *cx, const char *message, JSErrorReport *report)
@@ -96,9 +97,10 @@
 			// load our custom JS class objects
 			JSObject *obj = ADM_JSAvidemux::JSInit(cx, global);
 			JSObject *dsObj = ADM_JSDirectorySearch::JSInit(cx, global);
-			JSObject *df = ADM_JSDialogFactory::JSInit(cx, global);
-			JSObject *dfmenu = ADM_JSDFMenu::JSInit(cx, global);
-
+                        if(false==ADM_JSDialogFactoryInit(cx,global))
+                        {
+                                printf(&quot;Cannot register dialog factory classes \n&quot;);
+                        }
 			// register error handler
 			JS_SetErrorReporter(cx, printJSError);
                         JS_AvidemuxFunction(cx,global);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,7 +1,13 @@
 SET(ADM_script_SRCS
 	ADM_AvidemuxAudio.cpp  ADM_AvidemuxVideo.cpp    ADM_JSAvidemux.cpp       ADM_JSDirectorySearch.cpp  ADM_JSGlobal.cpp
 	ADM_Avidemux.cpp       ADM_JSAvidemuxAudio.cpp  ADM_JSAvidemuxVideo.cpp  ADM_JSFunctions.cpp        DirectorySearch.cpp
-	ADM_JSDialogFactory.cpp  ADM_JSDFMenu.cpp  ADM_JSAppliedVideoFilter.cpp  ADM_JSAudioTrackInfo.cpp)
+        ADM_JSAppliedVideoFilter.cpp  ADM_JSAudioTrackInfo.cpp
+        dialogFactory/ADM_JSDFMenu.cpp
+        dialogFactory/ADM_JSDFToggle.cpp
+        dialogFactory/ADM_JSDialogFactory.cpp
+        dialogFactory/ADM_JSDialogFactory_if.cpp
+        dialogFactory/ADM_JSDFInteger.cpp
+)
 
 include_directories(&quot;${PTHREAD_INCLUDE_DIR}&quot;)
 ADD_ADM_LIB_ALL_TARGETS(ADM_script ${ADM_script_SRCS})
@@ -16,4 +22,4 @@
 	include_directories(${SPIDERMONKEY_INCLUDE_DIR})
 else (USE_SYSTEM_SPIDERMONKEY)
 	include_directories(${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ADM_smjs)
-endif (USE_SYSTEM_SPIDERMONKEY)
\ No newline at end of file
+endif (USE_SYSTEM_SPIDERMONKEY)

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,35 @@
+/**
+    \file   ADM_JSDF.h
+    \brief  JS / DF binding
+    \author gruntster/Mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDF_H
+#define _ADM_JSDF_H
+
+/**
+    \class ADM_JSBaseHelper
+*/
+class ADM_JSDFBaseHelper
+{
+public:
+                        ADM_JSDFBaseHelper() {};
+    virtual             ~ADM_JSDFBaseHelper() {};
+    virtual diaElem*    getControl(void)=0;
+};
+// Compatibility with 2.6
+#define ADM_error printf
+#define ADM_info  printf
+
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,160 @@
+/**
+    \file   ADM_JSDFInteger.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDFInteger.h&quot;
+
+ADM_JSDFIntegerHelper::ADM_JSDFIntegerHelper(const char *title,int32_t mn,int32_t mx)
+{
+	_title = ADM_strdup(title); 
+    _min=mn;
+    _max=mx;
+	_value = 0;
+}
+
+ADM_JSDFIntegerHelper::~ADM_JSDFIntegerHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFIntegerHelper::getControl(void)
+{
+    return new diaElemInteger(&amp;_value,_title, _min,_max);
+}
+
+int32_t ADM_JSDFIntegerHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFIntegerHelper::setValue(int32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFInteger::properties[] = 
+{ 
+	{ &quot;value&quot;, valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFInteger::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFInteger::m_dfIntegerHelper =
+{
+	&quot;DFInteger&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFInteger::JSGetProperty, ADM_JSDFInteger::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFInteger::JSDestructor
+};
+
+JSObject *ADM_JSDFInteger::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dfIntegerHelper, 
+		ADM_JSDFInteger::JSConstructor, 1,
+		ADM_JSDFInteger::properties, ADM_JSDFInteger::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFInteger::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 3)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[1]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[2]))
+		return JS_FALSE;
+
+
+	ADM_JSDFIntegerHelper *pObject = new ADM_JSDFIntegerHelper(
+                                                    JS_GetStringBytes(JSVAL_TO_STRING(argv[0])),
+                                                    JSVAL_TO_INT(argv[1]),
+                                                    JSVAL_TO_INT(argv[2])
+                                                );
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFInteger::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfIntegerHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFInteger::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject-&gt;value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFInteger::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject-&gt;setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,66 @@
+/**
+    \file   ADM_JSDFInteger.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFInteger_H
+#define _ADM_JSDFInteger_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDF.h&quot;
+/**
+    \class ADM_JSDFIntegerHelper
+*/
+class ADM_JSDFIntegerHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	int32_t             _value;
+    int32_t             _min,_max;
+
+public:
+                     ADM_JSDFIntegerHelper(const char *title,int32_t mn, int32_t mx);
+                     ~ADM_JSDFIntegerHelper(void);
+	virtual diaElem* getControl(void);
+            int32_t value(void);
+            void     setValue(int32_t value);
+};
+/**
+    \class ADM_JSDFInteger
+*/
+class ADM_JSDFInteger
+{
+protected:
+    int32_t   minimum,maximum;
+public:
+	ADM_JSDFInteger(int32_t mn,int32_t mx) {minimum=mn;maximum=mx;}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfIntegerHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp (from rev 6132, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,193 @@
+/**
+    \file   ADM_JSDFMenu.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDFMenu.h&quot;
+
+ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_menuEntries = NULL;
+	_index = 0;
+}
+
+ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+	std::vector&lt;char*&gt;::iterator it;
+
+	for (it = _items.begin(); it != _items.end(); it++)
+		delete *it;
+
+	_items.clear();
+
+	if (_menuEntries)
+		delete _menuEntries;
+
+	_menuEntries = NULL;
+}
+
+void ADM_JSDFMenuHelper::addItem(const char* item)
+{
+	_items.push_back(ADM_strdup(item));
+}
+
+diaElem* ADM_JSDFMenuHelper::getControl(void)
+{
+	if (_menuEntries)
+		delete _menuEntries;
+
+	std::vector&lt;char*&gt;::iterator it;
+	int i = 0;
+
+	_menuEntries = new diaMenuEntry[_items.size()];	
+
+	for (it = _items.begin(); it != _items.end(); it++)
+	{
+		_menuEntries[i].val = i;
+		_menuEntries[i].text = *it;
+		_menuEntries[i].desc = NULL;
+
+		i++;
+	}
+
+	return new diaElemMenu(&amp;_index, _title, _items.size(), _menuEntries);
+}
+
+int ADM_JSDFMenuHelper::index(void)
+{
+	return _index;
+}
+
+void ADM_JSDFMenuHelper::setIndex(int index)
+{
+	_index = index;
+}
+
+JSPropertySpec ADM_JSDFMenu::properties[] = 
+{ 
+	{ &quot;index&quot;, indexProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFMenu::methods[] =
+{
+	{ &quot;addItem&quot;, addItem, 1, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDFMenu::m_dfMenuHelper =
+{
+	&quot;DFMenu&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
+};
+
+JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dfMenuHelper, 
+		ADM_JSDFMenu::JSConstructor, 1,
+		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	pObject-&gt;addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject-&gt;index());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject-&gt;setIndex(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,70 @@
+/**
+    \file   ADM_JSDFMenu.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFMenu_H
+#define _ADM_JSDFMenu_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDF.h&quot;
+#include &lt;vector&gt;
+/**
+    \class ADM_JSDFMenuHelper
+*/
+class ADM_JSDFMenuHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	uint32_t            _index;
+	diaMenuEntry        *_menuEntries;
+	std::vector &lt;char*&gt; _items;
+
+public:
+                     ADM_JSDFMenuHelper(const char *title);
+                     ~ADM_JSDFMenuHelper(void);
+            void     addItem(const char* item);
+	virtual diaElem* getControl(void);
+            int      index(void);
+            void     setIndex(int index);
+};
+/**
+    \class ADM_JSDFMenu
+*/
+class ADM_JSDFMenu
+{
+public:
+	ADM_JSDFMenu(void) {}
+
+	static JSBool   JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void     JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool   JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool   JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+
+	static JSBool   addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
+
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass m_dfMenuHelper;
+
+	enum
+	{
+		indexProperty
+	};
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,147 @@
+/**
+    \file   ADM_JSDFToggle.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDFToggle.h&quot;
+
+ADM_JSDFToggleHelper::ADM_JSDFToggleHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_value = 0;
+}
+
+ADM_JSDFToggleHelper::~ADM_JSDFToggleHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFToggleHelper::getControl(void)
+{
+    return new   diaElemToggle(&amp;_value,_title,NULL);
+}
+
+uint32_t ADM_JSDFToggleHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFToggleHelper::setValue(uint32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFToggle::properties[] = 
+{ 
+	{ &quot;value&quot;, valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFToggle::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFToggle::m_dfToggleHelper =
+{
+	&quot;DFToggle&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFToggle::JSGetProperty, ADM_JSDFToggle::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFToggle::JSDestructor
+};
+
+JSObject *ADM_JSDFToggle::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dfToggleHelper, 
+		ADM_JSDFToggle::JSConstructor, 1,
+		ADM_JSDFToggle::properties, ADM_JSDFToggle::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFToggle::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFToggleHelper *pObject = new ADM_JSDFToggleHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFToggle::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfToggleHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFToggle::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject-&gt;value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFToggle::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject-&gt;setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,63 @@
+/**
+    \file   ADM_JSDFToggle.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFToggle_H
+#define _ADM_JSDFToggle_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDF.h&quot;
+/**
+    \class ADM_JSDFToggleHelper
+*/
+class ADM_JSDFToggleHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	uint32_t            _value;
+
+public:
+                     ADM_JSDFToggleHelper(const char *title);
+                     ~ADM_JSDFToggleHelper(void);
+	virtual diaElem* getControl(void);
+            uint32_t value(void);
+            void     setValue(uint32_t value);
+};
+/**
+    \class ADM_JSDFToggle
+*/
+class ADM_JSDFToggle
+{
+public:
+	ADM_JSDFToggle(void) {}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfToggleHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp (from rev 6132, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,138 @@
+/**
+    \file   ADM_JSDialogFactory.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_JSDialogFactory.h&quot;
+
+ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+}
+
+ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+}
+
+void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFBaseHelper* control)
+{
+	_controls.push_back(control);
+}
+
+diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
+{
+	*controlCount = (int)_controls.size();
+
+	std::vector&lt;ADM_JSDFBaseHelper*&gt;::iterator it;
+	int i = 0;
+	diaElem **elems = new diaElem*[*controlCount];
+
+	for (it = _controls.begin(); it != _controls.end(); it++)
+	{
+		elems[i] = (*it)-&gt;getControl();
+		i++;
+	}
+
+	return elems;
+}
+
+const char* ADM_JSDialogFactoryHelper::title(void)
+{
+	return _title;
+}
+
+JSFunctionSpec ADM_JSDialogFactory::methods[] =
+{
+	{ &quot;addControl&quot;, addControl, 1, 0, 0 },
+	{ &quot;show&quot;, show, 0, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
+{
+	&quot;DialogFactory&quot;, JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
+};
+
+JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &amp;m_dialogFactoryHelper, 
+		ADM_JSDialogFactory::JSConstructor, 1,
+		NULL, ADM_JSDialogFactory::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (JSVAL_IS_STRING(argv[0]) == false)
+		return JS_FALSE;
+
+	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (pObject != NULL)
+		delete pObject;
+}
+
+JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	p-&gt;addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &amp;m_dialogFactoryHelper, NULL);
+
+	if (argc != 0)
+		return JS_FALSE;
+
+	int controlCount;
+	diaElem **elems = p-&gt;getControls(&amp;controlCount);
+
+	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p-&gt;title(), controlCount, elems));
+
+	for (int i = 0; i &lt; controlCount; i++)
+		delete elems[i];
+
+	delete elems;
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,61 @@
+/**
+    \file   ADM_JSDialogFactory.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDialogFactory_H
+#define _ADM_JSDialogFactory_H
+
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDFMenu.h&quot;
+#include &lt;vector&gt;
+/**
+    \class ADM_JSDialogFactoryHelper
+*/
+class ADM_JSDialogFactoryHelper
+{
+private:
+	char* _title;
+	std::vector &lt;ADM_JSDFBaseHelper*&gt; _controls;
+
+public:
+	ADM_JSDialogFactoryHelper(const char *title);
+	~ADM_JSDialogFactoryHelper(void);
+	void addControl(ADM_JSDFBaseHelper* control);
+	diaElem** getControls(int *controlCount);
+	const char* title(void);
+};
+/**
+    \class ADM_JSDialogFactory
+*/
+
+class ADM_JSDialogFactory
+{
+public:
+	ADM_JSDialogFactory(void) {}
+	virtual ~ADM_JSDialogFactory(void);
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+	static JSFunctionSpec methods[];
+	static JSClass m_dialogFactoryHelper;
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,56 @@
+/**
+    \file   ADM_JSDialogFactory_if.cpp
+    \brief  JS / DF binding
+    \author gruntster, mean (c) 2010
+
+
+    jsapigen does not like much variable number of arguments
+    In that case, we patch the generated file to go back to native spidermonkey api
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_default.h&quot;
+#include &quot;jsapi.h&quot;
+#include &quot;DIA_factory.h&quot;
+#include &quot;ADM_JSDFMenu.h&quot;
+#include &quot;ADM_JSDFToggle.h&quot;
+#include &quot;ADM_JSDFInteger.h&quot;
+#include &quot;ADM_JSDialogFactory.h&quot;
+
+/**
+    \fn ADM_JSDialogFactoryInit()
+    \brief Hook classes to spidermonkey
+*/
+bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj)
+{
+    if(NULL==ADM_JSDialogFactory::JSInit(cx,obj))
+    {
+        ADM_error(&quot;Cannot register dialogFactory js class\n&quot;);
+        return false;
+    }
+    if(NULL==ADM_JSDFMenu::JSInit(cx,obj))
+    {
+        ADM_error(&quot;Cannot register  menu js class\n&quot;);
+        return false;
+    }
+    if(NULL==ADM_JSDFToggle::JSInit(cx,obj))
+    {
+        ADM_error(&quot;Cannot register toggle js class\n&quot;);
+        return false;
+    }
+    if(NULL==ADM_JSDFInteger::JSInit(cx,obj))
+    {
+        ADM_error(&quot;Cannot register integer js class\n&quot;);
+        return false;
+    }
+    ADM_info(&quot;Registered DialogFactory classes\n&quot;);
+    return true;
+}
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003336.html">[Avidemux-svn-commit] r6132 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
</A></li>
	<LI>Next message: <A HREF="003338.html">[Avidemux-svn-commit] r6134 -	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3337">[ date ]</a>
              <a href="thread.html#3337">[ thread ]</a>
              <a href="subject.html#3337">[ subject ]</a>
              <a href="author.html#3337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
